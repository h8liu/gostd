<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html" class="current">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5427496">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5427552">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5427606">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5427657">package</span>&nbsp;<span class="ident" id="5427665">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5427673">import</span>&nbsp;<span class="op" id="5427680">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427683">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427691">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427702">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5427713">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5427728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427731">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5427793">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5427832">type</span>&nbsp;<span class="ident" id="5427837">Error</span>&nbsp;<span class="keyword" id="5427843">struct</span>&nbsp;<span class="op" id="5427850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427853">Code</span>&nbsp;<span class="ident" id="5427858">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427869">Expr</span>&nbsp;<span class="builtintype" id="5427874">string</span><br>
<span class="lineno"></span><span class="op" id="5427881">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5427884">func</span>&nbsp;<span class="op" id="5427889">(</span><span class="ident" id="5427890">e</span>&nbsp;<span class="op" id="5427892">*</span><span class="ident" id="5427893">Error</span><span class="op" id="5427898">)</span>&nbsp;<span class="ident" id="5427900">Error</span><span class="op" id="5427905">(</span><span class="op" id="5427906">)</span>&nbsp;<span class="builtintype" id="5427908">string</span>&nbsp;<span class="op" id="5427915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427918">return</span>&nbsp;<span class="string" id="5427925">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5427950">+</span>&nbsp;<span class="ident" id="5427952">e</span><span class="op" id="5427953">.</span><span class="ident" id="5427954">Code</span><span class="op" id="5427958">.</span><span class="ident" id="5427959">String</span><span class="op" id="5427965">(</span><span class="op" id="5427966">)</span>&nbsp;<span class="op" id="5427968">+</span>&nbsp;<span class="string" id="5427970">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5427976">+</span>&nbsp;<span class="ident" id="5427978">e</span><span class="op" id="5427979">.</span><span class="ident" id="5427980">Expr</span>&nbsp;<span class="op" id="5427985">+</span>&nbsp;<span class="string" id="5427987">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5427991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5427994">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5428061">type</span>&nbsp;<span class="ident" id="5428066">ErrorCode</span>&nbsp;<span class="builtintype" id="5428076">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5428084">const</span>&nbsp;<span class="op" id="5428090">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428093">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428114">ErrInternalError</span>&nbsp;<span class="ident" id="5428131">ErrorCode</span>&nbsp;<span class="op" id="5428141">=</span>&nbsp;<span class="string" id="5428143">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428177">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428194">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428219">ErrorCode</span>&nbsp;<span class="op" id="5428229">=</span>&nbsp;<span class="string" id="5428231">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428258">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428283">ErrorCode</span>&nbsp;<span class="op" id="5428293">=</span>&nbsp;<span class="string" id="5428295">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428328">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428353">ErrorCode</span>&nbsp;<span class="op" id="5428363">=</span>&nbsp;<span class="string" id="5428365">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428392">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5428417">ErrorCode</span>&nbsp;<span class="op" id="5428427">=</span>&nbsp;<span class="string" id="5428429">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428454">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428479">ErrorCode</span>&nbsp;<span class="op" id="5428489">=</span>&nbsp;<span class="string" id="5428491">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428529">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428554">ErrorCode</span>&nbsp;<span class="op" id="5428564">=</span>&nbsp;<span class="string" id="5428566">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428604">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428629">ErrorCode</span>&nbsp;<span class="op" id="5428639">=</span>&nbsp;<span class="string" id="5428641">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428665">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428690">ErrorCode</span>&nbsp;<span class="op" id="5428700">=</span>&nbsp;<span class="string" id="5428702">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428719">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428744">ErrorCode</span>&nbsp;<span class="op" id="5428754">=</span>&nbsp;<span class="string" id="5428756">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428777">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428802">ErrorCode</span>&nbsp;<span class="op" id="5428812">=</span>&nbsp;<span class="string" id="5428814">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428835">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5428860">ErrorCode</span>&nbsp;<span class="op" id="5428870">=</span>&nbsp;<span class="string" id="5428872">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428915">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428940">ErrorCode</span>&nbsp;<span class="op" id="5428950">=</span>&nbsp;<span class="string" id="5428952">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428995">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429020">ErrorCode</span>&nbsp;<span class="op" id="5429030">=</span>&nbsp;<span class="string" id="5429032">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5429047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5429050">func</span>&nbsp;<span class="op" id="5429055">(</span><span class="ident" id="5429056">e</span>&nbsp;<span class="ident" id="5429058">ErrorCode</span><span class="op" id="5429067">)</span>&nbsp;<span class="ident" id="5429069">String</span><span class="op" id="5429075">(</span><span class="op" id="5429076">)</span>&nbsp;<span class="builtintype" id="5429078">string</span>&nbsp;<span class="op" id="5429085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429088">return</span>&nbsp;<span class="builtintype" id="5429095">string</span><span class="op" id="5429101">(</span><span class="ident" id="5429102">e</span><span class="op" id="5429103">)</span><br>
<span class="lineno">50</span><span class="op" id="5429105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5429108">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5429197">type</span>&nbsp;<span class="ident" id="5429202">Flags</span>&nbsp;<span class="builtintype" id="5429208">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5429216">const</span>&nbsp;<span class="op" id="5429222">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429225">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429239">Flags</span>&nbsp;<span class="op" id="5429245">=</span>&nbsp;<span class="num" id="5429247">1</span>&nbsp;<span class="op" id="5429249">&lt;&lt;</span>&nbsp;<span class="ident" id="5429252">iota</span>&nbsp;<span class="comment" id="5429257">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429284">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429316">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429352">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429384">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429457">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429489">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429518">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429550">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429614">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429646">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429698">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429730">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429756">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429788">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429846">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429878">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429913">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429945">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429988">MatchNL</span>&nbsp;<span class="op" id="5429996">=</span>&nbsp;<span class="ident" id="5429998">ClassNL</span>&nbsp;<span class="op" id="5430006">|</span>&nbsp;<span class="ident" id="5430008">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430016">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430028">=</span>&nbsp;<span class="ident" id="5430030">ClassNL</span>&nbsp;<span class="op" id="5430038">|</span>&nbsp;<span class="ident" id="5430040">OneLine</span>&nbsp;<span class="op" id="5430048">|</span>&nbsp;<span class="ident" id="5430050">PerlX</span>&nbsp;<span class="op" id="5430056">|</span>&nbsp;<span class="ident" id="5430058">UnicodeGroups</span>&nbsp;<span class="comment" id="5430072">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430105">POSIX</span>&nbsp;<span class="ident" id="5430111">Flags</span>&nbsp;<span class="op" id="5430117">=</span>&nbsp;<span class="num" id="5430119">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430161">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5430177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430180">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5430213">const</span>&nbsp;<span class="op" id="5430219">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430222">opLeftParen</span>&nbsp;<span class="op" id="5430234">=</span>&nbsp;<span class="ident" id="5430236">opPseudo</span>&nbsp;<span class="op" id="5430245">+</span>&nbsp;<span class="ident" id="5430247">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430253">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5430267">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430270">type</span>&nbsp;<span class="ident" id="5430275">parser</span>&nbsp;<span class="keyword" id="5430282">struct</span>&nbsp;<span class="op" id="5430289">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430292">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430304">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5430314">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430335">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430347">[</span><span class="op" id="5430348">]</span><span class="op" id="5430349">*</span><span class="ident" id="5430350">Regexp</span>&nbsp;<span class="comment" id="5430357">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430389">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430401">*</span><span class="ident" id="5430402">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430410">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5430422">int</span>&nbsp;<span class="comment" id="5430426">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430462">wholeRegexp</span>&nbsp;<span class="builtintype" id="5430474">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430482">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430494">[</span><span class="op" id="5430495">]</span><span class="builtintype" id="5430496">rune</span>&nbsp;<span class="comment" id="5430501">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5430536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430539">func</span>&nbsp;<span class="op" id="5430544">(</span><span class="ident" id="5430545">p</span>&nbsp;<span class="op" id="5430547">*</span><span class="ident" id="5430548">parser</span><span class="op" id="5430554">)</span>&nbsp;<span class="ident" id="5430556">newRegexp</span><span class="op" id="5430565">(</span><span class="ident" id="5430566">op</span>&nbsp;<span class="ident" id="5430569">Op</span><span class="op" id="5430571">)</span>&nbsp;<span class="op" id="5430573">*</span><span class="ident" id="5430574">Regexp</span>&nbsp;<span class="op" id="5430581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430584">re</span>&nbsp;<span class="op" id="5430587">:=</span>&nbsp;<span class="ident" id="5430590">p</span><span class="op" id="5430591">.</span><span class="ident" id="5430592">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430598">if</span>&nbsp;<span class="ident" id="5430601">re</span>&nbsp;<span class="op" id="5430604">!=</span>&nbsp;<span class="ident" id="5430607">nil</span>&nbsp;<span class="op" id="5430611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430615">p</span><span class="op" id="5430616">.</span><span class="ident" id="5430617">free</span>&nbsp;<span class="op" id="5430622">=</span>&nbsp;<span class="ident" id="5430624">re</span><span class="op" id="5430626">.</span><span class="ident" id="5430627">Sub0</span><span class="op" id="5430631">[</span><span class="num" id="5430632">0</span><span class="op" id="5430633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430637">*</span><span class="ident" id="5430638">re</span>&nbsp;<span class="op" id="5430641">=</span>&nbsp;<span class="ident" id="5430643">Regexp</span><span class="op" id="5430649">{</span><span class="op" id="5430650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430653">}</span>&nbsp;<span class="keyword" id="5430655">else</span>&nbsp;<span class="op" id="5430660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430664">re</span>&nbsp;<span class="op" id="5430667">=</span>&nbsp;<span class="builtinfunc" id="5430669">new</span><span class="op" id="5430672">(</span><span class="ident" id="5430673">Regexp</span><span class="op" id="5430679">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5430682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430685">re</span><span class="op" id="5430687">.</span><span class="ident" id="5430688">Op</span>&nbsp;<span class="op" id="5430691">=</span>&nbsp;<span class="ident" id="5430693">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430697">return</span>&nbsp;<span class="ident" id="5430704">re</span><br>
<span class="lineno"></span><span class="op" id="5430707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5430710">func</span>&nbsp;<span class="op" id="5430715">(</span><span class="ident" id="5430716">p</span>&nbsp;<span class="op" id="5430718">*</span><span class="ident" id="5430719">parser</span><span class="op" id="5430725">)</span>&nbsp;<span class="ident" id="5430727">reuse</span><span class="op" id="5430732">(</span><span class="ident" id="5430733">re</span>&nbsp;<span class="op" id="5430736">*</span><span class="ident" id="5430737">Regexp</span><span class="op" id="5430743">)</span>&nbsp;<span class="op" id="5430745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430748">re</span><span class="op" id="5430750">.</span><span class="ident" id="5430751">Sub0</span><span class="op" id="5430755">[</span><span class="num" id="5430756">0</span><span class="op" id="5430757">]</span>&nbsp;<span class="op" id="5430759">=</span>&nbsp;<span class="ident" id="5430761">p</span><span class="op" id="5430762">.</span><span class="ident" id="5430763">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5430769">p</span><span class="op" id="5430770">.</span><span class="ident" id="5430771">free</span>&nbsp;<span class="op" id="5430776">=</span>&nbsp;<span class="ident" id="5430778">re</span><br>
<span class="lineno"></span><span class="op" id="5430781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5430784">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430814">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5430888">func</span>&nbsp;<span class="op" id="5430893">(</span><span class="ident" id="5430894">p</span>&nbsp;<span class="op" id="5430896">*</span><span class="ident" id="5430897">parser</span><span class="op" id="5430903">)</span>&nbsp;<span class="ident" id="5430905">push</span><span class="op" id="5430909">(</span><span class="ident" id="5430910">re</span>&nbsp;<span class="op" id="5430913">*</span><span class="ident" id="5430914">Regexp</span><span class="op" id="5430920">)</span>&nbsp;<span class="op" id="5430922">*</span><span class="ident" id="5430923">Regexp</span>&nbsp;<span class="op" id="5430930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5430933">if</span>&nbsp;<span class="ident" id="5430936">re</span><span class="op" id="5430938">.</span><span class="ident" id="5430939">Op</span>&nbsp;<span class="op" id="5430942">==</span>&nbsp;<span class="ident" id="5430945">OpCharClass</span>&nbsp;<span class="op" id="5430957">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5430960">len</span><span class="op" id="5430963">(</span><span class="ident" id="5430964">re</span><span class="op" id="5430966">.</span><span class="ident" id="5430967">Rune</span><span class="op" id="5430971">)</span>&nbsp;<span class="op" id="5430973">==</span>&nbsp;<span class="num" id="5430976">2</span>&nbsp;<span class="op" id="5430978">&amp;&amp;</span>&nbsp;<span class="ident" id="5430981">re</span><span class="op" id="5430983">.</span><span class="ident" id="5430984">Rune</span><span class="op" id="5430988">[</span><span class="num" id="5430989">0</span><span class="op" id="5430990">]</span>&nbsp;<span class="op" id="5430992">==</span>&nbsp;<span class="ident" id="5430995">re</span><span class="op" id="5430997">.</span><span class="ident" id="5430998">Rune</span><span class="op" id="5431002">[</span><span class="num" id="5431003">1</span><span class="op" id="5431004">]</span>&nbsp;<span class="op" id="5431006">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431010">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431028">if</span>&nbsp;<span class="ident" id="5431031">p</span><span class="op" id="5431032">.</span><span class="ident" id="5431033">maybeConcat</span><span class="op" id="5431044">(</span><span class="ident" id="5431045">re</span><span class="op" id="5431047">.</span><span class="ident" id="5431048">Rune</span><span class="op" id="5431052">[</span><span class="num" id="5431053">0</span><span class="op" id="5431054">]</span><span class="op" id="5431055">,</span>&nbsp;<span class="ident" id="5431057">p</span><span class="op" id="5431058">.</span><span class="ident" id="5431059">flags</span><span class="op" id="5431064">&amp;^</span><span class="ident" id="5431066">FoldCase</span><span class="op" id="5431074">)</span>&nbsp;<span class="op" id="5431076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431081">return</span>&nbsp;<span class="ident" id="5431088">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431098">re</span><span class="op" id="5431100">.</span><span class="ident" id="5431101">Op</span>&nbsp;<span class="op" id="5431104">=</span>&nbsp;<span class="ident" id="5431106">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431118">re</span><span class="op" id="5431120">.</span><span class="ident" id="5431121">Rune</span>&nbsp;<span class="op" id="5431126">=</span>&nbsp;<span class="ident" id="5431128">re</span><span class="op" id="5431130">.</span><span class="ident" id="5431131">Rune</span><span class="op" id="5431135">[</span><span class="op" id="5431136">:</span><span class="num" id="5431137">1</span><span class="op" id="5431138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431142">re</span><span class="op" id="5431144">.</span><span class="ident" id="5431145">Flags</span>&nbsp;<span class="op" id="5431151">=</span>&nbsp;<span class="ident" id="5431153">p</span><span class="op" id="5431154">.</span><span class="ident" id="5431155">flags</span>&nbsp;<span class="op" id="5431161">&amp;^</span>&nbsp;<span class="ident" id="5431164">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431174">}</span>&nbsp;<span class="keyword" id="5431176">else</span>&nbsp;<span class="keyword" id="5431181">if</span>&nbsp;<span class="ident" id="5431184">re</span><span class="op" id="5431186">.</span><span class="ident" id="5431187">Op</span>&nbsp;<span class="op" id="5431190">==</span>&nbsp;<span class="ident" id="5431193">OpCharClass</span>&nbsp;<span class="op" id="5431205">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5431208">len</span><span class="op" id="5431211">(</span><span class="ident" id="5431212">re</span><span class="op" id="5431214">.</span><span class="ident" id="5431215">Rune</span><span class="op" id="5431219">)</span>&nbsp;<span class="op" id="5431221">==</span>&nbsp;<span class="num" id="5431224">4</span>&nbsp;<span class="op" id="5431226">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431231">re</span><span class="op" id="5431233">.</span><span class="ident" id="5431234">Rune</span><span class="op" id="5431238">[</span><span class="num" id="5431239">0</span><span class="op" id="5431240">]</span>&nbsp;<span class="op" id="5431242">==</span>&nbsp;<span class="ident" id="5431245">re</span><span class="op" id="5431247">.</span><span class="ident" id="5431248">Rune</span><span class="op" id="5431252">[</span><span class="num" id="5431253">1</span><span class="op" id="5431254">]</span>&nbsp;<span class="op" id="5431256">&amp;&amp;</span>&nbsp;<span class="ident" id="5431259">re</span><span class="op" id="5431261">.</span><span class="ident" id="5431262">Rune</span><span class="op" id="5431266">[</span><span class="num" id="5431267">2</span><span class="op" id="5431268">]</span>&nbsp;<span class="op" id="5431270">==</span>&nbsp;<span class="ident" id="5431273">re</span><span class="op" id="5431275">.</span><span class="ident" id="5431276">Rune</span><span class="op" id="5431280">[</span><span class="num" id="5431281">3</span><span class="op" id="5431282">]</span>&nbsp;<span class="op" id="5431284">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431289">unicode</span><span class="op" id="5431296">.</span><span class="ident" id="5431297">SimpleFold</span><span class="op" id="5431307">(</span><span class="ident" id="5431308">re</span><span class="op" id="5431310">.</span><span class="ident" id="5431311">Rune</span><span class="op" id="5431315">[</span><span class="num" id="5431316">0</span><span class="op" id="5431317">]</span><span class="op" id="5431318">)</span>&nbsp;<span class="op" id="5431320">==</span>&nbsp;<span class="ident" id="5431323">re</span><span class="op" id="5431325">.</span><span class="ident" id="5431326">Rune</span><span class="op" id="5431330">[</span><span class="num" id="5431331">2</span><span class="op" id="5431332">]</span>&nbsp;<span class="op" id="5431334">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431339">unicode</span><span class="op" id="5431346">.</span><span class="ident" id="5431347">SimpleFold</span><span class="op" id="5431357">(</span><span class="ident" id="5431358">re</span><span class="op" id="5431360">.</span><span class="ident" id="5431361">Rune</span><span class="op" id="5431365">[</span><span class="num" id="5431366">2</span><span class="op" id="5431367">]</span><span class="op" id="5431368">)</span>&nbsp;<span class="op" id="5431370">==</span>&nbsp;<span class="ident" id="5431373">re</span><span class="op" id="5431375">.</span><span class="ident" id="5431376">Rune</span><span class="op" id="5431380">[</span><span class="num" id="5431381">0</span><span class="op" id="5431382">]</span>&nbsp;<span class="op" id="5431384">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431389">re</span><span class="op" id="5431391">.</span><span class="ident" id="5431392">Op</span>&nbsp;<span class="op" id="5431395">==</span>&nbsp;<span class="ident" id="5431398">OpCharClass</span>&nbsp;<span class="op" id="5431410">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5431413">len</span><span class="op" id="5431416">(</span><span class="ident" id="5431417">re</span><span class="op" id="5431419">.</span><span class="ident" id="5431420">Rune</span><span class="op" id="5431424">)</span>&nbsp;<span class="op" id="5431426">==</span>&nbsp;<span class="num" id="5431429">2</span>&nbsp;<span class="op" id="5431431">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431437">re</span><span class="op" id="5431439">.</span><span class="ident" id="5431440">Rune</span><span class="op" id="5431444">[</span><span class="num" id="5431445">0</span><span class="op" id="5431446">]</span><span class="op" id="5431447">+</span><span class="num" id="5431448">1</span>&nbsp;<span class="op" id="5431450">==</span>&nbsp;<span class="ident" id="5431453">re</span><span class="op" id="5431455">.</span><span class="ident" id="5431456">Rune</span><span class="op" id="5431460">[</span><span class="num" id="5431461">1</span><span class="op" id="5431462">]</span>&nbsp;<span class="op" id="5431464">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431470">unicode</span><span class="op" id="5431477">.</span><span class="ident" id="5431478">SimpleFold</span><span class="op" id="5431488">(</span><span class="ident" id="5431489">re</span><span class="op" id="5431491">.</span><span class="ident" id="5431492">Rune</span><span class="op" id="5431496">[</span><span class="num" id="5431497">0</span><span class="op" id="5431498">]</span><span class="op" id="5431499">)</span>&nbsp;<span class="op" id="5431501">==</span>&nbsp;<span class="ident" id="5431504">re</span><span class="op" id="5431506">.</span><span class="ident" id="5431507">Rune</span><span class="op" id="5431511">[</span><span class="num" id="5431512">1</span><span class="op" id="5431513">]</span>&nbsp;<span class="op" id="5431515">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431521">unicode</span><span class="op" id="5431528">.</span><span class="ident" id="5431529">SimpleFold</span><span class="op" id="5431539">(</span><span class="ident" id="5431540">re</span><span class="op" id="5431542">.</span><span class="ident" id="5431543">Rune</span><span class="op" id="5431547">[</span><span class="num" id="5431548">1</span><span class="op" id="5431549">]</span><span class="op" id="5431550">)</span>&nbsp;<span class="op" id="5431552">==</span>&nbsp;<span class="ident" id="5431555">re</span><span class="op" id="5431557">.</span><span class="ident" id="5431558">Rune</span><span class="op" id="5431562">[</span><span class="num" id="5431563">0</span><span class="op" id="5431564">]</span>&nbsp;<span class="op" id="5431566">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431570">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431618">if</span>&nbsp;<span class="ident" id="5431621">p</span><span class="op" id="5431622">.</span><span class="ident" id="5431623">maybeConcat</span><span class="op" id="5431634">(</span><span class="ident" id="5431635">re</span><span class="op" id="5431637">.</span><span class="ident" id="5431638">Rune</span><span class="op" id="5431642">[</span><span class="num" id="5431643">0</span><span class="op" id="5431644">]</span><span class="op" id="5431645">,</span>&nbsp;<span class="ident" id="5431647">p</span><span class="op" id="5431648">.</span><span class="ident" id="5431649">flags</span><span class="op" id="5431654">|</span><span class="ident" id="5431655">FoldCase</span><span class="op" id="5431663">)</span>&nbsp;<span class="op" id="5431665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431670">return</span>&nbsp;<span class="ident" id="5431677">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431688">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431732">re</span><span class="op" id="5431734">.</span><span class="ident" id="5431735">Op</span>&nbsp;<span class="op" id="5431738">=</span>&nbsp;<span class="ident" id="5431740">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431752">re</span><span class="op" id="5431754">.</span><span class="ident" id="5431755">Rune</span>&nbsp;<span class="op" id="5431760">=</span>&nbsp;<span class="ident" id="5431762">re</span><span class="op" id="5431764">.</span><span class="ident" id="5431765">Rune</span><span class="op" id="5431769">[</span><span class="op" id="5431770">:</span><span class="num" id="5431771">1</span><span class="op" id="5431772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431776">re</span><span class="op" id="5431778">.</span><span class="ident" id="5431779">Flags</span>&nbsp;<span class="op" id="5431785">=</span>&nbsp;<span class="ident" id="5431787">p</span><span class="op" id="5431788">.</span><span class="ident" id="5431789">flags</span>&nbsp;<span class="op" id="5431795">|</span>&nbsp;<span class="ident" id="5431797">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431807">}</span>&nbsp;<span class="keyword" id="5431809">else</span>&nbsp;<span class="op" id="5431814">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5431818">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431850">p</span><span class="op" id="5431851">.</span><span class="ident" id="5431852">maybeConcat</span><span class="op" id="5431863">(</span><span class="op" id="5431864">-</span><span class="num" id="5431865">1</span><span class="op" id="5431866">,</span>&nbsp;<span class="num" id="5431868">0</span><span class="op" id="5431869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5431872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5431876">p</span><span class="op" id="5431877">.</span><span class="ident" id="5431878">stack</span>&nbsp;<span class="op" id="5431884">=</span>&nbsp;<span class="builtinfunc" id="5431886">append</span><span class="op" id="5431892">(</span><span class="ident" id="5431893">p</span><span class="op" id="5431894">.</span><span class="ident" id="5431895">stack</span><span class="op" id="5431900">,</span>&nbsp;<span class="ident" id="5431902">re</span><span class="op" id="5431904">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5431907">return</span>&nbsp;<span class="ident" id="5431914">re</span><br>
<span class="lineno"></span><span class="op" id="5431917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5431920">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5431972">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5432034">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5432093">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5432156">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5432220">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5432262">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5432325">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5432360">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5432405">func</span>&nbsp;<span class="op" id="5432410">(</span><span class="ident" id="5432411">p</span>&nbsp;<span class="op" id="5432413">*</span><span class="ident" id="5432414">parser</span><span class="op" id="5432420">)</span>&nbsp;<span class="ident" id="5432422">maybeConcat</span><span class="op" id="5432433">(</span><span class="ident" id="5432434">r</span>&nbsp;<span class="builtintype" id="5432436">rune</span><span class="op" id="5432440">,</span>&nbsp;<span class="ident" id="5432442">flags</span>&nbsp;<span class="ident" id="5432448">Flags</span><span class="op" id="5432453">)</span>&nbsp;<span class="builtintype" id="5432455">bool</span>&nbsp;<span class="op" id="5432460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432463">n</span>&nbsp;<span class="op" id="5432465">:=</span>&nbsp;<span class="builtinfunc" id="5432468">len</span><span class="op" id="5432471">(</span><span class="ident" id="5432472">p</span><span class="op" id="5432473">.</span><span class="ident" id="5432474">stack</span><span class="op" id="5432479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432482">if</span>&nbsp;<span class="ident" id="5432485">n</span>&nbsp;<span class="op" id="5432487">&lt;</span>&nbsp;<span class="num" id="5432489">2</span>&nbsp;<span class="op" id="5432491">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432495">return</span>&nbsp;<span class="builtintype" id="5432502">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432513">re1</span>&nbsp;<span class="op" id="5432517">:=</span>&nbsp;<span class="ident" id="5432520">p</span><span class="op" id="5432521">.</span><span class="ident" id="5432522">stack</span><span class="op" id="5432527">[</span><span class="ident" id="5432528">n</span><span class="op" id="5432529">-</span><span class="num" id="5432530">1</span><span class="op" id="5432531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432534">re2</span>&nbsp;<span class="op" id="5432538">:=</span>&nbsp;<span class="ident" id="5432541">p</span><span class="op" id="5432542">.</span><span class="ident" id="5432543">stack</span><span class="op" id="5432548">[</span><span class="ident" id="5432549">n</span><span class="op" id="5432550">-</span><span class="num" id="5432551">2</span><span class="op" id="5432552">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432555">if</span>&nbsp;<span class="ident" id="5432558">re1</span><span class="op" id="5432561">.</span><span class="ident" id="5432562">Op</span>&nbsp;<span class="op" id="5432565">!=</span>&nbsp;<span class="ident" id="5432568">OpLiteral</span>&nbsp;<span class="op" id="5432578">||</span>&nbsp;<span class="ident" id="5432581">re2</span><span class="op" id="5432584">.</span><span class="ident" id="5432585">Op</span>&nbsp;<span class="op" id="5432588">!=</span>&nbsp;<span class="ident" id="5432591">OpLiteral</span>&nbsp;<span class="op" id="5432601">||</span>&nbsp;<span class="ident" id="5432604">re1</span><span class="op" id="5432607">.</span><span class="ident" id="5432608">Flags</span><span class="op" id="5432613">&amp;</span><span class="ident" id="5432614">FoldCase</span>&nbsp;<span class="op" id="5432623">!=</span>&nbsp;<span class="ident" id="5432626">re2</span><span class="op" id="5432629">.</span><span class="ident" id="5432630">Flags</span><span class="op" id="5432635">&amp;</span><span class="ident" id="5432636">FoldCase</span>&nbsp;<span class="op" id="5432645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432649">return</span>&nbsp;<span class="builtintype" id="5432656">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5432667">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432690">re2</span><span class="op" id="5432693">.</span><span class="ident" id="5432694">Rune</span>&nbsp;<span class="op" id="5432699">=</span>&nbsp;<span class="builtinfunc" id="5432701">append</span><span class="op" id="5432707">(</span><span class="ident" id="5432708">re2</span><span class="op" id="5432711">.</span><span class="ident" id="5432712">Rune</span><span class="op" id="5432716">,</span>&nbsp;<span class="ident" id="5432718">re1</span><span class="op" id="5432721">.</span><span class="ident" id="5432722">Rune</span><span class="op" id="5432726">...</span><span class="op" id="5432729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5432733">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432760">if</span>&nbsp;<span class="ident" id="5432763">r</span>&nbsp;<span class="op" id="5432765">&gt;=</span>&nbsp;<span class="num" id="5432768">0</span>&nbsp;<span class="op" id="5432770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432774">re1</span><span class="op" id="5432777">.</span><span class="ident" id="5432778">Rune</span>&nbsp;<span class="op" id="5432783">=</span>&nbsp;<span class="ident" id="5432785">re1</span><span class="op" id="5432788">.</span><span class="ident" id="5432789">Rune0</span><span class="op" id="5432794">[</span><span class="op" id="5432795">:</span><span class="num" id="5432796">1</span><span class="op" id="5432797">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432801">re1</span><span class="op" id="5432804">.</span><span class="ident" id="5432805">Rune</span><span class="op" id="5432809">[</span><span class="num" id="5432810">0</span><span class="op" id="5432811">]</span>&nbsp;<span class="op" id="5432813">=</span>&nbsp;<span class="ident" id="5432815">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432819">re1</span><span class="op" id="5432822">.</span><span class="ident" id="5432823">Flags</span>&nbsp;<span class="op" id="5432829">=</span>&nbsp;<span class="ident" id="5432831">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432839">return</span>&nbsp;<span class="builtintype" id="5432846">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5432852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432856">p</span><span class="op" id="5432857">.</span><span class="ident" id="5432858">stack</span>&nbsp;<span class="op" id="5432864">=</span>&nbsp;<span class="ident" id="5432866">p</span><span class="op" id="5432867">.</span><span class="ident" id="5432868">stack</span><span class="op" id="5432873">[</span><span class="op" id="5432874">:</span><span class="ident" id="5432875">n</span><span class="op" id="5432876">-</span><span class="num" id="5432877">1</span><span class="op" id="5432878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432881">p</span><span class="op" id="5432882">.</span><span class="ident" id="5432883">reuse</span><span class="op" id="5432888">(</span><span class="ident" id="5432889">re1</span><span class="op" id="5432892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5432895">return</span>&nbsp;<span class="builtintype" id="5432902">false</span>&nbsp;<span class="comment" id="5432908">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5432926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5432929">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5432995">func</span>&nbsp;<span class="op" id="5433000">(</span><span class="ident" id="5433001">p</span>&nbsp;<span class="op" id="5433003">*</span><span class="ident" id="5433004">parser</span><span class="op" id="5433010">)</span>&nbsp;<span class="ident" id="5433012">newLiteral</span><span class="op" id="5433022">(</span><span class="ident" id="5433023">r</span>&nbsp;<span class="builtintype" id="5433025">rune</span><span class="op" id="5433029">,</span>&nbsp;<span class="ident" id="5433031">flags</span>&nbsp;<span class="ident" id="5433037">Flags</span><span class="op" id="5433042">)</span>&nbsp;<span class="op" id="5433044">*</span><span class="ident" id="5433045">Regexp</span>&nbsp;<span class="op" id="5433052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433055">re</span>&nbsp;<span class="op" id="5433058">:=</span>&nbsp;<span class="ident" id="5433061">p</span><span class="op" id="5433062">.</span><span class="ident" id="5433063">newRegexp</span><span class="op" id="5433072">(</span><span class="ident" id="5433073">OpLiteral</span><span class="op" id="5433082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433085">re</span><span class="op" id="5433087">.</span><span class="ident" id="5433088">Flags</span>&nbsp;<span class="op" id="5433094">=</span>&nbsp;<span class="ident" id="5433096">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433103">if</span>&nbsp;<span class="ident" id="5433106">flags</span><span class="op" id="5433111">&amp;</span><span class="ident" id="5433112">FoldCase</span>&nbsp;<span class="op" id="5433121">!=</span>&nbsp;<span class="num" id="5433124">0</span>&nbsp;<span class="op" id="5433126">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433130">r</span>&nbsp;<span class="op" id="5433132">=</span>&nbsp;<span class="ident" id="5433134">minFoldRune</span><span class="op" id="5433145">(</span><span class="ident" id="5433146">r</span><span class="op" id="5433147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433153">re</span><span class="op" id="5433155">.</span><span class="ident" id="5433156">Rune0</span><span class="op" id="5433161">[</span><span class="num" id="5433162">0</span><span class="op" id="5433163">]</span>&nbsp;<span class="op" id="5433165">=</span>&nbsp;<span class="ident" id="5433167">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433170">re</span><span class="op" id="5433172">.</span><span class="ident" id="5433173">Rune</span>&nbsp;<span class="op" id="5433178">=</span>&nbsp;<span class="ident" id="5433180">re</span><span class="op" id="5433182">.</span><span class="ident" id="5433183">Rune0</span><span class="op" id="5433188">[</span><span class="op" id="5433189">:</span><span class="num" id="5433190">1</span><span class="op" id="5433191">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433194">return</span>&nbsp;<span class="ident" id="5433201">re</span><br>
<span class="lineno">190</span><span class="op" id="5433204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433207">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5433269">func</span>&nbsp;<span class="ident" id="5433274">minFoldRune</span><span class="op" id="5433285">(</span><span class="ident" id="5433286">r</span>&nbsp;<span class="builtintype" id="5433288">rune</span><span class="op" id="5433292">)</span>&nbsp;<span class="builtintype" id="5433294">rune</span>&nbsp;<span class="op" id="5433299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433302">if</span>&nbsp;<span class="ident" id="5433305">r</span>&nbsp;<span class="op" id="5433307">&lt;</span>&nbsp;<span class="ident" id="5433309">minFold</span>&nbsp;<span class="op" id="5433317">||</span>&nbsp;<span class="ident" id="5433320">r</span>&nbsp;<span class="op" id="5433322">&gt;</span>&nbsp;<span class="ident" id="5433324">maxFold</span>&nbsp;<span class="op" id="5433332">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433336">return</span>&nbsp;<span class="ident" id="5433343">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433349">min</span>&nbsp;<span class="op" id="5433353">:=</span>&nbsp;<span class="ident" id="5433356">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433359">r0</span>&nbsp;<span class="op" id="5433362">:=</span>&nbsp;<span class="ident" id="5433365">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433368">for</span>&nbsp;<span class="ident" id="5433372">r</span>&nbsp;<span class="op" id="5433374">=</span>&nbsp;<span class="ident" id="5433376">unicode</span><span class="op" id="5433383">.</span><span class="ident" id="5433384">SimpleFold</span><span class="op" id="5433394">(</span><span class="ident" id="5433395">r</span><span class="op" id="5433396">)</span><span class="op" id="5433397">;</span>&nbsp;<span class="ident" id="5433399">r</span>&nbsp;<span class="op" id="5433401">!=</span>&nbsp;<span class="ident" id="5433404">r0</span><span class="op" id="5433406">;</span>&nbsp;<span class="ident" id="5433408">r</span>&nbsp;<span class="op" id="5433410">=</span>&nbsp;<span class="ident" id="5433412">unicode</span><span class="op" id="5433419">.</span><span class="ident" id="5433420">SimpleFold</span><span class="op" id="5433430">(</span><span class="ident" id="5433431">r</span><span class="op" id="5433432">)</span>&nbsp;<span class="op" id="5433434">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433438">if</span>&nbsp;<span class="ident" id="5433441">min</span>&nbsp;<span class="op" id="5433445">&gt;</span>&nbsp;<span class="ident" id="5433447">r</span>&nbsp;<span class="op" id="5433449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433454">min</span>&nbsp;<span class="op" id="5433458">=</span>&nbsp;<span class="ident" id="5433460">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433470">return</span>&nbsp;<span class="ident" id="5433477">min</span><br>
<span class="lineno">205</span><span class="op" id="5433481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433484">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5433547">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5433575">func</span>&nbsp;<span class="op" id="5433580">(</span><span class="ident" id="5433581">p</span>&nbsp;<span class="op" id="5433583">*</span><span class="ident" id="5433584">parser</span><span class="op" id="5433590">)</span>&nbsp;<span class="ident" id="5433592">literal</span><span class="op" id="5433599">(</span><span class="ident" id="5433600">r</span>&nbsp;<span class="builtintype" id="5433602">rune</span><span class="op" id="5433606">)</span>&nbsp;<span class="op" id="5433608">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433611">p</span><span class="op" id="5433612">.</span><span class="ident" id="5433613">push</span><span class="op" id="5433617">(</span><span class="ident" id="5433618">p</span><span class="op" id="5433619">.</span><span class="ident" id="5433620">newLiteral</span><span class="op" id="5433630">(</span><span class="ident" id="5433631">r</span><span class="op" id="5433632">,</span>&nbsp;<span class="ident" id="5433634">p</span><span class="op" id="5433635">.</span><span class="ident" id="5433636">flags</span><span class="op" id="5433641">)</span><span class="op" id="5433642">)</span><br>
<span class="lineno"></span><span class="op" id="5433644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5433647">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5433702">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5433730">func</span>&nbsp;<span class="op" id="5433735">(</span><span class="ident" id="5433736">p</span>&nbsp;<span class="op" id="5433738">*</span><span class="ident" id="5433739">parser</span><span class="op" id="5433745">)</span>&nbsp;<span class="ident" id="5433747">op</span><span class="op" id="5433749">(</span><span class="ident" id="5433750">op</span>&nbsp;<span class="ident" id="5433753">Op</span><span class="op" id="5433755">)</span>&nbsp;<span class="op" id="5433757">*</span><span class="ident" id="5433758">Regexp</span>&nbsp;<span class="op" id="5433765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433768">re</span>&nbsp;<span class="op" id="5433771">:=</span>&nbsp;<span class="ident" id="5433774">p</span><span class="op" id="5433775">.</span><span class="ident" id="5433776">newRegexp</span><span class="op" id="5433785">(</span><span class="ident" id="5433786">op</span><span class="op" id="5433788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433791">re</span><span class="op" id="5433793">.</span><span class="ident" id="5433794">Flags</span>&nbsp;<span class="op" id="5433800">=</span>&nbsp;<span class="ident" id="5433802">p</span><span class="op" id="5433803">.</span><span class="ident" id="5433804">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5433811">return</span>&nbsp;<span class="ident" id="5433818">p</span><span class="op" id="5433819">.</span><span class="ident" id="5433820">push</span><span class="op" id="5433824">(</span><span class="ident" id="5433825">re</span><span class="op" id="5433827">)</span><br>
<span class="lineno"></span><span class="op" id="5433829">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5433832">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5433921">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5433989">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5434060">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5434119">func</span>&nbsp;<span class="op" id="5434124">(</span><span class="ident" id="5434125">p</span>&nbsp;<span class="op" id="5434127">*</span><span class="ident" id="5434128">parser</span><span class="op" id="5434134">)</span>&nbsp;<span class="ident" id="5434136">repeat</span><span class="op" id="5434142">(</span><span class="ident" id="5434143">op</span>&nbsp;<span class="ident" id="5434146">Op</span><span class="op" id="5434148">,</span>&nbsp;<span class="ident" id="5434150">min</span><span class="op" id="5434153">,</span>&nbsp;<span class="ident" id="5434155">max</span>&nbsp;<span class="builtintype" id="5434159">int</span><span class="op" id="5434162">,</span>&nbsp;<span class="ident" id="5434164">before</span><span class="op" id="5434170">,</span>&nbsp;<span class="ident" id="5434172">after</span><span class="op" id="5434177">,</span>&nbsp;<span class="ident" id="5434179">lastRepeat</span>&nbsp;<span class="builtintype" id="5434190">string</span><span class="op" id="5434196">)</span>&nbsp;<span class="op" id="5434198">(</span><span class="builtintype" id="5434199">string</span><span class="op" id="5434205">,</span>&nbsp;<span class="builtintype" id="5434207">error</span><span class="op" id="5434212">)</span>&nbsp;<span class="op" id="5434214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434217">flags</span>&nbsp;<span class="op" id="5434223">:=</span>&nbsp;<span class="ident" id="5434226">p</span><span class="op" id="5434227">.</span><span class="ident" id="5434228">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434235">if</span>&nbsp;<span class="ident" id="5434238">p</span><span class="op" id="5434239">.</span><span class="ident" id="5434240">flags</span><span class="op" id="5434245">&amp;</span><span class="ident" id="5434246">PerlX</span>&nbsp;<span class="op" id="5434252">!=</span>&nbsp;<span class="num" id="5434255">0</span>&nbsp;<span class="op" id="5434257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434261">if</span>&nbsp;<span class="builtinfunc" id="5434264">len</span><span class="op" id="5434267">(</span><span class="ident" id="5434268">after</span><span class="op" id="5434273">)</span>&nbsp;<span class="op" id="5434275">&gt;</span>&nbsp;<span class="num" id="5434277">0</span>&nbsp;<span class="op" id="5434279">&amp;&amp;</span>&nbsp;<span class="ident" id="5434282">after</span><span class="op" id="5434287">[</span><span class="num" id="5434288">0</span><span class="op" id="5434289">]</span>&nbsp;<span class="op" id="5434291">==</span>&nbsp;<span class="string" id="5434294">&#39;?&#39;</span>&nbsp;<span class="op" id="5434298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434303">after</span>&nbsp;<span class="op" id="5434309">=</span>&nbsp;<span class="ident" id="5434311">after</span><span class="op" id="5434316">[</span><span class="num" id="5434317">1</span><span class="op" id="5434318">:</span><span class="op" id="5434319">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434324">flags</span>&nbsp;<span class="op" id="5434330">^=</span>&nbsp;<span class="ident" id="5434333">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434349">if</span>&nbsp;<span class="ident" id="5434352">lastRepeat</span>&nbsp;<span class="op" id="5434363">!=</span>&nbsp;<span class="string" id="5434366">&#34;&#34;</span>&nbsp;<span class="op" id="5434369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434374">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434437">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434500">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434555">return</span>&nbsp;<span class="string" id="5434562">&#34;&#34;</span><span class="op" id="5434564">,</span>&nbsp;<span class="op" id="5434566">&amp;</span><span class="ident" id="5434567">Error</span><span class="op" id="5434572">{</span><span class="ident" id="5434573">ErrInvalidRepeatOp</span><span class="op" id="5434591">,</span>&nbsp;<span class="ident" id="5434593">lastRepeat</span><span class="op" id="5434603">[</span><span class="op" id="5434604">:</span><span class="builtinfunc" id="5434605">len</span><span class="op" id="5434608">(</span><span class="ident" id="5434609">lastRepeat</span><span class="op" id="5434619">)</span><span class="op" id="5434620">-</span><span class="builtinfunc" id="5434621">len</span><span class="op" id="5434624">(</span><span class="ident" id="5434625">after</span><span class="op" id="5434630">)</span><span class="op" id="5434631">]</span><span class="op" id="5434632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434642">n</span>&nbsp;<span class="op" id="5434644">:=</span>&nbsp;<span class="builtinfunc" id="5434647">len</span><span class="op" id="5434650">(</span><span class="ident" id="5434651">p</span><span class="op" id="5434652">.</span><span class="ident" id="5434653">stack</span><span class="op" id="5434658">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434661">if</span>&nbsp;<span class="ident" id="5434664">n</span>&nbsp;<span class="op" id="5434666">==</span>&nbsp;<span class="num" id="5434669">0</span>&nbsp;<span class="op" id="5434671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434675">return</span>&nbsp;<span class="string" id="5434682">&#34;&#34;</span><span class="op" id="5434684">,</span>&nbsp;<span class="op" id="5434686">&amp;</span><span class="ident" id="5434687">Error</span><span class="op" id="5434692">{</span><span class="ident" id="5434693">ErrMissingRepeatArgument</span><span class="op" id="5434717">,</span>&nbsp;<span class="ident" id="5434719">before</span><span class="op" id="5434725">[</span><span class="op" id="5434726">:</span><span class="builtinfunc" id="5434727">len</span><span class="op" id="5434730">(</span><span class="ident" id="5434731">before</span><span class="op" id="5434737">)</span><span class="op" id="5434738">-</span><span class="builtinfunc" id="5434739">len</span><span class="op" id="5434742">(</span><span class="ident" id="5434743">after</span><span class="op" id="5434748">)</span><span class="op" id="5434749">]</span><span class="op" id="5434750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434756">sub</span>&nbsp;<span class="op" id="5434760">:=</span>&nbsp;<span class="ident" id="5434763">p</span><span class="op" id="5434764">.</span><span class="ident" id="5434765">stack</span><span class="op" id="5434770">[</span><span class="ident" id="5434771">n</span><span class="op" id="5434772">-</span><span class="num" id="5434773">1</span><span class="op" id="5434774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434777">if</span>&nbsp;<span class="ident" id="5434780">sub</span><span class="op" id="5434783">.</span><span class="ident" id="5434784">Op</span>&nbsp;<span class="op" id="5434787">&gt;=</span>&nbsp;<span class="ident" id="5434790">opPseudo</span>&nbsp;<span class="op" id="5434799">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5434803">return</span>&nbsp;<span class="string" id="5434810">&#34;&#34;</span><span class="op" id="5434812">,</span>&nbsp;<span class="op" id="5434814">&amp;</span><span class="ident" id="5434815">Error</span><span class="op" id="5434820">{</span><span class="ident" id="5434821">ErrMissingRepeatArgument</span><span class="op" id="5434845">,</span>&nbsp;<span class="ident" id="5434847">before</span><span class="op" id="5434853">[</span><span class="op" id="5434854">:</span><span class="builtinfunc" id="5434855">len</span><span class="op" id="5434858">(</span><span class="ident" id="5434859">before</span><span class="op" id="5434865">)</span><span class="op" id="5434866">-</span><span class="builtinfunc" id="5434867">len</span><span class="op" id="5434870">(</span><span class="ident" id="5434871">after</span><span class="op" id="5434876">)</span><span class="op" id="5434877">]</span><span class="op" id="5434878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434885">re</span>&nbsp;<span class="op" id="5434888">:=</span>&nbsp;<span class="ident" id="5434891">p</span><span class="op" id="5434892">.</span><span class="ident" id="5434893">newRegexp</span><span class="op" id="5434902">(</span><span class="ident" id="5434903">op</span><span class="op" id="5434905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434908">re</span><span class="op" id="5434910">.</span><span class="ident" id="5434911">Min</span>&nbsp;<span class="op" id="5434915">=</span>&nbsp;<span class="ident" id="5434917">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434922">re</span><span class="op" id="5434924">.</span><span class="ident" id="5434925">Max</span>&nbsp;<span class="op" id="5434929">=</span>&nbsp;<span class="ident" id="5434931">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434936">re</span><span class="op" id="5434938">.</span><span class="ident" id="5434939">Flags</span>&nbsp;<span class="op" id="5434945">=</span>&nbsp;<span class="ident" id="5434947">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434954">re</span><span class="op" id="5434956">.</span><span class="ident" id="5434957">Sub</span>&nbsp;<span class="op" id="5434961">=</span>&nbsp;<span class="ident" id="5434963">re</span><span class="op" id="5434965">.</span><span class="ident" id="5434966">Sub0</span><span class="op" id="5434970">[</span><span class="op" id="5434971">:</span><span class="num" id="5434972">1</span><span class="op" id="5434973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434976">re</span><span class="op" id="5434978">.</span><span class="ident" id="5434979">Sub</span><span class="op" id="5434982">[</span><span class="num" id="5434983">0</span><span class="op" id="5434984">]</span>&nbsp;<span class="op" id="5434986">=</span>&nbsp;<span class="ident" id="5434988">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434993">p</span><span class="op" id="5434994">.</span><span class="ident" id="5434995">stack</span><span class="op" id="5435000">[</span><span class="ident" id="5435001">n</span><span class="op" id="5435002">-</span><span class="num" id="5435003">1</span><span class="op" id="5435004">]</span>&nbsp;<span class="op" id="5435006">=</span>&nbsp;<span class="ident" id="5435008">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435013">if</span>&nbsp;<span class="ident" id="5435016">op</span>&nbsp;<span class="op" id="5435019">==</span>&nbsp;<span class="ident" id="5435022">OpRepeat</span>&nbsp;<span class="op" id="5435031">&amp;&amp;</span>&nbsp;<span class="op" id="5435034">(</span><span class="ident" id="5435035">min</span>&nbsp;<span class="op" id="5435039">&gt;=</span>&nbsp;<span class="num" id="5435042">2</span>&nbsp;<span class="op" id="5435044">||</span>&nbsp;<span class="ident" id="5435047">max</span>&nbsp;<span class="op" id="5435051">&gt;=</span>&nbsp;<span class="num" id="5435054">2</span><span class="op" id="5435055">)</span>&nbsp;<span class="op" id="5435057">&amp;&amp;</span>&nbsp;<span class="op" id="5435060">!</span><span class="ident" id="5435061">repeatIsValid</span><span class="op" id="5435074">(</span><span class="ident" id="5435075">re</span><span class="op" id="5435077">,</span>&nbsp;<span class="num" id="5435079">1000</span><span class="op" id="5435083">)</span>&nbsp;<span class="op" id="5435085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435089">return</span>&nbsp;<span class="string" id="5435096">&#34;&#34;</span><span class="op" id="5435098">,</span>&nbsp;<span class="op" id="5435100">&amp;</span><span class="ident" id="5435101">Error</span><span class="op" id="5435106">{</span><span class="ident" id="5435107">ErrInvalidRepeatSize</span><span class="op" id="5435127">,</span>&nbsp;<span class="ident" id="5435129">before</span><span class="op" id="5435135">[</span><span class="op" id="5435136">:</span><span class="builtinfunc" id="5435137">len</span><span class="op" id="5435140">(</span><span class="ident" id="5435141">before</span><span class="op" id="5435147">)</span><span class="op" id="5435148">-</span><span class="builtinfunc" id="5435149">len</span><span class="op" id="5435152">(</span><span class="ident" id="5435153">after</span><span class="op" id="5435158">)</span><span class="op" id="5435159">]</span><span class="op" id="5435160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435167">return</span>&nbsp;<span class="ident" id="5435174">after</span><span class="op" id="5435179">,</span>&nbsp;<span class="ident" id="5435181">nil</span><br>
<span class="lineno"></span><span class="op" id="5435185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5435188">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5435249">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5435313">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5435374">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5435394">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5435471">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5435543">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5435612">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5435684">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5435759">func</span>&nbsp;<span class="ident" id="5435764">repeatIsValid</span><span class="op" id="5435777">(</span><span class="ident" id="5435778">re</span>&nbsp;<span class="op" id="5435781">*</span><span class="ident" id="5435782">Regexp</span><span class="op" id="5435788">,</span>&nbsp;<span class="ident" id="5435790">n</span>&nbsp;<span class="builtintype" id="5435792">int</span><span class="op" id="5435795">)</span>&nbsp;<span class="builtintype" id="5435797">bool</span>&nbsp;<span class="op" id="5435802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435805">if</span>&nbsp;<span class="ident" id="5435808">re</span><span class="op" id="5435810">.</span><span class="ident" id="5435811">Op</span>&nbsp;<span class="op" id="5435814">==</span>&nbsp;<span class="ident" id="5435817">OpRepeat</span>&nbsp;<span class="op" id="5435826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435830">m</span>&nbsp;<span class="op" id="5435832">:=</span>&nbsp;<span class="ident" id="5435835">re</span><span class="op" id="5435837">.</span><span class="ident" id="5435838">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435844">if</span>&nbsp;<span class="ident" id="5435847">m</span>&nbsp;<span class="op" id="5435849">==</span>&nbsp;<span class="num" id="5435852">0</span>&nbsp;<span class="op" id="5435854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435859">return</span>&nbsp;<span class="builtintype" id="5435866">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435877">if</span>&nbsp;<span class="ident" id="5435880">m</span>&nbsp;<span class="op" id="5435882">&lt;</span>&nbsp;<span class="num" id="5435884">0</span>&nbsp;<span class="op" id="5435886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435891">m</span>&nbsp;<span class="op" id="5435893">=</span>&nbsp;<span class="ident" id="5435895">re</span><span class="op" id="5435897">.</span><span class="ident" id="5435898">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435908">if</span>&nbsp;<span class="ident" id="5435911">m</span>&nbsp;<span class="op" id="5435913">&gt;</span>&nbsp;<span class="ident" id="5435915">n</span>&nbsp;<span class="op" id="5435917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435922">return</span>&nbsp;<span class="builtintype" id="5435929">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435941">if</span>&nbsp;<span class="ident" id="5435944">m</span>&nbsp;<span class="op" id="5435946">&gt;</span>&nbsp;<span class="num" id="5435948">0</span>&nbsp;<span class="op" id="5435950">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435955">n</span>&nbsp;<span class="op" id="5435957">/=</span>&nbsp;<span class="ident" id="5435960">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435970">for</span>&nbsp;<span class="ident" id="5435974">_</span><span class="op" id="5435975">,</span>&nbsp;<span class="ident" id="5435977">sub</span>&nbsp;<span class="op" id="5435981">:=</span>&nbsp;<span class="keyword" id="5435984">range</span>&nbsp;<span class="ident" id="5435990">re</span><span class="op" id="5435992">.</span><span class="ident" id="5435993">Sub</span>&nbsp;<span class="op" id="5435997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436001">if</span>&nbsp;<span class="op" id="5436004">!</span><span class="ident" id="5436005">repeatIsValid</span><span class="op" id="5436018">(</span><span class="ident" id="5436019">sub</span><span class="op" id="5436022">,</span>&nbsp;<span class="ident" id="5436024">n</span><span class="op" id="5436025">)</span>&nbsp;<span class="op" id="5436027">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436032">return</span>&nbsp;<span class="builtintype" id="5436039">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436053">return</span>&nbsp;<span class="builtintype" id="5436060">true</span><br>
<span class="lineno"></span><span class="op" id="5436065">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5436068">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5436163">func</span>&nbsp;<span class="op" id="5436168">(</span><span class="ident" id="5436169">p</span>&nbsp;<span class="op" id="5436171">*</span><span class="ident" id="5436172">parser</span><span class="op" id="5436178">)</span>&nbsp;<span class="ident" id="5436180">concat</span><span class="op" id="5436186">(</span><span class="op" id="5436187">)</span>&nbsp;<span class="op" id="5436189">*</span><span class="ident" id="5436190">Regexp</span>&nbsp;<span class="op" id="5436197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436200">p</span><span class="op" id="5436201">.</span><span class="ident" id="5436202">maybeConcat</span><span class="op" id="5436213">(</span><span class="op" id="5436214">-</span><span class="num" id="5436215">1</span><span class="op" id="5436216">,</span>&nbsp;<span class="num" id="5436218">0</span><span class="op" id="5436219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436223">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436269">i</span>&nbsp;<span class="op" id="5436271">:=</span>&nbsp;<span class="builtinfunc" id="5436274">len</span><span class="op" id="5436277">(</span><span class="ident" id="5436278">p</span><span class="op" id="5436279">.</span><span class="ident" id="5436280">stack</span><span class="op" id="5436285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436288">for</span>&nbsp;<span class="ident" id="5436292">i</span>&nbsp;<span class="op" id="5436294">&gt;</span>&nbsp;<span class="num" id="5436296">0</span>&nbsp;<span class="op" id="5436298">&amp;&amp;</span>&nbsp;<span class="ident" id="5436301">p</span><span class="op" id="5436302">.</span><span class="ident" id="5436303">stack</span><span class="op" id="5436308">[</span><span class="ident" id="5436309">i</span><span class="op" id="5436310">-</span><span class="num" id="5436311">1</span><span class="op" id="5436312">]</span><span class="op" id="5436313">.</span><span class="ident" id="5436314">Op</span>&nbsp;<span class="op" id="5436317">&lt;</span>&nbsp;<span class="ident" id="5436319">opPseudo</span>&nbsp;<span class="op" id="5436328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436332">i</span><span class="op" id="5436333">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436337">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436340">subs</span>&nbsp;<span class="op" id="5436345">:=</span>&nbsp;<span class="ident" id="5436348">p</span><span class="op" id="5436349">.</span><span class="ident" id="5436350">stack</span><span class="op" id="5436355">[</span><span class="ident" id="5436356">i</span><span class="op" id="5436357">:</span><span class="op" id="5436358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436361">p</span><span class="op" id="5436362">.</span><span class="ident" id="5436363">stack</span>&nbsp;<span class="op" id="5436369">=</span>&nbsp;<span class="ident" id="5436371">p</span><span class="op" id="5436372">.</span><span class="ident" id="5436373">stack</span><span class="op" id="5436378">[</span><span class="op" id="5436379">:</span><span class="ident" id="5436380">i</span><span class="op" id="5436381">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436385">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436426">if</span>&nbsp;<span class="builtinfunc" id="5436429">len</span><span class="op" id="5436432">(</span><span class="ident" id="5436433">subs</span><span class="op" id="5436437">)</span>&nbsp;<span class="op" id="5436439">==</span>&nbsp;<span class="num" id="5436442">0</span>&nbsp;<span class="op" id="5436444">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436448">return</span>&nbsp;<span class="ident" id="5436455">p</span><span class="op" id="5436456">.</span><span class="ident" id="5436457">push</span><span class="op" id="5436461">(</span><span class="ident" id="5436462">p</span><span class="op" id="5436463">.</span><span class="ident" id="5436464">newRegexp</span><span class="op" id="5436473">(</span><span class="ident" id="5436474">OpEmptyMatch</span><span class="op" id="5436486">)</span><span class="op" id="5436487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436494">return</span>&nbsp;<span class="ident" id="5436501">p</span><span class="op" id="5436502">.</span><span class="ident" id="5436503">push</span><span class="op" id="5436507">(</span><span class="ident" id="5436508">p</span><span class="op" id="5436509">.</span><span class="ident" id="5436510">collapse</span><span class="op" id="5436518">(</span><span class="ident" id="5436519">subs</span><span class="op" id="5436523">,</span>&nbsp;<span class="ident" id="5436525">OpConcat</span><span class="op" id="5436533">)</span><span class="op" id="5436534">)</span><br>
<span class="lineno"></span><span class="op" id="5436536">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5436539">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5436628">func</span>&nbsp;<span class="op" id="5436633">(</span><span class="ident" id="5436634">p</span>&nbsp;<span class="op" id="5436636">*</span><span class="ident" id="5436637">parser</span><span class="op" id="5436643">)</span>&nbsp;<span class="ident" id="5436645">alternate</span><span class="op" id="5436654">(</span><span class="op" id="5436655">)</span>&nbsp;<span class="op" id="5436657">*</span><span class="ident" id="5436658">Regexp</span>&nbsp;<span class="op" id="5436665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436668">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436709">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436737">i</span>&nbsp;<span class="op" id="5436739">:=</span>&nbsp;<span class="builtinfunc" id="5436742">len</span><span class="op" id="5436745">(</span><span class="ident" id="5436746">p</span><span class="op" id="5436747">.</span><span class="ident" id="5436748">stack</span><span class="op" id="5436753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436756">for</span>&nbsp;<span class="ident" id="5436760">i</span>&nbsp;<span class="op" id="5436762">&gt;</span>&nbsp;<span class="num" id="5436764">0</span>&nbsp;<span class="op" id="5436766">&amp;&amp;</span>&nbsp;<span class="ident" id="5436769">p</span><span class="op" id="5436770">.</span><span class="ident" id="5436771">stack</span><span class="op" id="5436776">[</span><span class="ident" id="5436777">i</span><span class="op" id="5436778">-</span><span class="num" id="5436779">1</span><span class="op" id="5436780">]</span><span class="op" id="5436781">.</span><span class="ident" id="5436782">Op</span>&nbsp;<span class="op" id="5436785">&lt;</span>&nbsp;<span class="ident" id="5436787">opPseudo</span>&nbsp;<span class="op" id="5436796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436800">i</span><span class="op" id="5436801">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436808">subs</span>&nbsp;<span class="op" id="5436813">:=</span>&nbsp;<span class="ident" id="5436816">p</span><span class="op" id="5436817">.</span><span class="ident" id="5436818">stack</span><span class="op" id="5436823">[</span><span class="ident" id="5436824">i</span><span class="op" id="5436825">:</span><span class="op" id="5436826">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436829">p</span><span class="op" id="5436830">.</span><span class="ident" id="5436831">stack</span>&nbsp;<span class="op" id="5436837">=</span>&nbsp;<span class="ident" id="5436839">p</span><span class="op" id="5436840">.</span><span class="ident" id="5436841">stack</span><span class="op" id="5436846">[</span><span class="op" id="5436847">:</span><span class="ident" id="5436848">i</span><span class="op" id="5436849">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436853">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436887">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436941">if</span>&nbsp;<span class="builtinfunc" id="5436944">len</span><span class="op" id="5436947">(</span><span class="ident" id="5436948">subs</span><span class="op" id="5436952">)</span>&nbsp;<span class="op" id="5436954">&gt;</span>&nbsp;<span class="num" id="5436956">0</span>&nbsp;<span class="op" id="5436958">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436962">cleanAlt</span><span class="op" id="5436970">(</span><span class="ident" id="5436971">subs</span><span class="op" id="5436975">[</span><span class="builtinfunc" id="5436976">len</span><span class="op" id="5436979">(</span><span class="ident" id="5436980">subs</span><span class="op" id="5436984">)</span><span class="op" id="5436985">-</span><span class="num" id="5436986">1</span><span class="op" id="5436987">]</span><span class="op" id="5436988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436995">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5437031">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437074">if</span>&nbsp;<span class="builtinfunc" id="5437077">len</span><span class="op" id="5437080">(</span><span class="ident" id="5437081">subs</span><span class="op" id="5437085">)</span>&nbsp;<span class="op" id="5437087">==</span>&nbsp;<span class="num" id="5437090">0</span>&nbsp;<span class="op" id="5437092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437096">return</span>&nbsp;<span class="ident" id="5437103">p</span><span class="op" id="5437104">.</span><span class="ident" id="5437105">push</span><span class="op" id="5437109">(</span><span class="ident" id="5437110">p</span><span class="op" id="5437111">.</span><span class="ident" id="5437112">newRegexp</span><span class="op" id="5437121">(</span><span class="ident" id="5437122">OpNoMatch</span><span class="op" id="5437131">)</span><span class="op" id="5437132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437139">return</span>&nbsp;<span class="ident" id="5437146">p</span><span class="op" id="5437147">.</span><span class="ident" id="5437148">push</span><span class="op" id="5437152">(</span><span class="ident" id="5437153">p</span><span class="op" id="5437154">.</span><span class="ident" id="5437155">collapse</span><span class="op" id="5437163">(</span><span class="ident" id="5437164">subs</span><span class="op" id="5437168">,</span>&nbsp;<span class="ident" id="5437170">OpAlternate</span><span class="op" id="5437181">)</span><span class="op" id="5437182">)</span><br>
<span class="lineno">340</span><span class="op" id="5437184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437187">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5437251">func</span>&nbsp;<span class="ident" id="5437256">cleanAlt</span><span class="op" id="5437264">(</span><span class="ident" id="5437265">re</span>&nbsp;<span class="op" id="5437268">*</span><span class="ident" id="5437269">Regexp</span><span class="op" id="5437275">)</span>&nbsp;<span class="op" id="5437277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437280">switch</span>&nbsp;<span class="ident" id="5437287">re</span><span class="op" id="5437289">.</span><span class="ident" id="5437290">Op</span>&nbsp;<span class="op" id="5437293">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437296">case</span>&nbsp;<span class="ident" id="5437301">OpCharClass</span><span class="op" id="5437312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437316">re</span><span class="op" id="5437318">.</span><span class="ident" id="5437319">Rune</span>&nbsp;<span class="op" id="5437324">=</span>&nbsp;<span class="ident" id="5437326">cleanClass</span><span class="op" id="5437336">(</span><span class="op" id="5437337">&amp;</span><span class="ident" id="5437338">re</span><span class="op" id="5437340">.</span><span class="ident" id="5437341">Rune</span><span class="op" id="5437345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437349">if</span>&nbsp;<span class="builtinfunc" id="5437352">len</span><span class="op" id="5437355">(</span><span class="ident" id="5437356">re</span><span class="op" id="5437358">.</span><span class="ident" id="5437359">Rune</span><span class="op" id="5437363">)</span>&nbsp;<span class="op" id="5437365">==</span>&nbsp;<span class="num" id="5437368">2</span>&nbsp;<span class="op" id="5437370">&amp;&amp;</span>&nbsp;<span class="ident" id="5437373">re</span><span class="op" id="5437375">.</span><span class="ident" id="5437376">Rune</span><span class="op" id="5437380">[</span><span class="num" id="5437381">0</span><span class="op" id="5437382">]</span>&nbsp;<span class="op" id="5437384">==</span>&nbsp;<span class="num" id="5437387">0</span>&nbsp;<span class="op" id="5437389">&amp;&amp;</span>&nbsp;<span class="ident" id="5437392">re</span><span class="op" id="5437394">.</span><span class="ident" id="5437395">Rune</span><span class="op" id="5437399">[</span><span class="num" id="5437400">1</span><span class="op" id="5437401">]</span>&nbsp;<span class="op" id="5437403">==</span>&nbsp;<span class="ident" id="5437406">unicode</span><span class="op" id="5437413">.</span><span class="ident" id="5437414">MaxRune</span>&nbsp;<span class="op" id="5437422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437427">re</span><span class="op" id="5437429">.</span><span class="ident" id="5437430">Rune</span>&nbsp;<span class="op" id="5437435">=</span>&nbsp;<span class="ident" id="5437437">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437444">re</span><span class="op" id="5437446">.</span><span class="ident" id="5437447">Op</span>&nbsp;<span class="op" id="5437450">=</span>&nbsp;<span class="ident" id="5437452">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437478">if</span>&nbsp;<span class="builtinfunc" id="5437481">len</span><span class="op" id="5437484">(</span><span class="ident" id="5437485">re</span><span class="op" id="5437487">.</span><span class="ident" id="5437488">Rune</span><span class="op" id="5437492">)</span>&nbsp;<span class="op" id="5437494">==</span>&nbsp;<span class="num" id="5437497">4</span>&nbsp;<span class="op" id="5437499">&amp;&amp;</span>&nbsp;<span class="ident" id="5437502">re</span><span class="op" id="5437504">.</span><span class="ident" id="5437505">Rune</span><span class="op" id="5437509">[</span><span class="num" id="5437510">0</span><span class="op" id="5437511">]</span>&nbsp;<span class="op" id="5437513">==</span>&nbsp;<span class="num" id="5437516">0</span>&nbsp;<span class="op" id="5437518">&amp;&amp;</span>&nbsp;<span class="ident" id="5437521">re</span><span class="op" id="5437523">.</span><span class="ident" id="5437524">Rune</span><span class="op" id="5437528">[</span><span class="num" id="5437529">1</span><span class="op" id="5437530">]</span>&nbsp;<span class="op" id="5437532">==</span>&nbsp;<span class="string" id="5437535">&#39;\n&#39;</span><span class="op" id="5437539">-</span><span class="num" id="5437540">1</span>&nbsp;<span class="op" id="5437542">&amp;&amp;</span>&nbsp;<span class="ident" id="5437545">re</span><span class="op" id="5437547">.</span><span class="ident" id="5437548">Rune</span><span class="op" id="5437552">[</span><span class="num" id="5437553">2</span><span class="op" id="5437554">]</span>&nbsp;<span class="op" id="5437556">==</span>&nbsp;<span class="string" id="5437559">&#39;\n&#39;</span><span class="op" id="5437563">+</span><span class="num" id="5437564">1</span>&nbsp;<span class="op" id="5437566">&amp;&amp;</span>&nbsp;<span class="ident" id="5437569">re</span><span class="op" id="5437571">.</span><span class="ident" id="5437572">Rune</span><span class="op" id="5437576">[</span><span class="num" id="5437577">3</span><span class="op" id="5437578">]</span>&nbsp;<span class="op" id="5437580">==</span>&nbsp;<span class="ident" id="5437583">unicode</span><span class="op" id="5437590">.</span><span class="ident" id="5437591">MaxRune</span>&nbsp;<span class="op" id="5437599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437604">re</span><span class="op" id="5437606">.</span><span class="ident" id="5437607">Rune</span>&nbsp;<span class="op" id="5437612">=</span>&nbsp;<span class="ident" id="5437614">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437621">re</span><span class="op" id="5437623">.</span><span class="ident" id="5437624">Op</span>&nbsp;<span class="op" id="5437627">=</span>&nbsp;<span class="ident" id="5437629">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437647">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437660">if</span>&nbsp;<span class="builtinfunc" id="5437663">cap</span><span class="op" id="5437666">(</span><span class="ident" id="5437667">re</span><span class="op" id="5437669">.</span><span class="ident" id="5437670">Rune</span><span class="op" id="5437674">)</span><span class="op" id="5437675">-</span><span class="builtinfunc" id="5437676">len</span><span class="op" id="5437679">(</span><span class="ident" id="5437680">re</span><span class="op" id="5437682">.</span><span class="ident" id="5437683">Rune</span><span class="op" id="5437687">)</span>&nbsp;<span class="op" id="5437689">&gt;</span>&nbsp;<span class="num" id="5437691">100</span>&nbsp;<span class="op" id="5437695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5437700">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5437738">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437786">re</span><span class="op" id="5437788">.</span><span class="ident" id="5437789">Rune</span>&nbsp;<span class="op" id="5437794">=</span>&nbsp;<span class="builtinfunc" id="5437796">append</span><span class="op" id="5437802">(</span><span class="ident" id="5437803">re</span><span class="op" id="5437805">.</span><span class="ident" id="5437806">Rune0</span><span class="op" id="5437811">[</span><span class="op" id="5437812">:</span><span class="num" id="5437813">0</span><span class="op" id="5437814">]</span><span class="op" id="5437815">,</span>&nbsp;<span class="ident" id="5437817">re</span><span class="op" id="5437819">.</span><span class="ident" id="5437820">Rune</span><span class="op" id="5437824">...</span><span class="op" id="5437827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437834">}</span><br>
<span class="lineno"></span><span class="op" id="5437836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5437839">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5437893">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5437946">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5437999">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5438029">func</span>&nbsp;<span class="op" id="5438034">(</span><span class="ident" id="5438035">p</span>&nbsp;<span class="op" id="5438037">*</span><span class="ident" id="5438038">parser</span><span class="op" id="5438044">)</span>&nbsp;<span class="ident" id="5438046">collapse</span><span class="op" id="5438054">(</span><span class="ident" id="5438055">subs</span>&nbsp;<span class="op" id="5438060">[</span><span class="op" id="5438061">]</span><span class="op" id="5438062">*</span><span class="ident" id="5438063">Regexp</span><span class="op" id="5438069">,</span>&nbsp;<span class="ident" id="5438071">op</span>&nbsp;<span class="ident" id="5438074">Op</span><span class="op" id="5438076">)</span>&nbsp;<span class="op" id="5438078">*</span><span class="ident" id="5438079">Regexp</span>&nbsp;<span class="op" id="5438086">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438089">if</span>&nbsp;<span class="builtinfunc" id="5438092">len</span><span class="op" id="5438095">(</span><span class="ident" id="5438096">subs</span><span class="op" id="5438100">)</span>&nbsp;<span class="op" id="5438102">==</span>&nbsp;<span class="num" id="5438105">1</span>&nbsp;<span class="op" id="5438107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438111">return</span>&nbsp;<span class="ident" id="5438118">subs</span><span class="op" id="5438122">[</span><span class="num" id="5438123">0</span><span class="op" id="5438124">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438130">re</span>&nbsp;<span class="op" id="5438133">:=</span>&nbsp;<span class="ident" id="5438136">p</span><span class="op" id="5438137">.</span><span class="ident" id="5438138">newRegexp</span><span class="op" id="5438147">(</span><span class="ident" id="5438148">op</span><span class="op" id="5438150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438153">re</span><span class="op" id="5438155">.</span><span class="ident" id="5438156">Sub</span>&nbsp;<span class="op" id="5438160">=</span>&nbsp;<span class="ident" id="5438162">re</span><span class="op" id="5438164">.</span><span class="ident" id="5438165">Sub0</span><span class="op" id="5438169">[</span><span class="op" id="5438170">:</span><span class="num" id="5438171">0</span><span class="op" id="5438172">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438175">for</span>&nbsp;<span class="ident" id="5438179">_</span><span class="op" id="5438180">,</span>&nbsp;<span class="ident" id="5438182">sub</span>&nbsp;<span class="op" id="5438186">:=</span>&nbsp;<span class="keyword" id="5438189">range</span>&nbsp;<span class="ident" id="5438195">subs</span>&nbsp;<span class="op" id="5438200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438204">if</span>&nbsp;<span class="ident" id="5438207">sub</span><span class="op" id="5438210">.</span><span class="ident" id="5438211">Op</span>&nbsp;<span class="op" id="5438214">==</span>&nbsp;<span class="ident" id="5438217">op</span>&nbsp;<span class="op" id="5438220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438225">re</span><span class="op" id="5438227">.</span><span class="ident" id="5438228">Sub</span>&nbsp;<span class="op" id="5438232">=</span>&nbsp;<span class="builtinfunc" id="5438234">append</span><span class="op" id="5438240">(</span><span class="ident" id="5438241">re</span><span class="op" id="5438243">.</span><span class="ident" id="5438244">Sub</span><span class="op" id="5438247">,</span>&nbsp;<span class="ident" id="5438249">sub</span><span class="op" id="5438252">.</span><span class="ident" id="5438253">Sub</span><span class="op" id="5438256">...</span><span class="op" id="5438259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438264">p</span><span class="op" id="5438265">.</span><span class="ident" id="5438266">reuse</span><span class="op" id="5438271">(</span><span class="ident" id="5438272">sub</span><span class="op" id="5438275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438279">}</span>&nbsp;<span class="keyword" id="5438281">else</span>&nbsp;<span class="op" id="5438286">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438291">re</span><span class="op" id="5438293">.</span><span class="ident" id="5438294">Sub</span>&nbsp;<span class="op" id="5438298">=</span>&nbsp;<span class="builtinfunc" id="5438300">append</span><span class="op" id="5438306">(</span><span class="ident" id="5438307">re</span><span class="op" id="5438309">.</span><span class="ident" id="5438310">Sub</span><span class="op" id="5438313">,</span>&nbsp;<span class="ident" id="5438315">sub</span><span class="op" id="5438318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438328">if</span>&nbsp;<span class="ident" id="5438331">op</span>&nbsp;<span class="op" id="5438334">==</span>&nbsp;<span class="ident" id="5438337">OpAlternate</span>&nbsp;<span class="op" id="5438349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438353">re</span><span class="op" id="5438355">.</span><span class="ident" id="5438356">Sub</span>&nbsp;<span class="op" id="5438360">=</span>&nbsp;<span class="ident" id="5438362">p</span><span class="op" id="5438363">.</span><span class="ident" id="5438364">factor</span><span class="op" id="5438370">(</span><span class="ident" id="5438371">re</span><span class="op" id="5438373">.</span><span class="ident" id="5438374">Sub</span><span class="op" id="5438377">,</span>&nbsp;<span class="ident" id="5438379">re</span><span class="op" id="5438381">.</span><span class="ident" id="5438382">Flags</span><span class="op" id="5438387">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438391">if</span>&nbsp;<span class="builtinfunc" id="5438394">len</span><span class="op" id="5438397">(</span><span class="ident" id="5438398">re</span><span class="op" id="5438400">.</span><span class="ident" id="5438401">Sub</span><span class="op" id="5438404">)</span>&nbsp;<span class="op" id="5438406">==</span>&nbsp;<span class="num" id="5438409">1</span>&nbsp;<span class="op" id="5438411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438416">old</span>&nbsp;<span class="op" id="5438420">:=</span>&nbsp;<span class="ident" id="5438423">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438429">re</span>&nbsp;<span class="op" id="5438432">=</span>&nbsp;<span class="ident" id="5438434">re</span><span class="op" id="5438436">.</span><span class="ident" id="5438437">Sub</span><span class="op" id="5438440">[</span><span class="num" id="5438441">0</span><span class="op" id="5438442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438447">p</span><span class="op" id="5438448">.</span><span class="ident" id="5438449">reuse</span><span class="op" id="5438454">(</span><span class="ident" id="5438455">old</span><span class="op" id="5438458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438462">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438468">return</span>&nbsp;<span class="ident" id="5438475">re</span><br>
<span class="lineno"></span><span class="op" id="5438478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5438481">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5438546">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5438612">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5438663">//</span><br>
<span class="lineno"></span><span class="comment" id="5438666">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5438682">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5438709">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5438755">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5438783">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5438838">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5438864">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5438867">func</span>&nbsp;<span class="op" id="5438872">(</span><span class="ident" id="5438873">p</span>&nbsp;<span class="op" id="5438875">*</span><span class="ident" id="5438876">parser</span><span class="op" id="5438882">)</span>&nbsp;<span class="ident" id="5438884">factor</span><span class="op" id="5438890">(</span><span class="ident" id="5438891">sub</span>&nbsp;<span class="op" id="5438895">[</span><span class="op" id="5438896">]</span><span class="op" id="5438897">*</span><span class="ident" id="5438898">Regexp</span><span class="op" id="5438904">,</span>&nbsp;<span class="ident" id="5438906">flags</span>&nbsp;<span class="ident" id="5438912">Flags</span><span class="op" id="5438917">)</span>&nbsp;<span class="op" id="5438919">[</span><span class="op" id="5438920">]</span><span class="op" id="5438921">*</span><span class="ident" id="5438922">Regexp</span>&nbsp;<span class="op" id="5438929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438932">if</span>&nbsp;<span class="builtinfunc" id="5438935">len</span><span class="op" id="5438938">(</span><span class="ident" id="5438939">sub</span><span class="op" id="5438942">)</span>&nbsp;<span class="op" id="5438944">&lt;</span>&nbsp;<span class="num" id="5438946">2</span>&nbsp;<span class="op" id="5438948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438952">return</span>&nbsp;<span class="ident" id="5438959">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5438968">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439017">var</span>&nbsp;<span class="ident" id="5439021">str</span>&nbsp;<span class="op" id="5439025">[</span><span class="op" id="5439026">]</span><span class="builtintype" id="5439027">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439033">var</span>&nbsp;<span class="ident" id="5439037">strflags</span>&nbsp;<span class="ident" id="5439046">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439053">start</span>&nbsp;<span class="op" id="5439059">:=</span>&nbsp;<span class="num" id="5439062">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439065">out</span>&nbsp;<span class="op" id="5439069">:=</span>&nbsp;<span class="ident" id="5439072">sub</span><span class="op" id="5439075">[</span><span class="op" id="5439076">:</span><span class="num" id="5439077">0</span><span class="op" id="5439078">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439081">for</span>&nbsp;<span class="ident" id="5439085">i</span>&nbsp;<span class="op" id="5439087">:=</span>&nbsp;<span class="num" id="5439090">0</span><span class="op" id="5439091">;</span>&nbsp;<span class="ident" id="5439093">i</span>&nbsp;<span class="op" id="5439095">&lt;=</span>&nbsp;<span class="builtinfunc" id="5439098">len</span><span class="op" id="5439101">(</span><span class="ident" id="5439102">sub</span><span class="op" id="5439105">)</span><span class="op" id="5439106">;</span>&nbsp;<span class="ident" id="5439108">i</span><span class="op" id="5439109">++</span>&nbsp;<span class="op" id="5439112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439116">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439180">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439247">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439281">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439286">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439350">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439389">var</span>&nbsp;<span class="ident" id="5439393">istr</span>&nbsp;<span class="op" id="5439398">[</span><span class="op" id="5439399">]</span><span class="builtintype" id="5439400">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439407">var</span>&nbsp;<span class="ident" id="5439411">iflags</span>&nbsp;<span class="ident" id="5439418">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439426">if</span>&nbsp;<span class="ident" id="5439429">i</span>&nbsp;<span class="op" id="5439431">&lt;</span>&nbsp;<span class="builtinfunc" id="5439433">len</span><span class="op" id="5439436">(</span><span class="ident" id="5439437">sub</span><span class="op" id="5439440">)</span>&nbsp;<span class="op" id="5439442">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439447">istr</span><span class="op" id="5439451">,</span>&nbsp;<span class="ident" id="5439453">iflags</span>&nbsp;<span class="op" id="5439460">=</span>&nbsp;<span class="ident" id="5439462">p</span><span class="op" id="5439463">.</span><span class="ident" id="5439464">leadingString</span><span class="op" id="5439477">(</span><span class="ident" id="5439478">sub</span><span class="op" id="5439481">[</span><span class="ident" id="5439482">i</span><span class="op" id="5439483">]</span><span class="op" id="5439484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439489">if</span>&nbsp;<span class="ident" id="5439492">iflags</span>&nbsp;<span class="op" id="5439499">==</span>&nbsp;<span class="ident" id="5439502">strflags</span>&nbsp;<span class="op" id="5439511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439517">same</span>&nbsp;<span class="op" id="5439522">:=</span>&nbsp;<span class="num" id="5439525">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439531">for</span>&nbsp;<span class="ident" id="5439535">same</span>&nbsp;<span class="op" id="5439540">&lt;</span>&nbsp;<span class="builtinfunc" id="5439542">len</span><span class="op" id="5439545">(</span><span class="ident" id="5439546">str</span><span class="op" id="5439549">)</span>&nbsp;<span class="op" id="5439551">&amp;&amp;</span>&nbsp;<span class="ident" id="5439554">same</span>&nbsp;<span class="op" id="5439559">&lt;</span>&nbsp;<span class="builtinfunc" id="5439561">len</span><span class="op" id="5439564">(</span><span class="ident" id="5439565">istr</span><span class="op" id="5439569">)</span>&nbsp;<span class="op" id="5439571">&amp;&amp;</span>&nbsp;<span class="ident" id="5439574">str</span><span class="op" id="5439577">[</span><span class="ident" id="5439578">same</span><span class="op" id="5439582">]</span>&nbsp;<span class="op" id="5439584">==</span>&nbsp;<span class="ident" id="5439587">istr</span><span class="op" id="5439591">[</span><span class="ident" id="5439592">same</span><span class="op" id="5439596">]</span>&nbsp;<span class="op" id="5439598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439605">same</span><span class="op" id="5439609">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439622">if</span>&nbsp;<span class="ident" id="5439625">same</span>&nbsp;<span class="op" id="5439630">&gt;</span>&nbsp;<span class="num" id="5439632">0</span>&nbsp;<span class="op" id="5439634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439641">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439693">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439720">str</span>&nbsp;<span class="op" id="5439724">=</span>&nbsp;<span class="ident" id="5439726">str</span><span class="op" id="5439729">[</span><span class="op" id="5439730">:</span><span class="ident" id="5439731">same</span><span class="op" id="5439735">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439742">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439769">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439829">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439890">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439928">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439933">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440002">if</span>&nbsp;<span class="ident" id="5440005">i</span>&nbsp;<span class="op" id="5440007">==</span>&nbsp;<span class="ident" id="5440010">start</span>&nbsp;<span class="op" id="5440016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440021">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440059">}</span>&nbsp;<span class="keyword" id="5440061">else</span>&nbsp;<span class="keyword" id="5440066">if</span>&nbsp;<span class="ident" id="5440069">i</span>&nbsp;<span class="op" id="5440071">==</span>&nbsp;<span class="ident" id="5440074">start</span><span class="op" id="5440079">+</span><span class="num" id="5440080">1</span>&nbsp;<span class="op" id="5440082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440087">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440127">out</span>&nbsp;<span class="op" id="5440131">=</span>&nbsp;<span class="builtinfunc" id="5440133">append</span><span class="op" id="5440139">(</span><span class="ident" id="5440140">out</span><span class="op" id="5440143">,</span>&nbsp;<span class="ident" id="5440145">sub</span><span class="op" id="5440148">[</span><span class="ident" id="5440149">start</span><span class="op" id="5440154">]</span><span class="op" id="5440155">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440159">}</span>&nbsp;<span class="keyword" id="5440161">else</span>&nbsp;<span class="op" id="5440166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440171">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440230">prefix</span>&nbsp;<span class="op" id="5440237">:=</span>&nbsp;<span class="ident" id="5440240">p</span><span class="op" id="5440241">.</span><span class="ident" id="5440242">newRegexp</span><span class="op" id="5440251">(</span><span class="ident" id="5440252">OpLiteral</span><span class="op" id="5440261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440266">prefix</span><span class="op" id="5440272">.</span><span class="ident" id="5440273">Flags</span>&nbsp;<span class="op" id="5440279">=</span>&nbsp;<span class="ident" id="5440281">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440293">prefix</span><span class="op" id="5440299">.</span><span class="ident" id="5440300">Rune</span>&nbsp;<span class="op" id="5440305">=</span>&nbsp;<span class="builtinfunc" id="5440307">append</span><span class="op" id="5440313">(</span><span class="ident" id="5440314">prefix</span><span class="op" id="5440320">.</span><span class="ident" id="5440321">Rune</span><span class="op" id="5440325">[</span><span class="op" id="5440326">:</span><span class="num" id="5440327">0</span><span class="op" id="5440328">]</span><span class="op" id="5440329">,</span>&nbsp;<span class="ident" id="5440331">str</span><span class="op" id="5440334">...</span><span class="op" id="5440337">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440343">for</span>&nbsp;<span class="ident" id="5440347">j</span>&nbsp;<span class="op" id="5440349">:=</span>&nbsp;<span class="ident" id="5440352">start</span><span class="op" id="5440357">;</span>&nbsp;<span class="ident" id="5440359">j</span>&nbsp;<span class="op" id="5440361">&lt;</span>&nbsp;<span class="ident" id="5440363">i</span><span class="op" id="5440364">;</span>&nbsp;<span class="ident" id="5440366">j</span><span class="op" id="5440367">++</span>&nbsp;<span class="op" id="5440370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440376">sub</span><span class="op" id="5440379">[</span><span class="ident" id="5440380">j</span><span class="op" id="5440381">]</span>&nbsp;<span class="op" id="5440383">=</span>&nbsp;<span class="ident" id="5440385">p</span><span class="op" id="5440386">.</span><span class="ident" id="5440387">removeLeadingString</span><span class="op" id="5440406">(</span><span class="ident" id="5440407">sub</span><span class="op" id="5440410">[</span><span class="ident" id="5440411">j</span><span class="op" id="5440412">]</span><span class="op" id="5440413">,</span>&nbsp;<span class="builtinfunc" id="5440415">len</span><span class="op" id="5440418">(</span><span class="ident" id="5440419">str</span><span class="op" id="5440422">)</span><span class="op" id="5440423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440433">suffix</span>&nbsp;<span class="op" id="5440440">:=</span>&nbsp;<span class="ident" id="5440443">p</span><span class="op" id="5440444">.</span><span class="ident" id="5440445">collapse</span><span class="op" id="5440453">(</span><span class="ident" id="5440454">sub</span><span class="op" id="5440457">[</span><span class="ident" id="5440458">start</span><span class="op" id="5440463">:</span><span class="ident" id="5440464">i</span><span class="op" id="5440465">]</span><span class="op" id="5440466">,</span>&nbsp;<span class="ident" id="5440468">OpAlternate</span><span class="op" id="5440479">)</span>&nbsp;<span class="comment" id="5440481">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440496">re</span>&nbsp;<span class="op" id="5440499">:=</span>&nbsp;<span class="ident" id="5440502">p</span><span class="op" id="5440503">.</span><span class="ident" id="5440504">newRegexp</span><span class="op" id="5440513">(</span><span class="ident" id="5440514">OpConcat</span><span class="op" id="5440522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440527">re</span><span class="op" id="5440529">.</span><span class="ident" id="5440530">Sub</span>&nbsp;<span class="op" id="5440534">=</span>&nbsp;<span class="builtinfunc" id="5440536">append</span><span class="op" id="5440542">(</span><span class="ident" id="5440543">re</span><span class="op" id="5440545">.</span><span class="ident" id="5440546">Sub</span><span class="op" id="5440549">[</span><span class="op" id="5440550">:</span><span class="num" id="5440551">0</span><span class="op" id="5440552">]</span><span class="op" id="5440553">,</span>&nbsp;<span class="ident" id="5440555">prefix</span><span class="op" id="5440561">,</span>&nbsp;<span class="ident" id="5440563">suffix</span><span class="op" id="5440569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440574">out</span>&nbsp;<span class="op" id="5440578">=</span>&nbsp;<span class="builtinfunc" id="5440580">append</span><span class="op" id="5440586">(</span><span class="ident" id="5440587">out</span><span class="op" id="5440590">,</span>&nbsp;<span class="ident" id="5440592">re</span><span class="op" id="5440594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440598">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440603">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440636">start</span>&nbsp;<span class="op" id="5440642">=</span>&nbsp;<span class="ident" id="5440644">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440648">str</span>&nbsp;<span class="op" id="5440652">=</span>&nbsp;<span class="ident" id="5440654">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440661">strflags</span>&nbsp;<span class="op" id="5440670">=</span>&nbsp;<span class="ident" id="5440672">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440683">sub</span>&nbsp;<span class="op" id="5440687">=</span>&nbsp;<span class="ident" id="5440689">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440695">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440744">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440792">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440852">start</span>&nbsp;<span class="op" id="5440858">=</span>&nbsp;<span class="num" id="5440860">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440863">out</span>&nbsp;<span class="op" id="5440867">=</span>&nbsp;<span class="ident" id="5440869">sub</span><span class="op" id="5440872">[</span><span class="op" id="5440873">:</span><span class="num" id="5440874">0</span><span class="op" id="5440875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440878">var</span>&nbsp;<span class="ident" id="5440882">first</span>&nbsp;<span class="op" id="5440888">*</span><span class="ident" id="5440889">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440897">for</span>&nbsp;<span class="ident" id="5440901">i</span>&nbsp;<span class="op" id="5440903">:=</span>&nbsp;<span class="num" id="5440906">0</span><span class="op" id="5440907">;</span>&nbsp;<span class="ident" id="5440909">i</span>&nbsp;<span class="op" id="5440911">&lt;=</span>&nbsp;<span class="builtinfunc" id="5440914">len</span><span class="op" id="5440917">(</span><span class="ident" id="5440918">sub</span><span class="op" id="5440921">)</span><span class="op" id="5440922">;</span>&nbsp;<span class="ident" id="5440924">i</span><span class="op" id="5440925">++</span>&nbsp;<span class="op" id="5440928">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440932">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440996">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441063">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441097">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441102">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441179">var</span>&nbsp;<span class="ident" id="5441183">ifirst</span>&nbsp;<span class="op" id="5441190">*</span><span class="ident" id="5441191">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441200">if</span>&nbsp;<span class="ident" id="5441203">i</span>&nbsp;<span class="op" id="5441205">&lt;</span>&nbsp;<span class="builtinfunc" id="5441207">len</span><span class="op" id="5441210">(</span><span class="ident" id="5441211">sub</span><span class="op" id="5441214">)</span>&nbsp;<span class="op" id="5441216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441221">ifirst</span>&nbsp;<span class="op" id="5441228">=</span>&nbsp;<span class="ident" id="5441230">p</span><span class="op" id="5441231">.</span><span class="ident" id="5441232">leadingRegexp</span><span class="op" id="5441245">(</span><span class="ident" id="5441246">sub</span><span class="op" id="5441249">[</span><span class="ident" id="5441250">i</span><span class="op" id="5441251">]</span><span class="op" id="5441252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441257">if</span>&nbsp;<span class="ident" id="5441260">first</span>&nbsp;<span class="op" id="5441266">!=</span>&nbsp;<span class="ident" id="5441269">nil</span>&nbsp;<span class="op" id="5441273">&amp;&amp;</span>&nbsp;<span class="ident" id="5441276">first</span><span class="op" id="5441281">.</span><span class="ident" id="5441282">Equal</span><span class="op" id="5441287">(</span><span class="ident" id="5441288">ifirst</span><span class="op" id="5441294">)</span>&nbsp;<span class="op" id="5441296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441302">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441323">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441375">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441435">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441440">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441509">if</span>&nbsp;<span class="ident" id="5441512">i</span>&nbsp;<span class="op" id="5441514">==</span>&nbsp;<span class="ident" id="5441517">start</span>&nbsp;<span class="op" id="5441523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441528">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441566">}</span>&nbsp;<span class="keyword" id="5441568">else</span>&nbsp;<span class="keyword" id="5441573">if</span>&nbsp;<span class="ident" id="5441576">i</span>&nbsp;<span class="op" id="5441578">==</span>&nbsp;<span class="ident" id="5441581">start</span><span class="op" id="5441586">+</span><span class="num" id="5441587">1</span>&nbsp;<span class="op" id="5441589">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441594">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441634">out</span>&nbsp;<span class="op" id="5441638">=</span>&nbsp;<span class="builtinfunc" id="5441640">append</span><span class="op" id="5441646">(</span><span class="ident" id="5441647">out</span><span class="op" id="5441650">,</span>&nbsp;<span class="ident" id="5441652">sub</span><span class="op" id="5441655">[</span><span class="ident" id="5441656">start</span><span class="op" id="5441661">]</span><span class="op" id="5441662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441666">}</span>&nbsp;<span class="keyword" id="5441668">else</span>&nbsp;<span class="op" id="5441673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5441678">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441737">prefix</span>&nbsp;<span class="op" id="5441744">:=</span>&nbsp;<span class="ident" id="5441747">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5441756">for</span>&nbsp;<span class="ident" id="5441760">j</span>&nbsp;<span class="op" id="5441762">:=</span>&nbsp;<span class="ident" id="5441765">start</span><span class="op" id="5441770">;</span>&nbsp;<span class="ident" id="5441772">j</span>&nbsp;<span class="op" id="5441774">&lt;</span>&nbsp;<span class="ident" id="5441776">i</span><span class="op" id="5441777">;</span>&nbsp;<span class="ident" id="5441779">j</span><span class="op" id="5441780">++</span>&nbsp;<span class="op" id="5441783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441789">reuse</span>&nbsp;<span class="op" id="5441795">:=</span>&nbsp;<span class="ident" id="5441798">j</span>&nbsp;<span class="op" id="5441800">!=</span>&nbsp;<span class="ident" id="5441803">start</span>&nbsp;<span class="comment" id="5441809">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441844">sub</span><span class="op" id="5441847">[</span><span class="ident" id="5441848">j</span><span class="op" id="5441849">]</span>&nbsp;<span class="op" id="5441851">=</span>&nbsp;<span class="ident" id="5441853">p</span><span class="op" id="5441854">.</span><span class="ident" id="5441855">removeLeadingRegexp</span><span class="op" id="5441874">(</span><span class="ident" id="5441875">sub</span><span class="op" id="5441878">[</span><span class="ident" id="5441879">j</span><span class="op" id="5441880">]</span><span class="op" id="5441881">,</span>&nbsp;<span class="ident" id="5441883">reuse</span><span class="op" id="5441888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5441893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441898">suffix</span>&nbsp;<span class="op" id="5441905">:=</span>&nbsp;<span class="ident" id="5441908">p</span><span class="op" id="5441909">.</span><span class="ident" id="5441910">collapse</span><span class="op" id="5441918">(</span><span class="ident" id="5441919">sub</span><span class="op" id="5441922">[</span><span class="ident" id="5441923">start</span><span class="op" id="5441928">:</span><span class="ident" id="5441929">i</span><span class="op" id="5441930">]</span><span class="op" id="5441931">,</span>&nbsp;<span class="ident" id="5441933">OpAlternate</span><span class="op" id="5441944">)</span>&nbsp;<span class="comment" id="5441946">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441961">re</span>&nbsp;<span class="op" id="5441964">:=</span>&nbsp;<span class="ident" id="5441967">p</span><span class="op" id="5441968">.</span><span class="ident" id="5441969">newRegexp</span><span class="op" id="5441978">(</span><span class="ident" id="5441979">OpConcat</span><span class="op" id="5441987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5441992">re</span><span class="op" id="5441994">.</span><span class="ident" id="5441995">Sub</span>&nbsp;<span class="op" id="5441999">=</span>&nbsp;<span class="builtinfunc" id="5442001">append</span><span class="op" id="5442007">(</span><span class="ident" id="5442008">re</span><span class="op" id="5442010">.</span><span class="ident" id="5442011">Sub</span><span class="op" id="5442014">[</span><span class="op" id="5442015">:</span><span class="num" id="5442016">0</span><span class="op" id="5442017">]</span><span class="op" id="5442018">,</span>&nbsp;<span class="ident" id="5442020">prefix</span><span class="op" id="5442026">,</span>&nbsp;<span class="ident" id="5442028">suffix</span><span class="op" id="5442034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442039">out</span>&nbsp;<span class="op" id="5442043">=</span>&nbsp;<span class="builtinfunc" id="5442045">append</span><span class="op" id="5442051">(</span><span class="ident" id="5442052">out</span><span class="op" id="5442055">,</span>&nbsp;<span class="ident" id="5442057">re</span><span class="op" id="5442059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442063">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442068">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442101">start</span>&nbsp;<span class="op" id="5442107">=</span>&nbsp;<span class="ident" id="5442109">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442113">first</span>&nbsp;<span class="op" id="5442119">=</span>&nbsp;<span class="ident" id="5442121">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442129">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442132">sub</span>&nbsp;<span class="op" id="5442136">=</span>&nbsp;<span class="ident" id="5442138">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442144">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442214">start</span>&nbsp;<span class="op" id="5442220">=</span>&nbsp;<span class="num" id="5442222">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442225">out</span>&nbsp;<span class="op" id="5442229">=</span>&nbsp;<span class="ident" id="5442231">sub</span><span class="op" id="5442234">[</span><span class="op" id="5442235">:</span><span class="num" id="5442236">0</span><span class="op" id="5442237">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442240">for</span>&nbsp;<span class="ident" id="5442244">i</span>&nbsp;<span class="op" id="5442246">:=</span>&nbsp;<span class="num" id="5442249">0</span><span class="op" id="5442250">;</span>&nbsp;<span class="ident" id="5442252">i</span>&nbsp;<span class="op" id="5442254">&lt;=</span>&nbsp;<span class="builtinfunc" id="5442257">len</span><span class="op" id="5442260">(</span><span class="ident" id="5442261">sub</span><span class="op" id="5442264">)</span><span class="op" id="5442265">;</span>&nbsp;<span class="ident" id="5442267">i</span><span class="op" id="5442268">++</span>&nbsp;<span class="op" id="5442271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442275">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442339">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442406">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442440">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442445">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442510">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442551">if</span>&nbsp;<span class="ident" id="5442554">i</span>&nbsp;<span class="op" id="5442556">&lt;</span>&nbsp;<span class="builtinfunc" id="5442558">len</span><span class="op" id="5442561">(</span><span class="ident" id="5442562">sub</span><span class="op" id="5442565">)</span>&nbsp;<span class="op" id="5442567">&amp;&amp;</span>&nbsp;<span class="ident" id="5442570">isCharClass</span><span class="op" id="5442581">(</span><span class="ident" id="5442582">sub</span><span class="op" id="5442585">[</span><span class="ident" id="5442586">i</span><span class="op" id="5442587">]</span><span class="op" id="5442588">)</span>&nbsp;<span class="op" id="5442590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442595">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442606">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442611">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442652">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442693">if</span>&nbsp;<span class="ident" id="5442696">i</span>&nbsp;<span class="op" id="5442698">==</span>&nbsp;<span class="ident" id="5442701">start</span>&nbsp;<span class="op" id="5442707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442712">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442750">}</span>&nbsp;<span class="keyword" id="5442752">else</span>&nbsp;<span class="keyword" id="5442757">if</span>&nbsp;<span class="ident" id="5442760">i</span>&nbsp;<span class="op" id="5442762">==</span>&nbsp;<span class="ident" id="5442765">start</span><span class="op" id="5442770">+</span><span class="num" id="5442771">1</span>&nbsp;<span class="op" id="5442773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442778">out</span>&nbsp;<span class="op" id="5442782">=</span>&nbsp;<span class="builtinfunc" id="5442784">append</span><span class="op" id="5442790">(</span><span class="ident" id="5442791">out</span><span class="op" id="5442794">,</span>&nbsp;<span class="ident" id="5442796">sub</span><span class="op" id="5442799">[</span><span class="ident" id="5442800">start</span><span class="op" id="5442805">]</span><span class="op" id="5442806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5442810">}</span>&nbsp;<span class="keyword" id="5442812">else</span>&nbsp;<span class="op" id="5442817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442822">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5442849">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5442901">max</span>&nbsp;<span class="op" id="5442905">:=</span>&nbsp;<span class="ident" id="5442908">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442917">for</span>&nbsp;<span class="ident" id="5442921">j</span>&nbsp;<span class="op" id="5442923">:=</span>&nbsp;<span class="ident" id="5442926">start</span>&nbsp;<span class="op" id="5442932">+</span>&nbsp;<span class="num" id="5442934">1</span><span class="op" id="5442935">;</span>&nbsp;<span class="ident" id="5442937">j</span>&nbsp;<span class="op" id="5442939">&lt;</span>&nbsp;<span class="ident" id="5442941">i</span><span class="op" id="5442942">;</span>&nbsp;<span class="ident" id="5442944">j</span><span class="op" id="5442945">++</span>&nbsp;<span class="op" id="5442948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5442954">if</span>&nbsp;<span class="ident" id="5442957">sub</span><span class="op" id="5442960">[</span><span class="ident" id="5442961">max</span><span class="op" id="5442964">]</span><span class="op" id="5442965">.</span><span class="ident" id="5442966">Op</span>&nbsp;<span class="op" id="5442969">&lt;</span>&nbsp;<span class="ident" id="5442971">sub</span><span class="op" id="5442974">[</span><span class="ident" id="5442975">j</span><span class="op" id="5442976">]</span><span class="op" id="5442977">.</span><span class="ident" id="5442978">Op</span>&nbsp;<span class="op" id="5442981">||</span>&nbsp;<span class="ident" id="5442984">sub</span><span class="op" id="5442987">[</span><span class="ident" id="5442988">max</span><span class="op" id="5442991">]</span><span class="op" id="5442992">.</span><span class="ident" id="5442993">Op</span>&nbsp;<span class="op" id="5442996">==</span>&nbsp;<span class="ident" id="5442999">sub</span><span class="op" id="5443002">[</span><span class="ident" id="5443003">j</span><span class="op" id="5443004">]</span><span class="op" id="5443005">.</span><span class="ident" id="5443006">Op</span>&nbsp;<span class="op" id="5443009">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5443012">len</span><span class="op" id="5443015">(</span><span class="ident" id="5443016">sub</span><span class="op" id="5443019">[</span><span class="ident" id="5443020">max</span><span class="op" id="5443023">]</span><span class="op" id="5443024">.</span><span class="ident" id="5443025">Rune</span><span class="op" id="5443029">)</span>&nbsp;<span class="op" id="5443031">&lt;</span>&nbsp;<span class="builtinfunc" id="5443033">len</span><span class="op" id="5443036">(</span><span class="ident" id="5443037">sub</span><span class="op" id="5443040">[</span><span class="ident" id="5443041">j</span><span class="op" id="5443042">]</span><span class="op" id="5443043">.</span><span class="ident" id="5443044">Rune</span><span class="op" id="5443048">)</span>&nbsp;<span class="op" id="5443050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443057">max</span>&nbsp;<span class="op" id="5443061">=</span>&nbsp;<span class="ident" id="5443063">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443069">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443079">sub</span><span class="op" id="5443082">[</span><span class="ident" id="5443083">start</span><span class="op" id="5443088">]</span><span class="op" id="5443089">,</span>&nbsp;<span class="ident" id="5443091">sub</span><span class="op" id="5443094">[</span><span class="ident" id="5443095">max</span><span class="op" id="5443098">]</span>&nbsp;<span class="op" id="5443100">=</span>&nbsp;<span class="ident" id="5443102">sub</span><span class="op" id="5443105">[</span><span class="ident" id="5443106">max</span><span class="op" id="5443109">]</span><span class="op" id="5443110">,</span>&nbsp;<span class="ident" id="5443112">sub</span><span class="op" id="5443115">[</span><span class="ident" id="5443116">start</span><span class="op" id="5443121">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443127">for</span>&nbsp;<span class="ident" id="5443131">j</span>&nbsp;<span class="op" id="5443133">:=</span>&nbsp;<span class="ident" id="5443136">start</span>&nbsp;<span class="op" id="5443142">+</span>&nbsp;<span class="num" id="5443144">1</span><span class="op" id="5443145">;</span>&nbsp;<span class="ident" id="5443147">j</span>&nbsp;<span class="op" id="5443149">&lt;</span>&nbsp;<span class="ident" id="5443151">i</span><span class="op" id="5443152">;</span>&nbsp;<span class="ident" id="5443154">j</span><span class="op" id="5443155">++</span>&nbsp;<span class="op" id="5443158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443164">mergeCharClass</span><span class="op" id="5443178">(</span><span class="ident" id="5443179">sub</span><span class="op" id="5443182">[</span><span class="ident" id="5443183">start</span><span class="op" id="5443188">]</span><span class="op" id="5443189">,</span>&nbsp;<span class="ident" id="5443191">sub</span><span class="op" id="5443194">[</span><span class="ident" id="5443195">j</span><span class="op" id="5443196">]</span><span class="op" id="5443197">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443203">p</span><span class="op" id="5443204">.</span><span class="ident" id="5443205">reuse</span><span class="op" id="5443210">(</span><span class="ident" id="5443211">sub</span><span class="op" id="5443214">[</span><span class="ident" id="5443215">j</span><span class="op" id="5443216">]</span><span class="op" id="5443217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443227">cleanAlt</span><span class="op" id="5443235">(</span><span class="ident" id="5443236">sub</span><span class="op" id="5443239">[</span><span class="ident" id="5443240">start</span><span class="op" id="5443245">]</span><span class="op" id="5443246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443251">out</span>&nbsp;<span class="op" id="5443255">=</span>&nbsp;<span class="builtinfunc" id="5443257">append</span><span class="op" id="5443263">(</span><span class="ident" id="5443264">out</span><span class="op" id="5443267">,</span>&nbsp;<span class="ident" id="5443269">sub</span><span class="op" id="5443272">[</span><span class="ident" id="5443273">start</span><span class="op" id="5443278">]</span><span class="op" id="5443279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443283">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5443288">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443319">if</span>&nbsp;<span class="ident" id="5443322">i</span>&nbsp;<span class="op" id="5443324">&lt;</span>&nbsp;<span class="builtinfunc" id="5443326">len</span><span class="op" id="5443329">(</span><span class="ident" id="5443330">sub</span><span class="op" id="5443333">)</span>&nbsp;<span class="op" id="5443335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443340">out</span>&nbsp;<span class="op" id="5443344">=</span>&nbsp;<span class="builtinfunc" id="5443346">append</span><span class="op" id="5443352">(</span><span class="ident" id="5443353">out</span><span class="op" id="5443356">,</span>&nbsp;<span class="ident" id="5443358">sub</span><span class="op" id="5443361">[</span><span class="ident" id="5443362">i</span><span class="op" id="5443363">]</span><span class="op" id="5443364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443368">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443372">start</span>&nbsp;<span class="op" id="5443378">=</span>&nbsp;<span class="ident" id="5443380">i</span>&nbsp;<span class="op" id="5443382">+</span>&nbsp;<span class="num" id="5443384">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443390">sub</span>&nbsp;<span class="op" id="5443394">=</span>&nbsp;<span class="ident" id="5443396">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5443402">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443473">start</span>&nbsp;<span class="op" id="5443479">=</span>&nbsp;<span class="num" id="5443481">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443484">out</span>&nbsp;<span class="op" id="5443488">=</span>&nbsp;<span class="ident" id="5443490">sub</span><span class="op" id="5443493">[</span><span class="op" id="5443494">:</span><span class="num" id="5443495">0</span><span class="op" id="5443496">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443499">for</span>&nbsp;<span class="ident" id="5443503">i</span>&nbsp;<span class="op" id="5443505">:=</span>&nbsp;<span class="keyword" id="5443508">range</span>&nbsp;<span class="ident" id="5443514">sub</span>&nbsp;<span class="op" id="5443518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443522">if</span>&nbsp;<span class="ident" id="5443525">i</span><span class="op" id="5443526">+</span><span class="num" id="5443527">1</span>&nbsp;<span class="op" id="5443529">&lt;</span>&nbsp;<span class="builtinfunc" id="5443531">len</span><span class="op" id="5443534">(</span><span class="ident" id="5443535">sub</span><span class="op" id="5443538">)</span>&nbsp;<span class="op" id="5443540">&amp;&amp;</span>&nbsp;<span class="ident" id="5443543">sub</span><span class="op" id="5443546">[</span><span class="ident" id="5443547">i</span><span class="op" id="5443548">]</span><span class="op" id="5443549">.</span><span class="ident" id="5443550">Op</span>&nbsp;<span class="op" id="5443553">==</span>&nbsp;<span class="ident" id="5443556">OpEmptyMatch</span>&nbsp;<span class="op" id="5443569">&amp;&amp;</span>&nbsp;<span class="ident" id="5443572">sub</span><span class="op" id="5443575">[</span><span class="ident" id="5443576">i</span><span class="op" id="5443577">+</span><span class="num" id="5443578">1</span><span class="op" id="5443579">]</span><span class="op" id="5443580">.</span><span class="ident" id="5443581">Op</span>&nbsp;<span class="op" id="5443584">==</span>&nbsp;<span class="ident" id="5443587">OpEmptyMatch</span>&nbsp;<span class="op" id="5443600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443605">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443620">out</span>&nbsp;<span class="op" id="5443624">=</span>&nbsp;<span class="builtinfunc" id="5443626">append</span><span class="op" id="5443632">(</span><span class="ident" id="5443633">out</span><span class="op" id="5443636">,</span>&nbsp;<span class="ident" id="5443638">sub</span><span class="op" id="5443641">[</span><span class="ident" id="5443642">i</span><span class="op" id="5443643">]</span><span class="op" id="5443644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443650">sub</span>&nbsp;<span class="op" id="5443654">=</span>&nbsp;<span class="ident" id="5443656">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443662">return</span>&nbsp;<span class="ident" id="5443669">sub</span><br>
<span class="lineno"></span><span class="op" id="5443673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443676">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5443749">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5443804">func</span>&nbsp;<span class="op" id="5443809">(</span><span class="ident" id="5443810">p</span>&nbsp;<span class="op" id="5443812">*</span><span class="ident" id="5443813">parser</span><span class="op" id="5443819">)</span>&nbsp;<span class="ident" id="5443821">leadingString</span><span class="op" id="5443834">(</span><span class="ident" id="5443835">re</span>&nbsp;<span class="op" id="5443838">*</span><span class="ident" id="5443839">Regexp</span><span class="op" id="5443845">)</span>&nbsp;<span class="op" id="5443847">(</span><span class="op" id="5443848">[</span><span class="op" id="5443849">]</span><span class="builtintype" id="5443850">rune</span><span class="op" id="5443854">,</span>&nbsp;<span class="ident" id="5443856">Flags</span><span class="op" id="5443861">)</span>&nbsp;<span class="op" id="5443863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443866">if</span>&nbsp;<span class="ident" id="5443869">re</span><span class="op" id="5443871">.</span><span class="ident" id="5443872">Op</span>&nbsp;<span class="op" id="5443875">==</span>&nbsp;<span class="ident" id="5443878">OpConcat</span>&nbsp;<span class="op" id="5443887">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5443890">len</span><span class="op" id="5443893">(</span><span class="ident" id="5443894">re</span><span class="op" id="5443896">.</span><span class="ident" id="5443897">Sub</span><span class="op" id="5443900">)</span>&nbsp;<span class="op" id="5443902">&gt;</span>&nbsp;<span class="num" id="5443904">0</span>&nbsp;<span class="op" id="5443906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5443910">re</span>&nbsp;<span class="op" id="5443913">=</span>&nbsp;<span class="ident" id="5443915">re</span><span class="op" id="5443917">.</span><span class="ident" id="5443918">Sub</span><span class="op" id="5443921">[</span><span class="num" id="5443922">0</span><span class="op" id="5443923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443929">if</span>&nbsp;<span class="ident" id="5443932">re</span><span class="op" id="5443934">.</span><span class="ident" id="5443935">Op</span>&nbsp;<span class="op" id="5443938">!=</span>&nbsp;<span class="ident" id="5443941">OpLiteral</span>&nbsp;<span class="op" id="5443951">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443955">return</span>&nbsp;<span class="ident" id="5443962">nil</span><span class="op" id="5443965">,</span>&nbsp;<span class="num" id="5443967">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5443970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5443973">return</span>&nbsp;<span class="ident" id="5443980">re</span><span class="op" id="5443982">.</span><span class="ident" id="5443983">Rune</span><span class="op" id="5443987">,</span>&nbsp;<span class="ident" id="5443989">re</span><span class="op" id="5443991">.</span><span class="ident" id="5443992">Flags</span>&nbsp;<span class="op" id="5443998">&amp;</span>&nbsp;<span class="ident" id="5444000">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="5444009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5444012">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5444069">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5444134">func</span>&nbsp;<span class="op" id="5444139">(</span><span class="ident" id="5444140">p</span>&nbsp;<span class="op" id="5444142">*</span><span class="ident" id="5444143">parser</span><span class="op" id="5444149">)</span>&nbsp;<span class="ident" id="5444151">removeLeadingString</span><span class="op" id="5444170">(</span><span class="ident" id="5444171">re</span>&nbsp;<span class="op" id="5444174">*</span><span class="ident" id="5444175">Regexp</span><span class="op" id="5444181">,</span>&nbsp;<span class="ident" id="5444183">n</span>&nbsp;<span class="builtintype" id="5444185">int</span><span class="op" id="5444188">)</span>&nbsp;<span class="op" id="5444190">*</span><span class="ident" id="5444191">Regexp</span>&nbsp;<span class="op" id="5444198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444201">if</span>&nbsp;<span class="ident" id="5444204">re</span><span class="op" id="5444206">.</span><span class="ident" id="5444207">Op</span>&nbsp;<span class="op" id="5444210">==</span>&nbsp;<span class="ident" id="5444213">OpConcat</span>&nbsp;<span class="op" id="5444222">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5444225">len</span><span class="op" id="5444228">(</span><span class="ident" id="5444229">re</span><span class="op" id="5444231">.</span><span class="ident" id="5444232">Sub</span><span class="op" id="5444235">)</span>&nbsp;<span class="op" id="5444237">&gt;</span>&nbsp;<span class="num" id="5444239">0</span>&nbsp;<span class="op" id="5444241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444245">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444295">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444334">sub</span>&nbsp;<span class="op" id="5444338">:=</span>&nbsp;<span class="ident" id="5444341">re</span><span class="op" id="5444343">.</span><span class="ident" id="5444344">Sub</span><span class="op" id="5444347">[</span><span class="num" id="5444348">0</span><span class="op" id="5444349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444353">sub</span>&nbsp;<span class="op" id="5444357">=</span>&nbsp;<span class="ident" id="5444359">p</span><span class="op" id="5444360">.</span><span class="ident" id="5444361">removeLeadingString</span><span class="op" id="5444380">(</span><span class="ident" id="5444381">sub</span><span class="op" id="5444384">,</span>&nbsp;<span class="ident" id="5444386">n</span><span class="op" id="5444387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444391">re</span><span class="op" id="5444393">.</span><span class="ident" id="5444394">Sub</span><span class="op" id="5444397">[</span><span class="num" id="5444398">0</span><span class="op" id="5444399">]</span>&nbsp;<span class="op" id="5444401">=</span>&nbsp;<span class="ident" id="5444403">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444409">if</span>&nbsp;<span class="ident" id="5444412">sub</span><span class="op" id="5444415">.</span><span class="ident" id="5444416">Op</span>&nbsp;<span class="op" id="5444419">==</span>&nbsp;<span class="ident" id="5444422">OpEmptyMatch</span>&nbsp;<span class="op" id="5444435">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444440">p</span><span class="op" id="5444441">.</span><span class="ident" id="5444442">reuse</span><span class="op" id="5444447">(</span><span class="ident" id="5444448">sub</span><span class="op" id="5444451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444456">switch</span>&nbsp;<span class="builtinfunc" id="5444463">len</span><span class="op" id="5444466">(</span><span class="ident" id="5444467">re</span><span class="op" id="5444469">.</span><span class="ident" id="5444470">Sub</span><span class="op" id="5444473">)</span>&nbsp;<span class="op" id="5444475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444480">case</span>&nbsp;<span class="num" id="5444485">0</span><span class="op" id="5444486">,</span>&nbsp;<span class="num" id="5444488">1</span><span class="op" id="5444489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5444495">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444525">re</span><span class="op" id="5444527">.</span><span class="ident" id="5444528">Op</span>&nbsp;<span class="op" id="5444531">=</span>&nbsp;<span class="ident" id="5444533">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444550">re</span><span class="op" id="5444552">.</span><span class="ident" id="5444553">Sub</span>&nbsp;<span class="op" id="5444557">=</span>&nbsp;<span class="ident" id="5444559">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444566">case</span>&nbsp;<span class="num" id="5444571">2</span><span class="op" id="5444572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444578">old</span>&nbsp;<span class="op" id="5444582">:=</span>&nbsp;<span class="ident" id="5444585">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444592">re</span>&nbsp;<span class="op" id="5444595">=</span>&nbsp;<span class="ident" id="5444597">re</span><span class="op" id="5444599">.</span><span class="ident" id="5444600">Sub</span><span class="op" id="5444603">[</span><span class="num" id="5444604">1</span><span class="op" id="5444605">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444611">p</span><span class="op" id="5444612">.</span><span class="ident" id="5444613">reuse</span><span class="op" id="5444618">(</span><span class="ident" id="5444619">old</span><span class="op" id="5444622">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444627">default</span><span class="op" id="5444634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5444640">copy</span><span class="op" id="5444644">(</span><span class="ident" id="5444645">re</span><span class="op" id="5444647">.</span><span class="ident" id="5444648">Sub</span><span class="op" id="5444651">,</span>&nbsp;<span class="ident" id="5444653">re</span><span class="op" id="5444655">.</span><span class="ident" id="5444656">Sub</span><span class="op" id="5444659">[</span><span class="num" id="5444660">1</span><span class="op" id="5444661">:</span><span class="op" id="5444662">]</span><span class="op" id="5444663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444669">re</span><span class="op" id="5444671">.</span><span class="ident" id="5444672">Sub</span>&nbsp;<span class="op" id="5444676">=</span>&nbsp;<span class="ident" id="5444678">re</span><span class="op" id="5444680">.</span><span class="ident" id="5444681">Sub</span><span class="op" id="5444684">[</span><span class="op" id="5444685">:</span><span class="builtinfunc" id="5444686">len</span><span class="op" id="5444689">(</span><span class="ident" id="5444690">re</span><span class="op" id="5444692">.</span><span class="ident" id="5444693">Sub</span><span class="op" id="5444696">)</span><span class="op" id="5444697">-</span><span class="num" id="5444698">1</span><span class="op" id="5444699">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444708">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444712">return</span>&nbsp;<span class="ident" id="5444719">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444727">if</span>&nbsp;<span class="ident" id="5444730">re</span><span class="op" id="5444732">.</span><span class="ident" id="5444733">Op</span>&nbsp;<span class="op" id="5444736">==</span>&nbsp;<span class="ident" id="5444739">OpLiteral</span>&nbsp;<span class="op" id="5444749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444753">re</span><span class="op" id="5444755">.</span><span class="ident" id="5444756">Rune</span>&nbsp;<span class="op" id="5444761">=</span>&nbsp;<span class="ident" id="5444763">re</span><span class="op" id="5444765">.</span><span class="ident" id="5444766">Rune</span><span class="op" id="5444770">[</span><span class="op" id="5444771">:</span><span class="builtinfunc" id="5444772">copy</span><span class="op" id="5444776">(</span><span class="ident" id="5444777">re</span><span class="op" id="5444779">.</span><span class="ident" id="5444780">Rune</span><span class="op" id="5444784">,</span>&nbsp;<span class="ident" id="5444786">re</span><span class="op" id="5444788">.</span><span class="ident" id="5444789">Rune</span><span class="op" id="5444793">[</span><span class="ident" id="5444794">n</span><span class="op" id="5444795">:</span><span class="op" id="5444796">]</span><span class="op" id="5444797">)</span><span class="op" id="5444798">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444802">if</span>&nbsp;<span class="builtinfunc" id="5444805">len</span><span class="op" id="5444808">(</span><span class="ident" id="5444809">re</span><span class="op" id="5444811">.</span><span class="ident" id="5444812">Rune</span><span class="op" id="5444816">)</span>&nbsp;<span class="op" id="5444818">==</span>&nbsp;<span class="num" id="5444821">0</span>&nbsp;<span class="op" id="5444823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5444828">re</span><span class="op" id="5444830">.</span><span class="ident" id="5444831">Op</span>&nbsp;<span class="op" id="5444834">=</span>&nbsp;<span class="ident" id="5444836">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5444854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5444857">return</span>&nbsp;<span class="ident" id="5444864">re</span><br>
<span class="lineno">630</span><span class="op" id="5444867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5444870">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5444935">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5444990">func</span>&nbsp;<span class="op" id="5444995">(</span><span class="ident" id="5444996">p</span>&nbsp;<span class="op" id="5444998">*</span><span class="ident" id="5444999">parser</span><span class="op" id="5445005">)</span>&nbsp;<span class="ident" id="5445007">leadingRegexp</span><span class="op" id="5445020">(</span><span class="ident" id="5445021">re</span>&nbsp;<span class="op" id="5445024">*</span><span class="ident" id="5445025">Regexp</span><span class="op" id="5445031">)</span>&nbsp;<span class="op" id="5445033">*</span><span class="ident" id="5445034">Regexp</span>&nbsp;<span class="op" id="5445041">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445044">if</span>&nbsp;<span class="ident" id="5445047">re</span><span class="op" id="5445049">.</span><span class="ident" id="5445050">Op</span>&nbsp;<span class="op" id="5445053">==</span>&nbsp;<span class="ident" id="5445056">OpEmptyMatch</span>&nbsp;<span class="op" id="5445069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445073">return</span>&nbsp;<span class="ident" id="5445080">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445088">if</span>&nbsp;<span class="ident" id="5445091">re</span><span class="op" id="5445093">.</span><span class="ident" id="5445094">Op</span>&nbsp;<span class="op" id="5445097">==</span>&nbsp;<span class="ident" id="5445100">OpConcat</span>&nbsp;<span class="op" id="5445109">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5445112">len</span><span class="op" id="5445115">(</span><span class="ident" id="5445116">re</span><span class="op" id="5445118">.</span><span class="ident" id="5445119">Sub</span><span class="op" id="5445122">)</span>&nbsp;<span class="op" id="5445124">&gt;</span>&nbsp;<span class="num" id="5445126">0</span>&nbsp;<span class="op" id="5445128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445132">sub</span>&nbsp;<span class="op" id="5445136">:=</span>&nbsp;<span class="ident" id="5445139">re</span><span class="op" id="5445141">.</span><span class="ident" id="5445142">Sub</span><span class="op" id="5445145">[</span><span class="num" id="5445146">0</span><span class="op" id="5445147">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445151">if</span>&nbsp;<span class="ident" id="5445154">sub</span><span class="op" id="5445157">.</span><span class="ident" id="5445158">Op</span>&nbsp;<span class="op" id="5445161">==</span>&nbsp;<span class="ident" id="5445164">OpEmptyMatch</span>&nbsp;<span class="op" id="5445177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445182">return</span>&nbsp;<span class="ident" id="5445189">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445199">return</span>&nbsp;<span class="ident" id="5445206">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445211">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445214">return</span>&nbsp;<span class="ident" id="5445221">re</span><br>
<span class="lineno"></span><span class="op" id="5445224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5445227">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5445284">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5445322">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5445406">func</span>&nbsp;<span class="op" id="5445411">(</span><span class="ident" id="5445412">p</span>&nbsp;<span class="op" id="5445414">*</span><span class="ident" id="5445415">parser</span><span class="op" id="5445421">)</span>&nbsp;<span class="ident" id="5445423">removeLeadingRegexp</span><span class="op" id="5445442">(</span><span class="ident" id="5445443">re</span>&nbsp;<span class="op" id="5445446">*</span><span class="ident" id="5445447">Regexp</span><span class="op" id="5445453">,</span>&nbsp;<span class="ident" id="5445455">reuse</span>&nbsp;<span class="builtintype" id="5445461">bool</span><span class="op" id="5445465">)</span>&nbsp;<span class="op" id="5445467">*</span><span class="ident" id="5445468">Regexp</span>&nbsp;<span class="op" id="5445475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445478">if</span>&nbsp;<span class="ident" id="5445481">re</span><span class="op" id="5445483">.</span><span class="ident" id="5445484">Op</span>&nbsp;<span class="op" id="5445487">==</span>&nbsp;<span class="ident" id="5445490">OpConcat</span>&nbsp;<span class="op" id="5445499">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5445502">len</span><span class="op" id="5445505">(</span><span class="ident" id="5445506">re</span><span class="op" id="5445508">.</span><span class="ident" id="5445509">Sub</span><span class="op" id="5445512">)</span>&nbsp;<span class="op" id="5445514">&gt;</span>&nbsp;<span class="num" id="5445516">0</span>&nbsp;<span class="op" id="5445518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445522">if</span>&nbsp;<span class="ident" id="5445525">reuse</span>&nbsp;<span class="op" id="5445531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445536">p</span><span class="op" id="5445537">.</span><span class="ident" id="5445538">reuse</span><span class="op" id="5445543">(</span><span class="ident" id="5445544">re</span><span class="op" id="5445546">.</span><span class="ident" id="5445547">Sub</span><span class="op" id="5445550">[</span><span class="num" id="5445551">0</span><span class="op" id="5445552">]</span><span class="op" id="5445553">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445561">re</span><span class="op" id="5445563">.</span><span class="ident" id="5445564">Sub</span>&nbsp;<span class="op" id="5445568">=</span>&nbsp;<span class="ident" id="5445570">re</span><span class="op" id="5445572">.</span><span class="ident" id="5445573">Sub</span><span class="op" id="5445576">[</span><span class="op" id="5445577">:</span><span class="builtinfunc" id="5445578">copy</span><span class="op" id="5445582">(</span><span class="ident" id="5445583">re</span><span class="op" id="5445585">.</span><span class="ident" id="5445586">Sub</span><span class="op" id="5445589">,</span>&nbsp;<span class="ident" id="5445591">re</span><span class="op" id="5445593">.</span><span class="ident" id="5445594">Sub</span><span class="op" id="5445597">[</span><span class="num" id="5445598">1</span><span class="op" id="5445599">:</span><span class="op" id="5445600">]</span><span class="op" id="5445601">)</span><span class="op" id="5445602">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445606">switch</span>&nbsp;<span class="builtinfunc" id="5445613">len</span><span class="op" id="5445616">(</span><span class="ident" id="5445617">re</span><span class="op" id="5445619">.</span><span class="ident" id="5445620">Sub</span><span class="op" id="5445623">)</span>&nbsp;<span class="op" id="5445625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445629">case</span>&nbsp;<span class="num" id="5445634">0</span><span class="op" id="5445635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445640">re</span><span class="op" id="5445642">.</span><span class="ident" id="5445643">Op</span>&nbsp;<span class="op" id="5445646">=</span>&nbsp;<span class="ident" id="5445648">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445664">re</span><span class="op" id="5445666">.</span><span class="ident" id="5445667">Sub</span>&nbsp;<span class="op" id="5445671">=</span>&nbsp;<span class="ident" id="5445673">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445679">case</span>&nbsp;<span class="num" id="5445684">1</span><span class="op" id="5445685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445690">old</span>&nbsp;<span class="op" id="5445694">:=</span>&nbsp;<span class="ident" id="5445697">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445703">re</span>&nbsp;<span class="op" id="5445706">=</span>&nbsp;<span class="ident" id="5445708">re</span><span class="op" id="5445710">.</span><span class="ident" id="5445711">Sub</span><span class="op" id="5445714">[</span><span class="num" id="5445715">0</span><span class="op" id="5445716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445721">p</span><span class="op" id="5445722">.</span><span class="ident" id="5445723">reuse</span><span class="op" id="5445728">(</span><span class="ident" id="5445729">old</span><span class="op" id="5445732">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445740">return</span>&nbsp;<span class="ident" id="5445747">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445754">if</span>&nbsp;<span class="ident" id="5445757">reuse</span>&nbsp;<span class="op" id="5445763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445767">p</span><span class="op" id="5445768">.</span><span class="ident" id="5445769">reuse</span><span class="op" id="5445774">(</span><span class="ident" id="5445775">re</span><span class="op" id="5445777">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445783">return</span>&nbsp;<span class="ident" id="5445790">p</span><span class="op" id="5445791">.</span><span class="ident" id="5445792">newRegexp</span><span class="op" id="5445801">(</span><span class="ident" id="5445802">OpEmptyMatch</span><span class="op" id="5445814">)</span><br>
<span class="lineno"></span><span class="op" id="5445816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5445819">func</span>&nbsp;<span class="ident" id="5445824">literalRegexp</span><span class="op" id="5445837">(</span><span class="ident" id="5445838">s</span>&nbsp;<span class="builtintype" id="5445840">string</span><span class="op" id="5445846">,</span>&nbsp;<span class="ident" id="5445848">flags</span>&nbsp;<span class="ident" id="5445854">Flags</span><span class="op" id="5445859">)</span>&nbsp;<span class="op" id="5445861">*</span><span class="ident" id="5445862">Regexp</span>&nbsp;<span class="op" id="5445869">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445872">re</span>&nbsp;<span class="op" id="5445875">:=</span>&nbsp;<span class="op" id="5445878">&amp;</span><span class="ident" id="5445879">Regexp</span><span class="op" id="5445885">{</span><span class="ident" id="5445886">Op</span><span class="op" id="5445888">:</span>&nbsp;<span class="ident" id="5445890">OpLiteral</span><span class="op" id="5445899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445902">re</span><span class="op" id="5445904">.</span><span class="ident" id="5445905">Flags</span>&nbsp;<span class="op" id="5445911">=</span>&nbsp;<span class="ident" id="5445913">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5445920">re</span><span class="op" id="5445922">.</span><span class="ident" id="5445923">Rune</span>&nbsp;<span class="op" id="5445928">=</span>&nbsp;<span class="ident" id="5445930">re</span><span class="op" id="5445932">.</span><span class="ident" id="5445933">Rune0</span><span class="op" id="5445938">[</span><span class="op" id="5445939">:</span><span class="num" id="5445940">0</span><span class="op" id="5445941">]</span>&nbsp;<span class="comment" id="5445943">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5445983">for</span>&nbsp;<span class="ident" id="5445987">_</span><span class="op" id="5445988">,</span>&nbsp;<span class="ident" id="5445990">c</span>&nbsp;<span class="op" id="5445992">:=</span>&nbsp;<span class="keyword" id="5445995">range</span>&nbsp;<span class="ident" id="5446001">s</span>&nbsp;<span class="op" id="5446003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446007">if</span>&nbsp;<span class="builtinfunc" id="5446010">len</span><span class="op" id="5446013">(</span><span class="ident" id="5446014">re</span><span class="op" id="5446016">.</span><span class="ident" id="5446017">Rune</span><span class="op" id="5446021">)</span>&nbsp;<span class="op" id="5446023">&gt;=</span>&nbsp;<span class="builtinfunc" id="5446026">cap</span><span class="op" id="5446029">(</span><span class="ident" id="5446030">re</span><span class="op" id="5446032">.</span><span class="ident" id="5446033">Rune</span><span class="op" id="5446037">)</span>&nbsp;<span class="op" id="5446039">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5446044">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446104">re</span><span class="op" id="5446106">.</span><span class="ident" id="5446107">Rune</span>&nbsp;<span class="op" id="5446112">=</span>&nbsp;<span class="op" id="5446114">[</span><span class="op" id="5446115">]</span><span class="builtintype" id="5446116">rune</span><span class="op" id="5446120">(</span><span class="ident" id="5446121">s</span><span class="op" id="5446122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446127">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446139">re</span><span class="op" id="5446141">.</span><span class="ident" id="5446142">Rune</span>&nbsp;<span class="op" id="5446147">=</span>&nbsp;<span class="builtinfunc" id="5446149">append</span><span class="op" id="5446155">(</span><span class="ident" id="5446156">re</span><span class="op" id="5446158">.</span><span class="ident" id="5446159">Rune</span><span class="op" id="5446163">,</span>&nbsp;<span class="ident" id="5446165">c</span><span class="op" id="5446166">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446172">return</span>&nbsp;<span class="ident" id="5446179">re</span><br>
<span class="lineno"></span><span class="op" id="5446182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446185">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5446198">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5446273">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5446342">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5446381">func</span>&nbsp;<span class="ident" id="5446386">Parse</span><span class="op" id="5446391">(</span><span class="ident" id="5446392">s</span>&nbsp;<span class="builtintype" id="5446394">string</span><span class="op" id="5446400">,</span>&nbsp;<span class="ident" id="5446402">flags</span>&nbsp;<span class="ident" id="5446408">Flags</span><span class="op" id="5446413">)</span>&nbsp;<span class="op" id="5446415">(</span><span class="op" id="5446416">*</span><span class="ident" id="5446417">Regexp</span><span class="op" id="5446423">,</span>&nbsp;<span class="builtintype" id="5446425">error</span><span class="op" id="5446430">)</span>&nbsp;<span class="op" id="5446432">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446435">if</span>&nbsp;<span class="ident" id="5446438">flags</span><span class="op" id="5446443">&amp;</span><span class="ident" id="5446444">Literal</span>&nbsp;<span class="op" id="5446452">!=</span>&nbsp;<span class="num" id="5446455">0</span>&nbsp;<span class="op" id="5446457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5446461">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446501">if</span>&nbsp;<span class="ident" id="5446504">err</span>&nbsp;<span class="op" id="5446508">:=</span>&nbsp;<span class="ident" id="5446511">checkUTF8</span><span class="op" id="5446520">(</span><span class="ident" id="5446521">s</span><span class="op" id="5446522">)</span><span class="op" id="5446523">;</span>&nbsp;<span class="ident" id="5446525">err</span>&nbsp;<span class="op" id="5446529">!=</span>&nbsp;<span class="ident" id="5446532">nil</span>&nbsp;<span class="op" id="5446536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446541">return</span>&nbsp;<span class="ident" id="5446548">nil</span><span class="op" id="5446551">,</span>&nbsp;<span class="ident" id="5446553">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446559">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446563">return</span>&nbsp;<span class="ident" id="5446570">literalRegexp</span><span class="op" id="5446583">(</span><span class="ident" id="5446584">s</span><span class="op" id="5446585">,</span>&nbsp;<span class="ident" id="5446587">flags</span><span class="op" id="5446592">)</span><span class="op" id="5446593">,</span>&nbsp;<span class="ident" id="5446595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5446604">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446638">var</span>&nbsp;<span class="op" id="5446642">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446646">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446657">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446666">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5446677">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446685">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5446696">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446703">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446714">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446719">lastRepeat</span>&nbsp;<span class="builtintype" id="5446730">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446741">p</span><span class="op" id="5446742">.</span><span class="ident" id="5446743">flags</span>&nbsp;<span class="op" id="5446749">=</span>&nbsp;<span class="ident" id="5446751">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446758">p</span><span class="op" id="5446759">.</span><span class="ident" id="5446760">wholeRegexp</span>&nbsp;<span class="op" id="5446772">=</span>&nbsp;<span class="ident" id="5446774">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446777">t</span>&nbsp;<span class="op" id="5446779">:=</span>&nbsp;<span class="ident" id="5446782">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446785">for</span>&nbsp;<span class="ident" id="5446789">t</span>&nbsp;<span class="op" id="5446791">!=</span>&nbsp;<span class="string" id="5446794">&#34;&#34;</span>&nbsp;<span class="op" id="5446797">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446801">repeat</span>&nbsp;<span class="op" id="5446808">:=</span>&nbsp;<span class="string" id="5446811">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446815">BigSwitch</span><span class="op" id="5446824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446828">switch</span>&nbsp;<span class="ident" id="5446835">t</span><span class="op" id="5446836">[</span><span class="num" id="5446837">0</span><span class="op" id="5446838">]</span>&nbsp;<span class="op" id="5446840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446844">default</span><span class="op" id="5446851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446856">if</span>&nbsp;<span class="ident" id="5446859">c</span><span class="op" id="5446860">,</span>&nbsp;<span class="ident" id="5446862">t</span><span class="op" id="5446863">,</span>&nbsp;<span class="ident" id="5446865">err</span>&nbsp;<span class="op" id="5446869">=</span>&nbsp;<span class="ident" id="5446871">nextRune</span><span class="op" id="5446879">(</span><span class="ident" id="5446880">t</span><span class="op" id="5446881">)</span><span class="op" id="5446882">;</span>&nbsp;<span class="ident" id="5446884">err</span>&nbsp;<span class="op" id="5446888">!=</span>&nbsp;<span class="ident" id="5446891">nil</span>&nbsp;<span class="op" id="5446895">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446901">return</span>&nbsp;<span class="ident" id="5446908">nil</span><span class="op" id="5446911">,</span>&nbsp;<span class="ident" id="5446913">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446925">p</span><span class="op" id="5446926">.</span><span class="ident" id="5446927">literal</span><span class="op" id="5446934">(</span><span class="ident" id="5446935">c</span><span class="op" id="5446936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446941">case</span>&nbsp;<span class="string" id="5446946">&#39;(&#39;</span><span class="op" id="5446949">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5446954">if</span>&nbsp;<span class="ident" id="5446957">p</span><span class="op" id="5446958">.</span><span class="ident" id="5446959">flags</span><span class="op" id="5446964">&amp;</span><span class="ident" id="5446965">PerlX</span>&nbsp;<span class="op" id="5446971">!=</span>&nbsp;<span class="num" id="5446974">0</span>&nbsp;<span class="op" id="5446976">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5446979">len</span><span class="op" id="5446982">(</span><span class="ident" id="5446983">t</span><span class="op" id="5446984">)</span>&nbsp;<span class="op" id="5446986">&gt;=</span>&nbsp;<span class="num" id="5446989">2</span>&nbsp;<span class="op" id="5446991">&amp;&amp;</span>&nbsp;<span class="ident" id="5446994">t</span><span class="op" id="5446995">[</span><span class="num" id="5446996">1</span><span class="op" id="5446997">]</span>&nbsp;<span class="op" id="5446999">==</span>&nbsp;<span class="string" id="5447002">&#39;?&#39;</span>&nbsp;<span class="op" id="5447006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5447012">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447058">if</span>&nbsp;<span class="ident" id="5447061">t</span><span class="op" id="5447062">,</span>&nbsp;<span class="ident" id="5447064">err</span>&nbsp;<span class="op" id="5447068">=</span>&nbsp;<span class="ident" id="5447070">p</span><span class="op" id="5447071">.</span><span class="ident" id="5447072">parsePerlFlags</span><span class="op" id="5447086">(</span><span class="ident" id="5447087">t</span><span class="op" id="5447088">)</span><span class="op" id="5447089">;</span>&nbsp;<span class="ident" id="5447091">err</span>&nbsp;<span class="op" id="5447095">!=</span>&nbsp;<span class="ident" id="5447098">nil</span>&nbsp;<span class="op" id="5447102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447109">return</span>&nbsp;<span class="ident" id="5447116">nil</span><span class="op" id="5447119">,</span>&nbsp;<span class="ident" id="5447121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447129">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447135">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447149">p</span><span class="op" id="5447150">.</span><span class="ident" id="5447151">numCap</span><span class="op" id="5447157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447163">p</span><span class="op" id="5447164">.</span><span class="ident" id="5447165">op</span><span class="op" id="5447167">(</span><span class="ident" id="5447168">opLeftParen</span><span class="op" id="5447179">)</span><span class="op" id="5447180">.</span><span class="ident" id="5447181">Cap</span>&nbsp;<span class="op" id="5447185">=</span>&nbsp;<span class="ident" id="5447187">p</span><span class="op" id="5447188">.</span><span class="ident" id="5447189">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447199">t</span>&nbsp;<span class="op" id="5447201">=</span>&nbsp;<span class="ident" id="5447203">t</span><span class="op" id="5447204">[</span><span class="num" id="5447205">1</span><span class="op" id="5447206">:</span><span class="op" id="5447207">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447211">case</span>&nbsp;<span class="string" id="5447216">&#39;|&#39;</span><span class="op" id="5447219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447224">if</span>&nbsp;<span class="ident" id="5447227">err</span>&nbsp;<span class="op" id="5447231">=</span>&nbsp;<span class="ident" id="5447233">p</span><span class="op" id="5447234">.</span><span class="ident" id="5447235">parseVerticalBar</span><span class="op" id="5447251">(</span><span class="op" id="5447252">)</span><span class="op" id="5447253">;</span>&nbsp;<span class="ident" id="5447255">err</span>&nbsp;<span class="op" id="5447259">!=</span>&nbsp;<span class="ident" id="5447262">nil</span>&nbsp;<span class="op" id="5447266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447272">return</span>&nbsp;<span class="ident" id="5447279">nil</span><span class="op" id="5447282">,</span>&nbsp;<span class="ident" id="5447284">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447296">t</span>&nbsp;<span class="op" id="5447298">=</span>&nbsp;<span class="ident" id="5447300">t</span><span class="op" id="5447301">[</span><span class="num" id="5447302">1</span><span class="op" id="5447303">:</span><span class="op" id="5447304">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447308">case</span>&nbsp;<span class="string" id="5447313">&#39;)&#39;</span><span class="op" id="5447316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447321">if</span>&nbsp;<span class="ident" id="5447324">err</span>&nbsp;<span class="op" id="5447328">=</span>&nbsp;<span class="ident" id="5447330">p</span><span class="op" id="5447331">.</span><span class="ident" id="5447332">parseRightParen</span><span class="op" id="5447347">(</span><span class="op" id="5447348">)</span><span class="op" id="5447349">;</span>&nbsp;<span class="ident" id="5447351">err</span>&nbsp;<span class="op" id="5447355">!=</span>&nbsp;<span class="ident" id="5447358">nil</span>&nbsp;<span class="op" id="5447362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447368">return</span>&nbsp;<span class="ident" id="5447375">nil</span><span class="op" id="5447378">,</span>&nbsp;<span class="ident" id="5447380">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447392">t</span>&nbsp;<span class="op" id="5447394">=</span>&nbsp;<span class="ident" id="5447396">t</span><span class="op" id="5447397">[</span><span class="num" id="5447398">1</span><span class="op" id="5447399">:</span><span class="op" id="5447400">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447404">case</span>&nbsp;<span class="string" id="5447409">&#39;^&#39;</span><span class="op" id="5447412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447417">if</span>&nbsp;<span class="ident" id="5447420">p</span><span class="op" id="5447421">.</span><span class="ident" id="5447422">flags</span><span class="op" id="5447427">&amp;</span><span class="ident" id="5447428">OneLine</span>&nbsp;<span class="op" id="5447436">!=</span>&nbsp;<span class="num" id="5447439">0</span>&nbsp;<span class="op" id="5447441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447447">p</span><span class="op" id="5447448">.</span><span class="ident" id="5447449">op</span><span class="op" id="5447451">(</span><span class="ident" id="5447452">OpBeginText</span><span class="op" id="5447463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447468">}</span>&nbsp;<span class="keyword" id="5447470">else</span>&nbsp;<span class="op" id="5447475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447481">p</span><span class="op" id="5447482">.</span><span class="ident" id="5447483">op</span><span class="op" id="5447485">(</span><span class="ident" id="5447486">OpBeginLine</span><span class="op" id="5447497">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447507">t</span>&nbsp;<span class="op" id="5447509">=</span>&nbsp;<span class="ident" id="5447511">t</span><span class="op" id="5447512">[</span><span class="num" id="5447513">1</span><span class="op" id="5447514">:</span><span class="op" id="5447515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447519">case</span>&nbsp;<span class="string" id="5447524">&#39;$&#39;</span><span class="op" id="5447527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447532">if</span>&nbsp;<span class="ident" id="5447535">p</span><span class="op" id="5447536">.</span><span class="ident" id="5447537">flags</span><span class="op" id="5447542">&amp;</span><span class="ident" id="5447543">OneLine</span>&nbsp;<span class="op" id="5447551">!=</span>&nbsp;<span class="num" id="5447554">0</span>&nbsp;<span class="op" id="5447556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447562">p</span><span class="op" id="5447563">.</span><span class="ident" id="5447564">op</span><span class="op" id="5447566">(</span><span class="ident" id="5447567">OpEndText</span><span class="op" id="5447576">)</span><span class="op" id="5447577">.</span><span class="ident" id="5447578">Flags</span>&nbsp;<span class="op" id="5447584">|=</span>&nbsp;<span class="ident" id="5447587">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447600">}</span>&nbsp;<span class="keyword" id="5447602">else</span>&nbsp;<span class="op" id="5447607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447613">p</span><span class="op" id="5447614">.</span><span class="ident" id="5447615">op</span><span class="op" id="5447617">(</span><span class="ident" id="5447618">OpEndLine</span><span class="op" id="5447627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447637">t</span>&nbsp;<span class="op" id="5447639">=</span>&nbsp;<span class="ident" id="5447641">t</span><span class="op" id="5447642">[</span><span class="num" id="5447643">1</span><span class="op" id="5447644">:</span><span class="op" id="5447645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447649">case</span>&nbsp;<span class="string" id="5447654">&#39;.&#39;</span><span class="op" id="5447657">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447662">if</span>&nbsp;<span class="ident" id="5447665">p</span><span class="op" id="5447666">.</span><span class="ident" id="5447667">flags</span><span class="op" id="5447672">&amp;</span><span class="ident" id="5447673">DotNL</span>&nbsp;<span class="op" id="5447679">!=</span>&nbsp;<span class="num" id="5447682">0</span>&nbsp;<span class="op" id="5447684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447690">p</span><span class="op" id="5447691">.</span><span class="ident" id="5447692">op</span><span class="op" id="5447694">(</span><span class="ident" id="5447695">OpAnyChar</span><span class="op" id="5447704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447709">}</span>&nbsp;<span class="keyword" id="5447711">else</span>&nbsp;<span class="op" id="5447716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447722">p</span><span class="op" id="5447723">.</span><span class="ident" id="5447724">op</span><span class="op" id="5447726">(</span><span class="ident" id="5447727">OpAnyCharNotNL</span><span class="op" id="5447741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447746">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447751">t</span>&nbsp;<span class="op" id="5447753">=</span>&nbsp;<span class="ident" id="5447755">t</span><span class="op" id="5447756">[</span><span class="num" id="5447757">1</span><span class="op" id="5447758">:</span><span class="op" id="5447759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447763">case</span>&nbsp;<span class="string" id="5447768">&#39;[&#39;</span><span class="op" id="5447771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447776">if</span>&nbsp;<span class="ident" id="5447779">t</span><span class="op" id="5447780">,</span>&nbsp;<span class="ident" id="5447782">err</span>&nbsp;<span class="op" id="5447786">=</span>&nbsp;<span class="ident" id="5447788">p</span><span class="op" id="5447789">.</span><span class="ident" id="5447790">parseClass</span><span class="op" id="5447800">(</span><span class="ident" id="5447801">t</span><span class="op" id="5447802">)</span><span class="op" id="5447803">;</span>&nbsp;<span class="ident" id="5447805">err</span>&nbsp;<span class="op" id="5447809">!=</span>&nbsp;<span class="ident" id="5447812">nil</span>&nbsp;<span class="op" id="5447816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447822">return</span>&nbsp;<span class="ident" id="5447829">nil</span><span class="op" id="5447832">,</span>&nbsp;<span class="ident" id="5447834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447841">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447845">case</span>&nbsp;<span class="string" id="5447850">&#39;*&#39;</span><span class="op" id="5447853">,</span>&nbsp;<span class="string" id="5447855">&#39;+&#39;</span><span class="op" id="5447858">,</span>&nbsp;<span class="string" id="5447860">&#39;?&#39;</span><span class="op" id="5447863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447868">before</span>&nbsp;<span class="op" id="5447875">:=</span>&nbsp;<span class="ident" id="5447878">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447883">switch</span>&nbsp;<span class="ident" id="5447890">t</span><span class="op" id="5447891">[</span><span class="num" id="5447892">0</span><span class="op" id="5447893">]</span>&nbsp;<span class="op" id="5447895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447900">case</span>&nbsp;<span class="string" id="5447905">&#39;*&#39;</span><span class="op" id="5447908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447914">op</span>&nbsp;<span class="op" id="5447917">=</span>&nbsp;<span class="ident" id="5447919">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447929">case</span>&nbsp;<span class="string" id="5447934">&#39;+&#39;</span><span class="op" id="5447937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447943">op</span>&nbsp;<span class="op" id="5447946">=</span>&nbsp;<span class="ident" id="5447948">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5447958">case</span>&nbsp;<span class="string" id="5447963">&#39;?&#39;</span><span class="op" id="5447966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447972">op</span>&nbsp;<span class="op" id="5447975">=</span>&nbsp;<span class="ident" id="5447977">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5447988">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447993">after</span>&nbsp;<span class="op" id="5447999">:=</span>&nbsp;<span class="ident" id="5448002">t</span><span class="op" id="5448003">[</span><span class="num" id="5448004">1</span><span class="op" id="5448005">:</span><span class="op" id="5448006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448011">if</span>&nbsp;<span class="ident" id="5448014">after</span><span class="op" id="5448019">,</span>&nbsp;<span class="ident" id="5448021">err</span>&nbsp;<span class="op" id="5448025">=</span>&nbsp;<span class="ident" id="5448027">p</span><span class="op" id="5448028">.</span><span class="ident" id="5448029">repeat</span><span class="op" id="5448035">(</span><span class="ident" id="5448036">op</span><span class="op" id="5448038">,</span>&nbsp;<span class="num" id="5448040">0</span><span class="op" id="5448041">,</span>&nbsp;<span class="num" id="5448043">0</span><span class="op" id="5448044">,</span>&nbsp;<span class="ident" id="5448046">before</span><span class="op" id="5448052">,</span>&nbsp;<span class="ident" id="5448054">after</span><span class="op" id="5448059">,</span>&nbsp;<span class="ident" id="5448061">lastRepeat</span><span class="op" id="5448071">)</span><span class="op" id="5448072">;</span>&nbsp;<span class="ident" id="5448074">err</span>&nbsp;<span class="op" id="5448078">!=</span>&nbsp;<span class="ident" id="5448081">nil</span>&nbsp;<span class="op" id="5448085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448091">return</span>&nbsp;<span class="ident" id="5448098">nil</span><span class="op" id="5448101">,</span>&nbsp;<span class="ident" id="5448103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448115">repeat</span>&nbsp;<span class="op" id="5448122">=</span>&nbsp;<span class="ident" id="5448124">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448134">t</span>&nbsp;<span class="op" id="5448136">=</span>&nbsp;<span class="ident" id="5448138">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448146">case</span>&nbsp;<span class="string" id="5448151">&#39;{&#39;</span><span class="op" id="5448154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448159">op</span>&nbsp;<span class="op" id="5448162">=</span>&nbsp;<span class="ident" id="5448164">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448176">before</span>&nbsp;<span class="op" id="5448183">:=</span>&nbsp;<span class="ident" id="5448186">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448191">min</span><span class="op" id="5448194">,</span>&nbsp;<span class="ident" id="5448196">max</span><span class="op" id="5448199">,</span>&nbsp;<span class="ident" id="5448201">after</span><span class="op" id="5448206">,</span>&nbsp;<span class="ident" id="5448208">ok</span>&nbsp;<span class="op" id="5448211">:=</span>&nbsp;<span class="ident" id="5448214">p</span><span class="op" id="5448215">.</span><span class="ident" id="5448216">parseRepeat</span><span class="op" id="5448227">(</span><span class="ident" id="5448228">t</span><span class="op" id="5448229">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448234">if</span>&nbsp;<span class="op" id="5448237">!</span><span class="ident" id="5448238">ok</span>&nbsp;<span class="op" id="5448241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448247">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448302">p</span><span class="op" id="5448303">.</span><span class="ident" id="5448304">literal</span><span class="op" id="5448311">(</span><span class="string" id="5448312">&#39;{&#39;</span><span class="op" id="5448315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448321">t</span>&nbsp;<span class="op" id="5448323">=</span>&nbsp;<span class="ident" id="5448325">t</span><span class="op" id="5448326">[</span><span class="num" id="5448327">1</span><span class="op" id="5448328">:</span><span class="op" id="5448329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448335">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448349">if</span>&nbsp;<span class="ident" id="5448352">min</span>&nbsp;<span class="op" id="5448356">&lt;</span>&nbsp;<span class="num" id="5448358">0</span>&nbsp;<span class="op" id="5448360">||</span>&nbsp;<span class="ident" id="5448363">min</span>&nbsp;<span class="op" id="5448367">&gt;</span>&nbsp;<span class="num" id="5448369">1000</span>&nbsp;<span class="op" id="5448374">||</span>&nbsp;<span class="ident" id="5448377">max</span>&nbsp;<span class="op" id="5448381">&gt;</span>&nbsp;<span class="num" id="5448383">1000</span>&nbsp;<span class="op" id="5448388">||</span>&nbsp;<span class="ident" id="5448391">max</span>&nbsp;<span class="op" id="5448395">&gt;=</span>&nbsp;<span class="num" id="5448398">0</span>&nbsp;<span class="op" id="5448400">&amp;&amp;</span>&nbsp;<span class="ident" id="5448403">min</span>&nbsp;<span class="op" id="5448407">&gt;</span>&nbsp;<span class="ident" id="5448409">max</span>&nbsp;<span class="op" id="5448413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448419">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448481">return</span>&nbsp;<span class="ident" id="5448488">nil</span><span class="op" id="5448491">,</span>&nbsp;<span class="op" id="5448493">&amp;</span><span class="ident" id="5448494">Error</span><span class="op" id="5448499">{</span><span class="ident" id="5448500">ErrInvalidRepeatSize</span><span class="op" id="5448520">,</span>&nbsp;<span class="ident" id="5448522">before</span><span class="op" id="5448528">[</span><span class="op" id="5448529">:</span><span class="builtinfunc" id="5448530">len</span><span class="op" id="5448533">(</span><span class="ident" id="5448534">before</span><span class="op" id="5448540">)</span><span class="op" id="5448541">-</span><span class="builtinfunc" id="5448542">len</span><span class="op" id="5448545">(</span><span class="ident" id="5448546">after</span><span class="op" id="5448551">)</span><span class="op" id="5448552">]</span><span class="op" id="5448553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448558">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448563">if</span>&nbsp;<span class="ident" id="5448566">after</span><span class="op" id="5448571">,</span>&nbsp;<span class="ident" id="5448573">err</span>&nbsp;<span class="op" id="5448577">=</span>&nbsp;<span class="ident" id="5448579">p</span><span class="op" id="5448580">.</span><span class="ident" id="5448581">repeat</span><span class="op" id="5448587">(</span><span class="ident" id="5448588">op</span><span class="op" id="5448590">,</span>&nbsp;<span class="ident" id="5448592">min</span><span class="op" id="5448595">,</span>&nbsp;<span class="ident" id="5448597">max</span><span class="op" id="5448600">,</span>&nbsp;<span class="ident" id="5448602">before</span><span class="op" id="5448608">,</span>&nbsp;<span class="ident" id="5448610">after</span><span class="op" id="5448615">,</span>&nbsp;<span class="ident" id="5448617">lastRepeat</span><span class="op" id="5448627">)</span><span class="op" id="5448628">;</span>&nbsp;<span class="ident" id="5448630">err</span>&nbsp;<span class="op" id="5448634">!=</span>&nbsp;<span class="ident" id="5448637">nil</span>&nbsp;<span class="op" id="5448641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448647">return</span>&nbsp;<span class="ident" id="5448654">nil</span><span class="op" id="5448657">,</span>&nbsp;<span class="ident" id="5448659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448671">repeat</span>&nbsp;<span class="op" id="5448678">=</span>&nbsp;<span class="ident" id="5448680">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448690">t</span>&nbsp;<span class="op" id="5448692">=</span>&nbsp;<span class="ident" id="5448694">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448702">case</span>&nbsp;<span class="string" id="5448707">&#39;\\&#39;</span><span class="op" id="5448711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448716">if</span>&nbsp;<span class="ident" id="5448719">p</span><span class="op" id="5448720">.</span><span class="ident" id="5448721">flags</span><span class="op" id="5448726">&amp;</span><span class="ident" id="5448727">PerlX</span>&nbsp;<span class="op" id="5448733">!=</span>&nbsp;<span class="num" id="5448736">0</span>&nbsp;<span class="op" id="5448738">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5448741">len</span><span class="op" id="5448744">(</span><span class="ident" id="5448745">t</span><span class="op" id="5448746">)</span>&nbsp;<span class="op" id="5448748">&gt;=</span>&nbsp;<span class="num" id="5448751">2</span>&nbsp;<span class="op" id="5448753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448759">switch</span>&nbsp;<span class="ident" id="5448766">t</span><span class="op" id="5448767">[</span><span class="num" id="5448768">1</span><span class="op" id="5448769">]</span>&nbsp;<span class="op" id="5448771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448777">case</span>&nbsp;<span class="string" id="5448782">&#39;A&#39;</span><span class="op" id="5448785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448792">p</span><span class="op" id="5448793">.</span><span class="ident" id="5448794">op</span><span class="op" id="5448796">(</span><span class="ident" id="5448797">OpBeginText</span><span class="op" id="5448808">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448815">t</span>&nbsp;<span class="op" id="5448817">=</span>&nbsp;<span class="ident" id="5448819">t</span><span class="op" id="5448820">[</span><span class="num" id="5448821">2</span><span class="op" id="5448822">:</span><span class="op" id="5448823">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448830">break</span>&nbsp;<span class="ident" id="5448836">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448850">case</span>&nbsp;<span class="string" id="5448855">&#39;b&#39;</span><span class="op" id="5448858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448865">p</span><span class="op" id="5448866">.</span><span class="ident" id="5448867">op</span><span class="op" id="5448869">(</span><span class="ident" id="5448870">OpWordBoundary</span><span class="op" id="5448884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448891">t</span>&nbsp;<span class="op" id="5448893">=</span>&nbsp;<span class="ident" id="5448895">t</span><span class="op" id="5448896">[</span><span class="num" id="5448897">2</span><span class="op" id="5448898">:</span><span class="op" id="5448899">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448906">break</span>&nbsp;<span class="ident" id="5448912">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448926">case</span>&nbsp;<span class="string" id="5448931">&#39;B&#39;</span><span class="op" id="5448934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448941">p</span><span class="op" id="5448942">.</span><span class="ident" id="5448943">op</span><span class="op" id="5448945">(</span><span class="ident" id="5448946">OpNoWordBoundary</span><span class="op" id="5448962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448969">t</span>&nbsp;<span class="op" id="5448971">=</span>&nbsp;<span class="ident" id="5448973">t</span><span class="op" id="5448974">[</span><span class="num" id="5448975">2</span><span class="op" id="5448976">:</span><span class="op" id="5448977">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448984">break</span>&nbsp;<span class="ident" id="5448990">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449004">case</span>&nbsp;<span class="string" id="5449009">&#39;C&#39;</span><span class="op" id="5449012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449019">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449051">return</span>&nbsp;<span class="ident" id="5449058">nil</span><span class="op" id="5449061">,</span>&nbsp;<span class="op" id="5449063">&amp;</span><span class="ident" id="5449064">Error</span><span class="op" id="5449069">{</span><span class="ident" id="5449070">ErrInvalidEscape</span><span class="op" id="5449086">,</span>&nbsp;<span class="ident" id="5449088">t</span><span class="op" id="5449089">[</span><span class="op" id="5449090">:</span><span class="num" id="5449091">2</span><span class="op" id="5449092">]</span><span class="op" id="5449093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449099">case</span>&nbsp;<span class="string" id="5449104">&#39;Q&#39;</span><span class="op" id="5449107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449114">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449160">var</span>&nbsp;<span class="ident" id="5449164">lit</span>&nbsp;<span class="builtintype" id="5449168">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449180">if</span>&nbsp;<span class="ident" id="5449183">i</span>&nbsp;<span class="op" id="5449185">:=</span>&nbsp;<span class="ident" id="5449188">strings</span><span class="op" id="5449195">.</span><span class="ident" id="5449196">Index</span><span class="op" id="5449201">(</span><span class="ident" id="5449202">t</span><span class="op" id="5449203">,</span>&nbsp;<span class="string" id="5449205">`\E`</span><span class="op" id="5449209">)</span><span class="op" id="5449210">;</span>&nbsp;<span class="ident" id="5449212">i</span>&nbsp;<span class="op" id="5449214">&lt;</span>&nbsp;<span class="num" id="5449216">0</span>&nbsp;<span class="op" id="5449218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449226">lit</span>&nbsp;<span class="op" id="5449230">=</span>&nbsp;<span class="ident" id="5449232">t</span><span class="op" id="5449233">[</span><span class="num" id="5449234">2</span><span class="op" id="5449235">:</span><span class="op" id="5449236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449244">t</span>&nbsp;<span class="op" id="5449246">=</span>&nbsp;<span class="string" id="5449248">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449256">}</span>&nbsp;<span class="keyword" id="5449258">else</span>&nbsp;<span class="op" id="5449263">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449271">lit</span>&nbsp;<span class="op" id="5449275">=</span>&nbsp;<span class="ident" id="5449277">t</span><span class="op" id="5449278">[</span><span class="num" id="5449279">2</span><span class="op" id="5449280">:</span><span class="ident" id="5449281">i</span><span class="op" id="5449282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449290">t</span>&nbsp;<span class="op" id="5449292">=</span>&nbsp;<span class="ident" id="5449294">t</span><span class="op" id="5449295">[</span><span class="ident" id="5449296">i</span><span class="op" id="5449297">+</span><span class="num" id="5449298">2</span><span class="op" id="5449299">:</span><span class="op" id="5449300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449314">p</span><span class="op" id="5449315">.</span><span class="ident" id="5449316">push</span><span class="op" id="5449320">(</span><span class="ident" id="5449321">literalRegexp</span><span class="op" id="5449334">(</span><span class="ident" id="5449335">lit</span><span class="op" id="5449338">,</span>&nbsp;<span class="ident" id="5449340">p</span><span class="op" id="5449341">.</span><span class="ident" id="5449342">flags</span><span class="op" id="5449347">)</span><span class="op" id="5449348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449355">break</span>&nbsp;<span class="ident" id="5449361">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449375">case</span>&nbsp;<span class="string" id="5449380">&#39;z&#39;</span><span class="op" id="5449383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449390">p</span><span class="op" id="5449391">.</span><span class="ident" id="5449392">op</span><span class="op" id="5449394">(</span><span class="ident" id="5449395">OpEndText</span><span class="op" id="5449404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449411">t</span>&nbsp;<span class="op" id="5449413">=</span>&nbsp;<span class="ident" id="5449415">t</span><span class="op" id="5449416">[</span><span class="num" id="5449417">2</span><span class="op" id="5449418">:</span><span class="op" id="5449419">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449426">break</span>&nbsp;<span class="ident" id="5449432">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449446">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449457">re</span>&nbsp;<span class="op" id="5449460">:=</span>&nbsp;<span class="ident" id="5449463">p</span><span class="op" id="5449464">.</span><span class="ident" id="5449465">newRegexp</span><span class="op" id="5449474">(</span><span class="ident" id="5449475">OpCharClass</span><span class="op" id="5449486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449491">re</span><span class="op" id="5449493">.</span><span class="ident" id="5449494">Flags</span>&nbsp;<span class="op" id="5449500">=</span>&nbsp;<span class="ident" id="5449502">p</span><span class="op" id="5449503">.</span><span class="ident" id="5449504">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449514">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449566">if</span>&nbsp;<span class="builtinfunc" id="5449569">len</span><span class="op" id="5449572">(</span><span class="ident" id="5449573">t</span><span class="op" id="5449574">)</span>&nbsp;<span class="op" id="5449576">&gt;=</span>&nbsp;<span class="num" id="5449579">2</span>&nbsp;<span class="op" id="5449581">&amp;&amp;</span>&nbsp;<span class="op" id="5449584">(</span><span class="ident" id="5449585">t</span><span class="op" id="5449586">[</span><span class="num" id="5449587">1</span><span class="op" id="5449588">]</span>&nbsp;<span class="op" id="5449590">==</span>&nbsp;<span class="string" id="5449593">&#39;p&#39;</span>&nbsp;<span class="op" id="5449597">||</span>&nbsp;<span class="ident" id="5449600">t</span><span class="op" id="5449601">[</span><span class="num" id="5449602">1</span><span class="op" id="5449603">]</span>&nbsp;<span class="op" id="5449605">==</span>&nbsp;<span class="string" id="5449608">&#39;P&#39;</span><span class="op" id="5449611">)</span>&nbsp;<span class="op" id="5449613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449619">r</span><span class="op" id="5449620">,</span>&nbsp;<span class="ident" id="5449622">rest</span><span class="op" id="5449626">,</span>&nbsp;<span class="ident" id="5449628">err</span>&nbsp;<span class="op" id="5449632">:=</span>&nbsp;<span class="ident" id="5449635">p</span><span class="op" id="5449636">.</span><span class="ident" id="5449637">parseUnicodeClass</span><span class="op" id="5449654">(</span><span class="ident" id="5449655">t</span><span class="op" id="5449656">,</span>&nbsp;<span class="ident" id="5449658">re</span><span class="op" id="5449660">.</span><span class="ident" id="5449661">Rune0</span><span class="op" id="5449666">[</span><span class="op" id="5449667">:</span><span class="num" id="5449668">0</span><span class="op" id="5449669">]</span><span class="op" id="5449670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449676">if</span>&nbsp;<span class="ident" id="5449679">err</span>&nbsp;<span class="op" id="5449683">!=</span>&nbsp;<span class="ident" id="5449686">nil</span>&nbsp;<span class="op" id="5449690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449697">return</span>&nbsp;<span class="ident" id="5449704">nil</span><span class="op" id="5449707">,</span>&nbsp;<span class="ident" id="5449709">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449723">if</span>&nbsp;<span class="ident" id="5449726">r</span>&nbsp;<span class="op" id="5449728">!=</span>&nbsp;<span class="ident" id="5449731">nil</span>&nbsp;<span class="op" id="5449735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449742">re</span><span class="op" id="5449744">.</span><span class="ident" id="5449745">Rune</span>&nbsp;<span class="op" id="5449750">=</span>&nbsp;<span class="ident" id="5449752">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449759">t</span>&nbsp;<span class="op" id="5449761">=</span>&nbsp;<span class="ident" id="5449763">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449773">p</span><span class="op" id="5449774">.</span><span class="ident" id="5449775">push</span><span class="op" id="5449779">(</span><span class="ident" id="5449780">re</span><span class="op" id="5449782">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449789">break</span>&nbsp;<span class="ident" id="5449795">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5449820">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449855">if</span>&nbsp;<span class="ident" id="5449858">r</span><span class="op" id="5449859">,</span>&nbsp;<span class="ident" id="5449861">rest</span>&nbsp;<span class="op" id="5449866">:=</span>&nbsp;<span class="ident" id="5449869">p</span><span class="op" id="5449870">.</span><span class="ident" id="5449871">parsePerlClassEscape</span><span class="op" id="5449891">(</span><span class="ident" id="5449892">t</span><span class="op" id="5449893">,</span>&nbsp;<span class="ident" id="5449895">re</span><span class="op" id="5449897">.</span><span class="ident" id="5449898">Rune0</span><span class="op" id="5449903">[</span><span class="op" id="5449904">:</span><span class="num" id="5449905">0</span><span class="op" id="5449906">]</span><span class="op" id="5449907">)</span><span class="op" id="5449908">;</span>&nbsp;<span class="ident" id="5449910">r</span>&nbsp;<span class="op" id="5449912">!=</span>&nbsp;<span class="ident" id="5449915">nil</span>&nbsp;<span class="op" id="5449919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449925">re</span><span class="op" id="5449927">.</span><span class="ident" id="5449928">Rune</span>&nbsp;<span class="op" id="5449933">=</span>&nbsp;<span class="ident" id="5449935">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449941">t</span>&nbsp;<span class="op" id="5449943">=</span>&nbsp;<span class="ident" id="5449945">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449954">p</span><span class="op" id="5449955">.</span><span class="ident" id="5449956">push</span><span class="op" id="5449960">(</span><span class="ident" id="5449961">re</span><span class="op" id="5449963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449969">break</span>&nbsp;<span class="ident" id="5449975">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449993">p</span><span class="op" id="5449994">.</span><span class="ident" id="5449995">reuse</span><span class="op" id="5450000">(</span><span class="ident" id="5450001">re</span><span class="op" id="5450003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450009">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450049">if</span>&nbsp;<span class="ident" id="5450052">c</span><span class="op" id="5450053">,</span>&nbsp;<span class="ident" id="5450055">t</span><span class="op" id="5450056">,</span>&nbsp;<span class="ident" id="5450058">err</span>&nbsp;<span class="op" id="5450062">=</span>&nbsp;<span class="ident" id="5450064">p</span><span class="op" id="5450065">.</span><span class="ident" id="5450066">parseEscape</span><span class="op" id="5450077">(</span><span class="ident" id="5450078">t</span><span class="op" id="5450079">)</span><span class="op" id="5450080">;</span>&nbsp;<span class="ident" id="5450082">err</span>&nbsp;<span class="op" id="5450086">!=</span>&nbsp;<span class="ident" id="5450089">nil</span>&nbsp;<span class="op" id="5450093">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450099">return</span>&nbsp;<span class="ident" id="5450106">nil</span><span class="op" id="5450109">,</span>&nbsp;<span class="ident" id="5450111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450123">p</span><span class="op" id="5450124">.</span><span class="ident" id="5450125">literal</span><span class="op" id="5450132">(</span><span class="ident" id="5450133">c</span><span class="op" id="5450134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450142">lastRepeat</span>&nbsp;<span class="op" id="5450153">=</span>&nbsp;<span class="ident" id="5450155">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450167">p</span><span class="op" id="5450168">.</span><span class="ident" id="5450169">concat</span><span class="op" id="5450175">(</span><span class="op" id="5450176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450179">if</span>&nbsp;<span class="ident" id="5450182">p</span><span class="op" id="5450183">.</span><span class="ident" id="5450184">swapVerticalBar</span><span class="op" id="5450199">(</span><span class="op" id="5450200">)</span>&nbsp;<span class="op" id="5450202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450206">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450228">p</span><span class="op" id="5450229">.</span><span class="ident" id="5450230">stack</span>&nbsp;<span class="op" id="5450236">=</span>&nbsp;<span class="ident" id="5450238">p</span><span class="op" id="5450239">.</span><span class="ident" id="5450240">stack</span><span class="op" id="5450245">[</span><span class="op" id="5450246">:</span><span class="builtinfunc" id="5450247">len</span><span class="op" id="5450250">(</span><span class="ident" id="5450251">p</span><span class="op" id="5450252">.</span><span class="ident" id="5450253">stack</span><span class="op" id="5450258">)</span><span class="op" id="5450259">-</span><span class="num" id="5450260">1</span><span class="op" id="5450261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450267">p</span><span class="op" id="5450268">.</span><span class="ident" id="5450269">alternate</span><span class="op" id="5450278">(</span><span class="op" id="5450279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450283">n</span>&nbsp;<span class="op" id="5450285">:=</span>&nbsp;<span class="builtinfunc" id="5450288">len</span><span class="op" id="5450291">(</span><span class="ident" id="5450292">p</span><span class="op" id="5450293">.</span><span class="ident" id="5450294">stack</span><span class="op" id="5450299">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450302">if</span>&nbsp;<span class="ident" id="5450305">n</span>&nbsp;<span class="op" id="5450307">!=</span>&nbsp;<span class="num" id="5450310">1</span>&nbsp;<span class="op" id="5450312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450316">return</span>&nbsp;<span class="ident" id="5450323">nil</span><span class="op" id="5450326">,</span>&nbsp;<span class="op" id="5450328">&amp;</span><span class="ident" id="5450329">Error</span><span class="op" id="5450334">{</span><span class="ident" id="5450335">ErrMissingParen</span><span class="op" id="5450350">,</span>&nbsp;<span class="ident" id="5450352">s</span><span class="op" id="5450353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450359">return</span>&nbsp;<span class="ident" id="5450366">p</span><span class="op" id="5450367">.</span><span class="ident" id="5450368">stack</span><span class="op" id="5450373">[</span><span class="num" id="5450374">0</span><span class="op" id="5450375">]</span><span class="op" id="5450376">,</span>&nbsp;<span class="ident" id="5450378">nil</span><br>
<span class="lineno"></span><span class="op" id="5450382">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5450385">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5450456">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5450509">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5450598">func</span>&nbsp;<span class="op" id="5450603">(</span><span class="ident" id="5450604">p</span>&nbsp;<span class="op" id="5450606">*</span><span class="ident" id="5450607">parser</span><span class="op" id="5450613">)</span>&nbsp;<span class="ident" id="5450615">parseRepeat</span><span class="op" id="5450626">(</span><span class="ident" id="5450627">s</span>&nbsp;<span class="builtintype" id="5450629">string</span><span class="op" id="5450635">)</span>&nbsp;<span class="op" id="5450637">(</span><span class="ident" id="5450638">min</span><span class="op" id="5450641">,</span>&nbsp;<span class="ident" id="5450643">max</span>&nbsp;<span class="builtintype" id="5450647">int</span><span class="op" id="5450650">,</span>&nbsp;<span class="ident" id="5450652">rest</span>&nbsp;<span class="builtintype" id="5450657">string</span><span class="op" id="5450663">,</span>&nbsp;<span class="ident" id="5450665">ok</span>&nbsp;<span class="builtintype" id="5450668">bool</span><span class="op" id="5450672">)</span>&nbsp;<span class="op" id="5450674">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450677">if</span>&nbsp;<span class="ident" id="5450680">s</span>&nbsp;<span class="op" id="5450682">==</span>&nbsp;<span class="string" id="5450685">&#34;&#34;</span>&nbsp;<span class="op" id="5450688">||</span>&nbsp;<span class="ident" id="5450691">s</span><span class="op" id="5450692">[</span><span class="num" id="5450693">0</span><span class="op" id="5450694">]</span>&nbsp;<span class="op" id="5450696">!=</span>&nbsp;<span class="string" id="5450699">&#39;{&#39;</span>&nbsp;<span class="op" id="5450703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450707">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450718">s</span>&nbsp;<span class="op" id="5450720">=</span>&nbsp;<span class="ident" id="5450722">s</span><span class="op" id="5450723">[</span><span class="num" id="5450724">1</span><span class="op" id="5450725">:</span><span class="op" id="5450726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450729">var</span>&nbsp;<span class="ident" id="5450733">ok1</span>&nbsp;<span class="builtintype" id="5450737">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450743">if</span>&nbsp;<span class="ident" id="5450746">min</span><span class="op" id="5450749">,</span>&nbsp;<span class="ident" id="5450751">s</span><span class="op" id="5450752">,</span>&nbsp;<span class="ident" id="5450754">ok1</span>&nbsp;<span class="op" id="5450758">=</span>&nbsp;<span class="ident" id="5450760">p</span><span class="op" id="5450761">.</span><span class="ident" id="5450762">parseInt</span><span class="op" id="5450770">(</span><span class="ident" id="5450771">s</span><span class="op" id="5450772">)</span><span class="op" id="5450773">;</span>&nbsp;<span class="op" id="5450775">!</span><span class="ident" id="5450776">ok1</span>&nbsp;<span class="op" id="5450780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450784">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450795">if</span>&nbsp;<span class="ident" id="5450798">s</span>&nbsp;<span class="op" id="5450800">==</span>&nbsp;<span class="string" id="5450803">&#34;&#34;</span>&nbsp;<span class="op" id="5450806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450810">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450821">if</span>&nbsp;<span class="ident" id="5450824">s</span><span class="op" id="5450825">[</span><span class="num" id="5450826">0</span><span class="op" id="5450827">]</span>&nbsp;<span class="op" id="5450829">!=</span>&nbsp;<span class="string" id="5450832">&#39;,&#39;</span>&nbsp;<span class="op" id="5450836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450840">max</span>&nbsp;<span class="op" id="5450844">=</span>&nbsp;<span class="ident" id="5450846">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450851">}</span>&nbsp;<span class="keyword" id="5450853">else</span>&nbsp;<span class="op" id="5450858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450862">s</span>&nbsp;<span class="op" id="5450864">=</span>&nbsp;<span class="ident" id="5450866">s</span><span class="op" id="5450867">[</span><span class="num" id="5450868">1</span><span class="op" id="5450869">:</span><span class="op" id="5450870">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450874">if</span>&nbsp;<span class="ident" id="5450877">s</span>&nbsp;<span class="op" id="5450879">==</span>&nbsp;<span class="string" id="5450882">&#34;&#34;</span>&nbsp;<span class="op" id="5450885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450903">if</span>&nbsp;<span class="ident" id="5450906">s</span><span class="op" id="5450907">[</span><span class="num" id="5450908">0</span><span class="op" id="5450909">]</span>&nbsp;<span class="op" id="5450911">==</span>&nbsp;<span class="string" id="5450914">&#39;}&#39;</span>&nbsp;<span class="op" id="5450918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450923">max</span>&nbsp;<span class="op" id="5450927">=</span>&nbsp;<span class="op" id="5450929">-</span><span class="num" id="5450930">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450934">}</span>&nbsp;<span class="keyword" id="5450936">else</span>&nbsp;<span class="keyword" id="5450941">if</span>&nbsp;<span class="ident" id="5450944">max</span><span class="op" id="5450947">,</span>&nbsp;<span class="ident" id="5450949">s</span><span class="op" id="5450950">,</span>&nbsp;<span class="ident" id="5450952">ok1</span>&nbsp;<span class="op" id="5450956">=</span>&nbsp;<span class="ident" id="5450958">p</span><span class="op" id="5450959">.</span><span class="ident" id="5450960">parseInt</span><span class="op" id="5450968">(</span><span class="ident" id="5450969">s</span><span class="op" id="5450970">)</span><span class="op" id="5450971">;</span>&nbsp;<span class="op" id="5450973">!</span><span class="ident" id="5450974">ok1</span>&nbsp;<span class="op" id="5450978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450983">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450992">}</span>&nbsp;<span class="keyword" id="5450994">else</span>&nbsp;<span class="keyword" id="5450999">if</span>&nbsp;<span class="ident" id="5451002">max</span>&nbsp;<span class="op" id="5451006">&lt;</span>&nbsp;<span class="num" id="5451008">0</span>&nbsp;<span class="op" id="5451010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451015">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451053">min</span>&nbsp;<span class="op" id="5451057">=</span>&nbsp;<span class="op" id="5451059">-</span><span class="num" id="5451060">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451070">if</span>&nbsp;<span class="ident" id="5451073">s</span>&nbsp;<span class="op" id="5451075">==</span>&nbsp;<span class="string" id="5451078">&#34;&#34;</span>&nbsp;<span class="op" id="5451081">||</span>&nbsp;<span class="ident" id="5451084">s</span><span class="op" id="5451085">[</span><span class="num" id="5451086">0</span><span class="op" id="5451087">]</span>&nbsp;<span class="op" id="5451089">!=</span>&nbsp;<span class="string" id="5451092">&#39;}&#39;</span>&nbsp;<span class="op" id="5451096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451100">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451108">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451111">rest</span>&nbsp;<span class="op" id="5451116">=</span>&nbsp;<span class="ident" id="5451118">s</span><span class="op" id="5451119">[</span><span class="num" id="5451120">1</span><span class="op" id="5451121">:</span><span class="op" id="5451122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451125">ok</span>&nbsp;<span class="op" id="5451128">=</span>&nbsp;<span class="builtintype" id="5451130">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451136">return</span><br>
<span class="lineno"></span><span class="op" id="5451143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5451146">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5451223">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5451311">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5451368">func</span>&nbsp;<span class="op" id="5451373">(</span><span class="ident" id="5451374">p</span>&nbsp;<span class="op" id="5451376">*</span><span class="ident" id="5451377">parser</span><span class="op" id="5451383">)</span>&nbsp;<span class="ident" id="5451385">parsePerlFlags</span><span class="op" id="5451399">(</span><span class="ident" id="5451400">s</span>&nbsp;<span class="builtintype" id="5451402">string</span><span class="op" id="5451408">)</span>&nbsp;<span class="op" id="5451410">(</span><span class="ident" id="5451411">rest</span>&nbsp;<span class="builtintype" id="5451416">string</span><span class="op" id="5451422">,</span>&nbsp;<span class="ident" id="5451424">err</span>&nbsp;<span class="builtintype" id="5451428">error</span><span class="op" id="5451433">)</span>&nbsp;<span class="op" id="5451435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451438">t</span>&nbsp;<span class="op" id="5451440">:=</span>&nbsp;<span class="ident" id="5451443">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451447">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451522">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451581">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451585">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451643">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451708">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451777">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451781">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451843">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451905">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451969">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452041">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452045">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452105">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452166">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452218">if</span>&nbsp;<span class="builtinfunc" id="5452221">len</span><span class="op" id="5452224">(</span><span class="ident" id="5452225">t</span><span class="op" id="5452226">)</span>&nbsp;<span class="op" id="5452228">&gt;</span>&nbsp;<span class="num" id="5452230">4</span>&nbsp;<span class="op" id="5452232">&amp;&amp;</span>&nbsp;<span class="ident" id="5452235">t</span><span class="op" id="5452236">[</span><span class="num" id="5452237">2</span><span class="op" id="5452238">]</span>&nbsp;<span class="op" id="5452240">==</span>&nbsp;<span class="string" id="5452243">&#39;P&#39;</span>&nbsp;<span class="op" id="5452247">&amp;&amp;</span>&nbsp;<span class="ident" id="5452250">t</span><span class="op" id="5452251">[</span><span class="num" id="5452252">3</span><span class="op" id="5452253">]</span>&nbsp;<span class="op" id="5452255">==</span>&nbsp;<span class="string" id="5452258">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5452262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452266">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452286">end</span>&nbsp;<span class="op" id="5452290">:=</span>&nbsp;<span class="ident" id="5452293">strings</span><span class="op" id="5452300">.</span><span class="ident" id="5452301">IndexRune</span><span class="op" id="5452310">(</span><span class="ident" id="5452311">t</span><span class="op" id="5452312">,</span>&nbsp;<span class="string" id="5452314">&#39;&gt;&#39;</span><span class="op" id="5452317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452321">if</span>&nbsp;<span class="ident" id="5452324">end</span>&nbsp;<span class="op" id="5452328">&lt;</span>&nbsp;<span class="num" id="5452330">0</span>&nbsp;<span class="op" id="5452332">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452337">if</span>&nbsp;<span class="ident" id="5452340">err</span>&nbsp;<span class="op" id="5452344">=</span>&nbsp;<span class="ident" id="5452346">checkUTF8</span><span class="op" id="5452355">(</span><span class="ident" id="5452356">t</span><span class="op" id="5452357">)</span><span class="op" id="5452358">;</span>&nbsp;<span class="ident" id="5452360">err</span>&nbsp;<span class="op" id="5452364">!=</span>&nbsp;<span class="ident" id="5452367">nil</span>&nbsp;<span class="op" id="5452371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452377">return</span>&nbsp;<span class="string" id="5452384">&#34;&#34;</span><span class="op" id="5452386">,</span>&nbsp;<span class="ident" id="5452388">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452400">return</span>&nbsp;<span class="string" id="5452407">&#34;&#34;</span><span class="op" id="5452409">,</span>&nbsp;<span class="op" id="5452411">&amp;</span><span class="ident" id="5452412">Error</span><span class="op" id="5452417">{</span><span class="ident" id="5452418">ErrInvalidNamedCapture</span><span class="op" id="5452440">,</span>&nbsp;<span class="ident" id="5452442">s</span><span class="op" id="5452443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452447">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452452">capture</span>&nbsp;<span class="op" id="5452460">:=</span>&nbsp;<span class="ident" id="5452463">t</span><span class="op" id="5452464">[</span><span class="op" id="5452465">:</span><span class="ident" id="5452466">end</span><span class="op" id="5452469">+</span><span class="num" id="5452470">1</span><span class="op" id="5452471">]</span>&nbsp;<span class="comment" id="5452473">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452490">name</span>&nbsp;<span class="op" id="5452495">:=</span>&nbsp;<span class="ident" id="5452498">t</span><span class="op" id="5452499">[</span><span class="num" id="5452500">4</span><span class="op" id="5452501">:</span><span class="ident" id="5452502">end</span><span class="op" id="5452505">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452511">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452523">if</span>&nbsp;<span class="ident" id="5452526">err</span>&nbsp;<span class="op" id="5452530">=</span>&nbsp;<span class="ident" id="5452532">checkUTF8</span><span class="op" id="5452541">(</span><span class="ident" id="5452542">name</span><span class="op" id="5452546">)</span><span class="op" id="5452547">;</span>&nbsp;<span class="ident" id="5452549">err</span>&nbsp;<span class="op" id="5452553">!=</span>&nbsp;<span class="ident" id="5452556">nil</span>&nbsp;<span class="op" id="5452560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452565">return</span>&nbsp;<span class="string" id="5452572">&#34;&#34;</span><span class="op" id="5452574">,</span>&nbsp;<span class="ident" id="5452576">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452586">if</span>&nbsp;<span class="op" id="5452589">!</span><span class="ident" id="5452590">isValidCaptureName</span><span class="op" id="5452608">(</span><span class="ident" id="5452609">name</span><span class="op" id="5452613">)</span>&nbsp;<span class="op" id="5452615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452620">return</span>&nbsp;<span class="string" id="5452627">&#34;&#34;</span><span class="op" id="5452629">,</span>&nbsp;<span class="op" id="5452631">&amp;</span><span class="ident" id="5452632">Error</span><span class="op" id="5452637">{</span><span class="ident" id="5452638">ErrInvalidNamedCapture</span><span class="op" id="5452660">,</span>&nbsp;<span class="ident" id="5452662">capture</span><span class="op" id="5452669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452678">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452717">p</span><span class="op" id="5452718">.</span><span class="ident" id="5452719">numCap</span><span class="op" id="5452725">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452730">re</span>&nbsp;<span class="op" id="5452733">:=</span>&nbsp;<span class="ident" id="5452736">p</span><span class="op" id="5452737">.</span><span class="ident" id="5452738">op</span><span class="op" id="5452740">(</span><span class="ident" id="5452741">opLeftParen</span><span class="op" id="5452752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452756">re</span><span class="op" id="5452758">.</span><span class="ident" id="5452759">Cap</span>&nbsp;<span class="op" id="5452763">=</span>&nbsp;<span class="ident" id="5452765">p</span><span class="op" id="5452766">.</span><span class="ident" id="5452767">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452776">re</span><span class="op" id="5452778">.</span><span class="ident" id="5452779">Name</span>&nbsp;<span class="op" id="5452784">=</span>&nbsp;<span class="ident" id="5452786">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452793">return</span>&nbsp;<span class="ident" id="5452800">t</span><span class="op" id="5452801">[</span><span class="ident" id="5452802">end</span><span class="op" id="5452805">+</span><span class="num" id="5452806">1</span><span class="op" id="5452807">:</span><span class="op" id="5452808">]</span><span class="op" id="5452809">,</span>&nbsp;<span class="ident" id="5452811">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452820">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452877">var</span>&nbsp;<span class="ident" id="5452881">c</span>&nbsp;<span class="builtintype" id="5452883">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452889">t</span>&nbsp;<span class="op" id="5452891">=</span>&nbsp;<span class="ident" id="5452893">t</span><span class="op" id="5452894">[</span><span class="num" id="5452895">2</span><span class="op" id="5452896">:</span><span class="op" id="5452897">]</span>&nbsp;<span class="comment" id="5452899">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452911">flags</span>&nbsp;<span class="op" id="5452917">:=</span>&nbsp;<span class="ident" id="5452920">p</span><span class="op" id="5452921">.</span><span class="ident" id="5452922">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452929">sign</span>&nbsp;<span class="op" id="5452934">:=</span>&nbsp;<span class="op" id="5452937">+</span><span class="num" id="5452938">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452941">sawFlag</span>&nbsp;<span class="op" id="5452949">:=</span>&nbsp;<span class="builtintype" id="5452952">false</span><br>
<span class="lineno"></span><span class="ident" id="5452958">Loop</span><span class="op" id="5452962">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452965">for</span>&nbsp;<span class="ident" id="5452969">t</span>&nbsp;<span class="op" id="5452971">!=</span>&nbsp;<span class="string" id="5452974">&#34;&#34;</span>&nbsp;<span class="op" id="5452977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452981">if</span>&nbsp;<span class="ident" id="5452984">c</span><span class="op" id="5452985">,</span>&nbsp;<span class="ident" id="5452987">t</span><span class="op" id="5452988">,</span>&nbsp;<span class="ident" id="5452990">err</span>&nbsp;<span class="op" id="5452994">=</span>&nbsp;<span class="ident" id="5452996">nextRune</span><span class="op" id="5453004">(</span><span class="ident" id="5453005">t</span><span class="op" id="5453006">)</span><span class="op" id="5453007">;</span>&nbsp;<span class="ident" id="5453009">err</span>&nbsp;<span class="op" id="5453013">!=</span>&nbsp;<span class="ident" id="5453016">nil</span>&nbsp;<span class="op" id="5453020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453025">return</span>&nbsp;<span class="string" id="5453032">&#34;&#34;</span><span class="op" id="5453034">,</span>&nbsp;<span class="ident" id="5453036">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453046">switch</span>&nbsp;<span class="ident" id="5453053">c</span>&nbsp;<span class="op" id="5453055">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453059">default</span><span class="op" id="5453066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453071">break</span>&nbsp;<span class="ident" id="5453077">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453085">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453097">case</span>&nbsp;<span class="string" id="5453102">&#39;i&#39;</span><span class="op" id="5453105">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453110">flags</span>&nbsp;<span class="op" id="5453116">|=</span>&nbsp;<span class="ident" id="5453119">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453131">sawFlag</span>&nbsp;<span class="op" id="5453139">=</span>&nbsp;<span class="builtintype" id="5453141">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453148">case</span>&nbsp;<span class="string" id="5453153">&#39;m&#39;</span><span class="op" id="5453156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453161">flags</span>&nbsp;<span class="op" id="5453167">&amp;^=</span>&nbsp;<span class="ident" id="5453171">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453182">sawFlag</span>&nbsp;<span class="op" id="5453190">=</span>&nbsp;<span class="builtintype" id="5453192">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453199">case</span>&nbsp;<span class="string" id="5453204">&#39;s&#39;</span><span class="op" id="5453207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453212">flags</span>&nbsp;<span class="op" id="5453218">|=</span>&nbsp;<span class="ident" id="5453221">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453230">sawFlag</span>&nbsp;<span class="op" id="5453238">=</span>&nbsp;<span class="builtintype" id="5453240">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453247">case</span>&nbsp;<span class="string" id="5453252">&#39;U&#39;</span><span class="op" id="5453255">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453260">flags</span>&nbsp;<span class="op" id="5453266">|=</span>&nbsp;<span class="ident" id="5453269">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453282">sawFlag</span>&nbsp;<span class="op" id="5453290">=</span>&nbsp;<span class="builtintype" id="5453292">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453300">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453325">case</span>&nbsp;<span class="string" id="5453330">&#39;-&#39;</span><span class="op" id="5453333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453338">if</span>&nbsp;<span class="ident" id="5453341">sign</span>&nbsp;<span class="op" id="5453346">&lt;</span>&nbsp;<span class="num" id="5453348">0</span>&nbsp;<span class="op" id="5453350">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453356">break</span>&nbsp;<span class="ident" id="5453362">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453375">sign</span>&nbsp;<span class="op" id="5453380">=</span>&nbsp;<span class="op" id="5453382">-</span><span class="num" id="5453383">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453388">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453452">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453506">flags</span>&nbsp;<span class="op" id="5453512">=</span>&nbsp;<span class="op" id="5453514">^</span><span class="ident" id="5453515">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453524">sawFlag</span>&nbsp;<span class="op" id="5453532">=</span>&nbsp;<span class="builtintype" id="5453534">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453543">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453585">case</span>&nbsp;<span class="string" id="5453590">&#39;:&#39;</span><span class="op" id="5453593">,</span>&nbsp;<span class="string" id="5453595">&#39;)&#39;</span><span class="op" id="5453598">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453603">if</span>&nbsp;<span class="ident" id="5453606">sign</span>&nbsp;<span class="op" id="5453611">&lt;</span>&nbsp;<span class="num" id="5453613">0</span>&nbsp;<span class="op" id="5453615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453621">if</span>&nbsp;<span class="op" id="5453624">!</span><span class="ident" id="5453625">sawFlag</span>&nbsp;<span class="op" id="5453633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453640">break</span>&nbsp;<span class="ident" id="5453646">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453661">flags</span>&nbsp;<span class="op" id="5453667">=</span>&nbsp;<span class="op" id="5453669">^</span><span class="ident" id="5453670">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453684">if</span>&nbsp;<span class="ident" id="5453687">c</span>&nbsp;<span class="op" id="5453689">==</span>&nbsp;<span class="string" id="5453692">&#39;:&#39;</span>&nbsp;<span class="op" id="5453696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453702">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453724">p</span><span class="op" id="5453725">.</span><span class="ident" id="5453726">op</span><span class="op" id="5453728">(</span><span class="ident" id="5453729">opLeftParen</span><span class="op" id="5453740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453745">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453750">p</span><span class="op" id="5453751">.</span><span class="ident" id="5453752">flags</span>&nbsp;<span class="op" id="5453758">=</span>&nbsp;<span class="ident" id="5453760">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453769">return</span>&nbsp;<span class="ident" id="5453776">t</span><span class="op" id="5453777">,</span>&nbsp;<span class="ident" id="5453779">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453792">return</span>&nbsp;<span class="string" id="5453799">&#34;&#34;</span><span class="op" id="5453801">,</span>&nbsp;<span class="op" id="5453803">&amp;</span><span class="ident" id="5453804">Error</span><span class="op" id="5453809">{</span><span class="ident" id="5453810">ErrInvalidPerlOp</span><span class="op" id="5453826">,</span>&nbsp;<span class="ident" id="5453828">s</span><span class="op" id="5453829">[</span><span class="op" id="5453830">:</span><span class="builtinfunc" id="5453831">len</span><span class="op" id="5453834">(</span><span class="ident" id="5453835">s</span><span class="op" id="5453836">)</span><span class="op" id="5453837">-</span><span class="builtinfunc" id="5453838">len</span><span class="op" id="5453841">(</span><span class="ident" id="5453842">t</span><span class="op" id="5453843">)</span><span class="op" id="5453844">]</span><span class="op" id="5453845">}</span><br>
<span class="lineno"></span><span class="op" id="5453847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453850">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5453893">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5453936">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5453970">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5454016">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5454053">func</span>&nbsp;<span class="ident" id="5454058">isValidCaptureName</span><span class="op" id="5454076">(</span><span class="ident" id="5454077">name</span>&nbsp;<span class="builtintype" id="5454082">string</span><span class="op" id="5454088">)</span>&nbsp;<span class="builtintype" id="5454090">bool</span>&nbsp;<span class="op" id="5454095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454098">if</span>&nbsp;<span class="ident" id="5454101">name</span>&nbsp;<span class="op" id="5454106">==</span>&nbsp;<span class="string" id="5454109">&#34;&#34;</span>&nbsp;<span class="op" id="5454112">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454116">return</span>&nbsp;<span class="builtintype" id="5454123">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454133">for</span>&nbsp;<span class="ident" id="5454137">_</span><span class="op" id="5454138">,</span>&nbsp;<span class="ident" id="5454140">c</span>&nbsp;<span class="op" id="5454142">:=</span>&nbsp;<span class="keyword" id="5454145">range</span>&nbsp;<span class="ident" id="5454151">name</span>&nbsp;<span class="op" id="5454156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454160">if</span>&nbsp;<span class="ident" id="5454163">c</span>&nbsp;<span class="op" id="5454165">!=</span>&nbsp;<span class="string" id="5454168">&#39;_&#39;</span>&nbsp;<span class="op" id="5454172">&amp;&amp;</span>&nbsp;<span class="op" id="5454175">!</span><span class="ident" id="5454176">isalnum</span><span class="op" id="5454183">(</span><span class="ident" id="5454184">c</span><span class="op" id="5454185">)</span>&nbsp;<span class="op" id="5454187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454192">return</span>&nbsp;<span class="builtintype" id="5454199">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454213">return</span>&nbsp;<span class="builtintype" id="5454220">true</span><br>
<span class="lineno"></span><span class="op" id="5454225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5454228">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5454266">func</span>&nbsp;<span class="op" id="5454271">(</span><span class="ident" id="5454272">p</span>&nbsp;<span class="op" id="5454274">*</span><span class="ident" id="5454275">parser</span><span class="op" id="5454281">)</span>&nbsp;<span class="ident" id="5454283">parseInt</span><span class="op" id="5454291">(</span><span class="ident" id="5454292">s</span>&nbsp;<span class="builtintype" id="5454294">string</span><span class="op" id="5454300">)</span>&nbsp;<span class="op" id="5454302">(</span><span class="ident" id="5454303">n</span>&nbsp;<span class="builtintype" id="5454305">int</span><span class="op" id="5454308">,</span>&nbsp;<span class="ident" id="5454310">rest</span>&nbsp;<span class="builtintype" id="5454315">string</span><span class="op" id="5454321">,</span>&nbsp;<span class="ident" id="5454323">ok</span>&nbsp;<span class="builtintype" id="5454326">bool</span><span class="op" id="5454330">)</span>&nbsp;<span class="op" id="5454332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454335">if</span>&nbsp;<span class="ident" id="5454338">s</span>&nbsp;<span class="op" id="5454340">==</span>&nbsp;<span class="string" id="5454343">&#34;&#34;</span>&nbsp;<span class="op" id="5454346">||</span>&nbsp;<span class="ident" id="5454349">s</span><span class="op" id="5454350">[</span><span class="num" id="5454351">0</span><span class="op" id="5454352">]</span>&nbsp;<span class="op" id="5454354">&lt;</span>&nbsp;<span class="string" id="5454356">&#39;0&#39;</span>&nbsp;<span class="op" id="5454360">||</span>&nbsp;<span class="string" id="5454363">&#39;9&#39;</span>&nbsp;<span class="op" id="5454367">&lt;</span>&nbsp;<span class="ident" id="5454369">s</span><span class="op" id="5454370">[</span><span class="num" id="5454371">0</span><span class="op" id="5454372">]</span>&nbsp;<span class="op" id="5454374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454378">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454386">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454389">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454417">if</span>&nbsp;<span class="builtinfunc" id="5454420">len</span><span class="op" id="5454423">(</span><span class="ident" id="5454424">s</span><span class="op" id="5454425">)</span>&nbsp;<span class="op" id="5454427">&gt;=</span>&nbsp;<span class="num" id="5454430">2</span>&nbsp;<span class="op" id="5454432">&amp;&amp;</span>&nbsp;<span class="ident" id="5454435">s</span><span class="op" id="5454436">[</span><span class="num" id="5454437">0</span><span class="op" id="5454438">]</span>&nbsp;<span class="op" id="5454440">==</span>&nbsp;<span class="string" id="5454443">&#39;0&#39;</span>&nbsp;<span class="op" id="5454447">&amp;&amp;</span>&nbsp;<span class="string" id="5454450">&#39;0&#39;</span>&nbsp;<span class="op" id="5454454">&lt;=</span>&nbsp;<span class="ident" id="5454457">s</span><span class="op" id="5454458">[</span><span class="num" id="5454459">1</span><span class="op" id="5454460">]</span>&nbsp;<span class="op" id="5454462">&amp;&amp;</span>&nbsp;<span class="ident" id="5454465">s</span><span class="op" id="5454466">[</span><span class="num" id="5454467">1</span><span class="op" id="5454468">]</span>&nbsp;<span class="op" id="5454470">&lt;=</span>&nbsp;<span class="string" id="5454473">&#39;9&#39;</span>&nbsp;<span class="op" id="5454477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454492">t</span>&nbsp;<span class="op" id="5454494">:=</span>&nbsp;<span class="ident" id="5454497">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454500">for</span>&nbsp;<span class="ident" id="5454504">s</span>&nbsp;<span class="op" id="5454506">!=</span>&nbsp;<span class="string" id="5454509">&#34;&#34;</span>&nbsp;<span class="op" id="5454512">&amp;&amp;</span>&nbsp;<span class="string" id="5454515">&#39;0&#39;</span>&nbsp;<span class="op" id="5454519">&lt;=</span>&nbsp;<span class="ident" id="5454522">s</span><span class="op" id="5454523">[</span><span class="num" id="5454524">0</span><span class="op" id="5454525">]</span>&nbsp;<span class="op" id="5454527">&amp;&amp;</span>&nbsp;<span class="ident" id="5454530">s</span><span class="op" id="5454531">[</span><span class="num" id="5454532">0</span><span class="op" id="5454533">]</span>&nbsp;<span class="op" id="5454535">&lt;=</span>&nbsp;<span class="string" id="5454538">&#39;9&#39;</span>&nbsp;<span class="op" id="5454542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454546">s</span>&nbsp;<span class="op" id="5454548">=</span>&nbsp;<span class="ident" id="5454550">s</span><span class="op" id="5454551">[</span><span class="num" id="5454552">1</span><span class="op" id="5454553">:</span><span class="op" id="5454554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454560">rest</span>&nbsp;<span class="op" id="5454565">=</span>&nbsp;<span class="ident" id="5454567">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454570">ok</span>&nbsp;<span class="op" id="5454573">=</span>&nbsp;<span class="builtintype" id="5454575">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454581">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454613">t</span>&nbsp;<span class="op" id="5454615">=</span>&nbsp;<span class="ident" id="5454617">t</span><span class="op" id="5454618">[</span><span class="op" id="5454619">:</span><span class="builtinfunc" id="5454620">len</span><span class="op" id="5454623">(</span><span class="ident" id="5454624">t</span><span class="op" id="5454625">)</span><span class="op" id="5454626">-</span><span class="builtinfunc" id="5454627">len</span><span class="op" id="5454630">(</span><span class="ident" id="5454631">s</span><span class="op" id="5454632">)</span><span class="op" id="5454633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454636">for</span>&nbsp;<span class="ident" id="5454640">i</span>&nbsp;<span class="op" id="5454642">:=</span>&nbsp;<span class="num" id="5454645">0</span><span class="op" id="5454646">;</span>&nbsp;<span class="ident" id="5454648">i</span>&nbsp;<span class="op" id="5454650">&lt;</span>&nbsp;<span class="builtinfunc" id="5454652">len</span><span class="op" id="5454655">(</span><span class="ident" id="5454656">t</span><span class="op" id="5454657">)</span><span class="op" id="5454658">;</span>&nbsp;<span class="ident" id="5454660">i</span><span class="op" id="5454661">++</span>&nbsp;<span class="op" id="5454664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454668">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454689">if</span>&nbsp;<span class="ident" id="5454692">n</span>&nbsp;<span class="op" id="5454694">&gt;=</span>&nbsp;<span class="num" id="5454697">1e8</span>&nbsp;<span class="op" id="5454701">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454706">n</span>&nbsp;<span class="op" id="5454708">=</span>&nbsp;<span class="op" id="5454710">-</span><span class="num" id="5454711">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454716">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454728">n</span>&nbsp;<span class="op" id="5454730">=</span>&nbsp;<span class="ident" id="5454732">n</span><span class="op" id="5454733">*</span><span class="num" id="5454734">10</span>&nbsp;<span class="op" id="5454737">+</span>&nbsp;<span class="builtintype" id="5454739">int</span><span class="op" id="5454742">(</span><span class="ident" id="5454743">t</span><span class="op" id="5454744">[</span><span class="ident" id="5454745">i</span><span class="op" id="5454746">]</span><span class="op" id="5454747">)</span>&nbsp;<span class="op" id="5454749">-</span>&nbsp;<span class="string" id="5454751">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454756">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454759">return</span><br>
<span class="lineno"></span><span class="op" id="5454766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454769">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5454818">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5454874">func</span>&nbsp;<span class="ident" id="5454879">isCharClass</span><span class="op" id="5454890">(</span><span class="ident" id="5454891">re</span>&nbsp;<span class="op" id="5454894">*</span><span class="ident" id="5454895">Regexp</span><span class="op" id="5454901">)</span>&nbsp;<span class="builtintype" id="5454903">bool</span>&nbsp;<span class="op" id="5454908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454911">return</span>&nbsp;<span class="ident" id="5454918">re</span><span class="op" id="5454920">.</span><span class="ident" id="5454921">Op</span>&nbsp;<span class="op" id="5454924">==</span>&nbsp;<span class="ident" id="5454927">OpLiteral</span>&nbsp;<span class="op" id="5454937">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5454940">len</span><span class="op" id="5454943">(</span><span class="ident" id="5454944">re</span><span class="op" id="5454946">.</span><span class="ident" id="5454947">Rune</span><span class="op" id="5454951">)</span>&nbsp;<span class="op" id="5454953">==</span>&nbsp;<span class="num" id="5454956">1</span>&nbsp;<span class="op" id="5454958">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454963">re</span><span class="op" id="5454965">.</span><span class="ident" id="5454966">Op</span>&nbsp;<span class="op" id="5454969">==</span>&nbsp;<span class="ident" id="5454972">OpCharClass</span>&nbsp;<span class="op" id="5454984">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454989">re</span><span class="op" id="5454991">.</span><span class="ident" id="5454992">Op</span>&nbsp;<span class="op" id="5454995">==</span>&nbsp;<span class="ident" id="5454998">OpAnyCharNotNL</span>&nbsp;<span class="op" id="5455013">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455018">re</span><span class="op" id="5455020">.</span><span class="ident" id="5455021">Op</span>&nbsp;<span class="op" id="5455024">==</span>&nbsp;<span class="ident" id="5455027">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="5455037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455040">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5455060">func</span>&nbsp;<span class="ident" id="5455065">matchRune</span><span class="op" id="5455074">(</span><span class="ident" id="5455075">re</span>&nbsp;<span class="op" id="5455078">*</span><span class="ident" id="5455079">Regexp</span><span class="op" id="5455085">,</span>&nbsp;<span class="ident" id="5455087">r</span>&nbsp;<span class="builtintype" id="5455089">rune</span><span class="op" id="5455093">)</span>&nbsp;<span class="builtintype" id="5455095">bool</span>&nbsp;<span class="op" id="5455100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455103">switch</span>&nbsp;<span class="ident" id="5455110">re</span><span class="op" id="5455112">.</span><span class="ident" id="5455113">Op</span>&nbsp;<span class="op" id="5455116">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455119">case</span>&nbsp;<span class="ident" id="5455124">OpLiteral</span><span class="op" id="5455133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455137">return</span>&nbsp;<span class="builtinfunc" id="5455144">len</span><span class="op" id="5455147">(</span><span class="ident" id="5455148">re</span><span class="op" id="5455150">.</span><span class="ident" id="5455151">Rune</span><span class="op" id="5455155">)</span>&nbsp;<span class="op" id="5455157">==</span>&nbsp;<span class="num" id="5455160">1</span>&nbsp;<span class="op" id="5455162">&amp;&amp;</span>&nbsp;<span class="ident" id="5455165">re</span><span class="op" id="5455167">.</span><span class="ident" id="5455168">Rune</span><span class="op" id="5455172">[</span><span class="num" id="5455173">0</span><span class="op" id="5455174">]</span>&nbsp;<span class="op" id="5455176">==</span>&nbsp;<span class="ident" id="5455179">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455182">case</span>&nbsp;<span class="ident" id="5455187">OpCharClass</span><span class="op" id="5455198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455202">for</span>&nbsp;<span class="ident" id="5455206">i</span>&nbsp;<span class="op" id="5455208">:=</span>&nbsp;<span class="num" id="5455211">0</span><span class="op" id="5455212">;</span>&nbsp;<span class="ident" id="5455214">i</span>&nbsp;<span class="op" id="5455216">&lt;</span>&nbsp;<span class="builtinfunc" id="5455218">len</span><span class="op" id="5455221">(</span><span class="ident" id="5455222">re</span><span class="op" id="5455224">.</span><span class="ident" id="5455225">Rune</span><span class="op" id="5455229">)</span><span class="op" id="5455230">;</span>&nbsp;<span class="ident" id="5455232">i</span>&nbsp;<span class="op" id="5455234">+=</span>&nbsp;<span class="num" id="5455237">2</span>&nbsp;<span class="op" id="5455239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455244">if</span>&nbsp;<span class="ident" id="5455247">re</span><span class="op" id="5455249">.</span><span class="ident" id="5455250">Rune</span><span class="op" id="5455254">[</span><span class="ident" id="5455255">i</span><span class="op" id="5455256">]</span>&nbsp;<span class="op" id="5455258">&lt;=</span>&nbsp;<span class="ident" id="5455261">r</span>&nbsp;<span class="op" id="5455263">&amp;&amp;</span>&nbsp;<span class="ident" id="5455266">r</span>&nbsp;<span class="op" id="5455268">&lt;=</span>&nbsp;<span class="ident" id="5455271">re</span><span class="op" id="5455273">.</span><span class="ident" id="5455274">Rune</span><span class="op" id="5455278">[</span><span class="ident" id="5455279">i</span><span class="op" id="5455280">+</span><span class="num" id="5455281">1</span><span class="op" id="5455282">]</span>&nbsp;<span class="op" id="5455284">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455290">return</span>&nbsp;<span class="builtintype" id="5455297">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455313">return</span>&nbsp;<span class="builtintype" id="5455320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455327">case</span>&nbsp;<span class="ident" id="5455332">OpAnyCharNotNL</span><span class="op" id="5455346">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455350">return</span>&nbsp;<span class="ident" id="5455357">r</span>&nbsp;<span class="op" id="5455359">!=</span>&nbsp;<span class="string" id="5455362">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455368">case</span>&nbsp;<span class="ident" id="5455373">OpAnyChar</span><span class="op" id="5455382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455386">return</span>&nbsp;<span class="builtintype" id="5455393">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455402">return</span>&nbsp;<span class="builtintype" id="5455409">false</span><br>
<span class="lineno">1110</span><span class="op" id="5455415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455418">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5455464">func</span>&nbsp;<span class="op" id="5455469">(</span><span class="ident" id="5455470">p</span>&nbsp;<span class="op" id="5455472">*</span><span class="ident" id="5455473">parser</span><span class="op" id="5455479">)</span>&nbsp;<span class="ident" id="5455481">parseVerticalBar</span><span class="op" id="5455497">(</span><span class="op" id="5455498">)</span>&nbsp;<span class="builtintype" id="5455500">error</span>&nbsp;<span class="op" id="5455506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455509">p</span><span class="op" id="5455510">.</span><span class="ident" id="5455511">concat</span><span class="op" id="5455517">(</span><span class="op" id="5455518">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455522">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455583">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455636">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455695">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455735">if</span>&nbsp;<span class="op" id="5455738">!</span><span class="ident" id="5455739">p</span><span class="op" id="5455740">.</span><span class="ident" id="5455741">swapVerticalBar</span><span class="op" id="5455756">(</span><span class="op" id="5455757">)</span>&nbsp;<span class="op" id="5455759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455763">p</span><span class="op" id="5455764">.</span><span class="ident" id="5455765">op</span><span class="op" id="5455767">(</span><span class="ident" id="5455768">opVerticalBar</span><span class="op" id="5455781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455788">return</span>&nbsp;<span class="ident" id="5455795">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5455799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455802">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5455841">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5455890">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5455926">func</span>&nbsp;<span class="ident" id="5455931">mergeCharClass</span><span class="op" id="5455945">(</span><span class="ident" id="5455946">dst</span><span class="op" id="5455949">,</span>&nbsp;<span class="ident" id="5455951">src</span>&nbsp;<span class="op" id="5455955">*</span><span class="ident" id="5455956">Regexp</span><span class="op" id="5455962">)</span>&nbsp;<span class="op" id="5455964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455967">switch</span>&nbsp;<span class="ident" id="5455974">dst</span><span class="op" id="5455977">.</span><span class="ident" id="5455978">Op</span>&nbsp;<span class="op" id="5455981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455984">case</span>&nbsp;<span class="ident" id="5455989">OpAnyChar</span><span class="op" id="5455998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456002">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456032">case</span>&nbsp;<span class="ident" id="5456037">OpAnyCharNotNL</span><span class="op" id="5456051">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456055">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456077">if</span>&nbsp;<span class="ident" id="5456080">matchRune</span><span class="op" id="5456089">(</span><span class="ident" id="5456090">src</span><span class="op" id="5456093">,</span>&nbsp;<span class="string" id="5456095">&#39;\n&#39;</span><span class="op" id="5456099">)</span>&nbsp;<span class="op" id="5456101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456106">dst</span><span class="op" id="5456109">.</span><span class="ident" id="5456110">Op</span>&nbsp;<span class="op" id="5456113">=</span>&nbsp;<span class="ident" id="5456115">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456130">case</span>&nbsp;<span class="ident" id="5456135">OpCharClass</span><span class="op" id="5456146">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456150">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456203">if</span>&nbsp;<span class="ident" id="5456206">src</span><span class="op" id="5456209">.</span><span class="ident" id="5456210">Op</span>&nbsp;<span class="op" id="5456213">==</span>&nbsp;<span class="ident" id="5456216">OpLiteral</span>&nbsp;<span class="op" id="5456226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456231">dst</span><span class="op" id="5456234">.</span><span class="ident" id="5456235">Rune</span>&nbsp;<span class="op" id="5456240">=</span>&nbsp;<span class="ident" id="5456242">appendLiteral</span><span class="op" id="5456255">(</span><span class="ident" id="5456256">dst</span><span class="op" id="5456259">.</span><span class="ident" id="5456260">Rune</span><span class="op" id="5456264">,</span>&nbsp;<span class="ident" id="5456266">src</span><span class="op" id="5456269">.</span><span class="ident" id="5456270">Rune</span><span class="op" id="5456274">[</span><span class="num" id="5456275">0</span><span class="op" id="5456276">]</span><span class="op" id="5456277">,</span>&nbsp;<span class="ident" id="5456279">src</span><span class="op" id="5456282">.</span><span class="ident" id="5456283">Flags</span><span class="op" id="5456288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456292">}</span>&nbsp;<span class="keyword" id="5456294">else</span>&nbsp;<span class="op" id="5456299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456304">dst</span><span class="op" id="5456307">.</span><span class="ident" id="5456308">Rune</span>&nbsp;<span class="op" id="5456313">=</span>&nbsp;<span class="ident" id="5456315">appendClass</span><span class="op" id="5456326">(</span><span class="ident" id="5456327">dst</span><span class="op" id="5456330">.</span><span class="ident" id="5456331">Rune</span><span class="op" id="5456335">,</span>&nbsp;<span class="ident" id="5456337">src</span><span class="op" id="5456340">.</span><span class="ident" id="5456341">Rune</span><span class="op" id="5456345">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456352">case</span>&nbsp;<span class="ident" id="5456357">OpLiteral</span><span class="op" id="5456366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456370">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456388">if</span>&nbsp;<span class="ident" id="5456391">src</span><span class="op" id="5456394">.</span><span class="ident" id="5456395">Rune</span><span class="op" id="5456399">[</span><span class="num" id="5456400">0</span><span class="op" id="5456401">]</span>&nbsp;<span class="op" id="5456403">==</span>&nbsp;<span class="ident" id="5456406">dst</span><span class="op" id="5456409">.</span><span class="ident" id="5456410">Rune</span><span class="op" id="5456414">[</span><span class="num" id="5456415">0</span><span class="op" id="5456416">]</span>&nbsp;<span class="op" id="5456418">&amp;&amp;</span>&nbsp;<span class="ident" id="5456421">src</span><span class="op" id="5456424">.</span><span class="ident" id="5456425">Flags</span>&nbsp;<span class="op" id="5456431">==</span>&nbsp;<span class="ident" id="5456434">dst</span><span class="op" id="5456437">.</span><span class="ident" id="5456438">Flags</span>&nbsp;<span class="op" id="5456444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456449">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456461">dst</span><span class="op" id="5456464">.</span><span class="ident" id="5456465">Op</span>&nbsp;<span class="op" id="5456468">=</span>&nbsp;<span class="ident" id="5456470">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456484">dst</span><span class="op" id="5456487">.</span><span class="ident" id="5456488">Rune</span>&nbsp;<span class="op" id="5456493">=</span>&nbsp;<span class="ident" id="5456495">appendLiteral</span><span class="op" id="5456508">(</span><span class="ident" id="5456509">dst</span><span class="op" id="5456512">.</span><span class="ident" id="5456513">Rune</span><span class="op" id="5456517">[</span><span class="op" id="5456518">:</span><span class="num" id="5456519">0</span><span class="op" id="5456520">]</span><span class="op" id="5456521">,</span>&nbsp;<span class="ident" id="5456523">dst</span><span class="op" id="5456526">.</span><span class="ident" id="5456527">Rune</span><span class="op" id="5456531">[</span><span class="num" id="5456532">0</span><span class="op" id="5456533">]</span><span class="op" id="5456534">,</span>&nbsp;<span class="ident" id="5456536">dst</span><span class="op" id="5456539">.</span><span class="ident" id="5456540">Flags</span><span class="op" id="5456545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456549">dst</span><span class="op" id="5456552">.</span><span class="ident" id="5456553">Rune</span>&nbsp;<span class="op" id="5456558">=</span>&nbsp;<span class="ident" id="5456560">appendLiteral</span><span class="op" id="5456573">(</span><span class="ident" id="5456574">dst</span><span class="op" id="5456577">.</span><span class="ident" id="5456578">Rune</span><span class="op" id="5456582">,</span>&nbsp;<span class="ident" id="5456584">src</span><span class="op" id="5456587">.</span><span class="ident" id="5456588">Rune</span><span class="op" id="5456592">[</span><span class="num" id="5456593">0</span><span class="op" id="5456594">]</span><span class="op" id="5456595">,</span>&nbsp;<span class="ident" id="5456597">src</span><span class="op" id="5456600">.</span><span class="ident" id="5456601">Flags</span><span class="op" id="5456606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456609">}</span><br>
<span class="lineno">1155</span><span class="op" id="5456611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5456614">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5456684">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5456735">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5456766">func</span>&nbsp;<span class="op" id="5456771">(</span><span class="ident" id="5456772">p</span>&nbsp;<span class="op" id="5456774">*</span><span class="ident" id="5456775">parser</span><span class="op" id="5456781">)</span>&nbsp;<span class="ident" id="5456783">swapVerticalBar</span><span class="op" id="5456798">(</span><span class="op" id="5456799">)</span>&nbsp;<span class="builtintype" id="5456801">bool</span>&nbsp;<span class="op" id="5456806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456809">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456872">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456912">n</span>&nbsp;<span class="op" id="5456914">:=</span>&nbsp;<span class="builtinfunc" id="5456917">len</span><span class="op" id="5456920">(</span><span class="ident" id="5456921">p</span><span class="op" id="5456922">.</span><span class="ident" id="5456923">stack</span><span class="op" id="5456928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456931">if</span>&nbsp;<span class="ident" id="5456934">n</span>&nbsp;<span class="op" id="5456936">&gt;=</span>&nbsp;<span class="num" id="5456939">3</span>&nbsp;<span class="op" id="5456941">&amp;&amp;</span>&nbsp;<span class="ident" id="5456944">p</span><span class="op" id="5456945">.</span><span class="ident" id="5456946">stack</span><span class="op" id="5456951">[</span><span class="ident" id="5456952">n</span><span class="op" id="5456953">-</span><span class="num" id="5456954">2</span><span class="op" id="5456955">]</span><span class="op" id="5456956">.</span><span class="ident" id="5456957">Op</span>&nbsp;<span class="op" id="5456960">==</span>&nbsp;<span class="ident" id="5456963">opVerticalBar</span>&nbsp;<span class="op" id="5456977">&amp;&amp;</span>&nbsp;<span class="ident" id="5456980">isCharClass</span><span class="op" id="5456991">(</span><span class="ident" id="5456992">p</span><span class="op" id="5456993">.</span><span class="ident" id="5456994">stack</span><span class="op" id="5456999">[</span><span class="ident" id="5457000">n</span><span class="op" id="5457001">-</span><span class="num" id="5457002">1</span><span class="op" id="5457003">]</span><span class="op" id="5457004">)</span>&nbsp;<span class="op" id="5457006">&amp;&amp;</span>&nbsp;<span class="ident" id="5457009">isCharClass</span><span class="op" id="5457020">(</span><span class="ident" id="5457021">p</span><span class="op" id="5457022">.</span><span class="ident" id="5457023">stack</span><span class="op" id="5457028">[</span><span class="ident" id="5457029">n</span><span class="op" id="5457030">-</span><span class="num" id="5457031">3</span><span class="op" id="5457032">]</span><span class="op" id="5457033">)</span>&nbsp;<span class="op" id="5457035">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457039">re1</span>&nbsp;<span class="op" id="5457043">:=</span>&nbsp;<span class="ident" id="5457046">p</span><span class="op" id="5457047">.</span><span class="ident" id="5457048">stack</span><span class="op" id="5457053">[</span><span class="ident" id="5457054">n</span><span class="op" id="5457055">-</span><span class="num" id="5457056">1</span><span class="op" id="5457057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457061">re3</span>&nbsp;<span class="op" id="5457065">:=</span>&nbsp;<span class="ident" id="5457068">p</span><span class="op" id="5457069">.</span><span class="ident" id="5457070">stack</span><span class="op" id="5457075">[</span><span class="ident" id="5457076">n</span><span class="op" id="5457077">-</span><span class="num" id="5457078">3</span><span class="op" id="5457079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457083">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457126">if</span>&nbsp;<span class="ident" id="5457129">re1</span><span class="op" id="5457132">.</span><span class="ident" id="5457133">Op</span>&nbsp;<span class="op" id="5457136">&gt;</span>&nbsp;<span class="ident" id="5457138">re3</span><span class="op" id="5457141">.</span><span class="ident" id="5457142">Op</span>&nbsp;<span class="op" id="5457145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457150">re1</span><span class="op" id="5457153">,</span>&nbsp;<span class="ident" id="5457155">re3</span>&nbsp;<span class="op" id="5457159">=</span>&nbsp;<span class="ident" id="5457161">re3</span><span class="op" id="5457164">,</span>&nbsp;<span class="ident" id="5457166">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457173">p</span><span class="op" id="5457174">.</span><span class="ident" id="5457175">stack</span><span class="op" id="5457180">[</span><span class="ident" id="5457181">n</span><span class="op" id="5457182">-</span><span class="num" id="5457183">3</span><span class="op" id="5457184">]</span>&nbsp;<span class="op" id="5457186">=</span>&nbsp;<span class="ident" id="5457188">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457198">mergeCharClass</span><span class="op" id="5457212">(</span><span class="ident" id="5457213">re3</span><span class="op" id="5457216">,</span>&nbsp;<span class="ident" id="5457218">re1</span><span class="op" id="5457221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457225">p</span><span class="op" id="5457226">.</span><span class="ident" id="5457227">reuse</span><span class="op" id="5457232">(</span><span class="ident" id="5457233">re1</span><span class="op" id="5457236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457240">p</span><span class="op" id="5457241">.</span><span class="ident" id="5457242">stack</span>&nbsp;<span class="op" id="5457248">=</span>&nbsp;<span class="ident" id="5457250">p</span><span class="op" id="5457251">.</span><span class="ident" id="5457252">stack</span><span class="op" id="5457257">[</span><span class="op" id="5457258">:</span><span class="ident" id="5457259">n</span><span class="op" id="5457260">-</span><span class="num" id="5457261">1</span><span class="op" id="5457262">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457266">return</span>&nbsp;<span class="builtintype" id="5457273">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457283">if</span>&nbsp;<span class="ident" id="5457286">n</span>&nbsp;<span class="op" id="5457288">&gt;=</span>&nbsp;<span class="num" id="5457291">2</span>&nbsp;<span class="op" id="5457293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457297">re1</span>&nbsp;<span class="op" id="5457301">:=</span>&nbsp;<span class="ident" id="5457304">p</span><span class="op" id="5457305">.</span><span class="ident" id="5457306">stack</span><span class="op" id="5457311">[</span><span class="ident" id="5457312">n</span><span class="op" id="5457313">-</span><span class="num" id="5457314">1</span><span class="op" id="5457315">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457319">re2</span>&nbsp;<span class="op" id="5457323">:=</span>&nbsp;<span class="ident" id="5457326">p</span><span class="op" id="5457327">.</span><span class="ident" id="5457328">stack</span><span class="op" id="5457333">[</span><span class="ident" id="5457334">n</span><span class="op" id="5457335">-</span><span class="num" id="5457336">2</span><span class="op" id="5457337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457341">if</span>&nbsp;<span class="ident" id="5457344">re2</span><span class="op" id="5457347">.</span><span class="ident" id="5457348">Op</span>&nbsp;<span class="op" id="5457351">==</span>&nbsp;<span class="ident" id="5457354">opVerticalBar</span>&nbsp;<span class="op" id="5457368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457373">if</span>&nbsp;<span class="ident" id="5457376">n</span>&nbsp;<span class="op" id="5457378">&gt;=</span>&nbsp;<span class="num" id="5457381">3</span>&nbsp;<span class="op" id="5457383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457389">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457414">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457446">cleanAlt</span><span class="op" id="5457454">(</span><span class="ident" id="5457455">p</span><span class="op" id="5457456">.</span><span class="ident" id="5457457">stack</span><span class="op" id="5457462">[</span><span class="ident" id="5457463">n</span><span class="op" id="5457464">-</span><span class="num" id="5457465">3</span><span class="op" id="5457466">]</span><span class="op" id="5457467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457477">p</span><span class="op" id="5457478">.</span><span class="ident" id="5457479">stack</span><span class="op" id="5457484">[</span><span class="ident" id="5457485">n</span><span class="op" id="5457486">-</span><span class="num" id="5457487">2</span><span class="op" id="5457488">]</span>&nbsp;<span class="op" id="5457490">=</span>&nbsp;<span class="ident" id="5457492">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457499">p</span><span class="op" id="5457500">.</span><span class="ident" id="5457501">stack</span><span class="op" id="5457506">[</span><span class="ident" id="5457507">n</span><span class="op" id="5457508">-</span><span class="num" id="5457509">1</span><span class="op" id="5457510">]</span>&nbsp;<span class="op" id="5457512">=</span>&nbsp;<span class="ident" id="5457514">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457521">return</span>&nbsp;<span class="builtintype" id="5457528">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457541">return</span>&nbsp;<span class="builtintype" id="5457548">false</span><br>
<span class="lineno"></span><span class="op" id="5457554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5457557">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5457602">func</span>&nbsp;<span class="op" id="5457607">(</span><span class="ident" id="5457608">p</span>&nbsp;<span class="op" id="5457610">*</span><span class="ident" id="5457611">parser</span><span class="op" id="5457617">)</span>&nbsp;<span class="ident" id="5457619">parseRightParen</span><span class="op" id="5457634">(</span><span class="op" id="5457635">)</span>&nbsp;<span class="builtintype" id="5457637">error</span>&nbsp;<span class="op" id="5457643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457646">p</span><span class="op" id="5457647">.</span><span class="ident" id="5457648">concat</span><span class="op" id="5457654">(</span><span class="op" id="5457655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457658">if</span>&nbsp;<span class="ident" id="5457661">p</span><span class="op" id="5457662">.</span><span class="ident" id="5457663">swapVerticalBar</span><span class="op" id="5457678">(</span><span class="op" id="5457679">)</span>&nbsp;<span class="op" id="5457681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457685">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457707">p</span><span class="op" id="5457708">.</span><span class="ident" id="5457709">stack</span>&nbsp;<span class="op" id="5457715">=</span>&nbsp;<span class="ident" id="5457717">p</span><span class="op" id="5457718">.</span><span class="ident" id="5457719">stack</span><span class="op" id="5457724">[</span><span class="op" id="5457725">:</span><span class="builtinfunc" id="5457726">len</span><span class="op" id="5457729">(</span><span class="ident" id="5457730">p</span><span class="op" id="5457731">.</span><span class="ident" id="5457732">stack</span><span class="op" id="5457737">)</span><span class="op" id="5457738">-</span><span class="num" id="5457739">1</span><span class="op" id="5457740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457746">p</span><span class="op" id="5457747">.</span><span class="ident" id="5457748">alternate</span><span class="op" id="5457757">(</span><span class="op" id="5457758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457762">n</span>&nbsp;<span class="op" id="5457764">:=</span>&nbsp;<span class="builtinfunc" id="5457767">len</span><span class="op" id="5457770">(</span><span class="ident" id="5457771">p</span><span class="op" id="5457772">.</span><span class="ident" id="5457773">stack</span><span class="op" id="5457778">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457781">if</span>&nbsp;<span class="ident" id="5457784">n</span>&nbsp;<span class="op" id="5457786">&lt;</span>&nbsp;<span class="num" id="5457788">2</span>&nbsp;<span class="op" id="5457790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457794">return</span>&nbsp;<span class="op" id="5457801">&amp;</span><span class="ident" id="5457802">Error</span><span class="op" id="5457807">{</span><span class="ident" id="5457808">ErrUnexpectedParen</span><span class="op" id="5457826">,</span>&nbsp;<span class="ident" id="5457828">p</span><span class="op" id="5457829">.</span><span class="ident" id="5457830">wholeRegexp</span><span class="op" id="5457841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457847">re1</span>&nbsp;<span class="op" id="5457851">:=</span>&nbsp;<span class="ident" id="5457854">p</span><span class="op" id="5457855">.</span><span class="ident" id="5457856">stack</span><span class="op" id="5457861">[</span><span class="ident" id="5457862">n</span><span class="op" id="5457863">-</span><span class="num" id="5457864">1</span><span class="op" id="5457865">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457868">re2</span>&nbsp;<span class="op" id="5457872">:=</span>&nbsp;<span class="ident" id="5457875">p</span><span class="op" id="5457876">.</span><span class="ident" id="5457877">stack</span><span class="op" id="5457882">[</span><span class="ident" id="5457883">n</span><span class="op" id="5457884">-</span><span class="num" id="5457885">2</span><span class="op" id="5457886">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457889">p</span><span class="op" id="5457890">.</span><span class="ident" id="5457891">stack</span>&nbsp;<span class="op" id="5457897">=</span>&nbsp;<span class="ident" id="5457899">p</span><span class="op" id="5457900">.</span><span class="ident" id="5457901">stack</span><span class="op" id="5457906">[</span><span class="op" id="5457907">:</span><span class="ident" id="5457908">n</span><span class="op" id="5457909">-</span><span class="num" id="5457910">2</span><span class="op" id="5457911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457914">if</span>&nbsp;<span class="ident" id="5457917">re2</span><span class="op" id="5457920">.</span><span class="ident" id="5457921">Op</span>&nbsp;<span class="op" id="5457924">!=</span>&nbsp;<span class="ident" id="5457927">opLeftParen</span>&nbsp;<span class="op" id="5457939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457943">return</span>&nbsp;<span class="op" id="5457950">&amp;</span><span class="ident" id="5457951">Error</span><span class="op" id="5457956">{</span><span class="ident" id="5457957">ErrUnexpectedParen</span><span class="op" id="5457975">,</span>&nbsp;<span class="ident" id="5457977">p</span><span class="op" id="5457978">.</span><span class="ident" id="5457979">wholeRegexp</span><span class="op" id="5457990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457996">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458032">p</span><span class="op" id="5458033">.</span><span class="ident" id="5458034">flags</span>&nbsp;<span class="op" id="5458040">=</span>&nbsp;<span class="ident" id="5458042">re2</span><span class="op" id="5458045">.</span><span class="ident" id="5458046">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458053">if</span>&nbsp;<span class="ident" id="5458056">re2</span><span class="op" id="5458059">.</span><span class="ident" id="5458060">Cap</span>&nbsp;<span class="op" id="5458064">==</span>&nbsp;<span class="num" id="5458067">0</span>&nbsp;<span class="op" id="5458069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458073">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458097">p</span><span class="op" id="5458098">.</span><span class="ident" id="5458099">push</span><span class="op" id="5458103">(</span><span class="ident" id="5458104">re1</span><span class="op" id="5458107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458110">}</span>&nbsp;<span class="keyword" id="5458112">else</span>&nbsp;<span class="op" id="5458117">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458121">re2</span><span class="op" id="5458124">.</span><span class="ident" id="5458125">Op</span>&nbsp;<span class="op" id="5458128">=</span>&nbsp;<span class="ident" id="5458130">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458142">re2</span><span class="op" id="5458145">.</span><span class="ident" id="5458146">Sub</span>&nbsp;<span class="op" id="5458150">=</span>&nbsp;<span class="ident" id="5458152">re2</span><span class="op" id="5458155">.</span><span class="ident" id="5458156">Sub0</span><span class="op" id="5458160">[</span><span class="op" id="5458161">:</span><span class="num" id="5458162">1</span><span class="op" id="5458163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458167">re2</span><span class="op" id="5458170">.</span><span class="ident" id="5458171">Sub</span><span class="op" id="5458174">[</span><span class="num" id="5458175">0</span><span class="op" id="5458176">]</span>&nbsp;<span class="op" id="5458178">=</span>&nbsp;<span class="ident" id="5458180">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458186">p</span><span class="op" id="5458187">.</span><span class="ident" id="5458188">push</span><span class="op" id="5458192">(</span><span class="ident" id="5458193">re2</span><span class="op" id="5458196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458199">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458202">return</span>&nbsp;<span class="ident" id="5458209">nil</span><br>
<span class="lineno"></span><span class="op" id="5458213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5458216">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5458279">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5458304">func</span>&nbsp;<span class="op" id="5458309">(</span><span class="ident" id="5458310">p</span>&nbsp;<span class="op" id="5458312">*</span><span class="ident" id="5458313">parser</span><span class="op" id="5458319">)</span>&nbsp;<span class="ident" id="5458321">parseEscape</span><span class="op" id="5458332">(</span><span class="ident" id="5458333">s</span>&nbsp;<span class="builtintype" id="5458335">string</span><span class="op" id="5458341">)</span>&nbsp;<span class="op" id="5458343">(</span><span class="ident" id="5458344">r</span>&nbsp;<span class="builtintype" id="5458346">rune</span><span class="op" id="5458350">,</span>&nbsp;<span class="ident" id="5458352">rest</span>&nbsp;<span class="builtintype" id="5458357">string</span><span class="op" id="5458363">,</span>&nbsp;<span class="ident" id="5458365">err</span>&nbsp;<span class="builtintype" id="5458369">error</span><span class="op" id="5458374">)</span>&nbsp;<span class="op" id="5458376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458379">t</span>&nbsp;<span class="op" id="5458381">:=</span>&nbsp;<span class="ident" id="5458384">s</span><span class="op" id="5458385">[</span><span class="num" id="5458386">1</span><span class="op" id="5458387">:</span><span class="op" id="5458388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458391">if</span>&nbsp;<span class="ident" id="5458394">t</span>&nbsp;<span class="op" id="5458396">==</span>&nbsp;<span class="string" id="5458399">&#34;&#34;</span>&nbsp;<span class="op" id="5458402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458406">return</span>&nbsp;<span class="num" id="5458413">0</span><span class="op" id="5458414">,</span>&nbsp;<span class="string" id="5458416">&#34;&#34;</span><span class="op" id="5458418">,</span>&nbsp;<span class="op" id="5458420">&amp;</span><span class="ident" id="5458421">Error</span><span class="op" id="5458426">{</span><span class="ident" id="5458427">ErrTrailingBackslash</span><span class="op" id="5458447">,</span>&nbsp;<span class="string" id="5458449">&#34;&#34;</span><span class="op" id="5458451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458454">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458457">c</span><span class="op" id="5458458">,</span>&nbsp;<span class="ident" id="5458460">t</span><span class="op" id="5458461">,</span>&nbsp;<span class="ident" id="5458463">err</span>&nbsp;<span class="op" id="5458467">:=</span>&nbsp;<span class="ident" id="5458470">nextRune</span><span class="op" id="5458478">(</span><span class="ident" id="5458479">t</span><span class="op" id="5458480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458483">if</span>&nbsp;<span class="ident" id="5458486">err</span>&nbsp;<span class="op" id="5458490">!=</span>&nbsp;<span class="ident" id="5458493">nil</span>&nbsp;<span class="op" id="5458497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458501">return</span>&nbsp;<span class="num" id="5458508">0</span><span class="op" id="5458509">,</span>&nbsp;<span class="string" id="5458511">&#34;&#34;</span><span class="op" id="5458513">,</span>&nbsp;<span class="ident" id="5458515">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5458523">Switch</span><span class="op" id="5458529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458532">switch</span>&nbsp;<span class="ident" id="5458539">c</span>&nbsp;<span class="op" id="5458541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458544">default</span><span class="op" id="5458551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458555">if</span>&nbsp;<span class="ident" id="5458558">c</span>&nbsp;<span class="op" id="5458560">&lt;</span>&nbsp;<span class="ident" id="5458562">utf8</span><span class="op" id="5458566">.</span><span class="ident" id="5458567">RuneSelf</span>&nbsp;<span class="op" id="5458576">&amp;&amp;</span>&nbsp;<span class="op" id="5458579">!</span><span class="ident" id="5458580">isalnum</span><span class="op" id="5458587">(</span><span class="ident" id="5458588">c</span><span class="op" id="5458589">)</span>&nbsp;<span class="op" id="5458591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458596">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458653">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458713">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458772">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458831">return</span>&nbsp;<span class="ident" id="5458838">c</span><span class="op" id="5458839">,</span>&nbsp;<span class="ident" id="5458841">t</span><span class="op" id="5458842">,</span>&nbsp;<span class="ident" id="5458844">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458850">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458854">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458873">case</span>&nbsp;<span class="string" id="5458878">&#39;1&#39;</span><span class="op" id="5458881">,</span>&nbsp;<span class="string" id="5458883">&#39;2&#39;</span><span class="op" id="5458886">,</span>&nbsp;<span class="string" id="5458888">&#39;3&#39;</span><span class="op" id="5458891">,</span>&nbsp;<span class="string" id="5458893">&#39;4&#39;</span><span class="op" id="5458896">,</span>&nbsp;<span class="string" id="5458898">&#39;5&#39;</span><span class="op" id="5458901">,</span>&nbsp;<span class="string" id="5458903">&#39;6&#39;</span><span class="op" id="5458906">,</span>&nbsp;<span class="string" id="5458908">&#39;7&#39;</span><span class="op" id="5458911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458915">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458976">if</span>&nbsp;<span class="ident" id="5458979">t</span>&nbsp;<span class="op" id="5458981">==</span>&nbsp;<span class="string" id="5458984">&#34;&#34;</span>&nbsp;<span class="op" id="5458987">||</span>&nbsp;<span class="ident" id="5458990">t</span><span class="op" id="5458991">[</span><span class="num" id="5458992">0</span><span class="op" id="5458993">]</span>&nbsp;<span class="op" id="5458995">&lt;</span>&nbsp;<span class="string" id="5458997">&#39;0&#39;</span>&nbsp;<span class="op" id="5459001">||</span>&nbsp;<span class="ident" id="5459004">t</span><span class="op" id="5459005">[</span><span class="num" id="5459006">0</span><span class="op" id="5459007">]</span>&nbsp;<span class="op" id="5459009">&gt;</span>&nbsp;<span class="string" id="5459011">&#39;7&#39;</span>&nbsp;<span class="op" id="5459015">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459020">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459032">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459045">case</span>&nbsp;<span class="string" id="5459050">&#39;0&#39;</span><span class="op" id="5459053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459057">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459114">r</span>&nbsp;<span class="op" id="5459116">=</span>&nbsp;<span class="ident" id="5459118">c</span>&nbsp;<span class="op" id="5459120">-</span>&nbsp;<span class="string" id="5459122">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459128">for</span>&nbsp;<span class="ident" id="5459132">i</span>&nbsp;<span class="op" id="5459134">:=</span>&nbsp;<span class="num" id="5459137">1</span><span class="op" id="5459138">;</span>&nbsp;<span class="ident" id="5459140">i</span>&nbsp;<span class="op" id="5459142">&lt;</span>&nbsp;<span class="num" id="5459144">3</span><span class="op" id="5459145">;</span>&nbsp;<span class="ident" id="5459147">i</span><span class="op" id="5459148">++</span>&nbsp;<span class="op" id="5459151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459156">if</span>&nbsp;<span class="ident" id="5459159">t</span>&nbsp;<span class="op" id="5459161">==</span>&nbsp;<span class="string" id="5459164">&#34;&#34;</span>&nbsp;<span class="op" id="5459167">||</span>&nbsp;<span class="ident" id="5459170">t</span><span class="op" id="5459171">[</span><span class="num" id="5459172">0</span><span class="op" id="5459173">]</span>&nbsp;<span class="op" id="5459175">&lt;</span>&nbsp;<span class="string" id="5459177">&#39;0&#39;</span>&nbsp;<span class="op" id="5459181">||</span>&nbsp;<span class="ident" id="5459184">t</span><span class="op" id="5459185">[</span><span class="num" id="5459186">0</span><span class="op" id="5459187">]</span>&nbsp;<span class="op" id="5459189">&gt;</span>&nbsp;<span class="string" id="5459191">&#39;7&#39;</span>&nbsp;<span class="op" id="5459195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459201">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459210">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459215">r</span>&nbsp;<span class="op" id="5459217">=</span>&nbsp;<span class="ident" id="5459219">r</span><span class="op" id="5459220">*</span><span class="num" id="5459221">8</span>&nbsp;<span class="op" id="5459223">+</span>&nbsp;<span class="builtintype" id="5459225">rune</span><span class="op" id="5459229">(</span><span class="ident" id="5459230">t</span><span class="op" id="5459231">[</span><span class="num" id="5459232">0</span><span class="op" id="5459233">]</span><span class="op" id="5459234">)</span>&nbsp;<span class="op" id="5459236">-</span>&nbsp;<span class="string" id="5459238">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459245">t</span>&nbsp;<span class="op" id="5459247">=</span>&nbsp;<span class="ident" id="5459249">t</span><span class="op" id="5459250">[</span><span class="num" id="5459251">1</span><span class="op" id="5459252">:</span><span class="op" id="5459253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459261">return</span>&nbsp;<span class="ident" id="5459268">r</span><span class="op" id="5459269">,</span>&nbsp;<span class="ident" id="5459271">t</span><span class="op" id="5459272">,</span>&nbsp;<span class="ident" id="5459274">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459280">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459305">case</span>&nbsp;<span class="string" id="5459310">&#39;x&#39;</span><span class="op" id="5459313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459317">if</span>&nbsp;<span class="ident" id="5459320">t</span>&nbsp;<span class="op" id="5459322">==</span>&nbsp;<span class="string" id="5459325">&#34;&#34;</span>&nbsp;<span class="op" id="5459328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459333">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459341">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459345">if</span>&nbsp;<span class="ident" id="5459348">c</span><span class="op" id="5459349">,</span>&nbsp;<span class="ident" id="5459351">t</span><span class="op" id="5459352">,</span>&nbsp;<span class="ident" id="5459354">err</span>&nbsp;<span class="op" id="5459358">=</span>&nbsp;<span class="ident" id="5459360">nextRune</span><span class="op" id="5459368">(</span><span class="ident" id="5459369">t</span><span class="op" id="5459370">)</span><span class="op" id="5459371">;</span>&nbsp;<span class="ident" id="5459373">err</span>&nbsp;<span class="op" id="5459377">!=</span>&nbsp;<span class="ident" id="5459380">nil</span>&nbsp;<span class="op" id="5459384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459389">return</span>&nbsp;<span class="num" id="5459396">0</span><span class="op" id="5459397">,</span>&nbsp;<span class="string" id="5459399">&#34;&#34;</span><span class="op" id="5459401">,</span>&nbsp;<span class="ident" id="5459403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459413">if</span>&nbsp;<span class="ident" id="5459416">c</span>&nbsp;<span class="op" id="5459418">==</span>&nbsp;<span class="string" id="5459421">&#39;{&#39;</span>&nbsp;<span class="op" id="5459425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459430">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459468">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459524">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459590">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459614">nhex</span>&nbsp;<span class="op" id="5459619">:=</span>&nbsp;<span class="num" id="5459622">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459627">r</span>&nbsp;<span class="op" id="5459629">=</span>&nbsp;<span class="num" id="5459631">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459636">for</span>&nbsp;<span class="op" id="5459640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459646">if</span>&nbsp;<span class="ident" id="5459649">t</span>&nbsp;<span class="op" id="5459651">==</span>&nbsp;<span class="string" id="5459654">&#34;&#34;</span>&nbsp;<span class="op" id="5459657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459664">break</span>&nbsp;<span class="ident" id="5459670">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459687">if</span>&nbsp;<span class="ident" id="5459690">c</span><span class="op" id="5459691">,</span>&nbsp;<span class="ident" id="5459693">t</span><span class="op" id="5459694">,</span>&nbsp;<span class="ident" id="5459696">err</span>&nbsp;<span class="op" id="5459700">=</span>&nbsp;<span class="ident" id="5459702">nextRune</span><span class="op" id="5459710">(</span><span class="ident" id="5459711">t</span><span class="op" id="5459712">)</span><span class="op" id="5459713">;</span>&nbsp;<span class="ident" id="5459715">err</span>&nbsp;<span class="op" id="5459719">!=</span>&nbsp;<span class="ident" id="5459722">nil</span>&nbsp;<span class="op" id="5459726">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459733">return</span>&nbsp;<span class="num" id="5459740">0</span><span class="op" id="5459741">,</span>&nbsp;<span class="string" id="5459743">&#34;&#34;</span><span class="op" id="5459745">,</span>&nbsp;<span class="ident" id="5459747">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459761">if</span>&nbsp;<span class="ident" id="5459764">c</span>&nbsp;<span class="op" id="5459766">==</span>&nbsp;<span class="string" id="5459769">&#39;}&#39;</span>&nbsp;<span class="op" id="5459773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459790">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459796">v</span>&nbsp;<span class="op" id="5459798">:=</span>&nbsp;<span class="ident" id="5459801">unhex</span><span class="op" id="5459806">(</span><span class="ident" id="5459807">c</span><span class="op" id="5459808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459814">if</span>&nbsp;<span class="ident" id="5459817">v</span>&nbsp;<span class="op" id="5459819">&lt;</span>&nbsp;<span class="num" id="5459821">0</span>&nbsp;<span class="op" id="5459823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459830">break</span>&nbsp;<span class="ident" id="5459836">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459853">r</span>&nbsp;<span class="op" id="5459855">=</span>&nbsp;<span class="ident" id="5459857">r</span><span class="op" id="5459858">*</span><span class="num" id="5459859">16</span>&nbsp;<span class="op" id="5459862">+</span>&nbsp;<span class="ident" id="5459864">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459870">if</span>&nbsp;<span class="ident" id="5459873">r</span>&nbsp;<span class="op" id="5459875">&gt;</span>&nbsp;<span class="ident" id="5459877">unicode</span><span class="op" id="5459884">.</span><span class="ident" id="5459885">MaxRune</span>&nbsp;<span class="op" id="5459893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459900">break</span>&nbsp;<span class="ident" id="5459906">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459923">nhex</span><span class="op" id="5459927">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459933">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459938">if</span>&nbsp;<span class="ident" id="5459941">nhex</span>&nbsp;<span class="op" id="5459946">==</span>&nbsp;<span class="num" id="5459949">0</span>&nbsp;<span class="op" id="5459951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459957">break</span>&nbsp;<span class="ident" id="5459963">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459978">return</span>&nbsp;<span class="ident" id="5459985">r</span><span class="op" id="5459986">,</span>&nbsp;<span class="ident" id="5459988">t</span><span class="op" id="5459989">,</span>&nbsp;<span class="ident" id="5459991">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459997">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460002">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460034">x</span>&nbsp;<span class="op" id="5460036">:=</span>&nbsp;<span class="ident" id="5460039">unhex</span><span class="op" id="5460044">(</span><span class="ident" id="5460045">c</span><span class="op" id="5460046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460050">if</span>&nbsp;<span class="ident" id="5460053">c</span><span class="op" id="5460054">,</span>&nbsp;<span class="ident" id="5460056">t</span><span class="op" id="5460057">,</span>&nbsp;<span class="ident" id="5460059">err</span>&nbsp;<span class="op" id="5460063">=</span>&nbsp;<span class="ident" id="5460065">nextRune</span><span class="op" id="5460073">(</span><span class="ident" id="5460074">t</span><span class="op" id="5460075">)</span><span class="op" id="5460076">;</span>&nbsp;<span class="ident" id="5460078">err</span>&nbsp;<span class="op" id="5460082">!=</span>&nbsp;<span class="ident" id="5460085">nil</span>&nbsp;<span class="op" id="5460089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460094">return</span>&nbsp;<span class="num" id="5460101">0</span><span class="op" id="5460102">,</span>&nbsp;<span class="string" id="5460104">&#34;&#34;</span><span class="op" id="5460106">,</span>&nbsp;<span class="ident" id="5460108">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460118">y</span>&nbsp;<span class="op" id="5460120">:=</span>&nbsp;<span class="ident" id="5460123">unhex</span><span class="op" id="5460128">(</span><span class="ident" id="5460129">c</span><span class="op" id="5460130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460134">if</span>&nbsp;<span class="ident" id="5460137">x</span>&nbsp;<span class="op" id="5460139">&lt;</span>&nbsp;<span class="num" id="5460141">0</span>&nbsp;<span class="op" id="5460143">||</span>&nbsp;<span class="ident" id="5460146">y</span>&nbsp;<span class="op" id="5460148">&lt;</span>&nbsp;<span class="num" id="5460150">0</span>&nbsp;<span class="op" id="5460152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460157">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460165">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460169">return</span>&nbsp;<span class="ident" id="5460176">x</span><span class="op" id="5460177">*</span><span class="num" id="5460178">16</span>&nbsp;<span class="op" id="5460181">+</span>&nbsp;<span class="ident" id="5460183">y</span><span class="op" id="5460184">,</span>&nbsp;<span class="ident" id="5460186">t</span><span class="op" id="5460187">,</span>&nbsp;<span class="ident" id="5460189">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460195">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460253">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460305">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460364">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460420">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460475">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460502">case</span>&nbsp;<span class="string" id="5460507">&#39;a&#39;</span><span class="op" id="5460510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460514">return</span>&nbsp;<span class="string" id="5460521">&#39;\a&#39;</span><span class="op" id="5460525">,</span>&nbsp;<span class="ident" id="5460527">t</span><span class="op" id="5460528">,</span>&nbsp;<span class="ident" id="5460530">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460535">case</span>&nbsp;<span class="string" id="5460540">&#39;f&#39;</span><span class="op" id="5460543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460547">return</span>&nbsp;<span class="string" id="5460554">&#39;\f&#39;</span><span class="op" id="5460558">,</span>&nbsp;<span class="ident" id="5460560">t</span><span class="op" id="5460561">,</span>&nbsp;<span class="ident" id="5460563">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460568">case</span>&nbsp;<span class="string" id="5460573">&#39;n&#39;</span><span class="op" id="5460576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460580">return</span>&nbsp;<span class="string" id="5460587">&#39;\n&#39;</span><span class="op" id="5460591">,</span>&nbsp;<span class="ident" id="5460593">t</span><span class="op" id="5460594">,</span>&nbsp;<span class="ident" id="5460596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460601">case</span>&nbsp;<span class="string" id="5460606">&#39;r&#39;</span><span class="op" id="5460609">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460613">return</span>&nbsp;<span class="string" id="5460620">&#39;\r&#39;</span><span class="op" id="5460624">,</span>&nbsp;<span class="ident" id="5460626">t</span><span class="op" id="5460627">,</span>&nbsp;<span class="ident" id="5460629">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460634">case</span>&nbsp;<span class="string" id="5460639">&#39;t&#39;</span><span class="op" id="5460642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460646">return</span>&nbsp;<span class="string" id="5460653">&#39;\t&#39;</span><span class="op" id="5460657">,</span>&nbsp;<span class="ident" id="5460659">t</span><span class="op" id="5460660">,</span>&nbsp;<span class="ident" id="5460662">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460667">case</span>&nbsp;<span class="string" id="5460672">&#39;v&#39;</span><span class="op" id="5460675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460679">return</span>&nbsp;<span class="string" id="5460686">&#39;\v&#39;</span><span class="op" id="5460690">,</span>&nbsp;<span class="ident" id="5460692">t</span><span class="op" id="5460693">,</span>&nbsp;<span class="ident" id="5460695">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460703">return</span>&nbsp;<span class="num" id="5460710">0</span><span class="op" id="5460711">,</span>&nbsp;<span class="string" id="5460713">&#34;&#34;</span><span class="op" id="5460715">,</span>&nbsp;<span class="op" id="5460717">&amp;</span><span class="ident" id="5460718">Error</span><span class="op" id="5460723">{</span><span class="ident" id="5460724">ErrInvalidEscape</span><span class="op" id="5460740">,</span>&nbsp;<span class="ident" id="5460742">s</span><span class="op" id="5460743">[</span><span class="op" id="5460744">:</span><span class="builtinfunc" id="5460745">len</span><span class="op" id="5460748">(</span><span class="ident" id="5460749">s</span><span class="op" id="5460750">)</span><span class="op" id="5460751">-</span><span class="builtinfunc" id="5460752">len</span><span class="op" id="5460755">(</span><span class="ident" id="5460756">t</span><span class="op" id="5460757">)</span><span class="op" id="5460758">]</span><span class="op" id="5460759">}</span><br>
<span class="lineno"></span><span class="op" id="5460761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5460764">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5460839">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5460858">func</span>&nbsp;<span class="op" id="5460863">(</span><span class="ident" id="5460864">p</span>&nbsp;<span class="op" id="5460866">*</span><span class="ident" id="5460867">parser</span><span class="op" id="5460873">)</span>&nbsp;<span class="ident" id="5460875">parseClassChar</span><span class="op" id="5460889">(</span><span class="ident" id="5460890">s</span><span class="op" id="5460891">,</span>&nbsp;<span class="ident" id="5460893">wholeClass</span>&nbsp;<span class="builtintype" id="5460904">string</span><span class="op" id="5460910">)</span>&nbsp;<span class="op" id="5460912">(</span><span class="ident" id="5460913">r</span>&nbsp;<span class="builtintype" id="5460915">rune</span><span class="op" id="5460919">,</span>&nbsp;<span class="ident" id="5460921">rest</span>&nbsp;<span class="builtintype" id="5460926">string</span><span class="op" id="5460932">,</span>&nbsp;<span class="ident" id="5460934">err</span>&nbsp;<span class="builtintype" id="5460938">error</span><span class="op" id="5460943">)</span>&nbsp;<span class="op" id="5460945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460948">if</span>&nbsp;<span class="ident" id="5460951">s</span>&nbsp;<span class="op" id="5460953">==</span>&nbsp;<span class="string" id="5460956">&#34;&#34;</span>&nbsp;<span class="op" id="5460959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460963">return</span>&nbsp;<span class="num" id="5460970">0</span><span class="op" id="5460971">,</span>&nbsp;<span class="string" id="5460973">&#34;&#34;</span><span class="op" id="5460975">,</span>&nbsp;<span class="op" id="5460977">&amp;</span><span class="ident" id="5460978">Error</span><span class="op" id="5460983">{</span><span class="ident" id="5460984">Code</span><span class="op" id="5460988">:</span>&nbsp;<span class="ident" id="5460990">ErrMissingBracket</span><span class="op" id="5461007">,</span>&nbsp;<span class="ident" id="5461009">Expr</span><span class="op" id="5461013">:</span>&nbsp;<span class="ident" id="5461015">wholeClass</span><span class="op" id="5461025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461028">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5461032">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5461079">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461125">if</span>&nbsp;<span class="ident" id="5461128">s</span><span class="op" id="5461129">[</span><span class="num" id="5461130">0</span><span class="op" id="5461131">]</span>&nbsp;<span class="op" id="5461133">==</span>&nbsp;<span class="string" id="5461136">&#39;\\&#39;</span>&nbsp;<span class="op" id="5461141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461145">return</span>&nbsp;<span class="ident" id="5461152">p</span><span class="op" id="5461153">.</span><span class="ident" id="5461154">parseEscape</span><span class="op" id="5461165">(</span><span class="ident" id="5461166">s</span><span class="op" id="5461167">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461174">return</span>&nbsp;<span class="ident" id="5461181">nextRune</span><span class="op" id="5461189">(</span><span class="ident" id="5461190">s</span><span class="op" id="5461191">)</span><br>
<span class="lineno"></span><span class="op" id="5461193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5461196">type</span>&nbsp;<span class="ident" id="5461201">charGroup</span>&nbsp;<span class="keyword" id="5461211">struct</span>&nbsp;<span class="op" id="5461218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461221">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5461227">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461232">class</span>&nbsp;<span class="op" id="5461238">[</span><span class="op" id="5461239">]</span><span class="builtintype" id="5461240">rune</span><br>
<span class="lineno"></span><span class="op" id="5461245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5461248">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5461325">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5461404">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5461468">func</span>&nbsp;<span class="op" id="5461473">(</span><span class="ident" id="5461474">p</span>&nbsp;<span class="op" id="5461476">*</span><span class="ident" id="5461477">parser</span><span class="op" id="5461483">)</span>&nbsp;<span class="ident" id="5461485">parsePerlClassEscape</span><span class="op" id="5461505">(</span><span class="ident" id="5461506">s</span>&nbsp;<span class="builtintype" id="5461508">string</span><span class="op" id="5461514">,</span>&nbsp;<span class="ident" id="5461516">r</span>&nbsp;<span class="op" id="5461518">[</span><span class="op" id="5461519">]</span><span class="builtintype" id="5461520">rune</span><span class="op" id="5461524">)</span>&nbsp;<span class="op" id="5461526">(</span><span class="ident" id="5461527">out</span>&nbsp;<span class="op" id="5461531">[</span><span class="op" id="5461532">]</span><span class="builtintype" id="5461533">rune</span><span class="op" id="5461537">,</span>&nbsp;<span class="ident" id="5461539">rest</span>&nbsp;<span class="builtintype" id="5461544">string</span><span class="op" id="5461550">)</span>&nbsp;<span class="op" id="5461552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461555">if</span>&nbsp;<span class="ident" id="5461558">p</span><span class="op" id="5461559">.</span><span class="ident" id="5461560">flags</span><span class="op" id="5461565">&amp;</span><span class="ident" id="5461566">PerlX</span>&nbsp;<span class="op" id="5461572">==</span>&nbsp;<span class="num" id="5461575">0</span>&nbsp;<span class="op" id="5461577">||</span>&nbsp;<span class="builtinfunc" id="5461580">len</span><span class="op" id="5461583">(</span><span class="ident" id="5461584">s</span><span class="op" id="5461585">)</span>&nbsp;<span class="op" id="5461587">&lt;</span>&nbsp;<span class="num" id="5461589">2</span>&nbsp;<span class="op" id="5461591">||</span>&nbsp;<span class="ident" id="5461594">s</span><span class="op" id="5461595">[</span><span class="num" id="5461596">0</span><span class="op" id="5461597">]</span>&nbsp;<span class="op" id="5461599">!=</span>&nbsp;<span class="string" id="5461602">&#39;\\&#39;</span>&nbsp;<span class="op" id="5461607">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461622">g</span>&nbsp;<span class="op" id="5461624">:=</span>&nbsp;<span class="ident" id="5461627">perlGroup</span><span class="op" id="5461636">[</span><span class="ident" id="5461637">s</span><span class="op" id="5461638">[</span><span class="num" id="5461639">0</span><span class="op" id="5461640">:</span><span class="num" id="5461641">2</span><span class="op" id="5461642">]</span><span class="op" id="5461643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461646">if</span>&nbsp;<span class="ident" id="5461649">g</span><span class="op" id="5461650">.</span><span class="ident" id="5461651">sign</span>&nbsp;<span class="op" id="5461656">==</span>&nbsp;<span class="num" id="5461659">0</span>&nbsp;<span class="op" id="5461661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461665">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461676">return</span>&nbsp;<span class="ident" id="5461683">p</span><span class="op" id="5461684">.</span><span class="ident" id="5461685">appendGroup</span><span class="op" id="5461696">(</span><span class="ident" id="5461697">r</span><span class="op" id="5461698">,</span>&nbsp;<span class="ident" id="5461700">g</span><span class="op" id="5461701">)</span><span class="op" id="5461702">,</span>&nbsp;<span class="ident" id="5461704">s</span><span class="op" id="5461705">[</span><span class="num" id="5461706">2</span><span class="op" id="5461707">:</span><span class="op" id="5461708">]</span><br>
<span class="lineno"></span><span class="op" id="5461710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461713">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5461792">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5461871">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5461935">func</span>&nbsp;<span class="op" id="5461940">(</span><span class="ident" id="5461941">p</span>&nbsp;<span class="op" id="5461943">*</span><span class="ident" id="5461944">parser</span><span class="op" id="5461950">)</span>&nbsp;<span class="ident" id="5461952">parseNamedClass</span><span class="op" id="5461967">(</span><span class="ident" id="5461968">s</span>&nbsp;<span class="builtintype" id="5461970">string</span><span class="op" id="5461976">,</span>&nbsp;<span class="ident" id="5461978">r</span>&nbsp;<span class="op" id="5461980">[</span><span class="op" id="5461981">]</span><span class="builtintype" id="5461982">rune</span><span class="op" id="5461986">)</span>&nbsp;<span class="op" id="5461988">(</span><span class="ident" id="5461989">out</span>&nbsp;<span class="op" id="5461993">[</span><span class="op" id="5461994">]</span><span class="builtintype" id="5461995">rune</span><span class="op" id="5461999">,</span>&nbsp;<span class="ident" id="5462001">rest</span>&nbsp;<span class="builtintype" id="5462006">string</span><span class="op" id="5462012">,</span>&nbsp;<span class="ident" id="5462014">err</span>&nbsp;<span class="builtintype" id="5462018">error</span><span class="op" id="5462023">)</span>&nbsp;<span class="op" id="5462025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462028">if</span>&nbsp;<span class="builtinfunc" id="5462031">len</span><span class="op" id="5462034">(</span><span class="ident" id="5462035">s</span><span class="op" id="5462036">)</span>&nbsp;<span class="op" id="5462038">&lt;</span>&nbsp;<span class="num" id="5462040">2</span>&nbsp;<span class="op" id="5462042">||</span>&nbsp;<span class="ident" id="5462045">s</span><span class="op" id="5462046">[</span><span class="num" id="5462047">0</span><span class="op" id="5462048">]</span>&nbsp;<span class="op" id="5462050">!=</span>&nbsp;<span class="string" id="5462053">&#39;[&#39;</span>&nbsp;<span class="op" id="5462057">||</span>&nbsp;<span class="ident" id="5462060">s</span><span class="op" id="5462061">[</span><span class="num" id="5462062">1</span><span class="op" id="5462063">]</span>&nbsp;<span class="op" id="5462065">!=</span>&nbsp;<span class="string" id="5462068">&#39;:&#39;</span>&nbsp;<span class="op" id="5462072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462076">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462088">i</span>&nbsp;<span class="op" id="5462090">:=</span>&nbsp;<span class="ident" id="5462093">strings</span><span class="op" id="5462100">.</span><span class="ident" id="5462101">Index</span><span class="op" id="5462106">(</span><span class="ident" id="5462107">s</span><span class="op" id="5462108">[</span><span class="num" id="5462109">2</span><span class="op" id="5462110">:</span><span class="op" id="5462111">]</span><span class="op" id="5462112">,</span>&nbsp;<span class="string" id="5462114">&#34;:]&#34;</span><span class="op" id="5462118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462121">if</span>&nbsp;<span class="ident" id="5462124">i</span>&nbsp;<span class="op" id="5462126">&lt;</span>&nbsp;<span class="num" id="5462128">0</span>&nbsp;<span class="op" id="5462130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462134">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462145">i</span>&nbsp;<span class="op" id="5462147">+=</span>&nbsp;<span class="num" id="5462150">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462153">name</span><span class="op" id="5462157">,</span>&nbsp;<span class="ident" id="5462159">s</span>&nbsp;<span class="op" id="5462161">:=</span>&nbsp;<span class="ident" id="5462164">s</span><span class="op" id="5462165">[</span><span class="num" id="5462166">0</span><span class="op" id="5462167">:</span><span class="ident" id="5462168">i</span><span class="op" id="5462169">+</span><span class="num" id="5462170">2</span><span class="op" id="5462171">]</span><span class="op" id="5462172">,</span>&nbsp;<span class="ident" id="5462174">s</span><span class="op" id="5462175">[</span><span class="ident" id="5462176">i</span><span class="op" id="5462177">+</span><span class="num" id="5462178">2</span><span class="op" id="5462179">:</span><span class="op" id="5462180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462183">g</span>&nbsp;<span class="op" id="5462185">:=</span>&nbsp;<span class="ident" id="5462188">posixGroup</span><span class="op" id="5462198">[</span><span class="ident" id="5462199">name</span><span class="op" id="5462203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462206">if</span>&nbsp;<span class="ident" id="5462209">g</span><span class="op" id="5462210">.</span><span class="ident" id="5462211">sign</span>&nbsp;<span class="op" id="5462216">==</span>&nbsp;<span class="num" id="5462219">0</span>&nbsp;<span class="op" id="5462221">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462225">return</span>&nbsp;<span class="ident" id="5462232">nil</span><span class="op" id="5462235">,</span>&nbsp;<span class="string" id="5462237">&#34;&#34;</span><span class="op" id="5462239">,</span>&nbsp;<span class="op" id="5462241">&amp;</span><span class="ident" id="5462242">Error</span><span class="op" id="5462247">{</span><span class="ident" id="5462248">ErrInvalidCharRange</span><span class="op" id="5462267">,</span>&nbsp;<span class="ident" id="5462269">name</span><span class="op" id="5462273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462279">return</span>&nbsp;<span class="ident" id="5462286">p</span><span class="op" id="5462287">.</span><span class="ident" id="5462288">appendGroup</span><span class="op" id="5462299">(</span><span class="ident" id="5462300">r</span><span class="op" id="5462301">,</span>&nbsp;<span class="ident" id="5462303">g</span><span class="op" id="5462304">)</span><span class="op" id="5462305">,</span>&nbsp;<span class="ident" id="5462307">s</span><span class="op" id="5462308">,</span>&nbsp;<span class="ident" id="5462310">nil</span><br>
<span class="lineno"></span><span class="op" id="5462314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5462317">func</span>&nbsp;<span class="op" id="5462322">(</span><span class="ident" id="5462323">p</span>&nbsp;<span class="op" id="5462325">*</span><span class="ident" id="5462326">parser</span><span class="op" id="5462332">)</span>&nbsp;<span class="ident" id="5462334">appendGroup</span><span class="op" id="5462345">(</span><span class="ident" id="5462346">r</span>&nbsp;<span class="op" id="5462348">[</span><span class="op" id="5462349">]</span><span class="builtintype" id="5462350">rune</span><span class="op" id="5462354">,</span>&nbsp;<span class="ident" id="5462356">g</span>&nbsp;<span class="ident" id="5462358">charGroup</span><span class="op" id="5462367">)</span>&nbsp;<span class="op" id="5462369">[</span><span class="op" id="5462370">]</span><span class="builtintype" id="5462371">rune</span>&nbsp;<span class="op" id="5462376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462379">if</span>&nbsp;<span class="ident" id="5462382">p</span><span class="op" id="5462383">.</span><span class="ident" id="5462384">flags</span><span class="op" id="5462389">&amp;</span><span class="ident" id="5462390">FoldCase</span>&nbsp;<span class="op" id="5462399">==</span>&nbsp;<span class="num" id="5462402">0</span>&nbsp;<span class="op" id="5462404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462408">if</span>&nbsp;<span class="ident" id="5462411">g</span><span class="op" id="5462412">.</span><span class="ident" id="5462413">sign</span>&nbsp;<span class="op" id="5462418">&lt;</span>&nbsp;<span class="num" id="5462420">0</span>&nbsp;<span class="op" id="5462422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462427">r</span>&nbsp;<span class="op" id="5462429">=</span>&nbsp;<span class="ident" id="5462431">appendNegatedClass</span><span class="op" id="5462449">(</span><span class="ident" id="5462450">r</span><span class="op" id="5462451">,</span>&nbsp;<span class="ident" id="5462453">g</span><span class="op" id="5462454">.</span><span class="ident" id="5462455">class</span><span class="op" id="5462460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462464">}</span>&nbsp;<span class="keyword" id="5462466">else</span>&nbsp;<span class="op" id="5462471">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462476">r</span>&nbsp;<span class="op" id="5462478">=</span>&nbsp;<span class="ident" id="5462480">appendClass</span><span class="op" id="5462491">(</span><span class="ident" id="5462492">r</span><span class="op" id="5462493">,</span>&nbsp;<span class="ident" id="5462495">g</span><span class="op" id="5462496">.</span><span class="ident" id="5462497">class</span><span class="op" id="5462502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462509">}</span>&nbsp;<span class="keyword" id="5462511">else</span>&nbsp;<span class="op" id="5462516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462520">tmp</span>&nbsp;<span class="op" id="5462524">:=</span>&nbsp;<span class="ident" id="5462527">p</span><span class="op" id="5462528">.</span><span class="ident" id="5462529">tmpClass</span><span class="op" id="5462537">[</span><span class="op" id="5462538">:</span><span class="num" id="5462539">0</span><span class="op" id="5462540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462544">tmp</span>&nbsp;<span class="op" id="5462548">=</span>&nbsp;<span class="ident" id="5462550">appendFoldedClass</span><span class="op" id="5462567">(</span><span class="ident" id="5462568">tmp</span><span class="op" id="5462571">,</span>&nbsp;<span class="ident" id="5462573">g</span><span class="op" id="5462574">.</span><span class="ident" id="5462575">class</span><span class="op" id="5462580">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462584">p</span><span class="op" id="5462585">.</span><span class="ident" id="5462586">tmpClass</span>&nbsp;<span class="op" id="5462595">=</span>&nbsp;<span class="ident" id="5462597">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462603">tmp</span>&nbsp;<span class="op" id="5462607">=</span>&nbsp;<span class="ident" id="5462609">cleanClass</span><span class="op" id="5462619">(</span><span class="op" id="5462620">&amp;</span><span class="ident" id="5462621">p</span><span class="op" id="5462622">.</span><span class="ident" id="5462623">tmpClass</span><span class="op" id="5462631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462635">if</span>&nbsp;<span class="ident" id="5462638">g</span><span class="op" id="5462639">.</span><span class="ident" id="5462640">sign</span>&nbsp;<span class="op" id="5462645">&lt;</span>&nbsp;<span class="num" id="5462647">0</span>&nbsp;<span class="op" id="5462649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462654">r</span>&nbsp;<span class="op" id="5462656">=</span>&nbsp;<span class="ident" id="5462658">appendNegatedClass</span><span class="op" id="5462676">(</span><span class="ident" id="5462677">r</span><span class="op" id="5462678">,</span>&nbsp;<span class="ident" id="5462680">tmp</span><span class="op" id="5462683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462687">}</span>&nbsp;<span class="keyword" id="5462689">else</span>&nbsp;<span class="op" id="5462694">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462699">r</span>&nbsp;<span class="op" id="5462701">=</span>&nbsp;<span class="ident" id="5462703">appendClass</span><span class="op" id="5462714">(</span><span class="ident" id="5462715">r</span><span class="op" id="5462716">,</span>&nbsp;<span class="ident" id="5462718">tmp</span><span class="op" id="5462721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462731">return</span>&nbsp;<span class="ident" id="5462738">r</span><br>
<span class="lineno"></span><span class="op" id="5462740">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5462743">var</span>&nbsp;<span class="ident" id="5462747">anyTable</span>&nbsp;<span class="op" id="5462756">=</span>&nbsp;<span class="op" id="5462758">&amp;</span><span class="ident" id="5462759">unicode</span><span class="op" id="5462766">.</span><span class="ident" id="5462767">RangeTable</span><span class="op" id="5462777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462780">R16</span><span class="op" id="5462783">:</span>&nbsp;<span class="op" id="5462785">[</span><span class="op" id="5462786">]</span><span class="ident" id="5462787">unicode</span><span class="op" id="5462794">.</span><span class="ident" id="5462795">Range16</span><span class="op" id="5462802">{</span><span class="op" id="5462803">{</span><span class="ident" id="5462804">Lo</span><span class="op" id="5462806">:</span>&nbsp;<span class="num" id="5462808">0</span><span class="op" id="5462809">,</span>&nbsp;<span class="ident" id="5462811">Hi</span><span class="op" id="5462813">:</span>&nbsp;<span class="num" id="5462815">1</span><span class="op" id="5462816">&lt;&lt;</span><span class="num" id="5462818">16</span>&nbsp;<span class="op" id="5462821">-</span>&nbsp;<span class="num" id="5462823">1</span><span class="op" id="5462824">,</span>&nbsp;<span class="ident" id="5462826">Stride</span><span class="op" id="5462832">:</span>&nbsp;<span class="num" id="5462834">1</span><span class="op" id="5462835">}</span><span class="op" id="5462836">}</span><span class="op" id="5462837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462840">R32</span><span class="op" id="5462843">:</span>&nbsp;<span class="op" id="5462845">[</span><span class="op" id="5462846">]</span><span class="ident" id="5462847">unicode</span><span class="op" id="5462854">.</span><span class="ident" id="5462855">Range32</span><span class="op" id="5462862">{</span><span class="op" id="5462863">{</span><span class="ident" id="5462864">Lo</span><span class="op" id="5462866">:</span>&nbsp;<span class="num" id="5462868">1</span>&nbsp;<span class="op" id="5462870">&lt;&lt;</span>&nbsp;<span class="num" id="5462873">16</span><span class="op" id="5462875">,</span>&nbsp;<span class="ident" id="5462877">Hi</span><span class="op" id="5462879">:</span>&nbsp;<span class="ident" id="5462881">unicode</span><span class="op" id="5462888">.</span><span class="ident" id="5462889">MaxRune</span><span class="op" id="5462896">,</span>&nbsp;<span class="ident" id="5462898">Stride</span><span class="op" id="5462904">:</span>&nbsp;<span class="num" id="5462906">1</span><span class="op" id="5462907">}</span><span class="op" id="5462908">}</span><span class="op" id="5462909">,</span><br>
<span class="lineno"></span><span class="op" id="5462911">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5462914">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5462980">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5463040">func</span>&nbsp;<span class="ident" id="5463045">unicodeTable</span><span class="op" id="5463057">(</span><span class="ident" id="5463058">name</span>&nbsp;<span class="builtintype" id="5463063">string</span><span class="op" id="5463069">)</span>&nbsp;<span class="op" id="5463071">(</span><span class="op" id="5463072">*</span><span class="ident" id="5463073">unicode</span><span class="op" id="5463080">.</span><span class="ident" id="5463081">RangeTable</span><span class="op" id="5463091">,</span>&nbsp;<span class="op" id="5463093">*</span><span class="ident" id="5463094">unicode</span><span class="op" id="5463101">.</span><span class="ident" id="5463102">RangeTable</span><span class="op" id="5463112">)</span>&nbsp;<span class="op" id="5463114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5463117">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463152">if</span>&nbsp;<span class="ident" id="5463155">name</span>&nbsp;<span class="op" id="5463160">==</span>&nbsp;<span class="string" id="5463163">&#34;Any&#34;</span>&nbsp;<span class="op" id="5463169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463173">return</span>&nbsp;<span class="ident" id="5463180">anyTable</span><span class="op" id="5463188">,</span>&nbsp;<span class="ident" id="5463190">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463203">if</span>&nbsp;<span class="ident" id="5463206">t</span>&nbsp;<span class="op" id="5463208">:=</span>&nbsp;<span class="ident" id="5463211">unicode</span><span class="op" id="5463218">.</span><span class="ident" id="5463219">Categories</span><span class="op" id="5463229">[</span><span class="ident" id="5463230">name</span><span class="op" id="5463234">]</span><span class="op" id="5463235">;</span>&nbsp;<span class="ident" id="5463237">t</span>&nbsp;<span class="op" id="5463239">!=</span>&nbsp;<span class="ident" id="5463242">nil</span>&nbsp;<span class="op" id="5463246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463250">return</span>&nbsp;<span class="ident" id="5463257">t</span><span class="op" id="5463258">,</span>&nbsp;<span class="ident" id="5463260">unicode</span><span class="op" id="5463267">.</span><span class="ident" id="5463268">FoldCategory</span><span class="op" id="5463280">[</span><span class="ident" id="5463281">name</span><span class="op" id="5463285">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463291">if</span>&nbsp;<span class="ident" id="5463294">t</span>&nbsp;<span class="op" id="5463296">:=</span>&nbsp;<span class="ident" id="5463299">unicode</span><span class="op" id="5463306">.</span><span class="ident" id="5463307">Scripts</span><span class="op" id="5463314">[</span><span class="ident" id="5463315">name</span><span class="op" id="5463319">]</span><span class="op" id="5463320">;</span>&nbsp;<span class="ident" id="5463322">t</span>&nbsp;<span class="op" id="5463324">!=</span>&nbsp;<span class="ident" id="5463327">nil</span>&nbsp;<span class="op" id="5463331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463335">return</span>&nbsp;<span class="ident" id="5463342">t</span><span class="op" id="5463343">,</span>&nbsp;<span class="ident" id="5463345">unicode</span><span class="op" id="5463352">.</span><span class="ident" id="5463353">FoldScript</span><span class="op" id="5463363">[</span><span class="ident" id="5463364">name</span><span class="op" id="5463368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463374">return</span>&nbsp;<span class="ident" id="5463381">nil</span><span class="op" id="5463384">,</span>&nbsp;<span class="ident" id="5463386">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5463390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5463393">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5463468">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5463547">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5463611">func</span>&nbsp;<span class="op" id="5463616">(</span><span class="ident" id="5463617">p</span>&nbsp;<span class="op" id="5463619">*</span><span class="ident" id="5463620">parser</span><span class="op" id="5463626">)</span>&nbsp;<span class="ident" id="5463628">parseUnicodeClass</span><span class="op" id="5463645">(</span><span class="ident" id="5463646">s</span>&nbsp;<span class="builtintype" id="5463648">string</span><span class="op" id="5463654">,</span>&nbsp;<span class="ident" id="5463656">r</span>&nbsp;<span class="op" id="5463658">[</span><span class="op" id="5463659">]</span><span class="builtintype" id="5463660">rune</span><span class="op" id="5463664">)</span>&nbsp;<span class="op" id="5463666">(</span><span class="ident" id="5463667">out</span>&nbsp;<span class="op" id="5463671">[</span><span class="op" id="5463672">]</span><span class="builtintype" id="5463673">rune</span><span class="op" id="5463677">,</span>&nbsp;<span class="ident" id="5463679">rest</span>&nbsp;<span class="builtintype" id="5463684">string</span><span class="op" id="5463690">,</span>&nbsp;<span class="ident" id="5463692">err</span>&nbsp;<span class="builtintype" id="5463696">error</span><span class="op" id="5463701">)</span>&nbsp;<span class="op" id="5463703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463706">if</span>&nbsp;<span class="ident" id="5463709">p</span><span class="op" id="5463710">.</span><span class="ident" id="5463711">flags</span><span class="op" id="5463716">&amp;</span><span class="ident" id="5463717">UnicodeGroups</span>&nbsp;<span class="op" id="5463731">==</span>&nbsp;<span class="num" id="5463734">0</span>&nbsp;<span class="op" id="5463736">||</span>&nbsp;<span class="builtinfunc" id="5463739">len</span><span class="op" id="5463742">(</span><span class="ident" id="5463743">s</span><span class="op" id="5463744">)</span>&nbsp;<span class="op" id="5463746">&lt;</span>&nbsp;<span class="num" id="5463748">2</span>&nbsp;<span class="op" id="5463750">||</span>&nbsp;<span class="ident" id="5463753">s</span><span class="op" id="5463754">[</span><span class="num" id="5463755">0</span><span class="op" id="5463756">]</span>&nbsp;<span class="op" id="5463758">!=</span>&nbsp;<span class="string" id="5463761">&#39;\\&#39;</span>&nbsp;<span class="op" id="5463766">||</span>&nbsp;<span class="ident" id="5463769">s</span><span class="op" id="5463770">[</span><span class="num" id="5463771">1</span><span class="op" id="5463772">]</span>&nbsp;<span class="op" id="5463774">!=</span>&nbsp;<span class="string" id="5463777">&#39;p&#39;</span>&nbsp;<span class="op" id="5463781">&amp;&amp;</span>&nbsp;<span class="ident" id="5463784">s</span><span class="op" id="5463785">[</span><span class="num" id="5463786">1</span><span class="op" id="5463787">]</span>&nbsp;<span class="op" id="5463789">!=</span>&nbsp;<span class="string" id="5463792">&#39;P&#39;</span>&nbsp;<span class="op" id="5463796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463800">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5463812">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5463852">sign</span>&nbsp;<span class="op" id="5463857">:=</span>&nbsp;<span class="op" id="5463860">+</span><span class="num" id="5463861">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463864">if</span>&nbsp;<span class="ident" id="5463867">s</span><span class="op" id="5463868">[</span><span class="num" id="5463869">1</span><span class="op" id="5463870">]</span>&nbsp;<span class="op" id="5463872">==</span>&nbsp;<span class="string" id="5463875">&#39;P&#39;</span>&nbsp;<span class="op" id="5463879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5463883">sign</span>&nbsp;<span class="op" id="5463888">=</span>&nbsp;<span class="op" id="5463890">-</span><span class="num" id="5463891">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463894">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5463897">t</span>&nbsp;<span class="op" id="5463899">:=</span>&nbsp;<span class="ident" id="5463902">s</span><span class="op" id="5463903">[</span><span class="num" id="5463904">2</span><span class="op" id="5463905">:</span><span class="op" id="5463906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5463909">c</span><span class="op" id="5463910">,</span>&nbsp;<span class="ident" id="5463912">t</span><span class="op" id="5463913">,</span>&nbsp;<span class="ident" id="5463915">err</span>&nbsp;<span class="op" id="5463919">:=</span>&nbsp;<span class="ident" id="5463922">nextRune</span><span class="op" id="5463930">(</span><span class="ident" id="5463931">t</span><span class="op" id="5463932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463935">if</span>&nbsp;<span class="ident" id="5463938">err</span>&nbsp;<span class="op" id="5463942">!=</span>&nbsp;<span class="ident" id="5463945">nil</span>&nbsp;<span class="op" id="5463949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463953">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5463961">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463964">var</span>&nbsp;<span class="ident" id="5463968">seq</span><span class="op" id="5463971">,</span>&nbsp;<span class="ident" id="5463973">name</span>&nbsp;<span class="builtintype" id="5463978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5463986">if</span>&nbsp;<span class="ident" id="5463989">c</span>&nbsp;<span class="op" id="5463991">!=</span>&nbsp;<span class="string" id="5463994">&#39;{&#39;</span>&nbsp;<span class="op" id="5463998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464002">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464027">seq</span>&nbsp;<span class="op" id="5464031">=</span>&nbsp;<span class="ident" id="5464033">s</span><span class="op" id="5464034">[</span><span class="op" id="5464035">:</span><span class="builtinfunc" id="5464036">len</span><span class="op" id="5464039">(</span><span class="ident" id="5464040">s</span><span class="op" id="5464041">)</span><span class="op" id="5464042">-</span><span class="builtinfunc" id="5464043">len</span><span class="op" id="5464046">(</span><span class="ident" id="5464047">t</span><span class="op" id="5464048">)</span><span class="op" id="5464049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464053">name</span>&nbsp;<span class="op" id="5464058">=</span>&nbsp;<span class="ident" id="5464060">seq</span><span class="op" id="5464063">[</span><span class="num" id="5464064">2</span><span class="op" id="5464065">:</span><span class="op" id="5464066">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464069">}</span>&nbsp;<span class="keyword" id="5464071">else</span>&nbsp;<span class="op" id="5464076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464080">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464104">end</span>&nbsp;<span class="op" id="5464108">:=</span>&nbsp;<span class="ident" id="5464111">strings</span><span class="op" id="5464118">.</span><span class="ident" id="5464119">IndexRune</span><span class="op" id="5464128">(</span><span class="ident" id="5464129">s</span><span class="op" id="5464130">,</span>&nbsp;<span class="string" id="5464132">&#39;}&#39;</span><span class="op" id="5464135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464139">if</span>&nbsp;<span class="ident" id="5464142">end</span>&nbsp;<span class="op" id="5464146">&lt;</span>&nbsp;<span class="num" id="5464148">0</span>&nbsp;<span class="op" id="5464150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464155">if</span>&nbsp;<span class="ident" id="5464158">err</span>&nbsp;<span class="op" id="5464162">=</span>&nbsp;<span class="ident" id="5464164">checkUTF8</span><span class="op" id="5464173">(</span><span class="ident" id="5464174">s</span><span class="op" id="5464175">)</span><span class="op" id="5464176">;</span>&nbsp;<span class="ident" id="5464178">err</span>&nbsp;<span class="op" id="5464182">!=</span>&nbsp;<span class="ident" id="5464185">nil</span>&nbsp;<span class="op" id="5464189">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464195">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464210">return</span>&nbsp;<span class="ident" id="5464217">nil</span><span class="op" id="5464220">,</span>&nbsp;<span class="string" id="5464222">&#34;&#34;</span><span class="op" id="5464224">,</span>&nbsp;<span class="op" id="5464226">&amp;</span><span class="ident" id="5464227">Error</span><span class="op" id="5464232">{</span><span class="ident" id="5464233">ErrInvalidCharRange</span><span class="op" id="5464252">,</span>&nbsp;<span class="ident" id="5464254">s</span><span class="op" id="5464255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464263">seq</span><span class="op" id="5464266">,</span>&nbsp;<span class="ident" id="5464268">t</span>&nbsp;<span class="op" id="5464270">=</span>&nbsp;<span class="ident" id="5464272">s</span><span class="op" id="5464273">[</span><span class="op" id="5464274">:</span><span class="ident" id="5464275">end</span><span class="op" id="5464278">+</span><span class="num" id="5464279">1</span><span class="op" id="5464280">]</span><span class="op" id="5464281">,</span>&nbsp;<span class="ident" id="5464283">s</span><span class="op" id="5464284">[</span><span class="ident" id="5464285">end</span><span class="op" id="5464288">+</span><span class="num" id="5464289">1</span><span class="op" id="5464290">:</span><span class="op" id="5464291">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464295">name</span>&nbsp;<span class="op" id="5464300">=</span>&nbsp;<span class="ident" id="5464302">s</span><span class="op" id="5464303">[</span><span class="num" id="5464304">3</span><span class="op" id="5464305">:</span><span class="ident" id="5464306">end</span><span class="op" id="5464309">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464313">if</span>&nbsp;<span class="ident" id="5464316">err</span>&nbsp;<span class="op" id="5464320">=</span>&nbsp;<span class="ident" id="5464322">checkUTF8</span><span class="op" id="5464331">(</span><span class="ident" id="5464332">name</span><span class="op" id="5464336">)</span><span class="op" id="5464337">;</span>&nbsp;<span class="ident" id="5464339">err</span>&nbsp;<span class="op" id="5464343">!=</span>&nbsp;<span class="ident" id="5464346">nil</span>&nbsp;<span class="op" id="5464350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464355">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464367">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464371">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464455">if</span>&nbsp;<span class="ident" id="5464458">name</span>&nbsp;<span class="op" id="5464463">!=</span>&nbsp;<span class="string" id="5464466">&#34;&#34;</span>&nbsp;<span class="op" id="5464469">&amp;&amp;</span>&nbsp;<span class="ident" id="5464472">name</span><span class="op" id="5464476">[</span><span class="num" id="5464477">0</span><span class="op" id="5464478">]</span>&nbsp;<span class="op" id="5464480">==</span>&nbsp;<span class="string" id="5464483">&#39;^&#39;</span>&nbsp;<span class="op" id="5464487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464491">sign</span>&nbsp;<span class="op" id="5464496">=</span>&nbsp;<span class="op" id="5464498">-</span><span class="ident" id="5464499">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464506">name</span>&nbsp;<span class="op" id="5464511">=</span>&nbsp;<span class="ident" id="5464513">name</span><span class="op" id="5464517">[</span><span class="num" id="5464518">1</span><span class="op" id="5464519">:</span><span class="op" id="5464520">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464527">tab</span><span class="op" id="5464530">,</span>&nbsp;<span class="ident" id="5464532">fold</span>&nbsp;<span class="op" id="5464537">:=</span>&nbsp;<span class="ident" id="5464540">unicodeTable</span><span class="op" id="5464552">(</span><span class="ident" id="5464553">name</span><span class="op" id="5464557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464560">if</span>&nbsp;<span class="ident" id="5464563">tab</span>&nbsp;<span class="op" id="5464567">==</span>&nbsp;<span class="ident" id="5464570">nil</span>&nbsp;<span class="op" id="5464574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464578">return</span>&nbsp;<span class="ident" id="5464585">nil</span><span class="op" id="5464588">,</span>&nbsp;<span class="string" id="5464590">&#34;&#34;</span><span class="op" id="5464592">,</span>&nbsp;<span class="op" id="5464594">&amp;</span><span class="ident" id="5464595">Error</span><span class="op" id="5464600">{</span><span class="ident" id="5464601">ErrInvalidCharRange</span><span class="op" id="5464620">,</span>&nbsp;<span class="ident" id="5464622">seq</span><span class="op" id="5464625">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464632">if</span>&nbsp;<span class="ident" id="5464635">p</span><span class="op" id="5464636">.</span><span class="ident" id="5464637">flags</span><span class="op" id="5464642">&amp;</span><span class="ident" id="5464643">FoldCase</span>&nbsp;<span class="op" id="5464652">==</span>&nbsp;<span class="num" id="5464655">0</span>&nbsp;<span class="op" id="5464657">||</span>&nbsp;<span class="ident" id="5464660">fold</span>&nbsp;<span class="op" id="5464665">==</span>&nbsp;<span class="ident" id="5464668">nil</span>&nbsp;<span class="op" id="5464672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5464676">if</span>&nbsp;<span class="ident" id="5464679">sign</span>&nbsp;<span class="op" id="5464684">&gt;</span>&nbsp;<span class="num" id="5464686">0</span>&nbsp;<span class="op" id="5464688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464693">r</span>&nbsp;<span class="op" id="5464695">=</span>&nbsp;<span class="ident" id="5464697">appendTable</span><span class="op" id="5464708">(</span><span class="ident" id="5464709">r</span><span class="op" id="5464710">,</span>&nbsp;<span class="ident" id="5464712">tab</span><span class="op" id="5464715">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464719">}</span>&nbsp;<span class="keyword" id="5464721">else</span>&nbsp;<span class="op" id="5464726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464731">r</span>&nbsp;<span class="op" id="5464733">=</span>&nbsp;<span class="ident" id="5464735">appendNegatedTable</span><span class="op" id="5464753">(</span><span class="ident" id="5464754">r</span><span class="op" id="5464755">,</span>&nbsp;<span class="ident" id="5464757">tab</span><span class="op" id="5464760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5464767">}</span>&nbsp;<span class="keyword" id="5464769">else</span>&nbsp;<span class="op" id="5464774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464778">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464835">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5464894">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464922">tmp</span>&nbsp;<span class="op" id="5464926">:=</span>&nbsp;<span class="ident" id="5464929">p</span><span class="op" id="5464930">.</span><span class="ident" id="5464931">tmpClass</span><span class="op" id="5464939">[</span><span class="op" id="5464940">:</span><span class="num" id="5464941">0</span><span class="op" id="5464942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464946">tmp</span>&nbsp;<span class="op" id="5464950">=</span>&nbsp;<span class="ident" id="5464952">appendTable</span><span class="op" id="5464963">(</span><span class="ident" id="5464964">tmp</span><span class="op" id="5464967">,</span>&nbsp;<span class="ident" id="5464969">tab</span><span class="op" id="5464972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5464976">tmp</span>&nbsp;<span class="op" id="5464980">=</span>&nbsp;<span class="ident" id="5464982">appendTable</span><span class="op" id="5464993">(</span><span class="ident" id="5464994">tmp</span><span class="op" id="5464997">,</span>&nbsp;<span class="ident" id="5464999">fold</span><span class="op" id="5465003">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465007">p</span><span class="op" id="5465008">.</span><span class="ident" id="5465009">tmpClass</span>&nbsp;<span class="op" id="5465018">=</span>&nbsp;<span class="ident" id="5465020">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465026">tmp</span>&nbsp;<span class="op" id="5465030">=</span>&nbsp;<span class="ident" id="5465032">cleanClass</span><span class="op" id="5465042">(</span><span class="op" id="5465043">&amp;</span><span class="ident" id="5465044">p</span><span class="op" id="5465045">.</span><span class="ident" id="5465046">tmpClass</span><span class="op" id="5465054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465058">if</span>&nbsp;<span class="ident" id="5465061">sign</span>&nbsp;<span class="op" id="5465066">&gt;</span>&nbsp;<span class="num" id="5465068">0</span>&nbsp;<span class="op" id="5465070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465075">r</span>&nbsp;<span class="op" id="5465077">=</span>&nbsp;<span class="ident" id="5465079">appendClass</span><span class="op" id="5465090">(</span><span class="ident" id="5465091">r</span><span class="op" id="5465092">,</span>&nbsp;<span class="ident" id="5465094">tmp</span><span class="op" id="5465097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5465101">}</span>&nbsp;<span class="keyword" id="5465103">else</span>&nbsp;<span class="op" id="5465108">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465113">r</span>&nbsp;<span class="op" id="5465115">=</span>&nbsp;<span class="ident" id="5465117">appendNegatedClass</span><span class="op" id="5465135">(</span><span class="ident" id="5465136">r</span><span class="op" id="5465137">,</span>&nbsp;<span class="ident" id="5465139">tmp</span><span class="op" id="5465142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5465146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5465149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465152">return</span>&nbsp;<span class="ident" id="5465159">r</span><span class="op" id="5465160">,</span>&nbsp;<span class="ident" id="5465162">t</span><span class="op" id="5465163">,</span>&nbsp;<span class="ident" id="5465165">nil</span><br>
<span class="lineno"></span><span class="op" id="5465169">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5465172">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5465233">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5465272">func</span>&nbsp;<span class="op" id="5465277">(</span><span class="ident" id="5465278">p</span>&nbsp;<span class="op" id="5465280">*</span><span class="ident" id="5465281">parser</span><span class="op" id="5465287">)</span>&nbsp;<span class="ident" id="5465289">parseClass</span><span class="op" id="5465299">(</span><span class="ident" id="5465300">s</span>&nbsp;<span class="builtintype" id="5465302">string</span><span class="op" id="5465308">)</span>&nbsp;<span class="op" id="5465310">(</span><span class="ident" id="5465311">rest</span>&nbsp;<span class="builtintype" id="5465316">string</span><span class="op" id="5465322">,</span>&nbsp;<span class="ident" id="5465324">err</span>&nbsp;<span class="builtintype" id="5465328">error</span><span class="op" id="5465333">)</span>&nbsp;<span class="op" id="5465335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465338">t</span>&nbsp;<span class="op" id="5465340">:=</span>&nbsp;<span class="ident" id="5465343">s</span><span class="op" id="5465344">[</span><span class="num" id="5465345">1</span><span class="op" id="5465346">:</span><span class="op" id="5465347">]</span>&nbsp;<span class="comment" id="5465349">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465360">re</span>&nbsp;<span class="op" id="5465363">:=</span>&nbsp;<span class="ident" id="5465366">p</span><span class="op" id="5465367">.</span><span class="ident" id="5465368">newRegexp</span><span class="op" id="5465377">(</span><span class="ident" id="5465378">OpCharClass</span><span class="op" id="5465389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465392">re</span><span class="op" id="5465394">.</span><span class="ident" id="5465395">Flags</span>&nbsp;<span class="op" id="5465401">=</span>&nbsp;<span class="ident" id="5465403">p</span><span class="op" id="5465404">.</span><span class="ident" id="5465405">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465412">re</span><span class="op" id="5465414">.</span><span class="ident" id="5465415">Rune</span>&nbsp;<span class="op" id="5465420">=</span>&nbsp;<span class="ident" id="5465422">re</span><span class="op" id="5465424">.</span><span class="ident" id="5465425">Rune0</span><span class="op" id="5465430">[</span><span class="op" id="5465431">:</span><span class="num" id="5465432">0</span><span class="op" id="5465433">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465437">sign</span>&nbsp;<span class="op" id="5465442">:=</span>&nbsp;<span class="op" id="5465445">+</span><span class="num" id="5465446">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465449">if</span>&nbsp;<span class="ident" id="5465452">t</span>&nbsp;<span class="op" id="5465454">!=</span>&nbsp;<span class="string" id="5465457">&#34;&#34;</span>&nbsp;<span class="op" id="5465460">&amp;&amp;</span>&nbsp;<span class="ident" id="5465463">t</span><span class="op" id="5465464">[</span><span class="num" id="5465465">0</span><span class="op" id="5465466">]</span>&nbsp;<span class="op" id="5465468">==</span>&nbsp;<span class="string" id="5465471">&#39;^&#39;</span>&nbsp;<span class="op" id="5465475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465479">sign</span>&nbsp;<span class="op" id="5465484">=</span>&nbsp;<span class="op" id="5465486">-</span><span class="num" id="5465487">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465491">t</span>&nbsp;<span class="op" id="5465493">=</span>&nbsp;<span class="ident" id="5465495">t</span><span class="op" id="5465496">[</span><span class="num" id="5465497">1</span><span class="op" id="5465498">:</span><span class="op" id="5465499">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5465504">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5465560">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465613">if</span>&nbsp;<span class="ident" id="5465616">p</span><span class="op" id="5465617">.</span><span class="ident" id="5465618">flags</span><span class="op" id="5465623">&amp;</span><span class="ident" id="5465624">ClassNL</span>&nbsp;<span class="op" id="5465632">==</span>&nbsp;<span class="num" id="5465635">0</span>&nbsp;<span class="op" id="5465637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465642">re</span><span class="op" id="5465644">.</span><span class="ident" id="5465645">Rune</span>&nbsp;<span class="op" id="5465650">=</span>&nbsp;<span class="builtinfunc" id="5465652">append</span><span class="op" id="5465658">(</span><span class="ident" id="5465659">re</span><span class="op" id="5465661">.</span><span class="ident" id="5465662">Rune</span><span class="op" id="5465666">,</span>&nbsp;<span class="string" id="5465668">&#39;\n&#39;</span><span class="op" id="5465672">,</span>&nbsp;<span class="string" id="5465674">&#39;\n&#39;</span><span class="op" id="5465678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5465682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5465685">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465689">class</span>&nbsp;<span class="op" id="5465695">:=</span>&nbsp;<span class="ident" id="5465698">re</span><span class="op" id="5465700">.</span><span class="ident" id="5465701">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465707">first</span>&nbsp;<span class="op" id="5465713">:=</span>&nbsp;<span class="builtintype" id="5465716">true</span>&nbsp;<span class="comment" id="5465721">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465765">for</span>&nbsp;<span class="ident" id="5465769">t</span>&nbsp;<span class="op" id="5465771">==</span>&nbsp;<span class="string" id="5465774">&#34;&#34;</span>&nbsp;<span class="op" id="5465777">||</span>&nbsp;<span class="ident" id="5465780">t</span><span class="op" id="5465781">[</span><span class="num" id="5465782">0</span><span class="op" id="5465783">]</span>&nbsp;<span class="op" id="5465785">!=</span>&nbsp;<span class="string" id="5465788">&#39;]&#39;</span>&nbsp;<span class="op" id="5465792">||</span>&nbsp;<span class="ident" id="5465795">first</span>&nbsp;<span class="op" id="5465801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5465805">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5465869">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5465900">if</span>&nbsp;<span class="ident" id="5465903">t</span>&nbsp;<span class="op" id="5465905">!=</span>&nbsp;<span class="string" id="5465908">&#34;&#34;</span>&nbsp;<span class="op" id="5465911">&amp;&amp;</span>&nbsp;<span class="ident" id="5465914">t</span><span class="op" id="5465915">[</span><span class="num" id="5465916">0</span><span class="op" id="5465917">]</span>&nbsp;<span class="op" id="5465919">==</span>&nbsp;<span class="string" id="5465922">&#39;-&#39;</span>&nbsp;<span class="op" id="5465926">&amp;&amp;</span>&nbsp;<span class="ident" id="5465929">p</span><span class="op" id="5465930">.</span><span class="ident" id="5465931">flags</span><span class="op" id="5465936">&amp;</span><span class="ident" id="5465937">PerlX</span>&nbsp;<span class="op" id="5465943">==</span>&nbsp;<span class="num" id="5465946">0</span>&nbsp;<span class="op" id="5465948">&amp;&amp;</span>&nbsp;<span class="op" id="5465951">!</span><span class="ident" id="5465952">first</span>&nbsp;<span class="op" id="5465958">&amp;&amp;</span>&nbsp;<span class="op" id="5465961">(</span><span class="builtinfunc" id="5465962">len</span><span class="op" id="5465965">(</span><span class="ident" id="5465966">t</span><span class="op" id="5465967">)</span>&nbsp;<span class="op" id="5465969">==</span>&nbsp;<span class="num" id="5465972">1</span>&nbsp;<span class="op" id="5465974">||</span>&nbsp;<span class="ident" id="5465977">t</span><span class="op" id="5465978">[</span><span class="num" id="5465979">1</span><span class="op" id="5465980">]</span>&nbsp;<span class="op" id="5465982">!=</span>&nbsp;<span class="string" id="5465985">&#39;]&#39;</span><span class="op" id="5465988">)</span>&nbsp;<span class="op" id="5465990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5465995">_</span><span class="op" id="5465996">,</span>&nbsp;<span class="ident" id="5465998">size</span>&nbsp;<span class="op" id="5466003">:=</span>&nbsp;<span class="ident" id="5466006">utf8</span><span class="op" id="5466010">.</span><span class="ident" id="5466011">DecodeRuneInString</span><span class="op" id="5466029">(</span><span class="ident" id="5466030">t</span><span class="op" id="5466031">[</span><span class="num" id="5466032">1</span><span class="op" id="5466033">:</span><span class="op" id="5466034">]</span><span class="op" id="5466035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466040">return</span>&nbsp;<span class="string" id="5466047">&#34;&#34;</span><span class="op" id="5466049">,</span>&nbsp;<span class="op" id="5466051">&amp;</span><span class="ident" id="5466052">Error</span><span class="op" id="5466057">{</span><span class="ident" id="5466058">Code</span><span class="op" id="5466062">:</span>&nbsp;<span class="ident" id="5466064">ErrInvalidCharRange</span><span class="op" id="5466083">,</span>&nbsp;<span class="ident" id="5466085">Expr</span><span class="op" id="5466089">:</span>&nbsp;<span class="ident" id="5466091">t</span><span class="op" id="5466092">[</span><span class="op" id="5466093">:</span><span class="num" id="5466094">1</span><span class="op" id="5466095">+</span><span class="ident" id="5466096">size</span><span class="op" id="5466100">]</span><span class="op" id="5466101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466105">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466109">first</span>&nbsp;<span class="op" id="5466115">=</span>&nbsp;<span class="builtintype" id="5466117">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5466126">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466161">if</span>&nbsp;<span class="builtinfunc" id="5466164">len</span><span class="op" id="5466167">(</span><span class="ident" id="5466168">t</span><span class="op" id="5466169">)</span>&nbsp;<span class="op" id="5466171">&gt;</span>&nbsp;<span class="num" id="5466173">2</span>&nbsp;<span class="op" id="5466175">&amp;&amp;</span>&nbsp;<span class="ident" id="5466178">t</span><span class="op" id="5466179">[</span><span class="num" id="5466180">0</span><span class="op" id="5466181">]</span>&nbsp;<span class="op" id="5466183">==</span>&nbsp;<span class="string" id="5466186">&#39;[&#39;</span>&nbsp;<span class="op" id="5466190">&amp;&amp;</span>&nbsp;<span class="ident" id="5466193">t</span><span class="op" id="5466194">[</span><span class="num" id="5466195">1</span><span class="op" id="5466196">]</span>&nbsp;<span class="op" id="5466198">==</span>&nbsp;<span class="string" id="5466201">&#39;:&#39;</span>&nbsp;<span class="op" id="5466205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466210">nclass</span><span class="op" id="5466216">,</span>&nbsp;<span class="ident" id="5466218">nt</span><span class="op" id="5466220">,</span>&nbsp;<span class="ident" id="5466222">err</span>&nbsp;<span class="op" id="5466226">:=</span>&nbsp;<span class="ident" id="5466229">p</span><span class="op" id="5466230">.</span><span class="ident" id="5466231">parseNamedClass</span><span class="op" id="5466246">(</span><span class="ident" id="5466247">t</span><span class="op" id="5466248">,</span>&nbsp;<span class="ident" id="5466250">class</span><span class="op" id="5466255">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466260">if</span>&nbsp;<span class="ident" id="5466263">err</span>&nbsp;<span class="op" id="5466267">!=</span>&nbsp;<span class="ident" id="5466270">nil</span>&nbsp;<span class="op" id="5466274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466280">return</span>&nbsp;<span class="string" id="5466287">&#34;&#34;</span><span class="op" id="5466289">,</span>&nbsp;<span class="ident" id="5466291">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466303">if</span>&nbsp;<span class="ident" id="5466306">nclass</span>&nbsp;<span class="op" id="5466313">!=</span>&nbsp;<span class="ident" id="5466316">nil</span>&nbsp;<span class="op" id="5466320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466326">class</span><span class="op" id="5466331">,</span>&nbsp;<span class="ident" id="5466333">t</span>&nbsp;<span class="op" id="5466335">=</span>&nbsp;<span class="ident" id="5466337">nclass</span><span class="op" id="5466343">,</span>&nbsp;<span class="ident" id="5466345">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466352">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5466373">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466425">nclass</span><span class="op" id="5466431">,</span>&nbsp;<span class="ident" id="5466433">nt</span><span class="op" id="5466435">,</span>&nbsp;<span class="ident" id="5466437">err</span>&nbsp;<span class="op" id="5466441">:=</span>&nbsp;<span class="ident" id="5466444">p</span><span class="op" id="5466445">.</span><span class="ident" id="5466446">parseUnicodeClass</span><span class="op" id="5466463">(</span><span class="ident" id="5466464">t</span><span class="op" id="5466465">,</span>&nbsp;<span class="ident" id="5466467">class</span><span class="op" id="5466472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466476">if</span>&nbsp;<span class="ident" id="5466479">err</span>&nbsp;<span class="op" id="5466483">!=</span>&nbsp;<span class="ident" id="5466486">nil</span>&nbsp;<span class="op" id="5466490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466495">return</span>&nbsp;<span class="string" id="5466502">&#34;&#34;</span><span class="op" id="5466504">,</span>&nbsp;<span class="ident" id="5466506">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466516">if</span>&nbsp;<span class="ident" id="5466519">nclass</span>&nbsp;<span class="op" id="5466526">!=</span>&nbsp;<span class="ident" id="5466529">nil</span>&nbsp;<span class="op" id="5466533">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466538">class</span><span class="op" id="5466543">,</span>&nbsp;<span class="ident" id="5466545">t</span>&nbsp;<span class="op" id="5466547">=</span>&nbsp;<span class="ident" id="5466549">nclass</span><span class="op" id="5466555">,</span>&nbsp;<span class="ident" id="5466557">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466563">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5466579">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466635">if</span>&nbsp;<span class="ident" id="5466638">nclass</span><span class="op" id="5466644">,</span>&nbsp;<span class="ident" id="5466646">nt</span>&nbsp;<span class="op" id="5466649">:=</span>&nbsp;<span class="ident" id="5466652">p</span><span class="op" id="5466653">.</span><span class="ident" id="5466654">parsePerlClassEscape</span><span class="op" id="5466674">(</span><span class="ident" id="5466675">t</span><span class="op" id="5466676">,</span>&nbsp;<span class="ident" id="5466678">class</span><span class="op" id="5466683">)</span><span class="op" id="5466684">;</span>&nbsp;<span class="ident" id="5466686">nclass</span>&nbsp;<span class="op" id="5466693">!=</span>&nbsp;<span class="ident" id="5466696">nil</span>&nbsp;<span class="op" id="5466700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466705">class</span><span class="op" id="5466710">,</span>&nbsp;<span class="ident" id="5466712">t</span>&nbsp;<span class="op" id="5466714">=</span>&nbsp;<span class="ident" id="5466716">nclass</span><span class="op" id="5466722">,</span>&nbsp;<span class="ident" id="5466724">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466730">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5466746">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466785">rng</span>&nbsp;<span class="op" id="5466789">:=</span>&nbsp;<span class="ident" id="5466792">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466796">var</span>&nbsp;<span class="ident" id="5466800">lo</span><span class="op" id="5466802">,</span>&nbsp;<span class="ident" id="5466804">hi</span>&nbsp;<span class="builtintype" id="5466807">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466814">if</span>&nbsp;<span class="ident" id="5466817">lo</span><span class="op" id="5466819">,</span>&nbsp;<span class="ident" id="5466821">t</span><span class="op" id="5466822">,</span>&nbsp;<span class="ident" id="5466824">err</span>&nbsp;<span class="op" id="5466828">=</span>&nbsp;<span class="ident" id="5466830">p</span><span class="op" id="5466831">.</span><span class="ident" id="5466832">parseClassChar</span><span class="op" id="5466846">(</span><span class="ident" id="5466847">t</span><span class="op" id="5466848">,</span>&nbsp;<span class="ident" id="5466850">s</span><span class="op" id="5466851">)</span><span class="op" id="5466852">;</span>&nbsp;<span class="ident" id="5466854">err</span>&nbsp;<span class="op" id="5466858">!=</span>&nbsp;<span class="ident" id="5466861">nil</span>&nbsp;<span class="op" id="5466865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466870">return</span>&nbsp;<span class="string" id="5466877">&#34;&#34;</span><span class="op" id="5466879">,</span>&nbsp;<span class="ident" id="5466881">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466891">hi</span>&nbsp;<span class="op" id="5466894">=</span>&nbsp;<span class="ident" id="5466896">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5466901">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5466945">if</span>&nbsp;<span class="builtinfunc" id="5466948">len</span><span class="op" id="5466951">(</span><span class="ident" id="5466952">t</span><span class="op" id="5466953">)</span>&nbsp;<span class="op" id="5466955">&gt;=</span>&nbsp;<span class="num" id="5466958">2</span>&nbsp;<span class="op" id="5466960">&amp;&amp;</span>&nbsp;<span class="ident" id="5466963">t</span><span class="op" id="5466964">[</span><span class="num" id="5466965">0</span><span class="op" id="5466966">]</span>&nbsp;<span class="op" id="5466968">==</span>&nbsp;<span class="string" id="5466971">&#39;-&#39;</span>&nbsp;<span class="op" id="5466975">&amp;&amp;</span>&nbsp;<span class="ident" id="5466978">t</span><span class="op" id="5466979">[</span><span class="num" id="5466980">1</span><span class="op" id="5466981">]</span>&nbsp;<span class="op" id="5466983">!=</span>&nbsp;<span class="string" id="5466986">&#39;]&#39;</span>&nbsp;<span class="op" id="5466990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5466995">t</span>&nbsp;<span class="op" id="5466997">=</span>&nbsp;<span class="ident" id="5466999">t</span><span class="op" id="5467000">[</span><span class="num" id="5467001">1</span><span class="op" id="5467002">:</span><span class="op" id="5467003">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467008">if</span>&nbsp;<span class="ident" id="5467011">hi</span><span class="op" id="5467013">,</span>&nbsp;<span class="ident" id="5467015">t</span><span class="op" id="5467016">,</span>&nbsp;<span class="ident" id="5467018">err</span>&nbsp;<span class="op" id="5467022">=</span>&nbsp;<span class="ident" id="5467024">p</span><span class="op" id="5467025">.</span><span class="ident" id="5467026">parseClassChar</span><span class="op" id="5467040">(</span><span class="ident" id="5467041">t</span><span class="op" id="5467042">,</span>&nbsp;<span class="ident" id="5467044">s</span><span class="op" id="5467045">)</span><span class="op" id="5467046">;</span>&nbsp;<span class="ident" id="5467048">err</span>&nbsp;<span class="op" id="5467052">!=</span>&nbsp;<span class="ident" id="5467055">nil</span>&nbsp;<span class="op" id="5467059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467065">return</span>&nbsp;<span class="string" id="5467072">&#34;&#34;</span><span class="op" id="5467074">,</span>&nbsp;<span class="ident" id="5467076">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467088">if</span>&nbsp;<span class="ident" id="5467091">hi</span>&nbsp;<span class="op" id="5467094">&lt;</span>&nbsp;<span class="ident" id="5467096">lo</span>&nbsp;<span class="op" id="5467099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467105">rng</span>&nbsp;<span class="op" id="5467109">=</span>&nbsp;<span class="ident" id="5467111">rng</span><span class="op" id="5467114">[</span><span class="op" id="5467115">:</span><span class="builtinfunc" id="5467116">len</span><span class="op" id="5467119">(</span><span class="ident" id="5467120">rng</span><span class="op" id="5467123">)</span><span class="op" id="5467124">-</span><span class="builtinfunc" id="5467125">len</span><span class="op" id="5467128">(</span><span class="ident" id="5467129">t</span><span class="op" id="5467130">)</span><span class="op" id="5467131">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467137">return</span>&nbsp;<span class="string" id="5467144">&#34;&#34;</span><span class="op" id="5467146">,</span>&nbsp;<span class="op" id="5467148">&amp;</span><span class="ident" id="5467149">Error</span><span class="op" id="5467154">{</span><span class="ident" id="5467155">Code</span><span class="op" id="5467159">:</span>&nbsp;<span class="ident" id="5467161">ErrInvalidCharRange</span><span class="op" id="5467180">,</span>&nbsp;<span class="ident" id="5467182">Expr</span><span class="op" id="5467186">:</span>&nbsp;<span class="ident" id="5467188">rng</span><span class="op" id="5467191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467204">if</span>&nbsp;<span class="ident" id="5467207">p</span><span class="op" id="5467208">.</span><span class="ident" id="5467209">flags</span><span class="op" id="5467214">&amp;</span><span class="ident" id="5467215">FoldCase</span>&nbsp;<span class="op" id="5467224">==</span>&nbsp;<span class="num" id="5467227">0</span>&nbsp;<span class="op" id="5467229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467234">class</span>&nbsp;<span class="op" id="5467240">=</span>&nbsp;<span class="ident" id="5467242">appendRange</span><span class="op" id="5467253">(</span><span class="ident" id="5467254">class</span><span class="op" id="5467259">,</span>&nbsp;<span class="ident" id="5467261">lo</span><span class="op" id="5467263">,</span>&nbsp;<span class="ident" id="5467265">hi</span><span class="op" id="5467267">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467271">}</span>&nbsp;<span class="keyword" id="5467273">else</span>&nbsp;<span class="op" id="5467278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467283">class</span>&nbsp;<span class="op" id="5467289">=</span>&nbsp;<span class="ident" id="5467291">appendFoldedRange</span><span class="op" id="5467308">(</span><span class="ident" id="5467309">class</span><span class="op" id="5467314">,</span>&nbsp;<span class="ident" id="5467316">lo</span><span class="op" id="5467318">,</span>&nbsp;<span class="ident" id="5467320">hi</span><span class="op" id="5467322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467332">t</span>&nbsp;<span class="op" id="5467334">=</span>&nbsp;<span class="ident" id="5467336">t</span><span class="op" id="5467337">[</span><span class="num" id="5467338">1</span><span class="op" id="5467339">:</span><span class="op" id="5467340">]</span>&nbsp;<span class="comment" id="5467342">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5467354">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467410">re</span><span class="op" id="5467412">.</span><span class="ident" id="5467413">Rune</span>&nbsp;<span class="op" id="5467418">=</span>&nbsp;<span class="ident" id="5467420">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467427">class</span>&nbsp;<span class="op" id="5467433">=</span>&nbsp;<span class="ident" id="5467435">cleanClass</span><span class="op" id="5467445">(</span><span class="op" id="5467446">&amp;</span><span class="ident" id="5467447">re</span><span class="op" id="5467449">.</span><span class="ident" id="5467450">Rune</span><span class="op" id="5467454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467457">if</span>&nbsp;<span class="ident" id="5467460">sign</span>&nbsp;<span class="op" id="5467465">&lt;</span>&nbsp;<span class="num" id="5467467">0</span>&nbsp;<span class="op" id="5467469">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467473">class</span>&nbsp;<span class="op" id="5467479">=</span>&nbsp;<span class="ident" id="5467481">negateClass</span><span class="op" id="5467492">(</span><span class="ident" id="5467493">class</span><span class="op" id="5467498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467504">re</span><span class="op" id="5467506">.</span><span class="ident" id="5467507">Rune</span>&nbsp;<span class="op" id="5467512">=</span>&nbsp;<span class="ident" id="5467514">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467521">p</span><span class="op" id="5467522">.</span><span class="ident" id="5467523">push</span><span class="op" id="5467527">(</span><span class="ident" id="5467528">re</span><span class="op" id="5467530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467533">return</span>&nbsp;<span class="ident" id="5467540">t</span><span class="op" id="5467541">,</span>&nbsp;<span class="ident" id="5467543">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5467547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5467550">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5467607">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5467650">func</span>&nbsp;<span class="ident" id="5467655">cleanClass</span><span class="op" id="5467665">(</span><span class="ident" id="5467666">rp</span>&nbsp;<span class="op" id="5467669">*</span><span class="op" id="5467670">[</span><span class="op" id="5467671">]</span><span class="builtintype" id="5467672">rune</span><span class="op" id="5467676">)</span>&nbsp;<span class="op" id="5467678">[</span><span class="op" id="5467679">]</span><span class="builtintype" id="5467680">rune</span>&nbsp;<span class="op" id="5467685">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5467689">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467745">sort</span><span class="op" id="5467749">.</span><span class="ident" id="5467750">Sort</span><span class="op" id="5467754">(</span><span class="ident" id="5467755">ranges</span><span class="op" id="5467761">{</span><span class="ident" id="5467762">rp</span><span class="op" id="5467764">}</span><span class="op" id="5467765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467769">r</span>&nbsp;<span class="op" id="5467771">:=</span>&nbsp;<span class="op" id="5467774">*</span><span class="ident" id="5467775">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467779">if</span>&nbsp;<span class="builtinfunc" id="5467782">len</span><span class="op" id="5467785">(</span><span class="ident" id="5467786">r</span><span class="op" id="5467787">)</span>&nbsp;<span class="op" id="5467789">&lt;</span>&nbsp;<span class="num" id="5467791">2</span>&nbsp;<span class="op" id="5467793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467797">return</span>&nbsp;<span class="ident" id="5467804">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5467807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5467811">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467844">w</span>&nbsp;<span class="op" id="5467846">:=</span>&nbsp;<span class="num" id="5467849">2</span>&nbsp;<span class="comment" id="5467851">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467867">for</span>&nbsp;<span class="ident" id="5467871">i</span>&nbsp;<span class="op" id="5467873">:=</span>&nbsp;<span class="num" id="5467876">2</span><span class="op" id="5467877">;</span>&nbsp;<span class="ident" id="5467879">i</span>&nbsp;<span class="op" id="5467881">&lt;</span>&nbsp;<span class="builtinfunc" id="5467883">len</span><span class="op" id="5467886">(</span><span class="ident" id="5467887">r</span><span class="op" id="5467888">)</span><span class="op" id="5467889">;</span>&nbsp;<span class="ident" id="5467891">i</span>&nbsp;<span class="op" id="5467893">+=</span>&nbsp;<span class="num" id="5467896">2</span>&nbsp;<span class="op" id="5467898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5467902">lo</span><span class="op" id="5467904">,</span>&nbsp;<span class="ident" id="5467906">hi</span>&nbsp;<span class="op" id="5467909">:=</span>&nbsp;<span class="ident" id="5467912">r</span><span class="op" id="5467913">[</span><span class="ident" id="5467914">i</span><span class="op" id="5467915">]</span><span class="op" id="5467916">,</span>&nbsp;<span class="ident" id="5467918">r</span><span class="op" id="5467919">[</span><span class="ident" id="5467920">i</span><span class="op" id="5467921">+</span><span class="num" id="5467922">1</span><span class="op" id="5467923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467927">if</span>&nbsp;<span class="ident" id="5467930">lo</span>&nbsp;<span class="op" id="5467933">&lt;=</span>&nbsp;<span class="ident" id="5467936">r</span><span class="op" id="5467937">[</span><span class="ident" id="5467938">w</span><span class="op" id="5467939">-</span><span class="num" id="5467940">1</span><span class="op" id="5467941">]</span><span class="op" id="5467942">+</span><span class="num" id="5467943">1</span>&nbsp;<span class="op" id="5467945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5467950">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5467982">if</span>&nbsp;<span class="ident" id="5467985">hi</span>&nbsp;<span class="op" id="5467988">&gt;</span>&nbsp;<span class="ident" id="5467990">r</span><span class="op" id="5467991">[</span><span class="ident" id="5467992">w</span><span class="op" id="5467993">-</span><span class="num" id="5467994">1</span><span class="op" id="5467995">]</span>&nbsp;<span class="op" id="5467997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468003">r</span><span class="op" id="5468004">[</span><span class="ident" id="5468005">w</span><span class="op" id="5468006">-</span><span class="num" id="5468007">1</span><span class="op" id="5468008">]</span>&nbsp;<span class="op" id="5468010">=</span>&nbsp;<span class="ident" id="5468012">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468034">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468038">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468062">r</span><span class="op" id="5468063">[</span><span class="ident" id="5468064">w</span><span class="op" id="5468065">]</span>&nbsp;<span class="op" id="5468067">=</span>&nbsp;<span class="ident" id="5468069">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468074">r</span><span class="op" id="5468075">[</span><span class="ident" id="5468076">w</span><span class="op" id="5468077">+</span><span class="num" id="5468078">1</span><span class="op" id="5468079">]</span>&nbsp;<span class="op" id="5468081">=</span>&nbsp;<span class="ident" id="5468083">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468088">w</span>&nbsp;<span class="op" id="5468090">+=</span>&nbsp;<span class="num" id="5468093">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468096">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468100">return</span>&nbsp;<span class="ident" id="5468107">r</span><span class="op" id="5468108">[</span><span class="op" id="5468109">:</span><span class="ident" id="5468110">w</span><span class="op" id="5468111">]</span><br>
<span class="lineno"></span><span class="op" id="5468113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5468116">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5468195">func</span>&nbsp;<span class="ident" id="5468200">appendLiteral</span><span class="op" id="5468213">(</span><span class="ident" id="5468214">r</span>&nbsp;<span class="op" id="5468216">[</span><span class="op" id="5468217">]</span><span class="builtintype" id="5468218">rune</span><span class="op" id="5468222">,</span>&nbsp;<span class="ident" id="5468224">x</span>&nbsp;<span class="builtintype" id="5468226">rune</span><span class="op" id="5468230">,</span>&nbsp;<span class="ident" id="5468232">flags</span>&nbsp;<span class="ident" id="5468238">Flags</span><span class="op" id="5468243">)</span>&nbsp;<span class="op" id="5468245">[</span><span class="op" id="5468246">]</span><span class="builtintype" id="5468247">rune</span>&nbsp;<span class="op" id="5468252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468255">if</span>&nbsp;<span class="ident" id="5468258">flags</span><span class="op" id="5468263">&amp;</span><span class="ident" id="5468264">FoldCase</span>&nbsp;<span class="op" id="5468273">!=</span>&nbsp;<span class="num" id="5468276">0</span>&nbsp;<span class="op" id="5468278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468282">return</span>&nbsp;<span class="ident" id="5468289">appendFoldedRange</span><span class="op" id="5468306">(</span><span class="ident" id="5468307">r</span><span class="op" id="5468308">,</span>&nbsp;<span class="ident" id="5468310">x</span><span class="op" id="5468311">,</span>&nbsp;<span class="ident" id="5468313">x</span><span class="op" id="5468314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468320">return</span>&nbsp;<span class="ident" id="5468327">appendRange</span><span class="op" id="5468338">(</span><span class="ident" id="5468339">r</span><span class="op" id="5468340">,</span>&nbsp;<span class="ident" id="5468342">x</span><span class="op" id="5468343">,</span>&nbsp;<span class="ident" id="5468345">x</span><span class="op" id="5468346">)</span><br>
<span class="lineno">1650</span><span class="op" id="5468348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5468351">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5468430">func</span>&nbsp;<span class="ident" id="5468435">appendRange</span><span class="op" id="5468446">(</span><span class="ident" id="5468447">r</span>&nbsp;<span class="op" id="5468449">[</span><span class="op" id="5468450">]</span><span class="builtintype" id="5468451">rune</span><span class="op" id="5468455">,</span>&nbsp;<span class="ident" id="5468457">lo</span><span class="op" id="5468459">,</span>&nbsp;<span class="ident" id="5468461">hi</span>&nbsp;<span class="builtintype" id="5468464">rune</span><span class="op" id="5468468">)</span>&nbsp;<span class="op" id="5468470">[</span><span class="op" id="5468471">]</span><span class="builtintype" id="5468472">rune</span>&nbsp;<span class="op" id="5468477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468480">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468549">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468606">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468668">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468693">n</span>&nbsp;<span class="op" id="5468695">:=</span>&nbsp;<span class="builtinfunc" id="5468698">len</span><span class="op" id="5468701">(</span><span class="ident" id="5468702">r</span><span class="op" id="5468703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468706">for</span>&nbsp;<span class="ident" id="5468710">i</span>&nbsp;<span class="op" id="5468712">:=</span>&nbsp;<span class="num" id="5468715">2</span><span class="op" id="5468716">;</span>&nbsp;<span class="ident" id="5468718">i</span>&nbsp;<span class="op" id="5468720">&lt;=</span>&nbsp;<span class="num" id="5468723">4</span><span class="op" id="5468724">;</span>&nbsp;<span class="ident" id="5468726">i</span>&nbsp;<span class="op" id="5468728">+=</span>&nbsp;<span class="num" id="5468731">2</span>&nbsp;<span class="op" id="5468733">{</span>&nbsp;<span class="comment" id="5468735">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468762">if</span>&nbsp;<span class="ident" id="5468765">n</span>&nbsp;<span class="op" id="5468767">&gt;=</span>&nbsp;<span class="ident" id="5468770">i</span>&nbsp;<span class="op" id="5468772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468777">rlo</span><span class="op" id="5468780">,</span>&nbsp;<span class="ident" id="5468782">rhi</span>&nbsp;<span class="op" id="5468786">:=</span>&nbsp;<span class="ident" id="5468789">r</span><span class="op" id="5468790">[</span><span class="ident" id="5468791">n</span><span class="op" id="5468792">-</span><span class="ident" id="5468793">i</span><span class="op" id="5468794">]</span><span class="op" id="5468795">,</span>&nbsp;<span class="ident" id="5468797">r</span><span class="op" id="5468798">[</span><span class="ident" id="5468799">n</span><span class="op" id="5468800">-</span><span class="ident" id="5468801">i</span><span class="op" id="5468802">+</span><span class="num" id="5468803">1</span><span class="op" id="5468804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468809">if</span>&nbsp;<span class="ident" id="5468812">lo</span>&nbsp;<span class="op" id="5468815">&lt;=</span>&nbsp;<span class="ident" id="5468818">rhi</span><span class="op" id="5468821">+</span><span class="num" id="5468822">1</span>&nbsp;<span class="op" id="5468824">&amp;&amp;</span>&nbsp;<span class="ident" id="5468827">rlo</span>&nbsp;<span class="op" id="5468831">&lt;=</span>&nbsp;<span class="ident" id="5468834">hi</span><span class="op" id="5468836">+</span><span class="num" id="5468837">1</span>&nbsp;<span class="op" id="5468839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468845">if</span>&nbsp;<span class="ident" id="5468848">lo</span>&nbsp;<span class="op" id="5468851">&lt;</span>&nbsp;<span class="ident" id="5468853">rlo</span>&nbsp;<span class="op" id="5468857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468864">r</span><span class="op" id="5468865">[</span><span class="ident" id="5468866">n</span><span class="op" id="5468867">-</span><span class="ident" id="5468868">i</span><span class="op" id="5468869">]</span>&nbsp;<span class="op" id="5468871">=</span>&nbsp;<span class="ident" id="5468873">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468886">if</span>&nbsp;<span class="ident" id="5468889">hi</span>&nbsp;<span class="op" id="5468892">&gt;</span>&nbsp;<span class="ident" id="5468894">rhi</span>&nbsp;<span class="op" id="5468898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5468905">r</span><span class="op" id="5468906">[</span><span class="ident" id="5468907">n</span><span class="op" id="5468908">-</span><span class="ident" id="5468909">i</span><span class="op" id="5468910">+</span><span class="num" id="5468911">1</span><span class="op" id="5468912">]</span>&nbsp;<span class="op" id="5468914">=</span>&nbsp;<span class="ident" id="5468916">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468929">return</span>&nbsp;<span class="ident" id="5468936">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5468948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5468952">return</span>&nbsp;<span class="builtinfunc" id="5468959">append</span><span class="op" id="5468965">(</span><span class="ident" id="5468966">r</span><span class="op" id="5468967">,</span>&nbsp;<span class="ident" id="5468969">lo</span><span class="op" id="5468971">,</span>&nbsp;<span class="ident" id="5468973">hi</span><span class="op" id="5468975">)</span><br>
<span class="lineno">1675</span><span class="op" id="5468977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5468980">const</span>&nbsp;<span class="op" id="5468986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5468989">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469040">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469065">minFold</span>&nbsp;<span class="op" id="5469073">=</span>&nbsp;<span class="num" id="5469075">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469083">maxFold</span>&nbsp;<span class="op" id="5469091">=</span>&nbsp;<span class="num" id="5469093">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5469101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5469104">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5469173">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5469230">func</span>&nbsp;<span class="ident" id="5469235">appendFoldedRange</span><span class="op" id="5469252">(</span><span class="ident" id="5469253">r</span>&nbsp;<span class="op" id="5469255">[</span><span class="op" id="5469256">]</span><span class="builtintype" id="5469257">rune</span><span class="op" id="5469261">,</span>&nbsp;<span class="ident" id="5469263">lo</span><span class="op" id="5469265">,</span>&nbsp;<span class="ident" id="5469267">hi</span>&nbsp;<span class="builtintype" id="5469270">rune</span><span class="op" id="5469274">)</span>&nbsp;<span class="op" id="5469276">[</span><span class="op" id="5469277">]</span><span class="builtintype" id="5469278">rune</span>&nbsp;<span class="op" id="5469283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469286">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469305">if</span>&nbsp;<span class="ident" id="5469308">lo</span>&nbsp;<span class="op" id="5469311">&lt;=</span>&nbsp;<span class="ident" id="5469314">minFold</span>&nbsp;<span class="op" id="5469322">&amp;&amp;</span>&nbsp;<span class="ident" id="5469325">hi</span>&nbsp;<span class="op" id="5469328">&gt;=</span>&nbsp;<span class="ident" id="5469331">maxFold</span>&nbsp;<span class="op" id="5469339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469343">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469387">return</span>&nbsp;<span class="ident" id="5469394">appendRange</span><span class="op" id="5469405">(</span><span class="ident" id="5469406">r</span><span class="op" id="5469407">,</span>&nbsp;<span class="ident" id="5469409">lo</span><span class="op" id="5469411">,</span>&nbsp;<span class="ident" id="5469413">hi</span><span class="op" id="5469415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469421">if</span>&nbsp;<span class="ident" id="5469424">hi</span>&nbsp;<span class="op" id="5469427">&lt;</span>&nbsp;<span class="ident" id="5469429">minFold</span>&nbsp;<span class="op" id="5469437">||</span>&nbsp;<span class="ident" id="5469440">lo</span>&nbsp;<span class="op" id="5469443">&gt;</span>&nbsp;<span class="ident" id="5469445">maxFold</span>&nbsp;<span class="op" id="5469453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469457">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469502">return</span>&nbsp;<span class="ident" id="5469509">appendRange</span><span class="op" id="5469520">(</span><span class="ident" id="5469521">r</span><span class="op" id="5469522">,</span>&nbsp;<span class="ident" id="5469524">lo</span><span class="op" id="5469526">,</span>&nbsp;<span class="ident" id="5469528">hi</span><span class="op" id="5469530">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469536">if</span>&nbsp;<span class="ident" id="5469539">lo</span>&nbsp;<span class="op" id="5469542">&lt;</span>&nbsp;<span class="ident" id="5469544">minFold</span>&nbsp;<span class="op" id="5469552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469556">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469595">r</span>&nbsp;<span class="op" id="5469597">=</span>&nbsp;<span class="ident" id="5469599">appendRange</span><span class="op" id="5469610">(</span><span class="ident" id="5469611">r</span><span class="op" id="5469612">,</span>&nbsp;<span class="ident" id="5469614">lo</span><span class="op" id="5469616">,</span>&nbsp;<span class="ident" id="5469618">minFold</span><span class="op" id="5469625">-</span><span class="num" id="5469626">1</span><span class="op" id="5469627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469631">lo</span>&nbsp;<span class="op" id="5469634">=</span>&nbsp;<span class="ident" id="5469636">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469648">if</span>&nbsp;<span class="ident" id="5469651">hi</span>&nbsp;<span class="op" id="5469654">&gt;</span>&nbsp;<span class="ident" id="5469656">maxFold</span>&nbsp;<span class="op" id="5469664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469668">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469707">r</span>&nbsp;<span class="op" id="5469709">=</span>&nbsp;<span class="ident" id="5469711">appendRange</span><span class="op" id="5469722">(</span><span class="ident" id="5469723">r</span><span class="op" id="5469724">,</span>&nbsp;<span class="ident" id="5469726">maxFold</span><span class="op" id="5469733">+</span><span class="num" id="5469734">1</span><span class="op" id="5469735">,</span>&nbsp;<span class="ident" id="5469737">hi</span><span class="op" id="5469739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469743">hi</span>&nbsp;<span class="op" id="5469746">=</span>&nbsp;<span class="ident" id="5469748">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5469761">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469832">for</span>&nbsp;<span class="ident" id="5469836">c</span>&nbsp;<span class="op" id="5469838">:=</span>&nbsp;<span class="ident" id="5469841">lo</span><span class="op" id="5469843">;</span>&nbsp;<span class="ident" id="5469845">c</span>&nbsp;<span class="op" id="5469847">&lt;=</span>&nbsp;<span class="ident" id="5469850">hi</span><span class="op" id="5469852">;</span>&nbsp;<span class="ident" id="5469854">c</span><span class="op" id="5469855">++</span>&nbsp;<span class="op" id="5469858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469862">r</span>&nbsp;<span class="op" id="5469864">=</span>&nbsp;<span class="ident" id="5469866">appendRange</span><span class="op" id="5469877">(</span><span class="ident" id="5469878">r</span><span class="op" id="5469879">,</span>&nbsp;<span class="ident" id="5469881">c</span><span class="op" id="5469882">,</span>&nbsp;<span class="ident" id="5469884">c</span><span class="op" id="5469885">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469889">f</span>&nbsp;<span class="op" id="5469891">:=</span>&nbsp;<span class="ident" id="5469894">unicode</span><span class="op" id="5469901">.</span><span class="ident" id="5469902">SimpleFold</span><span class="op" id="5469912">(</span><span class="ident" id="5469913">c</span><span class="op" id="5469914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469918">for</span>&nbsp;<span class="ident" id="5469922">f</span>&nbsp;<span class="op" id="5469924">!=</span>&nbsp;<span class="ident" id="5469927">c</span>&nbsp;<span class="op" id="5469929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469934">r</span>&nbsp;<span class="op" id="5469936">=</span>&nbsp;<span class="ident" id="5469938">appendRange</span><span class="op" id="5469949">(</span><span class="ident" id="5469950">r</span><span class="op" id="5469951">,</span>&nbsp;<span class="ident" id="5469953">f</span><span class="op" id="5469954">,</span>&nbsp;<span class="ident" id="5469956">f</span><span class="op" id="5469957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5469962">f</span>&nbsp;<span class="op" id="5469964">=</span>&nbsp;<span class="ident" id="5469966">unicode</span><span class="op" id="5469973">.</span><span class="ident" id="5469974">SimpleFold</span><span class="op" id="5469984">(</span><span class="ident" id="5469985">f</span><span class="op" id="5469986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469990">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5469993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5469996">return</span>&nbsp;<span class="ident" id="5470003">r</span><br>
<span class="lineno"></span><span class="op" id="5470005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470008">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5470083">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5470108">func</span>&nbsp;<span class="ident" id="5470113">appendClass</span><span class="op" id="5470124">(</span><span class="ident" id="5470125">r</span>&nbsp;<span class="op" id="5470127">[</span><span class="op" id="5470128">]</span><span class="builtintype" id="5470129">rune</span><span class="op" id="5470133">,</span>&nbsp;<span class="ident" id="5470135">x</span>&nbsp;<span class="op" id="5470137">[</span><span class="op" id="5470138">]</span><span class="builtintype" id="5470139">rune</span><span class="op" id="5470143">)</span>&nbsp;<span class="op" id="5470145">[</span><span class="op" id="5470146">]</span><span class="builtintype" id="5470147">rune</span>&nbsp;<span class="op" id="5470152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470155">for</span>&nbsp;<span class="ident" id="5470159">i</span>&nbsp;<span class="op" id="5470161">:=</span>&nbsp;<span class="num" id="5470164">0</span><span class="op" id="5470165">;</span>&nbsp;<span class="ident" id="5470167">i</span>&nbsp;<span class="op" id="5470169">&lt;</span>&nbsp;<span class="builtinfunc" id="5470171">len</span><span class="op" id="5470174">(</span><span class="ident" id="5470175">x</span><span class="op" id="5470176">)</span><span class="op" id="5470177">;</span>&nbsp;<span class="ident" id="5470179">i</span>&nbsp;<span class="op" id="5470181">+=</span>&nbsp;<span class="num" id="5470184">2</span>&nbsp;<span class="op" id="5470186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470190">r</span>&nbsp;<span class="op" id="5470192">=</span>&nbsp;<span class="ident" id="5470194">appendRange</span><span class="op" id="5470205">(</span><span class="ident" id="5470206">r</span><span class="op" id="5470207">,</span>&nbsp;<span class="ident" id="5470209">x</span><span class="op" id="5470210">[</span><span class="ident" id="5470211">i</span><span class="op" id="5470212">]</span><span class="op" id="5470213">,</span>&nbsp;<span class="ident" id="5470215">x</span><span class="op" id="5470216">[</span><span class="ident" id="5470217">i</span><span class="op" id="5470218">+</span><span class="num" id="5470219">1</span><span class="op" id="5470220">]</span><span class="op" id="5470221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5470224">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470227">return</span>&nbsp;<span class="ident" id="5470234">r</span><br>
<span class="lineno"></span><span class="op" id="5470236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470239">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5470335">func</span>&nbsp;<span class="ident" id="5470340">appendFoldedClass</span><span class="op" id="5470357">(</span><span class="ident" id="5470358">r</span>&nbsp;<span class="op" id="5470360">[</span><span class="op" id="5470361">]</span><span class="builtintype" id="5470362">rune</span><span class="op" id="5470366">,</span>&nbsp;<span class="ident" id="5470368">x</span>&nbsp;<span class="op" id="5470370">[</span><span class="op" id="5470371">]</span><span class="builtintype" id="5470372">rune</span><span class="op" id="5470376">)</span>&nbsp;<span class="op" id="5470378">[</span><span class="op" id="5470379">]</span><span class="builtintype" id="5470380">rune</span>&nbsp;<span class="op" id="5470385">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470388">for</span>&nbsp;<span class="ident" id="5470392">i</span>&nbsp;<span class="op" id="5470394">:=</span>&nbsp;<span class="num" id="5470397">0</span><span class="op" id="5470398">;</span>&nbsp;<span class="ident" id="5470400">i</span>&nbsp;<span class="op" id="5470402">&lt;</span>&nbsp;<span class="builtinfunc" id="5470404">len</span><span class="op" id="5470407">(</span><span class="ident" id="5470408">x</span><span class="op" id="5470409">)</span><span class="op" id="5470410">;</span>&nbsp;<span class="ident" id="5470412">i</span>&nbsp;<span class="op" id="5470414">+=</span>&nbsp;<span class="num" id="5470417">2</span>&nbsp;<span class="op" id="5470419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470423">r</span>&nbsp;<span class="op" id="5470425">=</span>&nbsp;<span class="ident" id="5470427">appendFoldedRange</span><span class="op" id="5470444">(</span><span class="ident" id="5470445">r</span><span class="op" id="5470446">,</span>&nbsp;<span class="ident" id="5470448">x</span><span class="op" id="5470449">[</span><span class="ident" id="5470450">i</span><span class="op" id="5470451">]</span><span class="op" id="5470452">,</span>&nbsp;<span class="ident" id="5470454">x</span><span class="op" id="5470455">[</span><span class="ident" id="5470456">i</span><span class="op" id="5470457">+</span><span class="num" id="5470458">1</span><span class="op" id="5470459">]</span><span class="op" id="5470460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5470463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470466">return</span>&nbsp;<span class="ident" id="5470473">r</span><br>
<span class="lineno"></span><span class="op" id="5470475">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5470478">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5470576">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5470602">func</span>&nbsp;<span class="ident" id="5470607">appendNegatedClass</span><span class="op" id="5470625">(</span><span class="ident" id="5470626">r</span>&nbsp;<span class="op" id="5470628">[</span><span class="op" id="5470629">]</span><span class="builtintype" id="5470630">rune</span><span class="op" id="5470634">,</span>&nbsp;<span class="ident" id="5470636">x</span>&nbsp;<span class="op" id="5470638">[</span><span class="op" id="5470639">]</span><span class="builtintype" id="5470640">rune</span><span class="op" id="5470644">)</span>&nbsp;<span class="op" id="5470646">[</span><span class="op" id="5470647">]</span><span class="builtintype" id="5470648">rune</span>&nbsp;<span class="op" id="5470653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470656">nextLo</span>&nbsp;<span class="op" id="5470663">:=</span>&nbsp;<span class="string" id="5470666">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470676">for</span>&nbsp;<span class="ident" id="5470680">i</span>&nbsp;<span class="op" id="5470682">:=</span>&nbsp;<span class="num" id="5470685">0</span><span class="op" id="5470686">;</span>&nbsp;<span class="ident" id="5470688">i</span>&nbsp;<span class="op" id="5470690">&lt;</span>&nbsp;<span class="builtinfunc" id="5470692">len</span><span class="op" id="5470695">(</span><span class="ident" id="5470696">x</span><span class="op" id="5470697">)</span><span class="op" id="5470698">;</span>&nbsp;<span class="ident" id="5470700">i</span>&nbsp;<span class="op" id="5470702">+=</span>&nbsp;<span class="num" id="5470705">2</span>&nbsp;<span class="op" id="5470707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470711">lo</span><span class="op" id="5470713">,</span>&nbsp;<span class="ident" id="5470715">hi</span>&nbsp;<span class="op" id="5470718">:=</span>&nbsp;<span class="ident" id="5470721">x</span><span class="op" id="5470722">[</span><span class="ident" id="5470723">i</span><span class="op" id="5470724">]</span><span class="op" id="5470725">,</span>&nbsp;<span class="ident" id="5470727">x</span><span class="op" id="5470728">[</span><span class="ident" id="5470729">i</span><span class="op" id="5470730">+</span><span class="num" id="5470731">1</span><span class="op" id="5470732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470736">if</span>&nbsp;<span class="ident" id="5470739">nextLo</span>&nbsp;<span class="op" id="5470746">&lt;=</span>&nbsp;<span class="ident" id="5470749">lo</span><span class="op" id="5470751">-</span><span class="num" id="5470752">1</span>&nbsp;<span class="op" id="5470754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470759">r</span>&nbsp;<span class="op" id="5470761">=</span>&nbsp;<span class="ident" id="5470763">appendRange</span><span class="op" id="5470774">(</span><span class="ident" id="5470775">r</span><span class="op" id="5470776">,</span>&nbsp;<span class="ident" id="5470778">nextLo</span><span class="op" id="5470784">,</span>&nbsp;<span class="ident" id="5470786">lo</span><span class="op" id="5470788">-</span><span class="num" id="5470789">1</span><span class="op" id="5470790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5470794">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470798">nextLo</span>&nbsp;<span class="op" id="5470805">=</span>&nbsp;<span class="ident" id="5470807">hi</span>&nbsp;<span class="op" id="5470810">+</span>&nbsp;<span class="num" id="5470812">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5470815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470818">if</span>&nbsp;<span class="ident" id="5470821">nextLo</span>&nbsp;<span class="op" id="5470828">&lt;=</span>&nbsp;<span class="ident" id="5470831">unicode</span><span class="op" id="5470838">.</span><span class="ident" id="5470839">MaxRune</span>&nbsp;<span class="op" id="5470847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5470851">r</span>&nbsp;<span class="op" id="5470853">=</span>&nbsp;<span class="ident" id="5470855">appendRange</span><span class="op" id="5470866">(</span><span class="ident" id="5470867">r</span><span class="op" id="5470868">,</span>&nbsp;<span class="ident" id="5470870">nextLo</span><span class="op" id="5470876">,</span>&nbsp;<span class="ident" id="5470878">unicode</span><span class="op" id="5470885">.</span><span class="ident" id="5470886">MaxRune</span><span class="op" id="5470893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5470896">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5470899">return</span>&nbsp;<span class="ident" id="5470906">r</span><br>
<span class="lineno"></span><span class="op" id="5470908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470911">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5470976">func</span>&nbsp;<span class="ident" id="5470981">appendTable</span><span class="op" id="5470992">(</span><span class="ident" id="5470993">r</span>&nbsp;<span class="op" id="5470995">[</span><span class="op" id="5470996">]</span><span class="builtintype" id="5470997">rune</span><span class="op" id="5471001">,</span>&nbsp;<span class="ident" id="5471003">x</span>&nbsp;<span class="op" id="5471005">*</span><span class="ident" id="5471006">unicode</span><span class="op" id="5471013">.</span><span class="ident" id="5471014">RangeTable</span><span class="op" id="5471024">)</span>&nbsp;<span class="op" id="5471026">[</span><span class="op" id="5471027">]</span><span class="builtintype" id="5471028">rune</span>&nbsp;<span class="op" id="5471033">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471036">for</span>&nbsp;<span class="ident" id="5471040">_</span><span class="op" id="5471041">,</span>&nbsp;<span class="ident" id="5471043">xr</span>&nbsp;<span class="op" id="5471046">:=</span>&nbsp;<span class="keyword" id="5471049">range</span>&nbsp;<span class="ident" id="5471055">x</span><span class="op" id="5471056">.</span><span class="ident" id="5471057">R16</span>&nbsp;<span class="op" id="5471061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471065">lo</span><span class="op" id="5471067">,</span>&nbsp;<span class="ident" id="5471069">hi</span><span class="op" id="5471071">,</span>&nbsp;<span class="ident" id="5471073">stride</span>&nbsp;<span class="op" id="5471080">:=</span>&nbsp;<span class="builtintype" id="5471083">rune</span><span class="op" id="5471087">(</span><span class="ident" id="5471088">xr</span><span class="op" id="5471090">.</span><span class="ident" id="5471091">Lo</span><span class="op" id="5471093">)</span><span class="op" id="5471094">,</span>&nbsp;<span class="builtintype" id="5471096">rune</span><span class="op" id="5471100">(</span><span class="ident" id="5471101">xr</span><span class="op" id="5471103">.</span><span class="ident" id="5471104">Hi</span><span class="op" id="5471106">)</span><span class="op" id="5471107">,</span>&nbsp;<span class="builtintype" id="5471109">rune</span><span class="op" id="5471113">(</span><span class="ident" id="5471114">xr</span><span class="op" id="5471116">.</span><span class="ident" id="5471117">Stride</span><span class="op" id="5471123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471127">if</span>&nbsp;<span class="ident" id="5471130">stride</span>&nbsp;<span class="op" id="5471137">==</span>&nbsp;<span class="num" id="5471140">1</span>&nbsp;<span class="op" id="5471142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471147">r</span>&nbsp;<span class="op" id="5471149">=</span>&nbsp;<span class="ident" id="5471151">appendRange</span><span class="op" id="5471162">(</span><span class="ident" id="5471163">r</span><span class="op" id="5471164">,</span>&nbsp;<span class="ident" id="5471166">lo</span><span class="op" id="5471168">,</span>&nbsp;<span class="ident" id="5471170">hi</span><span class="op" id="5471172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471177">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471192">for</span>&nbsp;<span class="ident" id="5471196">c</span>&nbsp;<span class="op" id="5471198">:=</span>&nbsp;<span class="ident" id="5471201">lo</span><span class="op" id="5471203">;</span>&nbsp;<span class="ident" id="5471205">c</span>&nbsp;<span class="op" id="5471207">&lt;=</span>&nbsp;<span class="ident" id="5471210">hi</span><span class="op" id="5471212">;</span>&nbsp;<span class="ident" id="5471214">c</span>&nbsp;<span class="op" id="5471216">+=</span>&nbsp;<span class="ident" id="5471219">stride</span>&nbsp;<span class="op" id="5471226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471231">r</span>&nbsp;<span class="op" id="5471233">=</span>&nbsp;<span class="ident" id="5471235">appendRange</span><span class="op" id="5471246">(</span><span class="ident" id="5471247">r</span><span class="op" id="5471248">,</span>&nbsp;<span class="ident" id="5471250">c</span><span class="op" id="5471251">,</span>&nbsp;<span class="ident" id="5471253">c</span><span class="op" id="5471254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471261">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471264">for</span>&nbsp;<span class="ident" id="5471268">_</span><span class="op" id="5471269">,</span>&nbsp;<span class="ident" id="5471271">xr</span>&nbsp;<span class="op" id="5471274">:=</span>&nbsp;<span class="keyword" id="5471277">range</span>&nbsp;<span class="ident" id="5471283">x</span><span class="op" id="5471284">.</span><span class="ident" id="5471285">R32</span>&nbsp;<span class="op" id="5471289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471293">lo</span><span class="op" id="5471295">,</span>&nbsp;<span class="ident" id="5471297">hi</span><span class="op" id="5471299">,</span>&nbsp;<span class="ident" id="5471301">stride</span>&nbsp;<span class="op" id="5471308">:=</span>&nbsp;<span class="builtintype" id="5471311">rune</span><span class="op" id="5471315">(</span><span class="ident" id="5471316">xr</span><span class="op" id="5471318">.</span><span class="ident" id="5471319">Lo</span><span class="op" id="5471321">)</span><span class="op" id="5471322">,</span>&nbsp;<span class="builtintype" id="5471324">rune</span><span class="op" id="5471328">(</span><span class="ident" id="5471329">xr</span><span class="op" id="5471331">.</span><span class="ident" id="5471332">Hi</span><span class="op" id="5471334">)</span><span class="op" id="5471335">,</span>&nbsp;<span class="builtintype" id="5471337">rune</span><span class="op" id="5471341">(</span><span class="ident" id="5471342">xr</span><span class="op" id="5471344">.</span><span class="ident" id="5471345">Stride</span><span class="op" id="5471351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471355">if</span>&nbsp;<span class="ident" id="5471358">stride</span>&nbsp;<span class="op" id="5471365">==</span>&nbsp;<span class="num" id="5471368">1</span>&nbsp;<span class="op" id="5471370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471375">r</span>&nbsp;<span class="op" id="5471377">=</span>&nbsp;<span class="ident" id="5471379">appendRange</span><span class="op" id="5471390">(</span><span class="ident" id="5471391">r</span><span class="op" id="5471392">,</span>&nbsp;<span class="ident" id="5471394">lo</span><span class="op" id="5471396">,</span>&nbsp;<span class="ident" id="5471398">hi</span><span class="op" id="5471400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471405">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471420">for</span>&nbsp;<span class="ident" id="5471424">c</span>&nbsp;<span class="op" id="5471426">:=</span>&nbsp;<span class="ident" id="5471429">lo</span><span class="op" id="5471431">;</span>&nbsp;<span class="ident" id="5471433">c</span>&nbsp;<span class="op" id="5471435">&lt;=</span>&nbsp;<span class="ident" id="5471438">hi</span><span class="op" id="5471440">;</span>&nbsp;<span class="ident" id="5471442">c</span>&nbsp;<span class="op" id="5471444">+=</span>&nbsp;<span class="ident" id="5471447">stride</span>&nbsp;<span class="op" id="5471454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471459">r</span>&nbsp;<span class="op" id="5471461">=</span>&nbsp;<span class="ident" id="5471463">appendRange</span><span class="op" id="5471474">(</span><span class="ident" id="5471475">r</span><span class="op" id="5471476">,</span>&nbsp;<span class="ident" id="5471478">c</span><span class="op" id="5471479">,</span>&nbsp;<span class="ident" id="5471481">c</span><span class="op" id="5471482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471489">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471492">return</span>&nbsp;<span class="ident" id="5471499">r</span><br>
<span class="lineno"></span><span class="op" id="5471501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5471504">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5471592">func</span>&nbsp;<span class="ident" id="5471597">appendNegatedTable</span><span class="op" id="5471615">(</span><span class="ident" id="5471616">r</span>&nbsp;<span class="op" id="5471618">[</span><span class="op" id="5471619">]</span><span class="builtintype" id="5471620">rune</span><span class="op" id="5471624">,</span>&nbsp;<span class="ident" id="5471626">x</span>&nbsp;<span class="op" id="5471628">*</span><span class="ident" id="5471629">unicode</span><span class="op" id="5471636">.</span><span class="ident" id="5471637">RangeTable</span><span class="op" id="5471647">)</span>&nbsp;<span class="op" id="5471649">[</span><span class="op" id="5471650">]</span><span class="builtintype" id="5471651">rune</span>&nbsp;<span class="op" id="5471656">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471659">nextLo</span>&nbsp;<span class="op" id="5471666">:=</span>&nbsp;<span class="string" id="5471669">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5471678">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471710">for</span>&nbsp;<span class="ident" id="5471714">_</span><span class="op" id="5471715">,</span>&nbsp;<span class="ident" id="5471717">xr</span>&nbsp;<span class="op" id="5471720">:=</span>&nbsp;<span class="keyword" id="5471723">range</span>&nbsp;<span class="ident" id="5471729">x</span><span class="op" id="5471730">.</span><span class="ident" id="5471731">R16</span>&nbsp;<span class="op" id="5471735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471739">lo</span><span class="op" id="5471741">,</span>&nbsp;<span class="ident" id="5471743">hi</span><span class="op" id="5471745">,</span>&nbsp;<span class="ident" id="5471747">stride</span>&nbsp;<span class="op" id="5471754">:=</span>&nbsp;<span class="builtintype" id="5471757">rune</span><span class="op" id="5471761">(</span><span class="ident" id="5471762">xr</span><span class="op" id="5471764">.</span><span class="ident" id="5471765">Lo</span><span class="op" id="5471767">)</span><span class="op" id="5471768">,</span>&nbsp;<span class="builtintype" id="5471770">rune</span><span class="op" id="5471774">(</span><span class="ident" id="5471775">xr</span><span class="op" id="5471777">.</span><span class="ident" id="5471778">Hi</span><span class="op" id="5471780">)</span><span class="op" id="5471781">,</span>&nbsp;<span class="builtintype" id="5471783">rune</span><span class="op" id="5471787">(</span><span class="ident" id="5471788">xr</span><span class="op" id="5471790">.</span><span class="ident" id="5471791">Stride</span><span class="op" id="5471797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471801">if</span>&nbsp;<span class="ident" id="5471804">stride</span>&nbsp;<span class="op" id="5471811">==</span>&nbsp;<span class="num" id="5471814">1</span>&nbsp;<span class="op" id="5471816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471821">if</span>&nbsp;<span class="ident" id="5471824">nextLo</span>&nbsp;<span class="op" id="5471831">&lt;=</span>&nbsp;<span class="ident" id="5471834">lo</span><span class="op" id="5471836">-</span><span class="num" id="5471837">1</span>&nbsp;<span class="op" id="5471839">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471845">r</span>&nbsp;<span class="op" id="5471847">=</span>&nbsp;<span class="ident" id="5471849">appendRange</span><span class="op" id="5471860">(</span><span class="ident" id="5471861">r</span><span class="op" id="5471862">,</span>&nbsp;<span class="ident" id="5471864">nextLo</span><span class="op" id="5471870">,</span>&nbsp;<span class="ident" id="5471872">lo</span><span class="op" id="5471874">-</span><span class="num" id="5471875">1</span><span class="op" id="5471876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471886">nextLo</span>&nbsp;<span class="op" id="5471893">=</span>&nbsp;<span class="ident" id="5471895">hi</span>&nbsp;<span class="op" id="5471898">+</span>&nbsp;<span class="num" id="5471900">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471905">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5471916">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471920">for</span>&nbsp;<span class="ident" id="5471924">c</span>&nbsp;<span class="op" id="5471926">:=</span>&nbsp;<span class="ident" id="5471929">lo</span><span class="op" id="5471931">;</span>&nbsp;<span class="ident" id="5471933">c</span>&nbsp;<span class="op" id="5471935">&lt;=</span>&nbsp;<span class="ident" id="5471938">hi</span><span class="op" id="5471940">;</span>&nbsp;<span class="ident" id="5471942">c</span>&nbsp;<span class="op" id="5471944">+=</span>&nbsp;<span class="ident" id="5471947">stride</span>&nbsp;<span class="op" id="5471954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471959">if</span>&nbsp;<span class="ident" id="5471962">nextLo</span>&nbsp;<span class="op" id="5471969">&lt;=</span>&nbsp;<span class="ident" id="5471972">c</span><span class="op" id="5471973">-</span><span class="num" id="5471974">1</span>&nbsp;<span class="op" id="5471976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471982">r</span>&nbsp;<span class="op" id="5471984">=</span>&nbsp;<span class="ident" id="5471986">appendRange</span><span class="op" id="5471997">(</span><span class="ident" id="5471998">r</span><span class="op" id="5471999">,</span>&nbsp;<span class="ident" id="5472001">nextLo</span><span class="op" id="5472007">,</span>&nbsp;<span class="ident" id="5472009">c</span><span class="op" id="5472010">-</span><span class="num" id="5472011">1</span><span class="op" id="5472012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472022">nextLo</span>&nbsp;<span class="op" id="5472029">=</span>&nbsp;<span class="ident" id="5472031">c</span>&nbsp;<span class="op" id="5472033">+</span>&nbsp;<span class="num" id="5472035">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472045">for</span>&nbsp;<span class="ident" id="5472049">_</span><span class="op" id="5472050">,</span>&nbsp;<span class="ident" id="5472052">xr</span>&nbsp;<span class="op" id="5472055">:=</span>&nbsp;<span class="keyword" id="5472058">range</span>&nbsp;<span class="ident" id="5472064">x</span><span class="op" id="5472065">.</span><span class="ident" id="5472066">R32</span>&nbsp;<span class="op" id="5472070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472074">lo</span><span class="op" id="5472076">,</span>&nbsp;<span class="ident" id="5472078">hi</span><span class="op" id="5472080">,</span>&nbsp;<span class="ident" id="5472082">stride</span>&nbsp;<span class="op" id="5472089">:=</span>&nbsp;<span class="builtintype" id="5472092">rune</span><span class="op" id="5472096">(</span><span class="ident" id="5472097">xr</span><span class="op" id="5472099">.</span><span class="ident" id="5472100">Lo</span><span class="op" id="5472102">)</span><span class="op" id="5472103">,</span>&nbsp;<span class="builtintype" id="5472105">rune</span><span class="op" id="5472109">(</span><span class="ident" id="5472110">xr</span><span class="op" id="5472112">.</span><span class="ident" id="5472113">Hi</span><span class="op" id="5472115">)</span><span class="op" id="5472116">,</span>&nbsp;<span class="builtintype" id="5472118">rune</span><span class="op" id="5472122">(</span><span class="ident" id="5472123">xr</span><span class="op" id="5472125">.</span><span class="ident" id="5472126">Stride</span><span class="op" id="5472132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472136">if</span>&nbsp;<span class="ident" id="5472139">stride</span>&nbsp;<span class="op" id="5472146">==</span>&nbsp;<span class="num" id="5472149">1</span>&nbsp;<span class="op" id="5472151">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472156">if</span>&nbsp;<span class="ident" id="5472159">nextLo</span>&nbsp;<span class="op" id="5472166">&lt;=</span>&nbsp;<span class="ident" id="5472169">lo</span><span class="op" id="5472171">-</span><span class="num" id="5472172">1</span>&nbsp;<span class="op" id="5472174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472180">r</span>&nbsp;<span class="op" id="5472182">=</span>&nbsp;<span class="ident" id="5472184">appendRange</span><span class="op" id="5472195">(</span><span class="ident" id="5472196">r</span><span class="op" id="5472197">,</span>&nbsp;<span class="ident" id="5472199">nextLo</span><span class="op" id="5472205">,</span>&nbsp;<span class="ident" id="5472207">lo</span><span class="op" id="5472209">-</span><span class="num" id="5472210">1</span><span class="op" id="5472211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472221">nextLo</span>&nbsp;<span class="op" id="5472228">=</span>&nbsp;<span class="ident" id="5472230">hi</span>&nbsp;<span class="op" id="5472233">+</span>&nbsp;<span class="num" id="5472235">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472240">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472255">for</span>&nbsp;<span class="ident" id="5472259">c</span>&nbsp;<span class="op" id="5472261">:=</span>&nbsp;<span class="ident" id="5472264">lo</span><span class="op" id="5472266">;</span>&nbsp;<span class="ident" id="5472268">c</span>&nbsp;<span class="op" id="5472270">&lt;=</span>&nbsp;<span class="ident" id="5472273">hi</span><span class="op" id="5472275">;</span>&nbsp;<span class="ident" id="5472277">c</span>&nbsp;<span class="op" id="5472279">+=</span>&nbsp;<span class="ident" id="5472282">stride</span>&nbsp;<span class="op" id="5472289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472294">if</span>&nbsp;<span class="ident" id="5472297">nextLo</span>&nbsp;<span class="op" id="5472304">&lt;=</span>&nbsp;<span class="ident" id="5472307">c</span><span class="op" id="5472308">-</span><span class="num" id="5472309">1</span>&nbsp;<span class="op" id="5472311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472317">r</span>&nbsp;<span class="op" id="5472319">=</span>&nbsp;<span class="ident" id="5472321">appendRange</span><span class="op" id="5472332">(</span><span class="ident" id="5472333">r</span><span class="op" id="5472334">,</span>&nbsp;<span class="ident" id="5472336">nextLo</span><span class="op" id="5472342">,</span>&nbsp;<span class="ident" id="5472344">c</span><span class="op" id="5472345">-</span><span class="num" id="5472346">1</span><span class="op" id="5472347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472352">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472357">nextLo</span>&nbsp;<span class="op" id="5472364">=</span>&nbsp;<span class="ident" id="5472366">c</span>&nbsp;<span class="op" id="5472368">+</span>&nbsp;<span class="num" id="5472370">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472380">if</span>&nbsp;<span class="ident" id="5472383">nextLo</span>&nbsp;<span class="op" id="5472390">&lt;=</span>&nbsp;<span class="ident" id="5472393">unicode</span><span class="op" id="5472400">.</span><span class="ident" id="5472401">MaxRune</span>&nbsp;<span class="op" id="5472409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472413">r</span>&nbsp;<span class="op" id="5472415">=</span>&nbsp;<span class="ident" id="5472417">appendRange</span><span class="op" id="5472428">(</span><span class="ident" id="5472429">r</span><span class="op" id="5472430">,</span>&nbsp;<span class="ident" id="5472432">nextLo</span><span class="op" id="5472438">,</span>&nbsp;<span class="ident" id="5472440">unicode</span><span class="op" id="5472447">.</span><span class="ident" id="5472448">MaxRune</span><span class="op" id="5472455">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472461">return</span>&nbsp;<span class="ident" id="5472468">r</span><br>
<span class="lineno"></span><span class="op" id="5472470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5472473">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5472527">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5472571">func</span>&nbsp;<span class="ident" id="5472576">negateClass</span><span class="op" id="5472587">(</span><span class="ident" id="5472588">r</span>&nbsp;<span class="op" id="5472590">[</span><span class="op" id="5472591">]</span><span class="builtintype" id="5472592">rune</span><span class="op" id="5472596">)</span>&nbsp;<span class="op" id="5472598">[</span><span class="op" id="5472599">]</span><span class="builtintype" id="5472600">rune</span>&nbsp;<span class="op" id="5472605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472608">nextLo</span>&nbsp;<span class="op" id="5472615">:=</span>&nbsp;<span class="string" id="5472618">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5472627">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472659">w</span>&nbsp;<span class="op" id="5472661">:=</span>&nbsp;<span class="num" id="5472664">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5472678">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472694">for</span>&nbsp;<span class="ident" id="5472698">i</span>&nbsp;<span class="op" id="5472700">:=</span>&nbsp;<span class="num" id="5472703">0</span><span class="op" id="5472704">;</span>&nbsp;<span class="ident" id="5472706">i</span>&nbsp;<span class="op" id="5472708">&lt;</span>&nbsp;<span class="builtinfunc" id="5472710">len</span><span class="op" id="5472713">(</span><span class="ident" id="5472714">r</span><span class="op" id="5472715">)</span><span class="op" id="5472716">;</span>&nbsp;<span class="ident" id="5472718">i</span>&nbsp;<span class="op" id="5472720">+=</span>&nbsp;<span class="num" id="5472723">2</span>&nbsp;<span class="op" id="5472725">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472729">lo</span><span class="op" id="5472731">,</span>&nbsp;<span class="ident" id="5472733">hi</span>&nbsp;<span class="op" id="5472736">:=</span>&nbsp;<span class="ident" id="5472739">r</span><span class="op" id="5472740">[</span><span class="ident" id="5472741">i</span><span class="op" id="5472742">]</span><span class="op" id="5472743">,</span>&nbsp;<span class="ident" id="5472745">r</span><span class="op" id="5472746">[</span><span class="ident" id="5472747">i</span><span class="op" id="5472748">+</span><span class="num" id="5472749">1</span><span class="op" id="5472750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472754">if</span>&nbsp;<span class="ident" id="5472757">nextLo</span>&nbsp;<span class="op" id="5472764">&lt;=</span>&nbsp;<span class="ident" id="5472767">lo</span><span class="op" id="5472769">-</span><span class="num" id="5472770">1</span>&nbsp;<span class="op" id="5472772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472777">r</span><span class="op" id="5472778">[</span><span class="ident" id="5472779">w</span><span class="op" id="5472780">]</span>&nbsp;<span class="op" id="5472782">=</span>&nbsp;<span class="ident" id="5472784">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472794">r</span><span class="op" id="5472795">[</span><span class="ident" id="5472796">w</span><span class="op" id="5472797">+</span><span class="num" id="5472798">1</span><span class="op" id="5472799">]</span>&nbsp;<span class="op" id="5472801">=</span>&nbsp;<span class="ident" id="5472803">lo</span>&nbsp;<span class="op" id="5472806">-</span>&nbsp;<span class="num" id="5472808">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472813">w</span>&nbsp;<span class="op" id="5472815">+=</span>&nbsp;<span class="num" id="5472818">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472826">nextLo</span>&nbsp;<span class="op" id="5472833">=</span>&nbsp;<span class="ident" id="5472835">hi</span>&nbsp;<span class="op" id="5472838">+</span>&nbsp;<span class="num" id="5472840">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472846">r</span>&nbsp;<span class="op" id="5472848">=</span>&nbsp;<span class="ident" id="5472850">r</span><span class="op" id="5472851">[</span><span class="op" id="5472852">:</span><span class="ident" id="5472853">w</span><span class="op" id="5472854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472857">if</span>&nbsp;<span class="ident" id="5472860">nextLo</span>&nbsp;<span class="op" id="5472867">&lt;=</span>&nbsp;<span class="ident" id="5472870">unicode</span><span class="op" id="5472877">.</span><span class="ident" id="5472878">MaxRune</span>&nbsp;<span class="op" id="5472886">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5472890">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5472943">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473007">r</span>&nbsp;<span class="op" id="5473009">=</span>&nbsp;<span class="builtinfunc" id="5473011">append</span><span class="op" id="5473017">(</span><span class="ident" id="5473018">r</span><span class="op" id="5473019">,</span>&nbsp;<span class="ident" id="5473021">nextLo</span><span class="op" id="5473027">,</span>&nbsp;<span class="ident" id="5473029">unicode</span><span class="op" id="5473036">.</span><span class="ident" id="5473037">MaxRune</span><span class="op" id="5473044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473050">return</span>&nbsp;<span class="ident" id="5473057">r</span><br>
<span class="lineno">1840</span><span class="op" id="5473059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5473062">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5473111">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5473164">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5473214">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5473228">type</span>&nbsp;<span class="ident" id="5473233">ranges</span>&nbsp;<span class="keyword" id="5473240">struct</span>&nbsp;<span class="op" id="5473247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473250">p</span>&nbsp;<span class="op" id="5473252">*</span><span class="op" id="5473253">[</span><span class="op" id="5473254">]</span><span class="builtintype" id="5473255">rune</span><br>
<span class="lineno"></span><span class="op" id="5473260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5473263">func</span>&nbsp;<span class="op" id="5473268">(</span><span class="ident" id="5473269">ra</span>&nbsp;<span class="ident" id="5473272">ranges</span><span class="op" id="5473278">)</span>&nbsp;<span class="ident" id="5473280">Less</span><span class="op" id="5473284">(</span><span class="ident" id="5473285">i</span><span class="op" id="5473286">,</span>&nbsp;<span class="ident" id="5473288">j</span>&nbsp;<span class="builtintype" id="5473290">int</span><span class="op" id="5473293">)</span>&nbsp;<span class="builtintype" id="5473295">bool</span>&nbsp;<span class="op" id="5473300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473303">p</span>&nbsp;<span class="op" id="5473305">:=</span>&nbsp;<span class="op" id="5473308">*</span><span class="ident" id="5473309">ra</span><span class="op" id="5473311">.</span><span class="ident" id="5473312">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473315">i</span>&nbsp;<span class="op" id="5473317">*=</span>&nbsp;<span class="num" id="5473320">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473323">j</span>&nbsp;<span class="op" id="5473325">*=</span>&nbsp;<span class="num" id="5473328">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473331">return</span>&nbsp;<span class="ident" id="5473338">p</span><span class="op" id="5473339">[</span><span class="ident" id="5473340">i</span><span class="op" id="5473341">]</span>&nbsp;<span class="op" id="5473343">&lt;</span>&nbsp;<span class="ident" id="5473345">p</span><span class="op" id="5473346">[</span><span class="ident" id="5473347">j</span><span class="op" id="5473348">]</span>&nbsp;<span class="op" id="5473350">||</span>&nbsp;<span class="ident" id="5473353">p</span><span class="op" id="5473354">[</span><span class="ident" id="5473355">i</span><span class="op" id="5473356">]</span>&nbsp;<span class="op" id="5473358">==</span>&nbsp;<span class="ident" id="5473361">p</span><span class="op" id="5473362">[</span><span class="ident" id="5473363">j</span><span class="op" id="5473364">]</span>&nbsp;<span class="op" id="5473366">&amp;&amp;</span>&nbsp;<span class="ident" id="5473369">p</span><span class="op" id="5473370">[</span><span class="ident" id="5473371">i</span><span class="op" id="5473372">+</span><span class="num" id="5473373">1</span><span class="op" id="5473374">]</span>&nbsp;<span class="op" id="5473376">&gt;</span>&nbsp;<span class="ident" id="5473378">p</span><span class="op" id="5473379">[</span><span class="ident" id="5473380">j</span><span class="op" id="5473381">+</span><span class="num" id="5473382">1</span><span class="op" id="5473383">]</span><br>
<span class="lineno">1855</span><span class="op" id="5473385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473388">func</span>&nbsp;<span class="op" id="5473393">(</span><span class="ident" id="5473394">ra</span>&nbsp;<span class="ident" id="5473397">ranges</span><span class="op" id="5473403">)</span>&nbsp;<span class="ident" id="5473405">Len</span><span class="op" id="5473408">(</span><span class="op" id="5473409">)</span>&nbsp;<span class="builtintype" id="5473411">int</span>&nbsp;<span class="op" id="5473415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473418">return</span>&nbsp;<span class="builtinfunc" id="5473425">len</span><span class="op" id="5473428">(</span><span class="op" id="5473429">*</span><span class="ident" id="5473430">ra</span><span class="op" id="5473432">.</span><span class="ident" id="5473433">p</span><span class="op" id="5473434">)</span>&nbsp;<span class="op" id="5473436">/</span>&nbsp;<span class="num" id="5473438">2</span><br>
<span class="lineno"></span><span class="op" id="5473440">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5473443">func</span>&nbsp;<span class="op" id="5473448">(</span><span class="ident" id="5473449">ra</span>&nbsp;<span class="ident" id="5473452">ranges</span><span class="op" id="5473458">)</span>&nbsp;<span class="ident" id="5473460">Swap</span><span class="op" id="5473464">(</span><span class="ident" id="5473465">i</span><span class="op" id="5473466">,</span>&nbsp;<span class="ident" id="5473468">j</span>&nbsp;<span class="builtintype" id="5473470">int</span><span class="op" id="5473473">)</span>&nbsp;<span class="op" id="5473475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473478">p</span>&nbsp;<span class="op" id="5473480">:=</span>&nbsp;<span class="op" id="5473483">*</span><span class="ident" id="5473484">ra</span><span class="op" id="5473486">.</span><span class="ident" id="5473487">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473490">i</span>&nbsp;<span class="op" id="5473492">*=</span>&nbsp;<span class="num" id="5473495">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473498">j</span>&nbsp;<span class="op" id="5473500">*=</span>&nbsp;<span class="num" id="5473503">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473506">p</span><span class="op" id="5473507">[</span><span class="ident" id="5473508">i</span><span class="op" id="5473509">]</span><span class="op" id="5473510">,</span>&nbsp;<span class="ident" id="5473512">p</span><span class="op" id="5473513">[</span><span class="ident" id="5473514">i</span><span class="op" id="5473515">+</span><span class="num" id="5473516">1</span><span class="op" id="5473517">]</span><span class="op" id="5473518">,</span>&nbsp;<span class="ident" id="5473520">p</span><span class="op" id="5473521">[</span><span class="ident" id="5473522">j</span><span class="op" id="5473523">]</span><span class="op" id="5473524">,</span>&nbsp;<span class="ident" id="5473526">p</span><span class="op" id="5473527">[</span><span class="ident" id="5473528">j</span><span class="op" id="5473529">+</span><span class="num" id="5473530">1</span><span class="op" id="5473531">]</span>&nbsp;<span class="op" id="5473533">=</span>&nbsp;<span class="ident" id="5473535">p</span><span class="op" id="5473536">[</span><span class="ident" id="5473537">j</span><span class="op" id="5473538">]</span><span class="op" id="5473539">,</span>&nbsp;<span class="ident" id="5473541">p</span><span class="op" id="5473542">[</span><span class="ident" id="5473543">j</span><span class="op" id="5473544">+</span><span class="num" id="5473545">1</span><span class="op" id="5473546">]</span><span class="op" id="5473547">,</span>&nbsp;<span class="ident" id="5473549">p</span><span class="op" id="5473550">[</span><span class="ident" id="5473551">i</span><span class="op" id="5473552">]</span><span class="op" id="5473553">,</span>&nbsp;<span class="ident" id="5473555">p</span><span class="op" id="5473556">[</span><span class="ident" id="5473557">i</span><span class="op" id="5473558">+</span><span class="num" id="5473559">1</span><span class="op" id="5473560">]</span><br>
<span class="lineno"></span><span class="op" id="5473562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473565">func</span>&nbsp;<span class="ident" id="5473570">checkUTF8</span><span class="op" id="5473579">(</span><span class="ident" id="5473580">s</span>&nbsp;<span class="builtintype" id="5473582">string</span><span class="op" id="5473588">)</span>&nbsp;<span class="builtintype" id="5473590">error</span>&nbsp;<span class="op" id="5473596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473599">for</span>&nbsp;<span class="ident" id="5473603">s</span>&nbsp;<span class="op" id="5473605">!=</span>&nbsp;<span class="string" id="5473608">&#34;&#34;</span>&nbsp;<span class="op" id="5473611">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5473615">rune</span><span class="op" id="5473619">,</span>&nbsp;<span class="ident" id="5473621">size</span>&nbsp;<span class="op" id="5473626">:=</span>&nbsp;<span class="ident" id="5473629">utf8</span><span class="op" id="5473633">.</span><span class="ident" id="5473634">DecodeRuneInString</span><span class="op" id="5473652">(</span><span class="ident" id="5473653">s</span><span class="op" id="5473654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473658">if</span>&nbsp;<span class="builtintype" id="5473661">rune</span>&nbsp;<span class="op" id="5473666">==</span>&nbsp;<span class="ident" id="5473669">utf8</span><span class="op" id="5473673">.</span><span class="ident" id="5473674">RuneError</span>&nbsp;<span class="op" id="5473684">&amp;&amp;</span>&nbsp;<span class="ident" id="5473687">size</span>&nbsp;<span class="op" id="5473692">==</span>&nbsp;<span class="num" id="5473695">1</span>&nbsp;<span class="op" id="5473697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473702">return</span>&nbsp;<span class="op" id="5473709">&amp;</span><span class="ident" id="5473710">Error</span><span class="op" id="5473715">{</span><span class="ident" id="5473716">Code</span><span class="op" id="5473720">:</span>&nbsp;<span class="ident" id="5473722">ErrInvalidUTF8</span><span class="op" id="5473736">,</span>&nbsp;<span class="ident" id="5473738">Expr</span><span class="op" id="5473742">:</span>&nbsp;<span class="ident" id="5473744">s</span><span class="op" id="5473745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473753">s</span>&nbsp;<span class="op" id="5473755">=</span>&nbsp;<span class="ident" id="5473757">s</span><span class="op" id="5473758">[</span><span class="ident" id="5473759">size</span><span class="op" id="5473763">:</span><span class="op" id="5473764">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473770">return</span>&nbsp;<span class="ident" id="5473777">nil</span><br>
<span class="lineno"></span><span class="op" id="5473781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473784">func</span>&nbsp;<span class="ident" id="5473789">nextRune</span><span class="op" id="5473797">(</span><span class="ident" id="5473798">s</span>&nbsp;<span class="builtintype" id="5473800">string</span><span class="op" id="5473806">)</span>&nbsp;<span class="op" id="5473808">(</span><span class="ident" id="5473809">c</span>&nbsp;<span class="builtintype" id="5473811">rune</span><span class="op" id="5473815">,</span>&nbsp;<span class="ident" id="5473817">t</span>&nbsp;<span class="builtintype" id="5473819">string</span><span class="op" id="5473825">,</span>&nbsp;<span class="ident" id="5473827">err</span>&nbsp;<span class="builtintype" id="5473831">error</span><span class="op" id="5473836">)</span>&nbsp;<span class="op" id="5473838">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473841">c</span><span class="op" id="5473842">,</span>&nbsp;<span class="ident" id="5473844">size</span>&nbsp;<span class="op" id="5473849">:=</span>&nbsp;<span class="ident" id="5473852">utf8</span><span class="op" id="5473856">.</span><span class="ident" id="5473857">DecodeRuneInString</span><span class="op" id="5473875">(</span><span class="ident" id="5473876">s</span><span class="op" id="5473877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473880">if</span>&nbsp;<span class="ident" id="5473883">c</span>&nbsp;<span class="op" id="5473885">==</span>&nbsp;<span class="ident" id="5473888">utf8</span><span class="op" id="5473892">.</span><span class="ident" id="5473893">RuneError</span>&nbsp;<span class="op" id="5473903">&amp;&amp;</span>&nbsp;<span class="ident" id="5473906">size</span>&nbsp;<span class="op" id="5473911">==</span>&nbsp;<span class="num" id="5473914">1</span>&nbsp;<span class="op" id="5473916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473920">return</span>&nbsp;<span class="num" id="5473927">0</span><span class="op" id="5473928">,</span>&nbsp;<span class="string" id="5473930">&#34;&#34;</span><span class="op" id="5473932">,</span>&nbsp;<span class="op" id="5473934">&amp;</span><span class="ident" id="5473935">Error</span><span class="op" id="5473940">{</span><span class="ident" id="5473941">Code</span><span class="op" id="5473945">:</span>&nbsp;<span class="ident" id="5473947">ErrInvalidUTF8</span><span class="op" id="5473961">,</span>&nbsp;<span class="ident" id="5473963">Expr</span><span class="op" id="5473967">:</span>&nbsp;<span class="ident" id="5473969">s</span><span class="op" id="5473970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473976">return</span>&nbsp;<span class="ident" id="5473983">c</span><span class="op" id="5473984">,</span>&nbsp;<span class="ident" id="5473986">s</span><span class="op" id="5473987">[</span><span class="ident" id="5473988">size</span><span class="op" id="5473992">:</span><span class="op" id="5473993">]</span><span class="op" id="5473994">,</span>&nbsp;<span class="ident" id="5473996">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5474000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5474003">func</span>&nbsp;<span class="ident" id="5474008">isalnum</span><span class="op" id="5474015">(</span><span class="ident" id="5474016">c</span>&nbsp;<span class="builtintype" id="5474018">rune</span><span class="op" id="5474022">)</span>&nbsp;<span class="builtintype" id="5474024">bool</span>&nbsp;<span class="op" id="5474029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474032">return</span>&nbsp;<span class="string" id="5474039">&#39;0&#39;</span>&nbsp;<span class="op" id="5474043">&lt;=</span>&nbsp;<span class="ident" id="5474046">c</span>&nbsp;<span class="op" id="5474048">&amp;&amp;</span>&nbsp;<span class="ident" id="5474051">c</span>&nbsp;<span class="op" id="5474053">&lt;=</span>&nbsp;<span class="string" id="5474056">&#39;9&#39;</span>&nbsp;<span class="op" id="5474060">||</span>&nbsp;<span class="string" id="5474063">&#39;A&#39;</span>&nbsp;<span class="op" id="5474067">&lt;=</span>&nbsp;<span class="ident" id="5474070">c</span>&nbsp;<span class="op" id="5474072">&amp;&amp;</span>&nbsp;<span class="ident" id="5474075">c</span>&nbsp;<span class="op" id="5474077">&lt;=</span>&nbsp;<span class="string" id="5474080">&#39;Z&#39;</span>&nbsp;<span class="op" id="5474084">||</span>&nbsp;<span class="string" id="5474087">&#39;a&#39;</span>&nbsp;<span class="op" id="5474091">&lt;=</span>&nbsp;<span class="ident" id="5474094">c</span>&nbsp;<span class="op" id="5474096">&amp;&amp;</span>&nbsp;<span class="ident" id="5474099">c</span>&nbsp;<span class="op" id="5474101">&lt;=</span>&nbsp;<span class="string" id="5474104">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5474108">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5474111">func</span>&nbsp;<span class="ident" id="5474116">unhex</span><span class="op" id="5474121">(</span><span class="ident" id="5474122">c</span>&nbsp;<span class="builtintype" id="5474124">rune</span><span class="op" id="5474128">)</span>&nbsp;<span class="builtintype" id="5474130">rune</span>&nbsp;<span class="op" id="5474135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474138">if</span>&nbsp;<span class="string" id="5474141">&#39;0&#39;</span>&nbsp;<span class="op" id="5474145">&lt;=</span>&nbsp;<span class="ident" id="5474148">c</span>&nbsp;<span class="op" id="5474150">&amp;&amp;</span>&nbsp;<span class="ident" id="5474153">c</span>&nbsp;<span class="op" id="5474155">&lt;=</span>&nbsp;<span class="string" id="5474158">&#39;9&#39;</span>&nbsp;<span class="op" id="5474162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474166">return</span>&nbsp;<span class="ident" id="5474173">c</span>&nbsp;<span class="op" id="5474175">-</span>&nbsp;<span class="string" id="5474177">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474182">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474185">if</span>&nbsp;<span class="string" id="5474188">&#39;a&#39;</span>&nbsp;<span class="op" id="5474192">&lt;=</span>&nbsp;<span class="ident" id="5474195">c</span>&nbsp;<span class="op" id="5474197">&amp;&amp;</span>&nbsp;<span class="ident" id="5474200">c</span>&nbsp;<span class="op" id="5474202">&lt;=</span>&nbsp;<span class="string" id="5474205">&#39;f&#39;</span>&nbsp;<span class="op" id="5474209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474213">return</span>&nbsp;<span class="ident" id="5474220">c</span>&nbsp;<span class="op" id="5474222">-</span>&nbsp;<span class="string" id="5474224">&#39;a&#39;</span>&nbsp;<span class="op" id="5474228">+</span>&nbsp;<span class="num" id="5474230">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474237">if</span>&nbsp;<span class="string" id="5474240">&#39;A&#39;</span>&nbsp;<span class="op" id="5474244">&lt;=</span>&nbsp;<span class="ident" id="5474247">c</span>&nbsp;<span class="op" id="5474249">&amp;&amp;</span>&nbsp;<span class="ident" id="5474252">c</span>&nbsp;<span class="op" id="5474254">&lt;=</span>&nbsp;<span class="string" id="5474257">&#39;F&#39;</span>&nbsp;<span class="op" id="5474261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474265">return</span>&nbsp;<span class="ident" id="5474272">c</span>&nbsp;<span class="op" id="5474274">-</span>&nbsp;<span class="string" id="5474276">&#39;A&#39;</span>&nbsp;<span class="op" id="5474280">+</span>&nbsp;<span class="num" id="5474282">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5474286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5474289">return</span>&nbsp;<span class="op" id="5474296">-</span><span class="num" id="5474297">1</span><br>
<span class="lineno"></span><span class="op" id="5474299">}</span>
</div>
</body>
</html>
