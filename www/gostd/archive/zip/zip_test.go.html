<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7560227">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7560282">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7560336">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7560387">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7560436">package</span>&nbsp;<span class="ident" id="7560444">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7560449">import</span>&nbsp;<span class="op" id="7560456">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560459">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560468">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560475">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560483">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560489">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560502">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560510">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560521">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7560532">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7560539">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7560542">func</span>&nbsp;<span class="ident" id="7560547">TestOver65kFiles</span><span class="op" id="7560563">(</span><span class="ident" id="7560564">t</span>&nbsp;<span class="op" id="7560566">*</span><span class="ident" id="7560567">testing</span><span class="op" id="7560574">.</span><span class="ident" id="7560575">T</span><span class="op" id="7560576">)</span>&nbsp;<span class="op" id="7560578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560581">buf</span>&nbsp;<span class="op" id="7560585">:=</span>&nbsp;<span class="builtinfunc" id="7560588">new</span><span class="op" id="7560591">(</span><span class="ident" id="7560592">bytes</span><span class="op" id="7560597">.</span><span class="ident" id="7560598">Buffer</span><span class="op" id="7560604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560607">w</span>&nbsp;<span class="op" id="7560609">:=</span>&nbsp;<span class="ident" id="7560612">NewWriter</span><span class="op" id="7560621">(</span><span class="ident" id="7560622">buf</span><span class="op" id="7560625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560628">const</span>&nbsp;<span class="ident" id="7560634">nFiles</span>&nbsp;<span class="op" id="7560641">=</span>&nbsp;<span class="op" id="7560643">(</span><span class="num" id="7560644">1</span>&nbsp;<span class="op" id="7560646">&lt;&lt;</span>&nbsp;<span class="num" id="7560649">16</span><span class="op" id="7560651">)</span>&nbsp;<span class="op" id="7560653">+</span>&nbsp;<span class="num" id="7560655">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560659">for</span>&nbsp;<span class="ident" id="7560663">i</span>&nbsp;<span class="op" id="7560665">:=</span>&nbsp;<span class="num" id="7560668">0</span><span class="op" id="7560669">;</span>&nbsp;<span class="ident" id="7560671">i</span>&nbsp;<span class="op" id="7560673">&lt;</span>&nbsp;<span class="ident" id="7560675">nFiles</span><span class="op" id="7560681">;</span>&nbsp;<span class="ident" id="7560683">i</span><span class="op" id="7560684">++</span>&nbsp;<span class="op" id="7560687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560691">_</span><span class="op" id="7560692">,</span>&nbsp;<span class="ident" id="7560694">err</span>&nbsp;<span class="op" id="7560698">:=</span>&nbsp;<span class="ident" id="7560701">w</span><span class="op" id="7560702">.</span><span class="ident" id="7560703">CreateHeader</span><span class="op" id="7560715">(</span><span class="op" id="7560716">&amp;</span><span class="ident" id="7560717">FileHeader</span><span class="op" id="7560727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560732">Name</span><span class="op" id="7560736">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7560740">fmt</span><span class="op" id="7560743">.</span><span class="ident" id="7560744">Sprintf</span><span class="op" id="7560751">(</span><span class="string" id="7560752">&#34;%d.dat&#34;</span><span class="op" id="7560760">,</span>&nbsp;<span class="ident" id="7560762">i</span><span class="op" id="7560763">)</span><span class="op" id="7560764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560769">Method</span><span class="op" id="7560775">:</span>&nbsp;<span class="ident" id="7560777">Store</span><span class="op" id="7560782">,</span>&nbsp;<span class="comment" id="7560784">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560821">}</span><span class="op" id="7560822">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560826">if</span>&nbsp;<span class="ident" id="7560829">err</span>&nbsp;<span class="op" id="7560833">!=</span>&nbsp;<span class="ident" id="7560836">nil</span>&nbsp;<span class="op" id="7560840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560845">t</span><span class="op" id="7560846">.</span><span class="ident" id="7560847">Fatalf</span><span class="op" id="7560853">(</span><span class="string" id="7560854">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7560876">,</span>&nbsp;<span class="ident" id="7560878">i</span><span class="op" id="7560879">,</span>&nbsp;<span class="ident" id="7560881">err</span><span class="op" id="7560884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7560894">if</span>&nbsp;<span class="ident" id="7560897">err</span>&nbsp;<span class="op" id="7560901">:=</span>&nbsp;<span class="ident" id="7560904">w</span><span class="op" id="7560905">.</span><span class="ident" id="7560906">Close</span><span class="op" id="7560911">(</span><span class="op" id="7560912">)</span><span class="op" id="7560913">;</span>&nbsp;<span class="ident" id="7560915">err</span>&nbsp;<span class="op" id="7560919">!=</span>&nbsp;<span class="ident" id="7560922">nil</span>&nbsp;<span class="op" id="7560926">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560930">t</span><span class="op" id="7560931">.</span><span class="ident" id="7560932">Fatalf</span><span class="op" id="7560938">(</span><span class="string" id="7560939">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7560957">,</span>&nbsp;<span class="ident" id="7560959">err</span><span class="op" id="7560962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7560965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560968">s</span>&nbsp;<span class="op" id="7560970">:=</span>&nbsp;<span class="ident" id="7560973">buf</span><span class="op" id="7560976">.</span><span class="ident" id="7560977">String</span><span class="op" id="7560983">(</span><span class="op" id="7560984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7560987">zr</span><span class="op" id="7560989">,</span>&nbsp;<span class="ident" id="7560991">err</span>&nbsp;<span class="op" id="7560995">:=</span>&nbsp;<span class="ident" id="7560998">NewReader</span><span class="op" id="7561007">(</span><span class="ident" id="7561008">strings</span><span class="op" id="7561015">.</span><span class="ident" id="7561016">NewReader</span><span class="op" id="7561025">(</span><span class="ident" id="7561026">s</span><span class="op" id="7561027">)</span><span class="op" id="7561028">,</span>&nbsp;<span class="ident" id="7561030">int64</span><span class="op" id="7561035">(</span><span class="builtinfunc" id="7561036">len</span><span class="op" id="7561039">(</span><span class="ident" id="7561040">s</span><span class="op" id="7561041">)</span><span class="op" id="7561042">)</span><span class="op" id="7561043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561046">if</span>&nbsp;<span class="ident" id="7561049">err</span>&nbsp;<span class="op" id="7561053">!=</span>&nbsp;<span class="ident" id="7561056">nil</span>&nbsp;<span class="op" id="7561060">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561064">t</span><span class="op" id="7561065">.</span><span class="ident" id="7561066">Fatalf</span><span class="op" id="7561072">(</span><span class="string" id="7561073">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7561088">,</span>&nbsp;<span class="ident" id="7561090">err</span><span class="op" id="7561093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561099">if</span>&nbsp;<span class="ident" id="7561102">got</span>&nbsp;<span class="op" id="7561106">:=</span>&nbsp;<span class="builtinfunc" id="7561109">len</span><span class="op" id="7561112">(</span><span class="ident" id="7561113">zr</span><span class="op" id="7561115">.</span><span class="ident" id="7561116">File</span><span class="op" id="7561120">)</span><span class="op" id="7561121">;</span>&nbsp;<span class="ident" id="7561123">got</span>&nbsp;<span class="op" id="7561127">!=</span>&nbsp;<span class="ident" id="7561130">nFiles</span>&nbsp;<span class="op" id="7561137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561141">t</span><span class="op" id="7561142">.</span><span class="ident" id="7561143">Fatalf</span><span class="op" id="7561149">(</span><span class="string" id="7561150">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7561183">,</span>&nbsp;<span class="ident" id="7561185">got</span><span class="op" id="7561188">,</span>&nbsp;<span class="ident" id="7561190">nFiles</span><span class="op" id="7561196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561199">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561202">for</span>&nbsp;<span class="ident" id="7561206">i</span>&nbsp;<span class="op" id="7561208">:=</span>&nbsp;<span class="num" id="7561211">0</span><span class="op" id="7561212">;</span>&nbsp;<span class="ident" id="7561214">i</span>&nbsp;<span class="op" id="7561216">&lt;</span>&nbsp;<span class="ident" id="7561218">nFiles</span><span class="op" id="7561224">;</span>&nbsp;<span class="ident" id="7561226">i</span><span class="op" id="7561227">++</span>&nbsp;<span class="op" id="7561230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561234">want</span>&nbsp;<span class="op" id="7561239">:=</span>&nbsp;<span class="ident" id="7561242">fmt</span><span class="op" id="7561245">.</span><span class="ident" id="7561246">Sprintf</span><span class="op" id="7561253">(</span><span class="string" id="7561254">&#34;%d.dat&#34;</span><span class="op" id="7561262">,</span>&nbsp;<span class="ident" id="7561264">i</span><span class="op" id="7561265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561269">if</span>&nbsp;<span class="ident" id="7561272">zr</span><span class="op" id="7561274">.</span><span class="ident" id="7561275">File</span><span class="op" id="7561279">[</span><span class="ident" id="7561280">i</span><span class="op" id="7561281">]</span><span class="op" id="7561282">.</span><span class="ident" id="7561283">Name</span>&nbsp;<span class="op" id="7561288">!=</span>&nbsp;<span class="ident" id="7561291">want</span>&nbsp;<span class="op" id="7561296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561301">t</span><span class="op" id="7561302">.</span><span class="ident" id="7561303">Fatalf</span><span class="op" id="7561309">(</span><span class="string" id="7561310">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7561334">,</span>&nbsp;<span class="ident" id="7561336">i</span><span class="op" id="7561337">,</span>&nbsp;<span class="ident" id="7561339">zr</span><span class="op" id="7561341">.</span><span class="ident" id="7561342">File</span><span class="op" id="7561346">[</span><span class="ident" id="7561347">i</span><span class="op" id="7561348">]</span><span class="op" id="7561349">.</span><span class="ident" id="7561350">Name</span><span class="op" id="7561354">,</span>&nbsp;<span class="ident" id="7561356">want</span><span class="op" id="7561360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561364">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561367">}</span><br>
<span class="lineno"></span><span class="op" id="7561369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7561372">func</span>&nbsp;<span class="ident" id="7561377">TestModTime</span><span class="op" id="7561388">(</span><span class="ident" id="7561389">t</span>&nbsp;<span class="op" id="7561391">*</span><span class="ident" id="7561392">testing</span><span class="op" id="7561399">.</span><span class="ident" id="7561400">T</span><span class="op" id="7561401">)</span>&nbsp;<span class="op" id="7561403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561406">var</span>&nbsp;<span class="ident" id="7561410">testTime</span>&nbsp;<span class="op" id="7561419">=</span>&nbsp;<span class="ident" id="7561421">time</span><span class="op" id="7561425">.</span><span class="ident" id="7561426">Date</span><span class="op" id="7561430">(</span><span class="num" id="7561431">2009</span><span class="op" id="7561435">,</span>&nbsp;<span class="ident" id="7561437">time</span><span class="op" id="7561441">.</span><span class="ident" id="7561442">November</span><span class="op" id="7561450">,</span>&nbsp;<span class="num" id="7561452">10</span><span class="op" id="7561454">,</span>&nbsp;<span class="num" id="7561456">23</span><span class="op" id="7561458">,</span>&nbsp;<span class="num" id="7561460">45</span><span class="op" id="7561462">,</span>&nbsp;<span class="num" id="7561464">58</span><span class="op" id="7561466">,</span>&nbsp;<span class="num" id="7561468">0</span><span class="op" id="7561469">,</span>&nbsp;<span class="ident" id="7561471">time</span><span class="op" id="7561475">.</span><span class="ident" id="7561476">UTC</span><span class="op" id="7561479">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561482">fh</span>&nbsp;<span class="op" id="7561485">:=</span>&nbsp;<span class="builtinfunc" id="7561488">new</span><span class="op" id="7561491">(</span><span class="ident" id="7561492">FileHeader</span><span class="op" id="7561502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561505">fh</span><span class="op" id="7561507">.</span><span class="ident" id="7561508">SetModTime</span><span class="op" id="7561518">(</span><span class="ident" id="7561519">testTime</span><span class="op" id="7561527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561530">outTime</span>&nbsp;<span class="op" id="7561538">:=</span>&nbsp;<span class="ident" id="7561541">fh</span><span class="op" id="7561543">.</span><span class="ident" id="7561544">ModTime</span><span class="op" id="7561551">(</span><span class="op" id="7561552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561555">if</span>&nbsp;<span class="op" id="7561558">!</span><span class="ident" id="7561559">outTime</span><span class="op" id="7561566">.</span><span class="ident" id="7561567">Equal</span><span class="op" id="7561572">(</span><span class="ident" id="7561573">testTime</span><span class="op" id="7561581">)</span>&nbsp;<span class="op" id="7561583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561587">t</span><span class="op" id="7561588">.</span><span class="ident" id="7561589">Errorf</span><span class="op" id="7561595">(</span><span class="string" id="7561596">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7561632">,</span>&nbsp;<span class="ident" id="7561634">outTime</span><span class="op" id="7561641">,</span>&nbsp;<span class="ident" id="7561643">testTime</span><span class="op" id="7561651">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561654">}</span><br>
<span class="lineno"></span><span class="op" id="7561656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7561659">func</span>&nbsp;<span class="ident" id="7561664">testHeaderRoundTrip</span><span class="op" id="7561683">(</span><span class="ident" id="7561684">fh</span>&nbsp;<span class="op" id="7561687">*</span><span class="ident" id="7561688">FileHeader</span><span class="op" id="7561698">,</span>&nbsp;<span class="ident" id="7561700">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7561721">uint32</span><span class="op" id="7561727">,</span>&nbsp;<span class="ident" id="7561729">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7561752">uint64</span><span class="op" id="7561758">,</span>&nbsp;<span class="ident" id="7561760">t</span>&nbsp;<span class="op" id="7561762">*</span><span class="ident" id="7561763">testing</span><span class="op" id="7561770">.</span><span class="ident" id="7561771">T</span><span class="op" id="7561772">)</span>&nbsp;<span class="op" id="7561774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561777">fi</span>&nbsp;<span class="op" id="7561780">:=</span>&nbsp;<span class="ident" id="7561783">fh</span><span class="op" id="7561785">.</span><span class="ident" id="7561786">FileInfo</span><span class="op" id="7561794">(</span><span class="op" id="7561795">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561798">fh2</span><span class="op" id="7561801">,</span>&nbsp;<span class="ident" id="7561803">err</span>&nbsp;<span class="op" id="7561807">:=</span>&nbsp;<span class="ident" id="7561810">FileInfoHeader</span><span class="op" id="7561824">(</span><span class="ident" id="7561825">fi</span><span class="op" id="7561827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561830">if</span>&nbsp;<span class="ident" id="7561833">err</span>&nbsp;<span class="op" id="7561837">!=</span>&nbsp;<span class="ident" id="7561840">nil</span>&nbsp;<span class="op" id="7561844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561848">t</span><span class="op" id="7561849">.</span><span class="ident" id="7561850">Fatal</span><span class="op" id="7561855">(</span><span class="ident" id="7561856">err</span><span class="op" id="7561859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561865">if</span>&nbsp;<span class="ident" id="7561868">got</span><span class="op" id="7561871">,</span>&nbsp;<span class="ident" id="7561873">want</span>&nbsp;<span class="op" id="7561878">:=</span>&nbsp;<span class="ident" id="7561881">fh2</span><span class="op" id="7561884">.</span><span class="ident" id="7561885">Name</span><span class="op" id="7561889">,</span>&nbsp;<span class="ident" id="7561891">fh</span><span class="op" id="7561893">.</span><span class="ident" id="7561894">Name</span><span class="op" id="7561898">;</span>&nbsp;<span class="ident" id="7561900">got</span>&nbsp;<span class="op" id="7561904">!=</span>&nbsp;<span class="ident" id="7561907">want</span>&nbsp;<span class="op" id="7561912">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7561916">t</span><span class="op" id="7561917">.</span><span class="ident" id="7561918">Errorf</span><span class="op" id="7561924">(</span><span class="string" id="7561925">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7561950">,</span>&nbsp;<span class="ident" id="7561952">got</span><span class="op" id="7561955">,</span>&nbsp;<span class="ident" id="7561957">want</span><span class="op" id="7561961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7561964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7561967">if</span>&nbsp;<span class="ident" id="7561970">got</span><span class="op" id="7561973">,</span>&nbsp;<span class="ident" id="7561975">want</span>&nbsp;<span class="op" id="7561980">:=</span>&nbsp;<span class="ident" id="7561983">fh2</span><span class="op" id="7561986">.</span><span class="ident" id="7561987">UncompressedSize</span><span class="op" id="7562003">,</span>&nbsp;<span class="ident" id="7562005">wantUncompressedSize</span><span class="op" id="7562025">;</span>&nbsp;<span class="ident" id="7562027">got</span>&nbsp;<span class="op" id="7562031">!=</span>&nbsp;<span class="ident" id="7562034">want</span>&nbsp;<span class="op" id="7562039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562043">t</span><span class="op" id="7562044">.</span><span class="ident" id="7562045">Errorf</span><span class="op" id="7562051">(</span><span class="string" id="7562052">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7562089">,</span>&nbsp;<span class="ident" id="7562091">got</span><span class="op" id="7562094">,</span>&nbsp;<span class="ident" id="7562096">want</span><span class="op" id="7562100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562103">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562106">if</span>&nbsp;<span class="ident" id="7562109">got</span><span class="op" id="7562112">,</span>&nbsp;<span class="ident" id="7562114">want</span>&nbsp;<span class="op" id="7562119">:=</span>&nbsp;<span class="ident" id="7562122">fh2</span><span class="op" id="7562125">.</span><span class="ident" id="7562126">UncompressedSize64</span><span class="op" id="7562144">,</span>&nbsp;<span class="ident" id="7562146">wantUncompressedSize64</span><span class="op" id="7562168">;</span>&nbsp;<span class="ident" id="7562170">got</span>&nbsp;<span class="op" id="7562174">!=</span>&nbsp;<span class="ident" id="7562177">want</span>&nbsp;<span class="op" id="7562182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562186">t</span><span class="op" id="7562187">.</span><span class="ident" id="7562188">Errorf</span><span class="op" id="7562194">(</span><span class="string" id="7562195">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7562234">,</span>&nbsp;<span class="ident" id="7562236">got</span><span class="op" id="7562239">,</span>&nbsp;<span class="ident" id="7562241">want</span><span class="op" id="7562245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562251">if</span>&nbsp;<span class="ident" id="7562254">got</span><span class="op" id="7562257">,</span>&nbsp;<span class="ident" id="7562259">want</span>&nbsp;<span class="op" id="7562264">:=</span>&nbsp;<span class="ident" id="7562267">fh2</span><span class="op" id="7562270">.</span><span class="ident" id="7562271">ModifiedTime</span><span class="op" id="7562283">,</span>&nbsp;<span class="ident" id="7562285">fh</span><span class="op" id="7562287">.</span><span class="ident" id="7562288">ModifiedTime</span><span class="op" id="7562300">;</span>&nbsp;<span class="ident" id="7562302">got</span>&nbsp;<span class="op" id="7562306">!=</span>&nbsp;<span class="ident" id="7562309">want</span>&nbsp;<span class="op" id="7562314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562318">t</span><span class="op" id="7562319">.</span><span class="ident" id="7562320">Errorf</span><span class="op" id="7562326">(</span><span class="string" id="7562327">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7562360">,</span>&nbsp;<span class="ident" id="7562362">got</span><span class="op" id="7562365">,</span>&nbsp;<span class="ident" id="7562367">want</span><span class="op" id="7562371">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562377">if</span>&nbsp;<span class="ident" id="7562380">got</span><span class="op" id="7562383">,</span>&nbsp;<span class="ident" id="7562385">want</span>&nbsp;<span class="op" id="7562390">:=</span>&nbsp;<span class="ident" id="7562393">fh2</span><span class="op" id="7562396">.</span><span class="ident" id="7562397">ModifiedDate</span><span class="op" id="7562409">,</span>&nbsp;<span class="ident" id="7562411">fh</span><span class="op" id="7562413">.</span><span class="ident" id="7562414">ModifiedDate</span><span class="op" id="7562426">;</span>&nbsp;<span class="ident" id="7562428">got</span>&nbsp;<span class="op" id="7562432">!=</span>&nbsp;<span class="ident" id="7562435">want</span>&nbsp;<span class="op" id="7562440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562444">t</span><span class="op" id="7562445">.</span><span class="ident" id="7562446">Errorf</span><span class="op" id="7562452">(</span><span class="string" id="7562453">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7562486">,</span>&nbsp;<span class="ident" id="7562488">got</span><span class="op" id="7562491">,</span>&nbsp;<span class="ident" id="7562493">want</span><span class="op" id="7562497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7562504">if</span>&nbsp;<span class="ident" id="7562507">sysfh</span><span class="op" id="7562512">,</span>&nbsp;<span class="ident" id="7562514">ok</span>&nbsp;<span class="op" id="7562517">:=</span>&nbsp;<span class="ident" id="7562520">fi</span><span class="op" id="7562522">.</span><span class="ident" id="7562523">Sys</span><span class="op" id="7562526">(</span><span class="op" id="7562527">)</span><span class="op" id="7562528">.</span><span class="op" id="7562529">(</span><span class="op" id="7562530">*</span><span class="ident" id="7562531">FileHeader</span><span class="op" id="7562541">)</span><span class="op" id="7562542">;</span>&nbsp;<span class="op" id="7562544">!</span><span class="ident" id="7562545">ok</span>&nbsp;<span class="op" id="7562548">&amp;&amp;</span>&nbsp;<span class="ident" id="7562551">sysfh</span>&nbsp;<span class="op" id="7562557">!=</span>&nbsp;<span class="ident" id="7562560">fh</span>&nbsp;<span class="op" id="7562563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562567">t</span><span class="op" id="7562568">.</span><span class="ident" id="7562569">Errorf</span><span class="op" id="7562575">(</span><span class="string" id="7562576">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7562616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562619">}</span><br>
<span class="lineno"></span><span class="op" id="7562621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7562624">func</span>&nbsp;<span class="ident" id="7562629">TestFileHeaderRoundTrip</span><span class="op" id="7562652">(</span><span class="ident" id="7562653">t</span>&nbsp;<span class="op" id="7562655">*</span><span class="ident" id="7562656">testing</span><span class="op" id="7562663">.</span><span class="ident" id="7562664">T</span><span class="op" id="7562665">)</span>&nbsp;<span class="op" id="7562667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562670">fh</span>&nbsp;<span class="op" id="7562673">:=</span>&nbsp;<span class="op" id="7562676">&amp;</span><span class="ident" id="7562677">FileHeader</span><span class="op" id="7562687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562691">Name</span><span class="op" id="7562695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7562709">&#34;foo.txt&#34;</span><span class="op" id="7562718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562722">UncompressedSize</span><span class="op" id="7562738">:</span>&nbsp;<span class="num" id="7562740">987654321</span><span class="op" id="7562749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562753">ModifiedTime</span><span class="op" id="7562765">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7562771">1234</span><span class="op" id="7562775">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562779">ModifiedDate</span><span class="op" id="7562791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7562797">5678</span><span class="op" id="7562801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7562804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562807">testHeaderRoundTrip</span><span class="op" id="7562826">(</span><span class="ident" id="7562827">fh</span><span class="op" id="7562829">,</span>&nbsp;<span class="ident" id="7562831">fh</span><span class="op" id="7562833">.</span><span class="ident" id="7562834">UncompressedSize</span><span class="op" id="7562850">,</span>&nbsp;<span class="ident" id="7562852">uint64</span><span class="op" id="7562858">(</span><span class="ident" id="7562859">fh</span><span class="op" id="7562861">.</span><span class="ident" id="7562862">UncompressedSize</span><span class="op" id="7562878">)</span><span class="op" id="7562879">,</span>&nbsp;<span class="ident" id="7562881">t</span><span class="op" id="7562882">)</span><br>
<span class="lineno"></span><span class="op" id="7562884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7562887">func</span>&nbsp;<span class="ident" id="7562892">TestFileHeaderRoundTrip64</span><span class="op" id="7562917">(</span><span class="ident" id="7562918">t</span>&nbsp;<span class="op" id="7562920">*</span><span class="ident" id="7562921">testing</span><span class="op" id="7562928">.</span><span class="ident" id="7562929">T</span><span class="op" id="7562930">)</span>&nbsp;<span class="op" id="7562932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562935">fh</span>&nbsp;<span class="op" id="7562938">:=</span>&nbsp;<span class="op" id="7562941">&amp;</span><span class="ident" id="7562942">FileHeader</span><span class="op" id="7562952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562956">Name</span><span class="op" id="7562960">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7562976">&#34;foo.txt&#34;</span><span class="op" id="7562985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7562989">UncompressedSize64</span><span class="op" id="7563007">:</span>&nbsp;<span class="num" id="7563009">9876543210</span><span class="op" id="7563019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563023">ModifiedTime</span><span class="op" id="7563035">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7563043">1234</span><span class="op" id="7563047">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563051">ModifiedDate</span><span class="op" id="7563063">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7563071">5678</span><span class="op" id="7563075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563081">testHeaderRoundTrip</span><span class="op" id="7563100">(</span><span class="ident" id="7563101">fh</span><span class="op" id="7563103">,</span>&nbsp;<span class="ident" id="7563105">uint32max</span><span class="op" id="7563114">,</span>&nbsp;<span class="ident" id="7563116">fh</span><span class="op" id="7563118">.</span><span class="ident" id="7563119">UncompressedSize64</span><span class="op" id="7563137">,</span>&nbsp;<span class="ident" id="7563139">t</span><span class="op" id="7563140">)</span><br>
<span class="lineno"></span><span class="op" id="7563142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7563145">type</span>&nbsp;<span class="ident" id="7563150">repeatedByte</span>&nbsp;<span class="keyword" id="7563163">struct</span>&nbsp;<span class="op" id="7563170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563173">off</span>&nbsp;<span class="ident" id="7563177">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563184">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7563188">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563194">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7563198">int64</span><br>
<span class="lineno"></span><span class="op" id="7563204">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7563207">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7563257">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7563325">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7563358">type</span>&nbsp;<span class="ident" id="7563363">rleBuffer</span>&nbsp;<span class="keyword" id="7563373">struct</span>&nbsp;<span class="op" id="7563380">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563383">buf</span>&nbsp;<span class="op" id="7563387">[</span><span class="op" id="7563388">]</span><span class="ident" id="7563389">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7563402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7563405">func</span>&nbsp;<span class="op" id="7563410">(</span><span class="ident" id="7563411">r</span>&nbsp;<span class="op" id="7563413">*</span><span class="ident" id="7563414">rleBuffer</span><span class="op" id="7563423">)</span>&nbsp;<span class="ident" id="7563425">Size</span><span class="op" id="7563429">(</span><span class="op" id="7563430">)</span>&nbsp;<span class="ident" id="7563432">int64</span>&nbsp;<span class="op" id="7563438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563441">if</span>&nbsp;<span class="builtinfunc" id="7563444">len</span><span class="op" id="7563447">(</span><span class="ident" id="7563448">r</span><span class="op" id="7563449">.</span><span class="ident" id="7563450">buf</span><span class="op" id="7563453">)</span>&nbsp;<span class="op" id="7563455">==</span>&nbsp;<span class="num" id="7563458">0</span>&nbsp;<span class="op" id="7563460">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563464">return</span>&nbsp;<span class="num" id="7563471">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563477">last</span>&nbsp;<span class="op" id="7563482">:=</span>&nbsp;<span class="op" id="7563485">&amp;</span><span class="ident" id="7563486">r</span><span class="op" id="7563487">.</span><span class="ident" id="7563488">buf</span><span class="op" id="7563491">[</span><span class="builtinfunc" id="7563492">len</span><span class="op" id="7563495">(</span><span class="ident" id="7563496">r</span><span class="op" id="7563497">.</span><span class="ident" id="7563498">buf</span><span class="op" id="7563501">)</span><span class="op" id="7563502">-</span><span class="num" id="7563503">1</span><span class="op" id="7563504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563507">return</span>&nbsp;<span class="ident" id="7563514">last</span><span class="op" id="7563518">.</span><span class="ident" id="7563519">off</span>&nbsp;<span class="op" id="7563523">+</span>&nbsp;<span class="ident" id="7563525">last</span><span class="op" id="7563529">.</span><span class="ident" id="7563530">n</span><br>
<span class="lineno"></span><span class="op" id="7563532">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7563535">func</span>&nbsp;<span class="op" id="7563540">(</span><span class="ident" id="7563541">r</span>&nbsp;<span class="op" id="7563543">*</span><span class="ident" id="7563544">rleBuffer</span><span class="op" id="7563553">)</span>&nbsp;<span class="ident" id="7563555">Write</span><span class="op" id="7563560">(</span><span class="ident" id="7563561">p</span>&nbsp;<span class="op" id="7563563">[</span><span class="op" id="7563564">]</span><span class="builtintype" id="7563565">byte</span><span class="op" id="7563569">)</span>&nbsp;<span class="op" id="7563571">(</span><span class="ident" id="7563572">n</span>&nbsp;<span class="builtintype" id="7563574">int</span><span class="op" id="7563577">,</span>&nbsp;<span class="ident" id="7563579">err</span>&nbsp;<span class="builtintype" id="7563583">error</span><span class="op" id="7563588">)</span>&nbsp;<span class="op" id="7563590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563593">var</span>&nbsp;<span class="ident" id="7563597">rp</span>&nbsp;<span class="op" id="7563600">*</span><span class="ident" id="7563601">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563615">if</span>&nbsp;<span class="builtinfunc" id="7563618">len</span><span class="op" id="7563621">(</span><span class="ident" id="7563622">r</span><span class="op" id="7563623">.</span><span class="ident" id="7563624">buf</span><span class="op" id="7563627">)</span>&nbsp;<span class="op" id="7563629">&gt;</span>&nbsp;<span class="num" id="7563631">0</span>&nbsp;<span class="op" id="7563633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563637">rp</span>&nbsp;<span class="op" id="7563640">=</span>&nbsp;<span class="op" id="7563642">&amp;</span><span class="ident" id="7563643">r</span><span class="op" id="7563644">.</span><span class="ident" id="7563645">buf</span><span class="op" id="7563648">[</span><span class="builtinfunc" id="7563649">len</span><span class="op" id="7563652">(</span><span class="ident" id="7563653">r</span><span class="op" id="7563654">.</span><span class="ident" id="7563655">buf</span><span class="op" id="7563658">)</span><span class="op" id="7563659">-</span><span class="num" id="7563660">1</span><span class="op" id="7563661">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7563665">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563722">if</span>&nbsp;<span class="ident" id="7563725">lastByte</span>&nbsp;<span class="op" id="7563734">:=</span>&nbsp;<span class="ident" id="7563737">rp</span><span class="op" id="7563739">.</span><span class="ident" id="7563740">b</span><span class="op" id="7563741">;</span>&nbsp;<span class="builtinfunc" id="7563743">len</span><span class="op" id="7563746">(</span><span class="ident" id="7563747">p</span><span class="op" id="7563748">)</span>&nbsp;<span class="op" id="7563750">&gt;</span>&nbsp;<span class="num" id="7563752">0</span>&nbsp;<span class="op" id="7563754">&amp;&amp;</span>&nbsp;<span class="ident" id="7563757">p</span><span class="op" id="7563758">[</span><span class="num" id="7563759">0</span><span class="op" id="7563760">]</span>&nbsp;<span class="op" id="7563762">==</span>&nbsp;<span class="ident" id="7563765">lastByte</span>&nbsp;<span class="op" id="7563774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563779">all</span>&nbsp;<span class="op" id="7563783">:=</span>&nbsp;<span class="builtintype" id="7563786">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563794">for</span>&nbsp;<span class="ident" id="7563798">_</span><span class="op" id="7563799">,</span>&nbsp;<span class="ident" id="7563801">b</span>&nbsp;<span class="op" id="7563803">:=</span>&nbsp;<span class="keyword" id="7563806">range</span>&nbsp;<span class="ident" id="7563812">p</span>&nbsp;<span class="op" id="7563814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563820">if</span>&nbsp;<span class="ident" id="7563823">b</span>&nbsp;<span class="op" id="7563825">!=</span>&nbsp;<span class="ident" id="7563828">lastByte</span>&nbsp;<span class="op" id="7563837">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563844">all</span>&nbsp;<span class="op" id="7563848">=</span>&nbsp;<span class="builtintype" id="7563850">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563861">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563881">if</span>&nbsp;<span class="ident" id="7563884">all</span>&nbsp;<span class="op" id="7563888">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7563894">rp</span><span class="op" id="7563896">.</span><span class="ident" id="7563897">n</span>&nbsp;<span class="op" id="7563899">+=</span>&nbsp;<span class="ident" id="7563902">int64</span><span class="op" id="7563907">(</span><span class="builtinfunc" id="7563908">len</span><span class="op" id="7563911">(</span><span class="ident" id="7563912">p</span><span class="op" id="7563913">)</span><span class="op" id="7563914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563920">return</span>&nbsp;<span class="builtinfunc" id="7563927">len</span><span class="op" id="7563930">(</span><span class="ident" id="7563931">p</span><span class="op" id="7563932">)</span><span class="op" id="7563933">,</span>&nbsp;<span class="ident" id="7563935">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7563949">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563953">for</span>&nbsp;<span class="ident" id="7563957">_</span><span class="op" id="7563958">,</span>&nbsp;<span class="ident" id="7563960">b</span>&nbsp;<span class="op" id="7563962">:=</span>&nbsp;<span class="keyword" id="7563965">range</span>&nbsp;<span class="ident" id="7563971">p</span>&nbsp;<span class="op" id="7563973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7563977">if</span>&nbsp;<span class="ident" id="7563980">rp</span>&nbsp;<span class="op" id="7563983">==</span>&nbsp;<span class="ident" id="7563986">nil</span>&nbsp;<span class="op" id="7563990">||</span>&nbsp;<span class="ident" id="7563993">rp</span><span class="op" id="7563995">.</span><span class="ident" id="7563996">b</span>&nbsp;<span class="op" id="7563998">!=</span>&nbsp;<span class="ident" id="7564001">b</span>&nbsp;<span class="op" id="7564003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564008">r</span><span class="op" id="7564009">.</span><span class="ident" id="7564010">buf</span>&nbsp;<span class="op" id="7564014">=</span>&nbsp;<span class="builtinfunc" id="7564016">append</span><span class="op" id="7564022">(</span><span class="ident" id="7564023">r</span><span class="op" id="7564024">.</span><span class="ident" id="7564025">buf</span><span class="op" id="7564028">,</span>&nbsp;<span class="ident" id="7564030">repeatedByte</span><span class="op" id="7564042">{</span><span class="ident" id="7564043">r</span><span class="op" id="7564044">.</span><span class="ident" id="7564045">Size</span><span class="op" id="7564049">(</span><span class="op" id="7564050">)</span><span class="op" id="7564051">,</span>&nbsp;<span class="ident" id="7564053">b</span><span class="op" id="7564054">,</span>&nbsp;<span class="num" id="7564056">1</span><span class="op" id="7564057">}</span><span class="op" id="7564058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564063">rp</span>&nbsp;<span class="op" id="7564066">=</span>&nbsp;<span class="op" id="7564068">&amp;</span><span class="ident" id="7564069">r</span><span class="op" id="7564070">.</span><span class="ident" id="7564071">buf</span><span class="op" id="7564074">[</span><span class="builtinfunc" id="7564075">len</span><span class="op" id="7564078">(</span><span class="ident" id="7564079">r</span><span class="op" id="7564080">.</span><span class="ident" id="7564081">buf</span><span class="op" id="7564084">)</span><span class="op" id="7564085">-</span><span class="num" id="7564086">1</span><span class="op" id="7564087">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564091">}</span>&nbsp;<span class="keyword" id="7564093">else</span>&nbsp;<span class="op" id="7564098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564103">rp</span><span class="op" id="7564105">.</span><span class="ident" id="7564106">n</span><span class="op" id="7564107">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564118">return</span>&nbsp;<span class="builtinfunc" id="7564125">len</span><span class="op" id="7564128">(</span><span class="ident" id="7564129">p</span><span class="op" id="7564130">)</span><span class="op" id="7564131">,</span>&nbsp;<span class="ident" id="7564133">nil</span><br>
<span class="lineno">160</span><span class="op" id="7564137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7564140">func</span>&nbsp;<span class="op" id="7564145">(</span><span class="ident" id="7564146">r</span>&nbsp;<span class="op" id="7564148">*</span><span class="ident" id="7564149">rleBuffer</span><span class="op" id="7564158">)</span>&nbsp;<span class="ident" id="7564160">ReadAt</span><span class="op" id="7564166">(</span><span class="ident" id="7564167">p</span>&nbsp;<span class="op" id="7564169">[</span><span class="op" id="7564170">]</span><span class="builtintype" id="7564171">byte</span><span class="op" id="7564175">,</span>&nbsp;<span class="ident" id="7564177">off</span>&nbsp;<span class="ident" id="7564181">int64</span><span class="op" id="7564186">)</span>&nbsp;<span class="op" id="7564188">(</span><span class="ident" id="7564189">n</span>&nbsp;<span class="builtintype" id="7564191">int</span><span class="op" id="7564194">,</span>&nbsp;<span class="ident" id="7564196">err</span>&nbsp;<span class="builtintype" id="7564200">error</span><span class="op" id="7564205">)</span>&nbsp;<span class="op" id="7564207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564210">if</span>&nbsp;<span class="builtinfunc" id="7564213">len</span><span class="op" id="7564216">(</span><span class="ident" id="7564217">p</span><span class="op" id="7564218">)</span>&nbsp;<span class="op" id="7564220">==</span>&nbsp;<span class="num" id="7564223">0</span>&nbsp;<span class="op" id="7564225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564229">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564240">skipParts</span>&nbsp;<span class="op" id="7564250">:=</span>&nbsp;<span class="ident" id="7564253">sort</span><span class="op" id="7564257">.</span><span class="ident" id="7564258">Search</span><span class="op" id="7564264">(</span><span class="builtinfunc" id="7564265">len</span><span class="op" id="7564268">(</span><span class="ident" id="7564269">r</span><span class="op" id="7564270">.</span><span class="ident" id="7564271">buf</span><span class="op" id="7564274">)</span><span class="op" id="7564275">,</span>&nbsp;<span class="keyword" id="7564277">func</span><span class="op" id="7564281">(</span><span class="ident" id="7564282">i</span>&nbsp;<span class="builtintype" id="7564284">int</span><span class="op" id="7564287">)</span>&nbsp;<span class="builtintype" id="7564289">bool</span>&nbsp;<span class="op" id="7564294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564298">part</span>&nbsp;<span class="op" id="7564303">:=</span>&nbsp;<span class="op" id="7564306">&amp;</span><span class="ident" id="7564307">r</span><span class="op" id="7564308">.</span><span class="ident" id="7564309">buf</span><span class="op" id="7564312">[</span><span class="ident" id="7564313">i</span><span class="op" id="7564314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564318">return</span>&nbsp;<span class="ident" id="7564325">part</span><span class="op" id="7564329">.</span><span class="ident" id="7564330">off</span><span class="op" id="7564333">+</span><span class="ident" id="7564334">part</span><span class="op" id="7564338">.</span><span class="ident" id="7564339">n</span>&nbsp;<span class="op" id="7564341">&gt;</span>&nbsp;<span class="ident" id="7564343">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564348">}</span><span class="op" id="7564349">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564352">parts</span>&nbsp;<span class="op" id="7564358">:=</span>&nbsp;<span class="ident" id="7564361">r</span><span class="op" id="7564362">.</span><span class="ident" id="7564363">buf</span><span class="op" id="7564366">[</span><span class="ident" id="7564367">skipParts</span><span class="op" id="7564376">:</span><span class="op" id="7564377">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564380">if</span>&nbsp;<span class="builtinfunc" id="7564383">len</span><span class="op" id="7564386">(</span><span class="ident" id="7564387">parts</span><span class="op" id="7564392">)</span>&nbsp;<span class="op" id="7564394">&gt;</span>&nbsp;<span class="num" id="7564396">0</span>&nbsp;<span class="op" id="7564398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564402">skipBytes</span>&nbsp;<span class="op" id="7564412">:=</span>&nbsp;<span class="ident" id="7564415">off</span>&nbsp;<span class="op" id="7564419">-</span>&nbsp;<span class="ident" id="7564421">parts</span><span class="op" id="7564426">[</span><span class="num" id="7564427">0</span><span class="op" id="7564428">]</span><span class="op" id="7564429">.</span><span class="ident" id="7564430">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564436">for</span>&nbsp;<span class="builtinfunc" id="7564440">len</span><span class="op" id="7564443">(</span><span class="ident" id="7564444">parts</span><span class="op" id="7564449">)</span>&nbsp;<span class="op" id="7564451">&gt;</span>&nbsp;<span class="num" id="7564453">0</span>&nbsp;<span class="op" id="7564455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564460">part</span>&nbsp;<span class="op" id="7564465">:=</span>&nbsp;<span class="ident" id="7564468">parts</span><span class="op" id="7564473">[</span><span class="num" id="7564474">0</span><span class="op" id="7564475">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564480">for</span>&nbsp;<span class="ident" id="7564484">i</span>&nbsp;<span class="op" id="7564486">:=</span>&nbsp;<span class="ident" id="7564489">skipBytes</span><span class="op" id="7564498">;</span>&nbsp;<span class="ident" id="7564500">i</span>&nbsp;<span class="op" id="7564502">&lt;</span>&nbsp;<span class="ident" id="7564504">part</span><span class="op" id="7564508">.</span><span class="ident" id="7564509">n</span><span class="op" id="7564510">;</span>&nbsp;<span class="ident" id="7564512">i</span><span class="op" id="7564513">++</span>&nbsp;<span class="op" id="7564516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564522">if</span>&nbsp;<span class="ident" id="7564525">n</span>&nbsp;<span class="op" id="7564527">==</span>&nbsp;<span class="builtinfunc" id="7564530">len</span><span class="op" id="7564533">(</span><span class="ident" id="7564534">p</span><span class="op" id="7564535">)</span>&nbsp;<span class="op" id="7564537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564544">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564561">p</span><span class="op" id="7564562">[</span><span class="ident" id="7564563">n</span><span class="op" id="7564564">]</span>&nbsp;<span class="op" id="7564566">=</span>&nbsp;<span class="ident" id="7564568">part</span><span class="op" id="7564572">.</span><span class="ident" id="7564573">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564579">n</span><span class="op" id="7564580">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564591">parts</span>&nbsp;<span class="op" id="7564597">=</span>&nbsp;<span class="ident" id="7564599">parts</span><span class="op" id="7564604">[</span><span class="num" id="7564605">1</span><span class="op" id="7564606">:</span><span class="op" id="7564607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564612">skipBytes</span>&nbsp;<span class="op" id="7564622">=</span>&nbsp;<span class="num" id="7564624">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564628">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564634">if</span>&nbsp;<span class="ident" id="7564637">n</span>&nbsp;<span class="op" id="7564639">!=</span>&nbsp;<span class="builtinfunc" id="7564642">len</span><span class="op" id="7564645">(</span><span class="ident" id="7564646">p</span><span class="op" id="7564647">)</span>&nbsp;<span class="op" id="7564649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564653">err</span>&nbsp;<span class="op" id="7564657">=</span>&nbsp;<span class="ident" id="7564659">io</span><span class="op" id="7564661">.</span><span class="ident" id="7564662">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564683">return</span><br>
<span class="lineno">190</span><span class="op" id="7564690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7564693">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7564779">func</span>&nbsp;<span class="ident" id="7564784">TestRLEBuffer</span><span class="op" id="7564797">(</span><span class="ident" id="7564798">t</span>&nbsp;<span class="op" id="7564800">*</span><span class="ident" id="7564801">testing</span><span class="op" id="7564808">.</span><span class="ident" id="7564809">T</span><span class="op" id="7564810">)</span>&nbsp;<span class="op" id="7564812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564815">b</span>&nbsp;<span class="op" id="7564817">:=</span>&nbsp;<span class="builtinfunc" id="7564820">new</span><span class="op" id="7564823">(</span><span class="ident" id="7564824">rleBuffer</span><span class="op" id="7564833">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564836">var</span>&nbsp;<span class="ident" id="7564840">all</span>&nbsp;<span class="op" id="7564844">[</span><span class="op" id="7564845">]</span><span class="builtintype" id="7564846">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564852">writes</span>&nbsp;<span class="op" id="7564859">:=</span>&nbsp;<span class="op" id="7564862">[</span><span class="op" id="7564863">]</span><span class="builtintype" id="7564864">string</span><span class="op" id="7564870">{</span><span class="string" id="7564871">&#34;abcdeee&#34;</span><span class="op" id="7564880">,</span>&nbsp;<span class="string" id="7564882">&#34;eeeeeee&#34;</span><span class="op" id="7564891">,</span>&nbsp;<span class="string" id="7564893">&#34;eeeefghaaiii&#34;</span><span class="op" id="7564907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564910">for</span>&nbsp;<span class="ident" id="7564914">_</span><span class="op" id="7564915">,</span>&nbsp;<span class="ident" id="7564917">w</span>&nbsp;<span class="op" id="7564919">:=</span>&nbsp;<span class="keyword" id="7564922">range</span>&nbsp;<span class="ident" id="7564928">writes</span>&nbsp;<span class="op" id="7564935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564939">b</span><span class="op" id="7564940">.</span><span class="ident" id="7564941">Write</span><span class="op" id="7564946">(</span><span class="op" id="7564947">[</span><span class="op" id="7564948">]</span><span class="builtintype" id="7564949">byte</span><span class="op" id="7564953">(</span><span class="ident" id="7564954">w</span><span class="op" id="7564955">)</span><span class="op" id="7564956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7564960">all</span>&nbsp;<span class="op" id="7564964">=</span>&nbsp;<span class="builtinfunc" id="7564966">append</span><span class="op" id="7564972">(</span><span class="ident" id="7564973">all</span><span class="op" id="7564976">,</span>&nbsp;<span class="ident" id="7564978">w</span><span class="op" id="7564979">...</span><span class="op" id="7564982">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7564985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7564988">if</span>&nbsp;<span class="builtinfunc" id="7564991">len</span><span class="op" id="7564994">(</span><span class="ident" id="7564995">b</span><span class="op" id="7564996">.</span><span class="ident" id="7564997">buf</span><span class="op" id="7565000">)</span>&nbsp;<span class="op" id="7565002">!=</span>&nbsp;<span class="num" id="7565005">10</span>&nbsp;<span class="op" id="7565008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565012">t</span><span class="op" id="7565013">.</span><span class="ident" id="7565014">Fatalf</span><span class="op" id="7565020">(</span><span class="string" id="7565021">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7565047">,</span>&nbsp;<span class="builtinfunc" id="7565049">len</span><span class="op" id="7565052">(</span><span class="ident" id="7565053">b</span><span class="op" id="7565054">.</span><span class="ident" id="7565055">buf</span><span class="op" id="7565058">)</span><span class="op" id="7565059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565066">for</span>&nbsp;<span class="ident" id="7565070">i</span>&nbsp;<span class="op" id="7565072">:=</span>&nbsp;<span class="num" id="7565075">0</span><span class="op" id="7565076">;</span>&nbsp;<span class="ident" id="7565078">i</span>&nbsp;<span class="op" id="7565080">&lt;</span>&nbsp;<span class="builtinfunc" id="7565082">len</span><span class="op" id="7565085">(</span><span class="ident" id="7565086">all</span><span class="op" id="7565089">)</span><span class="op" id="7565090">;</span>&nbsp;<span class="ident" id="7565092">i</span><span class="op" id="7565093">++</span>&nbsp;<span class="op" id="7565096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565100">for</span>&nbsp;<span class="ident" id="7565104">j</span>&nbsp;<span class="op" id="7565106">:=</span>&nbsp;<span class="num" id="7565109">0</span><span class="op" id="7565110">;</span>&nbsp;<span class="ident" id="7565112">j</span>&nbsp;<span class="op" id="7565114">&lt;</span>&nbsp;<span class="builtinfunc" id="7565116">len</span><span class="op" id="7565119">(</span><span class="ident" id="7565120">all</span><span class="op" id="7565123">)</span><span class="op" id="7565124">-</span><span class="ident" id="7565125">i</span><span class="op" id="7565126">;</span>&nbsp;<span class="ident" id="7565128">j</span><span class="op" id="7565129">++</span>&nbsp;<span class="op" id="7565132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565137">buf</span>&nbsp;<span class="op" id="7565141">:=</span>&nbsp;<span class="builtinfunc" id="7565144">make</span><span class="op" id="7565148">(</span><span class="op" id="7565149">[</span><span class="op" id="7565150">]</span><span class="builtintype" id="7565151">byte</span><span class="op" id="7565155">,</span>&nbsp;<span class="ident" id="7565157">j</span><span class="op" id="7565158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565163">n</span><span class="op" id="7565164">,</span>&nbsp;<span class="ident" id="7565166">err</span>&nbsp;<span class="op" id="7565170">:=</span>&nbsp;<span class="ident" id="7565173">b</span><span class="op" id="7565174">.</span><span class="ident" id="7565175">ReadAt</span><span class="op" id="7565181">(</span><span class="ident" id="7565182">buf</span><span class="op" id="7565185">,</span>&nbsp;<span class="ident" id="7565187">int64</span><span class="op" id="7565192">(</span><span class="ident" id="7565193">i</span><span class="op" id="7565194">)</span><span class="op" id="7565195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565200">if</span>&nbsp;<span class="ident" id="7565203">err</span>&nbsp;<span class="op" id="7565207">!=</span>&nbsp;<span class="ident" id="7565210">nil</span>&nbsp;<span class="op" id="7565214">||</span>&nbsp;<span class="ident" id="7565217">n</span>&nbsp;<span class="op" id="7565219">!=</span>&nbsp;<span class="builtinfunc" id="7565222">len</span><span class="op" id="7565225">(</span><span class="ident" id="7565226">buf</span><span class="op" id="7565229">)</span>&nbsp;<span class="op" id="7565231">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565237">t</span><span class="op" id="7565238">.</span><span class="ident" id="7565239">Errorf</span><span class="op" id="7565245">(</span><span class="string" id="7565246">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7565285">,</span>&nbsp;<span class="ident" id="7565287">i</span><span class="op" id="7565288">,</span>&nbsp;<span class="ident" id="7565290">j</span><span class="op" id="7565291">,</span>&nbsp;<span class="ident" id="7565293">n</span><span class="op" id="7565294">,</span>&nbsp;<span class="ident" id="7565296">err</span><span class="op" id="7565299">,</span>&nbsp;<span class="builtinfunc" id="7565301">len</span><span class="op" id="7565304">(</span><span class="ident" id="7565305">buf</span><span class="op" id="7565308">)</span><span class="op" id="7565309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565319">if</span>&nbsp;<span class="op" id="7565322">!</span><span class="ident" id="7565323">bytes</span><span class="op" id="7565328">.</span><span class="ident" id="7565329">Equal</span><span class="op" id="7565334">(</span><span class="ident" id="7565335">buf</span><span class="op" id="7565338">,</span>&nbsp;<span class="ident" id="7565340">all</span><span class="op" id="7565343">[</span><span class="ident" id="7565344">i</span><span class="op" id="7565345">:</span><span class="ident" id="7565346">i</span><span class="op" id="7565347">+</span><span class="ident" id="7565348">j</span><span class="op" id="7565349">]</span><span class="op" id="7565350">)</span>&nbsp;<span class="op" id="7565352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565358">t</span><span class="op" id="7565359">.</span><span class="ident" id="7565360">Errorf</span><span class="op" id="7565366">(</span><span class="string" id="7565367">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7565397">,</span>&nbsp;<span class="ident" id="7565399">i</span><span class="op" id="7565400">,</span>&nbsp;<span class="ident" id="7565402">j</span><span class="op" id="7565403">,</span>&nbsp;<span class="ident" id="7565405">buf</span><span class="op" id="7565408">,</span>&nbsp;<span class="ident" id="7565410">all</span><span class="op" id="7565413">[</span><span class="ident" id="7565414">i</span><span class="op" id="7565415">:</span><span class="ident" id="7565416">i</span><span class="op" id="7565417">+</span><span class="ident" id="7565418">j</span><span class="op" id="7565419">]</span><span class="op" id="7565420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565425">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565432">}</span><br>
<span class="lineno"></span><span class="op" id="7565434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7565437">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7565492">type</span>&nbsp;<span class="ident" id="7565497">fakeHash32</span>&nbsp;<span class="keyword" id="7565508">struct</span>&nbsp;<span class="op" id="7565515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565518">hash</span><span class="op" id="7565522">.</span><span class="ident" id="7565523">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7565530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7565533">func</span>&nbsp;<span class="op" id="7565538">(</span><span class="ident" id="7565539">fakeHash32</span><span class="op" id="7565549">)</span>&nbsp;<span class="ident" id="7565551">Write</span><span class="op" id="7565556">(</span><span class="ident" id="7565557">p</span>&nbsp;<span class="op" id="7565559">[</span><span class="op" id="7565560">]</span><span class="builtintype" id="7565561">byte</span><span class="op" id="7565565">)</span>&nbsp;<span class="op" id="7565567">(</span><span class="builtintype" id="7565568">int</span><span class="op" id="7565571">,</span>&nbsp;<span class="builtintype" id="7565573">error</span><span class="op" id="7565578">)</span>&nbsp;<span class="op" id="7565580">{</span>&nbsp;<span class="keyword" id="7565582">return</span>&nbsp;<span class="builtinfunc" id="7565589">len</span><span class="op" id="7565592">(</span><span class="ident" id="7565593">p</span><span class="op" id="7565594">)</span><span class="op" id="7565595">,</span>&nbsp;<span class="ident" id="7565597">nil</span>&nbsp;<span class="op" id="7565601">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7565603">func</span>&nbsp;<span class="op" id="7565608">(</span><span class="ident" id="7565609">fakeHash32</span><span class="op" id="7565619">)</span>&nbsp;<span class="ident" id="7565621">Sum32</span><span class="op" id="7565626">(</span><span class="op" id="7565627">)</span>&nbsp;<span class="builtintype" id="7565629">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7565650">{</span>&nbsp;<span class="keyword" id="7565652">return</span>&nbsp;<span class="num" id="7565659">0</span>&nbsp;<span class="op" id="7565661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7565664">func</span>&nbsp;<span class="ident" id="7565669">TestZip64</span><span class="op" id="7565678">(</span><span class="ident" id="7565679">t</span>&nbsp;<span class="op" id="7565681">*</span><span class="ident" id="7565682">testing</span><span class="op" id="7565689">.</span><span class="ident" id="7565690">T</span><span class="op" id="7565691">)</span>&nbsp;<span class="op" id="7565693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565696">if</span>&nbsp;<span class="ident" id="7565699">testing</span><span class="op" id="7565706">.</span><span class="ident" id="7565707">Short</span><span class="op" id="7565712">(</span><span class="op" id="7565713">)</span>&nbsp;<span class="op" id="7565715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565719">t</span><span class="op" id="7565720">.</span><span class="ident" id="7565721">Skip</span><span class="op" id="7565725">(</span><span class="string" id="7565726">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7565747">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7565750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565753">const</span>&nbsp;<span class="ident" id="7565759">size</span>&nbsp;<span class="op" id="7565764">=</span>&nbsp;<span class="num" id="7565766">1</span>&nbsp;<span class="op" id="7565768">&lt;&lt;</span>&nbsp;<span class="num" id="7565771">32</span>&nbsp;<span class="comment" id="7565774">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565802">testZip64</span><span class="op" id="7565811">(</span><span class="ident" id="7565812">t</span><span class="op" id="7565813">,</span>&nbsp;<span class="ident" id="7565815">size</span><span class="op" id="7565819">)</span><br>
<span class="lineno"></span><span class="op" id="7565821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7565824">func</span>&nbsp;<span class="ident" id="7565829">testZip64</span><span class="op" id="7565838">(</span><span class="ident" id="7565839">t</span>&nbsp;<span class="ident" id="7565841">testing</span><span class="op" id="7565848">.</span><span class="ident" id="7565849">TB</span><span class="op" id="7565851">,</span>&nbsp;<span class="ident" id="7565853">size</span>&nbsp;<span class="ident" id="7565858">int64</span><span class="op" id="7565863">)</span>&nbsp;<span class="op" id="7565865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7565868">const</span>&nbsp;<span class="ident" id="7565874">chunkSize</span>&nbsp;<span class="op" id="7565884">=</span>&nbsp;<span class="num" id="7565886">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565892">chunks</span>&nbsp;<span class="op" id="7565899">:=</span>&nbsp;<span class="builtintype" id="7565902">int</span><span class="op" id="7565905">(</span><span class="ident" id="7565906">size</span>&nbsp;<span class="op" id="7565911">/</span>&nbsp;<span class="ident" id="7565913">chunkSize</span><span class="op" id="7565922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7565925">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565973">buf</span>&nbsp;<span class="op" id="7565977">:=</span>&nbsp;<span class="builtinfunc" id="7565980">new</span><span class="op" id="7565983">(</span><span class="ident" id="7565984">rleBuffer</span><span class="op" id="7565993">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7565996">w</span>&nbsp;<span class="op" id="7565998">:=</span>&nbsp;<span class="ident" id="7566001">NewWriter</span><span class="op" id="7566010">(</span><span class="ident" id="7566011">buf</span><span class="op" id="7566014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566017">f</span><span class="op" id="7566018">,</span>&nbsp;<span class="ident" id="7566020">err</span>&nbsp;<span class="op" id="7566024">:=</span>&nbsp;<span class="ident" id="7566027">w</span><span class="op" id="7566028">.</span><span class="ident" id="7566029">CreateHeader</span><span class="op" id="7566041">(</span><span class="op" id="7566042">&amp;</span><span class="ident" id="7566043">FileHeader</span><span class="op" id="7566053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566057">Name</span><span class="op" id="7566061">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7566065">&#34;huge.txt&#34;</span><span class="op" id="7566075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566079">Method</span><span class="op" id="7566085">:</span>&nbsp;<span class="ident" id="7566087">Store</span><span class="op" id="7566092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566095">}</span><span class="op" id="7566096">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566099">if</span>&nbsp;<span class="ident" id="7566102">err</span>&nbsp;<span class="op" id="7566106">!=</span>&nbsp;<span class="ident" id="7566109">nil</span>&nbsp;<span class="op" id="7566113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566117">t</span><span class="op" id="7566118">.</span><span class="ident" id="7566119">Fatal</span><span class="op" id="7566124">(</span><span class="ident" id="7566125">err</span><span class="op" id="7566128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566134">f</span><span class="op" id="7566135">.</span><span class="op" id="7566136">(</span><span class="op" id="7566137">*</span><span class="ident" id="7566138">fileWriter</span><span class="op" id="7566148">)</span><span class="op" id="7566149">.</span><span class="ident" id="7566150">crc32</span>&nbsp;<span class="op" id="7566156">=</span>&nbsp;<span class="ident" id="7566158">fakeHash32</span><span class="op" id="7566168">{</span><span class="op" id="7566169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566172">chunk</span>&nbsp;<span class="op" id="7566178">:=</span>&nbsp;<span class="builtinfunc" id="7566181">make</span><span class="op" id="7566185">(</span><span class="op" id="7566186">[</span><span class="op" id="7566187">]</span><span class="builtintype" id="7566188">byte</span><span class="op" id="7566192">,</span>&nbsp;<span class="ident" id="7566194">chunkSize</span><span class="op" id="7566203">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566206">for</span>&nbsp;<span class="ident" id="7566210">i</span>&nbsp;<span class="op" id="7566212">:=</span>&nbsp;<span class="keyword" id="7566215">range</span>&nbsp;<span class="ident" id="7566221">chunk</span>&nbsp;<span class="op" id="7566227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566231">chunk</span><span class="op" id="7566236">[</span><span class="ident" id="7566237">i</span><span class="op" id="7566238">]</span>&nbsp;<span class="op" id="7566240">=</span>&nbsp;<span class="string" id="7566242">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566250">for</span>&nbsp;<span class="ident" id="7566254">i</span>&nbsp;<span class="op" id="7566256">:=</span>&nbsp;<span class="num" id="7566259">0</span><span class="op" id="7566260">;</span>&nbsp;<span class="ident" id="7566262">i</span>&nbsp;<span class="op" id="7566264">&lt;</span>&nbsp;<span class="ident" id="7566266">chunks</span><span class="op" id="7566272">;</span>&nbsp;<span class="ident" id="7566274">i</span><span class="op" id="7566275">++</span>&nbsp;<span class="op" id="7566278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566282">_</span><span class="op" id="7566283">,</span>&nbsp;<span class="ident" id="7566285">err</span>&nbsp;<span class="op" id="7566289">:=</span>&nbsp;<span class="ident" id="7566292">f</span><span class="op" id="7566293">.</span><span class="ident" id="7566294">Write</span><span class="op" id="7566299">(</span><span class="ident" id="7566300">chunk</span><span class="op" id="7566305">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566309">if</span>&nbsp;<span class="ident" id="7566312">err</span>&nbsp;<span class="op" id="7566316">!=</span>&nbsp;<span class="ident" id="7566319">nil</span>&nbsp;<span class="op" id="7566323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566328">t</span><span class="op" id="7566329">.</span><span class="ident" id="7566330">Fatal</span><span class="op" id="7566335">(</span><span class="string" id="7566336">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7566350">,</span>&nbsp;<span class="ident" id="7566352">err</span><span class="op" id="7566355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566365">end</span>&nbsp;<span class="op" id="7566369">:=</span>&nbsp;<span class="op" id="7566372">[</span><span class="op" id="7566373">]</span><span class="builtintype" id="7566374">byte</span><span class="op" id="7566378">(</span><span class="string" id="7566379">&#34;END\n&#34;</span><span class="op" id="7566386">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566389">_</span><span class="op" id="7566390">,</span>&nbsp;<span class="ident" id="7566392">err</span>&nbsp;<span class="op" id="7566396">=</span>&nbsp;<span class="ident" id="7566398">f</span><span class="op" id="7566399">.</span><span class="ident" id="7566400">Write</span><span class="op" id="7566405">(</span><span class="ident" id="7566406">end</span><span class="op" id="7566409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566412">if</span>&nbsp;<span class="ident" id="7566415">err</span>&nbsp;<span class="op" id="7566419">!=</span>&nbsp;<span class="ident" id="7566422">nil</span>&nbsp;<span class="op" id="7566426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566430">t</span><span class="op" id="7566431">.</span><span class="ident" id="7566432">Fatal</span><span class="op" id="7566437">(</span><span class="string" id="7566438">&#34;write&nbsp;end:&#34;</span><span class="op" id="7566450">,</span>&nbsp;<span class="ident" id="7566452">err</span><span class="op" id="7566455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566461">if</span>&nbsp;<span class="ident" id="7566464">err</span>&nbsp;<span class="op" id="7566468">:=</span>&nbsp;<span class="ident" id="7566471">w</span><span class="op" id="7566472">.</span><span class="ident" id="7566473">Close</span><span class="op" id="7566478">(</span><span class="op" id="7566479">)</span><span class="op" id="7566480">;</span>&nbsp;<span class="ident" id="7566482">err</span>&nbsp;<span class="op" id="7566486">!=</span>&nbsp;<span class="ident" id="7566489">nil</span>&nbsp;<span class="op" id="7566493">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566497">t</span><span class="op" id="7566498">.</span><span class="ident" id="7566499">Fatal</span><span class="op" id="7566504">(</span><span class="ident" id="7566505">err</span><span class="op" id="7566508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7566515">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566577">r</span><span class="op" id="7566578">,</span>&nbsp;<span class="ident" id="7566580">err</span>&nbsp;<span class="op" id="7566584">:=</span>&nbsp;<span class="ident" id="7566587">NewReader</span><span class="op" id="7566596">(</span><span class="ident" id="7566597">buf</span><span class="op" id="7566600">,</span>&nbsp;<span class="ident" id="7566602">int64</span><span class="op" id="7566607">(</span><span class="ident" id="7566608">buf</span><span class="op" id="7566611">.</span><span class="ident" id="7566612">Size</span><span class="op" id="7566616">(</span><span class="op" id="7566617">)</span><span class="op" id="7566618">)</span><span class="op" id="7566619">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566622">if</span>&nbsp;<span class="ident" id="7566625">err</span>&nbsp;<span class="op" id="7566629">!=</span>&nbsp;<span class="ident" id="7566632">nil</span>&nbsp;<span class="op" id="7566636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566640">t</span><span class="op" id="7566641">.</span><span class="ident" id="7566642">Fatal</span><span class="op" id="7566647">(</span><span class="string" id="7566648">&#34;reader:&#34;</span><span class="op" id="7566657">,</span>&nbsp;<span class="ident" id="7566659">err</span><span class="op" id="7566662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566668">f0</span>&nbsp;<span class="op" id="7566671">:=</span>&nbsp;<span class="ident" id="7566674">r</span><span class="op" id="7566675">.</span><span class="ident" id="7566676">File</span><span class="op" id="7566680">[</span><span class="num" id="7566681">0</span><span class="op" id="7566682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566685">rc</span><span class="op" id="7566687">,</span>&nbsp;<span class="ident" id="7566689">err</span>&nbsp;<span class="op" id="7566693">:=</span>&nbsp;<span class="ident" id="7566696">f0</span><span class="op" id="7566698">.</span><span class="ident" id="7566699">Open</span><span class="op" id="7566703">(</span><span class="op" id="7566704">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566707">if</span>&nbsp;<span class="ident" id="7566710">err</span>&nbsp;<span class="op" id="7566714">!=</span>&nbsp;<span class="ident" id="7566717">nil</span>&nbsp;<span class="op" id="7566721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566725">t</span><span class="op" id="7566726">.</span><span class="ident" id="7566727">Fatal</span><span class="op" id="7566732">(</span><span class="string" id="7566733">&#34;opening:&#34;</span><span class="op" id="7566743">,</span>&nbsp;<span class="ident" id="7566745">err</span><span class="op" id="7566748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566754">rc</span><span class="op" id="7566756">.</span><span class="op" id="7566757">(</span><span class="op" id="7566758">*</span><span class="ident" id="7566759">checksumReader</span><span class="op" id="7566773">)</span><span class="op" id="7566774">.</span><span class="ident" id="7566775">hash</span>&nbsp;<span class="op" id="7566780">=</span>&nbsp;<span class="ident" id="7566782">fakeHash32</span><span class="op" id="7566792">{</span><span class="op" id="7566793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566796">for</span>&nbsp;<span class="ident" id="7566800">i</span>&nbsp;<span class="op" id="7566802">:=</span>&nbsp;<span class="num" id="7566805">0</span><span class="op" id="7566806">;</span>&nbsp;<span class="ident" id="7566808">i</span>&nbsp;<span class="op" id="7566810">&lt;</span>&nbsp;<span class="ident" id="7566812">chunks</span><span class="op" id="7566818">;</span>&nbsp;<span class="ident" id="7566820">i</span><span class="op" id="7566821">++</span>&nbsp;<span class="op" id="7566824">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566828">_</span><span class="op" id="7566829">,</span>&nbsp;<span class="ident" id="7566831">err</span>&nbsp;<span class="op" id="7566835">:=</span>&nbsp;<span class="ident" id="7566838">io</span><span class="op" id="7566840">.</span><span class="ident" id="7566841">ReadFull</span><span class="op" id="7566849">(</span><span class="ident" id="7566850">rc</span><span class="op" id="7566852">,</span>&nbsp;<span class="ident" id="7566854">chunk</span><span class="op" id="7566859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566863">if</span>&nbsp;<span class="ident" id="7566866">err</span>&nbsp;<span class="op" id="7566870">!=</span>&nbsp;<span class="ident" id="7566873">nil</span>&nbsp;<span class="op" id="7566877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566882">t</span><span class="op" id="7566883">.</span><span class="ident" id="7566884">Fatal</span><span class="op" id="7566889">(</span><span class="string" id="7566890">&#34;read:&#34;</span><span class="op" id="7566897">,</span>&nbsp;<span class="ident" id="7566899">err</span><span class="op" id="7566902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566909">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566912">gotEnd</span><span class="op" id="7566918">,</span>&nbsp;<span class="ident" id="7566920">err</span>&nbsp;<span class="op" id="7566924">:=</span>&nbsp;<span class="ident" id="7566927">ioutil</span><span class="op" id="7566933">.</span><span class="ident" id="7566934">ReadAll</span><span class="op" id="7566941">(</span><span class="ident" id="7566942">rc</span><span class="op" id="7566944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566947">if</span>&nbsp;<span class="ident" id="7566950">err</span>&nbsp;<span class="op" id="7566954">!=</span>&nbsp;<span class="ident" id="7566957">nil</span>&nbsp;<span class="op" id="7566961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7566965">t</span><span class="op" id="7566966">.</span><span class="ident" id="7566967">Fatal</span><span class="op" id="7566972">(</span><span class="string" id="7566973">&#34;read&nbsp;end:&#34;</span><span class="op" id="7566984">,</span>&nbsp;<span class="ident" id="7566986">err</span><span class="op" id="7566989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7566992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7566995">if</span>&nbsp;<span class="op" id="7566998">!</span><span class="ident" id="7566999">bytes</span><span class="op" id="7567004">.</span><span class="ident" id="7567005">Equal</span><span class="op" id="7567010">(</span><span class="ident" id="7567011">gotEnd</span><span class="op" id="7567017">,</span>&nbsp;<span class="ident" id="7567019">end</span><span class="op" id="7567022">)</span>&nbsp;<span class="op" id="7567024">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567028">t</span><span class="op" id="7567029">.</span><span class="ident" id="7567030">Errorf</span><span class="op" id="7567036">(</span><span class="string" id="7567037">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7567071">,</span>&nbsp;<span class="ident" id="7567073">gotEnd</span><span class="op" id="7567079">,</span>&nbsp;<span class="ident" id="7567081">end</span><span class="op" id="7567084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567090">err</span>&nbsp;<span class="op" id="7567094">=</span>&nbsp;<span class="ident" id="7567096">rc</span><span class="op" id="7567098">.</span><span class="ident" id="7567099">Close</span><span class="op" id="7567104">(</span><span class="op" id="7567105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567108">if</span>&nbsp;<span class="ident" id="7567111">err</span>&nbsp;<span class="op" id="7567115">!=</span>&nbsp;<span class="ident" id="7567118">nil</span>&nbsp;<span class="op" id="7567122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567126">t</span><span class="op" id="7567127">.</span><span class="ident" id="7567128">Fatal</span><span class="op" id="7567133">(</span><span class="string" id="7567134">&#34;closing:&#34;</span><span class="op" id="7567144">,</span>&nbsp;<span class="ident" id="7567146">err</span><span class="op" id="7567149">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567155">if</span>&nbsp;<span class="ident" id="7567158">size</span>&nbsp;<span class="op" id="7567163">==</span>&nbsp;<span class="num" id="7567166">1</span><span class="op" id="7567167">&lt;&lt;</span><span class="num" id="7567169">32</span>&nbsp;<span class="op" id="7567172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567176">if</span>&nbsp;<span class="ident" id="7567179">got</span><span class="op" id="7567182">,</span>&nbsp;<span class="ident" id="7567184">want</span>&nbsp;<span class="op" id="7567189">:=</span>&nbsp;<span class="ident" id="7567192">f0</span><span class="op" id="7567194">.</span><span class="ident" id="7567195">UncompressedSize</span><span class="op" id="7567211">,</span>&nbsp;<span class="builtintype" id="7567213">uint32</span><span class="op" id="7567219">(</span><span class="ident" id="7567220">uint32max</span><span class="op" id="7567229">)</span><span class="op" id="7567230">;</span>&nbsp;<span class="ident" id="7567232">got</span>&nbsp;<span class="op" id="7567236">!=</span>&nbsp;<span class="ident" id="7567239">want</span>&nbsp;<span class="op" id="7567244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567249">t</span><span class="op" id="7567250">.</span><span class="ident" id="7567251">Errorf</span><span class="op" id="7567257">(</span><span class="string" id="7567258">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7567288">,</span>&nbsp;<span class="ident" id="7567290">got</span><span class="op" id="7567293">,</span>&nbsp;<span class="ident" id="7567295">want</span><span class="op" id="7567299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567303">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567310">if</span>&nbsp;<span class="ident" id="7567313">got</span><span class="op" id="7567316">,</span>&nbsp;<span class="ident" id="7567318">want</span>&nbsp;<span class="op" id="7567323">:=</span>&nbsp;<span class="ident" id="7567326">f0</span><span class="op" id="7567328">.</span><span class="ident" id="7567329">UncompressedSize64</span><span class="op" id="7567347">,</span>&nbsp;<span class="ident" id="7567349">uint64</span><span class="op" id="7567355">(</span><span class="ident" id="7567356">size</span><span class="op" id="7567360">)</span><span class="op" id="7567361">+</span><span class="ident" id="7567362">uint64</span><span class="op" id="7567368">(</span><span class="builtinfunc" id="7567369">len</span><span class="op" id="7567372">(</span><span class="ident" id="7567373">end</span><span class="op" id="7567376">)</span><span class="op" id="7567377">)</span><span class="op" id="7567378">;</span>&nbsp;<span class="ident" id="7567380">got</span>&nbsp;<span class="op" id="7567384">!=</span>&nbsp;<span class="ident" id="7567387">want</span>&nbsp;<span class="op" id="7567392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567396">t</span><span class="op" id="7567397">.</span><span class="ident" id="7567398">Errorf</span><span class="op" id="7567404">(</span><span class="string" id="7567405">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7567437">,</span>&nbsp;<span class="ident" id="7567439">got</span><span class="op" id="7567442">,</span>&nbsp;<span class="ident" id="7567444">want</span><span class="op" id="7567448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567451">}</span><br>
<span class="lineno">305</span><span class="op" id="7567453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7567456">func</span>&nbsp;<span class="ident" id="7567461">testInvalidHeader</span><span class="op" id="7567478">(</span><span class="ident" id="7567479">h</span>&nbsp;<span class="op" id="7567481">*</span><span class="ident" id="7567482">FileHeader</span><span class="op" id="7567492">,</span>&nbsp;<span class="ident" id="7567494">t</span>&nbsp;<span class="op" id="7567496">*</span><span class="ident" id="7567497">testing</span><span class="op" id="7567504">.</span><span class="ident" id="7567505">T</span><span class="op" id="7567506">)</span>&nbsp;<span class="op" id="7567508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567511">var</span>&nbsp;<span class="ident" id="7567515">buf</span>&nbsp;<span class="ident" id="7567519">bytes</span><span class="op" id="7567524">.</span><span class="ident" id="7567525">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567533">z</span>&nbsp;<span class="op" id="7567535">:=</span>&nbsp;<span class="ident" id="7567538">NewWriter</span><span class="op" id="7567547">(</span><span class="op" id="7567548">&amp;</span><span class="ident" id="7567549">buf</span><span class="op" id="7567552">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567556">f</span><span class="op" id="7567557">,</span>&nbsp;<span class="ident" id="7567559">err</span>&nbsp;<span class="op" id="7567563">:=</span>&nbsp;<span class="ident" id="7567566">z</span><span class="op" id="7567567">.</span><span class="ident" id="7567568">CreateHeader</span><span class="op" id="7567580">(</span><span class="ident" id="7567581">h</span><span class="op" id="7567582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567585">if</span>&nbsp;<span class="ident" id="7567588">err</span>&nbsp;<span class="op" id="7567592">!=</span>&nbsp;<span class="ident" id="7567595">nil</span>&nbsp;<span class="op" id="7567599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567603">t</span><span class="op" id="7567604">.</span><span class="ident" id="7567605">Fatalf</span><span class="op" id="7567611">(</span><span class="string" id="7567612">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7567639">,</span>&nbsp;<span class="ident" id="7567641">err</span><span class="op" id="7567644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567647">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567650">if</span>&nbsp;<span class="ident" id="7567653">_</span><span class="op" id="7567654">,</span>&nbsp;<span class="ident" id="7567656">err</span>&nbsp;<span class="op" id="7567660">:=</span>&nbsp;<span class="ident" id="7567663">f</span><span class="op" id="7567664">.</span><span class="ident" id="7567665">Write</span><span class="op" id="7567670">(</span><span class="op" id="7567671">[</span><span class="op" id="7567672">]</span><span class="builtintype" id="7567673">byte</span><span class="op" id="7567677">(</span><span class="string" id="7567678">&#34;hi&#34;</span><span class="op" id="7567682">)</span><span class="op" id="7567683">)</span><span class="op" id="7567684">;</span>&nbsp;<span class="ident" id="7567686">err</span>&nbsp;<span class="op" id="7567690">!=</span>&nbsp;<span class="ident" id="7567693">nil</span>&nbsp;<span class="op" id="7567697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567701">t</span><span class="op" id="7567702">.</span><span class="ident" id="7567703">Fatalf</span><span class="op" id="7567709">(</span><span class="string" id="7567710">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7567737">,</span>&nbsp;<span class="ident" id="7567739">err</span><span class="op" id="7567742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567748">if</span>&nbsp;<span class="ident" id="7567751">err</span>&nbsp;<span class="op" id="7567755">:=</span>&nbsp;<span class="ident" id="7567758">z</span><span class="op" id="7567759">.</span><span class="ident" id="7567760">Close</span><span class="op" id="7567765">(</span><span class="op" id="7567766">)</span><span class="op" id="7567767">;</span>&nbsp;<span class="ident" id="7567769">err</span>&nbsp;<span class="op" id="7567773">!=</span>&nbsp;<span class="ident" id="7567776">nil</span>&nbsp;<span class="op" id="7567780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567784">t</span><span class="op" id="7567785">.</span><span class="ident" id="7567786">Fatalf</span><span class="op" id="7567792">(</span><span class="string" id="7567793">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7567823">,</span>&nbsp;<span class="ident" id="7567825">err</span><span class="op" id="7567828">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567835">b</span>&nbsp;<span class="op" id="7567837">:=</span>&nbsp;<span class="ident" id="7567840">buf</span><span class="op" id="7567843">.</span><span class="ident" id="7567844">Bytes</span><span class="op" id="7567849">(</span><span class="op" id="7567850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7567853">if</span>&nbsp;<span class="ident" id="7567856">_</span><span class="op" id="7567857">,</span>&nbsp;<span class="ident" id="7567859">err</span>&nbsp;<span class="op" id="7567863">=</span>&nbsp;<span class="ident" id="7567865">NewReader</span><span class="op" id="7567874">(</span><span class="ident" id="7567875">bytes</span><span class="op" id="7567880">.</span><span class="ident" id="7567881">NewReader</span><span class="op" id="7567890">(</span><span class="ident" id="7567891">b</span><span class="op" id="7567892">)</span><span class="op" id="7567893">,</span>&nbsp;<span class="ident" id="7567895">int64</span><span class="op" id="7567900">(</span><span class="builtinfunc" id="7567901">len</span><span class="op" id="7567904">(</span><span class="ident" id="7567905">b</span><span class="op" id="7567906">)</span><span class="op" id="7567907">)</span><span class="op" id="7567908">)</span><span class="op" id="7567909">;</span>&nbsp;<span class="ident" id="7567911">err</span>&nbsp;<span class="op" id="7567915">!=</span>&nbsp;<span class="ident" id="7567918">ErrFormat</span>&nbsp;<span class="op" id="7567928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7567932">t</span><span class="op" id="7567933">.</span><span class="ident" id="7567934">Fatalf</span><span class="op" id="7567940">(</span><span class="string" id="7567941">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7567969">,</span>&nbsp;<span class="ident" id="7567971">err</span><span class="op" id="7567974">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7567977">}</span><br>
<span class="lineno"></span><span class="op" id="7567979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7567982">func</span>&nbsp;<span class="ident" id="7567987">testValidHeader</span><span class="op" id="7568002">(</span><span class="ident" id="7568003">h</span>&nbsp;<span class="op" id="7568005">*</span><span class="ident" id="7568006">FileHeader</span><span class="op" id="7568016">,</span>&nbsp;<span class="ident" id="7568018">t</span>&nbsp;<span class="op" id="7568020">*</span><span class="ident" id="7568021">testing</span><span class="op" id="7568028">.</span><span class="ident" id="7568029">T</span><span class="op" id="7568030">)</span>&nbsp;<span class="op" id="7568032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568035">var</span>&nbsp;<span class="ident" id="7568039">buf</span>&nbsp;<span class="ident" id="7568043">bytes</span><span class="op" id="7568048">.</span><span class="ident" id="7568049">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568057">z</span>&nbsp;<span class="op" id="7568059">:=</span>&nbsp;<span class="ident" id="7568062">NewWriter</span><span class="op" id="7568071">(</span><span class="op" id="7568072">&amp;</span><span class="ident" id="7568073">buf</span><span class="op" id="7568076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568080">f</span><span class="op" id="7568081">,</span>&nbsp;<span class="ident" id="7568083">err</span>&nbsp;<span class="op" id="7568087">:=</span>&nbsp;<span class="ident" id="7568090">z</span><span class="op" id="7568091">.</span><span class="ident" id="7568092">CreateHeader</span><span class="op" id="7568104">(</span><span class="ident" id="7568105">h</span><span class="op" id="7568106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568109">if</span>&nbsp;<span class="ident" id="7568112">err</span>&nbsp;<span class="op" id="7568116">!=</span>&nbsp;<span class="ident" id="7568119">nil</span>&nbsp;<span class="op" id="7568123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568127">t</span><span class="op" id="7568128">.</span><span class="ident" id="7568129">Fatalf</span><span class="op" id="7568135">(</span><span class="string" id="7568136">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7568163">,</span>&nbsp;<span class="ident" id="7568165">err</span><span class="op" id="7568168">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568174">if</span>&nbsp;<span class="ident" id="7568177">_</span><span class="op" id="7568178">,</span>&nbsp;<span class="ident" id="7568180">err</span>&nbsp;<span class="op" id="7568184">:=</span>&nbsp;<span class="ident" id="7568187">f</span><span class="op" id="7568188">.</span><span class="ident" id="7568189">Write</span><span class="op" id="7568194">(</span><span class="op" id="7568195">[</span><span class="op" id="7568196">]</span><span class="builtintype" id="7568197">byte</span><span class="op" id="7568201">(</span><span class="string" id="7568202">&#34;hi&#34;</span><span class="op" id="7568206">)</span><span class="op" id="7568207">)</span><span class="op" id="7568208">;</span>&nbsp;<span class="ident" id="7568210">err</span>&nbsp;<span class="op" id="7568214">!=</span>&nbsp;<span class="ident" id="7568217">nil</span>&nbsp;<span class="op" id="7568221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568225">t</span><span class="op" id="7568226">.</span><span class="ident" id="7568227">Fatalf</span><span class="op" id="7568233">(</span><span class="string" id="7568234">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7568261">,</span>&nbsp;<span class="ident" id="7568263">err</span><span class="op" id="7568266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568272">if</span>&nbsp;<span class="ident" id="7568275">err</span>&nbsp;<span class="op" id="7568279">:=</span>&nbsp;<span class="ident" id="7568282">z</span><span class="op" id="7568283">.</span><span class="ident" id="7568284">Close</span><span class="op" id="7568289">(</span><span class="op" id="7568290">)</span><span class="op" id="7568291">;</span>&nbsp;<span class="ident" id="7568293">err</span>&nbsp;<span class="op" id="7568297">!=</span>&nbsp;<span class="ident" id="7568300">nil</span>&nbsp;<span class="op" id="7568304">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568308">t</span><span class="op" id="7568309">.</span><span class="ident" id="7568310">Fatalf</span><span class="op" id="7568316">(</span><span class="string" id="7568317">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7568347">,</span>&nbsp;<span class="ident" id="7568349">err</span><span class="op" id="7568352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568359">b</span>&nbsp;<span class="op" id="7568361">:=</span>&nbsp;<span class="ident" id="7568364">buf</span><span class="op" id="7568367">.</span><span class="ident" id="7568368">Bytes</span><span class="op" id="7568373">(</span><span class="op" id="7568374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568377">if</span>&nbsp;<span class="ident" id="7568380">_</span><span class="op" id="7568381">,</span>&nbsp;<span class="ident" id="7568383">err</span>&nbsp;<span class="op" id="7568387">=</span>&nbsp;<span class="ident" id="7568389">NewReader</span><span class="op" id="7568398">(</span><span class="ident" id="7568399">bytes</span><span class="op" id="7568404">.</span><span class="ident" id="7568405">NewReader</span><span class="op" id="7568414">(</span><span class="ident" id="7568415">b</span><span class="op" id="7568416">)</span><span class="op" id="7568417">,</span>&nbsp;<span class="ident" id="7568419">int64</span><span class="op" id="7568424">(</span><span class="builtinfunc" id="7568425">len</span><span class="op" id="7568428">(</span><span class="ident" id="7568429">b</span><span class="op" id="7568430">)</span><span class="op" id="7568431">)</span><span class="op" id="7568432">)</span><span class="op" id="7568433">;</span>&nbsp;<span class="ident" id="7568435">err</span>&nbsp;<span class="op" id="7568439">!=</span>&nbsp;<span class="ident" id="7568442">nil</span>&nbsp;<span class="op" id="7568446">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568450">t</span><span class="op" id="7568451">.</span><span class="ident" id="7568452">Fatalf</span><span class="op" id="7568458">(</span><span class="string" id="7568459">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7568481">,</span>&nbsp;<span class="ident" id="7568483">err</span><span class="op" id="7568486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568489">}</span><br>
<span class="lineno"></span><span class="op" id="7568491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7568494">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7568509">func</span>&nbsp;<span class="ident" id="7568514">TestHeaderInvalidTagAndSize</span><span class="op" id="7568541">(</span><span class="ident" id="7568542">t</span>&nbsp;<span class="op" id="7568544">*</span><span class="ident" id="7568545">testing</span><span class="op" id="7568552">.</span><span class="ident" id="7568553">T</span><span class="op" id="7568554">)</span>&nbsp;<span class="op" id="7568556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7568559">const</span>&nbsp;<span class="ident" id="7568565">timeFormat</span>&nbsp;<span class="op" id="7568576">=</span>&nbsp;<span class="string" id="7568578">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568606">ts</span>&nbsp;<span class="op" id="7568609">:=</span>&nbsp;<span class="ident" id="7568612">time</span><span class="op" id="7568616">.</span><span class="ident" id="7568617">Now</span><span class="op" id="7568620">(</span><span class="op" id="7568621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568624">filename</span>&nbsp;<span class="op" id="7568633">:=</span>&nbsp;<span class="ident" id="7568636">ts</span><span class="op" id="7568638">.</span><span class="ident" id="7568639">Format</span><span class="op" id="7568645">(</span><span class="ident" id="7568646">timeFormat</span><span class="op" id="7568656">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568660">h</span>&nbsp;<span class="op" id="7568662">:=</span>&nbsp;<span class="ident" id="7568665">FileHeader</span><span class="op" id="7568675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568679">Name</span><span class="op" id="7568683">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7568687">filename</span><span class="op" id="7568695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568699">Method</span><span class="op" id="7568705">:</span>&nbsp;<span class="ident" id="7568707">Deflate</span><span class="op" id="7568714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568718">Extra</span><span class="op" id="7568723">:</span>&nbsp;&nbsp;<span class="op" id="7568726">[</span><span class="op" id="7568727">]</span><span class="builtintype" id="7568728">byte</span><span class="op" id="7568732">(</span><span class="ident" id="7568733">ts</span><span class="op" id="7568735">.</span><span class="ident" id="7568736">Format</span><span class="op" id="7568742">(</span><span class="ident" id="7568743">time</span><span class="op" id="7568747">.</span><span class="ident" id="7568748">RFC3339Nano</span><span class="op" id="7568759">)</span><span class="op" id="7568760">)</span><span class="op" id="7568761">,</span>&nbsp;<span class="comment" id="7568763">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568790">h</span><span class="op" id="7568791">.</span><span class="ident" id="7568792">SetModTime</span><span class="op" id="7568802">(</span><span class="ident" id="7568803">ts</span><span class="op" id="7568805">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568809">testInvalidHeader</span><span class="op" id="7568826">(</span><span class="op" id="7568827">&amp;</span><span class="ident" id="7568828">h</span><span class="op" id="7568829">,</span>&nbsp;<span class="ident" id="7568831">t</span><span class="op" id="7568832">)</span><br>
<span class="lineno"></span><span class="op" id="7568834">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7568837">func</span>&nbsp;<span class="ident" id="7568842">TestHeaderTooShort</span><span class="op" id="7568860">(</span><span class="ident" id="7568861">t</span>&nbsp;<span class="op" id="7568863">*</span><span class="ident" id="7568864">testing</span><span class="op" id="7568871">.</span><span class="ident" id="7568872">T</span><span class="op" id="7568873">)</span>&nbsp;<span class="op" id="7568875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568878">h</span>&nbsp;<span class="op" id="7568880">:=</span>&nbsp;<span class="ident" id="7568883">FileHeader</span><span class="op" id="7568893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568897">Name</span><span class="op" id="7568901">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7568905">&#34;foo.txt&#34;</span><span class="op" id="7568914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568918">Method</span><span class="op" id="7568924">:</span>&nbsp;<span class="ident" id="7568926">Deflate</span><span class="op" id="7568933">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568937">Extra</span><span class="op" id="7568942">:</span>&nbsp;&nbsp;<span class="op" id="7568945">[</span><span class="op" id="7568946">]</span><span class="builtintype" id="7568947">byte</span><span class="op" id="7568951">{</span><span class="ident" id="7568952">zip64ExtraId</span><span class="op" id="7568964">}</span><span class="op" id="7568965">,</span>&nbsp;<span class="comment" id="7568967">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7568984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7568987">testInvalidHeader</span><span class="op" id="7569004">(</span><span class="op" id="7569005">&amp;</span><span class="ident" id="7569006">h</span><span class="op" id="7569007">,</span>&nbsp;<span class="ident" id="7569009">t</span><span class="op" id="7569010">)</span><br>
<span class="lineno"></span><span class="op" id="7569012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7569015">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7569071">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7569098">func</span>&nbsp;<span class="ident" id="7569103">TestZeroLengthHeader</span><span class="op" id="7569123">(</span><span class="ident" id="7569124">t</span>&nbsp;<span class="op" id="7569126">*</span><span class="ident" id="7569127">testing</span><span class="op" id="7569134">.</span><span class="ident" id="7569135">T</span><span class="op" id="7569136">)</span>&nbsp;<span class="op" id="7569138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569141">h</span>&nbsp;<span class="op" id="7569143">:=</span>&nbsp;<span class="ident" id="7569146">FileHeader</span><span class="op" id="7569156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569160">Name</span><span class="op" id="7569164">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7569168">&#34;extadata.txt&#34;</span><span class="op" id="7569182">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569186">Method</span><span class="op" id="7569192">:</span>&nbsp;<span class="ident" id="7569194">Deflate</span><span class="op" id="7569201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569205">Extra</span><span class="op" id="7569210">:</span>&nbsp;<span class="op" id="7569212">[</span><span class="op" id="7569213">]</span><span class="builtintype" id="7569214">byte</span><span class="op" id="7569218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7569223">85</span><span class="op" id="7569225">,</span>&nbsp;<span class="num" id="7569227">84</span><span class="op" id="7569229">,</span>&nbsp;<span class="num" id="7569231">5</span><span class="op" id="7569232">,</span>&nbsp;<span class="num" id="7569234">0</span><span class="op" id="7569235">,</span>&nbsp;<span class="num" id="7569237">3</span><span class="op" id="7569238">,</span>&nbsp;<span class="num" id="7569240">154</span><span class="op" id="7569243">,</span>&nbsp;<span class="num" id="7569245">144</span><span class="op" id="7569248">,</span>&nbsp;<span class="num" id="7569250">195</span><span class="op" id="7569253">,</span>&nbsp;<span class="num" id="7569255">77</span><span class="op" id="7569257">,</span>&nbsp;<span class="comment" id="7569259">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7569282">85</span><span class="op" id="7569284">,</span>&nbsp;<span class="num" id="7569286">120</span><span class="op" id="7569289">,</span>&nbsp;<span class="num" id="7569291">0</span><span class="op" id="7569292">,</span>&nbsp;<span class="num" id="7569294">0</span><span class="op" id="7569295">,</span>&nbsp;<span class="comment" id="7569297">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569319">}</span><span class="op" id="7569320">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569326">testValidHeader</span><span class="op" id="7569341">(</span><span class="op" id="7569342">&amp;</span><span class="ident" id="7569343">h</span><span class="op" id="7569344">,</span>&nbsp;<span class="ident" id="7569346">t</span><span class="op" id="7569347">)</span><br>
<span class="lineno"></span><span class="op" id="7569349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7569352">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7569422">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7569493">func</span>&nbsp;<span class="ident" id="7569498">BenchmarkZip64Test</span><span class="op" id="7569516">(</span><span class="ident" id="7569517">b</span>&nbsp;<span class="op" id="7569519">*</span><span class="ident" id="7569520">testing</span><span class="op" id="7569527">.</span><span class="ident" id="7569528">B</span><span class="op" id="7569529">)</span>&nbsp;<span class="op" id="7569531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7569534">for</span>&nbsp;<span class="ident" id="7569538">i</span>&nbsp;<span class="op" id="7569540">:=</span>&nbsp;<span class="num" id="7569543">0</span><span class="op" id="7569544">;</span>&nbsp;<span class="ident" id="7569546">i</span>&nbsp;<span class="op" id="7569548">&lt;</span>&nbsp;<span class="ident" id="7569550">b</span><span class="op" id="7569551">.</span><span class="ident" id="7569552">N</span><span class="op" id="7569553">;</span>&nbsp;<span class="ident" id="7569555">i</span><span class="op" id="7569556">++</span>&nbsp;<span class="op" id="7569559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7569563">testZip64</span><span class="op" id="7569572">(</span><span class="ident" id="7569573">b</span><span class="op" id="7569574">,</span>&nbsp;<span class="num" id="7569576">1</span><span class="op" id="7569577">&lt;&lt;</span><span class="num" id="7569579">26</span><span class="op" id="7569581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7569584">}</span><br>
<span class="lineno">395</span><span class="op" id="7569586">}</span>
</div>
</body>
</html>
