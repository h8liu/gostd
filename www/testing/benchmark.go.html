<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5016217">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5016272">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5016326">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5016377">package</span>&nbsp;<span class="ident" id="5016385">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5016394">import</span>&nbsp;<span class="op" id="5016401">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016404">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016412">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016419">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016425">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016436">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016444">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5016459">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5016466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5016469">var</span>&nbsp;<span class="ident" id="5016473">matchBenchmarks</span>&nbsp;<span class="op" id="5016489">=</span>&nbsp;<span class="ident" id="5016491"><a href="/testing/benchmark.go.html#5016404">flag</a></span><span class="op" id="5016495">.</span><span class="ident" id="5016496">String</span><span class="op" id="5016502">(</span><span class="string" id="5016503">&#34;test.bench&#34;</span><span class="op" id="5016515">,</span>&nbsp;<span class="string" id="5016517">&#34;&#34;</span><span class="op" id="5016519">,</span>&nbsp;<span class="string" id="5016521">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5016569">)</span><br>
<span class="lineno"></span><span class="keyword" id="5016571">var</span>&nbsp;<span class="ident" id="5016575">benchTime</span>&nbsp;<span class="op" id="5016585">=</span>&nbsp;<span class="ident" id="5016587"><a href="/testing/benchmark.go.html#5016404">flag</a></span><span class="op" id="5016591">.</span><span class="ident" id="5016592">Duration</span><span class="op" id="5016600">(</span><span class="string" id="5016601">&#34;test.benchtime&#34;</span><span class="op" id="5016617">,</span>&nbsp;<span class="num" id="5016619">1</span><span class="op" id="5016620">*</span><span class="ident" id="5016621"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5016625">.</span><span class="ident" id="5016626">Second</span><span class="op" id="5016632">,</span>&nbsp;<span class="string" id="5016634">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5016675">)</span><br>
<span class="lineno"></span><span class="keyword" id="5016677">var</span>&nbsp;<span class="ident" id="5016681">benchmarkMemory</span>&nbsp;<span class="op" id="5016697">=</span>&nbsp;<span class="ident" id="5016699"><a href="/testing/benchmark.go.html#5016404">flag</a></span><span class="op" id="5016703">.</span><span class="ident" id="5016704">Bool</span><span class="op" id="5016708">(</span><span class="string" id="5016709">&#34;test.benchmem&#34;</span><span class="op" id="5016724">,</span>&nbsp;<span class="builtintype" id="5016726">false</span><span class="op" id="5016731">,</span>&nbsp;<span class="string" id="5016733">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5016774">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5016777">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5016837">var</span>&nbsp;<span class="ident" id="5016841">benchmarkLock</span>&nbsp;<span class="ident" id="5016855"><a href="/testing/benchmark.go.html#5016436">sync</a></span><span class="op" id="5016859">.</span><span class="ident" id="5016860">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5016867">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5016917">var</span>&nbsp;<span class="ident" id="5016921">memStats</span>&nbsp;<span class="ident" id="5016930"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5016937">.</span><span class="ident" id="5016938">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5016948">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5017037">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5017066">type</span>&nbsp;<span class="ident" id="5017071">InternalBenchmark</span>&nbsp;<span class="keyword" id="5017089">struct</span>&nbsp;<span class="op" id="5017096">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017099">Name</span>&nbsp;<span class="builtintype" id="5017104">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017112">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5017117">func</span><span class="op" id="5017121">(</span><span class="ident" id="5017122">b</span>&nbsp;<span class="op" id="5017124">*</span><span class="ident" id="5017125"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5017126">)</span><br>
<span class="lineno"></span><span class="op" id="5017128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5017131">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5017196">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5017254">type</span>&nbsp;<span class="ident" id="5017259">B</span>&nbsp;<span class="keyword" id="5017261">struct</span>&nbsp;<span class="op" id="5017268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017271"><a href="/testing/testing.go.html#5041124">common</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017279">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5017296">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017301">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5017318">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5017332">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017377">previousDuration</span>&nbsp;<span class="ident" id="5017394"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5017398">.</span><span class="ident" id="5017399">Duration</span>&nbsp;<span class="comment" id="5017408">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017447">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5017464"><a href="/testing/benchmark.go.html#5017071">InternalBenchmark</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017483">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5017500">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017507">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5017524">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017530">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5017547">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017553">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5017570"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017587">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5017604">int</span>&nbsp;<span class="comment" id="5017608">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017666">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017734">startAllocs</span>&nbsp;<span class="ident" id="5017746">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017754">startBytes</span>&nbsp;&nbsp;<span class="ident" id="5017766">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017774">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017822">netAllocs</span>&nbsp;<span class="ident" id="5017832">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017840">netBytes</span>&nbsp;&nbsp;<span class="ident" id="5017850">uint64</span><br>
<span class="lineno"></span><span class="op" id="5017857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5017860">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5017935">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5018009">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5018033">func</span>&nbsp;<span class="op" id="5018038">(</span><span class="ident" id="5018039">b</span>&nbsp;<span class="op" id="5018041">*</span><span class="ident" id="5018042"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5018043">)</span>&nbsp;<span class="ident" id="5018045">StartTimer</span><span class="op" id="5018055">(</span><span class="op" id="5018056">)</span>&nbsp;<span class="op" id="5018058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018061">if</span>&nbsp;<span class="op" id="5018064">!</span><span class="ident" id="5018065"><a href="/testing/benchmark.go.html#5018039">b</a></span><span class="op" id="5018066">.</span><span class="ident" id="5018067">timerOn</span>&nbsp;<span class="op" id="5018075">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018079"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5018086">.</span><span class="ident" id="5018087">ReadMemStats</span><span class="op" id="5018099">(</span><span class="op" id="5018100">&amp;</span><span class="ident" id="5018101"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018113"><a href="/testing/benchmark.go.html#5018039">b</a></span><span class="op" id="5018114">.</span><span class="ident" id="5018115">startAllocs</span>&nbsp;<span class="op" id="5018127">=</span>&nbsp;<span class="ident" id="5018129"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018137">.</span><span class="ident" id="5018138">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018148"><a href="/testing/benchmark.go.html#5018039">b</a></span><span class="op" id="5018149">.</span><span class="ident" id="5018150">startBytes</span>&nbsp;<span class="op" id="5018161">=</span>&nbsp;<span class="ident" id="5018163"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018171">.</span><span class="ident" id="5018172">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018185"><a href="/testing/benchmark.go.html#5018039">b</a></span><span class="op" id="5018186">.</span><span class="ident" id="5018187">start</span>&nbsp;<span class="op" id="5018193">=</span>&nbsp;<span class="ident" id="5018195"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5018199">.</span><span class="ident" id="5018200">Now</span><span class="op" id="5018203">(</span><span class="op" id="5018204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018208"><a href="/testing/benchmark.go.html#5018039">b</a></span><span class="op" id="5018209">.</span><span class="ident" id="5018210">timerOn</span>&nbsp;<span class="op" id="5018218">=</span>&nbsp;<span class="builtintype" id="5018220">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018226">}</span><br>
<span class="lineno"></span><span class="op" id="5018228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5018231">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5018302">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5018360">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5018380">func</span>&nbsp;<span class="op" id="5018385">(</span><span class="ident" id="5018386">b</span>&nbsp;<span class="op" id="5018388">*</span><span class="ident" id="5018389"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5018390">)</span>&nbsp;<span class="ident" id="5018392">StopTimer</span><span class="op" id="5018401">(</span><span class="op" id="5018402">)</span>&nbsp;<span class="op" id="5018404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018407">if</span>&nbsp;<span class="ident" id="5018410"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018411">.</span><span class="ident" id="5018412">timerOn</span>&nbsp;<span class="op" id="5018420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018424"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018425">.</span><span class="ident" id="5018426">duration</span>&nbsp;<span class="op" id="5018435">+=</span>&nbsp;<span class="ident" id="5018438"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5018442">.</span><span class="ident" id="5018443">Now</span><span class="op" id="5018446">(</span><span class="op" id="5018447">)</span><span class="op" id="5018448">.</span><span class="ident" id="5018449">Sub</span><span class="op" id="5018452">(</span><span class="ident" id="5018453"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018454">.</span><span class="ident" id="5018455">start</span><span class="op" id="5018460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018464"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5018471">.</span><span class="ident" id="5018472">ReadMemStats</span><span class="op" id="5018484">(</span><span class="op" id="5018485">&amp;</span><span class="ident" id="5018486"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018494">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018498"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018499">.</span><span class="ident" id="5018500">netAllocs</span>&nbsp;<span class="op" id="5018510">+=</span>&nbsp;<span class="ident" id="5018513"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018521">.</span><span class="ident" id="5018522">Mallocs</span>&nbsp;<span class="op" id="5018530">-</span>&nbsp;<span class="ident" id="5018532"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018533">.</span><span class="ident" id="5018534">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018548"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018549">.</span><span class="ident" id="5018550">netBytes</span>&nbsp;<span class="op" id="5018559">+=</span>&nbsp;<span class="ident" id="5018562"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018570">.</span><span class="ident" id="5018571">TotalAlloc</span>&nbsp;<span class="op" id="5018582">-</span>&nbsp;<span class="ident" id="5018584"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018585">.</span><span class="ident" id="5018586">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018599"><a href="/testing/benchmark.go.html#5018386">b</a></span><span class="op" id="5018600">.</span><span class="ident" id="5018601">timerOn</span>&nbsp;<span class="op" id="5018609">=</span>&nbsp;<span class="builtintype" id="5018611">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018618">}</span><br>
<span class="lineno"></span><span class="op" id="5018620">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5018623">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5018702">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5018754">func</span>&nbsp;<span class="op" id="5018759">(</span><span class="ident" id="5018760">b</span>&nbsp;<span class="op" id="5018762">*</span><span class="ident" id="5018763"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5018764">)</span>&nbsp;<span class="ident" id="5018766">ResetTimer</span><span class="op" id="5018776">(</span><span class="op" id="5018777">)</span>&nbsp;<span class="op" id="5018779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018782">if</span>&nbsp;<span class="ident" id="5018785"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018786">.</span><span class="ident" id="5018787">timerOn</span>&nbsp;<span class="op" id="5018795">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018799"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5018806">.</span><span class="ident" id="5018807">ReadMemStats</span><span class="op" id="5018819">(</span><span class="op" id="5018820">&amp;</span><span class="ident" id="5018821"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018833"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018834">.</span><span class="ident" id="5018835">startAllocs</span>&nbsp;<span class="op" id="5018847">=</span>&nbsp;<span class="ident" id="5018849"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018857">.</span><span class="ident" id="5018858">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018868"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018869">.</span><span class="ident" id="5018870">startBytes</span>&nbsp;<span class="op" id="5018881">=</span>&nbsp;<span class="ident" id="5018883"><a href="/testing/benchmark.go.html#5016921">memStats</a></span><span class="op" id="5018891">.</span><span class="ident" id="5018892">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018905"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018906">.</span><span class="ident" id="5018907">start</span>&nbsp;<span class="op" id="5018913">=</span>&nbsp;<span class="ident" id="5018915"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5018919">.</span><span class="ident" id="5018920">Now</span><span class="op" id="5018923">(</span><span class="op" id="5018924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018927">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018930"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018931">.</span><span class="ident" id="5018932">duration</span>&nbsp;<span class="op" id="5018941">=</span>&nbsp;<span class="num" id="5018943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018946"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018947">.</span><span class="ident" id="5018948">netAllocs</span>&nbsp;<span class="op" id="5018958">=</span>&nbsp;<span class="num" id="5018960">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018963"><a href="/testing/benchmark.go.html#5018760">b</a></span><span class="op" id="5018964">.</span><span class="ident" id="5018965">netBytes</span>&nbsp;<span class="op" id="5018974">=</span>&nbsp;<span class="num" id="5018976">0</span><br>
<span class="lineno"></span><span class="op" id="5018978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5018981">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5019054">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5019118">func</span>&nbsp;<span class="op" id="5019123">(</span><span class="ident" id="5019124">b</span>&nbsp;<span class="op" id="5019126">*</span><span class="ident" id="5019127"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5019128">)</span>&nbsp;<span class="ident" id="5019130">SetBytes</span><span class="op" id="5019138">(</span><span class="ident" id="5019139">n</span>&nbsp;<span class="ident" id="5019141">int64</span><span class="op" id="5019146">)</span>&nbsp;<span class="op" id="5019148">{</span>&nbsp;<span class="ident" id="5019150"><a href="/testing/benchmark.go.html#5019124">b</a></span><span class="op" id="5019151">.</span><span class="ident" id="5019152">bytes</span>&nbsp;<span class="op" id="5019158">=</span>&nbsp;<span class="ident" id="5019160"><a href="/testing/benchmark.go.html#5019139">n</a></span>&nbsp;<span class="op" id="5019162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5019165">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5019227">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5019298">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5019345">func</span>&nbsp;<span class="op" id="5019350">(</span><span class="ident" id="5019351">b</span>&nbsp;<span class="op" id="5019353">*</span><span class="ident" id="5019354"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5019355">)</span>&nbsp;<span class="ident" id="5019357">ReportAllocs</span><span class="op" id="5019369">(</span><span class="op" id="5019370">)</span>&nbsp;<span class="op" id="5019372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019375"><a href="/testing/benchmark.go.html#5019351">b</a></span><span class="op" id="5019376">.</span><span class="ident" id="5019377">showAllocResult</span>&nbsp;<span class="op" id="5019393">=</span>&nbsp;<span class="builtintype" id="5019395">true</span><br>
<span class="lineno"></span><span class="op" id="5019400">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5019403">func</span>&nbsp;<span class="op" id="5019408">(</span><span class="ident" id="5019409">b</span>&nbsp;<span class="op" id="5019411">*</span><span class="ident" id="5019412"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5019413">)</span>&nbsp;<span class="ident" id="5019415">nsPerOp</span><span class="op" id="5019422">(</span><span class="op" id="5019423">)</span>&nbsp;<span class="ident" id="5019425">int64</span>&nbsp;<span class="op" id="5019431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019434">if</span>&nbsp;<span class="ident" id="5019437"><a href="/testing/benchmark.go.html#5019409">b</a></span><span class="op" id="5019438">.</span><span class="ident" id="5019439">N</span>&nbsp;<span class="op" id="5019441">&lt;=</span>&nbsp;<span class="num" id="5019444">0</span>&nbsp;<span class="op" id="5019446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019450">return</span>&nbsp;<span class="num" id="5019457">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019460">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019463">return</span>&nbsp;<span class="ident" id="5019470"><a href="/testing/benchmark.go.html#5019409">b</a></span><span class="op" id="5019471">.</span><span class="ident" id="5019472">duration</span><span class="op" id="5019480">.</span><span class="ident" id="5019481">Nanoseconds</span><span class="op" id="5019492">(</span><span class="op" id="5019493">)</span>&nbsp;<span class="op" id="5019495">/</span>&nbsp;<span class="ident" id="5019497">int64</span><span class="op" id="5019502">(</span><span class="ident" id="5019503"><a href="/testing/benchmark.go.html#5019409">b</a></span><span class="op" id="5019504">.</span><span class="ident" id="5019505">N</span><span class="op" id="5019506">)</span><br>
<span class="lineno"></span><span class="op" id="5019508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5019511">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5019583">func</span>&nbsp;<span class="op" id="5019588">(</span><span class="ident" id="5019589">b</span>&nbsp;<span class="op" id="5019591">*</span><span class="ident" id="5019592"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5019593">)</span>&nbsp;<span class="ident" id="5019595">runN</span><span class="op" id="5019599">(</span><span class="ident" id="5019600">n</span>&nbsp;<span class="builtintype" id="5019602">int</span><span class="op" id="5019605">)</span>&nbsp;<span class="op" id="5019607">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019610"><a href="/testing/benchmark.go.html#5016841">benchmarkLock</a></span><span class="op" id="5019623">.</span><span class="ident" id="5019624">Lock</span><span class="op" id="5019628">(</span><span class="op" id="5019629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019632">defer</span>&nbsp;<span class="ident" id="5019638"><a href="/testing/benchmark.go.html#5016841">benchmarkLock</a></span><span class="op" id="5019651">.</span><span class="ident" id="5019652">Unlock</span><span class="op" id="5019658">(</span><span class="op" id="5019659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019662">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5019715">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019759"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5019766">.</span><span class="ident" id="5019767">GC</span><span class="op" id="5019769">(</span><span class="op" id="5019770">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019773"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019774">.</span><span class="ident" id="5019775">N</span>&nbsp;<span class="op" id="5019777">=</span>&nbsp;<span class="ident" id="5019779"><a href="/testing/benchmark.go.html#5019600">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019782"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019783">.</span><span class="ident" id="5019784">parallelism</span>&nbsp;<span class="op" id="5019796">=</span>&nbsp;<span class="num" id="5019798">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019801"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019802">.</span><span class="ident" id="5019803">ResetTimer</span><span class="op" id="5019813">(</span><span class="op" id="5019814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019817"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019818">.</span><span class="ident" id="5019819">StartTimer</span><span class="op" id="5019829">(</span><span class="op" id="5019830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019833"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019834">.</span><span class="ident" id="5019835">benchmark</span><span class="op" id="5019844">.</span><span class="ident" id="5019845">F</span><span class="op" id="5019846">(</span><span class="ident" id="5019847"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019848">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019851"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019852">.</span><span class="ident" id="5019853">StopTimer</span><span class="op" id="5019862">(</span><span class="op" id="5019863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019866"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019867">.</span><span class="ident" id="5019868">previousN</span>&nbsp;<span class="op" id="5019878">=</span>&nbsp;<span class="ident" id="5019880"><a href="/testing/benchmark.go.html#5019600">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019883"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019884">.</span><span class="ident" id="5019885">previousDuration</span>&nbsp;<span class="op" id="5019902">=</span>&nbsp;<span class="ident" id="5019904"><a href="/testing/benchmark.go.html#5019589">b</a></span><span class="op" id="5019905">.</span><span class="ident" id="5019906">duration</span><br>
<span class="lineno"></span><span class="op" id="5019915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5019918">func</span>&nbsp;<span class="ident" id="5019923">min</span><span class="op" id="5019926">(</span><span class="ident" id="5019927">x</span><span class="op" id="5019928">,</span>&nbsp;<span class="ident" id="5019930">y</span>&nbsp;<span class="builtintype" id="5019932">int</span><span class="op" id="5019935">)</span>&nbsp;<span class="builtintype" id="5019937">int</span>&nbsp;<span class="op" id="5019941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019944">if</span>&nbsp;<span class="ident" id="5019947"><a href="/testing/benchmark.go.html#5019927">x</a></span>&nbsp;<span class="op" id="5019949">&gt;</span>&nbsp;<span class="ident" id="5019951"><a href="/testing/benchmark.go.html#5019930">y</a></span>&nbsp;<span class="op" id="5019953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019957">return</span>&nbsp;<span class="ident" id="5019964"><a href="/testing/benchmark.go.html#5019930">y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019970">return</span>&nbsp;<span class="ident" id="5019977"><a href="/testing/benchmark.go.html#5019927">x</a></span><br>
<span class="lineno">135</span><span class="op" id="5019979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5019982">func</span>&nbsp;<span class="ident" id="5019987">max</span><span class="op" id="5019990">(</span><span class="ident" id="5019991">x</span><span class="op" id="5019992">,</span>&nbsp;<span class="ident" id="5019994">y</span>&nbsp;<span class="builtintype" id="5019996">int</span><span class="op" id="5019999">)</span>&nbsp;<span class="builtintype" id="5020001">int</span>&nbsp;<span class="op" id="5020005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020008">if</span>&nbsp;<span class="ident" id="5020011"><a href="/testing/benchmark.go.html#5019991">x</a></span>&nbsp;<span class="op" id="5020013">&lt;</span>&nbsp;<span class="ident" id="5020015"><a href="/testing/benchmark.go.html#5019994">y</a></span>&nbsp;<span class="op" id="5020017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020021">return</span>&nbsp;<span class="ident" id="5020028"><a href="/testing/benchmark.go.html#5019994">y</a></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020034">return</span>&nbsp;<span class="ident" id="5020041"><a href="/testing/benchmark.go.html#5019991">x</a></span><br>
<span class="lineno"></span><span class="op" id="5020043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020046">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5020110">func</span>&nbsp;<span class="ident" id="5020115">roundDown10</span><span class="op" id="5020126">(</span><span class="ident" id="5020127">n</span>&nbsp;<span class="builtintype" id="5020129">int</span><span class="op" id="5020132">)</span>&nbsp;<span class="builtintype" id="5020134">int</span>&nbsp;<span class="op" id="5020138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020141">var</span>&nbsp;<span class="ident" id="5020145">tens</span>&nbsp;<span class="op" id="5020150">=</span>&nbsp;<span class="num" id="5020152">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020155">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020183">for</span>&nbsp;<span class="ident" id="5020187"><a href="/testing/benchmark.go.html#5020127">n</a></span>&nbsp;<span class="op" id="5020189">&gt;=</span>&nbsp;<span class="num" id="5020192">10</span>&nbsp;<span class="op" id="5020195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020199"><a href="/testing/benchmark.go.html#5020127">n</a></span>&nbsp;<span class="op" id="5020201">=</span>&nbsp;<span class="ident" id="5020203"><a href="/testing/benchmark.go.html#5020127">n</a></span>&nbsp;<span class="op" id="5020205">/</span>&nbsp;<span class="num" id="5020207">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020212"><a href="/testing/benchmark.go.html#5020145">tens</a></span><span class="op" id="5020216">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5020223">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020244">result</span>&nbsp;<span class="op" id="5020251">:=</span>&nbsp;<span class="num" id="5020254">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020257">for</span>&nbsp;<span class="ident" id="5020261">i</span>&nbsp;<span class="op" id="5020263">:=</span>&nbsp;<span class="num" id="5020266">0</span><span class="op" id="5020267">;</span>&nbsp;<span class="ident" id="5020269"><a href="/testing/benchmark.go.html#5020261">i</a></span>&nbsp;<span class="op" id="5020271">&lt;</span>&nbsp;<span class="ident" id="5020273"><a href="/testing/benchmark.go.html#5020145">tens</a></span><span class="op" id="5020277">;</span>&nbsp;<span class="ident" id="5020279"><a href="/testing/benchmark.go.html#5020261">i</a></span><span class="op" id="5020280">++</span>&nbsp;<span class="op" id="5020283">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020287"><a href="/testing/benchmark.go.html#5020244">result</a></span>&nbsp;<span class="op" id="5020294">*=</span>&nbsp;<span class="num" id="5020297">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020304">return</span>&nbsp;<span class="ident" id="5020311"><a href="/testing/benchmark.go.html#5020244">result</a></span><br>
<span class="lineno"></span><span class="op" id="5020318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5020321">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5020390">func</span>&nbsp;<span class="ident" id="5020395">roundUp</span><span class="op" id="5020402">(</span><span class="ident" id="5020403">n</span>&nbsp;<span class="builtintype" id="5020405">int</span><span class="op" id="5020408">)</span>&nbsp;<span class="builtintype" id="5020410">int</span>&nbsp;<span class="op" id="5020414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020417">base</span>&nbsp;<span class="op" id="5020422">:=</span>&nbsp;<span class="ident" id="5020425"><a href="/testing/benchmark.go.html#5020115">roundDown10</a></span><span class="op" id="5020436">(</span><span class="ident" id="5020437"><a href="/testing/benchmark.go.html#5020403">n</a></span><span class="op" id="5020438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020441">switch</span>&nbsp;<span class="op" id="5020448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020451">case</span>&nbsp;<span class="ident" id="5020456"><a href="/testing/benchmark.go.html#5020403">n</a></span>&nbsp;<span class="op" id="5020458">&lt;=</span>&nbsp;<span class="ident" id="5020461"><a href="/testing/benchmark.go.html#5020417">base</a></span><span class="op" id="5020465">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020469">return</span>&nbsp;<span class="ident" id="5020476"><a href="/testing/benchmark.go.html#5020417">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020482">case</span>&nbsp;<span class="ident" id="5020487"><a href="/testing/benchmark.go.html#5020403">n</a></span>&nbsp;<span class="op" id="5020489">&lt;=</span>&nbsp;<span class="op" id="5020492">(</span><span class="num" id="5020493">2</span>&nbsp;<span class="op" id="5020495">*</span>&nbsp;<span class="ident" id="5020497"><a href="/testing/benchmark.go.html#5020417">base</a></span><span class="op" id="5020501">)</span><span class="op" id="5020502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020506">return</span>&nbsp;<span class="num" id="5020513">2</span>&nbsp;<span class="op" id="5020515">*</span>&nbsp;<span class="ident" id="5020517"><a href="/testing/benchmark.go.html#5020417">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020523">case</span>&nbsp;<span class="ident" id="5020528"><a href="/testing/benchmark.go.html#5020403">n</a></span>&nbsp;<span class="op" id="5020530">&lt;=</span>&nbsp;<span class="op" id="5020533">(</span><span class="num" id="5020534">3</span>&nbsp;<span class="op" id="5020536">*</span>&nbsp;<span class="ident" id="5020538"><a href="/testing/benchmark.go.html#5020417">base</a></span><span class="op" id="5020542">)</span><span class="op" id="5020543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020547">return</span>&nbsp;<span class="num" id="5020554">3</span>&nbsp;<span class="op" id="5020556">*</span>&nbsp;<span class="ident" id="5020558"><a href="/testing/benchmark.go.html#5020417">base</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020564">case</span>&nbsp;<span class="ident" id="5020569"><a href="/testing/benchmark.go.html#5020403">n</a></span>&nbsp;<span class="op" id="5020571">&lt;=</span>&nbsp;<span class="op" id="5020574">(</span><span class="num" id="5020575">5</span>&nbsp;<span class="op" id="5020577">*</span>&nbsp;<span class="ident" id="5020579"><a href="/testing/benchmark.go.html#5020417">base</a></span><span class="op" id="5020583">)</span><span class="op" id="5020584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020588">return</span>&nbsp;<span class="num" id="5020595">5</span>&nbsp;<span class="op" id="5020597">*</span>&nbsp;<span class="ident" id="5020599"><a href="/testing/benchmark.go.html#5020417">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020605">default</span><span class="op" id="5020612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020616">return</span>&nbsp;<span class="num" id="5020623">10</span>&nbsp;<span class="op" id="5020626">*</span>&nbsp;<span class="ident" id="5020628"><a href="/testing/benchmark.go.html#5020417">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020634">}</span><br>
<span class="lineno">175</span><span class="op" id="5020636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020639">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5020700">func</span>&nbsp;<span class="op" id="5020705">(</span><span class="ident" id="5020706">b</span>&nbsp;<span class="op" id="5020708">*</span><span class="ident" id="5020709"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5020710">)</span>&nbsp;<span class="ident" id="5020712">run</span><span class="op" id="5020715">(</span><span class="op" id="5020716">)</span>&nbsp;<span class="ident" id="5020718"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span>&nbsp;<span class="op" id="5020734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020737">go</span>&nbsp;<span class="ident" id="5020740"><a href="/testing/benchmark.go.html#5020706">b</a></span><span class="op" id="5020741">.</span><span class="ident" id="5020742">launch</span><span class="op" id="5020748">(</span><span class="op" id="5020749">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020752">&lt;-</span><span class="ident" id="5020754"><a href="/testing/benchmark.go.html#5020706">b</a></span><span class="op" id="5020755">.</span><span class="ident" id="5020756">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020764">return</span>&nbsp;<span class="ident" id="5020771"><a href="/testing/benchmark.go.html#5020706">b</a></span><span class="op" id="5020772">.</span><span class="ident" id="5020773">result</span><br>
<span class="lineno"></span><span class="op" id="5020780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020783">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5020861">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5020942">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5020987">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5021031">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5021093">func</span>&nbsp;<span class="op" id="5021098">(</span><span class="ident" id="5021099">b</span>&nbsp;<span class="op" id="5021101">*</span><span class="ident" id="5021102"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5021103">)</span>&nbsp;<span class="ident" id="5021105">launch</span><span class="op" id="5021111">(</span><span class="op" id="5021112">)</span>&nbsp;<span class="op" id="5021114">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021117">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021186">n</span>&nbsp;<span class="op" id="5021188">:=</span>&nbsp;<span class="num" id="5021191">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021195">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021249">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021285">defer</span>&nbsp;<span class="keyword" id="5021291">func</span><span class="op" id="5021295">(</span><span class="op" id="5021296">)</span>&nbsp;<span class="op" id="5021298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021302"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021303">.</span><span class="ident" id="5021304">signal</span>&nbsp;<span class="op" id="5021311">&lt;-</span>&nbsp;<span class="ident" id="5021314"><a href="/testing/benchmark.go.html#5021099">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021317">}</span><span class="op" id="5021318">(</span><span class="op" id="5021319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021323"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021324">.</span><span class="ident" id="5021325">runN</span><span class="op" id="5021329">(</span><span class="ident" id="5021330"><a href="/testing/benchmark.go.html#5021186">n</a></span><span class="op" id="5021331">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021334">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021399">d</span>&nbsp;<span class="op" id="5021401">:=</span>&nbsp;<span class="op" id="5021404">*</span><span class="ident" id="5021405"><a href="/testing/benchmark.go.html#5016575">benchTime</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021416">for</span>&nbsp;<span class="op" id="5021420">!</span><span class="ident" id="5021421"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021422">.</span><span class="ident" id="5021423">failed</span>&nbsp;<span class="op" id="5021430">&amp;&amp;</span>&nbsp;<span class="ident" id="5021433"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021434">.</span><span class="ident" id="5021435">duration</span>&nbsp;<span class="op" id="5021444">&lt;</span>&nbsp;<span class="ident" id="5021446"><a href="/testing/benchmark.go.html#5021399">d</a></span>&nbsp;<span class="op" id="5021448">&amp;&amp;</span>&nbsp;<span class="ident" id="5021451"><a href="/testing/benchmark.go.html#5021186">n</a></span>&nbsp;<span class="op" id="5021453">&lt;</span>&nbsp;<span class="num" id="5021455">1e9</span>&nbsp;<span class="op" id="5021459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021463">last</span>&nbsp;<span class="op" id="5021468">:=</span>&nbsp;<span class="ident" id="5021471"><a href="/testing/benchmark.go.html#5021186">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021475">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021509">if</span>&nbsp;<span class="ident" id="5021512"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021513">.</span><span class="ident" id="5021514">nsPerOp</span><span class="op" id="5021521">(</span><span class="op" id="5021522">)</span>&nbsp;<span class="op" id="5021524">==</span>&nbsp;<span class="num" id="5021527">0</span>&nbsp;<span class="op" id="5021529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021534"><a href="/testing/benchmark.go.html#5021186">n</a></span>&nbsp;<span class="op" id="5021536">=</span>&nbsp;<span class="num" id="5021538">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021544">}</span>&nbsp;<span class="keyword" id="5021546">else</span>&nbsp;<span class="op" id="5021551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021556"><a href="/testing/benchmark.go.html#5021186">n</a></span>&nbsp;<span class="op" id="5021558">=</span>&nbsp;<span class="builtintype" id="5021560">int</span><span class="op" id="5021563">(</span><span class="ident" id="5021564"><a href="/testing/benchmark.go.html#5021399">d</a></span><span class="op" id="5021565">.</span><span class="ident" id="5021566">Nanoseconds</span><span class="op" id="5021577">(</span><span class="op" id="5021578">)</span>&nbsp;<span class="op" id="5021580">/</span>&nbsp;<span class="ident" id="5021582"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021583">.</span><span class="ident" id="5021584">nsPerOp</span><span class="op" id="5021591">(</span><span class="op" id="5021592">)</span><span class="op" id="5021593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021597">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021601">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021659">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021725">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021779"><a href="/testing/benchmark.go.html#5021186">n</a></span>&nbsp;<span class="op" id="5021781">=</span>&nbsp;<span class="ident" id="5021783"><a href="/testing/benchmark.go.html#5019987">max</a></span><span class="op" id="5021786">(</span><span class="ident" id="5021787"><a href="/testing/benchmark.go.html#5019923">min</a></span><span class="op" id="5021790">(</span><span class="ident" id="5021791"><a href="/testing/benchmark.go.html#5021186">n</a></span><span class="op" id="5021792">+</span><span class="ident" id="5021793"><a href="/testing/benchmark.go.html#5021186">n</a></span><span class="op" id="5021794">/</span><span class="num" id="5021795">5</span><span class="op" id="5021796">,</span>&nbsp;<span class="num" id="5021798">100</span><span class="op" id="5021801">*</span><span class="ident" id="5021802"><a href="/testing/benchmark.go.html#5021463">last</a></span><span class="op" id="5021806">)</span><span class="op" id="5021807">,</span>&nbsp;<span class="ident" id="5021809"><a href="/testing/benchmark.go.html#5021463">last</a></span><span class="op" id="5021813">+</span><span class="num" id="5021814">1</span><span class="op" id="5021815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5021819">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021860"><a href="/testing/benchmark.go.html#5021186">n</a></span>&nbsp;<span class="op" id="5021862">=</span>&nbsp;<span class="ident" id="5021864"><a href="/testing/benchmark.go.html#5020395">roundUp</a></span><span class="op" id="5021871">(</span><span class="ident" id="5021872"><a href="/testing/benchmark.go.html#5021186">n</a></span><span class="op" id="5021873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021877"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021878">.</span><span class="ident" id="5021879">runN</span><span class="op" id="5021883">(</span><span class="ident" id="5021884"><a href="/testing/benchmark.go.html#5021186">n</a></span><span class="op" id="5021885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021891"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021892">.</span><span class="ident" id="5021893">result</span>&nbsp;<span class="op" id="5021900">=</span>&nbsp;<span class="ident" id="5021902"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5021917">{</span><span class="ident" id="5021918"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021919">.</span><span class="ident" id="5021920">N</span><span class="op" id="5021921">,</span>&nbsp;<span class="ident" id="5021923"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021924">.</span><span class="ident" id="5021925">duration</span><span class="op" id="5021933">,</span>&nbsp;<span class="ident" id="5021935"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021936">.</span><span class="ident" id="5021937">bytes</span><span class="op" id="5021942">,</span>&nbsp;<span class="ident" id="5021944"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021945">.</span><span class="ident" id="5021946">netAllocs</span><span class="op" id="5021955">,</span>&nbsp;<span class="ident" id="5021957"><a href="/testing/benchmark.go.html#5021099">b</a></span><span class="op" id="5021958">.</span><span class="ident" id="5021959">netBytes</span><span class="op" id="5021967">}</span><br>
<span class="lineno"></span><span class="op" id="5021969">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5021972">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5022007">type</span>&nbsp;<span class="ident" id="5022012">BenchmarkResult</span>&nbsp;<span class="keyword" id="5022028">struct</span>&nbsp;<span class="op" id="5022035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022038">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5022048">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5022062">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022092">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5022102"><a href="/testing/benchmark.go.html#5016459">time</a></span><span class="op" id="5022106">.</span><span class="ident" id="5022107">Duration</span>&nbsp;<span class="comment" id="5022116">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022142">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5022152">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5022166">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022204">MemAllocs</span>&nbsp;<span class="ident" id="5022214">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5022228">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022272">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="5022282">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5022296">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5022336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5022339">func</span>&nbsp;<span class="op" id="5022344">(</span><span class="ident" id="5022345">r</span>&nbsp;<span class="ident" id="5022347"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5022362">)</span>&nbsp;<span class="ident" id="5022364">NsPerOp</span><span class="op" id="5022371">(</span><span class="op" id="5022372">)</span>&nbsp;<span class="ident" id="5022374">int64</span>&nbsp;<span class="op" id="5022380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022383">if</span>&nbsp;<span class="ident" id="5022386"><a href="/testing/benchmark.go.html#5022345">r</a></span><span class="op" id="5022387">.</span><span class="ident" id="5022388">N</span>&nbsp;<span class="op" id="5022390">&lt;=</span>&nbsp;<span class="num" id="5022393">0</span>&nbsp;<span class="op" id="5022395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022399">return</span>&nbsp;<span class="num" id="5022406">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022412">return</span>&nbsp;<span class="ident" id="5022419"><a href="/testing/benchmark.go.html#5022345">r</a></span><span class="op" id="5022420">.</span><span class="ident" id="5022421">T</span><span class="op" id="5022422">.</span><span class="ident" id="5022423">Nanoseconds</span><span class="op" id="5022434">(</span><span class="op" id="5022435">)</span>&nbsp;<span class="op" id="5022437">/</span>&nbsp;<span class="ident" id="5022439">int64</span><span class="op" id="5022444">(</span><span class="ident" id="5022445"><a href="/testing/benchmark.go.html#5022345">r</a></span><span class="op" id="5022446">.</span><span class="ident" id="5022447">N</span><span class="op" id="5022448">)</span><br>
<span class="lineno">235</span><span class="op" id="5022450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5022453">func</span>&nbsp;<span class="op" id="5022458">(</span><span class="ident" id="5022459">r</span>&nbsp;<span class="ident" id="5022461"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5022476">)</span>&nbsp;<span class="ident" id="5022478">mbPerSec</span><span class="op" id="5022486">(</span><span class="op" id="5022487">)</span>&nbsp;<span class="builtintype" id="5022489">float64</span>&nbsp;<span class="op" id="5022497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022500">if</span>&nbsp;<span class="ident" id="5022503"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022504">.</span><span class="ident" id="5022505">Bytes</span>&nbsp;<span class="op" id="5022511">&lt;=</span>&nbsp;<span class="num" id="5022514">0</span>&nbsp;<span class="op" id="5022516">||</span>&nbsp;<span class="ident" id="5022519"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022520">.</span><span class="ident" id="5022521">T</span>&nbsp;<span class="op" id="5022523">&lt;=</span>&nbsp;<span class="num" id="5022526">0</span>&nbsp;<span class="op" id="5022528">||</span>&nbsp;<span class="ident" id="5022531"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022532">.</span><span class="ident" id="5022533">N</span>&nbsp;<span class="op" id="5022535">&lt;=</span>&nbsp;<span class="num" id="5022538">0</span>&nbsp;<span class="op" id="5022540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022544">return</span>&nbsp;<span class="num" id="5022551">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022557">return</span>&nbsp;<span class="op" id="5022564">(</span><span class="builtintype" id="5022565">float64</span><span class="op" id="5022572">(</span><span class="ident" id="5022573"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022574">.</span><span class="ident" id="5022575">Bytes</span><span class="op" id="5022580">)</span>&nbsp;<span class="op" id="5022582">*</span>&nbsp;<span class="builtintype" id="5022584">float64</span><span class="op" id="5022591">(</span><span class="ident" id="5022592"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022593">.</span><span class="ident" id="5022594">N</span><span class="op" id="5022595">)</span>&nbsp;<span class="op" id="5022597">/</span>&nbsp;<span class="num" id="5022599">1e6</span><span class="op" id="5022602">)</span>&nbsp;<span class="op" id="5022604">/</span>&nbsp;<span class="ident" id="5022606"><a href="/testing/benchmark.go.html#5022459">r</a></span><span class="op" id="5022607">.</span><span class="ident" id="5022608">T</span><span class="op" id="5022609">.</span><span class="ident" id="5022610">Seconds</span><span class="op" id="5022617">(</span><span class="op" id="5022618">)</span><br>
<span class="lineno"></span><span class="op" id="5022620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5022623">func</span>&nbsp;<span class="op" id="5022628">(</span><span class="ident" id="5022629">r</span>&nbsp;<span class="ident" id="5022631"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5022646">)</span>&nbsp;<span class="ident" id="5022648">AllocsPerOp</span><span class="op" id="5022659">(</span><span class="op" id="5022660">)</span>&nbsp;<span class="ident" id="5022662">int64</span>&nbsp;<span class="op" id="5022668">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022671">if</span>&nbsp;<span class="ident" id="5022674"><a href="/testing/benchmark.go.html#5022629">r</a></span><span class="op" id="5022675">.</span><span class="ident" id="5022676">N</span>&nbsp;<span class="op" id="5022678">&lt;=</span>&nbsp;<span class="num" id="5022681">0</span>&nbsp;<span class="op" id="5022683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022687">return</span>&nbsp;<span class="num" id="5022694">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022700">return</span>&nbsp;<span class="ident" id="5022707">int64</span><span class="op" id="5022712">(</span><span class="ident" id="5022713"><a href="/testing/benchmark.go.html#5022629">r</a></span><span class="op" id="5022714">.</span><span class="ident" id="5022715">MemAllocs</span><span class="op" id="5022724">)</span>&nbsp;<span class="op" id="5022726">/</span>&nbsp;<span class="ident" id="5022728">int64</span><span class="op" id="5022733">(</span><span class="ident" id="5022734"><a href="/testing/benchmark.go.html#5022629">r</a></span><span class="op" id="5022735">.</span><span class="ident" id="5022736">N</span><span class="op" id="5022737">)</span><br>
<span class="lineno"></span><span class="op" id="5022739">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5022742">func</span>&nbsp;<span class="op" id="5022747">(</span><span class="ident" id="5022748">r</span>&nbsp;<span class="ident" id="5022750"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5022765">)</span>&nbsp;<span class="ident" id="5022767">AllocedBytesPerOp</span><span class="op" id="5022784">(</span><span class="op" id="5022785">)</span>&nbsp;<span class="ident" id="5022787">int64</span>&nbsp;<span class="op" id="5022793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022796">if</span>&nbsp;<span class="ident" id="5022799"><a href="/testing/benchmark.go.html#5022748">r</a></span><span class="op" id="5022800">.</span><span class="ident" id="5022801">N</span>&nbsp;<span class="op" id="5022803">&lt;=</span>&nbsp;<span class="num" id="5022806">0</span>&nbsp;<span class="op" id="5022808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022812">return</span>&nbsp;<span class="num" id="5022819">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022822">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022825">return</span>&nbsp;<span class="ident" id="5022832">int64</span><span class="op" id="5022837">(</span><span class="ident" id="5022838"><a href="/testing/benchmark.go.html#5022748">r</a></span><span class="op" id="5022839">.</span><span class="ident" id="5022840">MemBytes</span><span class="op" id="5022848">)</span>&nbsp;<span class="op" id="5022850">/</span>&nbsp;<span class="ident" id="5022852">int64</span><span class="op" id="5022857">(</span><span class="ident" id="5022858"><a href="/testing/benchmark.go.html#5022748">r</a></span><span class="op" id="5022859">.</span><span class="ident" id="5022860">N</span><span class="op" id="5022861">)</span><br>
<span class="lineno"></span><span class="op" id="5022863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5022866">func</span>&nbsp;<span class="op" id="5022871">(</span><span class="ident" id="5022872">r</span>&nbsp;<span class="ident" id="5022874"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5022889">)</span>&nbsp;<span class="ident" id="5022891">String</span><span class="op" id="5022897">(</span><span class="op" id="5022898">)</span>&nbsp;<span class="builtintype" id="5022900">string</span>&nbsp;<span class="op" id="5022907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022910">mbs</span>&nbsp;<span class="op" id="5022914">:=</span>&nbsp;<span class="ident" id="5022917"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5022918">.</span><span class="ident" id="5022919">mbPerSec</span><span class="op" id="5022927">(</span><span class="op" id="5022928">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022931">mb</span>&nbsp;<span class="op" id="5022934">:=</span>&nbsp;<span class="string" id="5022937">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022941">if</span>&nbsp;<span class="ident" id="5022944"><a href="/testing/benchmark.go.html#5022910">mbs</a></span>&nbsp;<span class="op" id="5022948">!=</span>&nbsp;<span class="num" id="5022951">0</span>&nbsp;<span class="op" id="5022953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022957"><a href="/testing/benchmark.go.html#5022931">mb</a></span>&nbsp;<span class="op" id="5022960">=</span>&nbsp;<span class="ident" id="5022962"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5022965">.</span><span class="ident" id="5022966">Sprintf</span><span class="op" id="5022973">(</span><span class="string" id="5022974">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5022988">,</span>&nbsp;<span class="ident" id="5022990"><a href="/testing/benchmark.go.html#5022910">mbs</a></span><span class="op" id="5022993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5022996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5022999">nsop</span>&nbsp;<span class="op" id="5023004">:=</span>&nbsp;<span class="ident" id="5023007"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023008">.</span><span class="ident" id="5023009">NsPerOp</span><span class="op" id="5023016">(</span><span class="op" id="5023017">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023020">ns</span>&nbsp;<span class="op" id="5023023">:=</span>&nbsp;<span class="ident" id="5023026"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5023029">.</span><span class="ident" id="5023030">Sprintf</span><span class="op" id="5023037">(</span><span class="string" id="5023038">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5023050">,</span>&nbsp;<span class="ident" id="5023052"><a href="/testing/benchmark.go.html#5022999">nsop</a></span><span class="op" id="5023056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023059">if</span>&nbsp;<span class="ident" id="5023062"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023063">.</span><span class="ident" id="5023064">N</span>&nbsp;<span class="op" id="5023066">&gt;</span>&nbsp;<span class="num" id="5023068">0</span>&nbsp;<span class="op" id="5023070">&amp;&amp;</span>&nbsp;<span class="ident" id="5023073"><a href="/testing/benchmark.go.html#5022999">nsop</a></span>&nbsp;<span class="op" id="5023078">&lt;</span>&nbsp;<span class="num" id="5023080">100</span>&nbsp;<span class="op" id="5023084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023088">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023135">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023196">if</span>&nbsp;<span class="ident" id="5023199"><a href="/testing/benchmark.go.html#5022999">nsop</a></span>&nbsp;<span class="op" id="5023204">&lt;</span>&nbsp;<span class="num" id="5023206">10</span>&nbsp;<span class="op" id="5023209">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023214"><a href="/testing/benchmark.go.html#5023020">ns</a></span>&nbsp;<span class="op" id="5023217">=</span>&nbsp;<span class="ident" id="5023219"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5023222">.</span><span class="ident" id="5023223">Sprintf</span><span class="op" id="5023230">(</span><span class="string" id="5023231">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5023245">,</span>&nbsp;<span class="builtintype" id="5023247">float64</span><span class="op" id="5023254">(</span><span class="ident" id="5023255"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023256">.</span><span class="ident" id="5023257">T</span><span class="op" id="5023258">.</span><span class="ident" id="5023259">Nanoseconds</span><span class="op" id="5023270">(</span><span class="op" id="5023271">)</span><span class="op" id="5023272">)</span><span class="op" id="5023273">/</span><span class="builtintype" id="5023274">float64</span><span class="op" id="5023281">(</span><span class="ident" id="5023282"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023283">.</span><span class="ident" id="5023284">N</span><span class="op" id="5023285">)</span><span class="op" id="5023286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023290">}</span>&nbsp;<span class="keyword" id="5023292">else</span>&nbsp;<span class="op" id="5023297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023302"><a href="/testing/benchmark.go.html#5023020">ns</a></span>&nbsp;<span class="op" id="5023305">=</span>&nbsp;<span class="ident" id="5023307"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5023310">.</span><span class="ident" id="5023311">Sprintf</span><span class="op" id="5023318">(</span><span class="string" id="5023319">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5023333">,</span>&nbsp;<span class="builtintype" id="5023335">float64</span><span class="op" id="5023342">(</span><span class="ident" id="5023343"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023344">.</span><span class="ident" id="5023345">T</span><span class="op" id="5023346">.</span><span class="ident" id="5023347">Nanoseconds</span><span class="op" id="5023358">(</span><span class="op" id="5023359">)</span><span class="op" id="5023360">)</span><span class="op" id="5023361">/</span><span class="builtintype" id="5023362">float64</span><span class="op" id="5023369">(</span><span class="ident" id="5023370"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023371">.</span><span class="ident" id="5023372">N</span><span class="op" id="5023373">)</span><span class="op" id="5023374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023381">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023384">return</span>&nbsp;<span class="ident" id="5023391"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5023394">.</span><span class="ident" id="5023395">Sprintf</span><span class="op" id="5023402">(</span><span class="string" id="5023403">&#34;%8d\t%s%s&#34;</span><span class="op" id="5023414">,</span>&nbsp;<span class="ident" id="5023416"><a href="/testing/benchmark.go.html#5022872">r</a></span><span class="op" id="5023417">.</span><span class="ident" id="5023418">N</span><span class="op" id="5023419">,</span>&nbsp;<span class="ident" id="5023421"><a href="/testing/benchmark.go.html#5023020">ns</a></span><span class="op" id="5023423">,</span>&nbsp;<span class="ident" id="5023425"><a href="/testing/benchmark.go.html#5022931">mb</a></span><span class="op" id="5023427">)</span><br>
<span class="lineno"></span><span class="op" id="5023429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5023432">func</span>&nbsp;<span class="op" id="5023437">(</span><span class="ident" id="5023438">r</span>&nbsp;<span class="ident" id="5023440"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span><span class="op" id="5023455">)</span>&nbsp;<span class="ident" id="5023457">MemString</span><span class="op" id="5023466">(</span><span class="op" id="5023467">)</span>&nbsp;<span class="builtintype" id="5023469">string</span>&nbsp;<span class="op" id="5023476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023479">return</span>&nbsp;<span class="ident" id="5023486"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5023489">.</span><span class="ident" id="5023490">Sprintf</span><span class="op" id="5023497">(</span><span class="string" id="5023498">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5023523">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023527"><a href="/testing/benchmark.go.html#5023438">r</a></span><span class="op" id="5023528">.</span><span class="ident" id="5023529">AllocedBytesPerOp</span><span class="op" id="5023546">(</span><span class="op" id="5023547">)</span><span class="op" id="5023548">,</span>&nbsp;<span class="ident" id="5023550"><a href="/testing/benchmark.go.html#5023438">r</a></span><span class="op" id="5023551">.</span><span class="ident" id="5023552">AllocsPerOp</span><span class="op" id="5023563">(</span><span class="op" id="5023564">)</span><span class="op" id="5023565">)</span><br>
<span class="lineno"></span><span class="op" id="5023567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5023570">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5023663">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5023692">func</span>&nbsp;<span class="ident" id="5023697">RunBenchmarks</span><span class="op" id="5023710">(</span><span class="ident" id="5023711">matchString</span>&nbsp;<span class="keyword" id="5023723">func</span><span class="op" id="5023727">(</span><span class="ident" id="5023728">pat</span><span class="op" id="5023731">,</span>&nbsp;<span class="ident" id="5023733">str</span>&nbsp;<span class="builtintype" id="5023737">string</span><span class="op" id="5023743">)</span>&nbsp;<span class="op" id="5023745">(</span><span class="builtintype" id="5023746">bool</span><span class="op" id="5023750">,</span>&nbsp;<span class="builtintype" id="5023752">error</span><span class="op" id="5023757">)</span><span class="op" id="5023758">,</span>&nbsp;<span class="ident" id="5023760">benchmarks</span>&nbsp;<span class="op" id="5023771">[</span><span class="op" id="5023772">]</span><span class="ident" id="5023773"><a href="/testing/benchmark.go.html#5017071">InternalBenchmark</a></span><span class="op" id="5023790">)</span>&nbsp;<span class="op" id="5023792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023795">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023847">if</span>&nbsp;<span class="builtinfunc" id="5023850">len</span><span class="op" id="5023853">(</span><span class="op" id="5023854">*</span><span class="ident" id="5023855"><a href="/testing/benchmark.go.html#5016473">matchBenchmarks</a></span><span class="op" id="5023870">)</span>&nbsp;<span class="op" id="5023872">==</span>&nbsp;<span class="num" id="5023875">0</span>&nbsp;<span class="op" id="5023877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023889">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023892">for</span>&nbsp;<span class="ident" id="5023896">_</span><span class="op" id="5023897">,</span>&nbsp;<span class="ident" id="5023899">Benchmark</span>&nbsp;<span class="op" id="5023909">:=</span>&nbsp;<span class="keyword" id="5023912">range</span>&nbsp;<span class="ident" id="5023918"><a href="/testing/benchmark.go.html#5023760">benchmarks</a></span>&nbsp;<span class="op" id="5023929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023933">matched</span><span class="op" id="5023940">,</span>&nbsp;<span class="ident" id="5023942">err</span>&nbsp;<span class="op" id="5023946">:=</span>&nbsp;<span class="ident" id="5023949"><a href="/testing/benchmark.go.html#5023711">matchString</a></span><span class="op" id="5023960">(</span><span class="op" id="5023961">*</span><span class="ident" id="5023962"><a href="/testing/benchmark.go.html#5016473">matchBenchmarks</a></span><span class="op" id="5023977">,</span>&nbsp;<span class="ident" id="5023979"><a href="/testing/benchmark.go.html#5023899">Benchmark</a></span><span class="op" id="5023988">.</span><span class="ident" id="5023989">Name</span><span class="op" id="5023993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023997">if</span>&nbsp;<span class="ident" id="5024000"><a href="/testing/benchmark.go.html#5023942">err</a></span>&nbsp;<span class="op" id="5024004">!=</span>&nbsp;<span class="ident" id="5024007">nil</span>&nbsp;<span class="op" id="5024011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024016"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5024019">.</span><span class="ident" id="5024020">Fprintf</span><span class="op" id="5024027">(</span><span class="ident" id="5024028"><a href="/testing/benchmark.go.html#5016419">os</a></span><span class="op" id="5024030">.</span><span class="ident" id="5024031">Stderr</span><span class="op" id="5024037">,</span>&nbsp;<span class="string" id="5024039">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5024086">,</span>&nbsp;<span class="ident" id="5024088"><a href="/testing/benchmark.go.html#5023942">err</a></span><span class="op" id="5024091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024096"><a href="/testing/benchmark.go.html#5016419">os</a></span><span class="op" id="5024098">.</span><span class="ident" id="5024099">Exit</span><span class="op" id="5024103">(</span><span class="num" id="5024104">1</span><span class="op" id="5024105">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024113">if</span>&nbsp;<span class="op" id="5024116">!</span><span class="ident" id="5024117"><a href="/testing/benchmark.go.html#5023933">matched</a></span>&nbsp;<span class="op" id="5024125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024145">for</span>&nbsp;<span class="ident" id="5024149">_</span><span class="op" id="5024150">,</span>&nbsp;<span class="ident" id="5024152">procs</span>&nbsp;<span class="op" id="5024158">:=</span>&nbsp;<span class="keyword" id="5024161">range</span>&nbsp;<span class="ident" id="5024167"><a href="/testing/testing.go.html#5041003">cpuList</a></span>&nbsp;<span class="op" id="5024175">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024180"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5024187">.</span><span class="ident" id="5024188">GOMAXPROCS</span><span class="op" id="5024198">(</span><span class="ident" id="5024199"><a href="/testing/benchmark.go.html#5024152">procs</a></span><span class="op" id="5024204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024209">b</span>&nbsp;<span class="op" id="5024211">:=</span>&nbsp;<span class="op" id="5024214">&amp;</span><span class="ident" id="5024215"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5024216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024222">common</span><span class="op" id="5024228">:</span>&nbsp;<span class="ident" id="5024230"><a href="/testing/testing.go.html#5041124">common</a></span><span class="op" id="5024236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024243">signal</span><span class="op" id="5024249">:</span>&nbsp;<span class="builtinfunc" id="5024251">make</span><span class="op" id="5024255">(</span><span class="keyword" id="5024256">chan</span>&nbsp;<span class="keyword" id="5024261">interface</span><span class="op" id="5024270">{</span><span class="op" id="5024271">}</span><span class="op" id="5024272">)</span><span class="op" id="5024273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024279">}</span><span class="op" id="5024280">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024286">benchmark</span><span class="op" id="5024295">:</span>&nbsp;<span class="ident" id="5024297"><a href="/testing/benchmark.go.html#5023899">Benchmark</a></span><span class="op" id="5024306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024316">benchName</span>&nbsp;<span class="op" id="5024326">:=</span>&nbsp;<span class="ident" id="5024329"><a href="/testing/benchmark.go.html#5023899">Benchmark</a></span><span class="op" id="5024338">.</span><span class="ident" id="5024339">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024347">if</span>&nbsp;<span class="ident" id="5024350"><a href="/testing/benchmark.go.html#5024152">procs</a></span>&nbsp;<span class="op" id="5024356">!=</span>&nbsp;<span class="num" id="5024359">1</span>&nbsp;<span class="op" id="5024361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024367"><a href="/testing/benchmark.go.html#5024316">benchName</a></span>&nbsp;<span class="op" id="5024377">=</span>&nbsp;<span class="ident" id="5024379"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5024382">.</span><span class="ident" id="5024383">Sprintf</span><span class="op" id="5024390">(</span><span class="string" id="5024391">&#34;%s-%d&#34;</span><span class="op" id="5024398">,</span>&nbsp;<span class="ident" id="5024400"><a href="/testing/benchmark.go.html#5023899">Benchmark</a></span><span class="op" id="5024409">.</span><span class="ident" id="5024410">Name</span><span class="op" id="5024414">,</span>&nbsp;<span class="ident" id="5024416"><a href="/testing/benchmark.go.html#5024152">procs</a></span><span class="op" id="5024421">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024431"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5024434">.</span><span class="ident" id="5024435">Printf</span><span class="op" id="5024441">(</span><span class="string" id="5024442">&#34;%s\t&#34;</span><span class="op" id="5024448">,</span>&nbsp;<span class="ident" id="5024450"><a href="/testing/benchmark.go.html#5024316">benchName</a></span><span class="op" id="5024459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024464">r</span>&nbsp;<span class="op" id="5024466">:=</span>&nbsp;<span class="ident" id="5024469"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5024470">.</span><span class="ident" id="5024471">run</span><span class="op" id="5024474">(</span><span class="op" id="5024475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024480">if</span>&nbsp;<span class="ident" id="5024483"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5024484">.</span><span class="ident" id="5024485">failed</span>&nbsp;<span class="op" id="5024492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024498">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024561">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024638">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024667"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5024670">.</span><span class="ident" id="5024671">Printf</span><span class="op" id="5024677">(</span><span class="string" id="5024678">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5024696">,</span>&nbsp;<span class="ident" id="5024698"><a href="/testing/benchmark.go.html#5024316">benchName</a></span><span class="op" id="5024707">,</span>&nbsp;<span class="ident" id="5024709"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5024710">.</span><span class="ident" id="5024711">output</span><span class="op" id="5024717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024723">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024735">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024740">results</span>&nbsp;<span class="op" id="5024748">:=</span>&nbsp;<span class="ident" id="5024751"><a href="/testing/benchmark.go.html#5024464">r</a></span><span class="op" id="5024752">.</span><span class="ident" id="5024753">String</span><span class="op" id="5024759">(</span><span class="op" id="5024760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024765">if</span>&nbsp;<span class="op" id="5024768">*</span><span class="ident" id="5024769"><a href="/testing/benchmark.go.html#5016681">benchmarkMemory</a></span>&nbsp;<span class="op" id="5024785">||</span>&nbsp;<span class="ident" id="5024788"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5024789">.</span><span class="ident" id="5024790">showAllocResult</span>&nbsp;<span class="op" id="5024806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024812"><a href="/testing/benchmark.go.html#5024740">results</a></span>&nbsp;<span class="op" id="5024820">+=</span>&nbsp;<span class="string" id="5024823">&#34;\t&#34;</span>&nbsp;<span class="op" id="5024828">+</span>&nbsp;<span class="ident" id="5024830"><a href="/testing/benchmark.go.html#5024464">r</a></span><span class="op" id="5024831">.</span><span class="ident" id="5024832">MemString</span><span class="op" id="5024841">(</span><span class="op" id="5024842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024852"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5024855">.</span><span class="ident" id="5024856">Println</span><span class="op" id="5024863">(</span><span class="ident" id="5024864"><a href="/testing/benchmark.go.html#5024740">results</a></span><span class="op" id="5024871">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024876">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024956">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025029">if</span>&nbsp;<span class="builtinfunc" id="5025032">len</span><span class="op" id="5025035">(</span><span class="ident" id="5025036"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5025037">.</span><span class="ident" id="5025038">output</span><span class="op" id="5025044">)</span>&nbsp;<span class="op" id="5025046">&gt;</span>&nbsp;<span class="num" id="5025048">0</span>&nbsp;<span class="op" id="5025050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025056"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5025057">.</span><span class="ident" id="5025058">trimOutput</span><span class="op" id="5025068">(</span><span class="op" id="5025069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025075"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5025078">.</span><span class="ident" id="5025079">Printf</span><span class="op" id="5025085">(</span><span class="string" id="5025086">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5025105">,</span>&nbsp;<span class="ident" id="5025107"><a href="/testing/benchmark.go.html#5024316">benchName</a></span><span class="op" id="5025116">,</span>&nbsp;<span class="ident" id="5025118"><a href="/testing/benchmark.go.html#5024209">b</a></span><span class="op" id="5025119">.</span><span class="ident" id="5025120">output</span><span class="op" id="5025126">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025136">if</span>&nbsp;<span class="ident" id="5025139">p</span>&nbsp;<span class="op" id="5025141">:=</span>&nbsp;<span class="ident" id="5025144"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5025151">.</span><span class="ident" id="5025152">GOMAXPROCS</span><span class="op" id="5025162">(</span><span class="op" id="5025163">-</span><span class="num" id="5025164">1</span><span class="op" id="5025165">)</span><span class="op" id="5025166">;</span>&nbsp;<span class="ident" id="5025168"><a href="/testing/benchmark.go.html#5025139">p</a></span>&nbsp;<span class="op" id="5025170">!=</span>&nbsp;<span class="ident" id="5025173"><a href="/testing/benchmark.go.html#5024152">procs</a></span>&nbsp;<span class="op" id="5025179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025185"><a href="/testing/benchmark.go.html#5016412">fmt</a></span><span class="op" id="5025188">.</span><span class="ident" id="5025189">Fprintf</span><span class="op" id="5025196">(</span><span class="ident" id="5025197"><a href="/testing/benchmark.go.html#5016419">os</a></span><span class="op" id="5025199">.</span><span class="ident" id="5025200">Stderr</span><span class="op" id="5025206">,</span>&nbsp;<span class="string" id="5025208">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5025249">,</span>&nbsp;<span class="ident" id="5025251"><a href="/testing/benchmark.go.html#5024316">benchName</a></span><span class="op" id="5025260">,</span>&nbsp;<span class="ident" id="5025262"><a href="/testing/benchmark.go.html#5025139">p</a></span><span class="op" id="5025263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025272">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025275">}</span><br>
<span class="lineno"></span><span class="op" id="5025277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5025280">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5025356">func</span>&nbsp;<span class="op" id="5025361">(</span><span class="ident" id="5025362">b</span>&nbsp;<span class="op" id="5025364">*</span><span class="ident" id="5025365"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5025366">)</span>&nbsp;<span class="ident" id="5025368">trimOutput</span><span class="op" id="5025378">(</span><span class="op" id="5025379">)</span>&nbsp;<span class="op" id="5025381">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025384">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025456">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5025536">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025620">const</span>&nbsp;<span class="ident" id="5025626">maxNewlines</span>&nbsp;<span class="op" id="5025638">=</span>&nbsp;<span class="num" id="5025640">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025644">for</span>&nbsp;<span class="ident" id="5025648">nlCount</span><span class="op" id="5025655">,</span>&nbsp;<span class="ident" id="5025657">j</span>&nbsp;<span class="op" id="5025659">:=</span>&nbsp;<span class="num" id="5025662">0</span><span class="op" id="5025663">,</span>&nbsp;<span class="num" id="5025665">0</span><span class="op" id="5025666">;</span>&nbsp;<span class="ident" id="5025668"><a href="/testing/benchmark.go.html#5025657">j</a></span>&nbsp;<span class="op" id="5025670">&lt;</span>&nbsp;<span class="builtinfunc" id="5025672">len</span><span class="op" id="5025675">(</span><span class="ident" id="5025676"><a href="/testing/benchmark.go.html#5025362">b</a></span><span class="op" id="5025677">.</span><span class="ident" id="5025678">output</span><span class="op" id="5025684">)</span><span class="op" id="5025685">;</span>&nbsp;<span class="ident" id="5025687"><a href="/testing/benchmark.go.html#5025657">j</a></span><span class="op" id="5025688">++</span>&nbsp;<span class="op" id="5025691">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025695">if</span>&nbsp;<span class="ident" id="5025698"><a href="/testing/benchmark.go.html#5025362">b</a></span><span class="op" id="5025699">.</span><span class="ident" id="5025700">output</span><span class="op" id="5025706">[</span><span class="ident" id="5025707"><a href="/testing/benchmark.go.html#5025657">j</a></span><span class="op" id="5025708">]</span>&nbsp;<span class="op" id="5025710">==</span>&nbsp;<span class="string" id="5025713">&#39;\n&#39;</span>&nbsp;<span class="op" id="5025718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025723"><a href="/testing/benchmark.go.html#5025648">nlCount</a></span><span class="op" id="5025730">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025736">if</span>&nbsp;<span class="ident" id="5025739"><a href="/testing/benchmark.go.html#5025648">nlCount</a></span>&nbsp;<span class="op" id="5025747">&gt;=</span>&nbsp;<span class="ident" id="5025750"><a href="/testing/benchmark.go.html#5025626">maxNewlines</a></span>&nbsp;<span class="op" id="5025762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025768"><a href="/testing/benchmark.go.html#5025362">b</a></span><span class="op" id="5025769">.</span><span class="ident" id="5025770">output</span>&nbsp;<span class="op" id="5025777">=</span>&nbsp;<span class="builtinfunc" id="5025779">append</span><span class="op" id="5025785">(</span><span class="ident" id="5025786"><a href="/testing/benchmark.go.html#5025362">b</a></span><span class="op" id="5025787">.</span><span class="ident" id="5025788">output</span><span class="op" id="5025794">[</span><span class="op" id="5025795">:</span><span class="ident" id="5025796"><a href="/testing/benchmark.go.html#5025657">j</a></span><span class="op" id="5025797">]</span><span class="op" id="5025798">,</span>&nbsp;<span class="string" id="5025800">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5025830">...</span><span class="op" id="5025833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025839">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025855">}</span><br>
<span class="lineno"></span><span class="op" id="5025857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5025860">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5025924">type</span>&nbsp;<span class="ident" id="5025929">PB</span>&nbsp;<span class="keyword" id="5025932">struct</span>&nbsp;<span class="op" id="5025939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025942">globalN</span>&nbsp;<span class="op" id="5025950">*</span><span class="ident" id="5025951">uint64</span>&nbsp;<span class="comment" id="5025958">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026017">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5026025">uint64</span>&nbsp;&nbsp;<span class="comment" id="5026033">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026087">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5026095">uint64</span>&nbsp;&nbsp;<span class="comment" id="5026103">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026142">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5026150">uint64</span>&nbsp;&nbsp;<span class="comment" id="5026158">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5026205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5026208">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5026270">func</span>&nbsp;<span class="op" id="5026275">(</span><span class="ident" id="5026276">pb</span>&nbsp;<span class="op" id="5026279">*</span><span class="ident" id="5026280"><a href="/testing/benchmark.go.html#5025929">PB</a></span><span class="op" id="5026282">)</span>&nbsp;<span class="ident" id="5026284">Next</span><span class="op" id="5026288">(</span><span class="op" id="5026289">)</span>&nbsp;<span class="builtintype" id="5026291">bool</span>&nbsp;<span class="op" id="5026296">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026299">if</span>&nbsp;<span class="ident" id="5026302"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026304">.</span><span class="ident" id="5026305">cache</span>&nbsp;<span class="op" id="5026311">==</span>&nbsp;<span class="num" id="5026314">0</span>&nbsp;<span class="op" id="5026316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026320">n</span>&nbsp;<span class="op" id="5026322">:=</span>&nbsp;<span class="ident" id="5026325"><a href="/testing/benchmark.go.html#5016444">atomic</a></span><span class="op" id="5026331">.</span><span class="ident" id="5026332">AddUint64</span><span class="op" id="5026341">(</span><span class="ident" id="5026342"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026344">.</span><span class="ident" id="5026345">globalN</span><span class="op" id="5026352">,</span>&nbsp;<span class="ident" id="5026354"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026356">.</span><span class="ident" id="5026357">grain</span><span class="op" id="5026362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026366">if</span>&nbsp;<span class="ident" id="5026369"><a href="/testing/benchmark.go.html#5026320">n</a></span>&nbsp;<span class="op" id="5026371">&lt;=</span>&nbsp;<span class="ident" id="5026374"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026376">.</span><span class="ident" id="5026377">bN</span>&nbsp;<span class="op" id="5026380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026385"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026387">.</span><span class="ident" id="5026388">cache</span>&nbsp;<span class="op" id="5026394">=</span>&nbsp;<span class="ident" id="5026396"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026398">.</span><span class="ident" id="5026399">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026407">}</span>&nbsp;<span class="keyword" id="5026409">else</span>&nbsp;<span class="keyword" id="5026414">if</span>&nbsp;<span class="ident" id="5026417"><a href="/testing/benchmark.go.html#5026320">n</a></span>&nbsp;<span class="op" id="5026419">&lt;</span>&nbsp;<span class="ident" id="5026421"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026423">.</span><span class="ident" id="5026424">bN</span><span class="op" id="5026426">+</span><span class="ident" id="5026427"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026429">.</span><span class="ident" id="5026430">grain</span>&nbsp;<span class="op" id="5026436">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026441"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026443">.</span><span class="ident" id="5026444">cache</span>&nbsp;<span class="op" id="5026450">=</span>&nbsp;<span class="ident" id="5026452"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026454">.</span><span class="ident" id="5026455">bN</span>&nbsp;<span class="op" id="5026458">+</span>&nbsp;<span class="ident" id="5026460"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026462">.</span><span class="ident" id="5026463">grain</span>&nbsp;<span class="op" id="5026469">-</span>&nbsp;<span class="ident" id="5026471"><a href="/testing/benchmark.go.html#5026320">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026475">}</span>&nbsp;<span class="keyword" id="5026477">else</span>&nbsp;<span class="op" id="5026482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026487">return</span>&nbsp;<span class="builtintype" id="5026494">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026505">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026508"><a href="/testing/benchmark.go.html#5026276">pb</a></span><span class="op" id="5026510">.</span><span class="ident" id="5026511">cache</span><span class="op" id="5026516">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026520">return</span>&nbsp;<span class="builtintype" id="5026527">true</span><br>
<span class="lineno"></span><span class="op" id="5026532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5026535">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5026580">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5026657">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5026737">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5026806">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5026865">//</span><br>
<span class="lineno">385</span><span class="comment" id="5026868">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5026941">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5027012">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5027085">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5027121">func</span>&nbsp;<span class="op" id="5027126">(</span><span class="ident" id="5027127">b</span>&nbsp;<span class="op" id="5027129">*</span><span class="ident" id="5027130"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5027131">)</span>&nbsp;<span class="ident" id="5027133">RunParallel</span><span class="op" id="5027144">(</span><span class="ident" id="5027145">body</span>&nbsp;<span class="keyword" id="5027150">func</span><span class="op" id="5027154">(</span><span class="op" id="5027155">*</span><span class="ident" id="5027156"><a href="/testing/benchmark.go.html#5025929">PB</a></span><span class="op" id="5027158">)</span><span class="op" id="5027159">)</span>&nbsp;<span class="op" id="5027161">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027164">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027232">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027301">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027329">grain</span>&nbsp;<span class="op" id="5027335">:=</span>&nbsp;<span class="ident" id="5027338">uint64</span><span class="op" id="5027344">(</span><span class="num" id="5027345">0</span><span class="op" id="5027346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027349">if</span>&nbsp;<span class="ident" id="5027352"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027353">.</span><span class="ident" id="5027354">previousN</span>&nbsp;<span class="op" id="5027364">&gt;</span>&nbsp;<span class="num" id="5027366">0</span>&nbsp;<span class="op" id="5027368">&amp;&amp;</span>&nbsp;<span class="ident" id="5027371"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027372">.</span><span class="ident" id="5027373">previousDuration</span>&nbsp;<span class="op" id="5027390">&gt;</span>&nbsp;<span class="num" id="5027392">0</span>&nbsp;<span class="op" id="5027394">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027398"><a href="/testing/benchmark.go.html#5027329">grain</a></span>&nbsp;<span class="op" id="5027404">=</span>&nbsp;<span class="num" id="5027406">1e5</span>&nbsp;<span class="op" id="5027410">*</span>&nbsp;<span class="ident" id="5027412">uint64</span><span class="op" id="5027418">(</span><span class="ident" id="5027419"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027420">.</span><span class="ident" id="5027421">previousN</span><span class="op" id="5027430">)</span>&nbsp;<span class="op" id="5027432">/</span>&nbsp;<span class="ident" id="5027434">uint64</span><span class="op" id="5027440">(</span><span class="ident" id="5027441"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027442">.</span><span class="ident" id="5027443">previousDuration</span><span class="op" id="5027459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027465">if</span>&nbsp;<span class="ident" id="5027468"><a href="/testing/benchmark.go.html#5027329">grain</a></span>&nbsp;<span class="op" id="5027474">&lt;</span>&nbsp;<span class="num" id="5027476">1</span>&nbsp;<span class="op" id="5027478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027482"><a href="/testing/benchmark.go.html#5027329">grain</a></span>&nbsp;<span class="op" id="5027488">=</span>&nbsp;<span class="num" id="5027490">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027493">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027496">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027566">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027621">if</span>&nbsp;<span class="ident" id="5027624"><a href="/testing/benchmark.go.html#5027329">grain</a></span>&nbsp;<span class="op" id="5027630">&gt;</span>&nbsp;<span class="num" id="5027632">1e4</span>&nbsp;<span class="op" id="5027636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027640"><a href="/testing/benchmark.go.html#5027329">grain</a></span>&nbsp;<span class="op" id="5027646">=</span>&nbsp;<span class="num" id="5027648">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027653">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027657">n</span>&nbsp;<span class="op" id="5027659">:=</span>&nbsp;<span class="ident" id="5027662">uint64</span><span class="op" id="5027668">(</span><span class="num" id="5027669">0</span><span class="op" id="5027670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027673">numProcs</span>&nbsp;<span class="op" id="5027682">:=</span>&nbsp;<span class="ident" id="5027685"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027686">.</span><span class="ident" id="5027687">parallelism</span>&nbsp;<span class="op" id="5027699">*</span>&nbsp;<span class="ident" id="5027701"><a href="/testing/benchmark.go.html#5016425">runtime</a></span><span class="op" id="5027708">.</span><span class="ident" id="5027709">GOMAXPROCS</span><span class="op" id="5027719">(</span><span class="num" id="5027720">0</span><span class="op" id="5027721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027724">var</span>&nbsp;<span class="ident" id="5027728">wg</span>&nbsp;<span class="ident" id="5027731"><a href="/testing/benchmark.go.html#5016436">sync</a></span><span class="op" id="5027735">.</span><span class="ident" id="5027736">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027747"><a href="/testing/benchmark.go.html#5027728">wg</a></span><span class="op" id="5027749">.</span><span class="ident" id="5027750">Add</span><span class="op" id="5027753">(</span><span class="ident" id="5027754"><a href="/testing/benchmark.go.html#5027673">numProcs</a></span><span class="op" id="5027762">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027765">for</span>&nbsp;<span class="ident" id="5027769">p</span>&nbsp;<span class="op" id="5027771">:=</span>&nbsp;<span class="num" id="5027774">0</span><span class="op" id="5027775">;</span>&nbsp;<span class="ident" id="5027777"><a href="/testing/benchmark.go.html#5027769">p</a></span>&nbsp;<span class="op" id="5027779">&lt;</span>&nbsp;<span class="ident" id="5027781"><a href="/testing/benchmark.go.html#5027673">numProcs</a></span><span class="op" id="5027789">;</span>&nbsp;<span class="ident" id="5027791"><a href="/testing/benchmark.go.html#5027769">p</a></span><span class="op" id="5027792">++</span>&nbsp;<span class="op" id="5027795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027799">go</span>&nbsp;<span class="keyword" id="5027802">func</span><span class="op" id="5027806">(</span><span class="op" id="5027807">)</span>&nbsp;<span class="op" id="5027809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027814">defer</span>&nbsp;<span class="ident" id="5027820"><a href="/testing/benchmark.go.html#5027728">wg</a></span><span class="op" id="5027822">.</span><span class="ident" id="5027823">Done</span><span class="op" id="5027827">(</span><span class="op" id="5027828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027833">pb</span>&nbsp;<span class="op" id="5027836">:=</span>&nbsp;<span class="op" id="5027839">&amp;</span><span class="ident" id="5027840"><a href="/testing/benchmark.go.html#5025929">PB</a></span><span class="op" id="5027842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027848">globalN</span><span class="op" id="5027855">:</span>&nbsp;<span class="op" id="5027857">&amp;</span><span class="ident" id="5027858"><a href="/testing/benchmark.go.html#5027657">n</a></span><span class="op" id="5027859">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027865">grain</span><span class="op" id="5027870">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5027874"><a href="/testing/benchmark.go.html#5027329">grain</a></span><span class="op" id="5027879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027885">bN</span><span class="op" id="5027887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5027894">uint64</span><span class="op" id="5027900">(</span><span class="ident" id="5027901"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027902">.</span><span class="ident" id="5027903">N</span><span class="op" id="5027904">)</span><span class="op" id="5027905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027915"><a href="/testing/benchmark.go.html#5027145">body</a></span><span class="op" id="5027919">(</span><span class="ident" id="5027920"><a href="/testing/benchmark.go.html#5027833">pb</a></span><span class="op" id="5027922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027926">}</span><span class="op" id="5027927">(</span><span class="op" id="5027928">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027934"><a href="/testing/benchmark.go.html#5027728">wg</a></span><span class="op" id="5027936">.</span><span class="ident" id="5027937">Wait</span><span class="op" id="5027941">(</span><span class="op" id="5027942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027945">if</span>&nbsp;<span class="ident" id="5027948"><a href="/testing/benchmark.go.html#5027657">n</a></span>&nbsp;<span class="op" id="5027950">&lt;=</span>&nbsp;<span class="ident" id="5027953">uint64</span><span class="op" id="5027959">(</span><span class="ident" id="5027960"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027961">.</span><span class="ident" id="5027962">N</span><span class="op" id="5027963">)</span>&nbsp;<span class="op" id="5027965">&amp;&amp;</span>&nbsp;<span class="op" id="5027968">!</span><span class="ident" id="5027969"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027970">.</span><span class="ident" id="5027971">Failed</span><span class="op" id="5027977">(</span><span class="op" id="5027978">)</span>&nbsp;<span class="op" id="5027980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027984"><a href="/testing/benchmark.go.html#5027127">b</a></span><span class="op" id="5027985">.</span><span class="ident" id="5027986">Fatal</span><span class="op" id="5027991">(</span><span class="string" id="5027992">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5028045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028048">}</span><br>
<span class="lineno">425</span><span class="op" id="5028050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5028053">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5028138">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5028215">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5028270">func</span>&nbsp;<span class="op" id="5028275">(</span><span class="ident" id="5028276">b</span>&nbsp;<span class="op" id="5028278">*</span><span class="ident" id="5028279"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5028280">)</span>&nbsp;<span class="ident" id="5028282">SetParallelism</span><span class="op" id="5028296">(</span><span class="ident" id="5028297">p</span>&nbsp;<span class="builtintype" id="5028299">int</span><span class="op" id="5028302">)</span>&nbsp;<span class="op" id="5028304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028307">if</span>&nbsp;<span class="ident" id="5028310"><a href="/testing/benchmark.go.html#5028297">p</a></span>&nbsp;<span class="op" id="5028312">&gt;=</span>&nbsp;<span class="num" id="5028315">1</span>&nbsp;<span class="op" id="5028317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028321"><a href="/testing/benchmark.go.html#5028276">b</a></span><span class="op" id="5028322">.</span><span class="ident" id="5028323">parallelism</span>&nbsp;<span class="op" id="5028335">=</span>&nbsp;<span class="ident" id="5028337"><a href="/testing/benchmark.go.html#5028297">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028340">}</span><br>
<span class="lineno"></span><span class="op" id="5028342">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5028345">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5028408">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5028468">func</span>&nbsp;<span class="ident" id="5028473">Benchmark</span><span class="op" id="5028482">(</span><span class="ident" id="5028483">f</span>&nbsp;<span class="keyword" id="5028485">func</span><span class="op" id="5028489">(</span><span class="ident" id="5028490">b</span>&nbsp;<span class="op" id="5028492">*</span><span class="ident" id="5028493"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5028494">)</span><span class="op" id="5028495">)</span>&nbsp;<span class="ident" id="5028497"><a href="/testing/benchmark.go.html#5022012">BenchmarkResult</a></span>&nbsp;<span class="op" id="5028513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028516">b</span>&nbsp;<span class="op" id="5028518">:=</span>&nbsp;<span class="op" id="5028521">&amp;</span><span class="ident" id="5028522"><a href="/testing/benchmark.go.html#5017259">B</a></span><span class="op" id="5028523">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028527">common</span><span class="op" id="5028533">:</span>&nbsp;<span class="ident" id="5028535"><a href="/testing/testing.go.html#5041124">common</a></span><span class="op" id="5028541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028546">signal</span><span class="op" id="5028552">:</span>&nbsp;<span class="builtinfunc" id="5028554">make</span><span class="op" id="5028558">(</span><span class="keyword" id="5028559">chan</span>&nbsp;<span class="keyword" id="5028564">interface</span><span class="op" id="5028573">{</span><span class="op" id="5028574">}</span><span class="op" id="5028575">)</span><span class="op" id="5028576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028580">}</span><span class="op" id="5028581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028585">benchmark</span><span class="op" id="5028594">:</span>&nbsp;<span class="ident" id="5028596"><a href="/testing/benchmark.go.html#5017071">InternalBenchmark</a></span><span class="op" id="5028613">{</span><span class="string" id="5028614">&#34;&#34;</span><span class="op" id="5028616">,</span>&nbsp;<span class="ident" id="5028618"><a href="/testing/benchmark.go.html#5028483">f</a></span><span class="op" id="5028619">}</span><span class="op" id="5028620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028623">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028626">return</span>&nbsp;<span class="ident" id="5028633"><a href="/testing/benchmark.go.html#5028516">b</a></span><span class="op" id="5028634">.</span><span class="ident" id="5028635">run</span><span class="op" id="5028638">(</span><span class="op" id="5028639">)</span><br>
<span class="lineno"></span><span class="op" id="5028641">}</span>
</div>
</body>
</html>
