<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4310922">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4310977">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4311031">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4311082">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4311167">package</span>&nbsp;<span class="ident" id="4311175">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4311180">import</span>&nbsp;<span class="op" id="4311187">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4311190">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4311200">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4311206">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4311217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311220">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4311299">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4311375">type</span>&nbsp;<span class="ident" id="4311380">Parameters</span>&nbsp;<span class="keyword" id="4311391">struct</span>&nbsp;<span class="op" id="4311398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311401">P</span><span class="op" id="4311402">,</span>&nbsp;<span class="ident" id="4311404">Q</span><span class="op" id="4311405">,</span>&nbsp;<span class="ident" id="4311407">G</span>&nbsp;<span class="op" id="4311409">*</span><span class="ident" id="4311410">big</span><span class="op" id="4311413">.</span><span class="ident" id="4311414">Int</span><br>
<span class="lineno"></span><span class="op" id="4311418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4311421">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4311463">type</span>&nbsp;<span class="ident" id="4311468">PublicKey</span>&nbsp;<span class="keyword" id="4311478">struct</span>&nbsp;<span class="op" id="4311485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311488">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311500">Y</span>&nbsp;<span class="op" id="4311502">*</span><span class="ident" id="4311503">big</span><span class="op" id="4311506">.</span><span class="ident" id="4311507">Int</span><br>
<span class="lineno"></span><span class="op" id="4311511">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4311514">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4311558">type</span>&nbsp;<span class="ident" id="4311563">PrivateKey</span>&nbsp;<span class="keyword" id="4311574">struct</span>&nbsp;<span class="op" id="4311581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311584">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4311595">X</span>&nbsp;<span class="op" id="4311597">*</span><span class="ident" id="4311598">big</span><span class="op" id="4311601">.</span><span class="ident" id="4311602">Int</span><br>
<span class="lineno">30</span><span class="op" id="4311606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311609">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4311686">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4311762">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4311841">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4311872">var</span>&nbsp;<span class="ident" id="4311876">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4311896">=</span>&nbsp;<span class="ident" id="4311898">errors</span><span class="op" id="4311904">.</span><span class="ident" id="4311905">New</span><span class="op" id="4311908">(</span><span class="string" id="4311909">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4311941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311944">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4312023">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4312083">type</span>&nbsp;<span class="ident" id="4312088">ParameterSizes</span>&nbsp;<span class="builtintype" id="4312103">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4312108">const</span>&nbsp;<span class="op" id="4312114">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312117">L1024N160</span>&nbsp;<span class="ident" id="4312127">ParameterSizes</span>&nbsp;<span class="op" id="4312142">=</span>&nbsp;<span class="ident" id="4312144">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312150">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312161">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312172">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4312182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4312185">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4312265">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4312334">const</span>&nbsp;<span class="ident" id="4312340">numMRTests</span>&nbsp;<span class="op" id="4312351">=</span>&nbsp;<span class="num" id="4312353">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4312357">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4312435">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4312495">func</span>&nbsp;<span class="ident" id="4312500">GenerateParameters</span><span class="op" id="4312518">(</span><span class="ident" id="4312519">params</span>&nbsp;<span class="op" id="4312526">*</span><span class="ident" id="4312527">Parameters</span><span class="op" id="4312537">,</span>&nbsp;<span class="ident" id="4312539">rand</span>&nbsp;<span class="ident" id="4312544">io</span><span class="op" id="4312546">.</span><span class="ident" id="4312547">Reader</span><span class="op" id="4312553">,</span>&nbsp;<span class="ident" id="4312555">sizes</span>&nbsp;<span class="ident" id="4312561">ParameterSizes</span><span class="op" id="4312575">)</span>&nbsp;<span class="op" id="4312577">(</span><span class="ident" id="4312578">err</span>&nbsp;<span class="builtintype" id="4312582">error</span><span class="op" id="4312587">)</span>&nbsp;<span class="op" id="4312589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312592">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312663">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312732">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312797">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312838">var</span>&nbsp;<span class="ident" id="4312842">L</span><span class="op" id="4312843">,</span>&nbsp;<span class="ident" id="4312845">N</span>&nbsp;<span class="builtintype" id="4312847">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312852">switch</span>&nbsp;<span class="ident" id="4312859">sizes</span>&nbsp;<span class="op" id="4312865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312868">case</span>&nbsp;<span class="ident" id="4312873">L1024N160</span><span class="op" id="4312882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312886">L</span>&nbsp;<span class="op" id="4312888">=</span>&nbsp;<span class="num" id="4312890">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312897">N</span>&nbsp;<span class="op" id="4312899">=</span>&nbsp;<span class="num" id="4312901">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312906">case</span>&nbsp;<span class="ident" id="4312911">L2048N224</span><span class="op" id="4312920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312924">L</span>&nbsp;<span class="op" id="4312926">=</span>&nbsp;<span class="num" id="4312928">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312935">N</span>&nbsp;<span class="op" id="4312937">=</span>&nbsp;<span class="num" id="4312939">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312944">case</span>&nbsp;<span class="ident" id="4312949">L2048N256</span><span class="op" id="4312958">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312962">L</span>&nbsp;<span class="op" id="4312964">=</span>&nbsp;<span class="num" id="4312966">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4312973">N</span>&nbsp;<span class="op" id="4312975">=</span>&nbsp;<span class="num" id="4312977">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4312982">case</span>&nbsp;<span class="ident" id="4312987">L3072N256</span><span class="op" id="4312996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313000">L</span>&nbsp;<span class="op" id="4313002">=</span>&nbsp;<span class="num" id="4313004">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313011">N</span>&nbsp;<span class="op" id="4313013">=</span>&nbsp;<span class="num" id="4313015">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313020">default</span><span class="op" id="4313027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313031">return</span>&nbsp;<span class="ident" id="4313038">errors</span><span class="op" id="4313044">.</span><span class="ident" id="4313045">New</span><span class="op" id="4313048">(</span><span class="string" id="4313049">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4313085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313092">qBytes</span>&nbsp;<span class="op" id="4313099">:=</span>&nbsp;<span class="builtinfunc" id="4313102">make</span><span class="op" id="4313106">(</span><span class="op" id="4313107">[</span><span class="op" id="4313108">]</span><span class="builtintype" id="4313109">byte</span><span class="op" id="4313113">,</span>&nbsp;<span class="ident" id="4313115">N</span><span class="op" id="4313116">/</span><span class="num" id="4313117">8</span><span class="op" id="4313118">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313121">pBytes</span>&nbsp;<span class="op" id="4313128">:=</span>&nbsp;<span class="builtinfunc" id="4313131">make</span><span class="op" id="4313135">(</span><span class="op" id="4313136">[</span><span class="op" id="4313137">]</span><span class="builtintype" id="4313138">byte</span><span class="op" id="4313142">,</span>&nbsp;<span class="ident" id="4313144">L</span><span class="op" id="4313145">/</span><span class="num" id="4313146">8</span><span class="op" id="4313147">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313151">q</span>&nbsp;<span class="op" id="4313153">:=</span>&nbsp;<span class="builtinfunc" id="4313156">new</span><span class="op" id="4313159">(</span><span class="ident" id="4313160">big</span><span class="op" id="4313163">.</span><span class="ident" id="4313164">Int</span><span class="op" id="4313167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313170">p</span>&nbsp;<span class="op" id="4313172">:=</span>&nbsp;<span class="builtinfunc" id="4313175">new</span><span class="op" id="4313178">(</span><span class="ident" id="4313179">big</span><span class="op" id="4313182">.</span><span class="ident" id="4313183">Int</span><span class="op" id="4313186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313189">rem</span>&nbsp;<span class="op" id="4313193">:=</span>&nbsp;<span class="builtinfunc" id="4313196">new</span><span class="op" id="4313199">(</span><span class="ident" id="4313200">big</span><span class="op" id="4313203">.</span><span class="ident" id="4313204">Int</span><span class="op" id="4313207">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313210">one</span>&nbsp;<span class="op" id="4313214">:=</span>&nbsp;<span class="builtinfunc" id="4313217">new</span><span class="op" id="4313220">(</span><span class="ident" id="4313221">big</span><span class="op" id="4313224">.</span><span class="ident" id="4313225">Int</span><span class="op" id="4313228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313231">one</span><span class="op" id="4313234">.</span><span class="ident" id="4313235">SetInt64</span><span class="op" id="4313243">(</span><span class="num" id="4313244">1</span><span class="op" id="4313245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4313248">GeneratePrimes</span><span class="op" id="4313262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313265">for</span>&nbsp;<span class="op" id="4313269">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313273">_</span><span class="op" id="4313274">,</span>&nbsp;<span class="ident" id="4313276">err</span>&nbsp;<span class="op" id="4313280">=</span>&nbsp;<span class="ident" id="4313282">io</span><span class="op" id="4313284">.</span><span class="ident" id="4313285">ReadFull</span><span class="op" id="4313293">(</span><span class="ident" id="4313294">rand</span><span class="op" id="4313298">,</span>&nbsp;<span class="ident" id="4313300">qBytes</span><span class="op" id="4313306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313310">if</span>&nbsp;<span class="ident" id="4313313">err</span>&nbsp;<span class="op" id="4313317">!=</span>&nbsp;<span class="ident" id="4313320">nil</span>&nbsp;<span class="op" id="4313324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313329">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313343">qBytes</span><span class="op" id="4313349">[</span><span class="builtinfunc" id="4313350">len</span><span class="op" id="4313353">(</span><span class="ident" id="4313354">qBytes</span><span class="op" id="4313360">)</span><span class="op" id="4313361">-</span><span class="num" id="4313362">1</span><span class="op" id="4313363">]</span>&nbsp;<span class="op" id="4313365">|=</span>&nbsp;<span class="num" id="4313368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313372">qBytes</span><span class="op" id="4313378">[</span><span class="num" id="4313379">0</span><span class="op" id="4313380">]</span>&nbsp;<span class="op" id="4313382">|=</span>&nbsp;<span class="num" id="4313385">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313392">q</span><span class="op" id="4313393">.</span><span class="ident" id="4313394">SetBytes</span><span class="op" id="4313402">(</span><span class="ident" id="4313403">qBytes</span><span class="op" id="4313409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313414">if</span>&nbsp;<span class="op" id="4313417">!</span><span class="ident" id="4313418">q</span><span class="op" id="4313419">.</span><span class="ident" id="4313420">ProbablyPrime</span><span class="op" id="4313433">(</span><span class="ident" id="4313434">numMRTests</span><span class="op" id="4313444">)</span>&nbsp;<span class="op" id="4313446">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313451">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313467">for</span>&nbsp;<span class="ident" id="4313471">i</span>&nbsp;<span class="op" id="4313473">:=</span>&nbsp;<span class="num" id="4313476">0</span><span class="op" id="4313477">;</span>&nbsp;<span class="ident" id="4313479">i</span>&nbsp;<span class="op" id="4313481">&lt;</span>&nbsp;<span class="num" id="4313483">4</span><span class="op" id="4313484">*</span><span class="ident" id="4313485">L</span><span class="op" id="4313486">;</span>&nbsp;<span class="ident" id="4313488">i</span><span class="op" id="4313489">++</span>&nbsp;<span class="op" id="4313492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313497">_</span><span class="op" id="4313498">,</span>&nbsp;<span class="ident" id="4313500">err</span>&nbsp;<span class="op" id="4313504">=</span>&nbsp;<span class="ident" id="4313506">io</span><span class="op" id="4313508">.</span><span class="ident" id="4313509">ReadFull</span><span class="op" id="4313517">(</span><span class="ident" id="4313518">rand</span><span class="op" id="4313522">,</span>&nbsp;<span class="ident" id="4313524">pBytes</span><span class="op" id="4313530">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313535">if</span>&nbsp;<span class="ident" id="4313538">err</span>&nbsp;<span class="op" id="4313542">!=</span>&nbsp;<span class="ident" id="4313545">nil</span>&nbsp;<span class="op" id="4313549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313571">pBytes</span><span class="op" id="4313577">[</span><span class="builtinfunc" id="4313578">len</span><span class="op" id="4313581">(</span><span class="ident" id="4313582">pBytes</span><span class="op" id="4313588">)</span><span class="op" id="4313589">-</span><span class="num" id="4313590">1</span><span class="op" id="4313591">]</span>&nbsp;<span class="op" id="4313593">|=</span>&nbsp;<span class="num" id="4313596">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313601">pBytes</span><span class="op" id="4313607">[</span><span class="num" id="4313608">0</span><span class="op" id="4313609">]</span>&nbsp;<span class="op" id="4313611">|=</span>&nbsp;<span class="num" id="4313614">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313623">p</span><span class="op" id="4313624">.</span><span class="ident" id="4313625">SetBytes</span><span class="op" id="4313633">(</span><span class="ident" id="4313634">pBytes</span><span class="op" id="4313640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313645">rem</span><span class="op" id="4313648">.</span><span class="ident" id="4313649">Mod</span><span class="op" id="4313652">(</span><span class="ident" id="4313653">p</span><span class="op" id="4313654">,</span>&nbsp;<span class="ident" id="4313656">q</span><span class="op" id="4313657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313662">rem</span><span class="op" id="4313665">.</span><span class="ident" id="4313666">Sub</span><span class="op" id="4313669">(</span><span class="ident" id="4313670">rem</span><span class="op" id="4313673">,</span>&nbsp;<span class="ident" id="4313675">one</span><span class="op" id="4313678">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313683">p</span><span class="op" id="4313684">.</span><span class="ident" id="4313685">Sub</span><span class="op" id="4313688">(</span><span class="ident" id="4313689">p</span><span class="op" id="4313690">,</span>&nbsp;<span class="ident" id="4313692">rem</span><span class="op" id="4313695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313700">if</span>&nbsp;<span class="ident" id="4313703">p</span><span class="op" id="4313704">.</span><span class="ident" id="4313705">BitLen</span><span class="op" id="4313711">(</span><span class="op" id="4313712">)</span>&nbsp;<span class="op" id="4313714">&lt;</span>&nbsp;<span class="ident" id="4313716">L</span>&nbsp;<span class="op" id="4313718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313724">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313742">if</span>&nbsp;<span class="op" id="4313745">!</span><span class="ident" id="4313746">p</span><span class="op" id="4313747">.</span><span class="ident" id="4313748">ProbablyPrime</span><span class="op" id="4313761">(</span><span class="ident" id="4313762">numMRTests</span><span class="op" id="4313772">)</span>&nbsp;<span class="op" id="4313774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313780">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313798">params</span><span class="op" id="4313804">.</span><span class="ident" id="4313805">P</span>&nbsp;<span class="op" id="4313807">=</span>&nbsp;<span class="ident" id="4313809">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313814">params</span><span class="op" id="4313820">.</span><span class="ident" id="4313821">Q</span>&nbsp;<span class="op" id="4313823">=</span>&nbsp;<span class="ident" id="4313825">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313830">break</span>&nbsp;<span class="ident" id="4313836">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4313856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313860">h</span>&nbsp;<span class="op" id="4313862">:=</span>&nbsp;<span class="builtinfunc" id="4313865">new</span><span class="op" id="4313868">(</span><span class="ident" id="4313869">big</span><span class="op" id="4313872">.</span><span class="ident" id="4313873">Int</span><span class="op" id="4313876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313879">h</span><span class="op" id="4313880">.</span><span class="ident" id="4313881">SetInt64</span><span class="op" id="4313889">(</span><span class="num" id="4313890">2</span><span class="op" id="4313891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313894">g</span>&nbsp;<span class="op" id="4313896">:=</span>&nbsp;<span class="builtinfunc" id="4313899">new</span><span class="op" id="4313902">(</span><span class="ident" id="4313903">big</span><span class="op" id="4313906">.</span><span class="ident" id="4313907">Int</span><span class="op" id="4313910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313914">pm1</span>&nbsp;<span class="op" id="4313918">:=</span>&nbsp;<span class="builtinfunc" id="4313921">new</span><span class="op" id="4313924">(</span><span class="ident" id="4313925">big</span><span class="op" id="4313928">.</span><span class="ident" id="4313929">Int</span><span class="op" id="4313932">)</span><span class="op" id="4313933">.</span><span class="ident" id="4313934">Sub</span><span class="op" id="4313937">(</span><span class="ident" id="4313938">p</span><span class="op" id="4313939">,</span>&nbsp;<span class="ident" id="4313941">one</span><span class="op" id="4313944">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313947">e</span>&nbsp;<span class="op" id="4313949">:=</span>&nbsp;<span class="builtinfunc" id="4313952">new</span><span class="op" id="4313955">(</span><span class="ident" id="4313956">big</span><span class="op" id="4313959">.</span><span class="ident" id="4313960">Int</span><span class="op" id="4313963">)</span><span class="op" id="4313964">.</span><span class="ident" id="4313965">Div</span><span class="op" id="4313968">(</span><span class="ident" id="4313969">pm1</span><span class="op" id="4313972">,</span>&nbsp;<span class="ident" id="4313974">q</span><span class="op" id="4313975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4313979">for</span>&nbsp;<span class="op" id="4313983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313987">g</span><span class="op" id="4313988">.</span><span class="ident" id="4313989">Exp</span><span class="op" id="4313992">(</span><span class="ident" id="4313993">h</span><span class="op" id="4313994">,</span>&nbsp;<span class="ident" id="4313996">e</span><span class="op" id="4313997">,</span>&nbsp;<span class="ident" id="4313999">p</span><span class="op" id="4314000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314004">if</span>&nbsp;<span class="ident" id="4314007">g</span><span class="op" id="4314008">.</span><span class="ident" id="4314009">Cmp</span><span class="op" id="4314012">(</span><span class="ident" id="4314013">one</span><span class="op" id="4314016">)</span>&nbsp;<span class="op" id="4314018">==</span>&nbsp;<span class="num" id="4314021">0</span>&nbsp;<span class="op" id="4314023">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314028">h</span><span class="op" id="4314029">.</span><span class="ident" id="4314030">Add</span><span class="op" id="4314033">(</span><span class="ident" id="4314034">h</span><span class="op" id="4314035">,</span>&nbsp;<span class="ident" id="4314037">one</span><span class="op" id="4314040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314061">params</span><span class="op" id="4314067">.</span><span class="ident" id="4314068">G</span>&nbsp;<span class="op" id="4314070">=</span>&nbsp;<span class="ident" id="4314072">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314084">}</span><br>
<span class="lineno"></span><span class="op" id="4314086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4314089">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4314163">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4314225">func</span>&nbsp;<span class="ident" id="4314230">GenerateKey</span><span class="op" id="4314241">(</span><span class="ident" id="4314242">priv</span>&nbsp;<span class="op" id="4314247">*</span><span class="ident" id="4314248">PrivateKey</span><span class="op" id="4314258">,</span>&nbsp;<span class="ident" id="4314260">rand</span>&nbsp;<span class="ident" id="4314265">io</span><span class="op" id="4314267">.</span><span class="ident" id="4314268">Reader</span><span class="op" id="4314274">)</span>&nbsp;<span class="builtintype" id="4314276">error</span>&nbsp;<span class="op" id="4314282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314285">if</span>&nbsp;<span class="ident" id="4314288">priv</span><span class="op" id="4314292">.</span><span class="ident" id="4314293">P</span>&nbsp;<span class="op" id="4314295">==</span>&nbsp;<span class="ident" id="4314298">nil</span>&nbsp;<span class="op" id="4314302">||</span>&nbsp;<span class="ident" id="4314305">priv</span><span class="op" id="4314309">.</span><span class="ident" id="4314310">Q</span>&nbsp;<span class="op" id="4314312">==</span>&nbsp;<span class="ident" id="4314315">nil</span>&nbsp;<span class="op" id="4314319">||</span>&nbsp;<span class="ident" id="4314322">priv</span><span class="op" id="4314326">.</span><span class="ident" id="4314327">G</span>&nbsp;<span class="op" id="4314329">==</span>&nbsp;<span class="ident" id="4314332">nil</span>&nbsp;<span class="op" id="4314336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314340">return</span>&nbsp;<span class="ident" id="4314347">errors</span><span class="op" id="4314353">.</span><span class="ident" id="4314354">New</span><span class="op" id="4314357">(</span><span class="string" id="4314358">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4314415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314418">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314422">x</span>&nbsp;<span class="op" id="4314424">:=</span>&nbsp;<span class="builtinfunc" id="4314427">new</span><span class="op" id="4314430">(</span><span class="ident" id="4314431">big</span><span class="op" id="4314434">.</span><span class="ident" id="4314435">Int</span><span class="op" id="4314438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314441">xBytes</span>&nbsp;<span class="op" id="4314448">:=</span>&nbsp;<span class="builtinfunc" id="4314451">make</span><span class="op" id="4314455">(</span><span class="op" id="4314456">[</span><span class="op" id="4314457">]</span><span class="builtintype" id="4314458">byte</span><span class="op" id="4314462">,</span>&nbsp;<span class="ident" id="4314464">priv</span><span class="op" id="4314468">.</span><span class="ident" id="4314469">Q</span><span class="op" id="4314470">.</span><span class="ident" id="4314471">BitLen</span><span class="op" id="4314477">(</span><span class="op" id="4314478">)</span><span class="op" id="4314479">/</span><span class="num" id="4314480">8</span><span class="op" id="4314481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314485">for</span>&nbsp;<span class="op" id="4314489">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314493">_</span><span class="op" id="4314494">,</span>&nbsp;<span class="ident" id="4314496">err</span>&nbsp;<span class="op" id="4314500">:=</span>&nbsp;<span class="ident" id="4314503">io</span><span class="op" id="4314505">.</span><span class="ident" id="4314506">ReadFull</span><span class="op" id="4314514">(</span><span class="ident" id="4314515">rand</span><span class="op" id="4314519">,</span>&nbsp;<span class="ident" id="4314521">xBytes</span><span class="op" id="4314527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314531">if</span>&nbsp;<span class="ident" id="4314534">err</span>&nbsp;<span class="op" id="4314538">!=</span>&nbsp;<span class="ident" id="4314541">nil</span>&nbsp;<span class="op" id="4314545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314550">return</span>&nbsp;<span class="ident" id="4314557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314567">x</span><span class="op" id="4314568">.</span><span class="ident" id="4314569">SetBytes</span><span class="op" id="4314577">(</span><span class="ident" id="4314578">xBytes</span><span class="op" id="4314584">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314588">if</span>&nbsp;<span class="ident" id="4314591">x</span><span class="op" id="4314592">.</span><span class="ident" id="4314593">Sign</span><span class="op" id="4314597">(</span><span class="op" id="4314598">)</span>&nbsp;<span class="op" id="4314600">!=</span>&nbsp;<span class="num" id="4314603">0</span>&nbsp;<span class="op" id="4314605">&amp;&amp;</span>&nbsp;<span class="ident" id="4314608">x</span><span class="op" id="4314609">.</span><span class="ident" id="4314610">Cmp</span><span class="op" id="4314613">(</span><span class="ident" id="4314614">priv</span><span class="op" id="4314618">.</span><span class="ident" id="4314619">Q</span><span class="op" id="4314620">)</span>&nbsp;<span class="op" id="4314622">&lt;</span>&nbsp;<span class="num" id="4314624">0</span>&nbsp;<span class="op" id="4314626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314631">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4314642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314646">priv</span><span class="op" id="4314650">.</span><span class="ident" id="4314651">X</span>&nbsp;<span class="op" id="4314653">=</span>&nbsp;<span class="ident" id="4314655">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314658">priv</span><span class="op" id="4314662">.</span><span class="ident" id="4314663">Y</span>&nbsp;<span class="op" id="4314665">=</span>&nbsp;<span class="builtinfunc" id="4314667">new</span><span class="op" id="4314670">(</span><span class="ident" id="4314671">big</span><span class="op" id="4314674">.</span><span class="ident" id="4314675">Int</span><span class="op" id="4314678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4314681">priv</span><span class="op" id="4314685">.</span><span class="ident" id="4314686">Y</span><span class="op" id="4314687">.</span><span class="ident" id="4314688">Exp</span><span class="op" id="4314691">(</span><span class="ident" id="4314692">priv</span><span class="op" id="4314696">.</span><span class="ident" id="4314697">G</span><span class="op" id="4314698">,</span>&nbsp;<span class="ident" id="4314700">x</span><span class="op" id="4314701">,</span>&nbsp;<span class="ident" id="4314703">priv</span><span class="op" id="4314707">.</span><span class="ident" id="4314708">P</span><span class="op" id="4314709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4314712">return</span>&nbsp;<span class="ident" id="4314719">nil</span><br>
<span class="lineno"></span><span class="op" id="4314723">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4314726">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4314803">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4314881">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4314952">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4314990">func</span>&nbsp;<span class="ident" id="4314995">fermatInverse</span><span class="op" id="4315008">(</span><span class="ident" id="4315009">k</span><span class="op" id="4315010">,</span>&nbsp;<span class="ident" id="4315012">P</span>&nbsp;<span class="op" id="4315014">*</span><span class="ident" id="4315015">big</span><span class="op" id="4315018">.</span><span class="ident" id="4315019">Int</span><span class="op" id="4315022">)</span>&nbsp;<span class="op" id="4315024">*</span><span class="ident" id="4315025">big</span><span class="op" id="4315028">.</span><span class="ident" id="4315029">Int</span>&nbsp;<span class="op" id="4315033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315036">two</span>&nbsp;<span class="op" id="4315040">:=</span>&nbsp;<span class="ident" id="4315043">big</span><span class="op" id="4315046">.</span><span class="ident" id="4315047">NewInt</span><span class="op" id="4315053">(</span><span class="num" id="4315054">2</span><span class="op" id="4315055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315058">pMinus2</span>&nbsp;<span class="op" id="4315066">:=</span>&nbsp;<span class="builtinfunc" id="4315069">new</span><span class="op" id="4315072">(</span><span class="ident" id="4315073">big</span><span class="op" id="4315076">.</span><span class="ident" id="4315077">Int</span><span class="op" id="4315080">)</span><span class="op" id="4315081">.</span><span class="ident" id="4315082">Sub</span><span class="op" id="4315085">(</span><span class="ident" id="4315086">P</span><span class="op" id="4315087">,</span>&nbsp;<span class="ident" id="4315089">two</span><span class="op" id="4315092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315095">return</span>&nbsp;<span class="builtinfunc" id="4315102">new</span><span class="op" id="4315105">(</span><span class="ident" id="4315106">big</span><span class="op" id="4315109">.</span><span class="ident" id="4315110">Int</span><span class="op" id="4315113">)</span><span class="op" id="4315114">.</span><span class="ident" id="4315115">Exp</span><span class="op" id="4315118">(</span><span class="ident" id="4315119">k</span><span class="op" id="4315120">,</span>&nbsp;<span class="ident" id="4315122">pMinus2</span><span class="op" id="4315129">,</span>&nbsp;<span class="ident" id="4315131">P</span><span class="op" id="4315132">)</span><br>
<span class="lineno"></span><span class="op" id="4315134">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4315137">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4315217">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4315295">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4315374">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4315383">//</span><br>
<span class="lineno"></span><span class="comment" id="4315386">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4315466">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4315541">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4315563">func</span>&nbsp;<span class="ident" id="4315568">Sign</span><span class="op" id="4315572">(</span><span class="ident" id="4315573">rand</span>&nbsp;<span class="ident" id="4315578">io</span><span class="op" id="4315580">.</span><span class="ident" id="4315581">Reader</span><span class="op" id="4315587">,</span>&nbsp;<span class="ident" id="4315589">priv</span>&nbsp;<span class="op" id="4315594">*</span><span class="ident" id="4315595">PrivateKey</span><span class="op" id="4315605">,</span>&nbsp;<span class="ident" id="4315607">hash</span>&nbsp;<span class="op" id="4315612">[</span><span class="op" id="4315613">]</span><span class="builtintype" id="4315614">byte</span><span class="op" id="4315618">)</span>&nbsp;<span class="op" id="4315620">(</span><span class="ident" id="4315621">r</span><span class="op" id="4315622">,</span>&nbsp;<span class="ident" id="4315624">s</span>&nbsp;<span class="op" id="4315626">*</span><span class="ident" id="4315627">big</span><span class="op" id="4315630">.</span><span class="ident" id="4315631">Int</span><span class="op" id="4315634">,</span>&nbsp;<span class="ident" id="4315636">err</span>&nbsp;<span class="builtintype" id="4315640">error</span><span class="op" id="4315645">)</span>&nbsp;<span class="op" id="4315647">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4315650">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315679">n</span>&nbsp;<span class="op" id="4315681">:=</span>&nbsp;<span class="ident" id="4315684">priv</span><span class="op" id="4315688">.</span><span class="ident" id="4315689">Q</span><span class="op" id="4315690">.</span><span class="ident" id="4315691">BitLen</span><span class="op" id="4315697">(</span><span class="op" id="4315698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315701">if</span>&nbsp;<span class="ident" id="4315704">n</span><span class="op" id="4315705">&amp;</span><span class="num" id="4315706">7</span>&nbsp;<span class="op" id="4315708">!=</span>&nbsp;<span class="num" id="4315711">0</span>&nbsp;<span class="op" id="4315713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315717">err</span>&nbsp;<span class="op" id="4315721">=</span>&nbsp;<span class="ident" id="4315723">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315745">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4315753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315756">n</span>&nbsp;<span class="op" id="4315758">&gt;&gt;=</span>&nbsp;<span class="num" id="4315762">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315766">for</span>&nbsp;<span class="op" id="4315770">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315774">k</span>&nbsp;<span class="op" id="4315776">:=</span>&nbsp;<span class="builtinfunc" id="4315779">new</span><span class="op" id="4315782">(</span><span class="ident" id="4315783">big</span><span class="op" id="4315786">.</span><span class="ident" id="4315787">Int</span><span class="op" id="4315790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315794">buf</span>&nbsp;<span class="op" id="4315798">:=</span>&nbsp;<span class="builtinfunc" id="4315801">make</span><span class="op" id="4315805">(</span><span class="op" id="4315806">[</span><span class="op" id="4315807">]</span><span class="builtintype" id="4315808">byte</span><span class="op" id="4315812">,</span>&nbsp;<span class="ident" id="4315814">n</span><span class="op" id="4315815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315819">for</span>&nbsp;<span class="op" id="4315823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315828">_</span><span class="op" id="4315829">,</span>&nbsp;<span class="ident" id="4315831">err</span>&nbsp;<span class="op" id="4315835">=</span>&nbsp;<span class="ident" id="4315837">io</span><span class="op" id="4315839">.</span><span class="ident" id="4315840">ReadFull</span><span class="op" id="4315848">(</span><span class="ident" id="4315849">rand</span><span class="op" id="4315853">,</span>&nbsp;<span class="ident" id="4315855">buf</span><span class="op" id="4315858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315863">if</span>&nbsp;<span class="ident" id="4315866">err</span>&nbsp;<span class="op" id="4315870">!=</span>&nbsp;<span class="ident" id="4315873">nil</span>&nbsp;<span class="op" id="4315877">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315883">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4315893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315898">k</span><span class="op" id="4315899">.</span><span class="ident" id="4315900">SetBytes</span><span class="op" id="4315908">(</span><span class="ident" id="4315909">buf</span><span class="op" id="4315912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315917">if</span>&nbsp;<span class="ident" id="4315920">k</span><span class="op" id="4315921">.</span><span class="ident" id="4315922">Sign</span><span class="op" id="4315926">(</span><span class="op" id="4315927">)</span>&nbsp;<span class="op" id="4315929">&gt;</span>&nbsp;<span class="num" id="4315931">0</span>&nbsp;<span class="op" id="4315933">&amp;&amp;</span>&nbsp;<span class="ident" id="4315936">k</span><span class="op" id="4315937">.</span><span class="ident" id="4315938">Cmp</span><span class="op" id="4315941">(</span><span class="ident" id="4315942">priv</span><span class="op" id="4315946">.</span><span class="ident" id="4315947">Q</span><span class="op" id="4315948">)</span>&nbsp;<span class="op" id="4315950">&lt;</span>&nbsp;<span class="num" id="4315952">0</span>&nbsp;<span class="op" id="4315954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4315960">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4315969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4315973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4315978">kInv</span>&nbsp;<span class="op" id="4315983">:=</span>&nbsp;<span class="ident" id="4315986">fermatInverse</span><span class="op" id="4315999">(</span><span class="ident" id="4316000">k</span><span class="op" id="4316001">,</span>&nbsp;<span class="ident" id="4316003">priv</span><span class="op" id="4316007">.</span><span class="ident" id="4316008">Q</span><span class="op" id="4316009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316014">r</span>&nbsp;<span class="op" id="4316016">=</span>&nbsp;<span class="builtinfunc" id="4316018">new</span><span class="op" id="4316021">(</span><span class="ident" id="4316022">big</span><span class="op" id="4316025">.</span><span class="ident" id="4316026">Int</span><span class="op" id="4316029">)</span><span class="op" id="4316030">.</span><span class="ident" id="4316031">Exp</span><span class="op" id="4316034">(</span><span class="ident" id="4316035">priv</span><span class="op" id="4316039">.</span><span class="ident" id="4316040">G</span><span class="op" id="4316041">,</span>&nbsp;<span class="ident" id="4316043">k</span><span class="op" id="4316044">,</span>&nbsp;<span class="ident" id="4316046">priv</span><span class="op" id="4316050">.</span><span class="ident" id="4316051">P</span><span class="op" id="4316052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316056">r</span><span class="op" id="4316057">.</span><span class="ident" id="4316058">Mod</span><span class="op" id="4316061">(</span><span class="ident" id="4316062">r</span><span class="op" id="4316063">,</span>&nbsp;<span class="ident" id="4316065">priv</span><span class="op" id="4316069">.</span><span class="ident" id="4316070">Q</span><span class="op" id="4316071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316076">if</span>&nbsp;<span class="ident" id="4316079">r</span><span class="op" id="4316080">.</span><span class="ident" id="4316081">Sign</span><span class="op" id="4316085">(</span><span class="op" id="4316086">)</span>&nbsp;<span class="op" id="4316088">==</span>&nbsp;<span class="num" id="4316091">0</span>&nbsp;<span class="op" id="4316093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316098">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316114">z</span>&nbsp;<span class="op" id="4316116">:=</span>&nbsp;<span class="ident" id="4316119">k</span><span class="op" id="4316120">.</span><span class="ident" id="4316121">SetBytes</span><span class="op" id="4316129">(</span><span class="ident" id="4316130">hash</span><span class="op" id="4316134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316139">s</span>&nbsp;<span class="op" id="4316141">=</span>&nbsp;<span class="builtinfunc" id="4316143">new</span><span class="op" id="4316146">(</span><span class="ident" id="4316147">big</span><span class="op" id="4316150">.</span><span class="ident" id="4316151">Int</span><span class="op" id="4316154">)</span><span class="op" id="4316155">.</span><span class="ident" id="4316156">Mul</span><span class="op" id="4316159">(</span><span class="ident" id="4316160">priv</span><span class="op" id="4316164">.</span><span class="ident" id="4316165">X</span><span class="op" id="4316166">,</span>&nbsp;<span class="ident" id="4316168">r</span><span class="op" id="4316169">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316173">s</span><span class="op" id="4316174">.</span><span class="ident" id="4316175">Add</span><span class="op" id="4316178">(</span><span class="ident" id="4316179">s</span><span class="op" id="4316180">,</span>&nbsp;<span class="ident" id="4316182">z</span><span class="op" id="4316183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316187">s</span><span class="op" id="4316188">.</span><span class="ident" id="4316189">Mod</span><span class="op" id="4316192">(</span><span class="ident" id="4316193">s</span><span class="op" id="4316194">,</span>&nbsp;<span class="ident" id="4316196">priv</span><span class="op" id="4316200">.</span><span class="ident" id="4316201">Q</span><span class="op" id="4316202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316206">s</span><span class="op" id="4316207">.</span><span class="ident" id="4316208">Mul</span><span class="op" id="4316211">(</span><span class="ident" id="4316212">s</span><span class="op" id="4316213">,</span>&nbsp;<span class="ident" id="4316215">kInv</span><span class="op" id="4316219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316223">s</span><span class="op" id="4316224">.</span><span class="ident" id="4316225">Mod</span><span class="op" id="4316228">(</span><span class="ident" id="4316229">s</span><span class="op" id="4316230">,</span>&nbsp;<span class="ident" id="4316232">priv</span><span class="op" id="4316236">.</span><span class="ident" id="4316237">Q</span><span class="op" id="4316238">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316243">if</span>&nbsp;<span class="ident" id="4316246">s</span><span class="op" id="4316247">.</span><span class="ident" id="4316248">Sign</span><span class="op" id="4316252">(</span><span class="op" id="4316253">)</span>&nbsp;<span class="op" id="4316255">!=</span>&nbsp;<span class="num" id="4316258">0</span>&nbsp;<span class="op" id="4316260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316265">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316280">return</span><br>
<span class="lineno"></span><span class="op" id="4316287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4316290">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4316369">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4316412">//</span><br>
<span class="lineno"></span><span class="comment" id="4316415">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4316495">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4316570">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4316592">func</span>&nbsp;<span class="ident" id="4316597">Verify</span><span class="op" id="4316603">(</span><span class="ident" id="4316604">pub</span>&nbsp;<span class="op" id="4316608">*</span><span class="ident" id="4316609">PublicKey</span><span class="op" id="4316618">,</span>&nbsp;<span class="ident" id="4316620">hash</span>&nbsp;<span class="op" id="4316625">[</span><span class="op" id="4316626">]</span><span class="builtintype" id="4316627">byte</span><span class="op" id="4316631">,</span>&nbsp;<span class="ident" id="4316633">r</span><span class="op" id="4316634">,</span>&nbsp;<span class="ident" id="4316636">s</span>&nbsp;<span class="op" id="4316638">*</span><span class="ident" id="4316639">big</span><span class="op" id="4316642">.</span><span class="ident" id="4316643">Int</span><span class="op" id="4316646">)</span>&nbsp;<span class="builtintype" id="4316648">bool</span>&nbsp;<span class="op" id="4316653">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4316656">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316685">if</span>&nbsp;<span class="ident" id="4316688">r</span><span class="op" id="4316689">.</span><span class="ident" id="4316690">Sign</span><span class="op" id="4316694">(</span><span class="op" id="4316695">)</span>&nbsp;<span class="op" id="4316697">&lt;</span>&nbsp;<span class="num" id="4316699">1</span>&nbsp;<span class="op" id="4316701">||</span>&nbsp;<span class="ident" id="4316704">r</span><span class="op" id="4316705">.</span><span class="ident" id="4316706">Cmp</span><span class="op" id="4316709">(</span><span class="ident" id="4316710">pub</span><span class="op" id="4316713">.</span><span class="ident" id="4316714">Q</span><span class="op" id="4316715">)</span>&nbsp;<span class="op" id="4316717">&gt;=</span>&nbsp;<span class="num" id="4316720">0</span>&nbsp;<span class="op" id="4316722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316726">return</span>&nbsp;<span class="builtintype" id="4316733">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316740">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316743">if</span>&nbsp;<span class="ident" id="4316746">s</span><span class="op" id="4316747">.</span><span class="ident" id="4316748">Sign</span><span class="op" id="4316752">(</span><span class="op" id="4316753">)</span>&nbsp;<span class="op" id="4316755">&lt;</span>&nbsp;<span class="num" id="4316757">1</span>&nbsp;<span class="op" id="4316759">||</span>&nbsp;<span class="ident" id="4316762">s</span><span class="op" id="4316763">.</span><span class="ident" id="4316764">Cmp</span><span class="op" id="4316767">(</span><span class="ident" id="4316768">pub</span><span class="op" id="4316771">.</span><span class="ident" id="4316772">Q</span><span class="op" id="4316773">)</span>&nbsp;<span class="op" id="4316775">&gt;=</span>&nbsp;<span class="num" id="4316778">0</span>&nbsp;<span class="op" id="4316780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316784">return</span>&nbsp;<span class="builtintype" id="4316791">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316802">w</span>&nbsp;<span class="op" id="4316804">:=</span>&nbsp;<span class="builtinfunc" id="4316807">new</span><span class="op" id="4316810">(</span><span class="ident" id="4316811">big</span><span class="op" id="4316814">.</span><span class="ident" id="4316815">Int</span><span class="op" id="4316818">)</span><span class="op" id="4316819">.</span><span class="ident" id="4316820">ModInverse</span><span class="op" id="4316830">(</span><span class="ident" id="4316831">s</span><span class="op" id="4316832">,</span>&nbsp;<span class="ident" id="4316834">pub</span><span class="op" id="4316837">.</span><span class="ident" id="4316838">Q</span><span class="op" id="4316839">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316843">n</span>&nbsp;<span class="op" id="4316845">:=</span>&nbsp;<span class="ident" id="4316848">pub</span><span class="op" id="4316851">.</span><span class="ident" id="4316852">Q</span><span class="op" id="4316853">.</span><span class="ident" id="4316854">BitLen</span><span class="op" id="4316860">(</span><span class="op" id="4316861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316864">if</span>&nbsp;<span class="ident" id="4316867">n</span><span class="op" id="4316868">&amp;</span><span class="num" id="4316869">7</span>&nbsp;<span class="op" id="4316871">!=</span>&nbsp;<span class="num" id="4316874">0</span>&nbsp;<span class="op" id="4316876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4316880">return</span>&nbsp;<span class="builtintype" id="4316887">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4316894">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316897">z</span>&nbsp;<span class="op" id="4316899">:=</span>&nbsp;<span class="builtinfunc" id="4316902">new</span><span class="op" id="4316905">(</span><span class="ident" id="4316906">big</span><span class="op" id="4316909">.</span><span class="ident" id="4316910">Int</span><span class="op" id="4316913">)</span><span class="op" id="4316914">.</span><span class="ident" id="4316915">SetBytes</span><span class="op" id="4316923">(</span><span class="ident" id="4316924">hash</span><span class="op" id="4316928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316932">u1</span>&nbsp;<span class="op" id="4316935">:=</span>&nbsp;<span class="builtinfunc" id="4316938">new</span><span class="op" id="4316941">(</span><span class="ident" id="4316942">big</span><span class="op" id="4316945">.</span><span class="ident" id="4316946">Int</span><span class="op" id="4316949">)</span><span class="op" id="4316950">.</span><span class="ident" id="4316951">Mul</span><span class="op" id="4316954">(</span><span class="ident" id="4316955">z</span><span class="op" id="4316956">,</span>&nbsp;<span class="ident" id="4316958">w</span><span class="op" id="4316959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316962">u1</span><span class="op" id="4316964">.</span><span class="ident" id="4316965">Mod</span><span class="op" id="4316968">(</span><span class="ident" id="4316969">u1</span><span class="op" id="4316971">,</span>&nbsp;<span class="ident" id="4316973">pub</span><span class="op" id="4316976">.</span><span class="ident" id="4316977">Q</span><span class="op" id="4316978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4316981">u2</span>&nbsp;<span class="op" id="4316984">:=</span>&nbsp;<span class="ident" id="4316987">w</span><span class="op" id="4316988">.</span><span class="ident" id="4316989">Mul</span><span class="op" id="4316992">(</span><span class="ident" id="4316993">r</span><span class="op" id="4316994">,</span>&nbsp;<span class="ident" id="4316996">w</span><span class="op" id="4316997">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317000">u2</span><span class="op" id="4317002">.</span><span class="ident" id="4317003">Mod</span><span class="op" id="4317006">(</span><span class="ident" id="4317007">u2</span><span class="op" id="4317009">,</span>&nbsp;<span class="ident" id="4317011">pub</span><span class="op" id="4317014">.</span><span class="ident" id="4317015">Q</span><span class="op" id="4317016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317019">v</span>&nbsp;<span class="op" id="4317021">:=</span>&nbsp;<span class="ident" id="4317024">u1</span><span class="op" id="4317026">.</span><span class="ident" id="4317027">Exp</span><span class="op" id="4317030">(</span><span class="ident" id="4317031">pub</span><span class="op" id="4317034">.</span><span class="ident" id="4317035">G</span><span class="op" id="4317036">,</span>&nbsp;<span class="ident" id="4317038">u1</span><span class="op" id="4317040">,</span>&nbsp;<span class="ident" id="4317042">pub</span><span class="op" id="4317045">.</span><span class="ident" id="4317046">P</span><span class="op" id="4317047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317050">u2</span><span class="op" id="4317052">.</span><span class="ident" id="4317053">Exp</span><span class="op" id="4317056">(</span><span class="ident" id="4317057">pub</span><span class="op" id="4317060">.</span><span class="ident" id="4317061">Y</span><span class="op" id="4317062">,</span>&nbsp;<span class="ident" id="4317064">u2</span><span class="op" id="4317066">,</span>&nbsp;<span class="ident" id="4317068">pub</span><span class="op" id="4317071">.</span><span class="ident" id="4317072">P</span><span class="op" id="4317073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317076">v</span><span class="op" id="4317077">.</span><span class="ident" id="4317078">Mul</span><span class="op" id="4317081">(</span><span class="ident" id="4317082">v</span><span class="op" id="4317083">,</span>&nbsp;<span class="ident" id="4317085">u2</span><span class="op" id="4317087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317090">v</span><span class="op" id="4317091">.</span><span class="ident" id="4317092">Mod</span><span class="op" id="4317095">(</span><span class="ident" id="4317096">v</span><span class="op" id="4317097">,</span>&nbsp;<span class="ident" id="4317099">pub</span><span class="op" id="4317102">.</span><span class="ident" id="4317103">P</span><span class="op" id="4317104">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4317107">v</span><span class="op" id="4317108">.</span><span class="ident" id="4317109">Mod</span><span class="op" id="4317112">(</span><span class="ident" id="4317113">v</span><span class="op" id="4317114">,</span>&nbsp;<span class="ident" id="4317116">pub</span><span class="op" id="4317119">.</span><span class="ident" id="4317120">Q</span><span class="op" id="4317121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4317125">return</span>&nbsp;<span class="ident" id="4317132">v</span><span class="op" id="4317133">.</span><span class="ident" id="4317134">Cmp</span><span class="op" id="4317137">(</span><span class="ident" id="4317138">r</span><span class="op" id="4317139">)</span>&nbsp;<span class="op" id="4317141">==</span>&nbsp;<span class="num" id="4317144">0</span><br>
<span class="lineno"></span><span class="op" id="4317146">}</span>
</div>
</body>
</html>
