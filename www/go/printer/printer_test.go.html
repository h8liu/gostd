<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7090518">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7090573">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7090627">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7090678">package</span>&nbsp;<span class="ident" id="7090686">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090695">import</span>&nbsp;<span class="op" id="7090702">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090705">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090714">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090724">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090732">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090739">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090749">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090762">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090774">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090787">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090804">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7090815">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7090822">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7090825">const</span>&nbsp;<span class="op" id="7090831">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090834">dataDir</span>&nbsp;&nbsp;<span class="op" id="7090843">=</span>&nbsp;<span class="string" id="7090845">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090857">tabwidth</span>&nbsp;<span class="op" id="7090866">=</span>&nbsp;<span class="num" id="7090868">8</span><br>
<span class="lineno"></span><span class="op" id="7090870">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7090873">var</span>&nbsp;<span class="ident" id="7090877">update</span>&nbsp;<span class="op" id="7090884">=</span>&nbsp;<span class="ident" id="7090886">flag</span><span class="op" id="7090890">.</span><span class="ident" id="7090891">Bool</span><span class="op" id="7090895">(</span><span class="string" id="7090896">&#34;update&#34;</span><span class="op" id="7090904">,</span>&nbsp;<span class="ident" id="7090906">false</span><span class="op" id="7090911">,</span>&nbsp;<span class="string" id="7090913">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7090934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090937">var</span>&nbsp;<span class="ident" id="7090941">fset</span>&nbsp;<span class="op" id="7090946">=</span>&nbsp;<span class="ident" id="7090948">token</span><span class="op" id="7090953">.</span><span class="ident" id="7090954">NewFileSet</span><span class="op" id="7090964">(</span><span class="op" id="7090965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7090968">type</span>&nbsp;<span class="ident" id="7090973">checkMode</span>&nbsp;<span class="builtintype" id="7090983">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090989">const</span>&nbsp;<span class="op" id="7090995">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090998">export</span>&nbsp;<span class="ident" id="7091005">checkMode</span>&nbsp;<span class="op" id="7091015">=</span>&nbsp;<span class="num" id="7091017">1</span>&nbsp;<span class="op" id="7091019">&lt;&lt;</span>&nbsp;<span class="ident" id="7091022">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091028">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091039">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7091050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7091053">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7091128">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7091203">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7091214">func</span>&nbsp;<span class="ident" id="7091219">format</span><span class="op" id="7091225">(</span><span class="ident" id="7091226">src</span>&nbsp;<span class="op" id="7091230">[</span><span class="op" id="7091231">]</span><span class="builtintype" id="7091232">byte</span><span class="op" id="7091236">,</span>&nbsp;<span class="ident" id="7091238">mode</span>&nbsp;<span class="ident" id="7091243">checkMode</span><span class="op" id="7091252">)</span>&nbsp;<span class="op" id="7091254">(</span><span class="op" id="7091255">[</span><span class="op" id="7091256">]</span><span class="builtintype" id="7091257">byte</span><span class="op" id="7091261">,</span>&nbsp;<span class="builtintype" id="7091263">error</span><span class="op" id="7091268">)</span>&nbsp;<span class="op" id="7091270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7091273">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091287">f</span><span class="op" id="7091288">,</span>&nbsp;<span class="ident" id="7091290">err</span>&nbsp;<span class="op" id="7091294">:=</span>&nbsp;<span class="ident" id="7091297">parser</span><span class="op" id="7091303">.</span><span class="ident" id="7091304">ParseFile</span><span class="op" id="7091313">(</span><span class="ident" id="7091314">fset</span><span class="op" id="7091318">,</span>&nbsp;<span class="string" id="7091320">&#34;&#34;</span><span class="op" id="7091322">,</span>&nbsp;<span class="ident" id="7091324">src</span><span class="op" id="7091327">,</span>&nbsp;<span class="ident" id="7091329">parser</span><span class="op" id="7091335">.</span><span class="ident" id="7091336">ParseComments</span><span class="op" id="7091349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091352">if</span>&nbsp;<span class="ident" id="7091355">err</span>&nbsp;<span class="op" id="7091359">!=</span>&nbsp;<span class="ident" id="7091362">nil</span>&nbsp;<span class="op" id="7091366">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091370">return</span>&nbsp;<span class="ident" id="7091377">nil</span><span class="op" id="7091380">,</span>&nbsp;<span class="ident" id="7091382">fmt</span><span class="op" id="7091385">.</span><span class="ident" id="7091386">Errorf</span><span class="op" id="7091392">(</span><span class="string" id="7091393">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7091408">,</span>&nbsp;<span class="ident" id="7091410">err</span><span class="op" id="7091413">,</span>&nbsp;<span class="ident" id="7091415">src</span><span class="op" id="7091418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7091425">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091457">if</span>&nbsp;<span class="ident" id="7091460">mode</span><span class="op" id="7091464">&amp;</span><span class="ident" id="7091465">export</span>&nbsp;<span class="op" id="7091472">!=</span>&nbsp;<span class="num" id="7091475">0</span>&nbsp;<span class="op" id="7091477">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091481">ast</span><span class="op" id="7091484">.</span><span class="ident" id="7091485">FileExports</span><span class="op" id="7091496">(</span><span class="ident" id="7091497">f</span><span class="op" id="7091498">)</span>&nbsp;<span class="comment" id="7091500">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091519">f</span><span class="op" id="7091520">.</span><span class="ident" id="7091521">Comments</span>&nbsp;<span class="op" id="7091530">=</span>&nbsp;<span class="ident" id="7091532">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7091538">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7091587">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091623">cfg</span>&nbsp;<span class="op" id="7091627">:=</span>&nbsp;<span class="ident" id="7091630">Config</span><span class="op" id="7091636">{</span><span class="ident" id="7091637">Tabwidth</span><span class="op" id="7091645">:</span>&nbsp;<span class="ident" id="7091647">tabwidth</span><span class="op" id="7091655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091658">if</span>&nbsp;<span class="ident" id="7091661">mode</span><span class="op" id="7091665">&amp;</span><span class="ident" id="7091666">rawFormat</span>&nbsp;<span class="op" id="7091676">!=</span>&nbsp;<span class="num" id="7091679">0</span>&nbsp;<span class="op" id="7091681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091685">cfg</span><span class="op" id="7091688">.</span><span class="ident" id="7091689">Mode</span>&nbsp;<span class="op" id="7091694">|=</span>&nbsp;<span class="ident" id="7091697">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7091712">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091726">var</span>&nbsp;<span class="ident" id="7091730">buf</span>&nbsp;<span class="ident" id="7091734">bytes</span><span class="op" id="7091739">.</span><span class="ident" id="7091740">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091748">if</span>&nbsp;<span class="ident" id="7091751">err</span>&nbsp;<span class="op" id="7091755">:=</span>&nbsp;<span class="ident" id="7091758">cfg</span><span class="op" id="7091761">.</span><span class="ident" id="7091762">Fprint</span><span class="op" id="7091768">(</span><span class="op" id="7091769">&amp;</span><span class="ident" id="7091770">buf</span><span class="op" id="7091773">,</span>&nbsp;<span class="ident" id="7091775">fset</span><span class="op" id="7091779">,</span>&nbsp;<span class="ident" id="7091781">f</span><span class="op" id="7091782">)</span><span class="op" id="7091783">;</span>&nbsp;<span class="ident" id="7091785">err</span>&nbsp;<span class="op" id="7091789">!=</span>&nbsp;<span class="ident" id="7091792">nil</span>&nbsp;<span class="op" id="7091796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091800">return</span>&nbsp;<span class="ident" id="7091807">nil</span><span class="op" id="7091810">,</span>&nbsp;<span class="ident" id="7091812">fmt</span><span class="op" id="7091815">.</span><span class="ident" id="7091816">Errorf</span><span class="op" id="7091822">(</span><span class="string" id="7091823">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7091834">,</span>&nbsp;<span class="ident" id="7091836">err</span><span class="op" id="7091839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091842">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7091846">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091902">res</span>&nbsp;<span class="op" id="7091906">:=</span>&nbsp;<span class="ident" id="7091909">buf</span><span class="op" id="7091912">.</span><span class="ident" id="7091913">Bytes</span><span class="op" id="7091918">(</span><span class="op" id="7091919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091922">if</span>&nbsp;<span class="ident" id="7091925">_</span><span class="op" id="7091926">,</span>&nbsp;<span class="ident" id="7091928">err</span>&nbsp;<span class="op" id="7091932">:=</span>&nbsp;<span class="ident" id="7091935">parser</span><span class="op" id="7091941">.</span><span class="ident" id="7091942">ParseFile</span><span class="op" id="7091951">(</span><span class="ident" id="7091952">fset</span><span class="op" id="7091956">,</span>&nbsp;<span class="string" id="7091958">&#34;&#34;</span><span class="op" id="7091960">,</span>&nbsp;<span class="ident" id="7091962">res</span><span class="op" id="7091965">,</span>&nbsp;<span class="num" id="7091967">0</span><span class="op" id="7091968">)</span><span class="op" id="7091969">;</span>&nbsp;<span class="ident" id="7091971">err</span>&nbsp;<span class="op" id="7091975">!=</span>&nbsp;<span class="ident" id="7091978">nil</span>&nbsp;<span class="op" id="7091982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091986">return</span>&nbsp;<span class="ident" id="7091993">nil</span><span class="op" id="7091996">,</span>&nbsp;<span class="ident" id="7091998">fmt</span><span class="op" id="7092001">.</span><span class="ident" id="7092002">Errorf</span><span class="op" id="7092008">(</span><span class="string" id="7092009">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7092027">,</span>&nbsp;<span class="ident" id="7092029">err</span><span class="op" id="7092032">,</span>&nbsp;<span class="ident" id="7092034">buf</span><span class="op" id="7092037">.</span><span class="ident" id="7092038">Bytes</span><span class="op" id="7092043">(</span><span class="op" id="7092044">)</span><span class="op" id="7092045">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092052">return</span>&nbsp;<span class="ident" id="7092059">res</span><span class="op" id="7092062">,</span>&nbsp;<span class="ident" id="7092064">nil</span><br>
<span class="lineno"></span><span class="op" id="7092068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7092071">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7092131">func</span>&nbsp;<span class="ident" id="7092136">lineAt</span><span class="op" id="7092142">(</span><span class="ident" id="7092143">text</span>&nbsp;<span class="op" id="7092148">[</span><span class="op" id="7092149">]</span><span class="builtintype" id="7092150">byte</span><span class="op" id="7092154">,</span>&nbsp;<span class="ident" id="7092156">offs</span>&nbsp;<span class="builtintype" id="7092161">int</span><span class="op" id="7092164">)</span>&nbsp;<span class="op" id="7092166">[</span><span class="op" id="7092167">]</span><span class="builtintype" id="7092168">byte</span>&nbsp;<span class="op" id="7092173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092176">i</span>&nbsp;<span class="op" id="7092178">:=</span>&nbsp;<span class="ident" id="7092181">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092187">for</span>&nbsp;<span class="ident" id="7092191">i</span>&nbsp;<span class="op" id="7092193">&lt;</span>&nbsp;<span class="builtinfunc" id="7092195">len</span><span class="op" id="7092198">(</span><span class="ident" id="7092199">text</span><span class="op" id="7092203">)</span>&nbsp;<span class="op" id="7092205">&amp;&amp;</span>&nbsp;<span class="ident" id="7092208">text</span><span class="op" id="7092212">[</span><span class="ident" id="7092213">i</span><span class="op" id="7092214">]</span>&nbsp;<span class="op" id="7092216">!=</span>&nbsp;<span class="string" id="7092219">&#39;\n&#39;</span>&nbsp;<span class="op" id="7092224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092228">i</span><span class="op" id="7092229">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092236">return</span>&nbsp;<span class="ident" id="7092243">text</span><span class="op" id="7092247">[</span><span class="ident" id="7092248">offs</span><span class="op" id="7092252">:</span><span class="ident" id="7092253">i</span><span class="op" id="7092254">]</span><br>
<span class="lineno"></span><span class="op" id="7092256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7092259">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7092285">func</span>&nbsp;<span class="ident" id="7092290">diff</span><span class="op" id="7092294">(</span><span class="ident" id="7092295">aname</span><span class="op" id="7092300">,</span>&nbsp;<span class="ident" id="7092302">bname</span>&nbsp;<span class="builtintype" id="7092308">string</span><span class="op" id="7092314">,</span>&nbsp;<span class="ident" id="7092316">a</span><span class="op" id="7092317">,</span>&nbsp;<span class="ident" id="7092319">b</span>&nbsp;<span class="op" id="7092321">[</span><span class="op" id="7092322">]</span><span class="builtintype" id="7092323">byte</span><span class="op" id="7092327">)</span>&nbsp;<span class="builtintype" id="7092329">error</span>&nbsp;<span class="op" id="7092335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092338">var</span>&nbsp;<span class="ident" id="7092342">buf</span>&nbsp;<span class="ident" id="7092346">bytes</span><span class="op" id="7092351">.</span><span class="ident" id="7092352">Buffer</span>&nbsp;<span class="comment" id="7092359">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7092391">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092411">if</span>&nbsp;<span class="builtinfunc" id="7092414">len</span><span class="op" id="7092417">(</span><span class="ident" id="7092418">a</span><span class="op" id="7092419">)</span>&nbsp;<span class="op" id="7092421">!=</span>&nbsp;<span class="builtinfunc" id="7092424">len</span><span class="op" id="7092427">(</span><span class="ident" id="7092428">b</span><span class="op" id="7092429">)</span>&nbsp;<span class="op" id="7092431">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092435">fmt</span><span class="op" id="7092438">.</span><span class="ident" id="7092439">Fprintf</span><span class="op" id="7092446">(</span><span class="op" id="7092447">&amp;</span><span class="ident" id="7092448">buf</span><span class="op" id="7092451">,</span>&nbsp;<span class="string" id="7092453">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7092499">,</span>&nbsp;<span class="ident" id="7092501">aname</span><span class="op" id="7092506">,</span>&nbsp;<span class="builtinfunc" id="7092508">len</span><span class="op" id="7092511">(</span><span class="ident" id="7092512">a</span><span class="op" id="7092513">)</span><span class="op" id="7092514">,</span>&nbsp;<span class="ident" id="7092516">bname</span><span class="op" id="7092521">,</span>&nbsp;<span class="builtinfunc" id="7092523">len</span><span class="op" id="7092526">(</span><span class="ident" id="7092527">b</span><span class="op" id="7092528">)</span><span class="op" id="7092529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7092536">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092557">line</span>&nbsp;<span class="op" id="7092562">:=</span>&nbsp;<span class="num" id="7092565">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092568">offs</span>&nbsp;<span class="op" id="7092573">:=</span>&nbsp;<span class="num" id="7092576">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092579">for</span>&nbsp;<span class="ident" id="7092583">i</span>&nbsp;<span class="op" id="7092585">:=</span>&nbsp;<span class="num" id="7092588">0</span><span class="op" id="7092589">;</span>&nbsp;<span class="ident" id="7092591">i</span>&nbsp;<span class="op" id="7092593">&lt;</span>&nbsp;<span class="builtinfunc" id="7092595">len</span><span class="op" id="7092598">(</span><span class="ident" id="7092599">a</span><span class="op" id="7092600">)</span>&nbsp;<span class="op" id="7092602">&amp;&amp;</span>&nbsp;<span class="ident" id="7092605">i</span>&nbsp;<span class="op" id="7092607">&lt;</span>&nbsp;<span class="builtinfunc" id="7092609">len</span><span class="op" id="7092612">(</span><span class="ident" id="7092613">b</span><span class="op" id="7092614">)</span><span class="op" id="7092615">;</span>&nbsp;<span class="ident" id="7092617">i</span><span class="op" id="7092618">++</span>&nbsp;<span class="op" id="7092621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092625">ch</span>&nbsp;<span class="op" id="7092628">:=</span>&nbsp;<span class="ident" id="7092631">a</span><span class="op" id="7092632">[</span><span class="ident" id="7092633">i</span><span class="op" id="7092634">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092638">if</span>&nbsp;<span class="ident" id="7092641">ch</span>&nbsp;<span class="op" id="7092644">!=</span>&nbsp;<span class="ident" id="7092647">b</span><span class="op" id="7092648">[</span><span class="ident" id="7092649">i</span><span class="op" id="7092650">]</span>&nbsp;<span class="op" id="7092652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092657">fmt</span><span class="op" id="7092660">.</span><span class="ident" id="7092661">Fprintf</span><span class="op" id="7092668">(</span><span class="op" id="7092669">&amp;</span><span class="ident" id="7092670">buf</span><span class="op" id="7092673">,</span>&nbsp;<span class="string" id="7092675">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7092691">,</span>&nbsp;<span class="ident" id="7092693">aname</span><span class="op" id="7092698">,</span>&nbsp;<span class="ident" id="7092700">line</span><span class="op" id="7092704">,</span>&nbsp;<span class="ident" id="7092706">i</span><span class="op" id="7092707">-</span><span class="ident" id="7092708">offs</span><span class="op" id="7092712">+</span><span class="num" id="7092713">1</span><span class="op" id="7092714">,</span>&nbsp;<span class="ident" id="7092716">lineAt</span><span class="op" id="7092722">(</span><span class="ident" id="7092723">a</span><span class="op" id="7092724">,</span>&nbsp;<span class="ident" id="7092726">offs</span><span class="op" id="7092730">)</span><span class="op" id="7092731">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092736">fmt</span><span class="op" id="7092739">.</span><span class="ident" id="7092740">Fprintf</span><span class="op" id="7092747">(</span><span class="op" id="7092748">&amp;</span><span class="ident" id="7092749">buf</span><span class="op" id="7092752">,</span>&nbsp;<span class="string" id="7092754">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7092770">,</span>&nbsp;<span class="ident" id="7092772">bname</span><span class="op" id="7092777">,</span>&nbsp;<span class="ident" id="7092779">line</span><span class="op" id="7092783">,</span>&nbsp;<span class="ident" id="7092785">i</span><span class="op" id="7092786">-</span><span class="ident" id="7092787">offs</span><span class="op" id="7092791">+</span><span class="num" id="7092792">1</span><span class="op" id="7092793">,</span>&nbsp;<span class="ident" id="7092795">lineAt</span><span class="op" id="7092801">(</span><span class="ident" id="7092802">b</span><span class="op" id="7092803">,</span>&nbsp;<span class="ident" id="7092805">offs</span><span class="op" id="7092809">)</span><span class="op" id="7092810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092815">fmt</span><span class="op" id="7092818">.</span><span class="ident" id="7092819">Fprintf</span><span class="op" id="7092826">(</span><span class="op" id="7092827">&amp;</span><span class="ident" id="7092828">buf</span><span class="op" id="7092831">,</span>&nbsp;<span class="string" id="7092833">&#34;\n\n&#34;</span><span class="op" id="7092839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092844">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092856">if</span>&nbsp;<span class="ident" id="7092859">ch</span>&nbsp;<span class="op" id="7092862">==</span>&nbsp;<span class="string" id="7092865">&#39;\n&#39;</span>&nbsp;<span class="op" id="7092870">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092875">line</span><span class="op" id="7092879">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092885">offs</span>&nbsp;<span class="op" id="7092890">=</span>&nbsp;<span class="ident" id="7092892">i</span>&nbsp;<span class="op" id="7092894">+</span>&nbsp;<span class="num" id="7092896">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092907">if</span>&nbsp;<span class="ident" id="7092910">buf</span><span class="op" id="7092913">.</span><span class="ident" id="7092914">Len</span><span class="op" id="7092917">(</span><span class="op" id="7092918">)</span>&nbsp;<span class="op" id="7092920">&gt;</span>&nbsp;<span class="num" id="7092922">0</span>&nbsp;<span class="op" id="7092924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092928">return</span>&nbsp;<span class="ident" id="7092935">errors</span><span class="op" id="7092941">.</span><span class="ident" id="7092942">New</span><span class="op" id="7092945">(</span><span class="ident" id="7092946">buf</span><span class="op" id="7092949">.</span><span class="ident" id="7092950">String</span><span class="op" id="7092956">(</span><span class="op" id="7092957">)</span><span class="op" id="7092958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092964">return</span>&nbsp;<span class="ident" id="7092971">nil</span><br>
<span class="lineno"></span><span class="op" id="7092975">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7092978">func</span>&nbsp;<span class="ident" id="7092983">runcheck</span><span class="op" id="7092991">(</span><span class="ident" id="7092992">t</span>&nbsp;<span class="op" id="7092994">*</span><span class="ident" id="7092995">testing</span><span class="op" id="7093002">.</span><span class="ident" id="7093003">T</span><span class="op" id="7093004">,</span>&nbsp;<span class="ident" id="7093006">source</span><span class="op" id="7093012">,</span>&nbsp;<span class="ident" id="7093014">golden</span>&nbsp;<span class="builtintype" id="7093021">string</span><span class="op" id="7093027">,</span>&nbsp;<span class="ident" id="7093029">mode</span>&nbsp;<span class="ident" id="7093034">checkMode</span><span class="op" id="7093043">)</span>&nbsp;<span class="op" id="7093045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093048">src</span><span class="op" id="7093051">,</span>&nbsp;<span class="ident" id="7093053">err</span>&nbsp;<span class="op" id="7093057">:=</span>&nbsp;<span class="ident" id="7093060">ioutil</span><span class="op" id="7093066">.</span><span class="ident" id="7093067">ReadFile</span><span class="op" id="7093075">(</span><span class="ident" id="7093076">source</span><span class="op" id="7093082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093085">if</span>&nbsp;<span class="ident" id="7093088">err</span>&nbsp;<span class="op" id="7093092">!=</span>&nbsp;<span class="ident" id="7093095">nil</span>&nbsp;<span class="op" id="7093099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093103">t</span><span class="op" id="7093104">.</span><span class="ident" id="7093105">Error</span><span class="op" id="7093110">(</span><span class="ident" id="7093111">err</span><span class="op" id="7093114">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093118">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093130">res</span><span class="op" id="7093133">,</span>&nbsp;<span class="ident" id="7093135">err</span>&nbsp;<span class="op" id="7093139">:=</span>&nbsp;<span class="ident" id="7093142">format</span><span class="op" id="7093148">(</span><span class="ident" id="7093149">src</span><span class="op" id="7093152">,</span>&nbsp;<span class="ident" id="7093154">mode</span><span class="op" id="7093158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093161">if</span>&nbsp;<span class="ident" id="7093164">err</span>&nbsp;<span class="op" id="7093168">!=</span>&nbsp;<span class="ident" id="7093171">nil</span>&nbsp;<span class="op" id="7093175">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093179">t</span><span class="op" id="7093180">.</span><span class="ident" id="7093181">Error</span><span class="op" id="7093186">(</span><span class="ident" id="7093187">err</span><span class="op" id="7093190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093194">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093206">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093243">if</span>&nbsp;<span class="op" id="7093246">*</span><span class="ident" id="7093247">update</span>&nbsp;<span class="op" id="7093254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093258">if</span>&nbsp;<span class="ident" id="7093261">err</span>&nbsp;<span class="op" id="7093265">:=</span>&nbsp;<span class="ident" id="7093268">ioutil</span><span class="op" id="7093274">.</span><span class="ident" id="7093275">WriteFile</span><span class="op" id="7093284">(</span><span class="ident" id="7093285">golden</span><span class="op" id="7093291">,</span>&nbsp;<span class="ident" id="7093293">res</span><span class="op" id="7093296">,</span>&nbsp;<span class="num" id="7093298">0644</span><span class="op" id="7093302">)</span><span class="op" id="7093303">;</span>&nbsp;<span class="ident" id="7093305">err</span>&nbsp;<span class="op" id="7093309">!=</span>&nbsp;<span class="ident" id="7093312">nil</span>&nbsp;<span class="op" id="7093316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093321">t</span><span class="op" id="7093322">.</span><span class="ident" id="7093323">Error</span><span class="op" id="7093328">(</span><span class="ident" id="7093329">err</span><span class="op" id="7093332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093340">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093352">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093367">gld</span><span class="op" id="7093370">,</span>&nbsp;<span class="ident" id="7093372">err</span>&nbsp;<span class="op" id="7093376">:=</span>&nbsp;<span class="ident" id="7093379">ioutil</span><span class="op" id="7093385">.</span><span class="ident" id="7093386">ReadFile</span><span class="op" id="7093394">(</span><span class="ident" id="7093395">golden</span><span class="op" id="7093401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093404">if</span>&nbsp;<span class="ident" id="7093407">err</span>&nbsp;<span class="op" id="7093411">!=</span>&nbsp;<span class="ident" id="7093414">nil</span>&nbsp;<span class="op" id="7093418">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093422">t</span><span class="op" id="7093423">.</span><span class="ident" id="7093424">Error</span><span class="op" id="7093429">(</span><span class="ident" id="7093430">err</span><span class="op" id="7093433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093437">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093449">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093498">if</span>&nbsp;<span class="ident" id="7093501">err</span>&nbsp;<span class="op" id="7093505">:=</span>&nbsp;<span class="ident" id="7093508">diff</span><span class="op" id="7093512">(</span><span class="ident" id="7093513">source</span><span class="op" id="7093519">,</span>&nbsp;<span class="ident" id="7093521">golden</span><span class="op" id="7093527">,</span>&nbsp;<span class="ident" id="7093529">res</span><span class="op" id="7093532">,</span>&nbsp;<span class="ident" id="7093534">gld</span><span class="op" id="7093537">)</span><span class="op" id="7093538">;</span>&nbsp;<span class="ident" id="7093540">err</span>&nbsp;<span class="op" id="7093544">!=</span>&nbsp;<span class="ident" id="7093547">nil</span>&nbsp;<span class="op" id="7093551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093555">t</span><span class="op" id="7093556">.</span><span class="ident" id="7093557">Error</span><span class="op" id="7093562">(</span><span class="ident" id="7093563">err</span><span class="op" id="7093566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093570">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093582">if</span>&nbsp;<span class="ident" id="7093585">mode</span><span class="op" id="7093589">&amp;</span><span class="ident" id="7093590">idempotent</span>&nbsp;<span class="op" id="7093601">!=</span>&nbsp;<span class="num" id="7093604">0</span>&nbsp;<span class="op" id="7093606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093610">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093652">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093715">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093777">res</span><span class="op" id="7093780">,</span>&nbsp;<span class="ident" id="7093782">err</span>&nbsp;<span class="op" id="7093786">=</span>&nbsp;<span class="ident" id="7093788">format</span><span class="op" id="7093794">(</span><span class="ident" id="7093795">gld</span><span class="op" id="7093798">,</span>&nbsp;<span class="ident" id="7093800">mode</span><span class="op" id="7093804">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093808">if</span>&nbsp;<span class="ident" id="7093811">err</span>&nbsp;<span class="op" id="7093815">:=</span>&nbsp;<span class="ident" id="7093818">diff</span><span class="op" id="7093822">(</span><span class="ident" id="7093823">golden</span><span class="op" id="7093829">,</span>&nbsp;<span class="ident" id="7093831">fmt</span><span class="op" id="7093834">.</span><span class="ident" id="7093835">Sprintf</span><span class="op" id="7093842">(</span><span class="string" id="7093843">&#34;format(%s)&#34;</span><span class="op" id="7093855">,</span>&nbsp;<span class="ident" id="7093857">golden</span><span class="op" id="7093863">)</span><span class="op" id="7093864">,</span>&nbsp;<span class="ident" id="7093866">gld</span><span class="op" id="7093869">,</span>&nbsp;<span class="ident" id="7093871">res</span><span class="op" id="7093874">)</span><span class="op" id="7093875">;</span>&nbsp;<span class="ident" id="7093877">err</span>&nbsp;<span class="op" id="7093881">!=</span>&nbsp;<span class="ident" id="7093884">nil</span>&nbsp;<span class="op" id="7093888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093893">t</span><span class="op" id="7093894">.</span><span class="ident" id="7093895">Errorf</span><span class="op" id="7093901">(</span><span class="string" id="7093902">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7093932">,</span>&nbsp;<span class="ident" id="7093934">err</span><span class="op" id="7093937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093944">}</span><br>
<span class="lineno"></span><span class="op" id="7093946">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7093949">func</span>&nbsp;<span class="ident" id="7093954">check</span><span class="op" id="7093959">(</span><span class="ident" id="7093960">t</span>&nbsp;<span class="op" id="7093962">*</span><span class="ident" id="7093963">testing</span><span class="op" id="7093970">.</span><span class="ident" id="7093971">T</span><span class="op" id="7093972">,</span>&nbsp;<span class="ident" id="7093974">source</span><span class="op" id="7093980">,</span>&nbsp;<span class="ident" id="7093982">golden</span>&nbsp;<span class="builtintype" id="7093989">string</span><span class="op" id="7093995">,</span>&nbsp;<span class="ident" id="7093997">mode</span>&nbsp;<span class="ident" id="7094002">checkMode</span><span class="op" id="7094011">)</span>&nbsp;<span class="op" id="7094013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094016">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094033">cc</span>&nbsp;<span class="op" id="7094036">:=</span>&nbsp;<span class="builtinfunc" id="7094039">make</span><span class="op" id="7094043">(</span><span class="keyword" id="7094044">chan</span>&nbsp;<span class="builtintype" id="7094049">int</span><span class="op" id="7094052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094055">go</span>&nbsp;<span class="keyword" id="7094058">func</span><span class="op" id="7094062">(</span><span class="op" id="7094063">)</span>&nbsp;<span class="op" id="7094065">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094069">runcheck</span><span class="op" id="7094077">(</span><span class="ident" id="7094078">t</span><span class="op" id="7094079">,</span>&nbsp;<span class="ident" id="7094081">source</span><span class="op" id="7094087">,</span>&nbsp;<span class="ident" id="7094089">golden</span><span class="op" id="7094095">,</span>&nbsp;<span class="ident" id="7094097">mode</span><span class="op" id="7094101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094105">cc</span>&nbsp;<span class="op" id="7094108">&lt;-</span>&nbsp;<span class="num" id="7094111">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094114">}</span><span class="op" id="7094115">(</span><span class="op" id="7094116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094120">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094142">select</span>&nbsp;<span class="op" id="7094149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094152">case</span>&nbsp;<span class="op" id="7094157">&lt;-</span><span class="ident" id="7094159">time</span><span class="op" id="7094163">.</span><span class="ident" id="7094164">After</span><span class="op" id="7094169">(</span><span class="num" id="7094170">10</span>&nbsp;<span class="op" id="7094173">*</span>&nbsp;<span class="ident" id="7094175">time</span><span class="op" id="7094179">.</span><span class="ident" id="7094180">Second</span><span class="op" id="7094186">)</span><span class="op" id="7094187">:</span>&nbsp;<span class="comment" id="7094189">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094249">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094281">t</span><span class="op" id="7094282">.</span><span class="ident" id="7094283">Errorf</span><span class="op" id="7094289">(</span><span class="string" id="7094290">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7094314">,</span>&nbsp;<span class="ident" id="7094316">source</span><span class="op" id="7094322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094325">case</span>&nbsp;<span class="op" id="7094330">&lt;-</span><span class="ident" id="7094332">cc</span><span class="op" id="7094334">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094338">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094384">}</span><br>
<span class="lineno"></span><span class="op" id="7094386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7094389">type</span>&nbsp;<span class="ident" id="7094394">entry</span>&nbsp;<span class="keyword" id="7094400">struct</span>&nbsp;<span class="op" id="7094407">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094410">source</span><span class="op" id="7094416">,</span>&nbsp;<span class="ident" id="7094418">golden</span>&nbsp;<span class="builtintype" id="7094425">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094433">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7094448">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7094458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7094461">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7094530">var</span>&nbsp;<span class="ident" id="7094534">data</span>&nbsp;<span class="op" id="7094539">=</span>&nbsp;<span class="op" id="7094541">[</span><span class="op" id="7094542">]</span><span class="ident" id="7094543">entry</span><span class="op" id="7094548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094551">{</span><span class="string" id="7094552">&#34;empty.input&#34;</span><span class="op" id="7094565">,</span>&nbsp;<span class="string" id="7094567">&#34;empty.golden&#34;</span><span class="op" id="7094581">,</span>&nbsp;<span class="ident" id="7094583">idempotent</span><span class="op" id="7094593">}</span><span class="op" id="7094594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094597">{</span><span class="string" id="7094598">&#34;comments.input&#34;</span><span class="op" id="7094614">,</span>&nbsp;<span class="string" id="7094616">&#34;comments.golden&#34;</span><span class="op" id="7094633">,</span>&nbsp;<span class="num" id="7094635">0</span><span class="op" id="7094636">}</span><span class="op" id="7094637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094640">{</span><span class="string" id="7094641">&#34;comments.input&#34;</span><span class="op" id="7094657">,</span>&nbsp;<span class="string" id="7094659">&#34;comments.x&#34;</span><span class="op" id="7094671">,</span>&nbsp;<span class="ident" id="7094673">export</span><span class="op" id="7094679">}</span><span class="op" id="7094680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094683">{</span><span class="string" id="7094684">&#34;comments2.input&#34;</span><span class="op" id="7094701">,</span>&nbsp;<span class="string" id="7094703">&#34;comments2.golden&#34;</span><span class="op" id="7094721">,</span>&nbsp;<span class="ident" id="7094723">idempotent</span><span class="op" id="7094733">}</span><span class="op" id="7094734">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094737">{</span><span class="string" id="7094738">&#34;linebreaks.input&#34;</span><span class="op" id="7094756">,</span>&nbsp;<span class="string" id="7094758">&#34;linebreaks.golden&#34;</span><span class="op" id="7094777">,</span>&nbsp;<span class="ident" id="7094779">idempotent</span><span class="op" id="7094789">}</span><span class="op" id="7094790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094793">{</span><span class="string" id="7094794">&#34;expressions.input&#34;</span><span class="op" id="7094813">,</span>&nbsp;<span class="string" id="7094815">&#34;expressions.golden&#34;</span><span class="op" id="7094835">,</span>&nbsp;<span class="ident" id="7094837">idempotent</span><span class="op" id="7094847">}</span><span class="op" id="7094848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094851">{</span><span class="string" id="7094852">&#34;expressions.input&#34;</span><span class="op" id="7094871">,</span>&nbsp;<span class="string" id="7094873">&#34;expressions.raw&#34;</span><span class="op" id="7094890">,</span>&nbsp;<span class="ident" id="7094892">rawFormat</span>&nbsp;<span class="op" id="7094902">|</span>&nbsp;<span class="ident" id="7094904">idempotent</span><span class="op" id="7094914">}</span><span class="op" id="7094915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094918">{</span><span class="string" id="7094919">&#34;declarations.input&#34;</span><span class="op" id="7094939">,</span>&nbsp;<span class="string" id="7094941">&#34;declarations.golden&#34;</span><span class="op" id="7094962">,</span>&nbsp;<span class="num" id="7094964">0</span><span class="op" id="7094965">}</span><span class="op" id="7094966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094969">{</span><span class="string" id="7094970">&#34;statements.input&#34;</span><span class="op" id="7094988">,</span>&nbsp;<span class="string" id="7094990">&#34;statements.golden&#34;</span><span class="op" id="7095009">,</span>&nbsp;<span class="num" id="7095011">0</span><span class="op" id="7095012">}</span><span class="op" id="7095013">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095016">{</span><span class="string" id="7095017">&#34;slow.input&#34;</span><span class="op" id="7095029">,</span>&nbsp;<span class="string" id="7095031">&#34;slow.golden&#34;</span><span class="op" id="7095044">,</span>&nbsp;<span class="ident" id="7095046">idempotent</span><span class="op" id="7095056">}</span><span class="op" id="7095057">,</span><br>
<span class="lineno"></span><span class="op" id="7095059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7095062">func</span>&nbsp;<span class="ident" id="7095067">TestFiles</span><span class="op" id="7095076">(</span><span class="ident" id="7095077">t</span>&nbsp;<span class="op" id="7095079">*</span><span class="ident" id="7095080">testing</span><span class="op" id="7095087">.</span><span class="ident" id="7095088">T</span><span class="op" id="7095089">)</span>&nbsp;<span class="op" id="7095091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095094">for</span>&nbsp;<span class="ident" id="7095098">_</span><span class="op" id="7095099">,</span>&nbsp;<span class="ident" id="7095101">e</span>&nbsp;<span class="op" id="7095103">:=</span>&nbsp;<span class="keyword" id="7095106">range</span>&nbsp;<span class="ident" id="7095112">data</span>&nbsp;<span class="op" id="7095117">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095121">source</span>&nbsp;<span class="op" id="7095128">:=</span>&nbsp;<span class="ident" id="7095131">filepath</span><span class="op" id="7095139">.</span><span class="ident" id="7095140">Join</span><span class="op" id="7095144">(</span><span class="ident" id="7095145">dataDir</span><span class="op" id="7095152">,</span>&nbsp;<span class="ident" id="7095154">e</span><span class="op" id="7095155">.</span><span class="ident" id="7095156">source</span><span class="op" id="7095162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095166">golden</span>&nbsp;<span class="op" id="7095173">:=</span>&nbsp;<span class="ident" id="7095176">filepath</span><span class="op" id="7095184">.</span><span class="ident" id="7095185">Join</span><span class="op" id="7095189">(</span><span class="ident" id="7095190">dataDir</span><span class="op" id="7095197">,</span>&nbsp;<span class="ident" id="7095199">e</span><span class="op" id="7095200">.</span><span class="ident" id="7095201">golden</span><span class="op" id="7095207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095211">check</span><span class="op" id="7095216">(</span><span class="ident" id="7095217">t</span><span class="op" id="7095218">,</span>&nbsp;<span class="ident" id="7095220">source</span><span class="op" id="7095226">,</span>&nbsp;<span class="ident" id="7095228">golden</span><span class="op" id="7095234">,</span>&nbsp;<span class="ident" id="7095236">e</span><span class="op" id="7095237">.</span><span class="ident" id="7095238">mode</span><span class="op" id="7095242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095246">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095293">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095329">}</span><br>
<span class="lineno"></span><span class="op" id="7095331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7095334">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7095410">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7095486">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7095515">//</span><br>
<span class="lineno"></span><span class="keyword" id="7095518">func</span>&nbsp;<span class="ident" id="7095523">TestLineComments</span><span class="op" id="7095539">(</span><span class="ident" id="7095540">t</span>&nbsp;<span class="op" id="7095542">*</span><span class="ident" id="7095543">testing</span><span class="op" id="7095550">.</span><span class="ident" id="7095551">T</span><span class="op" id="7095552">)</span>&nbsp;<span class="op" id="7095554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095557">const</span>&nbsp;<span class="ident" id="7095563">src</span>&nbsp;<span class="op" id="7095567">=</span>&nbsp;<span class="string" id="7095569">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095630">fset</span>&nbsp;<span class="op" id="7095635">:=</span>&nbsp;<span class="ident" id="7095638">token</span><span class="op" id="7095643">.</span><span class="ident" id="7095644">NewFileSet</span><span class="op" id="7095654">(</span><span class="op" id="7095655">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095658">f</span><span class="op" id="7095659">,</span>&nbsp;<span class="ident" id="7095661">err</span>&nbsp;<span class="op" id="7095665">:=</span>&nbsp;<span class="ident" id="7095668">parser</span><span class="op" id="7095674">.</span><span class="ident" id="7095675">ParseFile</span><span class="op" id="7095684">(</span><span class="ident" id="7095685">fset</span><span class="op" id="7095689">,</span>&nbsp;<span class="string" id="7095691">&#34;&#34;</span><span class="op" id="7095693">,</span>&nbsp;<span class="ident" id="7095695">src</span><span class="op" id="7095698">,</span>&nbsp;<span class="ident" id="7095700">parser</span><span class="op" id="7095706">.</span><span class="ident" id="7095707">ParseComments</span><span class="op" id="7095720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095723">if</span>&nbsp;<span class="ident" id="7095726">err</span>&nbsp;<span class="op" id="7095730">!=</span>&nbsp;<span class="ident" id="7095733">nil</span>&nbsp;<span class="op" id="7095737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7095741">panic</span><span class="op" id="7095746">(</span><span class="ident" id="7095747">err</span><span class="op" id="7095750">)</span>&nbsp;<span class="comment" id="7095752">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095774">var</span>&nbsp;<span class="ident" id="7095778">buf</span>&nbsp;<span class="ident" id="7095782">bytes</span><span class="op" id="7095787">.</span><span class="ident" id="7095788">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095796">fset</span>&nbsp;<span class="op" id="7095801">=</span>&nbsp;<span class="ident" id="7095803">token</span><span class="op" id="7095808">.</span><span class="ident" id="7095809">NewFileSet</span><span class="op" id="7095819">(</span><span class="op" id="7095820">)</span>&nbsp;<span class="comment" id="7095822">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095849">Fprint</span><span class="op" id="7095855">(</span><span class="op" id="7095856">&amp;</span><span class="ident" id="7095857">buf</span><span class="op" id="7095860">,</span>&nbsp;<span class="ident" id="7095862">fset</span><span class="op" id="7095866">,</span>&nbsp;<span class="ident" id="7095868">f</span><span class="op" id="7095869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095873">nlines</span>&nbsp;<span class="op" id="7095880">:=</span>&nbsp;<span class="num" id="7095883">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095886">for</span>&nbsp;<span class="ident" id="7095890">_</span><span class="op" id="7095891">,</span>&nbsp;<span class="ident" id="7095893">ch</span>&nbsp;<span class="op" id="7095896">:=</span>&nbsp;<span class="keyword" id="7095899">range</span>&nbsp;<span class="ident" id="7095905">buf</span><span class="op" id="7095908">.</span><span class="ident" id="7095909">Bytes</span><span class="op" id="7095914">(</span><span class="op" id="7095915">)</span>&nbsp;<span class="op" id="7095917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095921">if</span>&nbsp;<span class="ident" id="7095924">ch</span>&nbsp;<span class="op" id="7095927">==</span>&nbsp;<span class="string" id="7095930">&#39;\n&#39;</span>&nbsp;<span class="op" id="7095935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095940">nlines</span><span class="op" id="7095946">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095954">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095958">const</span>&nbsp;<span class="ident" id="7095964">expected</span>&nbsp;<span class="op" id="7095973">=</span>&nbsp;<span class="num" id="7095975">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095978">if</span>&nbsp;<span class="ident" id="7095981">nlines</span>&nbsp;<span class="op" id="7095988">&lt;</span>&nbsp;<span class="ident" id="7095990">expected</span>&nbsp;<span class="op" id="7095999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096003">t</span><span class="op" id="7096004">.</span><span class="ident" id="7096005">Errorf</span><span class="op" id="7096011">(</span><span class="string" id="7096012">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7096035">,</span>&nbsp;<span class="ident" id="7096037">nlines</span><span class="op" id="7096043">,</span>&nbsp;<span class="ident" id="7096045">expected</span><span class="op" id="7096053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096057">t</span><span class="op" id="7096058">.</span><span class="ident" id="7096059">Errorf</span><span class="op" id="7096065">(</span><span class="string" id="7096066">&#34;result:\n%s&#34;</span><span class="op" id="7096079">,</span>&nbsp;<span class="ident" id="7096081">buf</span><span class="op" id="7096084">.</span><span class="ident" id="7096085">Bytes</span><span class="op" id="7096090">(</span><span class="op" id="7096091">)</span><span class="op" id="7096092">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096095">}</span><br>
<span class="lineno"></span><span class="op" id="7096097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096100">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7096165">func</span>&nbsp;<span class="ident" id="7096170">init</span><span class="op" id="7096174">(</span><span class="op" id="7096175">)</span>&nbsp;<span class="op" id="7096177">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096180">const</span>&nbsp;<span class="ident" id="7096186">name</span>&nbsp;<span class="op" id="7096191">=</span>&nbsp;<span class="string" id="7096193">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096203">var</span>&nbsp;<span class="ident" id="7096207">buf</span>&nbsp;<span class="ident" id="7096211">bytes</span><span class="op" id="7096216">.</span><span class="ident" id="7096217">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096225">if</span>&nbsp;<span class="ident" id="7096228">err</span>&nbsp;<span class="op" id="7096232">:=</span>&nbsp;<span class="ident" id="7096235">Fprint</span><span class="op" id="7096241">(</span><span class="op" id="7096242">&amp;</span><span class="ident" id="7096243">buf</span><span class="op" id="7096246">,</span>&nbsp;<span class="ident" id="7096248">fset</span><span class="op" id="7096252">,</span>&nbsp;<span class="op" id="7096254">&amp;</span><span class="ident" id="7096255">ast</span><span class="op" id="7096258">.</span><span class="ident" id="7096259">Ident</span><span class="op" id="7096264">{</span><span class="ident" id="7096265">Name</span><span class="op" id="7096269">:</span>&nbsp;<span class="ident" id="7096271">name</span><span class="op" id="7096275">}</span><span class="op" id="7096276">)</span><span class="op" id="7096277">;</span>&nbsp;<span class="ident" id="7096279">err</span>&nbsp;<span class="op" id="7096283">!=</span>&nbsp;<span class="ident" id="7096286">nil</span>&nbsp;<span class="op" id="7096290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7096294">panic</span><span class="op" id="7096299">(</span><span class="ident" id="7096300">err</span><span class="op" id="7096303">)</span>&nbsp;<span class="comment" id="7096305">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096323">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7096326">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7096389">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096403">if</span>&nbsp;<span class="ident" id="7096406">s</span>&nbsp;<span class="op" id="7096408">:=</span>&nbsp;<span class="ident" id="7096411">buf</span><span class="op" id="7096414">.</span><span class="ident" id="7096415">String</span><span class="op" id="7096421">(</span><span class="op" id="7096422">)</span><span class="op" id="7096423">;</span>&nbsp;<span class="op" id="7096425">!</span><span class="ident" id="7096426">debug</span>&nbsp;<span class="op" id="7096432">&amp;&amp;</span>&nbsp;<span class="ident" id="7096435">s</span>&nbsp;<span class="op" id="7096437">!=</span>&nbsp;<span class="ident" id="7096440">name</span>&nbsp;<span class="op" id="7096445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7096449">panic</span><span class="op" id="7096454">(</span><span class="string" id="7096455">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7096462">+</span>&nbsp;<span class="ident" id="7096464">s</span>&nbsp;<span class="op" id="7096466">+</span>&nbsp;<span class="string" id="7096468">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7096478">+</span>&nbsp;<span class="ident" id="7096480">name</span><span class="op" id="7096484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096487">}</span><br>
<span class="lineno">255</span><span class="op" id="7096489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096492">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7096567">func</span>&nbsp;<span class="ident" id="7096572">TestBadNodes</span><span class="op" id="7096584">(</span><span class="ident" id="7096585">t</span>&nbsp;<span class="op" id="7096587">*</span><span class="ident" id="7096588">testing</span><span class="op" id="7096595">.</span><span class="ident" id="7096596">T</span><span class="op" id="7096597">)</span>&nbsp;<span class="op" id="7096599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096602">const</span>&nbsp;<span class="ident" id="7096608">src</span>&nbsp;<span class="op" id="7096612">=</span>&nbsp;<span class="string" id="7096614">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096630">const</span>&nbsp;<span class="ident" id="7096636">res</span>&nbsp;<span class="op" id="7096640">=</span>&nbsp;<span class="string" id="7096642">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096666">f</span><span class="op" id="7096667">,</span>&nbsp;<span class="ident" id="7096669">err</span>&nbsp;<span class="op" id="7096673">:=</span>&nbsp;<span class="ident" id="7096676">parser</span><span class="op" id="7096682">.</span><span class="ident" id="7096683">ParseFile</span><span class="op" id="7096692">(</span><span class="ident" id="7096693">fset</span><span class="op" id="7096697">,</span>&nbsp;<span class="string" id="7096699">&#34;&#34;</span><span class="op" id="7096701">,</span>&nbsp;<span class="ident" id="7096703">src</span><span class="op" id="7096706">,</span>&nbsp;<span class="ident" id="7096708">parser</span><span class="op" id="7096714">.</span><span class="ident" id="7096715">ParseComments</span><span class="op" id="7096728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096731">if</span>&nbsp;<span class="ident" id="7096734">err</span>&nbsp;<span class="op" id="7096738">==</span>&nbsp;<span class="ident" id="7096741">nil</span>&nbsp;<span class="op" id="7096745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096749">t</span><span class="op" id="7096750">.</span><span class="ident" id="7096751">Error</span><span class="op" id="7096756">(</span><span class="string" id="7096757">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7096783">)</span>&nbsp;<span class="comment" id="7096785">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096803">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096806">var</span>&nbsp;<span class="ident" id="7096810">buf</span>&nbsp;<span class="ident" id="7096814">bytes</span><span class="op" id="7096819">.</span><span class="ident" id="7096820">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096828">Fprint</span><span class="op" id="7096834">(</span><span class="op" id="7096835">&amp;</span><span class="ident" id="7096836">buf</span><span class="op" id="7096839">,</span>&nbsp;<span class="ident" id="7096841">fset</span><span class="op" id="7096845">,</span>&nbsp;<span class="ident" id="7096847">f</span><span class="op" id="7096848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096851">if</span>&nbsp;<span class="ident" id="7096854">buf</span><span class="op" id="7096857">.</span><span class="ident" id="7096858">String</span><span class="op" id="7096864">(</span><span class="op" id="7096865">)</span>&nbsp;<span class="op" id="7096867">!=</span>&nbsp;<span class="ident" id="7096870">res</span>&nbsp;<span class="op" id="7096874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096878">t</span><span class="op" id="7096879">.</span><span class="ident" id="7096880">Errorf</span><span class="op" id="7096886">(</span><span class="string" id="7096887">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7096908">,</span>&nbsp;<span class="ident" id="7096910">buf</span><span class="op" id="7096913">.</span><span class="ident" id="7096914">String</span><span class="op" id="7096920">(</span><span class="op" id="7096921">)</span><span class="op" id="7096922">,</span>&nbsp;<span class="ident" id="7096924">res</span><span class="op" id="7096927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096930">}</span><br>
<span class="lineno">270</span><span class="op" id="7096932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096935">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7097004">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7097076">func</span>&nbsp;<span class="ident" id="7097081">testComment</span><span class="op" id="7097092">(</span><span class="ident" id="7097093">t</span>&nbsp;<span class="op" id="7097095">*</span><span class="ident" id="7097096">testing</span><span class="op" id="7097103">.</span><span class="ident" id="7097104">T</span><span class="op" id="7097105">,</span>&nbsp;<span class="ident" id="7097107">f</span>&nbsp;<span class="op" id="7097109">*</span><span class="ident" id="7097110">ast</span><span class="op" id="7097113">.</span><span class="ident" id="7097114">File</span><span class="op" id="7097118">,</span>&nbsp;<span class="ident" id="7097120">srclen</span>&nbsp;<span class="builtintype" id="7097127">int</span><span class="op" id="7097130">,</span>&nbsp;<span class="ident" id="7097132">comment</span>&nbsp;<span class="op" id="7097140">*</span><span class="ident" id="7097141">ast</span><span class="op" id="7097144">.</span><span class="ident" id="7097145">Comment</span><span class="op" id="7097152">)</span>&nbsp;<span class="op" id="7097154">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097157">f</span><span class="op" id="7097158">.</span><span class="ident" id="7097159">Comments</span><span class="op" id="7097167">[</span><span class="num" id="7097168">0</span><span class="op" id="7097169">]</span><span class="op" id="7097170">.</span><span class="ident" id="7097171">List</span><span class="op" id="7097175">[</span><span class="num" id="7097176">0</span><span class="op" id="7097177">]</span>&nbsp;<span class="op" id="7097179">=</span>&nbsp;<span class="ident" id="7097181">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097190">var</span>&nbsp;<span class="ident" id="7097194">buf</span>&nbsp;<span class="ident" id="7097198">bytes</span><span class="op" id="7097203">.</span><span class="ident" id="7097204">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097212">for</span>&nbsp;<span class="ident" id="7097216">offs</span>&nbsp;<span class="op" id="7097221">:=</span>&nbsp;<span class="num" id="7097224">0</span><span class="op" id="7097225">;</span>&nbsp;<span class="ident" id="7097227">offs</span>&nbsp;<span class="op" id="7097232">&lt;=</span>&nbsp;<span class="ident" id="7097235">srclen</span><span class="op" id="7097241">;</span>&nbsp;<span class="ident" id="7097243">offs</span><span class="op" id="7097247">++</span>&nbsp;<span class="op" id="7097250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097254">buf</span><span class="op" id="7097257">.</span><span class="ident" id="7097258">Reset</span><span class="op" id="7097263">(</span><span class="op" id="7097264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097268">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097322">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097376">if</span>&nbsp;<span class="ident" id="7097379">err</span>&nbsp;<span class="op" id="7097383">:=</span>&nbsp;<span class="ident" id="7097386">Fprint</span><span class="op" id="7097392">(</span><span class="op" id="7097393">&amp;</span><span class="ident" id="7097394">buf</span><span class="op" id="7097397">,</span>&nbsp;<span class="ident" id="7097399">fset</span><span class="op" id="7097403">,</span>&nbsp;<span class="ident" id="7097405">f</span><span class="op" id="7097406">)</span><span class="op" id="7097407">;</span>&nbsp;<span class="ident" id="7097409">err</span>&nbsp;<span class="op" id="7097413">!=</span>&nbsp;<span class="ident" id="7097416">nil</span>&nbsp;<span class="op" id="7097420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097425">t</span><span class="op" id="7097426">.</span><span class="ident" id="7097427">Error</span><span class="op" id="7097432">(</span><span class="ident" id="7097433">err</span><span class="op" id="7097436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097444">if</span>&nbsp;<span class="ident" id="7097447">_</span><span class="op" id="7097448">,</span>&nbsp;<span class="ident" id="7097450">err</span>&nbsp;<span class="op" id="7097454">:=</span>&nbsp;<span class="ident" id="7097457">parser</span><span class="op" id="7097463">.</span><span class="ident" id="7097464">ParseFile</span><span class="op" id="7097473">(</span><span class="ident" id="7097474">fset</span><span class="op" id="7097478">,</span>&nbsp;<span class="string" id="7097480">&#34;&#34;</span><span class="op" id="7097482">,</span>&nbsp;<span class="ident" id="7097484">buf</span><span class="op" id="7097487">.</span><span class="ident" id="7097488">Bytes</span><span class="op" id="7097493">(</span><span class="op" id="7097494">)</span><span class="op" id="7097495">,</span>&nbsp;<span class="num" id="7097497">0</span><span class="op" id="7097498">)</span><span class="op" id="7097499">;</span>&nbsp;<span class="ident" id="7097501">err</span>&nbsp;<span class="op" id="7097505">!=</span>&nbsp;<span class="ident" id="7097508">nil</span>&nbsp;<span class="op" id="7097512">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097517">t</span><span class="op" id="7097518">.</span><span class="ident" id="7097519">Fatalf</span><span class="op" id="7097525">(</span><span class="string" id="7097526">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7097563">,</span>&nbsp;<span class="ident" id="7097565">comment</span><span class="op" id="7097572">.</span><span class="ident" id="7097573">Slash</span><span class="op" id="7097578">,</span>&nbsp;<span class="ident" id="7097580">buf</span><span class="op" id="7097583">.</span><span class="ident" id="7097584">String</span><span class="op" id="7097590">(</span><span class="op" id="7097591">)</span><span class="op" id="7097592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097600">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097645">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097692">comment</span><span class="op" id="7097699">.</span><span class="ident" id="7097700">Slash</span><span class="op" id="7097705">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097709">}</span><br>
<span class="lineno"></span><span class="op" id="7097711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7097714">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7097768">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7097837">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7097854">func</span>&nbsp;<span class="ident" id="7097859">TestBadComments</span><span class="op" id="7097874">(</span><span class="ident" id="7097875">t</span>&nbsp;<span class="op" id="7097877">*</span><span class="ident" id="7097878">testing</span><span class="op" id="7097885">.</span><span class="ident" id="7097886">T</span><span class="op" id="7097887">)</span>&nbsp;<span class="op" id="7097889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097892">const</span>&nbsp;<span class="ident" id="7097898">src</span>&nbsp;<span class="op" id="7097902">=</span>&nbsp;<span class="string" id="7097904">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098158">f</span><span class="op" id="7098159">,</span>&nbsp;<span class="ident" id="7098161">err</span>&nbsp;<span class="op" id="7098165">:=</span>&nbsp;<span class="ident" id="7098168">parser</span><span class="op" id="7098174">.</span><span class="ident" id="7098175">ParseFile</span><span class="op" id="7098184">(</span><span class="ident" id="7098185">fset</span><span class="op" id="7098189">,</span>&nbsp;<span class="string" id="7098191">&#34;&#34;</span><span class="op" id="7098193">,</span>&nbsp;<span class="ident" id="7098195">src</span><span class="op" id="7098198">,</span>&nbsp;<span class="ident" id="7098200">parser</span><span class="op" id="7098206">.</span><span class="ident" id="7098207">ParseComments</span><span class="op" id="7098220">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098223">if</span>&nbsp;<span class="ident" id="7098226">err</span>&nbsp;<span class="op" id="7098230">!=</span>&nbsp;<span class="ident" id="7098233">nil</span>&nbsp;<span class="op" id="7098237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098241">t</span><span class="op" id="7098242">.</span><span class="ident" id="7098243">Error</span><span class="op" id="7098248">(</span><span class="ident" id="7098249">err</span><span class="op" id="7098252">)</span>&nbsp;<span class="comment" id="7098254">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098276">comment</span>&nbsp;<span class="op" id="7098284">:=</span>&nbsp;<span class="ident" id="7098287">f</span><span class="op" id="7098288">.</span><span class="ident" id="7098289">Comments</span><span class="op" id="7098297">[</span><span class="num" id="7098298">0</span><span class="op" id="7098299">]</span><span class="op" id="7098300">.</span><span class="ident" id="7098301">List</span><span class="op" id="7098305">[</span><span class="num" id="7098306">0</span><span class="op" id="7098307">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098310">pos</span>&nbsp;<span class="op" id="7098314">:=</span>&nbsp;<span class="ident" id="7098317">comment</span><span class="op" id="7098324">.</span><span class="ident" id="7098325">Pos</span><span class="op" id="7098328">(</span><span class="op" id="7098329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098332">if</span>&nbsp;<span class="ident" id="7098335">fset</span><span class="op" id="7098339">.</span><span class="ident" id="7098340">Position</span><span class="op" id="7098348">(</span><span class="ident" id="7098349">pos</span><span class="op" id="7098352">)</span><span class="op" id="7098353">.</span><span class="ident" id="7098354">Offset</span>&nbsp;<span class="op" id="7098361">!=</span>&nbsp;<span class="num" id="7098364">1</span>&nbsp;<span class="op" id="7098366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098370">t</span><span class="op" id="7098371">.</span><span class="ident" id="7098372">Error</span><span class="op" id="7098377">(</span><span class="string" id="7098378">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7098397">)</span>&nbsp;<span class="comment" id="7098399">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098421">testComment</span><span class="op" id="7098432">(</span><span class="ident" id="7098433">t</span><span class="op" id="7098434">,</span>&nbsp;<span class="ident" id="7098436">f</span><span class="op" id="7098437">,</span>&nbsp;<span class="builtinfunc" id="7098439">len</span><span class="op" id="7098442">(</span><span class="ident" id="7098443">src</span><span class="op" id="7098446">)</span><span class="op" id="7098447">,</span>&nbsp;<span class="op" id="7098449">&amp;</span><span class="ident" id="7098450">ast</span><span class="op" id="7098453">.</span><span class="ident" id="7098454">Comment</span><span class="op" id="7098461">{</span><span class="ident" id="7098462">Slash</span><span class="op" id="7098467">:</span>&nbsp;<span class="ident" id="7098469">pos</span><span class="op" id="7098472">,</span>&nbsp;<span class="ident" id="7098474">Text</span><span class="op" id="7098478">:</span>&nbsp;<span class="string" id="7098480">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7098498">}</span><span class="op" id="7098499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098502">testComment</span><span class="op" id="7098513">(</span><span class="ident" id="7098514">t</span><span class="op" id="7098515">,</span>&nbsp;<span class="ident" id="7098517">f</span><span class="op" id="7098518">,</span>&nbsp;<span class="builtinfunc" id="7098520">len</span><span class="op" id="7098523">(</span><span class="ident" id="7098524">src</span><span class="op" id="7098527">)</span><span class="op" id="7098528">,</span>&nbsp;<span class="op" id="7098530">&amp;</span><span class="ident" id="7098531">ast</span><span class="op" id="7098534">.</span><span class="ident" id="7098535">Comment</span><span class="op" id="7098542">{</span><span class="ident" id="7098543">Slash</span><span class="op" id="7098548">:</span>&nbsp;<span class="ident" id="7098550">pos</span><span class="op" id="7098553">,</span>&nbsp;<span class="ident" id="7098555">Text</span><span class="op" id="7098559">:</span>&nbsp;<span class="string" id="7098561">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7098582">}</span><span class="op" id="7098583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098586">testComment</span><span class="op" id="7098597">(</span><span class="ident" id="7098598">t</span><span class="op" id="7098599">,</span>&nbsp;<span class="ident" id="7098601">f</span><span class="op" id="7098602">,</span>&nbsp;<span class="builtinfunc" id="7098604">len</span><span class="op" id="7098607">(</span><span class="ident" id="7098608">src</span><span class="op" id="7098611">)</span><span class="op" id="7098612">,</span>&nbsp;<span class="op" id="7098614">&amp;</span><span class="ident" id="7098615">ast</span><span class="op" id="7098618">.</span><span class="ident" id="7098619">Comment</span><span class="op" id="7098626">{</span><span class="ident" id="7098627">Slash</span><span class="op" id="7098632">:</span>&nbsp;<span class="ident" id="7098634">pos</span><span class="op" id="7098637">,</span>&nbsp;<span class="ident" id="7098639">Text</span><span class="op" id="7098643">:</span>&nbsp;<span class="string" id="7098645">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7098669">}</span><span class="op" id="7098670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098673">testComment</span><span class="op" id="7098684">(</span><span class="ident" id="7098685">t</span><span class="op" id="7098686">,</span>&nbsp;<span class="ident" id="7098688">f</span><span class="op" id="7098689">,</span>&nbsp;<span class="builtinfunc" id="7098691">len</span><span class="op" id="7098694">(</span><span class="ident" id="7098695">src</span><span class="op" id="7098698">)</span><span class="op" id="7098699">,</span>&nbsp;<span class="op" id="7098701">&amp;</span><span class="ident" id="7098702">ast</span><span class="op" id="7098705">.</span><span class="ident" id="7098706">Comment</span><span class="op" id="7098713">{</span><span class="ident" id="7098714">Slash</span><span class="op" id="7098719">:</span>&nbsp;<span class="ident" id="7098721">pos</span><span class="op" id="7098724">,</span>&nbsp;<span class="ident" id="7098726">Text</span><span class="op" id="7098730">:</span>&nbsp;<span class="string" id="7098732">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7098760">}</span><span class="op" id="7098761">)</span><br>
<span class="lineno"></span><span class="op" id="7098763">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7098766">type</span>&nbsp;<span class="ident" id="7098771">visitor</span>&nbsp;<span class="keyword" id="7098779">chan</span>&nbsp;<span class="op" id="7098784">*</span><span class="ident" id="7098785">ast</span><span class="op" id="7098788">.</span><span class="ident" id="7098789">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7098796">func</span>&nbsp;<span class="op" id="7098801">(</span><span class="ident" id="7098802">v</span>&nbsp;<span class="ident" id="7098804">visitor</span><span class="op" id="7098811">)</span>&nbsp;<span class="ident" id="7098813">Visit</span><span class="op" id="7098818">(</span><span class="ident" id="7098819">n</span>&nbsp;<span class="ident" id="7098821">ast</span><span class="op" id="7098824">.</span><span class="ident" id="7098825">Node</span><span class="op" id="7098829">)</span>&nbsp;<span class="op" id="7098831">(</span><span class="ident" id="7098832">w</span>&nbsp;<span class="ident" id="7098834">ast</span><span class="op" id="7098837">.</span><span class="ident" id="7098838">Visitor</span><span class="op" id="7098845">)</span>&nbsp;<span class="op" id="7098847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098850">if</span>&nbsp;<span class="ident" id="7098853">ident</span><span class="op" id="7098858">,</span>&nbsp;<span class="ident" id="7098860">ok</span>&nbsp;<span class="op" id="7098863">:=</span>&nbsp;<span class="ident" id="7098866">n</span><span class="op" id="7098867">.</span><span class="op" id="7098868">(</span><span class="op" id="7098869">*</span><span class="ident" id="7098870">ast</span><span class="op" id="7098873">.</span><span class="ident" id="7098874">Ident</span><span class="op" id="7098879">)</span><span class="op" id="7098880">;</span>&nbsp;<span class="ident" id="7098882">ok</span>&nbsp;<span class="op" id="7098885">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098889">v</span>&nbsp;<span class="op" id="7098891">&lt;-</span>&nbsp;<span class="ident" id="7098894">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098904">return</span>&nbsp;<span class="ident" id="7098911">v</span><br>
<span class="lineno"></span><span class="op" id="7098913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7098916">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7098994">func</span>&nbsp;<span class="ident" id="7098999">idents</span><span class="op" id="7099005">(</span><span class="ident" id="7099006">f</span>&nbsp;<span class="op" id="7099008">*</span><span class="ident" id="7099009">ast</span><span class="op" id="7099012">.</span><span class="ident" id="7099013">File</span><span class="op" id="7099017">)</span>&nbsp;<span class="op" id="7099019">&lt;-</span><span class="keyword" id="7099021">chan</span>&nbsp;<span class="op" id="7099026">*</span><span class="ident" id="7099027">ast</span><span class="op" id="7099030">.</span><span class="ident" id="7099031">Ident</span>&nbsp;<span class="op" id="7099037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099040">v</span>&nbsp;<span class="op" id="7099042">:=</span>&nbsp;<span class="builtinfunc" id="7099045">make</span><span class="op" id="7099049">(</span><span class="ident" id="7099050">visitor</span><span class="op" id="7099057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099060">go</span>&nbsp;<span class="keyword" id="7099063">func</span><span class="op" id="7099067">(</span><span class="op" id="7099068">)</span>&nbsp;<span class="op" id="7099070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099074">ast</span><span class="op" id="7099077">.</span><span class="ident" id="7099078">Walk</span><span class="op" id="7099082">(</span><span class="ident" id="7099083">v</span><span class="op" id="7099084">,</span>&nbsp;<span class="ident" id="7099086">f</span><span class="op" id="7099087">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7099091">close</span><span class="op" id="7099096">(</span><span class="ident" id="7099097">v</span><span class="op" id="7099098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099101">}</span><span class="op" id="7099102">(</span><span class="op" id="7099103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099106">return</span>&nbsp;<span class="ident" id="7099113">v</span><br>
<span class="lineno"></span><span class="op" id="7099115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7099118">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7099178">func</span>&nbsp;<span class="ident" id="7099183">identCount</span><span class="op" id="7099193">(</span><span class="ident" id="7099194">f</span>&nbsp;<span class="op" id="7099196">*</span><span class="ident" id="7099197">ast</span><span class="op" id="7099200">.</span><span class="ident" id="7099201">File</span><span class="op" id="7099205">)</span>&nbsp;<span class="builtintype" id="7099207">int</span>&nbsp;<span class="op" id="7099211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099214">n</span>&nbsp;<span class="op" id="7099216">:=</span>&nbsp;<span class="num" id="7099219">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099222">for</span>&nbsp;<span class="keyword" id="7099226">range</span>&nbsp;<span class="ident" id="7099232">idents</span><span class="op" id="7099238">(</span><span class="ident" id="7099239">f</span><span class="op" id="7099240">)</span>&nbsp;<span class="op" id="7099242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099246">n</span><span class="op" id="7099247">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099254">return</span>&nbsp;<span class="ident" id="7099261">n</span><br>
<span class="lineno"></span><span class="op" id="7099263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7099266">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7099330">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7099395">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7099413">func</span>&nbsp;<span class="ident" id="7099418">TestSourcePos</span><span class="op" id="7099431">(</span><span class="ident" id="7099432">t</span>&nbsp;<span class="op" id="7099434">*</span><span class="ident" id="7099435">testing</span><span class="op" id="7099442">.</span><span class="ident" id="7099443">T</span><span class="op" id="7099444">)</span>&nbsp;<span class="op" id="7099446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099449">const</span>&nbsp;<span class="ident" id="7099455">src</span>&nbsp;<span class="op" id="7099459">=</span>&nbsp;<span class="string" id="7099461">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099686">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099705">f1</span><span class="op" id="7099707">,</span>&nbsp;<span class="ident" id="7099709">err</span>&nbsp;<span class="op" id="7099713">:=</span>&nbsp;<span class="ident" id="7099716">parser</span><span class="op" id="7099722">.</span><span class="ident" id="7099723">ParseFile</span><span class="op" id="7099732">(</span><span class="ident" id="7099733">fset</span><span class="op" id="7099737">,</span>&nbsp;<span class="string" id="7099739">&#34;src&#34;</span><span class="op" id="7099744">,</span>&nbsp;<span class="ident" id="7099746">src</span><span class="op" id="7099749">,</span>&nbsp;<span class="ident" id="7099751">parser</span><span class="op" id="7099757">.</span><span class="ident" id="7099758">ParseComments</span><span class="op" id="7099771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099774">if</span>&nbsp;<span class="ident" id="7099777">err</span>&nbsp;<span class="op" id="7099781">!=</span>&nbsp;<span class="ident" id="7099784">nil</span>&nbsp;<span class="op" id="7099788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099792">t</span><span class="op" id="7099793">.</span><span class="ident" id="7099794">Fatal</span><span class="op" id="7099799">(</span><span class="ident" id="7099800">err</span><span class="op" id="7099803">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099810">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099836">var</span>&nbsp;<span class="ident" id="7099840">buf</span>&nbsp;<span class="ident" id="7099844">bytes</span><span class="op" id="7099849">.</span><span class="ident" id="7099850">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099858">err</span>&nbsp;<span class="op" id="7099862">=</span>&nbsp;<span class="op" id="7099864">(</span><span class="op" id="7099865">&amp;</span><span class="ident" id="7099866">Config</span><span class="op" id="7099872">{</span><span class="ident" id="7099873">Mode</span><span class="op" id="7099877">:</span>&nbsp;<span class="ident" id="7099879">UseSpaces</span>&nbsp;<span class="op" id="7099889">|</span>&nbsp;<span class="ident" id="7099891">SourcePos</span><span class="op" id="7099900">,</span>&nbsp;<span class="ident" id="7099902">Tabwidth</span><span class="op" id="7099910">:</span>&nbsp;<span class="num" id="7099912">8</span><span class="op" id="7099913">}</span><span class="op" id="7099914">)</span><span class="op" id="7099915">.</span><span class="ident" id="7099916">Fprint</span><span class="op" id="7099922">(</span><span class="op" id="7099923">&amp;</span><span class="ident" id="7099924">buf</span><span class="op" id="7099927">,</span>&nbsp;<span class="ident" id="7099929">fset</span><span class="op" id="7099933">,</span>&nbsp;<span class="ident" id="7099935">f1</span><span class="op" id="7099937">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7099940">if</span>&nbsp;<span class="ident" id="7099943">err</span>&nbsp;<span class="op" id="7099947">!=</span>&nbsp;<span class="ident" id="7099950">nil</span>&nbsp;<span class="op" id="7099954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7099958">t</span><span class="op" id="7099959">.</span><span class="ident" id="7099960">Fatal</span><span class="op" id="7099965">(</span><span class="ident" id="7099966">err</span><span class="op" id="7099969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7099972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7099976">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7100010">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100086">f2</span><span class="op" id="7100088">,</span>&nbsp;<span class="ident" id="7100090">err</span>&nbsp;<span class="op" id="7100094">:=</span>&nbsp;<span class="ident" id="7100097">parser</span><span class="op" id="7100103">.</span><span class="ident" id="7100104">ParseFile</span><span class="op" id="7100113">(</span><span class="ident" id="7100114">fset</span><span class="op" id="7100118">,</span>&nbsp;<span class="string" id="7100120">&#34;&#34;</span><span class="op" id="7100122">,</span>&nbsp;<span class="ident" id="7100124">buf</span><span class="op" id="7100127">.</span><span class="ident" id="7100128">Bytes</span><span class="op" id="7100133">(</span><span class="op" id="7100134">)</span><span class="op" id="7100135">,</span>&nbsp;<span class="num" id="7100137">0</span><span class="op" id="7100138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100141">if</span>&nbsp;<span class="ident" id="7100144">err</span>&nbsp;<span class="op" id="7100148">!=</span>&nbsp;<span class="ident" id="7100151">nil</span>&nbsp;<span class="op" id="7100155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100159">t</span><span class="op" id="7100160">.</span><span class="ident" id="7100161">Fatalf</span><span class="op" id="7100167">(</span><span class="string" id="7100168">&#34;%s\n%s&#34;</span><span class="op" id="7100176">,</span>&nbsp;<span class="ident" id="7100178">err</span><span class="op" id="7100181">,</span>&nbsp;<span class="ident" id="7100183">buf</span><span class="op" id="7100186">.</span><span class="ident" id="7100187">Bytes</span><span class="op" id="7100192">(</span><span class="op" id="7100193">)</span><span class="op" id="7100194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100197">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7100201">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7100272">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7100344">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100415">n1</span>&nbsp;<span class="op" id="7100418">:=</span>&nbsp;<span class="ident" id="7100421">identCount</span><span class="op" id="7100431">(</span><span class="ident" id="7100432">f1</span><span class="op" id="7100434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100437">n2</span>&nbsp;<span class="op" id="7100440">:=</span>&nbsp;<span class="ident" id="7100443">identCount</span><span class="op" id="7100453">(</span><span class="ident" id="7100454">f2</span><span class="op" id="7100456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100459">if</span>&nbsp;<span class="ident" id="7100462">n1</span>&nbsp;<span class="op" id="7100465">==</span>&nbsp;<span class="num" id="7100468">0</span>&nbsp;<span class="op" id="7100470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100474">t</span><span class="op" id="7100475">.</span><span class="ident" id="7100476">Fatal</span><span class="op" id="7100481">(</span><span class="string" id="7100482">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7100497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100500">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100503">if</span>&nbsp;<span class="ident" id="7100506">n2</span>&nbsp;<span class="op" id="7100509">!=</span>&nbsp;<span class="ident" id="7100512">n1</span>&nbsp;<span class="op" id="7100515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100519">t</span><span class="op" id="7100520">.</span><span class="ident" id="7100521">Errorf</span><span class="op" id="7100527">(</span><span class="string" id="7100528">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7100552">,</span>&nbsp;<span class="ident" id="7100554">n2</span><span class="op" id="7100556">,</span>&nbsp;<span class="ident" id="7100558">n1</span><span class="op" id="7100560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7100567">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100629">i2range</span>&nbsp;<span class="op" id="7100637">:=</span>&nbsp;<span class="ident" id="7100640">idents</span><span class="op" id="7100646">(</span><span class="ident" id="7100647">f2</span><span class="op" id="7100649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100652">for</span>&nbsp;<span class="ident" id="7100656">i1</span>&nbsp;<span class="op" id="7100659">:=</span>&nbsp;<span class="keyword" id="7100662">range</span>&nbsp;<span class="ident" id="7100668">idents</span><span class="op" id="7100674">(</span><span class="ident" id="7100675">f1</span><span class="op" id="7100677">)</span>&nbsp;<span class="op" id="7100679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100683">i2</span>&nbsp;<span class="op" id="7100686">:=</span>&nbsp;<span class="op" id="7100689">&lt;-</span><span class="ident" id="7100691">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100702">if</span>&nbsp;<span class="ident" id="7100705">i2</span><span class="op" id="7100707">.</span><span class="ident" id="7100708">Name</span>&nbsp;<span class="op" id="7100713">!=</span>&nbsp;<span class="ident" id="7100716">i1</span><span class="op" id="7100718">.</span><span class="ident" id="7100719">Name</span>&nbsp;<span class="op" id="7100724">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100729">t</span><span class="op" id="7100730">.</span><span class="ident" id="7100731">Errorf</span><span class="op" id="7100737">(</span><span class="string" id="7100738">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7100761">,</span>&nbsp;<span class="ident" id="7100763">i2</span><span class="op" id="7100765">.</span><span class="ident" id="7100766">Name</span><span class="op" id="7100770">,</span>&nbsp;<span class="ident" id="7100772">i1</span><span class="op" id="7100774">.</span><span class="ident" id="7100775">Name</span><span class="op" id="7100779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100788">l1</span>&nbsp;<span class="op" id="7100791">:=</span>&nbsp;<span class="ident" id="7100794">fset</span><span class="op" id="7100798">.</span><span class="ident" id="7100799">Position</span><span class="op" id="7100807">(</span><span class="ident" id="7100808">i1</span><span class="op" id="7100810">.</span><span class="ident" id="7100811">Pos</span><span class="op" id="7100814">(</span><span class="op" id="7100815">)</span><span class="op" id="7100816">)</span><span class="op" id="7100817">.</span><span class="ident" id="7100818">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100825">l2</span>&nbsp;<span class="op" id="7100828">:=</span>&nbsp;<span class="ident" id="7100831">fset</span><span class="op" id="7100835">.</span><span class="ident" id="7100836">Position</span><span class="op" id="7100844">(</span><span class="ident" id="7100845">i2</span><span class="op" id="7100847">.</span><span class="ident" id="7100848">Pos</span><span class="op" id="7100851">(</span><span class="op" id="7100852">)</span><span class="op" id="7100853">)</span><span class="op" id="7100854">.</span><span class="ident" id="7100855">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100862">if</span>&nbsp;<span class="ident" id="7100865">l2</span>&nbsp;<span class="op" id="7100868">!=</span>&nbsp;<span class="ident" id="7100871">l1</span>&nbsp;<span class="op" id="7100874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100879">t</span><span class="op" id="7100880">.</span><span class="ident" id="7100881">Errorf</span><span class="op" id="7100887">(</span><span class="string" id="7100888">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7100917">,</span>&nbsp;<span class="ident" id="7100919">l2</span><span class="op" id="7100921">,</span>&nbsp;<span class="ident" id="7100923">l1</span><span class="op" id="7100925">,</span>&nbsp;<span class="ident" id="7100927">i1</span><span class="op" id="7100929">.</span><span class="ident" id="7100930">Name</span><span class="op" id="7100934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7100945">if</span>&nbsp;<span class="ident" id="7100948">t</span><span class="op" id="7100949">.</span><span class="ident" id="7100950">Failed</span><span class="op" id="7100956">(</span><span class="op" id="7100957">)</span>&nbsp;<span class="op" id="7100959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7100963">t</span><span class="op" id="7100964">.</span><span class="ident" id="7100965">Logf</span><span class="op" id="7100969">(</span><span class="string" id="7100970">&#34;\n%s&#34;</span><span class="op" id="7100976">,</span>&nbsp;<span class="ident" id="7100978">buf</span><span class="op" id="7100981">.</span><span class="ident" id="7100982">Bytes</span><span class="op" id="7100987">(</span><span class="op" id="7100988">)</span><span class="op" id="7100989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7100992">}</span><br>
<span class="lineno"></span><span class="op" id="7100994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7100997">var</span>&nbsp;<span class="ident" id="7101001">decls</span>&nbsp;<span class="op" id="7101007">=</span>&nbsp;<span class="op" id="7101009">[</span><span class="op" id="7101010">]</span><span class="builtintype" id="7101011">string</span><span class="op" id="7101017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101020">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7101034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101037">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7101089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101092">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7101134">,</span><br>
<span class="lineno"></span><span class="op" id="7101136">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7101139">func</span>&nbsp;<span class="ident" id="7101144">TestDeclLists</span><span class="op" id="7101157">(</span><span class="ident" id="7101158">t</span>&nbsp;<span class="op" id="7101160">*</span><span class="ident" id="7101161">testing</span><span class="op" id="7101168">.</span><span class="ident" id="7101169">T</span><span class="op" id="7101170">)</span>&nbsp;<span class="op" id="7101172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101175">for</span>&nbsp;<span class="ident" id="7101179">_</span><span class="op" id="7101180">,</span>&nbsp;<span class="ident" id="7101182">src</span>&nbsp;<span class="op" id="7101186">:=</span>&nbsp;<span class="keyword" id="7101189">range</span>&nbsp;<span class="ident" id="7101195">decls</span>&nbsp;<span class="op" id="7101201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101205">file</span><span class="op" id="7101209">,</span>&nbsp;<span class="ident" id="7101211">err</span>&nbsp;<span class="op" id="7101215">:=</span>&nbsp;<span class="ident" id="7101218">parser</span><span class="op" id="7101224">.</span><span class="ident" id="7101225">ParseFile</span><span class="op" id="7101234">(</span><span class="ident" id="7101235">fset</span><span class="op" id="7101239">,</span>&nbsp;<span class="string" id="7101241">&#34;&#34;</span><span class="op" id="7101243">,</span>&nbsp;<span class="string" id="7101245">&#34;package&nbsp;p;&#34;</span><span class="op" id="7101257">+</span><span class="ident" id="7101258">src</span><span class="op" id="7101261">,</span>&nbsp;<span class="ident" id="7101263">parser</span><span class="op" id="7101269">.</span><span class="ident" id="7101270">ParseComments</span><span class="op" id="7101283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101287">if</span>&nbsp;<span class="ident" id="7101290">err</span>&nbsp;<span class="op" id="7101294">!=</span>&nbsp;<span class="ident" id="7101297">nil</span>&nbsp;<span class="op" id="7101301">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7101306">panic</span><span class="op" id="7101311">(</span><span class="ident" id="7101312">err</span><span class="op" id="7101315">)</span>&nbsp;<span class="comment" id="7101317">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101341">var</span>&nbsp;<span class="ident" id="7101345">buf</span>&nbsp;<span class="ident" id="7101349">bytes</span><span class="op" id="7101354">.</span><span class="ident" id="7101355">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101364">err</span>&nbsp;<span class="op" id="7101368">=</span>&nbsp;<span class="ident" id="7101370">Fprint</span><span class="op" id="7101376">(</span><span class="op" id="7101377">&amp;</span><span class="ident" id="7101378">buf</span><span class="op" id="7101381">,</span>&nbsp;<span class="ident" id="7101383">fset</span><span class="op" id="7101387">,</span>&nbsp;<span class="ident" id="7101389">file</span><span class="op" id="7101393">.</span><span class="ident" id="7101394">Decls</span><span class="op" id="7101399">)</span>&nbsp;<span class="comment" id="7101401">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101430">if</span>&nbsp;<span class="ident" id="7101433">err</span>&nbsp;<span class="op" id="7101437">!=</span>&nbsp;<span class="ident" id="7101440">nil</span>&nbsp;<span class="op" id="7101444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7101449">panic</span><span class="op" id="7101454">(</span><span class="ident" id="7101455">err</span><span class="op" id="7101458">)</span>&nbsp;<span class="comment" id="7101460">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101484">out</span>&nbsp;<span class="op" id="7101488">:=</span>&nbsp;<span class="ident" id="7101491">buf</span><span class="op" id="7101494">.</span><span class="ident" id="7101495">String</span><span class="op" id="7101501">(</span><span class="op" id="7101502">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101506">if</span>&nbsp;<span class="ident" id="7101509">out</span>&nbsp;<span class="op" id="7101513">!=</span>&nbsp;<span class="ident" id="7101516">src</span>&nbsp;<span class="op" id="7101520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101525">t</span><span class="op" id="7101526">.</span><span class="ident" id="7101527">Errorf</span><span class="op" id="7101533">(</span><span class="string" id="7101534">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7101558">,</span>&nbsp;<span class="ident" id="7101560">out</span><span class="op" id="7101563">,</span>&nbsp;<span class="ident" id="7101565">src</span><span class="op" id="7101568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101575">}</span><br>
<span class="lineno"></span><span class="op" id="7101577">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7101580">var</span>&nbsp;<span class="ident" id="7101584">stmts</span>&nbsp;<span class="op" id="7101590">=</span>&nbsp;<span class="op" id="7101592">[</span><span class="op" id="7101593">]</span><span class="builtintype" id="7101594">string</span><span class="op" id="7101600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101603">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7101611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101614">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7101656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7101659">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7101686">,</span><br>
<span class="lineno">460</span><span class="op" id="7101688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7101691">func</span>&nbsp;<span class="ident" id="7101696">TestStmtLists</span><span class="op" id="7101709">(</span><span class="ident" id="7101710">t</span>&nbsp;<span class="op" id="7101712">*</span><span class="ident" id="7101713">testing</span><span class="op" id="7101720">.</span><span class="ident" id="7101721">T</span><span class="op" id="7101722">)</span>&nbsp;<span class="op" id="7101724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101727">for</span>&nbsp;<span class="ident" id="7101731">_</span><span class="op" id="7101732">,</span>&nbsp;<span class="ident" id="7101734">src</span>&nbsp;<span class="op" id="7101738">:=</span>&nbsp;<span class="keyword" id="7101741">range</span>&nbsp;<span class="ident" id="7101747">stmts</span>&nbsp;<span class="op" id="7101753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101757">file</span><span class="op" id="7101761">,</span>&nbsp;<span class="ident" id="7101763">err</span>&nbsp;<span class="op" id="7101767">:=</span>&nbsp;<span class="ident" id="7101770">parser</span><span class="op" id="7101776">.</span><span class="ident" id="7101777">ParseFile</span><span class="op" id="7101786">(</span><span class="ident" id="7101787">fset</span><span class="op" id="7101791">,</span>&nbsp;<span class="string" id="7101793">&#34;&#34;</span><span class="op" id="7101795">,</span>&nbsp;<span class="string" id="7101797">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7101820">+</span><span class="ident" id="7101821">src</span><span class="op" id="7101824">+</span><span class="string" id="7101825">&#34;}&#34;</span><span class="op" id="7101828">,</span>&nbsp;<span class="ident" id="7101830">parser</span><span class="op" id="7101836">.</span><span class="ident" id="7101837">ParseComments</span><span class="op" id="7101850">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101854">if</span>&nbsp;<span class="ident" id="7101857">err</span>&nbsp;<span class="op" id="7101861">!=</span>&nbsp;<span class="ident" id="7101864">nil</span>&nbsp;<span class="op" id="7101868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7101873">panic</span><span class="op" id="7101878">(</span><span class="ident" id="7101879">err</span><span class="op" id="7101882">)</span>&nbsp;<span class="comment" id="7101884">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7101903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7101908">var</span>&nbsp;<span class="ident" id="7101912">buf</span>&nbsp;<span class="ident" id="7101916">bytes</span><span class="op" id="7101921">.</span><span class="ident" id="7101922">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7101931">err</span>&nbsp;<span class="op" id="7101935">=</span>&nbsp;<span class="ident" id="7101937">Fprint</span><span class="op" id="7101943">(</span><span class="op" id="7101944">&amp;</span><span class="ident" id="7101945">buf</span><span class="op" id="7101948">,</span>&nbsp;<span class="ident" id="7101950">fset</span><span class="op" id="7101954">,</span>&nbsp;<span class="ident" id="7101956">file</span><span class="op" id="7101960">.</span><span class="ident" id="7101961">Decls</span><span class="op" id="7101966">[</span><span class="num" id="7101967">0</span><span class="op" id="7101968">]</span><span class="op" id="7101969">.</span><span class="op" id="7101970">(</span><span class="op" id="7101971">*</span><span class="ident" id="7101972">ast</span><span class="op" id="7101975">.</span><span class="ident" id="7101976">FuncDecl</span><span class="op" id="7101984">)</span><span class="op" id="7101985">.</span><span class="ident" id="7101986">Body</span><span class="op" id="7101990">.</span><span class="ident" id="7101991">List</span><span class="op" id="7101995">)</span>&nbsp;<span class="comment" id="7101997">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102024">if</span>&nbsp;<span class="ident" id="7102027">err</span>&nbsp;<span class="op" id="7102031">!=</span>&nbsp;<span class="ident" id="7102034">nil</span>&nbsp;<span class="op" id="7102038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7102043">panic</span><span class="op" id="7102048">(</span><span class="ident" id="7102049">err</span><span class="op" id="7102052">)</span>&nbsp;<span class="comment" id="7102054">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102078">out</span>&nbsp;<span class="op" id="7102082">:=</span>&nbsp;<span class="ident" id="7102085">buf</span><span class="op" id="7102088">.</span><span class="ident" id="7102089">String</span><span class="op" id="7102095">(</span><span class="op" id="7102096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102100">if</span>&nbsp;<span class="ident" id="7102103">out</span>&nbsp;<span class="op" id="7102107">!=</span>&nbsp;<span class="ident" id="7102110">src</span>&nbsp;<span class="op" id="7102114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102119">t</span><span class="op" id="7102120">.</span><span class="ident" id="7102121">Errorf</span><span class="op" id="7102127">(</span><span class="string" id="7102128">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7102152">,</span>&nbsp;<span class="ident" id="7102154">out</span><span class="op" id="7102157">,</span>&nbsp;<span class="ident" id="7102159">src</span><span class="op" id="7102162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102169">}</span><br>
<span class="lineno">480</span><span class="op" id="7102171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7102174">func</span>&nbsp;<span class="ident" id="7102179">TestBaseIndent</span><span class="op" id="7102193">(</span><span class="ident" id="7102194">t</span>&nbsp;<span class="op" id="7102196">*</span><span class="ident" id="7102197">testing</span><span class="op" id="7102204">.</span><span class="ident" id="7102205">T</span><span class="op" id="7102206">)</span>&nbsp;<span class="op" id="7102208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7102211">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7102280">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7102349">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102369">const</span>&nbsp;<span class="ident" id="7102375">filename</span>&nbsp;<span class="op" id="7102384">=</span>&nbsp;<span class="string" id="7102386">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102400">src</span><span class="op" id="7102403">,</span>&nbsp;<span class="ident" id="7102405">err</span>&nbsp;<span class="op" id="7102409">:=</span>&nbsp;<span class="ident" id="7102412">ioutil</span><span class="op" id="7102418">.</span><span class="ident" id="7102419">ReadFile</span><span class="op" id="7102427">(</span><span class="ident" id="7102428">filename</span><span class="op" id="7102436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102439">if</span>&nbsp;<span class="ident" id="7102442">err</span>&nbsp;<span class="op" id="7102446">!=</span>&nbsp;<span class="ident" id="7102449">nil</span>&nbsp;<span class="op" id="7102453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7102457">panic</span><span class="op" id="7102462">(</span><span class="ident" id="7102463">err</span><span class="op" id="7102466">)</span>&nbsp;<span class="comment" id="7102468">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102490">file</span><span class="op" id="7102494">,</span>&nbsp;<span class="ident" id="7102496">err</span>&nbsp;<span class="op" id="7102500">:=</span>&nbsp;<span class="ident" id="7102503">parser</span><span class="op" id="7102509">.</span><span class="ident" id="7102510">ParseFile</span><span class="op" id="7102519">(</span><span class="ident" id="7102520">fset</span><span class="op" id="7102524">,</span>&nbsp;<span class="ident" id="7102526">filename</span><span class="op" id="7102534">,</span>&nbsp;<span class="ident" id="7102536">src</span><span class="op" id="7102539">,</span>&nbsp;<span class="num" id="7102541">0</span><span class="op" id="7102542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102545">if</span>&nbsp;<span class="ident" id="7102548">err</span>&nbsp;<span class="op" id="7102552">!=</span>&nbsp;<span class="ident" id="7102555">nil</span>&nbsp;<span class="op" id="7102559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7102563">panic</span><span class="op" id="7102568">(</span><span class="ident" id="7102569">err</span><span class="op" id="7102572">)</span>&nbsp;<span class="comment" id="7102574">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102596">var</span>&nbsp;<span class="ident" id="7102600">buf</span>&nbsp;<span class="ident" id="7102604">bytes</span><span class="op" id="7102609">.</span><span class="ident" id="7102610">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102618">for</span>&nbsp;<span class="ident" id="7102622">indent</span>&nbsp;<span class="op" id="7102629">:=</span>&nbsp;<span class="num" id="7102632">0</span><span class="op" id="7102633">;</span>&nbsp;<span class="ident" id="7102635">indent</span>&nbsp;<span class="op" id="7102642">&lt;</span>&nbsp;<span class="num" id="7102644">4</span><span class="op" id="7102645">;</span>&nbsp;<span class="ident" id="7102647">indent</span><span class="op" id="7102653">++</span>&nbsp;<span class="op" id="7102656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102660">buf</span><span class="op" id="7102663">.</span><span class="ident" id="7102664">Reset</span><span class="op" id="7102669">(</span><span class="op" id="7102670">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102674">(</span><span class="op" id="7102675">&amp;</span><span class="ident" id="7102676">Config</span><span class="op" id="7102682">{</span><span class="ident" id="7102683">Tabwidth</span><span class="op" id="7102691">:</span>&nbsp;<span class="ident" id="7102693">tabwidth</span><span class="op" id="7102701">,</span>&nbsp;<span class="ident" id="7102703">Indent</span><span class="op" id="7102709">:</span>&nbsp;<span class="ident" id="7102711">indent</span><span class="op" id="7102717">}</span><span class="op" id="7102718">)</span><span class="op" id="7102719">.</span><span class="ident" id="7102720">Fprint</span><span class="op" id="7102726">(</span><span class="op" id="7102727">&amp;</span><span class="ident" id="7102728">buf</span><span class="op" id="7102731">,</span>&nbsp;<span class="ident" id="7102733">fset</span><span class="op" id="7102737">,</span>&nbsp;<span class="ident" id="7102739">file</span><span class="op" id="7102743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7102747">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102804">lines</span>&nbsp;<span class="op" id="7102810">:=</span>&nbsp;<span class="ident" id="7102813">bytes</span><span class="op" id="7102818">.</span><span class="ident" id="7102819">Split</span><span class="op" id="7102824">(</span><span class="ident" id="7102825">buf</span><span class="op" id="7102828">.</span><span class="ident" id="7102829">Bytes</span><span class="op" id="7102834">(</span><span class="op" id="7102835">)</span><span class="op" id="7102836">,</span>&nbsp;<span class="op" id="7102838">[</span><span class="op" id="7102839">]</span><span class="builtintype" id="7102840">byte</span><span class="op" id="7102844">{</span><span class="string" id="7102845">&#39;\n&#39;</span><span class="op" id="7102849">}</span><span class="op" id="7102850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102854">for</span>&nbsp;<span class="ident" id="7102858">i</span><span class="op" id="7102859">,</span>&nbsp;<span class="ident" id="7102861">line</span>&nbsp;<span class="op" id="7102866">:=</span>&nbsp;<span class="keyword" id="7102869">range</span>&nbsp;<span class="ident" id="7102875">lines</span>&nbsp;<span class="op" id="7102881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102886">if</span>&nbsp;<span class="builtinfunc" id="7102889">len</span><span class="op" id="7102892">(</span><span class="ident" id="7102893">line</span><span class="op" id="7102897">)</span>&nbsp;<span class="op" id="7102899">==</span>&nbsp;<span class="num" id="7102902">0</span>&nbsp;<span class="op" id="7102904">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102910">continue</span>&nbsp;<span class="comment" id="7102919">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7102960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7102965">n</span>&nbsp;<span class="op" id="7102967">:=</span>&nbsp;<span class="num" id="7102970">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7102975">for</span>&nbsp;<span class="ident" id="7102979">j</span><span class="op" id="7102980">,</span>&nbsp;<span class="ident" id="7102982">b</span>&nbsp;<span class="op" id="7102984">:=</span>&nbsp;<span class="keyword" id="7102987">range</span>&nbsp;<span class="ident" id="7102993">line</span>&nbsp;<span class="op" id="7102998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103004">if</span>&nbsp;<span class="ident" id="7103007">b</span>&nbsp;<span class="op" id="7103009">!=</span>&nbsp;<span class="string" id="7103012">&#39;\t&#39;</span>&nbsp;<span class="op" id="7103017">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7103024">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103051">n</span>&nbsp;<span class="op" id="7103053">=</span>&nbsp;<span class="ident" id="7103055">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103062">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103077">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103082">if</span>&nbsp;<span class="ident" id="7103085">n</span>&nbsp;<span class="op" id="7103087">&lt;</span>&nbsp;<span class="ident" id="7103089">indent</span>&nbsp;<span class="op" id="7103096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103102">t</span><span class="op" id="7103103">.</span><span class="ident" id="7103104">Errorf</span><span class="op" id="7103110">(</span><span class="string" id="7103111">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7103160">,</span>&nbsp;<span class="ident" id="7103162">i</span><span class="op" id="7103163">,</span>&nbsp;<span class="ident" id="7103165">n</span><span class="op" id="7103166">,</span>&nbsp;<span class="ident" id="7103168">indent</span><span class="op" id="7103174">,</span>&nbsp;<span class="ident" id="7103176">line</span><span class="op" id="7103180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103192">}</span><br>
<span class="lineno">520</span><span class="op" id="7103194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7103197">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7103264">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7103336">func</span>&nbsp;<span class="ident" id="7103341">TestFuncType</span><span class="op" id="7103353">(</span><span class="ident" id="7103354">t</span>&nbsp;<span class="op" id="7103356">*</span><span class="ident" id="7103357">testing</span><span class="op" id="7103364">.</span><span class="ident" id="7103365">T</span><span class="op" id="7103366">)</span>&nbsp;<span class="op" id="7103368">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103371">src</span>&nbsp;<span class="op" id="7103375">:=</span>&nbsp;<span class="op" id="7103378">&amp;</span><span class="ident" id="7103379">ast</span><span class="op" id="7103382">.</span><span class="ident" id="7103383">File</span><span class="op" id="7103387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103391">Name</span><span class="op" id="7103395">:</span>&nbsp;<span class="op" id="7103397">&amp;</span><span class="ident" id="7103398">ast</span><span class="op" id="7103401">.</span><span class="ident" id="7103402">Ident</span><span class="op" id="7103407">{</span><span class="ident" id="7103408">Name</span><span class="op" id="7103412">:</span>&nbsp;<span class="string" id="7103414">&#34;p&#34;</span><span class="op" id="7103417">}</span><span class="op" id="7103418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103422">Decls</span><span class="op" id="7103427">:</span>&nbsp;<span class="op" id="7103429">[</span><span class="op" id="7103430">]</span><span class="ident" id="7103431">ast</span><span class="op" id="7103434">.</span><span class="ident" id="7103435">Decl</span><span class="op" id="7103439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103444">&amp;</span><span class="ident" id="7103445">ast</span><span class="op" id="7103448">.</span><span class="ident" id="7103449">FuncDecl</span><span class="op" id="7103457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103463">Name</span><span class="op" id="7103467">:</span>&nbsp;<span class="op" id="7103469">&amp;</span><span class="ident" id="7103470">ast</span><span class="op" id="7103473">.</span><span class="ident" id="7103474">Ident</span><span class="op" id="7103479">{</span><span class="ident" id="7103480">Name</span><span class="op" id="7103484">:</span>&nbsp;<span class="string" id="7103486">&#34;f&#34;</span><span class="op" id="7103489">}</span><span class="op" id="7103490">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103496">Type</span><span class="op" id="7103500">:</span>&nbsp;<span class="op" id="7103502">&amp;</span><span class="ident" id="7103503">ast</span><span class="op" id="7103506">.</span><span class="ident" id="7103507">FuncType</span><span class="op" id="7103515">{</span><span class="op" id="7103516">}</span><span class="op" id="7103517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103522">}</span><span class="op" id="7103523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103527">}</span><span class="op" id="7103528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103535">var</span>&nbsp;<span class="ident" id="7103539">buf</span>&nbsp;<span class="ident" id="7103543">bytes</span><span class="op" id="7103548">.</span><span class="ident" id="7103549">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103557">if</span>&nbsp;<span class="ident" id="7103560">err</span>&nbsp;<span class="op" id="7103564">:=</span>&nbsp;<span class="ident" id="7103567">Fprint</span><span class="op" id="7103573">(</span><span class="op" id="7103574">&amp;</span><span class="ident" id="7103575">buf</span><span class="op" id="7103578">,</span>&nbsp;<span class="ident" id="7103580">fset</span><span class="op" id="7103584">,</span>&nbsp;<span class="ident" id="7103586">src</span><span class="op" id="7103589">)</span><span class="op" id="7103590">;</span>&nbsp;<span class="ident" id="7103592">err</span>&nbsp;<span class="op" id="7103596">!=</span>&nbsp;<span class="ident" id="7103599">nil</span>&nbsp;<span class="op" id="7103603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103607">t</span><span class="op" id="7103608">.</span><span class="ident" id="7103609">Fatal</span><span class="op" id="7103614">(</span><span class="ident" id="7103615">err</span><span class="op" id="7103618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103624">got</span>&nbsp;<span class="op" id="7103628">:=</span>&nbsp;<span class="ident" id="7103631">buf</span><span class="op" id="7103634">.</span><span class="ident" id="7103635">String</span><span class="op" id="7103641">(</span><span class="op" id="7103642">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103646">const</span>&nbsp;<span class="ident" id="7103652">want</span>&nbsp;<span class="op" id="7103657">=</span>&nbsp;<span class="string" id="7103659">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103684">if</span>&nbsp;<span class="ident" id="7103687">got</span>&nbsp;<span class="op" id="7103691">!=</span>&nbsp;<span class="ident" id="7103694">want</span>&nbsp;<span class="op" id="7103699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103703">t</span><span class="op" id="7103704">.</span><span class="ident" id="7103705">Fatalf</span><span class="op" id="7103711">(</span><span class="string" id="7103712">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7103735">,</span>&nbsp;<span class="ident" id="7103737">got</span><span class="op" id="7103740">,</span>&nbsp;<span class="ident" id="7103742">want</span><span class="op" id="7103746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103749">}</span><br>
<span class="lineno"></span><span class="op" id="7103751">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7103754">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7103833">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7103851">func</span>&nbsp;<span class="ident" id="7103856">TestX</span><span class="op" id="7103861">(</span><span class="ident" id="7103862">t</span>&nbsp;<span class="op" id="7103864">*</span><span class="ident" id="7103865">testing</span><span class="op" id="7103872">.</span><span class="ident" id="7103873">T</span><span class="op" id="7103874">)</span>&nbsp;<span class="op" id="7103876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103879">const</span>&nbsp;<span class="ident" id="7103885">src</span>&nbsp;<span class="op" id="7103889">=</span>&nbsp;<span class="string" id="7103891">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103918">_</span><span class="op" id="7103919">,</span>&nbsp;<span class="ident" id="7103921">err</span>&nbsp;<span class="op" id="7103925">:=</span>&nbsp;<span class="ident" id="7103928">format</span><span class="op" id="7103934">(</span><span class="op" id="7103935">[</span><span class="op" id="7103936">]</span><span class="builtintype" id="7103937">byte</span><span class="op" id="7103941">(</span><span class="ident" id="7103942">src</span><span class="op" id="7103945">)</span><span class="op" id="7103946">,</span>&nbsp;<span class="num" id="7103948">0</span><span class="op" id="7103949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7103952">if</span>&nbsp;<span class="ident" id="7103955">err</span>&nbsp;<span class="op" id="7103959">!=</span>&nbsp;<span class="ident" id="7103962">nil</span>&nbsp;<span class="op" id="7103966">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7103970">t</span><span class="op" id="7103971">.</span><span class="ident" id="7103972">Error</span><span class="op" id="7103977">(</span><span class="ident" id="7103978">err</span><span class="op" id="7103981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7103984">}</span><br>
<span class="lineno"></span><span class="op" id="7103986">}</span>
</div>
</body>
</html>
