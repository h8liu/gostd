<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8244203">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8244259">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8244313">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8244364">package</span>&nbsp;<span class="ident" id="8244372">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244377">import</span>&nbsp;<span class="op" id="8244384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244387">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244396">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244403">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244409">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244420">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244431">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8244442">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8244449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244452">type</span>&nbsp;<span class="ident" id="8244457">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="8244475">struct</span>&nbsp;<span class="op" id="8244482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244485">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8244499">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244507">litAddrOrName</span>&nbsp;<span class="builtintype" id="8244521">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244529">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8244543">*</span><span class="ident" id="8244544">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244552">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8244566">error</span><br>
<span class="lineno"></span><span class="op" id="8244572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8244575">var</span>&nbsp;<span class="ident" id="8244579">resolveIPAddrTests</span>&nbsp;<span class="op" id="8244598">=</span>&nbsp;<span class="op" id="8244600">[</span><span class="op" id="8244601">]</span><span class="ident" id="8244602">resolveIPAddrTest</span><span class="op" id="8244619">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244622">{</span><span class="string" id="8244623">&#34;ip&#34;</span><span class="op" id="8244627">,</span>&nbsp;<span class="string" id="8244629">&#34;127.0.0.1&#34;</span><span class="op" id="8244640">,</span>&nbsp;<span class="op" id="8244642">&amp;</span><span class="ident" id="8244643">IPAddr</span><span class="op" id="8244649">{</span><span class="ident" id="8244650">IP</span><span class="op" id="8244652">:</span>&nbsp;<span class="ident" id="8244654">IPv4</span><span class="op" id="8244658">(</span><span class="num" id="8244659">127</span><span class="op" id="8244662">,</span>&nbsp;<span class="num" id="8244664">0</span><span class="op" id="8244665">,</span>&nbsp;<span class="num" id="8244667">0</span><span class="op" id="8244668">,</span>&nbsp;<span class="num" id="8244670">1</span><span class="op" id="8244671">)</span><span class="op" id="8244672">}</span><span class="op" id="8244673">,</span>&nbsp;<span class="ident" id="8244675">nil</span><span class="op" id="8244678">}</span><span class="op" id="8244679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244682">{</span><span class="string" id="8244683">&#34;ip4&#34;</span><span class="op" id="8244688">,</span>&nbsp;<span class="string" id="8244690">&#34;127.0.0.1&#34;</span><span class="op" id="8244701">,</span>&nbsp;<span class="op" id="8244703">&amp;</span><span class="ident" id="8244704">IPAddr</span><span class="op" id="8244710">{</span><span class="ident" id="8244711">IP</span><span class="op" id="8244713">:</span>&nbsp;<span class="ident" id="8244715">IPv4</span><span class="op" id="8244719">(</span><span class="num" id="8244720">127</span><span class="op" id="8244723">,</span>&nbsp;<span class="num" id="8244725">0</span><span class="op" id="8244726">,</span>&nbsp;<span class="num" id="8244728">0</span><span class="op" id="8244729">,</span>&nbsp;<span class="num" id="8244731">1</span><span class="op" id="8244732">)</span><span class="op" id="8244733">}</span><span class="op" id="8244734">,</span>&nbsp;<span class="ident" id="8244736">nil</span><span class="op" id="8244739">}</span><span class="op" id="8244740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244743">{</span><span class="string" id="8244744">&#34;ip4:icmp&#34;</span><span class="op" id="8244754">,</span>&nbsp;<span class="string" id="8244756">&#34;127.0.0.1&#34;</span><span class="op" id="8244767">,</span>&nbsp;<span class="op" id="8244769">&amp;</span><span class="ident" id="8244770">IPAddr</span><span class="op" id="8244776">{</span><span class="ident" id="8244777">IP</span><span class="op" id="8244779">:</span>&nbsp;<span class="ident" id="8244781">IPv4</span><span class="op" id="8244785">(</span><span class="num" id="8244786">127</span><span class="op" id="8244789">,</span>&nbsp;<span class="num" id="8244791">0</span><span class="op" id="8244792">,</span>&nbsp;<span class="num" id="8244794">0</span><span class="op" id="8244795">,</span>&nbsp;<span class="num" id="8244797">1</span><span class="op" id="8244798">)</span><span class="op" id="8244799">}</span><span class="op" id="8244800">,</span>&nbsp;<span class="ident" id="8244802">nil</span><span class="op" id="8244805">}</span><span class="op" id="8244806">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244810">{</span><span class="string" id="8244811">&#34;ip&#34;</span><span class="op" id="8244815">,</span>&nbsp;<span class="string" id="8244817">&#34;::1&#34;</span><span class="op" id="8244822">,</span>&nbsp;<span class="op" id="8244824">&amp;</span><span class="ident" id="8244825">IPAddr</span><span class="op" id="8244831">{</span><span class="ident" id="8244832">IP</span><span class="op" id="8244834">:</span>&nbsp;<span class="ident" id="8244836">ParseIP</span><span class="op" id="8244843">(</span><span class="string" id="8244844">&#34;::1&#34;</span><span class="op" id="8244849">)</span><span class="op" id="8244850">}</span><span class="op" id="8244851">,</span>&nbsp;<span class="ident" id="8244853">nil</span><span class="op" id="8244856">}</span><span class="op" id="8244857">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244860">{</span><span class="string" id="8244861">&#34;ip6&#34;</span><span class="op" id="8244866">,</span>&nbsp;<span class="string" id="8244868">&#34;::1&#34;</span><span class="op" id="8244873">,</span>&nbsp;<span class="op" id="8244875">&amp;</span><span class="ident" id="8244876">IPAddr</span><span class="op" id="8244882">{</span><span class="ident" id="8244883">IP</span><span class="op" id="8244885">:</span>&nbsp;<span class="ident" id="8244887">ParseIP</span><span class="op" id="8244894">(</span><span class="string" id="8244895">&#34;::1&#34;</span><span class="op" id="8244900">)</span><span class="op" id="8244901">}</span><span class="op" id="8244902">,</span>&nbsp;<span class="ident" id="8244904">nil</span><span class="op" id="8244907">}</span><span class="op" id="8244908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244911">{</span><span class="string" id="8244912">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8244927">,</span>&nbsp;<span class="string" id="8244929">&#34;::1&#34;</span><span class="op" id="8244934">,</span>&nbsp;<span class="op" id="8244936">&amp;</span><span class="ident" id="8244937">IPAddr</span><span class="op" id="8244943">{</span><span class="ident" id="8244944">IP</span><span class="op" id="8244946">:</span>&nbsp;<span class="ident" id="8244948">ParseIP</span><span class="op" id="8244955">(</span><span class="string" id="8244956">&#34;::1&#34;</span><span class="op" id="8244961">)</span><span class="op" id="8244962">}</span><span class="op" id="8244963">,</span>&nbsp;<span class="ident" id="8244965">nil</span><span class="op" id="8244968">}</span><span class="op" id="8244969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244972">{</span><span class="string" id="8244973">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="8244988">,</span>&nbsp;<span class="string" id="8244990">&#34;::1&#34;</span><span class="op" id="8244995">,</span>&nbsp;<span class="op" id="8244997">&amp;</span><span class="ident" id="8244998">IPAddr</span><span class="op" id="8245004">{</span><span class="ident" id="8245005">IP</span><span class="op" id="8245007">:</span>&nbsp;<span class="ident" id="8245009">ParseIP</span><span class="op" id="8245016">(</span><span class="string" id="8245017">&#34;::1&#34;</span><span class="op" id="8245022">)</span><span class="op" id="8245023">}</span><span class="op" id="8245024">,</span>&nbsp;<span class="ident" id="8245026">nil</span><span class="op" id="8245029">}</span><span class="op" id="8245030">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245034">{</span><span class="string" id="8245035">&#34;ip&#34;</span><span class="op" id="8245039">,</span>&nbsp;<span class="string" id="8245041">&#34;::1%en0&#34;</span><span class="op" id="8245050">,</span>&nbsp;<span class="op" id="8245052">&amp;</span><span class="ident" id="8245053">IPAddr</span><span class="op" id="8245059">{</span><span class="ident" id="8245060">IP</span><span class="op" id="8245062">:</span>&nbsp;<span class="ident" id="8245064">ParseIP</span><span class="op" id="8245071">(</span><span class="string" id="8245072">&#34;::1&#34;</span><span class="op" id="8245077">)</span><span class="op" id="8245078">,</span>&nbsp;<span class="ident" id="8245080">Zone</span><span class="op" id="8245084">:</span>&nbsp;<span class="string" id="8245086">&#34;en0&#34;</span><span class="op" id="8245091">}</span><span class="op" id="8245092">,</span>&nbsp;<span class="ident" id="8245094">nil</span><span class="op" id="8245097">}</span><span class="op" id="8245098">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245101">{</span><span class="string" id="8245102">&#34;ip6&#34;</span><span class="op" id="8245107">,</span>&nbsp;<span class="string" id="8245109">&#34;::1%911&#34;</span><span class="op" id="8245118">,</span>&nbsp;<span class="op" id="8245120">&amp;</span><span class="ident" id="8245121">IPAddr</span><span class="op" id="8245127">{</span><span class="ident" id="8245128">IP</span><span class="op" id="8245130">:</span>&nbsp;<span class="ident" id="8245132">ParseIP</span><span class="op" id="8245139">(</span><span class="string" id="8245140">&#34;::1&#34;</span><span class="op" id="8245145">)</span><span class="op" id="8245146">,</span>&nbsp;<span class="ident" id="8245148">Zone</span><span class="op" id="8245152">:</span>&nbsp;<span class="string" id="8245154">&#34;911&#34;</span><span class="op" id="8245159">}</span><span class="op" id="8245160">,</span>&nbsp;<span class="ident" id="8245162">nil</span><span class="op" id="8245165">}</span><span class="op" id="8245166">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245170">{</span><span class="string" id="8245171">&#34;&#34;</span><span class="op" id="8245173">,</span>&nbsp;<span class="string" id="8245175">&#34;127.0.0.1&#34;</span><span class="op" id="8245186">,</span>&nbsp;<span class="op" id="8245188">&amp;</span><span class="ident" id="8245189">IPAddr</span><span class="op" id="8245195">{</span><span class="ident" id="8245196">IP</span><span class="op" id="8245198">:</span>&nbsp;<span class="ident" id="8245200">IPv4</span><span class="op" id="8245204">(</span><span class="num" id="8245205">127</span><span class="op" id="8245208">,</span>&nbsp;<span class="num" id="8245210">0</span><span class="op" id="8245211">,</span>&nbsp;<span class="num" id="8245213">0</span><span class="op" id="8245214">,</span>&nbsp;<span class="num" id="8245216">1</span><span class="op" id="8245217">)</span><span class="op" id="8245218">}</span><span class="op" id="8245219">,</span>&nbsp;<span class="ident" id="8245221">nil</span><span class="op" id="8245224">}</span><span class="op" id="8245225">,</span>&nbsp;<span class="comment" id="8245227">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245247">{</span><span class="string" id="8245248">&#34;&#34;</span><span class="op" id="8245250">,</span>&nbsp;<span class="string" id="8245252">&#34;::1&#34;</span><span class="op" id="8245257">,</span>&nbsp;<span class="op" id="8245259">&amp;</span><span class="ident" id="8245260">IPAddr</span><span class="op" id="8245266">{</span><span class="ident" id="8245267">IP</span><span class="op" id="8245269">:</span>&nbsp;<span class="ident" id="8245271">ParseIP</span><span class="op" id="8245278">(</span><span class="string" id="8245279">&#34;::1&#34;</span><span class="op" id="8245284">)</span><span class="op" id="8245285">}</span><span class="op" id="8245286">,</span>&nbsp;<span class="ident" id="8245288">nil</span><span class="op" id="8245291">}</span><span class="op" id="8245292">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8245304">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245325">{</span><span class="string" id="8245326">&#34;l2tp&#34;</span><span class="op" id="8245332">,</span>&nbsp;<span class="string" id="8245334">&#34;127.0.0.1&#34;</span><span class="op" id="8245345">,</span>&nbsp;<span class="ident" id="8245347">nil</span><span class="op" id="8245350">,</span>&nbsp;<span class="ident" id="8245352">UnknownNetworkError</span><span class="op" id="8245371">(</span><span class="string" id="8245372">&#34;l2tp&#34;</span><span class="op" id="8245378">)</span><span class="op" id="8245379">}</span><span class="op" id="8245380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245383">{</span><span class="string" id="8245384">&#34;l2tp:gre&#34;</span><span class="op" id="8245394">,</span>&nbsp;<span class="string" id="8245396">&#34;127.0.0.1&#34;</span><span class="op" id="8245407">,</span>&nbsp;<span class="ident" id="8245409">nil</span><span class="op" id="8245412">,</span>&nbsp;<span class="ident" id="8245414">UnknownNetworkError</span><span class="op" id="8245433">(</span><span class="string" id="8245434">&#34;l2tp:gre&#34;</span><span class="op" id="8245444">)</span><span class="op" id="8245445">}</span><span class="op" id="8245446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245449">{</span><span class="string" id="8245450">&#34;tcp&#34;</span><span class="op" id="8245455">,</span>&nbsp;<span class="string" id="8245457">&#34;1.2.3.4:123&#34;</span><span class="op" id="8245470">,</span>&nbsp;<span class="ident" id="8245472">nil</span><span class="op" id="8245475">,</span>&nbsp;<span class="ident" id="8245477">UnknownNetworkError</span><span class="op" id="8245496">(</span><span class="string" id="8245497">&#34;tcp&#34;</span><span class="op" id="8245502">)</span><span class="op" id="8245503">}</span><span class="op" id="8245504">,</span><br>
<span class="lineno"></span><span class="op" id="8245506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8245509">func</span>&nbsp;<span class="ident" id="8245514">init</span><span class="op" id="8245518">(</span><span class="op" id="8245519">)</span>&nbsp;<span class="op" id="8245521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245524">if</span>&nbsp;<span class="ident" id="8245527">ifi</span>&nbsp;<span class="op" id="8245531">:=</span>&nbsp;<span class="ident" id="8245534">loopbackInterface</span><span class="op" id="8245551">(</span><span class="op" id="8245552">)</span><span class="op" id="8245553">;</span>&nbsp;<span class="ident" id="8245555">ifi</span>&nbsp;<span class="op" id="8245559">!=</span>&nbsp;<span class="ident" id="8245562">nil</span>&nbsp;<span class="op" id="8245566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245570">index</span>&nbsp;<span class="op" id="8245576">:=</span>&nbsp;<span class="ident" id="8245579">fmt</span><span class="op" id="8245582">.</span><span class="ident" id="8245583">Sprintf</span><span class="op" id="8245590">(</span><span class="string" id="8245591">&#34;%v&#34;</span><span class="op" id="8245595">,</span>&nbsp;<span class="ident" id="8245597">ifi</span><span class="op" id="8245600">.</span><span class="ident" id="8245601">Index</span><span class="op" id="8245606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245610">resolveIPAddrTests</span>&nbsp;<span class="op" id="8245629">=</span>&nbsp;<span class="builtinfunc" id="8245631">append</span><span class="op" id="8245637">(</span><span class="ident" id="8245638">resolveIPAddrTests</span><span class="op" id="8245656">,</span>&nbsp;<span class="op" id="8245658">[</span><span class="op" id="8245659">]</span><span class="ident" id="8245660">resolveIPAddrTest</span><span class="op" id="8245677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245682">{</span><span class="string" id="8245683">&#34;ip6&#34;</span><span class="op" id="8245688">,</span>&nbsp;<span class="string" id="8245690">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8245701">+</span>&nbsp;<span class="ident" id="8245703">ifi</span><span class="op" id="8245706">.</span><span class="ident" id="8245707">Name</span><span class="op" id="8245711">,</span>&nbsp;<span class="op" id="8245713">&amp;</span><span class="ident" id="8245714">IPAddr</span><span class="op" id="8245720">{</span><span class="ident" id="8245721">IP</span><span class="op" id="8245723">:</span>&nbsp;<span class="ident" id="8245725">ParseIP</span><span class="op" id="8245732">(</span><span class="string" id="8245733">&#34;fe80::1&#34;</span><span class="op" id="8245742">)</span><span class="op" id="8245743">,</span>&nbsp;<span class="ident" id="8245745">Zone</span><span class="op" id="8245749">:</span>&nbsp;<span class="ident" id="8245751">zoneToString</span><span class="op" id="8245763">(</span><span class="ident" id="8245764">ifi</span><span class="op" id="8245767">.</span><span class="ident" id="8245768">Index</span><span class="op" id="8245773">)</span><span class="op" id="8245774">}</span><span class="op" id="8245775">,</span>&nbsp;<span class="ident" id="8245777">nil</span><span class="op" id="8245780">}</span><span class="op" id="8245781">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245786">{</span><span class="string" id="8245787">&#34;ip6&#34;</span><span class="op" id="8245792">,</span>&nbsp;<span class="string" id="8245794">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8245805">+</span>&nbsp;<span class="ident" id="8245807">index</span><span class="op" id="8245812">,</span>&nbsp;<span class="op" id="8245814">&amp;</span><span class="ident" id="8245815">IPAddr</span><span class="op" id="8245821">{</span><span class="ident" id="8245822">IP</span><span class="op" id="8245824">:</span>&nbsp;<span class="ident" id="8245826">ParseIP</span><span class="op" id="8245833">(</span><span class="string" id="8245834">&#34;fe80::1&#34;</span><span class="op" id="8245843">)</span><span class="op" id="8245844">,</span>&nbsp;<span class="ident" id="8245846">Zone</span><span class="op" id="8245850">:</span>&nbsp;<span class="ident" id="8245852">index</span><span class="op" id="8245857">}</span><span class="op" id="8245858">,</span>&nbsp;<span class="ident" id="8245860">nil</span><span class="op" id="8245863">}</span><span class="op" id="8245864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245868">}</span><span class="op" id="8245869">...</span><span class="op" id="8245872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245878">if</span>&nbsp;<span class="ident" id="8245881">ips</span><span class="op" id="8245884">,</span>&nbsp;<span class="ident" id="8245886">err</span>&nbsp;<span class="op" id="8245890">:=</span>&nbsp;<span class="ident" id="8245893">LookupIP</span><span class="op" id="8245901">(</span><span class="string" id="8245902">&#34;localhost&#34;</span><span class="op" id="8245913">)</span><span class="op" id="8245914">;</span>&nbsp;<span class="ident" id="8245916">err</span>&nbsp;<span class="op" id="8245920">==</span>&nbsp;<span class="ident" id="8245923">nil</span>&nbsp;<span class="op" id="8245927">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8245930">len</span><span class="op" id="8245933">(</span><span class="ident" id="8245934">ips</span><span class="op" id="8245937">)</span>&nbsp;<span class="op" id="8245939">&gt;</span>&nbsp;<span class="num" id="8245941">1</span>&nbsp;<span class="op" id="8245943">&amp;&amp;</span>&nbsp;<span class="ident" id="8245946">supportsIPv4</span>&nbsp;<span class="op" id="8245959">&amp;&amp;</span>&nbsp;<span class="ident" id="8245962">supportsIPv6</span>&nbsp;<span class="op" id="8245975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245979">resolveIPAddrTests</span>&nbsp;<span class="op" id="8245998">=</span>&nbsp;<span class="builtinfunc" id="8246000">append</span><span class="op" id="8246006">(</span><span class="ident" id="8246007">resolveIPAddrTests</span><span class="op" id="8246025">,</span>&nbsp;<span class="op" id="8246027">[</span><span class="op" id="8246028">]</span><span class="ident" id="8246029">resolveIPAddrTest</span><span class="op" id="8246046">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246051">{</span><span class="string" id="8246052">&#34;ip&#34;</span><span class="op" id="8246056">,</span>&nbsp;<span class="string" id="8246058">&#34;localhost&#34;</span><span class="op" id="8246069">,</span>&nbsp;<span class="op" id="8246071">&amp;</span><span class="ident" id="8246072">IPAddr</span><span class="op" id="8246078">{</span><span class="ident" id="8246079">IP</span><span class="op" id="8246081">:</span>&nbsp;<span class="ident" id="8246083">IPv4</span><span class="op" id="8246087">(</span><span class="num" id="8246088">127</span><span class="op" id="8246091">,</span>&nbsp;<span class="num" id="8246093">0</span><span class="op" id="8246094">,</span>&nbsp;<span class="num" id="8246096">0</span><span class="op" id="8246097">,</span>&nbsp;<span class="num" id="8246099">1</span><span class="op" id="8246100">)</span><span class="op" id="8246101">}</span><span class="op" id="8246102">,</span>&nbsp;<span class="ident" id="8246104">nil</span><span class="op" id="8246107">}</span><span class="op" id="8246108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246113">{</span><span class="string" id="8246114">&#34;ip4&#34;</span><span class="op" id="8246119">,</span>&nbsp;<span class="string" id="8246121">&#34;localhost&#34;</span><span class="op" id="8246132">,</span>&nbsp;<span class="op" id="8246134">&amp;</span><span class="ident" id="8246135">IPAddr</span><span class="op" id="8246141">{</span><span class="ident" id="8246142">IP</span><span class="op" id="8246144">:</span>&nbsp;<span class="ident" id="8246146">IPv4</span><span class="op" id="8246150">(</span><span class="num" id="8246151">127</span><span class="op" id="8246154">,</span>&nbsp;<span class="num" id="8246156">0</span><span class="op" id="8246157">,</span>&nbsp;<span class="num" id="8246159">0</span><span class="op" id="8246160">,</span>&nbsp;<span class="num" id="8246162">1</span><span class="op" id="8246163">)</span><span class="op" id="8246164">}</span><span class="op" id="8246165">,</span>&nbsp;<span class="ident" id="8246167">nil</span><span class="op" id="8246170">}</span><span class="op" id="8246171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246176">{</span><span class="string" id="8246177">&#34;ip6&#34;</span><span class="op" id="8246182">,</span>&nbsp;<span class="string" id="8246184">&#34;localhost&#34;</span><span class="op" id="8246195">,</span>&nbsp;<span class="op" id="8246197">&amp;</span><span class="ident" id="8246198">IPAddr</span><span class="op" id="8246204">{</span><span class="ident" id="8246205">IP</span><span class="op" id="8246207">:</span>&nbsp;<span class="ident" id="8246209">IPv6loopback</span><span class="op" id="8246221">}</span><span class="op" id="8246222">,</span>&nbsp;<span class="ident" id="8246224">nil</span><span class="op" id="8246227">}</span><span class="op" id="8246228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246232">}</span><span class="op" id="8246233">...</span><span class="op" id="8246236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246239">}</span><br>
<span class="lineno">60</span><span class="op" id="8246241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8246244">func</span>&nbsp;<span class="ident" id="8246249">skipRawSocketTest</span><span class="op" id="8246266">(</span><span class="ident" id="8246267">t</span>&nbsp;<span class="op" id="8246269">*</span><span class="ident" id="8246270">testing</span><span class="op" id="8246277">.</span><span class="ident" id="8246278">T</span><span class="op" id="8246279">)</span>&nbsp;<span class="op" id="8246281">(</span><span class="ident" id="8246282">skip</span>&nbsp;<span class="builtintype" id="8246287">bool</span><span class="op" id="8246291">,</span>&nbsp;<span class="ident" id="8246293">skipmsg</span>&nbsp;<span class="builtintype" id="8246301">string</span><span class="op" id="8246307">)</span>&nbsp;<span class="op" id="8246309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246312">skip</span><span class="op" id="8246316">,</span>&nbsp;<span class="ident" id="8246318">skipmsg</span><span class="op" id="8246325">,</span>&nbsp;<span class="ident" id="8246327">err</span>&nbsp;<span class="op" id="8246331">:=</span>&nbsp;<span class="ident" id="8246334">skipRawSocketTests</span><span class="op" id="8246352">(</span><span class="op" id="8246353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246356">if</span>&nbsp;<span class="ident" id="8246359">err</span>&nbsp;<span class="op" id="8246363">!=</span>&nbsp;<span class="ident" id="8246366">nil</span>&nbsp;<span class="op" id="8246370">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246374">t</span><span class="op" id="8246375">.</span><span class="ident" id="8246376">Fatal</span><span class="op" id="8246381">(</span><span class="ident" id="8246382">err</span><span class="op" id="8246385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246391">return</span>&nbsp;<span class="ident" id="8246398">skip</span><span class="op" id="8246402">,</span>&nbsp;<span class="ident" id="8246404">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="8246412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8246415">func</span>&nbsp;<span class="ident" id="8246420">TestResolveIPAddr</span><span class="op" id="8246437">(</span><span class="ident" id="8246438">t</span>&nbsp;<span class="op" id="8246440">*</span><span class="ident" id="8246441">testing</span><span class="op" id="8246448">.</span><span class="ident" id="8246449">T</span><span class="op" id="8246450">)</span>&nbsp;<span class="op" id="8246452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246455">switch</span>&nbsp;<span class="ident" id="8246462">runtime</span><span class="op" id="8246469">.</span><span class="ident" id="8246470">GOOS</span>&nbsp;<span class="op" id="8246475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246478">case</span>&nbsp;<span class="string" id="8246483">&#34;nacl&#34;</span><span class="op" id="8246489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246493">t</span><span class="op" id="8246494">.</span><span class="ident" id="8246495">Skipf</span><span class="op" id="8246500">(</span><span class="string" id="8246501">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8246522">,</span>&nbsp;<span class="ident" id="8246524">runtime</span><span class="op" id="8246531">.</span><span class="ident" id="8246532">GOOS</span><span class="op" id="8246536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246539">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246543">for</span>&nbsp;<span class="ident" id="8246547">_</span><span class="op" id="8246548">,</span>&nbsp;<span class="ident" id="8246550">tt</span>&nbsp;<span class="op" id="8246553">:=</span>&nbsp;<span class="keyword" id="8246556">range</span>&nbsp;<span class="ident" id="8246562">resolveIPAddrTests</span>&nbsp;<span class="op" id="8246581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246585">addr</span><span class="op" id="8246589">,</span>&nbsp;<span class="ident" id="8246591">err</span>&nbsp;<span class="op" id="8246595">:=</span>&nbsp;<span class="ident" id="8246598">ResolveIPAddr</span><span class="op" id="8246611">(</span><span class="ident" id="8246612">tt</span><span class="op" id="8246614">.</span><span class="ident" id="8246615">net</span><span class="op" id="8246618">,</span>&nbsp;<span class="ident" id="8246620">tt</span><span class="op" id="8246622">.</span><span class="ident" id="8246623">litAddrOrName</span><span class="op" id="8246636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246640">if</span>&nbsp;<span class="ident" id="8246643">err</span>&nbsp;<span class="op" id="8246647">!=</span>&nbsp;<span class="ident" id="8246650">tt</span><span class="op" id="8246652">.</span><span class="ident" id="8246653">err</span>&nbsp;<span class="op" id="8246657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246662">t</span><span class="op" id="8246663">.</span><span class="ident" id="8246664">Fatalf</span><span class="op" id="8246670">(</span><span class="string" id="8246671">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8246705">,</span>&nbsp;<span class="ident" id="8246707">tt</span><span class="op" id="8246709">.</span><span class="ident" id="8246710">net</span><span class="op" id="8246713">,</span>&nbsp;<span class="ident" id="8246715">tt</span><span class="op" id="8246717">.</span><span class="ident" id="8246718">litAddrOrName</span><span class="op" id="8246731">,</span>&nbsp;<span class="ident" id="8246733">err</span><span class="op" id="8246736">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246740">}</span>&nbsp;<span class="keyword" id="8246742">else</span>&nbsp;<span class="keyword" id="8246747">if</span>&nbsp;<span class="op" id="8246750">!</span><span class="ident" id="8246751">reflect</span><span class="op" id="8246758">.</span><span class="ident" id="8246759">DeepEqual</span><span class="op" id="8246768">(</span><span class="ident" id="8246769">addr</span><span class="op" id="8246773">,</span>&nbsp;<span class="ident" id="8246775">tt</span><span class="op" id="8246777">.</span><span class="ident" id="8246778">addr</span><span class="op" id="8246782">)</span>&nbsp;<span class="op" id="8246784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246789">t</span><span class="op" id="8246790">.</span><span class="ident" id="8246791">Fatalf</span><span class="op" id="8246797">(</span><span class="string" id="8246798">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8246821">,</span>&nbsp;<span class="ident" id="8246823">addr</span><span class="op" id="8246827">,</span>&nbsp;<span class="ident" id="8246829">tt</span><span class="op" id="8246831">.</span><span class="ident" id="8246832">addr</span><span class="op" id="8246836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246843">}</span><br>
<span class="lineno"></span><span class="op" id="8246845">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8246848">var</span>&nbsp;<span class="ident" id="8246852">icmpEchoTests</span>&nbsp;<span class="op" id="8246866">=</span>&nbsp;<span class="op" id="8246868">[</span><span class="op" id="8246869">]</span><span class="keyword" id="8246870">struct</span>&nbsp;<span class="op" id="8246877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246880">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8246886">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246894">laddr</span>&nbsp;<span class="builtintype" id="8246900">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246908">raddr</span>&nbsp;<span class="builtintype" id="8246914">string</span><br>
<span class="lineno">90</span><span class="op" id="8246921">}</span><span class="op" id="8246922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246925">{</span><span class="string" id="8246926">&#34;ip4:icmp&#34;</span><span class="op" id="8246936">,</span>&nbsp;<span class="string" id="8246938">&#34;0.0.0.0&#34;</span><span class="op" id="8246947">,</span>&nbsp;<span class="string" id="8246949">&#34;127.0.0.1&#34;</span><span class="op" id="8246960">}</span><span class="op" id="8246961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246964">{</span><span class="string" id="8246965">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8246980">,</span>&nbsp;<span class="string" id="8246982">&#34;::&#34;</span><span class="op" id="8246986">,</span>&nbsp;<span class="string" id="8246988">&#34;::1&#34;</span><span class="op" id="8246993">}</span><span class="op" id="8246994">,</span><br>
<span class="lineno"></span><span class="op" id="8246996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8246999">func</span>&nbsp;<span class="ident" id="8247004">TestConnICMPEcho</span><span class="op" id="8247020">(</span><span class="ident" id="8247021">t</span>&nbsp;<span class="op" id="8247023">*</span><span class="ident" id="8247024">testing</span><span class="op" id="8247031">.</span><span class="ident" id="8247032">T</span><span class="op" id="8247033">)</span>&nbsp;<span class="op" id="8247035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247038">if</span>&nbsp;<span class="ident" id="8247041">skip</span><span class="op" id="8247045">,</span>&nbsp;<span class="ident" id="8247047">skipmsg</span>&nbsp;<span class="op" id="8247055">:=</span>&nbsp;<span class="ident" id="8247058">skipRawSocketTest</span><span class="op" id="8247075">(</span><span class="ident" id="8247076">t</span><span class="op" id="8247077">)</span><span class="op" id="8247078">;</span>&nbsp;<span class="ident" id="8247080">skip</span>&nbsp;<span class="op" id="8247085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247089">t</span><span class="op" id="8247090">.</span><span class="ident" id="8247091">Skip</span><span class="op" id="8247095">(</span><span class="ident" id="8247096">skipmsg</span><span class="op" id="8247103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247110">for</span>&nbsp;<span class="ident" id="8247114">i</span><span class="op" id="8247115">,</span>&nbsp;<span class="ident" id="8247117">tt</span>&nbsp;<span class="op" id="8247120">:=</span>&nbsp;<span class="keyword" id="8247123">range</span>&nbsp;<span class="ident" id="8247129">icmpEchoTests</span>&nbsp;<span class="op" id="8247143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247147">net</span><span class="op" id="8247150">,</span>&nbsp;<span class="ident" id="8247152">_</span><span class="op" id="8247153">,</span>&nbsp;<span class="ident" id="8247155">err</span>&nbsp;<span class="op" id="8247159">:=</span>&nbsp;<span class="ident" id="8247162">parseNetwork</span><span class="op" id="8247174">(</span><span class="ident" id="8247175">tt</span><span class="op" id="8247177">.</span><span class="ident" id="8247178">net</span><span class="op" id="8247181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247185">if</span>&nbsp;<span class="ident" id="8247188">err</span>&nbsp;<span class="op" id="8247192">!=</span>&nbsp;<span class="ident" id="8247195">nil</span>&nbsp;<span class="op" id="8247199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247204">t</span><span class="op" id="8247205">.</span><span class="ident" id="8247206">Fatalf</span><span class="op" id="8247212">(</span><span class="string" id="8247213">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8247238">,</span>&nbsp;<span class="ident" id="8247240">err</span><span class="op" id="8247243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247247">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247251">if</span>&nbsp;<span class="ident" id="8247254">net</span>&nbsp;<span class="op" id="8247258">==</span>&nbsp;<span class="string" id="8247261">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8247267">&amp;&amp;</span>&nbsp;<span class="op" id="8247270">!</span><span class="ident" id="8247271">supportsIPv6</span>&nbsp;<span class="op" id="8247284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247289">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247305">c</span><span class="op" id="8247306">,</span>&nbsp;<span class="ident" id="8247308">err</span>&nbsp;<span class="op" id="8247312">:=</span>&nbsp;<span class="ident" id="8247315">Dial</span><span class="op" id="8247319">(</span><span class="ident" id="8247320">tt</span><span class="op" id="8247322">.</span><span class="ident" id="8247323">net</span><span class="op" id="8247326">,</span>&nbsp;<span class="ident" id="8247328">tt</span><span class="op" id="8247330">.</span><span class="ident" id="8247331">raddr</span><span class="op" id="8247336">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247340">if</span>&nbsp;<span class="ident" id="8247343">err</span>&nbsp;<span class="op" id="8247347">!=</span>&nbsp;<span class="ident" id="8247350">nil</span>&nbsp;<span class="op" id="8247354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247359">t</span><span class="op" id="8247360">.</span><span class="ident" id="8247361">Fatalf</span><span class="op" id="8247367">(</span><span class="string" id="8247368">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8247385">,</span>&nbsp;<span class="ident" id="8247387">err</span><span class="op" id="8247390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247398">c</span><span class="op" id="8247399">.</span><span class="ident" id="8247400">SetDeadline</span><span class="op" id="8247411">(</span><span class="ident" id="8247412">time</span><span class="op" id="8247416">.</span><span class="ident" id="8247417">Now</span><span class="op" id="8247420">(</span><span class="op" id="8247421">)</span><span class="op" id="8247422">.</span><span class="ident" id="8247423">Add</span><span class="op" id="8247426">(</span><span class="num" id="8247427">100</span>&nbsp;<span class="op" id="8247431">*</span>&nbsp;<span class="ident" id="8247433">time</span><span class="op" id="8247437">.</span><span class="ident" id="8247438">Millisecond</span><span class="op" id="8247449">)</span><span class="op" id="8247450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247454">defer</span>&nbsp;<span class="ident" id="8247460">c</span><span class="op" id="8247461">.</span><span class="ident" id="8247462">Close</span><span class="op" id="8247467">(</span><span class="op" id="8247468">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247473">typ</span>&nbsp;<span class="op" id="8247477">:=</span>&nbsp;<span class="ident" id="8247480">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247500">if</span>&nbsp;<span class="ident" id="8247503">net</span>&nbsp;<span class="op" id="8247507">==</span>&nbsp;<span class="string" id="8247510">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8247516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247521">typ</span>&nbsp;<span class="op" id="8247525">=</span>&nbsp;<span class="ident" id="8247527">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247547">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247551">xid</span><span class="op" id="8247554">,</span>&nbsp;<span class="ident" id="8247556">xseq</span>&nbsp;<span class="op" id="8247561">:=</span>&nbsp;<span class="ident" id="8247564">os</span><span class="op" id="8247566">.</span><span class="ident" id="8247567">Getpid</span><span class="op" id="8247573">(</span><span class="op" id="8247574">)</span><span class="op" id="8247575">&amp;</span><span class="num" id="8247576">0xffff</span><span class="op" id="8247582">,</span>&nbsp;<span class="ident" id="8247584">i</span><span class="op" id="8247585">+</span><span class="num" id="8247586">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247590">wb</span><span class="op" id="8247592">,</span>&nbsp;<span class="ident" id="8247594">err</span>&nbsp;<span class="op" id="8247598">:=</span>&nbsp;<span class="op" id="8247601">(</span><span class="op" id="8247602">&amp;</span><span class="ident" id="8247603">icmpMessage</span><span class="op" id="8247614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247619">Type</span><span class="op" id="8247623">:</span>&nbsp;<span class="ident" id="8247625">typ</span><span class="op" id="8247628">,</span>&nbsp;<span class="ident" id="8247630">Code</span><span class="op" id="8247634">:</span>&nbsp;<span class="num" id="8247636">0</span><span class="op" id="8247637">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247642">Body</span><span class="op" id="8247646">:</span>&nbsp;<span class="op" id="8247648">&amp;</span><span class="ident" id="8247649">icmpEcho</span><span class="op" id="8247657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247663">ID</span><span class="op" id="8247665">:</span>&nbsp;<span class="ident" id="8247667">xid</span><span class="op" id="8247670">,</span>&nbsp;<span class="ident" id="8247672">Seq</span><span class="op" id="8247675">:</span>&nbsp;<span class="ident" id="8247677">xseq</span><span class="op" id="8247681">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247687">Data</span><span class="op" id="8247691">:</span>&nbsp;<span class="ident" id="8247693">bytes</span><span class="op" id="8247698">.</span><span class="ident" id="8247699">Repeat</span><span class="op" id="8247705">(</span><span class="op" id="8247706">[</span><span class="op" id="8247707">]</span><span class="builtintype" id="8247708">byte</span><span class="op" id="8247712">(</span><span class="string" id="8247713">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8247735">)</span><span class="op" id="8247736">,</span>&nbsp;<span class="num" id="8247738">3</span><span class="op" id="8247739">)</span><span class="op" id="8247740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247745">}</span><span class="op" id="8247746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247750">}</span><span class="op" id="8247751">)</span><span class="op" id="8247752">.</span><span class="ident" id="8247753">Marshal</span><span class="op" id="8247760">(</span><span class="op" id="8247761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247765">if</span>&nbsp;<span class="ident" id="8247768">err</span>&nbsp;<span class="op" id="8247772">!=</span>&nbsp;<span class="ident" id="8247775">nil</span>&nbsp;<span class="op" id="8247779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247784">t</span><span class="op" id="8247785">.</span><span class="ident" id="8247786">Fatalf</span><span class="op" id="8247792">(</span><span class="string" id="8247793">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8247825">,</span>&nbsp;<span class="ident" id="8247827">err</span><span class="op" id="8247830">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247838">if</span>&nbsp;<span class="ident" id="8247841">_</span><span class="op" id="8247842">,</span>&nbsp;<span class="ident" id="8247844">err</span>&nbsp;<span class="op" id="8247848">:=</span>&nbsp;<span class="ident" id="8247851">c</span><span class="op" id="8247852">.</span><span class="ident" id="8247853">Write</span><span class="op" id="8247858">(</span><span class="ident" id="8247859">wb</span><span class="op" id="8247861">)</span><span class="op" id="8247862">;</span>&nbsp;<span class="ident" id="8247864">err</span>&nbsp;<span class="op" id="8247868">!=</span>&nbsp;<span class="ident" id="8247871">nil</span>&nbsp;<span class="op" id="8247875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247880">t</span><span class="op" id="8247881">.</span><span class="ident" id="8247882">Fatalf</span><span class="op" id="8247888">(</span><span class="string" id="8247889">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8247912">,</span>&nbsp;<span class="ident" id="8247914">err</span><span class="op" id="8247917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247925">var</span>&nbsp;<span class="ident" id="8247929">m</span>&nbsp;<span class="op" id="8247931">*</span><span class="ident" id="8247932">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247946">rb</span>&nbsp;<span class="op" id="8247949">:=</span>&nbsp;<span class="builtinfunc" id="8247952">make</span><span class="op" id="8247956">(</span><span class="op" id="8247957">[</span><span class="op" id="8247958">]</span><span class="builtintype" id="8247959">byte</span><span class="op" id="8247963">,</span>&nbsp;<span class="num" id="8247965">20</span><span class="op" id="8247967">+</span><span class="builtinfunc" id="8247968">len</span><span class="op" id="8247971">(</span><span class="ident" id="8247972">wb</span><span class="op" id="8247974">)</span><span class="op" id="8247975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247979">for</span>&nbsp;<span class="op" id="8247983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247988">if</span>&nbsp;<span class="ident" id="8247991">_</span><span class="op" id="8247992">,</span>&nbsp;<span class="ident" id="8247994">err</span>&nbsp;<span class="op" id="8247998">:=</span>&nbsp;<span class="ident" id="8248001">c</span><span class="op" id="8248002">.</span><span class="ident" id="8248003">Read</span><span class="op" id="8248007">(</span><span class="ident" id="8248008">rb</span><span class="op" id="8248010">)</span><span class="op" id="8248011">;</span>&nbsp;<span class="ident" id="8248013">err</span>&nbsp;<span class="op" id="8248017">!=</span>&nbsp;<span class="ident" id="8248020">nil</span>&nbsp;<span class="op" id="8248024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248030">t</span><span class="op" id="8248031">.</span><span class="ident" id="8248032">Fatalf</span><span class="op" id="8248038">(</span><span class="string" id="8248039">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8248061">,</span>&nbsp;<span class="ident" id="8248063">err</span><span class="op" id="8248066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248071">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248076">if</span>&nbsp;<span class="ident" id="8248079">net</span>&nbsp;<span class="op" id="8248083">==</span>&nbsp;<span class="string" id="8248086">&#34;ip4&#34;</span>&nbsp;<span class="op" id="8248092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248098">rb</span>&nbsp;<span class="op" id="8248101">=</span>&nbsp;<span class="ident" id="8248103">ipv4Payload</span><span class="op" id="8248114">(</span><span class="ident" id="8248115">rb</span><span class="op" id="8248117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248127">if</span>&nbsp;<span class="ident" id="8248130">m</span><span class="op" id="8248131">,</span>&nbsp;<span class="ident" id="8248133">err</span>&nbsp;<span class="op" id="8248137">=</span>&nbsp;<span class="ident" id="8248139">parseICMPMessage</span><span class="op" id="8248155">(</span><span class="ident" id="8248156">rb</span><span class="op" id="8248158">)</span><span class="op" id="8248159">;</span>&nbsp;<span class="ident" id="8248161">err</span>&nbsp;<span class="op" id="8248165">!=</span>&nbsp;<span class="ident" id="8248168">nil</span>&nbsp;<span class="op" id="8248172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248178">t</span><span class="op" id="8248179">.</span><span class="ident" id="8248180">Fatalf</span><span class="op" id="8248186">(</span><span class="string" id="8248187">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8248216">,</span>&nbsp;<span class="ident" id="8248218">err</span><span class="op" id="8248221">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248231">switch</span>&nbsp;<span class="ident" id="8248238">m</span><span class="op" id="8248239">.</span><span class="ident" id="8248240">Type</span>&nbsp;<span class="op" id="8248245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248250">case</span>&nbsp;<span class="ident" id="8248255">icmpv4EchoRequest</span><span class="op" id="8248272">,</span>&nbsp;<span class="ident" id="8248274">icmpv6EchoRequest</span><span class="op" id="8248291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248297">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248309">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248314">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248326">switch</span>&nbsp;<span class="ident" id="8248333">p</span>&nbsp;<span class="op" id="8248335">:=</span>&nbsp;<span class="ident" id="8248338">m</span><span class="op" id="8248339">.</span><span class="ident" id="8248340">Body</span><span class="op" id="8248344">.</span><span class="op" id="8248345">(</span><span class="keyword" id="8248346">type</span><span class="op" id="8248350">)</span>&nbsp;<span class="op" id="8248352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248356">case</span>&nbsp;<span class="op" id="8248361">*</span><span class="ident" id="8248362">icmpEcho</span><span class="op" id="8248370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248375">if</span>&nbsp;<span class="ident" id="8248378">p</span><span class="op" id="8248379">.</span><span class="ident" id="8248380">ID</span>&nbsp;<span class="op" id="8248383">!=</span>&nbsp;<span class="ident" id="8248386">xid</span>&nbsp;<span class="op" id="8248390">||</span>&nbsp;<span class="ident" id="8248393">p</span><span class="op" id="8248394">.</span><span class="ident" id="8248395">Seq</span>&nbsp;<span class="op" id="8248399">!=</span>&nbsp;<span class="ident" id="8248402">xseq</span>&nbsp;<span class="op" id="8248407">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248413">t</span><span class="op" id="8248414">.</span><span class="ident" id="8248415">Fatalf</span><span class="op" id="8248421">(</span><span class="string" id="8248422">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8248471">,</span>&nbsp;<span class="ident" id="8248473">p</span><span class="op" id="8248474">.</span><span class="ident" id="8248475">ID</span><span class="op" id="8248477">,</span>&nbsp;<span class="ident" id="8248479">p</span><span class="op" id="8248480">.</span><span class="ident" id="8248481">Seq</span><span class="op" id="8248484">,</span>&nbsp;<span class="ident" id="8248486">xid</span><span class="op" id="8248489">,</span>&nbsp;<span class="ident" id="8248491">xseq</span><span class="op" id="8248495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248504">default</span><span class="op" id="8248511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248516">t</span><span class="op" id="8248517">.</span><span class="ident" id="8248518">Fatalf</span><span class="op" id="8248524">(</span><span class="string" id="8248525">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8248574">,</span>&nbsp;<span class="ident" id="8248576">m</span><span class="op" id="8248577">.</span><span class="ident" id="8248578">Type</span><span class="op" id="8248582">,</span>&nbsp;<span class="ident" id="8248584">m</span><span class="op" id="8248585">.</span><span class="ident" id="8248586">Code</span><span class="op" id="8248590">,</span>&nbsp;<span class="ident" id="8248592">typ</span><span class="op" id="8248595">,</span>&nbsp;<span class="num" id="8248597">0</span><span class="op" id="8248598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248602">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248605">}</span><br>
<span class="lineno"></span><span class="op" id="8248607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8248610">func</span>&nbsp;<span class="ident" id="8248615">TestPacketConnICMPEcho</span><span class="op" id="8248637">(</span><span class="ident" id="8248638">t</span>&nbsp;<span class="op" id="8248640">*</span><span class="ident" id="8248641">testing</span><span class="op" id="8248648">.</span><span class="ident" id="8248649">T</span><span class="op" id="8248650">)</span>&nbsp;<span class="op" id="8248652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248655">if</span>&nbsp;<span class="ident" id="8248658">skip</span><span class="op" id="8248662">,</span>&nbsp;<span class="ident" id="8248664">skipmsg</span>&nbsp;<span class="op" id="8248672">:=</span>&nbsp;<span class="ident" id="8248675">skipRawSocketTest</span><span class="op" id="8248692">(</span><span class="ident" id="8248693">t</span><span class="op" id="8248694">)</span><span class="op" id="8248695">;</span>&nbsp;<span class="ident" id="8248697">skip</span>&nbsp;<span class="op" id="8248702">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248706">t</span><span class="op" id="8248707">.</span><span class="ident" id="8248708">Skip</span><span class="op" id="8248712">(</span><span class="ident" id="8248713">skipmsg</span><span class="op" id="8248720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248727">for</span>&nbsp;<span class="ident" id="8248731">i</span><span class="op" id="8248732">,</span>&nbsp;<span class="ident" id="8248734">tt</span>&nbsp;<span class="op" id="8248737">:=</span>&nbsp;<span class="keyword" id="8248740">range</span>&nbsp;<span class="ident" id="8248746">icmpEchoTests</span>&nbsp;<span class="op" id="8248760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248764">net</span><span class="op" id="8248767">,</span>&nbsp;<span class="ident" id="8248769">_</span><span class="op" id="8248770">,</span>&nbsp;<span class="ident" id="8248772">err</span>&nbsp;<span class="op" id="8248776">:=</span>&nbsp;<span class="ident" id="8248779">parseNetwork</span><span class="op" id="8248791">(</span><span class="ident" id="8248792">tt</span><span class="op" id="8248794">.</span><span class="ident" id="8248795">net</span><span class="op" id="8248798">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248802">if</span>&nbsp;<span class="ident" id="8248805">err</span>&nbsp;<span class="op" id="8248809">!=</span>&nbsp;<span class="ident" id="8248812">nil</span>&nbsp;<span class="op" id="8248816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248821">t</span><span class="op" id="8248822">.</span><span class="ident" id="8248823">Fatalf</span><span class="op" id="8248829">(</span><span class="string" id="8248830">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8248855">,</span>&nbsp;<span class="ident" id="8248857">err</span><span class="op" id="8248860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248868">if</span>&nbsp;<span class="ident" id="8248871">net</span>&nbsp;<span class="op" id="8248875">==</span>&nbsp;<span class="string" id="8248878">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8248884">&amp;&amp;</span>&nbsp;<span class="op" id="8248887">!</span><span class="ident" id="8248888">supportsIPv6</span>&nbsp;<span class="op" id="8248901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248906">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248922">c</span><span class="op" id="8248923">,</span>&nbsp;<span class="ident" id="8248925">err</span>&nbsp;<span class="op" id="8248929">:=</span>&nbsp;<span class="ident" id="8248932">ListenPacket</span><span class="op" id="8248944">(</span><span class="ident" id="8248945">tt</span><span class="op" id="8248947">.</span><span class="ident" id="8248948">net</span><span class="op" id="8248951">,</span>&nbsp;<span class="ident" id="8248953">tt</span><span class="op" id="8248955">.</span><span class="ident" id="8248956">laddr</span><span class="op" id="8248961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248965">if</span>&nbsp;<span class="ident" id="8248968">err</span>&nbsp;<span class="op" id="8248972">!=</span>&nbsp;<span class="ident" id="8248975">nil</span>&nbsp;<span class="op" id="8248979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248984">t</span><span class="op" id="8248985">.</span><span class="ident" id="8248986">Fatalf</span><span class="op" id="8248992">(</span><span class="string" id="8248993">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249018">,</span>&nbsp;<span class="ident" id="8249020">err</span><span class="op" id="8249023">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249031">c</span><span class="op" id="8249032">.</span><span class="ident" id="8249033">SetDeadline</span><span class="op" id="8249044">(</span><span class="ident" id="8249045">time</span><span class="op" id="8249049">.</span><span class="ident" id="8249050">Now</span><span class="op" id="8249053">(</span><span class="op" id="8249054">)</span><span class="op" id="8249055">.</span><span class="ident" id="8249056">Add</span><span class="op" id="8249059">(</span><span class="num" id="8249060">100</span>&nbsp;<span class="op" id="8249064">*</span>&nbsp;<span class="ident" id="8249066">time</span><span class="op" id="8249070">.</span><span class="ident" id="8249071">Millisecond</span><span class="op" id="8249082">)</span><span class="op" id="8249083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249087">defer</span>&nbsp;<span class="ident" id="8249093">c</span><span class="op" id="8249094">.</span><span class="ident" id="8249095">Close</span><span class="op" id="8249100">(</span><span class="op" id="8249101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249106">ra</span><span class="op" id="8249108">,</span>&nbsp;<span class="ident" id="8249110">err</span>&nbsp;<span class="op" id="8249114">:=</span>&nbsp;<span class="ident" id="8249117">ResolveIPAddr</span><span class="op" id="8249130">(</span><span class="ident" id="8249131">tt</span><span class="op" id="8249133">.</span><span class="ident" id="8249134">net</span><span class="op" id="8249137">,</span>&nbsp;<span class="ident" id="8249139">tt</span><span class="op" id="8249141">.</span><span class="ident" id="8249142">raddr</span><span class="op" id="8249147">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249151">if</span>&nbsp;<span class="ident" id="8249154">err</span>&nbsp;<span class="op" id="8249158">!=</span>&nbsp;<span class="ident" id="8249161">nil</span>&nbsp;<span class="op" id="8249165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249170">t</span><span class="op" id="8249171">.</span><span class="ident" id="8249172">Fatalf</span><span class="op" id="8249178">(</span><span class="string" id="8249179">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249205">,</span>&nbsp;<span class="ident" id="8249207">err</span><span class="op" id="8249210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249218">typ</span>&nbsp;<span class="op" id="8249222">:=</span>&nbsp;<span class="ident" id="8249225">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249245">if</span>&nbsp;<span class="ident" id="8249248">net</span>&nbsp;<span class="op" id="8249252">==</span>&nbsp;<span class="string" id="8249255">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8249261">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249266">typ</span>&nbsp;<span class="op" id="8249270">=</span>&nbsp;<span class="ident" id="8249272">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249296">xid</span><span class="op" id="8249299">,</span>&nbsp;<span class="ident" id="8249301">xseq</span>&nbsp;<span class="op" id="8249306">:=</span>&nbsp;<span class="ident" id="8249309">os</span><span class="op" id="8249311">.</span><span class="ident" id="8249312">Getpid</span><span class="op" id="8249318">(</span><span class="op" id="8249319">)</span><span class="op" id="8249320">&amp;</span><span class="num" id="8249321">0xffff</span><span class="op" id="8249327">,</span>&nbsp;<span class="ident" id="8249329">i</span><span class="op" id="8249330">+</span><span class="num" id="8249331">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249335">wb</span><span class="op" id="8249337">,</span>&nbsp;<span class="ident" id="8249339">err</span>&nbsp;<span class="op" id="8249343">:=</span>&nbsp;<span class="op" id="8249346">(</span><span class="op" id="8249347">&amp;</span><span class="ident" id="8249348">icmpMessage</span><span class="op" id="8249359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249364">Type</span><span class="op" id="8249368">:</span>&nbsp;<span class="ident" id="8249370">typ</span><span class="op" id="8249373">,</span>&nbsp;<span class="ident" id="8249375">Code</span><span class="op" id="8249379">:</span>&nbsp;<span class="num" id="8249381">0</span><span class="op" id="8249382">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249387">Body</span><span class="op" id="8249391">:</span>&nbsp;<span class="op" id="8249393">&amp;</span><span class="ident" id="8249394">icmpEcho</span><span class="op" id="8249402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249408">ID</span><span class="op" id="8249410">:</span>&nbsp;<span class="ident" id="8249412">xid</span><span class="op" id="8249415">,</span>&nbsp;<span class="ident" id="8249417">Seq</span><span class="op" id="8249420">:</span>&nbsp;<span class="ident" id="8249422">xseq</span><span class="op" id="8249426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249432">Data</span><span class="op" id="8249436">:</span>&nbsp;<span class="ident" id="8249438">bytes</span><span class="op" id="8249443">.</span><span class="ident" id="8249444">Repeat</span><span class="op" id="8249450">(</span><span class="op" id="8249451">[</span><span class="op" id="8249452">]</span><span class="builtintype" id="8249453">byte</span><span class="op" id="8249457">(</span><span class="string" id="8249458">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8249480">)</span><span class="op" id="8249481">,</span>&nbsp;<span class="num" id="8249483">3</span><span class="op" id="8249484">)</span><span class="op" id="8249485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249490">}</span><span class="op" id="8249491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249495">}</span><span class="op" id="8249496">)</span><span class="op" id="8249497">.</span><span class="ident" id="8249498">Marshal</span><span class="op" id="8249505">(</span><span class="op" id="8249506">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249510">if</span>&nbsp;<span class="ident" id="8249513">err</span>&nbsp;<span class="op" id="8249517">!=</span>&nbsp;<span class="ident" id="8249520">nil</span>&nbsp;<span class="op" id="8249524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249529">t</span><span class="op" id="8249530">.</span><span class="ident" id="8249531">Fatalf</span><span class="op" id="8249537">(</span><span class="string" id="8249538">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249570">,</span>&nbsp;<span class="ident" id="8249572">err</span><span class="op" id="8249575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249583">if</span>&nbsp;<span class="ident" id="8249586">_</span><span class="op" id="8249587">,</span>&nbsp;<span class="ident" id="8249589">err</span>&nbsp;<span class="op" id="8249593">:=</span>&nbsp;<span class="ident" id="8249596">c</span><span class="op" id="8249597">.</span><span class="ident" id="8249598">WriteTo</span><span class="op" id="8249605">(</span><span class="ident" id="8249606">wb</span><span class="op" id="8249608">,</span>&nbsp;<span class="ident" id="8249610">ra</span><span class="op" id="8249612">)</span><span class="op" id="8249613">;</span>&nbsp;<span class="ident" id="8249615">err</span>&nbsp;<span class="op" id="8249619">!=</span>&nbsp;<span class="ident" id="8249622">nil</span>&nbsp;<span class="op" id="8249626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249631">t</span><span class="op" id="8249632">.</span><span class="ident" id="8249633">Fatalf</span><span class="op" id="8249639">(</span><span class="string" id="8249640">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249671">,</span>&nbsp;<span class="ident" id="8249673">err</span><span class="op" id="8249676">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249684">var</span>&nbsp;<span class="ident" id="8249688">m</span>&nbsp;<span class="op" id="8249690">*</span><span class="ident" id="8249691">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249705">rb</span>&nbsp;<span class="op" id="8249708">:=</span>&nbsp;<span class="builtinfunc" id="8249711">make</span><span class="op" id="8249715">(</span><span class="op" id="8249716">[</span><span class="op" id="8249717">]</span><span class="builtintype" id="8249718">byte</span><span class="op" id="8249722">,</span>&nbsp;<span class="num" id="8249724">20</span><span class="op" id="8249726">+</span><span class="builtinfunc" id="8249727">len</span><span class="op" id="8249730">(</span><span class="ident" id="8249731">wb</span><span class="op" id="8249733">)</span><span class="op" id="8249734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249738">for</span>&nbsp;<span class="op" id="8249742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249747">if</span>&nbsp;<span class="ident" id="8249750">_</span><span class="op" id="8249751">,</span>&nbsp;<span class="ident" id="8249753">_</span><span class="op" id="8249754">,</span>&nbsp;<span class="ident" id="8249756">err</span>&nbsp;<span class="op" id="8249760">:=</span>&nbsp;<span class="ident" id="8249763">c</span><span class="op" id="8249764">.</span><span class="ident" id="8249765">ReadFrom</span><span class="op" id="8249773">(</span><span class="ident" id="8249774">rb</span><span class="op" id="8249776">)</span><span class="op" id="8249777">;</span>&nbsp;<span class="ident" id="8249779">err</span>&nbsp;<span class="op" id="8249783">!=</span>&nbsp;<span class="ident" id="8249786">nil</span>&nbsp;<span class="op" id="8249790">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249796">t</span><span class="op" id="8249797">.</span><span class="ident" id="8249798">Fatalf</span><span class="op" id="8249804">(</span><span class="string" id="8249805">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249837">,</span>&nbsp;<span class="ident" id="8249839">err</span><span class="op" id="8249842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8249852">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8249875">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8249898">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8249925">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249932">if</span>&nbsp;<span class="ident" id="8249935">m</span><span class="op" id="8249936">,</span>&nbsp;<span class="ident" id="8249938">err</span>&nbsp;<span class="op" id="8249942">=</span>&nbsp;<span class="ident" id="8249944">parseICMPMessage</span><span class="op" id="8249960">(</span><span class="ident" id="8249961">rb</span><span class="op" id="8249963">)</span><span class="op" id="8249964">;</span>&nbsp;<span class="ident" id="8249966">err</span>&nbsp;<span class="op" id="8249970">!=</span>&nbsp;<span class="ident" id="8249973">nil</span>&nbsp;<span class="op" id="8249977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249983">t</span><span class="op" id="8249984">.</span><span class="ident" id="8249985">Fatalf</span><span class="op" id="8249991">(</span><span class="string" id="8249992">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8250021">,</span>&nbsp;<span class="ident" id="8250023">err</span><span class="op" id="8250026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250036">switch</span>&nbsp;<span class="ident" id="8250043">m</span><span class="op" id="8250044">.</span><span class="ident" id="8250045">Type</span>&nbsp;<span class="op" id="8250050">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250055">case</span>&nbsp;<span class="ident" id="8250060">icmpv4EchoRequest</span><span class="op" id="8250077">,</span>&nbsp;<span class="ident" id="8250079">icmpv6EchoRequest</span><span class="op" id="8250096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250102">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250119">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250127">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250131">switch</span>&nbsp;<span class="ident" id="8250138">p</span>&nbsp;<span class="op" id="8250140">:=</span>&nbsp;<span class="ident" id="8250143">m</span><span class="op" id="8250144">.</span><span class="ident" id="8250145">Body</span><span class="op" id="8250149">.</span><span class="op" id="8250150">(</span><span class="keyword" id="8250151">type</span><span class="op" id="8250155">)</span>&nbsp;<span class="op" id="8250157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250161">case</span>&nbsp;<span class="op" id="8250166">*</span><span class="ident" id="8250167">icmpEcho</span><span class="op" id="8250175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250180">if</span>&nbsp;<span class="ident" id="8250183">p</span><span class="op" id="8250184">.</span><span class="ident" id="8250185">ID</span>&nbsp;<span class="op" id="8250188">!=</span>&nbsp;<span class="ident" id="8250191">xid</span>&nbsp;<span class="op" id="8250195">||</span>&nbsp;<span class="ident" id="8250198">p</span><span class="op" id="8250199">.</span><span class="ident" id="8250200">Seq</span>&nbsp;<span class="op" id="8250204">!=</span>&nbsp;<span class="ident" id="8250207">xseq</span>&nbsp;<span class="op" id="8250212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250218">t</span><span class="op" id="8250219">.</span><span class="ident" id="8250220">Fatalf</span><span class="op" id="8250226">(</span><span class="string" id="8250227">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8250276">,</span>&nbsp;<span class="ident" id="8250278">p</span><span class="op" id="8250279">.</span><span class="ident" id="8250280">ID</span><span class="op" id="8250282">,</span>&nbsp;<span class="ident" id="8250284">p</span><span class="op" id="8250285">.</span><span class="ident" id="8250286">Seq</span><span class="op" id="8250289">,</span>&nbsp;<span class="ident" id="8250291">xid</span><span class="op" id="8250294">,</span>&nbsp;<span class="ident" id="8250296">xseq</span><span class="op" id="8250300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250305">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250309">default</span><span class="op" id="8250316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250321">t</span><span class="op" id="8250322">.</span><span class="ident" id="8250323">Fatalf</span><span class="op" id="8250329">(</span><span class="string" id="8250330">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8250379">,</span>&nbsp;<span class="ident" id="8250381">m</span><span class="op" id="8250382">.</span><span class="ident" id="8250383">Type</span><span class="op" id="8250387">,</span>&nbsp;<span class="ident" id="8250389">m</span><span class="op" id="8250390">.</span><span class="ident" id="8250391">Code</span><span class="op" id="8250395">,</span>&nbsp;<span class="ident" id="8250397">typ</span><span class="op" id="8250400">,</span>&nbsp;<span class="num" id="8250402">0</span><span class="op" id="8250403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250410">}</span><br>
<span class="lineno"></span><span class="op" id="8250412">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="8250415">func</span>&nbsp;<span class="ident" id="8250420">ipv4Payload</span><span class="op" id="8250431">(</span><span class="ident" id="8250432">b</span>&nbsp;<span class="op" id="8250434">[</span><span class="op" id="8250435">]</span><span class="builtintype" id="8250436">byte</span><span class="op" id="8250440">)</span>&nbsp;<span class="op" id="8250442">[</span><span class="op" id="8250443">]</span><span class="builtintype" id="8250444">byte</span>&nbsp;<span class="op" id="8250449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250452">if</span>&nbsp;<span class="builtinfunc" id="8250455">len</span><span class="op" id="8250458">(</span><span class="ident" id="8250459">b</span><span class="op" id="8250460">)</span>&nbsp;<span class="op" id="8250462">&lt;</span>&nbsp;<span class="num" id="8250464">20</span>&nbsp;<span class="op" id="8250467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250471">return</span>&nbsp;<span class="ident" id="8250478">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250481">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250484">hdrlen</span>&nbsp;<span class="op" id="8250491">:=</span>&nbsp;<span class="builtintype" id="8250494">int</span><span class="op" id="8250497">(</span><span class="ident" id="8250498">b</span><span class="op" id="8250499">[</span><span class="num" id="8250500">0</span><span class="op" id="8250501">]</span><span class="op" id="8250502">&amp;</span><span class="num" id="8250503">0x0f</span><span class="op" id="8250507">)</span>&nbsp;<span class="op" id="8250509">&lt;&lt;</span>&nbsp;<span class="num" id="8250512">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250515">return</span>&nbsp;<span class="ident" id="8250522">b</span><span class="op" id="8250523">[</span><span class="ident" id="8250524">hdrlen</span><span class="op" id="8250530">:</span><span class="op" id="8250531">]</span><br>
<span class="lineno"></span><span class="op" id="8250533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250536">var</span>&nbsp;<span class="ident" id="8250540">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8250561">=</span>&nbsp;<span class="op" id="8250563">[</span><span class="op" id="8250564">]</span><span class="keyword" id="8250565">struct</span>&nbsp;<span class="op" id="8250572">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250575">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8250581">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250589">laddr</span>&nbsp;<span class="op" id="8250595">*</span><span class="ident" id="8250596">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="8250603">}</span><span class="op" id="8250604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250607">{</span><span class="string" id="8250608">&#34;ip4:icmp&#34;</span><span class="op" id="8250618">,</span>&nbsp;<span class="op" id="8250620">&amp;</span><span class="ident" id="8250621">IPAddr</span><span class="op" id="8250627">{</span><span class="ident" id="8250628">IP</span><span class="op" id="8250630">:</span>&nbsp;<span class="ident" id="8250632">IPv4</span><span class="op" id="8250636">(</span><span class="num" id="8250637">127</span><span class="op" id="8250640">,</span>&nbsp;<span class="num" id="8250642">0</span><span class="op" id="8250643">,</span>&nbsp;<span class="num" id="8250645">0</span><span class="op" id="8250646">,</span>&nbsp;<span class="num" id="8250648">1</span><span class="op" id="8250649">)</span><span class="op" id="8250650">}</span><span class="op" id="8250651">}</span><span class="op" id="8250652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250655">{</span><span class="string" id="8250656">&#34;ip4:icmp&#34;</span><span class="op" id="8250666">,</span>&nbsp;<span class="op" id="8250668">&amp;</span><span class="ident" id="8250669">IPAddr</span><span class="op" id="8250675">{</span><span class="op" id="8250676">}</span><span class="op" id="8250677">}</span><span class="op" id="8250678">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250681">{</span><span class="string" id="8250682">&#34;ip4:icmp&#34;</span><span class="op" id="8250692">,</span>&nbsp;<span class="ident" id="8250694">nil</span><span class="op" id="8250697">}</span><span class="op" id="8250698">,</span><br>
<span class="lineno"></span><span class="op" id="8250700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250703">func</span>&nbsp;<span class="ident" id="8250708">TestIPConnLocalName</span><span class="op" id="8250727">(</span><span class="ident" id="8250728">t</span>&nbsp;<span class="op" id="8250730">*</span><span class="ident" id="8250731">testing</span><span class="op" id="8250738">.</span><span class="ident" id="8250739">T</span><span class="op" id="8250740">)</span>&nbsp;<span class="op" id="8250742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250745">switch</span>&nbsp;<span class="ident" id="8250752">runtime</span><span class="op" id="8250759">.</span><span class="ident" id="8250760">GOOS</span>&nbsp;<span class="op" id="8250765">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250768">case</span>&nbsp;<span class="string" id="8250773">&#34;nacl&#34;</span><span class="op" id="8250779">,</span>&nbsp;<span class="string" id="8250781">&#34;plan9&#34;</span><span class="op" id="8250788">,</span>&nbsp;<span class="string" id="8250790">&#34;windows&#34;</span><span class="op" id="8250799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250803">t</span><span class="op" id="8250804">.</span><span class="ident" id="8250805">Skipf</span><span class="op" id="8250810">(</span><span class="string" id="8250811">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8250832">,</span>&nbsp;<span class="ident" id="8250834">runtime</span><span class="op" id="8250841">.</span><span class="ident" id="8250842">GOOS</span><span class="op" id="8250846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250849">default</span><span class="op" id="8250856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250860">if</span>&nbsp;<span class="ident" id="8250863">os</span><span class="op" id="8250865">.</span><span class="ident" id="8250866">Getuid</span><span class="op" id="8250872">(</span><span class="op" id="8250873">)</span>&nbsp;<span class="op" id="8250875">!=</span>&nbsp;<span class="num" id="8250878">0</span>&nbsp;<span class="op" id="8250880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250885">t</span><span class="op" id="8250886">.</span><span class="ident" id="8250887">Skip</span><span class="op" id="8250891">(</span><span class="string" id="8250892">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8250921">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250932">for</span>&nbsp;<span class="ident" id="8250936">_</span><span class="op" id="8250937">,</span>&nbsp;<span class="ident" id="8250939">tt</span>&nbsp;<span class="op" id="8250942">:=</span>&nbsp;<span class="keyword" id="8250945">range</span>&nbsp;<span class="ident" id="8250951">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8250972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250976">c</span><span class="op" id="8250977">,</span>&nbsp;<span class="ident" id="8250979">err</span>&nbsp;<span class="op" id="8250983">:=</span>&nbsp;<span class="ident" id="8250986">ListenIP</span><span class="op" id="8250994">(</span><span class="ident" id="8250995">tt</span><span class="op" id="8250997">.</span><span class="ident" id="8250998">net</span><span class="op" id="8251001">,</span>&nbsp;<span class="ident" id="8251003">tt</span><span class="op" id="8251005">.</span><span class="ident" id="8251006">laddr</span><span class="op" id="8251011">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251015">if</span>&nbsp;<span class="ident" id="8251018">err</span>&nbsp;<span class="op" id="8251022">!=</span>&nbsp;<span class="ident" id="8251025">nil</span>&nbsp;<span class="op" id="8251029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251034">t</span><span class="op" id="8251035">.</span><span class="ident" id="8251036">Fatalf</span><span class="op" id="8251042">(</span><span class="string" id="8251043">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8251064">,</span>&nbsp;<span class="ident" id="8251066">err</span><span class="op" id="8251069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251077">defer</span>&nbsp;<span class="ident" id="8251083">c</span><span class="op" id="8251084">.</span><span class="ident" id="8251085">Close</span><span class="op" id="8251090">(</span><span class="op" id="8251091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251095">if</span>&nbsp;<span class="ident" id="8251098">la</span>&nbsp;<span class="op" id="8251101">:=</span>&nbsp;<span class="ident" id="8251104">c</span><span class="op" id="8251105">.</span><span class="ident" id="8251106">LocalAddr</span><span class="op" id="8251115">(</span><span class="op" id="8251116">)</span><span class="op" id="8251117">;</span>&nbsp;<span class="ident" id="8251119">la</span>&nbsp;<span class="op" id="8251122">==</span>&nbsp;<span class="ident" id="8251125">nil</span>&nbsp;<span class="op" id="8251129">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251134">t</span><span class="op" id="8251135">.</span><span class="ident" id="8251136">Fatal</span><span class="op" id="8251141">(</span><span class="string" id="8251142">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="8251167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251174">}</span><br>
<span class="lineno"></span><span class="op" id="8251176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="8251179">func</span>&nbsp;<span class="ident" id="8251184">TestIPConnRemoteName</span><span class="op" id="8251204">(</span><span class="ident" id="8251205">t</span>&nbsp;<span class="op" id="8251207">*</span><span class="ident" id="8251208">testing</span><span class="op" id="8251215">.</span><span class="ident" id="8251216">T</span><span class="op" id="8251217">)</span>&nbsp;<span class="op" id="8251219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251222">switch</span>&nbsp;<span class="ident" id="8251229">runtime</span><span class="op" id="8251236">.</span><span class="ident" id="8251237">GOOS</span>&nbsp;<span class="op" id="8251242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251245">case</span>&nbsp;<span class="string" id="8251250">&#34;plan9&#34;</span><span class="op" id="8251257">,</span>&nbsp;<span class="string" id="8251259">&#34;windows&#34;</span><span class="op" id="8251268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251272">t</span><span class="op" id="8251273">.</span><span class="ident" id="8251274">Skipf</span><span class="op" id="8251279">(</span><span class="string" id="8251280">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8251301">,</span>&nbsp;<span class="ident" id="8251303">runtime</span><span class="op" id="8251310">.</span><span class="ident" id="8251311">GOOS</span><span class="op" id="8251315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251318">default</span><span class="op" id="8251325">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251329">if</span>&nbsp;<span class="ident" id="8251332">os</span><span class="op" id="8251334">.</span><span class="ident" id="8251335">Getuid</span><span class="op" id="8251341">(</span><span class="op" id="8251342">)</span>&nbsp;<span class="op" id="8251344">!=</span>&nbsp;<span class="num" id="8251347">0</span>&nbsp;<span class="op" id="8251349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251354">t</span><span class="op" id="8251355">.</span><span class="ident" id="8251356">Skip</span><span class="op" id="8251360">(</span><span class="string" id="8251361">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8251390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251401">raddr</span>&nbsp;<span class="op" id="8251407">:=</span>&nbsp;<span class="op" id="8251410">&amp;</span><span class="ident" id="8251411">IPAddr</span><span class="op" id="8251417">{</span><span class="ident" id="8251418">IP</span><span class="op" id="8251420">:</span>&nbsp;<span class="ident" id="8251422">IPv4</span><span class="op" id="8251426">(</span><span class="num" id="8251427">127</span><span class="op" id="8251430">,</span>&nbsp;<span class="num" id="8251432">0</span><span class="op" id="8251433">,</span>&nbsp;<span class="num" id="8251435">0</span><span class="op" id="8251436">,</span>&nbsp;<span class="num" id="8251438">1</span><span class="op" id="8251439">)</span><span class="op" id="8251440">.</span><span class="ident" id="8251441">To4</span><span class="op" id="8251444">(</span><span class="op" id="8251445">)</span><span class="op" id="8251446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251449">c</span><span class="op" id="8251450">,</span>&nbsp;<span class="ident" id="8251452">err</span>&nbsp;<span class="op" id="8251456">:=</span>&nbsp;<span class="ident" id="8251459">DialIP</span><span class="op" id="8251465">(</span><span class="string" id="8251466">&#34;ip:tcp&#34;</span><span class="op" id="8251474">,</span>&nbsp;<span class="op" id="8251476">&amp;</span><span class="ident" id="8251477">IPAddr</span><span class="op" id="8251483">{</span><span class="ident" id="8251484">IP</span><span class="op" id="8251486">:</span>&nbsp;<span class="ident" id="8251488">IPv4</span><span class="op" id="8251492">(</span><span class="num" id="8251493">127</span><span class="op" id="8251496">,</span>&nbsp;<span class="num" id="8251498">0</span><span class="op" id="8251499">,</span>&nbsp;<span class="num" id="8251501">0</span><span class="op" id="8251502">,</span>&nbsp;<span class="num" id="8251504">1</span><span class="op" id="8251505">)</span><span class="op" id="8251506">}</span><span class="op" id="8251507">,</span>&nbsp;<span class="ident" id="8251509">raddr</span><span class="op" id="8251514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251517">if</span>&nbsp;<span class="ident" id="8251520">err</span>&nbsp;<span class="op" id="8251524">!=</span>&nbsp;<span class="ident" id="8251527">nil</span>&nbsp;<span class="op" id="8251531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251535">t</span><span class="op" id="8251536">.</span><span class="ident" id="8251537">Fatalf</span><span class="op" id="8251543">(</span><span class="string" id="8251544">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8251563">,</span>&nbsp;<span class="ident" id="8251565">err</span><span class="op" id="8251568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251571">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251574">defer</span>&nbsp;<span class="ident" id="8251580">c</span><span class="op" id="8251581">.</span><span class="ident" id="8251582">Close</span><span class="op" id="8251587">(</span><span class="op" id="8251588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8251591">if</span>&nbsp;<span class="op" id="8251594">!</span><span class="ident" id="8251595">reflect</span><span class="op" id="8251602">.</span><span class="ident" id="8251603">DeepEqual</span><span class="op" id="8251612">(</span><span class="ident" id="8251613">raddr</span><span class="op" id="8251618">,</span>&nbsp;<span class="ident" id="8251620">c</span><span class="op" id="8251621">.</span><span class="ident" id="8251622">RemoteAddr</span><span class="op" id="8251632">(</span><span class="op" id="8251633">)</span><span class="op" id="8251634">)</span>&nbsp;<span class="op" id="8251636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8251640">t</span><span class="op" id="8251641">.</span><span class="ident" id="8251642">Fatalf</span><span class="op" id="8251648">(</span><span class="string" id="8251649">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8251672">,</span>&nbsp;<span class="ident" id="8251674">c</span><span class="op" id="8251675">.</span><span class="ident" id="8251676">RemoteAddr</span><span class="op" id="8251686">(</span><span class="op" id="8251687">)</span><span class="op" id="8251688">,</span>&nbsp;<span class="ident" id="8251690">raddr</span><span class="op" id="8251695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8251698">}</span><br>
<span class="lineno"></span><span class="op" id="8251700">}</span>
</div>
</body>
</html>
