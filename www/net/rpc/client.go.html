<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5778133">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5778188">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5778242">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5778293">package</span>&nbsp;<span class="ident" id="5778301">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5778306">import</span>&nbsp;<span class="op" id="5778313">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778316">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778325">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778341">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778351">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778357">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778364">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778371">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5778383">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5778390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5778393">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5778456">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5778498">type</span>&nbsp;<span class="ident" id="5778503">ServerError</span>&nbsp;<span class="builtintype" id="5778515">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5778523">func</span>&nbsp;<span class="op" id="5778528">(</span><span class="ident" id="5778529">e</span>&nbsp;<span class="ident" id="5778531"><a href="/net/rpc/client.go.html#5778503">ServerError</a></span><span class="op" id="5778542">)</span>&nbsp;<span class="ident" id="5778544">Error</span><span class="op" id="5778549">(</span><span class="op" id="5778550">)</span>&nbsp;<span class="builtintype" id="5778552">string</span>&nbsp;<span class="op" id="5778559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5778562">return</span>&nbsp;<span class="builtintype" id="5778569">string</span><span class="op" id="5778575">(</span><span class="ident" id="5778576"><a href="/net/rpc/client.go.html#5778529">e</a></span><span class="op" id="5778577">)</span><br>
<span class="lineno"></span><span class="op" id="5778579">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5778582">var</span>&nbsp;<span class="ident" id="5778586">ErrShutdown</span>&nbsp;<span class="op" id="5778598">=</span>&nbsp;<span class="ident" id="5778600"><a href="/net/rpc/client.go.html#5778341">errors</a></span><span class="op" id="5778606">.</span><span class="ident" id="5778607">New</span><span class="op" id="5778610">(</span><span class="string" id="5778611">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5778636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5778639">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5778673">type</span>&nbsp;<span class="ident" id="5778678">Call</span>&nbsp;<span class="keyword" id="5778683">struct</span>&nbsp;<span class="op" id="5778690">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778693">ServiceMethod</span>&nbsp;<span class="builtintype" id="5778707">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5778719">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778767">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5778781">interface</span><span class="op" id="5778790">{</span><span class="op" id="5778791">}</span>&nbsp;<span class="comment" id="5778793">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778837">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5778851">interface</span><span class="op" id="5778860">{</span><span class="op" id="5778861">}</span>&nbsp;<span class="comment" id="5778863">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778906">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5778920">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5778932">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5778972">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5778986">chan</span>&nbsp;<span class="op" id="5778991">*</span><span class="ident" id="5778992"><a href="/net/rpc/client.go.html#5778678">Call</a></span>&nbsp;&nbsp;<span class="comment" id="5778998">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5779032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5779035">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5779071">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5779125">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5779178">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5779217">type</span>&nbsp;<span class="ident" id="5779222">Client</span>&nbsp;<span class="keyword" id="5779229">struct</span>&nbsp;<span class="op" id="5779236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779239">codec</span>&nbsp;<span class="ident" id="5779245"><a href="/net/rpc/client.go.html#5779961">ClientCodec</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779259">reqMutex</span>&nbsp;<span class="ident" id="5779268"><a href="/net/rpc/client.go.html#5778383">sync</a></span><span class="op" id="5779272">.</span><span class="ident" id="5779273">Mutex</span>&nbsp;<span class="comment" id="5779279">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779302">request</span>&nbsp;&nbsp;<span class="ident" id="5779311"><a href="/net/rpc/server.go.html#5794226">Request</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779321">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5779330"><a href="/net/rpc/client.go.html#5778383">sync</a></span><span class="op" id="5779334">.</span><span class="ident" id="5779335">Mutex</span>&nbsp;<span class="comment" id="5779341">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779364">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5779373">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779381">pending</span>&nbsp;&nbsp;<span class="keyword" id="5779390">map</span><span class="op" id="5779393">[</span><span class="ident" id="5779394">uint64</span><span class="op" id="5779400">]</span><span class="op" id="5779401">*</span><span class="ident" id="5779402"><a href="/net/rpc/client.go.html#5778678">Call</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779408">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5779417">bool</span>&nbsp;<span class="comment" id="5779422">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5779448">shutdown</span>&nbsp;<span class="builtintype" id="5779457">bool</span>&nbsp;<span class="comment" id="5779462">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5779492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5779495">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5779551">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5779618">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5779688">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5779750">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5779819">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5779876">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5779942">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5779956">type</span>&nbsp;<span class="ident" id="5779961">ClientCodec</span>&nbsp;<span class="keyword" id="5779973">interface</span>&nbsp;<span class="op" id="5779983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5779986">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780059">WriteRequest</span><span class="op" id="5780071">(</span><span class="op" id="5780072">*</span><span class="ident" id="5780073"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5780080">,</span>&nbsp;<span class="keyword" id="5780082">interface</span><span class="op" id="5780091">{</span><span class="op" id="5780092">}</span><span class="op" id="5780093">)</span>&nbsp;<span class="builtintype" id="5780095">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780102">ReadResponseHeader</span><span class="op" id="5780120">(</span><span class="op" id="5780121">*</span><span class="ident" id="5780122"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5780130">)</span>&nbsp;<span class="builtintype" id="5780132">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780139">ReadResponseBody</span><span class="op" id="5780155">(</span><span class="keyword" id="5780156">interface</span><span class="op" id="5780165">{</span><span class="op" id="5780166">}</span><span class="op" id="5780167">)</span>&nbsp;<span class="builtintype" id="5780169">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780177">Close</span><span class="op" id="5780182">(</span><span class="op" id="5780183">)</span>&nbsp;<span class="builtintype" id="5780185">error</span><br>
<span class="lineno"></span><span class="op" id="5780191">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5780194">func</span>&nbsp;<span class="op" id="5780199">(</span><span class="ident" id="5780200">client</span>&nbsp;<span class="op" id="5780207">*</span><span class="ident" id="5780208"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5780214">)</span>&nbsp;<span class="ident" id="5780216">send</span><span class="op" id="5780220">(</span><span class="ident" id="5780221">call</span>&nbsp;<span class="op" id="5780226">*</span><span class="ident" id="5780227"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5780231">)</span>&nbsp;<span class="op" id="5780233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780236"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780242">.</span><span class="ident" id="5780243">reqMutex</span><span class="op" id="5780251">.</span><span class="ident" id="5780252">Lock</span><span class="op" id="5780256">(</span><span class="op" id="5780257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780260">defer</span>&nbsp;<span class="ident" id="5780266"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780272">.</span><span class="ident" id="5780273">reqMutex</span><span class="op" id="5780281">.</span><span class="ident" id="5780282">Unlock</span><span class="op" id="5780288">(</span><span class="op" id="5780289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780293">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780317"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780323">.</span><span class="ident" id="5780324">mutex</span><span class="op" id="5780329">.</span><span class="ident" id="5780330">Lock</span><span class="op" id="5780334">(</span><span class="op" id="5780335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780338">if</span>&nbsp;<span class="ident" id="5780341"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780347">.</span><span class="ident" id="5780348">shutdown</span>&nbsp;<span class="op" id="5780357">||</span>&nbsp;<span class="ident" id="5780360"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780366">.</span><span class="ident" id="5780367">closing</span>&nbsp;<span class="op" id="5780375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780379"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780383">.</span><span class="ident" id="5780384">Error</span>&nbsp;<span class="op" id="5780390">=</span>&nbsp;<span class="ident" id="5780392"><a href="/net/rpc/client.go.html#5778586">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780406"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780412">.</span><span class="ident" id="5780413">mutex</span><span class="op" id="5780418">.</span><span class="ident" id="5780419">Unlock</span><span class="op" id="5780425">(</span><span class="op" id="5780426">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780430"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780434">.</span><span class="ident" id="5780435">done</span><span class="op" id="5780439">(</span><span class="op" id="5780440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780444">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780455">seq</span>&nbsp;<span class="op" id="5780459">:=</span>&nbsp;<span class="ident" id="5780462"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780468">.</span><span class="ident" id="5780469">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780474"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780480">.</span><span class="ident" id="5780481">seq</span><span class="op" id="5780484">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780488"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780494">.</span><span class="ident" id="5780495">pending</span><span class="op" id="5780502">[</span><span class="ident" id="5780503"><a href="/net/rpc/client.go.html#5780455">seq</a></span><span class="op" id="5780506">]</span>&nbsp;<span class="op" id="5780508">=</span>&nbsp;<span class="ident" id="5780510"><a href="/net/rpc/client.go.html#5780221">call</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780516"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780522">.</span><span class="ident" id="5780523">mutex</span><span class="op" id="5780528">.</span><span class="ident" id="5780529">Unlock</span><span class="op" id="5780535">(</span><span class="op" id="5780536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5780540">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780573"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780579">.</span><span class="ident" id="5780580">request</span><span class="op" id="5780587">.</span><span class="ident" id="5780588">Seq</span>&nbsp;<span class="op" id="5780592">=</span>&nbsp;<span class="ident" id="5780594"><a href="/net/rpc/client.go.html#5780455">seq</a></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780599"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780605">.</span><span class="ident" id="5780606">request</span><span class="op" id="5780613">.</span><span class="ident" id="5780614">ServiceMethod</span>&nbsp;<span class="op" id="5780628">=</span>&nbsp;<span class="ident" id="5780630"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780634">.</span><span class="ident" id="5780635">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780650">err</span>&nbsp;<span class="op" id="5780654">:=</span>&nbsp;<span class="ident" id="5780657"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780663">.</span><span class="ident" id="5780664">codec</span><span class="op" id="5780669">.</span><span class="ident" id="5780670">WriteRequest</span><span class="op" id="5780682">(</span><span class="op" id="5780683">&amp;</span><span class="ident" id="5780684"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780690">.</span><span class="ident" id="5780691">request</span><span class="op" id="5780698">,</span>&nbsp;<span class="ident" id="5780700"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780704">.</span><span class="ident" id="5780705">Args</span><span class="op" id="5780709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780712">if</span>&nbsp;<span class="ident" id="5780715"><a href="/net/rpc/client.go.html#5780650">err</a></span>&nbsp;<span class="op" id="5780719">!=</span>&nbsp;<span class="ident" id="5780722">nil</span>&nbsp;<span class="op" id="5780726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780730"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780736">.</span><span class="ident" id="5780737">mutex</span><span class="op" id="5780742">.</span><span class="ident" id="5780743">Lock</span><span class="op" id="5780747">(</span><span class="op" id="5780748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780752"><a href="/net/rpc/client.go.html#5780221">call</a></span>&nbsp;<span class="op" id="5780757">=</span>&nbsp;<span class="ident" id="5780759"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780765">.</span><span class="ident" id="5780766">pending</span><span class="op" id="5780773">[</span><span class="ident" id="5780774"><a href="/net/rpc/client.go.html#5780455">seq</a></span><span class="op" id="5780777">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5780781">delete</span><span class="op" id="5780787">(</span><span class="ident" id="5780788"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780794">.</span><span class="ident" id="5780795">pending</span><span class="op" id="5780802">,</span>&nbsp;<span class="ident" id="5780804"><a href="/net/rpc/client.go.html#5780455">seq</a></span><span class="op" id="5780807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780811"><a href="/net/rpc/client.go.html#5780200">client</a></span><span class="op" id="5780817">.</span><span class="ident" id="5780818">mutex</span><span class="op" id="5780823">.</span><span class="ident" id="5780824">Unlock</span><span class="op" id="5780830">(</span><span class="op" id="5780831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780835">if</span>&nbsp;<span class="ident" id="5780838"><a href="/net/rpc/client.go.html#5780221">call</a></span>&nbsp;<span class="op" id="5780843">!=</span>&nbsp;<span class="ident" id="5780846">nil</span>&nbsp;<span class="op" id="5780850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780855"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780859">.</span><span class="ident" id="5780860">Error</span>&nbsp;<span class="op" id="5780866">=</span>&nbsp;<span class="ident" id="5780868"><a href="/net/rpc/client.go.html#5780650">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780875"><a href="/net/rpc/client.go.html#5780221">call</a></span><span class="op" id="5780879">.</span><span class="ident" id="5780880">done</span><span class="op" id="5780884">(</span><span class="op" id="5780885">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5780892">}</span><br>
<span class="lineno"></span><span class="op" id="5780894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5780897">func</span>&nbsp;<span class="op" id="5780902">(</span><span class="ident" id="5780903">client</span>&nbsp;<span class="op" id="5780910">*</span><span class="ident" id="5780911"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5780917">)</span>&nbsp;<span class="ident" id="5780919">input</span><span class="op" id="5780924">(</span><span class="op" id="5780925">)</span>&nbsp;<span class="op" id="5780927">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780930">var</span>&nbsp;<span class="ident" id="5780934">err</span>&nbsp;<span class="builtintype" id="5780938">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780945">var</span>&nbsp;<span class="ident" id="5780949">response</span>&nbsp;<span class="ident" id="5780958"><a href="/net/rpc/server.go.html#5794584">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5780968">for</span>&nbsp;<span class="ident" id="5780972"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5780976">==</span>&nbsp;<span class="ident" id="5780979">nil</span>&nbsp;<span class="op" id="5780983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5780987"><a href="/net/rpc/client.go.html#5780949">response</a></span>&nbsp;<span class="op" id="5780996">=</span>&nbsp;<span class="ident" id="5780998"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5781006">{</span><span class="op" id="5781007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781011"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781015">=</span>&nbsp;<span class="ident" id="5781017"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781023">.</span><span class="ident" id="5781024">codec</span><span class="op" id="5781029">.</span><span class="ident" id="5781030">ReadResponseHeader</span><span class="op" id="5781048">(</span><span class="op" id="5781049">&amp;</span><span class="ident" id="5781050"><a href="/net/rpc/client.go.html#5780949">response</a></span><span class="op" id="5781058">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781062">if</span>&nbsp;<span class="ident" id="5781065"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781069">!=</span>&nbsp;<span class="ident" id="5781072">nil</span>&nbsp;<span class="op" id="5781076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781081">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781093">seq</span>&nbsp;<span class="op" id="5781097">:=</span>&nbsp;<span class="ident" id="5781100"><a href="/net/rpc/client.go.html#5780949">response</a></span><span class="op" id="5781108">.</span><span class="ident" id="5781109">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781115"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781121">.</span><span class="ident" id="5781122">mutex</span><span class="op" id="5781127">.</span><span class="ident" id="5781128">Lock</span><span class="op" id="5781132">(</span><span class="op" id="5781133">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781137">call</span>&nbsp;<span class="op" id="5781142">:=</span>&nbsp;<span class="ident" id="5781145"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781151">.</span><span class="ident" id="5781152">pending</span><span class="op" id="5781159">[</span><span class="ident" id="5781160"><a href="/net/rpc/client.go.html#5781093">seq</a></span><span class="op" id="5781163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5781167">delete</span><span class="op" id="5781173">(</span><span class="ident" id="5781174"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781180">.</span><span class="ident" id="5781181">pending</span><span class="op" id="5781188">,</span>&nbsp;<span class="ident" id="5781190"><a href="/net/rpc/client.go.html#5781093">seq</a></span><span class="op" id="5781193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781197"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781203">.</span><span class="ident" id="5781204">mutex</span><span class="op" id="5781209">.</span><span class="ident" id="5781210">Unlock</span><span class="op" id="5781216">(</span><span class="op" id="5781217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781222">switch</span>&nbsp;<span class="op" id="5781229">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781233">case</span>&nbsp;<span class="ident" id="5781238"><a href="/net/rpc/client.go.html#5781137">call</a></span>&nbsp;<span class="op" id="5781243">==</span>&nbsp;<span class="ident" id="5781246">nil</span><span class="op" id="5781249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781254">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781311">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781369">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781425">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781483">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781543"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781547">=</span>&nbsp;<span class="ident" id="5781549"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781555">.</span><span class="ident" id="5781556">codec</span><span class="op" id="5781561">.</span><span class="ident" id="5781562">ReadResponseBody</span><span class="op" id="5781578">(</span><span class="ident" id="5781579">nil</span><span class="op" id="5781582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781587">if</span>&nbsp;<span class="ident" id="5781590"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781594">!=</span>&nbsp;<span class="ident" id="5781597">nil</span>&nbsp;<span class="op" id="5781601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781607"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781611">=</span>&nbsp;<span class="ident" id="5781613"><a href="/net/rpc/client.go.html#5778341">errors</a></span><span class="op" id="5781619">.</span><span class="ident" id="5781620">New</span><span class="op" id="5781623">(</span><span class="string" id="5781624">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5781647">+</span>&nbsp;<span class="ident" id="5781649"><a href="/net/rpc/client.go.html#5780934">err</a></span><span class="op" id="5781652">.</span><span class="ident" id="5781653">Error</span><span class="op" id="5781658">(</span><span class="op" id="5781659">)</span><span class="op" id="5781660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5781665">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781669">case</span>&nbsp;<span class="ident" id="5781674"><a href="/net/rpc/client.go.html#5780949">response</a></span><span class="op" id="5781682">.</span><span class="ident" id="5781683">Error</span>&nbsp;<span class="op" id="5781689">!=</span>&nbsp;<span class="string" id="5781692">&#34;&#34;</span><span class="op" id="5781694">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781699">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781760">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5781820">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781849"><a href="/net/rpc/client.go.html#5781137">call</a></span><span class="op" id="5781853">.</span><span class="ident" id="5781854">Error</span>&nbsp;<span class="op" id="5781860">=</span>&nbsp;<span class="ident" id="5781862"><a href="/net/rpc/client.go.html#5778503">ServerError</a></span><span class="op" id="5781873">(</span><span class="ident" id="5781874"><a href="/net/rpc/client.go.html#5780949">response</a></span><span class="op" id="5781882">.</span><span class="ident" id="5781883">Error</span><span class="op" id="5781888">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781893"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781897">=</span>&nbsp;<span class="ident" id="5781899"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5781905">.</span><span class="ident" id="5781906">codec</span><span class="op" id="5781911">.</span><span class="ident" id="5781912">ReadResponseBody</span><span class="op" id="5781928">(</span><span class="ident" id="5781929">nil</span><span class="op" id="5781932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5781937">if</span>&nbsp;<span class="ident" id="5781940"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781944">!=</span>&nbsp;<span class="ident" id="5781947">nil</span>&nbsp;<span class="op" id="5781951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5781957"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5781961">=</span>&nbsp;<span class="ident" id="5781963"><a href="/net/rpc/client.go.html#5778341">errors</a></span><span class="op" id="5781969">.</span><span class="ident" id="5781970">New</span><span class="op" id="5781973">(</span><span class="string" id="5781974">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5781997">+</span>&nbsp;<span class="ident" id="5781999"><a href="/net/rpc/client.go.html#5780934">err</a></span><span class="op" id="5782002">.</span><span class="ident" id="5782003">Error</span><span class="op" id="5782008">(</span><span class="op" id="5782009">)</span><span class="op" id="5782010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782020"><a href="/net/rpc/client.go.html#5781137">call</a></span><span class="op" id="5782024">.</span><span class="ident" id="5782025">done</span><span class="op" id="5782029">(</span><span class="op" id="5782030">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782034">default</span><span class="op" id="5782041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782046"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782050">=</span>&nbsp;<span class="ident" id="5782052"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782058">.</span><span class="ident" id="5782059">codec</span><span class="op" id="5782064">.</span><span class="ident" id="5782065">ReadResponseBody</span><span class="op" id="5782081">(</span><span class="ident" id="5782082"><a href="/net/rpc/client.go.html#5781137">call</a></span><span class="op" id="5782086">.</span><span class="ident" id="5782087">Reply</span><span class="op" id="5782092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782097">if</span>&nbsp;<span class="ident" id="5782100"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782104">!=</span>&nbsp;<span class="ident" id="5782107">nil</span>&nbsp;<span class="op" id="5782111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782117"><a href="/net/rpc/client.go.html#5781137">call</a></span><span class="op" id="5782121">.</span><span class="ident" id="5782122">Error</span>&nbsp;<span class="op" id="5782128">=</span>&nbsp;<span class="ident" id="5782130"><a href="/net/rpc/client.go.html#5778341">errors</a></span><span class="op" id="5782136">.</span><span class="ident" id="5782137">New</span><span class="op" id="5782140">(</span><span class="string" id="5782141">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5782157">+</span>&nbsp;<span class="ident" id="5782159"><a href="/net/rpc/client.go.html#5780934">err</a></span><span class="op" id="5782162">.</span><span class="ident" id="5782163">Error</span><span class="op" id="5782168">(</span><span class="op" id="5782169">)</span><span class="op" id="5782170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782175">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782180"><a href="/net/rpc/client.go.html#5781137">call</a></span><span class="op" id="5782184">.</span><span class="ident" id="5782185">done</span><span class="op" id="5782189">(</span><span class="op" id="5782190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782200">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782229"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782235">.</span><span class="ident" id="5782236">reqMutex</span><span class="op" id="5782244">.</span><span class="ident" id="5782245">Lock</span><span class="op" id="5782249">(</span><span class="op" id="5782250">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782253"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782259">.</span><span class="ident" id="5782260">mutex</span><span class="op" id="5782265">.</span><span class="ident" id="5782266">Lock</span><span class="op" id="5782270">(</span><span class="op" id="5782271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782274"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782280">.</span><span class="ident" id="5782281">shutdown</span>&nbsp;<span class="op" id="5782290">=</span>&nbsp;<span class="builtintype" id="5782292">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782298">closing</span>&nbsp;<span class="op" id="5782306">:=</span>&nbsp;<span class="ident" id="5782309"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782315">.</span><span class="ident" id="5782316">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782325">if</span>&nbsp;<span class="ident" id="5782328"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782332">==</span>&nbsp;<span class="ident" id="5782335"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5782337">.</span><span class="ident" id="5782338">EOF</span>&nbsp;<span class="op" id="5782342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782346">if</span>&nbsp;<span class="ident" id="5782349"><a href="/net/rpc/client.go.html#5782298">closing</a></span>&nbsp;<span class="op" id="5782357">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782362"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782366">=</span>&nbsp;<span class="ident" id="5782368"><a href="/net/rpc/client.go.html#5778586">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782382">}</span>&nbsp;<span class="keyword" id="5782384">else</span>&nbsp;<span class="op" id="5782389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782394"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782398">=</span>&nbsp;<span class="ident" id="5782400"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5782402">.</span><span class="ident" id="5782403">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782425">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782428">for</span>&nbsp;<span class="ident" id="5782432">_</span><span class="op" id="5782433">,</span>&nbsp;<span class="ident" id="5782435">call</span>&nbsp;<span class="op" id="5782440">:=</span>&nbsp;<span class="keyword" id="5782443">range</span>&nbsp;<span class="ident" id="5782449"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782455">.</span><span class="ident" id="5782456">pending</span>&nbsp;<span class="op" id="5782464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782468"><a href="/net/rpc/client.go.html#5782435">call</a></span><span class="op" id="5782472">.</span><span class="ident" id="5782473">Error</span>&nbsp;<span class="op" id="5782479">=</span>&nbsp;<span class="ident" id="5782481"><a href="/net/rpc/client.go.html#5780934">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782487"><a href="/net/rpc/client.go.html#5782435">call</a></span><span class="op" id="5782491">.</span><span class="ident" id="5782492">done</span><span class="op" id="5782496">(</span><span class="op" id="5782497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782503"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782509">.</span><span class="ident" id="5782510">mutex</span><span class="op" id="5782515">.</span><span class="ident" id="5782516">Unlock</span><span class="op" id="5782522">(</span><span class="op" id="5782523">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782526"><a href="/net/rpc/client.go.html#5780903">client</a></span><span class="op" id="5782532">.</span><span class="ident" id="5782533">reqMutex</span><span class="op" id="5782541">.</span><span class="ident" id="5782542">Unlock</span><span class="op" id="5782548">(</span><span class="op" id="5782549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782552">if</span>&nbsp;<span class="ident" id="5782555"><a href="/net/rpc/debug.go.html#5787850">debugLog</a></span>&nbsp;<span class="op" id="5782564">&amp;&amp;</span>&nbsp;<span class="ident" id="5782567"><a href="/net/rpc/client.go.html#5780934">err</a></span>&nbsp;<span class="op" id="5782571">!=</span>&nbsp;<span class="ident" id="5782574"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5782576">.</span><span class="ident" id="5782577">EOF</span>&nbsp;<span class="op" id="5782581">&amp;&amp;</span>&nbsp;<span class="op" id="5782584">!</span><span class="ident" id="5782585"><a href="/net/rpc/client.go.html#5782298">closing</a></span>&nbsp;<span class="op" id="5782593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782597"><a href="/net/rpc/client.go.html#5778357">log</a></span><span class="op" id="5782600">.</span><span class="ident" id="5782601">Println</span><span class="op" id="5782608">(</span><span class="string" id="5782609">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5782638">,</span>&nbsp;<span class="ident" id="5782640"><a href="/net/rpc/client.go.html#5780934">err</a></span><span class="op" id="5782643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782646">}</span><br>
<span class="lineno"></span><span class="op" id="5782648">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5782651">func</span>&nbsp;<span class="op" id="5782656">(</span><span class="ident" id="5782657">call</span>&nbsp;<span class="op" id="5782662">*</span><span class="ident" id="5782663"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5782667">)</span>&nbsp;<span class="ident" id="5782669">done</span><span class="op" id="5782673">(</span><span class="op" id="5782674">)</span>&nbsp;<span class="op" id="5782676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782679">select</span>&nbsp;<span class="op" id="5782686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782689">case</span>&nbsp;<span class="ident" id="5782694"><a href="/net/rpc/client.go.html#5782657">call</a></span><span class="op" id="5782698">.</span><span class="ident" id="5782699">Done</span>&nbsp;<span class="op" id="5782704">&lt;-</span>&nbsp;<span class="ident" id="5782707"><a href="/net/rpc/client.go.html#5782657">call</a></span><span class="op" id="5782711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782715">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782722">default</span><span class="op" id="5782729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782733">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5782810">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5782878">if</span>&nbsp;<span class="ident" id="5782881"><a href="/net/rpc/debug.go.html#5787850">debugLog</a></span>&nbsp;<span class="op" id="5782890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5782895"><a href="/net/rpc/client.go.html#5778357">log</a></span><span class="op" id="5782898">.</span><span class="ident" id="5782899">Println</span><span class="op" id="5782906">(</span><span class="string" id="5782907">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5782974">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5782981">}</span><br>
<span class="lineno"></span><span class="op" id="5782983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5782986">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5783046">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5783101">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5783160">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5783206">func</span>&nbsp;<span class="ident" id="5783211">NewClient</span><span class="op" id="5783220">(</span><span class="ident" id="5783221">conn</span>&nbsp;<span class="ident" id="5783226"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5783228">.</span><span class="ident" id="5783229">ReadWriteCloser</span><span class="op" id="5783244">)</span>&nbsp;<span class="op" id="5783246">*</span><span class="ident" id="5783247"><a href="/net/rpc/client.go.html#5779222">Client</a></span>&nbsp;<span class="op" id="5783254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783257">encBuf</span>&nbsp;<span class="op" id="5783264">:=</span>&nbsp;<span class="ident" id="5783267"><a href="/net/rpc/client.go.html#5778316">bufio</a></span><span class="op" id="5783272">.</span><span class="ident" id="5783273">NewWriter</span><span class="op" id="5783282">(</span><span class="ident" id="5783283"><a href="/net/rpc/client.go.html#5783221">conn</a></span><span class="op" id="5783287">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783290">client</span>&nbsp;<span class="op" id="5783297">:=</span>&nbsp;<span class="op" id="5783300">&amp;</span><span class="ident" id="5783301"><a href="/net/rpc/client.go.html#5783698">gobClientCodec</a></span><span class="op" id="5783315">{</span><span class="ident" id="5783316"><a href="/net/rpc/client.go.html#5783221">conn</a></span><span class="op" id="5783320">,</span>&nbsp;<span class="ident" id="5783322"><a href="/net/rpc/client.go.html#5778325">gob</a></span><span class="op" id="5783325">.</span><span class="ident" id="5783326">NewDecoder</span><span class="op" id="5783336">(</span><span class="ident" id="5783337"><a href="/net/rpc/client.go.html#5783221">conn</a></span><span class="op" id="5783341">)</span><span class="op" id="5783342">,</span>&nbsp;<span class="ident" id="5783344"><a href="/net/rpc/client.go.html#5778325">gob</a></span><span class="op" id="5783347">.</span><span class="ident" id="5783348">NewEncoder</span><span class="op" id="5783358">(</span><span class="ident" id="5783359"><a href="/net/rpc/client.go.html#5783257">encBuf</a></span><span class="op" id="5783365">)</span><span class="op" id="5783366">,</span>&nbsp;<span class="ident" id="5783368"><a href="/net/rpc/client.go.html#5783257">encBuf</a></span><span class="op" id="5783374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783377">return</span>&nbsp;<span class="ident" id="5783384"><a href="/net/rpc/client.go.html#5783532">NewClientWithCodec</a></span><span class="op" id="5783402">(</span><span class="ident" id="5783403"><a href="/net/rpc/client.go.html#5783290">client</a></span><span class="op" id="5783409">)</span><br>
<span class="lineno"></span><span class="op" id="5783411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5783414">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5783477">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5783527">func</span>&nbsp;<span class="ident" id="5783532">NewClientWithCodec</span><span class="op" id="5783550">(</span><span class="ident" id="5783551">codec</span>&nbsp;<span class="ident" id="5783557"><a href="/net/rpc/client.go.html#5779961">ClientCodec</a></span><span class="op" id="5783568">)</span>&nbsp;<span class="op" id="5783570">*</span><span class="ident" id="5783571"><a href="/net/rpc/client.go.html#5779222">Client</a></span>&nbsp;<span class="op" id="5783578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783581">client</span>&nbsp;<span class="op" id="5783588">:=</span>&nbsp;<span class="op" id="5783591">&amp;</span><span class="ident" id="5783592"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5783598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783602">codec</span><span class="op" id="5783607">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5783611"><a href="/net/rpc/client.go.html#5783551">codec</a></span><span class="op" id="5783616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783620">pending</span><span class="op" id="5783627">:</span>&nbsp;<span class="builtinfunc" id="5783629">make</span><span class="op" id="5783633">(</span><span class="keyword" id="5783634">map</span><span class="op" id="5783637">[</span><span class="ident" id="5783638">uint64</span><span class="op" id="5783644">]</span><span class="op" id="5783645">*</span><span class="ident" id="5783646"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5783650">)</span><span class="op" id="5783651">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783657">go</span>&nbsp;<span class="ident" id="5783660"><a href="/net/rpc/client.go.html#5783581">client</a></span><span class="op" id="5783666">.</span><span class="ident" id="5783667">input</span><span class="op" id="5783672">(</span><span class="op" id="5783673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783676">return</span>&nbsp;<span class="ident" id="5783683"><a href="/net/rpc/client.go.html#5783581">client</a></span><br>
<span class="lineno"></span><span class="op" id="5783690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5783693">type</span>&nbsp;<span class="ident" id="5783698">gobClientCodec</span>&nbsp;<span class="keyword" id="5783713">struct</span>&nbsp;<span class="op" id="5783720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783723">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5783730"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5783732">.</span><span class="ident" id="5783733">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783750">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5783757">*</span><span class="ident" id="5783758"><a href="/net/rpc/client.go.html#5778325">gob</a></span><span class="op" id="5783761">.</span><span class="ident" id="5783762">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783771">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5783778">*</span><span class="ident" id="5783779"><a href="/net/rpc/client.go.html#5778325">gob</a></span><span class="op" id="5783782">.</span><span class="ident" id="5783783">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5783792">encBuf</span>&nbsp;<span class="op" id="5783799">*</span><span class="ident" id="5783800"><a href="/net/rpc/client.go.html#5778316">bufio</a></span><span class="op" id="5783805">.</span><span class="ident" id="5783806">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5783813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5783816">func</span>&nbsp;<span class="op" id="5783821">(</span><span class="ident" id="5783822">c</span>&nbsp;<span class="op" id="5783824">*</span><span class="ident" id="5783825"><a href="/net/rpc/client.go.html#5783698">gobClientCodec</a></span><span class="op" id="5783839">)</span>&nbsp;<span class="ident" id="5783841">WriteRequest</span><span class="op" id="5783853">(</span><span class="ident" id="5783854">r</span>&nbsp;<span class="op" id="5783856">*</span><span class="ident" id="5783857"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5783864">,</span>&nbsp;<span class="ident" id="5783866">body</span>&nbsp;<span class="keyword" id="5783871">interface</span><span class="op" id="5783880">{</span><span class="op" id="5783881">}</span><span class="op" id="5783882">)</span>&nbsp;<span class="op" id="5783884">(</span><span class="ident" id="5783885">err</span>&nbsp;<span class="builtintype" id="5783889">error</span><span class="op" id="5783894">)</span>&nbsp;<span class="op" id="5783896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783899">if</span>&nbsp;<span class="ident" id="5783902"><a href="/net/rpc/client.go.html#5783885">err</a></span>&nbsp;<span class="op" id="5783906">=</span>&nbsp;<span class="ident" id="5783908"><a href="/net/rpc/client.go.html#5783822">c</a></span><span class="op" id="5783909">.</span><span class="ident" id="5783910">enc</span><span class="op" id="5783913">.</span><span class="ident" id="5783914">Encode</span><span class="op" id="5783920">(</span><span class="ident" id="5783921"><a href="/net/rpc/client.go.html#5783854">r</a></span><span class="op" id="5783922">)</span><span class="op" id="5783923">;</span>&nbsp;<span class="ident" id="5783925"><a href="/net/rpc/client.go.html#5783885">err</a></span>&nbsp;<span class="op" id="5783929">!=</span>&nbsp;<span class="ident" id="5783932">nil</span>&nbsp;<span class="op" id="5783936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783940">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5783948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783951">if</span>&nbsp;<span class="ident" id="5783954"><a href="/net/rpc/client.go.html#5783885">err</a></span>&nbsp;<span class="op" id="5783958">=</span>&nbsp;<span class="ident" id="5783960"><a href="/net/rpc/client.go.html#5783822">c</a></span><span class="op" id="5783961">.</span><span class="ident" id="5783962">enc</span><span class="op" id="5783965">.</span><span class="ident" id="5783966">Encode</span><span class="op" id="5783972">(</span><span class="ident" id="5783973"><a href="/net/rpc/client.go.html#5783866">body</a></span><span class="op" id="5783977">)</span><span class="op" id="5783978">;</span>&nbsp;<span class="ident" id="5783980"><a href="/net/rpc/client.go.html#5783885">err</a></span>&nbsp;<span class="op" id="5783984">!=</span>&nbsp;<span class="ident" id="5783987">nil</span>&nbsp;<span class="op" id="5783991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5783995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784006">return</span>&nbsp;<span class="ident" id="5784013"><a href="/net/rpc/client.go.html#5783822">c</a></span><span class="op" id="5784014">.</span><span class="ident" id="5784015">encBuf</span><span class="op" id="5784021">.</span><span class="ident" id="5784022">Flush</span><span class="op" id="5784027">(</span><span class="op" id="5784028">)</span><br>
<span class="lineno">220</span><span class="op" id="5784030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5784033">func</span>&nbsp;<span class="op" id="5784038">(</span><span class="ident" id="5784039">c</span>&nbsp;<span class="op" id="5784041">*</span><span class="ident" id="5784042"><a href="/net/rpc/client.go.html#5783698">gobClientCodec</a></span><span class="op" id="5784056">)</span>&nbsp;<span class="ident" id="5784058">ReadResponseHeader</span><span class="op" id="5784076">(</span><span class="ident" id="5784077">r</span>&nbsp;<span class="op" id="5784079">*</span><span class="ident" id="5784080"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5784088">)</span>&nbsp;<span class="builtintype" id="5784090">error</span>&nbsp;<span class="op" id="5784096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784099">return</span>&nbsp;<span class="ident" id="5784106"><a href="/net/rpc/client.go.html#5784039">c</a></span><span class="op" id="5784107">.</span><span class="ident" id="5784108">dec</span><span class="op" id="5784111">.</span><span class="ident" id="5784112">Decode</span><span class="op" id="5784118">(</span><span class="ident" id="5784119"><a href="/net/rpc/client.go.html#5784077">r</a></span><span class="op" id="5784120">)</span><br>
<span class="lineno"></span><span class="op" id="5784122">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5784125">func</span>&nbsp;<span class="op" id="5784130">(</span><span class="ident" id="5784131">c</span>&nbsp;<span class="op" id="5784133">*</span><span class="ident" id="5784134"><a href="/net/rpc/client.go.html#5783698">gobClientCodec</a></span><span class="op" id="5784148">)</span>&nbsp;<span class="ident" id="5784150">ReadResponseBody</span><span class="op" id="5784166">(</span><span class="ident" id="5784167">body</span>&nbsp;<span class="keyword" id="5784172">interface</span><span class="op" id="5784181">{</span><span class="op" id="5784182">}</span><span class="op" id="5784183">)</span>&nbsp;<span class="builtintype" id="5784185">error</span>&nbsp;<span class="op" id="5784191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784194">return</span>&nbsp;<span class="ident" id="5784201"><a href="/net/rpc/client.go.html#5784131">c</a></span><span class="op" id="5784202">.</span><span class="ident" id="5784203">dec</span><span class="op" id="5784206">.</span><span class="ident" id="5784207">Decode</span><span class="op" id="5784213">(</span><span class="ident" id="5784214"><a href="/net/rpc/client.go.html#5784167">body</a></span><span class="op" id="5784218">)</span><br>
<span class="lineno"></span><span class="op" id="5784220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5784223">func</span>&nbsp;<span class="op" id="5784228">(</span><span class="ident" id="5784229">c</span>&nbsp;<span class="op" id="5784231">*</span><span class="ident" id="5784232"><a href="/net/rpc/client.go.html#5783698">gobClientCodec</a></span><span class="op" id="5784246">)</span>&nbsp;<span class="ident" id="5784248">Close</span><span class="op" id="5784253">(</span><span class="op" id="5784254">)</span>&nbsp;<span class="builtintype" id="5784256">error</span>&nbsp;<span class="op" id="5784262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784265">return</span>&nbsp;<span class="ident" id="5784272"><a href="/net/rpc/client.go.html#5784229">c</a></span><span class="op" id="5784273">.</span><span class="ident" id="5784274">rwc</span><span class="op" id="5784277">.</span><span class="ident" id="5784278">Close</span><span class="op" id="5784283">(</span><span class="op" id="5784284">)</span><br>
<span class="lineno"></span><span class="op" id="5784286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5784289">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5784365">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5784408">func</span>&nbsp;<span class="ident" id="5784413">DialHTTP</span><span class="op" id="5784421">(</span><span class="ident" id="5784422">network</span><span class="op" id="5784429">,</span>&nbsp;<span class="ident" id="5784431">address</span>&nbsp;<span class="builtintype" id="5784439">string</span><span class="op" id="5784445">)</span>&nbsp;<span class="op" id="5784447">(</span><span class="op" id="5784448">*</span><span class="ident" id="5784449"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5784455">,</span>&nbsp;<span class="builtintype" id="5784457">error</span><span class="op" id="5784462">)</span>&nbsp;<span class="op" id="5784464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784467">return</span>&nbsp;<span class="ident" id="5784474"><a href="/net/rpc/client.go.html#5784622">DialHTTPPath</a></span><span class="op" id="5784486">(</span><span class="ident" id="5784487"><a href="/net/rpc/client.go.html#5784422">network</a></span><span class="op" id="5784494">,</span>&nbsp;<span class="ident" id="5784496"><a href="/net/rpc/client.go.html#5784431">address</a></span><span class="op" id="5784503">,</span>&nbsp;<span class="ident" id="5784505"><a href="/net/rpc/server.go.html#5793387">DefaultRPCPath</a></span><span class="op" id="5784519">)</span><br>
<span class="lineno"></span><span class="op" id="5784521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5784524">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5784571">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5784617">func</span>&nbsp;<span class="ident" id="5784622">DialHTTPPath</span><span class="op" id="5784634">(</span><span class="ident" id="5784635">network</span><span class="op" id="5784642">,</span>&nbsp;<span class="ident" id="5784644">address</span><span class="op" id="5784651">,</span>&nbsp;<span class="ident" id="5784653">path</span>&nbsp;<span class="builtintype" id="5784658">string</span><span class="op" id="5784664">)</span>&nbsp;<span class="op" id="5784666">(</span><span class="op" id="5784667">*</span><span class="ident" id="5784668"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5784674">,</span>&nbsp;<span class="builtintype" id="5784676">error</span><span class="op" id="5784681">)</span>&nbsp;<span class="op" id="5784683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784686">var</span>&nbsp;<span class="ident" id="5784690">err</span>&nbsp;<span class="builtintype" id="5784694">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784701">conn</span><span class="op" id="5784705">,</span>&nbsp;<span class="ident" id="5784707"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5784711">:=</span>&nbsp;<span class="ident" id="5784714"><a href="/net/rpc/client.go.html#5778364">net</a></span><span class="op" id="5784717">.</span><span class="ident" id="5784718">Dial</span><span class="op" id="5784722">(</span><span class="ident" id="5784723"><a href="/net/rpc/client.go.html#5784635">network</a></span><span class="op" id="5784730">,</span>&nbsp;<span class="ident" id="5784732"><a href="/net/rpc/client.go.html#5784644">address</a></span><span class="op" id="5784739">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784742">if</span>&nbsp;<span class="ident" id="5784745"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5784749">!=</span>&nbsp;<span class="ident" id="5784752">nil</span>&nbsp;<span class="op" id="5784756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5784760">return</span>&nbsp;<span class="ident" id="5784767">nil</span><span class="op" id="5784770">,</span>&nbsp;<span class="ident" id="5784772"><a href="/net/rpc/client.go.html#5784690">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5784777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784780"><a href="/net/rpc/client.go.html#5778351">io</a></span><span class="op" id="5784782">.</span><span class="ident" id="5784783">WriteString</span><span class="op" id="5784794">(</span><span class="ident" id="5784795"><a href="/net/rpc/client.go.html#5784701">conn</a></span><span class="op" id="5784799">,</span>&nbsp;<span class="string" id="5784801">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5784811">+</span><span class="ident" id="5784812"><a href="/net/rpc/client.go.html#5784653">path</a></span><span class="op" id="5784816">+</span><span class="string" id="5784817">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5784832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784836">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5784873">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5784911">resp</span><span class="op" id="5784915">,</span>&nbsp;<span class="ident" id="5784917"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5784921">:=</span>&nbsp;<span class="ident" id="5784924"><a href="/net/rpc/client.go.html#5778371">http</a></span><span class="op" id="5784928">.</span><span class="ident" id="5784929">ReadResponse</span><span class="op" id="5784941">(</span><span class="ident" id="5784942"><a href="/net/rpc/client.go.html#5778316">bufio</a></span><span class="op" id="5784947">.</span><span class="ident" id="5784948">NewReader</span><span class="op" id="5784957">(</span><span class="ident" id="5784958"><a href="/net/rpc/client.go.html#5784701">conn</a></span><span class="op" id="5784962">)</span><span class="op" id="5784963">,</span>&nbsp;<span class="op" id="5784965">&amp;</span><span class="ident" id="5784966"><a href="/net/rpc/client.go.html#5778371">http</a></span><span class="op" id="5784970">.</span><span class="ident" id="5784971">Request</span><span class="op" id="5784978">{</span><span class="ident" id="5784979">Method</span><span class="op" id="5784985">:</span>&nbsp;<span class="string" id="5784987">&#34;CONNECT&#34;</span><span class="op" id="5784996">}</span><span class="op" id="5784997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785000">if</span>&nbsp;<span class="ident" id="5785003"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5785007">==</span>&nbsp;<span class="ident" id="5785010">nil</span>&nbsp;<span class="op" id="5785014">&amp;&amp;</span>&nbsp;<span class="ident" id="5785017"><a href="/net/rpc/client.go.html#5784911">resp</a></span><span class="op" id="5785021">.</span><span class="ident" id="5785022">Status</span>&nbsp;<span class="op" id="5785029">==</span>&nbsp;<span class="ident" id="5785032"><a href="/net/rpc/server.go.html#5809472">connected</a></span>&nbsp;<span class="op" id="5785042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785046">return</span>&nbsp;<span class="ident" id="5785053"><a href="/net/rpc/client.go.html#5783211">NewClient</a></span><span class="op" id="5785062">(</span><span class="ident" id="5785063"><a href="/net/rpc/client.go.html#5784701">conn</a></span><span class="op" id="5785067">)</span><span class="op" id="5785068">,</span>&nbsp;<span class="ident" id="5785070">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785078">if</span>&nbsp;<span class="ident" id="5785081"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5785085">==</span>&nbsp;<span class="ident" id="5785088">nil</span>&nbsp;<span class="op" id="5785092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785096"><a href="/net/rpc/client.go.html#5784690">err</a></span>&nbsp;<span class="op" id="5785100">=</span>&nbsp;<span class="ident" id="5785102"><a href="/net/rpc/client.go.html#5778341">errors</a></span><span class="op" id="5785108">.</span><span class="ident" id="5785109">New</span><span class="op" id="5785112">(</span><span class="string" id="5785113">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5785142">+</span>&nbsp;<span class="ident" id="5785144"><a href="/net/rpc/client.go.html#5784911">resp</a></span><span class="op" id="5785148">.</span><span class="ident" id="5785149">Status</span><span class="op" id="5785155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785161"><a href="/net/rpc/client.go.html#5784701">conn</a></span><span class="op" id="5785165">.</span><span class="ident" id="5785166">Close</span><span class="op" id="5785171">(</span><span class="op" id="5785172">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785175">return</span>&nbsp;<span class="ident" id="5785182">nil</span><span class="op" id="5785185">,</span>&nbsp;<span class="op" id="5785187">&amp;</span><span class="ident" id="5785188"><a href="/net/rpc/client.go.html#5778364">net</a></span><span class="op" id="5785191">.</span><span class="ident" id="5785192">OpError</span><span class="op" id="5785199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785203">Op</span><span class="op" id="5785205">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5785209">&#34;dial-http&#34;</span><span class="op" id="5785220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785224">Net</span><span class="op" id="5785227">:</span>&nbsp;&nbsp;<span class="ident" id="5785230"><a href="/net/rpc/client.go.html#5784635">network</a></span>&nbsp;<span class="op" id="5785238">+</span>&nbsp;<span class="string" id="5785240">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5785244">+</span>&nbsp;<span class="ident" id="5785246"><a href="/net/rpc/client.go.html#5784644">address</a></span><span class="op" id="5785253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785257">Addr</span><span class="op" id="5785261">:</span>&nbsp;<span class="ident" id="5785263">nil</span><span class="op" id="5785266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785270">Err</span><span class="op" id="5785273">:</span>&nbsp;&nbsp;<span class="ident" id="5785276"><a href="/net/rpc/client.go.html#5784690">err</a></span><span class="op" id="5785279">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785282">}</span><br>
<span class="lineno"></span><span class="op" id="5785284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785287">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5785355">func</span>&nbsp;<span class="ident" id="5785360">Dial</span><span class="op" id="5785364">(</span><span class="ident" id="5785365">network</span><span class="op" id="5785372">,</span>&nbsp;<span class="ident" id="5785374">address</span>&nbsp;<span class="builtintype" id="5785382">string</span><span class="op" id="5785388">)</span>&nbsp;<span class="op" id="5785390">(</span><span class="op" id="5785391">*</span><span class="ident" id="5785392"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5785398">,</span>&nbsp;<span class="builtintype" id="5785400">error</span><span class="op" id="5785405">)</span>&nbsp;<span class="op" id="5785407">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785410">conn</span><span class="op" id="5785414">,</span>&nbsp;<span class="ident" id="5785416">err</span>&nbsp;<span class="op" id="5785420">:=</span>&nbsp;<span class="ident" id="5785423"><a href="/net/rpc/client.go.html#5778364">net</a></span><span class="op" id="5785426">.</span><span class="ident" id="5785427">Dial</span><span class="op" id="5785431">(</span><span class="ident" id="5785432"><a href="/net/rpc/client.go.html#5785365">network</a></span><span class="op" id="5785439">,</span>&nbsp;<span class="ident" id="5785441"><a href="/net/rpc/client.go.html#5785374">address</a></span><span class="op" id="5785448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785451">if</span>&nbsp;<span class="ident" id="5785454"><a href="/net/rpc/client.go.html#5785416">err</a></span>&nbsp;<span class="op" id="5785458">!=</span>&nbsp;<span class="ident" id="5785461">nil</span>&nbsp;<span class="op" id="5785465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785469">return</span>&nbsp;<span class="ident" id="5785476">nil</span><span class="op" id="5785479">,</span>&nbsp;<span class="ident" id="5785481"><a href="/net/rpc/client.go.html#5785416">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785489">return</span>&nbsp;<span class="ident" id="5785496"><a href="/net/rpc/client.go.html#5783211">NewClient</a></span><span class="op" id="5785505">(</span><span class="ident" id="5785506"><a href="/net/rpc/client.go.html#5785410">conn</a></span><span class="op" id="5785510">)</span><span class="op" id="5785511">,</span>&nbsp;<span class="ident" id="5785513">nil</span><br>
<span class="lineno">275</span><span class="op" id="5785517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5785520">func</span>&nbsp;<span class="op" id="5785525">(</span><span class="ident" id="5785526">client</span>&nbsp;<span class="op" id="5785533">*</span><span class="ident" id="5785534"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5785540">)</span>&nbsp;<span class="ident" id="5785542">Close</span><span class="op" id="5785547">(</span><span class="op" id="5785548">)</span>&nbsp;<span class="builtintype" id="5785550">error</span>&nbsp;<span class="op" id="5785556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785559"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785565">.</span><span class="ident" id="5785566">mutex</span><span class="op" id="5785571">.</span><span class="ident" id="5785572">Lock</span><span class="op" id="5785576">(</span><span class="op" id="5785577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785580">if</span>&nbsp;<span class="ident" id="5785583"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785589">.</span><span class="ident" id="5785590">closing</span>&nbsp;<span class="op" id="5785598">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785602"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785608">.</span><span class="ident" id="5785609">mutex</span><span class="op" id="5785614">.</span><span class="ident" id="5785615">Unlock</span><span class="op" id="5785621">(</span><span class="op" id="5785622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785626">return</span>&nbsp;<span class="ident" id="5785633"><a href="/net/rpc/client.go.html#5778586">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5785646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785649"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785655">.</span><span class="ident" id="5785656">closing</span>&nbsp;<span class="op" id="5785664">=</span>&nbsp;<span class="builtintype" id="5785666">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5785672"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785678">.</span><span class="ident" id="5785679">mutex</span><span class="op" id="5785684">.</span><span class="ident" id="5785685">Unlock</span><span class="op" id="5785691">(</span><span class="op" id="5785692">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5785695">return</span>&nbsp;<span class="ident" id="5785702"><a href="/net/rpc/client.go.html#5785526">client</a></span><span class="op" id="5785708">.</span><span class="ident" id="5785709">codec</span><span class="op" id="5785714">.</span><span class="ident" id="5785715">Close</span><span class="op" id="5785720">(</span><span class="op" id="5785721">)</span><br>
<span class="lineno"></span><span class="op" id="5785723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5785726">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5785813">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5785901">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5785975">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5786043">func</span>&nbsp;<span class="op" id="5786048">(</span><span class="ident" id="5786049">client</span>&nbsp;<span class="op" id="5786056">*</span><span class="ident" id="5786057"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5786063">)</span>&nbsp;<span class="ident" id="5786065">Go</span><span class="op" id="5786067">(</span><span class="ident" id="5786068">serviceMethod</span>&nbsp;<span class="builtintype" id="5786082">string</span><span class="op" id="5786088">,</span>&nbsp;<span class="ident" id="5786090">args</span>&nbsp;<span class="keyword" id="5786095">interface</span><span class="op" id="5786104">{</span><span class="op" id="5786105">}</span><span class="op" id="5786106">,</span>&nbsp;<span class="ident" id="5786108">reply</span>&nbsp;<span class="keyword" id="5786114">interface</span><span class="op" id="5786123">{</span><span class="op" id="5786124">}</span><span class="op" id="5786125">,</span>&nbsp;<span class="ident" id="5786127">done</span>&nbsp;<span class="keyword" id="5786132">chan</span>&nbsp;<span class="op" id="5786137">*</span><span class="ident" id="5786138"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5786142">)</span>&nbsp;<span class="op" id="5786144">*</span><span class="ident" id="5786145"><a href="/net/rpc/client.go.html#5778678">Call</a></span>&nbsp;<span class="op" id="5786150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786153">call</span>&nbsp;<span class="op" id="5786158">:=</span>&nbsp;<span class="builtinfunc" id="5786161">new</span><span class="op" id="5786164">(</span><span class="ident" id="5786165"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5786169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786172"><a href="/net/rpc/client.go.html#5786153">call</a></span><span class="op" id="5786176">.</span><span class="ident" id="5786177">ServiceMethod</span>&nbsp;<span class="op" id="5786191">=</span>&nbsp;<span class="ident" id="5786193"><a href="/net/rpc/client.go.html#5786068">serviceMethod</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786208"><a href="/net/rpc/client.go.html#5786153">call</a></span><span class="op" id="5786212">.</span><span class="ident" id="5786213">Args</span>&nbsp;<span class="op" id="5786218">=</span>&nbsp;<span class="ident" id="5786220"><a href="/net/rpc/client.go.html#5786090">args</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786226"><a href="/net/rpc/client.go.html#5786153">call</a></span><span class="op" id="5786230">.</span><span class="ident" id="5786231">Reply</span>&nbsp;<span class="op" id="5786237">=</span>&nbsp;<span class="ident" id="5786239"><a href="/net/rpc/client.go.html#5786108">reply</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786246">if</span>&nbsp;<span class="ident" id="5786249"><a href="/net/rpc/client.go.html#5786127">done</a></span>&nbsp;<span class="op" id="5786254">==</span>&nbsp;<span class="ident" id="5786257">nil</span>&nbsp;<span class="op" id="5786261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786265"><a href="/net/rpc/client.go.html#5786127">done</a></span>&nbsp;<span class="op" id="5786270">=</span>&nbsp;<span class="builtinfunc" id="5786272">make</span><span class="op" id="5786276">(</span><span class="keyword" id="5786277">chan</span>&nbsp;<span class="op" id="5786282">*</span><span class="ident" id="5786283"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5786287">,</span>&nbsp;<span class="num" id="5786289">10</span><span class="op" id="5786291">)</span>&nbsp;<span class="comment" id="5786293">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786307">}</span>&nbsp;<span class="keyword" id="5786309">else</span>&nbsp;<span class="op" id="5786314">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786318">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786374">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786433">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5786492">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786549">if</span>&nbsp;<span class="builtinfunc" id="5786552">cap</span><span class="op" id="5786555">(</span><span class="ident" id="5786556"><a href="/net/rpc/client.go.html#5786127">done</a></span><span class="op" id="5786560">)</span>&nbsp;<span class="op" id="5786562">==</span>&nbsp;<span class="num" id="5786565">0</span>&nbsp;<span class="op" id="5786567">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786572"><a href="/net/rpc/client.go.html#5778357">log</a></span><span class="op" id="5786575">.</span><span class="ident" id="5786576">Panic</span><span class="op" id="5786581">(</span><span class="string" id="5786582">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5786615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5786622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786625"><a href="/net/rpc/client.go.html#5786153">call</a></span><span class="op" id="5786629">.</span><span class="ident" id="5786630">Done</span>&nbsp;<span class="op" id="5786635">=</span>&nbsp;<span class="ident" id="5786637"><a href="/net/rpc/client.go.html#5786127">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786643"><a href="/net/rpc/client.go.html#5786049">client</a></span><span class="op" id="5786649">.</span><span class="ident" id="5786650">send</span><span class="op" id="5786654">(</span><span class="ident" id="5786655"><a href="/net/rpc/client.go.html#5786153">call</a></span><span class="op" id="5786659">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786662">return</span>&nbsp;<span class="ident" id="5786669"><a href="/net/rpc/client.go.html#5786153">call</a></span><br>
<span class="lineno"></span><span class="op" id="5786674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5786677">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5786769">func</span>&nbsp;<span class="op" id="5786774">(</span><span class="ident" id="5786775">client</span>&nbsp;<span class="op" id="5786782">*</span><span class="ident" id="5786783"><a href="/net/rpc/client.go.html#5779222">Client</a></span><span class="op" id="5786789">)</span>&nbsp;<span class="ident" id="5786791">Call</span><span class="op" id="5786795">(</span><span class="ident" id="5786796">serviceMethod</span>&nbsp;<span class="builtintype" id="5786810">string</span><span class="op" id="5786816">,</span>&nbsp;<span class="ident" id="5786818">args</span>&nbsp;<span class="keyword" id="5786823">interface</span><span class="op" id="5786832">{</span><span class="op" id="5786833">}</span><span class="op" id="5786834">,</span>&nbsp;<span class="ident" id="5786836">reply</span>&nbsp;<span class="keyword" id="5786842">interface</span><span class="op" id="5786851">{</span><span class="op" id="5786852">}</span><span class="op" id="5786853">)</span>&nbsp;<span class="builtintype" id="5786855">error</span>&nbsp;<span class="op" id="5786861">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5786864">call</span>&nbsp;<span class="op" id="5786869">:=</span>&nbsp;<span class="op" id="5786872">&lt;-</span><span class="ident" id="5786874"><a href="/net/rpc/client.go.html#5786775">client</a></span><span class="op" id="5786880">.</span><span class="ident" id="5786881">Go</span><span class="op" id="5786883">(</span><span class="ident" id="5786884"><a href="/net/rpc/client.go.html#5786796">serviceMethod</a></span><span class="op" id="5786897">,</span>&nbsp;<span class="ident" id="5786899"><a href="/net/rpc/client.go.html#5786818">args</a></span><span class="op" id="5786903">,</span>&nbsp;<span class="ident" id="5786905"><a href="/net/rpc/client.go.html#5786836">reply</a></span><span class="op" id="5786910">,</span>&nbsp;<span class="builtinfunc" id="5786912">make</span><span class="op" id="5786916">(</span><span class="keyword" id="5786917">chan</span>&nbsp;<span class="op" id="5786922">*</span><span class="ident" id="5786923"><a href="/net/rpc/client.go.html#5778678">Call</a></span><span class="op" id="5786927">,</span>&nbsp;<span class="num" id="5786929">1</span><span class="op" id="5786930">)</span><span class="op" id="5786931">)</span><span class="op" id="5786932">.</span><span class="ident" id="5786933">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5786939">return</span>&nbsp;<span class="ident" id="5786946"><a href="/net/rpc/client.go.html#5786864">call</a></span><span class="op" id="5786950">.</span><span class="ident" id="5786951">Error</span><br>
<span class="lineno"></span><span class="op" id="5786957">}</span>
</div>
</body>
</html>
