<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html" class="current">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4453489">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4453544">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4453598">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4453649">package</span>&nbsp;<span class="ident" id="4453657">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4453662">import</span>&nbsp;<span class="op" id="4453669">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453672">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453682">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453697">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453711">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453726">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4453743">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4453750">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4453753">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4453825">func</span>&nbsp;<span class="ident" id="4453830">splitPreMasterSecret</span><span class="op" id="4453850">(</span><span class="ident" id="4453851">secret</span>&nbsp;<span class="op" id="4453858">[</span><span class="op" id="4453859">]</span><span class="builtintype" id="4453860">byte</span><span class="op" id="4453864">)</span>&nbsp;<span class="op" id="4453866">(</span><span class="ident" id="4453867">s1</span><span class="op" id="4453869">,</span>&nbsp;<span class="ident" id="4453871">s2</span>&nbsp;<span class="op" id="4453874">[</span><span class="op" id="4453875">]</span><span class="builtintype" id="4453876">byte</span><span class="op" id="4453880">)</span>&nbsp;<span class="op" id="4453882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4453885">s1</span>&nbsp;<span class="op" id="4453888">=</span>&nbsp;<span class="ident" id="4453890">secret</span><span class="op" id="4453896">[</span><span class="num" id="4453897">0</span>&nbsp;<span class="op" id="4453899">:</span>&nbsp;<span class="op" id="4453901">(</span><span class="builtinfunc" id="4453902">len</span><span class="op" id="4453905">(</span><span class="ident" id="4453906">secret</span><span class="op" id="4453912">)</span><span class="op" id="4453913">+</span><span class="num" id="4453914">1</span><span class="op" id="4453915">)</span><span class="op" id="4453916">/</span><span class="num" id="4453917">2</span><span class="op" id="4453918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4453921">s2</span>&nbsp;<span class="op" id="4453924">=</span>&nbsp;<span class="ident" id="4453926">secret</span><span class="op" id="4453932">[</span><span class="builtinfunc" id="4453933">len</span><span class="op" id="4453936">(</span><span class="ident" id="4453937">secret</span><span class="op" id="4453943">)</span><span class="op" id="4453944">/</span><span class="num" id="4453945">2</span><span class="op" id="4453946">:</span><span class="op" id="4453947">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4453950">return</span><br>
<span class="lineno"></span><span class="op" id="4453957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453960">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4454036">func</span>&nbsp;<span class="ident" id="4454041">pHash</span><span class="op" id="4454046">(</span><span class="ident" id="4454047">result</span><span class="op" id="4454053">,</span>&nbsp;<span class="ident" id="4454055">secret</span><span class="op" id="4454061">,</span>&nbsp;<span class="ident" id="4454063">seed</span>&nbsp;<span class="op" id="4454068">[</span><span class="op" id="4454069">]</span><span class="builtintype" id="4454070">byte</span><span class="op" id="4454074">,</span>&nbsp;<span class="ident" id="4454076">hash</span>&nbsp;<span class="keyword" id="4454081">func</span><span class="op" id="4454085">(</span><span class="op" id="4454086">)</span>&nbsp;<span class="ident" id="4454088">hash</span><span class="op" id="4454092">.</span><span class="ident" id="4454093">Hash</span><span class="op" id="4454097">)</span>&nbsp;<span class="op" id="4454099">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454102">h</span>&nbsp;<span class="op" id="4454104">:=</span>&nbsp;<span class="ident" id="4454107">hmac</span><span class="op" id="4454111">.</span><span class="ident" id="4454112">New</span><span class="op" id="4454115">(</span><span class="ident" id="4454116">hash</span><span class="op" id="4454120">,</span>&nbsp;<span class="ident" id="4454122">secret</span><span class="op" id="4454128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454131">h</span><span class="op" id="4454132">.</span><span class="ident" id="4454133">Write</span><span class="op" id="4454138">(</span><span class="ident" id="4454139">seed</span><span class="op" id="4454143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454146">a</span>&nbsp;<span class="op" id="4454148">:=</span>&nbsp;<span class="ident" id="4454151">h</span><span class="op" id="4454152">.</span><span class="ident" id="4454153">Sum</span><span class="op" id="4454156">(</span><span class="builtintype" id="4454157">nil</span><span class="op" id="4454160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454164">j</span>&nbsp;<span class="op" id="4454166">:=</span>&nbsp;<span class="num" id="4454169">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454172">for</span>&nbsp;<span class="ident" id="4454176">j</span>&nbsp;<span class="op" id="4454178">&lt;</span>&nbsp;<span class="builtinfunc" id="4454180">len</span><span class="op" id="4454183">(</span><span class="ident" id="4454184">result</span><span class="op" id="4454190">)</span>&nbsp;<span class="op" id="4454192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454196">h</span><span class="op" id="4454197">.</span><span class="ident" id="4454198">Reset</span><span class="op" id="4454203">(</span><span class="op" id="4454204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454208">h</span><span class="op" id="4454209">.</span><span class="ident" id="4454210">Write</span><span class="op" id="4454215">(</span><span class="ident" id="4454216">a</span><span class="op" id="4454217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454221">h</span><span class="op" id="4454222">.</span><span class="ident" id="4454223">Write</span><span class="op" id="4454228">(</span><span class="ident" id="4454229">seed</span><span class="op" id="4454233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454237">b</span>&nbsp;<span class="op" id="4454239">:=</span>&nbsp;<span class="ident" id="4454242">h</span><span class="op" id="4454243">.</span><span class="ident" id="4454244">Sum</span><span class="op" id="4454247">(</span><span class="builtintype" id="4454248">nil</span><span class="op" id="4454251">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454255">todo</span>&nbsp;<span class="op" id="4454260">:=</span>&nbsp;<span class="builtinfunc" id="4454263">len</span><span class="op" id="4454266">(</span><span class="ident" id="4454267">b</span><span class="op" id="4454268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454272">if</span>&nbsp;<span class="ident" id="4454275">j</span><span class="op" id="4454276">+</span><span class="ident" id="4454277">todo</span>&nbsp;<span class="op" id="4454282">&gt;</span>&nbsp;<span class="builtinfunc" id="4454284">len</span><span class="op" id="4454287">(</span><span class="ident" id="4454288">result</span><span class="op" id="4454294">)</span>&nbsp;<span class="op" id="4454296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454301">todo</span>&nbsp;<span class="op" id="4454306">=</span>&nbsp;<span class="builtinfunc" id="4454308">len</span><span class="op" id="4454311">(</span><span class="ident" id="4454312">result</span><span class="op" id="4454318">)</span>&nbsp;<span class="op" id="4454320">-</span>&nbsp;<span class="ident" id="4454322">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4454330">copy</span><span class="op" id="4454334">(</span><span class="ident" id="4454335">result</span><span class="op" id="4454341">[</span><span class="ident" id="4454342">j</span><span class="op" id="4454343">:</span><span class="ident" id="4454344">j</span><span class="op" id="4454345">+</span><span class="ident" id="4454346">todo</span><span class="op" id="4454350">]</span><span class="op" id="4454351">,</span>&nbsp;<span class="ident" id="4454353">b</span><span class="op" id="4454354">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454358">j</span>&nbsp;<span class="op" id="4454360">+=</span>&nbsp;<span class="ident" id="4454363">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454371">h</span><span class="op" id="4454372">.</span><span class="ident" id="4454373">Reset</span><span class="op" id="4454378">(</span><span class="op" id="4454379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454383">h</span><span class="op" id="4454384">.</span><span class="ident" id="4454385">Write</span><span class="op" id="4454390">(</span><span class="ident" id="4454391">a</span><span class="op" id="4454392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454396">a</span>&nbsp;<span class="op" id="4454398">=</span>&nbsp;<span class="ident" id="4454400">h</span><span class="op" id="4454401">.</span><span class="ident" id="4454402">Sum</span><span class="op" id="4454405">(</span><span class="builtintype" id="4454406">nil</span><span class="op" id="4454409">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454412">}</span><br>
<span class="lineno"></span><span class="op" id="4454414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4454417">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4454508">func</span>&nbsp;<span class="ident" id="4454513">prf10</span><span class="op" id="4454518">(</span><span class="ident" id="4454519">result</span><span class="op" id="4454525">,</span>&nbsp;<span class="ident" id="4454527">secret</span><span class="op" id="4454533">,</span>&nbsp;<span class="ident" id="4454535">label</span><span class="op" id="4454540">,</span>&nbsp;<span class="ident" id="4454542">seed</span>&nbsp;<span class="op" id="4454547">[</span><span class="op" id="4454548">]</span><span class="builtintype" id="4454549">byte</span><span class="op" id="4454553">)</span>&nbsp;<span class="op" id="4454555">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454558">hashSHA1</span>&nbsp;<span class="op" id="4454567">:=</span>&nbsp;<span class="ident" id="4454570">sha1</span><span class="op" id="4454574">.</span><span class="ident" id="4454575">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454580">hashMD5</span>&nbsp;<span class="op" id="4454588">:=</span>&nbsp;<span class="ident" id="4454591">md5</span><span class="op" id="4454594">.</span><span class="ident" id="4454595">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454601">labelAndSeed</span>&nbsp;<span class="op" id="4454614">:=</span>&nbsp;<span class="builtinfunc" id="4454617">make</span><span class="op" id="4454621">(</span><span class="op" id="4454622">[</span><span class="op" id="4454623">]</span><span class="builtintype" id="4454624">byte</span><span class="op" id="4454628">,</span>&nbsp;<span class="builtinfunc" id="4454630">len</span><span class="op" id="4454633">(</span><span class="ident" id="4454634">label</span><span class="op" id="4454639">)</span><span class="op" id="4454640">+</span><span class="builtinfunc" id="4454641">len</span><span class="op" id="4454644">(</span><span class="ident" id="4454645">seed</span><span class="op" id="4454649">)</span><span class="op" id="4454650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4454653">copy</span><span class="op" id="4454657">(</span><span class="ident" id="4454658">labelAndSeed</span><span class="op" id="4454670">,</span>&nbsp;<span class="ident" id="4454672">label</span><span class="op" id="4454677">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4454680">copy</span><span class="op" id="4454684">(</span><span class="ident" id="4454685">labelAndSeed</span><span class="op" id="4454697">[</span><span class="builtinfunc" id="4454698">len</span><span class="op" id="4454701">(</span><span class="ident" id="4454702">label</span><span class="op" id="4454707">)</span><span class="op" id="4454708">:</span><span class="op" id="4454709">]</span><span class="op" id="4454710">,</span>&nbsp;<span class="ident" id="4454712">seed</span><span class="op" id="4454716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454720">s1</span><span class="op" id="4454722">,</span>&nbsp;<span class="ident" id="4454724">s2</span>&nbsp;<span class="op" id="4454727">:=</span>&nbsp;<span class="ident" id="4454730">splitPreMasterSecret</span><span class="op" id="4454750">(</span><span class="ident" id="4454751">secret</span><span class="op" id="4454757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454760">pHash</span><span class="op" id="4454765">(</span><span class="ident" id="4454766">result</span><span class="op" id="4454772">,</span>&nbsp;<span class="ident" id="4454774">s1</span><span class="op" id="4454776">,</span>&nbsp;<span class="ident" id="4454778">labelAndSeed</span><span class="op" id="4454790">,</span>&nbsp;<span class="ident" id="4454792">hashMD5</span><span class="op" id="4454799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454802">result2</span>&nbsp;<span class="op" id="4454810">:=</span>&nbsp;<span class="builtinfunc" id="4454813">make</span><span class="op" id="4454817">(</span><span class="op" id="4454818">[</span><span class="op" id="4454819">]</span><span class="builtintype" id="4454820">byte</span><span class="op" id="4454824">,</span>&nbsp;<span class="builtinfunc" id="4454826">len</span><span class="op" id="4454829">(</span><span class="ident" id="4454830">result</span><span class="op" id="4454836">)</span><span class="op" id="4454837">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454840">pHash</span><span class="op" id="4454845">(</span><span class="ident" id="4454846">result2</span><span class="op" id="4454853">,</span>&nbsp;<span class="ident" id="4454855">s2</span><span class="op" id="4454857">,</span>&nbsp;<span class="ident" id="4454859">labelAndSeed</span><span class="op" id="4454871">,</span>&nbsp;<span class="ident" id="4454873">hashSHA1</span><span class="op" id="4454881">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454885">for</span>&nbsp;<span class="ident" id="4454889">i</span><span class="op" id="4454890">,</span>&nbsp;<span class="ident" id="4454892">b</span>&nbsp;<span class="op" id="4454894">:=</span>&nbsp;<span class="keyword" id="4454897">range</span>&nbsp;<span class="ident" id="4454903">result2</span>&nbsp;<span class="op" id="4454911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454915">result</span><span class="op" id="4454921">[</span><span class="ident" id="4454922">i</span><span class="op" id="4454923">]</span>&nbsp;<span class="op" id="4454925">^=</span>&nbsp;<span class="ident" id="4454928">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454931">}</span><br>
<span class="lineno">65</span><span class="op" id="4454933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4454936">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="4455027">func</span>&nbsp;<span class="ident" id="4455032">prf12</span><span class="op" id="4455037">(</span><span class="ident" id="4455038">result</span><span class="op" id="4455044">,</span>&nbsp;<span class="ident" id="4455046">secret</span><span class="op" id="4455052">,</span>&nbsp;<span class="ident" id="4455054">label</span><span class="op" id="4455059">,</span>&nbsp;<span class="ident" id="4455061">seed</span>&nbsp;<span class="op" id="4455066">[</span><span class="op" id="4455067">]</span><span class="builtintype" id="4455068">byte</span><span class="op" id="4455072">)</span>&nbsp;<span class="op" id="4455074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455077">labelAndSeed</span>&nbsp;<span class="op" id="4455090">:=</span>&nbsp;<span class="builtinfunc" id="4455093">make</span><span class="op" id="4455097">(</span><span class="op" id="4455098">[</span><span class="op" id="4455099">]</span><span class="builtintype" id="4455100">byte</span><span class="op" id="4455104">,</span>&nbsp;<span class="builtinfunc" id="4455106">len</span><span class="op" id="4455109">(</span><span class="ident" id="4455110">label</span><span class="op" id="4455115">)</span><span class="op" id="4455116">+</span><span class="builtinfunc" id="4455117">len</span><span class="op" id="4455120">(</span><span class="ident" id="4455121">seed</span><span class="op" id="4455125">)</span><span class="op" id="4455126">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4455129">copy</span><span class="op" id="4455133">(</span><span class="ident" id="4455134">labelAndSeed</span><span class="op" id="4455146">,</span>&nbsp;<span class="ident" id="4455148">label</span><span class="op" id="4455153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4455156">copy</span><span class="op" id="4455160">(</span><span class="ident" id="4455161">labelAndSeed</span><span class="op" id="4455173">[</span><span class="builtinfunc" id="4455174">len</span><span class="op" id="4455177">(</span><span class="ident" id="4455178">label</span><span class="op" id="4455183">)</span><span class="op" id="4455184">:</span><span class="op" id="4455185">]</span><span class="op" id="4455186">,</span>&nbsp;<span class="ident" id="4455188">seed</span><span class="op" id="4455192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455196">pHash</span><span class="op" id="4455201">(</span><span class="ident" id="4455202">result</span><span class="op" id="4455208">,</span>&nbsp;<span class="ident" id="4455210">secret</span><span class="op" id="4455216">,</span>&nbsp;<span class="ident" id="4455218">labelAndSeed</span><span class="op" id="4455230">,</span>&nbsp;<span class="ident" id="4455232">sha256</span><span class="op" id="4455238">.</span><span class="ident" id="4455239">New</span><span class="op" id="4455242">)</span><br>
<span class="lineno"></span><span class="op" id="4455244">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4455247">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4455317">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="4455390">func</span>&nbsp;<span class="ident" id="4455395">prf30</span><span class="op" id="4455400">(</span><span class="ident" id="4455401">result</span><span class="op" id="4455407">,</span>&nbsp;<span class="ident" id="4455409">secret</span><span class="op" id="4455415">,</span>&nbsp;<span class="ident" id="4455417">label</span><span class="op" id="4455422">,</span>&nbsp;<span class="ident" id="4455424">seed</span>&nbsp;<span class="op" id="4455429">[</span><span class="op" id="4455430">]</span><span class="builtintype" id="4455431">byte</span><span class="op" id="4455435">)</span>&nbsp;<span class="op" id="4455437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455440">hashSHA1</span>&nbsp;<span class="op" id="4455449">:=</span>&nbsp;<span class="ident" id="4455452">sha1</span><span class="op" id="4455456">.</span><span class="ident" id="4455457">New</span><span class="op" id="4455460">(</span><span class="op" id="4455461">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455464">hashMD5</span>&nbsp;<span class="op" id="4455472">:=</span>&nbsp;<span class="ident" id="4455475">md5</span><span class="op" id="4455478">.</span><span class="ident" id="4455479">New</span><span class="op" id="4455482">(</span><span class="op" id="4455483">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455487">done</span>&nbsp;<span class="op" id="4455492">:=</span>&nbsp;<span class="num" id="4455495">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455498">i</span>&nbsp;<span class="op" id="4455500">:=</span>&nbsp;<span class="num" id="4455503">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4455506">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4455577">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4455649">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4455721">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455740">var</span>&nbsp;<span class="ident" id="4455744">b</span>&nbsp;<span class="op" id="4455746">[</span><span class="num" id="4455747">11</span><span class="op" id="4455749">]</span><span class="builtintype" id="4455750">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455756">for</span>&nbsp;<span class="ident" id="4455760">done</span>&nbsp;<span class="op" id="4455765">&lt;</span>&nbsp;<span class="builtinfunc" id="4455767">len</span><span class="op" id="4455770">(</span><span class="ident" id="4455771">result</span><span class="op" id="4455777">)</span>&nbsp;<span class="op" id="4455779">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455783">for</span>&nbsp;<span class="ident" id="4455787">j</span>&nbsp;<span class="op" id="4455789">:=</span>&nbsp;<span class="num" id="4455792">0</span><span class="op" id="4455793">;</span>&nbsp;<span class="ident" id="4455795">j</span>&nbsp;<span class="op" id="4455797">&lt;=</span>&nbsp;<span class="ident" id="4455800">i</span><span class="op" id="4455801">;</span>&nbsp;<span class="ident" id="4455803">j</span><span class="op" id="4455804">++</span>&nbsp;<span class="op" id="4455807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455812">b</span><span class="op" id="4455813">[</span><span class="ident" id="4455814">j</span><span class="op" id="4455815">]</span>&nbsp;<span class="op" id="4455817">=</span>&nbsp;<span class="string" id="4455819">&#39;A&#39;</span>&nbsp;<span class="op" id="4455823">+</span>&nbsp;<span class="builtintype" id="4455825">byte</span><span class="op" id="4455829">(</span><span class="ident" id="4455830">i</span><span class="op" id="4455831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455840">hashSHA1</span><span class="op" id="4455848">.</span><span class="ident" id="4455849">Reset</span><span class="op" id="4455854">(</span><span class="op" id="4455855">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455859">hashSHA1</span><span class="op" id="4455867">.</span><span class="ident" id="4455868">Write</span><span class="op" id="4455873">(</span><span class="ident" id="4455874">b</span><span class="op" id="4455875">[</span><span class="op" id="4455876">:</span><span class="ident" id="4455877">i</span><span class="op" id="4455878">+</span><span class="num" id="4455879">1</span><span class="op" id="4455880">]</span><span class="op" id="4455881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455885">hashSHA1</span><span class="op" id="4455893">.</span><span class="ident" id="4455894">Write</span><span class="op" id="4455899">(</span><span class="ident" id="4455900">secret</span><span class="op" id="4455906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455910">hashSHA1</span><span class="op" id="4455918">.</span><span class="ident" id="4455919">Write</span><span class="op" id="4455924">(</span><span class="ident" id="4455925">seed</span><span class="op" id="4455929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455933">digest</span>&nbsp;<span class="op" id="4455940">:=</span>&nbsp;<span class="ident" id="4455943">hashSHA1</span><span class="op" id="4455951">.</span><span class="ident" id="4455952">Sum</span><span class="op" id="4455955">(</span><span class="builtintype" id="4455956">nil</span><span class="op" id="4455959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455964">hashMD5</span><span class="op" id="4455971">.</span><span class="ident" id="4455972">Reset</span><span class="op" id="4455977">(</span><span class="op" id="4455978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455982">hashMD5</span><span class="op" id="4455989">.</span><span class="ident" id="4455990">Write</span><span class="op" id="4455995">(</span><span class="ident" id="4455996">secret</span><span class="op" id="4456002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456006">hashMD5</span><span class="op" id="4456013">.</span><span class="ident" id="4456014">Write</span><span class="op" id="4456019">(</span><span class="ident" id="4456020">digest</span><span class="op" id="4456026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456031">done</span>&nbsp;<span class="op" id="4456036">+=</span>&nbsp;<span class="builtinfunc" id="4456039">copy</span><span class="op" id="4456043">(</span><span class="ident" id="4456044">result</span><span class="op" id="4456050">[</span><span class="ident" id="4456051">done</span><span class="op" id="4456055">:</span><span class="op" id="4456056">]</span><span class="op" id="4456057">,</span>&nbsp;<span class="ident" id="4456059">hashMD5</span><span class="op" id="4456066">.</span><span class="ident" id="4456067">Sum</span><span class="op" id="4456070">(</span><span class="builtintype" id="4456071">nil</span><span class="op" id="4456074">)</span><span class="op" id="4456075">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456079">i</span><span class="op" id="4456080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456084">}</span><br>
<span class="lineno"></span><span class="op" id="4456086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4456089">const</span>&nbsp;<span class="op" id="4456095">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456098">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456119">=</span>&nbsp;<span class="num" id="4456121">32</span>&nbsp;<span class="comment" id="4456124">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456165">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4456186">=</span>&nbsp;<span class="num" id="4456188">48</span>&nbsp;<span class="comment" id="4456191">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456233">finishedVerifyLength</span>&nbsp;<span class="op" id="4456254">=</span>&nbsp;<span class="num" id="4456256">12</span>&nbsp;<span class="comment" id="4456259">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="4456307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4456310">var</span>&nbsp;<span class="ident" id="4456314">masterSecretLabel</span>&nbsp;<span class="op" id="4456332">=</span>&nbsp;<span class="op" id="4456334">[</span><span class="op" id="4456335">]</span><span class="builtintype" id="4456336">byte</span><span class="op" id="4456340">(</span><span class="string" id="4456341">&#34;master&nbsp;secret&#34;</span><span class="op" id="4456356">)</span><br>
<span class="lineno"></span><span class="keyword" id="4456358">var</span>&nbsp;<span class="ident" id="4456362">keyExpansionLabel</span>&nbsp;<span class="op" id="4456380">=</span>&nbsp;<span class="op" id="4456382">[</span><span class="op" id="4456383">]</span><span class="builtintype" id="4456384">byte</span><span class="op" id="4456388">(</span><span class="string" id="4456389">&#34;key&nbsp;expansion&#34;</span><span class="op" id="4456404">)</span><br>
<span class="lineno"></span><span class="keyword" id="4456406">var</span>&nbsp;<span class="ident" id="4456410">clientFinishedLabel</span>&nbsp;<span class="op" id="4456430">=</span>&nbsp;<span class="op" id="4456432">[</span><span class="op" id="4456433">]</span><span class="builtintype" id="4456434">byte</span><span class="op" id="4456438">(</span><span class="string" id="4456439">&#34;client&nbsp;finished&#34;</span><span class="op" id="4456456">)</span><br>
<span class="lineno"></span><span class="keyword" id="4456458">var</span>&nbsp;<span class="ident" id="4456462">serverFinishedLabel</span>&nbsp;<span class="op" id="4456482">=</span>&nbsp;<span class="op" id="4456484">[</span><span class="op" id="4456485">]</span><span class="builtintype" id="4456486">byte</span><span class="op" id="4456490">(</span><span class="string" id="4456491">&#34;server&nbsp;finished&#34;</span><span class="op" id="4456508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="4456511">func</span>&nbsp;<span class="ident" id="4456516">prfForVersion</span><span class="op" id="4456529">(</span><span class="ident" id="4456530">version</span>&nbsp;<span class="builtintype" id="4456538">uint16</span><span class="op" id="4456544">)</span>&nbsp;<span class="keyword" id="4456546">func</span><span class="op" id="4456550">(</span><span class="ident" id="4456551">result</span><span class="op" id="4456557">,</span>&nbsp;<span class="ident" id="4456559">secret</span><span class="op" id="4456565">,</span>&nbsp;<span class="ident" id="4456567">label</span><span class="op" id="4456572">,</span>&nbsp;<span class="ident" id="4456574">seed</span>&nbsp;<span class="op" id="4456579">[</span><span class="op" id="4456580">]</span><span class="builtintype" id="4456581">byte</span><span class="op" id="4456585">)</span>&nbsp;<span class="op" id="4456587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456590">switch</span>&nbsp;<span class="ident" id="4456597">version</span>&nbsp;<span class="op" id="4456605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456608">case</span>&nbsp;<span class="ident" id="4456613">VersionSSL30</span><span class="op" id="4456625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456629">return</span>&nbsp;<span class="ident" id="4456636">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456643">case</span>&nbsp;<span class="ident" id="4456648">VersionTLS10</span><span class="op" id="4456660">,</span>&nbsp;<span class="ident" id="4456662">VersionTLS11</span><span class="op" id="4456674">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456678">return</span>&nbsp;<span class="ident" id="4456685">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456692">case</span>&nbsp;<span class="ident" id="4456697">VersionTLS12</span><span class="op" id="4456709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456713">return</span>&nbsp;<span class="ident" id="4456720">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456727">default</span><span class="op" id="4456734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4456738">panic</span><span class="op" id="4456743">(</span><span class="string" id="4456744">&#34;unknown&nbsp;version&#34;</span><span class="op" id="4456761">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456764">}</span><br>
<span class="lineno"></span><span class="op" id="4456766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4456769">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="4456846">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="4456908">func</span>&nbsp;<span class="ident" id="4456913">masterFromPreMasterSecret</span><span class="op" id="4456938">(</span><span class="ident" id="4456939">version</span>&nbsp;<span class="builtintype" id="4456947">uint16</span><span class="op" id="4456953">,</span>&nbsp;<span class="ident" id="4456955">preMasterSecret</span><span class="op" id="4456970">,</span>&nbsp;<span class="ident" id="4456972">clientRandom</span><span class="op" id="4456984">,</span>&nbsp;<span class="ident" id="4456986">serverRandom</span>&nbsp;<span class="op" id="4456999">[</span><span class="op" id="4457000">]</span><span class="builtintype" id="4457001">byte</span><span class="op" id="4457005">)</span>&nbsp;<span class="op" id="4457007">[</span><span class="op" id="4457008">]</span><span class="builtintype" id="4457009">byte</span>&nbsp;<span class="op" id="4457014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457017">var</span>&nbsp;<span class="ident" id="4457021">seed</span>&nbsp;<span class="op" id="4457026">[</span><span class="ident" id="4457027">tlsRandomLength</span>&nbsp;<span class="op" id="4457043">*</span>&nbsp;<span class="num" id="4457045">2</span><span class="op" id="4457046">]</span><span class="builtintype" id="4457047">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4457053">copy</span><span class="op" id="4457057">(</span><span class="ident" id="4457058">seed</span><span class="op" id="4457062">[</span><span class="num" id="4457063">0</span><span class="op" id="4457064">:</span><span class="builtinfunc" id="4457065">len</span><span class="op" id="4457068">(</span><span class="ident" id="4457069">clientRandom</span><span class="op" id="4457081">)</span><span class="op" id="4457082">]</span><span class="op" id="4457083">,</span>&nbsp;<span class="ident" id="4457085">clientRandom</span><span class="op" id="4457097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4457100">copy</span><span class="op" id="4457104">(</span><span class="ident" id="4457105">seed</span><span class="op" id="4457109">[</span><span class="builtinfunc" id="4457110">len</span><span class="op" id="4457113">(</span><span class="ident" id="4457114">clientRandom</span><span class="op" id="4457126">)</span><span class="op" id="4457127">:</span><span class="op" id="4457128">]</span><span class="op" id="4457129">,</span>&nbsp;<span class="ident" id="4457131">serverRandom</span><span class="op" id="4457143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457146">masterSecret</span>&nbsp;<span class="op" id="4457159">:=</span>&nbsp;<span class="builtinfunc" id="4457162">make</span><span class="op" id="4457166">(</span><span class="op" id="4457167">[</span><span class="op" id="4457168">]</span><span class="builtintype" id="4457169">byte</span><span class="op" id="4457173">,</span>&nbsp;<span class="ident" id="4457175">masterSecretLength</span><span class="op" id="4457193">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457196">prfForVersion</span><span class="op" id="4457209">(</span><span class="ident" id="4457210">version</span><span class="op" id="4457217">)</span><span class="op" id="4457218">(</span><span class="ident" id="4457219">masterSecret</span><span class="op" id="4457231">,</span>&nbsp;<span class="ident" id="4457233">preMasterSecret</span><span class="op" id="4457248">,</span>&nbsp;<span class="ident" id="4457250">masterSecretLabel</span><span class="op" id="4457267">,</span>&nbsp;<span class="ident" id="4457269">seed</span><span class="op" id="4457273">[</span><span class="num" id="4457274">0</span><span class="op" id="4457275">:</span><span class="op" id="4457276">]</span><span class="op" id="4457277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457280">return</span>&nbsp;<span class="ident" id="4457287">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="4457300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4457303">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="4457373">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4457451">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4457477">func</span>&nbsp;<span class="ident" id="4457482">keysFromMasterSecret</span><span class="op" id="4457502">(</span><span class="ident" id="4457503">version</span>&nbsp;<span class="builtintype" id="4457511">uint16</span><span class="op" id="4457517">,</span>&nbsp;<span class="ident" id="4457519">masterSecret</span><span class="op" id="4457531">,</span>&nbsp;<span class="ident" id="4457533">clientRandom</span><span class="op" id="4457545">,</span>&nbsp;<span class="ident" id="4457547">serverRandom</span>&nbsp;<span class="op" id="4457560">[</span><span class="op" id="4457561">]</span><span class="builtintype" id="4457562">byte</span><span class="op" id="4457566">,</span>&nbsp;<span class="ident" id="4457568">macLen</span><span class="op" id="4457574">,</span>&nbsp;<span class="ident" id="4457576">keyLen</span><span class="op" id="4457582">,</span>&nbsp;<span class="ident" id="4457584">ivLen</span>&nbsp;<span class="builtintype" id="4457590">int</span><span class="op" id="4457593">)</span>&nbsp;<span class="op" id="4457595">(</span><span class="ident" id="4457596">clientMAC</span><span class="op" id="4457605">,</span>&nbsp;<span class="ident" id="4457607">serverMAC</span><span class="op" id="4457616">,</span>&nbsp;<span class="ident" id="4457618">clientKey</span><span class="op" id="4457627">,</span>&nbsp;<span class="ident" id="4457629">serverKey</span><span class="op" id="4457638">,</span>&nbsp;<span class="ident" id="4457640">clientIV</span><span class="op" id="4457648">,</span>&nbsp;<span class="ident" id="4457650">serverIV</span>&nbsp;<span class="op" id="4457659">[</span><span class="op" id="4457660">]</span><span class="builtintype" id="4457661">byte</span><span class="op" id="4457665">)</span>&nbsp;<span class="op" id="4457667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457670">var</span>&nbsp;<span class="ident" id="4457674">seed</span>&nbsp;<span class="op" id="4457679">[</span><span class="ident" id="4457680">tlsRandomLength</span>&nbsp;<span class="op" id="4457696">*</span>&nbsp;<span class="num" id="4457698">2</span><span class="op" id="4457699">]</span><span class="builtintype" id="4457700">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4457706">copy</span><span class="op" id="4457710">(</span><span class="ident" id="4457711">seed</span><span class="op" id="4457715">[</span><span class="num" id="4457716">0</span><span class="op" id="4457717">:</span><span class="builtinfunc" id="4457718">len</span><span class="op" id="4457721">(</span><span class="ident" id="4457722">clientRandom</span><span class="op" id="4457734">)</span><span class="op" id="4457735">]</span><span class="op" id="4457736">,</span>&nbsp;<span class="ident" id="4457738">serverRandom</span><span class="op" id="4457750">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4457753">copy</span><span class="op" id="4457757">(</span><span class="ident" id="4457758">seed</span><span class="op" id="4457762">[</span><span class="builtinfunc" id="4457763">len</span><span class="op" id="4457766">(</span><span class="ident" id="4457767">serverRandom</span><span class="op" id="4457779">)</span><span class="op" id="4457780">:</span><span class="op" id="4457781">]</span><span class="op" id="4457782">,</span>&nbsp;<span class="ident" id="4457784">clientRandom</span><span class="op" id="4457796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457800">n</span>&nbsp;<span class="op" id="4457802">:=</span>&nbsp;<span class="num" id="4457805">2</span><span class="op" id="4457806">*</span><span class="ident" id="4457807">macLen</span>&nbsp;<span class="op" id="4457814">+</span>&nbsp;<span class="num" id="4457816">2</span><span class="op" id="4457817">*</span><span class="ident" id="4457818">keyLen</span>&nbsp;<span class="op" id="4457825">+</span>&nbsp;<span class="num" id="4457827">2</span><span class="op" id="4457828">*</span><span class="ident" id="4457829">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457836">keyMaterial</span>&nbsp;<span class="op" id="4457848">:=</span>&nbsp;<span class="builtinfunc" id="4457851">make</span><span class="op" id="4457855">(</span><span class="op" id="4457856">[</span><span class="op" id="4457857">]</span><span class="builtintype" id="4457858">byte</span><span class="op" id="4457862">,</span>&nbsp;<span class="ident" id="4457864">n</span><span class="op" id="4457865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457868">prfForVersion</span><span class="op" id="4457881">(</span><span class="ident" id="4457882">version</span><span class="op" id="4457889">)</span><span class="op" id="4457890">(</span><span class="ident" id="4457891">keyMaterial</span><span class="op" id="4457902">,</span>&nbsp;<span class="ident" id="4457904">masterSecret</span><span class="op" id="4457916">,</span>&nbsp;<span class="ident" id="4457918">keyExpansionLabel</span><span class="op" id="4457935">,</span>&nbsp;<span class="ident" id="4457937">seed</span><span class="op" id="4457941">[</span><span class="num" id="4457942">0</span><span class="op" id="4457943">:</span><span class="op" id="4457944">]</span><span class="op" id="4457945">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457948">clientMAC</span>&nbsp;<span class="op" id="4457958">=</span>&nbsp;<span class="ident" id="4457960">keyMaterial</span><span class="op" id="4457971">[</span><span class="op" id="4457972">:</span><span class="ident" id="4457973">macLen</span><span class="op" id="4457979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457982">keyMaterial</span>&nbsp;<span class="op" id="4457994">=</span>&nbsp;<span class="ident" id="4457996">keyMaterial</span><span class="op" id="4458007">[</span><span class="ident" id="4458008">macLen</span><span class="op" id="4458014">:</span><span class="op" id="4458015">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458018">serverMAC</span>&nbsp;<span class="op" id="4458028">=</span>&nbsp;<span class="ident" id="4458030">keyMaterial</span><span class="op" id="4458041">[</span><span class="op" id="4458042">:</span><span class="ident" id="4458043">macLen</span><span class="op" id="4458049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458052">keyMaterial</span>&nbsp;<span class="op" id="4458064">=</span>&nbsp;<span class="ident" id="4458066">keyMaterial</span><span class="op" id="4458077">[</span><span class="ident" id="4458078">macLen</span><span class="op" id="4458084">:</span><span class="op" id="4458085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458088">clientKey</span>&nbsp;<span class="op" id="4458098">=</span>&nbsp;<span class="ident" id="4458100">keyMaterial</span><span class="op" id="4458111">[</span><span class="op" id="4458112">:</span><span class="ident" id="4458113">keyLen</span><span class="op" id="4458119">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458122">keyMaterial</span>&nbsp;<span class="op" id="4458134">=</span>&nbsp;<span class="ident" id="4458136">keyMaterial</span><span class="op" id="4458147">[</span><span class="ident" id="4458148">keyLen</span><span class="op" id="4458154">:</span><span class="op" id="4458155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458158">serverKey</span>&nbsp;<span class="op" id="4458168">=</span>&nbsp;<span class="ident" id="4458170">keyMaterial</span><span class="op" id="4458181">[</span><span class="op" id="4458182">:</span><span class="ident" id="4458183">keyLen</span><span class="op" id="4458189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458192">keyMaterial</span>&nbsp;<span class="op" id="4458204">=</span>&nbsp;<span class="ident" id="4458206">keyMaterial</span><span class="op" id="4458217">[</span><span class="ident" id="4458218">keyLen</span><span class="op" id="4458224">:</span><span class="op" id="4458225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458228">clientIV</span>&nbsp;<span class="op" id="4458237">=</span>&nbsp;<span class="ident" id="4458239">keyMaterial</span><span class="op" id="4458250">[</span><span class="op" id="4458251">:</span><span class="ident" id="4458252">ivLen</span><span class="op" id="4458257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458260">keyMaterial</span>&nbsp;<span class="op" id="4458272">=</span>&nbsp;<span class="ident" id="4458274">keyMaterial</span><span class="op" id="4458285">[</span><span class="ident" id="4458286">ivLen</span><span class="op" id="4458291">:</span><span class="op" id="4458292">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458295">serverIV</span>&nbsp;<span class="op" id="4458304">=</span>&nbsp;<span class="ident" id="4458306">keyMaterial</span><span class="op" id="4458317">[</span><span class="op" id="4458318">:</span><span class="ident" id="4458319">ivLen</span><span class="op" id="4458324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4458327">return</span><br>
<span class="lineno"></span><span class="op" id="4458334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458337">func</span>&nbsp;<span class="ident" id="4458342">newFinishedHash</span><span class="op" id="4458357">(</span><span class="ident" id="4458358">version</span>&nbsp;<span class="builtintype" id="4458366">uint16</span><span class="op" id="4458372">)</span>&nbsp;<span class="ident" id="4458374">finishedHash</span>&nbsp;<span class="op" id="4458387">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4458390">if</span>&nbsp;<span class="ident" id="4458393">version</span>&nbsp;<span class="op" id="4458401">&gt;=</span>&nbsp;<span class="ident" id="4458404">VersionTLS12</span>&nbsp;<span class="op" id="4458417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4458421">return</span>&nbsp;<span class="ident" id="4458428">finishedHash</span><span class="op" id="4458440">{</span><span class="ident" id="4458441">sha256</span><span class="op" id="4458447">.</span><span class="ident" id="4458448">New</span><span class="op" id="4458451">(</span><span class="op" id="4458452">)</span><span class="op" id="4458453">,</span>&nbsp;<span class="ident" id="4458455">sha256</span><span class="op" id="4458461">.</span><span class="ident" id="4458462">New</span><span class="op" id="4458465">(</span><span class="op" id="4458466">)</span><span class="op" id="4458467">,</span>&nbsp;<span class="builtintype" id="4458469">nil</span><span class="op" id="4458472">,</span>&nbsp;<span class="builtintype" id="4458474">nil</span><span class="op" id="4458477">,</span>&nbsp;<span class="ident" id="4458479">version</span><span class="op" id="4458486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4458489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4458492">return</span>&nbsp;<span class="ident" id="4458499">finishedHash</span><span class="op" id="4458511">{</span><span class="ident" id="4458512">sha1</span><span class="op" id="4458516">.</span><span class="ident" id="4458517">New</span><span class="op" id="4458520">(</span><span class="op" id="4458521">)</span><span class="op" id="4458522">,</span>&nbsp;<span class="ident" id="4458524">sha1</span><span class="op" id="4458528">.</span><span class="ident" id="4458529">New</span><span class="op" id="4458532">(</span><span class="op" id="4458533">)</span><span class="op" id="4458534">,</span>&nbsp;<span class="ident" id="4458536">md5</span><span class="op" id="4458539">.</span><span class="ident" id="4458540">New</span><span class="op" id="4458543">(</span><span class="op" id="4458544">)</span><span class="op" id="4458545">,</span>&nbsp;<span class="ident" id="4458547">md5</span><span class="op" id="4458550">.</span><span class="ident" id="4458551">New</span><span class="op" id="4458554">(</span><span class="op" id="4458555">)</span><span class="op" id="4458556">,</span>&nbsp;<span class="ident" id="4458558">version</span><span class="op" id="4458565">}</span><br>
<span class="lineno"></span><span class="op" id="4458567">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4458570">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="4458648">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4458688">type</span>&nbsp;<span class="ident" id="4458693">finishedHash</span>&nbsp;<span class="keyword" id="4458706">struct</span>&nbsp;<span class="op" id="4458713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458716">client</span>&nbsp;<span class="ident" id="4458723">hash</span><span class="op" id="4458727">.</span><span class="ident" id="4458728">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458734">server</span>&nbsp;<span class="ident" id="4458741">hash</span><span class="op" id="4458745">.</span><span class="ident" id="4458746">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458753">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458811">clientMD5</span>&nbsp;<span class="ident" id="4458821">hash</span><span class="op" id="4458825">.</span><span class="ident" id="4458826">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458832">serverMD5</span>&nbsp;<span class="ident" id="4458842">hash</span><span class="op" id="4458846">.</span><span class="ident" id="4458847">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458854">version</span>&nbsp;<span class="builtintype" id="4458862">uint16</span><br>
<span class="lineno"></span><span class="op" id="4458869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458872">func</span>&nbsp;<span class="op" id="4458877">(</span><span class="ident" id="4458878">h</span>&nbsp;<span class="ident" id="4458880">finishedHash</span><span class="op" id="4458892">)</span>&nbsp;<span class="ident" id="4458894">Write</span><span class="op" id="4458899">(</span><span class="ident" id="4458900">msg</span>&nbsp;<span class="op" id="4458904">[</span><span class="op" id="4458905">]</span><span class="builtintype" id="4458906">byte</span><span class="op" id="4458910">)</span>&nbsp;<span class="op" id="4458912">(</span><span class="ident" id="4458913">n</span>&nbsp;<span class="builtintype" id="4458915">int</span><span class="op" id="4458918">,</span>&nbsp;<span class="ident" id="4458920">err</span>&nbsp;<span class="builtintype" id="4458924">error</span><span class="op" id="4458929">)</span>&nbsp;<span class="op" id="4458931">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458934">h</span><span class="op" id="4458935">.</span><span class="ident" id="4458936">client</span><span class="op" id="4458942">.</span><span class="ident" id="4458943">Write</span><span class="op" id="4458948">(</span><span class="ident" id="4458949">msg</span><span class="op" id="4458952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458955">h</span><span class="op" id="4458956">.</span><span class="ident" id="4458957">server</span><span class="op" id="4458963">.</span><span class="ident" id="4458964">Write</span><span class="op" id="4458969">(</span><span class="ident" id="4458970">msg</span><span class="op" id="4458973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4458977">if</span>&nbsp;<span class="ident" id="4458980">h</span><span class="op" id="4458981">.</span><span class="ident" id="4458982">version</span>&nbsp;<span class="op" id="4458990">&lt;</span>&nbsp;<span class="ident" id="4458992">VersionTLS12</span>&nbsp;<span class="op" id="4459005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459009">h</span><span class="op" id="4459010">.</span><span class="ident" id="4459011">clientMD5</span><span class="op" id="4459020">.</span><span class="ident" id="4459021">Write</span><span class="op" id="4459026">(</span><span class="ident" id="4459027">msg</span><span class="op" id="4459030">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459034">h</span><span class="op" id="4459035">.</span><span class="ident" id="4459036">serverMD5</span><span class="op" id="4459045">.</span><span class="ident" id="4459046">Write</span><span class="op" id="4459051">(</span><span class="ident" id="4459052">msg</span><span class="op" id="4459055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459061">return</span>&nbsp;<span class="builtinfunc" id="4459068">len</span><span class="op" id="4459071">(</span><span class="ident" id="4459072">msg</span><span class="op" id="4459075">)</span><span class="op" id="4459076">,</span>&nbsp;<span class="builtintype" id="4459078">nil</span><br>
<span class="lineno"></span><span class="op" id="4459082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4459085">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="4459163">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="4459235">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4459248">func</span>&nbsp;<span class="ident" id="4459253">finishedSum30</span><span class="op" id="4459266">(</span><span class="ident" id="4459267">md5</span><span class="op" id="4459270">,</span>&nbsp;<span class="ident" id="4459272">sha1</span>&nbsp;<span class="ident" id="4459277">hash</span><span class="op" id="4459281">.</span><span class="ident" id="4459282">Hash</span><span class="op" id="4459286">,</span>&nbsp;<span class="ident" id="4459288">masterSecret</span>&nbsp;<span class="op" id="4459301">[</span><span class="op" id="4459302">]</span><span class="builtintype" id="4459303">byte</span><span class="op" id="4459307">,</span>&nbsp;<span class="ident" id="4459309">magic</span>&nbsp;<span class="op" id="4459315">[</span><span class="num" id="4459316">4</span><span class="op" id="4459317">]</span><span class="builtintype" id="4459318">byte</span><span class="op" id="4459322">)</span>&nbsp;<span class="op" id="4459324">[</span><span class="op" id="4459325">]</span><span class="builtintype" id="4459326">byte</span>&nbsp;<span class="op" id="4459331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459334">md5</span><span class="op" id="4459337">.</span><span class="ident" id="4459338">Write</span><span class="op" id="4459343">(</span><span class="ident" id="4459344">magic</span><span class="op" id="4459349">[</span><span class="op" id="4459350">:</span><span class="op" id="4459351">]</span><span class="op" id="4459352">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459355">md5</span><span class="op" id="4459358">.</span><span class="ident" id="4459359">Write</span><span class="op" id="4459364">(</span><span class="ident" id="4459365">masterSecret</span><span class="op" id="4459377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459380">md5</span><span class="op" id="4459383">.</span><span class="ident" id="4459384">Write</span><span class="op" id="4459389">(</span><span class="ident" id="4459390">ssl30Pad1</span><span class="op" id="4459399">[</span><span class="op" id="4459400">:</span><span class="op" id="4459401">]</span><span class="op" id="4459402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459405">md5Digest</span>&nbsp;<span class="op" id="4459415">:=</span>&nbsp;<span class="ident" id="4459418">md5</span><span class="op" id="4459421">.</span><span class="ident" id="4459422">Sum</span><span class="op" id="4459425">(</span><span class="builtintype" id="4459426">nil</span><span class="op" id="4459429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459433">md5</span><span class="op" id="4459436">.</span><span class="ident" id="4459437">Reset</span><span class="op" id="4459442">(</span><span class="op" id="4459443">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459446">md5</span><span class="op" id="4459449">.</span><span class="ident" id="4459450">Write</span><span class="op" id="4459455">(</span><span class="ident" id="4459456">masterSecret</span><span class="op" id="4459468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459471">md5</span><span class="op" id="4459474">.</span><span class="ident" id="4459475">Write</span><span class="op" id="4459480">(</span><span class="ident" id="4459481">ssl30Pad2</span><span class="op" id="4459490">[</span><span class="op" id="4459491">:</span><span class="op" id="4459492">]</span><span class="op" id="4459493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459496">md5</span><span class="op" id="4459499">.</span><span class="ident" id="4459500">Write</span><span class="op" id="4459505">(</span><span class="ident" id="4459506">md5Digest</span><span class="op" id="4459515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459518">md5Digest</span>&nbsp;<span class="op" id="4459528">=</span>&nbsp;<span class="ident" id="4459530">md5</span><span class="op" id="4459533">.</span><span class="ident" id="4459534">Sum</span><span class="op" id="4459537">(</span><span class="builtintype" id="4459538">nil</span><span class="op" id="4459541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459545">sha1</span><span class="op" id="4459549">.</span><span class="ident" id="4459550">Write</span><span class="op" id="4459555">(</span><span class="ident" id="4459556">magic</span><span class="op" id="4459561">[</span><span class="op" id="4459562">:</span><span class="op" id="4459563">]</span><span class="op" id="4459564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459567">sha1</span><span class="op" id="4459571">.</span><span class="ident" id="4459572">Write</span><span class="op" id="4459577">(</span><span class="ident" id="4459578">masterSecret</span><span class="op" id="4459590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459593">sha1</span><span class="op" id="4459597">.</span><span class="ident" id="4459598">Write</span><span class="op" id="4459603">(</span><span class="ident" id="4459604">ssl30Pad1</span><span class="op" id="4459613">[</span><span class="op" id="4459614">:</span><span class="num" id="4459615">40</span><span class="op" id="4459617">]</span><span class="op" id="4459618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459621">sha1Digest</span>&nbsp;<span class="op" id="4459632">:=</span>&nbsp;<span class="ident" id="4459635">sha1</span><span class="op" id="4459639">.</span><span class="ident" id="4459640">Sum</span><span class="op" id="4459643">(</span><span class="builtintype" id="4459644">nil</span><span class="op" id="4459647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459651">sha1</span><span class="op" id="4459655">.</span><span class="ident" id="4459656">Reset</span><span class="op" id="4459661">(</span><span class="op" id="4459662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459665">sha1</span><span class="op" id="4459669">.</span><span class="ident" id="4459670">Write</span><span class="op" id="4459675">(</span><span class="ident" id="4459676">masterSecret</span><span class="op" id="4459688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459691">sha1</span><span class="op" id="4459695">.</span><span class="ident" id="4459696">Write</span><span class="op" id="4459701">(</span><span class="ident" id="4459702">ssl30Pad2</span><span class="op" id="4459711">[</span><span class="op" id="4459712">:</span><span class="num" id="4459713">40</span><span class="op" id="4459715">]</span><span class="op" id="4459716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459719">sha1</span><span class="op" id="4459723">.</span><span class="ident" id="4459724">Write</span><span class="op" id="4459729">(</span><span class="ident" id="4459730">sha1Digest</span><span class="op" id="4459740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459743">sha1Digest</span>&nbsp;<span class="op" id="4459754">=</span>&nbsp;<span class="ident" id="4459756">sha1</span><span class="op" id="4459760">.</span><span class="ident" id="4459761">Sum</span><span class="op" id="4459764">(</span><span class="builtintype" id="4459765">nil</span><span class="op" id="4459768">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459772">ret</span>&nbsp;<span class="op" id="4459776">:=</span>&nbsp;<span class="builtinfunc" id="4459779">make</span><span class="op" id="4459783">(</span><span class="op" id="4459784">[</span><span class="op" id="4459785">]</span><span class="builtintype" id="4459786">byte</span><span class="op" id="4459790">,</span>&nbsp;<span class="builtinfunc" id="4459792">len</span><span class="op" id="4459795">(</span><span class="ident" id="4459796">md5Digest</span><span class="op" id="4459805">)</span><span class="op" id="4459806">+</span><span class="builtinfunc" id="4459807">len</span><span class="op" id="4459810">(</span><span class="ident" id="4459811">sha1Digest</span><span class="op" id="4459821">)</span><span class="op" id="4459822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4459825">copy</span><span class="op" id="4459829">(</span><span class="ident" id="4459830">ret</span><span class="op" id="4459833">,</span>&nbsp;<span class="ident" id="4459835">md5Digest</span><span class="op" id="4459844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4459847">copy</span><span class="op" id="4459851">(</span><span class="ident" id="4459852">ret</span><span class="op" id="4459855">[</span><span class="builtinfunc" id="4459856">len</span><span class="op" id="4459859">(</span><span class="ident" id="4459860">md5Digest</span><span class="op" id="4459869">)</span><span class="op" id="4459870">:</span><span class="op" id="4459871">]</span><span class="op" id="4459872">,</span>&nbsp;<span class="ident" id="4459874">sha1Digest</span><span class="op" id="4459884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459887">return</span>&nbsp;<span class="ident" id="4459894">ret</span><br>
<span class="lineno">230</span><span class="op" id="4459898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459901">var</span>&nbsp;<span class="ident" id="4459905">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="4459929">=</span>&nbsp;<span class="op" id="4459931">[</span><span class="num" id="4459932">4</span><span class="op" id="4459933">]</span><span class="builtintype" id="4459934">byte</span><span class="op" id="4459938">{</span><span class="num" id="4459939">0x43</span><span class="op" id="4459943">,</span>&nbsp;<span class="num" id="4459945">0x4c</span><span class="op" id="4459949">,</span>&nbsp;<span class="num" id="4459951">0x4e</span><span class="op" id="4459955">,</span>&nbsp;<span class="num" id="4459957">0x54</span><span class="op" id="4459961">}</span><br>
<span class="lineno"></span><span class="keyword" id="4459963">var</span>&nbsp;<span class="ident" id="4459967">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="4459991">=</span>&nbsp;<span class="op" id="4459993">[</span><span class="num" id="4459994">4</span><span class="op" id="4459995">]</span><span class="builtintype" id="4459996">byte</span><span class="op" id="4460000">{</span><span class="num" id="4460001">0x53</span><span class="op" id="4460005">,</span>&nbsp;<span class="num" id="4460007">0x52</span><span class="op" id="4460011">,</span>&nbsp;<span class="num" id="4460013">0x56</span><span class="op" id="4460017">,</span>&nbsp;<span class="num" id="4460019">0x52</span><span class="op" id="4460023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4460026">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4460100">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4460121">func</span>&nbsp;<span class="op" id="4460126">(</span><span class="ident" id="4460127">h</span>&nbsp;<span class="ident" id="4460129">finishedHash</span><span class="op" id="4460141">)</span>&nbsp;<span class="ident" id="4460143">clientSum</span><span class="op" id="4460152">(</span><span class="ident" id="4460153">masterSecret</span>&nbsp;<span class="op" id="4460166">[</span><span class="op" id="4460167">]</span><span class="builtintype" id="4460168">byte</span><span class="op" id="4460172">)</span>&nbsp;<span class="op" id="4460174">[</span><span class="op" id="4460175">]</span><span class="builtintype" id="4460176">byte</span>&nbsp;<span class="op" id="4460181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460184">if</span>&nbsp;<span class="ident" id="4460187">h</span><span class="op" id="4460188">.</span><span class="ident" id="4460189">version</span>&nbsp;<span class="op" id="4460197">==</span>&nbsp;<span class="ident" id="4460200">VersionSSL30</span>&nbsp;<span class="op" id="4460213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460217">return</span>&nbsp;<span class="ident" id="4460224">finishedSum30</span><span class="op" id="4460237">(</span><span class="ident" id="4460238">h</span><span class="op" id="4460239">.</span><span class="ident" id="4460240">clientMD5</span><span class="op" id="4460249">,</span>&nbsp;<span class="ident" id="4460251">h</span><span class="op" id="4460252">.</span><span class="ident" id="4460253">client</span><span class="op" id="4460259">,</span>&nbsp;<span class="ident" id="4460261">masterSecret</span><span class="op" id="4460273">,</span>&nbsp;<span class="ident" id="4460275">ssl3ClientFinishedMagic</span><span class="op" id="4460298">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460305">out</span>&nbsp;<span class="op" id="4460309">:=</span>&nbsp;<span class="builtinfunc" id="4460312">make</span><span class="op" id="4460316">(</span><span class="op" id="4460317">[</span><span class="op" id="4460318">]</span><span class="builtintype" id="4460319">byte</span><span class="op" id="4460323">,</span>&nbsp;<span class="ident" id="4460325">finishedVerifyLength</span><span class="op" id="4460345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460348">if</span>&nbsp;<span class="ident" id="4460351">h</span><span class="op" id="4460352">.</span><span class="ident" id="4460353">version</span>&nbsp;<span class="op" id="4460361">&gt;=</span>&nbsp;<span class="ident" id="4460364">VersionTLS12</span>&nbsp;<span class="op" id="4460377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460381">seed</span>&nbsp;<span class="op" id="4460386">:=</span>&nbsp;<span class="ident" id="4460389">h</span><span class="op" id="4460390">.</span><span class="ident" id="4460391">client</span><span class="op" id="4460397">.</span><span class="ident" id="4460398">Sum</span><span class="op" id="4460401">(</span><span class="builtintype" id="4460402">nil</span><span class="op" id="4460405">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460409">prf12</span><span class="op" id="4460414">(</span><span class="ident" id="4460415">out</span><span class="op" id="4460418">,</span>&nbsp;<span class="ident" id="4460420">masterSecret</span><span class="op" id="4460432">,</span>&nbsp;<span class="ident" id="4460434">clientFinishedLabel</span><span class="op" id="4460453">,</span>&nbsp;<span class="ident" id="4460455">seed</span><span class="op" id="4460459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460462">}</span>&nbsp;<span class="keyword" id="4460464">else</span>&nbsp;<span class="op" id="4460469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460473">seed</span>&nbsp;<span class="op" id="4460478">:=</span>&nbsp;<span class="builtinfunc" id="4460481">make</span><span class="op" id="4460485">(</span><span class="op" id="4460486">[</span><span class="op" id="4460487">]</span><span class="builtintype" id="4460488">byte</span><span class="op" id="4460492">,</span>&nbsp;<span class="num" id="4460494">0</span><span class="op" id="4460495">,</span>&nbsp;<span class="ident" id="4460497">md5</span><span class="op" id="4460500">.</span><span class="ident" id="4460501">Size</span><span class="op" id="4460505">+</span><span class="ident" id="4460506">sha1</span><span class="op" id="4460510">.</span><span class="ident" id="4460511">Size</span><span class="op" id="4460515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460519">seed</span>&nbsp;<span class="op" id="4460524">=</span>&nbsp;<span class="ident" id="4460526">h</span><span class="op" id="4460527">.</span><span class="ident" id="4460528">clientMD5</span><span class="op" id="4460537">.</span><span class="ident" id="4460538">Sum</span><span class="op" id="4460541">(</span><span class="ident" id="4460542">seed</span><span class="op" id="4460546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460550">seed</span>&nbsp;<span class="op" id="4460555">=</span>&nbsp;<span class="ident" id="4460557">h</span><span class="op" id="4460558">.</span><span class="ident" id="4460559">client</span><span class="op" id="4460565">.</span><span class="ident" id="4460566">Sum</span><span class="op" id="4460569">(</span><span class="ident" id="4460570">seed</span><span class="op" id="4460574">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460578">prf10</span><span class="op" id="4460583">(</span><span class="ident" id="4460584">out</span><span class="op" id="4460587">,</span>&nbsp;<span class="ident" id="4460589">masterSecret</span><span class="op" id="4460601">,</span>&nbsp;<span class="ident" id="4460603">clientFinishedLabel</span><span class="op" id="4460622">,</span>&nbsp;<span class="ident" id="4460624">seed</span><span class="op" id="4460628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460634">return</span>&nbsp;<span class="ident" id="4460641">out</span><br>
<span class="lineno"></span><span class="op" id="4460645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4460648">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4460722">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="4460743">func</span>&nbsp;<span class="op" id="4460748">(</span><span class="ident" id="4460749">h</span>&nbsp;<span class="ident" id="4460751">finishedHash</span><span class="op" id="4460763">)</span>&nbsp;<span class="ident" id="4460765">serverSum</span><span class="op" id="4460774">(</span><span class="ident" id="4460775">masterSecret</span>&nbsp;<span class="op" id="4460788">[</span><span class="op" id="4460789">]</span><span class="builtintype" id="4460790">byte</span><span class="op" id="4460794">)</span>&nbsp;<span class="op" id="4460796">[</span><span class="op" id="4460797">]</span><span class="builtintype" id="4460798">byte</span>&nbsp;<span class="op" id="4460803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460806">if</span>&nbsp;<span class="ident" id="4460809">h</span><span class="op" id="4460810">.</span><span class="ident" id="4460811">version</span>&nbsp;<span class="op" id="4460819">==</span>&nbsp;<span class="ident" id="4460822">VersionSSL30</span>&nbsp;<span class="op" id="4460835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460839">return</span>&nbsp;<span class="ident" id="4460846">finishedSum30</span><span class="op" id="4460859">(</span><span class="ident" id="4460860">h</span><span class="op" id="4460861">.</span><span class="ident" id="4460862">serverMD5</span><span class="op" id="4460871">,</span>&nbsp;<span class="ident" id="4460873">h</span><span class="op" id="4460874">.</span><span class="ident" id="4460875">server</span><span class="op" id="4460881">,</span>&nbsp;<span class="ident" id="4460883">masterSecret</span><span class="op" id="4460895">,</span>&nbsp;<span class="ident" id="4460897">ssl3ServerFinishedMagic</span><span class="op" id="4460920">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460927">out</span>&nbsp;<span class="op" id="4460931">:=</span>&nbsp;<span class="builtinfunc" id="4460934">make</span><span class="op" id="4460938">(</span><span class="op" id="4460939">[</span><span class="op" id="4460940">]</span><span class="builtintype" id="4460941">byte</span><span class="op" id="4460945">,</span>&nbsp;<span class="ident" id="4460947">finishedVerifyLength</span><span class="op" id="4460967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460970">if</span>&nbsp;<span class="ident" id="4460973">h</span><span class="op" id="4460974">.</span><span class="ident" id="4460975">version</span>&nbsp;<span class="op" id="4460983">&gt;=</span>&nbsp;<span class="ident" id="4460986">VersionTLS12</span>&nbsp;<span class="op" id="4460999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461003">seed</span>&nbsp;<span class="op" id="4461008">:=</span>&nbsp;<span class="ident" id="4461011">h</span><span class="op" id="4461012">.</span><span class="ident" id="4461013">server</span><span class="op" id="4461019">.</span><span class="ident" id="4461020">Sum</span><span class="op" id="4461023">(</span><span class="builtintype" id="4461024">nil</span><span class="op" id="4461027">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461031">prf12</span><span class="op" id="4461036">(</span><span class="ident" id="4461037">out</span><span class="op" id="4461040">,</span>&nbsp;<span class="ident" id="4461042">masterSecret</span><span class="op" id="4461054">,</span>&nbsp;<span class="ident" id="4461056">serverFinishedLabel</span><span class="op" id="4461075">,</span>&nbsp;<span class="ident" id="4461077">seed</span><span class="op" id="4461081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461084">}</span>&nbsp;<span class="keyword" id="4461086">else</span>&nbsp;<span class="op" id="4461091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461095">seed</span>&nbsp;<span class="op" id="4461100">:=</span>&nbsp;<span class="builtinfunc" id="4461103">make</span><span class="op" id="4461107">(</span><span class="op" id="4461108">[</span><span class="op" id="4461109">]</span><span class="builtintype" id="4461110">byte</span><span class="op" id="4461114">,</span>&nbsp;<span class="num" id="4461116">0</span><span class="op" id="4461117">,</span>&nbsp;<span class="ident" id="4461119">md5</span><span class="op" id="4461122">.</span><span class="ident" id="4461123">Size</span><span class="op" id="4461127">+</span><span class="ident" id="4461128">sha1</span><span class="op" id="4461132">.</span><span class="ident" id="4461133">Size</span><span class="op" id="4461137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461141">seed</span>&nbsp;<span class="op" id="4461146">=</span>&nbsp;<span class="ident" id="4461148">h</span><span class="op" id="4461149">.</span><span class="ident" id="4461150">serverMD5</span><span class="op" id="4461159">.</span><span class="ident" id="4461160">Sum</span><span class="op" id="4461163">(</span><span class="ident" id="4461164">seed</span><span class="op" id="4461168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461172">seed</span>&nbsp;<span class="op" id="4461177">=</span>&nbsp;<span class="ident" id="4461179">h</span><span class="op" id="4461180">.</span><span class="ident" id="4461181">server</span><span class="op" id="4461187">.</span><span class="ident" id="4461188">Sum</span><span class="op" id="4461191">(</span><span class="ident" id="4461192">seed</span><span class="op" id="4461196">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461200">prf10</span><span class="op" id="4461205">(</span><span class="ident" id="4461206">out</span><span class="op" id="4461209">,</span>&nbsp;<span class="ident" id="4461211">masterSecret</span><span class="op" id="4461223">,</span>&nbsp;<span class="ident" id="4461225">serverFinishedLabel</span><span class="op" id="4461244">,</span>&nbsp;<span class="ident" id="4461246">seed</span><span class="op" id="4461250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461256">return</span>&nbsp;<span class="ident" id="4461263">out</span><br>
<span class="lineno"></span><span class="op" id="4461267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="4461270">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4461348">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4461404">func</span>&nbsp;<span class="op" id="4461409">(</span><span class="ident" id="4461410">h</span>&nbsp;<span class="ident" id="4461412">finishedHash</span><span class="op" id="4461424">)</span>&nbsp;<span class="ident" id="4461426">hashForClientCertificate</span><span class="op" id="4461450">(</span><span class="ident" id="4461451">sigType</span>&nbsp;<span class="builtintype" id="4461459">uint8</span><span class="op" id="4461464">)</span>&nbsp;<span class="op" id="4461466">(</span><span class="op" id="4461467">[</span><span class="op" id="4461468">]</span><span class="builtintype" id="4461469">byte</span><span class="op" id="4461473">,</span>&nbsp;<span class="ident" id="4461475">crypto</span><span class="op" id="4461481">.</span><span class="ident" id="4461482">Hash</span><span class="op" id="4461486">,</span>&nbsp;<span class="builtintype" id="4461488">uint8</span><span class="op" id="4461493">)</span>&nbsp;<span class="op" id="4461495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461498">if</span>&nbsp;<span class="ident" id="4461501">h</span><span class="op" id="4461502">.</span><span class="ident" id="4461503">version</span>&nbsp;<span class="op" id="4461511">&gt;=</span>&nbsp;<span class="ident" id="4461514">VersionTLS12</span>&nbsp;<span class="op" id="4461527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461531">digest</span>&nbsp;<span class="op" id="4461538">:=</span>&nbsp;<span class="ident" id="4461541">h</span><span class="op" id="4461542">.</span><span class="ident" id="4461543">server</span><span class="op" id="4461549">.</span><span class="ident" id="4461550">Sum</span><span class="op" id="4461553">(</span><span class="builtintype" id="4461554">nil</span><span class="op" id="4461557">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461561">return</span>&nbsp;<span class="ident" id="4461568">digest</span><span class="op" id="4461574">,</span>&nbsp;<span class="ident" id="4461576">crypto</span><span class="op" id="4461582">.</span><span class="ident" id="4461583">SHA256</span><span class="op" id="4461589">,</span>&nbsp;<span class="ident" id="4461591">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461606">if</span>&nbsp;<span class="ident" id="4461609">sigType</span>&nbsp;<span class="op" id="4461617">==</span>&nbsp;<span class="ident" id="4461620">signatureECDSA</span>&nbsp;<span class="op" id="4461635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461639">digest</span>&nbsp;<span class="op" id="4461646">:=</span>&nbsp;<span class="ident" id="4461649">h</span><span class="op" id="4461650">.</span><span class="ident" id="4461651">server</span><span class="op" id="4461657">.</span><span class="ident" id="4461658">Sum</span><span class="op" id="4461661">(</span><span class="builtintype" id="4461662">nil</span><span class="op" id="4461665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461669">return</span>&nbsp;<span class="ident" id="4461676">digest</span><span class="op" id="4461682">,</span>&nbsp;<span class="ident" id="4461684">crypto</span><span class="op" id="4461690">.</span><span class="ident" id="4461691">SHA1</span><span class="op" id="4461695">,</span>&nbsp;<span class="ident" id="4461697">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461711">digest</span>&nbsp;<span class="op" id="4461718">:=</span>&nbsp;<span class="builtinfunc" id="4461721">make</span><span class="op" id="4461725">(</span><span class="op" id="4461726">[</span><span class="op" id="4461727">]</span><span class="builtintype" id="4461728">byte</span><span class="op" id="4461732">,</span>&nbsp;<span class="num" id="4461734">0</span><span class="op" id="4461735">,</span>&nbsp;<span class="num" id="4461737">36</span><span class="op" id="4461739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461742">digest</span>&nbsp;<span class="op" id="4461749">=</span>&nbsp;<span class="ident" id="4461751">h</span><span class="op" id="4461752">.</span><span class="ident" id="4461753">serverMD5</span><span class="op" id="4461762">.</span><span class="ident" id="4461763">Sum</span><span class="op" id="4461766">(</span><span class="ident" id="4461767">digest</span><span class="op" id="4461773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461776">digest</span>&nbsp;<span class="op" id="4461783">=</span>&nbsp;<span class="ident" id="4461785">h</span><span class="op" id="4461786">.</span><span class="ident" id="4461787">server</span><span class="op" id="4461793">.</span><span class="ident" id="4461794">Sum</span><span class="op" id="4461797">(</span><span class="ident" id="4461798">digest</span><span class="op" id="4461804">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461807">return</span>&nbsp;<span class="ident" id="4461814">digest</span><span class="op" id="4461820">,</span>&nbsp;<span class="ident" id="4461822">crypto</span><span class="op" id="4461828">.</span><span class="ident" id="4461829">MD5SHA1</span><span class="op" id="4461836">,</span>&nbsp;<span class="num" id="4461838">0</span>&nbsp;<span class="comment" id="4461840">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="4461872">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
