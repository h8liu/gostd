<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7864716">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7864771">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7864825">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7864876">package</span>&nbsp;<span class="ident" id="7864884">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864895">import</span>&nbsp;<span class="op" id="7864902">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864905">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864914">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864931">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864938">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864944">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864957">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864974">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864980">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7864991">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7865002">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7865012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7865015">func</span>&nbsp;<span class="ident" id="7865020">TestBoundaryLine</span><span class="op" id="7865036">(</span><span class="ident" id="7865037">t</span>&nbsp;<span class="op" id="7865039">*</span><span class="ident" id="7865040">testing</span><span class="op" id="7865047">.</span><span class="ident" id="7865048">T</span><span class="op" id="7865049">)</span>&nbsp;<span class="op" id="7865051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865054">mr</span>&nbsp;<span class="op" id="7865057">:=</span>&nbsp;<span class="ident" id="7865060">NewReader</span><span class="op" id="7865069">(</span><span class="ident" id="7865070">strings</span><span class="op" id="7865077">.</span><span class="ident" id="7865078">NewReader</span><span class="op" id="7865087">(</span><span class="string" id="7865088">&#34;&#34;</span><span class="op" id="7865090">)</span><span class="op" id="7865091">,</span>&nbsp;<span class="string" id="7865093">&#34;myBoundary&#34;</span><span class="op" id="7865105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865108">if</span>&nbsp;<span class="op" id="7865111">!</span><span class="ident" id="7865112">mr</span><span class="op" id="7865114">.</span><span class="ident" id="7865115">isBoundaryDelimiterLine</span><span class="op" id="7865138">(</span><span class="op" id="7865139">[</span><span class="op" id="7865140">]</span><span class="builtintype" id="7865141">byte</span><span class="op" id="7865145">(</span><span class="string" id="7865146">&#34;--myBoundary\r\n&#34;</span><span class="op" id="7865164">)</span><span class="op" id="7865165">)</span>&nbsp;<span class="op" id="7865167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865171">t</span><span class="op" id="7865172">.</span><span class="ident" id="7865173">Error</span><span class="op" id="7865178">(</span><span class="string" id="7865179">&#34;expected&#34;</span><span class="op" id="7865189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865192">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865195">if</span>&nbsp;<span class="op" id="7865198">!</span><span class="ident" id="7865199">mr</span><span class="op" id="7865201">.</span><span class="ident" id="7865202">isBoundaryDelimiterLine</span><span class="op" id="7865225">(</span><span class="op" id="7865226">[</span><span class="op" id="7865227">]</span><span class="builtintype" id="7865228">byte</span><span class="op" id="7865232">(</span><span class="string" id="7865233">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="7865252">)</span><span class="op" id="7865253">)</span>&nbsp;<span class="op" id="7865255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865259">t</span><span class="op" id="7865260">.</span><span class="ident" id="7865261">Error</span><span class="op" id="7865266">(</span><span class="string" id="7865267">&#34;expected&#34;</span><span class="op" id="7865277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865283">if</span>&nbsp;<span class="op" id="7865286">!</span><span class="ident" id="7865287">mr</span><span class="op" id="7865289">.</span><span class="ident" id="7865290">isBoundaryDelimiterLine</span><span class="op" id="7865313">(</span><span class="op" id="7865314">[</span><span class="op" id="7865315">]</span><span class="builtintype" id="7865316">byte</span><span class="op" id="7865320">(</span><span class="string" id="7865321">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="7865338">)</span><span class="op" id="7865339">)</span>&nbsp;<span class="op" id="7865341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865345">t</span><span class="op" id="7865346">.</span><span class="ident" id="7865347">Error</span><span class="op" id="7865352">(</span><span class="string" id="7865353">&#34;expected&#34;</span><span class="op" id="7865363">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865369">if</span>&nbsp;<span class="ident" id="7865372">mr</span><span class="op" id="7865374">.</span><span class="ident" id="7865375">isBoundaryDelimiterLine</span><span class="op" id="7865398">(</span><span class="op" id="7865399">[</span><span class="op" id="7865400">]</span><span class="builtintype" id="7865401">byte</span><span class="op" id="7865405">(</span><span class="string" id="7865406">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="7865429">)</span><span class="op" id="7865430">)</span>&nbsp;<span class="op" id="7865432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865436">t</span><span class="op" id="7865437">.</span><span class="ident" id="7865438">Error</span><span class="op" id="7865443">(</span><span class="string" id="7865444">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7865459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865465">if</span>&nbsp;<span class="ident" id="7865468">mr</span><span class="op" id="7865470">.</span><span class="ident" id="7865471">isBoundaryDelimiterLine</span><span class="op" id="7865494">(</span><span class="op" id="7865495">[</span><span class="op" id="7865496">]</span><span class="builtintype" id="7865497">byte</span><span class="op" id="7865501">(</span><span class="string" id="7865502">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="7865524">)</span><span class="op" id="7865525">)</span>&nbsp;<span class="op" id="7865527">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865531">t</span><span class="op" id="7865532">.</span><span class="ident" id="7865533">Error</span><span class="op" id="7865538">(</span><span class="string" id="7865539">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7865554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865557">}</span><br>
<span class="lineno"></span><span class="op" id="7865559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865562">func</span>&nbsp;<span class="ident" id="7865567">escapeString</span><span class="op" id="7865579">(</span><span class="ident" id="7865580">v</span>&nbsp;<span class="builtintype" id="7865582">string</span><span class="op" id="7865588">)</span>&nbsp;<span class="builtintype" id="7865590">string</span>&nbsp;<span class="op" id="7865597">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865600">bytes</span><span class="op" id="7865605">,</span>&nbsp;<span class="ident" id="7865607">_</span>&nbsp;<span class="op" id="7865609">:=</span>&nbsp;<span class="ident" id="7865612">json</span><span class="op" id="7865616">.</span><span class="ident" id="7865617">Marshal</span><span class="op" id="7865624">(</span><span class="ident" id="7865625">v</span><span class="op" id="7865626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865629">return</span>&nbsp;<span class="builtintype" id="7865636">string</span><span class="op" id="7865642">(</span><span class="ident" id="7865643">bytes</span><span class="op" id="7865648">)</span><br>
<span class="lineno"></span><span class="op" id="7865650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865653">func</span>&nbsp;<span class="ident" id="7865658">expectEq</span><span class="op" id="7865666">(</span><span class="ident" id="7865667">t</span>&nbsp;<span class="op" id="7865669">*</span><span class="ident" id="7865670">testing</span><span class="op" id="7865677">.</span><span class="ident" id="7865678">T</span><span class="op" id="7865679">,</span>&nbsp;<span class="ident" id="7865681">expected</span><span class="op" id="7865689">,</span>&nbsp;<span class="ident" id="7865691">actual</span><span class="op" id="7865697">,</span>&nbsp;<span class="ident" id="7865699">what</span>&nbsp;<span class="builtintype" id="7865704">string</span><span class="op" id="7865710">)</span>&nbsp;<span class="op" id="7865712">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865715">if</span>&nbsp;<span class="ident" id="7865718">expected</span>&nbsp;<span class="op" id="7865727">==</span>&nbsp;<span class="ident" id="7865730">actual</span>&nbsp;<span class="op" id="7865737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865741">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865752">t</span><span class="op" id="7865753">.</span><span class="ident" id="7865754">Errorf</span><span class="op" id="7865760">(</span><span class="string" id="7865761">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="7865829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865833">what</span><span class="op" id="7865837">,</span>&nbsp;<span class="ident" id="7865839">escapeString</span><span class="op" id="7865851">(</span><span class="ident" id="7865852">actual</span><span class="op" id="7865858">)</span><span class="op" id="7865859">,</span>&nbsp;<span class="builtinfunc" id="7865861">len</span><span class="op" id="7865864">(</span><span class="ident" id="7865865">actual</span><span class="op" id="7865871">)</span><span class="op" id="7865872">,</span>&nbsp;<span class="ident" id="7865874">escapeString</span><span class="op" id="7865886">(</span><span class="ident" id="7865887">expected</span><span class="op" id="7865895">)</span><span class="op" id="7865896">,</span>&nbsp;<span class="builtinfunc" id="7865898">len</span><span class="op" id="7865901">(</span><span class="ident" id="7865902">expected</span><span class="op" id="7865910">)</span><span class="op" id="7865911">)</span><br>
<span class="lineno">50</span><span class="op" id="7865913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865916">func</span>&nbsp;<span class="ident" id="7865921">TestNameAccessors</span><span class="op" id="7865938">(</span><span class="ident" id="7865939">t</span>&nbsp;<span class="op" id="7865941">*</span><span class="ident" id="7865942">testing</span><span class="op" id="7865949">.</span><span class="ident" id="7865950">T</span><span class="op" id="7865951">)</span>&nbsp;<span class="op" id="7865953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865956">tests</span>&nbsp;<span class="op" id="7865962">:=</span>&nbsp;<span class="op" id="7865965">[</span><span class="op" id="7865966">...</span><span class="op" id="7865969">]</span><span class="op" id="7865970">[</span><span class="num" id="7865971">3</span><span class="op" id="7865972">]</span><span class="builtintype" id="7865973">string</span><span class="op" id="7865979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865983">{</span><span class="string" id="7865984">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7866007">,</span>&nbsp;<span class="string" id="7866009">&#34;foo&#34;</span><span class="op" id="7866014">,</span>&nbsp;<span class="string" id="7866016">&#34;&#34;</span><span class="op" id="7866018">}</span><span class="op" id="7866019">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866023">{</span><span class="string" id="7866024">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="7866047">,</span>&nbsp;<span class="string" id="7866049">&#34;foo&#34;</span><span class="op" id="7866054">,</span>&nbsp;<span class="string" id="7866056">&#34;&#34;</span><span class="op" id="7866058">}</span><span class="op" id="7866059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866063">{</span><span class="string" id="7866064">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="7866086">,</span>&nbsp;<span class="string" id="7866088">&#34;foo&#34;</span><span class="op" id="7866093">,</span>&nbsp;<span class="string" id="7866095">&#34;&#34;</span><span class="op" id="7866097">}</span><span class="op" id="7866098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866102">{</span><span class="string" id="7866103">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7866128">,</span>&nbsp;<span class="string" id="7866130">&#34;foo&#34;</span><span class="op" id="7866135">,</span>&nbsp;<span class="string" id="7866137">&#34;&#34;</span><span class="op" id="7866139">}</span><span class="op" id="7866140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866144">{</span><span class="string" id="7866145">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7866170">,</span>&nbsp;<span class="string" id="7866172">&#34;foo&#34;</span><span class="op" id="7866177">,</span>&nbsp;<span class="string" id="7866179">&#34;&#34;</span><span class="op" id="7866181">}</span><span class="op" id="7866182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866186">{</span><span class="string" id="7866187">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="7866210">,</span>&nbsp;<span class="string" id="7866212">&#34;foo&#34;</span><span class="op" id="7866217">,</span>&nbsp;<span class="string" id="7866219">&#34;&#34;</span><span class="op" id="7866221">}</span><span class="op" id="7866222">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866226">{</span><span class="string" id="7866227">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7866280">,</span>&nbsp;<span class="string" id="7866282">&#34;foo&#34;</span><span class="op" id="7866287">,</span>&nbsp;<span class="string" id="7866289">&#34;foo.txt&#34;</span><span class="op" id="7866298">}</span><span class="op" id="7866299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866303">{</span><span class="string" id="7866304">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7866361">,</span>&nbsp;<span class="string" id="7866363">&#34;&#34;</span><span class="op" id="7866365">,</span>&nbsp;<span class="string" id="7866367">&#34;bar.txt&#34;</span><span class="op" id="7866376">}</span><span class="op" id="7866377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866383">for</span>&nbsp;<span class="ident" id="7866387">i</span><span class="op" id="7866388">,</span>&nbsp;<span class="ident" id="7866390">test</span>&nbsp;<span class="op" id="7866395">:=</span>&nbsp;<span class="keyword" id="7866398">range</span>&nbsp;<span class="ident" id="7866404">tests</span>&nbsp;<span class="op" id="7866410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866414">p</span>&nbsp;<span class="op" id="7866416">:=</span>&nbsp;<span class="op" id="7866419">&amp;</span><span class="ident" id="7866420">Part</span><span class="op" id="7866424">{</span><span class="ident" id="7866425">Header</span><span class="op" id="7866431">:</span>&nbsp;<span class="builtinfunc" id="7866433">make</span><span class="op" id="7866437">(</span><span class="keyword" id="7866438">map</span><span class="op" id="7866441">[</span><span class="builtintype" id="7866442">string</span><span class="op" id="7866448">]</span><span class="op" id="7866449">[</span><span class="op" id="7866450">]</span><span class="builtintype" id="7866451">string</span><span class="op" id="7866457">)</span><span class="op" id="7866458">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866462">p</span><span class="op" id="7866463">.</span><span class="ident" id="7866464">Header</span><span class="op" id="7866470">.</span><span class="ident" id="7866471">Set</span><span class="op" id="7866474">(</span><span class="string" id="7866475">&#34;Content-Disposition&#34;</span><span class="op" id="7866496">,</span>&nbsp;<span class="ident" id="7866498">test</span><span class="op" id="7866502">[</span><span class="num" id="7866503">0</span><span class="op" id="7866504">]</span><span class="op" id="7866505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866509">if</span>&nbsp;<span class="ident" id="7866512">g</span><span class="op" id="7866513">,</span>&nbsp;<span class="ident" id="7866515">e</span>&nbsp;<span class="op" id="7866517">:=</span>&nbsp;<span class="ident" id="7866520">p</span><span class="op" id="7866521">.</span><span class="ident" id="7866522">FormName</span><span class="op" id="7866530">(</span><span class="op" id="7866531">)</span><span class="op" id="7866532">,</span>&nbsp;<span class="ident" id="7866534">test</span><span class="op" id="7866538">[</span><span class="num" id="7866539">1</span><span class="op" id="7866540">]</span><span class="op" id="7866541">;</span>&nbsp;<span class="ident" id="7866543">g</span>&nbsp;<span class="op" id="7866545">!=</span>&nbsp;<span class="ident" id="7866548">e</span>&nbsp;<span class="op" id="7866550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866555">t</span><span class="op" id="7866556">.</span><span class="ident" id="7866557">Errorf</span><span class="op" id="7866563">(</span><span class="string" id="7866564">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7866599">,</span>&nbsp;<span class="ident" id="7866601">i</span><span class="op" id="7866602">,</span>&nbsp;<span class="ident" id="7866604">g</span><span class="op" id="7866605">,</span>&nbsp;<span class="ident" id="7866607">e</span><span class="op" id="7866608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866616">if</span>&nbsp;<span class="ident" id="7866619">g</span><span class="op" id="7866620">,</span>&nbsp;<span class="ident" id="7866622">e</span>&nbsp;<span class="op" id="7866624">:=</span>&nbsp;<span class="ident" id="7866627">p</span><span class="op" id="7866628">.</span><span class="ident" id="7866629">FileName</span><span class="op" id="7866637">(</span><span class="op" id="7866638">)</span><span class="op" id="7866639">,</span>&nbsp;<span class="ident" id="7866641">test</span><span class="op" id="7866645">[</span><span class="num" id="7866646">2</span><span class="op" id="7866647">]</span><span class="op" id="7866648">;</span>&nbsp;<span class="ident" id="7866650">g</span>&nbsp;<span class="op" id="7866652">!=</span>&nbsp;<span class="ident" id="7866655">e</span>&nbsp;<span class="op" id="7866657">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866662">t</span><span class="op" id="7866663">.</span><span class="ident" id="7866664">Errorf</span><span class="op" id="7866670">(</span><span class="string" id="7866671">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7866706">,</span>&nbsp;<span class="ident" id="7866708">i</span><span class="op" id="7866709">,</span>&nbsp;<span class="ident" id="7866711">g</span><span class="op" id="7866712">,</span>&nbsp;<span class="ident" id="7866714">e</span><span class="op" id="7866715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866722">}</span><br>
<span class="lineno"></span><span class="op" id="7866724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7866727">var</span>&nbsp;<span class="ident" id="7866731">longLine</span>&nbsp;<span class="op" id="7866740">=</span>&nbsp;<span class="ident" id="7866742">strings</span><span class="op" id="7866749">.</span><span class="ident" id="7866750">Repeat</span><span class="op" id="7866756">(</span><span class="string" id="7866757">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="7866777">,</span>&nbsp;<span class="op" id="7866779">(</span><span class="num" id="7866780">1</span><span class="op" id="7866781">&lt;&lt;</span><span class="num" id="7866783">20</span><span class="op" id="7866785">)</span><span class="op" id="7866786">/</span><span class="num" id="7866787">8</span><span class="op" id="7866788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866791">func</span>&nbsp;<span class="ident" id="7866796">testMultipartBody</span><span class="op" id="7866813">(</span><span class="ident" id="7866814">sep</span>&nbsp;<span class="builtintype" id="7866818">string</span><span class="op" id="7866824">)</span>&nbsp;<span class="builtintype" id="7866826">string</span>&nbsp;<span class="op" id="7866833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866836">testBody</span>&nbsp;<span class="op" id="7866845">:=</span>&nbsp;<span class="string" id="7866848">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867205">testBody</span>&nbsp;<span class="op" id="7867214">=</span>&nbsp;<span class="ident" id="7867216">strings</span><span class="op" id="7867223">.</span><span class="ident" id="7867224">Replace</span><span class="op" id="7867231">(</span><span class="ident" id="7867232">testBody</span><span class="op" id="7867240">,</span>&nbsp;<span class="string" id="7867242">&#34;\n&#34;</span><span class="op" id="7867246">,</span>&nbsp;<span class="ident" id="7867248">sep</span><span class="op" id="7867251">,</span>&nbsp;<span class="op" id="7867253">-</span><span class="num" id="7867254">1</span><span class="op" id="7867255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867258">return</span>&nbsp;<span class="ident" id="7867265">strings</span><span class="op" id="7867272">.</span><span class="ident" id="7867273">Replace</span><span class="op" id="7867280">(</span><span class="ident" id="7867281">testBody</span><span class="op" id="7867289">,</span>&nbsp;<span class="string" id="7867291">&#34;[longline]&#34;</span><span class="op" id="7867303">,</span>&nbsp;<span class="ident" id="7867305">longLine</span><span class="op" id="7867313">,</span>&nbsp;<span class="num" id="7867315">1</span><span class="op" id="7867316">)</span><br>
<span class="lineno">110</span><span class="op" id="7867318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867321">func</span>&nbsp;<span class="ident" id="7867326">TestMultipart</span><span class="op" id="7867339">(</span><span class="ident" id="7867340">t</span>&nbsp;<span class="op" id="7867342">*</span><span class="ident" id="7867343">testing</span><span class="op" id="7867350">.</span><span class="ident" id="7867351">T</span><span class="op" id="7867352">)</span>&nbsp;<span class="op" id="7867354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867357">bodyReader</span>&nbsp;<span class="op" id="7867368">:=</span>&nbsp;<span class="ident" id="7867371">strings</span><span class="op" id="7867378">.</span><span class="ident" id="7867379">NewReader</span><span class="op" id="7867388">(</span><span class="ident" id="7867389">testMultipartBody</span><span class="op" id="7867406">(</span><span class="string" id="7867407">&#34;\r\n&#34;</span><span class="op" id="7867413">)</span><span class="op" id="7867414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867417">testMultipart</span><span class="op" id="7867430">(</span><span class="ident" id="7867431">t</span><span class="op" id="7867432">,</span>&nbsp;<span class="ident" id="7867434">bodyReader</span><span class="op" id="7867444">,</span>&nbsp;<span class="builtintype" id="7867446">false</span><span class="op" id="7867451">)</span><br>
<span class="lineno">115</span><span class="op" id="7867453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867456">func</span>&nbsp;<span class="ident" id="7867461">TestMultipartOnlyNewlines</span><span class="op" id="7867486">(</span><span class="ident" id="7867487">t</span>&nbsp;<span class="op" id="7867489">*</span><span class="ident" id="7867490">testing</span><span class="op" id="7867497">.</span><span class="ident" id="7867498">T</span><span class="op" id="7867499">)</span>&nbsp;<span class="op" id="7867501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867504">bodyReader</span>&nbsp;<span class="op" id="7867515">:=</span>&nbsp;<span class="ident" id="7867518">strings</span><span class="op" id="7867525">.</span><span class="ident" id="7867526">NewReader</span><span class="op" id="7867535">(</span><span class="ident" id="7867536">testMultipartBody</span><span class="op" id="7867553">(</span><span class="string" id="7867554">&#34;\n&#34;</span><span class="op" id="7867558">)</span><span class="op" id="7867559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867562">testMultipart</span><span class="op" id="7867575">(</span><span class="ident" id="7867576">t</span><span class="op" id="7867577">,</span>&nbsp;<span class="ident" id="7867579">bodyReader</span><span class="op" id="7867589">,</span>&nbsp;<span class="builtintype" id="7867591">true</span><span class="op" id="7867595">)</span><br>
<span class="lineno">120</span><span class="op" id="7867597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867600">func</span>&nbsp;<span class="ident" id="7867605">TestMultipartSlowInput</span><span class="op" id="7867627">(</span><span class="ident" id="7867628">t</span>&nbsp;<span class="op" id="7867630">*</span><span class="ident" id="7867631">testing</span><span class="op" id="7867638">.</span><span class="ident" id="7867639">T</span><span class="op" id="7867640">)</span>&nbsp;<span class="op" id="7867642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867645">bodyReader</span>&nbsp;<span class="op" id="7867656">:=</span>&nbsp;<span class="ident" id="7867659">strings</span><span class="op" id="7867666">.</span><span class="ident" id="7867667">NewReader</span><span class="op" id="7867676">(</span><span class="ident" id="7867677">testMultipartBody</span><span class="op" id="7867694">(</span><span class="string" id="7867695">&#34;\r\n&#34;</span><span class="op" id="7867701">)</span><span class="op" id="7867702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867705">testMultipart</span><span class="op" id="7867718">(</span><span class="ident" id="7867719">t</span><span class="op" id="7867720">,</span>&nbsp;<span class="op" id="7867722">&amp;</span><span class="ident" id="7867723">slowReader</span><span class="op" id="7867733">{</span><span class="ident" id="7867734">bodyReader</span><span class="op" id="7867744">}</span><span class="op" id="7867745">,</span>&nbsp;<span class="builtintype" id="7867747">false</span><span class="op" id="7867752">)</span><br>
<span class="lineno">125</span><span class="op" id="7867754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867757">func</span>&nbsp;<span class="ident" id="7867762">testMultipart</span><span class="op" id="7867775">(</span><span class="ident" id="7867776">t</span>&nbsp;<span class="op" id="7867778">*</span><span class="ident" id="7867779">testing</span><span class="op" id="7867786">.</span><span class="ident" id="7867787">T</span><span class="op" id="7867788">,</span>&nbsp;<span class="ident" id="7867790">r</span>&nbsp;<span class="ident" id="7867792">io</span><span class="op" id="7867794">.</span><span class="ident" id="7867795">Reader</span><span class="op" id="7867801">,</span>&nbsp;<span class="ident" id="7867803">onlyNewlines</span>&nbsp;<span class="builtintype" id="7867816">bool</span><span class="op" id="7867820">)</span>&nbsp;<span class="op" id="7867822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867825">reader</span>&nbsp;<span class="op" id="7867832">:=</span>&nbsp;<span class="ident" id="7867835">NewReader</span><span class="op" id="7867844">(</span><span class="ident" id="7867845">r</span><span class="op" id="7867846">,</span>&nbsp;<span class="string" id="7867848">&#34;MyBoundary&#34;</span><span class="op" id="7867860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867863">buf</span>&nbsp;<span class="op" id="7867867">:=</span>&nbsp;<span class="builtinfunc" id="7867870">new</span><span class="op" id="7867873">(</span><span class="ident" id="7867874">bytes</span><span class="op" id="7867879">.</span><span class="ident" id="7867880">Buffer</span><span class="op" id="7867886">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7867890">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867900">part</span><span class="op" id="7867904">,</span>&nbsp;<span class="ident" id="7867906">err</span>&nbsp;<span class="op" id="7867910">:=</span>&nbsp;<span class="ident" id="7867913">reader</span><span class="op" id="7867919">.</span><span class="ident" id="7867920">NextPart</span><span class="op" id="7867928">(</span><span class="op" id="7867929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867932">if</span>&nbsp;<span class="ident" id="7867935">part</span>&nbsp;<span class="op" id="7867940">==</span>&nbsp;<span class="ident" id="7867943">nil</span>&nbsp;<span class="op" id="7867947">||</span>&nbsp;<span class="ident" id="7867950">err</span>&nbsp;<span class="op" id="7867954">!=</span>&nbsp;<span class="ident" id="7867957">nil</span>&nbsp;<span class="op" id="7867961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867965">t</span><span class="op" id="7867966">.</span><span class="ident" id="7867967">Error</span><span class="op" id="7867972">(</span><span class="string" id="7867973">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="7867989">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867993">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868004">if</span>&nbsp;<span class="ident" id="7868007">x</span>&nbsp;<span class="op" id="7868009">:=</span>&nbsp;<span class="ident" id="7868012">part</span><span class="op" id="7868016">.</span><span class="ident" id="7868017">Header</span><span class="op" id="7868023">.</span><span class="ident" id="7868024">Get</span><span class="op" id="7868027">(</span><span class="string" id="7868028">&#34;Header1&#34;</span><span class="op" id="7868037">)</span><span class="op" id="7868038">;</span>&nbsp;<span class="ident" id="7868040">x</span>&nbsp;<span class="op" id="7868042">!=</span>&nbsp;<span class="string" id="7868045">&#34;value1&#34;</span>&nbsp;<span class="op" id="7868054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868058">t</span><span class="op" id="7868059">.</span><span class="ident" id="7868060">Errorf</span><span class="op" id="7868066">(</span><span class="string" id="7868067">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7868102">,</span>&nbsp;<span class="string" id="7868104">&#34;Header1&#34;</span><span class="op" id="7868113">,</span>&nbsp;<span class="ident" id="7868115">x</span><span class="op" id="7868116">,</span>&nbsp;<span class="string" id="7868118">&#34;value1&#34;</span><span class="op" id="7868126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868129">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868132">if</span>&nbsp;<span class="ident" id="7868135">x</span>&nbsp;<span class="op" id="7868137">:=</span>&nbsp;<span class="ident" id="7868140">part</span><span class="op" id="7868144">.</span><span class="ident" id="7868145">Header</span><span class="op" id="7868151">.</span><span class="ident" id="7868152">Get</span><span class="op" id="7868155">(</span><span class="string" id="7868156">&#34;foo-bar&#34;</span><span class="op" id="7868165">)</span><span class="op" id="7868166">;</span>&nbsp;<span class="ident" id="7868168">x</span>&nbsp;<span class="op" id="7868170">!=</span>&nbsp;<span class="string" id="7868173">&#34;baz&#34;</span>&nbsp;<span class="op" id="7868179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868183">t</span><span class="op" id="7868184">.</span><span class="ident" id="7868185">Errorf</span><span class="op" id="7868191">(</span><span class="string" id="7868192">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7868227">,</span>&nbsp;<span class="string" id="7868229">&#34;foo-bar&#34;</span><span class="op" id="7868238">,</span>&nbsp;<span class="ident" id="7868240">x</span><span class="op" id="7868241">,</span>&nbsp;<span class="string" id="7868243">&#34;baz&#34;</span><span class="op" id="7868248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868254">if</span>&nbsp;<span class="ident" id="7868257">x</span>&nbsp;<span class="op" id="7868259">:=</span>&nbsp;<span class="ident" id="7868262">part</span><span class="op" id="7868266">.</span><span class="ident" id="7868267">Header</span><span class="op" id="7868273">.</span><span class="ident" id="7868274">Get</span><span class="op" id="7868277">(</span><span class="string" id="7868278">&#34;Foo-Bar&#34;</span><span class="op" id="7868287">)</span><span class="op" id="7868288">;</span>&nbsp;<span class="ident" id="7868290">x</span>&nbsp;<span class="op" id="7868292">!=</span>&nbsp;<span class="string" id="7868295">&#34;baz&#34;</span>&nbsp;<span class="op" id="7868301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868305">t</span><span class="op" id="7868306">.</span><span class="ident" id="7868307">Errorf</span><span class="op" id="7868313">(</span><span class="string" id="7868314">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7868349">,</span>&nbsp;<span class="string" id="7868351">&#34;Foo-Bar&#34;</span><span class="op" id="7868360">,</span>&nbsp;<span class="ident" id="7868362">x</span><span class="op" id="7868363">,</span>&nbsp;<span class="string" id="7868365">&#34;baz&#34;</span><span class="op" id="7868370">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868376">buf</span><span class="op" id="7868379">.</span><span class="ident" id="7868380">Reset</span><span class="op" id="7868385">(</span><span class="op" id="7868386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868389">if</span>&nbsp;<span class="ident" id="7868392">_</span><span class="op" id="7868393">,</span>&nbsp;<span class="ident" id="7868395">err</span>&nbsp;<span class="op" id="7868399">:=</span>&nbsp;<span class="ident" id="7868402">io</span><span class="op" id="7868404">.</span><span class="ident" id="7868405">Copy</span><span class="op" id="7868409">(</span><span class="ident" id="7868410">buf</span><span class="op" id="7868413">,</span>&nbsp;<span class="ident" id="7868415">part</span><span class="op" id="7868419">)</span><span class="op" id="7868420">;</span>&nbsp;<span class="ident" id="7868422">err</span>&nbsp;<span class="op" id="7868426">!=</span>&nbsp;<span class="ident" id="7868429">nil</span>&nbsp;<span class="op" id="7868433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868437">t</span><span class="op" id="7868438">.</span><span class="ident" id="7868439">Errorf</span><span class="op" id="7868445">(</span><span class="string" id="7868446">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7868463">,</span>&nbsp;<span class="ident" id="7868465">err</span><span class="op" id="7868468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868471">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868475">adjustNewlines</span>&nbsp;<span class="op" id="7868490">:=</span>&nbsp;<span class="keyword" id="7868493">func</span><span class="op" id="7868497">(</span><span class="ident" id="7868498">s</span>&nbsp;<span class="builtintype" id="7868500">string</span><span class="op" id="7868506">)</span>&nbsp;<span class="builtintype" id="7868508">string</span>&nbsp;<span class="op" id="7868515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868519">if</span>&nbsp;<span class="ident" id="7868522">onlyNewlines</span>&nbsp;<span class="op" id="7868535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868540">return</span>&nbsp;<span class="ident" id="7868547">strings</span><span class="op" id="7868554">.</span><span class="ident" id="7868555">Replace</span><span class="op" id="7868562">(</span><span class="ident" id="7868563">s</span><span class="op" id="7868564">,</span>&nbsp;<span class="string" id="7868566">&#34;\r\n&#34;</span><span class="op" id="7868572">,</span>&nbsp;<span class="string" id="7868574">&#34;\n&#34;</span><span class="op" id="7868578">,</span>&nbsp;<span class="op" id="7868580">-</span><span class="num" id="7868581">1</span><span class="op" id="7868582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868586">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868590">return</span>&nbsp;<span class="ident" id="7868597">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868604">expectEq</span><span class="op" id="7868612">(</span><span class="ident" id="7868613">t</span><span class="op" id="7868614">,</span>&nbsp;<span class="ident" id="7868616">adjustNewlines</span><span class="op" id="7868630">(</span><span class="string" id="7868631">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="7868653">)</span><span class="op" id="7868654">,</span>&nbsp;<span class="ident" id="7868656">buf</span><span class="op" id="7868659">.</span><span class="ident" id="7868660">String</span><span class="op" id="7868666">(</span><span class="op" id="7868667">)</span><span class="op" id="7868668">,</span>&nbsp;<span class="string" id="7868670">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="7868691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7868695">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868705">part</span><span class="op" id="7868709">,</span>&nbsp;<span class="ident" id="7868711">err</span>&nbsp;<span class="op" id="7868715">=</span>&nbsp;<span class="ident" id="7868717">reader</span><span class="op" id="7868723">.</span><span class="ident" id="7868724">NextPart</span><span class="op" id="7868732">(</span><span class="op" id="7868733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868736">if</span>&nbsp;<span class="ident" id="7868739">err</span>&nbsp;<span class="op" id="7868743">!=</span>&nbsp;<span class="ident" id="7868746">nil</span>&nbsp;<span class="op" id="7868750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868754">t</span><span class="op" id="7868755">.</span><span class="ident" id="7868756">Fatalf</span><span class="op" id="7868762">(</span><span class="string" id="7868763">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7868788">,</span>&nbsp;<span class="ident" id="7868790">err</span><span class="op" id="7868793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868797">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868808">if</span>&nbsp;<span class="ident" id="7868811">e</span><span class="op" id="7868812">,</span>&nbsp;<span class="ident" id="7868814">g</span>&nbsp;<span class="op" id="7868816">:=</span>&nbsp;<span class="string" id="7868819">&#34;bigsection&#34;</span><span class="op" id="7868831">,</span>&nbsp;<span class="ident" id="7868833">part</span><span class="op" id="7868837">.</span><span class="ident" id="7868838">Header</span><span class="op" id="7868844">.</span><span class="ident" id="7868845">Get</span><span class="op" id="7868848">(</span><span class="string" id="7868849">&#34;name&#34;</span><span class="op" id="7868855">)</span><span class="op" id="7868856">;</span>&nbsp;<span class="ident" id="7868858">e</span>&nbsp;<span class="op" id="7868860">!=</span>&nbsp;<span class="ident" id="7868863">g</span>&nbsp;<span class="op" id="7868865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868869">t</span><span class="op" id="7868870">.</span><span class="ident" id="7868871">Errorf</span><span class="op" id="7868877">(</span><span class="string" id="7868878">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7868920">,</span>&nbsp;<span class="ident" id="7868922">e</span><span class="op" id="7868923">,</span>&nbsp;<span class="ident" id="7868925">g</span><span class="op" id="7868926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868932">buf</span><span class="op" id="7868935">.</span><span class="ident" id="7868936">Reset</span><span class="op" id="7868941">(</span><span class="op" id="7868942">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868945">if</span>&nbsp;<span class="ident" id="7868948">_</span><span class="op" id="7868949">,</span>&nbsp;<span class="ident" id="7868951">err</span>&nbsp;<span class="op" id="7868955">:=</span>&nbsp;<span class="ident" id="7868958">io</span><span class="op" id="7868960">.</span><span class="ident" id="7868961">Copy</span><span class="op" id="7868965">(</span><span class="ident" id="7868966">buf</span><span class="op" id="7868969">,</span>&nbsp;<span class="ident" id="7868971">part</span><span class="op" id="7868975">)</span><span class="op" id="7868976">;</span>&nbsp;<span class="ident" id="7868978">err</span>&nbsp;<span class="op" id="7868982">!=</span>&nbsp;<span class="ident" id="7868985">nil</span>&nbsp;<span class="op" id="7868989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868993">t</span><span class="op" id="7868994">.</span><span class="ident" id="7868995">Errorf</span><span class="op" id="7869001">(</span><span class="string" id="7869002">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7869019">,</span>&nbsp;<span class="ident" id="7869021">err</span><span class="op" id="7869024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869030">s</span>&nbsp;<span class="op" id="7869032">:=</span>&nbsp;<span class="ident" id="7869035">buf</span><span class="op" id="7869038">.</span><span class="ident" id="7869039">String</span><span class="op" id="7869045">(</span><span class="op" id="7869046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869049">if</span>&nbsp;<span class="builtinfunc" id="7869052">len</span><span class="op" id="7869055">(</span><span class="ident" id="7869056">s</span><span class="op" id="7869057">)</span>&nbsp;<span class="op" id="7869059">!=</span>&nbsp;<span class="builtinfunc" id="7869062">len</span><span class="op" id="7869065">(</span><span class="ident" id="7869066">longLine</span><span class="op" id="7869074">)</span>&nbsp;<span class="op" id="7869076">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869080">t</span><span class="op" id="7869081">.</span><span class="ident" id="7869082">Errorf</span><span class="op" id="7869088">(</span><span class="string" id="7869089">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="7869148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7869153">len</span><span class="op" id="7869156">(</span><span class="ident" id="7869157">longLine</span><span class="op" id="7869165">)</span><span class="op" id="7869166">,</span>&nbsp;<span class="builtinfunc" id="7869168">len</span><span class="op" id="7869171">(</span><span class="ident" id="7869172">s</span><span class="op" id="7869173">)</span><span class="op" id="7869174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869180">if</span>&nbsp;<span class="ident" id="7869183">s</span>&nbsp;<span class="op" id="7869185">!=</span>&nbsp;<span class="ident" id="7869188">longLine</span>&nbsp;<span class="op" id="7869197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869201">t</span><span class="op" id="7869202">.</span><span class="ident" id="7869203">Errorf</span><span class="op" id="7869209">(</span><span class="string" id="7869210">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="7869240">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7869247">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869257">part</span><span class="op" id="7869261">,</span>&nbsp;<span class="ident" id="7869263">err</span>&nbsp;<span class="op" id="7869267">=</span>&nbsp;<span class="ident" id="7869269">reader</span><span class="op" id="7869275">.</span><span class="ident" id="7869276">NextPart</span><span class="op" id="7869284">(</span><span class="op" id="7869285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869288">if</span>&nbsp;<span class="ident" id="7869291">part</span>&nbsp;<span class="op" id="7869296">==</span>&nbsp;<span class="ident" id="7869299">nil</span>&nbsp;<span class="op" id="7869303">||</span>&nbsp;<span class="ident" id="7869306">err</span>&nbsp;<span class="op" id="7869310">!=</span>&nbsp;<span class="ident" id="7869313">nil</span>&nbsp;<span class="op" id="7869317">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869321">t</span><span class="op" id="7869322">.</span><span class="ident" id="7869323">Error</span><span class="op" id="7869328">(</span><span class="string" id="7869329">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="7869345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869360">if</span>&nbsp;<span class="ident" id="7869363">part</span><span class="op" id="7869367">.</span><span class="ident" id="7869368">Header</span><span class="op" id="7869374">.</span><span class="ident" id="7869375">Get</span><span class="op" id="7869378">(</span><span class="string" id="7869379">&#34;foo-bar&#34;</span><span class="op" id="7869388">)</span>&nbsp;<span class="op" id="7869390">!=</span>&nbsp;<span class="string" id="7869393">&#34;bazb&#34;</span>&nbsp;<span class="op" id="7869400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869404">t</span><span class="op" id="7869405">.</span><span class="ident" id="7869406">Error</span><span class="op" id="7869411">(</span><span class="string" id="7869412">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="7869436">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869442">buf</span><span class="op" id="7869445">.</span><span class="ident" id="7869446">Reset</span><span class="op" id="7869451">(</span><span class="op" id="7869452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869455">if</span>&nbsp;<span class="ident" id="7869458">_</span><span class="op" id="7869459">,</span>&nbsp;<span class="ident" id="7869461">err</span>&nbsp;<span class="op" id="7869465">:=</span>&nbsp;<span class="ident" id="7869468">io</span><span class="op" id="7869470">.</span><span class="ident" id="7869471">Copy</span><span class="op" id="7869475">(</span><span class="ident" id="7869476">buf</span><span class="op" id="7869479">,</span>&nbsp;<span class="ident" id="7869481">part</span><span class="op" id="7869485">)</span><span class="op" id="7869486">;</span>&nbsp;<span class="ident" id="7869488">err</span>&nbsp;<span class="op" id="7869492">!=</span>&nbsp;<span class="ident" id="7869495">nil</span>&nbsp;<span class="op" id="7869499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869503">t</span><span class="op" id="7869504">.</span><span class="ident" id="7869505">Errorf</span><span class="op" id="7869511">(</span><span class="string" id="7869512">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7869529">,</span>&nbsp;<span class="ident" id="7869531">err</span><span class="op" id="7869534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869537">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869540">expectEq</span><span class="op" id="7869548">(</span><span class="ident" id="7869549">t</span><span class="op" id="7869550">,</span>&nbsp;<span class="ident" id="7869552">adjustNewlines</span><span class="op" id="7869566">(</span><span class="string" id="7869567">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="7869632">)</span><span class="op" id="7869633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869637">buf</span><span class="op" id="7869640">.</span><span class="ident" id="7869641">String</span><span class="op" id="7869647">(</span><span class="op" id="7869648">)</span><span class="op" id="7869649">,</span>&nbsp;<span class="string" id="7869651">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="7869667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7869671">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869681">part</span><span class="op" id="7869685">,</span>&nbsp;<span class="ident" id="7869687">err</span>&nbsp;<span class="op" id="7869691">=</span>&nbsp;<span class="ident" id="7869693">reader</span><span class="op" id="7869699">.</span><span class="ident" id="7869700">NextPart</span><span class="op" id="7869708">(</span><span class="op" id="7869709">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869712">if</span>&nbsp;<span class="ident" id="7869715">part</span>&nbsp;<span class="op" id="7869720">==</span>&nbsp;<span class="ident" id="7869723">nil</span>&nbsp;<span class="op" id="7869727">||</span>&nbsp;<span class="ident" id="7869730">err</span>&nbsp;<span class="op" id="7869734">!=</span>&nbsp;<span class="ident" id="7869737">nil</span>&nbsp;<span class="op" id="7869741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869745">t</span><span class="op" id="7869746">.</span><span class="ident" id="7869747">Error</span><span class="op" id="7869752">(</span><span class="string" id="7869753">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="7869785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869789">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7869801">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869824">part</span><span class="op" id="7869828">,</span>&nbsp;<span class="ident" id="7869830">err</span>&nbsp;<span class="op" id="7869834">=</span>&nbsp;<span class="ident" id="7869836">reader</span><span class="op" id="7869842">.</span><span class="ident" id="7869843">NextPart</span><span class="op" id="7869851">(</span><span class="op" id="7869852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869855">if</span>&nbsp;<span class="ident" id="7869858">part</span>&nbsp;<span class="op" id="7869863">!=</span>&nbsp;<span class="ident" id="7869866">nil</span>&nbsp;<span class="op" id="7869870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869874">t</span><span class="op" id="7869875">.</span><span class="ident" id="7869876">Error</span><span class="op" id="7869881">(</span><span class="string" id="7869882">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="7869911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869914">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7869917">if</span>&nbsp;<span class="ident" id="7869920">err</span>&nbsp;<span class="op" id="7869924">!=</span>&nbsp;<span class="ident" id="7869927">io</span><span class="op" id="7869929">.</span><span class="ident" id="7869930">EOF</span>&nbsp;<span class="op" id="7869934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7869938">t</span><span class="op" id="7869939">.</span><span class="ident" id="7869940">Errorf</span><span class="op" id="7869946">(</span><span class="string" id="7869947">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7869986">,</span>&nbsp;<span class="ident" id="7869988">err</span><span class="op" id="7869991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7869994">}</span><br>
<span class="lineno"></span><span class="op" id="7869996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7869999">func</span>&nbsp;<span class="ident" id="7870004">TestVariousTextLineEndings</span><span class="op" id="7870030">(</span><span class="ident" id="7870031">t</span>&nbsp;<span class="op" id="7870033">*</span><span class="ident" id="7870034">testing</span><span class="op" id="7870041">.</span><span class="ident" id="7870042">T</span><span class="op" id="7870043">)</span>&nbsp;<span class="op" id="7870045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870048">tests</span>&nbsp;<span class="op" id="7870054">:=</span>&nbsp;<span class="op" id="7870057">[</span><span class="op" id="7870058">...</span><span class="op" id="7870061">]</span><span class="builtintype" id="7870062">string</span><span class="op" id="7870068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870072">&#34;Foo\nBar&#34;</span><span class="op" id="7870082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870086">&#34;Foo\nBar\n&#34;</span><span class="op" id="7870098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870102">&#34;Foo\r\nBar&#34;</span><span class="op" id="7870114">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870118">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="7870134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870138">&#34;Foo\rBar&#34;</span><span class="op" id="7870148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870152">&#34;Foo\rBar\r&#34;</span><span class="op" id="7870164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870168">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="7870214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870217">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870221">for</span>&nbsp;<span class="ident" id="7870225">testNum</span><span class="op" id="7870232">,</span>&nbsp;<span class="ident" id="7870234">expectedBody</span>&nbsp;<span class="op" id="7870247">:=</span>&nbsp;<span class="keyword" id="7870250">range</span>&nbsp;<span class="ident" id="7870256">tests</span>&nbsp;<span class="op" id="7870262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870266">body</span>&nbsp;<span class="op" id="7870271">:=</span>&nbsp;<span class="string" id="7870274">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="7870291">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870296">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7870349">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870354">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7870361">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870366">expectedBody</span>&nbsp;<span class="op" id="7870379">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7870384">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870409">bodyReader</span>&nbsp;<span class="op" id="7870420">:=</span>&nbsp;<span class="ident" id="7870423">strings</span><span class="op" id="7870430">.</span><span class="ident" id="7870431">NewReader</span><span class="op" id="7870440">(</span><span class="ident" id="7870441">body</span><span class="op" id="7870445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870450">reader</span>&nbsp;<span class="op" id="7870457">:=</span>&nbsp;<span class="ident" id="7870460">NewReader</span><span class="op" id="7870469">(</span><span class="ident" id="7870470">bodyReader</span><span class="op" id="7870480">,</span>&nbsp;<span class="string" id="7870482">&#34;BOUNDARY&#34;</span><span class="op" id="7870492">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870496">buf</span>&nbsp;<span class="op" id="7870500">:=</span>&nbsp;<span class="builtinfunc" id="7870503">new</span><span class="op" id="7870506">(</span><span class="ident" id="7870507">bytes</span><span class="op" id="7870512">.</span><span class="ident" id="7870513">Buffer</span><span class="op" id="7870519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870523">part</span><span class="op" id="7870527">,</span>&nbsp;<span class="ident" id="7870529">err</span>&nbsp;<span class="op" id="7870533">:=</span>&nbsp;<span class="ident" id="7870536">reader</span><span class="op" id="7870542">.</span><span class="ident" id="7870543">NextPart</span><span class="op" id="7870551">(</span><span class="op" id="7870552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870556">if</span>&nbsp;<span class="ident" id="7870559">part</span>&nbsp;<span class="op" id="7870564">==</span>&nbsp;<span class="ident" id="7870567">nil</span>&nbsp;<span class="op" id="7870571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870576">t</span><span class="op" id="7870577">.</span><span class="ident" id="7870578">Errorf</span><span class="op" id="7870584">(</span><span class="string" id="7870585">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="7870618">,</span>&nbsp;<span class="ident" id="7870620">testNum</span><span class="op" id="7870627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870632">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870647">if</span>&nbsp;<span class="ident" id="7870650">err</span>&nbsp;<span class="op" id="7870654">!=</span>&nbsp;<span class="ident" id="7870657">nil</span>&nbsp;<span class="op" id="7870661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870666">t</span><span class="op" id="7870667">.</span><span class="ident" id="7870668">Errorf</span><span class="op" id="7870674">(</span><span class="string" id="7870675">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7870708">,</span>&nbsp;<span class="ident" id="7870710">testNum</span><span class="op" id="7870717">,</span>&nbsp;<span class="ident" id="7870719">err</span><span class="op" id="7870722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870738">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870742">written</span><span class="op" id="7870749">,</span>&nbsp;<span class="ident" id="7870751">err</span>&nbsp;<span class="op" id="7870755">:=</span>&nbsp;<span class="ident" id="7870758">io</span><span class="op" id="7870760">.</span><span class="ident" id="7870761">Copy</span><span class="op" id="7870765">(</span><span class="ident" id="7870766">buf</span><span class="op" id="7870769">,</span>&nbsp;<span class="ident" id="7870771">part</span><span class="op" id="7870775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870779">expectEq</span><span class="op" id="7870787">(</span><span class="ident" id="7870788">t</span><span class="op" id="7870789">,</span>&nbsp;<span class="ident" id="7870791">expectedBody</span><span class="op" id="7870803">,</span>&nbsp;<span class="ident" id="7870805">buf</span><span class="op" id="7870808">.</span><span class="ident" id="7870809">String</span><span class="op" id="7870815">(</span><span class="op" id="7870816">)</span><span class="op" id="7870817">,</span>&nbsp;<span class="ident" id="7870819">fmt</span><span class="op" id="7870822">.</span><span class="ident" id="7870823">Sprintf</span><span class="op" id="7870830">(</span><span class="string" id="7870831">&#34;test&nbsp;%d&#34;</span><span class="op" id="7870840">,</span>&nbsp;<span class="ident" id="7870842">testNum</span><span class="op" id="7870849">)</span><span class="op" id="7870850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870854">if</span>&nbsp;<span class="ident" id="7870857">err</span>&nbsp;<span class="op" id="7870861">!=</span>&nbsp;<span class="ident" id="7870864">nil</span>&nbsp;<span class="op" id="7870868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870873">t</span><span class="op" id="7870874">.</span><span class="ident" id="7870875">Errorf</span><span class="op" id="7870881">(</span><span class="string" id="7870882">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="7870927">,</span>&nbsp;<span class="ident" id="7870929">written</span><span class="op" id="7870936">,</span>&nbsp;<span class="ident" id="7870938">err</span><span class="op" id="7870941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870945">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870950">part</span><span class="op" id="7870954">,</span>&nbsp;<span class="ident" id="7870956">err</span>&nbsp;<span class="op" id="7870960">=</span>&nbsp;<span class="ident" id="7870962">reader</span><span class="op" id="7870968">.</span><span class="ident" id="7870969">NextPart</span><span class="op" id="7870977">(</span><span class="op" id="7870978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7870982">if</span>&nbsp;<span class="ident" id="7870985">part</span>&nbsp;<span class="op" id="7870990">!=</span>&nbsp;<span class="ident" id="7870993">nil</span>&nbsp;<span class="op" id="7870997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871002">t</span><span class="op" id="7871003">.</span><span class="ident" id="7871004">Errorf</span><span class="op" id="7871010">(</span><span class="string" id="7871011">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="7871039">,</span>&nbsp;<span class="ident" id="7871041">testNum</span><span class="op" id="7871048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871052">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871056">if</span>&nbsp;<span class="ident" id="7871059">err</span>&nbsp;<span class="op" id="7871063">!=</span>&nbsp;<span class="ident" id="7871066">io</span><span class="op" id="7871068">.</span><span class="ident" id="7871069">EOF</span>&nbsp;<span class="op" id="7871073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871078">t</span><span class="op" id="7871079">.</span><span class="ident" id="7871080">Errorf</span><span class="op" id="7871086">(</span><span class="string" id="7871087">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7871123">,</span>&nbsp;<span class="ident" id="7871125">testNum</span><span class="op" id="7871132">,</span>&nbsp;<span class="ident" id="7871134">err</span><span class="op" id="7871137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871145">}</span><br>
<span class="lineno">260</span><span class="op" id="7871147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871150">type</span>&nbsp;<span class="ident" id="7871155">maliciousReader</span>&nbsp;<span class="keyword" id="7871171">struct</span>&nbsp;<span class="op" id="7871178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871181">t</span>&nbsp;<span class="op" id="7871183">*</span><span class="ident" id="7871184">testing</span><span class="op" id="7871191">.</span><span class="ident" id="7871192">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871195">n</span>&nbsp;<span class="builtintype" id="7871197">int</span><br>
<span class="lineno">265</span><span class="op" id="7871201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871204">const</span>&nbsp;<span class="ident" id="7871210">maxReadThreshold</span>&nbsp;<span class="op" id="7871227">=</span>&nbsp;<span class="num" id="7871229">1</span>&nbsp;<span class="op" id="7871231">&lt;&lt;</span>&nbsp;<span class="num" id="7871234">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871238">func</span>&nbsp;<span class="op" id="7871243">(</span><span class="ident" id="7871244">mr</span>&nbsp;<span class="op" id="7871247">*</span><span class="ident" id="7871248">maliciousReader</span><span class="op" id="7871263">)</span>&nbsp;<span class="ident" id="7871265">Read</span><span class="op" id="7871269">(</span><span class="ident" id="7871270">b</span>&nbsp;<span class="op" id="7871272">[</span><span class="op" id="7871273">]</span><span class="builtintype" id="7871274">byte</span><span class="op" id="7871278">)</span>&nbsp;<span class="op" id="7871280">(</span><span class="ident" id="7871281">n</span>&nbsp;<span class="builtintype" id="7871283">int</span><span class="op" id="7871286">,</span>&nbsp;<span class="ident" id="7871288">err</span>&nbsp;<span class="builtintype" id="7871292">error</span><span class="op" id="7871297">)</span>&nbsp;<span class="op" id="7871299">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871302">mr</span><span class="op" id="7871304">.</span><span class="ident" id="7871305">n</span>&nbsp;<span class="op" id="7871307">+=</span>&nbsp;<span class="builtinfunc" id="7871310">len</span><span class="op" id="7871313">(</span><span class="ident" id="7871314">b</span><span class="op" id="7871315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871318">if</span>&nbsp;<span class="ident" id="7871321">mr</span><span class="op" id="7871323">.</span><span class="ident" id="7871324">n</span>&nbsp;<span class="op" id="7871326">&gt;=</span>&nbsp;<span class="ident" id="7871329">maxReadThreshold</span>&nbsp;<span class="op" id="7871346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871350">mr</span><span class="op" id="7871352">.</span><span class="ident" id="7871353">t</span><span class="op" id="7871354">.</span><span class="ident" id="7871355">Fatal</span><span class="op" id="7871360">(</span><span class="string" id="7871361">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="7871380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871384">return</span>&nbsp;<span class="num" id="7871391">0</span><span class="op" id="7871392">,</span>&nbsp;<span class="ident" id="7871394">io</span><span class="op" id="7871396">.</span><span class="ident" id="7871397">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871402">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871405">return</span>&nbsp;<span class="builtinfunc" id="7871412">len</span><span class="op" id="7871415">(</span><span class="ident" id="7871416">b</span><span class="op" id="7871417">)</span><span class="op" id="7871418">,</span>&nbsp;<span class="ident" id="7871420">nil</span><br>
<span class="lineno"></span><span class="op" id="7871424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871427">func</span>&nbsp;<span class="ident" id="7871432">TestLineLimit</span><span class="op" id="7871445">(</span><span class="ident" id="7871446">t</span>&nbsp;<span class="op" id="7871448">*</span><span class="ident" id="7871449">testing</span><span class="op" id="7871456">.</span><span class="ident" id="7871457">T</span><span class="op" id="7871458">)</span>&nbsp;<span class="op" id="7871460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871463">mr</span>&nbsp;<span class="op" id="7871466">:=</span>&nbsp;<span class="op" id="7871469">&amp;</span><span class="ident" id="7871470">maliciousReader</span><span class="op" id="7871485">{</span><span class="ident" id="7871486">t</span><span class="op" id="7871487">:</span>&nbsp;<span class="ident" id="7871489">t</span><span class="op" id="7871490">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871493">r</span>&nbsp;<span class="op" id="7871495">:=</span>&nbsp;<span class="ident" id="7871498">NewReader</span><span class="op" id="7871507">(</span><span class="ident" id="7871508">mr</span><span class="op" id="7871510">,</span>&nbsp;<span class="string" id="7871512">&#34;fooBoundary&#34;</span><span class="op" id="7871525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871528">part</span><span class="op" id="7871532">,</span>&nbsp;<span class="ident" id="7871534">err</span>&nbsp;<span class="op" id="7871538">:=</span>&nbsp;<span class="ident" id="7871541">r</span><span class="op" id="7871542">.</span><span class="ident" id="7871543">NextPart</span><span class="op" id="7871551">(</span><span class="op" id="7871552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871555">if</span>&nbsp;<span class="ident" id="7871558">part</span>&nbsp;<span class="op" id="7871563">!=</span>&nbsp;<span class="ident" id="7871566">nil</span>&nbsp;<span class="op" id="7871570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871574">t</span><span class="op" id="7871575">.</span><span class="ident" id="7871576">Errorf</span><span class="op" id="7871582">(</span><span class="string" id="7871583">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="7871605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871608">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871611">if</span>&nbsp;<span class="ident" id="7871614">err</span>&nbsp;<span class="op" id="7871618">==</span>&nbsp;<span class="ident" id="7871621">nil</span>&nbsp;<span class="op" id="7871625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871629">t</span><span class="op" id="7871630">.</span><span class="ident" id="7871631">Errorf</span><span class="op" id="7871637">(</span><span class="string" id="7871638">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="7871657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871663">if</span>&nbsp;<span class="ident" id="7871666">mr</span><span class="op" id="7871668">.</span><span class="ident" id="7871669">n</span>&nbsp;<span class="op" id="7871671">&gt;=</span>&nbsp;<span class="ident" id="7871674">maxReadThreshold</span>&nbsp;<span class="op" id="7871691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871695">t</span><span class="op" id="7871696">.</span><span class="ident" id="7871697">Errorf</span><span class="op" id="7871703">(</span><span class="string" id="7871704">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7871742">,</span>&nbsp;<span class="ident" id="7871744">maxReadThreshold</span><span class="op" id="7871760">,</span>&nbsp;<span class="ident" id="7871762">mr</span><span class="op" id="7871764">.</span><span class="ident" id="7871765">n</span><span class="op" id="7871766">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871769">}</span><br>
<span class="lineno"></span><span class="op" id="7871771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871774">func</span>&nbsp;<span class="ident" id="7871779">TestMultipartTruncated</span><span class="op" id="7871801">(</span><span class="ident" id="7871802">t</span>&nbsp;<span class="op" id="7871804">*</span><span class="ident" id="7871805">testing</span><span class="op" id="7871812">.</span><span class="ident" id="7871813">T</span><span class="op" id="7871814">)</span>&nbsp;<span class="op" id="7871816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871819">testBody</span>&nbsp;<span class="op" id="7871828">:=</span>&nbsp;<span class="string" id="7871831">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871938">body</span>&nbsp;<span class="op" id="7871943">:=</span>&nbsp;<span class="ident" id="7871946">strings</span><span class="op" id="7871953">.</span><span class="ident" id="7871954">Replace</span><span class="op" id="7871961">(</span><span class="ident" id="7871962">testBody</span><span class="op" id="7871970">,</span>&nbsp;<span class="string" id="7871972">&#34;\n&#34;</span><span class="op" id="7871976">,</span>&nbsp;<span class="string" id="7871978">&#34;\r\n&#34;</span><span class="op" id="7871984">,</span>&nbsp;<span class="op" id="7871986">-</span><span class="num" id="7871987">1</span><span class="op" id="7871988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871991">bodyReader</span>&nbsp;<span class="op" id="7872002">:=</span>&nbsp;<span class="ident" id="7872005">strings</span><span class="op" id="7872012">.</span><span class="ident" id="7872013">NewReader</span><span class="op" id="7872022">(</span><span class="ident" id="7872023">body</span><span class="op" id="7872027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872030">r</span>&nbsp;<span class="op" id="7872032">:=</span>&nbsp;<span class="ident" id="7872035">NewReader</span><span class="op" id="7872044">(</span><span class="ident" id="7872045">bodyReader</span><span class="op" id="7872055">,</span>&nbsp;<span class="string" id="7872057">&#34;MyBoundary&#34;</span><span class="op" id="7872069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872073">part</span><span class="op" id="7872077">,</span>&nbsp;<span class="ident" id="7872079">err</span>&nbsp;<span class="op" id="7872083">:=</span>&nbsp;<span class="ident" id="7872086">r</span><span class="op" id="7872087">.</span><span class="ident" id="7872088">NextPart</span><span class="op" id="7872096">(</span><span class="op" id="7872097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872100">if</span>&nbsp;<span class="ident" id="7872103">err</span>&nbsp;<span class="op" id="7872107">!=</span>&nbsp;<span class="ident" id="7872110">nil</span>&nbsp;<span class="op" id="7872114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872118">t</span><span class="op" id="7872119">.</span><span class="ident" id="7872120">Fatalf</span><span class="op" id="7872126">(</span><span class="string" id="7872127">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7872146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872152">_</span><span class="op" id="7872153">,</span>&nbsp;<span class="ident" id="7872155">err</span>&nbsp;<span class="op" id="7872159">=</span>&nbsp;<span class="ident" id="7872161">io</span><span class="op" id="7872163">.</span><span class="ident" id="7872164">Copy</span><span class="op" id="7872168">(</span><span class="ident" id="7872169">ioutil</span><span class="op" id="7872175">.</span><span class="ident" id="7872176">Discard</span><span class="op" id="7872183">,</span>&nbsp;<span class="ident" id="7872185">part</span><span class="op" id="7872189">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872192">if</span>&nbsp;<span class="ident" id="7872195">err</span>&nbsp;<span class="op" id="7872199">!=</span>&nbsp;<span class="ident" id="7872202">io</span><span class="op" id="7872204">.</span><span class="ident" id="7872205">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7872222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872226">t</span><span class="op" id="7872227">.</span><span class="ident" id="7872228">Fatalf</span><span class="op" id="7872234">(</span><span class="string" id="7872235">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7872279">,</span>&nbsp;<span class="ident" id="7872281">err</span><span class="op" id="7872284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872287">}</span><br>
<span class="lineno"></span><span class="op" id="7872289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7872292">type</span>&nbsp;<span class="ident" id="7872297">slowReader</span>&nbsp;<span class="keyword" id="7872308">struct</span>&nbsp;<span class="op" id="7872315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872318">r</span>&nbsp;<span class="ident" id="7872320">io</span><span class="op" id="7872322">.</span><span class="ident" id="7872323">Reader</span><br>
<span class="lineno"></span><span class="op" id="7872330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7872333">func</span>&nbsp;<span class="op" id="7872338">(</span><span class="ident" id="7872339">s</span>&nbsp;<span class="op" id="7872341">*</span><span class="ident" id="7872342">slowReader</span><span class="op" id="7872352">)</span>&nbsp;<span class="ident" id="7872354">Read</span><span class="op" id="7872358">(</span><span class="ident" id="7872359">p</span>&nbsp;<span class="op" id="7872361">[</span><span class="op" id="7872362">]</span><span class="builtintype" id="7872363">byte</span><span class="op" id="7872367">)</span>&nbsp;<span class="op" id="7872369">(</span><span class="builtintype" id="7872370">int</span><span class="op" id="7872373">,</span>&nbsp;<span class="builtintype" id="7872375">error</span><span class="op" id="7872380">)</span>&nbsp;<span class="op" id="7872382">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872385">if</span>&nbsp;<span class="builtinfunc" id="7872388">len</span><span class="op" id="7872391">(</span><span class="ident" id="7872392">p</span><span class="op" id="7872393">)</span>&nbsp;<span class="op" id="7872395">==</span>&nbsp;<span class="num" id="7872398">0</span>&nbsp;<span class="op" id="7872400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872404">return</span>&nbsp;<span class="ident" id="7872411">s</span><span class="op" id="7872412">.</span><span class="ident" id="7872413">r</span><span class="op" id="7872414">.</span><span class="ident" id="7872415">Read</span><span class="op" id="7872419">(</span><span class="ident" id="7872420">p</span><span class="op" id="7872421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872427">return</span>&nbsp;<span class="ident" id="7872434">s</span><span class="op" id="7872435">.</span><span class="ident" id="7872436">r</span><span class="op" id="7872437">.</span><span class="ident" id="7872438">Read</span><span class="op" id="7872442">(</span><span class="ident" id="7872443">p</span><span class="op" id="7872444">[</span><span class="op" id="7872445">:</span><span class="num" id="7872446">1</span><span class="op" id="7872447">]</span><span class="op" id="7872448">)</span><br>
<span class="lineno"></span><span class="op" id="7872450">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7872453">func</span>&nbsp;<span class="ident" id="7872458">TestLineContinuation</span><span class="op" id="7872478">(</span><span class="ident" id="7872479">t</span>&nbsp;<span class="op" id="7872481">*</span><span class="ident" id="7872482">testing</span><span class="op" id="7872489">.</span><span class="ident" id="7872490">T</span><span class="op" id="7872491">)</span>&nbsp;<span class="op" id="7872493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872496">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872572">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872584">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872651">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872712">testBody</span>&nbsp;<span class="op" id="7872721">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7872726">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873222">r</span>&nbsp;<span class="op" id="7873224">:=</span>&nbsp;<span class="ident" id="7873227">NewReader</span><span class="op" id="7873236">(</span><span class="ident" id="7873237">strings</span><span class="op" id="7873244">.</span><span class="ident" id="7873245">NewReader</span><span class="op" id="7873254">(</span><span class="ident" id="7873255">testBody</span><span class="op" id="7873263">)</span><span class="op" id="7873264">,</span>&nbsp;<span class="string" id="7873266">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="7873290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873294">for</span>&nbsp;<span class="ident" id="7873298">i</span>&nbsp;<span class="op" id="7873300">:=</span>&nbsp;<span class="num" id="7873303">0</span><span class="op" id="7873304">;</span>&nbsp;<span class="ident" id="7873306">i</span>&nbsp;<span class="op" id="7873308">&lt;</span>&nbsp;<span class="num" id="7873310">2</span><span class="op" id="7873311">;</span>&nbsp;<span class="ident" id="7873313">i</span><span class="op" id="7873314">++</span>&nbsp;<span class="op" id="7873317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873321">part</span><span class="op" id="7873325">,</span>&nbsp;<span class="ident" id="7873327">err</span>&nbsp;<span class="op" id="7873331">:=</span>&nbsp;<span class="ident" id="7873334">r</span><span class="op" id="7873335">.</span><span class="ident" id="7873336">NextPart</span><span class="op" id="7873344">(</span><span class="op" id="7873345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873349">if</span>&nbsp;<span class="ident" id="7873352">err</span>&nbsp;<span class="op" id="7873356">!=</span>&nbsp;<span class="ident" id="7873359">nil</span>&nbsp;<span class="op" id="7873363">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873368">t</span><span class="op" id="7873369">.</span><span class="ident" id="7873370">Fatalf</span><span class="op" id="7873376">(</span><span class="string" id="7873377">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7873396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873404">var</span>&nbsp;<span class="ident" id="7873408">buf</span>&nbsp;<span class="ident" id="7873412">bytes</span><span class="op" id="7873417">.</span><span class="ident" id="7873418">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873427">n</span><span class="op" id="7873428">,</span>&nbsp;<span class="ident" id="7873430">err</span>&nbsp;<span class="op" id="7873434">:=</span>&nbsp;<span class="ident" id="7873437">io</span><span class="op" id="7873439">.</span><span class="ident" id="7873440">Copy</span><span class="op" id="7873444">(</span><span class="op" id="7873445">&amp;</span><span class="ident" id="7873446">buf</span><span class="op" id="7873449">,</span>&nbsp;<span class="ident" id="7873451">part</span><span class="op" id="7873455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873459">if</span>&nbsp;<span class="ident" id="7873462">err</span>&nbsp;<span class="op" id="7873466">!=</span>&nbsp;<span class="ident" id="7873469">nil</span>&nbsp;<span class="op" id="7873473">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873478">t</span><span class="op" id="7873479">.</span><span class="ident" id="7873480">Errorf</span><span class="op" id="7873486">(</span><span class="string" id="7873487">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="7873528">,</span>&nbsp;<span class="ident" id="7873530">err</span><span class="op" id="7873533">,</span>&nbsp;<span class="ident" id="7873535">buf</span><span class="op" id="7873538">.</span><span class="ident" id="7873539">String</span><span class="op" id="7873545">(</span><span class="op" id="7873546">)</span><span class="op" id="7873547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873555">if</span>&nbsp;<span class="ident" id="7873558">n</span>&nbsp;<span class="op" id="7873560">&lt;=</span>&nbsp;<span class="num" id="7873563">0</span>&nbsp;<span class="op" id="7873565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873570">t</span><span class="op" id="7873571">.</span><span class="ident" id="7873572">Errorf</span><span class="op" id="7873578">(</span><span class="string" id="7873579">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="7873607">,</span>&nbsp;<span class="ident" id="7873609">n</span><span class="op" id="7873610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873614">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873617">}</span><br>
<span class="lineno"></span><span class="op" id="7873619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7873622">func</span>&nbsp;<span class="ident" id="7873627">TestQuotedPrintableEncoding</span><span class="op" id="7873654">(</span><span class="ident" id="7873655">t</span>&nbsp;<span class="op" id="7873657">*</span><span class="ident" id="7873658">testing</span><span class="op" id="7873665">.</span><span class="ident" id="7873666">T</span><span class="op" id="7873667">)</span>&nbsp;<span class="op" id="7873669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873672">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873710">body</span>&nbsp;<span class="op" id="7873715">:=</span>&nbsp;<span class="string" id="7873718">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874452">r</span>&nbsp;<span class="op" id="7874454">:=</span>&nbsp;<span class="ident" id="7874457">NewReader</span><span class="op" id="7874466">(</span><span class="ident" id="7874467">strings</span><span class="op" id="7874474">.</span><span class="ident" id="7874475">NewReader</span><span class="op" id="7874484">(</span><span class="ident" id="7874485">body</span><span class="op" id="7874489">)</span><span class="op" id="7874490">,</span>&nbsp;<span class="string" id="7874492">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="7874522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874525">part</span><span class="op" id="7874529">,</span>&nbsp;<span class="ident" id="7874531">err</span>&nbsp;<span class="op" id="7874535">:=</span>&nbsp;<span class="ident" id="7874538">r</span><span class="op" id="7874539">.</span><span class="ident" id="7874540">NextPart</span><span class="op" id="7874548">(</span><span class="op" id="7874549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874552">if</span>&nbsp;<span class="ident" id="7874555">err</span>&nbsp;<span class="op" id="7874559">!=</span>&nbsp;<span class="ident" id="7874562">nil</span>&nbsp;<span class="op" id="7874566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874570">t</span><span class="op" id="7874571">.</span><span class="ident" id="7874572">Fatal</span><span class="op" id="7874577">(</span><span class="ident" id="7874578">err</span><span class="op" id="7874581">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874587">if</span>&nbsp;<span class="ident" id="7874590">te</span><span class="op" id="7874592">,</span>&nbsp;<span class="ident" id="7874594">ok</span>&nbsp;<span class="op" id="7874597">:=</span>&nbsp;<span class="ident" id="7874600">part</span><span class="op" id="7874604">.</span><span class="ident" id="7874605">Header</span><span class="op" id="7874611">[</span><span class="string" id="7874612">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="7874639">]</span><span class="op" id="7874640">;</span>&nbsp;<span class="ident" id="7874642">ok</span>&nbsp;<span class="op" id="7874645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874649">t</span><span class="op" id="7874650">.</span><span class="ident" id="7874651">Errorf</span><span class="op" id="7874657">(</span><span class="string" id="7874658">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7874702">,</span>&nbsp;<span class="ident" id="7874704">te</span><span class="op" id="7874706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874712">var</span>&nbsp;<span class="ident" id="7874716">buf</span>&nbsp;<span class="ident" id="7874720">bytes</span><span class="op" id="7874725">.</span><span class="ident" id="7874726">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874734">_</span><span class="op" id="7874735">,</span>&nbsp;<span class="ident" id="7874737">err</span>&nbsp;<span class="op" id="7874741">=</span>&nbsp;<span class="ident" id="7874743">io</span><span class="op" id="7874745">.</span><span class="ident" id="7874746">Copy</span><span class="op" id="7874750">(</span><span class="op" id="7874751">&amp;</span><span class="ident" id="7874752">buf</span><span class="op" id="7874755">,</span>&nbsp;<span class="ident" id="7874757">part</span><span class="op" id="7874761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874764">if</span>&nbsp;<span class="ident" id="7874767">err</span>&nbsp;<span class="op" id="7874771">!=</span>&nbsp;<span class="ident" id="7874774">nil</span>&nbsp;<span class="op" id="7874778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874782">t</span><span class="op" id="7874783">.</span><span class="ident" id="7874784">Error</span><span class="op" id="7874789">(</span><span class="ident" id="7874790">err</span><span class="op" id="7874793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874799">got</span>&nbsp;<span class="op" id="7874803">:=</span>&nbsp;<span class="ident" id="7874806">buf</span><span class="op" id="7874809">.</span><span class="ident" id="7874810">String</span><span class="op" id="7874816">(</span><span class="op" id="7874817">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874820">want</span>&nbsp;<span class="op" id="7874825">:=</span>&nbsp;<span class="string" id="7874828">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875185">if</span>&nbsp;<span class="ident" id="7875188">got</span>&nbsp;<span class="op" id="7875192">!=</span>&nbsp;<span class="ident" id="7875195">want</span>&nbsp;<span class="op" id="7875200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875204">t</span><span class="op" id="7875205">.</span><span class="ident" id="7875206">Errorf</span><span class="op" id="7875212">(</span><span class="string" id="7875213">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="7875252">,</span>&nbsp;<span class="ident" id="7875254">got</span><span class="op" id="7875257">,</span>&nbsp;<span class="ident" id="7875259">want</span><span class="op" id="7875263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875266">}</span><br>
<span class="lineno"></span><span class="op" id="7875268">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="7875271">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="7875344">func</span>&nbsp;<span class="ident" id="7875349">TestNested</span><span class="op" id="7875359">(</span><span class="ident" id="7875360">t</span>&nbsp;<span class="op" id="7875362">*</span><span class="ident" id="7875363">testing</span><span class="op" id="7875370">.</span><span class="ident" id="7875371">T</span><span class="op" id="7875372">)</span>&nbsp;<span class="op" id="7875374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875377">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875437">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875484">f</span><span class="op" id="7875485">,</span>&nbsp;<span class="ident" id="7875487">err</span>&nbsp;<span class="op" id="7875491">:=</span>&nbsp;<span class="ident" id="7875494">os</span><span class="op" id="7875496">.</span><span class="ident" id="7875497">Open</span><span class="op" id="7875501">(</span><span class="string" id="7875502">&#34;testdata/nested-mime&#34;</span><span class="op" id="7875524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875527">if</span>&nbsp;<span class="ident" id="7875530">err</span>&nbsp;<span class="op" id="7875534">!=</span>&nbsp;<span class="ident" id="7875537">nil</span>&nbsp;<span class="op" id="7875541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875545">t</span><span class="op" id="7875546">.</span><span class="ident" id="7875547">Fatal</span><span class="op" id="7875552">(</span><span class="ident" id="7875553">err</span><span class="op" id="7875556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875562">defer</span>&nbsp;<span class="ident" id="7875568">f</span><span class="op" id="7875569">.</span><span class="ident" id="7875570">Close</span><span class="op" id="7875575">(</span><span class="op" id="7875576">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875579">mr</span>&nbsp;<span class="op" id="7875582">:=</span>&nbsp;<span class="ident" id="7875585">NewReader</span><span class="op" id="7875594">(</span><span class="ident" id="7875595">f</span><span class="op" id="7875596">,</span>&nbsp;<span class="string" id="7875598">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="7875628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875631">p</span><span class="op" id="7875632">,</span>&nbsp;<span class="ident" id="7875634">err</span>&nbsp;<span class="op" id="7875638">:=</span>&nbsp;<span class="ident" id="7875641">mr</span><span class="op" id="7875643">.</span><span class="ident" id="7875644">NextPart</span><span class="op" id="7875652">(</span><span class="op" id="7875653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875656">if</span>&nbsp;<span class="ident" id="7875659">err</span>&nbsp;<span class="op" id="7875663">!=</span>&nbsp;<span class="ident" id="7875666">nil</span>&nbsp;<span class="op" id="7875670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875674">t</span><span class="op" id="7875675">.</span><span class="ident" id="7875676">Fatalf</span><span class="op" id="7875682">(</span><span class="string" id="7875683">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="7875730">,</span>&nbsp;<span class="ident" id="7875732">err</span><span class="op" id="7875735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875738">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7875742">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875825">mr2</span>&nbsp;<span class="op" id="7875829">:=</span>&nbsp;<span class="ident" id="7875832">NewReader</span><span class="op" id="7875841">(</span><span class="ident" id="7875842">p</span><span class="op" id="7875843">,</span>&nbsp;<span class="string" id="7875845">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="7875875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875878">p</span><span class="op" id="7875879">,</span>&nbsp;<span class="ident" id="7875881">err</span>&nbsp;<span class="op" id="7875885">=</span>&nbsp;<span class="ident" id="7875887">mr2</span><span class="op" id="7875890">.</span><span class="ident" id="7875891">NextPart</span><span class="op" id="7875899">(</span><span class="op" id="7875900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875903">if</span>&nbsp;<span class="ident" id="7875906">err</span>&nbsp;<span class="op" id="7875910">!=</span>&nbsp;<span class="ident" id="7875913">nil</span>&nbsp;<span class="op" id="7875917">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875921">t</span><span class="op" id="7875922">.</span><span class="ident" id="7875923">Fatalf</span><span class="op" id="7875929">(</span><span class="string" id="7875930">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7875959">,</span>&nbsp;<span class="ident" id="7875961">err</span><span class="op" id="7875964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875970">if</span>&nbsp;<span class="ident" id="7875973">b</span><span class="op" id="7875974">,</span>&nbsp;<span class="ident" id="7875976">err</span>&nbsp;<span class="op" id="7875980">:=</span>&nbsp;<span class="ident" id="7875983">ioutil</span><span class="op" id="7875989">.</span><span class="ident" id="7875990">ReadAll</span><span class="op" id="7875997">(</span><span class="ident" id="7875998">p</span><span class="op" id="7875999">)</span><span class="op" id="7876000">;</span>&nbsp;<span class="builtintype" id="7876002">string</span><span class="op" id="7876008">(</span><span class="ident" id="7876009">b</span><span class="op" id="7876010">)</span>&nbsp;<span class="op" id="7876012">!=</span>&nbsp;<span class="string" id="7876015">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="7876028">||</span>&nbsp;<span class="ident" id="7876031">err</span>&nbsp;<span class="op" id="7876035">!=</span>&nbsp;<span class="ident" id="7876038">nil</span>&nbsp;<span class="op" id="7876042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876046">t</span><span class="op" id="7876047">.</span><span class="ident" id="7876048">Fatalf</span><span class="op" id="7876054">(</span><span class="string" id="7876055">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7876092">,</span>&nbsp;<span class="ident" id="7876094">b</span><span class="op" id="7876095">,</span>&nbsp;<span class="ident" id="7876097">err</span><span class="op" id="7876100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876103">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876106">p</span><span class="op" id="7876107">,</span>&nbsp;<span class="ident" id="7876109">err</span>&nbsp;<span class="op" id="7876113">=</span>&nbsp;<span class="ident" id="7876115">mr2</span><span class="op" id="7876118">.</span><span class="ident" id="7876119">NextPart</span><span class="op" id="7876127">(</span><span class="op" id="7876128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876131">if</span>&nbsp;<span class="ident" id="7876134">err</span>&nbsp;<span class="op" id="7876138">!=</span>&nbsp;<span class="ident" id="7876141">nil</span>&nbsp;<span class="op" id="7876145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876149">t</span><span class="op" id="7876150">.</span><span class="ident" id="7876151">Fatalf</span><span class="op" id="7876157">(</span><span class="string" id="7876158">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7876186">,</span>&nbsp;<span class="ident" id="7876188">err</span><span class="op" id="7876191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876197">if</span>&nbsp;<span class="ident" id="7876200">b</span><span class="op" id="7876201">,</span>&nbsp;<span class="ident" id="7876203">err</span>&nbsp;<span class="op" id="7876207">:=</span>&nbsp;<span class="ident" id="7876210">ioutil</span><span class="op" id="7876216">.</span><span class="ident" id="7876217">ReadAll</span><span class="op" id="7876224">(</span><span class="ident" id="7876225">p</span><span class="op" id="7876226">)</span><span class="op" id="7876227">;</span>&nbsp;<span class="builtintype" id="7876229">string</span><span class="op" id="7876235">(</span><span class="ident" id="7876236">b</span><span class="op" id="7876237">)</span>&nbsp;<span class="op" id="7876239">!=</span>&nbsp;<span class="string" id="7876242">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="7876260">||</span>&nbsp;<span class="ident" id="7876263">err</span>&nbsp;<span class="op" id="7876267">!=</span>&nbsp;<span class="ident" id="7876270">nil</span>&nbsp;<span class="op" id="7876274">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876278">t</span><span class="op" id="7876279">.</span><span class="ident" id="7876280">Fatalf</span><span class="op" id="7876286">(</span><span class="string" id="7876287">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7876323">,</span>&nbsp;<span class="ident" id="7876325">b</span><span class="op" id="7876326">,</span>&nbsp;<span class="ident" id="7876328">err</span><span class="op" id="7876331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876338">p</span><span class="op" id="7876339">,</span>&nbsp;<span class="ident" id="7876341">err</span>&nbsp;<span class="op" id="7876345">=</span>&nbsp;<span class="ident" id="7876347">mr2</span><span class="op" id="7876350">.</span><span class="ident" id="7876351">NextPart</span><span class="op" id="7876359">(</span><span class="op" id="7876360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876363">if</span>&nbsp;<span class="ident" id="7876366">err</span>&nbsp;<span class="op" id="7876370">!=</span>&nbsp;<span class="ident" id="7876373">io</span><span class="op" id="7876375">.</span><span class="ident" id="7876376">EOF</span>&nbsp;<span class="op" id="7876380">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876384">t</span><span class="op" id="7876385">.</span><span class="ident" id="7876386">Fatalf</span><span class="op" id="7876392">(</span><span class="string" id="7876393">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7876433">,</span>&nbsp;<span class="ident" id="7876435">err</span><span class="op" id="7876438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7876445">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876514">_</span><span class="op" id="7876515">,</span>&nbsp;<span class="ident" id="7876517">err</span>&nbsp;<span class="op" id="7876521">=</span>&nbsp;<span class="ident" id="7876523">mr</span><span class="op" id="7876525">.</span><span class="ident" id="7876526">NextPart</span><span class="op" id="7876534">(</span><span class="op" id="7876535">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876538">if</span>&nbsp;<span class="ident" id="7876541">err</span>&nbsp;<span class="op" id="7876545">!=</span>&nbsp;<span class="ident" id="7876548">nil</span>&nbsp;<span class="op" id="7876552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876556">t</span><span class="op" id="7876557">.</span><span class="ident" id="7876558">Fatalf</span><span class="op" id="7876564">(</span><span class="string" id="7876565">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="7876616">,</span>&nbsp;<span class="ident" id="7876618">err</span><span class="op" id="7876621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876628">_</span><span class="op" id="7876629">,</span>&nbsp;<span class="ident" id="7876631">err</span>&nbsp;<span class="op" id="7876635">=</span>&nbsp;<span class="ident" id="7876637">mr</span><span class="op" id="7876639">.</span><span class="ident" id="7876640">NextPart</span><span class="op" id="7876648">(</span><span class="op" id="7876649">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876652">if</span>&nbsp;<span class="ident" id="7876655">err</span>&nbsp;<span class="op" id="7876659">!=</span>&nbsp;<span class="ident" id="7876662">io</span><span class="op" id="7876664">.</span><span class="ident" id="7876665">EOF</span>&nbsp;<span class="op" id="7876669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876673">t</span><span class="op" id="7876674">.</span><span class="ident" id="7876675">Fatalf</span><span class="op" id="7876681">(</span><span class="string" id="7876682">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7876722">,</span>&nbsp;<span class="ident" id="7876724">err</span><span class="op" id="7876727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7876730">}</span><br>
<span class="lineno"></span><span class="op" id="7876732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="7876735">type</span>&nbsp;<span class="ident" id="7876740">headerBody</span>&nbsp;<span class="keyword" id="7876751">struct</span>&nbsp;<span class="op" id="7876758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876761">header</span>&nbsp;<span class="ident" id="7876768">textproto</span><span class="op" id="7876777">.</span><span class="ident" id="7876778">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876790">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7876797">string</span><br>
<span class="lineno"></span><span class="op" id="7876804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7876807">func</span>&nbsp;<span class="ident" id="7876812">formData</span><span class="op" id="7876820">(</span><span class="ident" id="7876821">key</span><span class="op" id="7876824">,</span>&nbsp;<span class="ident" id="7876826">value</span>&nbsp;<span class="builtintype" id="7876832">string</span><span class="op" id="7876838">)</span>&nbsp;<span class="ident" id="7876840">headerBody</span>&nbsp;<span class="op" id="7876851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7876854">return</span>&nbsp;<span class="ident" id="7876861">headerBody</span><span class="op" id="7876871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7876875">textproto</span><span class="op" id="7876884">.</span><span class="ident" id="7876885">MIMEHeader</span><span class="op" id="7876895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7876900">&#34;Content-Type&#34;</span><span class="op" id="7876914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7876923">{</span><span class="string" id="7876924">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="7876956">}</span><span class="op" id="7876957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7876962">&#34;Content-Disposition&#34;</span><span class="op" id="7876983">:</span>&nbsp;<span class="op" id="7876985">{</span><span class="string" id="7876986">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="7877005">+</span>&nbsp;<span class="ident" id="7877007">key</span><span class="op" id="7877010">}</span><span class="op" id="7877011">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7877015">}</span><span class="op" id="7877016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877020">value</span><span class="op" id="7877025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7877028">}</span><br>
<span class="lineno"></span><span class="op" id="7877030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="7877033">type</span>&nbsp;<span class="ident" id="7877038">parseTest</span>&nbsp;<span class="keyword" id="7877048">struct</span>&nbsp;<span class="op" id="7877055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877058">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7877066">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877074">in</span><span class="op" id="7877076">,</span>&nbsp;<span class="ident" id="7877078">sep</span>&nbsp;<span class="builtintype" id="7877082">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877090">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7877098">[</span><span class="op" id="7877099">]</span><span class="ident" id="7877100">headerBody</span><br>
<span class="lineno"></span><span class="op" id="7877111">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7877114">var</span>&nbsp;<span class="ident" id="7877118">parseTests</span>&nbsp;<span class="op" id="7877129">=</span>&nbsp;<span class="op" id="7877131">[</span><span class="op" id="7877132">]</span><span class="ident" id="7877133">parseTest</span><span class="op" id="7877142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877145">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877215">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877284">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877350">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877413">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7877479">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7877542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877546">name</span><span class="op" id="7877550">:</span>&nbsp;<span class="string" id="7877552">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="7877569">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877573">sep</span><span class="op" id="7877576">:</span>&nbsp;&nbsp;<span class="string" id="7877579">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="7877609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7877613">in</span><span class="op" id="7877615">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7877619">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="7879527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879531">want</span><span class="op" id="7879535">:</span>&nbsp;<span class="op" id="7879537">[</span><span class="op" id="7879538">]</span><span class="ident" id="7879539">headerBody</span><span class="op" id="7879549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879554">formData</span><span class="op" id="7879562">(</span><span class="string" id="7879563">&#34;otherEmpty1&#34;</span><span class="op" id="7879576">,</span>&nbsp;<span class="string" id="7879578">&#34;&#34;</span><span class="op" id="7879580">)</span><span class="op" id="7879581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879586">formData</span><span class="op" id="7879594">(</span><span class="string" id="7879595">&#34;otherFoo1&#34;</span><span class="op" id="7879606">,</span>&nbsp;<span class="string" id="7879608">&#34;foo&#34;</span><span class="op" id="7879613">)</span><span class="op" id="7879614">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879619">formData</span><span class="op" id="7879627">(</span><span class="string" id="7879628">&#34;otherFoo2&#34;</span><span class="op" id="7879639">,</span>&nbsp;<span class="string" id="7879641">&#34;foo&#34;</span><span class="op" id="7879646">)</span><span class="op" id="7879647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879652">formData</span><span class="op" id="7879660">(</span><span class="string" id="7879661">&#34;otherEmpty2&#34;</span><span class="op" id="7879674">,</span>&nbsp;<span class="string" id="7879676">&#34;&#34;</span><span class="op" id="7879678">)</span><span class="op" id="7879679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879684">formData</span><span class="op" id="7879692">(</span><span class="string" id="7879693">&#34;otherRepeatFoo&#34;</span><span class="op" id="7879709">,</span>&nbsp;<span class="string" id="7879711">&#34;foo&#34;</span><span class="op" id="7879716">)</span><span class="op" id="7879717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879722">formData</span><span class="op" id="7879730">(</span><span class="string" id="7879731">&#34;otherRepeatFoo&#34;</span><span class="op" id="7879747">,</span>&nbsp;<span class="string" id="7879749">&#34;foo&#34;</span><span class="op" id="7879754">)</span><span class="op" id="7879755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879760">formData</span><span class="op" id="7879768">(</span><span class="string" id="7879769">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7879787">,</span>&nbsp;<span class="string" id="7879789">&#34;&#34;</span><span class="op" id="7879791">)</span><span class="op" id="7879792">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879797">formData</span><span class="op" id="7879805">(</span><span class="string" id="7879806">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7879824">,</span>&nbsp;<span class="string" id="7879826">&#34;&#34;</span><span class="op" id="7879828">)</span><span class="op" id="7879829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7879834">formData</span><span class="op" id="7879842">(</span><span class="string" id="7879843">&#34;submit&#34;</span><span class="op" id="7879851">,</span>&nbsp;<span class="string" id="7879853">&#34;Submit&#34;</span><span class="op" id="7879861">)</span><span class="op" id="7879862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7879867">{</span><span class="ident" id="7879868">textproto</span><span class="op" id="7879877">.</span><span class="ident" id="7879878">MIMEHeader</span><span class="op" id="7879888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7879894">&#34;Content-Type&#34;</span><span class="op" id="7879908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7879917">{</span><span class="string" id="7879918">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="7880134">}</span><span class="op" id="7880135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7880141">&#34;Content-Disposition&#34;</span><span class="op" id="7880162">:</span>&nbsp;<span class="op" id="7880164">{</span><span class="string" id="7880165">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="7880210">}</span><span class="op" id="7880211">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880216">}</span><span class="op" id="7880217">,</span>&nbsp;<span class="string" id="7880219">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="7880466">}</span><span class="op" id="7880467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880471">}</span><span class="op" id="7880472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880475">}</span><span class="op" id="7880476">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880480">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880556">name</span><span class="op" id="7880560">:</span>&nbsp;<span class="string" id="7880562">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="7880593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880597">sep</span><span class="op" id="7880600">:</span>&nbsp;&nbsp;<span class="string" id="7880603">&#34;abc&#34;</span><span class="op" id="7880608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880612">in</span><span class="op" id="7880614">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880618">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="7880652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880656">want</span><span class="op" id="7880660">:</span>&nbsp;<span class="op" id="7880662">[</span><span class="op" id="7880663">]</span><span class="ident" id="7880664">headerBody</span><span class="op" id="7880674">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880679">{</span><span class="ident" id="7880680">textproto</span><span class="op" id="7880689">.</span><span class="ident" id="7880690">MIMEHeader</span><span class="op" id="7880700">{</span><span class="string" id="7880701">&#34;Foo&#34;</span><span class="op" id="7880706">:</span>&nbsp;<span class="op" id="7880708">{</span><span class="string" id="7880709">&#34;bar&#34;</span><span class="op" id="7880714">}</span><span class="op" id="7880715">}</span><span class="op" id="7880716">,</span>&nbsp;<span class="string" id="7880718">&#34;&#34;</span><span class="op" id="7880720">}</span><span class="op" id="7880721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880725">}</span><span class="op" id="7880726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880729">}</span><span class="op" id="7880730">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7880734">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880814">name</span><span class="op" id="7880818">:</span>&nbsp;<span class="string" id="7880820">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="7880855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880859">sep</span><span class="op" id="7880862">:</span>&nbsp;&nbsp;<span class="string" id="7880865">&#34;abc&#34;</span><span class="op" id="7880870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880874">in</span><span class="op" id="7880876">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7880880">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="7880918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7880922">want</span><span class="op" id="7880926">:</span>&nbsp;<span class="op" id="7880928">[</span><span class="op" id="7880929">]</span><span class="ident" id="7880930">headerBody</span><span class="op" id="7880940">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880945">{</span><span class="ident" id="7880946">textproto</span><span class="op" id="7880955">.</span><span class="ident" id="7880956">MIMEHeader</span><span class="op" id="7880966">{</span><span class="string" id="7880967">&#34;Foo&#34;</span><span class="op" id="7880972">:</span>&nbsp;<span class="op" id="7880974">{</span><span class="string" id="7880975">&#34;bar&#34;</span><span class="op" id="7880980">}</span><span class="op" id="7880981">}</span><span class="op" id="7880982">,</span>&nbsp;<span class="string" id="7880984">&#34;&#34;</span><span class="op" id="7880986">}</span><span class="op" id="7880987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880991">}</span><span class="op" id="7880992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7880995">}</span><span class="op" id="7880996">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881000">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881026">name</span><span class="op" id="7881030">:</span>&nbsp;<span class="string" id="7881032">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="7881050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881054">sep</span><span class="op" id="7881057">:</span>&nbsp;&nbsp;<span class="string" id="7881060">&#34;abc&#34;</span><span class="op" id="7881065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881069">in</span><span class="op" id="7881071">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7881075">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="7881136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881140">want</span><span class="op" id="7881144">:</span>&nbsp;<span class="op" id="7881146">[</span><span class="op" id="7881147">]</span><span class="ident" id="7881148">headerBody</span><span class="op" id="7881158">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881163">{</span><span class="ident" id="7881164">textproto</span><span class="op" id="7881173">.</span><span class="ident" id="7881174">MIMEHeader</span><span class="op" id="7881184">{</span><span class="string" id="7881185">&#34;Foo&#34;</span><span class="op" id="7881190">:</span>&nbsp;<span class="op" id="7881192">{</span><span class="string" id="7881193">&#34;bar&#34;</span><span class="op" id="7881198">}</span><span class="op" id="7881199">}</span><span class="op" id="7881200">,</span>&nbsp;<span class="string" id="7881202">&#34;&#34;</span><span class="op" id="7881204">}</span><span class="op" id="7881205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881210">{</span><span class="ident" id="7881211">textproto</span><span class="op" id="7881220">.</span><span class="ident" id="7881221">MIMEHeader</span><span class="op" id="7881231">{</span><span class="string" id="7881232">&#34;Foo2&#34;</span><span class="op" id="7881238">:</span>&nbsp;<span class="op" id="7881240">{</span><span class="string" id="7881241">&#34;bar2&#34;</span><span class="op" id="7881247">}</span><span class="op" id="7881248">}</span><span class="op" id="7881249">,</span>&nbsp;<span class="string" id="7881251">&#34;&#34;</span><span class="op" id="7881253">}</span><span class="op" id="7881254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881258">}</span><span class="op" id="7881259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881262">}</span><span class="op" id="7881263">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881267">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881329">name</span><span class="op" id="7881333">:</span>&nbsp;<span class="string" id="7881335">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="7881363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881367">sep</span><span class="op" id="7881370">:</span>&nbsp;&nbsp;<span class="string" id="7881373">&#34;abc&#34;</span><span class="op" id="7881378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881382">in</span><span class="op" id="7881384">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7881388">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="7881426">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881430">want</span><span class="op" id="7881434">:</span>&nbsp;<span class="op" id="7881436">[</span><span class="op" id="7881437">]</span><span class="ident" id="7881438">headerBody</span><span class="op" id="7881448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881453">{</span><span class="ident" id="7881454">textproto</span><span class="op" id="7881463">.</span><span class="ident" id="7881464">MIMEHeader</span><span class="op" id="7881474">{</span><span class="string" id="7881475">&#34;Foo&#34;</span><span class="op" id="7881480">:</span>&nbsp;<span class="op" id="7881482">{</span><span class="string" id="7881483">&#34;bar&#34;</span><span class="op" id="7881488">}</span><span class="op" id="7881489">}</span><span class="op" id="7881490">,</span>&nbsp;<span class="string" id="7881492">&#34;&#34;</span><span class="op" id="7881494">}</span><span class="op" id="7881495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881499">}</span><span class="op" id="7881500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881503">}</span><span class="op" id="7881504">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881508">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881572">name</span><span class="op" id="7881576">:</span>&nbsp;<span class="string" id="7881578">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="7881606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881610">sep</span><span class="op" id="7881613">:</span>&nbsp;&nbsp;<span class="string" id="7881616">&#34;abc&#34;</span><span class="op" id="7881621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881625">in</span><span class="op" id="7881627">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7881631">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="7881668">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881672">want</span><span class="op" id="7881676">:</span>&nbsp;<span class="op" id="7881678">[</span><span class="op" id="7881679">]</span><span class="ident" id="7881680">headerBody</span><span class="op" id="7881690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881695">{</span><span class="ident" id="7881696">textproto</span><span class="op" id="7881705">.</span><span class="ident" id="7881706">MIMEHeader</span><span class="op" id="7881716">{</span><span class="string" id="7881717">&#34;Foo&#34;</span><span class="op" id="7881722">:</span>&nbsp;<span class="op" id="7881724">{</span><span class="string" id="7881725">&#34;bar&#34;</span><span class="op" id="7881730">}</span><span class="op" id="7881731">}</span><span class="op" id="7881732">,</span>&nbsp;<span class="string" id="7881734">&#34;&#34;</span><span class="op" id="7881736">}</span><span class="op" id="7881737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881741">}</span><span class="op" id="7881742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881745">}</span><span class="op" id="7881746">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881750">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881803">name</span><span class="op" id="7881807">:</span>&nbsp;<span class="string" id="7881809">&#34;no&nbsp;parts&#34;</span><span class="op" id="7881819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881823">sep</span><span class="op" id="7881826">:</span>&nbsp;&nbsp;<span class="string" id="7881829">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="7881869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881873">in</span><span class="op" id="7881875">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7881879">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="7881927">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7881931">want</span><span class="op" id="7881935">:</span>&nbsp;<span class="op" id="7881937">[</span><span class="op" id="7881938">]</span><span class="ident" id="7881939">headerBody</span><span class="op" id="7881949">{</span><span class="op" id="7881950">}</span><span class="op" id="7881951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7881954">}</span><span class="op" id="7881955">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7881959">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882040">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882044">name</span><span class="op" id="7882048">:</span>&nbsp;<span class="string" id="7882050">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="7882074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882078">sep</span><span class="op" id="7882081">:</span>&nbsp;&nbsp;<span class="string" id="7882084">&#34;sep&#34;</span><span class="op" id="7882089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882093">in</span><span class="op" id="7882095">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7882099">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="7882146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882150">want</span><span class="op" id="7882154">:</span>&nbsp;<span class="op" id="7882156">[</span><span class="op" id="7882157">]</span><span class="ident" id="7882158">headerBody</span><span class="op" id="7882168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882173">{</span><span class="ident" id="7882174">textproto</span><span class="op" id="7882183">.</span><span class="ident" id="7882184">MIMEHeader</span><span class="op" id="7882194">{</span><span class="string" id="7882195">&#34;Foo&#34;</span><span class="op" id="7882200">:</span>&nbsp;<span class="op" id="7882202">{</span><span class="string" id="7882203">&#34;bar&#34;</span><span class="op" id="7882208">}</span><span class="op" id="7882209">}</span><span class="op" id="7882210">,</span>&nbsp;<span class="string" id="7882212">&#34;--sepFAKE&#34;</span><span class="op" id="7882223">}</span><span class="op" id="7882224">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882228">}</span><span class="op" id="7882229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882232">}</span><span class="op" id="7882233">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7882237">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882298">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882302">name</span><span class="op" id="7882306">:</span>&nbsp;<span class="string" id="7882308">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="7882334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882338">sep</span><span class="op" id="7882341">:</span>&nbsp;&nbsp;<span class="string" id="7882344">&#34;sep&#34;</span><span class="op" id="7882349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882353">in</span><span class="op" id="7882355">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7882359">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="7882402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882406">want</span><span class="op" id="7882410">:</span>&nbsp;<span class="op" id="7882412">[</span><span class="op" id="7882413">]</span><span class="ident" id="7882414">headerBody</span><span class="op" id="7882424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882429">{</span><span class="ident" id="7882430">textproto</span><span class="op" id="7882439">.</span><span class="ident" id="7882440">MIMEHeader</span><span class="op" id="7882450">{</span><span class="string" id="7882451">&#34;Foo&#34;</span><span class="op" id="7882456">:</span>&nbsp;<span class="op" id="7882458">{</span><span class="string" id="7882459">&#34;bar&#34;</span><span class="op" id="7882464">}</span><span class="op" id="7882465">}</span><span class="op" id="7882466">,</span>&nbsp;<span class="string" id="7882468">&#34;text&#34;</span><span class="op" id="7882474">}</span><span class="op" id="7882475">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882479">}</span><span class="op" id="7882480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882483">}</span><span class="op" id="7882484">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7882488">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882519">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882523">name</span><span class="op" id="7882527">:</span>&nbsp;<span class="string" id="7882529">&#34;leading&nbsp;line&#34;</span><span class="op" id="7882543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882547">sep</span><span class="op" id="7882550">:</span>&nbsp;&nbsp;<span class="string" id="7882553">&#34;MyBoundary&#34;</span><span class="op" id="7882565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882569">in</span><span class="op" id="7882571">:</span>&nbsp;<span class="ident" id="7882573">strings</span><span class="op" id="7882580">.</span><span class="ident" id="7882581">Replace</span><span class="op" id="7882588">(</span><span class="string" id="7882589">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="7882682">,</span>&nbsp;<span class="string" id="7882684">&#34;\n&#34;</span><span class="op" id="7882688">,</span>&nbsp;<span class="string" id="7882690">&#34;\r\n&#34;</span><span class="op" id="7882696">,</span>&nbsp;<span class="op" id="7882698">-</span><span class="num" id="7882699">1</span><span class="op" id="7882700">)</span><span class="op" id="7882701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882705">want</span><span class="op" id="7882709">:</span>&nbsp;<span class="op" id="7882711">[</span><span class="op" id="7882712">]</span><span class="ident" id="7882713">headerBody</span><span class="op" id="7882723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882728">{</span><span class="ident" id="7882729">textproto</span><span class="op" id="7882738">.</span><span class="ident" id="7882739">MIMEHeader</span><span class="op" id="7882749">{</span><span class="string" id="7882750">&#34;Foo&#34;</span><span class="op" id="7882755">:</span>&nbsp;<span class="op" id="7882757">{</span><span class="string" id="7882758">&#34;bar&#34;</span><span class="op" id="7882763">}</span><span class="op" id="7882764">}</span><span class="op" id="7882765">,</span>&nbsp;<span class="string" id="7882767">&#34;&#34;</span><span class="op" id="7882769">}</span><span class="op" id="7882770">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882774">}</span><span class="op" id="7882775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7882778">}</span><span class="op" id="7882779">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882783">roundTripParseTest</span><span class="op" id="7882801">(</span><span class="op" id="7882802">)</span><span class="op" id="7882803">,</span><br>
<span class="lineno"></span><span class="op" id="7882805">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="7882808">func</span>&nbsp;<span class="ident" id="7882813">TestParse</span><span class="op" id="7882822">(</span><span class="ident" id="7882823">t</span>&nbsp;<span class="op" id="7882825">*</span><span class="ident" id="7882826">testing</span><span class="op" id="7882833">.</span><span class="ident" id="7882834">T</span><span class="op" id="7882835">)</span>&nbsp;<span class="op" id="7882837">{</span><br>
<span class="lineno"></span><span class="ident" id="7882839">Cases</span><span class="op" id="7882844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882847">for</span>&nbsp;<span class="ident" id="7882851">_</span><span class="op" id="7882852">,</span>&nbsp;<span class="ident" id="7882854">tt</span>&nbsp;<span class="op" id="7882857">:=</span>&nbsp;<span class="keyword" id="7882860">range</span>&nbsp;<span class="ident" id="7882866">parseTests</span>&nbsp;<span class="op" id="7882877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882881">r</span>&nbsp;<span class="op" id="7882883">:=</span>&nbsp;<span class="ident" id="7882886">NewReader</span><span class="op" id="7882895">(</span><span class="ident" id="7882896">strings</span><span class="op" id="7882903">.</span><span class="ident" id="7882904">NewReader</span><span class="op" id="7882913">(</span><span class="ident" id="7882914">tt</span><span class="op" id="7882916">.</span><span class="ident" id="7882917">in</span><span class="op" id="7882919">)</span><span class="op" id="7882920">,</span>&nbsp;<span class="ident" id="7882922">tt</span><span class="op" id="7882924">.</span><span class="ident" id="7882925">sep</span><span class="op" id="7882928">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882932">got</span>&nbsp;<span class="op" id="7882936">:=</span>&nbsp;<span class="op" id="7882939">[</span><span class="op" id="7882940">]</span><span class="ident" id="7882941">headerBody</span><span class="op" id="7882951">{</span><span class="op" id="7882952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882956">for</span>&nbsp;<span class="op" id="7882960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7882965">p</span><span class="op" id="7882966">,</span>&nbsp;<span class="ident" id="7882968">err</span>&nbsp;<span class="op" id="7882972">:=</span>&nbsp;<span class="ident" id="7882975">r</span><span class="op" id="7882976">.</span><span class="ident" id="7882977">NextPart</span><span class="op" id="7882985">(</span><span class="op" id="7882986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7882991">if</span>&nbsp;<span class="ident" id="7882994">err</span>&nbsp;<span class="op" id="7882998">==</span>&nbsp;<span class="ident" id="7883001">io</span><span class="op" id="7883003">.</span><span class="ident" id="7883004">EOF</span>&nbsp;<span class="op" id="7883008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883014">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883028">if</span>&nbsp;<span class="ident" id="7883031">err</span>&nbsp;<span class="op" id="7883035">!=</span>&nbsp;<span class="ident" id="7883038">nil</span>&nbsp;<span class="op" id="7883042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883048">t</span><span class="op" id="7883049">.</span><span class="ident" id="7883050">Errorf</span><span class="op" id="7883056">(</span><span class="string" id="7883057">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="7883083">,</span>&nbsp;<span class="ident" id="7883085">tt</span><span class="op" id="7883087">.</span><span class="ident" id="7883088">name</span><span class="op" id="7883092">,</span>&nbsp;<span class="ident" id="7883094">err</span><span class="op" id="7883097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883103">continue</span>&nbsp;<span class="ident" id="7883112">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883121">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883126">pbody</span><span class="op" id="7883131">,</span>&nbsp;<span class="ident" id="7883133">err</span>&nbsp;<span class="op" id="7883137">:=</span>&nbsp;<span class="ident" id="7883140">ioutil</span><span class="op" id="7883146">.</span><span class="ident" id="7883147">ReadAll</span><span class="op" id="7883154">(</span><span class="ident" id="7883155">p</span><span class="op" id="7883156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883161">if</span>&nbsp;<span class="ident" id="7883164">err</span>&nbsp;<span class="op" id="7883168">!=</span>&nbsp;<span class="ident" id="7883171">nil</span>&nbsp;<span class="op" id="7883175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883181">t</span><span class="op" id="7883182">.</span><span class="ident" id="7883183">Errorf</span><span class="op" id="7883189">(</span><span class="string" id="7883190">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7883226">,</span>&nbsp;<span class="ident" id="7883228">tt</span><span class="op" id="7883230">.</span><span class="ident" id="7883231">name</span><span class="op" id="7883235">,</span>&nbsp;<span class="ident" id="7883237">err</span><span class="op" id="7883240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883246">continue</span>&nbsp;<span class="ident" id="7883255">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883264">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883269">got</span>&nbsp;<span class="op" id="7883273">=</span>&nbsp;<span class="builtinfunc" id="7883275">append</span><span class="op" id="7883281">(</span><span class="ident" id="7883282">got</span><span class="op" id="7883285">,</span>&nbsp;<span class="ident" id="7883287">headerBody</span><span class="op" id="7883297">{</span><span class="ident" id="7883298">p</span><span class="op" id="7883299">.</span><span class="ident" id="7883300">Header</span><span class="op" id="7883306">,</span>&nbsp;<span class="builtintype" id="7883308">string</span><span class="op" id="7883314">(</span><span class="ident" id="7883315">pbody</span><span class="op" id="7883320">)</span><span class="op" id="7883321">}</span><span class="op" id="7883322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883330">if</span>&nbsp;<span class="op" id="7883333">!</span><span class="ident" id="7883334">reflect</span><span class="op" id="7883341">.</span><span class="ident" id="7883342">DeepEqual</span><span class="op" id="7883351">(</span><span class="ident" id="7883352">tt</span><span class="op" id="7883354">.</span><span class="ident" id="7883355">want</span><span class="op" id="7883359">,</span>&nbsp;<span class="ident" id="7883361">got</span><span class="op" id="7883364">)</span>&nbsp;<span class="op" id="7883366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883371">t</span><span class="op" id="7883372">.</span><span class="ident" id="7883373">Errorf</span><span class="op" id="7883379">(</span><span class="string" id="7883380">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7883410">,</span>&nbsp;<span class="ident" id="7883412">tt</span><span class="op" id="7883414">.</span><span class="ident" id="7883415">name</span><span class="op" id="7883419">,</span>&nbsp;<span class="ident" id="7883421">got</span><span class="op" id="7883424">,</span>&nbsp;<span class="ident" id="7883426">tt</span><span class="op" id="7883428">.</span><span class="ident" id="7883429">want</span><span class="op" id="7883433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883438">if</span>&nbsp;<span class="builtinfunc" id="7883441">len</span><span class="op" id="7883444">(</span><span class="ident" id="7883445">tt</span><span class="op" id="7883447">.</span><span class="ident" id="7883448">want</span><span class="op" id="7883452">)</span>&nbsp;<span class="op" id="7883454">!=</span>&nbsp;<span class="builtinfunc" id="7883457">len</span><span class="op" id="7883460">(</span><span class="ident" id="7883461">got</span><span class="op" id="7883464">)</span>&nbsp;<span class="op" id="7883466">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883472">t</span><span class="op" id="7883473">.</span><span class="ident" id="7883474">Errorf</span><span class="op" id="7883480">(</span><span class="string" id="7883481">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7883513">,</span>&nbsp;<span class="ident" id="7883515">tt</span><span class="op" id="7883517">.</span><span class="ident" id="7883518">name</span><span class="op" id="7883522">,</span>&nbsp;<span class="builtinfunc" id="7883524">len</span><span class="op" id="7883527">(</span><span class="ident" id="7883528">got</span><span class="op" id="7883531">)</span><span class="op" id="7883532">,</span>&nbsp;<span class="builtinfunc" id="7883534">len</span><span class="op" id="7883537">(</span><span class="ident" id="7883538">tt</span><span class="op" id="7883540">.</span><span class="ident" id="7883541">want</span><span class="op" id="7883545">)</span><span class="op" id="7883546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883551">}</span>&nbsp;<span class="keyword" id="7883553">else</span>&nbsp;<span class="keyword" id="7883558">if</span>&nbsp;<span class="builtinfunc" id="7883561">len</span><span class="op" id="7883564">(</span><span class="ident" id="7883565">got</span><span class="op" id="7883568">)</span>&nbsp;<span class="op" id="7883570">&gt;</span>&nbsp;<span class="num" id="7883572">1</span>&nbsp;<span class="op" id="7883574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883580">for</span>&nbsp;<span class="ident" id="7883584">pi</span><span class="op" id="7883586">,</span>&nbsp;<span class="ident" id="7883588">wantPart</span>&nbsp;<span class="op" id="7883597">:=</span>&nbsp;<span class="keyword" id="7883600">range</span>&nbsp;<span class="ident" id="7883606">tt</span><span class="op" id="7883608">.</span><span class="ident" id="7883609">want</span>&nbsp;<span class="op" id="7883614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7883621">if</span>&nbsp;<span class="op" id="7883624">!</span><span class="ident" id="7883625">reflect</span><span class="op" id="7883632">.</span><span class="ident" id="7883633">DeepEqual</span><span class="op" id="7883642">(</span><span class="ident" id="7883643">wantPart</span><span class="op" id="7883651">,</span>&nbsp;<span class="ident" id="7883653">got</span><span class="op" id="7883656">[</span><span class="ident" id="7883657">pi</span><span class="op" id="7883659">]</span><span class="op" id="7883660">)</span>&nbsp;<span class="op" id="7883662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883670">t</span><span class="op" id="7883671">.</span><span class="ident" id="7883672">Errorf</span><span class="op" id="7883678">(</span><span class="string" id="7883679">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7883718">,</span>&nbsp;<span class="ident" id="7883720">tt</span><span class="op" id="7883722">.</span><span class="ident" id="7883723">name</span><span class="op" id="7883727">,</span>&nbsp;<span class="ident" id="7883729">pi</span><span class="op" id="7883731">,</span>&nbsp;<span class="ident" id="7883733">got</span><span class="op" id="7883736">[</span><span class="ident" id="7883737">pi</span><span class="op" id="7883739">]</span><span class="op" id="7883740">,</span>&nbsp;<span class="ident" id="7883742">wantPart</span><span class="op" id="7883750">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7883775">}</span><br>
<span class="lineno">605</span><span class="op" id="7883777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7883780">func</span>&nbsp;<span class="ident" id="7883785">roundTripParseTest</span><span class="op" id="7883803">(</span><span class="op" id="7883804">)</span>&nbsp;<span class="ident" id="7883806">parseTest</span>&nbsp;<span class="op" id="7883816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883819">t</span>&nbsp;<span class="op" id="7883821">:=</span>&nbsp;<span class="ident" id="7883824">parseTest</span><span class="op" id="7883833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883837">name</span><span class="op" id="7883841">:</span>&nbsp;<span class="string" id="7883843">&#34;round&nbsp;trip&#34;</span><span class="op" id="7883855">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883859">want</span><span class="op" id="7883863">:</span>&nbsp;<span class="op" id="7883865">[</span><span class="op" id="7883866">]</span><span class="ident" id="7883867">headerBody</span><span class="op" id="7883877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883882">formData</span><span class="op" id="7883890">(</span><span class="string" id="7883891">&#34;empty&#34;</span><span class="op" id="7883898">,</span>&nbsp;<span class="string" id="7883900">&#34;&#34;</span><span class="op" id="7883902">)</span><span class="op" id="7883903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883908">formData</span><span class="op" id="7883916">(</span><span class="string" id="7883917">&#34;lf&#34;</span><span class="op" id="7883921">,</span>&nbsp;<span class="string" id="7883923">&#34;\n&#34;</span><span class="op" id="7883927">)</span><span class="op" id="7883928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883933">formData</span><span class="op" id="7883941">(</span><span class="string" id="7883942">&#34;cr&#34;</span><span class="op" id="7883946">,</span>&nbsp;<span class="string" id="7883948">&#34;\r&#34;</span><span class="op" id="7883952">)</span><span class="op" id="7883953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883958">formData</span><span class="op" id="7883966">(</span><span class="string" id="7883967">&#34;crlf&#34;</span><span class="op" id="7883973">,</span>&nbsp;<span class="string" id="7883975">&#34;\r\n&#34;</span><span class="op" id="7883981">)</span><span class="op" id="7883982">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7883987">formData</span><span class="op" id="7883995">(</span><span class="string" id="7883996">&#34;foo&#34;</span><span class="op" id="7884001">,</span>&nbsp;<span class="string" id="7884003">&#34;bar&#34;</span><span class="op" id="7884008">)</span><span class="op" id="7884009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7884013">}</span><span class="op" id="7884014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7884017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7884020">var</span>&nbsp;<span class="ident" id="7884024">buf</span>&nbsp;<span class="ident" id="7884028">bytes</span><span class="op" id="7884033">.</span><span class="ident" id="7884034">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884042">w</span>&nbsp;<span class="op" id="7884044">:=</span>&nbsp;<span class="ident" id="7884047">NewWriter</span><span class="op" id="7884056">(</span><span class="op" id="7884057">&amp;</span><span class="ident" id="7884058">buf</span><span class="op" id="7884061">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7884064">for</span>&nbsp;<span class="ident" id="7884068">_</span><span class="op" id="7884069">,</span>&nbsp;<span class="ident" id="7884071">p</span>&nbsp;<span class="op" id="7884073">:=</span>&nbsp;<span class="keyword" id="7884076">range</span>&nbsp;<span class="ident" id="7884082">t</span><span class="op" id="7884083">.</span><span class="ident" id="7884084">want</span>&nbsp;<span class="op" id="7884089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884093">pw</span><span class="op" id="7884095">,</span>&nbsp;<span class="ident" id="7884097">err</span>&nbsp;<span class="op" id="7884101">:=</span>&nbsp;<span class="ident" id="7884104">w</span><span class="op" id="7884105">.</span><span class="ident" id="7884106">CreatePart</span><span class="op" id="7884116">(</span><span class="ident" id="7884117">p</span><span class="op" id="7884118">.</span><span class="ident" id="7884119">header</span><span class="op" id="7884125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7884129">if</span>&nbsp;<span class="ident" id="7884132">err</span>&nbsp;<span class="op" id="7884136">!=</span>&nbsp;<span class="ident" id="7884139">nil</span>&nbsp;<span class="op" id="7884143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7884148">panic</span><span class="op" id="7884153">(</span><span class="ident" id="7884154">err</span><span class="op" id="7884157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7884161">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884165">_</span><span class="op" id="7884166">,</span>&nbsp;<span class="ident" id="7884168">err</span>&nbsp;<span class="op" id="7884172">=</span>&nbsp;<span class="ident" id="7884174">pw</span><span class="op" id="7884176">.</span><span class="ident" id="7884177">Write</span><span class="op" id="7884182">(</span><span class="op" id="7884183">[</span><span class="op" id="7884184">]</span><span class="builtintype" id="7884185">byte</span><span class="op" id="7884189">(</span><span class="ident" id="7884190">p</span><span class="op" id="7884191">.</span><span class="ident" id="7884192">body</span><span class="op" id="7884196">)</span><span class="op" id="7884197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7884201">if</span>&nbsp;<span class="ident" id="7884204">err</span>&nbsp;<span class="op" id="7884208">!=</span>&nbsp;<span class="ident" id="7884211">nil</span>&nbsp;<span class="op" id="7884215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7884220">panic</span><span class="op" id="7884225">(</span><span class="ident" id="7884226">err</span><span class="op" id="7884229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7884233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7884236">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884239">w</span><span class="op" id="7884240">.</span><span class="ident" id="7884241">Close</span><span class="op" id="7884246">(</span><span class="op" id="7884247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884250">t</span><span class="op" id="7884251">.</span><span class="ident" id="7884252">in</span>&nbsp;<span class="op" id="7884255">=</span>&nbsp;<span class="ident" id="7884257">buf</span><span class="op" id="7884260">.</span><span class="ident" id="7884261">String</span><span class="op" id="7884267">(</span><span class="op" id="7884268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7884271">t</span><span class="op" id="7884272">.</span><span class="ident" id="7884273">sep</span>&nbsp;<span class="op" id="7884277">=</span>&nbsp;<span class="ident" id="7884279">w</span><span class="op" id="7884280">.</span><span class="ident" id="7884281">Boundary</span><span class="op" id="7884289">(</span><span class="op" id="7884290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7884293">return</span>&nbsp;<span class="ident" id="7884300">t</span><br>
<span class="lineno"></span><span class="op" id="7884302">}</span>
</div>
</body>
</html>
