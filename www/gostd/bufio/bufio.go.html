<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3345482">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3345537">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3345591">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3345642">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="3345720">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3345795">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3345866">package</span>&nbsp;<span class="ident" id="3345874">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3345881">import</span>&nbsp;<span class="op" id="3345888">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345891">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345900">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345910">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345916">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3345931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345934">const</span>&nbsp;<span class="op" id="3345940">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345943">defaultBufSize</span>&nbsp;<span class="op" id="3345958">=</span>&nbsp;<span class="num" id="3345960">4096</span><br>
<span class="lineno"></span><span class="op" id="3345965">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3345968">var</span>&nbsp;<span class="op" id="3345972">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345975">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="3345996">=</span>&nbsp;<span class="ident" id="3345998">errors</span><span class="op" id="3346004">.</span><span class="ident" id="3346005">New</span><span class="op" id="3346008">(</span><span class="string" id="3346009">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="3346043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346046">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="3346067">=</span>&nbsp;<span class="ident" id="3346069">errors</span><span class="op" id="3346075">.</span><span class="ident" id="3346076">New</span><span class="op" id="3346079">(</span><span class="string" id="3346080">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="3346114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346117">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346138">=</span>&nbsp;<span class="ident" id="3346140">errors</span><span class="op" id="3346146">.</span><span class="ident" id="3346147">New</span><span class="op" id="3346150">(</span><span class="string" id="3346151">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="3346171">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346174">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346195">=</span>&nbsp;<span class="ident" id="3346197">errors</span><span class="op" id="3346203">.</span><span class="ident" id="3346204">New</span><span class="op" id="3346207">(</span><span class="string" id="3346208">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="3346231">)</span><br>
<span class="lineno"></span><span class="op" id="3346233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346236">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3346256">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="3346312">type</span>&nbsp;<span class="ident" id="3346317">Reader</span>&nbsp;<span class="keyword" id="3346324">struct</span>&nbsp;<span class="op" id="3346331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346334">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3346347">[</span><span class="op" id="3346348">]</span><span class="builtintype" id="3346349">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346355">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3346368">io</span><span class="op" id="3346370">.</span><span class="ident" id="3346371">Reader</span>&nbsp;<span class="comment" id="3346378">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346412">r</span><span class="op" id="3346413">,</span>&nbsp;<span class="ident" id="3346415">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3346425">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3346435">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346468">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3346481">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346488">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3346501">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346506">lastRuneSize</span>&nbsp;<span class="builtintype" id="3346519">int</span><br>
<span class="lineno"></span><span class="op" id="3346523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3346526">const</span>&nbsp;<span class="ident" id="3346532">minReadBufferSize</span>&nbsp;<span class="op" id="3346550">=</span>&nbsp;<span class="num" id="3346552">16</span><br>
<span class="lineno"></span><span class="keyword" id="3346555">const</span>&nbsp;<span class="ident" id="3346561">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3346586">=</span>&nbsp;<span class="num" id="3346588">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3346593">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3346671">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="3346744">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="3346787">func</span>&nbsp;<span class="ident" id="3346792">NewReaderSize</span><span class="op" id="3346805">(</span><span class="ident" id="3346806">rd</span>&nbsp;<span class="ident" id="3346809">io</span><span class="op" id="3346811">.</span><span class="ident" id="3346812">Reader</span><span class="op" id="3346818">,</span>&nbsp;<span class="ident" id="3346820">size</span>&nbsp;<span class="builtintype" id="3346825">int</span><span class="op" id="3346828">)</span>&nbsp;<span class="op" id="3346830">*</span><span class="ident" id="3346831">Reader</span>&nbsp;<span class="op" id="3346838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3346841">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346869">b</span><span class="op" id="3346870">,</span>&nbsp;<span class="ident" id="3346872">ok</span>&nbsp;<span class="op" id="3346875">:=</span>&nbsp;<span class="ident" id="3346878">rd</span><span class="op" id="3346880">.</span><span class="op" id="3346881">(</span><span class="op" id="3346882">*</span><span class="ident" id="3346883">Reader</span><span class="op" id="3346889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346892">if</span>&nbsp;<span class="ident" id="3346895">ok</span>&nbsp;<span class="op" id="3346898">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3346901">len</span><span class="op" id="3346904">(</span><span class="ident" id="3346905">b</span><span class="op" id="3346906">.</span><span class="ident" id="3346907">buf</span><span class="op" id="3346910">)</span>&nbsp;<span class="op" id="3346912">&gt;=</span>&nbsp;<span class="ident" id="3346915">size</span>&nbsp;<span class="op" id="3346920">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346924">return</span>&nbsp;<span class="ident" id="3346931">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346937">if</span>&nbsp;<span class="ident" id="3346940">size</span>&nbsp;<span class="op" id="3346945">&lt;</span>&nbsp;<span class="ident" id="3346947">minReadBufferSize</span>&nbsp;<span class="op" id="3346965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346969">size</span>&nbsp;<span class="op" id="3346974">=</span>&nbsp;<span class="ident" id="3346976">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346995">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346998">r</span>&nbsp;<span class="op" id="3347000">:=</span>&nbsp;<span class="builtinfunc" id="3347003">new</span><span class="op" id="3347006">(</span><span class="ident" id="3347007">Reader</span><span class="op" id="3347013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347016">r</span><span class="op" id="3347017">.</span><span class="ident" id="3347018">reset</span><span class="op" id="3347023">(</span><span class="builtinfunc" id="3347024">make</span><span class="op" id="3347028">(</span><span class="op" id="3347029">[</span><span class="op" id="3347030">]</span><span class="builtintype" id="3347031">byte</span><span class="op" id="3347035">,</span>&nbsp;<span class="ident" id="3347037">size</span><span class="op" id="3347041">)</span><span class="op" id="3347042">,</span>&nbsp;<span class="ident" id="3347044">rd</span><span class="op" id="3347046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347049">return</span>&nbsp;<span class="ident" id="3347056">r</span><br>
<span class="lineno"></span><span class="op" id="3347058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3347061">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3347130">func</span>&nbsp;<span class="ident" id="3347135">NewReader</span><span class="op" id="3347144">(</span><span class="ident" id="3347145">rd</span>&nbsp;<span class="ident" id="3347148">io</span><span class="op" id="3347150">.</span><span class="ident" id="3347151">Reader</span><span class="op" id="3347157">)</span>&nbsp;<span class="op" id="3347159">*</span><span class="ident" id="3347160">Reader</span>&nbsp;<span class="op" id="3347167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347170">return</span>&nbsp;<span class="ident" id="3347177">NewReaderSize</span><span class="op" id="3347190">(</span><span class="ident" id="3347191">rd</span><span class="op" id="3347193">,</span>&nbsp;<span class="ident" id="3347195">defaultBufSize</span><span class="op" id="3347209">)</span><br>
<span class="lineno"></span><span class="op" id="3347211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3347214">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="3347282">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3347321">func</span>&nbsp;<span class="op" id="3347326">(</span><span class="ident" id="3347327">b</span>&nbsp;<span class="op" id="3347329">*</span><span class="ident" id="3347330">Reader</span><span class="op" id="3347336">)</span>&nbsp;<span class="ident" id="3347338">Reset</span><span class="op" id="3347343">(</span><span class="ident" id="3347344">r</span>&nbsp;<span class="ident" id="3347346">io</span><span class="op" id="3347348">.</span><span class="ident" id="3347349">Reader</span><span class="op" id="3347355">)</span>&nbsp;<span class="op" id="3347357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347360">b</span><span class="op" id="3347361">.</span><span class="ident" id="3347362">reset</span><span class="op" id="3347367">(</span><span class="ident" id="3347368">b</span><span class="op" id="3347369">.</span><span class="ident" id="3347370">buf</span><span class="op" id="3347373">,</span>&nbsp;<span class="ident" id="3347375">r</span><span class="op" id="3347376">)</span><br>
<span class="lineno"></span><span class="op" id="3347378">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3347381">func</span>&nbsp;<span class="op" id="3347386">(</span><span class="ident" id="3347387">b</span>&nbsp;<span class="op" id="3347389">*</span><span class="ident" id="3347390">Reader</span><span class="op" id="3347396">)</span>&nbsp;<span class="ident" id="3347398">reset</span><span class="op" id="3347403">(</span><span class="ident" id="3347404">buf</span>&nbsp;<span class="op" id="3347408">[</span><span class="op" id="3347409">]</span><span class="builtintype" id="3347410">byte</span><span class="op" id="3347414">,</span>&nbsp;<span class="ident" id="3347416">r</span>&nbsp;<span class="ident" id="3347418">io</span><span class="op" id="3347420">.</span><span class="ident" id="3347421">Reader</span><span class="op" id="3347427">)</span>&nbsp;<span class="op" id="3347429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347432">*</span><span class="ident" id="3347433">b</span>&nbsp;<span class="op" id="3347435">=</span>&nbsp;<span class="ident" id="3347437">Reader</span><span class="op" id="3347443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347447">buf</span><span class="op" id="3347450">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347461">buf</span><span class="op" id="3347464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347468">rd</span><span class="op" id="3347470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3347482">r</span><span class="op" id="3347483">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347487">lastByte</span><span class="op" id="3347495">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3347501">-</span><span class="num" id="3347502">1</span><span class="op" id="3347503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347507">lastRuneSize</span><span class="op" id="3347519">:</span>&nbsp;<span class="op" id="3347521">-</span><span class="num" id="3347522">1</span><span class="op" id="3347523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347526">}</span><br>
<span class="lineno"></span><span class="op" id="3347528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3347531">var</span>&nbsp;<span class="ident" id="3347535">errNegativeRead</span>&nbsp;<span class="op" id="3347551">=</span>&nbsp;<span class="ident" id="3347553">errors</span><span class="op" id="3347559">.</span><span class="ident" id="3347560">New</span><span class="op" id="3347563">(</span><span class="string" id="3347564">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="3347613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347616">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3347659">func</span>&nbsp;<span class="op" id="3347664">(</span><span class="ident" id="3347665">b</span>&nbsp;<span class="op" id="3347667">*</span><span class="ident" id="3347668">Reader</span><span class="op" id="3347674">)</span>&nbsp;<span class="ident" id="3347676">fill</span><span class="op" id="3347680">(</span><span class="op" id="3347681">)</span>&nbsp;<span class="op" id="3347683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347686">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347724">if</span>&nbsp;<span class="ident" id="3347727">b</span><span class="op" id="3347728">.</span><span class="ident" id="3347729">r</span>&nbsp;<span class="op" id="3347731">&gt;</span>&nbsp;<span class="num" id="3347733">0</span>&nbsp;<span class="op" id="3347735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3347739">copy</span><span class="op" id="3347743">(</span><span class="ident" id="3347744">b</span><span class="op" id="3347745">.</span><span class="ident" id="3347746">buf</span><span class="op" id="3347749">,</span>&nbsp;<span class="ident" id="3347751">b</span><span class="op" id="3347752">.</span><span class="ident" id="3347753">buf</span><span class="op" id="3347756">[</span><span class="ident" id="3347757">b</span><span class="op" id="3347758">.</span><span class="ident" id="3347759">r</span><span class="op" id="3347760">:</span><span class="ident" id="3347761">b</span><span class="op" id="3347762">.</span><span class="ident" id="3347763">w</span><span class="op" id="3347764">]</span><span class="op" id="3347765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347769">b</span><span class="op" id="3347770">.</span><span class="ident" id="3347771">w</span>&nbsp;<span class="op" id="3347773">-=</span>&nbsp;<span class="ident" id="3347776">b</span><span class="op" id="3347777">.</span><span class="ident" id="3347778">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347782">b</span><span class="op" id="3347783">.</span><span class="ident" id="3347784">r</span>&nbsp;<span class="op" id="3347786">=</span>&nbsp;<span class="num" id="3347788">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347791">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347795">if</span>&nbsp;<span class="ident" id="3347798">b</span><span class="op" id="3347799">.</span><span class="ident" id="3347800">w</span>&nbsp;<span class="op" id="3347802">&gt;=</span>&nbsp;<span class="builtinfunc" id="3347805">len</span><span class="op" id="3347808">(</span><span class="ident" id="3347809">b</span><span class="op" id="3347810">.</span><span class="ident" id="3347811">buf</span><span class="op" id="3347814">)</span>&nbsp;<span class="op" id="3347816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3347820">panic</span><span class="op" id="3347825">(</span><span class="string" id="3347826">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="3347860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3347867">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347917">for</span>&nbsp;<span class="ident" id="3347921">i</span>&nbsp;<span class="op" id="3347923">:=</span>&nbsp;<span class="ident" id="3347926">maxConsecutiveEmptyReads</span><span class="op" id="3347950">;</span>&nbsp;<span class="ident" id="3347952">i</span>&nbsp;<span class="op" id="3347954">&gt;</span>&nbsp;<span class="num" id="3347956">0</span><span class="op" id="3347957">;</span>&nbsp;<span class="ident" id="3347959">i</span><span class="op" id="3347960">--</span>&nbsp;<span class="op" id="3347963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347967">n</span><span class="op" id="3347968">,</span>&nbsp;<span class="ident" id="3347970">err</span>&nbsp;<span class="op" id="3347974">:=</span>&nbsp;<span class="ident" id="3347977">b</span><span class="op" id="3347978">.</span><span class="ident" id="3347979">rd</span><span class="op" id="3347981">.</span><span class="ident" id="3347982">Read</span><span class="op" id="3347986">(</span><span class="ident" id="3347987">b</span><span class="op" id="3347988">.</span><span class="ident" id="3347989">buf</span><span class="op" id="3347992">[</span><span class="ident" id="3347993">b</span><span class="op" id="3347994">.</span><span class="ident" id="3347995">w</span><span class="op" id="3347996">:</span><span class="op" id="3347997">]</span><span class="op" id="3347998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348002">if</span>&nbsp;<span class="ident" id="3348005">n</span>&nbsp;<span class="op" id="3348007">&lt;</span>&nbsp;<span class="num" id="3348009">0</span>&nbsp;<span class="op" id="3348011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3348016">panic</span><span class="op" id="3348021">(</span><span class="ident" id="3348022">errNegativeRead</span><span class="op" id="3348037">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348045">b</span><span class="op" id="3348046">.</span><span class="ident" id="3348047">w</span>&nbsp;<span class="op" id="3348049">+=</span>&nbsp;<span class="ident" id="3348052">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348056">if</span>&nbsp;<span class="ident" id="3348059">err</span>&nbsp;<span class="op" id="3348063">!=</span>&nbsp;<span class="ident" id="3348066">nil</span>&nbsp;<span class="op" id="3348070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348075">b</span><span class="op" id="3348076">.</span><span class="ident" id="3348077">err</span>&nbsp;<span class="op" id="3348081">=</span>&nbsp;<span class="ident" id="3348083">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348090">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348103">if</span>&nbsp;<span class="ident" id="3348106">n</span>&nbsp;<span class="op" id="3348108">&gt;</span>&nbsp;<span class="num" id="3348110">0</span>&nbsp;<span class="op" id="3348112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348129">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348132">b</span><span class="op" id="3348133">.</span><span class="ident" id="3348134">err</span>&nbsp;<span class="op" id="3348138">=</span>&nbsp;<span class="ident" id="3348140">io</span><span class="op" id="3348142">.</span><span class="ident" id="3348143">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="3348157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348160">func</span>&nbsp;<span class="op" id="3348165">(</span><span class="ident" id="3348166">b</span>&nbsp;<span class="op" id="3348168">*</span><span class="ident" id="3348169">Reader</span><span class="op" id="3348175">)</span>&nbsp;<span class="ident" id="3348177">readErr</span><span class="op" id="3348184">(</span><span class="op" id="3348185">)</span>&nbsp;<span class="builtintype" id="3348187">error</span>&nbsp;<span class="op" id="3348193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348196">err</span>&nbsp;<span class="op" id="3348200">:=</span>&nbsp;<span class="ident" id="3348203">b</span><span class="op" id="3348204">.</span><span class="ident" id="3348205">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348210">b</span><span class="op" id="3348211">.</span><span class="ident" id="3348212">err</span>&nbsp;<span class="op" id="3348216">=</span>&nbsp;<span class="ident" id="3348218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348223">return</span>&nbsp;<span class="ident" id="3348230">err</span><br>
<span class="lineno"></span><span class="op" id="3348234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348237">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="3348315">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3348392">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3348464">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3348518">func</span>&nbsp;<span class="op" id="3348523">(</span><span class="ident" id="3348524">b</span>&nbsp;<span class="op" id="3348526">*</span><span class="ident" id="3348527">Reader</span><span class="op" id="3348533">)</span>&nbsp;<span class="ident" id="3348535">Peek</span><span class="op" id="3348539">(</span><span class="ident" id="3348540">n</span>&nbsp;<span class="builtintype" id="3348542">int</span><span class="op" id="3348545">)</span>&nbsp;<span class="op" id="3348547">(</span><span class="op" id="3348548">[</span><span class="op" id="3348549">]</span><span class="builtintype" id="3348550">byte</span><span class="op" id="3348554">,</span>&nbsp;<span class="builtintype" id="3348556">error</span><span class="op" id="3348561">)</span>&nbsp;<span class="op" id="3348563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348566">if</span>&nbsp;<span class="ident" id="3348569">n</span>&nbsp;<span class="op" id="3348571">&lt;</span>&nbsp;<span class="num" id="3348573">0</span>&nbsp;<span class="op" id="3348575">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348579">return</span>&nbsp;<span class="ident" id="3348586">nil</span><span class="op" id="3348589">,</span>&nbsp;<span class="ident" id="3348591">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348612">if</span>&nbsp;<span class="ident" id="3348615">n</span>&nbsp;<span class="op" id="3348617">&gt;</span>&nbsp;<span class="builtinfunc" id="3348619">len</span><span class="op" id="3348622">(</span><span class="ident" id="3348623">b</span><span class="op" id="3348624">.</span><span class="ident" id="3348625">buf</span><span class="op" id="3348628">)</span>&nbsp;<span class="op" id="3348630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348634">return</span>&nbsp;<span class="ident" id="3348641">nil</span><span class="op" id="3348644">,</span>&nbsp;<span class="ident" id="3348646">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348661">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348664">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348689">for</span>&nbsp;<span class="ident" id="3348693">b</span><span class="op" id="3348694">.</span><span class="ident" id="3348695">w</span><span class="op" id="3348696">-</span><span class="ident" id="3348697">b</span><span class="op" id="3348698">.</span><span class="ident" id="3348699">r</span>&nbsp;<span class="op" id="3348701">&lt;</span>&nbsp;<span class="ident" id="3348703">n</span>&nbsp;<span class="op" id="3348705">&amp;&amp;</span>&nbsp;<span class="ident" id="3348708">b</span><span class="op" id="3348709">.</span><span class="ident" id="3348710">err</span>&nbsp;<span class="op" id="3348714">==</span>&nbsp;<span class="ident" id="3348717">nil</span>&nbsp;<span class="op" id="3348721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348725">b</span><span class="op" id="3348726">.</span><span class="ident" id="3348727">fill</span><span class="op" id="3348731">(</span><span class="op" id="3348732">)</span>&nbsp;<span class="comment" id="3348734">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348785">var</span>&nbsp;<span class="ident" id="3348789">err</span>&nbsp;<span class="builtintype" id="3348793">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348800">if</span>&nbsp;<span class="ident" id="3348803">avail</span>&nbsp;<span class="op" id="3348809">:=</span>&nbsp;<span class="ident" id="3348812">b</span><span class="op" id="3348813">.</span><span class="ident" id="3348814">w</span>&nbsp;<span class="op" id="3348816">-</span>&nbsp;<span class="ident" id="3348818">b</span><span class="op" id="3348819">.</span><span class="ident" id="3348820">r</span><span class="op" id="3348821">;</span>&nbsp;<span class="ident" id="3348823">avail</span>&nbsp;<span class="op" id="3348829">&lt;</span>&nbsp;<span class="ident" id="3348831">n</span>&nbsp;<span class="op" id="3348833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3348837">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348868">n</span>&nbsp;<span class="op" id="3348870">=</span>&nbsp;<span class="ident" id="3348872">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348880">err</span>&nbsp;<span class="op" id="3348884">=</span>&nbsp;<span class="ident" id="3348886">b</span><span class="op" id="3348887">.</span><span class="ident" id="3348888">readErr</span><span class="op" id="3348895">(</span><span class="op" id="3348896">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348900">if</span>&nbsp;<span class="ident" id="3348903">err</span>&nbsp;<span class="op" id="3348907">==</span>&nbsp;<span class="ident" id="3348910">nil</span>&nbsp;<span class="op" id="3348914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348919">err</span>&nbsp;<span class="op" id="3348923">=</span>&nbsp;<span class="ident" id="3348925">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348947">return</span>&nbsp;<span class="ident" id="3348954">b</span><span class="op" id="3348955">.</span><span class="ident" id="3348956">buf</span><span class="op" id="3348959">[</span><span class="ident" id="3348960">b</span><span class="op" id="3348961">.</span><span class="ident" id="3348962">r</span>&nbsp;<span class="op" id="3348964">:</span>&nbsp;<span class="ident" id="3348966">b</span><span class="op" id="3348967">.</span><span class="ident" id="3348968">r</span><span class="op" id="3348969">+</span><span class="ident" id="3348970">n</span><span class="op" id="3348971">]</span><span class="op" id="3348972">,</span>&nbsp;<span class="ident" id="3348974">err</span><br>
<span class="lineno">145</span><span class="op" id="3348978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348981">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3349008">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3349055">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="3349111">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="3349147">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3349205">func</span>&nbsp;<span class="op" id="3349210">(</span><span class="ident" id="3349211">b</span>&nbsp;<span class="op" id="3349213">*</span><span class="ident" id="3349214">Reader</span><span class="op" id="3349220">)</span>&nbsp;<span class="ident" id="3349222">Read</span><span class="op" id="3349226">(</span><span class="ident" id="3349227">p</span>&nbsp;<span class="op" id="3349229">[</span><span class="op" id="3349230">]</span><span class="builtintype" id="3349231">byte</span><span class="op" id="3349235">)</span>&nbsp;<span class="op" id="3349237">(</span><span class="ident" id="3349238">n</span>&nbsp;<span class="builtintype" id="3349240">int</span><span class="op" id="3349243">,</span>&nbsp;<span class="ident" id="3349245">err</span>&nbsp;<span class="builtintype" id="3349249">error</span><span class="op" id="3349254">)</span>&nbsp;<span class="op" id="3349256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349259">n</span>&nbsp;<span class="op" id="3349261">=</span>&nbsp;<span class="builtinfunc" id="3349263">len</span><span class="op" id="3349266">(</span><span class="ident" id="3349267">p</span><span class="op" id="3349268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349271">if</span>&nbsp;<span class="ident" id="3349274">n</span>&nbsp;<span class="op" id="3349276">==</span>&nbsp;<span class="num" id="3349279">0</span>&nbsp;<span class="op" id="3349281">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349285">return</span>&nbsp;<span class="num" id="3349292">0</span><span class="op" id="3349293">,</span>&nbsp;<span class="ident" id="3349295">b</span><span class="op" id="3349296">.</span><span class="ident" id="3349297">readErr</span><span class="op" id="3349304">(</span><span class="op" id="3349305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349311">if</span>&nbsp;<span class="ident" id="3349314">b</span><span class="op" id="3349315">.</span><span class="ident" id="3349316">r</span>&nbsp;<span class="op" id="3349318">==</span>&nbsp;<span class="ident" id="3349321">b</span><span class="op" id="3349322">.</span><span class="ident" id="3349323">w</span>&nbsp;<span class="op" id="3349325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349329">if</span>&nbsp;<span class="ident" id="3349332">b</span><span class="op" id="3349333">.</span><span class="ident" id="3349334">err</span>&nbsp;<span class="op" id="3349338">!=</span>&nbsp;<span class="ident" id="3349341">nil</span>&nbsp;<span class="op" id="3349345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349350">return</span>&nbsp;<span class="num" id="3349357">0</span><span class="op" id="3349358">,</span>&nbsp;<span class="ident" id="3349360">b</span><span class="op" id="3349361">.</span><span class="ident" id="3349362">readErr</span><span class="op" id="3349369">(</span><span class="op" id="3349370">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349378">if</span>&nbsp;<span class="builtinfunc" id="3349381">len</span><span class="op" id="3349384">(</span><span class="ident" id="3349385">p</span><span class="op" id="3349386">)</span>&nbsp;<span class="op" id="3349388">&gt;=</span>&nbsp;<span class="builtinfunc" id="3349391">len</span><span class="op" id="3349394">(</span><span class="ident" id="3349395">b</span><span class="op" id="3349396">.</span><span class="ident" id="3349397">buf</span><span class="op" id="3349400">)</span>&nbsp;<span class="op" id="3349402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349407">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349439">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349481">n</span><span class="op" id="3349482">,</span>&nbsp;<span class="ident" id="3349484">b</span><span class="op" id="3349485">.</span><span class="ident" id="3349486">err</span>&nbsp;<span class="op" id="3349490">=</span>&nbsp;<span class="ident" id="3349492">b</span><span class="op" id="3349493">.</span><span class="ident" id="3349494">rd</span><span class="op" id="3349496">.</span><span class="ident" id="3349497">Read</span><span class="op" id="3349501">(</span><span class="ident" id="3349502">p</span><span class="op" id="3349503">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349508">if</span>&nbsp;<span class="ident" id="3349511">n</span>&nbsp;<span class="op" id="3349513">&lt;</span>&nbsp;<span class="num" id="3349515">0</span>&nbsp;<span class="op" id="3349517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3349523">panic</span><span class="op" id="3349528">(</span><span class="ident" id="3349529">errNegativeRead</span><span class="op" id="3349544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349554">if</span>&nbsp;<span class="ident" id="3349557">n</span>&nbsp;<span class="op" id="3349559">&gt;</span>&nbsp;<span class="num" id="3349561">0</span>&nbsp;<span class="op" id="3349563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349569">b</span><span class="op" id="3349570">.</span><span class="ident" id="3349571">lastByte</span>&nbsp;<span class="op" id="3349580">=</span>&nbsp;<span class="builtintype" id="3349582">int</span><span class="op" id="3349585">(</span><span class="ident" id="3349586">p</span><span class="op" id="3349587">[</span><span class="ident" id="3349588">n</span><span class="op" id="3349589">-</span><span class="num" id="3349590">1</span><span class="op" id="3349591">]</span><span class="op" id="3349592">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349598">b</span><span class="op" id="3349599">.</span><span class="ident" id="3349600">lastRuneSize</span>&nbsp;<span class="op" id="3349613">=</span>&nbsp;<span class="op" id="3349615">-</span><span class="num" id="3349616">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349626">return</span>&nbsp;<span class="ident" id="3349633">n</span><span class="op" id="3349634">,</span>&nbsp;<span class="ident" id="3349636">b</span><span class="op" id="3349637">.</span><span class="ident" id="3349638">readErr</span><span class="op" id="3349645">(</span><span class="op" id="3349646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349654">b</span><span class="op" id="3349655">.</span><span class="ident" id="3349656">fill</span><span class="op" id="3349660">(</span><span class="op" id="3349661">)</span>&nbsp;<span class="comment" id="3349663">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349684">if</span>&nbsp;<span class="ident" id="3349687">b</span><span class="op" id="3349688">.</span><span class="ident" id="3349689">r</span>&nbsp;<span class="op" id="3349691">==</span>&nbsp;<span class="ident" id="3349694">b</span><span class="op" id="3349695">.</span><span class="ident" id="3349696">w</span>&nbsp;<span class="op" id="3349698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349703">return</span>&nbsp;<span class="num" id="3349710">0</span><span class="op" id="3349711">,</span>&nbsp;<span class="ident" id="3349713">b</span><span class="op" id="3349714">.</span><span class="ident" id="3349715">readErr</span><span class="op" id="3349722">(</span><span class="op" id="3349723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349734">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349761">n</span>&nbsp;<span class="op" id="3349763">=</span>&nbsp;<span class="builtinfunc" id="3349765">copy</span><span class="op" id="3349769">(</span><span class="ident" id="3349770">p</span><span class="op" id="3349771">,</span>&nbsp;<span class="ident" id="3349773">b</span><span class="op" id="3349774">.</span><span class="ident" id="3349775">buf</span><span class="op" id="3349778">[</span><span class="ident" id="3349779">b</span><span class="op" id="3349780">.</span><span class="ident" id="3349781">r</span><span class="op" id="3349782">:</span><span class="ident" id="3349783">b</span><span class="op" id="3349784">.</span><span class="ident" id="3349785">w</span><span class="op" id="3349786">]</span><span class="op" id="3349787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349790">b</span><span class="op" id="3349791">.</span><span class="ident" id="3349792">r</span>&nbsp;<span class="op" id="3349794">+=</span>&nbsp;<span class="ident" id="3349797">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349800">b</span><span class="op" id="3349801">.</span><span class="ident" id="3349802">lastByte</span>&nbsp;<span class="op" id="3349811">=</span>&nbsp;<span class="builtintype" id="3349813">int</span><span class="op" id="3349816">(</span><span class="ident" id="3349817">b</span><span class="op" id="3349818">.</span><span class="ident" id="3349819">buf</span><span class="op" id="3349822">[</span><span class="ident" id="3349823">b</span><span class="op" id="3349824">.</span><span class="ident" id="3349825">r</span><span class="op" id="3349826">-</span><span class="num" id="3349827">1</span><span class="op" id="3349828">]</span><span class="op" id="3349829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349832">b</span><span class="op" id="3349833">.</span><span class="ident" id="3349834">lastRuneSize</span>&nbsp;<span class="op" id="3349847">=</span>&nbsp;<span class="op" id="3349849">-</span><span class="num" id="3349850">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349853">return</span>&nbsp;<span class="ident" id="3349860">n</span><span class="op" id="3349861">,</span>&nbsp;<span class="ident" id="3349863">nil</span><br>
<span class="lineno"></span><span class="op" id="3349867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3349870">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="3349915">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="3349961">func</span>&nbsp;<span class="op" id="3349966">(</span><span class="ident" id="3349967">b</span>&nbsp;<span class="op" id="3349969">*</span><span class="ident" id="3349970">Reader</span><span class="op" id="3349976">)</span>&nbsp;<span class="ident" id="3349978">ReadByte</span><span class="op" id="3349986">(</span><span class="op" id="3349987">)</span>&nbsp;<span class="op" id="3349989">(</span><span class="ident" id="3349990">c</span>&nbsp;<span class="builtintype" id="3349992">byte</span><span class="op" id="3349996">,</span>&nbsp;<span class="ident" id="3349998">err</span>&nbsp;<span class="builtintype" id="3350002">error</span><span class="op" id="3350007">)</span>&nbsp;<span class="op" id="3350009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350012">b</span><span class="op" id="3350013">.</span><span class="ident" id="3350014">lastRuneSize</span>&nbsp;<span class="op" id="3350027">=</span>&nbsp;<span class="op" id="3350029">-</span><span class="num" id="3350030">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350033">for</span>&nbsp;<span class="ident" id="3350037">b</span><span class="op" id="3350038">.</span><span class="ident" id="3350039">r</span>&nbsp;<span class="op" id="3350041">==</span>&nbsp;<span class="ident" id="3350044">b</span><span class="op" id="3350045">.</span><span class="ident" id="3350046">w</span>&nbsp;<span class="op" id="3350048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350052">if</span>&nbsp;<span class="ident" id="3350055">b</span><span class="op" id="3350056">.</span><span class="ident" id="3350057">err</span>&nbsp;<span class="op" id="3350061">!=</span>&nbsp;<span class="ident" id="3350064">nil</span>&nbsp;<span class="op" id="3350068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350073">return</span>&nbsp;<span class="num" id="3350080">0</span><span class="op" id="3350081">,</span>&nbsp;<span class="ident" id="3350083">b</span><span class="op" id="3350084">.</span><span class="ident" id="3350085">readErr</span><span class="op" id="3350092">(</span><span class="op" id="3350093">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350101">b</span><span class="op" id="3350102">.</span><span class="ident" id="3350103">fill</span><span class="op" id="3350107">(</span><span class="op" id="3350108">)</span>&nbsp;<span class="comment" id="3350110">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350133">c</span>&nbsp;<span class="op" id="3350135">=</span>&nbsp;<span class="ident" id="3350137">b</span><span class="op" id="3350138">.</span><span class="ident" id="3350139">buf</span><span class="op" id="3350142">[</span><span class="ident" id="3350143">b</span><span class="op" id="3350144">.</span><span class="ident" id="3350145">r</span><span class="op" id="3350146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350149">b</span><span class="op" id="3350150">.</span><span class="ident" id="3350151">r</span><span class="op" id="3350152">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350156">b</span><span class="op" id="3350157">.</span><span class="ident" id="3350158">lastByte</span>&nbsp;<span class="op" id="3350167">=</span>&nbsp;<span class="builtintype" id="3350169">int</span><span class="op" id="3350172">(</span><span class="ident" id="3350173">c</span><span class="op" id="3350174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350177">return</span>&nbsp;<span class="ident" id="3350184">c</span><span class="op" id="3350185">,</span>&nbsp;<span class="ident" id="3350187">nil</span><br>
<span class="lineno"></span><span class="op" id="3350191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350194">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="3350280">func</span>&nbsp;<span class="op" id="3350285">(</span><span class="ident" id="3350286">b</span>&nbsp;<span class="op" id="3350288">*</span><span class="ident" id="3350289">Reader</span><span class="op" id="3350295">)</span>&nbsp;<span class="ident" id="3350297">UnreadByte</span><span class="op" id="3350307">(</span><span class="op" id="3350308">)</span>&nbsp;<span class="builtintype" id="3350310">error</span>&nbsp;<span class="op" id="3350316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350319">if</span>&nbsp;<span class="ident" id="3350322">b</span><span class="op" id="3350323">.</span><span class="ident" id="3350324">lastByte</span>&nbsp;<span class="op" id="3350333">&lt;</span>&nbsp;<span class="num" id="3350335">0</span>&nbsp;<span class="op" id="3350337">||</span>&nbsp;<span class="ident" id="3350340">b</span><span class="op" id="3350341">.</span><span class="ident" id="3350342">r</span>&nbsp;<span class="op" id="3350344">==</span>&nbsp;<span class="num" id="3350347">0</span>&nbsp;<span class="op" id="3350349">&amp;&amp;</span>&nbsp;<span class="ident" id="3350352">b</span><span class="op" id="3350353">.</span><span class="ident" id="3350354">w</span>&nbsp;<span class="op" id="3350356">&gt;</span>&nbsp;<span class="num" id="3350358">0</span>&nbsp;<span class="op" id="3350360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350364">return</span>&nbsp;<span class="ident" id="3350371">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350396">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350420">if</span>&nbsp;<span class="ident" id="3350423">b</span><span class="op" id="3350424">.</span><span class="ident" id="3350425">r</span>&nbsp;<span class="op" id="3350427">&gt;</span>&nbsp;<span class="num" id="3350429">0</span>&nbsp;<span class="op" id="3350431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350435">b</span><span class="op" id="3350436">.</span><span class="ident" id="3350437">r</span><span class="op" id="3350438">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350442">}</span>&nbsp;<span class="keyword" id="3350444">else</span>&nbsp;<span class="op" id="3350449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350453">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350479">b</span><span class="op" id="3350480">.</span><span class="ident" id="3350481">w</span>&nbsp;<span class="op" id="3350483">=</span>&nbsp;<span class="num" id="3350485">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350491">b</span><span class="op" id="3350492">.</span><span class="ident" id="3350493">buf</span><span class="op" id="3350496">[</span><span class="ident" id="3350497">b</span><span class="op" id="3350498">.</span><span class="ident" id="3350499">r</span><span class="op" id="3350500">]</span>&nbsp;<span class="op" id="3350502">=</span>&nbsp;<span class="builtintype" id="3350504">byte</span><span class="op" id="3350508">(</span><span class="ident" id="3350509">b</span><span class="op" id="3350510">.</span><span class="ident" id="3350511">lastByte</span><span class="op" id="3350519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350522">b</span><span class="op" id="3350523">.</span><span class="ident" id="3350524">lastByte</span>&nbsp;<span class="op" id="3350533">=</span>&nbsp;<span class="op" id="3350535">-</span><span class="num" id="3350536">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350539">b</span><span class="op" id="3350540">.</span><span class="ident" id="3350541">lastRuneSize</span>&nbsp;<span class="op" id="3350554">=</span>&nbsp;<span class="op" id="3350556">-</span><span class="num" id="3350557">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350560">return</span>&nbsp;<span class="ident" id="3350567">nil</span><br>
<span class="lineno">220</span><span class="op" id="3350571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350574">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3350649">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3350733">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="3350799">func</span>&nbsp;<span class="op" id="3350804">(</span><span class="ident" id="3350805">b</span>&nbsp;<span class="op" id="3350807">*</span><span class="ident" id="3350808">Reader</span><span class="op" id="3350814">)</span>&nbsp;<span class="ident" id="3350816">ReadRune</span><span class="op" id="3350824">(</span><span class="op" id="3350825">)</span>&nbsp;<span class="op" id="3350827">(</span><span class="ident" id="3350828">r</span>&nbsp;<span class="builtintype" id="3350830">rune</span><span class="op" id="3350834">,</span>&nbsp;<span class="ident" id="3350836">size</span>&nbsp;<span class="builtintype" id="3350841">int</span><span class="op" id="3350844">,</span>&nbsp;<span class="ident" id="3350846">err</span>&nbsp;<span class="builtintype" id="3350850">error</span><span class="op" id="3350855">)</span>&nbsp;<span class="op" id="3350857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350860">for</span>&nbsp;<span class="ident" id="3350864">b</span><span class="op" id="3350865">.</span><span class="ident" id="3350866">r</span><span class="op" id="3350867">+</span><span class="ident" id="3350868">utf8</span><span class="op" id="3350872">.</span><span class="ident" id="3350873">UTFMax</span>&nbsp;<span class="op" id="3350880">&gt;</span>&nbsp;<span class="ident" id="3350882">b</span><span class="op" id="3350883">.</span><span class="ident" id="3350884">w</span>&nbsp;<span class="op" id="3350886">&amp;&amp;</span>&nbsp;<span class="op" id="3350889">!</span><span class="ident" id="3350890">utf8</span><span class="op" id="3350894">.</span><span class="ident" id="3350895">FullRune</span><span class="op" id="3350903">(</span><span class="ident" id="3350904">b</span><span class="op" id="3350905">.</span><span class="ident" id="3350906">buf</span><span class="op" id="3350909">[</span><span class="ident" id="3350910">b</span><span class="op" id="3350911">.</span><span class="ident" id="3350912">r</span><span class="op" id="3350913">:</span><span class="ident" id="3350914">b</span><span class="op" id="3350915">.</span><span class="ident" id="3350916">w</span><span class="op" id="3350917">]</span><span class="op" id="3350918">)</span>&nbsp;<span class="op" id="3350920">&amp;&amp;</span>&nbsp;<span class="ident" id="3350923">b</span><span class="op" id="3350924">.</span><span class="ident" id="3350925">err</span>&nbsp;<span class="op" id="3350929">==</span>&nbsp;<span class="ident" id="3350932">nil</span>&nbsp;<span class="op" id="3350936">&amp;&amp;</span>&nbsp;<span class="ident" id="3350939">b</span><span class="op" id="3350940">.</span><span class="ident" id="3350941">w</span><span class="op" id="3350942">-</span><span class="ident" id="3350943">b</span><span class="op" id="3350944">.</span><span class="ident" id="3350945">r</span>&nbsp;<span class="op" id="3350947">&lt;</span>&nbsp;<span class="builtinfunc" id="3350949">len</span><span class="op" id="3350952">(</span><span class="ident" id="3350953">b</span><span class="op" id="3350954">.</span><span class="ident" id="3350955">buf</span><span class="op" id="3350958">)</span>&nbsp;<span class="op" id="3350960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350964">b</span><span class="op" id="3350965">.</span><span class="ident" id="3350966">fill</span><span class="op" id="3350970">(</span><span class="op" id="3350971">)</span>&nbsp;<span class="comment" id="3350973">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351021">b</span><span class="op" id="3351022">.</span><span class="ident" id="3351023">lastRuneSize</span>&nbsp;<span class="op" id="3351036">=</span>&nbsp;<span class="op" id="3351038">-</span><span class="num" id="3351039">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351042">if</span>&nbsp;<span class="ident" id="3351045">b</span><span class="op" id="3351046">.</span><span class="ident" id="3351047">r</span>&nbsp;<span class="op" id="3351049">==</span>&nbsp;<span class="ident" id="3351052">b</span><span class="op" id="3351053">.</span><span class="ident" id="3351054">w</span>&nbsp;<span class="op" id="3351056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351060">return</span>&nbsp;<span class="num" id="3351067">0</span><span class="op" id="3351068">,</span>&nbsp;<span class="num" id="3351070">0</span><span class="op" id="3351071">,</span>&nbsp;<span class="ident" id="3351073">b</span><span class="op" id="3351074">.</span><span class="ident" id="3351075">readErr</span><span class="op" id="3351082">(</span><span class="op" id="3351083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351089">r</span><span class="op" id="3351090">,</span>&nbsp;<span class="ident" id="3351092">size</span>&nbsp;<span class="op" id="3351097">=</span>&nbsp;<span class="builtintype" id="3351099">rune</span><span class="op" id="3351103">(</span><span class="ident" id="3351104">b</span><span class="op" id="3351105">.</span><span class="ident" id="3351106">buf</span><span class="op" id="3351109">[</span><span class="ident" id="3351110">b</span><span class="op" id="3351111">.</span><span class="ident" id="3351112">r</span><span class="op" id="3351113">]</span><span class="op" id="3351114">)</span><span class="op" id="3351115">,</span>&nbsp;<span class="num" id="3351117">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351120">if</span>&nbsp;<span class="ident" id="3351123">r</span>&nbsp;<span class="op" id="3351125">&gt;=</span>&nbsp;<span class="num" id="3351128">0x80</span>&nbsp;<span class="op" id="3351133">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351137">r</span><span class="op" id="3351138">,</span>&nbsp;<span class="ident" id="3351140">size</span>&nbsp;<span class="op" id="3351145">=</span>&nbsp;<span class="ident" id="3351147">utf8</span><span class="op" id="3351151">.</span><span class="ident" id="3351152">DecodeRune</span><span class="op" id="3351162">(</span><span class="ident" id="3351163">b</span><span class="op" id="3351164">.</span><span class="ident" id="3351165">buf</span><span class="op" id="3351168">[</span><span class="ident" id="3351169">b</span><span class="op" id="3351170">.</span><span class="ident" id="3351171">r</span><span class="op" id="3351172">:</span><span class="ident" id="3351173">b</span><span class="op" id="3351174">.</span><span class="ident" id="3351175">w</span><span class="op" id="3351176">]</span><span class="op" id="3351177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351183">b</span><span class="op" id="3351184">.</span><span class="ident" id="3351185">r</span>&nbsp;<span class="op" id="3351187">+=</span>&nbsp;<span class="ident" id="3351190">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351196">b</span><span class="op" id="3351197">.</span><span class="ident" id="3351198">lastByte</span>&nbsp;<span class="op" id="3351207">=</span>&nbsp;<span class="builtintype" id="3351209">int</span><span class="op" id="3351212">(</span><span class="ident" id="3351213">b</span><span class="op" id="3351214">.</span><span class="ident" id="3351215">buf</span><span class="op" id="3351218">[</span><span class="ident" id="3351219">b</span><span class="op" id="3351220">.</span><span class="ident" id="3351221">r</span><span class="op" id="3351222">-</span><span class="num" id="3351223">1</span><span class="op" id="3351224">]</span><span class="op" id="3351225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351228">b</span><span class="op" id="3351229">.</span><span class="ident" id="3351230">lastRuneSize</span>&nbsp;<span class="op" id="3351243">=</span>&nbsp;<span class="ident" id="3351245">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351251">return</span>&nbsp;<span class="ident" id="3351258">r</span><span class="op" id="3351259">,</span>&nbsp;<span class="ident" id="3351261">size</span><span class="op" id="3351265">,</span>&nbsp;<span class="ident" id="3351267">nil</span><br>
<span class="lineno"></span><span class="op" id="3351271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351274">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3351349">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="3351422">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3351496">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="3351525">func</span>&nbsp;<span class="op" id="3351530">(</span><span class="ident" id="3351531">b</span>&nbsp;<span class="op" id="3351533">*</span><span class="ident" id="3351534">Reader</span><span class="op" id="3351540">)</span>&nbsp;<span class="ident" id="3351542">UnreadRune</span><span class="op" id="3351552">(</span><span class="op" id="3351553">)</span>&nbsp;<span class="builtintype" id="3351555">error</span>&nbsp;<span class="op" id="3351561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351564">if</span>&nbsp;<span class="ident" id="3351567">b</span><span class="op" id="3351568">.</span><span class="ident" id="3351569">lastRuneSize</span>&nbsp;<span class="op" id="3351582">&lt;</span>&nbsp;<span class="num" id="3351584">0</span>&nbsp;<span class="op" id="3351586">||</span>&nbsp;<span class="ident" id="3351589">b</span><span class="op" id="3351590">.</span><span class="ident" id="3351591">r</span>&nbsp;<span class="op" id="3351593">&lt;</span>&nbsp;<span class="ident" id="3351595">b</span><span class="op" id="3351596">.</span><span class="ident" id="3351597">lastRuneSize</span>&nbsp;<span class="op" id="3351610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351614">return</span>&nbsp;<span class="ident" id="3351621">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3351643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351646">b</span><span class="op" id="3351647">.</span><span class="ident" id="3351648">r</span>&nbsp;<span class="op" id="3351650">-=</span>&nbsp;<span class="ident" id="3351653">b</span><span class="op" id="3351654">.</span><span class="ident" id="3351655">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351669">b</span><span class="op" id="3351670">.</span><span class="ident" id="3351671">lastByte</span>&nbsp;<span class="op" id="3351680">=</span>&nbsp;<span class="op" id="3351682">-</span><span class="num" id="3351683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3351686">b</span><span class="op" id="3351687">.</span><span class="ident" id="3351688">lastRuneSize</span>&nbsp;<span class="op" id="3351701">=</span>&nbsp;<span class="op" id="3351703">-</span><span class="num" id="3351704">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351707">return</span>&nbsp;<span class="ident" id="3351714">nil</span><br>
<span class="lineno">255</span><span class="op" id="3351718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351721">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3351803">func</span>&nbsp;<span class="op" id="3351808">(</span><span class="ident" id="3351809">b</span>&nbsp;<span class="op" id="3351811">*</span><span class="ident" id="3351812">Reader</span><span class="op" id="3351818">)</span>&nbsp;<span class="ident" id="3351820">Buffered</span><span class="op" id="3351828">(</span><span class="op" id="3351829">)</span>&nbsp;<span class="builtintype" id="3351831">int</span>&nbsp;<span class="op" id="3351835">{</span>&nbsp;<span class="keyword" id="3351837">return</span>&nbsp;<span class="ident" id="3351844">b</span><span class="op" id="3351845">.</span><span class="ident" id="3351846">w</span>&nbsp;<span class="op" id="3351848">-</span>&nbsp;<span class="ident" id="3351850">b</span><span class="op" id="3351851">.</span><span class="ident" id="3351852">r</span>&nbsp;<span class="op" id="3351854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3351857">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3351926">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3351984">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="3352032">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3352096">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="3352174">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3352255">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="3352319">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3352373">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3352409">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="3352484">func</span>&nbsp;<span class="op" id="3352489">(</span><span class="ident" id="3352490">b</span>&nbsp;<span class="op" id="3352492">*</span><span class="ident" id="3352493">Reader</span><span class="op" id="3352499">)</span>&nbsp;<span class="ident" id="3352501">ReadSlice</span><span class="op" id="3352510">(</span><span class="ident" id="3352511">delim</span>&nbsp;<span class="builtintype" id="3352517">byte</span><span class="op" id="3352521">)</span>&nbsp;<span class="op" id="3352523">(</span><span class="ident" id="3352524">line</span>&nbsp;<span class="op" id="3352529">[</span><span class="op" id="3352530">]</span><span class="builtintype" id="3352531">byte</span><span class="op" id="3352535">,</span>&nbsp;<span class="ident" id="3352537">err</span>&nbsp;<span class="builtintype" id="3352541">error</span><span class="op" id="3352546">)</span>&nbsp;<span class="op" id="3352548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352551">for</span>&nbsp;<span class="op" id="3352555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352559">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352579">if</span>&nbsp;<span class="ident" id="3352582">i</span>&nbsp;<span class="op" id="3352584">:=</span>&nbsp;<span class="ident" id="3352587">bytes</span><span class="op" id="3352592">.</span><span class="ident" id="3352593">IndexByte</span><span class="op" id="3352602">(</span><span class="ident" id="3352603">b</span><span class="op" id="3352604">.</span><span class="ident" id="3352605">buf</span><span class="op" id="3352608">[</span><span class="ident" id="3352609">b</span><span class="op" id="3352610">.</span><span class="ident" id="3352611">r</span><span class="op" id="3352612">:</span><span class="ident" id="3352613">b</span><span class="op" id="3352614">.</span><span class="ident" id="3352615">w</span><span class="op" id="3352616">]</span><span class="op" id="3352617">,</span>&nbsp;<span class="ident" id="3352619">delim</span><span class="op" id="3352624">)</span><span class="op" id="3352625">;</span>&nbsp;<span class="ident" id="3352627">i</span>&nbsp;<span class="op" id="3352629">&gt;=</span>&nbsp;<span class="num" id="3352632">0</span>&nbsp;<span class="op" id="3352634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352639">line</span>&nbsp;<span class="op" id="3352644">=</span>&nbsp;<span class="ident" id="3352646">b</span><span class="op" id="3352647">.</span><span class="ident" id="3352648">buf</span><span class="op" id="3352651">[</span><span class="ident" id="3352652">b</span><span class="op" id="3352653">.</span><span class="ident" id="3352654">r</span>&nbsp;<span class="op" id="3352656">:</span>&nbsp;<span class="ident" id="3352658">b</span><span class="op" id="3352659">.</span><span class="ident" id="3352660">r</span><span class="op" id="3352661">+</span><span class="ident" id="3352662">i</span><span class="op" id="3352663">+</span><span class="num" id="3352664">1</span><span class="op" id="3352665">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352670">b</span><span class="op" id="3352671">.</span><span class="ident" id="3352672">r</span>&nbsp;<span class="op" id="3352674">+=</span>&nbsp;<span class="ident" id="3352677">i</span>&nbsp;<span class="op" id="3352679">+</span>&nbsp;<span class="num" id="3352681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352686">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352699">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352719">if</span>&nbsp;<span class="ident" id="3352722">b</span><span class="op" id="3352723">.</span><span class="ident" id="3352724">err</span>&nbsp;<span class="op" id="3352728">!=</span>&nbsp;<span class="ident" id="3352731">nil</span>&nbsp;<span class="op" id="3352735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352740">line</span>&nbsp;<span class="op" id="3352745">=</span>&nbsp;<span class="ident" id="3352747">b</span><span class="op" id="3352748">.</span><span class="ident" id="3352749">buf</span><span class="op" id="3352752">[</span><span class="ident" id="3352753">b</span><span class="op" id="3352754">.</span><span class="ident" id="3352755">r</span><span class="op" id="3352756">:</span><span class="ident" id="3352757">b</span><span class="op" id="3352758">.</span><span class="ident" id="3352759">w</span><span class="op" id="3352760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352765">b</span><span class="op" id="3352766">.</span><span class="ident" id="3352767">r</span>&nbsp;<span class="op" id="3352769">=</span>&nbsp;<span class="ident" id="3352771">b</span><span class="op" id="3352772">.</span><span class="ident" id="3352773">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352778">err</span>&nbsp;<span class="op" id="3352782">=</span>&nbsp;<span class="ident" id="3352784">b</span><span class="op" id="3352785">.</span><span class="ident" id="3352786">readErr</span><span class="op" id="3352793">(</span><span class="op" id="3352794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352799">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352812">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352830">if</span>&nbsp;<span class="ident" id="3352833">b</span><span class="op" id="3352834">.</span><span class="ident" id="3352835">Buffered</span><span class="op" id="3352843">(</span><span class="op" id="3352844">)</span>&nbsp;<span class="op" id="3352846">&gt;=</span>&nbsp;<span class="builtinfunc" id="3352849">len</span><span class="op" id="3352852">(</span><span class="ident" id="3352853">b</span><span class="op" id="3352854">.</span><span class="ident" id="3352855">buf</span><span class="op" id="3352858">)</span>&nbsp;<span class="op" id="3352860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352865">b</span><span class="op" id="3352866">.</span><span class="ident" id="3352867">r</span>&nbsp;<span class="op" id="3352869">=</span>&nbsp;<span class="ident" id="3352871">b</span><span class="op" id="3352872">.</span><span class="ident" id="3352873">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352878">line</span>&nbsp;<span class="op" id="3352883">=</span>&nbsp;<span class="ident" id="3352885">b</span><span class="op" id="3352886">.</span><span class="ident" id="3352887">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352894">err</span>&nbsp;<span class="op" id="3352898">=</span>&nbsp;<span class="ident" id="3352900">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352917">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3352930">b</span><span class="op" id="3352931">.</span><span class="ident" id="3352932">fill</span><span class="op" id="3352936">(</span><span class="op" id="3352937">)</span>&nbsp;<span class="comment" id="3352939">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3352962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3352966">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352996">if</span>&nbsp;<span class="ident" id="3352999">i</span>&nbsp;<span class="op" id="3353001">:=</span>&nbsp;<span class="builtinfunc" id="3353004">len</span><span class="op" id="3353007">(</span><span class="ident" id="3353008">line</span><span class="op" id="3353012">)</span>&nbsp;<span class="op" id="3353014">-</span>&nbsp;<span class="num" id="3353016">1</span><span class="op" id="3353017">;</span>&nbsp;<span class="ident" id="3353019">i</span>&nbsp;<span class="op" id="3353021">&gt;=</span>&nbsp;<span class="num" id="3353024">0</span>&nbsp;<span class="op" id="3353026">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353030">b</span><span class="op" id="3353031">.</span><span class="ident" id="3353032">lastByte</span>&nbsp;<span class="op" id="3353041">=</span>&nbsp;<span class="builtintype" id="3353043">int</span><span class="op" id="3353046">(</span><span class="ident" id="3353047">line</span><span class="op" id="3353051">[</span><span class="ident" id="3353052">i</span><span class="op" id="3353053">]</span><span class="op" id="3353054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3353058">b</span><span class="op" id="3353059">.</span><span class="ident" id="3353060">lastRuneSize</span>&nbsp;<span class="op" id="3353073">=</span>&nbsp;<span class="op" id="3353075">-</span><span class="num" id="3353076">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3353079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3353083">return</span><br>
<span class="lineno">305</span><span class="op" id="3353090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3353093">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3353168">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="3353233">//</span><br>
<span class="lineno">310</span><span class="comment" id="3353236">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3353316">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3353388">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3353464">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="3353542">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="3353615">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="3353691">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="3353706">//</span><br>
<span class="lineno"></span><span class="comment" id="3353709">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="3353792">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="3353871">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3353946">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3354023">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="3354065">func</span>&nbsp;<span class="op" id="3354070">(</span><span class="ident" id="3354071">b</span>&nbsp;<span class="op" id="3354073">*</span><span class="ident" id="3354074">Reader</span><span class="op" id="3354080">)</span>&nbsp;<span class="ident" id="3354082">ReadLine</span><span class="op" id="3354090">(</span><span class="op" id="3354091">)</span>&nbsp;<span class="op" id="3354093">(</span><span class="ident" id="3354094">line</span>&nbsp;<span class="op" id="3354099">[</span><span class="op" id="3354100">]</span><span class="builtintype" id="3354101">byte</span><span class="op" id="3354105">,</span>&nbsp;<span class="ident" id="3354107">isPrefix</span>&nbsp;<span class="builtintype" id="3354116">bool</span><span class="op" id="3354120">,</span>&nbsp;<span class="ident" id="3354122">err</span>&nbsp;<span class="builtintype" id="3354126">error</span><span class="op" id="3354131">)</span>&nbsp;<span class="op" id="3354133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354136">line</span><span class="op" id="3354140">,</span>&nbsp;<span class="ident" id="3354142">err</span>&nbsp;<span class="op" id="3354146">=</span>&nbsp;<span class="ident" id="3354148">b</span><span class="op" id="3354149">.</span><span class="ident" id="3354150">ReadSlice</span><span class="op" id="3354159">(</span><span class="string" id="3354160">&#39;\n&#39;</span><span class="op" id="3354164">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354167">if</span>&nbsp;<span class="ident" id="3354170">err</span>&nbsp;<span class="op" id="3354174">==</span>&nbsp;<span class="ident" id="3354177">ErrBufferFull</span>&nbsp;<span class="op" id="3354191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354195">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354251">if</span>&nbsp;<span class="builtinfunc" id="3354254">len</span><span class="op" id="3354257">(</span><span class="ident" id="3354258">line</span><span class="op" id="3354262">)</span>&nbsp;<span class="op" id="3354264">&gt;</span>&nbsp;<span class="num" id="3354266">0</span>&nbsp;<span class="op" id="3354268">&amp;&amp;</span>&nbsp;<span class="ident" id="3354271">line</span><span class="op" id="3354275">[</span><span class="builtinfunc" id="3354276">len</span><span class="op" id="3354279">(</span><span class="ident" id="3354280">line</span><span class="op" id="3354284">)</span><span class="op" id="3354285">-</span><span class="num" id="3354286">1</span><span class="op" id="3354287">]</span>&nbsp;<span class="op" id="3354289">==</span>&nbsp;<span class="string" id="3354292">&#39;\r&#39;</span>&nbsp;<span class="op" id="3354297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354302">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354356">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354410">if</span>&nbsp;<span class="ident" id="3354413">b</span><span class="op" id="3354414">.</span><span class="ident" id="3354415">r</span>&nbsp;<span class="op" id="3354417">==</span>&nbsp;<span class="num" id="3354420">0</span>&nbsp;<span class="op" id="3354422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3354428">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3354457">panic</span><span class="op" id="3354462">(</span><span class="string" id="3354463">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="3354508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354518">b</span><span class="op" id="3354519">.</span><span class="ident" id="3354520">r</span><span class="op" id="3354521">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354527">line</span>&nbsp;<span class="op" id="3354532">=</span>&nbsp;<span class="ident" id="3354534">line</span><span class="op" id="3354538">[</span><span class="op" id="3354539">:</span><span class="builtinfunc" id="3354540">len</span><span class="op" id="3354543">(</span><span class="ident" id="3354544">line</span><span class="op" id="3354548">)</span><span class="op" id="3354549">-</span><span class="num" id="3354550">1</span><span class="op" id="3354551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354559">return</span>&nbsp;<span class="ident" id="3354566">line</span><span class="op" id="3354570">,</span>&nbsp;<span class="builtintype" id="3354572">true</span><span class="op" id="3354576">,</span>&nbsp;<span class="ident" id="3354578">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354587">if</span>&nbsp;<span class="builtinfunc" id="3354590">len</span><span class="op" id="3354593">(</span><span class="ident" id="3354594">line</span><span class="op" id="3354598">)</span>&nbsp;<span class="op" id="3354600">==</span>&nbsp;<span class="num" id="3354603">0</span>&nbsp;<span class="op" id="3354605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354609">if</span>&nbsp;<span class="ident" id="3354612">err</span>&nbsp;<span class="op" id="3354616">!=</span>&nbsp;<span class="ident" id="3354619">nil</span>&nbsp;<span class="op" id="3354623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354628">line</span>&nbsp;<span class="op" id="3354633">=</span>&nbsp;<span class="ident" id="3354635">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354645">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354656">err</span>&nbsp;<span class="op" id="3354660">=</span>&nbsp;<span class="ident" id="3354662">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354668">if</span>&nbsp;<span class="ident" id="3354671">line</span><span class="op" id="3354675">[</span><span class="builtinfunc" id="3354676">len</span><span class="op" id="3354679">(</span><span class="ident" id="3354680">line</span><span class="op" id="3354684">)</span><span class="op" id="3354685">-</span><span class="num" id="3354686">1</span><span class="op" id="3354687">]</span>&nbsp;<span class="op" id="3354689">==</span>&nbsp;<span class="string" id="3354692">&#39;\n&#39;</span>&nbsp;<span class="op" id="3354697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354701">drop</span>&nbsp;<span class="op" id="3354706">:=</span>&nbsp;<span class="num" id="3354709">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354713">if</span>&nbsp;<span class="builtinfunc" id="3354716">len</span><span class="op" id="3354719">(</span><span class="ident" id="3354720">line</span><span class="op" id="3354724">)</span>&nbsp;<span class="op" id="3354726">&gt;</span>&nbsp;<span class="num" id="3354728">1</span>&nbsp;<span class="op" id="3354730">&amp;&amp;</span>&nbsp;<span class="ident" id="3354733">line</span><span class="op" id="3354737">[</span><span class="builtinfunc" id="3354738">len</span><span class="op" id="3354741">(</span><span class="ident" id="3354742">line</span><span class="op" id="3354746">)</span><span class="op" id="3354747">-</span><span class="num" id="3354748">2</span><span class="op" id="3354749">]</span>&nbsp;<span class="op" id="3354751">==</span>&nbsp;<span class="string" id="3354754">&#39;\r&#39;</span>&nbsp;<span class="op" id="3354759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354764">drop</span>&nbsp;<span class="op" id="3354769">=</span>&nbsp;<span class="num" id="3354771">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3354779">line</span>&nbsp;<span class="op" id="3354784">=</span>&nbsp;<span class="ident" id="3354786">line</span><span class="op" id="3354790">[</span><span class="op" id="3354791">:</span><span class="builtinfunc" id="3354792">len</span><span class="op" id="3354795">(</span><span class="ident" id="3354796">line</span><span class="op" id="3354800">)</span><span class="op" id="3354801">-</span><span class="ident" id="3354802">drop</span><span class="op" id="3354806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3354809">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3354812">return</span><br>
<span class="lineno"></span><span class="op" id="3354819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3354822">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3354891">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="3354967">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3355031">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3355113">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3355194">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3355204">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="3355258">func</span>&nbsp;<span class="op" id="3355263">(</span><span class="ident" id="3355264">b</span>&nbsp;<span class="op" id="3355266">*</span><span class="ident" id="3355267">Reader</span><span class="op" id="3355273">)</span>&nbsp;<span class="ident" id="3355275">ReadBytes</span><span class="op" id="3355284">(</span><span class="ident" id="3355285">delim</span>&nbsp;<span class="builtintype" id="3355291">byte</span><span class="op" id="3355295">)</span>&nbsp;<span class="op" id="3355297">(</span><span class="ident" id="3355298">line</span>&nbsp;<span class="op" id="3355303">[</span><span class="op" id="3355304">]</span><span class="builtintype" id="3355305">byte</span><span class="op" id="3355309">,</span>&nbsp;<span class="ident" id="3355311">err</span>&nbsp;<span class="builtintype" id="3355315">error</span><span class="op" id="3355320">)</span>&nbsp;<span class="op" id="3355322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355325">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355362">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355393">var</span>&nbsp;<span class="ident" id="3355397">frag</span>&nbsp;<span class="op" id="3355402">[</span><span class="op" id="3355403">]</span><span class="builtintype" id="3355404">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355410">var</span>&nbsp;<span class="ident" id="3355414">full</span>&nbsp;<span class="op" id="3355419">[</span><span class="op" id="3355420">]</span><span class="op" id="3355421">[</span><span class="op" id="3355422">]</span><span class="builtintype" id="3355423">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355429">err</span>&nbsp;<span class="op" id="3355433">=</span>&nbsp;<span class="ident" id="3355435">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355441">for</span>&nbsp;<span class="op" id="3355445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355449">var</span>&nbsp;<span class="ident" id="3355453">e</span>&nbsp;<span class="builtintype" id="3355455">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355463">frag</span><span class="op" id="3355467">,</span>&nbsp;<span class="ident" id="3355469">e</span>&nbsp;<span class="op" id="3355471">=</span>&nbsp;<span class="ident" id="3355473">b</span><span class="op" id="3355474">.</span><span class="ident" id="3355475">ReadSlice</span><span class="op" id="3355484">(</span><span class="ident" id="3355485">delim</span><span class="op" id="3355490">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355494">if</span>&nbsp;<span class="ident" id="3355497">e</span>&nbsp;<span class="op" id="3355499">==</span>&nbsp;<span class="ident" id="3355502">nil</span>&nbsp;<span class="op" id="3355506">{</span>&nbsp;<span class="comment" id="3355508">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355533">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355545">if</span>&nbsp;<span class="ident" id="3355548">e</span>&nbsp;<span class="op" id="3355550">!=</span>&nbsp;<span class="ident" id="3355553">ErrBufferFull</span>&nbsp;<span class="op" id="3355567">{</span>&nbsp;<span class="comment" id="3355569">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355592">err</span>&nbsp;<span class="op" id="3355596">=</span>&nbsp;<span class="ident" id="3355598">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355603">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355616">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355648">buf</span>&nbsp;<span class="op" id="3355652">:=</span>&nbsp;<span class="builtinfunc" id="3355655">make</span><span class="op" id="3355659">(</span><span class="op" id="3355660">[</span><span class="op" id="3355661">]</span><span class="builtintype" id="3355662">byte</span><span class="op" id="3355666">,</span>&nbsp;<span class="builtinfunc" id="3355668">len</span><span class="op" id="3355671">(</span><span class="ident" id="3355672">frag</span><span class="op" id="3355676">)</span><span class="op" id="3355677">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3355681">copy</span><span class="op" id="3355685">(</span><span class="ident" id="3355686">buf</span><span class="op" id="3355689">,</span>&nbsp;<span class="ident" id="3355691">frag</span><span class="op" id="3355695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355699">full</span>&nbsp;<span class="op" id="3355704">=</span>&nbsp;<span class="builtinfunc" id="3355706">append</span><span class="op" id="3355712">(</span><span class="ident" id="3355713">full</span><span class="op" id="3355717">,</span>&nbsp;<span class="ident" id="3355719">buf</span><span class="op" id="3355722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355729">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355795">n</span>&nbsp;<span class="op" id="3355797">:=</span>&nbsp;<span class="num" id="3355800">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355803">for</span>&nbsp;<span class="ident" id="3355807">i</span>&nbsp;<span class="op" id="3355809">:=</span>&nbsp;<span class="keyword" id="3355812">range</span>&nbsp;<span class="ident" id="3355818">full</span>&nbsp;<span class="op" id="3355823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355827">n</span>&nbsp;<span class="op" id="3355829">+=</span>&nbsp;<span class="builtinfunc" id="3355832">len</span><span class="op" id="3355835">(</span><span class="ident" id="3355836">full</span><span class="op" id="3355840">[</span><span class="ident" id="3355841">i</span><span class="op" id="3355842">]</span><span class="op" id="3355843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355849">n</span>&nbsp;<span class="op" id="3355851">+=</span>&nbsp;<span class="builtinfunc" id="3355854">len</span><span class="op" id="3355857">(</span><span class="ident" id="3355858">frag</span><span class="op" id="3355862">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3355866">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355904">buf</span>&nbsp;<span class="op" id="3355908">:=</span>&nbsp;<span class="builtinfunc" id="3355911">make</span><span class="op" id="3355915">(</span><span class="op" id="3355916">[</span><span class="op" id="3355917">]</span><span class="builtintype" id="3355918">byte</span><span class="op" id="3355922">,</span>&nbsp;<span class="ident" id="3355924">n</span><span class="op" id="3355925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355928">n</span>&nbsp;<span class="op" id="3355930">=</span>&nbsp;<span class="num" id="3355932">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3355935">for</span>&nbsp;<span class="ident" id="3355939">i</span>&nbsp;<span class="op" id="3355941">:=</span>&nbsp;<span class="keyword" id="3355944">range</span>&nbsp;<span class="ident" id="3355950">full</span>&nbsp;<span class="op" id="3355955">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3355959">n</span>&nbsp;<span class="op" id="3355961">+=</span>&nbsp;<span class="builtinfunc" id="3355964">copy</span><span class="op" id="3355968">(</span><span class="ident" id="3355969">buf</span><span class="op" id="3355972">[</span><span class="ident" id="3355973">n</span><span class="op" id="3355974">:</span><span class="op" id="3355975">]</span><span class="op" id="3355976">,</span>&nbsp;<span class="ident" id="3355978">full</span><span class="op" id="3355982">[</span><span class="ident" id="3355983">i</span><span class="op" id="3355984">]</span><span class="op" id="3355985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3355988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3355991">copy</span><span class="op" id="3355995">(</span><span class="ident" id="3355996">buf</span><span class="op" id="3355999">[</span><span class="ident" id="3356000">n</span><span class="op" id="3356001">:</span><span class="op" id="3356002">]</span><span class="op" id="3356003">,</span>&nbsp;<span class="ident" id="3356005">frag</span><span class="op" id="3356009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356012">return</span>&nbsp;<span class="ident" id="3356019">buf</span><span class="op" id="3356022">,</span>&nbsp;<span class="ident" id="3356024">err</span><br>
<span class="lineno"></span><span class="op" id="3356028">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3356031">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3356101">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3356178">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3356243">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="3356325">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3356407">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3356417">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="3356471">func</span>&nbsp;<span class="op" id="3356476">(</span><span class="ident" id="3356477">b</span>&nbsp;<span class="op" id="3356479">*</span><span class="ident" id="3356480">Reader</span><span class="op" id="3356486">)</span>&nbsp;<span class="ident" id="3356488">ReadString</span><span class="op" id="3356498">(</span><span class="ident" id="3356499">delim</span>&nbsp;<span class="builtintype" id="3356505">byte</span><span class="op" id="3356509">)</span>&nbsp;<span class="op" id="3356511">(</span><span class="ident" id="3356512">line</span>&nbsp;<span class="builtintype" id="3356517">string</span><span class="op" id="3356523">,</span>&nbsp;<span class="ident" id="3356525">err</span>&nbsp;<span class="builtintype" id="3356529">error</span><span class="op" id="3356534">)</span>&nbsp;<span class="op" id="3356536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356539">bytes</span><span class="op" id="3356544">,</span>&nbsp;<span class="ident" id="3356546">err</span>&nbsp;<span class="op" id="3356550">:=</span>&nbsp;<span class="ident" id="3356553">b</span><span class="op" id="3356554">.</span><span class="ident" id="3356555">ReadBytes</span><span class="op" id="3356564">(</span><span class="ident" id="3356565">delim</span><span class="op" id="3356570">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356573">line</span>&nbsp;<span class="op" id="3356578">=</span>&nbsp;<span class="builtintype" id="3356580">string</span><span class="op" id="3356586">(</span><span class="ident" id="3356587">bytes</span><span class="op" id="3356592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356595">return</span>&nbsp;<span class="ident" id="3356602">line</span><span class="op" id="3356606">,</span>&nbsp;<span class="ident" id="3356608">err</span><br>
<span class="lineno"></span><span class="op" id="3356612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3356615">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="3356650">func</span>&nbsp;<span class="op" id="3356655">(</span><span class="ident" id="3356656">b</span>&nbsp;<span class="op" id="3356658">*</span><span class="ident" id="3356659">Reader</span><span class="op" id="3356665">)</span>&nbsp;<span class="ident" id="3356667">WriteTo</span><span class="op" id="3356674">(</span><span class="ident" id="3356675">w</span>&nbsp;<span class="ident" id="3356677">io</span><span class="op" id="3356679">.</span><span class="ident" id="3356680">Writer</span><span class="op" id="3356686">)</span>&nbsp;<span class="op" id="3356688">(</span><span class="ident" id="3356689">n</span>&nbsp;<span class="ident" id="3356691">int64</span><span class="op" id="3356696">,</span>&nbsp;<span class="ident" id="3356698">err</span>&nbsp;<span class="builtintype" id="3356702">error</span><span class="op" id="3356707">)</span>&nbsp;<span class="op" id="3356709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356712">n</span><span class="op" id="3356713">,</span>&nbsp;<span class="ident" id="3356715">err</span>&nbsp;<span class="op" id="3356719">=</span>&nbsp;<span class="ident" id="3356721">b</span><span class="op" id="3356722">.</span><span class="ident" id="3356723">writeBuf</span><span class="op" id="3356731">(</span><span class="ident" id="3356732">w</span><span class="op" id="3356733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356736">if</span>&nbsp;<span class="ident" id="3356739">err</span>&nbsp;<span class="op" id="3356743">!=</span>&nbsp;<span class="ident" id="3356746">nil</span>&nbsp;<span class="op" id="3356750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356754">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356762">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356766">if</span>&nbsp;<span class="ident" id="3356769">r</span><span class="op" id="3356770">,</span>&nbsp;<span class="ident" id="3356772">ok</span>&nbsp;<span class="op" id="3356775">:=</span>&nbsp;<span class="ident" id="3356778">b</span><span class="op" id="3356779">.</span><span class="ident" id="3356780">rd</span><span class="op" id="3356782">.</span><span class="op" id="3356783">(</span><span class="ident" id="3356784">io</span><span class="op" id="3356786">.</span><span class="ident" id="3356787">WriterTo</span><span class="op" id="3356795">)</span><span class="op" id="3356796">;</span>&nbsp;<span class="ident" id="3356798">ok</span>&nbsp;<span class="op" id="3356801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356805">m</span><span class="op" id="3356806">,</span>&nbsp;<span class="ident" id="3356808">err</span>&nbsp;<span class="op" id="3356812">:=</span>&nbsp;<span class="ident" id="3356815">r</span><span class="op" id="3356816">.</span><span class="ident" id="3356817">WriteTo</span><span class="op" id="3356824">(</span><span class="ident" id="3356825">w</span><span class="op" id="3356826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356830">n</span>&nbsp;<span class="op" id="3356832">+=</span>&nbsp;<span class="ident" id="3356835">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356839">return</span>&nbsp;<span class="ident" id="3356846">n</span><span class="op" id="3356847">,</span>&nbsp;<span class="ident" id="3356849">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356858">if</span>&nbsp;<span class="ident" id="3356861">w</span><span class="op" id="3356862">,</span>&nbsp;<span class="ident" id="3356864">ok</span>&nbsp;<span class="op" id="3356867">:=</span>&nbsp;<span class="ident" id="3356870">w</span><span class="op" id="3356871">.</span><span class="op" id="3356872">(</span><span class="ident" id="3356873">io</span><span class="op" id="3356875">.</span><span class="ident" id="3356876">ReaderFrom</span><span class="op" id="3356886">)</span><span class="op" id="3356887">;</span>&nbsp;<span class="ident" id="3356889">ok</span>&nbsp;<span class="op" id="3356892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356896">m</span><span class="op" id="3356897">,</span>&nbsp;<span class="ident" id="3356899">err</span>&nbsp;<span class="op" id="3356903">:=</span>&nbsp;<span class="ident" id="3356906">w</span><span class="op" id="3356907">.</span><span class="ident" id="3356908">ReadFrom</span><span class="op" id="3356916">(</span><span class="ident" id="3356917">b</span><span class="op" id="3356918">.</span><span class="ident" id="3356919">rd</span><span class="op" id="3356921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356925">n</span>&nbsp;<span class="op" id="3356927">+=</span>&nbsp;<span class="ident" id="3356930">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356934">return</span>&nbsp;<span class="ident" id="3356941">n</span><span class="op" id="3356942">,</span>&nbsp;<span class="ident" id="3356944">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3356949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3356953">if</span>&nbsp;<span class="ident" id="3356956">b</span><span class="op" id="3356957">.</span><span class="ident" id="3356958">w</span><span class="op" id="3356959">-</span><span class="ident" id="3356960">b</span><span class="op" id="3356961">.</span><span class="ident" id="3356962">r</span>&nbsp;<span class="op" id="3356964">&lt;</span>&nbsp;<span class="builtinfunc" id="3356966">len</span><span class="op" id="3356969">(</span><span class="ident" id="3356970">b</span><span class="op" id="3356971">.</span><span class="ident" id="3356972">buf</span><span class="op" id="3356975">)</span>&nbsp;<span class="op" id="3356977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3356981">b</span><span class="op" id="3356982">.</span><span class="ident" id="3356983">fill</span><span class="op" id="3356987">(</span><span class="op" id="3356988">)</span>&nbsp;<span class="comment" id="3356990">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357014">for</span>&nbsp;<span class="ident" id="3357018">b</span><span class="op" id="3357019">.</span><span class="ident" id="3357020">r</span>&nbsp;<span class="op" id="3357022">&lt;</span>&nbsp;<span class="ident" id="3357024">b</span><span class="op" id="3357025">.</span><span class="ident" id="3357026">w</span>&nbsp;<span class="op" id="3357028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3357032">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357070">m</span><span class="op" id="3357071">,</span>&nbsp;<span class="ident" id="3357073">err</span>&nbsp;<span class="op" id="3357077">:=</span>&nbsp;<span class="ident" id="3357080">b</span><span class="op" id="3357081">.</span><span class="ident" id="3357082">writeBuf</span><span class="op" id="3357090">(</span><span class="ident" id="3357091">w</span><span class="op" id="3357092">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357096">n</span>&nbsp;<span class="op" id="3357098">+=</span>&nbsp;<span class="ident" id="3357101">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357105">if</span>&nbsp;<span class="ident" id="3357108">err</span>&nbsp;<span class="op" id="3357112">!=</span>&nbsp;<span class="ident" id="3357115">nil</span>&nbsp;<span class="op" id="3357119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357124">return</span>&nbsp;<span class="ident" id="3357131">n</span><span class="op" id="3357132">,</span>&nbsp;<span class="ident" id="3357134">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357144">b</span><span class="op" id="3357145">.</span><span class="ident" id="3357146">fill</span><span class="op" id="3357150">(</span><span class="op" id="3357151">)</span>&nbsp;<span class="comment" id="3357153">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357177">if</span>&nbsp;<span class="ident" id="3357180">b</span><span class="op" id="3357181">.</span><span class="ident" id="3357182">err</span>&nbsp;<span class="op" id="3357186">==</span>&nbsp;<span class="ident" id="3357189">io</span><span class="op" id="3357191">.</span><span class="ident" id="3357192">EOF</span>&nbsp;<span class="op" id="3357196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357200">b</span><span class="op" id="3357201">.</span><span class="ident" id="3357202">err</span>&nbsp;<span class="op" id="3357206">=</span>&nbsp;<span class="ident" id="3357208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357213">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357217">return</span>&nbsp;<span class="ident" id="3357224">n</span><span class="op" id="3357225">,</span>&nbsp;<span class="ident" id="3357227">b</span><span class="op" id="3357228">.</span><span class="ident" id="3357229">readErr</span><span class="op" id="3357236">(</span><span class="op" id="3357237">)</span><br>
<span class="lineno"></span><span class="op" id="3357239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3357242">var</span>&nbsp;<span class="ident" id="3357246">errNegativeWrite</span>&nbsp;<span class="op" id="3357263">=</span>&nbsp;<span class="ident" id="3357265">errors</span><span class="op" id="3357271">.</span><span class="ident" id="3357272">New</span><span class="op" id="3357275">(</span><span class="string" id="3357276">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="3357326">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3357329">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3357383">func</span>&nbsp;<span class="op" id="3357388">(</span><span class="ident" id="3357389">b</span>&nbsp;<span class="op" id="3357391">*</span><span class="ident" id="3357392">Reader</span><span class="op" id="3357398">)</span>&nbsp;<span class="ident" id="3357400">writeBuf</span><span class="op" id="3357408">(</span><span class="ident" id="3357409">w</span>&nbsp;<span class="ident" id="3357411">io</span><span class="op" id="3357413">.</span><span class="ident" id="3357414">Writer</span><span class="op" id="3357420">)</span>&nbsp;<span class="op" id="3357422">(</span><span class="ident" id="3357423">int64</span><span class="op" id="3357428">,</span>&nbsp;<span class="builtintype" id="3357430">error</span><span class="op" id="3357435">)</span>&nbsp;<span class="op" id="3357437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357440">n</span><span class="op" id="3357441">,</span>&nbsp;<span class="ident" id="3357443">err</span>&nbsp;<span class="op" id="3357447">:=</span>&nbsp;<span class="ident" id="3357450">w</span><span class="op" id="3357451">.</span><span class="ident" id="3357452">Write</span><span class="op" id="3357457">(</span><span class="ident" id="3357458">b</span><span class="op" id="3357459">.</span><span class="ident" id="3357460">buf</span><span class="op" id="3357463">[</span><span class="ident" id="3357464">b</span><span class="op" id="3357465">.</span><span class="ident" id="3357466">r</span><span class="op" id="3357467">:</span><span class="ident" id="3357468">b</span><span class="op" id="3357469">.</span><span class="ident" id="3357470">w</span><span class="op" id="3357471">]</span><span class="op" id="3357472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357475">if</span>&nbsp;<span class="ident" id="3357478">n</span>&nbsp;<span class="op" id="3357480">&lt;</span>&nbsp;<span class="num" id="3357482">0</span>&nbsp;<span class="op" id="3357484">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3357488">panic</span><span class="op" id="3357493">(</span><span class="ident" id="3357494">errNegativeWrite</span><span class="op" id="3357510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3357513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357516">b</span><span class="op" id="3357517">.</span><span class="ident" id="3357518">r</span>&nbsp;<span class="op" id="3357520">+=</span>&nbsp;<span class="ident" id="3357523">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3357526">return</span>&nbsp;<span class="ident" id="3357533">int64</span><span class="op" id="3357538">(</span><span class="ident" id="3357539">n</span><span class="op" id="3357540">)</span><span class="op" id="3357541">,</span>&nbsp;<span class="ident" id="3357543">err</span><br>
<span class="lineno"></span><span class="op" id="3357547">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3357550">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3357570">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3357626">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="3357690">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3357751">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3357814">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3357874">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3357903">type</span>&nbsp;<span class="ident" id="3357908">Writer</span>&nbsp;<span class="keyword" id="3357915">struct</span>&nbsp;<span class="op" id="3357922">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357925">err</span>&nbsp;<span class="builtintype" id="3357929">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357936">buf</span>&nbsp;<span class="op" id="3357940">[</span><span class="op" id="3357941">]</span><span class="builtintype" id="3357942">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357948">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3357952">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3357957">wr</span>&nbsp;&nbsp;<span class="ident" id="3357961">io</span><span class="op" id="3357963">.</span><span class="ident" id="3357964">Writer</span><br>
<span class="lineno"></span><span class="op" id="3357971">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="3357974">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3358052">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="3358125">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3358168">func</span>&nbsp;<span class="ident" id="3358173">NewWriterSize</span><span class="op" id="3358186">(</span><span class="ident" id="3358187">w</span>&nbsp;<span class="ident" id="3358189">io</span><span class="op" id="3358191">.</span><span class="ident" id="3358192">Writer</span><span class="op" id="3358198">,</span>&nbsp;<span class="ident" id="3358200">size</span>&nbsp;<span class="builtintype" id="3358205">int</span><span class="op" id="3358208">)</span>&nbsp;<span class="op" id="3358210">*</span><span class="ident" id="3358211">Writer</span>&nbsp;<span class="op" id="3358218">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3358221">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358249">b</span><span class="op" id="3358250">,</span>&nbsp;<span class="ident" id="3358252">ok</span>&nbsp;<span class="op" id="3358255">:=</span>&nbsp;<span class="ident" id="3358258">w</span><span class="op" id="3358259">.</span><span class="op" id="3358260">(</span><span class="op" id="3358261">*</span><span class="ident" id="3358262">Writer</span><span class="op" id="3358268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358271">if</span>&nbsp;<span class="ident" id="3358274">ok</span>&nbsp;<span class="op" id="3358277">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3358280">len</span><span class="op" id="3358283">(</span><span class="ident" id="3358284">b</span><span class="op" id="3358285">.</span><span class="ident" id="3358286">buf</span><span class="op" id="3358289">)</span>&nbsp;<span class="op" id="3358291">&gt;=</span>&nbsp;<span class="ident" id="3358294">size</span>&nbsp;<span class="op" id="3358299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358303">return</span>&nbsp;<span class="ident" id="3358310">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358313">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358316">if</span>&nbsp;<span class="ident" id="3358319">size</span>&nbsp;<span class="op" id="3358324">&lt;=</span>&nbsp;<span class="num" id="3358327">0</span>&nbsp;<span class="op" id="3358329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358333">size</span>&nbsp;<span class="op" id="3358338">=</span>&nbsp;<span class="ident" id="3358340">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358359">return</span>&nbsp;<span class="op" id="3358366">&amp;</span><span class="ident" id="3358367">Writer</span><span class="op" id="3358373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358377">buf</span><span class="op" id="3358380">:</span>&nbsp;<span class="builtinfunc" id="3358382">make</span><span class="op" id="3358386">(</span><span class="op" id="3358387">[</span><span class="op" id="3358388">]</span><span class="builtintype" id="3358389">byte</span><span class="op" id="3358393">,</span>&nbsp;<span class="ident" id="3358395">size</span><span class="op" id="3358399">)</span><span class="op" id="3358400">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358404">wr</span><span class="op" id="3358406">:</span>&nbsp;&nbsp;<span class="ident" id="3358409">w</span><span class="op" id="3358410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358413">}</span><br>
<span class="lineno"></span><span class="op" id="3358415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358418">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="3358487">func</span>&nbsp;<span class="ident" id="3358492">NewWriter</span><span class="op" id="3358501">(</span><span class="ident" id="3358502">w</span>&nbsp;<span class="ident" id="3358504">io</span><span class="op" id="3358506">.</span><span class="ident" id="3358507">Writer</span><span class="op" id="3358513">)</span>&nbsp;<span class="op" id="3358515">*</span><span class="ident" id="3358516">Writer</span>&nbsp;<span class="op" id="3358523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358526">return</span>&nbsp;<span class="ident" id="3358533">NewWriterSize</span><span class="op" id="3358546">(</span><span class="ident" id="3358547">w</span><span class="op" id="3358548">,</span>&nbsp;<span class="ident" id="3358550">defaultBufSize</span><span class="op" id="3358564">)</span><br>
<span class="lineno"></span><span class="op" id="3358566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358569">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="3358638">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3358676">func</span>&nbsp;<span class="op" id="3358681">(</span><span class="ident" id="3358682">b</span>&nbsp;<span class="op" id="3358684">*</span><span class="ident" id="3358685">Writer</span><span class="op" id="3358691">)</span>&nbsp;<span class="ident" id="3358693">Reset</span><span class="op" id="3358698">(</span><span class="ident" id="3358699">w</span>&nbsp;<span class="ident" id="3358701">io</span><span class="op" id="3358703">.</span><span class="ident" id="3358704">Writer</span><span class="op" id="3358710">)</span>&nbsp;<span class="op" id="3358712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358715">b</span><span class="op" id="3358716">.</span><span class="ident" id="3358717">err</span>&nbsp;<span class="op" id="3358721">=</span>&nbsp;<span class="ident" id="3358723">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358728">b</span><span class="op" id="3358729">.</span><span class="ident" id="3358730">n</span>&nbsp;<span class="op" id="3358732">=</span>&nbsp;<span class="num" id="3358734">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358737">b</span><span class="op" id="3358738">.</span><span class="ident" id="3358739">wr</span>&nbsp;<span class="op" id="3358742">=</span>&nbsp;<span class="ident" id="3358744">w</span><br>
<span class="lineno">515</span><span class="op" id="3358746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3358749">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3358812">func</span>&nbsp;<span class="op" id="3358817">(</span><span class="ident" id="3358818">b</span>&nbsp;<span class="op" id="3358820">*</span><span class="ident" id="3358821">Writer</span><span class="op" id="3358827">)</span>&nbsp;<span class="ident" id="3358829">Flush</span><span class="op" id="3358834">(</span><span class="op" id="3358835">)</span>&nbsp;<span class="builtintype" id="3358837">error</span>&nbsp;<span class="op" id="3358843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358846">err</span>&nbsp;<span class="op" id="3358850">:=</span>&nbsp;<span class="ident" id="3358853">b</span><span class="op" id="3358854">.</span><span class="ident" id="3358855">flush</span><span class="op" id="3358860">(</span><span class="op" id="3358861">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358864">return</span>&nbsp;<span class="ident" id="3358871">err</span><br>
<span class="lineno"></span><span class="op" id="3358875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3358878">func</span>&nbsp;<span class="op" id="3358883">(</span><span class="ident" id="3358884">b</span>&nbsp;<span class="op" id="3358886">*</span><span class="ident" id="3358887">Writer</span><span class="op" id="3358893">)</span>&nbsp;<span class="ident" id="3358895">flush</span><span class="op" id="3358900">(</span><span class="op" id="3358901">)</span>&nbsp;<span class="builtintype" id="3358903">error</span>&nbsp;<span class="op" id="3358909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358912">if</span>&nbsp;<span class="ident" id="3358915">b</span><span class="op" id="3358916">.</span><span class="ident" id="3358917">err</span>&nbsp;<span class="op" id="3358921">!=</span>&nbsp;<span class="ident" id="3358924">nil</span>&nbsp;<span class="op" id="3358928">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358932">return</span>&nbsp;<span class="ident" id="3358939">b</span><span class="op" id="3358940">.</span><span class="ident" id="3358941">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358949">if</span>&nbsp;<span class="ident" id="3358952">b</span><span class="op" id="3358953">.</span><span class="ident" id="3358954">n</span>&nbsp;<span class="op" id="3358956">==</span>&nbsp;<span class="num" id="3358959">0</span>&nbsp;<span class="op" id="3358961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3358965">return</span>&nbsp;<span class="ident" id="3358972">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3358977">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3358980">n</span><span class="op" id="3358981">,</span>&nbsp;<span class="ident" id="3358983">err</span>&nbsp;<span class="op" id="3358987">:=</span>&nbsp;<span class="ident" id="3358990">b</span><span class="op" id="3358991">.</span><span class="ident" id="3358992">wr</span><span class="op" id="3358994">.</span><span class="ident" id="3358995">Write</span><span class="op" id="3359000">(</span><span class="ident" id="3359001">b</span><span class="op" id="3359002">.</span><span class="ident" id="3359003">buf</span><span class="op" id="3359006">[</span><span class="num" id="3359007">0</span><span class="op" id="3359008">:</span><span class="ident" id="3359009">b</span><span class="op" id="3359010">.</span><span class="ident" id="3359011">n</span><span class="op" id="3359012">]</span><span class="op" id="3359013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359016">if</span>&nbsp;<span class="ident" id="3359019">n</span>&nbsp;<span class="op" id="3359021">&lt;</span>&nbsp;<span class="ident" id="3359023">b</span><span class="op" id="3359024">.</span><span class="ident" id="3359025">n</span>&nbsp;<span class="op" id="3359027">&amp;&amp;</span>&nbsp;<span class="ident" id="3359030">err</span>&nbsp;<span class="op" id="3359034">==</span>&nbsp;<span class="ident" id="3359037">nil</span>&nbsp;<span class="op" id="3359041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359045">err</span>&nbsp;<span class="op" id="3359049">=</span>&nbsp;<span class="ident" id="3359051">io</span><span class="op" id="3359053">.</span><span class="ident" id="3359054">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359072">if</span>&nbsp;<span class="ident" id="3359075">err</span>&nbsp;<span class="op" id="3359079">!=</span>&nbsp;<span class="ident" id="3359082">nil</span>&nbsp;<span class="op" id="3359086">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359090">if</span>&nbsp;<span class="ident" id="3359093">n</span>&nbsp;<span class="op" id="3359095">&gt;</span>&nbsp;<span class="num" id="3359097">0</span>&nbsp;<span class="op" id="3359099">&amp;&amp;</span>&nbsp;<span class="ident" id="3359102">n</span>&nbsp;<span class="op" id="3359104">&lt;</span>&nbsp;<span class="ident" id="3359106">b</span><span class="op" id="3359107">.</span><span class="ident" id="3359108">n</span>&nbsp;<span class="op" id="3359110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3359115">copy</span><span class="op" id="3359119">(</span><span class="ident" id="3359120">b</span><span class="op" id="3359121">.</span><span class="ident" id="3359122">buf</span><span class="op" id="3359125">[</span><span class="num" id="3359126">0</span><span class="op" id="3359127">:</span><span class="ident" id="3359128">b</span><span class="op" id="3359129">.</span><span class="ident" id="3359130">n</span><span class="op" id="3359131">-</span><span class="ident" id="3359132">n</span><span class="op" id="3359133">]</span><span class="op" id="3359134">,</span>&nbsp;<span class="ident" id="3359136">b</span><span class="op" id="3359137">.</span><span class="ident" id="3359138">buf</span><span class="op" id="3359141">[</span><span class="ident" id="3359142">n</span><span class="op" id="3359143">:</span><span class="ident" id="3359144">b</span><span class="op" id="3359145">.</span><span class="ident" id="3359146">n</span><span class="op" id="3359147">]</span><span class="op" id="3359148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359156">b</span><span class="op" id="3359157">.</span><span class="ident" id="3359158">n</span>&nbsp;<span class="op" id="3359160">-=</span>&nbsp;<span class="ident" id="3359163">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359167">b</span><span class="op" id="3359168">.</span><span class="ident" id="3359169">err</span>&nbsp;<span class="op" id="3359173">=</span>&nbsp;<span class="ident" id="3359175">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359181">return</span>&nbsp;<span class="ident" id="3359188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359196">b</span><span class="op" id="3359197">.</span><span class="ident" id="3359198">n</span>&nbsp;<span class="op" id="3359200">=</span>&nbsp;<span class="num" id="3359202">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359205">return</span>&nbsp;<span class="ident" id="3359212">nil</span><br>
<span class="lineno"></span><span class="op" id="3359216">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3359219">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3359281">func</span>&nbsp;<span class="op" id="3359286">(</span><span class="ident" id="3359287">b</span>&nbsp;<span class="op" id="3359289">*</span><span class="ident" id="3359290">Writer</span><span class="op" id="3359296">)</span>&nbsp;<span class="ident" id="3359298">Available</span><span class="op" id="3359307">(</span><span class="op" id="3359308">)</span>&nbsp;<span class="builtintype" id="3359310">int</span>&nbsp;<span class="op" id="3359314">{</span>&nbsp;<span class="keyword" id="3359316">return</span>&nbsp;<span class="builtinfunc" id="3359323">len</span><span class="op" id="3359326">(</span><span class="ident" id="3359327">b</span><span class="op" id="3359328">.</span><span class="ident" id="3359329">buf</span><span class="op" id="3359332">)</span>&nbsp;<span class="op" id="3359334">-</span>&nbsp;<span class="ident" id="3359336">b</span><span class="op" id="3359337">.</span><span class="ident" id="3359338">n</span>&nbsp;<span class="op" id="3359340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3359343">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="3359431">func</span>&nbsp;<span class="op" id="3359436">(</span><span class="ident" id="3359437">b</span>&nbsp;<span class="op" id="3359439">*</span><span class="ident" id="3359440">Writer</span><span class="op" id="3359446">)</span>&nbsp;<span class="ident" id="3359448">Buffered</span><span class="op" id="3359456">(</span><span class="op" id="3359457">)</span>&nbsp;<span class="builtintype" id="3359459">int</span>&nbsp;<span class="op" id="3359463">{</span>&nbsp;<span class="keyword" id="3359465">return</span>&nbsp;<span class="ident" id="3359472">b</span><span class="op" id="3359473">.</span><span class="ident" id="3359474">n</span>&nbsp;<span class="op" id="3359476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3359479">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3359530">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3359573">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="3359628">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3359655">func</span>&nbsp;<span class="op" id="3359660">(</span><span class="ident" id="3359661">b</span>&nbsp;<span class="op" id="3359663">*</span><span class="ident" id="3359664">Writer</span><span class="op" id="3359670">)</span>&nbsp;<span class="ident" id="3359672">Write</span><span class="op" id="3359677">(</span><span class="ident" id="3359678">p</span>&nbsp;<span class="op" id="3359680">[</span><span class="op" id="3359681">]</span><span class="builtintype" id="3359682">byte</span><span class="op" id="3359686">)</span>&nbsp;<span class="op" id="3359688">(</span><span class="ident" id="3359689">nn</span>&nbsp;<span class="builtintype" id="3359692">int</span><span class="op" id="3359695">,</span>&nbsp;<span class="ident" id="3359697">err</span>&nbsp;<span class="builtintype" id="3359701">error</span><span class="op" id="3359706">)</span>&nbsp;<span class="op" id="3359708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359711">for</span>&nbsp;<span class="builtinfunc" id="3359715">len</span><span class="op" id="3359718">(</span><span class="ident" id="3359719">p</span><span class="op" id="3359720">)</span>&nbsp;<span class="op" id="3359722">&gt;</span>&nbsp;<span class="ident" id="3359724">b</span><span class="op" id="3359725">.</span><span class="ident" id="3359726">Available</span><span class="op" id="3359735">(</span><span class="op" id="3359736">)</span>&nbsp;<span class="op" id="3359738">&amp;&amp;</span>&nbsp;<span class="ident" id="3359741">b</span><span class="op" id="3359742">.</span><span class="ident" id="3359743">err</span>&nbsp;<span class="op" id="3359747">==</span>&nbsp;<span class="ident" id="3359750">nil</span>&nbsp;<span class="op" id="3359754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359758">var</span>&nbsp;<span class="ident" id="3359762">n</span>&nbsp;<span class="builtintype" id="3359764">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359770">if</span>&nbsp;<span class="ident" id="3359773">b</span><span class="op" id="3359774">.</span><span class="ident" id="3359775">Buffered</span><span class="op" id="3359783">(</span><span class="op" id="3359784">)</span>&nbsp;<span class="op" id="3359786">==</span>&nbsp;<span class="num" id="3359789">0</span>&nbsp;<span class="op" id="3359791">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359796">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3359829">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359872">n</span><span class="op" id="3359873">,</span>&nbsp;<span class="ident" id="3359875">b</span><span class="op" id="3359876">.</span><span class="ident" id="3359877">err</span>&nbsp;<span class="op" id="3359881">=</span>&nbsp;<span class="ident" id="3359883">b</span><span class="op" id="3359884">.</span><span class="ident" id="3359885">wr</span><span class="op" id="3359887">.</span><span class="ident" id="3359888">Write</span><span class="op" id="3359893">(</span><span class="ident" id="3359894">p</span><span class="op" id="3359895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359899">}</span>&nbsp;<span class="keyword" id="3359901">else</span>&nbsp;<span class="op" id="3359906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359911">n</span>&nbsp;<span class="op" id="3359913">=</span>&nbsp;<span class="builtinfunc" id="3359915">copy</span><span class="op" id="3359919">(</span><span class="ident" id="3359920">b</span><span class="op" id="3359921">.</span><span class="ident" id="3359922">buf</span><span class="op" id="3359925">[</span><span class="ident" id="3359926">b</span><span class="op" id="3359927">.</span><span class="ident" id="3359928">n</span><span class="op" id="3359929">:</span><span class="op" id="3359930">]</span><span class="op" id="3359931">,</span>&nbsp;<span class="ident" id="3359933">p</span><span class="op" id="3359934">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359939">b</span><span class="op" id="3359940">.</span><span class="ident" id="3359941">n</span>&nbsp;<span class="op" id="3359943">+=</span>&nbsp;<span class="ident" id="3359946">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359951">b</span><span class="op" id="3359952">.</span><span class="ident" id="3359953">flush</span><span class="op" id="3359958">(</span><span class="op" id="3359959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359967">nn</span>&nbsp;<span class="op" id="3359970">+=</span>&nbsp;<span class="ident" id="3359973">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3359977">p</span>&nbsp;<span class="op" id="3359979">=</span>&nbsp;<span class="ident" id="3359981">p</span><span class="op" id="3359982">[</span><span class="ident" id="3359983">n</span><span class="op" id="3359984">:</span><span class="op" id="3359985">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3359988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3359991">if</span>&nbsp;<span class="ident" id="3359994">b</span><span class="op" id="3359995">.</span><span class="ident" id="3359996">err</span>&nbsp;<span class="op" id="3360000">!=</span>&nbsp;<span class="ident" id="3360003">nil</span>&nbsp;<span class="op" id="3360007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360011">return</span>&nbsp;<span class="ident" id="3360018">nn</span><span class="op" id="3360020">,</span>&nbsp;<span class="ident" id="3360022">b</span><span class="op" id="3360023">.</span><span class="ident" id="3360024">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360032">n</span>&nbsp;<span class="op" id="3360034">:=</span>&nbsp;<span class="builtinfunc" id="3360037">copy</span><span class="op" id="3360041">(</span><span class="ident" id="3360042">b</span><span class="op" id="3360043">.</span><span class="ident" id="3360044">buf</span><span class="op" id="3360047">[</span><span class="ident" id="3360048">b</span><span class="op" id="3360049">.</span><span class="ident" id="3360050">n</span><span class="op" id="3360051">:</span><span class="op" id="3360052">]</span><span class="op" id="3360053">,</span>&nbsp;<span class="ident" id="3360055">p</span><span class="op" id="3360056">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360059">b</span><span class="op" id="3360060">.</span><span class="ident" id="3360061">n</span>&nbsp;<span class="op" id="3360063">+=</span>&nbsp;<span class="ident" id="3360066">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360069">nn</span>&nbsp;<span class="op" id="3360072">+=</span>&nbsp;<span class="ident" id="3360075">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360078">return</span>&nbsp;<span class="ident" id="3360085">nn</span><span class="op" id="3360087">,</span>&nbsp;<span class="ident" id="3360089">nil</span><br>
<span class="lineno"></span><span class="op" id="3360093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3360096">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3360131">func</span>&nbsp;<span class="op" id="3360136">(</span><span class="ident" id="3360137">b</span>&nbsp;<span class="op" id="3360139">*</span><span class="ident" id="3360140">Writer</span><span class="op" id="3360146">)</span>&nbsp;<span class="ident" id="3360148">WriteByte</span><span class="op" id="3360157">(</span><span class="ident" id="3360158">c</span>&nbsp;<span class="builtintype" id="3360160">byte</span><span class="op" id="3360164">)</span>&nbsp;<span class="builtintype" id="3360166">error</span>&nbsp;<span class="op" id="3360172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360175">if</span>&nbsp;<span class="ident" id="3360178">b</span><span class="op" id="3360179">.</span><span class="ident" id="3360180">err</span>&nbsp;<span class="op" id="3360184">!=</span>&nbsp;<span class="ident" id="3360187">nil</span>&nbsp;<span class="op" id="3360191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360195">return</span>&nbsp;<span class="ident" id="3360202">b</span><span class="op" id="3360203">.</span><span class="ident" id="3360204">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360209">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360212">if</span>&nbsp;<span class="ident" id="3360215">b</span><span class="op" id="3360216">.</span><span class="ident" id="3360217">Available</span><span class="op" id="3360226">(</span><span class="op" id="3360227">)</span>&nbsp;<span class="op" id="3360229">&lt;=</span>&nbsp;<span class="num" id="3360232">0</span>&nbsp;<span class="op" id="3360234">&amp;&amp;</span>&nbsp;<span class="ident" id="3360237">b</span><span class="op" id="3360238">.</span><span class="ident" id="3360239">flush</span><span class="op" id="3360244">(</span><span class="op" id="3360245">)</span>&nbsp;<span class="op" id="3360247">!=</span>&nbsp;<span class="ident" id="3360250">nil</span>&nbsp;<span class="op" id="3360254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360258">return</span>&nbsp;<span class="ident" id="3360265">b</span><span class="op" id="3360266">.</span><span class="ident" id="3360267">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360275">b</span><span class="op" id="3360276">.</span><span class="ident" id="3360277">buf</span><span class="op" id="3360280">[</span><span class="ident" id="3360281">b</span><span class="op" id="3360282">.</span><span class="ident" id="3360283">n</span><span class="op" id="3360284">]</span>&nbsp;<span class="op" id="3360286">=</span>&nbsp;<span class="ident" id="3360288">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360291">b</span><span class="op" id="3360292">.</span><span class="ident" id="3360293">n</span><span class="op" id="3360294">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360298">return</span>&nbsp;<span class="ident" id="3360305">nil</span><br>
<span class="lineno"></span><span class="op" id="3360309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3360312">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="3360371">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="3360417">func</span>&nbsp;<span class="op" id="3360422">(</span><span class="ident" id="3360423">b</span>&nbsp;<span class="op" id="3360425">*</span><span class="ident" id="3360426">Writer</span><span class="op" id="3360432">)</span>&nbsp;<span class="ident" id="3360434">WriteRune</span><span class="op" id="3360443">(</span><span class="ident" id="3360444">r</span>&nbsp;<span class="builtintype" id="3360446">rune</span><span class="op" id="3360450">)</span>&nbsp;<span class="op" id="3360452">(</span><span class="ident" id="3360453">size</span>&nbsp;<span class="builtintype" id="3360458">int</span><span class="op" id="3360461">,</span>&nbsp;<span class="ident" id="3360463">err</span>&nbsp;<span class="builtintype" id="3360467">error</span><span class="op" id="3360472">)</span>&nbsp;<span class="op" id="3360474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360477">if</span>&nbsp;<span class="ident" id="3360480">r</span>&nbsp;<span class="op" id="3360482">&lt;</span>&nbsp;<span class="ident" id="3360484">utf8</span><span class="op" id="3360488">.</span><span class="ident" id="3360489">RuneSelf</span>&nbsp;<span class="op" id="3360498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360502">err</span>&nbsp;<span class="op" id="3360506">=</span>&nbsp;<span class="ident" id="3360508">b</span><span class="op" id="3360509">.</span><span class="ident" id="3360510">WriteByte</span><span class="op" id="3360519">(</span><span class="builtintype" id="3360520">byte</span><span class="op" id="3360524">(</span><span class="ident" id="3360525">r</span><span class="op" id="3360526">)</span><span class="op" id="3360527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360531">if</span>&nbsp;<span class="ident" id="3360534">err</span>&nbsp;<span class="op" id="3360538">!=</span>&nbsp;<span class="ident" id="3360541">nil</span>&nbsp;<span class="op" id="3360545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360550">return</span>&nbsp;<span class="num" id="3360557">0</span><span class="op" id="3360558">,</span>&nbsp;<span class="ident" id="3360560">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360570">return</span>&nbsp;<span class="num" id="3360577">1</span><span class="op" id="3360578">,</span>&nbsp;<span class="ident" id="3360580">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360588">if</span>&nbsp;<span class="ident" id="3360591">b</span><span class="op" id="3360592">.</span><span class="ident" id="3360593">err</span>&nbsp;<span class="op" id="3360597">!=</span>&nbsp;<span class="ident" id="3360600">nil</span>&nbsp;<span class="op" id="3360604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360608">return</span>&nbsp;<span class="num" id="3360615">0</span><span class="op" id="3360616">,</span>&nbsp;<span class="ident" id="3360618">b</span><span class="op" id="3360619">.</span><span class="ident" id="3360620">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360628">n</span>&nbsp;<span class="op" id="3360630">:=</span>&nbsp;<span class="ident" id="3360633">b</span><span class="op" id="3360634">.</span><span class="ident" id="3360635">Available</span><span class="op" id="3360644">(</span><span class="op" id="3360645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360648">if</span>&nbsp;<span class="ident" id="3360651">n</span>&nbsp;<span class="op" id="3360653">&lt;</span>&nbsp;<span class="ident" id="3360655">utf8</span><span class="op" id="3360659">.</span><span class="ident" id="3360660">UTFMax</span>&nbsp;<span class="op" id="3360667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360671">if</span>&nbsp;<span class="ident" id="3360674">b</span><span class="op" id="3360675">.</span><span class="ident" id="3360676">flush</span><span class="op" id="3360681">(</span><span class="op" id="3360682">)</span><span class="op" id="3360683">;</span>&nbsp;<span class="ident" id="3360685">b</span><span class="op" id="3360686">.</span><span class="ident" id="3360687">err</span>&nbsp;<span class="op" id="3360691">!=</span>&nbsp;<span class="ident" id="3360694">nil</span>&nbsp;<span class="op" id="3360698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360703">return</span>&nbsp;<span class="num" id="3360710">0</span><span class="op" id="3360711">,</span>&nbsp;<span class="ident" id="3360713">b</span><span class="op" id="3360714">.</span><span class="ident" id="3360715">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360725">n</span>&nbsp;<span class="op" id="3360727">=</span>&nbsp;<span class="ident" id="3360729">b</span><span class="op" id="3360730">.</span><span class="ident" id="3360731">Available</span><span class="op" id="3360740">(</span><span class="op" id="3360741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360745">if</span>&nbsp;<span class="ident" id="3360748">n</span>&nbsp;<span class="op" id="3360750">&lt;</span>&nbsp;<span class="ident" id="3360752">utf8</span><span class="op" id="3360756">.</span><span class="ident" id="3360757">UTFMax</span>&nbsp;<span class="op" id="3360764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3360769">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360817">return</span>&nbsp;<span class="ident" id="3360824">b</span><span class="op" id="3360825">.</span><span class="ident" id="3360826">WriteString</span><span class="op" id="3360837">(</span><span class="builtintype" id="3360838">string</span><span class="op" id="3360844">(</span><span class="ident" id="3360845">r</span><span class="op" id="3360846">)</span><span class="op" id="3360847">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3360854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360857">size</span>&nbsp;<span class="op" id="3360862">=</span>&nbsp;<span class="ident" id="3360864">utf8</span><span class="op" id="3360868">.</span><span class="ident" id="3360869">EncodeRune</span><span class="op" id="3360879">(</span><span class="ident" id="3360880">b</span><span class="op" id="3360881">.</span><span class="ident" id="3360882">buf</span><span class="op" id="3360885">[</span><span class="ident" id="3360886">b</span><span class="op" id="3360887">.</span><span class="ident" id="3360888">n</span><span class="op" id="3360889">:</span><span class="op" id="3360890">]</span><span class="op" id="3360891">,</span>&nbsp;<span class="ident" id="3360893">r</span><span class="op" id="3360894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3360897">b</span><span class="op" id="3360898">.</span><span class="ident" id="3360899">n</span>&nbsp;<span class="op" id="3360901">+=</span>&nbsp;<span class="ident" id="3360904">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3360910">return</span>&nbsp;<span class="ident" id="3360917">size</span><span class="op" id="3360921">,</span>&nbsp;<span class="ident" id="3360923">nil</span><br>
<span class="lineno">620</span><span class="op" id="3360927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3360930">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3360962">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3361005">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="3361078">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3361105">func</span>&nbsp;<span class="op" id="3361110">(</span><span class="ident" id="3361111">b</span>&nbsp;<span class="op" id="3361113">*</span><span class="ident" id="3361114">Writer</span><span class="op" id="3361120">)</span>&nbsp;<span class="ident" id="3361122">WriteString</span><span class="op" id="3361133">(</span><span class="ident" id="3361134">s</span>&nbsp;<span class="builtintype" id="3361136">string</span><span class="op" id="3361142">)</span>&nbsp;<span class="op" id="3361144">(</span><span class="builtintype" id="3361145">int</span><span class="op" id="3361148">,</span>&nbsp;<span class="builtintype" id="3361150">error</span><span class="op" id="3361155">)</span>&nbsp;<span class="op" id="3361157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361160">nn</span>&nbsp;<span class="op" id="3361163">:=</span>&nbsp;<span class="num" id="3361166">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361169">for</span>&nbsp;<span class="builtinfunc" id="3361173">len</span><span class="op" id="3361176">(</span><span class="ident" id="3361177">s</span><span class="op" id="3361178">)</span>&nbsp;<span class="op" id="3361180">&gt;</span>&nbsp;<span class="ident" id="3361182">b</span><span class="op" id="3361183">.</span><span class="ident" id="3361184">Available</span><span class="op" id="3361193">(</span><span class="op" id="3361194">)</span>&nbsp;<span class="op" id="3361196">&amp;&amp;</span>&nbsp;<span class="ident" id="3361199">b</span><span class="op" id="3361200">.</span><span class="ident" id="3361201">err</span>&nbsp;<span class="op" id="3361205">==</span>&nbsp;<span class="ident" id="3361208">nil</span>&nbsp;<span class="op" id="3361212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361216">n</span>&nbsp;<span class="op" id="3361218">:=</span>&nbsp;<span class="builtinfunc" id="3361221">copy</span><span class="op" id="3361225">(</span><span class="ident" id="3361226">b</span><span class="op" id="3361227">.</span><span class="ident" id="3361228">buf</span><span class="op" id="3361231">[</span><span class="ident" id="3361232">b</span><span class="op" id="3361233">.</span><span class="ident" id="3361234">n</span><span class="op" id="3361235">:</span><span class="op" id="3361236">]</span><span class="op" id="3361237">,</span>&nbsp;<span class="ident" id="3361239">s</span><span class="op" id="3361240">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361244">b</span><span class="op" id="3361245">.</span><span class="ident" id="3361246">n</span>&nbsp;<span class="op" id="3361248">+=</span>&nbsp;<span class="ident" id="3361251">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361255">nn</span>&nbsp;<span class="op" id="3361258">+=</span>&nbsp;<span class="ident" id="3361261">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361265">s</span>&nbsp;<span class="op" id="3361267">=</span>&nbsp;<span class="ident" id="3361269">s</span><span class="op" id="3361270">[</span><span class="ident" id="3361271">n</span><span class="op" id="3361272">:</span><span class="op" id="3361273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361277">b</span><span class="op" id="3361278">.</span><span class="ident" id="3361279">flush</span><span class="op" id="3361284">(</span><span class="op" id="3361285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361288">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361291">if</span>&nbsp;<span class="ident" id="3361294">b</span><span class="op" id="3361295">.</span><span class="ident" id="3361296">err</span>&nbsp;<span class="op" id="3361300">!=</span>&nbsp;<span class="ident" id="3361303">nil</span>&nbsp;<span class="op" id="3361307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361311">return</span>&nbsp;<span class="ident" id="3361318">nn</span><span class="op" id="3361320">,</span>&nbsp;<span class="ident" id="3361322">b</span><span class="op" id="3361323">.</span><span class="ident" id="3361324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361332">n</span>&nbsp;<span class="op" id="3361334">:=</span>&nbsp;<span class="builtinfunc" id="3361337">copy</span><span class="op" id="3361341">(</span><span class="ident" id="3361342">b</span><span class="op" id="3361343">.</span><span class="ident" id="3361344">buf</span><span class="op" id="3361347">[</span><span class="ident" id="3361348">b</span><span class="op" id="3361349">.</span><span class="ident" id="3361350">n</span><span class="op" id="3361351">:</span><span class="op" id="3361352">]</span><span class="op" id="3361353">,</span>&nbsp;<span class="ident" id="3361355">s</span><span class="op" id="3361356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361359">b</span><span class="op" id="3361360">.</span><span class="ident" id="3361361">n</span>&nbsp;<span class="op" id="3361363">+=</span>&nbsp;<span class="ident" id="3361366">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361369">nn</span>&nbsp;<span class="op" id="3361372">+=</span>&nbsp;<span class="ident" id="3361375">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361378">return</span>&nbsp;<span class="ident" id="3361385">nn</span><span class="op" id="3361387">,</span>&nbsp;<span class="ident" id="3361389">nil</span><br>
<span class="lineno"></span><span class="op" id="3361393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3361396">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="3361434">func</span>&nbsp;<span class="op" id="3361439">(</span><span class="ident" id="3361440">b</span>&nbsp;<span class="op" id="3361442">*</span><span class="ident" id="3361443">Writer</span><span class="op" id="3361449">)</span>&nbsp;<span class="ident" id="3361451">ReadFrom</span><span class="op" id="3361459">(</span><span class="ident" id="3361460">r</span>&nbsp;<span class="ident" id="3361462">io</span><span class="op" id="3361464">.</span><span class="ident" id="3361465">Reader</span><span class="op" id="3361471">)</span>&nbsp;<span class="op" id="3361473">(</span><span class="ident" id="3361474">n</span>&nbsp;<span class="ident" id="3361476">int64</span><span class="op" id="3361481">,</span>&nbsp;<span class="ident" id="3361483">err</span>&nbsp;<span class="builtintype" id="3361487">error</span><span class="op" id="3361492">)</span>&nbsp;<span class="op" id="3361494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361497">if</span>&nbsp;<span class="ident" id="3361500">b</span><span class="op" id="3361501">.</span><span class="ident" id="3361502">Buffered</span><span class="op" id="3361510">(</span><span class="op" id="3361511">)</span>&nbsp;<span class="op" id="3361513">==</span>&nbsp;<span class="num" id="3361516">0</span>&nbsp;<span class="op" id="3361518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361522">if</span>&nbsp;<span class="ident" id="3361525">w</span><span class="op" id="3361526">,</span>&nbsp;<span class="ident" id="3361528">ok</span>&nbsp;<span class="op" id="3361531">:=</span>&nbsp;<span class="ident" id="3361534">b</span><span class="op" id="3361535">.</span><span class="ident" id="3361536">wr</span><span class="op" id="3361538">.</span><span class="op" id="3361539">(</span><span class="ident" id="3361540">io</span><span class="op" id="3361542">.</span><span class="ident" id="3361543">ReaderFrom</span><span class="op" id="3361553">)</span><span class="op" id="3361554">;</span>&nbsp;<span class="ident" id="3361556">ok</span>&nbsp;<span class="op" id="3361559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361564">return</span>&nbsp;<span class="ident" id="3361571">w</span><span class="op" id="3361572">.</span><span class="ident" id="3361573">ReadFrom</span><span class="op" id="3361581">(</span><span class="ident" id="3361582">r</span><span class="op" id="3361583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361587">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361593">var</span>&nbsp;<span class="ident" id="3361597">m</span>&nbsp;<span class="builtintype" id="3361599">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361604">for</span>&nbsp;<span class="op" id="3361608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361612">if</span>&nbsp;<span class="ident" id="3361615">b</span><span class="op" id="3361616">.</span><span class="ident" id="3361617">Available</span><span class="op" id="3361626">(</span><span class="op" id="3361627">)</span>&nbsp;<span class="op" id="3361629">==</span>&nbsp;<span class="num" id="3361632">0</span>&nbsp;<span class="op" id="3361634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361639">if</span>&nbsp;<span class="ident" id="3361642">err1</span>&nbsp;<span class="op" id="3361647">:=</span>&nbsp;<span class="ident" id="3361650">b</span><span class="op" id="3361651">.</span><span class="ident" id="3361652">flush</span><span class="op" id="3361657">(</span><span class="op" id="3361658">)</span><span class="op" id="3361659">;</span>&nbsp;<span class="ident" id="3361661">err1</span>&nbsp;<span class="op" id="3361666">!=</span>&nbsp;<span class="ident" id="3361669">nil</span>&nbsp;<span class="op" id="3361673">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361679">return</span>&nbsp;<span class="ident" id="3361686">n</span><span class="op" id="3361687">,</span>&nbsp;<span class="ident" id="3361689">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361705">nr</span>&nbsp;<span class="op" id="3361708">:=</span>&nbsp;<span class="num" id="3361711">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361715">for</span>&nbsp;<span class="ident" id="3361719">nr</span>&nbsp;<span class="op" id="3361722">&lt;</span>&nbsp;<span class="ident" id="3361724">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3361749">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361754">m</span><span class="op" id="3361755">,</span>&nbsp;<span class="ident" id="3361757">err</span>&nbsp;<span class="op" id="3361761">=</span>&nbsp;<span class="ident" id="3361763">r</span><span class="op" id="3361764">.</span><span class="ident" id="3361765">Read</span><span class="op" id="3361769">(</span><span class="ident" id="3361770">b</span><span class="op" id="3361771">.</span><span class="ident" id="3361772">buf</span><span class="op" id="3361775">[</span><span class="ident" id="3361776">b</span><span class="op" id="3361777">.</span><span class="ident" id="3361778">n</span><span class="op" id="3361779">:</span><span class="op" id="3361780">]</span><span class="op" id="3361781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361786">if</span>&nbsp;<span class="ident" id="3361789">m</span>&nbsp;<span class="op" id="3361791">!=</span>&nbsp;<span class="num" id="3361794">0</span>&nbsp;<span class="op" id="3361796">||</span>&nbsp;<span class="ident" id="3361799">err</span>&nbsp;<span class="op" id="3361803">!=</span>&nbsp;<span class="ident" id="3361806">nil</span>&nbsp;<span class="op" id="3361810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361816">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361830">nr</span><span class="op" id="3361832">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361841">if</span>&nbsp;<span class="ident" id="3361844">nr</span>&nbsp;<span class="op" id="3361847">==</span>&nbsp;<span class="ident" id="3361850">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3361875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361880">return</span>&nbsp;<span class="ident" id="3361887">n</span><span class="op" id="3361888">,</span>&nbsp;<span class="ident" id="3361890">io</span><span class="op" id="3361892">.</span><span class="ident" id="3361893">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361913">b</span><span class="op" id="3361914">.</span><span class="ident" id="3361915">n</span>&nbsp;<span class="op" id="3361917">+=</span>&nbsp;<span class="ident" id="3361920">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3361924">n</span>&nbsp;<span class="op" id="3361926">+=</span>&nbsp;<span class="ident" id="3361929">int64</span><span class="op" id="3361934">(</span><span class="ident" id="3361935">m</span><span class="op" id="3361936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361940">if</span>&nbsp;<span class="ident" id="3361943">err</span>&nbsp;<span class="op" id="3361947">!=</span>&nbsp;<span class="ident" id="3361950">nil</span>&nbsp;<span class="op" id="3361954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361959">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3361970">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3361973">if</span>&nbsp;<span class="ident" id="3361976">err</span>&nbsp;<span class="op" id="3361980">==</span>&nbsp;<span class="ident" id="3361983">io</span><span class="op" id="3361985">.</span><span class="ident" id="3361986">EOF</span>&nbsp;<span class="op" id="3361990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3361994">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362053">if</span>&nbsp;<span class="ident" id="3362056">b</span><span class="op" id="3362057">.</span><span class="ident" id="3362058">Available</span><span class="op" id="3362067">(</span><span class="op" id="3362068">)</span>&nbsp;<span class="op" id="3362070">==</span>&nbsp;<span class="num" id="3362073">0</span>&nbsp;<span class="op" id="3362075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362080">err</span>&nbsp;<span class="op" id="3362084">=</span>&nbsp;<span class="ident" id="3362086">b</span><span class="op" id="3362087">.</span><span class="ident" id="3362088">flush</span><span class="op" id="3362093">(</span><span class="op" id="3362094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362098">}</span>&nbsp;<span class="keyword" id="3362100">else</span>&nbsp;<span class="op" id="3362105">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3362110">err</span>&nbsp;<span class="op" id="3362114">=</span>&nbsp;<span class="ident" id="3362116">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362128">return</span>&nbsp;<span class="ident" id="3362135">n</span><span class="op" id="3362136">,</span>&nbsp;<span class="ident" id="3362138">err</span><br>
<span class="lineno"></span><span class="op" id="3362142">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3362145">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3362175">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3362231">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="3362263">type</span>&nbsp;<span class="ident" id="3362268">ReadWriter</span>&nbsp;<span class="keyword" id="3362279">struct</span>&nbsp;<span class="op" id="3362286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362289">*</span><span class="ident" id="3362290">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3362298">*</span><span class="ident" id="3362299">Writer</span><br>
<span class="lineno"></span><span class="op" id="3362306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3362309">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3362381">func</span>&nbsp;<span class="ident" id="3362386">NewReadWriter</span><span class="op" id="3362399">(</span><span class="ident" id="3362400">r</span>&nbsp;<span class="op" id="3362402">*</span><span class="ident" id="3362403">Reader</span><span class="op" id="3362409">,</span>&nbsp;<span class="ident" id="3362411">w</span>&nbsp;<span class="op" id="3362413">*</span><span class="ident" id="3362414">Writer</span><span class="op" id="3362420">)</span>&nbsp;<span class="op" id="3362422">*</span><span class="ident" id="3362423">ReadWriter</span>&nbsp;<span class="op" id="3362434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3362437">return</span>&nbsp;<span class="op" id="3362444">&amp;</span><span class="ident" id="3362445">ReadWriter</span><span class="op" id="3362455">{</span><span class="ident" id="3362456">r</span><span class="op" id="3362457">,</span>&nbsp;<span class="ident" id="3362459">w</span><span class="op" id="3362460">}</span><br>
<span class="lineno"></span><span class="op" id="3362462">}</span>
</div>
</body>
</html>
