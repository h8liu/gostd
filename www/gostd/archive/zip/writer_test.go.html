<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html" class="current">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7992034">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7992089">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7992143">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7992194">package</span>&nbsp;<span class="ident" id="7992202">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7992207">import</span>&nbsp;<span class="op" id="7992214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992217">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992226">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992232">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992245">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992258">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7992264">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7992274">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7992277">//&nbsp;TODO(adg):&nbsp;a&nbsp;more&nbsp;sophisticated&nbsp;test&nbsp;suite</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7992324">type</span>&nbsp;<span class="ident" id="7992329">WriteTest</span>&nbsp;<span class="keyword" id="7992339">struct</span>&nbsp;<span class="op" id="7992346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992349">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7992356">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992364">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7992371">[</span><span class="op" id="7992372">]</span><span class="builtintype" id="7992373">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992379">Method</span>&nbsp;<span class="builtintype" id="7992386">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992394">Mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7992401">os</span><span class="op" id="7992403">.</span><span class="ident" id="7992404">FileMode</span><br>
<span class="lineno"></span><span class="op" id="7992413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7992416">var</span>&nbsp;<span class="ident" id="7992420">writeTests</span>&nbsp;<span class="op" id="7992431">=</span>&nbsp;<span class="op" id="7992433">[</span><span class="op" id="7992434">]</span><span class="ident" id="7992435">WriteTest</span><span class="op" id="7992444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992451">Name</span><span class="op" id="7992455">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7992459">&#34;foo&#34;</span><span class="op" id="7992464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992468">Data</span><span class="op" id="7992472">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7992476">[</span><span class="op" id="7992477">]</span><span class="builtintype" id="7992478">byte</span><span class="op" id="7992482">(</span><span class="string" id="7992483">&#34;Rabbits,&nbsp;guinea&nbsp;pigs,&nbsp;gophers,&nbsp;marsupial&nbsp;rats,&nbsp;and&nbsp;quolls.&#34;</span><span class="op" id="7992543">)</span><span class="op" id="7992544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992548">Method</span><span class="op" id="7992554">:</span>&nbsp;<span class="ident" id="7992556">Store</span><span class="op" id="7992561">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992565">Mode</span><span class="op" id="7992569">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7992573">0666</span><span class="op" id="7992577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992580">}</span><span class="op" id="7992581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992588">Name</span><span class="op" id="7992592">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7992596">&#34;bar&#34;</span><span class="op" id="7992601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992605">Data</span><span class="op" id="7992609">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7992613">nil</span><span class="op" id="7992616">,</span>&nbsp;<span class="comment" id="7992618">//&nbsp;large&nbsp;data&nbsp;set&nbsp;in&nbsp;the&nbsp;test</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992650">Method</span><span class="op" id="7992656">:</span>&nbsp;<span class="ident" id="7992658">Deflate</span><span class="op" id="7992665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992669">Mode</span><span class="op" id="7992673">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7992677">0644</span><span class="op" id="7992681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992684">}</span><span class="op" id="7992685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992692">Name</span><span class="op" id="7992696">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7992700">&#34;setuid&#34;</span><span class="op" id="7992708">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992712">Data</span><span class="op" id="7992716">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7992720">[</span><span class="op" id="7992721">]</span><span class="builtintype" id="7992722">byte</span><span class="op" id="7992726">(</span><span class="string" id="7992727">&#34;setuid&nbsp;file&#34;</span><span class="op" id="7992740">)</span><span class="op" id="7992741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992745">Method</span><span class="op" id="7992751">:</span>&nbsp;<span class="ident" id="7992753">Deflate</span><span class="op" id="7992760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992764">Mode</span><span class="op" id="7992768">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7992772">0755</span>&nbsp;<span class="op" id="7992777">|</span>&nbsp;<span class="ident" id="7992779">os</span><span class="op" id="7992781">.</span><span class="ident" id="7992782">ModeSetuid</span><span class="op" id="7992792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992795">}</span><span class="op" id="7992796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992799">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992803">Name</span><span class="op" id="7992807">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7992811">&#34;setgid&#34;</span><span class="op" id="7992819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992823">Data</span><span class="op" id="7992827">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7992831">[</span><span class="op" id="7992832">]</span><span class="builtintype" id="7992833">byte</span><span class="op" id="7992837">(</span><span class="string" id="7992838">&#34;setgid&nbsp;file&#34;</span><span class="op" id="7992851">)</span><span class="op" id="7992852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992856">Method</span><span class="op" id="7992862">:</span>&nbsp;<span class="ident" id="7992864">Deflate</span><span class="op" id="7992871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992875">Mode</span><span class="op" id="7992879">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7992883">0755</span>&nbsp;<span class="op" id="7992888">|</span>&nbsp;<span class="ident" id="7992890">os</span><span class="op" id="7992892">.</span><span class="ident" id="7992893">ModeSetgid</span><span class="op" id="7992903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992906">}</span><span class="op" id="7992907">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992914">Name</span><span class="op" id="7992918">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7992922">&#34;symlink&#34;</span><span class="op" id="7992931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992935">Data</span><span class="op" id="7992939">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7992943">[</span><span class="op" id="7992944">]</span><span class="builtintype" id="7992945">byte</span><span class="op" id="7992949">(</span><span class="string" id="7992950">&#34;../link/target&#34;</span><span class="op" id="7992966">)</span><span class="op" id="7992967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992971">Method</span><span class="op" id="7992977">:</span>&nbsp;<span class="ident" id="7992979">Deflate</span><span class="op" id="7992986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992990">Mode</span><span class="op" id="7992994">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="7992998">0755</span>&nbsp;<span class="op" id="7993003">|</span>&nbsp;<span class="ident" id="7993005">os</span><span class="op" id="7993007">.</span><span class="ident" id="7993008">ModeSymlink</span><span class="op" id="7993019">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993022">}</span><span class="op" id="7993023">,</span><br>
<span class="lineno"></span><span class="op" id="7993025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7993028">func</span>&nbsp;<span class="ident" id="7993033">TestWriter</span><span class="op" id="7993043">(</span><span class="ident" id="7993044">t</span>&nbsp;<span class="op" id="7993046">*</span><span class="ident" id="7993047">testing</span><span class="op" id="7993054">.</span><span class="ident" id="7993055">T</span><span class="op" id="7993056">)</span>&nbsp;<span class="op" id="7993058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993061">largeData</span>&nbsp;<span class="op" id="7993071">:=</span>&nbsp;<span class="builtinfunc" id="7993074">make</span><span class="op" id="7993078">(</span><span class="op" id="7993079">[</span><span class="op" id="7993080">]</span><span class="builtintype" id="7993081">byte</span><span class="op" id="7993085">,</span>&nbsp;<span class="num" id="7993087">1</span><span class="op" id="7993088">&lt;&lt;</span><span class="num" id="7993090">17</span><span class="op" id="7993092">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993095">for</span>&nbsp;<span class="ident" id="7993099">i</span>&nbsp;<span class="op" id="7993101">:=</span>&nbsp;<span class="keyword" id="7993104">range</span>&nbsp;<span class="ident" id="7993110">largeData</span>&nbsp;<span class="op" id="7993120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993124">largeData</span><span class="op" id="7993133">[</span><span class="ident" id="7993134">i</span><span class="op" id="7993135">]</span>&nbsp;<span class="op" id="7993137">=</span>&nbsp;<span class="builtintype" id="7993139">byte</span><span class="op" id="7993143">(</span><span class="ident" id="7993144">rand</span><span class="op" id="7993148">.</span><span class="ident" id="7993149">Int</span><span class="op" id="7993152">(</span><span class="op" id="7993153">)</span><span class="op" id="7993154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993160">writeTests</span><span class="op" id="7993170">[</span><span class="num" id="7993171">1</span><span class="op" id="7993172">]</span><span class="op" id="7993173">.</span><span class="ident" id="7993174">Data</span>&nbsp;<span class="op" id="7993179">=</span>&nbsp;<span class="ident" id="7993181">largeData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993192">defer</span>&nbsp;<span class="keyword" id="7993198">func</span><span class="op" id="7993202">(</span><span class="op" id="7993203">)</span>&nbsp;<span class="op" id="7993205">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993209">writeTests</span><span class="op" id="7993219">[</span><span class="num" id="7993220">1</span><span class="op" id="7993221">]</span><span class="op" id="7993222">.</span><span class="ident" id="7993223">Data</span>&nbsp;<span class="op" id="7993228">=</span>&nbsp;<span class="ident" id="7993230">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993235">}</span><span class="op" id="7993236">(</span><span class="op" id="7993237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7993241">//&nbsp;write&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993262">buf</span>&nbsp;<span class="op" id="7993266">:=</span>&nbsp;<span class="builtinfunc" id="7993269">new</span><span class="op" id="7993272">(</span><span class="ident" id="7993273">bytes</span><span class="op" id="7993278">.</span><span class="ident" id="7993279">Buffer</span><span class="op" id="7993285">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993288">w</span>&nbsp;<span class="op" id="7993290">:=</span>&nbsp;<span class="ident" id="7993293">NewWriter</span><span class="op" id="7993302">(</span><span class="ident" id="7993303">buf</span><span class="op" id="7993306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993310">for</span>&nbsp;<span class="ident" id="7993314">_</span><span class="op" id="7993315">,</span>&nbsp;<span class="ident" id="7993317">wt</span>&nbsp;<span class="op" id="7993320">:=</span>&nbsp;<span class="keyword" id="7993323">range</span>&nbsp;<span class="ident" id="7993329">writeTests</span>&nbsp;<span class="op" id="7993340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993344">testCreate</span><span class="op" id="7993354">(</span><span class="ident" id="7993355">t</span><span class="op" id="7993356">,</span>&nbsp;<span class="ident" id="7993358">w</span><span class="op" id="7993359">,</span>&nbsp;<span class="op" id="7993361">&amp;</span><span class="ident" id="7993362">wt</span><span class="op" id="7993364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993367">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993371">if</span>&nbsp;<span class="ident" id="7993374">err</span>&nbsp;<span class="op" id="7993378">:=</span>&nbsp;<span class="ident" id="7993381">w</span><span class="op" id="7993382">.</span><span class="ident" id="7993383">Close</span><span class="op" id="7993388">(</span><span class="op" id="7993389">)</span><span class="op" id="7993390">;</span>&nbsp;<span class="ident" id="7993392">err</span>&nbsp;<span class="op" id="7993396">!=</span>&nbsp;<span class="ident" id="7993399">nil</span>&nbsp;<span class="op" id="7993403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993407">t</span><span class="op" id="7993408">.</span><span class="ident" id="7993409">Fatal</span><span class="op" id="7993414">(</span><span class="ident" id="7993415">err</span><span class="op" id="7993418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7993425">//&nbsp;read&nbsp;it&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993442">r</span><span class="op" id="7993443">,</span>&nbsp;<span class="ident" id="7993445">err</span>&nbsp;<span class="op" id="7993449">:=</span>&nbsp;<span class="ident" id="7993452">NewReader</span><span class="op" id="7993461">(</span><span class="ident" id="7993462">bytes</span><span class="op" id="7993467">.</span><span class="ident" id="7993468">NewReader</span><span class="op" id="7993477">(</span><span class="ident" id="7993478">buf</span><span class="op" id="7993481">.</span><span class="ident" id="7993482">Bytes</span><span class="op" id="7993487">(</span><span class="op" id="7993488">)</span><span class="op" id="7993489">)</span><span class="op" id="7993490">,</span>&nbsp;<span class="ident" id="7993492">int64</span><span class="op" id="7993497">(</span><span class="ident" id="7993498">buf</span><span class="op" id="7993501">.</span><span class="ident" id="7993502">Len</span><span class="op" id="7993505">(</span><span class="op" id="7993506">)</span><span class="op" id="7993507">)</span><span class="op" id="7993508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993511">if</span>&nbsp;<span class="ident" id="7993514">err</span>&nbsp;<span class="op" id="7993518">!=</span>&nbsp;<span class="ident" id="7993521">nil</span>&nbsp;<span class="op" id="7993525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993529">t</span><span class="op" id="7993530">.</span><span class="ident" id="7993531">Fatal</span><span class="op" id="7993536">(</span><span class="ident" id="7993537">err</span><span class="op" id="7993540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993543">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993546">for</span>&nbsp;<span class="ident" id="7993550">i</span><span class="op" id="7993551">,</span>&nbsp;<span class="ident" id="7993553">wt</span>&nbsp;<span class="op" id="7993556">:=</span>&nbsp;<span class="keyword" id="7993559">range</span>&nbsp;<span class="ident" id="7993565">writeTests</span>&nbsp;<span class="op" id="7993576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993580">testReadFile</span><span class="op" id="7993592">(</span><span class="ident" id="7993593">t</span><span class="op" id="7993594">,</span>&nbsp;<span class="ident" id="7993596">r</span><span class="op" id="7993597">.</span><span class="ident" id="7993598">File</span><span class="op" id="7993602">[</span><span class="ident" id="7993603">i</span><span class="op" id="7993604">]</span><span class="op" id="7993605">,</span>&nbsp;<span class="op" id="7993607">&amp;</span><span class="ident" id="7993608">wt</span><span class="op" id="7993610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993613">}</span><br>
<span class="lineno"></span><span class="op" id="7993615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7993618">func</span>&nbsp;<span class="ident" id="7993623">TestWriterFlush</span><span class="op" id="7993638">(</span><span class="ident" id="7993639">t</span>&nbsp;<span class="op" id="7993641">*</span><span class="ident" id="7993642">testing</span><span class="op" id="7993649">.</span><span class="ident" id="7993650">T</span><span class="op" id="7993651">)</span>&nbsp;<span class="op" id="7993653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993656">var</span>&nbsp;<span class="ident" id="7993660">buf</span>&nbsp;<span class="ident" id="7993664">bytes</span><span class="op" id="7993669">.</span><span class="ident" id="7993670">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993678">w</span>&nbsp;<span class="op" id="7993680">:=</span>&nbsp;<span class="ident" id="7993683">NewWriter</span><span class="op" id="7993692">(</span><span class="keyword" id="7993693">struct</span><span class="op" id="7993699">{</span>&nbsp;<span class="ident" id="7993701">io</span><span class="op" id="7993703">.</span><span class="ident" id="7993704">Writer</span>&nbsp;<span class="op" id="7993711">}</span><span class="op" id="7993712">{</span><span class="op" id="7993713">&amp;</span><span class="ident" id="7993714">buf</span><span class="op" id="7993717">}</span><span class="op" id="7993718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993721">_</span><span class="op" id="7993722">,</span>&nbsp;<span class="ident" id="7993724">err</span>&nbsp;<span class="op" id="7993728">:=</span>&nbsp;<span class="ident" id="7993731">w</span><span class="op" id="7993732">.</span><span class="ident" id="7993733">Create</span><span class="op" id="7993739">(</span><span class="string" id="7993740">&#34;foo&#34;</span><span class="op" id="7993745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993748">if</span>&nbsp;<span class="ident" id="7993751">err</span>&nbsp;<span class="op" id="7993755">!=</span>&nbsp;<span class="ident" id="7993758">nil</span>&nbsp;<span class="op" id="7993762">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993766">t</span><span class="op" id="7993767">.</span><span class="ident" id="7993768">Fatal</span><span class="op" id="7993773">(</span><span class="ident" id="7993774">err</span><span class="op" id="7993777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993783">if</span>&nbsp;<span class="ident" id="7993786">buf</span><span class="op" id="7993789">.</span><span class="ident" id="7993790">Len</span><span class="op" id="7993793">(</span><span class="op" id="7993794">)</span>&nbsp;<span class="op" id="7993796">&gt;</span>&nbsp;<span class="num" id="7993798">0</span>&nbsp;<span class="op" id="7993800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993804">t</span><span class="op" id="7993805">.</span><span class="ident" id="7993806">Fatalf</span><span class="op" id="7993812">(</span><span class="string" id="7993813">&#34;Unexpected&nbsp;%d&nbsp;bytes&nbsp;already&nbsp;in&nbsp;buffer&#34;</span><span class="op" id="7993852">,</span>&nbsp;<span class="ident" id="7993854">buf</span><span class="op" id="7993857">.</span><span class="ident" id="7993858">Len</span><span class="op" id="7993861">(</span><span class="op" id="7993862">)</span><span class="op" id="7993863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993866">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993869">if</span>&nbsp;<span class="ident" id="7993872">err</span>&nbsp;<span class="op" id="7993876">:=</span>&nbsp;<span class="ident" id="7993879">w</span><span class="op" id="7993880">.</span><span class="ident" id="7993881">Flush</span><span class="op" id="7993886">(</span><span class="op" id="7993887">)</span><span class="op" id="7993888">;</span>&nbsp;<span class="ident" id="7993890">err</span>&nbsp;<span class="op" id="7993894">!=</span>&nbsp;<span class="ident" id="7993897">nil</span>&nbsp;<span class="op" id="7993901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993905">t</span><span class="op" id="7993906">.</span><span class="ident" id="7993907">Fatal</span><span class="op" id="7993912">(</span><span class="ident" id="7993913">err</span><span class="op" id="7993916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993922">if</span>&nbsp;<span class="ident" id="7993925">buf</span><span class="op" id="7993928">.</span><span class="ident" id="7993929">Len</span><span class="op" id="7993932">(</span><span class="op" id="7993933">)</span>&nbsp;<span class="op" id="7993935">==</span>&nbsp;<span class="num" id="7993938">0</span>&nbsp;<span class="op" id="7993940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993944">t</span><span class="op" id="7993945">.</span><span class="ident" id="7993946">Fatal</span><span class="op" id="7993951">(</span><span class="string" id="7993952">&#34;No&nbsp;bytes&nbsp;written&nbsp;after&nbsp;Flush&#34;</span><span class="op" id="7993982">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993985">}</span><br>
<span class="lineno"></span><span class="op" id="7993987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7993990">func</span>&nbsp;<span class="ident" id="7993995">testCreate</span><span class="op" id="7994005">(</span><span class="ident" id="7994006">t</span>&nbsp;<span class="op" id="7994008">*</span><span class="ident" id="7994009">testing</span><span class="op" id="7994016">.</span><span class="ident" id="7994017">T</span><span class="op" id="7994018">,</span>&nbsp;<span class="ident" id="7994020">w</span>&nbsp;<span class="op" id="7994022">*</span><span class="ident" id="7994023">Writer</span><span class="op" id="7994029">,</span>&nbsp;<span class="ident" id="7994031">wt</span>&nbsp;<span class="op" id="7994034">*</span><span class="ident" id="7994035">WriteTest</span><span class="op" id="7994044">)</span>&nbsp;<span class="op" id="7994046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994049">header</span>&nbsp;<span class="op" id="7994056">:=</span>&nbsp;<span class="op" id="7994059">&amp;</span><span class="ident" id="7994060">FileHeader</span><span class="op" id="7994070">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994074">Name</span><span class="op" id="7994078">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7994082">wt</span><span class="op" id="7994084">.</span><span class="ident" id="7994085">Name</span><span class="op" id="7994089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994093">Method</span><span class="op" id="7994099">:</span>&nbsp;<span class="ident" id="7994101">wt</span><span class="op" id="7994103">.</span><span class="ident" id="7994104">Method</span><span class="op" id="7994110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994116">if</span>&nbsp;<span class="ident" id="7994119">wt</span><span class="op" id="7994121">.</span><span class="ident" id="7994122">Mode</span>&nbsp;<span class="op" id="7994127">!=</span>&nbsp;<span class="num" id="7994130">0</span>&nbsp;<span class="op" id="7994132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994136">header</span><span class="op" id="7994142">.</span><span class="ident" id="7994143">SetMode</span><span class="op" id="7994150">(</span><span class="ident" id="7994151">wt</span><span class="op" id="7994153">.</span><span class="ident" id="7994154">Mode</span><span class="op" id="7994158">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994164">f</span><span class="op" id="7994165">,</span>&nbsp;<span class="ident" id="7994167">err</span>&nbsp;<span class="op" id="7994171">:=</span>&nbsp;<span class="ident" id="7994174">w</span><span class="op" id="7994175">.</span><span class="ident" id="7994176">CreateHeader</span><span class="op" id="7994188">(</span><span class="ident" id="7994189">header</span><span class="op" id="7994195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994198">if</span>&nbsp;<span class="ident" id="7994201">err</span>&nbsp;<span class="op" id="7994205">!=</span>&nbsp;<span class="ident" id="7994208">nil</span>&nbsp;<span class="op" id="7994212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994216">t</span><span class="op" id="7994217">.</span><span class="ident" id="7994218">Fatal</span><span class="op" id="7994223">(</span><span class="ident" id="7994224">err</span><span class="op" id="7994227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994230">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994233">_</span><span class="op" id="7994234">,</span>&nbsp;<span class="ident" id="7994236">err</span>&nbsp;<span class="op" id="7994240">=</span>&nbsp;<span class="ident" id="7994242">f</span><span class="op" id="7994243">.</span><span class="ident" id="7994244">Write</span><span class="op" id="7994249">(</span><span class="ident" id="7994250">wt</span><span class="op" id="7994252">.</span><span class="ident" id="7994253">Data</span><span class="op" id="7994257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994260">if</span>&nbsp;<span class="ident" id="7994263">err</span>&nbsp;<span class="op" id="7994267">!=</span>&nbsp;<span class="ident" id="7994270">nil</span>&nbsp;<span class="op" id="7994274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994278">t</span><span class="op" id="7994279">.</span><span class="ident" id="7994280">Fatal</span><span class="op" id="7994285">(</span><span class="ident" id="7994286">err</span><span class="op" id="7994289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994292">}</span><br>
<span class="lineno"></span><span class="op" id="7994294">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7994297">func</span>&nbsp;<span class="ident" id="7994302">testReadFile</span><span class="op" id="7994314">(</span><span class="ident" id="7994315">t</span>&nbsp;<span class="op" id="7994317">*</span><span class="ident" id="7994318">testing</span><span class="op" id="7994325">.</span><span class="ident" id="7994326">T</span><span class="op" id="7994327">,</span>&nbsp;<span class="ident" id="7994329">f</span>&nbsp;<span class="op" id="7994331">*</span><span class="ident" id="7994332">File</span><span class="op" id="7994336">,</span>&nbsp;<span class="ident" id="7994338">wt</span>&nbsp;<span class="op" id="7994341">*</span><span class="ident" id="7994342">WriteTest</span><span class="op" id="7994351">)</span>&nbsp;<span class="op" id="7994353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994356">if</span>&nbsp;<span class="ident" id="7994359">f</span><span class="op" id="7994360">.</span><span class="ident" id="7994361">Name</span>&nbsp;<span class="op" id="7994366">!=</span>&nbsp;<span class="ident" id="7994369">wt</span><span class="op" id="7994371">.</span><span class="ident" id="7994372">Name</span>&nbsp;<span class="op" id="7994377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994381">t</span><span class="op" id="7994382">.</span><span class="ident" id="7994383">Fatalf</span><span class="op" id="7994389">(</span><span class="string" id="7994390">&#34;File&nbsp;name:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7994418">,</span>&nbsp;<span class="ident" id="7994420">f</span><span class="op" id="7994421">.</span><span class="ident" id="7994422">Name</span><span class="op" id="7994426">,</span>&nbsp;<span class="ident" id="7994428">wt</span><span class="op" id="7994430">.</span><span class="ident" id="7994431">Name</span><span class="op" id="7994435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994438">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994441">testFileMode</span><span class="op" id="7994453">(</span><span class="ident" id="7994454">t</span><span class="op" id="7994455">,</span>&nbsp;<span class="ident" id="7994457">wt</span><span class="op" id="7994459">.</span><span class="ident" id="7994460">Name</span><span class="op" id="7994464">,</span>&nbsp;<span class="ident" id="7994466">f</span><span class="op" id="7994467">,</span>&nbsp;<span class="ident" id="7994469">wt</span><span class="op" id="7994471">.</span><span class="ident" id="7994472">Mode</span><span class="op" id="7994476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994479">rc</span><span class="op" id="7994481">,</span>&nbsp;<span class="ident" id="7994483">err</span>&nbsp;<span class="op" id="7994487">:=</span>&nbsp;<span class="ident" id="7994490">f</span><span class="op" id="7994491">.</span><span class="ident" id="7994492">Open</span><span class="op" id="7994496">(</span><span class="op" id="7994497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994500">if</span>&nbsp;<span class="ident" id="7994503">err</span>&nbsp;<span class="op" id="7994507">!=</span>&nbsp;<span class="ident" id="7994510">nil</span>&nbsp;<span class="op" id="7994514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994518">t</span><span class="op" id="7994519">.</span><span class="ident" id="7994520">Fatal</span><span class="op" id="7994525">(</span><span class="string" id="7994526">&#34;opening:&#34;</span><span class="op" id="7994536">,</span>&nbsp;<span class="ident" id="7994538">err</span><span class="op" id="7994541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994544">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994547">b</span><span class="op" id="7994548">,</span>&nbsp;<span class="ident" id="7994550">err</span>&nbsp;<span class="op" id="7994554">:=</span>&nbsp;<span class="ident" id="7994557">ioutil</span><span class="op" id="7994563">.</span><span class="ident" id="7994564">ReadAll</span><span class="op" id="7994571">(</span><span class="ident" id="7994572">rc</span><span class="op" id="7994574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994577">if</span>&nbsp;<span class="ident" id="7994580">err</span>&nbsp;<span class="op" id="7994584">!=</span>&nbsp;<span class="ident" id="7994587">nil</span>&nbsp;<span class="op" id="7994591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994595">t</span><span class="op" id="7994596">.</span><span class="ident" id="7994597">Fatal</span><span class="op" id="7994602">(</span><span class="string" id="7994603">&#34;reading:&#34;</span><span class="op" id="7994613">,</span>&nbsp;<span class="ident" id="7994615">err</span><span class="op" id="7994618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994624">err</span>&nbsp;<span class="op" id="7994628">=</span>&nbsp;<span class="ident" id="7994630">rc</span><span class="op" id="7994632">.</span><span class="ident" id="7994633">Close</span><span class="op" id="7994638">(</span><span class="op" id="7994639">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994642">if</span>&nbsp;<span class="ident" id="7994645">err</span>&nbsp;<span class="op" id="7994649">!=</span>&nbsp;<span class="ident" id="7994652">nil</span>&nbsp;<span class="op" id="7994656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994660">t</span><span class="op" id="7994661">.</span><span class="ident" id="7994662">Fatal</span><span class="op" id="7994667">(</span><span class="string" id="7994668">&#34;closing:&#34;</span><span class="op" id="7994678">,</span>&nbsp;<span class="ident" id="7994680">err</span><span class="op" id="7994683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994689">if</span>&nbsp;<span class="op" id="7994692">!</span><span class="ident" id="7994693">bytes</span><span class="op" id="7994698">.</span><span class="ident" id="7994699">Equal</span><span class="op" id="7994704">(</span><span class="ident" id="7994705">b</span><span class="op" id="7994706">,</span>&nbsp;<span class="ident" id="7994708">wt</span><span class="op" id="7994710">.</span><span class="ident" id="7994711">Data</span><span class="op" id="7994715">)</span>&nbsp;<span class="op" id="7994717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994721">t</span><span class="op" id="7994722">.</span><span class="ident" id="7994723">Errorf</span><span class="op" id="7994729">(</span><span class="string" id="7994730">&#34;File&nbsp;contents&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7994757">,</span>&nbsp;<span class="ident" id="7994759">b</span><span class="op" id="7994760">,</span>&nbsp;<span class="ident" id="7994762">wt</span><span class="op" id="7994764">.</span><span class="ident" id="7994765">Data</span><span class="op" id="7994769">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994772">}</span><br>
<span class="lineno"></span><span class="op" id="7994774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7994777">func</span>&nbsp;<span class="ident" id="7994782">BenchmarkCompressedZipGarbage</span><span class="op" id="7994811">(</span><span class="ident" id="7994812">b</span>&nbsp;<span class="op" id="7994814">*</span><span class="ident" id="7994815">testing</span><span class="op" id="7994822">.</span><span class="ident" id="7994823">B</span><span class="op" id="7994824">)</span>&nbsp;<span class="op" id="7994826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994829">b</span><span class="op" id="7994830">.</span><span class="ident" id="7994831">ReportAllocs</span><span class="op" id="7994843">(</span><span class="op" id="7994844">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994847">var</span>&nbsp;<span class="ident" id="7994851">buf</span>&nbsp;<span class="ident" id="7994855">bytes</span><span class="op" id="7994860">.</span><span class="ident" id="7994861">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994869">bigBuf</span>&nbsp;<span class="op" id="7994876">:=</span>&nbsp;<span class="ident" id="7994879">bytes</span><span class="op" id="7994884">.</span><span class="ident" id="7994885">Repeat</span><span class="op" id="7994891">(</span><span class="op" id="7994892">[</span><span class="op" id="7994893">]</span><span class="builtintype" id="7994894">byte</span><span class="op" id="7994898">(</span><span class="string" id="7994899">&#34;a&#34;</span><span class="op" id="7994902">)</span><span class="op" id="7994903">,</span>&nbsp;<span class="num" id="7994905">1</span><span class="op" id="7994906">&lt;&lt;</span><span class="num" id="7994908">20</span><span class="op" id="7994910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994913">for</span>&nbsp;<span class="ident" id="7994917">i</span>&nbsp;<span class="op" id="7994919">:=</span>&nbsp;<span class="num" id="7994922">0</span><span class="op" id="7994923">;</span>&nbsp;<span class="ident" id="7994925">i</span>&nbsp;<span class="op" id="7994927">&lt;</span>&nbsp;<span class="ident" id="7994929">b</span><span class="op" id="7994930">.</span><span class="ident" id="7994931">N</span><span class="op" id="7994932">;</span>&nbsp;<span class="ident" id="7994934">i</span><span class="op" id="7994935">++</span>&nbsp;<span class="op" id="7994938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994942">buf</span><span class="op" id="7994945">.</span><span class="ident" id="7994946">Reset</span><span class="op" id="7994951">(</span><span class="op" id="7994952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994956">zw</span>&nbsp;<span class="op" id="7994959">:=</span>&nbsp;<span class="ident" id="7994962">NewWriter</span><span class="op" id="7994971">(</span><span class="op" id="7994972">&amp;</span><span class="ident" id="7994973">buf</span><span class="op" id="7994976">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994980">for</span>&nbsp;<span class="ident" id="7994984">j</span>&nbsp;<span class="op" id="7994986">:=</span>&nbsp;<span class="num" id="7994989">0</span><span class="op" id="7994990">;</span>&nbsp;<span class="ident" id="7994992">j</span>&nbsp;<span class="op" id="7994994">&lt;</span>&nbsp;<span class="num" id="7994996">3</span><span class="op" id="7994997">;</span>&nbsp;<span class="ident" id="7994999">j</span><span class="op" id="7995000">++</span>&nbsp;<span class="op" id="7995003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995008">w</span><span class="op" id="7995009">,</span>&nbsp;<span class="ident" id="7995011">_</span>&nbsp;<span class="op" id="7995013">:=</span>&nbsp;<span class="ident" id="7995016">zw</span><span class="op" id="7995018">.</span><span class="ident" id="7995019">CreateHeader</span><span class="op" id="7995031">(</span><span class="op" id="7995032">&amp;</span><span class="ident" id="7995033">FileHeader</span><span class="op" id="7995043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995049">Name</span><span class="op" id="7995053">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7995057">&#34;foo&#34;</span><span class="op" id="7995062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995068">Method</span><span class="op" id="7995074">:</span>&nbsp;<span class="ident" id="7995076">Deflate</span><span class="op" id="7995083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995088">}</span><span class="op" id="7995089">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995094">w</span><span class="op" id="7995095">.</span><span class="ident" id="7995096">Write</span><span class="op" id="7995101">(</span><span class="ident" id="7995102">bigBuf</span><span class="op" id="7995108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995116">zw</span><span class="op" id="7995118">.</span><span class="ident" id="7995119">Close</span><span class="op" id="7995124">(</span><span class="op" id="7995125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995128">}</span><br>
<span class="lineno"></span><span class="op" id="7995130">}</span>
</div>
</body>
</html>
