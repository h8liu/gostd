<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3990744">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3990800">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3990854">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3990905">package</span>&nbsp;<span class="ident" id="3990913">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3990918">import</span>&nbsp;<span class="op" id="3990925">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3990928">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3990938">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3990945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3990948">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3991007">//</span><br>
<span class="lineno"></span><span class="comment" id="3991010">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3991068">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3991130">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3991192">type</span>&nbsp;<span class="ident" id="3991197">Dialer</span>&nbsp;<span class="keyword" id="3991204">struct</span>&nbsp;<span class="op" id="3991211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991214">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991277">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991341">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991354">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991358">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991389">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991393">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991456">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991516">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991544">Timeout</span>&nbsp;<span class="ident" id="3991552">time</span><span class="op" id="3991556">.</span><span class="ident" id="3991557">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991568">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991629">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991684">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991749">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991781">Deadline</span>&nbsp;<span class="ident" id="3991790">time</span><span class="op" id="3991794">.</span><span class="ident" id="3991795">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991802">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991860">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991922">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991948">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992001">LocalAddr</span>&nbsp;<span class="ident" id="3992011">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992018">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992077">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992140">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992201">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992265">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992282">DualStack</span>&nbsp;<span class="builtintype" id="3992292">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992299">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992359">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992383">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992443">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992498">KeepAlive</span>&nbsp;<span class="ident" id="3992508">time</span><span class="op" id="3992512">.</span><span class="ident" id="3992513">Duration</span><br>
<span class="lineno"></span><span class="op" id="3992522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3992525">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3992590">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3992621">func</span>&nbsp;<span class="op" id="3992626">(</span><span class="ident" id="3992627">d</span>&nbsp;<span class="op" id="3992629">*</span><span class="ident" id="3992630">Dialer</span><span class="op" id="3992636">)</span>&nbsp;<span class="ident" id="3992638">deadline</span><span class="op" id="3992646">(</span><span class="op" id="3992647">)</span>&nbsp;<span class="ident" id="3992649">time</span><span class="op" id="3992653">.</span><span class="ident" id="3992654">Time</span>&nbsp;<span class="op" id="3992659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992662">if</span>&nbsp;<span class="ident" id="3992665">d</span><span class="op" id="3992666">.</span><span class="ident" id="3992667">Timeout</span>&nbsp;<span class="op" id="3992675">==</span>&nbsp;<span class="num" id="3992678">0</span>&nbsp;<span class="op" id="3992680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992684">return</span>&nbsp;<span class="ident" id="3992691">d</span><span class="op" id="3992692">.</span><span class="ident" id="3992693">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992706">timeoutDeadline</span>&nbsp;<span class="op" id="3992722">:=</span>&nbsp;<span class="ident" id="3992725">time</span><span class="op" id="3992729">.</span><span class="ident" id="3992730">Now</span><span class="op" id="3992733">(</span><span class="op" id="3992734">)</span><span class="op" id="3992735">.</span><span class="ident" id="3992736">Add</span><span class="op" id="3992739">(</span><span class="ident" id="3992740">d</span><span class="op" id="3992741">.</span><span class="ident" id="3992742">Timeout</span><span class="op" id="3992749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992752">if</span>&nbsp;<span class="ident" id="3992755">d</span><span class="op" id="3992756">.</span><span class="ident" id="3992757">Deadline</span><span class="op" id="3992765">.</span><span class="ident" id="3992766">IsZero</span><span class="op" id="3992772">(</span><span class="op" id="3992773">)</span>&nbsp;<span class="op" id="3992775">||</span>&nbsp;<span class="ident" id="3992778">timeoutDeadline</span><span class="op" id="3992793">.</span><span class="ident" id="3992794">Before</span><span class="op" id="3992800">(</span><span class="ident" id="3992801">d</span><span class="op" id="3992802">.</span><span class="ident" id="3992803">Deadline</span><span class="op" id="3992811">)</span>&nbsp;<span class="op" id="3992813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992817">return</span>&nbsp;<span class="ident" id="3992824">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992841">}</span>&nbsp;<span class="keyword" id="3992843">else</span>&nbsp;<span class="op" id="3992848">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992852">return</span>&nbsp;<span class="ident" id="3992859">d</span><span class="op" id="3992860">.</span><span class="ident" id="3992861">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992871">}</span><br>
<span class="lineno"></span><span class="op" id="3992873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3992876">func</span>&nbsp;<span class="ident" id="3992881">parseNetwork</span><span class="op" id="3992893">(</span><span class="ident" id="3992894">net</span>&nbsp;<span class="builtintype" id="3992898">string</span><span class="op" id="3992904">)</span>&nbsp;<span class="op" id="3992906">(</span><span class="ident" id="3992907">afnet</span>&nbsp;<span class="builtintype" id="3992913">string</span><span class="op" id="3992919">,</span>&nbsp;<span class="ident" id="3992921">proto</span>&nbsp;<span class="builtintype" id="3992927">int</span><span class="op" id="3992930">,</span>&nbsp;<span class="ident" id="3992932">err</span>&nbsp;<span class="builtintype" id="3992936">error</span><span class="op" id="3992941">)</span>&nbsp;<span class="op" id="3992943">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992946">i</span>&nbsp;<span class="op" id="3992948">:=</span>&nbsp;<span class="ident" id="3992951">last</span><span class="op" id="3992955">(</span><span class="ident" id="3992956">net</span><span class="op" id="3992959">,</span>&nbsp;<span class="string" id="3992961">&#39;:&#39;</span><span class="op" id="3992964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992967">if</span>&nbsp;<span class="ident" id="3992970">i</span>&nbsp;<span class="op" id="3992972">&lt;</span>&nbsp;<span class="num" id="3992974">0</span>&nbsp;<span class="op" id="3992976">{</span>&nbsp;<span class="comment" id="3992978">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992992">switch</span>&nbsp;<span class="ident" id="3992999">net</span>&nbsp;<span class="op" id="3993003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993007">case</span>&nbsp;<span class="string" id="3993012">&#34;tcp&#34;</span><span class="op" id="3993017">,</span>&nbsp;<span class="string" id="3993019">&#34;tcp4&#34;</span><span class="op" id="3993025">,</span>&nbsp;<span class="string" id="3993027">&#34;tcp6&#34;</span><span class="op" id="3993033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993037">case</span>&nbsp;<span class="string" id="3993042">&#34;udp&#34;</span><span class="op" id="3993047">,</span>&nbsp;<span class="string" id="3993049">&#34;udp4&#34;</span><span class="op" id="3993055">,</span>&nbsp;<span class="string" id="3993057">&#34;udp6&#34;</span><span class="op" id="3993063">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993067">case</span>&nbsp;<span class="string" id="3993072">&#34;ip&#34;</span><span class="op" id="3993076">,</span>&nbsp;<span class="string" id="3993078">&#34;ip4&#34;</span><span class="op" id="3993083">,</span>&nbsp;<span class="string" id="3993085">&#34;ip6&#34;</span><span class="op" id="3993090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993094">case</span>&nbsp;<span class="string" id="3993099">&#34;unix&#34;</span><span class="op" id="3993105">,</span>&nbsp;<span class="string" id="3993107">&#34;unixgram&#34;</span><span class="op" id="3993117">,</span>&nbsp;<span class="string" id="3993119">&#34;unixpacket&#34;</span><span class="op" id="3993131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993135">default</span><span class="op" id="3993142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993147">return</span>&nbsp;<span class="string" id="3993154">&#34;&#34;</span><span class="op" id="3993156">,</span>&nbsp;<span class="num" id="3993158">0</span><span class="op" id="3993159">,</span>&nbsp;<span class="ident" id="3993161">UnknownNetworkError</span><span class="op" id="3993180">(</span><span class="ident" id="3993181">net</span><span class="op" id="3993184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993188">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993192">return</span>&nbsp;<span class="ident" id="3993199">net</span><span class="op" id="3993202">,</span>&nbsp;<span class="num" id="3993204">0</span><span class="op" id="3993205">,</span>&nbsp;<span class="ident" id="3993207">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993215">afnet</span>&nbsp;<span class="op" id="3993221">=</span>&nbsp;<span class="ident" id="3993223">net</span><span class="op" id="3993226">[</span><span class="op" id="3993227">:</span><span class="ident" id="3993228">i</span><span class="op" id="3993229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993232">switch</span>&nbsp;<span class="ident" id="3993239">afnet</span>&nbsp;<span class="op" id="3993245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993248">case</span>&nbsp;<span class="string" id="3993253">&#34;ip&#34;</span><span class="op" id="3993257">,</span>&nbsp;<span class="string" id="3993259">&#34;ip4&#34;</span><span class="op" id="3993264">,</span>&nbsp;<span class="string" id="3993266">&#34;ip6&#34;</span><span class="op" id="3993271">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993275">protostr</span>&nbsp;<span class="op" id="3993284">:=</span>&nbsp;<span class="ident" id="3993287">net</span><span class="op" id="3993290">[</span><span class="ident" id="3993291">i</span><span class="op" id="3993292">+</span><span class="num" id="3993293">1</span><span class="op" id="3993294">:</span><span class="op" id="3993295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993299">proto</span><span class="op" id="3993304">,</span>&nbsp;<span class="ident" id="3993306">i</span><span class="op" id="3993307">,</span>&nbsp;<span class="ident" id="3993309">ok</span>&nbsp;<span class="op" id="3993312">:=</span>&nbsp;<span class="ident" id="3993315">dtoi</span><span class="op" id="3993319">(</span><span class="ident" id="3993320">protostr</span><span class="op" id="3993328">,</span>&nbsp;<span class="num" id="3993330">0</span><span class="op" id="3993331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993335">if</span>&nbsp;<span class="op" id="3993338">!</span><span class="ident" id="3993339">ok</span>&nbsp;<span class="op" id="3993342">||</span>&nbsp;<span class="ident" id="3993345">i</span>&nbsp;<span class="op" id="3993347">!=</span>&nbsp;<span class="builtinfunc" id="3993350">len</span><span class="op" id="3993353">(</span><span class="ident" id="3993354">protostr</span><span class="op" id="3993362">)</span>&nbsp;<span class="op" id="3993364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993369">proto</span><span class="op" id="3993374">,</span>&nbsp;<span class="ident" id="3993376">err</span>&nbsp;<span class="op" id="3993380">=</span>&nbsp;<span class="ident" id="3993382">lookupProtocol</span><span class="op" id="3993396">(</span><span class="ident" id="3993397">protostr</span><span class="op" id="3993405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993410">if</span>&nbsp;<span class="ident" id="3993413">err</span>&nbsp;<span class="op" id="3993417">!=</span>&nbsp;<span class="ident" id="3993420">nil</span>&nbsp;<span class="op" id="3993424">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993430">return</span>&nbsp;<span class="string" id="3993437">&#34;&#34;</span><span class="op" id="3993439">,</span>&nbsp;<span class="num" id="3993441">0</span><span class="op" id="3993442">,</span>&nbsp;<span class="ident" id="3993444">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993459">return</span>&nbsp;<span class="ident" id="3993466">afnet</span><span class="op" id="3993471">,</span>&nbsp;<span class="ident" id="3993473">proto</span><span class="op" id="3993478">,</span>&nbsp;<span class="ident" id="3993480">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993485">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993488">return</span>&nbsp;<span class="string" id="3993495">&#34;&#34;</span><span class="op" id="3993497">,</span>&nbsp;<span class="num" id="3993499">0</span><span class="op" id="3993500">,</span>&nbsp;<span class="ident" id="3993502">UnknownNetworkError</span><span class="op" id="3993521">(</span><span class="ident" id="3993522">net</span><span class="op" id="3993525">)</span><br>
<span class="lineno"></span><span class="op" id="3993527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3993530">func</span>&nbsp;<span class="ident" id="3993535">resolveAddr</span><span class="op" id="3993546">(</span><span class="ident" id="3993547">op</span><span class="op" id="3993549">,</span>&nbsp;<span class="ident" id="3993551">net</span><span class="op" id="3993554">,</span>&nbsp;<span class="ident" id="3993556">addr</span>&nbsp;<span class="builtintype" id="3993561">string</span><span class="op" id="3993567">,</span>&nbsp;<span class="ident" id="3993569">deadline</span>&nbsp;<span class="ident" id="3993578">time</span><span class="op" id="3993582">.</span><span class="ident" id="3993583">Time</span><span class="op" id="3993587">)</span>&nbsp;<span class="op" id="3993589">(</span><span class="ident" id="3993590">netaddr</span><span class="op" id="3993597">,</span>&nbsp;<span class="builtintype" id="3993599">error</span><span class="op" id="3993604">)</span>&nbsp;<span class="op" id="3993606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993609">afnet</span><span class="op" id="3993614">,</span>&nbsp;<span class="ident" id="3993616">_</span><span class="op" id="3993617">,</span>&nbsp;<span class="ident" id="3993619">err</span>&nbsp;<span class="op" id="3993623">:=</span>&nbsp;<span class="ident" id="3993626">parseNetwork</span><span class="op" id="3993638">(</span><span class="ident" id="3993639">net</span><span class="op" id="3993642">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993645">if</span>&nbsp;<span class="ident" id="3993648">err</span>&nbsp;<span class="op" id="3993652">!=</span>&nbsp;<span class="ident" id="3993655">nil</span>&nbsp;<span class="op" id="3993659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993663">return</span>&nbsp;<span class="ident" id="3993670">nil</span><span class="op" id="3993673">,</span>&nbsp;<span class="ident" id="3993675">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993683">if</span>&nbsp;<span class="ident" id="3993686">op</span>&nbsp;<span class="op" id="3993689">==</span>&nbsp;<span class="string" id="3993692">&#34;dial&#34;</span>&nbsp;<span class="op" id="3993699">&amp;&amp;</span>&nbsp;<span class="ident" id="3993702">addr</span>&nbsp;<span class="op" id="3993707">==</span>&nbsp;<span class="string" id="3993710">&#34;&#34;</span>&nbsp;<span class="op" id="3993713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993717">return</span>&nbsp;<span class="ident" id="3993724">nil</span><span class="op" id="3993727">,</span>&nbsp;<span class="ident" id="3993729">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993751">switch</span>&nbsp;<span class="ident" id="3993758">afnet</span>&nbsp;<span class="op" id="3993764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993767">case</span>&nbsp;<span class="string" id="3993772">&#34;unix&#34;</span><span class="op" id="3993778">,</span>&nbsp;<span class="string" id="3993780">&#34;unixgram&#34;</span><span class="op" id="3993790">,</span>&nbsp;<span class="string" id="3993792">&#34;unixpacket&#34;</span><span class="op" id="3993804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993808">return</span>&nbsp;<span class="ident" id="3993815">ResolveUnixAddr</span><span class="op" id="3993830">(</span><span class="ident" id="3993831">afnet</span><span class="op" id="3993836">,</span>&nbsp;<span class="ident" id="3993838">addr</span><span class="op" id="3993842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993845">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993848">return</span>&nbsp;<span class="ident" id="3993855">resolveInternetAddr</span><span class="op" id="3993874">(</span><span class="ident" id="3993875">afnet</span><span class="op" id="3993880">,</span>&nbsp;<span class="ident" id="3993882">addr</span><span class="op" id="3993886">,</span>&nbsp;<span class="ident" id="3993888">deadline</span><span class="op" id="3993896">)</span><br>
<span class="lineno"></span><span class="op" id="3993898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993901">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3993955">//</span><br>
<span class="lineno">115</span><span class="comment" id="3993958">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3994027">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3994089">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3994147">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3994164">//</span><br>
<span class="lineno">120</span><span class="comment" id="3994167">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3994231">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3994288">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3994353">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3994422">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3994439">//</span><br>
<span class="lineno"></span><span class="comment" id="3994442">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3994455">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3994488">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3994522">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3994559">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3994594">//</span><br>
<span class="lineno"></span><span class="comment" id="3994597">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3994667">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3994734">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3994757">//</span><br>
<span class="lineno"></span><span class="comment" id="3994760">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3994773">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3994803">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3994830">//</span><br>
<span class="lineno">140</span><span class="comment" id="3994833">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3994895">func</span>&nbsp;<span class="ident" id="3994900">Dial</span><span class="op" id="3994904">(</span><span class="ident" id="3994905">network</span><span class="op" id="3994912">,</span>&nbsp;<span class="ident" id="3994914">address</span>&nbsp;<span class="builtintype" id="3994922">string</span><span class="op" id="3994928">)</span>&nbsp;<span class="op" id="3994930">(</span><span class="ident" id="3994931">Conn</span><span class="op" id="3994935">,</span>&nbsp;<span class="builtintype" id="3994937">error</span><span class="op" id="3994942">)</span>&nbsp;<span class="op" id="3994944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994947">var</span>&nbsp;<span class="ident" id="3994951">d</span>&nbsp;<span class="ident" id="3994953">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994961">return</span>&nbsp;<span class="ident" id="3994968">d</span><span class="op" id="3994969">.</span><span class="ident" id="3994970">Dial</span><span class="op" id="3994974">(</span><span class="ident" id="3994975">network</span><span class="op" id="3994982">,</span>&nbsp;<span class="ident" id="3994984">address</span><span class="op" id="3994991">)</span><br>
<span class="lineno"></span><span class="op" id="3994993">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3994996">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3995047">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3995101">func</span>&nbsp;<span class="ident" id="3995106">DialTimeout</span><span class="op" id="3995117">(</span><span class="ident" id="3995118">network</span><span class="op" id="3995125">,</span>&nbsp;<span class="ident" id="3995127">address</span>&nbsp;<span class="builtintype" id="3995135">string</span><span class="op" id="3995141">,</span>&nbsp;<span class="ident" id="3995143">timeout</span>&nbsp;<span class="ident" id="3995151">time</span><span class="op" id="3995155">.</span><span class="ident" id="3995156">Duration</span><span class="op" id="3995164">)</span>&nbsp;<span class="op" id="3995166">(</span><span class="ident" id="3995167">Conn</span><span class="op" id="3995171">,</span>&nbsp;<span class="builtintype" id="3995173">error</span><span class="op" id="3995178">)</span>&nbsp;<span class="op" id="3995180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995183">d</span>&nbsp;<span class="op" id="3995185">:=</span>&nbsp;<span class="ident" id="3995188">Dialer</span><span class="op" id="3995194">{</span><span class="ident" id="3995195">Timeout</span><span class="op" id="3995202">:</span>&nbsp;<span class="ident" id="3995204">timeout</span><span class="op" id="3995211">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995214">return</span>&nbsp;<span class="ident" id="3995221">d</span><span class="op" id="3995222">.</span><span class="ident" id="3995223">Dial</span><span class="op" id="3995227">(</span><span class="ident" id="3995228">network</span><span class="op" id="3995235">,</span>&nbsp;<span class="ident" id="3995237">address</span><span class="op" id="3995244">)</span><br>
<span class="lineno"></span><span class="op" id="3995246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3995249">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3995303">//</span><br>
<span class="lineno">155</span><span class="comment" id="3995306">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3995368">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3995383">func</span>&nbsp;<span class="op" id="3995388">(</span><span class="ident" id="3995389">d</span>&nbsp;<span class="op" id="3995391">*</span><span class="ident" id="3995392">Dialer</span><span class="op" id="3995398">)</span>&nbsp;<span class="ident" id="3995400">Dial</span><span class="op" id="3995404">(</span><span class="ident" id="3995405">network</span><span class="op" id="3995412">,</span>&nbsp;<span class="ident" id="3995414">address</span>&nbsp;<span class="builtintype" id="3995422">string</span><span class="op" id="3995428">)</span>&nbsp;<span class="op" id="3995430">(</span><span class="ident" id="3995431">Conn</span><span class="op" id="3995435">,</span>&nbsp;<span class="builtintype" id="3995437">error</span><span class="op" id="3995442">)</span>&nbsp;<span class="op" id="3995444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995447">ra</span><span class="op" id="3995449">,</span>&nbsp;<span class="ident" id="3995451">err</span>&nbsp;<span class="op" id="3995455">:=</span>&nbsp;<span class="ident" id="3995458">resolveAddr</span><span class="op" id="3995469">(</span><span class="string" id="3995470">&#34;dial&#34;</span><span class="op" id="3995476">,</span>&nbsp;<span class="ident" id="3995478">network</span><span class="op" id="3995485">,</span>&nbsp;<span class="ident" id="3995487">address</span><span class="op" id="3995494">,</span>&nbsp;<span class="ident" id="3995496">d</span><span class="op" id="3995497">.</span><span class="ident" id="3995498">deadline</span><span class="op" id="3995506">(</span><span class="op" id="3995507">)</span><span class="op" id="3995508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995511">if</span>&nbsp;<span class="ident" id="3995514">err</span>&nbsp;<span class="op" id="3995518">!=</span>&nbsp;<span class="ident" id="3995521">nil</span>&nbsp;<span class="op" id="3995525">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995529">return</span>&nbsp;<span class="ident" id="3995536">nil</span><span class="op" id="3995539">,</span>&nbsp;<span class="op" id="3995541">&amp;</span><span class="ident" id="3995542">OpError</span><span class="op" id="3995549">{</span><span class="ident" id="3995550">Op</span><span class="op" id="3995552">:</span>&nbsp;<span class="string" id="3995554">&#34;dial&#34;</span><span class="op" id="3995560">,</span>&nbsp;<span class="ident" id="3995562">Net</span><span class="op" id="3995565">:</span>&nbsp;<span class="ident" id="3995567">network</span><span class="op" id="3995574">,</span>&nbsp;<span class="ident" id="3995576">Addr</span><span class="op" id="3995580">:</span>&nbsp;<span class="ident" id="3995582">nil</span><span class="op" id="3995585">,</span>&nbsp;<span class="ident" id="3995587">Err</span><span class="op" id="3995590">:</span>&nbsp;<span class="ident" id="3995592">err</span><span class="op" id="3995595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995601">dialer</span>&nbsp;<span class="op" id="3995608">:=</span>&nbsp;<span class="keyword" id="3995611">func</span><span class="op" id="3995615">(</span><span class="ident" id="3995616">deadline</span>&nbsp;<span class="ident" id="3995625">time</span><span class="op" id="3995629">.</span><span class="ident" id="3995630">Time</span><span class="op" id="3995634">)</span>&nbsp;<span class="op" id="3995636">(</span><span class="ident" id="3995637">Conn</span><span class="op" id="3995641">,</span>&nbsp;<span class="builtintype" id="3995643">error</span><span class="op" id="3995648">)</span>&nbsp;<span class="op" id="3995650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995654">return</span>&nbsp;<span class="ident" id="3995661">dialSingle</span><span class="op" id="3995671">(</span><span class="ident" id="3995672">network</span><span class="op" id="3995679">,</span>&nbsp;<span class="ident" id="3995681">address</span><span class="op" id="3995688">,</span>&nbsp;<span class="ident" id="3995690">d</span><span class="op" id="3995691">.</span><span class="ident" id="3995692">LocalAddr</span><span class="op" id="3995701">,</span>&nbsp;<span class="ident" id="3995703">ra</span><span class="op" id="3995705">.</span><span class="ident" id="3995706">toAddr</span><span class="op" id="3995712">(</span><span class="op" id="3995713">)</span><span class="op" id="3995714">,</span>&nbsp;<span class="ident" id="3995716">deadline</span><span class="op" id="3995724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995727">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995730">if</span>&nbsp;<span class="ident" id="3995733">ras</span><span class="op" id="3995736">,</span>&nbsp;<span class="ident" id="3995738">ok</span>&nbsp;<span class="op" id="3995741">:=</span>&nbsp;<span class="ident" id="3995744">ra</span><span class="op" id="3995746">.</span><span class="op" id="3995747">(</span><span class="ident" id="3995748">addrList</span><span class="op" id="3995756">)</span><span class="op" id="3995757">;</span>&nbsp;<span class="ident" id="3995759">ok</span>&nbsp;<span class="op" id="3995762">&amp;&amp;</span>&nbsp;<span class="ident" id="3995765">d</span><span class="op" id="3995766">.</span><span class="ident" id="3995767">DualStack</span>&nbsp;<span class="op" id="3995777">&amp;&amp;</span>&nbsp;<span class="ident" id="3995780">network</span>&nbsp;<span class="op" id="3995788">==</span>&nbsp;<span class="string" id="3995791">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3995797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995801">dialer</span>&nbsp;<span class="op" id="3995808">=</span>&nbsp;<span class="keyword" id="3995810">func</span><span class="op" id="3995814">(</span><span class="ident" id="3995815">deadline</span>&nbsp;<span class="ident" id="3995824">time</span><span class="op" id="3995828">.</span><span class="ident" id="3995829">Time</span><span class="op" id="3995833">)</span>&nbsp;<span class="op" id="3995835">(</span><span class="ident" id="3995836">Conn</span><span class="op" id="3995840">,</span>&nbsp;<span class="builtintype" id="3995842">error</span><span class="op" id="3995847">)</span>&nbsp;<span class="op" id="3995849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995854">return</span>&nbsp;<span class="ident" id="3995861">dialMulti</span><span class="op" id="3995870">(</span><span class="ident" id="3995871">network</span><span class="op" id="3995878">,</span>&nbsp;<span class="ident" id="3995880">address</span><span class="op" id="3995887">,</span>&nbsp;<span class="ident" id="3995889">d</span><span class="op" id="3995890">.</span><span class="ident" id="3995891">LocalAddr</span><span class="op" id="3995900">,</span>&nbsp;<span class="ident" id="3995902">ras</span><span class="op" id="3995905">,</span>&nbsp;<span class="ident" id="3995907">deadline</span><span class="op" id="3995915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995922">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995925">c</span><span class="op" id="3995926">,</span>&nbsp;<span class="ident" id="3995928">err</span>&nbsp;<span class="op" id="3995932">:=</span>&nbsp;<span class="ident" id="3995935">dial</span><span class="op" id="3995939">(</span><span class="ident" id="3995940">network</span><span class="op" id="3995947">,</span>&nbsp;<span class="ident" id="3995949">ra</span><span class="op" id="3995951">.</span><span class="ident" id="3995952">toAddr</span><span class="op" id="3995958">(</span><span class="op" id="3995959">)</span><span class="op" id="3995960">,</span>&nbsp;<span class="ident" id="3995962">dialer</span><span class="op" id="3995968">,</span>&nbsp;<span class="ident" id="3995970">d</span><span class="op" id="3995971">.</span><span class="ident" id="3995972">deadline</span><span class="op" id="3995980">(</span><span class="op" id="3995981">)</span><span class="op" id="3995982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995985">if</span>&nbsp;<span class="ident" id="3995988">d</span><span class="op" id="3995989">.</span><span class="ident" id="3995990">KeepAlive</span>&nbsp;<span class="op" id="3996000">&gt;</span>&nbsp;<span class="num" id="3996002">0</span>&nbsp;<span class="op" id="3996004">&amp;&amp;</span>&nbsp;<span class="ident" id="3996007">err</span>&nbsp;<span class="op" id="3996011">==</span>&nbsp;<span class="ident" id="3996014">nil</span>&nbsp;<span class="op" id="3996018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996022">if</span>&nbsp;<span class="ident" id="3996025">tc</span><span class="op" id="3996027">,</span>&nbsp;<span class="ident" id="3996029">ok</span>&nbsp;<span class="op" id="3996032">:=</span>&nbsp;<span class="ident" id="3996035">c</span><span class="op" id="3996036">.</span><span class="op" id="3996037">(</span><span class="op" id="3996038">*</span><span class="ident" id="3996039">TCPConn</span><span class="op" id="3996046">)</span><span class="op" id="3996047">;</span>&nbsp;<span class="ident" id="3996049">ok</span>&nbsp;<span class="op" id="3996052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996057">tc</span><span class="op" id="3996059">.</span><span class="ident" id="3996060">SetKeepAlive</span><span class="op" id="3996072">(</span><span class="builtintype" id="3996073">true</span><span class="op" id="3996077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996082">tc</span><span class="op" id="3996084">.</span><span class="ident" id="3996085">SetKeepAlivePeriod</span><span class="op" id="3996103">(</span><span class="ident" id="3996104">d</span><span class="op" id="3996105">.</span><span class="ident" id="3996106">KeepAlive</span><span class="op" id="3996115">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996120">testHookSetKeepAlive</span><span class="op" id="3996140">(</span><span class="op" id="3996141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996151">return</span>&nbsp;<span class="ident" id="3996158">c</span><span class="op" id="3996159">,</span>&nbsp;<span class="ident" id="3996161">err</span><br>
<span class="lineno"></span><span class="op" id="3996165">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3996168">var</span>&nbsp;<span class="ident" id="3996172">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3996193">=</span>&nbsp;<span class="keyword" id="3996195">func</span><span class="op" id="3996199">(</span><span class="op" id="3996200">)</span>&nbsp;<span class="op" id="3996202">{</span><span class="op" id="3996203">}</span>&nbsp;<span class="comment" id="3996205">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3996233">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3996303">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3996366">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3996434">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3996464">func</span>&nbsp;<span class="ident" id="3996469">dialMulti</span><span class="op" id="3996478">(</span><span class="ident" id="3996479">net</span><span class="op" id="3996482">,</span>&nbsp;<span class="ident" id="3996484">addr</span>&nbsp;<span class="builtintype" id="3996489">string</span><span class="op" id="3996495">,</span>&nbsp;<span class="ident" id="3996497">la</span>&nbsp;<span class="ident" id="3996500">Addr</span><span class="op" id="3996504">,</span>&nbsp;<span class="ident" id="3996506">ras</span>&nbsp;<span class="ident" id="3996510">addrList</span><span class="op" id="3996518">,</span>&nbsp;<span class="ident" id="3996520">deadline</span>&nbsp;<span class="ident" id="3996529">time</span><span class="op" id="3996533">.</span><span class="ident" id="3996534">Time</span><span class="op" id="3996538">)</span>&nbsp;<span class="op" id="3996540">(</span><span class="ident" id="3996541">Conn</span><span class="op" id="3996545">,</span>&nbsp;<span class="builtintype" id="3996547">error</span><span class="op" id="3996552">)</span>&nbsp;<span class="op" id="3996554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996557">type</span>&nbsp;<span class="ident" id="3996562">racer</span>&nbsp;<span class="keyword" id="3996568">struct</span>&nbsp;<span class="op" id="3996575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996579">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3996586">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996596">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996659">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996722">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996751">sig</span>&nbsp;<span class="op" id="3996755">:=</span>&nbsp;<span class="builtinfunc" id="3996758">make</span><span class="op" id="3996762">(</span><span class="keyword" id="3996763">chan</span>&nbsp;<span class="builtintype" id="3996768">bool</span><span class="op" id="3996772">,</span>&nbsp;<span class="num" id="3996774">1</span><span class="op" id="3996775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996778">lane</span>&nbsp;<span class="op" id="3996783">:=</span>&nbsp;<span class="builtinfunc" id="3996786">make</span><span class="op" id="3996790">(</span><span class="keyword" id="3996791">chan</span>&nbsp;<span class="ident" id="3996796">racer</span><span class="op" id="3996801">,</span>&nbsp;<span class="num" id="3996803">1</span><span class="op" id="3996804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996807">for</span>&nbsp;<span class="ident" id="3996811">_</span><span class="op" id="3996812">,</span>&nbsp;<span class="ident" id="3996814">ra</span>&nbsp;<span class="op" id="3996817">:=</span>&nbsp;<span class="keyword" id="3996820">range</span>&nbsp;<span class="ident" id="3996826">ras</span>&nbsp;<span class="op" id="3996830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996834">go</span>&nbsp;<span class="keyword" id="3996837">func</span><span class="op" id="3996841">(</span><span class="ident" id="3996842">ra</span>&nbsp;<span class="ident" id="3996845">Addr</span><span class="op" id="3996849">)</span>&nbsp;<span class="op" id="3996851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996856">c</span><span class="op" id="3996857">,</span>&nbsp;<span class="ident" id="3996859">err</span>&nbsp;<span class="op" id="3996863">:=</span>&nbsp;<span class="ident" id="3996866">dialSingle</span><span class="op" id="3996876">(</span><span class="ident" id="3996877">net</span><span class="op" id="3996880">,</span>&nbsp;<span class="ident" id="3996882">addr</span><span class="op" id="3996886">,</span>&nbsp;<span class="ident" id="3996888">la</span><span class="op" id="3996890">,</span>&nbsp;<span class="ident" id="3996892">ra</span><span class="op" id="3996894">,</span>&nbsp;<span class="ident" id="3996896">deadline</span><span class="op" id="3996904">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996909">if</span>&nbsp;<span class="ident" id="3996912">_</span><span class="op" id="3996913">,</span>&nbsp;<span class="ident" id="3996915">ok</span>&nbsp;<span class="op" id="3996918">:=</span>&nbsp;<span class="op" id="3996921">&lt;-</span><span class="ident" id="3996923">sig</span><span class="op" id="3996926">;</span>&nbsp;<span class="ident" id="3996928">ok</span>&nbsp;<span class="op" id="3996931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996937">lane</span>&nbsp;<span class="op" id="3996942">&lt;-</span>&nbsp;<span class="ident" id="3996945">racer</span><span class="op" id="3996950">{</span><span class="ident" id="3996951">c</span><span class="op" id="3996952">,</span>&nbsp;<span class="ident" id="3996954">err</span><span class="op" id="3996957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996962">}</span>&nbsp;<span class="keyword" id="3996964">else</span>&nbsp;<span class="keyword" id="3996969">if</span>&nbsp;<span class="ident" id="3996972">err</span>&nbsp;<span class="op" id="3996976">==</span>&nbsp;<span class="ident" id="3996979">nil</span>&nbsp;<span class="op" id="3996983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996989">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997028">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997060">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997097">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997137">c</span><span class="op" id="3997138">.</span><span class="ident" id="3997139">Close</span><span class="op" id="3997144">(</span><span class="op" id="3997145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997154">}</span><span class="op" id="3997155">(</span><span class="ident" id="3997156">ra</span><span class="op" id="3997158">.</span><span class="ident" id="3997159">toAddr</span><span class="op" id="3997165">(</span><span class="op" id="3997166">)</span><span class="op" id="3997167">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997173">defer</span>&nbsp;<span class="builtinfunc" id="3997179">close</span><span class="op" id="3997184">(</span><span class="ident" id="3997185">sig</span><span class="op" id="3997188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997191">lastErr</span>&nbsp;<span class="op" id="3997199">:=</span>&nbsp;<span class="ident" id="3997202">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997214">nracers</span>&nbsp;<span class="op" id="3997222">:=</span>&nbsp;<span class="builtinfunc" id="3997225">len</span><span class="op" id="3997228">(</span><span class="ident" id="3997229">ras</span><span class="op" id="3997232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997235">for</span>&nbsp;<span class="ident" id="3997239">nracers</span>&nbsp;<span class="op" id="3997247">&gt;</span>&nbsp;<span class="num" id="3997249">0</span>&nbsp;<span class="op" id="3997251">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997255">sig</span>&nbsp;<span class="op" id="3997259">&lt;-</span>&nbsp;<span class="builtintype" id="3997262">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997269">racer</span>&nbsp;<span class="op" id="3997275">:=</span>&nbsp;<span class="op" id="3997278">&lt;-</span><span class="ident" id="3997280">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997287">if</span>&nbsp;<span class="ident" id="3997290">racer</span><span class="op" id="3997295">.</span><span class="builtintype" id="3997296">error</span>&nbsp;<span class="op" id="3997302">==</span>&nbsp;<span class="ident" id="3997305">nil</span>&nbsp;<span class="op" id="3997309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997314">return</span>&nbsp;<span class="ident" id="3997321">racer</span><span class="op" id="3997326">.</span><span class="ident" id="3997327">Conn</span><span class="op" id="3997331">,</span>&nbsp;<span class="ident" id="3997333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997339">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997343">lastErr</span>&nbsp;<span class="op" id="3997351">=</span>&nbsp;<span class="ident" id="3997353">racer</span><span class="op" id="3997358">.</span><span class="builtintype" id="3997359">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997367">nracers</span><span class="op" id="3997374">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997381">return</span>&nbsp;<span class="ident" id="3997388">nil</span><span class="op" id="3997391">,</span>&nbsp;<span class="ident" id="3997393">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3997401">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3997404">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3997475">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3997503">func</span>&nbsp;<span class="ident" id="3997508">dialSingle</span><span class="op" id="3997518">(</span><span class="ident" id="3997519">net</span><span class="op" id="3997522">,</span>&nbsp;<span class="ident" id="3997524">addr</span>&nbsp;<span class="builtintype" id="3997529">string</span><span class="op" id="3997535">,</span>&nbsp;<span class="ident" id="3997537">la</span><span class="op" id="3997539">,</span>&nbsp;<span class="ident" id="3997541">ra</span>&nbsp;<span class="ident" id="3997544">Addr</span><span class="op" id="3997548">,</span>&nbsp;<span class="ident" id="3997550">deadline</span>&nbsp;<span class="ident" id="3997559">time</span><span class="op" id="3997563">.</span><span class="ident" id="3997564">Time</span><span class="op" id="3997568">)</span>&nbsp;<span class="op" id="3997570">(</span><span class="ident" id="3997571">c</span>&nbsp;<span class="ident" id="3997573">Conn</span><span class="op" id="3997577">,</span>&nbsp;<span class="ident" id="3997579">err</span>&nbsp;<span class="builtintype" id="3997583">error</span><span class="op" id="3997588">)</span>&nbsp;<span class="op" id="3997590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997593">if</span>&nbsp;<span class="ident" id="3997596">la</span>&nbsp;<span class="op" id="3997599">!=</span>&nbsp;<span class="ident" id="3997602">nil</span>&nbsp;<span class="op" id="3997606">&amp;&amp;</span>&nbsp;<span class="ident" id="3997609">la</span><span class="op" id="3997611">.</span><span class="ident" id="3997612">Network</span><span class="op" id="3997619">(</span><span class="op" id="3997620">)</span>&nbsp;<span class="op" id="3997622">!=</span>&nbsp;<span class="ident" id="3997625">ra</span><span class="op" id="3997627">.</span><span class="ident" id="3997628">Network</span><span class="op" id="3997635">(</span><span class="op" id="3997636">)</span>&nbsp;<span class="op" id="3997638">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997642">return</span>&nbsp;<span class="ident" id="3997649">nil</span><span class="op" id="3997652">,</span>&nbsp;<span class="op" id="3997654">&amp;</span><span class="ident" id="3997655">OpError</span><span class="op" id="3997662">{</span><span class="ident" id="3997663">Op</span><span class="op" id="3997665">:</span>&nbsp;<span class="string" id="3997667">&#34;dial&#34;</span><span class="op" id="3997673">,</span>&nbsp;<span class="ident" id="3997675">Net</span><span class="op" id="3997678">:</span>&nbsp;<span class="ident" id="3997680">net</span><span class="op" id="3997683">,</span>&nbsp;<span class="ident" id="3997685">Addr</span><span class="op" id="3997689">:</span>&nbsp;<span class="ident" id="3997691">ra</span><span class="op" id="3997693">,</span>&nbsp;<span class="ident" id="3997695">Err</span><span class="op" id="3997698">:</span>&nbsp;<span class="ident" id="3997700">errors</span><span class="op" id="3997706">.</span><span class="ident" id="3997707">New</span><span class="op" id="3997710">(</span><span class="string" id="3997711">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3997744">+</span>&nbsp;<span class="ident" id="3997746">la</span><span class="op" id="3997748">.</span><span class="ident" id="3997749">Network</span><span class="op" id="3997756">(</span><span class="op" id="3997757">)</span><span class="op" id="3997758">)</span><span class="op" id="3997759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997765">switch</span>&nbsp;<span class="ident" id="3997772">ra</span>&nbsp;<span class="op" id="3997775">:=</span>&nbsp;<span class="ident" id="3997778">ra</span><span class="op" id="3997780">.</span><span class="op" id="3997781">(</span><span class="keyword" id="3997782">type</span><span class="op" id="3997786">)</span>&nbsp;<span class="op" id="3997788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997791">case</span>&nbsp;<span class="op" id="3997796">*</span><span class="ident" id="3997797">TCPAddr</span><span class="op" id="3997804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997808">la</span><span class="op" id="3997810">,</span>&nbsp;<span class="ident" id="3997812">_</span>&nbsp;<span class="op" id="3997814">:=</span>&nbsp;<span class="ident" id="3997817">la</span><span class="op" id="3997819">.</span><span class="op" id="3997820">(</span><span class="op" id="3997821">*</span><span class="ident" id="3997822">TCPAddr</span><span class="op" id="3997829">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997833">c</span><span class="op" id="3997834">,</span>&nbsp;<span class="ident" id="3997836">err</span>&nbsp;<span class="op" id="3997840">=</span>&nbsp;<span class="ident" id="3997842">dialTCP</span><span class="op" id="3997849">(</span><span class="ident" id="3997850">net</span><span class="op" id="3997853">,</span>&nbsp;<span class="ident" id="3997855">la</span><span class="op" id="3997857">,</span>&nbsp;<span class="ident" id="3997859">ra</span><span class="op" id="3997861">,</span>&nbsp;<span class="ident" id="3997863">deadline</span><span class="op" id="3997871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997874">case</span>&nbsp;<span class="op" id="3997879">*</span><span class="ident" id="3997880">UDPAddr</span><span class="op" id="3997887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997891">la</span><span class="op" id="3997893">,</span>&nbsp;<span class="ident" id="3997895">_</span>&nbsp;<span class="op" id="3997897">:=</span>&nbsp;<span class="ident" id="3997900">la</span><span class="op" id="3997902">.</span><span class="op" id="3997903">(</span><span class="op" id="3997904">*</span><span class="ident" id="3997905">UDPAddr</span><span class="op" id="3997912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997916">c</span><span class="op" id="3997917">,</span>&nbsp;<span class="ident" id="3997919">err</span>&nbsp;<span class="op" id="3997923">=</span>&nbsp;<span class="ident" id="3997925">dialUDP</span><span class="op" id="3997932">(</span><span class="ident" id="3997933">net</span><span class="op" id="3997936">,</span>&nbsp;<span class="ident" id="3997938">la</span><span class="op" id="3997940">,</span>&nbsp;<span class="ident" id="3997942">ra</span><span class="op" id="3997944">,</span>&nbsp;<span class="ident" id="3997946">deadline</span><span class="op" id="3997954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997957">case</span>&nbsp;<span class="op" id="3997962">*</span><span class="ident" id="3997963">IPAddr</span><span class="op" id="3997969">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997973">la</span><span class="op" id="3997975">,</span>&nbsp;<span class="ident" id="3997977">_</span>&nbsp;<span class="op" id="3997979">:=</span>&nbsp;<span class="ident" id="3997982">la</span><span class="op" id="3997984">.</span><span class="op" id="3997985">(</span><span class="op" id="3997986">*</span><span class="ident" id="3997987">IPAddr</span><span class="op" id="3997993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997997">c</span><span class="op" id="3997998">,</span>&nbsp;<span class="ident" id="3998000">err</span>&nbsp;<span class="op" id="3998004">=</span>&nbsp;<span class="ident" id="3998006">dialIP</span><span class="op" id="3998012">(</span><span class="ident" id="3998013">net</span><span class="op" id="3998016">,</span>&nbsp;<span class="ident" id="3998018">la</span><span class="op" id="3998020">,</span>&nbsp;<span class="ident" id="3998022">ra</span><span class="op" id="3998024">,</span>&nbsp;<span class="ident" id="3998026">deadline</span><span class="op" id="3998034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998037">case</span>&nbsp;<span class="op" id="3998042">*</span><span class="ident" id="3998043">UnixAddr</span><span class="op" id="3998051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998055">la</span><span class="op" id="3998057">,</span>&nbsp;<span class="ident" id="3998059">_</span>&nbsp;<span class="op" id="3998061">:=</span>&nbsp;<span class="ident" id="3998064">la</span><span class="op" id="3998066">.</span><span class="op" id="3998067">(</span><span class="op" id="3998068">*</span><span class="ident" id="3998069">UnixAddr</span><span class="op" id="3998077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998081">c</span><span class="op" id="3998082">,</span>&nbsp;<span class="ident" id="3998084">err</span>&nbsp;<span class="op" id="3998088">=</span>&nbsp;<span class="ident" id="3998090">dialUnix</span><span class="op" id="3998098">(</span><span class="ident" id="3998099">net</span><span class="op" id="3998102">,</span>&nbsp;<span class="ident" id="3998104">la</span><span class="op" id="3998106">,</span>&nbsp;<span class="ident" id="3998108">ra</span><span class="op" id="3998110">,</span>&nbsp;<span class="ident" id="3998112">deadline</span><span class="op" id="3998120">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998123">default</span><span class="op" id="3998130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998134">return</span>&nbsp;<span class="ident" id="3998141">nil</span><span class="op" id="3998144">,</span>&nbsp;<span class="op" id="3998146">&amp;</span><span class="ident" id="3998147">OpError</span><span class="op" id="3998154">{</span><span class="ident" id="3998155">Op</span><span class="op" id="3998157">:</span>&nbsp;<span class="string" id="3998159">&#34;dial&#34;</span><span class="op" id="3998165">,</span>&nbsp;<span class="ident" id="3998167">Net</span><span class="op" id="3998170">:</span>&nbsp;<span class="ident" id="3998172">net</span><span class="op" id="3998175">,</span>&nbsp;<span class="ident" id="3998177">Addr</span><span class="op" id="3998181">:</span>&nbsp;<span class="ident" id="3998183">ra</span><span class="op" id="3998185">,</span>&nbsp;<span class="ident" id="3998187">Err</span><span class="op" id="3998190">:</span>&nbsp;<span class="op" id="3998192">&amp;</span><span class="ident" id="3998193">AddrError</span><span class="op" id="3998202">{</span><span class="ident" id="3998203">Err</span><span class="op" id="3998206">:</span>&nbsp;<span class="string" id="3998208">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3998233">,</span>&nbsp;<span class="ident" id="3998235">Addr</span><span class="op" id="3998239">:</span>&nbsp;<span class="ident" id="3998241">addr</span><span class="op" id="3998245">}</span><span class="op" id="3998246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998252">if</span>&nbsp;<span class="ident" id="3998255">err</span>&nbsp;<span class="op" id="3998259">!=</span>&nbsp;<span class="ident" id="3998262">nil</span>&nbsp;<span class="op" id="3998266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998270">return</span>&nbsp;<span class="ident" id="3998277">nil</span><span class="op" id="3998280">,</span>&nbsp;<span class="ident" id="3998282">err</span>&nbsp;<span class="comment" id="3998286">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998339">return</span>&nbsp;<span class="ident" id="3998346">c</span><span class="op" id="3998347">,</span>&nbsp;<span class="ident" id="3998349">nil</span><br>
<span class="lineno"></span><span class="op" id="3998353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3998356">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3998412">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3998481">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3998516">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3998553">func</span>&nbsp;<span class="ident" id="3998558">Listen</span><span class="op" id="3998564">(</span><span class="ident" id="3998565">net</span><span class="op" id="3998568">,</span>&nbsp;<span class="ident" id="3998570">laddr</span>&nbsp;<span class="builtintype" id="3998576">string</span><span class="op" id="3998582">)</span>&nbsp;<span class="op" id="3998584">(</span><span class="ident" id="3998585">Listener</span><span class="op" id="3998593">,</span>&nbsp;<span class="builtintype" id="3998595">error</span><span class="op" id="3998600">)</span>&nbsp;<span class="op" id="3998602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998605">la</span><span class="op" id="3998607">,</span>&nbsp;<span class="ident" id="3998609">err</span>&nbsp;<span class="op" id="3998613">:=</span>&nbsp;<span class="ident" id="3998616">resolveAddr</span><span class="op" id="3998627">(</span><span class="string" id="3998628">&#34;listen&#34;</span><span class="op" id="3998636">,</span>&nbsp;<span class="ident" id="3998638">net</span><span class="op" id="3998641">,</span>&nbsp;<span class="ident" id="3998643">laddr</span><span class="op" id="3998648">,</span>&nbsp;<span class="ident" id="3998650">noDeadline</span><span class="op" id="3998660">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998663">if</span>&nbsp;<span class="ident" id="3998666">err</span>&nbsp;<span class="op" id="3998670">!=</span>&nbsp;<span class="ident" id="3998673">nil</span>&nbsp;<span class="op" id="3998677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998681">return</span>&nbsp;<span class="ident" id="3998688">nil</span><span class="op" id="3998691">,</span>&nbsp;<span class="op" id="3998693">&amp;</span><span class="ident" id="3998694">OpError</span><span class="op" id="3998701">{</span><span class="ident" id="3998702">Op</span><span class="op" id="3998704">:</span>&nbsp;<span class="string" id="3998706">&#34;listen&#34;</span><span class="op" id="3998714">,</span>&nbsp;<span class="ident" id="3998716">Net</span><span class="op" id="3998719">:</span>&nbsp;<span class="ident" id="3998721">net</span><span class="op" id="3998724">,</span>&nbsp;<span class="ident" id="3998726">Addr</span><span class="op" id="3998730">:</span>&nbsp;<span class="ident" id="3998732">nil</span><span class="op" id="3998735">,</span>&nbsp;<span class="ident" id="3998737">Err</span><span class="op" id="3998740">:</span>&nbsp;<span class="ident" id="3998742">err</span><span class="op" id="3998745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998751">var</span>&nbsp;<span class="ident" id="3998755">l</span>&nbsp;<span class="ident" id="3998757">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998767">switch</span>&nbsp;<span class="ident" id="3998774">la</span>&nbsp;<span class="op" id="3998777">:=</span>&nbsp;<span class="ident" id="3998780">la</span><span class="op" id="3998782">.</span><span class="ident" id="3998783">toAddr</span><span class="op" id="3998789">(</span><span class="op" id="3998790">)</span><span class="op" id="3998791">.</span><span class="op" id="3998792">(</span><span class="keyword" id="3998793">type</span><span class="op" id="3998797">)</span>&nbsp;<span class="op" id="3998799">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998802">case</span>&nbsp;<span class="op" id="3998807">*</span><span class="ident" id="3998808">TCPAddr</span><span class="op" id="3998815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998819">l</span><span class="op" id="3998820">,</span>&nbsp;<span class="ident" id="3998822">err</span>&nbsp;<span class="op" id="3998826">=</span>&nbsp;<span class="ident" id="3998828">ListenTCP</span><span class="op" id="3998837">(</span><span class="ident" id="3998838">net</span><span class="op" id="3998841">,</span>&nbsp;<span class="ident" id="3998843">la</span><span class="op" id="3998845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998848">case</span>&nbsp;<span class="op" id="3998853">*</span><span class="ident" id="3998854">UnixAddr</span><span class="op" id="3998862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998866">l</span><span class="op" id="3998867">,</span>&nbsp;<span class="ident" id="3998869">err</span>&nbsp;<span class="op" id="3998873">=</span>&nbsp;<span class="ident" id="3998875">ListenUnix</span><span class="op" id="3998885">(</span><span class="ident" id="3998886">net</span><span class="op" id="3998889">,</span>&nbsp;<span class="ident" id="3998891">la</span><span class="op" id="3998893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998896">default</span><span class="op" id="3998903">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998907">return</span>&nbsp;<span class="ident" id="3998914">nil</span><span class="op" id="3998917">,</span>&nbsp;<span class="op" id="3998919">&amp;</span><span class="ident" id="3998920">OpError</span><span class="op" id="3998927">{</span><span class="ident" id="3998928">Op</span><span class="op" id="3998930">:</span>&nbsp;<span class="string" id="3998932">&#34;listen&#34;</span><span class="op" id="3998940">,</span>&nbsp;<span class="ident" id="3998942">Net</span><span class="op" id="3998945">:</span>&nbsp;<span class="ident" id="3998947">net</span><span class="op" id="3998950">,</span>&nbsp;<span class="ident" id="3998952">Addr</span><span class="op" id="3998956">:</span>&nbsp;<span class="ident" id="3998958">la</span><span class="op" id="3998960">,</span>&nbsp;<span class="ident" id="3998962">Err</span><span class="op" id="3998965">:</span>&nbsp;<span class="op" id="3998967">&amp;</span><span class="ident" id="3998968">AddrError</span><span class="op" id="3998977">{</span><span class="ident" id="3998978">Err</span><span class="op" id="3998981">:</span>&nbsp;<span class="string" id="3998983">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3999008">,</span>&nbsp;<span class="ident" id="3999010">Addr</span><span class="op" id="3999014">:</span>&nbsp;<span class="ident" id="3999016">laddr</span><span class="op" id="3999021">}</span><span class="op" id="3999022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999028">if</span>&nbsp;<span class="ident" id="3999031">err</span>&nbsp;<span class="op" id="3999035">!=</span>&nbsp;<span class="ident" id="3999038">nil</span>&nbsp;<span class="op" id="3999042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999046">return</span>&nbsp;<span class="ident" id="3999053">nil</span><span class="op" id="3999056">,</span>&nbsp;<span class="ident" id="3999058">err</span>&nbsp;<span class="comment" id="3999062">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999112">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999115">return</span>&nbsp;<span class="ident" id="3999122">l</span><span class="op" id="3999123">,</span>&nbsp;<span class="ident" id="3999125">nil</span><br>
<span class="lineno"></span><span class="op" id="3999129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3999132">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3999194">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3999263">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3999308">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3999345">func</span>&nbsp;<span class="ident" id="3999350">ListenPacket</span><span class="op" id="3999362">(</span><span class="ident" id="3999363">net</span><span class="op" id="3999366">,</span>&nbsp;<span class="ident" id="3999368">laddr</span>&nbsp;<span class="builtintype" id="3999374">string</span><span class="op" id="3999380">)</span>&nbsp;<span class="op" id="3999382">(</span><span class="ident" id="3999383">PacketConn</span><span class="op" id="3999393">,</span>&nbsp;<span class="builtintype" id="3999395">error</span><span class="op" id="3999400">)</span>&nbsp;<span class="op" id="3999402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999405">la</span><span class="op" id="3999407">,</span>&nbsp;<span class="ident" id="3999409">err</span>&nbsp;<span class="op" id="3999413">:=</span>&nbsp;<span class="ident" id="3999416">resolveAddr</span><span class="op" id="3999427">(</span><span class="string" id="3999428">&#34;listen&#34;</span><span class="op" id="3999436">,</span>&nbsp;<span class="ident" id="3999438">net</span><span class="op" id="3999441">,</span>&nbsp;<span class="ident" id="3999443">laddr</span><span class="op" id="3999448">,</span>&nbsp;<span class="ident" id="3999450">noDeadline</span><span class="op" id="3999460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999463">if</span>&nbsp;<span class="ident" id="3999466">err</span>&nbsp;<span class="op" id="3999470">!=</span>&nbsp;<span class="ident" id="3999473">nil</span>&nbsp;<span class="op" id="3999477">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999481">return</span>&nbsp;<span class="ident" id="3999488">nil</span><span class="op" id="3999491">,</span>&nbsp;<span class="op" id="3999493">&amp;</span><span class="ident" id="3999494">OpError</span><span class="op" id="3999501">{</span><span class="ident" id="3999502">Op</span><span class="op" id="3999504">:</span>&nbsp;<span class="string" id="3999506">&#34;listen&#34;</span><span class="op" id="3999514">,</span>&nbsp;<span class="ident" id="3999516">Net</span><span class="op" id="3999519">:</span>&nbsp;<span class="ident" id="3999521">net</span><span class="op" id="3999524">,</span>&nbsp;<span class="ident" id="3999526">Addr</span><span class="op" id="3999530">:</span>&nbsp;<span class="ident" id="3999532">nil</span><span class="op" id="3999535">,</span>&nbsp;<span class="ident" id="3999537">Err</span><span class="op" id="3999540">:</span>&nbsp;<span class="ident" id="3999542">err</span><span class="op" id="3999545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999551">var</span>&nbsp;<span class="ident" id="3999555">l</span>&nbsp;<span class="ident" id="3999557">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999569">switch</span>&nbsp;<span class="ident" id="3999576">la</span>&nbsp;<span class="op" id="3999579">:=</span>&nbsp;<span class="ident" id="3999582">la</span><span class="op" id="3999584">.</span><span class="ident" id="3999585">toAddr</span><span class="op" id="3999591">(</span><span class="op" id="3999592">)</span><span class="op" id="3999593">.</span><span class="op" id="3999594">(</span><span class="keyword" id="3999595">type</span><span class="op" id="3999599">)</span>&nbsp;<span class="op" id="3999601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999604">case</span>&nbsp;<span class="op" id="3999609">*</span><span class="ident" id="3999610">UDPAddr</span><span class="op" id="3999617">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999621">l</span><span class="op" id="3999622">,</span>&nbsp;<span class="ident" id="3999624">err</span>&nbsp;<span class="op" id="3999628">=</span>&nbsp;<span class="ident" id="3999630">ListenUDP</span><span class="op" id="3999639">(</span><span class="ident" id="3999640">net</span><span class="op" id="3999643">,</span>&nbsp;<span class="ident" id="3999645">la</span><span class="op" id="3999647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999650">case</span>&nbsp;<span class="op" id="3999655">*</span><span class="ident" id="3999656">IPAddr</span><span class="op" id="3999662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999666">l</span><span class="op" id="3999667">,</span>&nbsp;<span class="ident" id="3999669">err</span>&nbsp;<span class="op" id="3999673">=</span>&nbsp;<span class="ident" id="3999675">ListenIP</span><span class="op" id="3999683">(</span><span class="ident" id="3999684">net</span><span class="op" id="3999687">,</span>&nbsp;<span class="ident" id="3999689">la</span><span class="op" id="3999691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999694">case</span>&nbsp;<span class="op" id="3999699">*</span><span class="ident" id="3999700">UnixAddr</span><span class="op" id="3999708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999712">l</span><span class="op" id="3999713">,</span>&nbsp;<span class="ident" id="3999715">err</span>&nbsp;<span class="op" id="3999719">=</span>&nbsp;<span class="ident" id="3999721">ListenUnixgram</span><span class="op" id="3999735">(</span><span class="ident" id="3999736">net</span><span class="op" id="3999739">,</span>&nbsp;<span class="ident" id="3999741">la</span><span class="op" id="3999743">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999746">default</span><span class="op" id="3999753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999757">return</span>&nbsp;<span class="ident" id="3999764">nil</span><span class="op" id="3999767">,</span>&nbsp;<span class="op" id="3999769">&amp;</span><span class="ident" id="3999770">OpError</span><span class="op" id="3999777">{</span><span class="ident" id="3999778">Op</span><span class="op" id="3999780">:</span>&nbsp;<span class="string" id="3999782">&#34;listen&#34;</span><span class="op" id="3999790">,</span>&nbsp;<span class="ident" id="3999792">Net</span><span class="op" id="3999795">:</span>&nbsp;<span class="ident" id="3999797">net</span><span class="op" id="3999800">,</span>&nbsp;<span class="ident" id="3999802">Addr</span><span class="op" id="3999806">:</span>&nbsp;<span class="ident" id="3999808">la</span><span class="op" id="3999810">,</span>&nbsp;<span class="ident" id="3999812">Err</span><span class="op" id="3999815">:</span>&nbsp;<span class="op" id="3999817">&amp;</span><span class="ident" id="3999818">AddrError</span><span class="op" id="3999827">{</span><span class="ident" id="3999828">Err</span><span class="op" id="3999831">:</span>&nbsp;<span class="string" id="3999833">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3999858">,</span>&nbsp;<span class="ident" id="3999860">Addr</span><span class="op" id="3999864">:</span>&nbsp;<span class="ident" id="3999866">laddr</span><span class="op" id="3999871">}</span><span class="op" id="3999872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999878">if</span>&nbsp;<span class="ident" id="3999881">err</span>&nbsp;<span class="op" id="3999885">!=</span>&nbsp;<span class="ident" id="3999888">nil</span>&nbsp;<span class="op" id="3999892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999896">return</span>&nbsp;<span class="ident" id="3999903">nil</span><span class="op" id="3999906">,</span>&nbsp;<span class="ident" id="3999908">err</span>&nbsp;<span class="comment" id="3999912">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999965">return</span>&nbsp;<span class="ident" id="3999972">l</span><span class="op" id="3999973">,</span>&nbsp;<span class="ident" id="3999975">nil</span><br>
<span class="lineno"></span><span class="op" id="3999979">}</span>
</div>
</body>
</html>
