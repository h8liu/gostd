<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5198398">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5198453">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5198507">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5198558">package</span>&nbsp;<span class="ident" id="5198566">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5198576">import</span>&nbsp;<span class="op" id="5198583">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5198586">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5198595">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5198605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5198608">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5198687">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5198765">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5198843">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5198853">var</span>&nbsp;<span class="ident" id="5198857">transitionFunc</span>&nbsp;<span class="op" id="5198872">=</span>&nbsp;<span class="op" id="5198874">[</span><span class="op" id="5198875">...</span><span class="op" id="5198878">]</span><span class="keyword" id="5198879">func</span><span class="op" id="5198883">(</span><span class="ident" id="5198884">context</span><span class="op" id="5198891">,</span>&nbsp;<span class="op" id="5198893">[</span><span class="op" id="5198894">]</span><span class="builtintype" id="5198895">byte</span><span class="op" id="5198899">)</span>&nbsp;<span class="op" id="5198901">(</span><span class="ident" id="5198902">context</span><span class="op" id="5198909">,</span>&nbsp;<span class="builtintype" id="5198911">int</span><span class="op" id="5198914">)</span><span class="op" id="5198915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198918">stateText</span><span class="op" id="5198927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198936">tText</span><span class="op" id="5198941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198944">stateTag</span><span class="op" id="5198952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198962">tTag</span><span class="op" id="5198966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198969">stateAttrName</span><span class="op" id="5198982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5198987">tAttrName</span><span class="op" id="5198996">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5198999">stateAfterName</span><span class="op" id="5199013">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5199017">tAfterName</span><span class="op" id="5199027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199030">stateBeforeValue</span><span class="op" id="5199046">:</span>&nbsp;<span class="ident" id="5199048">tBeforeValue</span><span class="op" id="5199060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199063">stateHTMLCmt</span><span class="op" id="5199075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199081">tHTMLCmt</span><span class="op" id="5199089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199092">stateRCDATA</span><span class="op" id="5199103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199110">tSpecialTagEnd</span><span class="op" id="5199124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199127">stateAttr</span><span class="op" id="5199136">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199145">tAttr</span><span class="op" id="5199150">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199153">stateURL</span><span class="op" id="5199161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199171">tURL</span><span class="op" id="5199175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199178">stateJS</span><span class="op" id="5199185">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199196">tJS</span><span class="op" id="5199199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199202">stateJSDqStr</span><span class="op" id="5199214">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199220">tJSDelimited</span><span class="op" id="5199232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199235">stateJSSqStr</span><span class="op" id="5199247">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199253">tJSDelimited</span><span class="op" id="5199265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199268">stateJSRegexp</span><span class="op" id="5199281">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199286">tJSDelimited</span><span class="op" id="5199298">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199301">stateJSBlockCmt</span><span class="op" id="5199316">:</span>&nbsp;&nbsp;<span class="ident" id="5199319">tBlockCmt</span><span class="op" id="5199328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199331">stateJSLineCmt</span><span class="op" id="5199345">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5199349">tLineCmt</span><span class="op" id="5199357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199360">stateCSS</span><span class="op" id="5199368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199378">tCSS</span><span class="op" id="5199382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199385">stateCSSDqStr</span><span class="op" id="5199398">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199403">tCSSStr</span><span class="op" id="5199410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199413">stateCSSSqStr</span><span class="op" id="5199426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199431">tCSSStr</span><span class="op" id="5199438">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199441">stateCSSDqURL</span><span class="op" id="5199454">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199459">tCSSStr</span><span class="op" id="5199466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199469">stateCSSSqURL</span><span class="op" id="5199482">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199487">tCSSStr</span><span class="op" id="5199494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199497">stateCSSURL</span><span class="op" id="5199508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199515">tCSSStr</span><span class="op" id="5199522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199525">stateCSSBlockCmt</span><span class="op" id="5199541">:</span>&nbsp;<span class="ident" id="5199543">tBlockCmt</span><span class="op" id="5199552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199555">stateCSSLineCmt</span><span class="op" id="5199570">:</span>&nbsp;&nbsp;<span class="ident" id="5199573">tLineCmt</span><span class="op" id="5199581">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199584">stateError</span><span class="op" id="5199594">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5199602">tError</span><span class="op" id="5199608">,</span><br>
<span class="lineno"></span><span class="op" id="5199610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5199613">var</span>&nbsp;<span class="ident" id="5199617">commentStart</span>&nbsp;<span class="op" id="5199630">=</span>&nbsp;<span class="op" id="5199632">[</span><span class="op" id="5199633">]</span><span class="builtintype" id="5199634">byte</span><span class="op" id="5199638">(</span><span class="string" id="5199639">&#34;&lt;!--&#34;</span><span class="op" id="5199645">)</span><br>
<span class="lineno"></span><span class="keyword" id="5199647">var</span>&nbsp;<span class="ident" id="5199651">commentEnd</span>&nbsp;<span class="op" id="5199662">=</span>&nbsp;<span class="op" id="5199664">[</span><span class="op" id="5199665">]</span><span class="builtintype" id="5199666">byte</span><span class="op" id="5199670">(</span><span class="string" id="5199671">&#34;--&gt;&#34;</span><span class="op" id="5199676">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5199679">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5199743">func</span>&nbsp;<span class="ident" id="5199748">tText</span><span class="op" id="5199753">(</span><span class="ident" id="5199754">c</span>&nbsp;<span class="ident" id="5199756">context</span><span class="op" id="5199763">,</span>&nbsp;<span class="ident" id="5199765">s</span>&nbsp;<span class="op" id="5199767">[</span><span class="op" id="5199768">]</span><span class="builtintype" id="5199769">byte</span><span class="op" id="5199773">)</span>&nbsp;<span class="op" id="5199775">(</span><span class="ident" id="5199776">context</span><span class="op" id="5199783">,</span>&nbsp;<span class="builtintype" id="5199785">int</span><span class="op" id="5199788">)</span>&nbsp;<span class="op" id="5199790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199793">k</span>&nbsp;<span class="op" id="5199795">:=</span>&nbsp;<span class="num" id="5199798">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199801">for</span>&nbsp;<span class="op" id="5199805">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5199809">i</span>&nbsp;<span class="op" id="5199811">:=</span>&nbsp;<span class="ident" id="5199814">k</span>&nbsp;<span class="op" id="5199816">+</span>&nbsp;<span class="ident" id="5199818">bytes</span><span class="op" id="5199823">.</span><span class="ident" id="5199824">IndexByte</span><span class="op" id="5199833">(</span><span class="ident" id="5199834">s</span><span class="op" id="5199835">[</span><span class="ident" id="5199836">k</span><span class="op" id="5199837">:</span><span class="op" id="5199838">]</span><span class="op" id="5199839">,</span>&nbsp;<span class="string" id="5199841">&#39;&lt;&#39;</span><span class="op" id="5199844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199848">if</span>&nbsp;<span class="ident" id="5199851">i</span>&nbsp;<span class="op" id="5199853">&lt;</span>&nbsp;<span class="ident" id="5199855">k</span>&nbsp;<span class="op" id="5199857">||</span>&nbsp;<span class="ident" id="5199860">i</span><span class="op" id="5199861">+</span><span class="num" id="5199862">1</span>&nbsp;<span class="op" id="5199864">==</span>&nbsp;<span class="builtinfunc" id="5199867">len</span><span class="op" id="5199870">(</span><span class="ident" id="5199871">s</span><span class="op" id="5199872">)</span>&nbsp;<span class="op" id="5199874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199879">return</span>&nbsp;<span class="ident" id="5199886">c</span><span class="op" id="5199887">,</span>&nbsp;<span class="builtinfunc" id="5199889">len</span><span class="op" id="5199892">(</span><span class="ident" id="5199893">s</span><span class="op" id="5199894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5199898">}</span>&nbsp;<span class="keyword" id="5199900">else</span>&nbsp;<span class="keyword" id="5199905">if</span>&nbsp;<span class="ident" id="5199908">i</span><span class="op" id="5199909">+</span><span class="num" id="5199910">4</span>&nbsp;<span class="op" id="5199912">&lt;=</span>&nbsp;<span class="builtinfunc" id="5199915">len</span><span class="op" id="5199918">(</span><span class="ident" id="5199919">s</span><span class="op" id="5199920">)</span>&nbsp;<span class="op" id="5199922">&amp;&amp;</span>&nbsp;<span class="ident" id="5199925">bytes</span><span class="op" id="5199930">.</span><span class="ident" id="5199931">Equal</span><span class="op" id="5199936">(</span><span class="ident" id="5199937">commentStart</span><span class="op" id="5199949">,</span>&nbsp;<span class="ident" id="5199951">s</span><span class="op" id="5199952">[</span><span class="ident" id="5199953">i</span><span class="op" id="5199954">:</span><span class="ident" id="5199955">i</span><span class="op" id="5199956">+</span><span class="num" id="5199957">4</span><span class="op" id="5199958">]</span><span class="op" id="5199959">)</span>&nbsp;<span class="op" id="5199961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5199966">return</span>&nbsp;<span class="ident" id="5199973">context</span><span class="op" id="5199980">{</span><span class="ident" id="5199981">state</span><span class="op" id="5199986">:</span>&nbsp;<span class="ident" id="5199988">stateHTMLCmt</span><span class="op" id="5200000">}</span><span class="op" id="5200001">,</span>&nbsp;<span class="ident" id="5200003">i</span>&nbsp;<span class="op" id="5200005">+</span>&nbsp;<span class="num" id="5200007">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200015">i</span><span class="op" id="5200016">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200021">end</span>&nbsp;<span class="op" id="5200025">:=</span>&nbsp;<span class="builtintype" id="5200028">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200036">if</span>&nbsp;<span class="ident" id="5200039">s</span><span class="op" id="5200040">[</span><span class="ident" id="5200041">i</span><span class="op" id="5200042">]</span>&nbsp;<span class="op" id="5200044">==</span>&nbsp;<span class="string" id="5200047">&#39;/&#39;</span>&nbsp;<span class="op" id="5200051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200056">if</span>&nbsp;<span class="ident" id="5200059">i</span><span class="op" id="5200060">+</span><span class="num" id="5200061">1</span>&nbsp;<span class="op" id="5200063">==</span>&nbsp;<span class="builtinfunc" id="5200066">len</span><span class="op" id="5200069">(</span><span class="ident" id="5200070">s</span><span class="op" id="5200071">)</span>&nbsp;<span class="op" id="5200073">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200079">return</span>&nbsp;<span class="ident" id="5200086">c</span><span class="op" id="5200087">,</span>&nbsp;<span class="builtinfunc" id="5200089">len</span><span class="op" id="5200092">(</span><span class="ident" id="5200093">s</span><span class="op" id="5200094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200104">end</span><span class="op" id="5200107">,</span>&nbsp;<span class="ident" id="5200109">i</span>&nbsp;<span class="op" id="5200111">=</span>&nbsp;<span class="builtintype" id="5200113">true</span><span class="op" id="5200117">,</span>&nbsp;<span class="ident" id="5200119">i</span><span class="op" id="5200120">+</span><span class="num" id="5200121">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200129">j</span><span class="op" id="5200130">,</span>&nbsp;<span class="ident" id="5200132">e</span>&nbsp;<span class="op" id="5200134">:=</span>&nbsp;<span class="ident" id="5200137">eatTagName</span><span class="op" id="5200147">(</span><span class="ident" id="5200148">s</span><span class="op" id="5200149">,</span>&nbsp;<span class="ident" id="5200151">i</span><span class="op" id="5200152">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200156">if</span>&nbsp;<span class="ident" id="5200159">j</span>&nbsp;<span class="op" id="5200161">!=</span>&nbsp;<span class="ident" id="5200164">i</span>&nbsp;<span class="op" id="5200166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200171">if</span>&nbsp;<span class="ident" id="5200174">end</span>&nbsp;<span class="op" id="5200178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200184">e</span>&nbsp;<span class="op" id="5200186">=</span>&nbsp;<span class="ident" id="5200188">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200208">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200239">return</span>&nbsp;<span class="ident" id="5200246">context</span><span class="op" id="5200253">{</span><span class="ident" id="5200254">state</span><span class="op" id="5200259">:</span>&nbsp;<span class="ident" id="5200261">stateTag</span><span class="op" id="5200269">,</span>&nbsp;<span class="ident" id="5200271">element</span><span class="op" id="5200278">:</span>&nbsp;<span class="ident" id="5200280">e</span><span class="op" id="5200281">}</span><span class="op" id="5200282">,</span>&nbsp;<span class="ident" id="5200284">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200292">k</span>&nbsp;<span class="op" id="5200294">=</span>&nbsp;<span class="ident" id="5200296">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200299">}</span><br>
<span class="lineno"></span><span class="op" id="5200301">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5200304">var</span>&nbsp;<span class="ident" id="5200308">elementContentType</span>&nbsp;<span class="op" id="5200327">=</span>&nbsp;<span class="op" id="5200329">[</span><span class="op" id="5200330">...</span><span class="op" id="5200333">]</span><span class="ident" id="5200334">state</span><span class="op" id="5200339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200342">elementNone</span><span class="op" id="5200353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200359">stateText</span><span class="op" id="5200368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200371">elementScript</span><span class="op" id="5200384">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5200388">stateJS</span><span class="op" id="5200395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200398">elementStyle</span><span class="op" id="5200410">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200415">stateCSS</span><span class="op" id="5200423">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200426">elementTextarea</span><span class="op" id="5200441">:</span>&nbsp;<span class="ident" id="5200443">stateRCDATA</span><span class="op" id="5200454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200457">elementTitle</span><span class="op" id="5200469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5200474">stateRCDATA</span><span class="op" id="5200485">,</span><br>
<span class="lineno"></span><span class="op" id="5200487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5200490">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5200552">func</span>&nbsp;<span class="ident" id="5200557">tTag</span><span class="op" id="5200561">(</span><span class="ident" id="5200562">c</span>&nbsp;<span class="ident" id="5200564">context</span><span class="op" id="5200571">,</span>&nbsp;<span class="ident" id="5200573">s</span>&nbsp;<span class="op" id="5200575">[</span><span class="op" id="5200576">]</span><span class="builtintype" id="5200577">byte</span><span class="op" id="5200581">)</span>&nbsp;<span class="op" id="5200583">(</span><span class="ident" id="5200584">context</span><span class="op" id="5200591">,</span>&nbsp;<span class="builtintype" id="5200593">int</span><span class="op" id="5200596">)</span>&nbsp;<span class="op" id="5200598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5200601">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200630">i</span>&nbsp;<span class="op" id="5200632">:=</span>&nbsp;<span class="ident" id="5200635">eatWhiteSpace</span><span class="op" id="5200648">(</span><span class="ident" id="5200649">s</span><span class="op" id="5200650">,</span>&nbsp;<span class="num" id="5200652">0</span><span class="op" id="5200653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200656">if</span>&nbsp;<span class="ident" id="5200659">i</span>&nbsp;<span class="op" id="5200661">==</span>&nbsp;<span class="builtinfunc" id="5200664">len</span><span class="op" id="5200667">(</span><span class="ident" id="5200668">s</span><span class="op" id="5200669">)</span>&nbsp;<span class="op" id="5200671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200675">return</span>&nbsp;<span class="ident" id="5200682">c</span><span class="op" id="5200683">,</span>&nbsp;<span class="builtinfunc" id="5200685">len</span><span class="op" id="5200688">(</span><span class="ident" id="5200689">s</span><span class="op" id="5200690">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200696">if</span>&nbsp;<span class="ident" id="5200699">s</span><span class="op" id="5200700">[</span><span class="ident" id="5200701">i</span><span class="op" id="5200702">]</span>&nbsp;<span class="op" id="5200704">==</span>&nbsp;<span class="string" id="5200707">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5200711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200715">return</span>&nbsp;<span class="ident" id="5200722">context</span><span class="op" id="5200729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200734">state</span><span class="op" id="5200739">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5200743">elementContentType</span><span class="op" id="5200761">[</span><span class="ident" id="5200762">c</span><span class="op" id="5200763">.</span><span class="ident" id="5200764">element</span><span class="op" id="5200771">]</span><span class="op" id="5200772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200777">element</span><span class="op" id="5200784">:</span>&nbsp;<span class="ident" id="5200786">c</span><span class="op" id="5200787">.</span><span class="ident" id="5200788">element</span><span class="op" id="5200795">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200799">}</span><span class="op" id="5200800">,</span>&nbsp;<span class="ident" id="5200802">i</span>&nbsp;<span class="op" id="5200804">+</span>&nbsp;<span class="num" id="5200806">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200812">j</span><span class="op" id="5200813">,</span>&nbsp;<span class="ident" id="5200815">err</span>&nbsp;<span class="op" id="5200819">:=</span>&nbsp;<span class="ident" id="5200822">eatAttrName</span><span class="op" id="5200833">(</span><span class="ident" id="5200834">s</span><span class="op" id="5200835">,</span>&nbsp;<span class="ident" id="5200837">i</span><span class="op" id="5200838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200841">if</span>&nbsp;<span class="ident" id="5200844">err</span>&nbsp;<span class="op" id="5200848">!=</span>&nbsp;<span class="ident" id="5200851">nil</span>&nbsp;<span class="op" id="5200855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200859">return</span>&nbsp;<span class="ident" id="5200866">context</span><span class="op" id="5200873">{</span><span class="ident" id="5200874">state</span><span class="op" id="5200879">:</span>&nbsp;<span class="ident" id="5200881">stateError</span><span class="op" id="5200891">,</span>&nbsp;<span class="ident" id="5200893">err</span><span class="op" id="5200896">:</span>&nbsp;<span class="ident" id="5200898">err</span><span class="op" id="5200901">}</span><span class="op" id="5200902">,</span>&nbsp;<span class="builtinfunc" id="5200904">len</span><span class="op" id="5200907">(</span><span class="ident" id="5200908">s</span><span class="op" id="5200909">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5200912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200915">state</span><span class="op" id="5200920">,</span>&nbsp;<span class="ident" id="5200922">attr</span>&nbsp;<span class="op" id="5200927">:=</span>&nbsp;<span class="ident" id="5200930">stateTag</span><span class="op" id="5200938">,</span>&nbsp;<span class="ident" id="5200940">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200950">if</span>&nbsp;<span class="ident" id="5200953">i</span>&nbsp;<span class="op" id="5200955">==</span>&nbsp;<span class="ident" id="5200958">j</span>&nbsp;<span class="op" id="5200960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5200964">return</span>&nbsp;<span class="ident" id="5200971">context</span><span class="op" id="5200978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5200983">state</span><span class="op" id="5200988">:</span>&nbsp;<span class="ident" id="5200990">stateError</span><span class="op" id="5201000">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201005">err</span><span class="op" id="5201008">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5201012">errorf</span><span class="op" id="5201018">(</span><span class="ident" id="5201019">ErrBadHTML</span><span class="op" id="5201029">,</span>&nbsp;<span class="ident" id="5201031">nil</span><span class="op" id="5201034">,</span>&nbsp;<span class="num" id="5201036">0</span><span class="op" id="5201037">,</span>&nbsp;<span class="string" id="5201039">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5201093">,</span>&nbsp;<span class="ident" id="5201095">s</span><span class="op" id="5201096">[</span><span class="ident" id="5201097">i</span><span class="op" id="5201098">:</span><span class="op" id="5201099">]</span><span class="op" id="5201100">)</span><span class="op" id="5201101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201105">}</span><span class="op" id="5201106">,</span>&nbsp;<span class="builtinfunc" id="5201108">len</span><span class="op" id="5201111">(</span><span class="ident" id="5201112">s</span><span class="op" id="5201113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201119">switch</span>&nbsp;<span class="ident" id="5201126">attrType</span><span class="op" id="5201134">(</span><span class="builtintype" id="5201135">string</span><span class="op" id="5201141">(</span><span class="ident" id="5201142">s</span><span class="op" id="5201143">[</span><span class="ident" id="5201144">i</span><span class="op" id="5201145">:</span><span class="ident" id="5201146">j</span><span class="op" id="5201147">]</span><span class="op" id="5201148">)</span><span class="op" id="5201149">)</span>&nbsp;<span class="op" id="5201151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201154">case</span>&nbsp;<span class="ident" id="5201159">contentTypeURL</span><span class="op" id="5201173">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201177">attr</span>&nbsp;<span class="op" id="5201182">=</span>&nbsp;<span class="ident" id="5201184">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201193">case</span>&nbsp;<span class="ident" id="5201198">contentTypeCSS</span><span class="op" id="5201212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201216">attr</span>&nbsp;<span class="op" id="5201221">=</span>&nbsp;<span class="ident" id="5201223">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201234">case</span>&nbsp;<span class="ident" id="5201239">contentTypeJS</span><span class="op" id="5201252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201256">attr</span>&nbsp;<span class="op" id="5201261">=</span>&nbsp;<span class="ident" id="5201263">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201278">if</span>&nbsp;<span class="ident" id="5201281">j</span>&nbsp;<span class="op" id="5201283">==</span>&nbsp;<span class="builtinfunc" id="5201286">len</span><span class="op" id="5201289">(</span><span class="ident" id="5201290">s</span><span class="op" id="5201291">)</span>&nbsp;<span class="op" id="5201293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201297">state</span>&nbsp;<span class="op" id="5201303">=</span>&nbsp;<span class="ident" id="5201305">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201320">}</span>&nbsp;<span class="keyword" id="5201322">else</span>&nbsp;<span class="op" id="5201327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201331">state</span>&nbsp;<span class="op" id="5201337">=</span>&nbsp;<span class="ident" id="5201339">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201358">return</span>&nbsp;<span class="ident" id="5201365">context</span><span class="op" id="5201372">{</span><span class="ident" id="5201373">state</span><span class="op" id="5201378">:</span>&nbsp;<span class="ident" id="5201380">state</span><span class="op" id="5201385">,</span>&nbsp;<span class="ident" id="5201387">element</span><span class="op" id="5201394">:</span>&nbsp;<span class="ident" id="5201396">c</span><span class="op" id="5201397">.</span><span class="ident" id="5201398">element</span><span class="op" id="5201405">,</span>&nbsp;<span class="ident" id="5201407">attr</span><span class="op" id="5201411">:</span>&nbsp;<span class="ident" id="5201413">attr</span><span class="op" id="5201417">}</span><span class="op" id="5201418">,</span>&nbsp;<span class="ident" id="5201420">j</span><br>
<span class="lineno"></span><span class="op" id="5201422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5201425">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5201492">func</span>&nbsp;<span class="ident" id="5201497">tAttrName</span><span class="op" id="5201506">(</span><span class="ident" id="5201507">c</span>&nbsp;<span class="ident" id="5201509">context</span><span class="op" id="5201516">,</span>&nbsp;<span class="ident" id="5201518">s</span>&nbsp;<span class="op" id="5201520">[</span><span class="op" id="5201521">]</span><span class="builtintype" id="5201522">byte</span><span class="op" id="5201526">)</span>&nbsp;<span class="op" id="5201528">(</span><span class="ident" id="5201529">context</span><span class="op" id="5201536">,</span>&nbsp;<span class="builtintype" id="5201538">int</span><span class="op" id="5201541">)</span>&nbsp;<span class="op" id="5201543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201546">i</span><span class="op" id="5201547">,</span>&nbsp;<span class="ident" id="5201549">err</span>&nbsp;<span class="op" id="5201553">:=</span>&nbsp;<span class="ident" id="5201556">eatAttrName</span><span class="op" id="5201567">(</span><span class="ident" id="5201568">s</span><span class="op" id="5201569">,</span>&nbsp;<span class="num" id="5201571">0</span><span class="op" id="5201572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201575">if</span>&nbsp;<span class="ident" id="5201578">err</span>&nbsp;<span class="op" id="5201582">!=</span>&nbsp;<span class="ident" id="5201585">nil</span>&nbsp;<span class="op" id="5201589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201593">return</span>&nbsp;<span class="ident" id="5201600">context</span><span class="op" id="5201607">{</span><span class="ident" id="5201608">state</span><span class="op" id="5201613">:</span>&nbsp;<span class="ident" id="5201615">stateError</span><span class="op" id="5201625">,</span>&nbsp;<span class="ident" id="5201627">err</span><span class="op" id="5201630">:</span>&nbsp;<span class="ident" id="5201632">err</span><span class="op" id="5201635">}</span><span class="op" id="5201636">,</span>&nbsp;<span class="builtinfunc" id="5201638">len</span><span class="op" id="5201641">(</span><span class="ident" id="5201642">s</span><span class="op" id="5201643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201646">}</span>&nbsp;<span class="keyword" id="5201648">else</span>&nbsp;<span class="keyword" id="5201653">if</span>&nbsp;<span class="ident" id="5201656">i</span>&nbsp;<span class="op" id="5201658">!=</span>&nbsp;<span class="builtinfunc" id="5201661">len</span><span class="op" id="5201664">(</span><span class="ident" id="5201665">s</span><span class="op" id="5201666">)</span>&nbsp;<span class="op" id="5201668">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201672">c</span><span class="op" id="5201673">.</span><span class="ident" id="5201674">state</span>&nbsp;<span class="op" id="5201680">=</span>&nbsp;<span class="ident" id="5201682">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201701">return</span>&nbsp;<span class="ident" id="5201708">c</span><span class="op" id="5201709">,</span>&nbsp;<span class="ident" id="5201711">i</span><br>
<span class="lineno"></span><span class="op" id="5201713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5201716">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5201785">func</span>&nbsp;<span class="ident" id="5201790">tAfterName</span><span class="op" id="5201800">(</span><span class="ident" id="5201801">c</span>&nbsp;<span class="ident" id="5201803">context</span><span class="op" id="5201810">,</span>&nbsp;<span class="ident" id="5201812">s</span>&nbsp;<span class="op" id="5201814">[</span><span class="op" id="5201815">]</span><span class="builtintype" id="5201816">byte</span><span class="op" id="5201820">)</span>&nbsp;<span class="op" id="5201822">(</span><span class="ident" id="5201823">context</span><span class="op" id="5201830">,</span>&nbsp;<span class="builtintype" id="5201832">int</span><span class="op" id="5201835">)</span>&nbsp;<span class="op" id="5201837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201840">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5201877">i</span>&nbsp;<span class="op" id="5201879">:=</span>&nbsp;<span class="ident" id="5201882">eatWhiteSpace</span><span class="op" id="5201895">(</span><span class="ident" id="5201896">s</span><span class="op" id="5201897">,</span>&nbsp;<span class="num" id="5201899">0</span><span class="op" id="5201900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201903">if</span>&nbsp;<span class="ident" id="5201906">i</span>&nbsp;<span class="op" id="5201908">==</span>&nbsp;<span class="builtinfunc" id="5201911">len</span><span class="op" id="5201914">(</span><span class="ident" id="5201915">s</span><span class="op" id="5201916">)</span>&nbsp;<span class="op" id="5201918">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5201922">return</span>&nbsp;<span class="ident" id="5201929">c</span><span class="op" id="5201930">,</span>&nbsp;<span class="builtinfunc" id="5201932">len</span><span class="op" id="5201935">(</span><span class="ident" id="5201936">s</span><span class="op" id="5201937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5201940">}</span>&nbsp;<span class="keyword" id="5201942">else</span>&nbsp;<span class="keyword" id="5201947">if</span>&nbsp;<span class="ident" id="5201950">s</span><span class="op" id="5201951">[</span><span class="ident" id="5201952">i</span><span class="op" id="5201953">]</span>&nbsp;<span class="op" id="5201955">!=</span>&nbsp;<span class="string" id="5201958">&#39;=&#39;</span>&nbsp;<span class="op" id="5201962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5201966">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202026">c</span><span class="op" id="5202027">.</span><span class="ident" id="5202028">state</span>&nbsp;<span class="op" id="5202034">=</span>&nbsp;<span class="ident" id="5202036">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202047">return</span>&nbsp;<span class="ident" id="5202054">c</span><span class="op" id="5202055">,</span>&nbsp;<span class="ident" id="5202057">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202063">c</span><span class="op" id="5202064">.</span><span class="ident" id="5202065">state</span>&nbsp;<span class="op" id="5202071">=</span>&nbsp;<span class="ident" id="5202073">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202091">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202112">return</span>&nbsp;<span class="ident" id="5202119">c</span><span class="op" id="5202120">,</span>&nbsp;<span class="ident" id="5202122">i</span>&nbsp;<span class="op" id="5202124">+</span>&nbsp;<span class="num" id="5202126">1</span><br>
<span class="lineno"></span><span class="op" id="5202128">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5202131">var</span>&nbsp;<span class="ident" id="5202135">attrStartStates</span>&nbsp;<span class="op" id="5202151">=</span>&nbsp;<span class="op" id="5202153">[</span><span class="op" id="5202154">...</span><span class="op" id="5202157">]</span><span class="ident" id="5202158">state</span><span class="op" id="5202163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202166">attrNone</span><span class="op" id="5202174">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5202178">stateAttr</span><span class="op" id="5202187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202190">attrScript</span><span class="op" id="5202200">:</span>&nbsp;<span class="ident" id="5202202">stateJS</span><span class="op" id="5202209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202212">attrStyle</span><span class="op" id="5202221">:</span>&nbsp;&nbsp;<span class="ident" id="5202224">stateCSS</span><span class="op" id="5202232">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202235">attrURL</span><span class="op" id="5202242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202247">stateURL</span><span class="op" id="5202255">,</span><br>
<span class="lineno"></span><span class="op" id="5202257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5202260">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5202333">func</span>&nbsp;<span class="ident" id="5202338">tBeforeValue</span><span class="op" id="5202350">(</span><span class="ident" id="5202351">c</span>&nbsp;<span class="ident" id="5202353">context</span><span class="op" id="5202360">,</span>&nbsp;<span class="ident" id="5202362">s</span>&nbsp;<span class="op" id="5202364">[</span><span class="op" id="5202365">]</span><span class="builtintype" id="5202366">byte</span><span class="op" id="5202370">)</span>&nbsp;<span class="op" id="5202372">(</span><span class="ident" id="5202373">context</span><span class="op" id="5202380">,</span>&nbsp;<span class="builtintype" id="5202382">int</span><span class="op" id="5202385">)</span>&nbsp;<span class="op" id="5202387">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202390">i</span>&nbsp;<span class="op" id="5202392">:=</span>&nbsp;<span class="ident" id="5202395">eatWhiteSpace</span><span class="op" id="5202408">(</span><span class="ident" id="5202409">s</span><span class="op" id="5202410">,</span>&nbsp;<span class="num" id="5202412">0</span><span class="op" id="5202413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202416">if</span>&nbsp;<span class="ident" id="5202419">i</span>&nbsp;<span class="op" id="5202421">==</span>&nbsp;<span class="builtinfunc" id="5202424">len</span><span class="op" id="5202427">(</span><span class="ident" id="5202428">s</span><span class="op" id="5202429">)</span>&nbsp;<span class="op" id="5202431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202435">return</span>&nbsp;<span class="ident" id="5202442">c</span><span class="op" id="5202443">,</span>&nbsp;<span class="builtinfunc" id="5202445">len</span><span class="op" id="5202448">(</span><span class="ident" id="5202449">s</span><span class="op" id="5202450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5202456">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202490">delim</span>&nbsp;<span class="op" id="5202496">:=</span>&nbsp;<span class="ident" id="5202499">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202519">switch</span>&nbsp;<span class="ident" id="5202526">s</span><span class="op" id="5202527">[</span><span class="ident" id="5202528">i</span><span class="op" id="5202529">]</span>&nbsp;<span class="op" id="5202531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202534">case</span>&nbsp;<span class="string" id="5202539">&#39;\&#39;&#39;</span><span class="op" id="5202543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202547">delim</span><span class="op" id="5202552">,</span>&nbsp;<span class="ident" id="5202554">i</span>&nbsp;<span class="op" id="5202556">=</span>&nbsp;<span class="ident" id="5202558">delimSingleQuote</span><span class="op" id="5202574">,</span>&nbsp;<span class="ident" id="5202576">i</span><span class="op" id="5202577">+</span><span class="num" id="5202578">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202581">case</span>&nbsp;<span class="string" id="5202586">&#39;&#34;&#39;</span><span class="op" id="5202589">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202593">delim</span><span class="op" id="5202598">,</span>&nbsp;<span class="ident" id="5202600">i</span>&nbsp;<span class="op" id="5202602">=</span>&nbsp;<span class="ident" id="5202604">delimDoubleQuote</span><span class="op" id="5202620">,</span>&nbsp;<span class="ident" id="5202622">i</span><span class="op" id="5202623">+</span><span class="num" id="5202624">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5202630">c</span><span class="op" id="5202631">.</span><span class="ident" id="5202632">state</span><span class="op" id="5202637">,</span>&nbsp;<span class="ident" id="5202639">c</span><span class="op" id="5202640">.</span><span class="ident" id="5202641">delim</span><span class="op" id="5202646">,</span>&nbsp;<span class="ident" id="5202648">c</span><span class="op" id="5202649">.</span><span class="ident" id="5202650">attr</span>&nbsp;<span class="op" id="5202655">=</span>&nbsp;<span class="ident" id="5202657">attrStartStates</span><span class="op" id="5202672">[</span><span class="ident" id="5202673">c</span><span class="op" id="5202674">.</span><span class="ident" id="5202675">attr</span><span class="op" id="5202679">]</span><span class="op" id="5202680">,</span>&nbsp;<span class="ident" id="5202682">delim</span><span class="op" id="5202687">,</span>&nbsp;<span class="ident" id="5202689">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202699">return</span>&nbsp;<span class="ident" id="5202706">c</span><span class="op" id="5202707">,</span>&nbsp;<span class="ident" id="5202709">i</span><br>
<span class="lineno"></span><span class="op" id="5202711">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5202714">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5202779">func</span>&nbsp;<span class="ident" id="5202784">tHTMLCmt</span><span class="op" id="5202792">(</span><span class="ident" id="5202793">c</span>&nbsp;<span class="ident" id="5202795">context</span><span class="op" id="5202802">,</span>&nbsp;<span class="ident" id="5202804">s</span>&nbsp;<span class="op" id="5202806">[</span><span class="op" id="5202807">]</span><span class="builtintype" id="5202808">byte</span><span class="op" id="5202812">)</span>&nbsp;<span class="op" id="5202814">(</span><span class="ident" id="5202815">context</span><span class="op" id="5202822">,</span>&nbsp;<span class="builtintype" id="5202824">int</span><span class="op" id="5202827">)</span>&nbsp;<span class="op" id="5202829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202832">if</span>&nbsp;<span class="ident" id="5202835">i</span>&nbsp;<span class="op" id="5202837">:=</span>&nbsp;<span class="ident" id="5202840">bytes</span><span class="op" id="5202845">.</span><span class="ident" id="5202846">Index</span><span class="op" id="5202851">(</span><span class="ident" id="5202852">s</span><span class="op" id="5202853">,</span>&nbsp;<span class="ident" id="5202855">commentEnd</span><span class="op" id="5202865">)</span><span class="op" id="5202866">;</span>&nbsp;<span class="ident" id="5202868">i</span>&nbsp;<span class="op" id="5202870">!=</span>&nbsp;<span class="op" id="5202873">-</span><span class="num" id="5202874">1</span>&nbsp;<span class="op" id="5202876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202880">return</span>&nbsp;<span class="ident" id="5202887">context</span><span class="op" id="5202894">{</span><span class="op" id="5202895">}</span><span class="op" id="5202896">,</span>&nbsp;<span class="ident" id="5202898">i</span>&nbsp;<span class="op" id="5202900">+</span>&nbsp;<span class="num" id="5202902">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5202905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5202908">return</span>&nbsp;<span class="ident" id="5202915">c</span><span class="op" id="5202916">,</span>&nbsp;<span class="builtinfunc" id="5202918">len</span><span class="op" id="5202921">(</span><span class="ident" id="5202922">s</span><span class="op" id="5202923">)</span><br>
<span class="lineno"></span><span class="op" id="5202925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5202928">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5203002">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5203065">var</span>&nbsp;<span class="ident" id="5203069">specialTagEndMarkers</span>&nbsp;<span class="op" id="5203090">=</span>&nbsp;<span class="op" id="5203092">[</span><span class="op" id="5203093">...</span><span class="op" id="5203096">]</span><span class="builtintype" id="5203097">string</span><span class="op" id="5203103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203106">elementScript</span><span class="op" id="5203119">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5203123">&#34;&lt;/script&#34;</span><span class="op" id="5203133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203136">elementStyle</span><span class="op" id="5203148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5203153">&#34;&lt;/style&#34;</span><span class="op" id="5203162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203165">elementTextarea</span><span class="op" id="5203180">:</span>&nbsp;<span class="string" id="5203182">&#34;&lt;/textarea&#34;</span><span class="op" id="5203194">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203197">elementTitle</span><span class="op" id="5203209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5203214">&#34;&lt;/title&#34;</span><span class="op" id="5203223">,</span><br>
<span class="lineno"></span><span class="op" id="5203225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203228">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5203305">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5203324">func</span>&nbsp;<span class="ident" id="5203329">tSpecialTagEnd</span><span class="op" id="5203343">(</span><span class="ident" id="5203344">c</span>&nbsp;<span class="ident" id="5203346">context</span><span class="op" id="5203353">,</span>&nbsp;<span class="ident" id="5203355">s</span>&nbsp;<span class="op" id="5203357">[</span><span class="op" id="5203358">]</span><span class="builtintype" id="5203359">byte</span><span class="op" id="5203363">)</span>&nbsp;<span class="op" id="5203365">(</span><span class="ident" id="5203366">context</span><span class="op" id="5203373">,</span>&nbsp;<span class="builtintype" id="5203375">int</span><span class="op" id="5203378">)</span>&nbsp;<span class="op" id="5203380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203383">if</span>&nbsp;<span class="ident" id="5203386">c</span><span class="op" id="5203387">.</span><span class="ident" id="5203388">element</span>&nbsp;<span class="op" id="5203396">!=</span>&nbsp;<span class="ident" id="5203399">elementNone</span>&nbsp;<span class="op" id="5203411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203415">if</span>&nbsp;<span class="ident" id="5203418">i</span>&nbsp;<span class="op" id="5203420">:=</span>&nbsp;<span class="ident" id="5203423">strings</span><span class="op" id="5203430">.</span><span class="ident" id="5203431">Index</span><span class="op" id="5203436">(</span><span class="ident" id="5203437">strings</span><span class="op" id="5203444">.</span><span class="ident" id="5203445">ToLower</span><span class="op" id="5203452">(</span><span class="builtintype" id="5203453">string</span><span class="op" id="5203459">(</span><span class="ident" id="5203460">s</span><span class="op" id="5203461">)</span><span class="op" id="5203462">)</span><span class="op" id="5203463">,</span>&nbsp;<span class="ident" id="5203465">specialTagEndMarkers</span><span class="op" id="5203485">[</span><span class="ident" id="5203486">c</span><span class="op" id="5203487">.</span><span class="ident" id="5203488">element</span><span class="op" id="5203495">]</span><span class="op" id="5203496">)</span><span class="op" id="5203497">;</span>&nbsp;<span class="ident" id="5203499">i</span>&nbsp;<span class="op" id="5203501">!=</span>&nbsp;<span class="op" id="5203504">-</span><span class="num" id="5203505">1</span>&nbsp;<span class="op" id="5203507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203512">return</span>&nbsp;<span class="ident" id="5203519">context</span><span class="op" id="5203526">{</span><span class="op" id="5203527">}</span><span class="op" id="5203528">,</span>&nbsp;<span class="ident" id="5203530">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203534">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203540">return</span>&nbsp;<span class="ident" id="5203547">c</span><span class="op" id="5203548">,</span>&nbsp;<span class="builtinfunc" id="5203550">len</span><span class="op" id="5203553">(</span><span class="ident" id="5203554">s</span><span class="op" id="5203555">)</span><br>
<span class="lineno"></span><span class="op" id="5203557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203560">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5203629">func</span>&nbsp;<span class="ident" id="5203634">tAttr</span><span class="op" id="5203639">(</span><span class="ident" id="5203640">c</span>&nbsp;<span class="ident" id="5203642">context</span><span class="op" id="5203649">,</span>&nbsp;<span class="ident" id="5203651">s</span>&nbsp;<span class="op" id="5203653">[</span><span class="op" id="5203654">]</span><span class="builtintype" id="5203655">byte</span><span class="op" id="5203659">)</span>&nbsp;<span class="op" id="5203661">(</span><span class="ident" id="5203662">context</span><span class="op" id="5203669">,</span>&nbsp;<span class="builtintype" id="5203671">int</span><span class="op" id="5203674">)</span>&nbsp;<span class="op" id="5203676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203679">return</span>&nbsp;<span class="ident" id="5203686">c</span><span class="op" id="5203687">,</span>&nbsp;<span class="builtinfunc" id="5203689">len</span><span class="op" id="5203692">(</span><span class="ident" id="5203693">s</span><span class="op" id="5203694">)</span><br>
<span class="lineno"></span><span class="op" id="5203696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203699">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5203761">func</span>&nbsp;<span class="ident" id="5203766">tURL</span><span class="op" id="5203770">(</span><span class="ident" id="5203771">c</span>&nbsp;<span class="ident" id="5203773">context</span><span class="op" id="5203780">,</span>&nbsp;<span class="ident" id="5203782">s</span>&nbsp;<span class="op" id="5203784">[</span><span class="op" id="5203785">]</span><span class="builtintype" id="5203786">byte</span><span class="op" id="5203790">)</span>&nbsp;<span class="op" id="5203792">(</span><span class="ident" id="5203793">context</span><span class="op" id="5203800">,</span>&nbsp;<span class="builtintype" id="5203802">int</span><span class="op" id="5203805">)</span>&nbsp;<span class="op" id="5203807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5203810">if</span>&nbsp;<span class="ident" id="5203813">bytes</span><span class="op" id="5203818">.</span><span class="ident" id="5203819">IndexAny</span><span class="op" id="5203827">(</span><span class="ident" id="5203828">s</span><span class="op" id="5203829">,</span>&nbsp;<span class="string" id="5203831">&#34;#?&#34;</span><span class="op" id="5203835">)</span>&nbsp;<span class="op" id="5203837">&gt;=</span>&nbsp;<span class="num" id="5203840">0</span>&nbsp;<span class="op" id="5203842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5203846">c</span><span class="op" id="5203847">.</span><span class="ident" id="5203848">urlPart</span>&nbsp;<span class="op" id="5203856">=</span>&nbsp;<span class="ident" id="5203858">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5203878">}</span>&nbsp;<span class="keyword" id="5203880">else</span>&nbsp;<span class="keyword" id="5203885">if</span>&nbsp;<span class="builtinfunc" id="5203888">len</span><span class="op" id="5203891">(</span><span class="ident" id="5203892">s</span><span class="op" id="5203893">)</span>&nbsp;<span class="op" id="5203895">!=</span>&nbsp;<span class="ident" id="5203898">eatWhiteSpace</span><span class="op" id="5203911">(</span><span class="ident" id="5203912">s</span><span class="op" id="5203913">,</span>&nbsp;<span class="num" id="5203915">0</span><span class="op" id="5203916">)</span>&nbsp;<span class="op" id="5203918">&amp;&amp;</span>&nbsp;<span class="ident" id="5203921">c</span><span class="op" id="5203922">.</span><span class="ident" id="5203923">urlPart</span>&nbsp;<span class="op" id="5203931">==</span>&nbsp;<span class="ident" id="5203934">urlPartNone</span>&nbsp;<span class="op" id="5203946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5203950">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204015">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204078">c</span><span class="op" id="5204079">.</span><span class="ident" id="5204080">urlPart</span>&nbsp;<span class="op" id="5204088">=</span>&nbsp;<span class="ident" id="5204090">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204110">return</span>&nbsp;<span class="ident" id="5204117">c</span><span class="op" id="5204118">,</span>&nbsp;<span class="builtinfunc" id="5204120">len</span><span class="op" id="5204123">(</span><span class="ident" id="5204124">s</span><span class="op" id="5204125">)</span><br>
<span class="lineno"></span><span class="op" id="5204127">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5204130">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5204190">func</span>&nbsp;<span class="ident" id="5204195">tJS</span><span class="op" id="5204198">(</span><span class="ident" id="5204199">c</span>&nbsp;<span class="ident" id="5204201">context</span><span class="op" id="5204208">,</span>&nbsp;<span class="ident" id="5204210">s</span>&nbsp;<span class="op" id="5204212">[</span><span class="op" id="5204213">]</span><span class="builtintype" id="5204214">byte</span><span class="op" id="5204218">)</span>&nbsp;<span class="op" id="5204220">(</span><span class="ident" id="5204221">context</span><span class="op" id="5204228">,</span>&nbsp;<span class="builtintype" id="5204230">int</span><span class="op" id="5204233">)</span>&nbsp;<span class="op" id="5204235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204238">i</span>&nbsp;<span class="op" id="5204240">:=</span>&nbsp;<span class="ident" id="5204243">bytes</span><span class="op" id="5204248">.</span><span class="ident" id="5204249">IndexAny</span><span class="op" id="5204257">(</span><span class="ident" id="5204258">s</span><span class="op" id="5204259">,</span>&nbsp;<span class="string" id="5204261">`&#34;&#39;/`</span><span class="op" id="5204266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204269">if</span>&nbsp;<span class="ident" id="5204272">i</span>&nbsp;<span class="op" id="5204274">==</span>&nbsp;<span class="op" id="5204277">-</span><span class="num" id="5204278">1</span>&nbsp;<span class="op" id="5204280">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5204284">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204341">c</span><span class="op" id="5204342">.</span><span class="ident" id="5204343">jsCtx</span>&nbsp;<span class="op" id="5204349">=</span>&nbsp;<span class="ident" id="5204351">nextJSCtx</span><span class="op" id="5204360">(</span><span class="ident" id="5204361">s</span><span class="op" id="5204362">,</span>&nbsp;<span class="ident" id="5204364">c</span><span class="op" id="5204365">.</span><span class="ident" id="5204366">jsCtx</span><span class="op" id="5204371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204375">return</span>&nbsp;<span class="ident" id="5204382">c</span><span class="op" id="5204383">,</span>&nbsp;<span class="builtinfunc" id="5204385">len</span><span class="op" id="5204388">(</span><span class="ident" id="5204389">s</span><span class="op" id="5204390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5204393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204396">c</span><span class="op" id="5204397">.</span><span class="ident" id="5204398">jsCtx</span>&nbsp;<span class="op" id="5204404">=</span>&nbsp;<span class="ident" id="5204406">nextJSCtx</span><span class="op" id="5204415">(</span><span class="ident" id="5204416">s</span><span class="op" id="5204417">[</span><span class="op" id="5204418">:</span><span class="ident" id="5204419">i</span><span class="op" id="5204420">]</span><span class="op" id="5204421">,</span>&nbsp;<span class="ident" id="5204423">c</span><span class="op" id="5204424">.</span><span class="ident" id="5204425">jsCtx</span><span class="op" id="5204430">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204433">switch</span>&nbsp;<span class="ident" id="5204440">s</span><span class="op" id="5204441">[</span><span class="ident" id="5204442">i</span><span class="op" id="5204443">]</span>&nbsp;<span class="op" id="5204445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204448">case</span>&nbsp;<span class="string" id="5204453">&#39;&#34;&#39;</span><span class="op" id="5204456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204460">c</span><span class="op" id="5204461">.</span><span class="ident" id="5204462">state</span><span class="op" id="5204467">,</span>&nbsp;<span class="ident" id="5204469">c</span><span class="op" id="5204470">.</span><span class="ident" id="5204471">jsCtx</span>&nbsp;<span class="op" id="5204477">=</span>&nbsp;<span class="ident" id="5204479">stateJSDqStr</span><span class="op" id="5204491">,</span>&nbsp;<span class="ident" id="5204493">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204506">case</span>&nbsp;<span class="string" id="5204511">&#39;\&#39;&#39;</span><span class="op" id="5204515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204519">c</span><span class="op" id="5204520">.</span><span class="ident" id="5204521">state</span><span class="op" id="5204526">,</span>&nbsp;<span class="ident" id="5204528">c</span><span class="op" id="5204529">.</span><span class="ident" id="5204530">jsCtx</span>&nbsp;<span class="op" id="5204536">=</span>&nbsp;<span class="ident" id="5204538">stateJSSqStr</span><span class="op" id="5204550">,</span>&nbsp;<span class="ident" id="5204552">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204565">case</span>&nbsp;<span class="string" id="5204570">&#39;/&#39;</span><span class="op" id="5204573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204577">switch</span>&nbsp;<span class="op" id="5204584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204588">case</span>&nbsp;<span class="ident" id="5204593">i</span><span class="op" id="5204594">+</span><span class="num" id="5204595">1</span>&nbsp;<span class="op" id="5204597">&lt;</span>&nbsp;<span class="builtinfunc" id="5204599">len</span><span class="op" id="5204602">(</span><span class="ident" id="5204603">s</span><span class="op" id="5204604">)</span>&nbsp;<span class="op" id="5204606">&amp;&amp;</span>&nbsp;<span class="ident" id="5204609">s</span><span class="op" id="5204610">[</span><span class="ident" id="5204611">i</span><span class="op" id="5204612">+</span><span class="num" id="5204613">1</span><span class="op" id="5204614">]</span>&nbsp;<span class="op" id="5204616">==</span>&nbsp;<span class="string" id="5204619">&#39;/&#39;</span><span class="op" id="5204622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204627">c</span><span class="op" id="5204628">.</span><span class="ident" id="5204629">state</span><span class="op" id="5204634">,</span>&nbsp;<span class="ident" id="5204636">i</span>&nbsp;<span class="op" id="5204638">=</span>&nbsp;<span class="ident" id="5204640">stateJSLineCmt</span><span class="op" id="5204654">,</span>&nbsp;<span class="ident" id="5204656">i</span><span class="op" id="5204657">+</span><span class="num" id="5204658">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204662">case</span>&nbsp;<span class="ident" id="5204667">i</span><span class="op" id="5204668">+</span><span class="num" id="5204669">1</span>&nbsp;<span class="op" id="5204671">&lt;</span>&nbsp;<span class="builtinfunc" id="5204673">len</span><span class="op" id="5204676">(</span><span class="ident" id="5204677">s</span><span class="op" id="5204678">)</span>&nbsp;<span class="op" id="5204680">&amp;&amp;</span>&nbsp;<span class="ident" id="5204683">s</span><span class="op" id="5204684">[</span><span class="ident" id="5204685">i</span><span class="op" id="5204686">+</span><span class="num" id="5204687">1</span><span class="op" id="5204688">]</span>&nbsp;<span class="op" id="5204690">==</span>&nbsp;<span class="string" id="5204693">&#39;*&#39;</span><span class="op" id="5204696">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204701">c</span><span class="op" id="5204702">.</span><span class="ident" id="5204703">state</span><span class="op" id="5204708">,</span>&nbsp;<span class="ident" id="5204710">i</span>&nbsp;<span class="op" id="5204712">=</span>&nbsp;<span class="ident" id="5204714">stateJSBlockCmt</span><span class="op" id="5204729">,</span>&nbsp;<span class="ident" id="5204731">i</span><span class="op" id="5204732">+</span><span class="num" id="5204733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204737">case</span>&nbsp;<span class="ident" id="5204742">c</span><span class="op" id="5204743">.</span><span class="ident" id="5204744">jsCtx</span>&nbsp;<span class="op" id="5204750">==</span>&nbsp;<span class="ident" id="5204753">jsCtxRegexp</span><span class="op" id="5204764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204769">c</span><span class="op" id="5204770">.</span><span class="ident" id="5204771">state</span>&nbsp;<span class="op" id="5204777">=</span>&nbsp;<span class="ident" id="5204779">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204795">case</span>&nbsp;<span class="ident" id="5204800">c</span><span class="op" id="5204801">.</span><span class="ident" id="5204802">jsCtx</span>&nbsp;<span class="op" id="5204808">==</span>&nbsp;<span class="ident" id="5204811">jsCtxDivOp</span><span class="op" id="5204821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204826">c</span><span class="op" id="5204827">.</span><span class="ident" id="5204828">jsCtx</span>&nbsp;<span class="op" id="5204834">=</span>&nbsp;<span class="ident" id="5204836">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204850">default</span><span class="op" id="5204857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5204862">return</span>&nbsp;<span class="ident" id="5204869">context</span><span class="op" id="5204876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204882">state</span><span class="op" id="5204887">:</span>&nbsp;<span class="ident" id="5204889">stateError</span><span class="op" id="5204899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5204905">err</span><span class="op" id="5204908">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5204912">errorf</span><span class="op" id="5204918">(</span><span class="ident" id="5204919">ErrSlashAmbig</span><span class="op" id="5204932">,</span>&nbsp;<span class="ident" id="5204934">nil</span><span class="op" id="5204937">,</span>&nbsp;<span class="num" id="5204939">0</span><span class="op" id="5204940">,</span>&nbsp;<span class="string" id="5204942">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5204987">,</span>&nbsp;<span class="ident" id="5204989">s</span><span class="op" id="5204990">[</span><span class="ident" id="5204991">i</span><span class="op" id="5204992">:</span><span class="op" id="5204993">]</span><span class="op" id="5204994">)</span><span class="op" id="5204995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205000">}</span><span class="op" id="5205001">,</span>&nbsp;<span class="builtinfunc" id="5205003">len</span><span class="op" id="5205006">(</span><span class="ident" id="5205007">s</span><span class="op" id="5205008">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205015">default</span><span class="op" id="5205022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5205026">panic</span><span class="op" id="5205031">(</span><span class="string" id="5205032">&#34;unreachable&#34;</span><span class="op" id="5205045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205051">return</span>&nbsp;<span class="ident" id="5205058">c</span><span class="op" id="5205059">,</span>&nbsp;<span class="ident" id="5205061">i</span>&nbsp;<span class="op" id="5205063">+</span>&nbsp;<span class="num" id="5205065">1</span><br>
<span class="lineno">255</span><span class="op" id="5205067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205070">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5205150">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5205161">func</span>&nbsp;<span class="ident" id="5205166">tJSDelimited</span><span class="op" id="5205178">(</span><span class="ident" id="5205179">c</span>&nbsp;<span class="ident" id="5205181">context</span><span class="op" id="5205188">,</span>&nbsp;<span class="ident" id="5205190">s</span>&nbsp;<span class="op" id="5205192">[</span><span class="op" id="5205193">]</span><span class="builtintype" id="5205194">byte</span><span class="op" id="5205198">)</span>&nbsp;<span class="op" id="5205200">(</span><span class="ident" id="5205201">context</span><span class="op" id="5205208">,</span>&nbsp;<span class="builtintype" id="5205210">int</span><span class="op" id="5205213">)</span>&nbsp;<span class="op" id="5205215">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205218">specials</span>&nbsp;<span class="op" id="5205227">:=</span>&nbsp;<span class="string" id="5205230">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205236">switch</span>&nbsp;<span class="ident" id="5205243">c</span><span class="op" id="5205244">.</span><span class="ident" id="5205245">state</span>&nbsp;<span class="op" id="5205251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205254">case</span>&nbsp;<span class="ident" id="5205259">stateJSSqStr</span><span class="op" id="5205271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205275">specials</span>&nbsp;<span class="op" id="5205284">=</span>&nbsp;<span class="string" id="5205286">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205292">case</span>&nbsp;<span class="ident" id="5205297">stateJSRegexp</span><span class="op" id="5205310">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205314">specials</span>&nbsp;<span class="op" id="5205323">=</span>&nbsp;<span class="string" id="5205325">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205337">k</span><span class="op" id="5205338">,</span>&nbsp;<span class="ident" id="5205340">inCharset</span>&nbsp;<span class="op" id="5205350">:=</span>&nbsp;<span class="num" id="5205353">0</span><span class="op" id="5205354">,</span>&nbsp;<span class="builtintype" id="5205356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205363">for</span>&nbsp;<span class="op" id="5205367">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205371">i</span>&nbsp;<span class="op" id="5205373">:=</span>&nbsp;<span class="ident" id="5205376">k</span>&nbsp;<span class="op" id="5205378">+</span>&nbsp;<span class="ident" id="5205380">bytes</span><span class="op" id="5205385">.</span><span class="ident" id="5205386">IndexAny</span><span class="op" id="5205394">(</span><span class="ident" id="5205395">s</span><span class="op" id="5205396">[</span><span class="ident" id="5205397">k</span><span class="op" id="5205398">:</span><span class="op" id="5205399">]</span><span class="op" id="5205400">,</span>&nbsp;<span class="ident" id="5205402">specials</span><span class="op" id="5205410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205414">if</span>&nbsp;<span class="ident" id="5205417">i</span>&nbsp;<span class="op" id="5205419">&lt;</span>&nbsp;<span class="ident" id="5205421">k</span>&nbsp;<span class="op" id="5205423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205428">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205440">switch</span>&nbsp;<span class="ident" id="5205447">s</span><span class="op" id="5205448">[</span><span class="ident" id="5205449">i</span><span class="op" id="5205450">]</span>&nbsp;<span class="op" id="5205452">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205456">case</span>&nbsp;<span class="string" id="5205461">&#39;\\&#39;</span><span class="op" id="5205465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205470">i</span><span class="op" id="5205471">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205477">if</span>&nbsp;<span class="ident" id="5205480">i</span>&nbsp;<span class="op" id="5205482">==</span>&nbsp;<span class="builtinfunc" id="5205485">len</span><span class="op" id="5205488">(</span><span class="ident" id="5205489">s</span><span class="op" id="5205490">)</span>&nbsp;<span class="op" id="5205492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205498">return</span>&nbsp;<span class="ident" id="5205505">context</span><span class="op" id="5205512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205519">state</span><span class="op" id="5205524">:</span>&nbsp;<span class="ident" id="5205526">stateError</span><span class="op" id="5205536">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205543">err</span><span class="op" id="5205546">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5205550">errorf</span><span class="op" id="5205556">(</span><span class="ident" id="5205557">ErrPartialEscape</span><span class="op" id="5205573">,</span>&nbsp;<span class="ident" id="5205575">nil</span><span class="op" id="5205578">,</span>&nbsp;<span class="num" id="5205580">0</span><span class="op" id="5205581">,</span>&nbsp;<span class="string" id="5205583">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5205628">,</span>&nbsp;<span class="ident" id="5205630">s</span><span class="op" id="5205631">)</span><span class="op" id="5205632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205638">}</span><span class="op" id="5205639">,</span>&nbsp;<span class="builtinfunc" id="5205641">len</span><span class="op" id="5205644">(</span><span class="ident" id="5205645">s</span><span class="op" id="5205646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205655">case</span>&nbsp;<span class="string" id="5205660">&#39;[&#39;</span><span class="op" id="5205663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205668">inCharset</span>&nbsp;<span class="op" id="5205678">=</span>&nbsp;<span class="builtintype" id="5205680">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205687">case</span>&nbsp;<span class="string" id="5205692">&#39;]&#39;</span><span class="op" id="5205695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205700">inCharset</span>&nbsp;<span class="op" id="5205710">=</span>&nbsp;<span class="builtintype" id="5205712">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205720">default</span><span class="op" id="5205727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205732">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205752">if</span>&nbsp;<span class="op" id="5205755">!</span><span class="ident" id="5205756">inCharset</span>&nbsp;<span class="op" id="5205766">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205772">c</span><span class="op" id="5205773">.</span><span class="ident" id="5205774">state</span><span class="op" id="5205779">,</span>&nbsp;<span class="ident" id="5205781">c</span><span class="op" id="5205782">.</span><span class="ident" id="5205783">jsCtx</span>&nbsp;<span class="op" id="5205789">=</span>&nbsp;<span class="ident" id="5205791">stateJS</span><span class="op" id="5205798">,</span>&nbsp;<span class="ident" id="5205800">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205815">return</span>&nbsp;<span class="ident" id="5205822">c</span><span class="op" id="5205823">,</span>&nbsp;<span class="ident" id="5205825">i</span>&nbsp;<span class="op" id="5205827">+</span>&nbsp;<span class="num" id="5205829">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205842">k</span>&nbsp;<span class="op" id="5205844">=</span>&nbsp;<span class="ident" id="5205846">i</span>&nbsp;<span class="op" id="5205848">+</span>&nbsp;<span class="num" id="5205850">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5205853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205857">if</span>&nbsp;<span class="ident" id="5205860">inCharset</span>&nbsp;<span class="op" id="5205870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205874">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5205939">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5205970">return</span>&nbsp;<span class="ident" id="5205977">context</span><span class="op" id="5205984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5205989">state</span><span class="op" id="5205994">:</span>&nbsp;<span class="ident" id="5205996">stateError</span><span class="op" id="5206006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206011">err</span><span class="op" id="5206014">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5206018">errorf</span><span class="op" id="5206024">(</span><span class="ident" id="5206025">ErrPartialCharset</span><span class="op" id="5206042">,</span>&nbsp;<span class="ident" id="5206044">nil</span><span class="op" id="5206047">,</span>&nbsp;<span class="num" id="5206049">0</span><span class="op" id="5206050">,</span>&nbsp;<span class="string" id="5206052">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5206086">,</span>&nbsp;<span class="ident" id="5206088">s</span><span class="op" id="5206089">)</span><span class="op" id="5206090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206094">}</span><span class="op" id="5206095">,</span>&nbsp;<span class="builtinfunc" id="5206097">len</span><span class="op" id="5206100">(</span><span class="ident" id="5206101">s</span><span class="op" id="5206102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206105">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206109">return</span>&nbsp;<span class="ident" id="5206116">c</span><span class="op" id="5206117">,</span>&nbsp;<span class="builtinfunc" id="5206119">len</span><span class="op" id="5206122">(</span><span class="ident" id="5206123">s</span><span class="op" id="5206124">)</span><br>
<span class="lineno"></span><span class="op" id="5206126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5206129">var</span>&nbsp;<span class="ident" id="5206133">blockCommentEnd</span>&nbsp;<span class="op" id="5206149">=</span>&nbsp;<span class="op" id="5206151">[</span><span class="op" id="5206152">]</span><span class="builtintype" id="5206153">byte</span><span class="op" id="5206157">(</span><span class="string" id="5206158">&#34;*/&#34;</span><span class="op" id="5206162">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5206165">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5206237">func</span>&nbsp;<span class="ident" id="5206242">tBlockCmt</span><span class="op" id="5206251">(</span><span class="ident" id="5206252">c</span>&nbsp;<span class="ident" id="5206254">context</span><span class="op" id="5206261">,</span>&nbsp;<span class="ident" id="5206263">s</span>&nbsp;<span class="op" id="5206265">[</span><span class="op" id="5206266">]</span><span class="builtintype" id="5206267">byte</span><span class="op" id="5206271">)</span>&nbsp;<span class="op" id="5206273">(</span><span class="ident" id="5206274">context</span><span class="op" id="5206281">,</span>&nbsp;<span class="builtintype" id="5206283">int</span><span class="op" id="5206286">)</span>&nbsp;<span class="op" id="5206288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206291">i</span>&nbsp;<span class="op" id="5206293">:=</span>&nbsp;<span class="ident" id="5206296">bytes</span><span class="op" id="5206301">.</span><span class="ident" id="5206302">Index</span><span class="op" id="5206307">(</span><span class="ident" id="5206308">s</span><span class="op" id="5206309">,</span>&nbsp;<span class="ident" id="5206311">blockCommentEnd</span><span class="op" id="5206326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206329">if</span>&nbsp;<span class="ident" id="5206332">i</span>&nbsp;<span class="op" id="5206334">==</span>&nbsp;<span class="op" id="5206337">-</span><span class="num" id="5206338">1</span>&nbsp;<span class="op" id="5206340">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206344">return</span>&nbsp;<span class="ident" id="5206351">c</span><span class="op" id="5206352">,</span>&nbsp;<span class="builtinfunc" id="5206354">len</span><span class="op" id="5206357">(</span><span class="ident" id="5206358">s</span><span class="op" id="5206359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206365">switch</span>&nbsp;<span class="ident" id="5206372">c</span><span class="op" id="5206373">.</span><span class="ident" id="5206374">state</span>&nbsp;<span class="op" id="5206380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206383">case</span>&nbsp;<span class="ident" id="5206388">stateJSBlockCmt</span><span class="op" id="5206403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206407">c</span><span class="op" id="5206408">.</span><span class="ident" id="5206409">state</span>&nbsp;<span class="op" id="5206415">=</span>&nbsp;<span class="ident" id="5206417">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206426">case</span>&nbsp;<span class="ident" id="5206431">stateCSSBlockCmt</span><span class="op" id="5206447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206451">c</span><span class="op" id="5206452">.</span><span class="ident" id="5206453">state</span>&nbsp;<span class="op" id="5206459">=</span>&nbsp;<span class="ident" id="5206461">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206471">default</span><span class="op" id="5206478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5206482">panic</span><span class="op" id="5206487">(</span><span class="ident" id="5206488">c</span><span class="op" id="5206489">.</span><span class="ident" id="5206490">state</span><span class="op" id="5206495">.</span><span class="ident" id="5206496">String</span><span class="op" id="5206502">(</span><span class="op" id="5206503">)</span><span class="op" id="5206504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5206507">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206510">return</span>&nbsp;<span class="ident" id="5206517">c</span><span class="op" id="5206518">,</span>&nbsp;<span class="ident" id="5206520">i</span>&nbsp;<span class="op" id="5206522">+</span>&nbsp;<span class="num" id="5206524">2</span><br>
<span class="lineno"></span><span class="op" id="5206526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206529">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5206598">func</span>&nbsp;<span class="ident" id="5206603">tLineCmt</span><span class="op" id="5206611">(</span><span class="ident" id="5206612">c</span>&nbsp;<span class="ident" id="5206614">context</span><span class="op" id="5206621">,</span>&nbsp;<span class="ident" id="5206623">s</span>&nbsp;<span class="op" id="5206625">[</span><span class="op" id="5206626">]</span><span class="builtintype" id="5206627">byte</span><span class="op" id="5206631">)</span>&nbsp;<span class="op" id="5206633">(</span><span class="ident" id="5206634">context</span><span class="op" id="5206641">,</span>&nbsp;<span class="builtintype" id="5206643">int</span><span class="op" id="5206646">)</span>&nbsp;<span class="op" id="5206648">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206651">var</span>&nbsp;<span class="ident" id="5206655">lineTerminators</span>&nbsp;<span class="builtintype" id="5206671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206679">var</span>&nbsp;<span class="ident" id="5206683">endState</span>&nbsp;<span class="ident" id="5206692">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206699">switch</span>&nbsp;<span class="ident" id="5206706">c</span><span class="op" id="5206707">.</span><span class="ident" id="5206708">state</span>&nbsp;<span class="op" id="5206714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206717">case</span>&nbsp;<span class="ident" id="5206722">stateJSLineCmt</span><span class="op" id="5206736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206740">lineTerminators</span><span class="op" id="5206755">,</span>&nbsp;<span class="ident" id="5206757">endState</span>&nbsp;<span class="op" id="5206766">=</span>&nbsp;<span class="string" id="5206768">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5206786">,</span>&nbsp;<span class="ident" id="5206788">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5206797">case</span>&nbsp;<span class="ident" id="5206802">stateCSSLineCmt</span><span class="op" id="5206817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5206821">lineTerminators</span><span class="op" id="5206836">,</span>&nbsp;<span class="ident" id="5206838">endState</span>&nbsp;<span class="op" id="5206847">=</span>&nbsp;<span class="string" id="5206849">&#34;\n\f\r&#34;</span><span class="op" id="5206857">,</span>&nbsp;<span class="ident" id="5206859">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206870">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206936">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5206980">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207015">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207056">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207119">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207134">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207175">default</span><span class="op" id="5207182">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5207186">panic</span><span class="op" id="5207191">(</span><span class="ident" id="5207192">c</span><span class="op" id="5207193">.</span><span class="ident" id="5207194">state</span><span class="op" id="5207199">.</span><span class="ident" id="5207200">String</span><span class="op" id="5207206">(</span><span class="op" id="5207207">)</span><span class="op" id="5207208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207215">i</span>&nbsp;<span class="op" id="5207217">:=</span>&nbsp;<span class="ident" id="5207220">bytes</span><span class="op" id="5207225">.</span><span class="ident" id="5207226">IndexAny</span><span class="op" id="5207234">(</span><span class="ident" id="5207235">s</span><span class="op" id="5207236">,</span>&nbsp;<span class="ident" id="5207238">lineTerminators</span><span class="op" id="5207253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207256">if</span>&nbsp;<span class="ident" id="5207259">i</span>&nbsp;<span class="op" id="5207261">==</span>&nbsp;<span class="op" id="5207264">-</span><span class="num" id="5207265">1</span>&nbsp;<span class="op" id="5207267">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207271">return</span>&nbsp;<span class="ident" id="5207278">c</span><span class="op" id="5207279">,</span>&nbsp;<span class="builtinfunc" id="5207281">len</span><span class="op" id="5207284">(</span><span class="ident" id="5207285">s</span><span class="op" id="5207286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5207289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5207292">c</span><span class="op" id="5207293">.</span><span class="ident" id="5207294">state</span>&nbsp;<span class="op" id="5207300">=</span>&nbsp;<span class="ident" id="5207302">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207312">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207378">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207441">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207501">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207567">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5207631">return</span>&nbsp;<span class="ident" id="5207638">c</span><span class="op" id="5207639">,</span>&nbsp;<span class="ident" id="5207641">i</span><br>
<span class="lineno"></span><span class="op" id="5207643">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5207646">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5207708">func</span>&nbsp;<span class="ident" id="5207713">tCSS</span><span class="op" id="5207717">(</span><span class="ident" id="5207718">c</span>&nbsp;<span class="ident" id="5207720">context</span><span class="op" id="5207727">,</span>&nbsp;<span class="ident" id="5207729">s</span>&nbsp;<span class="op" id="5207731">[</span><span class="op" id="5207732">]</span><span class="builtintype" id="5207733">byte</span><span class="op" id="5207737">)</span>&nbsp;<span class="op" id="5207739">(</span><span class="ident" id="5207740">context</span><span class="op" id="5207747">,</span>&nbsp;<span class="builtintype" id="5207749">int</span><span class="op" id="5207752">)</span>&nbsp;<span class="op" id="5207754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207757">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207814">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207856">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207922">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207984">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5207999">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208052">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208098">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208149">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208210">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208226">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208283">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208353">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208357">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208420">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208455">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208459">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208513">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208582">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208654">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208675">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208743">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208813">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208874">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5208945">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209014">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209053">k</span>&nbsp;<span class="op" id="5209055">:=</span>&nbsp;<span class="num" id="5209058">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209061">for</span>&nbsp;<span class="op" id="5209065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209069">i</span>&nbsp;<span class="op" id="5209071">:=</span>&nbsp;<span class="ident" id="5209074">k</span>&nbsp;<span class="op" id="5209076">+</span>&nbsp;<span class="ident" id="5209078">bytes</span><span class="op" id="5209083">.</span><span class="ident" id="5209084">IndexAny</span><span class="op" id="5209092">(</span><span class="ident" id="5209093">s</span><span class="op" id="5209094">[</span><span class="ident" id="5209095">k</span><span class="op" id="5209096">:</span><span class="op" id="5209097">]</span><span class="op" id="5209098">,</span>&nbsp;<span class="string" id="5209100">`(&#34;&#39;/`</span><span class="op" id="5209106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209110">if</span>&nbsp;<span class="ident" id="5209113">i</span>&nbsp;<span class="op" id="5209115">&lt;</span>&nbsp;<span class="ident" id="5209117">k</span>&nbsp;<span class="op" id="5209119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209124">return</span>&nbsp;<span class="ident" id="5209131">c</span><span class="op" id="5209132">,</span>&nbsp;<span class="builtinfunc" id="5209134">len</span><span class="op" id="5209137">(</span><span class="ident" id="5209138">s</span><span class="op" id="5209139">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209147">switch</span>&nbsp;<span class="ident" id="5209154">s</span><span class="op" id="5209155">[</span><span class="ident" id="5209156">i</span><span class="op" id="5209157">]</span>&nbsp;<span class="op" id="5209159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209163">case</span>&nbsp;<span class="string" id="5209168">&#39;(&#39;</span><span class="op" id="5209171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5209176">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209208">p</span>&nbsp;<span class="op" id="5209210">:=</span>&nbsp;<span class="ident" id="5209213">bytes</span><span class="op" id="5209218">.</span><span class="ident" id="5209219">TrimRight</span><span class="op" id="5209228">(</span><span class="ident" id="5209229">s</span><span class="op" id="5209230">[</span><span class="op" id="5209231">:</span><span class="ident" id="5209232">i</span><span class="op" id="5209233">]</span><span class="op" id="5209234">,</span>&nbsp;<span class="string" id="5209236">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5209247">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209252">if</span>&nbsp;<span class="ident" id="5209255">endsWithCSSKeyword</span><span class="op" id="5209273">(</span><span class="ident" id="5209274">p</span><span class="op" id="5209275">,</span>&nbsp;<span class="string" id="5209277">&#34;url&#34;</span><span class="op" id="5209282">)</span>&nbsp;<span class="op" id="5209284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209290">j</span>&nbsp;<span class="op" id="5209292">:=</span>&nbsp;<span class="builtinfunc" id="5209295">len</span><span class="op" id="5209298">(</span><span class="ident" id="5209299">s</span><span class="op" id="5209300">)</span>&nbsp;<span class="op" id="5209302">-</span>&nbsp;<span class="builtinfunc" id="5209304">len</span><span class="op" id="5209307">(</span><span class="ident" id="5209308">bytes</span><span class="op" id="5209313">.</span><span class="ident" id="5209314">TrimLeft</span><span class="op" id="5209322">(</span><span class="ident" id="5209323">s</span><span class="op" id="5209324">[</span><span class="ident" id="5209325">i</span><span class="op" id="5209326">+</span><span class="num" id="5209327">1</span><span class="op" id="5209328">:</span><span class="op" id="5209329">]</span><span class="op" id="5209330">,</span>&nbsp;<span class="string" id="5209332">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5209343">)</span><span class="op" id="5209344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209350">switch</span>&nbsp;<span class="op" id="5209357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209363">case</span>&nbsp;<span class="ident" id="5209368">j</span>&nbsp;<span class="op" id="5209370">!=</span>&nbsp;<span class="builtinfunc" id="5209373">len</span><span class="op" id="5209376">(</span><span class="ident" id="5209377">s</span><span class="op" id="5209378">)</span>&nbsp;<span class="op" id="5209380">&amp;&amp;</span>&nbsp;<span class="ident" id="5209383">s</span><span class="op" id="5209384">[</span><span class="ident" id="5209385">j</span><span class="op" id="5209386">]</span>&nbsp;<span class="op" id="5209388">==</span>&nbsp;<span class="string" id="5209391">&#39;&#34;&#39;</span><span class="op" id="5209394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209401">c</span><span class="op" id="5209402">.</span><span class="ident" id="5209403">state</span><span class="op" id="5209408">,</span>&nbsp;<span class="ident" id="5209410">j</span>&nbsp;<span class="op" id="5209412">=</span>&nbsp;<span class="ident" id="5209414">stateCSSDqURL</span><span class="op" id="5209427">,</span>&nbsp;<span class="ident" id="5209429">j</span><span class="op" id="5209430">+</span><span class="num" id="5209431">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209437">case</span>&nbsp;<span class="ident" id="5209442">j</span>&nbsp;<span class="op" id="5209444">!=</span>&nbsp;<span class="builtinfunc" id="5209447">len</span><span class="op" id="5209450">(</span><span class="ident" id="5209451">s</span><span class="op" id="5209452">)</span>&nbsp;<span class="op" id="5209454">&amp;&amp;</span>&nbsp;<span class="ident" id="5209457">s</span><span class="op" id="5209458">[</span><span class="ident" id="5209459">j</span><span class="op" id="5209460">]</span>&nbsp;<span class="op" id="5209462">==</span>&nbsp;<span class="string" id="5209465">&#39;\&#39;&#39;</span><span class="op" id="5209469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209476">c</span><span class="op" id="5209477">.</span><span class="ident" id="5209478">state</span><span class="op" id="5209483">,</span>&nbsp;<span class="ident" id="5209485">j</span>&nbsp;<span class="op" id="5209487">=</span>&nbsp;<span class="ident" id="5209489">stateCSSSqURL</span><span class="op" id="5209502">,</span>&nbsp;<span class="ident" id="5209504">j</span><span class="op" id="5209505">+</span><span class="num" id="5209506">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209512">default</span><span class="op" id="5209519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209526">c</span><span class="op" id="5209527">.</span><span class="ident" id="5209528">state</span>&nbsp;<span class="op" id="5209534">=</span>&nbsp;<span class="ident" id="5209536">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209552">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209558">return</span>&nbsp;<span class="ident" id="5209565">c</span><span class="op" id="5209566">,</span>&nbsp;<span class="ident" id="5209568">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209577">case</span>&nbsp;<span class="string" id="5209582">&#39;/&#39;</span><span class="op" id="5209585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209590">if</span>&nbsp;<span class="ident" id="5209593">i</span><span class="op" id="5209594">+</span><span class="num" id="5209595">1</span>&nbsp;<span class="op" id="5209597">&lt;</span>&nbsp;<span class="builtinfunc" id="5209599">len</span><span class="op" id="5209602">(</span><span class="ident" id="5209603">s</span><span class="op" id="5209604">)</span>&nbsp;<span class="op" id="5209606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209612">switch</span>&nbsp;<span class="ident" id="5209619">s</span><span class="op" id="5209620">[</span><span class="ident" id="5209621">i</span><span class="op" id="5209622">+</span><span class="num" id="5209623">1</span><span class="op" id="5209624">]</span>&nbsp;<span class="op" id="5209626">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209632">case</span>&nbsp;<span class="string" id="5209637">&#39;/&#39;</span><span class="op" id="5209640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209647">c</span><span class="op" id="5209648">.</span><span class="ident" id="5209649">state</span>&nbsp;<span class="op" id="5209655">=</span>&nbsp;<span class="ident" id="5209657">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209678">return</span>&nbsp;<span class="ident" id="5209685">c</span><span class="op" id="5209686">,</span>&nbsp;<span class="ident" id="5209688">i</span>&nbsp;<span class="op" id="5209690">+</span>&nbsp;<span class="num" id="5209692">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209698">case</span>&nbsp;<span class="string" id="5209703">&#39;*&#39;</span><span class="op" id="5209706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209713">c</span><span class="op" id="5209714">.</span><span class="ident" id="5209715">state</span>&nbsp;<span class="op" id="5209721">=</span>&nbsp;<span class="ident" id="5209723">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209745">return</span>&nbsp;<span class="ident" id="5209752">c</span><span class="op" id="5209753">,</span>&nbsp;<span class="ident" id="5209755">i</span>&nbsp;<span class="op" id="5209757">+</span>&nbsp;<span class="num" id="5209759">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209774">case</span>&nbsp;<span class="string" id="5209779">&#39;&#34;&#39;</span><span class="op" id="5209782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209787">c</span><span class="op" id="5209788">.</span><span class="ident" id="5209789">state</span>&nbsp;<span class="op" id="5209795">=</span>&nbsp;<span class="ident" id="5209797">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209814">return</span>&nbsp;<span class="ident" id="5209821">c</span><span class="op" id="5209822">,</span>&nbsp;<span class="ident" id="5209824">i</span>&nbsp;<span class="op" id="5209826">+</span>&nbsp;<span class="num" id="5209828">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209832">case</span>&nbsp;<span class="string" id="5209837">&#39;\&#39;&#39;</span><span class="op" id="5209841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209846">c</span><span class="op" id="5209847">.</span><span class="ident" id="5209848">state</span>&nbsp;<span class="op" id="5209854">=</span>&nbsp;<span class="ident" id="5209856">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5209873">return</span>&nbsp;<span class="ident" id="5209880">c</span><span class="op" id="5209881">,</span>&nbsp;<span class="ident" id="5209883">i</span>&nbsp;<span class="op" id="5209885">+</span>&nbsp;<span class="num" id="5209887">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209891">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5209895">k</span>&nbsp;<span class="op" id="5209897">=</span>&nbsp;<span class="ident" id="5209899">i</span>&nbsp;<span class="op" id="5209901">+</span>&nbsp;<span class="num" id="5209903">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5209906">}</span><br>
<span class="lineno"></span><span class="op" id="5209908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5209911">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5209992">func</span>&nbsp;<span class="ident" id="5209997">tCSSStr</span><span class="op" id="5210004">(</span><span class="ident" id="5210005">c</span>&nbsp;<span class="ident" id="5210007">context</span><span class="op" id="5210014">,</span>&nbsp;<span class="ident" id="5210016">s</span>&nbsp;<span class="op" id="5210018">[</span><span class="op" id="5210019">]</span><span class="builtintype" id="5210020">byte</span><span class="op" id="5210024">)</span>&nbsp;<span class="op" id="5210026">(</span><span class="ident" id="5210027">context</span><span class="op" id="5210034">,</span>&nbsp;<span class="builtintype" id="5210036">int</span><span class="op" id="5210039">)</span>&nbsp;<span class="op" id="5210041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210044">var</span>&nbsp;<span class="ident" id="5210048">endAndEsc</span>&nbsp;<span class="builtintype" id="5210058">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210066">switch</span>&nbsp;<span class="ident" id="5210073">c</span><span class="op" id="5210074">.</span><span class="ident" id="5210075">state</span>&nbsp;<span class="op" id="5210081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210084">case</span>&nbsp;<span class="ident" id="5210089">stateCSSDqStr</span><span class="op" id="5210102">,</span>&nbsp;<span class="ident" id="5210104">stateCSSDqURL</span><span class="op" id="5210117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210121">endAndEsc</span>&nbsp;<span class="op" id="5210131">=</span>&nbsp;<span class="string" id="5210133">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210139">case</span>&nbsp;<span class="ident" id="5210144">stateCSSSqStr</span><span class="op" id="5210157">,</span>&nbsp;<span class="ident" id="5210159">stateCSSSqURL</span><span class="op" id="5210172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210176">endAndEsc</span>&nbsp;<span class="op" id="5210186">=</span>&nbsp;<span class="string" id="5210188">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210194">case</span>&nbsp;<span class="ident" id="5210199">stateCSSURL</span><span class="op" id="5210210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5210214">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5210274">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210336">endAndEsc</span>&nbsp;<span class="op" id="5210346">=</span>&nbsp;<span class="string" id="5210348">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210364">default</span><span class="op" id="5210371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5210375">panic</span><span class="op" id="5210380">(</span><span class="ident" id="5210381">c</span><span class="op" id="5210382">.</span><span class="ident" id="5210383">state</span><span class="op" id="5210388">.</span><span class="ident" id="5210389">String</span><span class="op" id="5210395">(</span><span class="op" id="5210396">)</span><span class="op" id="5210397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210404">k</span>&nbsp;<span class="op" id="5210406">:=</span>&nbsp;<span class="num" id="5210409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210412">for</span>&nbsp;<span class="op" id="5210416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210420">i</span>&nbsp;<span class="op" id="5210422">:=</span>&nbsp;<span class="ident" id="5210425">k</span>&nbsp;<span class="op" id="5210427">+</span>&nbsp;<span class="ident" id="5210429">bytes</span><span class="op" id="5210434">.</span><span class="ident" id="5210435">IndexAny</span><span class="op" id="5210443">(</span><span class="ident" id="5210444">s</span><span class="op" id="5210445">[</span><span class="ident" id="5210446">k</span><span class="op" id="5210447">:</span><span class="op" id="5210448">]</span><span class="op" id="5210449">,</span>&nbsp;<span class="ident" id="5210451">endAndEsc</span><span class="op" id="5210460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210464">if</span>&nbsp;<span class="ident" id="5210467">i</span>&nbsp;<span class="op" id="5210469">&lt;</span>&nbsp;<span class="ident" id="5210471">k</span>&nbsp;<span class="op" id="5210473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210478">c</span><span class="op" id="5210479">,</span>&nbsp;<span class="ident" id="5210481">nread</span>&nbsp;<span class="op" id="5210487">:=</span>&nbsp;<span class="ident" id="5210490">tURL</span><span class="op" id="5210494">(</span><span class="ident" id="5210495">c</span><span class="op" id="5210496">,</span>&nbsp;<span class="ident" id="5210498">decodeCSS</span><span class="op" id="5210507">(</span><span class="ident" id="5210508">s</span><span class="op" id="5210509">[</span><span class="ident" id="5210510">k</span><span class="op" id="5210511">:</span><span class="op" id="5210512">]</span><span class="op" id="5210513">)</span><span class="op" id="5210514">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210519">return</span>&nbsp;<span class="ident" id="5210526">c</span><span class="op" id="5210527">,</span>&nbsp;<span class="ident" id="5210529">k</span>&nbsp;<span class="op" id="5210531">+</span>&nbsp;<span class="ident" id="5210533">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210545">if</span>&nbsp;<span class="ident" id="5210548">s</span><span class="op" id="5210549">[</span><span class="ident" id="5210550">i</span><span class="op" id="5210551">]</span>&nbsp;<span class="op" id="5210553">==</span>&nbsp;<span class="string" id="5210556">&#39;\\&#39;</span>&nbsp;<span class="op" id="5210561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210566">i</span><span class="op" id="5210567">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210573">if</span>&nbsp;<span class="ident" id="5210576">i</span>&nbsp;<span class="op" id="5210578">==</span>&nbsp;<span class="builtinfunc" id="5210581">len</span><span class="op" id="5210584">(</span><span class="ident" id="5210585">s</span><span class="op" id="5210586">)</span>&nbsp;<span class="op" id="5210588">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210594">return</span>&nbsp;<span class="ident" id="5210601">context</span><span class="op" id="5210608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210615">state</span><span class="op" id="5210620">:</span>&nbsp;<span class="ident" id="5210622">stateError</span><span class="op" id="5210632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210639">err</span><span class="op" id="5210642">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5210646">errorf</span><span class="op" id="5210652">(</span><span class="ident" id="5210653">ErrPartialEscape</span><span class="op" id="5210669">,</span>&nbsp;<span class="ident" id="5210671">nil</span><span class="op" id="5210674">,</span>&nbsp;<span class="num" id="5210676">0</span><span class="op" id="5210677">,</span>&nbsp;<span class="string" id="5210679">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5210725">,</span>&nbsp;<span class="ident" id="5210727">s</span><span class="op" id="5210728">)</span><span class="op" id="5210729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210735">}</span><span class="op" id="5210736">,</span>&nbsp;<span class="builtinfunc" id="5210738">len</span><span class="op" id="5210741">(</span><span class="ident" id="5210742">s</span><span class="op" id="5210743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210748">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210752">}</span>&nbsp;<span class="keyword" id="5210754">else</span>&nbsp;<span class="op" id="5210759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210764">c</span><span class="op" id="5210765">.</span><span class="ident" id="5210766">state</span>&nbsp;<span class="op" id="5210772">=</span>&nbsp;<span class="ident" id="5210774">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210786">return</span>&nbsp;<span class="ident" id="5210793">c</span><span class="op" id="5210794">,</span>&nbsp;<span class="ident" id="5210796">i</span>&nbsp;<span class="op" id="5210798">+</span>&nbsp;<span class="num" id="5210800">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210808">c</span><span class="op" id="5210809">,</span>&nbsp;<span class="ident" id="5210811">_</span>&nbsp;<span class="op" id="5210813">=</span>&nbsp;<span class="ident" id="5210815">tURL</span><span class="op" id="5210819">(</span><span class="ident" id="5210820">c</span><span class="op" id="5210821">,</span>&nbsp;<span class="ident" id="5210823">decodeCSS</span><span class="op" id="5210832">(</span><span class="ident" id="5210833">s</span><span class="op" id="5210834">[</span><span class="op" id="5210835">:</span><span class="ident" id="5210836">i</span><span class="op" id="5210837">+</span><span class="num" id="5210838">1</span><span class="op" id="5210839">]</span><span class="op" id="5210840">)</span><span class="op" id="5210841">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5210845">k</span>&nbsp;<span class="op" id="5210847">=</span>&nbsp;<span class="ident" id="5210849">i</span>&nbsp;<span class="op" id="5210851">+</span>&nbsp;<span class="num" id="5210853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5210856">}</span><br>
<span class="lineno"></span><span class="op" id="5210858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5210861">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5210927">func</span>&nbsp;<span class="ident" id="5210932">tError</span><span class="op" id="5210938">(</span><span class="ident" id="5210939">c</span>&nbsp;<span class="ident" id="5210941">context</span><span class="op" id="5210948">,</span>&nbsp;<span class="ident" id="5210950">s</span>&nbsp;<span class="op" id="5210952">[</span><span class="op" id="5210953">]</span><span class="builtintype" id="5210954">byte</span><span class="op" id="5210958">)</span>&nbsp;<span class="op" id="5210960">(</span><span class="ident" id="5210961">context</span><span class="op" id="5210968">,</span>&nbsp;<span class="builtintype" id="5210970">int</span><span class="op" id="5210973">)</span>&nbsp;<span class="op" id="5210975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5210978">return</span>&nbsp;<span class="ident" id="5210985">c</span><span class="op" id="5210986">,</span>&nbsp;<span class="builtinfunc" id="5210988">len</span><span class="op" id="5210991">(</span><span class="ident" id="5210992">s</span><span class="op" id="5210993">)</span><br>
<span class="lineno"></span><span class="op" id="5210995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5210998">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5211074">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5211143">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5211216">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5211232">func</span>&nbsp;<span class="ident" id="5211237">eatAttrName</span><span class="op" id="5211248">(</span><span class="ident" id="5211249">s</span>&nbsp;<span class="op" id="5211251">[</span><span class="op" id="5211252">]</span><span class="builtintype" id="5211253">byte</span><span class="op" id="5211257">,</span>&nbsp;<span class="ident" id="5211259">i</span>&nbsp;<span class="builtintype" id="5211261">int</span><span class="op" id="5211264">)</span>&nbsp;<span class="op" id="5211266">(</span><span class="builtintype" id="5211267">int</span><span class="op" id="5211270">,</span>&nbsp;<span class="op" id="5211272">*</span><span class="ident" id="5211273">Error</span><span class="op" id="5211278">)</span>&nbsp;<span class="op" id="5211280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211283">for</span>&nbsp;<span class="ident" id="5211287">j</span>&nbsp;<span class="op" id="5211289">:=</span>&nbsp;<span class="ident" id="5211292">i</span><span class="op" id="5211293">;</span>&nbsp;<span class="ident" id="5211295">j</span>&nbsp;<span class="op" id="5211297">&lt;</span>&nbsp;<span class="builtinfunc" id="5211299">len</span><span class="op" id="5211302">(</span><span class="ident" id="5211303">s</span><span class="op" id="5211304">)</span><span class="op" id="5211305">;</span>&nbsp;<span class="ident" id="5211307">j</span><span class="op" id="5211308">++</span>&nbsp;<span class="op" id="5211311">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211315">switch</span>&nbsp;<span class="ident" id="5211322">s</span><span class="op" id="5211323">[</span><span class="ident" id="5211324">j</span><span class="op" id="5211325">]</span>&nbsp;<span class="op" id="5211327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211331">case</span>&nbsp;<span class="string" id="5211336">&#39;&nbsp;&#39;</span><span class="op" id="5211339">,</span>&nbsp;<span class="string" id="5211341">&#39;\t&#39;</span><span class="op" id="5211345">,</span>&nbsp;<span class="string" id="5211347">&#39;\n&#39;</span><span class="op" id="5211351">,</span>&nbsp;<span class="string" id="5211353">&#39;\f&#39;</span><span class="op" id="5211357">,</span>&nbsp;<span class="string" id="5211359">&#39;\r&#39;</span><span class="op" id="5211363">,</span>&nbsp;<span class="string" id="5211365">&#39;=&#39;</span><span class="op" id="5211368">,</span>&nbsp;<span class="string" id="5211370">&#39;&gt;&#39;</span><span class="op" id="5211373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211378">return</span>&nbsp;<span class="ident" id="5211385">j</span><span class="op" id="5211386">,</span>&nbsp;<span class="ident" id="5211388">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211394">case</span>&nbsp;<span class="string" id="5211399">&#39;\&#39;&#39;</span><span class="op" id="5211403">,</span>&nbsp;<span class="string" id="5211405">&#39;&#34;&#39;</span><span class="op" id="5211408">,</span>&nbsp;<span class="string" id="5211410">&#39;&lt;&#39;</span><span class="op" id="5211413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211418">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211473">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211529">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211555">return</span>&nbsp;<span class="op" id="5211562">-</span><span class="num" id="5211563">1</span><span class="op" id="5211564">,</span>&nbsp;<span class="ident" id="5211566">errorf</span><span class="op" id="5211572">(</span><span class="ident" id="5211573">ErrBadHTML</span><span class="op" id="5211583">,</span>&nbsp;<span class="ident" id="5211585">nil</span><span class="op" id="5211588">,</span>&nbsp;<span class="num" id="5211590">0</span><span class="op" id="5211591">,</span>&nbsp;<span class="string" id="5211593">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5211622">,</span>&nbsp;<span class="ident" id="5211624">s</span><span class="op" id="5211625">[</span><span class="ident" id="5211626">j</span><span class="op" id="5211627">:</span><span class="ident" id="5211628">j</span><span class="op" id="5211629">+</span><span class="num" id="5211630">1</span><span class="op" id="5211631">]</span><span class="op" id="5211632">,</span>&nbsp;<span class="ident" id="5211634">s</span><span class="op" id="5211635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211639">default</span><span class="op" id="5211646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5211651">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5211666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211669">return</span>&nbsp;<span class="builtinfunc" id="5211676">len</span><span class="op" id="5211679">(</span><span class="ident" id="5211680">s</span><span class="op" id="5211681">)</span><span class="op" id="5211682">,</span>&nbsp;<span class="ident" id="5211684">nil</span><br>
<span class="lineno"></span><span class="op" id="5211688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5211691">var</span>&nbsp;<span class="ident" id="5211695">elementNameMap</span>&nbsp;<span class="op" id="5211710">=</span>&nbsp;<span class="keyword" id="5211712">map</span><span class="op" id="5211715">[</span><span class="builtintype" id="5211716">string</span><span class="op" id="5211722">]</span><span class="ident" id="5211723">element</span><span class="op" id="5211730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5211733">&#34;script&#34;</span><span class="op" id="5211741">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5211745">elementScript</span><span class="op" id="5211758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5211761">&#34;style&#34;</span><span class="op" id="5211768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211773">elementStyle</span><span class="op" id="5211785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5211788">&#34;textarea&#34;</span><span class="op" id="5211798">:</span>&nbsp;<span class="ident" id="5211800">elementTextarea</span><span class="op" id="5211815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5211818">&#34;title&#34;</span><span class="op" id="5211825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211830">elementTitle</span><span class="op" id="5211842">,</span><br>
<span class="lineno">505</span><span class="op" id="5211844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5211847">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5211899">func</span>&nbsp;<span class="ident" id="5211904">asciiAlpha</span><span class="op" id="5211914">(</span><span class="ident" id="5211915">c</span>&nbsp;<span class="builtintype" id="5211917">byte</span><span class="op" id="5211921">)</span>&nbsp;<span class="builtintype" id="5211923">bool</span>&nbsp;<span class="op" id="5211928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5211931">return</span>&nbsp;<span class="string" id="5211938">&#39;A&#39;</span>&nbsp;<span class="op" id="5211942">&lt;=</span>&nbsp;<span class="ident" id="5211945">c</span>&nbsp;<span class="op" id="5211947">&amp;&amp;</span>&nbsp;<span class="ident" id="5211950">c</span>&nbsp;<span class="op" id="5211952">&lt;=</span>&nbsp;<span class="string" id="5211955">&#39;Z&#39;</span>&nbsp;<span class="op" id="5211959">||</span>&nbsp;<span class="string" id="5211962">&#39;a&#39;</span>&nbsp;<span class="op" id="5211966">&lt;=</span>&nbsp;<span class="ident" id="5211969">c</span>&nbsp;<span class="op" id="5211971">&amp;&amp;</span>&nbsp;<span class="ident" id="5211974">c</span>&nbsp;<span class="op" id="5211976">&lt;=</span>&nbsp;<span class="string" id="5211979">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5211983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5211986">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5212050">func</span>&nbsp;<span class="ident" id="5212055">asciiAlphaNum</span><span class="op" id="5212068">(</span><span class="ident" id="5212069">c</span>&nbsp;<span class="builtintype" id="5212071">byte</span><span class="op" id="5212075">)</span>&nbsp;<span class="builtintype" id="5212077">bool</span>&nbsp;<span class="op" id="5212082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212085">return</span>&nbsp;<span class="ident" id="5212092">asciiAlpha</span><span class="op" id="5212102">(</span><span class="ident" id="5212103">c</span><span class="op" id="5212104">)</span>&nbsp;<span class="op" id="5212106">||</span>&nbsp;<span class="string" id="5212109">&#39;0&#39;</span>&nbsp;<span class="op" id="5212113">&lt;=</span>&nbsp;<span class="ident" id="5212116">c</span>&nbsp;<span class="op" id="5212118">&amp;&amp;</span>&nbsp;<span class="ident" id="5212121">c</span>&nbsp;<span class="op" id="5212123">&lt;=</span>&nbsp;<span class="string" id="5212126">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5212130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5212133">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5212218">func</span>&nbsp;<span class="ident" id="5212223">eatTagName</span><span class="op" id="5212233">(</span><span class="ident" id="5212234">s</span>&nbsp;<span class="op" id="5212236">[</span><span class="op" id="5212237">]</span><span class="builtintype" id="5212238">byte</span><span class="op" id="5212242">,</span>&nbsp;<span class="ident" id="5212244">i</span>&nbsp;<span class="builtintype" id="5212246">int</span><span class="op" id="5212249">)</span>&nbsp;<span class="op" id="5212251">(</span><span class="builtintype" id="5212252">int</span><span class="op" id="5212255">,</span>&nbsp;<span class="ident" id="5212257">element</span><span class="op" id="5212264">)</span>&nbsp;<span class="op" id="5212266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212269">if</span>&nbsp;<span class="ident" id="5212272">i</span>&nbsp;<span class="op" id="5212274">==</span>&nbsp;<span class="builtinfunc" id="5212277">len</span><span class="op" id="5212280">(</span><span class="ident" id="5212281">s</span><span class="op" id="5212282">)</span>&nbsp;<span class="op" id="5212284">||</span>&nbsp;<span class="op" id="5212287">!</span><span class="ident" id="5212288">asciiAlpha</span><span class="op" id="5212298">(</span><span class="ident" id="5212299">s</span><span class="op" id="5212300">[</span><span class="ident" id="5212301">i</span><span class="op" id="5212302">]</span><span class="op" id="5212303">)</span>&nbsp;<span class="op" id="5212305">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212309">return</span>&nbsp;<span class="ident" id="5212316">i</span><span class="op" id="5212317">,</span>&nbsp;<span class="ident" id="5212319">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212335">j</span>&nbsp;<span class="op" id="5212337">:=</span>&nbsp;<span class="ident" id="5212340">i</span>&nbsp;<span class="op" id="5212342">+</span>&nbsp;<span class="num" id="5212344">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212347">for</span>&nbsp;<span class="ident" id="5212351">j</span>&nbsp;<span class="op" id="5212353">&lt;</span>&nbsp;<span class="builtinfunc" id="5212355">len</span><span class="op" id="5212358">(</span><span class="ident" id="5212359">s</span><span class="op" id="5212360">)</span>&nbsp;<span class="op" id="5212362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212366">x</span>&nbsp;<span class="op" id="5212368">:=</span>&nbsp;<span class="ident" id="5212371">s</span><span class="op" id="5212372">[</span><span class="ident" id="5212373">j</span><span class="op" id="5212374">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212378">if</span>&nbsp;<span class="ident" id="5212381">asciiAlphaNum</span><span class="op" id="5212394">(</span><span class="ident" id="5212395">x</span><span class="op" id="5212396">)</span>&nbsp;<span class="op" id="5212398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212403">j</span><span class="op" id="5212404">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212410">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212425">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212482">if</span>&nbsp;<span class="op" id="5212485">(</span><span class="ident" id="5212486">x</span>&nbsp;<span class="op" id="5212488">==</span>&nbsp;<span class="string" id="5212491">&#39;:&#39;</span>&nbsp;<span class="op" id="5212495">||</span>&nbsp;<span class="ident" id="5212498">x</span>&nbsp;<span class="op" id="5212500">==</span>&nbsp;<span class="string" id="5212503">&#39;-&#39;</span><span class="op" id="5212506">)</span>&nbsp;<span class="op" id="5212508">&amp;&amp;</span>&nbsp;<span class="ident" id="5212511">j</span><span class="op" id="5212512">+</span><span class="num" id="5212513">1</span>&nbsp;<span class="op" id="5212515">&lt;</span>&nbsp;<span class="builtinfunc" id="5212517">len</span><span class="op" id="5212520">(</span><span class="ident" id="5212521">s</span><span class="op" id="5212522">)</span>&nbsp;<span class="op" id="5212524">&amp;&amp;</span>&nbsp;<span class="ident" id="5212527">asciiAlphaNum</span><span class="op" id="5212540">(</span><span class="ident" id="5212541">s</span><span class="op" id="5212542">[</span><span class="ident" id="5212543">j</span><span class="op" id="5212544">+</span><span class="num" id="5212545">1</span><span class="op" id="5212546">]</span><span class="op" id="5212547">)</span>&nbsp;<span class="op" id="5212549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5212554">j</span>&nbsp;<span class="op" id="5212556">+=</span>&nbsp;<span class="num" id="5212559">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212579">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212589">return</span>&nbsp;<span class="ident" id="5212596">j</span><span class="op" id="5212597">,</span>&nbsp;<span class="ident" id="5212599">elementNameMap</span><span class="op" id="5212613">[</span><span class="ident" id="5212614">strings</span><span class="op" id="5212621">.</span><span class="ident" id="5212622">ToLower</span><span class="op" id="5212629">(</span><span class="builtintype" id="5212630">string</span><span class="op" id="5212636">(</span><span class="ident" id="5212637">s</span><span class="op" id="5212638">[</span><span class="ident" id="5212639">i</span><span class="op" id="5212640">:</span><span class="ident" id="5212641">j</span><span class="op" id="5212642">]</span><span class="op" id="5212643">)</span><span class="op" id="5212644">)</span><span class="op" id="5212645">]</span><br>
<span class="lineno"></span><span class="op" id="5212647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5212650">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5212722">func</span>&nbsp;<span class="ident" id="5212727">eatWhiteSpace</span><span class="op" id="5212740">(</span><span class="ident" id="5212741">s</span>&nbsp;<span class="op" id="5212743">[</span><span class="op" id="5212744">]</span><span class="builtintype" id="5212745">byte</span><span class="op" id="5212749">,</span>&nbsp;<span class="ident" id="5212751">i</span>&nbsp;<span class="builtintype" id="5212753">int</span><span class="op" id="5212756">)</span>&nbsp;<span class="builtintype" id="5212758">int</span>&nbsp;<span class="op" id="5212762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212765">for</span>&nbsp;<span class="ident" id="5212769">j</span>&nbsp;<span class="op" id="5212771">:=</span>&nbsp;<span class="ident" id="5212774">i</span><span class="op" id="5212775">;</span>&nbsp;<span class="ident" id="5212777">j</span>&nbsp;<span class="op" id="5212779">&lt;</span>&nbsp;<span class="builtinfunc" id="5212781">len</span><span class="op" id="5212784">(</span><span class="ident" id="5212785">s</span><span class="op" id="5212786">)</span><span class="op" id="5212787">;</span>&nbsp;<span class="ident" id="5212789">j</span><span class="op" id="5212790">++</span>&nbsp;<span class="op" id="5212793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212797">switch</span>&nbsp;<span class="ident" id="5212804">s</span><span class="op" id="5212805">[</span><span class="ident" id="5212806">j</span><span class="op" id="5212807">]</span>&nbsp;<span class="op" id="5212809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212813">case</span>&nbsp;<span class="string" id="5212818">&#39;&nbsp;&#39;</span><span class="op" id="5212821">,</span>&nbsp;<span class="string" id="5212823">&#39;\t&#39;</span><span class="op" id="5212827">,</span>&nbsp;<span class="string" id="5212829">&#39;\n&#39;</span><span class="op" id="5212833">,</span>&nbsp;<span class="string" id="5212835">&#39;\f&#39;</span><span class="op" id="5212839">,</span>&nbsp;<span class="string" id="5212841">&#39;\r&#39;</span><span class="op" id="5212845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5212850">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212862">default</span><span class="op" id="5212869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212874">return</span>&nbsp;<span class="ident" id="5212881">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5212888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5212891">return</span>&nbsp;<span class="builtinfunc" id="5212898">len</span><span class="op" id="5212901">(</span><span class="ident" id="5212902">s</span><span class="op" id="5212903">)</span><br>
<span class="lineno">550</span><span class="op" id="5212905">}</span>
</div>
</body>
</html>
