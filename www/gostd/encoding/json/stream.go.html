<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3431654">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3431710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3431764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3431815">package</span>&nbsp;<span class="ident" id="3431823">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3431829">import</span>&nbsp;<span class="op" id="3431836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3431839">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3431848">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3431858">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3431863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3431866">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3431932">type</span>&nbsp;<span class="ident" id="3431937">Decoder</span>&nbsp;<span class="keyword" id="3431945">struct</span>&nbsp;<span class="op" id="3431952">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3431955">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3431960">io</span><span class="op" id="3431962">.</span><span class="ident" id="3431963">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3431971">buf</span>&nbsp;&nbsp;<span class="op" id="3431976">[</span><span class="op" id="3431977">]</span><span class="builtintype" id="3431978">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3431984">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3431989">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3432002">scan</span>&nbsp;<span class="ident" id="3432007">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3432016">err</span>&nbsp;&nbsp;<span class="builtintype" id="3432021">error</span><br>
<span class="lineno">20</span><span class="op" id="3432027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3432030">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3432085">//</span><br>
<span class="lineno"></span><span class="comment" id="3432088">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="3432140">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="3432194">func</span>&nbsp;<span class="ident" id="3432199">NewDecoder</span><span class="op" id="3432209">(</span><span class="ident" id="3432210">r</span>&nbsp;<span class="ident" id="3432212">io</span><span class="op" id="3432214">.</span><span class="ident" id="3432215">Reader</span><span class="op" id="3432221">)</span>&nbsp;<span class="op" id="3432223">*</span><span class="ident" id="3432224">Decoder</span>&nbsp;<span class="op" id="3432232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3432235">return</span>&nbsp;<span class="op" id="3432242">&amp;</span><span class="ident" id="3432243">Decoder</span><span class="op" id="3432250">{</span><span class="ident" id="3432251">r</span><span class="op" id="3432252">:</span>&nbsp;<span class="ident" id="3432254">r</span><span class="op" id="3432255">}</span><br>
<span class="lineno"></span><span class="op" id="3432257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3432260">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3432339">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="3432374">func</span>&nbsp;<span class="op" id="3432379">(</span><span class="ident" id="3432380">dec</span>&nbsp;<span class="op" id="3432384">*</span><span class="ident" id="3432385">Decoder</span><span class="op" id="3432392">)</span>&nbsp;<span class="ident" id="3432394">UseNumber</span><span class="op" id="3432403">(</span><span class="op" id="3432404">)</span>&nbsp;<span class="op" id="3432406">{</span>&nbsp;<span class="ident" id="3432408">dec</span><span class="op" id="3432411">.</span><span class="ident" id="3432412">d</span><span class="op" id="3432413">.</span><span class="ident" id="3432414">useNumber</span>&nbsp;<span class="op" id="3432424">=</span>&nbsp;<span class="builtintype" id="3432426">true</span>&nbsp;<span class="op" id="3432431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3432434">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="3432487">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="3432540">//</span><br>
<span class="lineno"></span><span class="comment" id="3432543">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="3432600">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3432643">func</span>&nbsp;<span class="op" id="3432648">(</span><span class="ident" id="3432649">dec</span>&nbsp;<span class="op" id="3432653">*</span><span class="ident" id="3432654">Decoder</span><span class="op" id="3432661">)</span>&nbsp;<span class="ident" id="3432663">Decode</span><span class="op" id="3432669">(</span><span class="ident" id="3432670">v</span>&nbsp;<span class="keyword" id="3432672">interface</span><span class="op" id="3432681">{</span><span class="op" id="3432682">}</span><span class="op" id="3432683">)</span>&nbsp;<span class="builtintype" id="3432685">error</span>&nbsp;<span class="op" id="3432691">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3432694">if</span>&nbsp;<span class="ident" id="3432697">dec</span><span class="op" id="3432700">.</span><span class="ident" id="3432701">err</span>&nbsp;<span class="op" id="3432705">!=</span>&nbsp;<span class="builtintype" id="3432708">nil</span>&nbsp;<span class="op" id="3432712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3432716">return</span>&nbsp;<span class="ident" id="3432723">dec</span><span class="op" id="3432726">.</span><span class="ident" id="3432727">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3432732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3432736">n</span><span class="op" id="3432737">,</span>&nbsp;<span class="ident" id="3432739">err</span>&nbsp;<span class="op" id="3432743">:=</span>&nbsp;<span class="ident" id="3432746">dec</span><span class="op" id="3432749">.</span><span class="ident" id="3432750">readValue</span><span class="op" id="3432759">(</span><span class="op" id="3432760">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3432763">if</span>&nbsp;<span class="ident" id="3432766">err</span>&nbsp;<span class="op" id="3432770">!=</span>&nbsp;<span class="builtintype" id="3432773">nil</span>&nbsp;<span class="op" id="3432777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3432781">return</span>&nbsp;<span class="ident" id="3432788">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3432793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3432797">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3432845">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3432910">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3432956">dec</span><span class="op" id="3432959">.</span><span class="ident" id="3432960">d</span><span class="op" id="3432961">.</span><span class="ident" id="3432962">init</span><span class="op" id="3432966">(</span><span class="ident" id="3432967">dec</span><span class="op" id="3432970">.</span><span class="ident" id="3432971">buf</span><span class="op" id="3432974">[</span><span class="num" id="3432975">0</span><span class="op" id="3432976">:</span><span class="ident" id="3432977">n</span><span class="op" id="3432978">]</span><span class="op" id="3432979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3432982">err</span>&nbsp;<span class="op" id="3432986">=</span>&nbsp;<span class="ident" id="3432988">dec</span><span class="op" id="3432991">.</span><span class="ident" id="3432992">d</span><span class="op" id="3432993">.</span><span class="ident" id="3432994">unmarshal</span><span class="op" id="3433003">(</span><span class="ident" id="3433004">v</span><span class="op" id="3433005">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3433009">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433038">rest</span>&nbsp;<span class="op" id="3433043">:=</span>&nbsp;<span class="builtinfunc" id="3433046">copy</span><span class="op" id="3433050">(</span><span class="ident" id="3433051">dec</span><span class="op" id="3433054">.</span><span class="ident" id="3433055">buf</span><span class="op" id="3433058">,</span>&nbsp;<span class="ident" id="3433060">dec</span><span class="op" id="3433063">.</span><span class="ident" id="3433064">buf</span><span class="op" id="3433067">[</span><span class="ident" id="3433068">n</span><span class="op" id="3433069">:</span><span class="op" id="3433070">]</span><span class="op" id="3433071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433074">dec</span><span class="op" id="3433077">.</span><span class="ident" id="3433078">buf</span>&nbsp;<span class="op" id="3433082">=</span>&nbsp;<span class="ident" id="3433084">dec</span><span class="op" id="3433087">.</span><span class="ident" id="3433088">buf</span><span class="op" id="3433091">[</span><span class="num" id="3433092">0</span><span class="op" id="3433093">:</span><span class="ident" id="3433094">rest</span><span class="op" id="3433098">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433102">return</span>&nbsp;<span class="ident" id="3433109">err</span><br>
<span class="lineno">60</span><span class="op" id="3433113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3433116">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3433184">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="3433246">func</span>&nbsp;<span class="op" id="3433251">(</span><span class="ident" id="3433252">dec</span>&nbsp;<span class="op" id="3433256">*</span><span class="ident" id="3433257">Decoder</span><span class="op" id="3433264">)</span>&nbsp;<span class="ident" id="3433266">Buffered</span><span class="op" id="3433274">(</span><span class="op" id="3433275">)</span>&nbsp;<span class="ident" id="3433277">io</span><span class="op" id="3433279">.</span><span class="ident" id="3433280">Reader</span>&nbsp;<span class="op" id="3433287">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433290">return</span>&nbsp;<span class="ident" id="3433297">bytes</span><span class="op" id="3433302">.</span><span class="ident" id="3433303">NewReader</span><span class="op" id="3433312">(</span><span class="ident" id="3433313">dec</span><span class="op" id="3433316">.</span><span class="ident" id="3433317">buf</span><span class="op" id="3433320">)</span><br>
<span class="lineno"></span><span class="op" id="3433322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3433325">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="3433371">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="3433413">func</span>&nbsp;<span class="op" id="3433418">(</span><span class="ident" id="3433419">dec</span>&nbsp;<span class="op" id="3433423">*</span><span class="ident" id="3433424">Decoder</span><span class="op" id="3433431">)</span>&nbsp;<span class="ident" id="3433433">readValue</span><span class="op" id="3433442">(</span><span class="op" id="3433443">)</span>&nbsp;<span class="op" id="3433445">(</span><span class="builtintype" id="3433446">int</span><span class="op" id="3433449">,</span>&nbsp;<span class="builtintype" id="3433451">error</span><span class="op" id="3433456">)</span>&nbsp;<span class="op" id="3433458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433461">dec</span><span class="op" id="3433464">.</span><span class="ident" id="3433465">scan</span><span class="op" id="3433469">.</span><span class="ident" id="3433470">reset</span><span class="op" id="3433475">(</span><span class="op" id="3433476">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433480">scanp</span>&nbsp;<span class="op" id="3433486">:=</span>&nbsp;<span class="num" id="3433489">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433492">var</span>&nbsp;<span class="ident" id="3433496">err</span>&nbsp;<span class="builtintype" id="3433500">error</span><br>
<span class="lineno">75</span><span class="ident" id="3433506">Input</span><span class="op" id="3433511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433514">for</span>&nbsp;<span class="op" id="3433518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3433522">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433563">for</span>&nbsp;<span class="ident" id="3433567">i</span><span class="op" id="3433568">,</span>&nbsp;<span class="ident" id="3433570">c</span>&nbsp;<span class="op" id="3433572">:=</span>&nbsp;<span class="keyword" id="3433575">range</span>&nbsp;<span class="ident" id="3433581">dec</span><span class="op" id="3433584">.</span><span class="ident" id="3433585">buf</span><span class="op" id="3433588">[</span><span class="ident" id="3433589">scanp</span><span class="op" id="3433594">:</span><span class="op" id="3433595">]</span>&nbsp;<span class="op" id="3433597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433602">dec</span><span class="op" id="3433605">.</span><span class="ident" id="3433606">scan</span><span class="op" id="3433610">.</span><span class="ident" id="3433611">bytes</span><span class="op" id="3433616">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433622">v</span>&nbsp;<span class="op" id="3433624">:=</span>&nbsp;<span class="ident" id="3433627">dec</span><span class="op" id="3433630">.</span><span class="ident" id="3433631">scan</span><span class="op" id="3433635">.</span><span class="ident" id="3433636">step</span><span class="op" id="3433640">(</span><span class="op" id="3433641">&amp;</span><span class="ident" id="3433642">dec</span><span class="op" id="3433645">.</span><span class="ident" id="3433646">scan</span><span class="op" id="3433650">,</span>&nbsp;<span class="builtintype" id="3433652">int</span><span class="op" id="3433655">(</span><span class="ident" id="3433656">c</span><span class="op" id="3433657">)</span><span class="op" id="3433658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433663">if</span>&nbsp;<span class="ident" id="3433666">v</span>&nbsp;<span class="op" id="3433668">==</span>&nbsp;<span class="ident" id="3433671">scanEnd</span>&nbsp;<span class="op" id="3433679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433685">scanp</span>&nbsp;<span class="op" id="3433691">+=</span>&nbsp;<span class="ident" id="3433694">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433700">break</span>&nbsp;<span class="ident" id="3433706">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3433715">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3433720">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3433755">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3433810">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433848">if</span>&nbsp;<span class="op" id="3433851">(</span><span class="ident" id="3433852">v</span>&nbsp;<span class="op" id="3433854">==</span>&nbsp;<span class="ident" id="3433857">scanEndObject</span>&nbsp;<span class="op" id="3433871">||</span>&nbsp;<span class="ident" id="3433874">v</span>&nbsp;<span class="op" id="3433876">==</span>&nbsp;<span class="ident" id="3433879">scanEndArray</span><span class="op" id="3433891">)</span>&nbsp;<span class="op" id="3433893">&amp;&amp;</span>&nbsp;<span class="ident" id="3433896">dec</span><span class="op" id="3433899">.</span><span class="ident" id="3433900">scan</span><span class="op" id="3433904">.</span><span class="ident" id="3433905">step</span><span class="op" id="3433909">(</span><span class="op" id="3433910">&amp;</span><span class="ident" id="3433911">dec</span><span class="op" id="3433914">.</span><span class="ident" id="3433915">scan</span><span class="op" id="3433919">,</span>&nbsp;<span class="string" id="3433921">&#39;&nbsp;&#39;</span><span class="op" id="3433924">)</span>&nbsp;<span class="op" id="3433926">==</span>&nbsp;<span class="ident" id="3433929">scanEnd</span>&nbsp;<span class="op" id="3433937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3433943">scanp</span>&nbsp;<span class="op" id="3433949">+=</span>&nbsp;<span class="ident" id="3433952">i</span>&nbsp;<span class="op" id="3433954">+</span>&nbsp;<span class="num" id="3433956">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433962">break</span>&nbsp;<span class="ident" id="3433968">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3433977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3433982">if</span>&nbsp;<span class="ident" id="3433985">v</span>&nbsp;<span class="op" id="3433987">==</span>&nbsp;<span class="ident" id="3433990">scanError</span>&nbsp;<span class="op" id="3434000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434006">dec</span><span class="op" id="3434009">.</span><span class="ident" id="3434010">err</span>&nbsp;<span class="op" id="3434014">=</span>&nbsp;<span class="ident" id="3434016">dec</span><span class="op" id="3434019">.</span><span class="ident" id="3434020">scan</span><span class="op" id="3434024">.</span><span class="ident" id="3434025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434033">return</span>&nbsp;<span class="num" id="3434040">0</span><span class="op" id="3434041">,</span>&nbsp;<span class="ident" id="3434043">dec</span><span class="op" id="3434046">.</span><span class="ident" id="3434047">scan</span><span class="op" id="3434051">.</span><span class="ident" id="3434052">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434067">scanp</span>&nbsp;<span class="op" id="3434073">=</span>&nbsp;<span class="builtinfunc" id="3434075">len</span><span class="op" id="3434078">(</span><span class="ident" id="3434079">dec</span><span class="op" id="3434082">.</span><span class="ident" id="3434083">buf</span><span class="op" id="3434086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3434091">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3434129">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434174">if</span>&nbsp;<span class="ident" id="3434177">err</span>&nbsp;<span class="op" id="3434181">!=</span>&nbsp;<span class="builtintype" id="3434184">nil</span>&nbsp;<span class="op" id="3434188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434193">if</span>&nbsp;<span class="ident" id="3434196">err</span>&nbsp;<span class="op" id="3434200">==</span>&nbsp;<span class="ident" id="3434203">io</span><span class="op" id="3434205">.</span><span class="ident" id="3434206">EOF</span>&nbsp;<span class="op" id="3434210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434216">if</span>&nbsp;<span class="ident" id="3434219">dec</span><span class="op" id="3434222">.</span><span class="ident" id="3434223">scan</span><span class="op" id="3434227">.</span><span class="ident" id="3434228">step</span><span class="op" id="3434232">(</span><span class="op" id="3434233">&amp;</span><span class="ident" id="3434234">dec</span><span class="op" id="3434237">.</span><span class="ident" id="3434238">scan</span><span class="op" id="3434242">,</span>&nbsp;<span class="string" id="3434244">&#39;&nbsp;&#39;</span><span class="op" id="3434247">)</span>&nbsp;<span class="op" id="3434249">==</span>&nbsp;<span class="ident" id="3434252">scanEnd</span>&nbsp;<span class="op" id="3434260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434267">break</span>&nbsp;<span class="ident" id="3434273">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434289">if</span>&nbsp;<span class="ident" id="3434292">nonSpace</span><span class="op" id="3434300">(</span><span class="ident" id="3434301">dec</span><span class="op" id="3434304">.</span><span class="ident" id="3434305">buf</span><span class="op" id="3434308">)</span>&nbsp;<span class="op" id="3434310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434317">err</span>&nbsp;<span class="op" id="3434321">=</span>&nbsp;<span class="ident" id="3434323">io</span><span class="op" id="3434325">.</span><span class="ident" id="3434326">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434352">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434357">dec</span><span class="op" id="3434360">.</span><span class="ident" id="3434361">err</span>&nbsp;<span class="op" id="3434365">=</span>&nbsp;<span class="ident" id="3434367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434374">return</span>&nbsp;<span class="num" id="3434381">0</span><span class="op" id="3434382">,</span>&nbsp;<span class="ident" id="3434384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3434395">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434440">const</span>&nbsp;<span class="ident" id="3434446">minRead</span>&nbsp;<span class="op" id="3434454">=</span>&nbsp;<span class="num" id="3434456">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434462">if</span>&nbsp;<span class="builtinfunc" id="3434465">cap</span><span class="op" id="3434468">(</span><span class="ident" id="3434469">dec</span><span class="op" id="3434472">.</span><span class="ident" id="3434473">buf</span><span class="op" id="3434476">)</span><span class="op" id="3434477">-</span><span class="builtinfunc" id="3434478">len</span><span class="op" id="3434481">(</span><span class="ident" id="3434482">dec</span><span class="op" id="3434485">.</span><span class="ident" id="3434486">buf</span><span class="op" id="3434489">)</span>&nbsp;<span class="op" id="3434491">&lt;</span>&nbsp;<span class="ident" id="3434493">minRead</span>&nbsp;<span class="op" id="3434501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434506">newBuf</span>&nbsp;<span class="op" id="3434513">:=</span>&nbsp;<span class="builtinfunc" id="3434516">make</span><span class="op" id="3434520">(</span><span class="op" id="3434521">[</span><span class="op" id="3434522">]</span><span class="builtintype" id="3434523">byte</span><span class="op" id="3434527">,</span>&nbsp;<span class="builtinfunc" id="3434529">len</span><span class="op" id="3434532">(</span><span class="ident" id="3434533">dec</span><span class="op" id="3434536">.</span><span class="ident" id="3434537">buf</span><span class="op" id="3434540">)</span><span class="op" id="3434541">,</span>&nbsp;<span class="num" id="3434543">2</span><span class="op" id="3434544">*</span><span class="builtinfunc" id="3434545">cap</span><span class="op" id="3434548">(</span><span class="ident" id="3434549">dec</span><span class="op" id="3434552">.</span><span class="ident" id="3434553">buf</span><span class="op" id="3434556">)</span><span class="op" id="3434557">+</span><span class="ident" id="3434558">minRead</span><span class="op" id="3434565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3434570">copy</span><span class="op" id="3434574">(</span><span class="ident" id="3434575">newBuf</span><span class="op" id="3434581">,</span>&nbsp;<span class="ident" id="3434583">dec</span><span class="op" id="3434586">.</span><span class="ident" id="3434587">buf</span><span class="op" id="3434590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434595">dec</span><span class="op" id="3434598">.</span><span class="ident" id="3434599">buf</span>&nbsp;<span class="op" id="3434603">=</span>&nbsp;<span class="ident" id="3434605">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3434619">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434676">var</span>&nbsp;<span class="ident" id="3434680">n</span>&nbsp;<span class="builtintype" id="3434682">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434688">n</span><span class="op" id="3434689">,</span>&nbsp;<span class="ident" id="3434691">err</span>&nbsp;<span class="op" id="3434695">=</span>&nbsp;<span class="ident" id="3434697">dec</span><span class="op" id="3434700">.</span><span class="ident" id="3434701">r</span><span class="op" id="3434702">.</span><span class="ident" id="3434703">Read</span><span class="op" id="3434707">(</span><span class="ident" id="3434708">dec</span><span class="op" id="3434711">.</span><span class="ident" id="3434712">buf</span><span class="op" id="3434715">[</span><span class="builtinfunc" id="3434716">len</span><span class="op" id="3434719">(</span><span class="ident" id="3434720">dec</span><span class="op" id="3434723">.</span><span class="ident" id="3434724">buf</span><span class="op" id="3434727">)</span><span class="op" id="3434728">:</span><span class="builtinfunc" id="3434729">cap</span><span class="op" id="3434732">(</span><span class="ident" id="3434733">dec</span><span class="op" id="3434736">.</span><span class="ident" id="3434737">buf</span><span class="op" id="3434740">)</span><span class="op" id="3434741">]</span><span class="op" id="3434742">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3434746">dec</span><span class="op" id="3434749">.</span><span class="ident" id="3434750">buf</span>&nbsp;<span class="op" id="3434754">=</span>&nbsp;<span class="ident" id="3434756">dec</span><span class="op" id="3434759">.</span><span class="ident" id="3434760">buf</span><span class="op" id="3434763">[</span><span class="num" id="3434764">0</span>&nbsp;<span class="op" id="3434766">:</span>&nbsp;<span class="builtinfunc" id="3434768">len</span><span class="op" id="3434771">(</span><span class="ident" id="3434772">dec</span><span class="op" id="3434775">.</span><span class="ident" id="3434776">buf</span><span class="op" id="3434779">)</span><span class="op" id="3434780">+</span><span class="ident" id="3434781">n</span><span class="op" id="3434782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434788">return</span>&nbsp;<span class="ident" id="3434795">scanp</span><span class="op" id="3434800">,</span>&nbsp;<span class="builtintype" id="3434802">nil</span><br>
<span class="lineno"></span><span class="op" id="3434806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="3434809">func</span>&nbsp;<span class="ident" id="3434814">nonSpace</span><span class="op" id="3434822">(</span><span class="ident" id="3434823">b</span>&nbsp;<span class="op" id="3434825">[</span><span class="op" id="3434826">]</span><span class="builtintype" id="3434827">byte</span><span class="op" id="3434831">)</span>&nbsp;<span class="builtintype" id="3434833">bool</span>&nbsp;<span class="op" id="3434838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434841">for</span>&nbsp;<span class="ident" id="3434845">_</span><span class="op" id="3434846">,</span>&nbsp;<span class="ident" id="3434848">c</span>&nbsp;<span class="op" id="3434850">:=</span>&nbsp;<span class="keyword" id="3434853">range</span>&nbsp;<span class="ident" id="3434859">b</span>&nbsp;<span class="op" id="3434861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434865">if</span>&nbsp;<span class="op" id="3434868">!</span><span class="ident" id="3434869">isSpace</span><span class="op" id="3434876">(</span><span class="builtintype" id="3434877">rune</span><span class="op" id="3434881">(</span><span class="ident" id="3434882">c</span><span class="op" id="3434883">)</span><span class="op" id="3434884">)</span>&nbsp;<span class="op" id="3434886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434891">return</span>&nbsp;<span class="builtintype" id="3434898">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434905">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3434908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3434911">return</span>&nbsp;<span class="builtintype" id="3434918">false</span><br>
<span class="lineno"></span><span class="op" id="3434924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3434927">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="3434982">type</span>&nbsp;<span class="ident" id="3434987">Encoder</span>&nbsp;<span class="keyword" id="3434995">struct</span>&nbsp;<span class="op" id="3435002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435005">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3435009">io</span><span class="op" id="3435011">.</span><span class="ident" id="3435012">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435020">err</span>&nbsp;<span class="builtintype" id="3435024">error</span><br>
<span class="lineno"></span><span class="op" id="3435030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="3435033">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3435087">func</span>&nbsp;<span class="ident" id="3435092">NewEncoder</span><span class="op" id="3435102">(</span><span class="ident" id="3435103">w</span>&nbsp;<span class="ident" id="3435105">io</span><span class="op" id="3435107">.</span><span class="ident" id="3435108">Writer</span><span class="op" id="3435114">)</span>&nbsp;<span class="op" id="3435116">*</span><span class="ident" id="3435117">Encoder</span>&nbsp;<span class="op" id="3435125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435128">return</span>&nbsp;<span class="op" id="3435135">&amp;</span><span class="ident" id="3435136">Encoder</span><span class="op" id="3435143">{</span><span class="ident" id="3435144">w</span><span class="op" id="3435145">:</span>&nbsp;<span class="ident" id="3435147">w</span><span class="op" id="3435148">}</span><br>
<span class="lineno"></span><span class="op" id="3435150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="3435153">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="3435208">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3435244">//</span><br>
<span class="lineno"></span><span class="comment" id="3435247">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3435306">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="3435342">func</span>&nbsp;<span class="op" id="3435347">(</span><span class="ident" id="3435348">enc</span>&nbsp;<span class="op" id="3435352">*</span><span class="ident" id="3435353">Encoder</span><span class="op" id="3435360">)</span>&nbsp;<span class="ident" id="3435362">Encode</span><span class="op" id="3435368">(</span><span class="ident" id="3435369">v</span>&nbsp;<span class="keyword" id="3435371">interface</span><span class="op" id="3435380">{</span><span class="op" id="3435381">}</span><span class="op" id="3435382">)</span>&nbsp;<span class="builtintype" id="3435384">error</span>&nbsp;<span class="op" id="3435390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435393">if</span>&nbsp;<span class="ident" id="3435396">enc</span><span class="op" id="3435399">.</span><span class="ident" id="3435400">err</span>&nbsp;<span class="op" id="3435404">!=</span>&nbsp;<span class="builtintype" id="3435407">nil</span>&nbsp;<span class="op" id="3435411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435415">return</span>&nbsp;<span class="ident" id="3435422">enc</span><span class="op" id="3435425">.</span><span class="ident" id="3435426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3435431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435434">e</span>&nbsp;<span class="op" id="3435436">:=</span>&nbsp;<span class="ident" id="3435439">newEncodeState</span><span class="op" id="3435453">(</span><span class="op" id="3435454">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435457">err</span>&nbsp;<span class="op" id="3435461">:=</span>&nbsp;<span class="ident" id="3435464">e</span><span class="op" id="3435465">.</span><span class="ident" id="3435466">marshal</span><span class="op" id="3435473">(</span><span class="ident" id="3435474">v</span><span class="op" id="3435475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435478">if</span>&nbsp;<span class="ident" id="3435481">err</span>&nbsp;<span class="op" id="3435485">!=</span>&nbsp;<span class="builtintype" id="3435488">nil</span>&nbsp;<span class="op" id="3435492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435496">return</span>&nbsp;<span class="ident" id="3435503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3435508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435512">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435553">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435599">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435642">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435693">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3435740">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435759">e</span><span class="op" id="3435760">.</span><span class="ident" id="3435761">WriteByte</span><span class="op" id="3435770">(</span><span class="string" id="3435771">&#39;\n&#39;</span><span class="op" id="3435775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435779">if</span>&nbsp;<span class="ident" id="3435782">_</span><span class="op" id="3435783">,</span>&nbsp;<span class="ident" id="3435785">err</span>&nbsp;<span class="op" id="3435789">=</span>&nbsp;<span class="ident" id="3435791">enc</span><span class="op" id="3435794">.</span><span class="ident" id="3435795">w</span><span class="op" id="3435796">.</span><span class="ident" id="3435797">Write</span><span class="op" id="3435802">(</span><span class="ident" id="3435803">e</span><span class="op" id="3435804">.</span><span class="ident" id="3435805">Bytes</span><span class="op" id="3435810">(</span><span class="op" id="3435811">)</span><span class="op" id="3435812">)</span><span class="op" id="3435813">;</span>&nbsp;<span class="ident" id="3435815">err</span>&nbsp;<span class="op" id="3435819">!=</span>&nbsp;<span class="builtintype" id="3435822">nil</span>&nbsp;<span class="op" id="3435826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435830">enc</span><span class="op" id="3435833">.</span><span class="ident" id="3435834">err</span>&nbsp;<span class="op" id="3435838">=</span>&nbsp;<span class="ident" id="3435840">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3435845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3435848">encodeStatePool</span><span class="op" id="3435863">.</span><span class="ident" id="3435864">Put</span><span class="op" id="3435867">(</span><span class="ident" id="3435868">e</span><span class="op" id="3435869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3435872">return</span>&nbsp;<span class="ident" id="3435879">err</span><br>
<span class="lineno"></span><span class="op" id="3435883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3435886">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3435930">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3435981">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3436046">type</span>&nbsp;<span class="ident" id="3436051">RawMessage</span>&nbsp;<span class="op" id="3436062">[</span><span class="op" id="3436063">]</span><span class="builtintype" id="3436064">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3436070">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="3436123">func</span>&nbsp;<span class="op" id="3436128">(</span><span class="ident" id="3436129">m</span>&nbsp;<span class="op" id="3436131">*</span><span class="ident" id="3436132">RawMessage</span><span class="op" id="3436142">)</span>&nbsp;<span class="ident" id="3436144">MarshalJSON</span><span class="op" id="3436155">(</span><span class="op" id="3436156">)</span>&nbsp;<span class="op" id="3436158">(</span><span class="op" id="3436159">[</span><span class="op" id="3436160">]</span><span class="builtintype" id="3436161">byte</span><span class="op" id="3436165">,</span>&nbsp;<span class="builtintype" id="3436167">error</span><span class="op" id="3436172">)</span>&nbsp;<span class="op" id="3436174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3436177">return</span>&nbsp;<span class="op" id="3436184">*</span><span class="ident" id="3436185">m</span><span class="op" id="3436186">,</span>&nbsp;<span class="builtintype" id="3436188">nil</span><br>
<span class="lineno"></span><span class="op" id="3436192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3436195">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3436239">func</span>&nbsp;<span class="op" id="3436244">(</span><span class="ident" id="3436245">m</span>&nbsp;<span class="op" id="3436247">*</span><span class="ident" id="3436248">RawMessage</span><span class="op" id="3436258">)</span>&nbsp;<span class="ident" id="3436260">UnmarshalJSON</span><span class="op" id="3436273">(</span><span class="ident" id="3436274">data</span>&nbsp;<span class="op" id="3436279">[</span><span class="op" id="3436280">]</span><span class="builtintype" id="3436281">byte</span><span class="op" id="3436285">)</span>&nbsp;<span class="builtintype" id="3436287">error</span>&nbsp;<span class="op" id="3436293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3436296">if</span>&nbsp;<span class="ident" id="3436299">m</span>&nbsp;<span class="op" id="3436301">==</span>&nbsp;<span class="builtintype" id="3436304">nil</span>&nbsp;<span class="op" id="3436308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3436312">return</span>&nbsp;<span class="ident" id="3436319">errors</span><span class="op" id="3436325">.</span><span class="ident" id="3436326">New</span><span class="op" id="3436329">(</span><span class="string" id="3436330">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="3436377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3436380">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3436383">*</span><span class="ident" id="3436384">m</span>&nbsp;<span class="op" id="3436386">=</span>&nbsp;<span class="builtinfunc" id="3436388">append</span><span class="op" id="3436394">(</span><span class="op" id="3436395">(</span><span class="op" id="3436396">*</span><span class="ident" id="3436397">m</span><span class="op" id="3436398">)</span><span class="op" id="3436399">[</span><span class="num" id="3436400">0</span><span class="op" id="3436401">:</span><span class="num" id="3436402">0</span><span class="op" id="3436403">]</span><span class="op" id="3436404">,</span>&nbsp;<span class="ident" id="3436406">data</span><span class="op" id="3436410">...</span><span class="op" id="3436413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3436416">return</span>&nbsp;<span class="builtintype" id="3436423">nil</span><br>
<span class="lineno"></span><span class="op" id="3436427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3436430">var</span>&nbsp;<span class="ident" id="3436434">_</span>&nbsp;<span class="ident" id="3436436">Marshaler</span>&nbsp;<span class="op" id="3436446">=</span>&nbsp;<span class="op" id="3436448">(</span><span class="op" id="3436449">*</span><span class="ident" id="3436450">RawMessage</span><span class="op" id="3436460">)</span><span class="op" id="3436461">(</span><span class="builtintype" id="3436462">nil</span><span class="op" id="3436465">)</span><br>
<span class="lineno">200</span><span class="keyword" id="3436467">var</span>&nbsp;<span class="ident" id="3436471">_</span>&nbsp;<span class="ident" id="3436473">Unmarshaler</span>&nbsp;<span class="op" id="3436485">=</span>&nbsp;<span class="op" id="3436487">(</span><span class="op" id="3436488">*</span><span class="ident" id="3436489">RawMessage</span><span class="op" id="3436499">)</span><span class="op" id="3436500">(</span><span class="builtintype" id="3436501">nil</span><span class="op" id="3436504">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
