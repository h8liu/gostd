<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html" class="current">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3236195">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3236251">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3236305">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3236356">package</span>&nbsp;<span class="ident" id="3236364">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3236369">import</span>&nbsp;<span class="op" id="3236376">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236379">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236385">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3236391">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3236401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3236404">//&nbsp;maxSendfileSize&nbsp;is&nbsp;the&nbsp;largest&nbsp;chunk&nbsp;size&nbsp;we&nbsp;ask&nbsp;the&nbsp;kernel&nbsp;to&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="3236475">//&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">15</span><span class="keyword" id="3236489">const</span>&nbsp;<span class="ident" id="3236495">maxSendfileSize</span>&nbsp;<span class="builtintype" id="3236511">int</span>&nbsp;<span class="op" id="3236515">=</span>&nbsp;<span class="num" id="3236517">4</span>&nbsp;<span class="op" id="3236519">&lt;&lt;</span>&nbsp;<span class="num" id="3236522">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3236526">//&nbsp;sendFile&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;r&nbsp;to&nbsp;c&nbsp;using&nbsp;the&nbsp;sendfile</span><br>
<span class="lineno"></span><span class="comment" id="3236587">//&nbsp;system&nbsp;call&nbsp;to&nbsp;minimize&nbsp;copies.</span><br>
<span class="lineno"></span><span class="comment" id="3236622">//</span><br>
<span class="lineno">20</span><span class="comment" id="3236625">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;true,&nbsp;sendFile&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;and&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3236700">//&nbsp;non-EOF&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3236718">//</span><br>
<span class="lineno"></span><span class="comment" id="3236721">//&nbsp;if&nbsp;handled&nbsp;==&nbsp;false,&nbsp;sendFile&nbsp;performed&nbsp;no&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="3236773">func</span>&nbsp;<span class="ident" id="3236778">sendFile</span><span class="op" id="3236786">(</span><span class="ident" id="3236787">c</span>&nbsp;<span class="op" id="3236789">*</span><span class="ident" id="3236790">netFD</span><span class="op" id="3236795">,</span>&nbsp;<span class="ident" id="3236797">r</span>&nbsp;<span class="ident" id="3236799">io</span><span class="op" id="3236801">.</span><span class="ident" id="3236802">Reader</span><span class="op" id="3236808">)</span>&nbsp;<span class="op" id="3236810">(</span><span class="ident" id="3236811">written</span>&nbsp;<span class="ident" id="3236819">int64</span><span class="op" id="3236824">,</span>&nbsp;<span class="ident" id="3236826">err</span>&nbsp;<span class="builtintype" id="3236830">error</span><span class="op" id="3236835">,</span>&nbsp;<span class="ident" id="3236837">handled</span>&nbsp;<span class="builtintype" id="3236845">bool</span><span class="op" id="3236849">)</span>&nbsp;<span class="op" id="3236851">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236854">var</span>&nbsp;<span class="ident" id="3236858">remain</span>&nbsp;<span class="ident" id="3236865">int64</span>&nbsp;<span class="op" id="3236871">=</span>&nbsp;<span class="num" id="3236873">1</span>&nbsp;<span class="op" id="3236875">&lt;&lt;</span>&nbsp;<span class="num" id="3236878">62</span>&nbsp;<span class="comment" id="3236881">//&nbsp;by&nbsp;default,&nbsp;copy&nbsp;until&nbsp;EOF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236913">lr</span><span class="op" id="3236915">,</span>&nbsp;<span class="ident" id="3236917">ok</span>&nbsp;<span class="op" id="3236920">:=</span>&nbsp;<span class="ident" id="3236923">r</span><span class="op" id="3236924">.</span><span class="op" id="3236925">(</span><span class="op" id="3236926">*</span><span class="ident" id="3236927">io</span><span class="op" id="3236929">.</span><span class="ident" id="3236930">LimitedReader</span><span class="op" id="3236943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236946">if</span>&nbsp;<span class="ident" id="3236949">ok</span>&nbsp;<span class="op" id="3236952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3236956">remain</span><span class="op" id="3236962">,</span>&nbsp;<span class="ident" id="3236964">r</span>&nbsp;<span class="op" id="3236966">=</span>&nbsp;<span class="ident" id="3236968">lr</span><span class="op" id="3236970">.</span><span class="ident" id="3236971">N</span><span class="op" id="3236972">,</span>&nbsp;<span class="ident" id="3236974">lr</span><span class="op" id="3236976">.</span><span class="ident" id="3236977">R</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3236981">if</span>&nbsp;<span class="ident" id="3236984">remain</span>&nbsp;<span class="op" id="3236991">&lt;=</span>&nbsp;<span class="num" id="3236994">0</span>&nbsp;<span class="op" id="3236996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237001">return</span>&nbsp;<span class="num" id="3237008">0</span><span class="op" id="3237009">,</span>&nbsp;<span class="ident" id="3237011">nil</span><span class="op" id="3237014">,</span>&nbsp;<span class="builtintype" id="3237016">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237029">f</span><span class="op" id="3237030">,</span>&nbsp;<span class="ident" id="3237032">ok</span>&nbsp;<span class="op" id="3237035">:=</span>&nbsp;<span class="ident" id="3237038">r</span><span class="op" id="3237039">.</span><span class="op" id="3237040">(</span><span class="op" id="3237041">*</span><span class="ident" id="3237042">os</span><span class="op" id="3237044">.</span><span class="ident" id="3237045">File</span><span class="op" id="3237049">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237052">if</span>&nbsp;<span class="op" id="3237055">!</span><span class="ident" id="3237056">ok</span>&nbsp;<span class="op" id="3237059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237063">return</span>&nbsp;<span class="num" id="3237070">0</span><span class="op" id="3237071">,</span>&nbsp;<span class="ident" id="3237073">nil</span><span class="op" id="3237076">,</span>&nbsp;<span class="builtintype" id="3237078">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237089">if</span>&nbsp;<span class="ident" id="3237092">err</span>&nbsp;<span class="op" id="3237096">:=</span>&nbsp;<span class="ident" id="3237099">c</span><span class="op" id="3237100">.</span><span class="ident" id="3237101">writeLock</span><span class="op" id="3237110">(</span><span class="op" id="3237111">)</span><span class="op" id="3237112">;</span>&nbsp;<span class="ident" id="3237114">err</span>&nbsp;<span class="op" id="3237118">!=</span>&nbsp;<span class="ident" id="3237121">nil</span>&nbsp;<span class="op" id="3237125">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237129">return</span>&nbsp;<span class="num" id="3237136">0</span><span class="op" id="3237137">,</span>&nbsp;<span class="ident" id="3237139">err</span><span class="op" id="3237142">,</span>&nbsp;<span class="builtintype" id="3237144">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237153">defer</span>&nbsp;<span class="ident" id="3237159">c</span><span class="op" id="3237160">.</span><span class="ident" id="3237161">writeUnlock</span><span class="op" id="3237172">(</span><span class="op" id="3237173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237177">dst</span>&nbsp;<span class="op" id="3237181">:=</span>&nbsp;<span class="ident" id="3237184">c</span><span class="op" id="3237185">.</span><span class="ident" id="3237186">sysfd</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237193">src</span>&nbsp;<span class="op" id="3237197">:=</span>&nbsp;<span class="builtintype" id="3237200">int</span><span class="op" id="3237203">(</span><span class="ident" id="3237204">f</span><span class="op" id="3237205">.</span><span class="ident" id="3237206">Fd</span><span class="op" id="3237208">(</span><span class="op" id="3237209">)</span><span class="op" id="3237210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237213">for</span>&nbsp;<span class="ident" id="3237217">remain</span>&nbsp;<span class="op" id="3237224">&gt;</span>&nbsp;<span class="num" id="3237226">0</span>&nbsp;<span class="op" id="3237228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237232">n</span>&nbsp;<span class="op" id="3237234">:=</span>&nbsp;<span class="ident" id="3237237">maxSendfileSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237255">if</span>&nbsp;<span class="ident" id="3237258">int64</span><span class="op" id="3237263">(</span><span class="ident" id="3237264">n</span><span class="op" id="3237265">)</span>&nbsp;<span class="op" id="3237267">&gt;</span>&nbsp;<span class="ident" id="3237269">remain</span>&nbsp;<span class="op" id="3237276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237281">n</span>&nbsp;<span class="op" id="3237283">=</span>&nbsp;<span class="builtintype" id="3237285">int</span><span class="op" id="3237288">(</span><span class="ident" id="3237289">remain</span><span class="op" id="3237295">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237303">n</span><span class="op" id="3237304">,</span>&nbsp;<span class="ident" id="3237306">err1</span>&nbsp;<span class="op" id="3237311">:=</span>&nbsp;<span class="ident" id="3237314">syscall</span><span class="op" id="3237321">.</span><span class="ident" id="3237322">Sendfile</span><span class="op" id="3237330">(</span><span class="ident" id="3237331">dst</span><span class="op" id="3237334">,</span>&nbsp;<span class="ident" id="3237336">src</span><span class="op" id="3237339">,</span>&nbsp;<span class="ident" id="3237341">nil</span><span class="op" id="3237344">,</span>&nbsp;<span class="ident" id="3237346">n</span><span class="op" id="3237347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237351">if</span>&nbsp;<span class="ident" id="3237354">n</span>&nbsp;<span class="op" id="3237356">&gt;</span>&nbsp;<span class="num" id="3237358">0</span>&nbsp;<span class="op" id="3237360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237365">written</span>&nbsp;<span class="op" id="3237373">+=</span>&nbsp;<span class="ident" id="3237376">int64</span><span class="op" id="3237381">(</span><span class="ident" id="3237382">n</span><span class="op" id="3237383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237388">remain</span>&nbsp;<span class="op" id="3237395">-=</span>&nbsp;<span class="ident" id="3237398">int64</span><span class="op" id="3237403">(</span><span class="ident" id="3237404">n</span><span class="op" id="3237405">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237413">if</span>&nbsp;<span class="ident" id="3237416">n</span>&nbsp;<span class="op" id="3237418">==</span>&nbsp;<span class="num" id="3237421">0</span>&nbsp;<span class="op" id="3237423">&amp;&amp;</span>&nbsp;<span class="ident" id="3237426">err1</span>&nbsp;<span class="op" id="3237431">==</span>&nbsp;<span class="ident" id="3237434">nil</span>&nbsp;<span class="op" id="3237438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237443">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237455">if</span>&nbsp;<span class="ident" id="3237458">err1</span>&nbsp;<span class="op" id="3237463">==</span>&nbsp;<span class="ident" id="3237466">syscall</span><span class="op" id="3237473">.</span><span class="ident" id="3237474">EAGAIN</span>&nbsp;<span class="op" id="3237481">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237486">if</span>&nbsp;<span class="ident" id="3237489">err1</span>&nbsp;<span class="op" id="3237494">=</span>&nbsp;<span class="ident" id="3237496">c</span><span class="op" id="3237497">.</span><span class="ident" id="3237498">pd</span><span class="op" id="3237500">.</span><span class="ident" id="3237501">WaitWrite</span><span class="op" id="3237510">(</span><span class="op" id="3237511">)</span><span class="op" id="3237512">;</span>&nbsp;<span class="ident" id="3237514">err1</span>&nbsp;<span class="op" id="3237519">==</span>&nbsp;<span class="ident" id="3237522">nil</span>&nbsp;<span class="op" id="3237526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237532">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237552">if</span>&nbsp;<span class="ident" id="3237555">err1</span>&nbsp;<span class="op" id="3237560">!=</span>&nbsp;<span class="ident" id="3237563">nil</span>&nbsp;<span class="op" id="3237567">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237572">//&nbsp;This&nbsp;includes&nbsp;syscall.ENOSYS&nbsp;(no&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237618">//&nbsp;support)&nbsp;and&nbsp;syscall.EINVAL&nbsp;(fd&nbsp;types&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3237668">//&nbsp;don&#39;t&nbsp;implement&nbsp;sendfile&nbsp;together)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237709">err</span>&nbsp;<span class="op" id="3237713">=</span>&nbsp;<span class="op" id="3237715">&amp;</span><span class="ident" id="3237716">OpError</span><span class="op" id="3237723">{</span><span class="string" id="3237724">&#34;sendfile&#34;</span><span class="op" id="3237734">,</span>&nbsp;<span class="ident" id="3237736">c</span><span class="op" id="3237737">.</span><span class="ident" id="3237738">net</span><span class="op" id="3237741">,</span>&nbsp;<span class="ident" id="3237743">c</span><span class="op" id="3237744">.</span><span class="ident" id="3237745">raddr</span><span class="op" id="3237750">,</span>&nbsp;<span class="ident" id="3237752">err1</span><span class="op" id="3237756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237761">break</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237775">if</span>&nbsp;<span class="ident" id="3237778">lr</span>&nbsp;<span class="op" id="3237781">!=</span>&nbsp;<span class="ident" id="3237784">nil</span>&nbsp;<span class="op" id="3237788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3237792">lr</span><span class="op" id="3237794">.</span><span class="ident" id="3237795">N</span>&nbsp;<span class="op" id="3237797">=</span>&nbsp;<span class="ident" id="3237799">remain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3237807">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3237810">return</span>&nbsp;<span class="ident" id="3237817">written</span><span class="op" id="3237824">,</span>&nbsp;<span class="ident" id="3237826">err</span><span class="op" id="3237829">,</span>&nbsp;<span class="ident" id="3237831">written</span>&nbsp;<span class="op" id="3237839">&gt;</span>&nbsp;<span class="num" id="3237841">0</span><br>
<span class="lineno"></span><span class="op" id="3237843">}</span>
</div>
</body>
</html>
