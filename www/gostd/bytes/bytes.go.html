<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html" class="current">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1565931">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1565986">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1566040">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1566091">//&nbsp;Package&nbsp;bytes&nbsp;implements&nbsp;functions&nbsp;for&nbsp;the&nbsp;manipulation&nbsp;of&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="comment" id="1566166">//&nbsp;It&nbsp;is&nbsp;analogous&nbsp;to&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;strings&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="1566227">package</span>&nbsp;<span class="ident" id="1566235">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1566242">import</span>&nbsp;<span class="op" id="1566249">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1566252">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1566263">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1566278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1566281">func</span>&nbsp;<span class="ident" id="1566286">equalPortable</span><span class="op" id="1566299">(</span><span class="ident" id="1566300">a</span><span class="op" id="1566301">,</span>&nbsp;<span class="ident" id="1566303">b</span>&nbsp;<span class="op" id="1566305">[</span><span class="op" id="1566306">]</span><span class="builtintype" id="1566307">byte</span><span class="op" id="1566311">)</span>&nbsp;<span class="builtintype" id="1566313">bool</span>&nbsp;<span class="op" id="1566318">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566321">if</span>&nbsp;<span class="builtinfunc" id="1566324">len</span><span class="op" id="1566327">(</span><span class="ident" id="1566328">a</span><span class="op" id="1566329">)</span>&nbsp;<span class="op" id="1566331">!=</span>&nbsp;<span class="builtinfunc" id="1566334">len</span><span class="op" id="1566337">(</span><span class="ident" id="1566338">b</span><span class="op" id="1566339">)</span>&nbsp;<span class="op" id="1566341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566345">return</span>&nbsp;<span class="builtintype" id="1566352">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566362">for</span>&nbsp;<span class="ident" id="1566366">i</span><span class="op" id="1566367">,</span>&nbsp;<span class="ident" id="1566369">c</span>&nbsp;<span class="op" id="1566371">:=</span>&nbsp;<span class="keyword" id="1566374">range</span>&nbsp;<span class="ident" id="1566380">a</span>&nbsp;<span class="op" id="1566382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566386">if</span>&nbsp;<span class="ident" id="1566389">c</span>&nbsp;<span class="op" id="1566391">!=</span>&nbsp;<span class="ident" id="1566394">b</span><span class="op" id="1566395">[</span><span class="ident" id="1566396">i</span><span class="op" id="1566397">]</span>&nbsp;<span class="op" id="1566399">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566404">return</span>&nbsp;<span class="builtintype" id="1566411">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566425">return</span>&nbsp;<span class="builtintype" id="1566432">true</span><br>
<span class="lineno"></span><span class="op" id="1566437">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="1566440">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;a&nbsp;slice&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;slices&nbsp;of&nbsp;bytes),</span><br>
<span class="lineno"></span><span class="comment" id="1566544">//&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;byte&nbsp;slices.&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;are&nbsp;chopped&nbsp;into&nbsp;individual&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1566640">func</span>&nbsp;<span class="ident" id="1566645">explode</span><span class="op" id="1566652">(</span><span class="ident" id="1566653">s</span>&nbsp;<span class="op" id="1566655">[</span><span class="op" id="1566656">]</span><span class="builtintype" id="1566657">byte</span><span class="op" id="1566661">,</span>&nbsp;<span class="ident" id="1566663">n</span>&nbsp;<span class="builtintype" id="1566665">int</span><span class="op" id="1566668">)</span>&nbsp;<span class="op" id="1566670">[</span><span class="op" id="1566671">]</span><span class="op" id="1566672">[</span><span class="op" id="1566673">]</span><span class="builtintype" id="1566674">byte</span>&nbsp;<span class="op" id="1566679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566682">if</span>&nbsp;<span class="ident" id="1566685">n</span>&nbsp;<span class="op" id="1566687">&lt;=</span>&nbsp;<span class="num" id="1566690">0</span>&nbsp;<span class="op" id="1566692">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566696">n</span>&nbsp;<span class="op" id="1566698">=</span>&nbsp;<span class="builtinfunc" id="1566700">len</span><span class="op" id="1566703">(</span><span class="ident" id="1566704">s</span><span class="op" id="1566705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566711">a</span>&nbsp;<span class="op" id="1566713">:=</span>&nbsp;<span class="builtinfunc" id="1566716">make</span><span class="op" id="1566720">(</span><span class="op" id="1566721">[</span><span class="op" id="1566722">]</span><span class="op" id="1566723">[</span><span class="op" id="1566724">]</span><span class="builtintype" id="1566725">byte</span><span class="op" id="1566729">,</span>&nbsp;<span class="ident" id="1566731">n</span><span class="op" id="1566732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566735">var</span>&nbsp;<span class="ident" id="1566739">size</span>&nbsp;<span class="builtintype" id="1566744">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566749">na</span>&nbsp;<span class="op" id="1566752">:=</span>&nbsp;<span class="num" id="1566755">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566758">for</span>&nbsp;<span class="builtinfunc" id="1566762">len</span><span class="op" id="1566765">(</span><span class="ident" id="1566766">s</span><span class="op" id="1566767">)</span>&nbsp;<span class="op" id="1566769">&gt;</span>&nbsp;<span class="num" id="1566771">0</span>&nbsp;<span class="op" id="1566773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566777">if</span>&nbsp;<span class="ident" id="1566780">na</span><span class="op" id="1566782">+</span><span class="num" id="1566783">1</span>&nbsp;<span class="op" id="1566785">&gt;=</span>&nbsp;<span class="ident" id="1566788">n</span>&nbsp;<span class="op" id="1566790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566795">a</span><span class="op" id="1566796">[</span><span class="ident" id="1566797">na</span><span class="op" id="1566799">]</span>&nbsp;<span class="op" id="1566801">=</span>&nbsp;<span class="ident" id="1566803">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566808">na</span><span class="op" id="1566810">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566816">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566828">_</span><span class="op" id="1566829">,</span>&nbsp;<span class="ident" id="1566831">size</span>&nbsp;<span class="op" id="1566836">=</span>&nbsp;<span class="ident" id="1566838">utf8</span><span class="op" id="1566842">.</span><span class="ident" id="1566843">DecodeRune</span><span class="op" id="1566853">(</span><span class="ident" id="1566854">s</span><span class="op" id="1566855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566859">a</span><span class="op" id="1566860">[</span><span class="ident" id="1566861">na</span><span class="op" id="1566863">]</span>&nbsp;<span class="op" id="1566865">=</span>&nbsp;<span class="ident" id="1566867">s</span><span class="op" id="1566868">[</span><span class="num" id="1566869">0</span><span class="op" id="1566870">:</span><span class="ident" id="1566871">size</span><span class="op" id="1566875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566879">s</span>&nbsp;<span class="op" id="1566881">=</span>&nbsp;<span class="ident" id="1566883">s</span><span class="op" id="1566884">[</span><span class="ident" id="1566885">size</span><span class="op" id="1566889">:</span><span class="op" id="1566890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566894">na</span><span class="op" id="1566896">++</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566903">return</span>&nbsp;<span class="ident" id="1566910">a</span><span class="op" id="1566911">[</span><span class="num" id="1566912">0</span><span class="op" id="1566913">:</span><span class="ident" id="1566914">na</span><span class="op" id="1566916">]</span><br>
<span class="lineno"></span><span class="op" id="1566918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1566921">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno">50</span><span class="keyword" id="1566990">func</span>&nbsp;<span class="ident" id="1566995">Count</span><span class="op" id="1567000">(</span><span class="ident" id="1567001">s</span><span class="op" id="1567002">,</span>&nbsp;<span class="ident" id="1567004">sep</span>&nbsp;<span class="op" id="1567008">[</span><span class="op" id="1567009">]</span><span class="builtintype" id="1567010">byte</span><span class="op" id="1567014">)</span>&nbsp;<span class="builtintype" id="1567016">int</span>&nbsp;<span class="op" id="1567020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567023">n</span>&nbsp;<span class="op" id="1567025">:=</span>&nbsp;<span class="builtinfunc" id="1567028">len</span><span class="op" id="1567031">(</span><span class="ident" id="1567032">sep</span><span class="op" id="1567035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567038">if</span>&nbsp;<span class="ident" id="1567041">n</span>&nbsp;<span class="op" id="1567043">==</span>&nbsp;<span class="num" id="1567046">0</span>&nbsp;<span class="op" id="1567048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567052">return</span>&nbsp;<span class="ident" id="1567059">utf8</span><span class="op" id="1567063">.</span><span class="ident" id="1567064">RuneCount</span><span class="op" id="1567073">(</span><span class="ident" id="1567074">s</span><span class="op" id="1567075">)</span>&nbsp;<span class="op" id="1567077">+</span>&nbsp;<span class="num" id="1567079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567082">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567085">if</span>&nbsp;<span class="ident" id="1567088">n</span>&nbsp;<span class="op" id="1567090">&gt;</span>&nbsp;<span class="builtinfunc" id="1567092">len</span><span class="op" id="1567095">(</span><span class="ident" id="1567096">s</span><span class="op" id="1567097">)</span>&nbsp;<span class="op" id="1567099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567103">return</span>&nbsp;<span class="num" id="1567110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567116">count</span>&nbsp;<span class="op" id="1567122">:=</span>&nbsp;<span class="num" id="1567125">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567128">c</span>&nbsp;<span class="op" id="1567130">:=</span>&nbsp;<span class="ident" id="1567133">sep</span><span class="op" id="1567136">[</span><span class="num" id="1567137">0</span><span class="op" id="1567138">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567141">i</span>&nbsp;<span class="op" id="1567143">:=</span>&nbsp;<span class="num" id="1567146">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567149">t</span>&nbsp;<span class="op" id="1567151">:=</span>&nbsp;<span class="ident" id="1567154">s</span><span class="op" id="1567155">[</span><span class="op" id="1567156">:</span><span class="builtinfunc" id="1567157">len</span><span class="op" id="1567160">(</span><span class="ident" id="1567161">s</span><span class="op" id="1567162">)</span><span class="op" id="1567163">-</span><span class="ident" id="1567164">n</span><span class="op" id="1567165">+</span><span class="num" id="1567166">1</span><span class="op" id="1567167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567170">for</span>&nbsp;<span class="ident" id="1567174">i</span>&nbsp;<span class="op" id="1567176">&lt;</span>&nbsp;<span class="builtinfunc" id="1567178">len</span><span class="op" id="1567181">(</span><span class="ident" id="1567182">t</span><span class="op" id="1567183">)</span>&nbsp;<span class="op" id="1567185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567189">if</span>&nbsp;<span class="ident" id="1567192">t</span><span class="op" id="1567193">[</span><span class="ident" id="1567194">i</span><span class="op" id="1567195">]</span>&nbsp;<span class="op" id="1567197">!=</span>&nbsp;<span class="ident" id="1567200">c</span>&nbsp;<span class="op" id="1567202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567207">o</span>&nbsp;<span class="op" id="1567209">:=</span>&nbsp;<span class="ident" id="1567212">IndexByte</span><span class="op" id="1567221">(</span><span class="ident" id="1567222">t</span><span class="op" id="1567223">[</span><span class="ident" id="1567224">i</span><span class="op" id="1567225">:</span><span class="op" id="1567226">]</span><span class="op" id="1567227">,</span>&nbsp;<span class="ident" id="1567229">c</span><span class="op" id="1567230">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567235">if</span>&nbsp;<span class="ident" id="1567238">o</span>&nbsp;<span class="op" id="1567240">&lt;</span>&nbsp;<span class="num" id="1567242">0</span>&nbsp;<span class="op" id="1567244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567250">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567264">i</span>&nbsp;<span class="op" id="1567266">+=</span>&nbsp;<span class="ident" id="1567269">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567273">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567277">if</span>&nbsp;<span class="ident" id="1567280">n</span>&nbsp;<span class="op" id="1567282">==</span>&nbsp;<span class="num" id="1567285">1</span>&nbsp;<span class="op" id="1567287">||</span>&nbsp;<span class="ident" id="1567290">Equal</span><span class="op" id="1567295">(</span><span class="ident" id="1567296">s</span><span class="op" id="1567297">[</span><span class="ident" id="1567298">i</span><span class="op" id="1567299">:</span><span class="ident" id="1567300">i</span><span class="op" id="1567301">+</span><span class="ident" id="1567302">n</span><span class="op" id="1567303">]</span><span class="op" id="1567304">,</span>&nbsp;<span class="ident" id="1567306">sep</span><span class="op" id="1567309">)</span>&nbsp;<span class="op" id="1567311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567316">count</span><span class="op" id="1567321">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567327">i</span>&nbsp;<span class="op" id="1567329">+=</span>&nbsp;<span class="ident" id="1567332">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567337">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567348">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567352">i</span><span class="op" id="1567353">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567360">return</span>&nbsp;<span class="ident" id="1567367">count</span><br>
<span class="lineno"></span><span class="op" id="1567373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="1567376">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;subslice&nbsp;is&nbsp;within&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1567426">func</span>&nbsp;<span class="ident" id="1567431">Contains</span><span class="op" id="1567439">(</span><span class="ident" id="1567440">b</span><span class="op" id="1567441">,</span>&nbsp;<span class="ident" id="1567443">subslice</span>&nbsp;<span class="op" id="1567452">[</span><span class="op" id="1567453">]</span><span class="builtintype" id="1567454">byte</span><span class="op" id="1567458">)</span>&nbsp;<span class="builtintype" id="1567460">bool</span>&nbsp;<span class="op" id="1567465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567468">return</span>&nbsp;<span class="ident" id="1567475">Index</span><span class="op" id="1567480">(</span><span class="ident" id="1567481">b</span><span class="op" id="1567482">,</span>&nbsp;<span class="ident" id="1567484">subslice</span><span class="op" id="1567492">)</span>&nbsp;<span class="op" id="1567494">!=</span>&nbsp;<span class="op" id="1567497">-</span><span class="num" id="1567498">1</span><br>
<span class="lineno"></span><span class="op" id="1567500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1567503">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1567599">func</span>&nbsp;<span class="ident" id="1567604">Index</span><span class="op" id="1567609">(</span><span class="ident" id="1567610">s</span><span class="op" id="1567611">,</span>&nbsp;<span class="ident" id="1567613">sep</span>&nbsp;<span class="op" id="1567617">[</span><span class="op" id="1567618">]</span><span class="builtintype" id="1567619">byte</span><span class="op" id="1567623">)</span>&nbsp;<span class="builtintype" id="1567625">int</span>&nbsp;<span class="op" id="1567629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567632">n</span>&nbsp;<span class="op" id="1567634">:=</span>&nbsp;<span class="builtinfunc" id="1567637">len</span><span class="op" id="1567640">(</span><span class="ident" id="1567641">sep</span><span class="op" id="1567644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567647">if</span>&nbsp;<span class="ident" id="1567650">n</span>&nbsp;<span class="op" id="1567652">==</span>&nbsp;<span class="num" id="1567655">0</span>&nbsp;<span class="op" id="1567657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567661">return</span>&nbsp;<span class="num" id="1567668">0</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567674">if</span>&nbsp;<span class="ident" id="1567677">n</span>&nbsp;<span class="op" id="1567679">&gt;</span>&nbsp;<span class="builtinfunc" id="1567681">len</span><span class="op" id="1567684">(</span><span class="ident" id="1567685">s</span><span class="op" id="1567686">)</span>&nbsp;<span class="op" id="1567688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567692">return</span>&nbsp;<span class="op" id="1567699">-</span><span class="num" id="1567700">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567706">c</span>&nbsp;<span class="op" id="1567708">:=</span>&nbsp;<span class="ident" id="1567711">sep</span><span class="op" id="1567714">[</span><span class="num" id="1567715">0</span><span class="op" id="1567716">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567719">if</span>&nbsp;<span class="ident" id="1567722">n</span>&nbsp;<span class="op" id="1567724">==</span>&nbsp;<span class="num" id="1567727">1</span>&nbsp;<span class="op" id="1567729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567733">return</span>&nbsp;<span class="ident" id="1567740">IndexByte</span><span class="op" id="1567749">(</span><span class="ident" id="1567750">s</span><span class="op" id="1567751">,</span>&nbsp;<span class="ident" id="1567753">c</span><span class="op" id="1567754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567760">i</span>&nbsp;<span class="op" id="1567762">:=</span>&nbsp;<span class="num" id="1567765">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567768">t</span>&nbsp;<span class="op" id="1567770">:=</span>&nbsp;<span class="ident" id="1567773">s</span><span class="op" id="1567774">[</span><span class="op" id="1567775">:</span><span class="builtinfunc" id="1567776">len</span><span class="op" id="1567779">(</span><span class="ident" id="1567780">s</span><span class="op" id="1567781">)</span><span class="op" id="1567782">-</span><span class="ident" id="1567783">n</span><span class="op" id="1567784">+</span><span class="num" id="1567785">1</span><span class="op" id="1567786">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567789">for</span>&nbsp;<span class="ident" id="1567793">i</span>&nbsp;<span class="op" id="1567795">&lt;</span>&nbsp;<span class="builtinfunc" id="1567797">len</span><span class="op" id="1567800">(</span><span class="ident" id="1567801">t</span><span class="op" id="1567802">)</span>&nbsp;<span class="op" id="1567804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567808">if</span>&nbsp;<span class="ident" id="1567811">t</span><span class="op" id="1567812">[</span><span class="ident" id="1567813">i</span><span class="op" id="1567814">]</span>&nbsp;<span class="op" id="1567816">!=</span>&nbsp;<span class="ident" id="1567819">c</span>&nbsp;<span class="op" id="1567821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567826">o</span>&nbsp;<span class="op" id="1567828">:=</span>&nbsp;<span class="ident" id="1567831">IndexByte</span><span class="op" id="1567840">(</span><span class="ident" id="1567841">t</span><span class="op" id="1567842">[</span><span class="ident" id="1567843">i</span><span class="op" id="1567844">:</span><span class="op" id="1567845">]</span><span class="op" id="1567846">,</span>&nbsp;<span class="ident" id="1567848">c</span><span class="op" id="1567849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567854">if</span>&nbsp;<span class="ident" id="1567857">o</span>&nbsp;<span class="op" id="1567859">&lt;</span>&nbsp;<span class="num" id="1567861">0</span>&nbsp;<span class="op" id="1567863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567869">break</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567883">i</span>&nbsp;<span class="op" id="1567885">+=</span>&nbsp;<span class="ident" id="1567888">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567896">if</span>&nbsp;<span class="ident" id="1567899">Equal</span><span class="op" id="1567904">(</span><span class="ident" id="1567905">s</span><span class="op" id="1567906">[</span><span class="ident" id="1567907">i</span><span class="op" id="1567908">:</span><span class="ident" id="1567909">i</span><span class="op" id="1567910">+</span><span class="ident" id="1567911">n</span><span class="op" id="1567912">]</span><span class="op" id="1567913">,</span>&nbsp;<span class="ident" id="1567915">sep</span><span class="op" id="1567918">)</span>&nbsp;<span class="op" id="1567920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567925">return</span>&nbsp;<span class="ident" id="1567932">i</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567940">i</span><span class="op" id="1567941">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567948">return</span>&nbsp;<span class="op" id="1567955">-</span><span class="num" id="1567956">1</span><br>
<span class="lineno"></span><span class="op" id="1567958">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="1567961">func</span>&nbsp;<span class="ident" id="1567966">indexBytePortable</span><span class="op" id="1567983">(</span><span class="ident" id="1567984">s</span>&nbsp;<span class="op" id="1567986">[</span><span class="op" id="1567987">]</span><span class="builtintype" id="1567988">byte</span><span class="op" id="1567992">,</span>&nbsp;<span class="ident" id="1567994">c</span>&nbsp;<span class="builtintype" id="1567996">byte</span><span class="op" id="1568000">)</span>&nbsp;<span class="builtintype" id="1568002">int</span>&nbsp;<span class="op" id="1568006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568009">for</span>&nbsp;<span class="ident" id="1568013">i</span><span class="op" id="1568014">,</span>&nbsp;<span class="ident" id="1568016">b</span>&nbsp;<span class="op" id="1568018">:=</span>&nbsp;<span class="keyword" id="1568021">range</span>&nbsp;<span class="ident" id="1568027">s</span>&nbsp;<span class="op" id="1568029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568033">if</span>&nbsp;<span class="ident" id="1568036">b</span>&nbsp;<span class="op" id="1568038">==</span>&nbsp;<span class="ident" id="1568041">c</span>&nbsp;<span class="op" id="1568043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568048">return</span>&nbsp;<span class="ident" id="1568055">i</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568065">return</span>&nbsp;<span class="op" id="1568072">-</span><span class="num" id="1568073">1</span><br>
<span class="lineno"></span><span class="op" id="1568075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1568078">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1568177">func</span>&nbsp;<span class="ident" id="1568182">LastIndex</span><span class="op" id="1568191">(</span><span class="ident" id="1568192">s</span><span class="op" id="1568193">,</span>&nbsp;<span class="ident" id="1568195">sep</span>&nbsp;<span class="op" id="1568199">[</span><span class="op" id="1568200">]</span><span class="builtintype" id="1568201">byte</span><span class="op" id="1568205">)</span>&nbsp;<span class="builtintype" id="1568207">int</span>&nbsp;<span class="op" id="1568211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568214">n</span>&nbsp;<span class="op" id="1568216">:=</span>&nbsp;<span class="builtinfunc" id="1568219">len</span><span class="op" id="1568222">(</span><span class="ident" id="1568223">sep</span><span class="op" id="1568226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568229">if</span>&nbsp;<span class="ident" id="1568232">n</span>&nbsp;<span class="op" id="1568234">==</span>&nbsp;<span class="num" id="1568237">0</span>&nbsp;<span class="op" id="1568239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568243">return</span>&nbsp;<span class="builtinfunc" id="1568250">len</span><span class="op" id="1568253">(</span><span class="ident" id="1568254">s</span><span class="op" id="1568255">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568261">c</span>&nbsp;<span class="op" id="1568263">:=</span>&nbsp;<span class="ident" id="1568266">sep</span><span class="op" id="1568269">[</span><span class="num" id="1568270">0</span><span class="op" id="1568271">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568274">for</span>&nbsp;<span class="ident" id="1568278">i</span>&nbsp;<span class="op" id="1568280">:=</span>&nbsp;<span class="builtinfunc" id="1568283">len</span><span class="op" id="1568286">(</span><span class="ident" id="1568287">s</span><span class="op" id="1568288">)</span>&nbsp;<span class="op" id="1568290">-</span>&nbsp;<span class="ident" id="1568292">n</span><span class="op" id="1568293">;</span>&nbsp;<span class="ident" id="1568295">i</span>&nbsp;<span class="op" id="1568297">&gt;=</span>&nbsp;<span class="num" id="1568300">0</span><span class="op" id="1568301">;</span>&nbsp;<span class="ident" id="1568303">i</span><span class="op" id="1568304">--</span>&nbsp;<span class="op" id="1568307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568311">if</span>&nbsp;<span class="ident" id="1568314">s</span><span class="op" id="1568315">[</span><span class="ident" id="1568316">i</span><span class="op" id="1568317">]</span>&nbsp;<span class="op" id="1568319">==</span>&nbsp;<span class="ident" id="1568322">c</span>&nbsp;<span class="op" id="1568324">&amp;&amp;</span>&nbsp;<span class="op" id="1568327">(</span><span class="ident" id="1568328">n</span>&nbsp;<span class="op" id="1568330">==</span>&nbsp;<span class="num" id="1568333">1</span>&nbsp;<span class="op" id="1568335">||</span>&nbsp;<span class="ident" id="1568338">Equal</span><span class="op" id="1568343">(</span><span class="ident" id="1568344">s</span><span class="op" id="1568345">[</span><span class="ident" id="1568346">i</span><span class="op" id="1568347">:</span><span class="ident" id="1568348">i</span><span class="op" id="1568349">+</span><span class="ident" id="1568350">n</span><span class="op" id="1568351">]</span><span class="op" id="1568352">,</span>&nbsp;<span class="ident" id="1568354">sep</span><span class="op" id="1568357">)</span><span class="op" id="1568358">)</span>&nbsp;<span class="op" id="1568360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568365">return</span>&nbsp;<span class="ident" id="1568372">i</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568382">return</span>&nbsp;<span class="op" id="1568389">-</span><span class="num" id="1568390">1</span><br>
<span class="lineno"></span><span class="op" id="1568392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1568395">//&nbsp;IndexRune&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1568473">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1568550">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1568596">func</span>&nbsp;<span class="ident" id="1568601">IndexRune</span><span class="op" id="1568610">(</span><span class="ident" id="1568611">s</span>&nbsp;<span class="op" id="1568613">[</span><span class="op" id="1568614">]</span><span class="builtintype" id="1568615">byte</span><span class="op" id="1568619">,</span>&nbsp;<span class="ident" id="1568621">r</span>&nbsp;<span class="builtintype" id="1568623">rune</span><span class="op" id="1568627">)</span>&nbsp;<span class="builtintype" id="1568629">int</span>&nbsp;<span class="op" id="1568633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568636">for</span>&nbsp;<span class="ident" id="1568640">i</span>&nbsp;<span class="op" id="1568642">:=</span>&nbsp;<span class="num" id="1568645">0</span><span class="op" id="1568646">;</span>&nbsp;<span class="ident" id="1568648">i</span>&nbsp;<span class="op" id="1568650">&lt;</span>&nbsp;<span class="builtinfunc" id="1568652">len</span><span class="op" id="1568655">(</span><span class="ident" id="1568656">s</span><span class="op" id="1568657">)</span><span class="op" id="1568658">;</span>&nbsp;<span class="op" id="1568660">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568664">r1</span><span class="op" id="1568666">,</span>&nbsp;<span class="ident" id="1568668">size</span>&nbsp;<span class="op" id="1568673">:=</span>&nbsp;<span class="ident" id="1568676">utf8</span><span class="op" id="1568680">.</span><span class="ident" id="1568681">DecodeRune</span><span class="op" id="1568691">(</span><span class="ident" id="1568692">s</span><span class="op" id="1568693">[</span><span class="ident" id="1568694">i</span><span class="op" id="1568695">:</span><span class="op" id="1568696">]</span><span class="op" id="1568697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568701">if</span>&nbsp;<span class="ident" id="1568704">r</span>&nbsp;<span class="op" id="1568706">==</span>&nbsp;<span class="ident" id="1568709">r1</span>&nbsp;<span class="op" id="1568712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568717">return</span>&nbsp;<span class="ident" id="1568724">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568732">i</span>&nbsp;<span class="op" id="1568734">+=</span>&nbsp;<span class="ident" id="1568737">size</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568746">return</span>&nbsp;<span class="op" id="1568753">-</span><span class="num" id="1568754">1</span><br>
<span class="lineno"></span><span class="op" id="1568756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1568759">//&nbsp;IndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno">155</span><span class="comment" id="1568836">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1568916">//&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1568997">//&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="1569017">func</span>&nbsp;<span class="ident" id="1569022">IndexAny</span><span class="op" id="1569030">(</span><span class="ident" id="1569031">s</span>&nbsp;<span class="op" id="1569033">[</span><span class="op" id="1569034">]</span><span class="builtintype" id="1569035">byte</span><span class="op" id="1569039">,</span>&nbsp;<span class="ident" id="1569041">chars</span>&nbsp;<span class="builtintype" id="1569047">string</span><span class="op" id="1569053">)</span>&nbsp;<span class="builtintype" id="1569055">int</span>&nbsp;<span class="op" id="1569059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569062">if</span>&nbsp;<span class="builtinfunc" id="1569065">len</span><span class="op" id="1569068">(</span><span class="ident" id="1569069">chars</span><span class="op" id="1569074">)</span>&nbsp;<span class="op" id="1569076">&gt;</span>&nbsp;<span class="num" id="1569078">0</span>&nbsp;<span class="op" id="1569080">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569084">var</span>&nbsp;<span class="ident" id="1569088">r</span>&nbsp;<span class="builtintype" id="1569090">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569097">var</span>&nbsp;<span class="ident" id="1569101">width</span>&nbsp;<span class="builtintype" id="1569107">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569113">for</span>&nbsp;<span class="ident" id="1569117">i</span>&nbsp;<span class="op" id="1569119">:=</span>&nbsp;<span class="num" id="1569122">0</span><span class="op" id="1569123">;</span>&nbsp;<span class="ident" id="1569125">i</span>&nbsp;<span class="op" id="1569127">&lt;</span>&nbsp;<span class="builtinfunc" id="1569129">len</span><span class="op" id="1569132">(</span><span class="ident" id="1569133">s</span><span class="op" id="1569134">)</span><span class="op" id="1569135">;</span>&nbsp;<span class="ident" id="1569137">i</span>&nbsp;<span class="op" id="1569139">+=</span>&nbsp;<span class="ident" id="1569142">width</span>&nbsp;<span class="op" id="1569148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569153">r</span>&nbsp;<span class="op" id="1569155">=</span>&nbsp;<span class="builtintype" id="1569157">rune</span><span class="op" id="1569161">(</span><span class="ident" id="1569162">s</span><span class="op" id="1569163">[</span><span class="ident" id="1569164">i</span><span class="op" id="1569165">]</span><span class="op" id="1569166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569171">if</span>&nbsp;<span class="ident" id="1569174">r</span>&nbsp;<span class="op" id="1569176">&lt;</span>&nbsp;<span class="ident" id="1569178">utf8</span><span class="op" id="1569182">.</span><span class="ident" id="1569183">RuneSelf</span>&nbsp;<span class="op" id="1569192">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569198">width</span>&nbsp;<span class="op" id="1569204">=</span>&nbsp;<span class="num" id="1569206">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569211">}</span>&nbsp;<span class="keyword" id="1569213">else</span>&nbsp;<span class="op" id="1569218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569224">r</span><span class="op" id="1569225">,</span>&nbsp;<span class="ident" id="1569227">width</span>&nbsp;<span class="op" id="1569233">=</span>&nbsp;<span class="ident" id="1569235">utf8</span><span class="op" id="1569239">.</span><span class="ident" id="1569240">DecodeRune</span><span class="op" id="1569250">(</span><span class="ident" id="1569251">s</span><span class="op" id="1569252">[</span><span class="ident" id="1569253">i</span><span class="op" id="1569254">:</span><span class="op" id="1569255">]</span><span class="op" id="1569256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569266">for</span>&nbsp;<span class="ident" id="1569270">_</span><span class="op" id="1569271">,</span>&nbsp;<span class="ident" id="1569273">ch</span>&nbsp;<span class="op" id="1569276">:=</span>&nbsp;<span class="keyword" id="1569279">range</span>&nbsp;<span class="ident" id="1569285">chars</span>&nbsp;<span class="op" id="1569291">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569297">if</span>&nbsp;<span class="ident" id="1569300">r</span>&nbsp;<span class="op" id="1569302">==</span>&nbsp;<span class="ident" id="1569305">ch</span>&nbsp;<span class="op" id="1569308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569315">return</span>&nbsp;<span class="ident" id="1569322">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569337">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569343">return</span>&nbsp;<span class="op" id="1569350">-</span><span class="num" id="1569351">1</span><br>
<span class="lineno"></span><span class="op" id="1569353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1569356">//&nbsp;LastIndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno">180</span><span class="comment" id="1569429">//&nbsp;points.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1569505">//&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1569581">//&nbsp;there&nbsp;is&nbsp;no&nbsp;code&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="1569618">func</span>&nbsp;<span class="ident" id="1569623">LastIndexAny</span><span class="op" id="1569635">(</span><span class="ident" id="1569636">s</span>&nbsp;<span class="op" id="1569638">[</span><span class="op" id="1569639">]</span><span class="builtintype" id="1569640">byte</span><span class="op" id="1569644">,</span>&nbsp;<span class="ident" id="1569646">chars</span>&nbsp;<span class="builtintype" id="1569652">string</span><span class="op" id="1569658">)</span>&nbsp;<span class="builtintype" id="1569660">int</span>&nbsp;<span class="op" id="1569664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569667">if</span>&nbsp;<span class="builtinfunc" id="1569670">len</span><span class="op" id="1569673">(</span><span class="ident" id="1569674">chars</span><span class="op" id="1569679">)</span>&nbsp;<span class="op" id="1569681">&gt;</span>&nbsp;<span class="num" id="1569683">0</span>&nbsp;<span class="op" id="1569685">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569689">for</span>&nbsp;<span class="ident" id="1569693">i</span>&nbsp;<span class="op" id="1569695">:=</span>&nbsp;<span class="builtinfunc" id="1569698">len</span><span class="op" id="1569701">(</span><span class="ident" id="1569702">s</span><span class="op" id="1569703">)</span><span class="op" id="1569704">;</span>&nbsp;<span class="ident" id="1569706">i</span>&nbsp;<span class="op" id="1569708">&gt;</span>&nbsp;<span class="num" id="1569710">0</span><span class="op" id="1569711">;</span>&nbsp;<span class="op" id="1569713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569718">r</span><span class="op" id="1569719">,</span>&nbsp;<span class="ident" id="1569721">size</span>&nbsp;<span class="op" id="1569726">:=</span>&nbsp;<span class="ident" id="1569729">utf8</span><span class="op" id="1569733">.</span><span class="ident" id="1569734">DecodeLastRune</span><span class="op" id="1569748">(</span><span class="ident" id="1569749">s</span><span class="op" id="1569750">[</span><span class="num" id="1569751">0</span><span class="op" id="1569752">:</span><span class="ident" id="1569753">i</span><span class="op" id="1569754">]</span><span class="op" id="1569755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569760">i</span>&nbsp;<span class="op" id="1569762">-=</span>&nbsp;<span class="ident" id="1569765">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569773">for</span>&nbsp;<span class="ident" id="1569777">_</span><span class="op" id="1569778">,</span>&nbsp;<span class="ident" id="1569780">ch</span>&nbsp;<span class="op" id="1569783">:=</span>&nbsp;<span class="keyword" id="1569786">range</span>&nbsp;<span class="ident" id="1569792">chars</span>&nbsp;<span class="op" id="1569798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569804">if</span>&nbsp;<span class="ident" id="1569807">r</span>&nbsp;<span class="op" id="1569809">==</span>&nbsp;<span class="ident" id="1569812">ch</span>&nbsp;<span class="op" id="1569815">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569822">return</span>&nbsp;<span class="ident" id="1569829">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569847">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569850">return</span>&nbsp;<span class="op" id="1569857">-</span><span class="num" id="1569858">1</span><br>
<span class="lineno"></span><span class="op" id="1569860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1569863">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="1569916">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subslices.</span><br>
<span class="lineno">200</span><span class="keyword" id="1569968">func</span>&nbsp;<span class="ident" id="1569973">genSplit</span><span class="op" id="1569981">(</span><span class="ident" id="1569982">s</span><span class="op" id="1569983">,</span>&nbsp;<span class="ident" id="1569985">sep</span>&nbsp;<span class="op" id="1569989">[</span><span class="op" id="1569990">]</span><span class="builtintype" id="1569991">byte</span><span class="op" id="1569995">,</span>&nbsp;<span class="ident" id="1569997">sepSave</span><span class="op" id="1570004">,</span>&nbsp;<span class="ident" id="1570006">n</span>&nbsp;<span class="builtintype" id="1570008">int</span><span class="op" id="1570011">)</span>&nbsp;<span class="op" id="1570013">[</span><span class="op" id="1570014">]</span><span class="op" id="1570015">[</span><span class="op" id="1570016">]</span><span class="builtintype" id="1570017">byte</span>&nbsp;<span class="op" id="1570022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570025">if</span>&nbsp;<span class="ident" id="1570028">n</span>&nbsp;<span class="op" id="1570030">==</span>&nbsp;<span class="num" id="1570033">0</span>&nbsp;<span class="op" id="1570035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570039">return</span>&nbsp;<span class="ident" id="1570046">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570054">if</span>&nbsp;<span class="builtinfunc" id="1570057">len</span><span class="op" id="1570060">(</span><span class="ident" id="1570061">sep</span><span class="op" id="1570064">)</span>&nbsp;<span class="op" id="1570066">==</span>&nbsp;<span class="num" id="1570069">0</span>&nbsp;<span class="op" id="1570071">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570075">return</span>&nbsp;<span class="ident" id="1570082">explode</span><span class="op" id="1570089">(</span><span class="ident" id="1570090">s</span><span class="op" id="1570091">,</span>&nbsp;<span class="ident" id="1570093">n</span><span class="op" id="1570094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570100">if</span>&nbsp;<span class="ident" id="1570103">n</span>&nbsp;<span class="op" id="1570105">&lt;</span>&nbsp;<span class="num" id="1570107">0</span>&nbsp;<span class="op" id="1570109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570113">n</span>&nbsp;<span class="op" id="1570115">=</span>&nbsp;<span class="ident" id="1570117">Count</span><span class="op" id="1570122">(</span><span class="ident" id="1570123">s</span><span class="op" id="1570124">,</span>&nbsp;<span class="ident" id="1570126">sep</span><span class="op" id="1570129">)</span>&nbsp;<span class="op" id="1570131">+</span>&nbsp;<span class="num" id="1570133">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570136">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570139">c</span>&nbsp;<span class="op" id="1570141">:=</span>&nbsp;<span class="ident" id="1570144">sep</span><span class="op" id="1570147">[</span><span class="num" id="1570148">0</span><span class="op" id="1570149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570152">start</span>&nbsp;<span class="op" id="1570158">:=</span>&nbsp;<span class="num" id="1570161">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570164">a</span>&nbsp;<span class="op" id="1570166">:=</span>&nbsp;<span class="builtinfunc" id="1570169">make</span><span class="op" id="1570173">(</span><span class="op" id="1570174">[</span><span class="op" id="1570175">]</span><span class="op" id="1570176">[</span><span class="op" id="1570177">]</span><span class="builtintype" id="1570178">byte</span><span class="op" id="1570182">,</span>&nbsp;<span class="ident" id="1570184">n</span><span class="op" id="1570185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570188">na</span>&nbsp;<span class="op" id="1570191">:=</span>&nbsp;<span class="num" id="1570194">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570197">for</span>&nbsp;<span class="ident" id="1570201">i</span>&nbsp;<span class="op" id="1570203">:=</span>&nbsp;<span class="num" id="1570206">0</span><span class="op" id="1570207">;</span>&nbsp;<span class="ident" id="1570209">i</span><span class="op" id="1570210">+</span><span class="builtinfunc" id="1570211">len</span><span class="op" id="1570214">(</span><span class="ident" id="1570215">sep</span><span class="op" id="1570218">)</span>&nbsp;<span class="op" id="1570220">&lt;=</span>&nbsp;<span class="builtinfunc" id="1570223">len</span><span class="op" id="1570226">(</span><span class="ident" id="1570227">s</span><span class="op" id="1570228">)</span>&nbsp;<span class="op" id="1570230">&amp;&amp;</span>&nbsp;<span class="ident" id="1570233">na</span><span class="op" id="1570235">+</span><span class="num" id="1570236">1</span>&nbsp;<span class="op" id="1570238">&lt;</span>&nbsp;<span class="ident" id="1570240">n</span><span class="op" id="1570241">;</span>&nbsp;<span class="ident" id="1570243">i</span><span class="op" id="1570244">++</span>&nbsp;<span class="op" id="1570247">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570251">if</span>&nbsp;<span class="ident" id="1570254">s</span><span class="op" id="1570255">[</span><span class="ident" id="1570256">i</span><span class="op" id="1570257">]</span>&nbsp;<span class="op" id="1570259">==</span>&nbsp;<span class="ident" id="1570262">c</span>&nbsp;<span class="op" id="1570264">&amp;&amp;</span>&nbsp;<span class="op" id="1570267">(</span><span class="builtinfunc" id="1570268">len</span><span class="op" id="1570271">(</span><span class="ident" id="1570272">sep</span><span class="op" id="1570275">)</span>&nbsp;<span class="op" id="1570277">==</span>&nbsp;<span class="num" id="1570280">1</span>&nbsp;<span class="op" id="1570282">||</span>&nbsp;<span class="ident" id="1570285">Equal</span><span class="op" id="1570290">(</span><span class="ident" id="1570291">s</span><span class="op" id="1570292">[</span><span class="ident" id="1570293">i</span><span class="op" id="1570294">:</span><span class="ident" id="1570295">i</span><span class="op" id="1570296">+</span><span class="builtinfunc" id="1570297">len</span><span class="op" id="1570300">(</span><span class="ident" id="1570301">sep</span><span class="op" id="1570304">)</span><span class="op" id="1570305">]</span><span class="op" id="1570306">,</span>&nbsp;<span class="ident" id="1570308">sep</span><span class="op" id="1570311">)</span><span class="op" id="1570312">)</span>&nbsp;<span class="op" id="1570314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570319">a</span><span class="op" id="1570320">[</span><span class="ident" id="1570321">na</span><span class="op" id="1570323">]</span>&nbsp;<span class="op" id="1570325">=</span>&nbsp;<span class="ident" id="1570327">s</span><span class="op" id="1570328">[</span><span class="ident" id="1570329">start</span>&nbsp;<span class="op" id="1570335">:</span>&nbsp;<span class="ident" id="1570337">i</span><span class="op" id="1570338">+</span><span class="ident" id="1570339">sepSave</span><span class="op" id="1570346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570351">na</span><span class="op" id="1570353">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570359">start</span>&nbsp;<span class="op" id="1570365">=</span>&nbsp;<span class="ident" id="1570367">i</span>&nbsp;<span class="op" id="1570369">+</span>&nbsp;<span class="builtinfunc" id="1570371">len</span><span class="op" id="1570374">(</span><span class="ident" id="1570375">sep</span><span class="op" id="1570378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570383">i</span>&nbsp;<span class="op" id="1570385">+=</span>&nbsp;<span class="builtinfunc" id="1570388">len</span><span class="op" id="1570391">(</span><span class="ident" id="1570392">sep</span><span class="op" id="1570395">)</span>&nbsp;<span class="op" id="1570397">-</span>&nbsp;<span class="num" id="1570399">1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570409">a</span><span class="op" id="1570410">[</span><span class="ident" id="1570411">na</span><span class="op" id="1570413">]</span>&nbsp;<span class="op" id="1570415">=</span>&nbsp;<span class="ident" id="1570417">s</span><span class="op" id="1570418">[</span><span class="ident" id="1570419">start</span><span class="op" id="1570424">:</span><span class="op" id="1570425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570428">return</span>&nbsp;<span class="ident" id="1570435">a</span><span class="op" id="1570436">[</span><span class="num" id="1570437">0</span>&nbsp;<span class="op" id="1570439">:</span>&nbsp;<span class="ident" id="1570441">na</span><span class="op" id="1570443">+</span><span class="num" id="1570444">1</span><span class="op" id="1570445">]</span><br>
<span class="lineno"></span><span class="op" id="1570447">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1570450">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1570524">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="1570567">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1570628">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno">230</span><span class="comment" id="1570687">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="1570769">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="1570817">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="1570843">func</span>&nbsp;<span class="ident" id="1570848">SplitN</span><span class="op" id="1570854">(</span><span class="ident" id="1570855">s</span><span class="op" id="1570856">,</span>&nbsp;<span class="ident" id="1570858">sep</span>&nbsp;<span class="op" id="1570862">[</span><span class="op" id="1570863">]</span><span class="builtintype" id="1570864">byte</span><span class="op" id="1570868">,</span>&nbsp;<span class="ident" id="1570870">n</span>&nbsp;<span class="builtintype" id="1570872">int</span><span class="op" id="1570875">)</span>&nbsp;<span class="op" id="1570877">[</span><span class="op" id="1570878">]</span><span class="op" id="1570879">[</span><span class="op" id="1570880">]</span><span class="builtintype" id="1570881">byte</span>&nbsp;<span class="op" id="1570886">{</span>&nbsp;<span class="keyword" id="1570888">return</span>&nbsp;<span class="ident" id="1570895">genSplit</span><span class="op" id="1570903">(</span><span class="ident" id="1570904">s</span><span class="op" id="1570905">,</span>&nbsp;<span class="ident" id="1570907">sep</span><span class="op" id="1570910">,</span>&nbsp;<span class="num" id="1570912">0</span><span class="op" id="1570913">,</span>&nbsp;<span class="ident" id="1570915">n</span><span class="op" id="1570916">)</span>&nbsp;<span class="op" id="1570918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="1570921">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1570991">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="1571030">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1571096">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="1571155">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">240</span><span class="comment" id="1571237">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="1571285">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="1571311">func</span>&nbsp;<span class="ident" id="1571316">SplitAfterN</span><span class="op" id="1571327">(</span><span class="ident" id="1571328">s</span><span class="op" id="1571329">,</span>&nbsp;<span class="ident" id="1571331">sep</span>&nbsp;<span class="op" id="1571335">[</span><span class="op" id="1571336">]</span><span class="builtintype" id="1571337">byte</span><span class="op" id="1571341">,</span>&nbsp;<span class="ident" id="1571343">n</span>&nbsp;<span class="builtintype" id="1571345">int</span><span class="op" id="1571348">)</span>&nbsp;<span class="op" id="1571350">[</span><span class="op" id="1571351">]</span><span class="op" id="1571352">[</span><span class="op" id="1571353">]</span><span class="builtintype" id="1571354">byte</span>&nbsp;<span class="op" id="1571359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571362">return</span>&nbsp;<span class="ident" id="1571369">genSplit</span><span class="op" id="1571377">(</span><span class="ident" id="1571378">s</span><span class="op" id="1571379">,</span>&nbsp;<span class="ident" id="1571381">sep</span><span class="op" id="1571384">,</span>&nbsp;<span class="builtinfunc" id="1571386">len</span><span class="op" id="1571389">(</span><span class="ident" id="1571390">sep</span><span class="op" id="1571393">)</span><span class="op" id="1571394">,</span>&nbsp;<span class="ident" id="1571396">n</span><span class="op" id="1571397">)</span><br>
<span class="lineno"></span><span class="op" id="1571399">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="1571402">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1571479">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="1571522">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1571582">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">250</span><span class="keyword" id="1571632">func</span>&nbsp;<span class="ident" id="1571637">Split</span><span class="op" id="1571642">(</span><span class="ident" id="1571643">s</span><span class="op" id="1571644">,</span>&nbsp;<span class="ident" id="1571646">sep</span>&nbsp;<span class="op" id="1571650">[</span><span class="op" id="1571651">]</span><span class="builtintype" id="1571652">byte</span><span class="op" id="1571656">)</span>&nbsp;<span class="op" id="1571658">[</span><span class="op" id="1571659">]</span><span class="op" id="1571660">[</span><span class="op" id="1571661">]</span><span class="builtintype" id="1571662">byte</span>&nbsp;<span class="op" id="1571667">{</span>&nbsp;<span class="keyword" id="1571669">return</span>&nbsp;<span class="ident" id="1571676">genSplit</span><span class="op" id="1571684">(</span><span class="ident" id="1571685">s</span><span class="op" id="1571686">,</span>&nbsp;<span class="ident" id="1571688">sep</span><span class="op" id="1571691">,</span>&nbsp;<span class="num" id="1571693">0</span><span class="op" id="1571694">,</span>&nbsp;<span class="op" id="1571696">-</span><span class="num" id="1571697">1</span><span class="op" id="1571698">)</span>&nbsp;<span class="op" id="1571700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1571703">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1571776">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="1571815">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">255</span><span class="comment" id="1571880">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="1571935">func</span>&nbsp;<span class="ident" id="1571940">SplitAfter</span><span class="op" id="1571950">(</span><span class="ident" id="1571951">s</span><span class="op" id="1571952">,</span>&nbsp;<span class="ident" id="1571954">sep</span>&nbsp;<span class="op" id="1571958">[</span><span class="op" id="1571959">]</span><span class="builtintype" id="1571960">byte</span><span class="op" id="1571964">)</span>&nbsp;<span class="op" id="1571966">[</span><span class="op" id="1571967">]</span><span class="op" id="1571968">[</span><span class="op" id="1571969">]</span><span class="builtintype" id="1571970">byte</span>&nbsp;<span class="op" id="1571975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1571978">return</span>&nbsp;<span class="ident" id="1571985">genSplit</span><span class="op" id="1571993">(</span><span class="ident" id="1571994">s</span><span class="op" id="1571995">,</span>&nbsp;<span class="ident" id="1571997">sep</span><span class="op" id="1572000">,</span>&nbsp;<span class="builtinfunc" id="1572002">len</span><span class="op" id="1572005">(</span><span class="ident" id="1572006">sep</span><span class="op" id="1572009">)</span><span class="op" id="1572010">,</span>&nbsp;<span class="op" id="1572012">-</span><span class="num" id="1572013">1</span><span class="op" id="1572014">)</span><br>
<span class="lineno"></span><span class="op" id="1572016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="1572019">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="1572108">//&nbsp;characters,&nbsp;returning&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s&nbsp;or&nbsp;an&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="1572208">func</span>&nbsp;<span class="ident" id="1572213">Fields</span><span class="op" id="1572219">(</span><span class="ident" id="1572220">s</span>&nbsp;<span class="op" id="1572222">[</span><span class="op" id="1572223">]</span><span class="builtintype" id="1572224">byte</span><span class="op" id="1572228">)</span>&nbsp;<span class="op" id="1572230">[</span><span class="op" id="1572231">]</span><span class="op" id="1572232">[</span><span class="op" id="1572233">]</span><span class="builtintype" id="1572234">byte</span>&nbsp;<span class="op" id="1572239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572242">return</span>&nbsp;<span class="ident" id="1572249">FieldsFunc</span><span class="op" id="1572259">(</span><span class="ident" id="1572260">s</span><span class="op" id="1572261">,</span>&nbsp;<span class="ident" id="1572263">unicode</span><span class="op" id="1572270">.</span><span class="ident" id="1572271">IsSpace</span><span class="op" id="1572278">)</span><br>
<span class="lineno"></span><span class="op" id="1572280">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="comment" id="1572283">//&nbsp;FieldsFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1572362">//&nbsp;It&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1572436">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1572516">//&nbsp;len(s)&nbsp;==&nbsp;0,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">270</span><span class="comment" id="1572560">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="1572634">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="1572714">func</span>&nbsp;<span class="ident" id="1572719">FieldsFunc</span><span class="op" id="1572729">(</span><span class="ident" id="1572730">s</span>&nbsp;<span class="op" id="1572732">[</span><span class="op" id="1572733">]</span><span class="builtintype" id="1572734">byte</span><span class="op" id="1572738">,</span>&nbsp;<span class="ident" id="1572740">f</span>&nbsp;<span class="keyword" id="1572742">func</span><span class="op" id="1572746">(</span><span class="builtintype" id="1572747">rune</span><span class="op" id="1572751">)</span>&nbsp;<span class="builtintype" id="1572753">bool</span><span class="op" id="1572757">)</span>&nbsp;<span class="op" id="1572759">[</span><span class="op" id="1572760">]</span><span class="op" id="1572761">[</span><span class="op" id="1572762">]</span><span class="builtintype" id="1572763">byte</span>&nbsp;<span class="op" id="1572768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572771">n</span>&nbsp;<span class="op" id="1572773">:=</span>&nbsp;<span class="num" id="1572776">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572779">inField</span>&nbsp;<span class="op" id="1572787">:=</span>&nbsp;<span class="builtintype" id="1572790">false</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572797">for</span>&nbsp;<span class="ident" id="1572801">i</span>&nbsp;<span class="op" id="1572803">:=</span>&nbsp;<span class="num" id="1572806">0</span><span class="op" id="1572807">;</span>&nbsp;<span class="ident" id="1572809">i</span>&nbsp;<span class="op" id="1572811">&lt;</span>&nbsp;<span class="builtinfunc" id="1572813">len</span><span class="op" id="1572816">(</span><span class="ident" id="1572817">s</span><span class="op" id="1572818">)</span><span class="op" id="1572819">;</span>&nbsp;<span class="op" id="1572821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572825">r</span><span class="op" id="1572826">,</span>&nbsp;<span class="ident" id="1572828">size</span>&nbsp;<span class="op" id="1572833">:=</span>&nbsp;<span class="ident" id="1572836">utf8</span><span class="op" id="1572840">.</span><span class="ident" id="1572841">DecodeRune</span><span class="op" id="1572851">(</span><span class="ident" id="1572852">s</span><span class="op" id="1572853">[</span><span class="ident" id="1572854">i</span><span class="op" id="1572855">:</span><span class="op" id="1572856">]</span><span class="op" id="1572857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572861">wasInField</span>&nbsp;<span class="op" id="1572872">:=</span>&nbsp;<span class="ident" id="1572875">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572885">inField</span>&nbsp;<span class="op" id="1572893">=</span>&nbsp;<span class="op" id="1572895">!</span><span class="ident" id="1572896">f</span><span class="op" id="1572897">(</span><span class="ident" id="1572898">r</span><span class="op" id="1572899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1572903">if</span>&nbsp;<span class="ident" id="1572906">inField</span>&nbsp;<span class="op" id="1572914">&amp;&amp;</span>&nbsp;<span class="op" id="1572917">!</span><span class="ident" id="1572918">wasInField</span>&nbsp;<span class="op" id="1572929">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572934">n</span><span class="op" id="1572935">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572944">i</span>&nbsp;<span class="op" id="1572946">+=</span>&nbsp;<span class="ident" id="1572949">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1572955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572959">a</span>&nbsp;<span class="op" id="1572961">:=</span>&nbsp;<span class="builtinfunc" id="1572964">make</span><span class="op" id="1572968">(</span><span class="op" id="1572969">[</span><span class="op" id="1572970">]</span><span class="op" id="1572971">[</span><span class="op" id="1572972">]</span><span class="builtintype" id="1572973">byte</span><span class="op" id="1572977">,</span>&nbsp;<span class="ident" id="1572979">n</span><span class="op" id="1572980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572983">na</span>&nbsp;<span class="op" id="1572986">:=</span>&nbsp;<span class="num" id="1572989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1572992">fieldStart</span>&nbsp;<span class="op" id="1573003">:=</span>&nbsp;<span class="op" id="1573006">-</span><span class="num" id="1573007">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573010">for</span>&nbsp;<span class="ident" id="1573014">i</span>&nbsp;<span class="op" id="1573016">:=</span>&nbsp;<span class="num" id="1573019">0</span><span class="op" id="1573020">;</span>&nbsp;<span class="ident" id="1573022">i</span>&nbsp;<span class="op" id="1573024">&lt;=</span>&nbsp;<span class="builtinfunc" id="1573027">len</span><span class="op" id="1573030">(</span><span class="ident" id="1573031">s</span><span class="op" id="1573032">)</span>&nbsp;<span class="op" id="1573034">&amp;&amp;</span>&nbsp;<span class="ident" id="1573037">na</span>&nbsp;<span class="op" id="1573040">&lt;</span>&nbsp;<span class="ident" id="1573042">n</span><span class="op" id="1573043">;</span>&nbsp;<span class="op" id="1573045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573049">r</span><span class="op" id="1573050">,</span>&nbsp;<span class="ident" id="1573052">size</span>&nbsp;<span class="op" id="1573057">:=</span>&nbsp;<span class="ident" id="1573060">utf8</span><span class="op" id="1573064">.</span><span class="ident" id="1573065">DecodeRune</span><span class="op" id="1573075">(</span><span class="ident" id="1573076">s</span><span class="op" id="1573077">[</span><span class="ident" id="1573078">i</span><span class="op" id="1573079">:</span><span class="op" id="1573080">]</span><span class="op" id="1573081">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573085">if</span>&nbsp;<span class="ident" id="1573088">fieldStart</span>&nbsp;<span class="op" id="1573099">&lt;</span>&nbsp;<span class="num" id="1573101">0</span>&nbsp;<span class="op" id="1573103">&amp;&amp;</span>&nbsp;<span class="ident" id="1573106">size</span>&nbsp;<span class="op" id="1573111">&gt;</span>&nbsp;<span class="num" id="1573113">0</span>&nbsp;<span class="op" id="1573115">&amp;&amp;</span>&nbsp;<span class="op" id="1573118">!</span><span class="ident" id="1573119">f</span><span class="op" id="1573120">(</span><span class="ident" id="1573121">r</span><span class="op" id="1573122">)</span>&nbsp;<span class="op" id="1573124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573129">fieldStart</span>&nbsp;<span class="op" id="1573140">=</span>&nbsp;<span class="ident" id="1573142">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573147">i</span>&nbsp;<span class="op" id="1573149">+=</span>&nbsp;<span class="ident" id="1573152">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573160">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573171">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573175">if</span>&nbsp;<span class="ident" id="1573178">fieldStart</span>&nbsp;<span class="op" id="1573189">&gt;=</span>&nbsp;<span class="num" id="1573192">0</span>&nbsp;<span class="op" id="1573194">&amp;&amp;</span>&nbsp;<span class="op" id="1573197">(</span><span class="ident" id="1573198">size</span>&nbsp;<span class="op" id="1573203">==</span>&nbsp;<span class="num" id="1573206">0</span>&nbsp;<span class="op" id="1573208">||</span>&nbsp;<span class="ident" id="1573211">f</span><span class="op" id="1573212">(</span><span class="ident" id="1573213">r</span><span class="op" id="1573214">)</span><span class="op" id="1573215">)</span>&nbsp;<span class="op" id="1573217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573222">a</span><span class="op" id="1573223">[</span><span class="ident" id="1573224">na</span><span class="op" id="1573226">]</span>&nbsp;<span class="op" id="1573228">=</span>&nbsp;<span class="ident" id="1573230">s</span><span class="op" id="1573231">[</span><span class="ident" id="1573232">fieldStart</span><span class="op" id="1573242">:</span><span class="ident" id="1573243">i</span><span class="op" id="1573244">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573249">na</span><span class="op" id="1573251">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573257">fieldStart</span>&nbsp;<span class="op" id="1573268">=</span>&nbsp;<span class="op" id="1573270">-</span><span class="num" id="1573271">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573275">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573279">if</span>&nbsp;<span class="ident" id="1573282">size</span>&nbsp;<span class="op" id="1573287">==</span>&nbsp;<span class="num" id="1573290">0</span>&nbsp;<span class="op" id="1573292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573297">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573309">i</span>&nbsp;<span class="op" id="1573311">+=</span>&nbsp;<span class="ident" id="1573314">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573320">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573323">return</span>&nbsp;<span class="ident" id="1573330">a</span><span class="op" id="1573331">[</span><span class="num" id="1573332">0</span><span class="op" id="1573333">:</span><span class="ident" id="1573334">na</span><span class="op" id="1573336">]</span><br>
<span class="lineno"></span><span class="op" id="1573338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1573341">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;s&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice.&nbsp;The&nbsp;separator</span><br>
<span class="lineno"></span><span class="comment" id="1573422">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="1573480">func</span>&nbsp;<span class="ident" id="1573485">Join</span><span class="op" id="1573489">(</span><span class="ident" id="1573490">s</span>&nbsp;<span class="op" id="1573492">[</span><span class="op" id="1573493">]</span><span class="op" id="1573494">[</span><span class="op" id="1573495">]</span><span class="builtintype" id="1573496">byte</span><span class="op" id="1573500">,</span>&nbsp;<span class="ident" id="1573502">sep</span>&nbsp;<span class="op" id="1573506">[</span><span class="op" id="1573507">]</span><span class="builtintype" id="1573508">byte</span><span class="op" id="1573512">)</span>&nbsp;<span class="op" id="1573514">[</span><span class="op" id="1573515">]</span><span class="builtintype" id="1573516">byte</span>&nbsp;<span class="op" id="1573521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573524">if</span>&nbsp;<span class="builtinfunc" id="1573527">len</span><span class="op" id="1573530">(</span><span class="ident" id="1573531">s</span><span class="op" id="1573532">)</span>&nbsp;<span class="op" id="1573534">==</span>&nbsp;<span class="num" id="1573537">0</span>&nbsp;<span class="op" id="1573539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573543">return</span>&nbsp;<span class="op" id="1573550">[</span><span class="op" id="1573551">]</span><span class="builtintype" id="1573552">byte</span><span class="op" id="1573556">{</span><span class="op" id="1573557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573563">if</span>&nbsp;<span class="builtinfunc" id="1573566">len</span><span class="op" id="1573569">(</span><span class="ident" id="1573570">s</span><span class="op" id="1573571">)</span>&nbsp;<span class="op" id="1573573">==</span>&nbsp;<span class="num" id="1573576">1</span>&nbsp;<span class="op" id="1573578">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1573582">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573607">return</span>&nbsp;<span class="builtinfunc" id="1573614">append</span><span class="op" id="1573620">(</span><span class="op" id="1573621">[</span><span class="op" id="1573622">]</span><span class="builtintype" id="1573623">byte</span><span class="op" id="1573627">(</span><span class="ident" id="1573628">nil</span><span class="op" id="1573631">)</span><span class="op" id="1573632">,</span>&nbsp;<span class="ident" id="1573634">s</span><span class="op" id="1573635">[</span><span class="num" id="1573636">0</span><span class="op" id="1573637">]</span><span class="op" id="1573638">...</span><span class="op" id="1573641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573647">n</span>&nbsp;<span class="op" id="1573649">:=</span>&nbsp;<span class="builtinfunc" id="1573652">len</span><span class="op" id="1573655">(</span><span class="ident" id="1573656">sep</span><span class="op" id="1573659">)</span>&nbsp;<span class="op" id="1573661">*</span>&nbsp;<span class="op" id="1573663">(</span><span class="builtinfunc" id="1573664">len</span><span class="op" id="1573667">(</span><span class="ident" id="1573668">s</span><span class="op" id="1573669">)</span>&nbsp;<span class="op" id="1573671">-</span>&nbsp;<span class="num" id="1573673">1</span><span class="op" id="1573674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573677">for</span>&nbsp;<span class="ident" id="1573681">_</span><span class="op" id="1573682">,</span>&nbsp;<span class="ident" id="1573684">v</span>&nbsp;<span class="op" id="1573686">:=</span>&nbsp;<span class="keyword" id="1573689">range</span>&nbsp;<span class="ident" id="1573695">s</span>&nbsp;<span class="op" id="1573697">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573701">n</span>&nbsp;<span class="op" id="1573703">+=</span>&nbsp;<span class="builtinfunc" id="1573706">len</span><span class="op" id="1573709">(</span><span class="ident" id="1573710">v</span><span class="op" id="1573711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573718">b</span>&nbsp;<span class="op" id="1573720">:=</span>&nbsp;<span class="builtinfunc" id="1573723">make</span><span class="op" id="1573727">(</span><span class="op" id="1573728">[</span><span class="op" id="1573729">]</span><span class="builtintype" id="1573730">byte</span><span class="op" id="1573734">,</span>&nbsp;<span class="ident" id="1573736">n</span><span class="op" id="1573737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573740">bp</span>&nbsp;<span class="op" id="1573743">:=</span>&nbsp;<span class="builtinfunc" id="1573746">copy</span><span class="op" id="1573750">(</span><span class="ident" id="1573751">b</span><span class="op" id="1573752">,</span>&nbsp;<span class="ident" id="1573754">s</span><span class="op" id="1573755">[</span><span class="num" id="1573756">0</span><span class="op" id="1573757">]</span><span class="op" id="1573758">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573761">for</span>&nbsp;<span class="ident" id="1573765">_</span><span class="op" id="1573766">,</span>&nbsp;<span class="ident" id="1573768">v</span>&nbsp;<span class="op" id="1573770">:=</span>&nbsp;<span class="keyword" id="1573773">range</span>&nbsp;<span class="ident" id="1573779">s</span><span class="op" id="1573780">[</span><span class="num" id="1573781">1</span><span class="op" id="1573782">:</span><span class="op" id="1573783">]</span>&nbsp;<span class="op" id="1573785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573789">bp</span>&nbsp;<span class="op" id="1573792">+=</span>&nbsp;<span class="builtinfunc" id="1573795">copy</span><span class="op" id="1573799">(</span><span class="ident" id="1573800">b</span><span class="op" id="1573801">[</span><span class="ident" id="1573802">bp</span><span class="op" id="1573804">:</span><span class="op" id="1573805">]</span><span class="op" id="1573806">,</span>&nbsp;<span class="ident" id="1573808">sep</span><span class="op" id="1573811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1573815">bp</span>&nbsp;<span class="op" id="1573818">+=</span>&nbsp;<span class="builtinfunc" id="1573821">copy</span><span class="op" id="1573825">(</span><span class="ident" id="1573826">b</span><span class="op" id="1573827">[</span><span class="ident" id="1573828">bp</span><span class="op" id="1573830">:</span><span class="op" id="1573831">]</span><span class="op" id="1573832">,</span>&nbsp;<span class="ident" id="1573834">v</span><span class="op" id="1573835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1573838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573841">return</span>&nbsp;<span class="ident" id="1573848">b</span><br>
<span class="lineno">330</span><span class="op" id="1573850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1573853">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="1573917">func</span>&nbsp;<span class="ident" id="1573922">HasPrefix</span><span class="op" id="1573931">(</span><span class="ident" id="1573932">s</span><span class="op" id="1573933">,</span>&nbsp;<span class="ident" id="1573935">prefix</span>&nbsp;<span class="op" id="1573942">[</span><span class="op" id="1573943">]</span><span class="builtintype" id="1573944">byte</span><span class="op" id="1573948">)</span>&nbsp;<span class="builtintype" id="1573950">bool</span>&nbsp;<span class="op" id="1573955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1573958">return</span>&nbsp;<span class="builtinfunc" id="1573965">len</span><span class="op" id="1573968">(</span><span class="ident" id="1573969">s</span><span class="op" id="1573970">)</span>&nbsp;<span class="op" id="1573972">&gt;=</span>&nbsp;<span class="builtinfunc" id="1573975">len</span><span class="op" id="1573978">(</span><span class="ident" id="1573979">prefix</span><span class="op" id="1573985">)</span>&nbsp;<span class="op" id="1573987">&amp;&amp;</span>&nbsp;<span class="ident" id="1573990">Equal</span><span class="op" id="1573995">(</span><span class="ident" id="1573996">s</span><span class="op" id="1573997">[</span><span class="num" id="1573998">0</span><span class="op" id="1573999">:</span><span class="builtinfunc" id="1574000">len</span><span class="op" id="1574003">(</span><span class="ident" id="1574004">prefix</span><span class="op" id="1574010">)</span><span class="op" id="1574011">]</span><span class="op" id="1574012">,</span>&nbsp;<span class="ident" id="1574014">prefix</span><span class="op" id="1574020">)</span><br>
<span class="lineno">335</span><span class="op" id="1574022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1574025">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="1574087">func</span>&nbsp;<span class="ident" id="1574092">HasSuffix</span><span class="op" id="1574101">(</span><span class="ident" id="1574102">s</span><span class="op" id="1574103">,</span>&nbsp;<span class="ident" id="1574105">suffix</span>&nbsp;<span class="op" id="1574112">[</span><span class="op" id="1574113">]</span><span class="builtintype" id="1574114">byte</span><span class="op" id="1574118">)</span>&nbsp;<span class="builtintype" id="1574120">bool</span>&nbsp;<span class="op" id="1574125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1574128">return</span>&nbsp;<span class="builtinfunc" id="1574135">len</span><span class="op" id="1574138">(</span><span class="ident" id="1574139">s</span><span class="op" id="1574140">)</span>&nbsp;<span class="op" id="1574142">&gt;=</span>&nbsp;<span class="builtinfunc" id="1574145">len</span><span class="op" id="1574148">(</span><span class="ident" id="1574149">suffix</span><span class="op" id="1574155">)</span>&nbsp;<span class="op" id="1574157">&amp;&amp;</span>&nbsp;<span class="ident" id="1574160">Equal</span><span class="op" id="1574165">(</span><span class="ident" id="1574166">s</span><span class="op" id="1574167">[</span><span class="builtinfunc" id="1574168">len</span><span class="op" id="1574171">(</span><span class="ident" id="1574172">s</span><span class="op" id="1574173">)</span><span class="op" id="1574174">-</span><span class="builtinfunc" id="1574175">len</span><span class="op" id="1574178">(</span><span class="ident" id="1574179">suffix</span><span class="op" id="1574185">)</span><span class="op" id="1574186">:</span><span class="op" id="1574187">]</span><span class="op" id="1574188">,</span>&nbsp;<span class="ident" id="1574190">suffix</span><span class="op" id="1574196">)</span><br>
<span class="lineno">340</span><span class="op" id="1574198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1574201">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="1574276">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1574368">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.&nbsp;&nbsp;The&nbsp;characters&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno">345</span><span class="comment" id="1574445">//&nbsp;output&nbsp;are&nbsp;interpreted&nbsp;as&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="1574509">func</span>&nbsp;<span class="ident" id="1574514">Map</span><span class="op" id="1574517">(</span><span class="ident" id="1574518">mapping</span>&nbsp;<span class="keyword" id="1574526">func</span><span class="op" id="1574530">(</span><span class="ident" id="1574531">r</span>&nbsp;<span class="builtintype" id="1574533">rune</span><span class="op" id="1574537">)</span>&nbsp;<span class="builtintype" id="1574539">rune</span><span class="op" id="1574543">,</span>&nbsp;<span class="ident" id="1574545">s</span>&nbsp;<span class="op" id="1574547">[</span><span class="op" id="1574548">]</span><span class="builtintype" id="1574549">byte</span><span class="op" id="1574553">)</span>&nbsp;<span class="op" id="1574555">[</span><span class="op" id="1574556">]</span><span class="builtintype" id="1574557">byte</span>&nbsp;<span class="op" id="1574562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1574565">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;slice&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1574627">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1574694">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574756">maxbytes</span>&nbsp;<span class="op" id="1574765">:=</span>&nbsp;<span class="builtinfunc" id="1574768">len</span><span class="op" id="1574771">(</span><span class="ident" id="1574772">s</span><span class="op" id="1574773">)</span>&nbsp;<span class="comment" id="1574775">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574791">nbytes</span>&nbsp;<span class="op" id="1574798">:=</span>&nbsp;<span class="num" id="1574801">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574810">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574843">b</span>&nbsp;<span class="op" id="1574845">:=</span>&nbsp;<span class="builtinfunc" id="1574848">make</span><span class="op" id="1574852">(</span><span class="op" id="1574853">[</span><span class="op" id="1574854">]</span><span class="builtintype" id="1574855">byte</span><span class="op" id="1574859">,</span>&nbsp;<span class="ident" id="1574861">maxbytes</span><span class="op" id="1574869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1574872">for</span>&nbsp;<span class="ident" id="1574876">i</span>&nbsp;<span class="op" id="1574878">:=</span>&nbsp;<span class="num" id="1574881">0</span><span class="op" id="1574882">;</span>&nbsp;<span class="ident" id="1574884">i</span>&nbsp;<span class="op" id="1574886">&lt;</span>&nbsp;<span class="builtinfunc" id="1574888">len</span><span class="op" id="1574891">(</span><span class="ident" id="1574892">s</span><span class="op" id="1574893">)</span><span class="op" id="1574894">;</span>&nbsp;<span class="op" id="1574896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574900">wid</span>&nbsp;<span class="op" id="1574904">:=</span>&nbsp;<span class="num" id="1574907">1</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574911">r</span>&nbsp;<span class="op" id="1574913">:=</span>&nbsp;<span class="builtintype" id="1574916">rune</span><span class="op" id="1574920">(</span><span class="ident" id="1574921">s</span><span class="op" id="1574922">[</span><span class="ident" id="1574923">i</span><span class="op" id="1574924">]</span><span class="op" id="1574925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1574929">if</span>&nbsp;<span class="ident" id="1574932">r</span>&nbsp;<span class="op" id="1574934">&gt;=</span>&nbsp;<span class="ident" id="1574937">utf8</span><span class="op" id="1574941">.</span><span class="ident" id="1574942">RuneSelf</span>&nbsp;<span class="op" id="1574951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574956">r</span><span class="op" id="1574957">,</span>&nbsp;<span class="ident" id="1574959">wid</span>&nbsp;<span class="op" id="1574963">=</span>&nbsp;<span class="ident" id="1574965">utf8</span><span class="op" id="1574969">.</span><span class="ident" id="1574970">DecodeRune</span><span class="op" id="1574980">(</span><span class="ident" id="1574981">s</span><span class="op" id="1574982">[</span><span class="ident" id="1574983">i</span><span class="op" id="1574984">:</span><span class="op" id="1574985">]</span><span class="op" id="1574986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1574990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1574994">r</span>&nbsp;<span class="op" id="1574996">=</span>&nbsp;<span class="ident" id="1574998">mapping</span><span class="op" id="1575005">(</span><span class="ident" id="1575006">r</span><span class="op" id="1575007">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575011">if</span>&nbsp;<span class="ident" id="1575014">r</span>&nbsp;<span class="op" id="1575016">&gt;=</span>&nbsp;<span class="num" id="1575019">0</span>&nbsp;<span class="op" id="1575021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575026">rl</span>&nbsp;<span class="op" id="1575029">:=</span>&nbsp;<span class="ident" id="1575032">utf8</span><span class="op" id="1575036">.</span><span class="ident" id="1575037">RuneLen</span><span class="op" id="1575044">(</span><span class="ident" id="1575045">r</span><span class="op" id="1575046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575051">if</span>&nbsp;<span class="ident" id="1575054">rl</span>&nbsp;<span class="op" id="1575057">&lt;</span>&nbsp;<span class="num" id="1575059">0</span>&nbsp;<span class="op" id="1575061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575067">rl</span>&nbsp;<span class="op" id="1575070">=</span>&nbsp;<span class="builtinfunc" id="1575072">len</span><span class="op" id="1575075">(</span><span class="builtintype" id="1575076">string</span><span class="op" id="1575082">(</span><span class="ident" id="1575083">utf8</span><span class="op" id="1575087">.</span><span class="ident" id="1575088">RuneError</span><span class="op" id="1575097">)</span><span class="op" id="1575098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1575103">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575108">if</span>&nbsp;<span class="ident" id="1575111">nbytes</span><span class="op" id="1575117">+</span><span class="ident" id="1575118">rl</span>&nbsp;<span class="op" id="1575121">&gt;</span>&nbsp;<span class="ident" id="1575123">maxbytes</span>&nbsp;<span class="op" id="1575132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1575138">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575162">maxbytes</span>&nbsp;<span class="op" id="1575171">=</span>&nbsp;<span class="ident" id="1575173">maxbytes</span><span class="op" id="1575181">*</span><span class="num" id="1575182">2</span>&nbsp;<span class="op" id="1575184">+</span>&nbsp;<span class="ident" id="1575186">utf8</span><span class="op" id="1575190">.</span><span class="ident" id="1575191">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575202">nb</span>&nbsp;<span class="op" id="1575205">:=</span>&nbsp;<span class="builtinfunc" id="1575208">make</span><span class="op" id="1575212">(</span><span class="op" id="1575213">[</span><span class="op" id="1575214">]</span><span class="builtintype" id="1575215">byte</span><span class="op" id="1575219">,</span>&nbsp;<span class="ident" id="1575221">maxbytes</span><span class="op" id="1575229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1575235">copy</span><span class="op" id="1575239">(</span><span class="ident" id="1575240">nb</span><span class="op" id="1575242">,</span>&nbsp;<span class="ident" id="1575244">b</span><span class="op" id="1575245">[</span><span class="num" id="1575246">0</span><span class="op" id="1575247">:</span><span class="ident" id="1575248">nbytes</span><span class="op" id="1575254">]</span><span class="op" id="1575255">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575261">b</span>&nbsp;<span class="op" id="1575263">=</span>&nbsp;<span class="ident" id="1575265">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1575271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575276">nbytes</span>&nbsp;<span class="op" id="1575283">+=</span>&nbsp;<span class="ident" id="1575286">utf8</span><span class="op" id="1575290">.</span><span class="ident" id="1575291">EncodeRune</span><span class="op" id="1575301">(</span><span class="ident" id="1575302">b</span><span class="op" id="1575303">[</span><span class="ident" id="1575304">nbytes</span><span class="op" id="1575310">:</span><span class="ident" id="1575311">maxbytes</span><span class="op" id="1575319">]</span><span class="op" id="1575320">,</span>&nbsp;<span class="ident" id="1575322">r</span><span class="op" id="1575323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1575327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575331">i</span>&nbsp;<span class="op" id="1575333">+=</span>&nbsp;<span class="ident" id="1575336">wid</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1575341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575344">return</span>&nbsp;<span class="ident" id="1575351">b</span><span class="op" id="1575352">[</span><span class="num" id="1575353">0</span><span class="op" id="1575354">:</span><span class="ident" id="1575355">nbytes</span><span class="op" id="1575361">]</span><br>
<span class="lineno"></span><span class="op" id="1575363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1575366">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;b.</span><br>
<span class="lineno">380</span><span class="keyword" id="1575434">func</span>&nbsp;<span class="ident" id="1575439">Repeat</span><span class="op" id="1575445">(</span><span class="ident" id="1575446">b</span>&nbsp;<span class="op" id="1575448">[</span><span class="op" id="1575449">]</span><span class="builtintype" id="1575450">byte</span><span class="op" id="1575454">,</span>&nbsp;<span class="ident" id="1575456">count</span>&nbsp;<span class="builtintype" id="1575462">int</span><span class="op" id="1575465">)</span>&nbsp;<span class="op" id="1575467">[</span><span class="op" id="1575468">]</span><span class="builtintype" id="1575469">byte</span>&nbsp;<span class="op" id="1575474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575477">nb</span>&nbsp;<span class="op" id="1575480">:=</span>&nbsp;<span class="builtinfunc" id="1575483">make</span><span class="op" id="1575487">(</span><span class="op" id="1575488">[</span><span class="op" id="1575489">]</span><span class="builtintype" id="1575490">byte</span><span class="op" id="1575494">,</span>&nbsp;<span class="builtinfunc" id="1575496">len</span><span class="op" id="1575499">(</span><span class="ident" id="1575500">b</span><span class="op" id="1575501">)</span><span class="op" id="1575502">*</span><span class="ident" id="1575503">count</span><span class="op" id="1575508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575511">bp</span>&nbsp;<span class="op" id="1575514">:=</span>&nbsp;<span class="builtinfunc" id="1575517">copy</span><span class="op" id="1575521">(</span><span class="ident" id="1575522">nb</span><span class="op" id="1575524">,</span>&nbsp;<span class="ident" id="1575526">b</span><span class="op" id="1575527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575530">for</span>&nbsp;<span class="ident" id="1575534">bp</span>&nbsp;<span class="op" id="1575537">&lt;</span>&nbsp;<span class="builtinfunc" id="1575539">len</span><span class="op" id="1575542">(</span><span class="ident" id="1575543">nb</span><span class="op" id="1575545">)</span>&nbsp;<span class="op" id="1575547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1575551">copy</span><span class="op" id="1575555">(</span><span class="ident" id="1575556">nb</span><span class="op" id="1575558">[</span><span class="ident" id="1575559">bp</span><span class="op" id="1575561">:</span><span class="op" id="1575562">]</span><span class="op" id="1575563">,</span>&nbsp;<span class="ident" id="1575565">nb</span><span class="op" id="1575567">[</span><span class="op" id="1575568">:</span><span class="ident" id="1575569">bp</span><span class="op" id="1575571">]</span><span class="op" id="1575572">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1575576">bp</span>&nbsp;<span class="op" id="1575579">*=</span>&nbsp;<span class="num" id="1575582">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1575585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1575588">return</span>&nbsp;<span class="ident" id="1575595">nb</span><br>
<span class="lineno"></span><span class="op" id="1575598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="1575601">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1575700">func</span>&nbsp;<span class="ident" id="1575705">ToUpper</span><span class="op" id="1575712">(</span><span class="ident" id="1575713">s</span>&nbsp;<span class="op" id="1575715">[</span><span class="op" id="1575716">]</span><span class="builtintype" id="1575717">byte</span><span class="op" id="1575721">)</span>&nbsp;<span class="op" id="1575723">[</span><span class="op" id="1575724">]</span><span class="builtintype" id="1575725">byte</span>&nbsp;<span class="op" id="1575730">{</span>&nbsp;<span class="keyword" id="1575732">return</span>&nbsp;<span class="ident" id="1575739">Map</span><span class="op" id="1575742">(</span><span class="ident" id="1575743">unicode</span><span class="op" id="1575750">.</span><span class="ident" id="1575751">ToUpper</span><span class="op" id="1575758">,</span>&nbsp;<span class="ident" id="1575760">s</span><span class="op" id="1575761">)</span>&nbsp;<span class="op" id="1575763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1575766">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1575865">func</span>&nbsp;<span class="ident" id="1575870">ToLower</span><span class="op" id="1575877">(</span><span class="ident" id="1575878">s</span>&nbsp;<span class="op" id="1575880">[</span><span class="op" id="1575881">]</span><span class="builtintype" id="1575882">byte</span><span class="op" id="1575886">)</span>&nbsp;<span class="op" id="1575888">[</span><span class="op" id="1575889">]</span><span class="builtintype" id="1575890">byte</span>&nbsp;<span class="op" id="1575895">{</span>&nbsp;<span class="keyword" id="1575897">return</span>&nbsp;<span class="ident" id="1575904">Map</span><span class="op" id="1575907">(</span><span class="ident" id="1575908">unicode</span><span class="op" id="1575915">.</span><span class="ident" id="1575916">ToLower</span><span class="op" id="1575923">,</span>&nbsp;<span class="ident" id="1575925">s</span><span class="op" id="1575926">)</span>&nbsp;<span class="op" id="1575928">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1575931">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1576030">func</span>&nbsp;<span class="ident" id="1576035">ToTitle</span><span class="op" id="1576042">(</span><span class="ident" id="1576043">s</span>&nbsp;<span class="op" id="1576045">[</span><span class="op" id="1576046">]</span><span class="builtintype" id="1576047">byte</span><span class="op" id="1576051">)</span>&nbsp;<span class="op" id="1576053">[</span><span class="op" id="1576054">]</span><span class="builtintype" id="1576055">byte</span>&nbsp;<span class="op" id="1576060">{</span>&nbsp;<span class="keyword" id="1576062">return</span>&nbsp;<span class="ident" id="1576069">Map</span><span class="op" id="1576072">(</span><span class="ident" id="1576073">unicode</span><span class="op" id="1576080">.</span><span class="ident" id="1576081">ToTitle</span><span class="op" id="1576088">,</span>&nbsp;<span class="ident" id="1576090">s</span><span class="op" id="1576091">)</span>&nbsp;<span class="op" id="1576093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1576096">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno">400</span><span class="comment" id="1576190">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1576250">func</span>&nbsp;<span class="ident" id="1576255">ToUpperSpecial</span><span class="op" id="1576269">(</span><span class="ident" id="1576270">_case</span>&nbsp;<span class="ident" id="1576276">unicode</span><span class="op" id="1576283">.</span><span class="ident" id="1576284">SpecialCase</span><span class="op" id="1576295">,</span>&nbsp;<span class="ident" id="1576297">s</span>&nbsp;<span class="op" id="1576299">[</span><span class="op" id="1576300">]</span><span class="builtintype" id="1576301">byte</span><span class="op" id="1576305">)</span>&nbsp;<span class="op" id="1576307">[</span><span class="op" id="1576308">]</span><span class="builtintype" id="1576309">byte</span>&nbsp;<span class="op" id="1576314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1576317">return</span>&nbsp;<span class="ident" id="1576324">Map</span><span class="op" id="1576327">(</span><span class="keyword" id="1576328">func</span><span class="op" id="1576332">(</span><span class="ident" id="1576333">r</span>&nbsp;<span class="builtintype" id="1576335">rune</span><span class="op" id="1576339">)</span>&nbsp;<span class="builtintype" id="1576341">rune</span>&nbsp;<span class="op" id="1576346">{</span>&nbsp;<span class="keyword" id="1576348">return</span>&nbsp;<span class="ident" id="1576355">_case</span><span class="op" id="1576360">.</span><span class="ident" id="1576361">ToUpper</span><span class="op" id="1576368">(</span><span class="ident" id="1576369">r</span><span class="op" id="1576370">)</span>&nbsp;<span class="op" id="1576372">}</span><span class="op" id="1576373">,</span>&nbsp;<span class="ident" id="1576375">s</span><span class="op" id="1576376">)</span><br>
<span class="lineno"></span><span class="op" id="1576378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="1576381">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="1576475">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1576535">func</span>&nbsp;<span class="ident" id="1576540">ToLowerSpecial</span><span class="op" id="1576554">(</span><span class="ident" id="1576555">_case</span>&nbsp;<span class="ident" id="1576561">unicode</span><span class="op" id="1576568">.</span><span class="ident" id="1576569">SpecialCase</span><span class="op" id="1576580">,</span>&nbsp;<span class="ident" id="1576582">s</span>&nbsp;<span class="op" id="1576584">[</span><span class="op" id="1576585">]</span><span class="builtintype" id="1576586">byte</span><span class="op" id="1576590">)</span>&nbsp;<span class="op" id="1576592">[</span><span class="op" id="1576593">]</span><span class="builtintype" id="1576594">byte</span>&nbsp;<span class="op" id="1576599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1576602">return</span>&nbsp;<span class="ident" id="1576609">Map</span><span class="op" id="1576612">(</span><span class="keyword" id="1576613">func</span><span class="op" id="1576617">(</span><span class="ident" id="1576618">r</span>&nbsp;<span class="builtintype" id="1576620">rune</span><span class="op" id="1576624">)</span>&nbsp;<span class="builtintype" id="1576626">rune</span>&nbsp;<span class="op" id="1576631">{</span>&nbsp;<span class="keyword" id="1576633">return</span>&nbsp;<span class="ident" id="1576640">_case</span><span class="op" id="1576645">.</span><span class="ident" id="1576646">ToLower</span><span class="op" id="1576653">(</span><span class="ident" id="1576654">r</span><span class="op" id="1576655">)</span>&nbsp;<span class="op" id="1576657">}</span><span class="op" id="1576658">,</span>&nbsp;<span class="ident" id="1576660">s</span><span class="op" id="1576661">)</span><br>
<span class="lineno"></span><span class="op" id="1576663">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="1576666">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="1576760">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1576820">func</span>&nbsp;<span class="ident" id="1576825">ToTitleSpecial</span><span class="op" id="1576839">(</span><span class="ident" id="1576840">_case</span>&nbsp;<span class="ident" id="1576846">unicode</span><span class="op" id="1576853">.</span><span class="ident" id="1576854">SpecialCase</span><span class="op" id="1576865">,</span>&nbsp;<span class="ident" id="1576867">s</span>&nbsp;<span class="op" id="1576869">[</span><span class="op" id="1576870">]</span><span class="builtintype" id="1576871">byte</span><span class="op" id="1576875">)</span>&nbsp;<span class="op" id="1576877">[</span><span class="op" id="1576878">]</span><span class="builtintype" id="1576879">byte</span>&nbsp;<span class="op" id="1576884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1576887">return</span>&nbsp;<span class="ident" id="1576894">Map</span><span class="op" id="1576897">(</span><span class="keyword" id="1576898">func</span><span class="op" id="1576902">(</span><span class="ident" id="1576903">r</span>&nbsp;<span class="builtintype" id="1576905">rune</span><span class="op" id="1576909">)</span>&nbsp;<span class="builtintype" id="1576911">rune</span>&nbsp;<span class="op" id="1576916">{</span>&nbsp;<span class="keyword" id="1576918">return</span>&nbsp;<span class="ident" id="1576925">_case</span><span class="op" id="1576930">.</span><span class="ident" id="1576931">ToTitle</span><span class="op" id="1576938">(</span><span class="ident" id="1576939">r</span><span class="op" id="1576940">)</span>&nbsp;<span class="op" id="1576942">}</span><span class="op" id="1576943">,</span>&nbsp;<span class="ident" id="1576945">s</span><span class="op" id="1576946">)</span><br>
<span class="lineno">415</span><span class="op" id="1576948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1576951">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="comment" id="1577019">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="1577089">func</span>&nbsp;<span class="ident" id="1577094">isSeparator</span><span class="op" id="1577105">(</span><span class="ident" id="1577106">r</span>&nbsp;<span class="builtintype" id="1577108">rune</span><span class="op" id="1577112">)</span>&nbsp;<span class="builtintype" id="1577114">bool</span>&nbsp;<span class="op" id="1577119">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577122">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577180">if</span>&nbsp;<span class="ident" id="1577183">r</span>&nbsp;<span class="op" id="1577185">&lt;=</span>&nbsp;<span class="num" id="1577188">0x7F</span>&nbsp;<span class="op" id="1577193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577197">switch</span>&nbsp;<span class="op" id="1577204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577208">case</span>&nbsp;<span class="string" id="1577213">&#39;0&#39;</span>&nbsp;<span class="op" id="1577217">&lt;=</span>&nbsp;<span class="ident" id="1577220">r</span>&nbsp;<span class="op" id="1577222">&amp;&amp;</span>&nbsp;<span class="ident" id="1577225">r</span>&nbsp;<span class="op" id="1577227">&lt;=</span>&nbsp;<span class="string" id="1577230">&#39;9&#39;</span><span class="op" id="1577233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577238">return</span>&nbsp;<span class="builtintype" id="1577245">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577253">case</span>&nbsp;<span class="string" id="1577258">&#39;a&#39;</span>&nbsp;<span class="op" id="1577262">&lt;=</span>&nbsp;<span class="ident" id="1577265">r</span>&nbsp;<span class="op" id="1577267">&amp;&amp;</span>&nbsp;<span class="ident" id="1577270">r</span>&nbsp;<span class="op" id="1577272">&lt;=</span>&nbsp;<span class="string" id="1577275">&#39;z&#39;</span><span class="op" id="1577278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577283">return</span>&nbsp;<span class="builtintype" id="1577290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577298">case</span>&nbsp;<span class="string" id="1577303">&#39;A&#39;</span>&nbsp;<span class="op" id="1577307">&lt;=</span>&nbsp;<span class="ident" id="1577310">r</span>&nbsp;<span class="op" id="1577312">&amp;&amp;</span>&nbsp;<span class="ident" id="1577315">r</span>&nbsp;<span class="op" id="1577317">&lt;=</span>&nbsp;<span class="string" id="1577320">&#39;Z&#39;</span><span class="op" id="1577323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577328">return</span>&nbsp;<span class="builtintype" id="1577335">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577343">case</span>&nbsp;<span class="ident" id="1577348">r</span>&nbsp;<span class="op" id="1577350">==</span>&nbsp;<span class="string" id="1577353">&#39;_&#39;</span><span class="op" id="1577356">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577361">return</span>&nbsp;<span class="builtintype" id="1577368">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1577376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577380">return</span>&nbsp;<span class="builtintype" id="1577387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1577393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577396">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577438">if</span>&nbsp;<span class="ident" id="1577441">unicode</span><span class="op" id="1577448">.</span><span class="ident" id="1577449">IsLetter</span><span class="op" id="1577457">(</span><span class="ident" id="1577458">r</span><span class="op" id="1577459">)</span>&nbsp;<span class="op" id="1577461">||</span>&nbsp;<span class="ident" id="1577464">unicode</span><span class="op" id="1577471">.</span><span class="ident" id="1577472">IsDigit</span><span class="op" id="1577479">(</span><span class="ident" id="1577480">r</span><span class="op" id="1577481">)</span>&nbsp;<span class="op" id="1577483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577487">return</span>&nbsp;<span class="builtintype" id="1577494">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1577501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577504">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577572">return</span>&nbsp;<span class="ident" id="1577579">unicode</span><span class="op" id="1577586">.</span><span class="ident" id="1577587">IsSpace</span><span class="op" id="1577594">(</span><span class="ident" id="1577595">r</span><span class="op" id="1577596">)</span><br>
<span class="lineno">440</span><span class="op" id="1577598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1577601">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno"></span><span class="comment" id="1577672">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="1577703">//</span><br>
<span class="lineno">445</span><span class="comment" id="1577706">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="1577800">func</span>&nbsp;<span class="ident" id="1577805">Title</span><span class="op" id="1577810">(</span><span class="ident" id="1577811">s</span>&nbsp;<span class="op" id="1577813">[</span><span class="op" id="1577814">]</span><span class="builtintype" id="1577815">byte</span><span class="op" id="1577819">)</span>&nbsp;<span class="op" id="1577821">[</span><span class="op" id="1577822">]</span><span class="builtintype" id="1577823">byte</span>&nbsp;<span class="op" id="1577828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577831">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577873">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1577945">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1577976">prev</span>&nbsp;<span class="op" id="1577981">:=</span>&nbsp;<span class="string" id="1577984">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1577989">return</span>&nbsp;<span class="ident" id="1577996">Map</span><span class="op" id="1577999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578003">func</span><span class="op" id="1578007">(</span><span class="ident" id="1578008">r</span>&nbsp;<span class="builtintype" id="1578010">rune</span><span class="op" id="1578014">)</span>&nbsp;<span class="builtintype" id="1578016">rune</span>&nbsp;<span class="op" id="1578021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578026">if</span>&nbsp;<span class="ident" id="1578029">isSeparator</span><span class="op" id="1578040">(</span><span class="ident" id="1578041">prev</span><span class="op" id="1578045">)</span>&nbsp;<span class="op" id="1578047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578053">prev</span>&nbsp;<span class="op" id="1578058">=</span>&nbsp;<span class="ident" id="1578060">r</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578066">return</span>&nbsp;<span class="ident" id="1578073">unicode</span><span class="op" id="1578080">.</span><span class="ident" id="1578081">ToTitle</span><span class="op" id="1578088">(</span><span class="ident" id="1578089">r</span><span class="op" id="1578090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1578095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578100">prev</span>&nbsp;<span class="op" id="1578105">=</span>&nbsp;<span class="ident" id="1578107">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578112">return</span>&nbsp;<span class="ident" id="1578119">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1578123">}</span><span class="op" id="1578124">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578128">s</span><span class="op" id="1578129">)</span><br>
<span class="lineno"></span><span class="op" id="1578131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1578134">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1578215">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">465</span><span class="keyword" id="1578259">func</span>&nbsp;<span class="ident" id="1578264">TrimLeftFunc</span><span class="op" id="1578276">(</span><span class="ident" id="1578277">s</span>&nbsp;<span class="op" id="1578279">[</span><span class="op" id="1578280">]</span><span class="builtintype" id="1578281">byte</span><span class="op" id="1578285">,</span>&nbsp;<span class="ident" id="1578287">f</span>&nbsp;<span class="keyword" id="1578289">func</span><span class="op" id="1578293">(</span><span class="ident" id="1578294">r</span>&nbsp;<span class="builtintype" id="1578296">rune</span><span class="op" id="1578300">)</span>&nbsp;<span class="builtintype" id="1578302">bool</span><span class="op" id="1578306">)</span>&nbsp;<span class="op" id="1578308">[</span><span class="op" id="1578309">]</span><span class="builtintype" id="1578310">byte</span>&nbsp;<span class="op" id="1578315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578318">i</span>&nbsp;<span class="op" id="1578320">:=</span>&nbsp;<span class="ident" id="1578323">indexFunc</span><span class="op" id="1578332">(</span><span class="ident" id="1578333">s</span><span class="op" id="1578334">,</span>&nbsp;<span class="ident" id="1578336">f</span><span class="op" id="1578337">,</span>&nbsp;<span class="builtintype" id="1578339">false</span><span class="op" id="1578344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578347">if</span>&nbsp;<span class="ident" id="1578350">i</span>&nbsp;<span class="op" id="1578352">==</span>&nbsp;<span class="op" id="1578355">-</span><span class="num" id="1578356">1</span>&nbsp;<span class="op" id="1578358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578362">return</span>&nbsp;<span class="ident" id="1578369">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1578374">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578377">return</span>&nbsp;<span class="ident" id="1578384">s</span><span class="op" id="1578385">[</span><span class="ident" id="1578386">i</span><span class="op" id="1578387">:</span><span class="op" id="1578388">]</span><br>
<span class="lineno"></span><span class="op" id="1578390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1578393">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing&nbsp;UTF-8</span><br>
<span class="lineno"></span><span class="comment" id="1578468">//&nbsp;encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">475</span><span class="keyword" id="1578520">func</span>&nbsp;<span class="ident" id="1578525">TrimRightFunc</span><span class="op" id="1578538">(</span><span class="ident" id="1578539">s</span>&nbsp;<span class="op" id="1578541">[</span><span class="op" id="1578542">]</span><span class="builtintype" id="1578543">byte</span><span class="op" id="1578547">,</span>&nbsp;<span class="ident" id="1578549">f</span>&nbsp;<span class="keyword" id="1578551">func</span><span class="op" id="1578555">(</span><span class="ident" id="1578556">r</span>&nbsp;<span class="builtintype" id="1578558">rune</span><span class="op" id="1578562">)</span>&nbsp;<span class="builtintype" id="1578564">bool</span><span class="op" id="1578568">)</span>&nbsp;<span class="op" id="1578570">[</span><span class="op" id="1578571">]</span><span class="builtintype" id="1578572">byte</span>&nbsp;<span class="op" id="1578577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578580">i</span>&nbsp;<span class="op" id="1578582">:=</span>&nbsp;<span class="ident" id="1578585">lastIndexFunc</span><span class="op" id="1578598">(</span><span class="ident" id="1578599">s</span><span class="op" id="1578600">,</span>&nbsp;<span class="ident" id="1578602">f</span><span class="op" id="1578603">,</span>&nbsp;<span class="builtintype" id="1578605">false</span><span class="op" id="1578610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578613">if</span>&nbsp;<span class="ident" id="1578616">i</span>&nbsp;<span class="op" id="1578618">&gt;=</span>&nbsp;<span class="num" id="1578621">0</span>&nbsp;<span class="op" id="1578623">&amp;&amp;</span>&nbsp;<span class="ident" id="1578626">s</span><span class="op" id="1578627">[</span><span class="ident" id="1578628">i</span><span class="op" id="1578629">]</span>&nbsp;<span class="op" id="1578631">&gt;=</span>&nbsp;<span class="ident" id="1578634">utf8</span><span class="op" id="1578638">.</span><span class="ident" id="1578639">RuneSelf</span>&nbsp;<span class="op" id="1578648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578652">_</span><span class="op" id="1578653">,</span>&nbsp;<span class="ident" id="1578655">wid</span>&nbsp;<span class="op" id="1578659">:=</span>&nbsp;<span class="ident" id="1578662">utf8</span><span class="op" id="1578666">.</span><span class="ident" id="1578667">DecodeRune</span><span class="op" id="1578677">(</span><span class="ident" id="1578678">s</span><span class="op" id="1578679">[</span><span class="ident" id="1578680">i</span><span class="op" id="1578681">:</span><span class="op" id="1578682">]</span><span class="op" id="1578683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578687">i</span>&nbsp;<span class="op" id="1578689">+=</span>&nbsp;<span class="ident" id="1578692">wid</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1578697">}</span>&nbsp;<span class="keyword" id="1578699">else</span>&nbsp;<span class="op" id="1578704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1578708">i</span><span class="op" id="1578709">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1578713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578716">return</span>&nbsp;<span class="ident" id="1578723">s</span><span class="op" id="1578724">[</span><span class="num" id="1578725">0</span><span class="op" id="1578726">:</span><span class="ident" id="1578727">i</span><span class="op" id="1578728">]</span><br>
<span class="lineno"></span><span class="op" id="1578730">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1578733">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="1578809">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="keyword" id="1578867">func</span>&nbsp;<span class="ident" id="1578872">TrimFunc</span><span class="op" id="1578880">(</span><span class="ident" id="1578881">s</span>&nbsp;<span class="op" id="1578883">[</span><span class="op" id="1578884">]</span><span class="builtintype" id="1578885">byte</span><span class="op" id="1578889">,</span>&nbsp;<span class="ident" id="1578891">f</span>&nbsp;<span class="keyword" id="1578893">func</span><span class="op" id="1578897">(</span><span class="ident" id="1578898">r</span>&nbsp;<span class="builtintype" id="1578900">rune</span><span class="op" id="1578904">)</span>&nbsp;<span class="builtintype" id="1578906">bool</span><span class="op" id="1578910">)</span>&nbsp;<span class="op" id="1578912">[</span><span class="op" id="1578913">]</span><span class="builtintype" id="1578914">byte</span>&nbsp;<span class="op" id="1578919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1578922">return</span>&nbsp;<span class="ident" id="1578929">TrimRightFunc</span><span class="op" id="1578942">(</span><span class="ident" id="1578943">TrimLeftFunc</span><span class="op" id="1578955">(</span><span class="ident" id="1578956">s</span><span class="op" id="1578957">,</span>&nbsp;<span class="ident" id="1578959">f</span><span class="op" id="1578960">)</span><span class="op" id="1578961">,</span>&nbsp;<span class="ident" id="1578963">f</span><span class="op" id="1578964">)</span><br>
<span class="lineno">490</span><span class="op" id="1578966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1578969">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1579037">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="1579097">func</span>&nbsp;<span class="ident" id="1579102">TrimPrefix</span><span class="op" id="1579112">(</span><span class="ident" id="1579113">s</span><span class="op" id="1579114">,</span>&nbsp;<span class="ident" id="1579116">prefix</span>&nbsp;<span class="op" id="1579123">[</span><span class="op" id="1579124">]</span><span class="builtintype" id="1579125">byte</span><span class="op" id="1579129">)</span>&nbsp;<span class="op" id="1579131">[</span><span class="op" id="1579132">]</span><span class="builtintype" id="1579133">byte</span>&nbsp;<span class="op" id="1579138">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579141">if</span>&nbsp;<span class="ident" id="1579144">HasPrefix</span><span class="op" id="1579153">(</span><span class="ident" id="1579154">s</span><span class="op" id="1579155">,</span>&nbsp;<span class="ident" id="1579157">prefix</span><span class="op" id="1579163">)</span>&nbsp;<span class="op" id="1579165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579169">return</span>&nbsp;<span class="ident" id="1579176">s</span><span class="op" id="1579177">[</span><span class="builtinfunc" id="1579178">len</span><span class="op" id="1579181">(</span><span class="ident" id="1579182">prefix</span><span class="op" id="1579188">)</span><span class="op" id="1579189">:</span><span class="op" id="1579190">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1579193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579196">return</span>&nbsp;<span class="ident" id="1579203">s</span><br>
<span class="lineno"></span><span class="op" id="1579205">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="1579208">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1579277">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="1579335">func</span>&nbsp;<span class="ident" id="1579340">TrimSuffix</span><span class="op" id="1579350">(</span><span class="ident" id="1579351">s</span><span class="op" id="1579352">,</span>&nbsp;<span class="ident" id="1579354">suffix</span>&nbsp;<span class="op" id="1579361">[</span><span class="op" id="1579362">]</span><span class="builtintype" id="1579363">byte</span><span class="op" id="1579367">)</span>&nbsp;<span class="op" id="1579369">[</span><span class="op" id="1579370">]</span><span class="builtintype" id="1579371">byte</span>&nbsp;<span class="op" id="1579376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579379">if</span>&nbsp;<span class="ident" id="1579382">HasSuffix</span><span class="op" id="1579391">(</span><span class="ident" id="1579392">s</span><span class="op" id="1579393">,</span>&nbsp;<span class="ident" id="1579395">suffix</span><span class="op" id="1579401">)</span>&nbsp;<span class="op" id="1579403">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579407">return</span>&nbsp;<span class="ident" id="1579414">s</span><span class="op" id="1579415">[</span><span class="op" id="1579416">:</span><span class="builtinfunc" id="1579417">len</span><span class="op" id="1579420">(</span><span class="ident" id="1579421">s</span><span class="op" id="1579422">)</span><span class="op" id="1579423">-</span><span class="builtinfunc" id="1579424">len</span><span class="op" id="1579427">(</span><span class="ident" id="1579428">suffix</span><span class="op" id="1579434">)</span><span class="op" id="1579435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1579438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579441">return</span>&nbsp;<span class="ident" id="1579448">s</span><br>
<span class="lineno"></span><span class="op" id="1579450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="comment" id="1579453">//&nbsp;IndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1579531">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1579586">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="1579635">func</span>&nbsp;<span class="ident" id="1579640">IndexFunc</span><span class="op" id="1579649">(</span><span class="ident" id="1579650">s</span>&nbsp;<span class="op" id="1579652">[</span><span class="op" id="1579653">]</span><span class="builtintype" id="1579654">byte</span><span class="op" id="1579658">,</span>&nbsp;<span class="ident" id="1579660">f</span>&nbsp;<span class="keyword" id="1579662">func</span><span class="op" id="1579666">(</span><span class="ident" id="1579667">r</span>&nbsp;<span class="builtintype" id="1579669">rune</span><span class="op" id="1579673">)</span>&nbsp;<span class="builtintype" id="1579675">bool</span><span class="op" id="1579679">)</span>&nbsp;<span class="builtintype" id="1579681">int</span>&nbsp;<span class="op" id="1579685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579688">return</span>&nbsp;<span class="ident" id="1579695">indexFunc</span><span class="op" id="1579704">(</span><span class="ident" id="1579705">s</span><span class="op" id="1579706">,</span>&nbsp;<span class="ident" id="1579708">f</span><span class="op" id="1579709">,</span>&nbsp;<span class="builtintype" id="1579711">true</span><span class="op" id="1579715">)</span><br>
<span class="lineno">515</span><span class="op" id="1579717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1579720">//&nbsp;LastIndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1579802">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;last&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1579856">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno">520</span><span class="keyword" id="1579905">func</span>&nbsp;<span class="ident" id="1579910">LastIndexFunc</span><span class="op" id="1579923">(</span><span class="ident" id="1579924">s</span>&nbsp;<span class="op" id="1579926">[</span><span class="op" id="1579927">]</span><span class="builtintype" id="1579928">byte</span><span class="op" id="1579932">,</span>&nbsp;<span class="ident" id="1579934">f</span>&nbsp;<span class="keyword" id="1579936">func</span><span class="op" id="1579940">(</span><span class="ident" id="1579941">r</span>&nbsp;<span class="builtintype" id="1579943">rune</span><span class="op" id="1579947">)</span>&nbsp;<span class="builtintype" id="1579949">bool</span><span class="op" id="1579953">)</span>&nbsp;<span class="builtintype" id="1579955">int</span>&nbsp;<span class="op" id="1579959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1579962">return</span>&nbsp;<span class="ident" id="1579969">lastIndexFunc</span><span class="op" id="1579982">(</span><span class="ident" id="1579983">s</span><span class="op" id="1579984">,</span>&nbsp;<span class="ident" id="1579986">f</span><span class="op" id="1579987">,</span>&nbsp;<span class="builtintype" id="1579989">true</span><span class="op" id="1579993">)</span><br>
<span class="lineno"></span><span class="op" id="1579995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1579998">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno">525</span><span class="comment" id="1580051">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1580107">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="1580120">func</span>&nbsp;<span class="ident" id="1580125">indexFunc</span><span class="op" id="1580134">(</span><span class="ident" id="1580135">s</span>&nbsp;<span class="op" id="1580137">[</span><span class="op" id="1580138">]</span><span class="builtintype" id="1580139">byte</span><span class="op" id="1580143">,</span>&nbsp;<span class="ident" id="1580145">f</span>&nbsp;<span class="keyword" id="1580147">func</span><span class="op" id="1580151">(</span><span class="ident" id="1580152">r</span>&nbsp;<span class="builtintype" id="1580154">rune</span><span class="op" id="1580158">)</span>&nbsp;<span class="builtintype" id="1580160">bool</span><span class="op" id="1580164">,</span>&nbsp;<span class="ident" id="1580166">truth</span>&nbsp;<span class="builtintype" id="1580172">bool</span><span class="op" id="1580176">)</span>&nbsp;<span class="builtintype" id="1580178">int</span>&nbsp;<span class="op" id="1580182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580185">start</span>&nbsp;<span class="op" id="1580191">:=</span>&nbsp;<span class="num" id="1580194">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580197">for</span>&nbsp;<span class="ident" id="1580201">start</span>&nbsp;<span class="op" id="1580207">&lt;</span>&nbsp;<span class="builtinfunc" id="1580209">len</span><span class="op" id="1580212">(</span><span class="ident" id="1580213">s</span><span class="op" id="1580214">)</span>&nbsp;<span class="op" id="1580216">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580220">wid</span>&nbsp;<span class="op" id="1580224">:=</span>&nbsp;<span class="num" id="1580227">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580231">r</span>&nbsp;<span class="op" id="1580233">:=</span>&nbsp;<span class="builtintype" id="1580236">rune</span><span class="op" id="1580240">(</span><span class="ident" id="1580241">s</span><span class="op" id="1580242">[</span><span class="ident" id="1580243">start</span><span class="op" id="1580248">]</span><span class="op" id="1580249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580253">if</span>&nbsp;<span class="ident" id="1580256">r</span>&nbsp;<span class="op" id="1580258">&gt;=</span>&nbsp;<span class="ident" id="1580261">utf8</span><span class="op" id="1580265">.</span><span class="ident" id="1580266">RuneSelf</span>&nbsp;<span class="op" id="1580275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580280">r</span><span class="op" id="1580281">,</span>&nbsp;<span class="ident" id="1580283">wid</span>&nbsp;<span class="op" id="1580287">=</span>&nbsp;<span class="ident" id="1580289">utf8</span><span class="op" id="1580293">.</span><span class="ident" id="1580294">DecodeRune</span><span class="op" id="1580304">(</span><span class="ident" id="1580305">s</span><span class="op" id="1580306">[</span><span class="ident" id="1580307">start</span><span class="op" id="1580312">:</span><span class="op" id="1580313">]</span><span class="op" id="1580314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580318">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580322">if</span>&nbsp;<span class="ident" id="1580325">f</span><span class="op" id="1580326">(</span><span class="ident" id="1580327">r</span><span class="op" id="1580328">)</span>&nbsp;<span class="op" id="1580330">==</span>&nbsp;<span class="ident" id="1580333">truth</span>&nbsp;<span class="op" id="1580339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580344">return</span>&nbsp;<span class="ident" id="1580351">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580363">start</span>&nbsp;<span class="op" id="1580369">+=</span>&nbsp;<span class="ident" id="1580372">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580377">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580380">return</span>&nbsp;<span class="op" id="1580387">-</span><span class="num" id="1580388">1</span><br>
<span class="lineno"></span><span class="op" id="1580390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1580393">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1580454">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno">545</span><span class="comment" id="1580510">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="1580523">func</span>&nbsp;<span class="ident" id="1580528">lastIndexFunc</span><span class="op" id="1580541">(</span><span class="ident" id="1580542">s</span>&nbsp;<span class="op" id="1580544">[</span><span class="op" id="1580545">]</span><span class="builtintype" id="1580546">byte</span><span class="op" id="1580550">,</span>&nbsp;<span class="ident" id="1580552">f</span>&nbsp;<span class="keyword" id="1580554">func</span><span class="op" id="1580558">(</span><span class="ident" id="1580559">r</span>&nbsp;<span class="builtintype" id="1580561">rune</span><span class="op" id="1580565">)</span>&nbsp;<span class="builtintype" id="1580567">bool</span><span class="op" id="1580571">,</span>&nbsp;<span class="ident" id="1580573">truth</span>&nbsp;<span class="builtintype" id="1580579">bool</span><span class="op" id="1580583">)</span>&nbsp;<span class="builtintype" id="1580585">int</span>&nbsp;<span class="op" id="1580589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580592">for</span>&nbsp;<span class="ident" id="1580596">i</span>&nbsp;<span class="op" id="1580598">:=</span>&nbsp;<span class="builtinfunc" id="1580601">len</span><span class="op" id="1580604">(</span><span class="ident" id="1580605">s</span><span class="op" id="1580606">)</span><span class="op" id="1580607">;</span>&nbsp;<span class="ident" id="1580609">i</span>&nbsp;<span class="op" id="1580611">&gt;</span>&nbsp;<span class="num" id="1580613">0</span><span class="op" id="1580614">;</span>&nbsp;<span class="op" id="1580616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580620">r</span><span class="op" id="1580621">,</span>&nbsp;<span class="ident" id="1580623">size</span>&nbsp;<span class="op" id="1580628">:=</span>&nbsp;<span class="builtintype" id="1580631">rune</span><span class="op" id="1580635">(</span><span class="ident" id="1580636">s</span><span class="op" id="1580637">[</span><span class="ident" id="1580638">i</span><span class="op" id="1580639">-</span><span class="num" id="1580640">1</span><span class="op" id="1580641">]</span><span class="op" id="1580642">)</span><span class="op" id="1580643">,</span>&nbsp;<span class="num" id="1580645">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580649">if</span>&nbsp;<span class="ident" id="1580652">r</span>&nbsp;<span class="op" id="1580654">&gt;=</span>&nbsp;<span class="ident" id="1580657">utf8</span><span class="op" id="1580661">.</span><span class="ident" id="1580662">RuneSelf</span>&nbsp;<span class="op" id="1580671">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580676">r</span><span class="op" id="1580677">,</span>&nbsp;<span class="ident" id="1580679">size</span>&nbsp;<span class="op" id="1580684">=</span>&nbsp;<span class="ident" id="1580686">utf8</span><span class="op" id="1580690">.</span><span class="ident" id="1580691">DecodeLastRune</span><span class="op" id="1580705">(</span><span class="ident" id="1580706">s</span><span class="op" id="1580707">[</span><span class="num" id="1580708">0</span><span class="op" id="1580709">:</span><span class="ident" id="1580710">i</span><span class="op" id="1580711">]</span><span class="op" id="1580712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1580720">i</span>&nbsp;<span class="op" id="1580722">-=</span>&nbsp;<span class="ident" id="1580725">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580732">if</span>&nbsp;<span class="ident" id="1580735">f</span><span class="op" id="1580736">(</span><span class="ident" id="1580737">r</span><span class="op" id="1580738">)</span>&nbsp;<span class="op" id="1580740">==</span>&nbsp;<span class="ident" id="1580743">truth</span>&nbsp;<span class="op" id="1580749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580754">return</span>&nbsp;<span class="ident" id="1580761">i</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580771">return</span>&nbsp;<span class="op" id="1580778">-</span><span class="num" id="1580779">1</span><br>
<span class="lineno"></span><span class="op" id="1580781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="1580784">func</span>&nbsp;<span class="ident" id="1580789">makeCutsetFunc</span><span class="op" id="1580803">(</span><span class="ident" id="1580804">cutset</span>&nbsp;<span class="builtintype" id="1580811">string</span><span class="op" id="1580817">)</span>&nbsp;<span class="keyword" id="1580819">func</span><span class="op" id="1580823">(</span><span class="ident" id="1580824">r</span>&nbsp;<span class="builtintype" id="1580826">rune</span><span class="op" id="1580830">)</span>&nbsp;<span class="builtintype" id="1580832">bool</span>&nbsp;<span class="op" id="1580837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580840">return</span>&nbsp;<span class="keyword" id="1580847">func</span><span class="op" id="1580851">(</span><span class="ident" id="1580852">r</span>&nbsp;<span class="builtintype" id="1580854">rune</span><span class="op" id="1580858">)</span>&nbsp;<span class="builtintype" id="1580860">bool</span>&nbsp;<span class="op" id="1580865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580869">for</span>&nbsp;<span class="ident" id="1580873">_</span><span class="op" id="1580874">,</span>&nbsp;<span class="ident" id="1580876">c</span>&nbsp;<span class="op" id="1580878">:=</span>&nbsp;<span class="keyword" id="1580881">range</span>&nbsp;<span class="ident" id="1580887">cutset</span>&nbsp;<span class="op" id="1580894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580899">if</span>&nbsp;<span class="ident" id="1580902">c</span>&nbsp;<span class="op" id="1580904">==</span>&nbsp;<span class="ident" id="1580907">r</span>&nbsp;<span class="op" id="1580909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580915">return</span>&nbsp;<span class="builtintype" id="1580922">true</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1580938">return</span>&nbsp;<span class="builtintype" id="1580945">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1580952">}</span><br>
<span class="lineno"></span><span class="op" id="1580954">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="1580957">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1581020">//&nbsp;trailing&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="1581087">func</span>&nbsp;<span class="ident" id="1581092">Trim</span><span class="op" id="1581096">(</span><span class="ident" id="1581097">s</span>&nbsp;<span class="op" id="1581099">[</span><span class="op" id="1581100">]</span><span class="builtintype" id="1581101">byte</span><span class="op" id="1581105">,</span>&nbsp;<span class="ident" id="1581107">cutset</span>&nbsp;<span class="builtintype" id="1581114">string</span><span class="op" id="1581120">)</span>&nbsp;<span class="op" id="1581122">[</span><span class="op" id="1581123">]</span><span class="builtintype" id="1581124">byte</span>&nbsp;<span class="op" id="1581129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1581132">return</span>&nbsp;<span class="ident" id="1581139">TrimFunc</span><span class="op" id="1581147">(</span><span class="ident" id="1581148">s</span><span class="op" id="1581149">,</span>&nbsp;<span class="ident" id="1581151">makeCutsetFunc</span><span class="op" id="1581165">(</span><span class="ident" id="1581166">cutset</span><span class="op" id="1581172">)</span><span class="op" id="1581173">)</span><br>
<span class="lineno">575</span><span class="op" id="1581175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1581178">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="1581241">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="1581299">func</span>&nbsp;<span class="ident" id="1581304">TrimLeft</span><span class="op" id="1581312">(</span><span class="ident" id="1581313">s</span>&nbsp;<span class="op" id="1581315">[</span><span class="op" id="1581316">]</span><span class="builtintype" id="1581317">byte</span><span class="op" id="1581321">,</span>&nbsp;<span class="ident" id="1581323">cutset</span>&nbsp;<span class="builtintype" id="1581330">string</span><span class="op" id="1581336">)</span>&nbsp;<span class="op" id="1581338">[</span><span class="op" id="1581339">]</span><span class="builtintype" id="1581340">byte</span>&nbsp;<span class="op" id="1581345">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1581348">return</span>&nbsp;<span class="ident" id="1581355">TrimLeftFunc</span><span class="op" id="1581367">(</span><span class="ident" id="1581368">s</span><span class="op" id="1581369">,</span>&nbsp;<span class="ident" id="1581371">makeCutsetFunc</span><span class="op" id="1581385">(</span><span class="ident" id="1581386">cutset</span><span class="op" id="1581392">)</span><span class="op" id="1581393">)</span><br>
<span class="lineno"></span><span class="op" id="1581395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1581398">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="1581463">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;that&nbsp;are&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno">585</span><span class="keyword" id="1581530">func</span>&nbsp;<span class="ident" id="1581535">TrimRight</span><span class="op" id="1581544">(</span><span class="ident" id="1581545">s</span>&nbsp;<span class="op" id="1581547">[</span><span class="op" id="1581548">]</span><span class="builtintype" id="1581549">byte</span><span class="op" id="1581553">,</span>&nbsp;<span class="ident" id="1581555">cutset</span>&nbsp;<span class="builtintype" id="1581562">string</span><span class="op" id="1581568">)</span>&nbsp;<span class="op" id="1581570">[</span><span class="op" id="1581571">]</span><span class="builtintype" id="1581572">byte</span>&nbsp;<span class="op" id="1581577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1581580">return</span>&nbsp;<span class="ident" id="1581587">TrimRightFunc</span><span class="op" id="1581600">(</span><span class="ident" id="1581601">s</span><span class="op" id="1581602">,</span>&nbsp;<span class="ident" id="1581604">makeCutsetFunc</span><span class="op" id="1581618">(</span><span class="ident" id="1581619">cutset</span><span class="op" id="1581625">)</span><span class="op" id="1581626">)</span><br>
<span class="lineno"></span><span class="op" id="1581628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1581631">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno">590</span><span class="comment" id="1581699">//&nbsp;trailing&nbsp;white&nbsp;space,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="1581747">func</span>&nbsp;<span class="ident" id="1581752">TrimSpace</span><span class="op" id="1581761">(</span><span class="ident" id="1581762">s</span>&nbsp;<span class="op" id="1581764">[</span><span class="op" id="1581765">]</span><span class="builtintype" id="1581766">byte</span><span class="op" id="1581770">)</span>&nbsp;<span class="op" id="1581772">[</span><span class="op" id="1581773">]</span><span class="builtintype" id="1581774">byte</span>&nbsp;<span class="op" id="1581779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1581782">return</span>&nbsp;<span class="ident" id="1581789">TrimFunc</span><span class="op" id="1581797">(</span><span class="ident" id="1581798">s</span><span class="op" id="1581799">,</span>&nbsp;<span class="ident" id="1581801">unicode</span><span class="op" id="1581808">.</span><span class="ident" id="1581809">IsSpace</span><span class="op" id="1581816">)</span><br>
<span class="lineno"></span><span class="op" id="1581818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="1581821">//&nbsp;Runes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;runes&nbsp;(Unicode&nbsp;code&nbsp;points)&nbsp;equivalent&nbsp;to&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1581894">func</span>&nbsp;<span class="ident" id="1581899">Runes</span><span class="op" id="1581904">(</span><span class="ident" id="1581905">s</span>&nbsp;<span class="op" id="1581907">[</span><span class="op" id="1581908">]</span><span class="builtintype" id="1581909">byte</span><span class="op" id="1581913">)</span>&nbsp;<span class="op" id="1581915">[</span><span class="op" id="1581916">]</span><span class="builtintype" id="1581917">rune</span>&nbsp;<span class="op" id="1581922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1581925">t</span>&nbsp;<span class="op" id="1581927">:=</span>&nbsp;<span class="builtinfunc" id="1581930">make</span><span class="op" id="1581934">(</span><span class="op" id="1581935">[</span><span class="op" id="1581936">]</span><span class="builtintype" id="1581937">rune</span><span class="op" id="1581941">,</span>&nbsp;<span class="ident" id="1581943">utf8</span><span class="op" id="1581947">.</span><span class="ident" id="1581948">RuneCount</span><span class="op" id="1581957">(</span><span class="ident" id="1581958">s</span><span class="op" id="1581959">)</span><span class="op" id="1581960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1581963">i</span>&nbsp;<span class="op" id="1581965">:=</span>&nbsp;<span class="num" id="1581968">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1581971">for</span>&nbsp;<span class="builtinfunc" id="1581975">len</span><span class="op" id="1581978">(</span><span class="ident" id="1581979">s</span><span class="op" id="1581980">)</span>&nbsp;<span class="op" id="1581982">&gt;</span>&nbsp;<span class="num" id="1581984">0</span>&nbsp;<span class="op" id="1581986">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1581990">r</span><span class="op" id="1581991">,</span>&nbsp;<span class="ident" id="1581993">l</span>&nbsp;<span class="op" id="1581995">:=</span>&nbsp;<span class="ident" id="1581998">utf8</span><span class="op" id="1582002">.</span><span class="ident" id="1582003">DecodeRune</span><span class="op" id="1582013">(</span><span class="ident" id="1582014">s</span><span class="op" id="1582015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582019">t</span><span class="op" id="1582020">[</span><span class="ident" id="1582021">i</span><span class="op" id="1582022">]</span>&nbsp;<span class="op" id="1582024">=</span>&nbsp;<span class="ident" id="1582026">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582030">i</span><span class="op" id="1582031">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582036">s</span>&nbsp;<span class="op" id="1582038">=</span>&nbsp;<span class="ident" id="1582040">s</span><span class="op" id="1582041">[</span><span class="ident" id="1582042">l</span><span class="op" id="1582043">:</span><span class="op" id="1582044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582047">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582050">return</span>&nbsp;<span class="ident" id="1582057">t</span><br>
<span class="lineno"></span><span class="op" id="1582059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1582062">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;slice&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="1582120">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno">610</span><span class="comment" id="1582173">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="1582234">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="1582300">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="1582323">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span><span class="keyword" id="1582385">func</span>&nbsp;<span class="ident" id="1582390">Replace</span><span class="op" id="1582397">(</span><span class="ident" id="1582398">s</span><span class="op" id="1582399">,</span>&nbsp;<span class="ident" id="1582401">old</span><span class="op" id="1582404">,</span>&nbsp;<span class="builtinfunc" id="1582406">new</span>&nbsp;<span class="op" id="1582410">[</span><span class="op" id="1582411">]</span><span class="builtintype" id="1582412">byte</span><span class="op" id="1582416">,</span>&nbsp;<span class="ident" id="1582418">n</span>&nbsp;<span class="builtintype" id="1582420">int</span><span class="op" id="1582423">)</span>&nbsp;<span class="op" id="1582425">[</span><span class="op" id="1582426">]</span><span class="builtintype" id="1582427">byte</span>&nbsp;<span class="op" id="1582432">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582435">m</span>&nbsp;<span class="op" id="1582437">:=</span>&nbsp;<span class="num" id="1582440">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582443">if</span>&nbsp;<span class="ident" id="1582446">n</span>&nbsp;<span class="op" id="1582448">!=</span>&nbsp;<span class="num" id="1582451">0</span>&nbsp;<span class="op" id="1582453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1582457">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582494">m</span>&nbsp;<span class="op" id="1582496">=</span>&nbsp;<span class="ident" id="1582498">Count</span><span class="op" id="1582503">(</span><span class="ident" id="1582504">s</span><span class="op" id="1582505">,</span>&nbsp;<span class="ident" id="1582507">old</span><span class="op" id="1582510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582513">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582516">if</span>&nbsp;<span class="ident" id="1582519">m</span>&nbsp;<span class="op" id="1582521">==</span>&nbsp;<span class="num" id="1582524">0</span>&nbsp;<span class="op" id="1582526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1582530">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582555">return</span>&nbsp;<span class="builtinfunc" id="1582562">append</span><span class="op" id="1582568">(</span><span class="op" id="1582569">[</span><span class="op" id="1582570">]</span><span class="builtintype" id="1582571">byte</span><span class="op" id="1582575">(</span><span class="ident" id="1582576">nil</span><span class="op" id="1582579">)</span><span class="op" id="1582580">,</span>&nbsp;<span class="ident" id="1582582">s</span><span class="op" id="1582583">...</span><span class="op" id="1582586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582592">if</span>&nbsp;<span class="ident" id="1582595">n</span>&nbsp;<span class="op" id="1582597">&lt;</span>&nbsp;<span class="num" id="1582599">0</span>&nbsp;<span class="op" id="1582601">||</span>&nbsp;<span class="ident" id="1582604">m</span>&nbsp;<span class="op" id="1582606">&lt;</span>&nbsp;<span class="ident" id="1582608">n</span>&nbsp;<span class="op" id="1582610">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582614">n</span>&nbsp;<span class="op" id="1582616">=</span>&nbsp;<span class="ident" id="1582618">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1582625">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582659">t</span>&nbsp;<span class="op" id="1582661">:=</span>&nbsp;<span class="builtinfunc" id="1582664">make</span><span class="op" id="1582668">(</span><span class="op" id="1582669">[</span><span class="op" id="1582670">]</span><span class="builtintype" id="1582671">byte</span><span class="op" id="1582675">,</span>&nbsp;<span class="builtinfunc" id="1582677">len</span><span class="op" id="1582680">(</span><span class="ident" id="1582681">s</span><span class="op" id="1582682">)</span><span class="op" id="1582683">+</span><span class="ident" id="1582684">n</span><span class="op" id="1582685">*</span><span class="op" id="1582686">(</span><span class="builtinfunc" id="1582687">len</span><span class="op" id="1582690">(</span><span class="builtinfunc" id="1582691">new</span><span class="op" id="1582694">)</span><span class="op" id="1582695">-</span><span class="builtinfunc" id="1582696">len</span><span class="op" id="1582699">(</span><span class="ident" id="1582700">old</span><span class="op" id="1582703">)</span><span class="op" id="1582704">)</span><span class="op" id="1582705">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582708">w</span>&nbsp;<span class="op" id="1582710">:=</span>&nbsp;<span class="num" id="1582713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582716">start</span>&nbsp;<span class="op" id="1582722">:=</span>&nbsp;<span class="num" id="1582725">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582728">for</span>&nbsp;<span class="ident" id="1582732">i</span>&nbsp;<span class="op" id="1582734">:=</span>&nbsp;<span class="num" id="1582737">0</span><span class="op" id="1582738">;</span>&nbsp;<span class="ident" id="1582740">i</span>&nbsp;<span class="op" id="1582742">&lt;</span>&nbsp;<span class="ident" id="1582744">n</span><span class="op" id="1582745">;</span>&nbsp;<span class="ident" id="1582747">i</span><span class="op" id="1582748">++</span>&nbsp;<span class="op" id="1582751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582755">j</span>&nbsp;<span class="op" id="1582757">:=</span>&nbsp;<span class="ident" id="1582760">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582768">if</span>&nbsp;<span class="builtinfunc" id="1582771">len</span><span class="op" id="1582774">(</span><span class="ident" id="1582775">old</span><span class="op" id="1582778">)</span>&nbsp;<span class="op" id="1582780">==</span>&nbsp;<span class="num" id="1582783">0</span>&nbsp;<span class="op" id="1582785">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1582790">if</span>&nbsp;<span class="ident" id="1582793">i</span>&nbsp;<span class="op" id="1582795">&gt;</span>&nbsp;<span class="num" id="1582797">0</span>&nbsp;<span class="op" id="1582799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582805">_</span><span class="op" id="1582806">,</span>&nbsp;<span class="ident" id="1582808">wid</span>&nbsp;<span class="op" id="1582812">:=</span>&nbsp;<span class="ident" id="1582815">utf8</span><span class="op" id="1582819">.</span><span class="ident" id="1582820">DecodeRune</span><span class="op" id="1582830">(</span><span class="ident" id="1582831">s</span><span class="op" id="1582832">[</span><span class="ident" id="1582833">start</span><span class="op" id="1582838">:</span><span class="op" id="1582839">]</span><span class="op" id="1582840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582846">j</span>&nbsp;<span class="op" id="1582848">+=</span>&nbsp;<span class="ident" id="1582851">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582862">}</span>&nbsp;<span class="keyword" id="1582864">else</span>&nbsp;<span class="op" id="1582869">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582874">j</span>&nbsp;<span class="op" id="1582876">+=</span>&nbsp;<span class="ident" id="1582879">Index</span><span class="op" id="1582884">(</span><span class="ident" id="1582885">s</span><span class="op" id="1582886">[</span><span class="ident" id="1582887">start</span><span class="op" id="1582892">:</span><span class="op" id="1582893">]</span><span class="op" id="1582894">,</span>&nbsp;<span class="ident" id="1582896">old</span><span class="op" id="1582899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582907">w</span>&nbsp;<span class="op" id="1582909">+=</span>&nbsp;<span class="builtinfunc" id="1582912">copy</span><span class="op" id="1582916">(</span><span class="ident" id="1582917">t</span><span class="op" id="1582918">[</span><span class="ident" id="1582919">w</span><span class="op" id="1582920">:</span><span class="op" id="1582921">]</span><span class="op" id="1582922">,</span>&nbsp;<span class="ident" id="1582924">s</span><span class="op" id="1582925">[</span><span class="ident" id="1582926">start</span><span class="op" id="1582931">:</span><span class="ident" id="1582932">j</span><span class="op" id="1582933">]</span><span class="op" id="1582934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582938">w</span>&nbsp;<span class="op" id="1582940">+=</span>&nbsp;<span class="builtinfunc" id="1582943">copy</span><span class="op" id="1582947">(</span><span class="ident" id="1582948">t</span><span class="op" id="1582949">[</span><span class="ident" id="1582950">w</span><span class="op" id="1582951">:</span><span class="op" id="1582952">]</span><span class="op" id="1582953">,</span>&nbsp;<span class="builtinfunc" id="1582955">new</span><span class="op" id="1582958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582962">start</span>&nbsp;<span class="op" id="1582968">=</span>&nbsp;<span class="ident" id="1582970">j</span>&nbsp;<span class="op" id="1582972">+</span>&nbsp;<span class="builtinfunc" id="1582974">len</span><span class="op" id="1582977">(</span><span class="ident" id="1582978">old</span><span class="op" id="1582981">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1582984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1582987">w</span>&nbsp;<span class="op" id="1582989">+=</span>&nbsp;<span class="builtinfunc" id="1582992">copy</span><span class="op" id="1582996">(</span><span class="ident" id="1582997">t</span><span class="op" id="1582998">[</span><span class="ident" id="1582999">w</span><span class="op" id="1583000">:</span><span class="op" id="1583001">]</span><span class="op" id="1583002">,</span>&nbsp;<span class="ident" id="1583004">s</span><span class="op" id="1583005">[</span><span class="ident" id="1583006">start</span><span class="op" id="1583011">:</span><span class="op" id="1583012">]</span><span class="op" id="1583013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583016">return</span>&nbsp;<span class="ident" id="1583023">t</span><span class="op" id="1583024">[</span><span class="num" id="1583025">0</span><span class="op" id="1583026">:</span><span class="ident" id="1583027">w</span><span class="op" id="1583028">]</span><br>
<span class="lineno"></span><span class="op" id="1583030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1583033">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno"></span><span class="comment" id="1583101">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="1583142">func</span>&nbsp;<span class="ident" id="1583147">EqualFold</span><span class="op" id="1583156">(</span><span class="ident" id="1583157">s</span><span class="op" id="1583158">,</span>&nbsp;<span class="ident" id="1583160">t</span>&nbsp;<span class="op" id="1583162">[</span><span class="op" id="1583163">]</span><span class="builtintype" id="1583164">byte</span><span class="op" id="1583168">)</span>&nbsp;<span class="builtintype" id="1583170">bool</span>&nbsp;<span class="op" id="1583175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583178">for</span>&nbsp;<span class="builtinfunc" id="1583182">len</span><span class="op" id="1583185">(</span><span class="ident" id="1583186">s</span><span class="op" id="1583187">)</span>&nbsp;<span class="op" id="1583189">!=</span>&nbsp;<span class="num" id="1583192">0</span>&nbsp;<span class="op" id="1583194">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1583197">len</span><span class="op" id="1583200">(</span><span class="ident" id="1583201">t</span><span class="op" id="1583202">)</span>&nbsp;<span class="op" id="1583204">!=</span>&nbsp;<span class="num" id="1583207">0</span>&nbsp;<span class="op" id="1583209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583213">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583248">var</span>&nbsp;<span class="ident" id="1583252">sr</span><span class="op" id="1583254">,</span>&nbsp;<span class="ident" id="1583256">tr</span>&nbsp;<span class="builtintype" id="1583259">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583266">if</span>&nbsp;<span class="ident" id="1583269">s</span><span class="op" id="1583270">[</span><span class="num" id="1583271">0</span><span class="op" id="1583272">]</span>&nbsp;<span class="op" id="1583274">&lt;</span>&nbsp;<span class="ident" id="1583276">utf8</span><span class="op" id="1583280">.</span><span class="ident" id="1583281">RuneSelf</span>&nbsp;<span class="op" id="1583290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583295">sr</span><span class="op" id="1583297">,</span>&nbsp;<span class="ident" id="1583299">s</span>&nbsp;<span class="op" id="1583301">=</span>&nbsp;<span class="builtintype" id="1583303">rune</span><span class="op" id="1583307">(</span><span class="ident" id="1583308">s</span><span class="op" id="1583309">[</span><span class="num" id="1583310">0</span><span class="op" id="1583311">]</span><span class="op" id="1583312">)</span><span class="op" id="1583313">,</span>&nbsp;<span class="ident" id="1583315">s</span><span class="op" id="1583316">[</span><span class="num" id="1583317">1</span><span class="op" id="1583318">:</span><span class="op" id="1583319">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583323">}</span>&nbsp;<span class="keyword" id="1583325">else</span>&nbsp;<span class="op" id="1583330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583335">r</span><span class="op" id="1583336">,</span>&nbsp;<span class="ident" id="1583338">size</span>&nbsp;<span class="op" id="1583343">:=</span>&nbsp;<span class="ident" id="1583346">utf8</span><span class="op" id="1583350">.</span><span class="ident" id="1583351">DecodeRune</span><span class="op" id="1583361">(</span><span class="ident" id="1583362">s</span><span class="op" id="1583363">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583368">sr</span><span class="op" id="1583370">,</span>&nbsp;<span class="ident" id="1583372">s</span>&nbsp;<span class="op" id="1583374">=</span>&nbsp;<span class="ident" id="1583376">r</span><span class="op" id="1583377">,</span>&nbsp;<span class="ident" id="1583379">s</span><span class="op" id="1583380">[</span><span class="ident" id="1583381">size</span><span class="op" id="1583385">:</span><span class="op" id="1583386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583394">if</span>&nbsp;<span class="ident" id="1583397">t</span><span class="op" id="1583398">[</span><span class="num" id="1583399">0</span><span class="op" id="1583400">]</span>&nbsp;<span class="op" id="1583402">&lt;</span>&nbsp;<span class="ident" id="1583404">utf8</span><span class="op" id="1583408">.</span><span class="ident" id="1583409">RuneSelf</span>&nbsp;<span class="op" id="1583418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583423">tr</span><span class="op" id="1583425">,</span>&nbsp;<span class="ident" id="1583427">t</span>&nbsp;<span class="op" id="1583429">=</span>&nbsp;<span class="builtintype" id="1583431">rune</span><span class="op" id="1583435">(</span><span class="ident" id="1583436">t</span><span class="op" id="1583437">[</span><span class="num" id="1583438">0</span><span class="op" id="1583439">]</span><span class="op" id="1583440">)</span><span class="op" id="1583441">,</span>&nbsp;<span class="ident" id="1583443">t</span><span class="op" id="1583444">[</span><span class="num" id="1583445">1</span><span class="op" id="1583446">:</span><span class="op" id="1583447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583451">}</span>&nbsp;<span class="keyword" id="1583453">else</span>&nbsp;<span class="op" id="1583458">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583463">r</span><span class="op" id="1583464">,</span>&nbsp;<span class="ident" id="1583466">size</span>&nbsp;<span class="op" id="1583471">:=</span>&nbsp;<span class="ident" id="1583474">utf8</span><span class="op" id="1583478">.</span><span class="ident" id="1583479">DecodeRune</span><span class="op" id="1583489">(</span><span class="ident" id="1583490">t</span><span class="op" id="1583491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583496">tr</span><span class="op" id="1583498">,</span>&nbsp;<span class="ident" id="1583500">t</span>&nbsp;<span class="op" id="1583502">=</span>&nbsp;<span class="ident" id="1583504">r</span><span class="op" id="1583505">,</span>&nbsp;<span class="ident" id="1583507">t</span><span class="op" id="1583508">[</span><span class="ident" id="1583509">size</span><span class="op" id="1583513">:</span><span class="op" id="1583514">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583523">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583578">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583594">if</span>&nbsp;<span class="ident" id="1583597">tr</span>&nbsp;<span class="op" id="1583600">==</span>&nbsp;<span class="ident" id="1583603">sr</span>&nbsp;<span class="op" id="1583606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583611">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583622">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583627">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583671">if</span>&nbsp;<span class="ident" id="1583674">tr</span>&nbsp;<span class="op" id="1583677">&lt;</span>&nbsp;<span class="ident" id="1583679">sr</span>&nbsp;<span class="op" id="1583682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1583687">tr</span><span class="op" id="1583689">,</span>&nbsp;<span class="ident" id="1583691">sr</span>&nbsp;<span class="op" id="1583694">=</span>&nbsp;<span class="ident" id="1583696">sr</span><span class="op" id="1583698">,</span>&nbsp;<span class="ident" id="1583700">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583705">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583709">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583736">if</span>&nbsp;<span class="ident" id="1583739">tr</span>&nbsp;<span class="op" id="1583742">&lt;</span>&nbsp;<span class="ident" id="1583744">utf8</span><span class="op" id="1583748">.</span><span class="ident" id="1583749">RuneSelf</span>&nbsp;<span class="op" id="1583758">&amp;&amp;</span>&nbsp;<span class="string" id="1583761">&#39;A&#39;</span>&nbsp;<span class="op" id="1583765">&lt;=</span>&nbsp;<span class="ident" id="1583768">sr</span>&nbsp;<span class="op" id="1583771">&amp;&amp;</span>&nbsp;<span class="ident" id="1583774">sr</span>&nbsp;<span class="op" id="1583777">&lt;=</span>&nbsp;<span class="string" id="1583780">&#39;Z&#39;</span>&nbsp;<span class="op" id="1583784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583789">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583848">if</span>&nbsp;<span class="ident" id="1583851">tr</span>&nbsp;<span class="op" id="1583854">==</span>&nbsp;<span class="ident" id="1583857">sr</span><span class="op" id="1583859">+</span><span class="string" id="1583860">&#39;a&#39;</span><span class="op" id="1583863">-</span><span class="string" id="1583864">&#39;A&#39;</span>&nbsp;<span class="op" id="1583868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583874">continue</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1583891">return</span>&nbsp;<span class="builtintype" id="1583898">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1583906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583911">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1583982">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1584022">r</span>&nbsp;<span class="op" id="1584024">:=</span>&nbsp;<span class="ident" id="1584027">unicode</span><span class="op" id="1584034">.</span><span class="ident" id="1584035">SimpleFold</span><span class="op" id="1584045">(</span><span class="ident" id="1584046">sr</span><span class="op" id="1584048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1584052">for</span>&nbsp;<span class="ident" id="1584056">r</span>&nbsp;<span class="op" id="1584058">!=</span>&nbsp;<span class="ident" id="1584061">sr</span>&nbsp;<span class="op" id="1584064">&amp;&amp;</span>&nbsp;<span class="ident" id="1584067">r</span>&nbsp;<span class="op" id="1584069">&lt;</span>&nbsp;<span class="ident" id="1584071">tr</span>&nbsp;<span class="op" id="1584074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1584079">r</span>&nbsp;<span class="op" id="1584081">=</span>&nbsp;<span class="ident" id="1584083">unicode</span><span class="op" id="1584090">.</span><span class="ident" id="1584091">SimpleFold</span><span class="op" id="1584101">(</span><span class="ident" id="1584102">r</span><span class="op" id="1584103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1584107">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1584111">if</span>&nbsp;<span class="ident" id="1584114">r</span>&nbsp;<span class="op" id="1584116">==</span>&nbsp;<span class="ident" id="1584119">tr</span>&nbsp;<span class="op" id="1584122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1584127">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1584138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1584142">return</span>&nbsp;<span class="builtintype" id="1584149">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1584156">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1584160">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1584196">return</span>&nbsp;<span class="builtinfunc" id="1584203">len</span><span class="op" id="1584206">(</span><span class="ident" id="1584207">s</span><span class="op" id="1584208">)</span>&nbsp;<span class="op" id="1584210">==</span>&nbsp;<span class="builtinfunc" id="1584213">len</span><span class="op" id="1584216">(</span><span class="ident" id="1584217">t</span><span class="op" id="1584218">)</span><br>
<span class="lineno"></span><span class="op" id="1584220">}</span>
</div>
</body>
</html>
