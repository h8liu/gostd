<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7189877">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7189932">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7189986">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7190037">package</span>&nbsp;<span class="ident" id="7190045">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7190050">import</span>&nbsp;<span class="op" id="7190057">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190060">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190069">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190085">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190104">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190118">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190134">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190150">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190160">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190167">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190173">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190185">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190192">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190198">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190209">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190226">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190237">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7190248">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="7190255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7190258">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7190336">type</span>&nbsp;<span class="ident" id="7190341">zeroSource</span>&nbsp;<span class="keyword" id="7190352">struct</span><span class="op" id="7190358">{</span><span class="op" id="7190359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7190362">func</span>&nbsp;<span class="op" id="7190367">(</span><span class="ident" id="7190368">zeroSource</span><span class="op" id="7190378">)</span>&nbsp;<span class="ident" id="7190380">Read</span><span class="op" id="7190384">(</span><span class="ident" id="7190385">b</span>&nbsp;<span class="op" id="7190387">[</span><span class="op" id="7190388">]</span><span class="builtintype" id="7190389">byte</span><span class="op" id="7190393">)</span>&nbsp;<span class="op" id="7190395">(</span><span class="ident" id="7190396">n</span>&nbsp;<span class="builtintype" id="7190398">int</span><span class="op" id="7190401">,</span>&nbsp;<span class="ident" id="7190403">err</span>&nbsp;<span class="builtintype" id="7190407">error</span><span class="op" id="7190412">)</span>&nbsp;<span class="op" id="7190414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7190417">for</span>&nbsp;<span class="ident" id="7190421">i</span>&nbsp;<span class="op" id="7190423">:=</span>&nbsp;<span class="keyword" id="7190426">range</span>&nbsp;<span class="ident" id="7190432">b</span>&nbsp;<span class="op" id="7190434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190438">b</span><span class="op" id="7190439">[</span><span class="ident" id="7190440">i</span><span class="op" id="7190441">]</span>&nbsp;<span class="op" id="7190443">=</span>&nbsp;<span class="num" id="7190445">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7190448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7190452">return</span>&nbsp;<span class="builtinfunc" id="7190459">len</span><span class="op" id="7190462">(</span><span class="ident" id="7190463">b</span><span class="op" id="7190464">)</span><span class="op" id="7190465">,</span>&nbsp;<span class="ident" id="7190467">nil</span><br>
<span class="lineno"></span><span class="op" id="7190471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7190474">var</span>&nbsp;<span class="ident" id="7190478">testConfig</span>&nbsp;<span class="op" id="7190489">*</span><span class="ident" id="7190490">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7190498">func</span>&nbsp;<span class="ident" id="7190503">init</span><span class="op" id="7190507">(</span><span class="op" id="7190508">)</span>&nbsp;<span class="op" id="7190510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190513">testConfig</span>&nbsp;<span class="op" id="7190524">=</span>&nbsp;<span class="op" id="7190526">&amp;</span><span class="ident" id="7190527">Config</span><span class="op" id="7190533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190537">Time</span><span class="op" id="7190541">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7190557">func</span><span class="op" id="7190561">(</span><span class="op" id="7190562">)</span>&nbsp;<span class="ident" id="7190564">time</span><span class="op" id="7190568">.</span><span class="ident" id="7190569">Time</span>&nbsp;<span class="op" id="7190574">{</span>&nbsp;<span class="keyword" id="7190576">return</span>&nbsp;<span class="ident" id="7190583">time</span><span class="op" id="7190587">.</span><span class="ident" id="7190588">Unix</span><span class="op" id="7190592">(</span><span class="num" id="7190593">0</span><span class="op" id="7190594">,</span>&nbsp;<span class="num" id="7190596">0</span><span class="op" id="7190597">)</span>&nbsp;<span class="op" id="7190599">}</span><span class="op" id="7190600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190604">Rand</span><span class="op" id="7190608">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190624">zeroSource</span><span class="op" id="7190634">{</span><span class="op" id="7190635">}</span><span class="op" id="7190636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190640">Certificates</span><span class="op" id="7190652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7190660">make</span><span class="op" id="7190664">(</span><span class="op" id="7190665">[</span><span class="op" id="7190666">]</span><span class="ident" id="7190667">Certificate</span><span class="op" id="7190678">,</span>&nbsp;<span class="num" id="7190680">2</span><span class="op" id="7190681">)</span><span class="op" id="7190682">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190686">InsecureSkipVerify</span><span class="op" id="7190704">:</span>&nbsp;<span class="builtintype" id="7190706">true</span><span class="op" id="7190710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190714">MinVersion</span><span class="op" id="7190724">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190734">VersionSSL30</span><span class="op" id="7190746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190750">MaxVersion</span><span class="op" id="7190760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7190770">VersionTLS12</span><span class="op" id="7190782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7190785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190788">testConfig</span><span class="op" id="7190798">.</span><span class="ident" id="7190799">Certificates</span><span class="op" id="7190811">[</span><span class="num" id="7190812">0</span><span class="op" id="7190813">]</span><span class="op" id="7190814">.</span><span class="ident" id="7190815">Certificate</span>&nbsp;<span class="op" id="7190827">=</span>&nbsp;<span class="op" id="7190829">[</span><span class="op" id="7190830">]</span><span class="op" id="7190831">[</span><span class="op" id="7190832">]</span><span class="builtintype" id="7190833">byte</span><span class="op" id="7190837">{</span><span class="ident" id="7190838">testRSACertificate</span><span class="op" id="7190856">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190859">testConfig</span><span class="op" id="7190869">.</span><span class="ident" id="7190870">Certificates</span><span class="op" id="7190882">[</span><span class="num" id="7190883">0</span><span class="op" id="7190884">]</span><span class="op" id="7190885">.</span><span class="ident" id="7190886">PrivateKey</span>&nbsp;<span class="op" id="7190897">=</span>&nbsp;<span class="ident" id="7190899">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190918">testConfig</span><span class="op" id="7190928">.</span><span class="ident" id="7190929">Certificates</span><span class="op" id="7190941">[</span><span class="num" id="7190942">1</span><span class="op" id="7190943">]</span><span class="op" id="7190944">.</span><span class="ident" id="7190945">Certificate</span>&nbsp;<span class="op" id="7190957">=</span>&nbsp;<span class="op" id="7190959">[</span><span class="op" id="7190960">]</span><span class="op" id="7190961">[</span><span class="op" id="7190962">]</span><span class="builtintype" id="7190963">byte</span><span class="op" id="7190967">{</span><span class="ident" id="7190968">testSNICertificate</span><span class="op" id="7190986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7190989">testConfig</span><span class="op" id="7190999">.</span><span class="ident" id="7191000">Certificates</span><span class="op" id="7191012">[</span><span class="num" id="7191013">1</span><span class="op" id="7191014">]</span><span class="op" id="7191015">.</span><span class="ident" id="7191016">PrivateKey</span>&nbsp;<span class="op" id="7191027">=</span>&nbsp;<span class="ident" id="7191029">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191048">testConfig</span><span class="op" id="7191058">.</span><span class="ident" id="7191059">BuildNameToCertificate</span><span class="op" id="7191081">(</span><span class="op" id="7191082">)</span><br>
<span class="lineno"></span><span class="op" id="7191084">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7191087">func</span>&nbsp;<span class="ident" id="7191092">testClientHelloFailure</span><span class="op" id="7191114">(</span><span class="ident" id="7191115">t</span>&nbsp;<span class="op" id="7191117">*</span><span class="ident" id="7191118">testing</span><span class="op" id="7191125">.</span><span class="ident" id="7191126">T</span><span class="op" id="7191127">,</span>&nbsp;<span class="ident" id="7191129">m</span>&nbsp;<span class="ident" id="7191131">handshakeMessage</span><span class="op" id="7191147">,</span>&nbsp;<span class="ident" id="7191149">expectedSubStr</span>&nbsp;<span class="builtintype" id="7191164">string</span><span class="op" id="7191170">)</span>&nbsp;<span class="op" id="7191172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7191175">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7191216">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7191259">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191279">c</span><span class="op" id="7191280">,</span>&nbsp;<span class="ident" id="7191282">s</span>&nbsp;<span class="op" id="7191284">:=</span>&nbsp;<span class="ident" id="7191287">net</span><span class="op" id="7191290">.</span><span class="ident" id="7191291">Pipe</span><span class="op" id="7191295">(</span><span class="op" id="7191296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7191299">go</span>&nbsp;<span class="keyword" id="7191302">func</span><span class="op" id="7191306">(</span><span class="op" id="7191307">)</span>&nbsp;<span class="op" id="7191309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191313">cli</span>&nbsp;<span class="op" id="7191317">:=</span>&nbsp;<span class="ident" id="7191320">Client</span><span class="op" id="7191326">(</span><span class="ident" id="7191327">c</span><span class="op" id="7191328">,</span>&nbsp;<span class="ident" id="7191330">testConfig</span><span class="op" id="7191340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7191344">if</span>&nbsp;<span class="ident" id="7191347">ch</span><span class="op" id="7191349">,</span>&nbsp;<span class="ident" id="7191351">ok</span>&nbsp;<span class="op" id="7191354">:=</span>&nbsp;<span class="ident" id="7191357">m</span><span class="op" id="7191358">.</span><span class="op" id="7191359">(</span><span class="op" id="7191360">*</span><span class="ident" id="7191361">clientHelloMsg</span><span class="op" id="7191375">)</span><span class="op" id="7191376">;</span>&nbsp;<span class="ident" id="7191378">ok</span>&nbsp;<span class="op" id="7191381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191386">cli</span><span class="op" id="7191389">.</span><span class="ident" id="7191390">vers</span>&nbsp;<span class="op" id="7191395">=</span>&nbsp;<span class="ident" id="7191397">ch</span><span class="op" id="7191399">.</span><span class="ident" id="7191400">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7191407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191411">cli</span><span class="op" id="7191414">.</span><span class="ident" id="7191415">writeRecord</span><span class="op" id="7191426">(</span><span class="ident" id="7191427">recordTypeHandshake</span><span class="op" id="7191446">,</span>&nbsp;<span class="ident" id="7191448">m</span><span class="op" id="7191449">.</span><span class="ident" id="7191450">marshal</span><span class="op" id="7191457">(</span><span class="op" id="7191458">)</span><span class="op" id="7191459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191463">c</span><span class="op" id="7191464">.</span><span class="ident" id="7191465">Close</span><span class="op" id="7191470">(</span><span class="op" id="7191471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7191474">}</span><span class="op" id="7191475">(</span><span class="op" id="7191476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191479">err</span>&nbsp;<span class="op" id="7191483">:=</span>&nbsp;<span class="ident" id="7191486">Server</span><span class="op" id="7191492">(</span><span class="ident" id="7191493">s</span><span class="op" id="7191494">,</span>&nbsp;<span class="ident" id="7191496">testConfig</span><span class="op" id="7191506">)</span><span class="op" id="7191507">.</span><span class="ident" id="7191508">Handshake</span><span class="op" id="7191517">(</span><span class="op" id="7191518">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191521">s</span><span class="op" id="7191522">.</span><span class="ident" id="7191523">Close</span><span class="op" id="7191528">(</span><span class="op" id="7191529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7191532">if</span>&nbsp;<span class="ident" id="7191535">err</span>&nbsp;<span class="op" id="7191539">==</span>&nbsp;<span class="ident" id="7191542">nil</span>&nbsp;<span class="op" id="7191546">||</span>&nbsp;<span class="op" id="7191549">!</span><span class="ident" id="7191550">strings</span><span class="op" id="7191557">.</span><span class="ident" id="7191558">Contains</span><span class="op" id="7191566">(</span><span class="ident" id="7191567">err</span><span class="op" id="7191570">.</span><span class="ident" id="7191571">Error</span><span class="op" id="7191576">(</span><span class="op" id="7191577">)</span><span class="op" id="7191578">,</span>&nbsp;<span class="ident" id="7191580">expectedSubStr</span><span class="op" id="7191594">)</span>&nbsp;<span class="op" id="7191596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191600">t</span><span class="op" id="7191601">.</span><span class="ident" id="7191602">Errorf</span><span class="op" id="7191608">(</span><span class="string" id="7191609">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7191658">,</span>&nbsp;<span class="ident" id="7191660">err</span><span class="op" id="7191663">,</span>&nbsp;<span class="ident" id="7191665">expectedSubStr</span><span class="op" id="7191679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7191682">}</span><br>
<span class="lineno"></span><span class="op" id="7191684">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7191687">func</span>&nbsp;<span class="ident" id="7191692">TestSimpleError</span><span class="op" id="7191707">(</span><span class="ident" id="7191708">t</span>&nbsp;<span class="op" id="7191710">*</span><span class="ident" id="7191711">testing</span><span class="op" id="7191718">.</span><span class="ident" id="7191719">T</span><span class="op" id="7191720">)</span>&nbsp;<span class="op" id="7191722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191725">testClientHelloFailure</span><span class="op" id="7191747">(</span><span class="ident" id="7191748">t</span><span class="op" id="7191749">,</span>&nbsp;<span class="op" id="7191751">&amp;</span><span class="ident" id="7191752">serverHelloDoneMsg</span><span class="op" id="7191770">{</span><span class="op" id="7191771">}</span><span class="op" id="7191772">,</span>&nbsp;<span class="string" id="7191774">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="7191804">)</span><br>
<span class="lineno"></span><span class="op" id="7191806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7191809">var</span>&nbsp;<span class="ident" id="7191813">badProtocolVersions</span>&nbsp;<span class="op" id="7191833">=</span>&nbsp;<span class="op" id="7191835">[</span><span class="op" id="7191836">]</span><span class="builtintype" id="7191837">uint16</span><span class="op" id="7191843">{</span><span class="num" id="7191844">0x0000</span><span class="op" id="7191850">,</span>&nbsp;<span class="num" id="7191852">0x0005</span><span class="op" id="7191858">,</span>&nbsp;<span class="num" id="7191860">0x0100</span><span class="op" id="7191866">,</span>&nbsp;<span class="num" id="7191868">0x0105</span><span class="op" id="7191874">,</span>&nbsp;<span class="num" id="7191876">0x0200</span><span class="op" id="7191882">,</span>&nbsp;<span class="num" id="7191884">0x0205</span><span class="op" id="7191890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7191893">func</span>&nbsp;<span class="ident" id="7191898">TestRejectBadProtocolVersion</span><span class="op" id="7191926">(</span><span class="ident" id="7191927">t</span>&nbsp;<span class="op" id="7191929">*</span><span class="ident" id="7191930">testing</span><span class="op" id="7191937">.</span><span class="ident" id="7191938">T</span><span class="op" id="7191939">)</span>&nbsp;<span class="op" id="7191941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7191944">for</span>&nbsp;<span class="ident" id="7191948">_</span><span class="op" id="7191949">,</span>&nbsp;<span class="ident" id="7191951">v</span>&nbsp;<span class="op" id="7191953">:=</span>&nbsp;<span class="keyword" id="7191956">range</span>&nbsp;<span class="ident" id="7191962">badProtocolVersions</span>&nbsp;<span class="op" id="7191982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7191986">testClientHelloFailure</span><span class="op" id="7192008">(</span><span class="ident" id="7192009">t</span><span class="op" id="7192010">,</span>&nbsp;<span class="op" id="7192012">&amp;</span><span class="ident" id="7192013">clientHelloMsg</span><span class="op" id="7192027">{</span><span class="ident" id="7192028">vers</span><span class="op" id="7192032">:</span>&nbsp;<span class="ident" id="7192034">v</span><span class="op" id="7192035">}</span><span class="op" id="7192036">,</span>&nbsp;<span class="string" id="7192038">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="7192077">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7192080">}</span><br>
<span class="lineno"></span><span class="op" id="7192082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7192085">func</span>&nbsp;<span class="ident" id="7192090">TestNoSuiteOverlap</span><span class="op" id="7192108">(</span><span class="ident" id="7192109">t</span>&nbsp;<span class="op" id="7192111">*</span><span class="ident" id="7192112">testing</span><span class="op" id="7192119">.</span><span class="ident" id="7192120">T</span><span class="op" id="7192121">)</span>&nbsp;<span class="op" id="7192123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192126">clientHello</span>&nbsp;<span class="op" id="7192138">:=</span>&nbsp;<span class="op" id="7192141">&amp;</span><span class="ident" id="7192142">clientHelloMsg</span><span class="op" id="7192156">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192160">vers</span><span class="op" id="7192164">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7192180">0x0301</span><span class="op" id="7192186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192190">cipherSuites</span><span class="op" id="7192202">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192210">[</span><span class="op" id="7192211">]</span><span class="builtintype" id="7192212">uint16</span><span class="op" id="7192218">{</span><span class="num" id="7192219">0xff00</span><span class="op" id="7192225">}</span><span class="op" id="7192226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192230">compressionMethods</span><span class="op" id="7192248">:</span>&nbsp;<span class="op" id="7192250">[</span><span class="op" id="7192251">]</span><span class="builtintype" id="7192252">uint8</span><span class="op" id="7192257">{</span><span class="num" id="7192258">0</span><span class="op" id="7192259">}</span><span class="op" id="7192260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7192263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192266">testClientHelloFailure</span><span class="op" id="7192288">(</span><span class="ident" id="7192289">t</span><span class="op" id="7192290">,</span>&nbsp;<span class="ident" id="7192292">clientHello</span><span class="op" id="7192303">,</span>&nbsp;<span class="string" id="7192305">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="7192358">)</span><br>
<span class="lineno">95</span><span class="op" id="7192360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7192363">func</span>&nbsp;<span class="ident" id="7192368">TestNoCompressionOverlap</span><span class="op" id="7192392">(</span><span class="ident" id="7192393">t</span>&nbsp;<span class="op" id="7192395">*</span><span class="ident" id="7192396">testing</span><span class="op" id="7192403">.</span><span class="ident" id="7192404">T</span><span class="op" id="7192405">)</span>&nbsp;<span class="op" id="7192407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192410">clientHello</span>&nbsp;<span class="op" id="7192422">:=</span>&nbsp;<span class="op" id="7192425">&amp;</span><span class="ident" id="7192426">clientHelloMsg</span><span class="op" id="7192440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192444">vers</span><span class="op" id="7192448">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7192464">0x0301</span><span class="op" id="7192470">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192474">cipherSuites</span><span class="op" id="7192486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7192494">[</span><span class="op" id="7192495">]</span><span class="builtintype" id="7192496">uint16</span><span class="op" id="7192502">{</span><span class="ident" id="7192503">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7192527">}</span><span class="op" id="7192528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192532">compressionMethods</span><span class="op" id="7192550">:</span>&nbsp;<span class="op" id="7192552">[</span><span class="op" id="7192553">]</span><span class="builtintype" id="7192554">uint8</span><span class="op" id="7192559">{</span><span class="num" id="7192560">0xff</span><span class="op" id="7192564">}</span><span class="op" id="7192565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7192568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192571">testClientHelloFailure</span><span class="op" id="7192593">(</span><span class="ident" id="7192594">t</span><span class="op" id="7192595">,</span>&nbsp;<span class="ident" id="7192597">clientHello</span><span class="op" id="7192608">,</span>&nbsp;<span class="string" id="7192610">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="7192660">)</span><br>
<span class="lineno"></span><span class="op" id="7192662">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7192665">func</span>&nbsp;<span class="ident" id="7192670">TestTLS12OnlyCipherSuites</span><span class="op" id="7192695">(</span><span class="ident" id="7192696">t</span>&nbsp;<span class="op" id="7192698">*</span><span class="ident" id="7192699">testing</span><span class="op" id="7192706">.</span><span class="ident" id="7192707">T</span><span class="op" id="7192708">)</span>&nbsp;<span class="op" id="7192710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7192713">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7192784">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7192819">var</span>&nbsp;<span class="ident" id="7192823">zeros</span>&nbsp;<span class="op" id="7192829">[</span><span class="num" id="7192830">32</span><span class="op" id="7192832">]</span><span class="builtintype" id="7192833">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192840">clientHello</span>&nbsp;<span class="op" id="7192852">:=</span>&nbsp;<span class="op" id="7192855">&amp;</span><span class="ident" id="7192856">clientHelloMsg</span><span class="op" id="7192870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192874">vers</span><span class="op" id="7192878">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7192882">VersionTLS11</span><span class="op" id="7192894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192898">random</span><span class="op" id="7192904">:</span>&nbsp;<span class="ident" id="7192906">zeros</span><span class="op" id="7192911">[</span><span class="op" id="7192912">:</span><span class="op" id="7192913">]</span><span class="op" id="7192914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7192918">cipherSuites</span><span class="op" id="7192930">:</span>&nbsp;<span class="op" id="7192932">[</span><span class="op" id="7192933">]</span><span class="builtintype" id="7192934">uint16</span><span class="op" id="7192940">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7192945">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7192997">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7193045">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7193097">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193139">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="7193176">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193181">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7193205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7193209">}</span><span class="op" id="7193210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193214">compressionMethods</span><span class="op" id="7193232">:</span>&nbsp;<span class="op" id="7193234">[</span><span class="op" id="7193235">]</span><span class="builtintype" id="7193236">uint8</span><span class="op" id="7193241">{</span><span class="ident" id="7193242">compressionNone</span><span class="op" id="7193257">}</span><span class="op" id="7193258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193262">supportedCurves</span><span class="op" id="7193277">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193282">[</span><span class="op" id="7193283">]</span><span class="ident" id="7193284">CurveID</span><span class="op" id="7193291">{</span><span class="ident" id="7193292">CurveP256</span><span class="op" id="7193301">,</span>&nbsp;<span class="ident" id="7193303">CurveP384</span><span class="op" id="7193312">,</span>&nbsp;<span class="ident" id="7193314">CurveP521</span><span class="op" id="7193323">}</span><span class="op" id="7193324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193328">supportedPoints</span><span class="op" id="7193343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7193348">[</span><span class="op" id="7193349">]</span><span class="builtintype" id="7193350">uint8</span><span class="op" id="7193355">{</span><span class="ident" id="7193356">pointFormatUncompressed</span><span class="op" id="7193379">}</span><span class="op" id="7193380">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7193383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193387">c</span><span class="op" id="7193388">,</span>&nbsp;<span class="ident" id="7193390">s</span>&nbsp;<span class="op" id="7193392">:=</span>&nbsp;<span class="ident" id="7193395">net</span><span class="op" id="7193398">.</span><span class="ident" id="7193399">Pipe</span><span class="op" id="7193403">(</span><span class="op" id="7193404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193407">var</span>&nbsp;<span class="ident" id="7193411">reply</span>&nbsp;<span class="keyword" id="7193417">interface</span><span class="op" id="7193426">{</span><span class="op" id="7193427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193430">var</span>&nbsp;<span class="ident" id="7193434">clientErr</span>&nbsp;<span class="builtintype" id="7193444">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193451">go</span>&nbsp;<span class="keyword" id="7193454">func</span><span class="op" id="7193458">(</span><span class="op" id="7193459">)</span>&nbsp;<span class="op" id="7193461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193465">cli</span>&nbsp;<span class="op" id="7193469">:=</span>&nbsp;<span class="ident" id="7193472">Client</span><span class="op" id="7193478">(</span><span class="ident" id="7193479">c</span><span class="op" id="7193480">,</span>&nbsp;<span class="ident" id="7193482">testConfig</span><span class="op" id="7193492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193496">cli</span><span class="op" id="7193499">.</span><span class="ident" id="7193500">vers</span>&nbsp;<span class="op" id="7193505">=</span>&nbsp;<span class="ident" id="7193507">clientHello</span><span class="op" id="7193518">.</span><span class="ident" id="7193519">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193526">cli</span><span class="op" id="7193529">.</span><span class="ident" id="7193530">writeRecord</span><span class="op" id="7193541">(</span><span class="ident" id="7193542">recordTypeHandshake</span><span class="op" id="7193561">,</span>&nbsp;<span class="ident" id="7193563">clientHello</span><span class="op" id="7193574">.</span><span class="ident" id="7193575">marshal</span><span class="op" id="7193582">(</span><span class="op" id="7193583">)</span><span class="op" id="7193584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193588">reply</span><span class="op" id="7193593">,</span>&nbsp;<span class="ident" id="7193595">clientErr</span>&nbsp;<span class="op" id="7193605">=</span>&nbsp;<span class="ident" id="7193607">cli</span><span class="op" id="7193610">.</span><span class="ident" id="7193611">readHandshake</span><span class="op" id="7193624">(</span><span class="op" id="7193625">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193629">c</span><span class="op" id="7193630">.</span><span class="ident" id="7193631">Close</span><span class="op" id="7193636">(</span><span class="op" id="7193637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7193640">}</span><span class="op" id="7193641">(</span><span class="op" id="7193642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193645">config</span>&nbsp;<span class="op" id="7193652">:=</span>&nbsp;<span class="op" id="7193655">*</span><span class="ident" id="7193656">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193668">config</span><span class="op" id="7193674">.</span><span class="ident" id="7193675">CipherSuites</span>&nbsp;<span class="op" id="7193688">=</span>&nbsp;<span class="ident" id="7193690">clientHello</span><span class="op" id="7193701">.</span><span class="ident" id="7193702">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193716">Server</span><span class="op" id="7193722">(</span><span class="ident" id="7193723">s</span><span class="op" id="7193724">,</span>&nbsp;<span class="op" id="7193726">&amp;</span><span class="ident" id="7193727">config</span><span class="op" id="7193733">)</span><span class="op" id="7193734">.</span><span class="ident" id="7193735">Handshake</span><span class="op" id="7193744">(</span><span class="op" id="7193745">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193748">s</span><span class="op" id="7193749">.</span><span class="ident" id="7193750">Close</span><span class="op" id="7193755">(</span><span class="op" id="7193756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193759">if</span>&nbsp;<span class="ident" id="7193762">clientErr</span>&nbsp;<span class="op" id="7193772">!=</span>&nbsp;<span class="ident" id="7193775">nil</span>&nbsp;<span class="op" id="7193779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193783">t</span><span class="op" id="7193784">.</span><span class="ident" id="7193785">Fatal</span><span class="op" id="7193790">(</span><span class="ident" id="7193791">clientErr</span><span class="op" id="7193800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7193803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193806">serverHello</span><span class="op" id="7193817">,</span>&nbsp;<span class="ident" id="7193819">ok</span>&nbsp;<span class="op" id="7193822">:=</span>&nbsp;<span class="ident" id="7193825">reply</span><span class="op" id="7193830">.</span><span class="op" id="7193831">(</span><span class="op" id="7193832">*</span><span class="ident" id="7193833">serverHelloMsg</span><span class="op" id="7193847">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193850">if</span>&nbsp;<span class="op" id="7193853">!</span><span class="ident" id="7193854">ok</span>&nbsp;<span class="op" id="7193857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7193861">t</span><span class="op" id="7193862">.</span><span class="ident" id="7193863">Fatalf</span><span class="op" id="7193869">(</span><span class="string" id="7193870">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="7193921">,</span>&nbsp;<span class="ident" id="7193923">reply</span><span class="op" id="7193928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7193931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7193934">if</span>&nbsp;<span class="ident" id="7193937">s</span>&nbsp;<span class="op" id="7193939">:=</span>&nbsp;<span class="ident" id="7193942">serverHello</span><span class="op" id="7193953">.</span><span class="ident" id="7193954">cipherSuite</span><span class="op" id="7193965">;</span>&nbsp;<span class="ident" id="7193967">s</span>&nbsp;<span class="op" id="7193969">!=</span>&nbsp;<span class="ident" id="7193972">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7193997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194001">t</span><span class="op" id="7194002">.</span><span class="ident" id="7194003">Fatalf</span><span class="op" id="7194009">(</span><span class="string" id="7194010">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="7194044">,</span>&nbsp;<span class="ident" id="7194046">s</span><span class="op" id="7194047">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194050">}</span><br>
<span class="lineno"></span><span class="op" id="7194052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7194055">func</span>&nbsp;<span class="ident" id="7194060">TestAlertForwarding</span><span class="op" id="7194079">(</span><span class="ident" id="7194080">t</span>&nbsp;<span class="op" id="7194082">*</span><span class="ident" id="7194083">testing</span><span class="op" id="7194090">.</span><span class="ident" id="7194091">T</span><span class="op" id="7194092">)</span>&nbsp;<span class="op" id="7194094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194097">c</span><span class="op" id="7194098">,</span>&nbsp;<span class="ident" id="7194100">s</span>&nbsp;<span class="op" id="7194102">:=</span>&nbsp;<span class="ident" id="7194105">net</span><span class="op" id="7194108">.</span><span class="ident" id="7194109">Pipe</span><span class="op" id="7194113">(</span><span class="op" id="7194114">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194117">go</span>&nbsp;<span class="keyword" id="7194120">func</span><span class="op" id="7194124">(</span><span class="op" id="7194125">)</span>&nbsp;<span class="op" id="7194127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194131">Client</span><span class="op" id="7194137">(</span><span class="ident" id="7194138">c</span><span class="op" id="7194139">,</span>&nbsp;<span class="ident" id="7194141">testConfig</span><span class="op" id="7194151">)</span><span class="op" id="7194152">.</span><span class="ident" id="7194153">sendAlert</span><span class="op" id="7194162">(</span><span class="ident" id="7194163">alertUnknownCA</span><span class="op" id="7194177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194181">c</span><span class="op" id="7194182">.</span><span class="ident" id="7194183">Close</span><span class="op" id="7194188">(</span><span class="op" id="7194189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194192">}</span><span class="op" id="7194193">(</span><span class="op" id="7194194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194198">err</span>&nbsp;<span class="op" id="7194202">:=</span>&nbsp;<span class="ident" id="7194205">Server</span><span class="op" id="7194211">(</span><span class="ident" id="7194212">s</span><span class="op" id="7194213">,</span>&nbsp;<span class="ident" id="7194215">testConfig</span><span class="op" id="7194225">)</span><span class="op" id="7194226">.</span><span class="ident" id="7194227">Handshake</span><span class="op" id="7194236">(</span><span class="op" id="7194237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194240">s</span><span class="op" id="7194241">.</span><span class="ident" id="7194242">Close</span><span class="op" id="7194247">(</span><span class="op" id="7194248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194251">if</span>&nbsp;<span class="ident" id="7194254">e</span><span class="op" id="7194255">,</span>&nbsp;<span class="ident" id="7194257">ok</span>&nbsp;<span class="op" id="7194260">:=</span>&nbsp;<span class="ident" id="7194263">err</span><span class="op" id="7194266">.</span><span class="op" id="7194267">(</span><span class="op" id="7194268">*</span><span class="ident" id="7194269">net</span><span class="op" id="7194272">.</span><span class="ident" id="7194273">OpError</span><span class="op" id="7194280">)</span><span class="op" id="7194281">;</span>&nbsp;<span class="op" id="7194283">!</span><span class="ident" id="7194284">ok</span>&nbsp;<span class="op" id="7194287">||</span>&nbsp;<span class="ident" id="7194290">e</span><span class="op" id="7194291">.</span><span class="ident" id="7194292">Err</span>&nbsp;<span class="op" id="7194296">!=</span>&nbsp;<span class="builtintype" id="7194299">error</span><span class="op" id="7194304">(</span><span class="ident" id="7194305">alertUnknownCA</span><span class="op" id="7194319">)</span>&nbsp;<span class="op" id="7194321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194325">t</span><span class="op" id="7194326">.</span><span class="ident" id="7194327">Errorf</span><span class="op" id="7194333">(</span><span class="string" id="7194334">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7194363">,</span>&nbsp;<span class="ident" id="7194365">err</span><span class="op" id="7194368">,</span>&nbsp;<span class="builtintype" id="7194370">error</span><span class="op" id="7194375">(</span><span class="ident" id="7194376">alertUnknownCA</span><span class="op" id="7194390">)</span><span class="op" id="7194391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194394">}</span><br>
<span class="lineno">165</span><span class="op" id="7194396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7194399">func</span>&nbsp;<span class="ident" id="7194404">TestClose</span><span class="op" id="7194413">(</span><span class="ident" id="7194414">t</span>&nbsp;<span class="op" id="7194416">*</span><span class="ident" id="7194417">testing</span><span class="op" id="7194424">.</span><span class="ident" id="7194425">T</span><span class="op" id="7194426">)</span>&nbsp;<span class="op" id="7194428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194431">c</span><span class="op" id="7194432">,</span>&nbsp;<span class="ident" id="7194434">s</span>&nbsp;<span class="op" id="7194436">:=</span>&nbsp;<span class="ident" id="7194439">net</span><span class="op" id="7194442">.</span><span class="ident" id="7194443">Pipe</span><span class="op" id="7194447">(</span><span class="op" id="7194448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194451">go</span>&nbsp;<span class="ident" id="7194454">c</span><span class="op" id="7194455">.</span><span class="ident" id="7194456">Close</span><span class="op" id="7194461">(</span><span class="op" id="7194462">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194466">err</span>&nbsp;<span class="op" id="7194470">:=</span>&nbsp;<span class="ident" id="7194473">Server</span><span class="op" id="7194479">(</span><span class="ident" id="7194480">s</span><span class="op" id="7194481">,</span>&nbsp;<span class="ident" id="7194483">testConfig</span><span class="op" id="7194493">)</span><span class="op" id="7194494">.</span><span class="ident" id="7194495">Handshake</span><span class="op" id="7194504">(</span><span class="op" id="7194505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194508">s</span><span class="op" id="7194509">.</span><span class="ident" id="7194510">Close</span><span class="op" id="7194515">(</span><span class="op" id="7194516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194519">if</span>&nbsp;<span class="ident" id="7194522">err</span>&nbsp;<span class="op" id="7194526">!=</span>&nbsp;<span class="ident" id="7194529">io</span><span class="op" id="7194531">.</span><span class="ident" id="7194532">EOF</span>&nbsp;<span class="op" id="7194536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194540">t</span><span class="op" id="7194541">.</span><span class="ident" id="7194542">Errorf</span><span class="op" id="7194548">(</span><span class="string" id="7194549">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="7194578">,</span>&nbsp;<span class="ident" id="7194580">err</span><span class="op" id="7194583">,</span>&nbsp;<span class="ident" id="7194585">io</span><span class="op" id="7194587">.</span><span class="ident" id="7194588">EOF</span><span class="op" id="7194591">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194594">}</span><br>
<span class="lineno"></span><span class="op" id="7194596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7194599">func</span>&nbsp;<span class="ident" id="7194604">testHandshake</span><span class="op" id="7194617">(</span><span class="ident" id="7194618">clientConfig</span><span class="op" id="7194630">,</span>&nbsp;<span class="ident" id="7194632">serverConfig</span>&nbsp;<span class="op" id="7194645">*</span><span class="ident" id="7194646">Config</span><span class="op" id="7194652">)</span>&nbsp;<span class="op" id="7194654">(</span><span class="ident" id="7194655">state</span>&nbsp;<span class="ident" id="7194661">ConnectionState</span><span class="op" id="7194676">,</span>&nbsp;<span class="ident" id="7194678">err</span>&nbsp;<span class="builtintype" id="7194682">error</span><span class="op" id="7194687">)</span>&nbsp;<span class="op" id="7194689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194692">c</span><span class="op" id="7194693">,</span>&nbsp;<span class="ident" id="7194695">s</span>&nbsp;<span class="op" id="7194697">:=</span>&nbsp;<span class="ident" id="7194700">net</span><span class="op" id="7194703">.</span><span class="ident" id="7194704">Pipe</span><span class="op" id="7194708">(</span><span class="op" id="7194709">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194712">done</span>&nbsp;<span class="op" id="7194717">:=</span>&nbsp;<span class="builtinfunc" id="7194720">make</span><span class="op" id="7194724">(</span><span class="keyword" id="7194725">chan</span>&nbsp;<span class="builtintype" id="7194730">bool</span><span class="op" id="7194734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194737">go</span>&nbsp;<span class="keyword" id="7194740">func</span><span class="op" id="7194744">(</span><span class="op" id="7194745">)</span>&nbsp;<span class="op" id="7194747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194751">cli</span>&nbsp;<span class="op" id="7194755">:=</span>&nbsp;<span class="ident" id="7194758">Client</span><span class="op" id="7194764">(</span><span class="ident" id="7194765">c</span><span class="op" id="7194766">,</span>&nbsp;<span class="ident" id="7194768">clientConfig</span><span class="op" id="7194780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194784">cli</span><span class="op" id="7194787">.</span><span class="ident" id="7194788">Handshake</span><span class="op" id="7194797">(</span><span class="op" id="7194798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194802">c</span><span class="op" id="7194803">.</span><span class="ident" id="7194804">Close</span><span class="op" id="7194809">(</span><span class="op" id="7194810">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194814">done</span>&nbsp;<span class="op" id="7194819">&lt;-</span>&nbsp;<span class="builtintype" id="7194822">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194828">}</span><span class="op" id="7194829">(</span><span class="op" id="7194830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194833">server</span>&nbsp;<span class="op" id="7194840">:=</span>&nbsp;<span class="ident" id="7194843">Server</span><span class="op" id="7194849">(</span><span class="ident" id="7194850">s</span><span class="op" id="7194851">,</span>&nbsp;<span class="ident" id="7194853">serverConfig</span><span class="op" id="7194865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194868">err</span>&nbsp;<span class="op" id="7194872">=</span>&nbsp;<span class="ident" id="7194874">server</span><span class="op" id="7194880">.</span><span class="ident" id="7194881">Handshake</span><span class="op" id="7194890">(</span><span class="op" id="7194891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194894">if</span>&nbsp;<span class="ident" id="7194897">err</span>&nbsp;<span class="op" id="7194901">==</span>&nbsp;<span class="ident" id="7194904">nil</span>&nbsp;<span class="op" id="7194908">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194912">state</span>&nbsp;<span class="op" id="7194918">=</span>&nbsp;<span class="ident" id="7194920">server</span><span class="op" id="7194926">.</span><span class="ident" id="7194927">ConnectionState</span><span class="op" id="7194942">(</span><span class="op" id="7194943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7194949">s</span><span class="op" id="7194950">.</span><span class="ident" id="7194951">Close</span><span class="op" id="7194956">(</span><span class="op" id="7194957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7194960">&lt;-</span><span class="ident" id="7194962">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7194968">return</span><br>
<span class="lineno">195</span><span class="op" id="7194975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7194978">func</span>&nbsp;<span class="ident" id="7194983">TestVersion</span><span class="op" id="7194994">(</span><span class="ident" id="7194995">t</span>&nbsp;<span class="op" id="7194997">*</span><span class="ident" id="7194998">testing</span><span class="op" id="7195005">.</span><span class="ident" id="7195006">T</span><span class="op" id="7195007">)</span>&nbsp;<span class="op" id="7195009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195012">serverConfig</span>&nbsp;<span class="op" id="7195025">:=</span>&nbsp;<span class="op" id="7195028">&amp;</span><span class="ident" id="7195029">Config</span><span class="op" id="7195035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195039">Certificates</span><span class="op" id="7195051">:</span>&nbsp;<span class="ident" id="7195053">testConfig</span><span class="op" id="7195063">.</span><span class="ident" id="7195064">Certificates</span><span class="op" id="7195076">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195080">MaxVersion</span><span class="op" id="7195090">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7195094">VersionTLS11</span><span class="op" id="7195106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195112">clientConfig</span>&nbsp;<span class="op" id="7195125">:=</span>&nbsp;<span class="op" id="7195128">&amp;</span><span class="ident" id="7195129">Config</span><span class="op" id="7195135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195139">InsecureSkipVerify</span><span class="op" id="7195157">:</span>&nbsp;<span class="builtintype" id="7195159">true</span><span class="op" id="7195163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195166">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195169">state</span><span class="op" id="7195174">,</span>&nbsp;<span class="ident" id="7195176">err</span>&nbsp;<span class="op" id="7195180">:=</span>&nbsp;<span class="ident" id="7195183">testHandshake</span><span class="op" id="7195196">(</span><span class="ident" id="7195197">clientConfig</span><span class="op" id="7195209">,</span>&nbsp;<span class="ident" id="7195211">serverConfig</span><span class="op" id="7195223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7195226">if</span>&nbsp;<span class="ident" id="7195229">err</span>&nbsp;<span class="op" id="7195233">!=</span>&nbsp;<span class="ident" id="7195236">nil</span>&nbsp;<span class="op" id="7195240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195244">t</span><span class="op" id="7195245">.</span><span class="ident" id="7195246">Fatalf</span><span class="op" id="7195252">(</span><span class="string" id="7195253">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7195275">,</span>&nbsp;<span class="ident" id="7195277">err</span><span class="op" id="7195280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7195286">if</span>&nbsp;<span class="ident" id="7195289">state</span><span class="op" id="7195294">.</span><span class="ident" id="7195295">Version</span>&nbsp;<span class="op" id="7195303">!=</span>&nbsp;<span class="ident" id="7195306">VersionTLS11</span>&nbsp;<span class="op" id="7195319">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195323">t</span><span class="op" id="7195324">.</span><span class="ident" id="7195325">Fatalf</span><span class="op" id="7195331">(</span><span class="string" id="7195332">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="7195368">,</span>&nbsp;<span class="ident" id="7195370">state</span><span class="op" id="7195375">.</span><span class="ident" id="7195376">Version</span><span class="op" id="7195383">,</span>&nbsp;<span class="ident" id="7195385">VersionTLS11</span><span class="op" id="7195397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195400">}</span><br>
<span class="lineno"></span><span class="op" id="7195402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7195405">func</span>&nbsp;<span class="ident" id="7195410">TestCipherSuitePreference</span><span class="op" id="7195435">(</span><span class="ident" id="7195436">t</span>&nbsp;<span class="op" id="7195438">*</span><span class="ident" id="7195439">testing</span><span class="op" id="7195446">.</span><span class="ident" id="7195447">T</span><span class="op" id="7195448">)</span>&nbsp;<span class="op" id="7195450">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195453">serverConfig</span>&nbsp;<span class="op" id="7195466">:=</span>&nbsp;<span class="op" id="7195469">&amp;</span><span class="ident" id="7195470">Config</span><span class="op" id="7195476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195480">CipherSuites</span><span class="op" id="7195492">:</span>&nbsp;<span class="op" id="7195494">[</span><span class="op" id="7195495">]</span><span class="builtintype" id="7195496">uint16</span><span class="op" id="7195502">{</span><span class="ident" id="7195503">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7195527">,</span>&nbsp;<span class="ident" id="7195529">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7195557">,</span>&nbsp;<span class="ident" id="7195559">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="7195589">}</span><span class="op" id="7195590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195594">Certificates</span><span class="op" id="7195606">:</span>&nbsp;<span class="ident" id="7195608">testConfig</span><span class="op" id="7195618">.</span><span class="ident" id="7195619">Certificates</span><span class="op" id="7195631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195635">MaxVersion</span><span class="op" id="7195645">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7195649">VersionTLS11</span><span class="op" id="7195661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195664">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195667">clientConfig</span>&nbsp;<span class="op" id="7195680">:=</span>&nbsp;<span class="op" id="7195683">&amp;</span><span class="ident" id="7195684">Config</span><span class="op" id="7195690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195694">CipherSuites</span><span class="op" id="7195706">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7195714">[</span><span class="op" id="7195715">]</span><span class="builtintype" id="7195716">uint16</span><span class="op" id="7195722">{</span><span class="ident" id="7195723">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="7195751">,</span>&nbsp;<span class="ident" id="7195753">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="7195777">}</span><span class="op" id="7195778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195782">InsecureSkipVerify</span><span class="op" id="7195800">:</span>&nbsp;<span class="builtintype" id="7195802">true</span><span class="op" id="7195806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195812">state</span><span class="op" id="7195817">,</span>&nbsp;<span class="ident" id="7195819">err</span>&nbsp;<span class="op" id="7195823">:=</span>&nbsp;<span class="ident" id="7195826">testHandshake</span><span class="op" id="7195839">(</span><span class="ident" id="7195840">clientConfig</span><span class="op" id="7195852">,</span>&nbsp;<span class="ident" id="7195854">serverConfig</span><span class="op" id="7195866">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7195869">if</span>&nbsp;<span class="ident" id="7195872">err</span>&nbsp;<span class="op" id="7195876">!=</span>&nbsp;<span class="ident" id="7195879">nil</span>&nbsp;<span class="op" id="7195883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7195887">t</span><span class="op" id="7195888">.</span><span class="ident" id="7195889">Fatalf</span><span class="op" id="7195895">(</span><span class="string" id="7195896">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7195918">,</span>&nbsp;<span class="ident" id="7195920">err</span><span class="op" id="7195923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7195926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7195929">if</span>&nbsp;<span class="ident" id="7195932">state</span><span class="op" id="7195937">.</span><span class="ident" id="7195938">CipherSuite</span>&nbsp;<span class="op" id="7195950">!=</span>&nbsp;<span class="ident" id="7195953">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="7195982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7195986">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196049">t</span><span class="op" id="7196050">.</span><span class="ident" id="7196051">Fatalf</span><span class="op" id="7196057">(</span><span class="string" id="7196058">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7196100">,</span>&nbsp;<span class="ident" id="7196102">state</span><span class="op" id="7196107">.</span><span class="ident" id="7196108">CipherSuite</span><span class="op" id="7196119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7196122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196126">serverConfig</span><span class="op" id="7196138">.</span><span class="ident" id="7196139">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7196164">=</span>&nbsp;<span class="builtintype" id="7196166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196172">state</span><span class="op" id="7196177">,</span>&nbsp;<span class="ident" id="7196179">err</span>&nbsp;<span class="op" id="7196183">=</span>&nbsp;<span class="ident" id="7196185">testHandshake</span><span class="op" id="7196198">(</span><span class="ident" id="7196199">clientConfig</span><span class="op" id="7196211">,</span>&nbsp;<span class="ident" id="7196213">serverConfig</span><span class="op" id="7196225">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7196228">if</span>&nbsp;<span class="ident" id="7196231">err</span>&nbsp;<span class="op" id="7196235">!=</span>&nbsp;<span class="ident" id="7196238">nil</span>&nbsp;<span class="op" id="7196242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196246">t</span><span class="op" id="7196247">.</span><span class="ident" id="7196248">Fatalf</span><span class="op" id="7196254">(</span><span class="string" id="7196255">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7196277">,</span>&nbsp;<span class="ident" id="7196279">err</span><span class="op" id="7196282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7196285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7196288">if</span>&nbsp;<span class="ident" id="7196291">state</span><span class="op" id="7196296">.</span><span class="ident" id="7196297">CipherSuite</span>&nbsp;<span class="op" id="7196309">!=</span>&nbsp;<span class="ident" id="7196312">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="7196337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196341">t</span><span class="op" id="7196342">.</span><span class="ident" id="7196343">Fatalf</span><span class="op" id="7196349">(</span><span class="string" id="7196350">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="7196392">,</span>&nbsp;<span class="ident" id="7196394">state</span><span class="op" id="7196399">.</span><span class="ident" id="7196400">CipherSuite</span><span class="op" id="7196411">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7196414">}</span><br>
<span class="lineno"></span><span class="op" id="7196416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7196419">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7196494">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7196510">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="7196590">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="7196609">type</span>&nbsp;<span class="ident" id="7196614">serverTest</span>&nbsp;<span class="keyword" id="7196625">struct</span>&nbsp;<span class="op" id="7196632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196635">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196708">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196749">name</span>&nbsp;<span class="builtintype" id="7196754">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196762">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196828">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196873">command</span>&nbsp;<span class="op" id="7196881">[</span><span class="op" id="7196882">]</span><span class="builtintype" id="7196883">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196891">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7196955">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7196989">expectedPeerCerts</span>&nbsp;<span class="op" id="7197007">[</span><span class="op" id="7197008">]</span><span class="builtintype" id="7197009">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197017">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7197088">config</span>&nbsp;<span class="op" id="7197095">*</span><span class="ident" id="7197096">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197104">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197178">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7197216">expectAlert</span>&nbsp;<span class="builtintype" id="7197228">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197234">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197303">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7197375">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="7197405">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197413">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197482">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7197555">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7197592">validate</span>&nbsp;<span class="keyword" id="7197601">func</span><span class="op" id="7197605">(</span><span class="ident" id="7197606">ConnectionState</span><span class="op" id="7197621">)</span>&nbsp;<span class="builtintype" id="7197623">error</span><br>
<span class="lineno">270</span><span class="op" id="7197629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7197632">var</span>&nbsp;<span class="ident" id="7197636">defaultClientCommand</span>&nbsp;<span class="op" id="7197657">=</span>&nbsp;<span class="op" id="7197659">[</span><span class="op" id="7197660">]</span><span class="builtintype" id="7197661">string</span><span class="op" id="7197667">{</span><span class="string" id="7197668">&#34;openssl&#34;</span><span class="op" id="7197677">,</span>&nbsp;<span class="string" id="7197679">&#34;s_client&#34;</span><span class="op" id="7197689">,</span>&nbsp;<span class="string" id="7197691">&#34;-no_ticket&#34;</span><span class="op" id="7197703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7197706">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="7197782">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7197862">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7197877">func</span>&nbsp;<span class="op" id="7197882">(</span><span class="ident" id="7197883">test</span>&nbsp;<span class="op" id="7197888">*</span><span class="ident" id="7197889">serverTest</span><span class="op" id="7197899">)</span>&nbsp;<span class="ident" id="7197901">connFromCommand</span><span class="op" id="7197916">(</span><span class="op" id="7197917">)</span>&nbsp;<span class="op" id="7197919">(</span><span class="ident" id="7197920">conn</span>&nbsp;<span class="op" id="7197925">*</span><span class="ident" id="7197926">recordingConn</span><span class="op" id="7197939">,</span>&nbsp;<span class="ident" id="7197941">child</span>&nbsp;<span class="op" id="7197947">*</span><span class="ident" id="7197948">exec</span><span class="op" id="7197952">.</span><span class="ident" id="7197953">Cmd</span><span class="op" id="7197956">,</span>&nbsp;<span class="ident" id="7197958">err</span>&nbsp;<span class="builtintype" id="7197962">error</span><span class="op" id="7197967">)</span>&nbsp;<span class="op" id="7197969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7197972">l</span><span class="op" id="7197973">,</span>&nbsp;<span class="ident" id="7197975">err</span>&nbsp;<span class="op" id="7197979">:=</span>&nbsp;<span class="ident" id="7197982">net</span><span class="op" id="7197985">.</span><span class="ident" id="7197986">ListenTCP</span><span class="op" id="7197995">(</span><span class="string" id="7197996">&#34;tcp&#34;</span><span class="op" id="7198001">,</span>&nbsp;<span class="op" id="7198003">&amp;</span><span class="ident" id="7198004">net</span><span class="op" id="7198007">.</span><span class="ident" id="7198008">TCPAddr</span><span class="op" id="7198015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198019">IP</span><span class="op" id="7198021">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7198025">net</span><span class="op" id="7198028">.</span><span class="ident" id="7198029">IPv4</span><span class="op" id="7198033">(</span><span class="num" id="7198034">127</span><span class="op" id="7198037">,</span>&nbsp;<span class="num" id="7198039">0</span><span class="op" id="7198040">,</span>&nbsp;<span class="num" id="7198042">0</span><span class="op" id="7198043">,</span>&nbsp;<span class="num" id="7198045">1</span><span class="op" id="7198046">)</span><span class="op" id="7198047">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198051">Port</span><span class="op" id="7198055">:</span>&nbsp;<span class="num" id="7198057">0</span><span class="op" id="7198058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198061">}</span><span class="op" id="7198062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198065">if</span>&nbsp;<span class="ident" id="7198068">err</span>&nbsp;<span class="op" id="7198072">!=</span>&nbsp;<span class="ident" id="7198075">nil</span>&nbsp;<span class="op" id="7198079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198083">return</span>&nbsp;<span class="ident" id="7198090">nil</span><span class="op" id="7198093">,</span>&nbsp;<span class="ident" id="7198095">nil</span><span class="op" id="7198098">,</span>&nbsp;<span class="ident" id="7198100">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198105">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198108">defer</span>&nbsp;<span class="ident" id="7198114">l</span><span class="op" id="7198115">.</span><span class="ident" id="7198116">Close</span><span class="op" id="7198121">(</span><span class="op" id="7198122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198126">port</span>&nbsp;<span class="op" id="7198131">:=</span>&nbsp;<span class="ident" id="7198134">l</span><span class="op" id="7198135">.</span><span class="ident" id="7198136">Addr</span><span class="op" id="7198140">(</span><span class="op" id="7198141">)</span><span class="op" id="7198142">.</span><span class="op" id="7198143">(</span><span class="op" id="7198144">*</span><span class="ident" id="7198145">net</span><span class="op" id="7198148">.</span><span class="ident" id="7198149">TCPAddr</span><span class="op" id="7198156">)</span><span class="op" id="7198157">.</span><span class="ident" id="7198158">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198165">var</span>&nbsp;<span class="ident" id="7198169">command</span>&nbsp;<span class="op" id="7198177">[</span><span class="op" id="7198178">]</span><span class="builtintype" id="7198179">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198187">command</span>&nbsp;<span class="op" id="7198195">=</span>&nbsp;<span class="builtinfunc" id="7198197">append</span><span class="op" id="7198203">(</span><span class="ident" id="7198204">command</span><span class="op" id="7198211">,</span>&nbsp;<span class="ident" id="7198213">test</span><span class="op" id="7198217">.</span><span class="ident" id="7198218">command</span><span class="op" id="7198225">...</span><span class="op" id="7198228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198231">if</span>&nbsp;<span class="builtinfunc" id="7198234">len</span><span class="op" id="7198237">(</span><span class="ident" id="7198238">command</span><span class="op" id="7198245">)</span>&nbsp;<span class="op" id="7198247">==</span>&nbsp;<span class="num" id="7198250">0</span>&nbsp;<span class="op" id="7198252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198256">command</span>&nbsp;<span class="op" id="7198264">=</span>&nbsp;<span class="ident" id="7198266">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198291">command</span>&nbsp;<span class="op" id="7198299">=</span>&nbsp;<span class="builtinfunc" id="7198301">append</span><span class="op" id="7198307">(</span><span class="ident" id="7198308">command</span><span class="op" id="7198315">,</span>&nbsp;<span class="string" id="7198317">&#34;-connect&#34;</span><span class="op" id="7198327">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198330">command</span>&nbsp;<span class="op" id="7198338">=</span>&nbsp;<span class="builtinfunc" id="7198340">append</span><span class="op" id="7198346">(</span><span class="ident" id="7198347">command</span><span class="op" id="7198354">,</span>&nbsp;<span class="ident" id="7198356">fmt</span><span class="op" id="7198359">.</span><span class="ident" id="7198360">Sprintf</span><span class="op" id="7198367">(</span><span class="string" id="7198368">&#34;127.0.0.1:%d&#34;</span><span class="op" id="7198382">,</span>&nbsp;<span class="ident" id="7198384">port</span><span class="op" id="7198388">)</span><span class="op" id="7198389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198392">cmd</span>&nbsp;<span class="op" id="7198396">:=</span>&nbsp;<span class="ident" id="7198399">exec</span><span class="op" id="7198403">.</span><span class="ident" id="7198404">Command</span><span class="op" id="7198411">(</span><span class="ident" id="7198412">command</span><span class="op" id="7198419">[</span><span class="num" id="7198420">0</span><span class="op" id="7198421">]</span><span class="op" id="7198422">,</span>&nbsp;<span class="ident" id="7198424">command</span><span class="op" id="7198431">[</span><span class="num" id="7198432">1</span><span class="op" id="7198433">:</span><span class="op" id="7198434">]</span><span class="op" id="7198435">...</span><span class="op" id="7198438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198441">cmd</span><span class="op" id="7198444">.</span><span class="ident" id="7198445">Stdin</span>&nbsp;<span class="op" id="7198451">=</span>&nbsp;<span class="ident" id="7198453">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198458">var</span>&nbsp;<span class="ident" id="7198462">output</span>&nbsp;<span class="ident" id="7198469">bytes</span><span class="op" id="7198474">.</span><span class="ident" id="7198475">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198483">cmd</span><span class="op" id="7198486">.</span><span class="ident" id="7198487">Stdout</span>&nbsp;<span class="op" id="7198494">=</span>&nbsp;<span class="op" id="7198496">&amp;</span><span class="ident" id="7198497">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198505">cmd</span><span class="op" id="7198508">.</span><span class="ident" id="7198509">Stderr</span>&nbsp;<span class="op" id="7198516">=</span>&nbsp;<span class="op" id="7198518">&amp;</span><span class="ident" id="7198519">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198527">if</span>&nbsp;<span class="ident" id="7198530">err</span>&nbsp;<span class="op" id="7198534">:=</span>&nbsp;<span class="ident" id="7198537">cmd</span><span class="op" id="7198540">.</span><span class="ident" id="7198541">Start</span><span class="op" id="7198546">(</span><span class="op" id="7198547">)</span><span class="op" id="7198548">;</span>&nbsp;<span class="ident" id="7198550">err</span>&nbsp;<span class="op" id="7198554">!=</span>&nbsp;<span class="ident" id="7198557">nil</span>&nbsp;<span class="op" id="7198561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198565">return</span>&nbsp;<span class="ident" id="7198572">nil</span><span class="op" id="7198575">,</span>&nbsp;<span class="ident" id="7198577">nil</span><span class="op" id="7198580">,</span>&nbsp;<span class="ident" id="7198582">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198591">connChan</span>&nbsp;<span class="op" id="7198600">:=</span>&nbsp;<span class="builtinfunc" id="7198603">make</span><span class="op" id="7198607">(</span><span class="keyword" id="7198608">chan</span>&nbsp;<span class="keyword" id="7198613">interface</span><span class="op" id="7198622">{</span><span class="op" id="7198623">}</span><span class="op" id="7198624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198627">go</span>&nbsp;<span class="keyword" id="7198630">func</span><span class="op" id="7198634">(</span><span class="op" id="7198635">)</span>&nbsp;<span class="op" id="7198637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198641">tcpConn</span><span class="op" id="7198648">,</span>&nbsp;<span class="ident" id="7198650">err</span>&nbsp;<span class="op" id="7198654">:=</span>&nbsp;<span class="ident" id="7198657">l</span><span class="op" id="7198658">.</span><span class="ident" id="7198659">Accept</span><span class="op" id="7198665">(</span><span class="op" id="7198666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198670">if</span>&nbsp;<span class="ident" id="7198673">err</span>&nbsp;<span class="op" id="7198677">!=</span>&nbsp;<span class="ident" id="7198680">nil</span>&nbsp;<span class="op" id="7198684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198689">connChan</span>&nbsp;<span class="op" id="7198698">&lt;-</span>&nbsp;<span class="ident" id="7198701">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198711">connChan</span>&nbsp;<span class="op" id="7198720">&lt;-</span>&nbsp;<span class="ident" id="7198723">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198732">}</span><span class="op" id="7198733">(</span><span class="op" id="7198734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198738">var</span>&nbsp;<span class="ident" id="7198742">tcpConn</span>&nbsp;<span class="ident" id="7198750">net</span><span class="op" id="7198753">.</span><span class="ident" id="7198754">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198760">select</span>&nbsp;<span class="op" id="7198767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198770">case</span>&nbsp;<span class="ident" id="7198775">connOrError</span>&nbsp;<span class="op" id="7198787">:=</span>&nbsp;<span class="op" id="7198790">&lt;-</span><span class="ident" id="7198792">connChan</span><span class="op" id="7198800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198804">if</span>&nbsp;<span class="ident" id="7198807">err</span><span class="op" id="7198810">,</span>&nbsp;<span class="ident" id="7198812">ok</span>&nbsp;<span class="op" id="7198815">:=</span>&nbsp;<span class="ident" id="7198818">connOrError</span><span class="op" id="7198829">.</span><span class="op" id="7198830">(</span><span class="builtintype" id="7198831">error</span><span class="op" id="7198836">)</span><span class="op" id="7198837">;</span>&nbsp;<span class="ident" id="7198839">ok</span>&nbsp;<span class="op" id="7198842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198847">return</span>&nbsp;<span class="ident" id="7198854">nil</span><span class="op" id="7198857">,</span>&nbsp;<span class="ident" id="7198859">nil</span><span class="op" id="7198862">,</span>&nbsp;<span class="ident" id="7198864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7198870">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198874">tcpConn</span>&nbsp;<span class="op" id="7198882">=</span>&nbsp;<span class="ident" id="7198884">connOrError</span><span class="op" id="7198895">.</span><span class="op" id="7198896">(</span><span class="ident" id="7198897">net</span><span class="op" id="7198900">.</span><span class="ident" id="7198901">Conn</span><span class="op" id="7198905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198908">case</span>&nbsp;<span class="op" id="7198913">&lt;-</span><span class="ident" id="7198915">time</span><span class="op" id="7198919">.</span><span class="ident" id="7198920">After</span><span class="op" id="7198925">(</span><span class="num" id="7198926">2</span>&nbsp;<span class="op" id="7198928">*</span>&nbsp;<span class="ident" id="7198930">time</span><span class="op" id="7198934">.</span><span class="ident" id="7198935">Second</span><span class="op" id="7198941">)</span><span class="op" id="7198942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7198946">output</span><span class="op" id="7198952">.</span><span class="ident" id="7198953">WriteTo</span><span class="op" id="7198960">(</span><span class="ident" id="7198961">os</span><span class="op" id="7198963">.</span><span class="ident" id="7198964">Stdout</span><span class="op" id="7198970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7198974">return</span>&nbsp;<span class="ident" id="7198981">nil</span><span class="op" id="7198984">,</span>&nbsp;<span class="ident" id="7198986">nil</span><span class="op" id="7198989">,</span>&nbsp;<span class="ident" id="7198991">errors</span><span class="op" id="7198997">.</span><span class="ident" id="7198998">New</span><span class="op" id="7199001">(</span><span class="string" id="7199002">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="7199055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199058">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199062">record</span>&nbsp;<span class="op" id="7199069">:=</span>&nbsp;<span class="op" id="7199072">&amp;</span><span class="ident" id="7199073">recordingConn</span><span class="op" id="7199086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199090">Conn</span><span class="op" id="7199094">:</span>&nbsp;<span class="ident" id="7199096">tcpConn</span><span class="op" id="7199103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199110">return</span>&nbsp;<span class="ident" id="7199117">record</span><span class="op" id="7199123">,</span>&nbsp;<span class="ident" id="7199125">cmd</span><span class="op" id="7199128">,</span>&nbsp;<span class="ident" id="7199130">nil</span><br>
<span class="lineno"></span><span class="op" id="7199134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7199137">func</span>&nbsp;<span class="op" id="7199142">(</span><span class="ident" id="7199143">test</span>&nbsp;<span class="op" id="7199148">*</span><span class="ident" id="7199149">serverTest</span><span class="op" id="7199159">)</span>&nbsp;<span class="ident" id="7199161">dataPath</span><span class="op" id="7199169">(</span><span class="op" id="7199170">)</span>&nbsp;<span class="builtintype" id="7199172">string</span>&nbsp;<span class="op" id="7199179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199182">return</span>&nbsp;<span class="ident" id="7199189">filepath</span><span class="op" id="7199197">.</span><span class="ident" id="7199198">Join</span><span class="op" id="7199202">(</span><span class="string" id="7199203">&#34;testdata&#34;</span><span class="op" id="7199213">,</span>&nbsp;<span class="string" id="7199215">&#34;Server-&#34;</span><span class="op" id="7199224">+</span><span class="ident" id="7199225">test</span><span class="op" id="7199229">.</span><span class="ident" id="7199230">name</span><span class="op" id="7199234">)</span><br>
<span class="lineno">335</span><span class="op" id="7199236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7199239">func</span>&nbsp;<span class="op" id="7199244">(</span><span class="ident" id="7199245">test</span>&nbsp;<span class="op" id="7199250">*</span><span class="ident" id="7199251">serverTest</span><span class="op" id="7199261">)</span>&nbsp;<span class="ident" id="7199263">loadData</span><span class="op" id="7199271">(</span><span class="op" id="7199272">)</span>&nbsp;<span class="op" id="7199274">(</span><span class="ident" id="7199275">flows</span>&nbsp;<span class="op" id="7199281">[</span><span class="op" id="7199282">]</span><span class="op" id="7199283">[</span><span class="op" id="7199284">]</span><span class="builtintype" id="7199285">byte</span><span class="op" id="7199289">,</span>&nbsp;<span class="ident" id="7199291">err</span>&nbsp;<span class="builtintype" id="7199295">error</span><span class="op" id="7199300">)</span>&nbsp;<span class="op" id="7199302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199305">in</span><span class="op" id="7199307">,</span>&nbsp;<span class="ident" id="7199309">err</span>&nbsp;<span class="op" id="7199313">:=</span>&nbsp;<span class="ident" id="7199316">os</span><span class="op" id="7199318">.</span><span class="ident" id="7199319">Open</span><span class="op" id="7199323">(</span><span class="ident" id="7199324">test</span><span class="op" id="7199328">.</span><span class="ident" id="7199329">dataPath</span><span class="op" id="7199337">(</span><span class="op" id="7199338">)</span><span class="op" id="7199339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199342">if</span>&nbsp;<span class="ident" id="7199345">err</span>&nbsp;<span class="op" id="7199349">!=</span>&nbsp;<span class="ident" id="7199352">nil</span>&nbsp;<span class="op" id="7199356">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199360">return</span>&nbsp;<span class="ident" id="7199367">nil</span><span class="op" id="7199370">,</span>&nbsp;<span class="ident" id="7199372">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199380">defer</span>&nbsp;<span class="ident" id="7199386">in</span><span class="op" id="7199388">.</span><span class="ident" id="7199389">Close</span><span class="op" id="7199394">(</span><span class="op" id="7199395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199398">return</span>&nbsp;<span class="ident" id="7199405">parseTestData</span><span class="op" id="7199418">(</span><span class="ident" id="7199419">in</span><span class="op" id="7199421">)</span><br>
<span class="lineno"></span><span class="op" id="7199423">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7199426">func</span>&nbsp;<span class="op" id="7199431">(</span><span class="ident" id="7199432">test</span>&nbsp;<span class="op" id="7199437">*</span><span class="ident" id="7199438">serverTest</span><span class="op" id="7199448">)</span>&nbsp;<span class="ident" id="7199450">run</span><span class="op" id="7199453">(</span><span class="ident" id="7199454">t</span>&nbsp;<span class="op" id="7199456">*</span><span class="ident" id="7199457">testing</span><span class="op" id="7199464">.</span><span class="ident" id="7199465">T</span><span class="op" id="7199466">,</span>&nbsp;<span class="ident" id="7199468">write</span>&nbsp;<span class="builtintype" id="7199474">bool</span><span class="op" id="7199478">)</span>&nbsp;<span class="op" id="7199480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199483">var</span>&nbsp;<span class="ident" id="7199487">clientConn</span><span class="op" id="7199497">,</span>&nbsp;<span class="ident" id="7199499">serverConn</span>&nbsp;<span class="ident" id="7199510">net</span><span class="op" id="7199513">.</span><span class="ident" id="7199514">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199520">var</span>&nbsp;<span class="ident" id="7199524">recordingConn</span>&nbsp;<span class="op" id="7199538">*</span><span class="ident" id="7199539">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199554">var</span>&nbsp;<span class="ident" id="7199558">childProcess</span>&nbsp;<span class="op" id="7199571">*</span><span class="ident" id="7199572">exec</span><span class="op" id="7199576">.</span><span class="ident" id="7199577">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199583">if</span>&nbsp;<span class="ident" id="7199586">write</span>&nbsp;<span class="op" id="7199592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199596">var</span>&nbsp;<span class="ident" id="7199600">err</span>&nbsp;<span class="builtintype" id="7199604">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199612">recordingConn</span><span class="op" id="7199625">,</span>&nbsp;<span class="ident" id="7199627">childProcess</span><span class="op" id="7199639">,</span>&nbsp;<span class="ident" id="7199641">err</span>&nbsp;<span class="op" id="7199645">=</span>&nbsp;<span class="ident" id="7199647">test</span><span class="op" id="7199651">.</span><span class="ident" id="7199652">connFromCommand</span><span class="op" id="7199667">(</span><span class="op" id="7199668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199672">if</span>&nbsp;<span class="ident" id="7199675">err</span>&nbsp;<span class="op" id="7199679">!=</span>&nbsp;<span class="ident" id="7199682">nil</span>&nbsp;<span class="op" id="7199686">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199691">t</span><span class="op" id="7199692">.</span><span class="ident" id="7199693">Fatalf</span><span class="op" id="7199699">(</span><span class="string" id="7199700">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="7199732">,</span>&nbsp;<span class="ident" id="7199734">err</span><span class="op" id="7199737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199745">serverConn</span>&nbsp;<span class="op" id="7199756">=</span>&nbsp;<span class="ident" id="7199758">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199773">}</span>&nbsp;<span class="keyword" id="7199775">else</span>&nbsp;<span class="op" id="7199780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199784">clientConn</span><span class="op" id="7199794">,</span>&nbsp;<span class="ident" id="7199796">serverConn</span>&nbsp;<span class="op" id="7199807">=</span>&nbsp;<span class="ident" id="7199809">net</span><span class="op" id="7199812">.</span><span class="ident" id="7199813">Pipe</span><span class="op" id="7199817">(</span><span class="op" id="7199818">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199824">config</span>&nbsp;<span class="op" id="7199831">:=</span>&nbsp;<span class="ident" id="7199834">test</span><span class="op" id="7199838">.</span><span class="ident" id="7199839">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199847">if</span>&nbsp;<span class="ident" id="7199850">config</span>&nbsp;<span class="op" id="7199857">==</span>&nbsp;<span class="ident" id="7199860">nil</span>&nbsp;<span class="op" id="7199864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199868">config</span>&nbsp;<span class="op" id="7199875">=</span>&nbsp;<span class="ident" id="7199877">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7199889">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199892">server</span>&nbsp;<span class="op" id="7199899">:=</span>&nbsp;<span class="ident" id="7199902">Server</span><span class="op" id="7199908">(</span><span class="ident" id="7199909">serverConn</span><span class="op" id="7199919">,</span>&nbsp;<span class="ident" id="7199921">config</span><span class="op" id="7199927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7199930">connStateChan</span>&nbsp;<span class="op" id="7199944">:=</span>&nbsp;<span class="builtinfunc" id="7199947">make</span><span class="op" id="7199951">(</span><span class="keyword" id="7199952">chan</span>&nbsp;<span class="ident" id="7199957">ConnectionState</span><span class="op" id="7199972">,</span>&nbsp;<span class="num" id="7199974">1</span><span class="op" id="7199975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199978">go</span>&nbsp;<span class="keyword" id="7199981">func</span><span class="op" id="7199985">(</span><span class="op" id="7199986">)</span>&nbsp;<span class="op" id="7199988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7199992">var</span>&nbsp;<span class="ident" id="7199996">err</span>&nbsp;<span class="builtintype" id="7200000">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200008">if</span>&nbsp;<span class="ident" id="7200011">_</span><span class="op" id="7200012">,</span>&nbsp;<span class="ident" id="7200014">err</span>&nbsp;<span class="op" id="7200018">=</span>&nbsp;<span class="ident" id="7200020">server</span><span class="op" id="7200026">.</span><span class="ident" id="7200027">Write</span><span class="op" id="7200032">(</span><span class="op" id="7200033">[</span><span class="op" id="7200034">]</span><span class="builtintype" id="7200035">byte</span><span class="op" id="7200039">(</span><span class="string" id="7200040">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="7200056">)</span><span class="op" id="7200057">)</span><span class="op" id="7200058">;</span>&nbsp;<span class="ident" id="7200060">err</span>&nbsp;<span class="op" id="7200064">!=</span>&nbsp;<span class="ident" id="7200067">nil</span>&nbsp;<span class="op" id="7200071">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200076">t</span><span class="op" id="7200077">.</span><span class="ident" id="7200078">Logf</span><span class="op" id="7200082">(</span><span class="string" id="7200083">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="7200112">,</span>&nbsp;<span class="ident" id="7200114">err</span><span class="op" id="7200117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200125">if</span>&nbsp;<span class="builtinfunc" id="7200128">len</span><span class="op" id="7200131">(</span><span class="ident" id="7200132">test</span><span class="op" id="7200136">.</span><span class="ident" id="7200137">expectHandshakeErrorIncluding</span><span class="op" id="7200166">)</span>&nbsp;<span class="op" id="7200168">&gt;</span>&nbsp;<span class="num" id="7200170">0</span>&nbsp;<span class="op" id="7200172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200177">if</span>&nbsp;<span class="ident" id="7200180">err</span>&nbsp;<span class="op" id="7200184">==</span>&nbsp;<span class="ident" id="7200187">nil</span>&nbsp;<span class="op" id="7200191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200197">t</span><span class="op" id="7200198">.</span><span class="ident" id="7200199">Errorf</span><span class="op" id="7200205">(</span><span class="string" id="7200206">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="7200245">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200250">}</span>&nbsp;<span class="keyword" id="7200252">else</span>&nbsp;<span class="keyword" id="7200257">if</span>&nbsp;<span class="ident" id="7200260">s</span>&nbsp;<span class="op" id="7200262">:=</span>&nbsp;<span class="ident" id="7200265">err</span><span class="op" id="7200268">.</span><span class="ident" id="7200269">Error</span><span class="op" id="7200274">(</span><span class="op" id="7200275">)</span><span class="op" id="7200276">;</span>&nbsp;<span class="op" id="7200278">!</span><span class="ident" id="7200279">strings</span><span class="op" id="7200286">.</span><span class="ident" id="7200287">Contains</span><span class="op" id="7200295">(</span><span class="ident" id="7200296">s</span><span class="op" id="7200297">,</span>&nbsp;<span class="ident" id="7200299">test</span><span class="op" id="7200303">.</span><span class="ident" id="7200304">expectHandshakeErrorIncluding</span><span class="op" id="7200333">)</span>&nbsp;<span class="op" id="7200335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200341">t</span><span class="op" id="7200342">.</span><span class="ident" id="7200343">Errorf</span><span class="op" id="7200349">(</span><span class="string" id="7200350">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="7200395">,</span>&nbsp;<span class="ident" id="7200397">test</span><span class="op" id="7200401">.</span><span class="ident" id="7200402">expectHandshakeErrorIncluding</span><span class="op" id="7200431">,</span>&nbsp;<span class="ident" id="7200433">s</span><span class="op" id="7200434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200447">server</span><span class="op" id="7200453">.</span><span class="ident" id="7200454">Close</span><span class="op" id="7200459">(</span><span class="op" id="7200460">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200464">serverConn</span><span class="op" id="7200474">.</span><span class="ident" id="7200475">Close</span><span class="op" id="7200480">(</span><span class="op" id="7200481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200485">connStateChan</span>&nbsp;<span class="op" id="7200499">&lt;-</span>&nbsp;<span class="ident" id="7200502">server</span><span class="op" id="7200508">.</span><span class="ident" id="7200509">ConnectionState</span><span class="op" id="7200524">(</span><span class="op" id="7200525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200528">}</span><span class="op" id="7200529">(</span><span class="op" id="7200530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200534">if</span>&nbsp;<span class="op" id="7200537">!</span><span class="ident" id="7200538">write</span>&nbsp;<span class="op" id="7200544">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200548">flows</span><span class="op" id="7200553">,</span>&nbsp;<span class="ident" id="7200555">err</span>&nbsp;<span class="op" id="7200559">:=</span>&nbsp;<span class="ident" id="7200562">test</span><span class="op" id="7200566">.</span><span class="ident" id="7200567">loadData</span><span class="op" id="7200575">(</span><span class="op" id="7200576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200580">if</span>&nbsp;<span class="ident" id="7200583">err</span>&nbsp;<span class="op" id="7200587">!=</span>&nbsp;<span class="ident" id="7200590">nil</span>&nbsp;<span class="op" id="7200594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200599">if</span>&nbsp;<span class="op" id="7200602">!</span><span class="ident" id="7200603">test</span><span class="op" id="7200607">.</span><span class="ident" id="7200608">expectAlert</span>&nbsp;<span class="op" id="7200620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200626">t</span><span class="op" id="7200627">.</span><span class="ident" id="7200628">Fatalf</span><span class="op" id="7200634">(</span><span class="string" id="7200635">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7200668">,</span>&nbsp;<span class="ident" id="7200670">test</span><span class="op" id="7200674">.</span><span class="ident" id="7200675">name</span><span class="op" id="7200679">,</span>&nbsp;<span class="ident" id="7200681">test</span><span class="op" id="7200685">.</span><span class="ident" id="7200686">dataPath</span><span class="op" id="7200694">(</span><span class="op" id="7200695">)</span><span class="op" id="7200696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200701">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200709">for</span>&nbsp;<span class="ident" id="7200713">i</span><span class="op" id="7200714">,</span>&nbsp;<span class="ident" id="7200716">b</span>&nbsp;<span class="op" id="7200718">:=</span>&nbsp;<span class="keyword" id="7200721">range</span>&nbsp;<span class="ident" id="7200727">flows</span>&nbsp;<span class="op" id="7200733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200738">if</span>&nbsp;<span class="ident" id="7200741">i</span><span class="op" id="7200742">%</span><span class="num" id="7200743">2</span>&nbsp;<span class="op" id="7200745">==</span>&nbsp;<span class="num" id="7200748">0</span>&nbsp;<span class="op" id="7200750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200756">clientConn</span><span class="op" id="7200766">.</span><span class="ident" id="7200767">Write</span><span class="op" id="7200772">(</span><span class="ident" id="7200773">b</span><span class="op" id="7200774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200780">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200797">bb</span>&nbsp;<span class="op" id="7200800">:=</span>&nbsp;<span class="builtinfunc" id="7200803">make</span><span class="op" id="7200807">(</span><span class="op" id="7200808">[</span><span class="op" id="7200809">]</span><span class="builtintype" id="7200810">byte</span><span class="op" id="7200814">,</span>&nbsp;<span class="builtinfunc" id="7200816">len</span><span class="op" id="7200819">(</span><span class="ident" id="7200820">b</span><span class="op" id="7200821">)</span><span class="op" id="7200822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200827">n</span><span class="op" id="7200828">,</span>&nbsp;<span class="ident" id="7200830">err</span>&nbsp;<span class="op" id="7200834">:=</span>&nbsp;<span class="ident" id="7200837">io</span><span class="op" id="7200839">.</span><span class="ident" id="7200840">ReadFull</span><span class="op" id="7200848">(</span><span class="ident" id="7200849">clientConn</span><span class="op" id="7200859">,</span>&nbsp;<span class="ident" id="7200861">bb</span><span class="op" id="7200863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200868">if</span>&nbsp;<span class="ident" id="7200871">test</span><span class="op" id="7200875">.</span><span class="ident" id="7200876">expectAlert</span>&nbsp;<span class="op" id="7200888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200894">if</span>&nbsp;<span class="ident" id="7200897">err</span>&nbsp;<span class="op" id="7200901">==</span>&nbsp;<span class="ident" id="7200904">nil</span>&nbsp;<span class="op" id="7200908">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7200915">t</span><span class="op" id="7200916">.</span><span class="ident" id="7200917">Fatal</span><span class="op" id="7200922">(</span><span class="string" id="7200923">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="7200965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7200976">}</span>&nbsp;<span class="keyword" id="7200978">else</span>&nbsp;<span class="op" id="7200983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7200989">if</span>&nbsp;<span class="ident" id="7200992">err</span>&nbsp;<span class="op" id="7200996">!=</span>&nbsp;<span class="ident" id="7200999">nil</span>&nbsp;<span class="op" id="7201003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201010">t</span><span class="op" id="7201011">.</span><span class="ident" id="7201012">Fatalf</span><span class="op" id="7201018">(</span><span class="string" id="7201019">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="7201072">,</span>&nbsp;<span class="ident" id="7201074">test</span><span class="op" id="7201078">.</span><span class="ident" id="7201079">name</span><span class="op" id="7201083">,</span>&nbsp;<span class="ident" id="7201085">i</span><span class="op" id="7201086">+</span><span class="num" id="7201087">1</span><span class="op" id="7201088">,</span>&nbsp;<span class="ident" id="7201090">err</span><span class="op" id="7201093">,</span>&nbsp;<span class="ident" id="7201095">n</span><span class="op" id="7201096">,</span>&nbsp;<span class="builtinfunc" id="7201098">len</span><span class="op" id="7201101">(</span><span class="ident" id="7201102">bb</span><span class="op" id="7201104">)</span><span class="op" id="7201105">,</span>&nbsp;<span class="ident" id="7201107">bb</span><span class="op" id="7201109">[</span><span class="op" id="7201110">:</span><span class="ident" id="7201111">n</span><span class="op" id="7201112">]</span><span class="op" id="7201113">,</span>&nbsp;<span class="ident" id="7201115">b</span><span class="op" id="7201116">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201128">if</span>&nbsp;<span class="op" id="7201131">!</span><span class="ident" id="7201132">bytes</span><span class="op" id="7201137">.</span><span class="ident" id="7201138">Equal</span><span class="op" id="7201143">(</span><span class="ident" id="7201144">b</span><span class="op" id="7201145">,</span>&nbsp;<span class="ident" id="7201147">bb</span><span class="op" id="7201149">)</span>&nbsp;<span class="op" id="7201151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201158">t</span><span class="op" id="7201159">.</span><span class="ident" id="7201160">Fatalf</span><span class="op" id="7201166">(</span><span class="string" id="7201167">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="7201209">,</span>&nbsp;<span class="ident" id="7201211">test</span><span class="op" id="7201215">.</span><span class="ident" id="7201216">name</span><span class="op" id="7201220">,</span>&nbsp;<span class="ident" id="7201222">i</span><span class="op" id="7201223">+</span><span class="num" id="7201224">1</span><span class="op" id="7201225">,</span>&nbsp;<span class="ident" id="7201227">bb</span><span class="op" id="7201229">,</span>&nbsp;<span class="ident" id="7201231">b</span><span class="op" id="7201232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201243">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201251">clientConn</span><span class="op" id="7201261">.</span><span class="ident" id="7201262">Close</span><span class="op" id="7201267">(</span><span class="op" id="7201268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201275">connState</span>&nbsp;<span class="op" id="7201285">:=</span>&nbsp;<span class="op" id="7201288">&lt;-</span><span class="ident" id="7201290">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201305">peerCerts</span>&nbsp;<span class="op" id="7201315">:=</span>&nbsp;<span class="ident" id="7201318">connState</span><span class="op" id="7201327">.</span><span class="ident" id="7201328">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201346">if</span>&nbsp;<span class="builtinfunc" id="7201349">len</span><span class="op" id="7201352">(</span><span class="ident" id="7201353">peerCerts</span><span class="op" id="7201362">)</span>&nbsp;<span class="op" id="7201364">==</span>&nbsp;<span class="builtinfunc" id="7201367">len</span><span class="op" id="7201370">(</span><span class="ident" id="7201371">test</span><span class="op" id="7201375">.</span><span class="ident" id="7201376">expectedPeerCerts</span><span class="op" id="7201393">)</span>&nbsp;<span class="op" id="7201395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201399">for</span>&nbsp;<span class="ident" id="7201403">i</span><span class="op" id="7201404">,</span>&nbsp;<span class="ident" id="7201406">peerCert</span>&nbsp;<span class="op" id="7201415">:=</span>&nbsp;<span class="keyword" id="7201418">range</span>&nbsp;<span class="ident" id="7201424">peerCerts</span>&nbsp;<span class="op" id="7201434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201439">block</span><span class="op" id="7201444">,</span>&nbsp;<span class="ident" id="7201446">_</span>&nbsp;<span class="op" id="7201448">:=</span>&nbsp;<span class="ident" id="7201451">pem</span><span class="op" id="7201454">.</span><span class="ident" id="7201455">Decode</span><span class="op" id="7201461">(</span><span class="op" id="7201462">[</span><span class="op" id="7201463">]</span><span class="builtintype" id="7201464">byte</span><span class="op" id="7201468">(</span><span class="ident" id="7201469">test</span><span class="op" id="7201473">.</span><span class="ident" id="7201474">expectedPeerCerts</span><span class="op" id="7201491">[</span><span class="ident" id="7201492">i</span><span class="op" id="7201493">]</span><span class="op" id="7201494">)</span><span class="op" id="7201495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201500">if</span>&nbsp;<span class="op" id="7201503">!</span><span class="ident" id="7201504">bytes</span><span class="op" id="7201509">.</span><span class="ident" id="7201510">Equal</span><span class="op" id="7201515">(</span><span class="ident" id="7201516">block</span><span class="op" id="7201521">.</span><span class="ident" id="7201522">Bytes</span><span class="op" id="7201527">,</span>&nbsp;<span class="ident" id="7201529">peerCert</span><span class="op" id="7201537">.</span><span class="ident" id="7201538">Raw</span><span class="op" id="7201541">)</span>&nbsp;<span class="op" id="7201543">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201549">t</span><span class="op" id="7201550">.</span><span class="ident" id="7201551">Fatalf</span><span class="op" id="7201557">(</span><span class="string" id="7201558">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="7201588">,</span>&nbsp;<span class="ident" id="7201590">test</span><span class="op" id="7201594">.</span><span class="ident" id="7201595">name</span><span class="op" id="7201599">,</span>&nbsp;<span class="ident" id="7201601">i</span><span class="op" id="7201602">+</span><span class="num" id="7201603">1</span><span class="op" id="7201604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201616">}</span>&nbsp;<span class="keyword" id="7201618">else</span>&nbsp;<span class="op" id="7201623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201627">t</span><span class="op" id="7201628">.</span><span class="ident" id="7201629">Fatalf</span><span class="op" id="7201635">(</span><span class="string" id="7201636">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="7201695">,</span>&nbsp;<span class="ident" id="7201697">test</span><span class="op" id="7201701">.</span><span class="ident" id="7201702">name</span><span class="op" id="7201706">,</span>&nbsp;<span class="builtinfunc" id="7201708">len</span><span class="op" id="7201711">(</span><span class="ident" id="7201712">test</span><span class="op" id="7201716">.</span><span class="ident" id="7201717">expectedPeerCerts</span><span class="op" id="7201734">)</span><span class="op" id="7201735">,</span>&nbsp;<span class="builtinfunc" id="7201737">len</span><span class="op" id="7201740">(</span><span class="ident" id="7201741">peerCerts</span><span class="op" id="7201750">)</span><span class="op" id="7201751">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201758">if</span>&nbsp;<span class="ident" id="7201761">test</span><span class="op" id="7201765">.</span><span class="ident" id="7201766">validate</span>&nbsp;<span class="op" id="7201775">!=</span>&nbsp;<span class="ident" id="7201778">nil</span>&nbsp;<span class="op" id="7201782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201786">if</span>&nbsp;<span class="ident" id="7201789">err</span>&nbsp;<span class="op" id="7201793">:=</span>&nbsp;<span class="ident" id="7201796">test</span><span class="op" id="7201800">.</span><span class="ident" id="7201801">validate</span><span class="op" id="7201809">(</span><span class="ident" id="7201810">connState</span><span class="op" id="7201819">)</span><span class="op" id="7201820">;</span>&nbsp;<span class="ident" id="7201822">err</span>&nbsp;<span class="op" id="7201826">!=</span>&nbsp;<span class="ident" id="7201829">nil</span>&nbsp;<span class="op" id="7201833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201838">t</span><span class="op" id="7201839">.</span><span class="ident" id="7201840">Fatalf</span><span class="op" id="7201846">(</span><span class="string" id="7201847">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7201885">,</span>&nbsp;<span class="ident" id="7201887">err</span><span class="op" id="7201890">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7201897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7201901">if</span>&nbsp;<span class="ident" id="7201904">write</span>&nbsp;<span class="op" id="7201910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201914">path</span>&nbsp;<span class="op" id="7201919">:=</span>&nbsp;<span class="ident" id="7201922">test</span><span class="op" id="7201926">.</span><span class="ident" id="7201927">dataPath</span><span class="op" id="7201935">(</span><span class="op" id="7201936">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7201940">out</span><span class="op" id="7201943">,</span>&nbsp;<span class="ident" id="7201945">err</span>&nbsp;<span class="op" id="7201949">:=</span>&nbsp;<span class="ident" id="7201952">os</span><span class="op" id="7201954">.</span><span class="ident" id="7201955">OpenFile</span><span class="op" id="7201963">(</span><span class="ident" id="7201964">path</span><span class="op" id="7201968">,</span>&nbsp;<span class="ident" id="7201970">os</span><span class="op" id="7201972">.</span><span class="ident" id="7201973">O_WRONLY</span><span class="op" id="7201981">|</span><span class="ident" id="7201982">os</span><span class="op" id="7201984">.</span><span class="ident" id="7201985">O_CREATE</span><span class="op" id="7201993">|</span><span class="ident" id="7201994">os</span><span class="op" id="7201996">.</span><span class="ident" id="7201997">O_TRUNC</span><span class="op" id="7202004">,</span>&nbsp;<span class="num" id="7202006">0644</span><span class="op" id="7202010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7202014">if</span>&nbsp;<span class="ident" id="7202017">err</span>&nbsp;<span class="op" id="7202021">!=</span>&nbsp;<span class="ident" id="7202024">nil</span>&nbsp;<span class="op" id="7202028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202033">t</span><span class="op" id="7202034">.</span><span class="ident" id="7202035">Fatalf</span><span class="op" id="7202041">(</span><span class="string" id="7202042">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="7202076">,</span>&nbsp;<span class="ident" id="7202078">err</span><span class="op" id="7202081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7202085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7202089">defer</span>&nbsp;<span class="ident" id="7202095">out</span><span class="op" id="7202098">.</span><span class="ident" id="7202099">Close</span><span class="op" id="7202104">(</span><span class="op" id="7202105">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202109">recordingConn</span><span class="op" id="7202122">.</span><span class="ident" id="7202123">Close</span><span class="op" id="7202128">(</span><span class="op" id="7202129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7202133">if</span>&nbsp;<span class="builtinfunc" id="7202136">len</span><span class="op" id="7202139">(</span><span class="ident" id="7202140">recordingConn</span><span class="op" id="7202153">.</span><span class="ident" id="7202154">flows</span><span class="op" id="7202159">)</span>&nbsp;<span class="op" id="7202161">&lt;</span>&nbsp;<span class="num" id="7202163">3</span>&nbsp;<span class="op" id="7202165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202170">childProcess</span><span class="op" id="7202182">.</span><span class="ident" id="7202183">Stdout</span><span class="op" id="7202189">.</span><span class="op" id="7202190">(</span><span class="op" id="7202191">*</span><span class="ident" id="7202192">bytes</span><span class="op" id="7202197">.</span><span class="ident" id="7202198">Buffer</span><span class="op" id="7202204">)</span><span class="op" id="7202205">.</span><span class="ident" id="7202206">WriteTo</span><span class="op" id="7202213">(</span><span class="ident" id="7202214">os</span><span class="op" id="7202216">.</span><span class="ident" id="7202217">Stdout</span><span class="op" id="7202223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7202228">if</span>&nbsp;<span class="builtinfunc" id="7202231">len</span><span class="op" id="7202234">(</span><span class="ident" id="7202235">test</span><span class="op" id="7202239">.</span><span class="ident" id="7202240">expectHandshakeErrorIncluding</span><span class="op" id="7202269">)</span>&nbsp;<span class="op" id="7202271">==</span>&nbsp;<span class="num" id="7202274">0</span>&nbsp;<span class="op" id="7202276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202282">t</span><span class="op" id="7202283">.</span><span class="ident" id="7202284">Fatalf</span><span class="op" id="7202290">(</span><span class="string" id="7202291">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="7202309">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7202314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7202318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202322">recordingConn</span><span class="op" id="7202335">.</span><span class="ident" id="7202336">WriteTo</span><span class="op" id="7202343">(</span><span class="ident" id="7202344">out</span><span class="op" id="7202347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202351">fmt</span><span class="op" id="7202354">.</span><span class="ident" id="7202355">Printf</span><span class="op" id="7202361">(</span><span class="string" id="7202362">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="7202374">,</span>&nbsp;<span class="ident" id="7202376">path</span><span class="op" id="7202380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202384">childProcess</span><span class="op" id="7202396">.</span><span class="ident" id="7202397">Wait</span><span class="op" id="7202401">(</span><span class="op" id="7202402">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7202405">}</span><br>
<span class="lineno"></span><span class="op" id="7202407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7202410">func</span>&nbsp;<span class="ident" id="7202415">runServerTestForVersion</span><span class="op" id="7202438">(</span><span class="ident" id="7202439">t</span>&nbsp;<span class="op" id="7202441">*</span><span class="ident" id="7202442">testing</span><span class="op" id="7202449">.</span><span class="ident" id="7202450">T</span><span class="op" id="7202451">,</span>&nbsp;<span class="ident" id="7202453">template</span>&nbsp;<span class="op" id="7202462">*</span><span class="ident" id="7202463">serverTest</span><span class="op" id="7202473">,</span>&nbsp;<span class="ident" id="7202475">prefix</span><span class="op" id="7202481">,</span>&nbsp;<span class="ident" id="7202483">option</span>&nbsp;<span class="builtintype" id="7202490">string</span><span class="op" id="7202496">)</span>&nbsp;<span class="op" id="7202498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202501">test</span>&nbsp;<span class="op" id="7202506">:=</span>&nbsp;<span class="op" id="7202509">*</span><span class="ident" id="7202510">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202520">test</span><span class="op" id="7202524">.</span><span class="ident" id="7202525">name</span>&nbsp;<span class="op" id="7202530">=</span>&nbsp;<span class="ident" id="7202532">prefix</span>&nbsp;<span class="op" id="7202539">+</span>&nbsp;<span class="ident" id="7202541">test</span><span class="op" id="7202545">.</span><span class="ident" id="7202546">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7202552">if</span>&nbsp;<span class="builtinfunc" id="7202555">len</span><span class="op" id="7202558">(</span><span class="ident" id="7202559">test</span><span class="op" id="7202563">.</span><span class="ident" id="7202564">command</span><span class="op" id="7202571">)</span>&nbsp;<span class="op" id="7202573">==</span>&nbsp;<span class="num" id="7202576">0</span>&nbsp;<span class="op" id="7202578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202582">test</span><span class="op" id="7202586">.</span><span class="ident" id="7202587">command</span>&nbsp;<span class="op" id="7202595">=</span>&nbsp;<span class="ident" id="7202597">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7202619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202622">test</span><span class="op" id="7202626">.</span><span class="ident" id="7202627">command</span>&nbsp;<span class="op" id="7202635">=</span>&nbsp;<span class="builtinfunc" id="7202637">append</span><span class="op" id="7202643">(</span><span class="op" id="7202644">[</span><span class="op" id="7202645">]</span><span class="builtintype" id="7202646">string</span><span class="op" id="7202652">(</span><span class="ident" id="7202653">nil</span><span class="op" id="7202656">)</span><span class="op" id="7202657">,</span>&nbsp;<span class="ident" id="7202659">test</span><span class="op" id="7202663">.</span><span class="ident" id="7202664">command</span><span class="op" id="7202671">...</span><span class="op" id="7202674">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202677">test</span><span class="op" id="7202681">.</span><span class="ident" id="7202682">command</span>&nbsp;<span class="op" id="7202690">=</span>&nbsp;<span class="builtinfunc" id="7202692">append</span><span class="op" id="7202698">(</span><span class="ident" id="7202699">test</span><span class="op" id="7202703">.</span><span class="ident" id="7202704">command</span><span class="op" id="7202711">,</span>&nbsp;<span class="ident" id="7202713">option</span><span class="op" id="7202719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202722">test</span><span class="op" id="7202726">.</span><span class="ident" id="7202727">run</span><span class="op" id="7202730">(</span><span class="ident" id="7202731">t</span><span class="op" id="7202732">,</span>&nbsp;<span class="op" id="7202734">*</span><span class="ident" id="7202735">update</span><span class="op" id="7202741">)</span><br>
<span class="lineno"></span><span class="op" id="7202743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7202746">func</span>&nbsp;<span class="ident" id="7202751">runServerTestSSLv3</span><span class="op" id="7202769">(</span><span class="ident" id="7202770">t</span>&nbsp;<span class="op" id="7202772">*</span><span class="ident" id="7202773">testing</span><span class="op" id="7202780">.</span><span class="ident" id="7202781">T</span><span class="op" id="7202782">,</span>&nbsp;<span class="ident" id="7202784">template</span>&nbsp;<span class="op" id="7202793">*</span><span class="ident" id="7202794">serverTest</span><span class="op" id="7202804">)</span>&nbsp;<span class="op" id="7202806">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202809">runServerTestForVersion</span><span class="op" id="7202832">(</span><span class="ident" id="7202833">t</span><span class="op" id="7202834">,</span>&nbsp;<span class="ident" id="7202836">template</span><span class="op" id="7202844">,</span>&nbsp;<span class="string" id="7202846">&#34;SSLv3-&#34;</span><span class="op" id="7202854">,</span>&nbsp;<span class="string" id="7202856">&#34;-ssl3&#34;</span><span class="op" id="7202863">)</span><br>
<span class="lineno"></span><span class="op" id="7202865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7202868">func</span>&nbsp;<span class="ident" id="7202873">runServerTestTLS10</span><span class="op" id="7202891">(</span><span class="ident" id="7202892">t</span>&nbsp;<span class="op" id="7202894">*</span><span class="ident" id="7202895">testing</span><span class="op" id="7202902">.</span><span class="ident" id="7202903">T</span><span class="op" id="7202904">,</span>&nbsp;<span class="ident" id="7202906">template</span>&nbsp;<span class="op" id="7202915">*</span><span class="ident" id="7202916">serverTest</span><span class="op" id="7202926">)</span>&nbsp;<span class="op" id="7202928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7202931">runServerTestForVersion</span><span class="op" id="7202954">(</span><span class="ident" id="7202955">t</span><span class="op" id="7202956">,</span>&nbsp;<span class="ident" id="7202958">template</span><span class="op" id="7202966">,</span>&nbsp;<span class="string" id="7202968">&#34;TLSv10-&#34;</span><span class="op" id="7202977">,</span>&nbsp;<span class="string" id="7202979">&#34;-tls1&#34;</span><span class="op" id="7202986">)</span><br>
<span class="lineno">470</span><span class="op" id="7202988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7202991">func</span>&nbsp;<span class="ident" id="7202996">runServerTestTLS11</span><span class="op" id="7203014">(</span><span class="ident" id="7203015">t</span>&nbsp;<span class="op" id="7203017">*</span><span class="ident" id="7203018">testing</span><span class="op" id="7203025">.</span><span class="ident" id="7203026">T</span><span class="op" id="7203027">,</span>&nbsp;<span class="ident" id="7203029">template</span>&nbsp;<span class="op" id="7203038">*</span><span class="ident" id="7203039">serverTest</span><span class="op" id="7203049">)</span>&nbsp;<span class="op" id="7203051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203054">runServerTestForVersion</span><span class="op" id="7203077">(</span><span class="ident" id="7203078">t</span><span class="op" id="7203079">,</span>&nbsp;<span class="ident" id="7203081">template</span><span class="op" id="7203089">,</span>&nbsp;<span class="string" id="7203091">&#34;TLSv11-&#34;</span><span class="op" id="7203100">,</span>&nbsp;<span class="string" id="7203102">&#34;-tls1_1&#34;</span><span class="op" id="7203111">)</span><br>
<span class="lineno"></span><span class="op" id="7203113">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7203116">func</span>&nbsp;<span class="ident" id="7203121">runServerTestTLS12</span><span class="op" id="7203139">(</span><span class="ident" id="7203140">t</span>&nbsp;<span class="op" id="7203142">*</span><span class="ident" id="7203143">testing</span><span class="op" id="7203150">.</span><span class="ident" id="7203151">T</span><span class="op" id="7203152">,</span>&nbsp;<span class="ident" id="7203154">template</span>&nbsp;<span class="op" id="7203163">*</span><span class="ident" id="7203164">serverTest</span><span class="op" id="7203174">)</span>&nbsp;<span class="op" id="7203176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203179">runServerTestForVersion</span><span class="op" id="7203202">(</span><span class="ident" id="7203203">t</span><span class="op" id="7203204">,</span>&nbsp;<span class="ident" id="7203206">template</span><span class="op" id="7203214">,</span>&nbsp;<span class="string" id="7203216">&#34;TLSv12-&#34;</span><span class="op" id="7203225">,</span>&nbsp;<span class="string" id="7203227">&#34;-tls1_2&#34;</span><span class="op" id="7203236">)</span><br>
<span class="lineno"></span><span class="op" id="7203238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7203241">func</span>&nbsp;<span class="ident" id="7203246">TestHandshakeServerRSARC4</span><span class="op" id="7203271">(</span><span class="ident" id="7203272">t</span>&nbsp;<span class="op" id="7203274">*</span><span class="ident" id="7203275">testing</span><span class="op" id="7203282">.</span><span class="ident" id="7203283">T</span><span class="op" id="7203284">)</span>&nbsp;<span class="op" id="7203286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203289">test</span>&nbsp;<span class="op" id="7203294">:=</span>&nbsp;<span class="op" id="7203297">&amp;</span><span class="ident" id="7203298">serverTest</span><span class="op" id="7203308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203312">name</span><span class="op" id="7203316">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7203321">&#34;RSA-RC4&#34;</span><span class="op" id="7203330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203334">command</span><span class="op" id="7203341">:</span>&nbsp;<span class="op" id="7203343">[</span><span class="op" id="7203344">]</span><span class="builtintype" id="7203345">string</span><span class="op" id="7203351">{</span><span class="string" id="7203352">&#34;openssl&#34;</span><span class="op" id="7203361">,</span>&nbsp;<span class="string" id="7203363">&#34;s_client&#34;</span><span class="op" id="7203373">,</span>&nbsp;<span class="string" id="7203375">&#34;-no_ticket&#34;</span><span class="op" id="7203387">,</span>&nbsp;<span class="string" id="7203389">&#34;-cipher&#34;</span><span class="op" id="7203398">,</span>&nbsp;<span class="string" id="7203400">&#34;RC4-SHA&#34;</span><span class="op" id="7203409">}</span><span class="op" id="7203410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7203413">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203416">runServerTestSSLv3</span><span class="op" id="7203434">(</span><span class="ident" id="7203435">t</span><span class="op" id="7203436">,</span>&nbsp;<span class="ident" id="7203438">test</span><span class="op" id="7203442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203445">runServerTestTLS10</span><span class="op" id="7203463">(</span><span class="ident" id="7203464">t</span><span class="op" id="7203465">,</span>&nbsp;<span class="ident" id="7203467">test</span><span class="op" id="7203471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203474">runServerTestTLS11</span><span class="op" id="7203492">(</span><span class="ident" id="7203493">t</span><span class="op" id="7203494">,</span>&nbsp;<span class="ident" id="7203496">test</span><span class="op" id="7203500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203503">runServerTestTLS12</span><span class="op" id="7203521">(</span><span class="ident" id="7203522">t</span><span class="op" id="7203523">,</span>&nbsp;<span class="ident" id="7203525">test</span><span class="op" id="7203529">)</span><br>
<span class="lineno"></span><span class="op" id="7203531">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="7203534">func</span>&nbsp;<span class="ident" id="7203539">TestHandshakeServerRSA3DES</span><span class="op" id="7203565">(</span><span class="ident" id="7203566">t</span>&nbsp;<span class="op" id="7203568">*</span><span class="ident" id="7203569">testing</span><span class="op" id="7203576">.</span><span class="ident" id="7203577">T</span><span class="op" id="7203578">)</span>&nbsp;<span class="op" id="7203580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203583">test</span>&nbsp;<span class="op" id="7203588">:=</span>&nbsp;<span class="op" id="7203591">&amp;</span><span class="ident" id="7203592">serverTest</span><span class="op" id="7203602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203606">name</span><span class="op" id="7203610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7203615">&#34;RSA-3DES&#34;</span><span class="op" id="7203625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203629">command</span><span class="op" id="7203636">:</span>&nbsp;<span class="op" id="7203638">[</span><span class="op" id="7203639">]</span><span class="builtintype" id="7203640">string</span><span class="op" id="7203646">{</span><span class="string" id="7203647">&#34;openssl&#34;</span><span class="op" id="7203656">,</span>&nbsp;<span class="string" id="7203658">&#34;s_client&#34;</span><span class="op" id="7203668">,</span>&nbsp;<span class="string" id="7203670">&#34;-no_ticket&#34;</span><span class="op" id="7203682">,</span>&nbsp;<span class="string" id="7203684">&#34;-cipher&#34;</span><span class="op" id="7203693">,</span>&nbsp;<span class="string" id="7203695">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="7203709">}</span><span class="op" id="7203710">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7203713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203716">runServerTestSSLv3</span><span class="op" id="7203734">(</span><span class="ident" id="7203735">t</span><span class="op" id="7203736">,</span>&nbsp;<span class="ident" id="7203738">test</span><span class="op" id="7203742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203745">runServerTestTLS10</span><span class="op" id="7203763">(</span><span class="ident" id="7203764">t</span><span class="op" id="7203765">,</span>&nbsp;<span class="ident" id="7203767">test</span><span class="op" id="7203771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203774">runServerTestTLS12</span><span class="op" id="7203792">(</span><span class="ident" id="7203793">t</span><span class="op" id="7203794">,</span>&nbsp;<span class="ident" id="7203796">test</span><span class="op" id="7203800">)</span><br>
<span class="lineno"></span><span class="op" id="7203802">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7203805">func</span>&nbsp;<span class="ident" id="7203810">TestHandshakeServerRSAAES</span><span class="op" id="7203835">(</span><span class="ident" id="7203836">t</span>&nbsp;<span class="op" id="7203838">*</span><span class="ident" id="7203839">testing</span><span class="op" id="7203846">.</span><span class="ident" id="7203847">T</span><span class="op" id="7203848">)</span>&nbsp;<span class="op" id="7203850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203853">test</span>&nbsp;<span class="op" id="7203858">:=</span>&nbsp;<span class="op" id="7203861">&amp;</span><span class="ident" id="7203862">serverTest</span><span class="op" id="7203872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203876">name</span><span class="op" id="7203880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7203885">&#34;RSA-AES&#34;</span><span class="op" id="7203894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203898">command</span><span class="op" id="7203905">:</span>&nbsp;<span class="op" id="7203907">[</span><span class="op" id="7203908">]</span><span class="builtintype" id="7203909">string</span><span class="op" id="7203915">{</span><span class="string" id="7203916">&#34;openssl&#34;</span><span class="op" id="7203925">,</span>&nbsp;<span class="string" id="7203927">&#34;s_client&#34;</span><span class="op" id="7203937">,</span>&nbsp;<span class="string" id="7203939">&#34;-no_ticket&#34;</span><span class="op" id="7203951">,</span>&nbsp;<span class="string" id="7203953">&#34;-cipher&#34;</span><span class="op" id="7203962">,</span>&nbsp;<span class="string" id="7203964">&#34;AES128-SHA&#34;</span><span class="op" id="7203976">}</span><span class="op" id="7203977">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7203980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7203983">runServerTestSSLv3</span><span class="op" id="7204001">(</span><span class="ident" id="7204002">t</span><span class="op" id="7204003">,</span>&nbsp;<span class="ident" id="7204005">test</span><span class="op" id="7204009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204012">runServerTestTLS10</span><span class="op" id="7204030">(</span><span class="ident" id="7204031">t</span><span class="op" id="7204032">,</span>&nbsp;<span class="ident" id="7204034">test</span><span class="op" id="7204038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204041">runServerTestTLS12</span><span class="op" id="7204059">(</span><span class="ident" id="7204060">t</span><span class="op" id="7204061">,</span>&nbsp;<span class="ident" id="7204063">test</span><span class="op" id="7204067">)</span><br>
<span class="lineno"></span><span class="op" id="7204069">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="7204072">func</span>&nbsp;<span class="ident" id="7204077">TestHandshakeServerAESGCM</span><span class="op" id="7204102">(</span><span class="ident" id="7204103">t</span>&nbsp;<span class="op" id="7204105">*</span><span class="ident" id="7204106">testing</span><span class="op" id="7204113">.</span><span class="ident" id="7204114">T</span><span class="op" id="7204115">)</span>&nbsp;<span class="op" id="7204117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204120">test</span>&nbsp;<span class="op" id="7204125">:=</span>&nbsp;<span class="op" id="7204128">&amp;</span><span class="ident" id="7204129">serverTest</span><span class="op" id="7204139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204143">name</span><span class="op" id="7204147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204152">&#34;RSA-AES-GCM&#34;</span><span class="op" id="7204165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204169">command</span><span class="op" id="7204176">:</span>&nbsp;<span class="op" id="7204178">[</span><span class="op" id="7204179">]</span><span class="builtintype" id="7204180">string</span><span class="op" id="7204186">{</span><span class="string" id="7204187">&#34;openssl&#34;</span><span class="op" id="7204196">,</span>&nbsp;<span class="string" id="7204198">&#34;s_client&#34;</span><span class="op" id="7204208">,</span>&nbsp;<span class="string" id="7204210">&#34;-no_ticket&#34;</span><span class="op" id="7204222">,</span>&nbsp;<span class="string" id="7204224">&#34;-cipher&#34;</span><span class="op" id="7204233">,</span>&nbsp;<span class="string" id="7204235">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="7204264">}</span><span class="op" id="7204265">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7204268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204271">runServerTestTLS12</span><span class="op" id="7204289">(</span><span class="ident" id="7204290">t</span><span class="op" id="7204291">,</span>&nbsp;<span class="ident" id="7204293">test</span><span class="op" id="7204297">)</span><br>
<span class="lineno"></span><span class="op" id="7204299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204302">func</span>&nbsp;<span class="ident" id="7204307">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="7204339">(</span><span class="ident" id="7204340">t</span>&nbsp;<span class="op" id="7204342">*</span><span class="ident" id="7204343">testing</span><span class="op" id="7204350">.</span><span class="ident" id="7204351">T</span><span class="op" id="7204352">)</span>&nbsp;<span class="op" id="7204354">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204357">config</span>&nbsp;<span class="op" id="7204364">:=</span>&nbsp;<span class="op" id="7204367">*</span><span class="ident" id="7204368">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204380">config</span><span class="op" id="7204386">.</span><span class="ident" id="7204387">Certificates</span>&nbsp;<span class="op" id="7204400">=</span>&nbsp;<span class="builtinfunc" id="7204402">make</span><span class="op" id="7204406">(</span><span class="op" id="7204407">[</span><span class="op" id="7204408">]</span><span class="ident" id="7204409">Certificate</span><span class="op" id="7204420">,</span>&nbsp;<span class="num" id="7204422">1</span><span class="op" id="7204423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204426">config</span><span class="op" id="7204432">.</span><span class="ident" id="7204433">Certificates</span><span class="op" id="7204445">[</span><span class="num" id="7204446">0</span><span class="op" id="7204447">]</span><span class="op" id="7204448">.</span><span class="ident" id="7204449">Certificate</span>&nbsp;<span class="op" id="7204461">=</span>&nbsp;<span class="op" id="7204463">[</span><span class="op" id="7204464">]</span><span class="op" id="7204465">[</span><span class="op" id="7204466">]</span><span class="builtintype" id="7204467">byte</span><span class="op" id="7204471">{</span><span class="ident" id="7204472">testECDSACertificate</span><span class="op" id="7204492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204495">config</span><span class="op" id="7204501">.</span><span class="ident" id="7204502">Certificates</span><span class="op" id="7204514">[</span><span class="num" id="7204515">0</span><span class="op" id="7204516">]</span><span class="op" id="7204517">.</span><span class="ident" id="7204518">PrivateKey</span>&nbsp;<span class="op" id="7204529">=</span>&nbsp;<span class="ident" id="7204531">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204552">config</span><span class="op" id="7204558">.</span><span class="ident" id="7204559">BuildNameToCertificate</span><span class="op" id="7204581">(</span><span class="op" id="7204582">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204586">test</span>&nbsp;<span class="op" id="7204591">:=</span>&nbsp;<span class="op" id="7204594">&amp;</span><span class="ident" id="7204595">serverTest</span><span class="op" id="7204605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204609">name</span><span class="op" id="7204613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204618">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="7204635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204639">command</span><span class="op" id="7204646">:</span>&nbsp;<span class="op" id="7204648">[</span><span class="op" id="7204649">]</span><span class="builtintype" id="7204650">string</span><span class="op" id="7204656">{</span><span class="string" id="7204657">&#34;openssl&#34;</span><span class="op" id="7204666">,</span>&nbsp;<span class="string" id="7204668">&#34;s_client&#34;</span><span class="op" id="7204678">,</span>&nbsp;<span class="string" id="7204680">&#34;-no_ticket&#34;</span><span class="op" id="7204692">,</span>&nbsp;<span class="string" id="7204694">&#34;-cipher&#34;</span><span class="op" id="7204703">,</span>&nbsp;<span class="string" id="7204705">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="7204729">}</span><span class="op" id="7204730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204734">config</span><span class="op" id="7204740">:</span>&nbsp;&nbsp;<span class="op" id="7204743">&amp;</span><span class="ident" id="7204744">config</span><span class="op" id="7204750">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7204753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204756">runServerTestTLS10</span><span class="op" id="7204774">(</span><span class="ident" id="7204775">t</span><span class="op" id="7204776">,</span>&nbsp;<span class="ident" id="7204778">test</span><span class="op" id="7204782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204785">runServerTestTLS12</span><span class="op" id="7204803">(</span><span class="ident" id="7204804">t</span><span class="op" id="7204805">,</span>&nbsp;<span class="ident" id="7204807">test</span><span class="op" id="7204811">)</span><br>
<span class="lineno"></span><span class="op" id="7204813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7204816">func</span>&nbsp;<span class="ident" id="7204821">TestHandshakeServerALPN</span><span class="op" id="7204844">(</span><span class="ident" id="7204845">t</span>&nbsp;<span class="op" id="7204847">*</span><span class="ident" id="7204848">testing</span><span class="op" id="7204855">.</span><span class="ident" id="7204856">T</span><span class="op" id="7204857">)</span>&nbsp;<span class="op" id="7204859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204862">config</span>&nbsp;<span class="op" id="7204869">:=</span>&nbsp;<span class="op" id="7204872">*</span><span class="ident" id="7204873">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204885">config</span><span class="op" id="7204891">.</span><span class="ident" id="7204892">NextProtos</span>&nbsp;<span class="op" id="7204903">=</span>&nbsp;<span class="op" id="7204905">[</span><span class="op" id="7204906">]</span><span class="builtintype" id="7204907">string</span><span class="op" id="7204913">{</span><span class="string" id="7204914">&#34;proto1&#34;</span><span class="op" id="7204922">,</span>&nbsp;<span class="string" id="7204924">&#34;proto2&#34;</span><span class="op" id="7204932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204936">test</span>&nbsp;<span class="op" id="7204941">:=</span>&nbsp;<span class="op" id="7204944">&amp;</span><span class="ident" id="7204945">serverTest</span><span class="op" id="7204955">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7204959">name</span><span class="op" id="7204963">:</span>&nbsp;<span class="string" id="7204965">&#34;ALPN&#34;</span><span class="op" id="7204971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7204975">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205041">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205084">command</span><span class="op" id="7205091">:</span>&nbsp;<span class="op" id="7205093">[</span><span class="op" id="7205094">]</span><span class="builtintype" id="7205095">string</span><span class="op" id="7205101">{</span><span class="string" id="7205102">&#34;openssl&#34;</span><span class="op" id="7205111">,</span>&nbsp;<span class="string" id="7205113">&#34;s_client&#34;</span><span class="op" id="7205123">,</span>&nbsp;<span class="string" id="7205125">&#34;-alpn&#34;</span><span class="op" id="7205132">,</span>&nbsp;<span class="string" id="7205134">&#34;proto2,proto1&#34;</span><span class="op" id="7205149">}</span><span class="op" id="7205150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205154">config</span><span class="op" id="7205160">:</span>&nbsp;&nbsp;<span class="op" id="7205163">&amp;</span><span class="ident" id="7205164">config</span><span class="op" id="7205170">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205174">validate</span><span class="op" id="7205182">:</span>&nbsp;<span class="keyword" id="7205184">func</span><span class="op" id="7205188">(</span><span class="ident" id="7205189">state</span>&nbsp;<span class="ident" id="7205195">ConnectionState</span><span class="op" id="7205210">)</span>&nbsp;<span class="builtintype" id="7205212">error</span>&nbsp;<span class="op" id="7205218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205223">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7205282">if</span>&nbsp;<span class="ident" id="7205285">state</span><span class="op" id="7205290">.</span><span class="ident" id="7205291">NegotiatedProtocol</span>&nbsp;<span class="op" id="7205310">!=</span>&nbsp;<span class="string" id="7205313">&#34;proto1&#34;</span>&nbsp;<span class="op" id="7205322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7205328">return</span>&nbsp;<span class="ident" id="7205335">fmt</span><span class="op" id="7205338">.</span><span class="ident" id="7205339">Errorf</span><span class="op" id="7205345">(</span><span class="string" id="7205346">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="7205378">,</span>&nbsp;<span class="ident" id="7205380">state</span><span class="op" id="7205385">.</span><span class="ident" id="7205386">NegotiatedProtocol</span><span class="op" id="7205404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7205409">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7205414">return</span>&nbsp;<span class="ident" id="7205421">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7205427">}</span><span class="op" id="7205428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7205431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205434">runServerTestTLS12</span><span class="op" id="7205452">(</span><span class="ident" id="7205453">t</span><span class="op" id="7205454">,</span>&nbsp;<span class="ident" id="7205456">test</span><span class="op" id="7205460">)</span><br>
<span class="lineno"></span><span class="op" id="7205462">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="7205465">func</span>&nbsp;<span class="ident" id="7205470">TestHandshakeServerALPNNoMatch</span><span class="op" id="7205500">(</span><span class="ident" id="7205501">t</span>&nbsp;<span class="op" id="7205503">*</span><span class="ident" id="7205504">testing</span><span class="op" id="7205511">.</span><span class="ident" id="7205512">T</span><span class="op" id="7205513">)</span>&nbsp;<span class="op" id="7205515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205518">config</span>&nbsp;<span class="op" id="7205525">:=</span>&nbsp;<span class="op" id="7205528">*</span><span class="ident" id="7205529">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205541">config</span><span class="op" id="7205547">.</span><span class="ident" id="7205548">NextProtos</span>&nbsp;<span class="op" id="7205559">=</span>&nbsp;<span class="op" id="7205561">[</span><span class="op" id="7205562">]</span><span class="builtintype" id="7205563">string</span><span class="op" id="7205569">{</span><span class="string" id="7205570">&#34;proto3&#34;</span><span class="op" id="7205578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205582">test</span>&nbsp;<span class="op" id="7205587">:=</span>&nbsp;<span class="op" id="7205590">&amp;</span><span class="ident" id="7205591">serverTest</span><span class="op" id="7205601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205605">name</span><span class="op" id="7205609">:</span>&nbsp;<span class="string" id="7205611">&#34;ALPN-NoMatch&#34;</span><span class="op" id="7205625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205629">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205695">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205738">command</span><span class="op" id="7205745">:</span>&nbsp;<span class="op" id="7205747">[</span><span class="op" id="7205748">]</span><span class="builtintype" id="7205749">string</span><span class="op" id="7205755">{</span><span class="string" id="7205756">&#34;openssl&#34;</span><span class="op" id="7205765">,</span>&nbsp;<span class="string" id="7205767">&#34;s_client&#34;</span><span class="op" id="7205777">,</span>&nbsp;<span class="string" id="7205779">&#34;-alpn&#34;</span><span class="op" id="7205786">,</span>&nbsp;<span class="string" id="7205788">&#34;proto2,proto1&#34;</span><span class="op" id="7205803">}</span><span class="op" id="7205804">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205808">config</span><span class="op" id="7205814">:</span>&nbsp;&nbsp;<span class="op" id="7205817">&amp;</span><span class="ident" id="7205818">config</span><span class="op" id="7205824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7205828">validate</span><span class="op" id="7205836">:</span>&nbsp;<span class="keyword" id="7205838">func</span><span class="op" id="7205842">(</span><span class="ident" id="7205843">state</span>&nbsp;<span class="ident" id="7205849">ConnectionState</span><span class="op" id="7205864">)</span>&nbsp;<span class="builtintype" id="7205866">error</span>&nbsp;<span class="op" id="7205872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205877">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7205936">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7205979">if</span>&nbsp;<span class="ident" id="7205982">state</span><span class="op" id="7205987">.</span><span class="ident" id="7205988">NegotiatedProtocol</span>&nbsp;<span class="op" id="7206007">!=</span>&nbsp;<span class="string" id="7206010">&#34;&#34;</span>&nbsp;<span class="op" id="7206013">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7206019">return</span>&nbsp;<span class="ident" id="7206026">fmt</span><span class="op" id="7206029">.</span><span class="ident" id="7206030">Errorf</span><span class="op" id="7206036">(</span><span class="string" id="7206037">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="7206065">,</span>&nbsp;<span class="ident" id="7206067">state</span><span class="op" id="7206072">.</span><span class="ident" id="7206073">NegotiatedProtocol</span><span class="op" id="7206091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7206101">return</span>&nbsp;<span class="ident" id="7206108">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206114">}</span><span class="op" id="7206115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206118">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206121">runServerTestTLS12</span><span class="op" id="7206139">(</span><span class="ident" id="7206140">t</span><span class="op" id="7206141">,</span>&nbsp;<span class="ident" id="7206143">test</span><span class="op" id="7206147">)</span><br>
<span class="lineno"></span><span class="op" id="7206149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7206152">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7206224">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="7206304">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7206368">func</span>&nbsp;<span class="ident" id="7206373">TestHandshakeServerSNI</span><span class="op" id="7206395">(</span><span class="ident" id="7206396">t</span>&nbsp;<span class="op" id="7206398">*</span><span class="ident" id="7206399">testing</span><span class="op" id="7206406">.</span><span class="ident" id="7206407">T</span><span class="op" id="7206408">)</span>&nbsp;<span class="op" id="7206410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206413">test</span>&nbsp;<span class="op" id="7206418">:=</span>&nbsp;<span class="op" id="7206421">&amp;</span><span class="ident" id="7206422">serverTest</span><span class="op" id="7206432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206436">name</span><span class="op" id="7206440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206445">&#34;SNI&#34;</span><span class="op" id="7206450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206454">command</span><span class="op" id="7206461">:</span>&nbsp;<span class="op" id="7206463">[</span><span class="op" id="7206464">]</span><span class="builtintype" id="7206465">string</span><span class="op" id="7206471">{</span><span class="string" id="7206472">&#34;openssl&#34;</span><span class="op" id="7206481">,</span>&nbsp;<span class="string" id="7206483">&#34;s_client&#34;</span><span class="op" id="7206493">,</span>&nbsp;<span class="string" id="7206495">&#34;-no_ticket&#34;</span><span class="op" id="7206507">,</span>&nbsp;<span class="string" id="7206509">&#34;-cipher&#34;</span><span class="op" id="7206518">,</span>&nbsp;<span class="string" id="7206520">&#34;AES128-SHA&#34;</span><span class="op" id="7206532">,</span>&nbsp;<span class="string" id="7206534">&#34;-servername&#34;</span><span class="op" id="7206547">,</span>&nbsp;<span class="string" id="7206549">&#34;snitest.com&#34;</span><span class="op" id="7206562">}</span><span class="op" id="7206563">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7206566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206569">runServerTestTLS12</span><span class="op" id="7206587">(</span><span class="ident" id="7206588">t</span><span class="op" id="7206589">,</span>&nbsp;<span class="ident" id="7206591">test</span><span class="op" id="7206595">)</span><br>
<span class="lineno"></span><span class="op" id="7206597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7206600">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="7206679">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="7206722">func</span>&nbsp;<span class="ident" id="7206727">TestHandshakeServerSNIGetCertificate</span><span class="op" id="7206763">(</span><span class="ident" id="7206764">t</span>&nbsp;<span class="op" id="7206766">*</span><span class="ident" id="7206767">testing</span><span class="op" id="7206774">.</span><span class="ident" id="7206775">T</span><span class="op" id="7206776">)</span>&nbsp;<span class="op" id="7206778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206781">config</span>&nbsp;<span class="op" id="7206788">:=</span>&nbsp;<span class="op" id="7206791">*</span><span class="ident" id="7206792">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7206805">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206874">nameToCert</span>&nbsp;<span class="op" id="7206885">:=</span>&nbsp;<span class="ident" id="7206888">config</span><span class="op" id="7206894">.</span><span class="ident" id="7206895">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206914">config</span><span class="op" id="7206920">.</span><span class="ident" id="7206921">NameToCertificate</span>&nbsp;<span class="op" id="7206939">=</span>&nbsp;<span class="ident" id="7206941">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7206946">config</span><span class="op" id="7206952">.</span><span class="ident" id="7206953">GetCertificate</span>&nbsp;<span class="op" id="7206968">=</span>&nbsp;<span class="keyword" id="7206970">func</span><span class="op" id="7206974">(</span><span class="ident" id="7206975">clientHello</span>&nbsp;<span class="op" id="7206987">*</span><span class="ident" id="7206988">ClientHelloInfo</span><span class="op" id="7207003">)</span>&nbsp;<span class="op" id="7207005">(</span><span class="op" id="7207006">*</span><span class="ident" id="7207007">Certificate</span><span class="op" id="7207018">,</span>&nbsp;<span class="builtintype" id="7207020">error</span><span class="op" id="7207025">)</span>&nbsp;<span class="op" id="7207027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207031">cert</span><span class="op" id="7207035">,</span>&nbsp;<span class="ident" id="7207037">_</span>&nbsp;<span class="op" id="7207039">:=</span>&nbsp;<span class="ident" id="7207042">nameToCert</span><span class="op" id="7207052">[</span><span class="ident" id="7207053">clientHello</span><span class="op" id="7207064">.</span><span class="ident" id="7207065">ServerName</span><span class="op" id="7207075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7207079">return</span>&nbsp;<span class="ident" id="7207086">cert</span><span class="op" id="7207090">,</span>&nbsp;<span class="ident" id="7207092">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207100">test</span>&nbsp;<span class="op" id="7207105">:=</span>&nbsp;<span class="op" id="7207108">&amp;</span><span class="ident" id="7207109">serverTest</span><span class="op" id="7207119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207123">name</span><span class="op" id="7207127">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207132">&#34;SNI&#34;</span><span class="op" id="7207137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207141">command</span><span class="op" id="7207148">:</span>&nbsp;<span class="op" id="7207150">[</span><span class="op" id="7207151">]</span><span class="builtintype" id="7207152">string</span><span class="op" id="7207158">{</span><span class="string" id="7207159">&#34;openssl&#34;</span><span class="op" id="7207168">,</span>&nbsp;<span class="string" id="7207170">&#34;s_client&#34;</span><span class="op" id="7207180">,</span>&nbsp;<span class="string" id="7207182">&#34;-no_ticket&#34;</span><span class="op" id="7207194">,</span>&nbsp;<span class="string" id="7207196">&#34;-cipher&#34;</span><span class="op" id="7207205">,</span>&nbsp;<span class="string" id="7207207">&#34;AES128-SHA&#34;</span><span class="op" id="7207219">,</span>&nbsp;<span class="string" id="7207221">&#34;-servername&#34;</span><span class="op" id="7207234">,</span>&nbsp;<span class="string" id="7207236">&#34;snitest.com&#34;</span><span class="op" id="7207249">}</span><span class="op" id="7207250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207254">config</span><span class="op" id="7207260">:</span>&nbsp;&nbsp;<span class="op" id="7207263">&amp;</span><span class="ident" id="7207264">config</span><span class="op" id="7207270">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207276">runServerTestTLS12</span><span class="op" id="7207294">(</span><span class="ident" id="7207295">t</span><span class="op" id="7207296">,</span>&nbsp;<span class="ident" id="7207298">test</span><span class="op" id="7207302">)</span><br>
<span class="lineno"></span><span class="op" id="7207304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7207307">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="7207366">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7207441">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7207515">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7207545">func</span>&nbsp;<span class="ident" id="7207550">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="7207594">(</span><span class="ident" id="7207595">t</span>&nbsp;<span class="op" id="7207597">*</span><span class="ident" id="7207598">testing</span><span class="op" id="7207605">.</span><span class="ident" id="7207606">T</span><span class="op" id="7207607">)</span>&nbsp;<span class="op" id="7207609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207612">config</span>&nbsp;<span class="op" id="7207619">:=</span>&nbsp;<span class="op" id="7207622">*</span><span class="ident" id="7207623">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207636">config</span><span class="op" id="7207642">.</span><span class="ident" id="7207643">GetCertificate</span>&nbsp;<span class="op" id="7207658">=</span>&nbsp;<span class="keyword" id="7207660">func</span><span class="op" id="7207664">(</span><span class="ident" id="7207665">clientHello</span>&nbsp;<span class="op" id="7207677">*</span><span class="ident" id="7207678">ClientHelloInfo</span><span class="op" id="7207693">)</span>&nbsp;<span class="op" id="7207695">(</span><span class="op" id="7207696">*</span><span class="ident" id="7207697">Certificate</span><span class="op" id="7207708">,</span>&nbsp;<span class="builtintype" id="7207710">error</span><span class="op" id="7207715">)</span>&nbsp;<span class="op" id="7207717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7207721">return</span>&nbsp;<span class="ident" id="7207728">nil</span><span class="op" id="7207731">,</span>&nbsp;<span class="ident" id="7207733">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207741">test</span>&nbsp;<span class="op" id="7207746">:=</span>&nbsp;<span class="op" id="7207749">&amp;</span><span class="ident" id="7207750">serverTest</span><span class="op" id="7207760">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207764">name</span><span class="op" id="7207768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7207773">&#34;SNI&#34;</span><span class="op" id="7207778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207782">command</span><span class="op" id="7207789">:</span>&nbsp;<span class="op" id="7207791">[</span><span class="op" id="7207792">]</span><span class="builtintype" id="7207793">string</span><span class="op" id="7207799">{</span><span class="string" id="7207800">&#34;openssl&#34;</span><span class="op" id="7207809">,</span>&nbsp;<span class="string" id="7207811">&#34;s_client&#34;</span><span class="op" id="7207821">,</span>&nbsp;<span class="string" id="7207823">&#34;-no_ticket&#34;</span><span class="op" id="7207835">,</span>&nbsp;<span class="string" id="7207837">&#34;-cipher&#34;</span><span class="op" id="7207846">,</span>&nbsp;<span class="string" id="7207848">&#34;AES128-SHA&#34;</span><span class="op" id="7207860">,</span>&nbsp;<span class="string" id="7207862">&#34;-servername&#34;</span><span class="op" id="7207875">,</span>&nbsp;<span class="string" id="7207877">&#34;snitest.com&#34;</span><span class="op" id="7207890">}</span><span class="op" id="7207891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207895">config</span><span class="op" id="7207901">:</span>&nbsp;&nbsp;<span class="op" id="7207904">&amp;</span><span class="ident" id="7207905">config</span><span class="op" id="7207911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7207914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7207917">runServerTestTLS12</span><span class="op" id="7207935">(</span><span class="ident" id="7207936">t</span><span class="op" id="7207937">,</span>&nbsp;<span class="ident" id="7207939">test</span><span class="op" id="7207943">)</span><br>
<span class="lineno">625</span><span class="op" id="7207945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7207948">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7208024">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="7208065">func</span>&nbsp;<span class="ident" id="7208070">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="7208111">(</span><span class="ident" id="7208112">t</span>&nbsp;<span class="op" id="7208114">*</span><span class="ident" id="7208115">testing</span><span class="op" id="7208122">.</span><span class="ident" id="7208123">T</span><span class="op" id="7208124">)</span>&nbsp;<span class="op" id="7208126">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208129">config</span>&nbsp;<span class="op" id="7208136">:=</span>&nbsp;<span class="op" id="7208139">*</span><span class="ident" id="7208140">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208153">config</span><span class="op" id="7208159">.</span><span class="ident" id="7208160">GetCertificate</span>&nbsp;<span class="op" id="7208175">=</span>&nbsp;<span class="keyword" id="7208177">func</span><span class="op" id="7208181">(</span><span class="ident" id="7208182">clientHello</span>&nbsp;<span class="op" id="7208194">*</span><span class="ident" id="7208195">ClientHelloInfo</span><span class="op" id="7208210">)</span>&nbsp;<span class="op" id="7208212">(</span><span class="op" id="7208213">*</span><span class="ident" id="7208214">Certificate</span><span class="op" id="7208225">,</span>&nbsp;<span class="builtintype" id="7208227">error</span><span class="op" id="7208232">)</span>&nbsp;<span class="op" id="7208234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7208238">return</span>&nbsp;<span class="ident" id="7208245">nil</span><span class="op" id="7208248">,</span>&nbsp;<span class="ident" id="7208250">fmt</span><span class="op" id="7208253">.</span><span class="ident" id="7208254">Errorf</span><span class="op" id="7208260">(</span><span class="string" id="7208261">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="7208291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208294">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208297">test</span>&nbsp;<span class="op" id="7208302">:=</span>&nbsp;<span class="op" id="7208305">&amp;</span><span class="ident" id="7208306">serverTest</span><span class="op" id="7208316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208320">name</span><span class="op" id="7208324">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7208333">&#34;SNI&#34;</span><span class="op" id="7208338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208342">command</span><span class="op" id="7208349">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208355">[</span><span class="op" id="7208356">]</span><span class="builtintype" id="7208357">string</span><span class="op" id="7208363">{</span><span class="string" id="7208364">&#34;openssl&#34;</span><span class="op" id="7208373">,</span>&nbsp;<span class="string" id="7208375">&#34;s_client&#34;</span><span class="op" id="7208385">,</span>&nbsp;<span class="string" id="7208387">&#34;-no_ticket&#34;</span><span class="op" id="7208399">,</span>&nbsp;<span class="string" id="7208401">&#34;-cipher&#34;</span><span class="op" id="7208410">,</span>&nbsp;<span class="string" id="7208412">&#34;AES128-SHA&#34;</span><span class="op" id="7208424">,</span>&nbsp;<span class="string" id="7208426">&#34;-servername&#34;</span><span class="op" id="7208439">,</span>&nbsp;<span class="string" id="7208441">&#34;snitest.com&#34;</span><span class="op" id="7208454">}</span><span class="op" id="7208455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208459">config</span><span class="op" id="7208465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208472">&amp;</span><span class="ident" id="7208473">config</span><span class="op" id="7208479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208483">expectAlert</span><span class="op" id="7208494">:</span>&nbsp;<span class="builtintype" id="7208496">true</span><span class="op" id="7208500">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7208503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208506">runServerTestTLS12</span><span class="op" id="7208524">(</span><span class="ident" id="7208525">t</span><span class="op" id="7208526">,</span>&nbsp;<span class="ident" id="7208528">test</span><span class="op" id="7208532">)</span><br>
<span class="lineno"></span><span class="op" id="7208534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7208537">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="7208617">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="7208691">func</span>&nbsp;<span class="ident" id="7208696">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="7208730">(</span><span class="ident" id="7208731">t</span>&nbsp;<span class="op" id="7208733">*</span><span class="ident" id="7208734">testing</span><span class="op" id="7208741">.</span><span class="ident" id="7208742">T</span><span class="op" id="7208743">)</span>&nbsp;<span class="op" id="7208745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208748">config</span>&nbsp;<span class="op" id="7208755">:=</span>&nbsp;<span class="op" id="7208758">*</span><span class="ident" id="7208759">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208771">config</span><span class="op" id="7208777">.</span><span class="ident" id="7208778">CipherSuites</span>&nbsp;<span class="op" id="7208791">=</span>&nbsp;<span class="op" id="7208793">[</span><span class="op" id="7208794">]</span><span class="builtintype" id="7208795">uint16</span><span class="op" id="7208801">{</span><span class="ident" id="7208802">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7208838">,</span>&nbsp;<span class="ident" id="7208840">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7208874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208877">config</span><span class="op" id="7208883">.</span><span class="ident" id="7208884">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7208909">=</span>&nbsp;<span class="builtintype" id="7208911">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208918">test</span>&nbsp;<span class="op" id="7208923">:=</span>&nbsp;<span class="op" id="7208926">&amp;</span><span class="ident" id="7208927">serverTest</span><span class="op" id="7208937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208941">name</span><span class="op" id="7208945">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7208949">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="7208979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7208983">config</span><span class="op" id="7208989">:</span>&nbsp;<span class="op" id="7208991">&amp;</span><span class="ident" id="7208992">config</span><span class="op" id="7208998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209001">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209004">runServerTestTLS12</span><span class="op" id="7209022">(</span><span class="ident" id="7209023">t</span><span class="op" id="7209024">,</span>&nbsp;<span class="ident" id="7209026">test</span><span class="op" id="7209030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209034">config</span>&nbsp;<span class="op" id="7209041">=</span>&nbsp;<span class="op" id="7209043">*</span><span class="ident" id="7209044">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209056">config</span><span class="op" id="7209062">.</span><span class="ident" id="7209063">CipherSuites</span>&nbsp;<span class="op" id="7209076">=</span>&nbsp;<span class="op" id="7209078">[</span><span class="op" id="7209079">]</span><span class="builtintype" id="7209080">uint16</span><span class="op" id="7209086">{</span><span class="ident" id="7209087">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7209121">,</span>&nbsp;<span class="ident" id="7209123">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="7209159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209162">config</span><span class="op" id="7209168">.</span><span class="ident" id="7209169">Certificates</span>&nbsp;<span class="op" id="7209182">=</span>&nbsp;<span class="op" id="7209184">[</span><span class="op" id="7209185">]</span><span class="ident" id="7209186">Certificate</span><span class="op" id="7209197">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209206">Certificate</span><span class="op" id="7209217">:</span>&nbsp;<span class="op" id="7209219">[</span><span class="op" id="7209220">]</span><span class="op" id="7209221">[</span><span class="op" id="7209222">]</span><span class="builtintype" id="7209223">byte</span><span class="op" id="7209227">{</span><span class="ident" id="7209228">testECDSACertificate</span><span class="op" id="7209248">}</span><span class="op" id="7209249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209254">PrivateKey</span><span class="op" id="7209264">:</span>&nbsp;&nbsp;<span class="ident" id="7209267">testECDSAPrivateKey</span><span class="op" id="7209286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209290">}</span><span class="op" id="7209291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209294">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209297">config</span><span class="op" id="7209303">.</span><span class="ident" id="7209304">BuildNameToCertificate</span><span class="op" id="7209326">(</span><span class="op" id="7209327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209330">config</span><span class="op" id="7209336">.</span><span class="ident" id="7209337">PreferServerCipherSuites</span>&nbsp;<span class="op" id="7209362">=</span>&nbsp;<span class="builtintype" id="7209364">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209371">test</span>&nbsp;<span class="op" id="7209376">=</span>&nbsp;<span class="op" id="7209378">&amp;</span><span class="ident" id="7209379">serverTest</span><span class="op" id="7209389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209393">name</span><span class="op" id="7209397">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7209401">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="7209433">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209437">config</span><span class="op" id="7209443">:</span>&nbsp;<span class="op" id="7209445">&amp;</span><span class="ident" id="7209446">config</span><span class="op" id="7209452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209458">runServerTestTLS12</span><span class="op" id="7209476">(</span><span class="ident" id="7209477">t</span><span class="op" id="7209478">,</span>&nbsp;<span class="ident" id="7209480">test</span><span class="op" id="7209484">)</span><br>
<span class="lineno"></span><span class="op" id="7209486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="7209489">func</span>&nbsp;<span class="ident" id="7209494">TestResumption</span><span class="op" id="7209508">(</span><span class="ident" id="7209509">t</span>&nbsp;<span class="op" id="7209511">*</span><span class="ident" id="7209512">testing</span><span class="op" id="7209519">.</span><span class="ident" id="7209520">T</span><span class="op" id="7209521">)</span>&nbsp;<span class="op" id="7209523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209526">sessionFilePath</span>&nbsp;<span class="op" id="7209542">:=</span>&nbsp;<span class="ident" id="7209545">tempFile</span><span class="op" id="7209553">(</span><span class="string" id="7209554">&#34;&#34;</span><span class="op" id="7209556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7209559">defer</span>&nbsp;<span class="ident" id="7209565">os</span><span class="op" id="7209567">.</span><span class="ident" id="7209568">Remove</span><span class="op" id="7209574">(</span><span class="ident" id="7209575">sessionFilePath</span><span class="op" id="7209590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209594">test</span>&nbsp;<span class="op" id="7209599">:=</span>&nbsp;<span class="op" id="7209602">&amp;</span><span class="ident" id="7209603">serverTest</span><span class="op" id="7209613">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209617">name</span><span class="op" id="7209621">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7209626">&#34;IssueTicket&#34;</span><span class="op" id="7209639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209643">command</span><span class="op" id="7209650">:</span>&nbsp;<span class="op" id="7209652">[</span><span class="op" id="7209653">]</span><span class="builtintype" id="7209654">string</span><span class="op" id="7209660">{</span><span class="string" id="7209661">&#34;openssl&#34;</span><span class="op" id="7209670">,</span>&nbsp;<span class="string" id="7209672">&#34;s_client&#34;</span><span class="op" id="7209682">,</span>&nbsp;<span class="string" id="7209684">&#34;-cipher&#34;</span><span class="op" id="7209693">,</span>&nbsp;<span class="string" id="7209695">&#34;RC4-SHA&#34;</span><span class="op" id="7209704">,</span>&nbsp;<span class="string" id="7209706">&#34;-sess_out&#34;</span><span class="op" id="7209717">,</span>&nbsp;<span class="ident" id="7209719">sessionFilePath</span><span class="op" id="7209734">}</span><span class="op" id="7209735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209741">runServerTestTLS12</span><span class="op" id="7209759">(</span><span class="ident" id="7209760">t</span><span class="op" id="7209761">,</span>&nbsp;<span class="ident" id="7209763">test</span><span class="op" id="7209767">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209771">test</span>&nbsp;<span class="op" id="7209776">=</span>&nbsp;<span class="op" id="7209778">&amp;</span><span class="ident" id="7209779">serverTest</span><span class="op" id="7209789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209793">name</span><span class="op" id="7209797">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7209802">&#34;Resume&#34;</span><span class="op" id="7209810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209814">command</span><span class="op" id="7209821">:</span>&nbsp;<span class="op" id="7209823">[</span><span class="op" id="7209824">]</span><span class="builtintype" id="7209825">string</span><span class="op" id="7209831">{</span><span class="string" id="7209832">&#34;openssl&#34;</span><span class="op" id="7209841">,</span>&nbsp;<span class="string" id="7209843">&#34;s_client&#34;</span><span class="op" id="7209853">,</span>&nbsp;<span class="string" id="7209855">&#34;-cipher&#34;</span><span class="op" id="7209864">,</span>&nbsp;<span class="string" id="7209866">&#34;RC4-SHA&#34;</span><span class="op" id="7209875">,</span>&nbsp;<span class="string" id="7209877">&#34;-sess_in&#34;</span><span class="op" id="7209887">,</span>&nbsp;<span class="ident" id="7209889">sessionFilePath</span><span class="op" id="7209904">}</span><span class="op" id="7209905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7209908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209911">runServerTestTLS12</span><span class="op" id="7209929">(</span><span class="ident" id="7209930">t</span><span class="op" id="7209931">,</span>&nbsp;<span class="ident" id="7209933">test</span><span class="op" id="7209937">)</span><br>
<span class="lineno">690</span><span class="op" id="7209939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7209942">func</span>&nbsp;<span class="ident" id="7209947">TestResumptionDisabled</span><span class="op" id="7209969">(</span><span class="ident" id="7209970">t</span>&nbsp;<span class="op" id="7209972">*</span><span class="ident" id="7209973">testing</span><span class="op" id="7209980">.</span><span class="ident" id="7209981">T</span><span class="op" id="7209982">)</span>&nbsp;<span class="op" id="7209984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7209987">sessionFilePath</span>&nbsp;<span class="op" id="7210003">:=</span>&nbsp;<span class="ident" id="7210006">tempFile</span><span class="op" id="7210014">(</span><span class="string" id="7210015">&#34;&#34;</span><span class="op" id="7210017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7210020">defer</span>&nbsp;<span class="ident" id="7210026">os</span><span class="op" id="7210028">.</span><span class="ident" id="7210029">Remove</span><span class="op" id="7210035">(</span><span class="ident" id="7210036">sessionFilePath</span><span class="op" id="7210051">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210055">config</span>&nbsp;<span class="op" id="7210062">:=</span>&nbsp;<span class="op" id="7210065">*</span><span class="ident" id="7210066">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210079">test</span>&nbsp;<span class="op" id="7210084">:=</span>&nbsp;<span class="op" id="7210087">&amp;</span><span class="ident" id="7210088">serverTest</span><span class="op" id="7210098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210102">name</span><span class="op" id="7210106">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7210111">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="7210134">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210138">command</span><span class="op" id="7210145">:</span>&nbsp;<span class="op" id="7210147">[</span><span class="op" id="7210148">]</span><span class="builtintype" id="7210149">string</span><span class="op" id="7210155">{</span><span class="string" id="7210156">&#34;openssl&#34;</span><span class="op" id="7210165">,</span>&nbsp;<span class="string" id="7210167">&#34;s_client&#34;</span><span class="op" id="7210177">,</span>&nbsp;<span class="string" id="7210179">&#34;-cipher&#34;</span><span class="op" id="7210188">,</span>&nbsp;<span class="string" id="7210190">&#34;RC4-SHA&#34;</span><span class="op" id="7210199">,</span>&nbsp;<span class="string" id="7210201">&#34;-sess_out&#34;</span><span class="op" id="7210212">,</span>&nbsp;<span class="ident" id="7210214">sessionFilePath</span><span class="op" id="7210229">}</span><span class="op" id="7210230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210234">config</span><span class="op" id="7210240">:</span>&nbsp;&nbsp;<span class="op" id="7210243">&amp;</span><span class="ident" id="7210244">config</span><span class="op" id="7210250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210256">runServerTestTLS12</span><span class="op" id="7210274">(</span><span class="ident" id="7210275">t</span><span class="op" id="7210276">,</span>&nbsp;<span class="ident" id="7210278">test</span><span class="op" id="7210282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210286">config</span><span class="op" id="7210292">.</span><span class="ident" id="7210293">SessionTicketsDisabled</span>&nbsp;<span class="op" id="7210316">=</span>&nbsp;<span class="builtintype" id="7210318">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210325">test</span>&nbsp;<span class="op" id="7210330">=</span>&nbsp;<span class="op" id="7210332">&amp;</span><span class="ident" id="7210333">serverTest</span><span class="op" id="7210343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210347">name</span><span class="op" id="7210351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7210356">&#34;ResumeDisabled&#34;</span><span class="op" id="7210372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210376">command</span><span class="op" id="7210383">:</span>&nbsp;<span class="op" id="7210385">[</span><span class="op" id="7210386">]</span><span class="builtintype" id="7210387">string</span><span class="op" id="7210393">{</span><span class="string" id="7210394">&#34;openssl&#34;</span><span class="op" id="7210403">,</span>&nbsp;<span class="string" id="7210405">&#34;s_client&#34;</span><span class="op" id="7210415">,</span>&nbsp;<span class="string" id="7210417">&#34;-cipher&#34;</span><span class="op" id="7210426">,</span>&nbsp;<span class="string" id="7210428">&#34;RC4-SHA&#34;</span><span class="op" id="7210437">,</span>&nbsp;<span class="string" id="7210439">&#34;-sess_in&#34;</span><span class="op" id="7210449">,</span>&nbsp;<span class="ident" id="7210451">sessionFilePath</span><span class="op" id="7210466">}</span><span class="op" id="7210467">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210471">config</span><span class="op" id="7210477">:</span>&nbsp;&nbsp;<span class="op" id="7210480">&amp;</span><span class="ident" id="7210481">config</span><span class="op" id="7210487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210493">runServerTestTLS12</span><span class="op" id="7210511">(</span><span class="ident" id="7210512">t</span><span class="op" id="7210513">,</span>&nbsp;<span class="ident" id="7210515">test</span><span class="op" id="7210519">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7210523">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7210595">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="7210663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7210666">func</span>&nbsp;<span class="ident" id="7210671">TestFallbackSCSV</span><span class="op" id="7210687">(</span><span class="ident" id="7210688">t</span>&nbsp;<span class="op" id="7210690">*</span><span class="ident" id="7210691">testing</span><span class="op" id="7210698">.</span><span class="ident" id="7210699">T</span><span class="op" id="7210700">)</span>&nbsp;<span class="op" id="7210702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210705">test</span>&nbsp;<span class="op" id="7210710">:=</span>&nbsp;<span class="op" id="7210713">&amp;</span><span class="ident" id="7210714">serverTest</span><span class="op" id="7210724">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210728">name</span><span class="op" id="7210732">:</span>&nbsp;<span class="string" id="7210734">&#34;FallbackSCSV&#34;</span><span class="op" id="7210748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7210752">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210813">command</span><span class="op" id="7210820">:</span>&nbsp;<span class="op" id="7210822">[</span><span class="op" id="7210823">]</span><span class="builtintype" id="7210824">string</span><span class="op" id="7210830">{</span><span class="string" id="7210831">&#34;openssl&#34;</span><span class="op" id="7210840">,</span>&nbsp;<span class="string" id="7210842">&#34;s_client&#34;</span><span class="op" id="7210852">,</span>&nbsp;<span class="string" id="7210854">&#34;-fallback_scsv&#34;</span><span class="op" id="7210870">}</span><span class="op" id="7210871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210875">expectHandshakeErrorIncluding</span><span class="op" id="7210904">:</span>&nbsp;<span class="string" id="7210906">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="7210938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7210941">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7210944">runServerTestTLS11</span><span class="op" id="7210962">(</span><span class="ident" id="7210963">t</span><span class="op" id="7210964">,</span>&nbsp;<span class="ident" id="7210966">test</span><span class="op" id="7210970">)</span><br>
<span class="lineno"></span><span class="op" id="7210972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7210975">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="7211036">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="7211098">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211134">const</span>&nbsp;<span class="ident" id="7211140">clientCertificatePEM</span>&nbsp;<span class="op" id="7211161">=</span>&nbsp;<span class="string" id="7211163">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211896">const</span>&nbsp;<span class="ident" id="7211902">clientKeyPEM</span>&nbsp;<span class="op" id="7211915">=</span>&nbsp;<span class="string" id="7211917">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7212804">const</span>&nbsp;<span class="ident" id="7212810">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="7212836">=</span>&nbsp;<span class="string" id="7212838">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7213591">const</span>&nbsp;<span class="ident" id="7213597">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="7213615">=</span>&nbsp;<span class="string" id="7213617">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="7214057">func</span>&nbsp;<span class="ident" id="7214062">TestClientAuth</span><span class="op" id="7214076">(</span><span class="ident" id="7214077">t</span>&nbsp;<span class="op" id="7214079">*</span><span class="ident" id="7214080">testing</span><span class="op" id="7214087">.</span><span class="ident" id="7214088">T</span><span class="op" id="7214089">)</span>&nbsp;<span class="op" id="7214091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214094">var</span>&nbsp;<span class="ident" id="7214098">certPath</span><span class="op" id="7214106">,</span>&nbsp;<span class="ident" id="7214108">keyPath</span><span class="op" id="7214115">,</span>&nbsp;<span class="ident" id="7214117">ecdsaCertPath</span><span class="op" id="7214130">,</span>&nbsp;<span class="ident" id="7214132">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="7214145">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214154">if</span>&nbsp;<span class="op" id="7214157">*</span><span class="ident" id="7214158">update</span>&nbsp;<span class="op" id="7214165">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214169">certPath</span>&nbsp;<span class="op" id="7214178">=</span>&nbsp;<span class="ident" id="7214180">tempFile</span><span class="op" id="7214188">(</span><span class="ident" id="7214189">clientCertificatePEM</span><span class="op" id="7214209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214213">defer</span>&nbsp;<span class="ident" id="7214219">os</span><span class="op" id="7214221">.</span><span class="ident" id="7214222">Remove</span><span class="op" id="7214228">(</span><span class="ident" id="7214229">certPath</span><span class="op" id="7214237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214241">keyPath</span>&nbsp;<span class="op" id="7214249">=</span>&nbsp;<span class="ident" id="7214251">tempFile</span><span class="op" id="7214259">(</span><span class="ident" id="7214260">clientKeyPEM</span><span class="op" id="7214272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214276">defer</span>&nbsp;<span class="ident" id="7214282">os</span><span class="op" id="7214284">.</span><span class="ident" id="7214285">Remove</span><span class="op" id="7214291">(</span><span class="ident" id="7214292">keyPath</span><span class="op" id="7214299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214303">ecdsaCertPath</span>&nbsp;<span class="op" id="7214317">=</span>&nbsp;<span class="ident" id="7214319">tempFile</span><span class="op" id="7214327">(</span><span class="ident" id="7214328">clientECDSACertificatePEM</span><span class="op" id="7214353">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214357">defer</span>&nbsp;<span class="ident" id="7214363">os</span><span class="op" id="7214365">.</span><span class="ident" id="7214366">Remove</span><span class="op" id="7214372">(</span><span class="ident" id="7214373">ecdsaCertPath</span><span class="op" id="7214386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214390">ecdsaKeyPath</span>&nbsp;<span class="op" id="7214403">=</span>&nbsp;<span class="ident" id="7214405">tempFile</span><span class="op" id="7214413">(</span><span class="ident" id="7214414">clientECDSAKeyPEM</span><span class="op" id="7214431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7214435">defer</span>&nbsp;<span class="ident" id="7214441">os</span><span class="op" id="7214443">.</span><span class="ident" id="7214444">Remove</span><span class="op" id="7214450">(</span><span class="ident" id="7214451">ecdsaKeyPath</span><span class="op" id="7214463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214470">config</span>&nbsp;<span class="op" id="7214477">:=</span>&nbsp;<span class="op" id="7214480">*</span><span class="ident" id="7214481">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214493">config</span><span class="op" id="7214499">.</span><span class="ident" id="7214500">ClientAuth</span>&nbsp;<span class="op" id="7214511">=</span>&nbsp;<span class="ident" id="7214513">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214533">test</span>&nbsp;<span class="op" id="7214538">:=</span>&nbsp;<span class="op" id="7214541">&amp;</span><span class="ident" id="7214542">serverTest</span><span class="op" id="7214552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214556">name</span><span class="op" id="7214560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7214565">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="7214594">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214598">command</span><span class="op" id="7214605">:</span>&nbsp;<span class="op" id="7214607">[</span><span class="op" id="7214608">]</span><span class="builtintype" id="7214609">string</span><span class="op" id="7214615">{</span><span class="string" id="7214616">&#34;openssl&#34;</span><span class="op" id="7214625">,</span>&nbsp;<span class="string" id="7214627">&#34;s_client&#34;</span><span class="op" id="7214637">,</span>&nbsp;<span class="string" id="7214639">&#34;-no_ticket&#34;</span><span class="op" id="7214651">,</span>&nbsp;<span class="string" id="7214653">&#34;-cipher&#34;</span><span class="op" id="7214662">,</span>&nbsp;<span class="string" id="7214664">&#34;RC4-SHA&#34;</span><span class="op" id="7214673">}</span><span class="op" id="7214674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214678">config</span><span class="op" id="7214684">:</span>&nbsp;&nbsp;<span class="op" id="7214687">&amp;</span><span class="ident" id="7214688">config</span><span class="op" id="7214694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7214697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214700">runServerTestTLS12</span><span class="op" id="7214718">(</span><span class="ident" id="7214719">t</span><span class="op" id="7214720">,</span>&nbsp;<span class="ident" id="7214722">test</span><span class="op" id="7214726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214730">test</span>&nbsp;<span class="op" id="7214735">=</span>&nbsp;<span class="op" id="7214737">&amp;</span><span class="ident" id="7214738">serverTest</span><span class="op" id="7214748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214752">name</span><span class="op" id="7214756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7214771">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="7214800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214804">command</span><span class="op" id="7214811">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7214823">[</span><span class="op" id="7214824">]</span><span class="builtintype" id="7214825">string</span><span class="op" id="7214831">{</span><span class="string" id="7214832">&#34;openssl&#34;</span><span class="op" id="7214841">,</span>&nbsp;<span class="string" id="7214843">&#34;s_client&#34;</span><span class="op" id="7214853">,</span>&nbsp;<span class="string" id="7214855">&#34;-no_ticket&#34;</span><span class="op" id="7214867">,</span>&nbsp;<span class="string" id="7214869">&#34;-cipher&#34;</span><span class="op" id="7214878">,</span>&nbsp;<span class="string" id="7214880">&#34;RC4-SHA&#34;</span><span class="op" id="7214889">,</span>&nbsp;<span class="string" id="7214891">&#34;-cert&#34;</span><span class="op" id="7214898">,</span>&nbsp;<span class="ident" id="7214900">certPath</span><span class="op" id="7214908">,</span>&nbsp;<span class="string" id="7214910">&#34;-key&#34;</span><span class="op" id="7214916">,</span>&nbsp;<span class="ident" id="7214918">keyPath</span><span class="op" id="7214925">}</span><span class="op" id="7214926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214930">config</span><span class="op" id="7214936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7214949">&amp;</span><span class="ident" id="7214950">config</span><span class="op" id="7214956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7214960">expectedPeerCerts</span><span class="op" id="7214977">:</span>&nbsp;<span class="op" id="7214979">[</span><span class="op" id="7214980">]</span><span class="builtintype" id="7214981">string</span><span class="op" id="7214987">{</span><span class="ident" id="7214988">clientCertificatePEM</span><span class="op" id="7215008">}</span><span class="op" id="7215009">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215015">runServerTestTLS12</span><span class="op" id="7215033">(</span><span class="ident" id="7215034">t</span><span class="op" id="7215035">,</span>&nbsp;<span class="ident" id="7215037">test</span><span class="op" id="7215041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215045">test</span>&nbsp;<span class="op" id="7215050">=</span>&nbsp;<span class="op" id="7215052">&amp;</span><span class="ident" id="7215053">serverTest</span><span class="op" id="7215063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215067">name</span><span class="op" id="7215071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7215086">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="7215120">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215124">command</span><span class="op" id="7215131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7215143">[</span><span class="op" id="7215144">]</span><span class="builtintype" id="7215145">string</span><span class="op" id="7215151">{</span><span class="string" id="7215152">&#34;openssl&#34;</span><span class="op" id="7215161">,</span>&nbsp;<span class="string" id="7215163">&#34;s_client&#34;</span><span class="op" id="7215173">,</span>&nbsp;<span class="string" id="7215175">&#34;-no_ticket&#34;</span><span class="op" id="7215187">,</span>&nbsp;<span class="string" id="7215189">&#34;-cipher&#34;</span><span class="op" id="7215198">,</span>&nbsp;<span class="string" id="7215200">&#34;RC4-SHA&#34;</span><span class="op" id="7215209">,</span>&nbsp;<span class="string" id="7215211">&#34;-cert&#34;</span><span class="op" id="7215218">,</span>&nbsp;<span class="ident" id="7215220">ecdsaCertPath</span><span class="op" id="7215233">,</span>&nbsp;<span class="string" id="7215235">&#34;-key&#34;</span><span class="op" id="7215241">,</span>&nbsp;<span class="ident" id="7215243">ecdsaKeyPath</span><span class="op" id="7215255">}</span><span class="op" id="7215256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215260">config</span><span class="op" id="7215266">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7215279">&amp;</span><span class="ident" id="7215280">config</span><span class="op" id="7215286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215290">expectedPeerCerts</span><span class="op" id="7215307">:</span>&nbsp;<span class="op" id="7215309">[</span><span class="op" id="7215310">]</span><span class="builtintype" id="7215311">string</span><span class="op" id="7215317">{</span><span class="ident" id="7215318">clientECDSACertificatePEM</span><span class="op" id="7215343">}</span><span class="op" id="7215344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7215347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215350">runServerTestTLS12</span><span class="op" id="7215368">(</span><span class="ident" id="7215369">t</span><span class="op" id="7215370">,</span>&nbsp;<span class="ident" id="7215372">test</span><span class="op" id="7215376">)</span><br>
<span class="lineno">830</span><span class="op" id="7215378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7215381">func</span>&nbsp;<span class="ident" id="7215386">bigFromString</span><span class="op" id="7215399">(</span><span class="ident" id="7215400">s</span>&nbsp;<span class="builtintype" id="7215402">string</span><span class="op" id="7215408">)</span>&nbsp;<span class="op" id="7215410">*</span><span class="ident" id="7215411">big</span><span class="op" id="7215414">.</span><span class="ident" id="7215415">Int</span>&nbsp;<span class="op" id="7215419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215422">ret</span>&nbsp;<span class="op" id="7215426">:=</span>&nbsp;<span class="builtinfunc" id="7215429">new</span><span class="op" id="7215432">(</span><span class="ident" id="7215433">big</span><span class="op" id="7215436">.</span><span class="ident" id="7215437">Int</span><span class="op" id="7215440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215443">ret</span><span class="op" id="7215446">.</span><span class="ident" id="7215447">SetString</span><span class="op" id="7215456">(</span><span class="ident" id="7215457">s</span><span class="op" id="7215458">,</span>&nbsp;<span class="num" id="7215460">10</span><span class="op" id="7215462">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215465">return</span>&nbsp;<span class="ident" id="7215472">ret</span><br>
<span class="lineno"></span><span class="op" id="7215476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7215479">func</span>&nbsp;<span class="ident" id="7215484">fromHex</span><span class="op" id="7215491">(</span><span class="ident" id="7215492">s</span>&nbsp;<span class="builtintype" id="7215494">string</span><span class="op" id="7215500">)</span>&nbsp;<span class="op" id="7215502">[</span><span class="op" id="7215503">]</span><span class="builtintype" id="7215504">byte</span>&nbsp;<span class="op" id="7215509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7215512">b</span><span class="op" id="7215513">,</span>&nbsp;<span class="ident" id="7215515">_</span>&nbsp;<span class="op" id="7215517">:=</span>&nbsp;<span class="ident" id="7215520">hex</span><span class="op" id="7215523">.</span><span class="ident" id="7215524">DecodeString</span><span class="op" id="7215536">(</span><span class="ident" id="7215537">s</span><span class="op" id="7215538">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7215541">return</span>&nbsp;<span class="ident" id="7215548">b</span><br>
<span class="lineno"></span><span class="op" id="7215550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7215553">var</span>&nbsp;<span class="ident" id="7215557">testRSACertificate</span>&nbsp;<span class="op" id="7215576">=</span>&nbsp;<span class="ident" id="7215578">fromHex</span><span class="op" id="7215585">(</span><span class="string" id="7215586">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="7216972">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="7216975">var</span>&nbsp;<span class="ident" id="7216979">testECDSACertificate</span>&nbsp;<span class="op" id="7217000">=</span>&nbsp;<span class="ident" id="7217002">fromHex</span><span class="op" id="7217009">(</span><span class="string" id="7217010">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="7218044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7218047">var</span>&nbsp;<span class="ident" id="7218051">testSNICertificate</span>&nbsp;<span class="op" id="7218070">=</span>&nbsp;<span class="ident" id="7218072">fromHex</span><span class="op" id="7218079">(</span><span class="string" id="7218080">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="7219086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7219089">var</span>&nbsp;<span class="ident" id="7219093">testRSAPrivateKey</span>&nbsp;<span class="op" id="7219111">=</span>&nbsp;<span class="op" id="7219113">&amp;</span><span class="ident" id="7219114">rsa</span><span class="op" id="7219117">.</span><span class="ident" id="7219118">PrivateKey</span><span class="op" id="7219128">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219131">PublicKey</span><span class="op" id="7219140">:</span>&nbsp;<span class="ident" id="7219142">rsa</span><span class="op" id="7219145">.</span><span class="ident" id="7219146">PublicKey</span><span class="op" id="7219155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219159">N</span><span class="op" id="7219160">:</span>&nbsp;<span class="ident" id="7219162">bigFromString</span><span class="op" id="7219175">(</span><span class="string" id="7219176">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="7219487">)</span><span class="op" id="7219488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219492">E</span><span class="op" id="7219493">:</span>&nbsp;<span class="num" id="7219495">65537</span><span class="op" id="7219500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7219503">}</span><span class="op" id="7219504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219507">D</span><span class="op" id="7219508">:</span>&nbsp;<span class="ident" id="7219510">bigFromString</span><span class="op" id="7219523">(</span><span class="string" id="7219524">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="7219834">)</span><span class="op" id="7219835">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219838">Primes</span><span class="op" id="7219844">:</span>&nbsp;<span class="op" id="7219846">[</span><span class="op" id="7219847">]</span><span class="op" id="7219848">*</span><span class="ident" id="7219849">big</span><span class="op" id="7219852">.</span><span class="ident" id="7219853">Int</span><span class="op" id="7219856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7219860">bigFromString</span><span class="op" id="7219873">(</span><span class="string" id="7219874">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="7220031">)</span><span class="op" id="7220032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220036">bigFromString</span><span class="op" id="7220049">(</span><span class="string" id="7220050">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="7220207">)</span><span class="op" id="7220208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7220211">}</span><span class="op" id="7220212">,</span><br>
<span class="lineno"></span><span class="op" id="7220214">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="7220217">var</span>&nbsp;<span class="ident" id="7220221">testECDSAPrivateKey</span>&nbsp;<span class="op" id="7220241">=</span>&nbsp;<span class="op" id="7220243">&amp;</span><span class="ident" id="7220244">ecdsa</span><span class="op" id="7220249">.</span><span class="ident" id="7220250">PrivateKey</span><span class="op" id="7220260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220263">PublicKey</span><span class="op" id="7220272">:</span>&nbsp;<span class="ident" id="7220274">ecdsa</span><span class="op" id="7220279">.</span><span class="ident" id="7220280">PublicKey</span><span class="op" id="7220289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220293">Curve</span><span class="op" id="7220298">:</span>&nbsp;<span class="ident" id="7220300">elliptic</span><span class="op" id="7220308">.</span><span class="ident" id="7220309">P521</span><span class="op" id="7220313">(</span><span class="op" id="7220314">)</span><span class="op" id="7220315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220319">X</span><span class="op" id="7220320">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7220326">bigFromString</span><span class="op" id="7220339">(</span><span class="string" id="7220340">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="7220499">)</span><span class="op" id="7220500">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220504">Y</span><span class="op" id="7220505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7220511">bigFromString</span><span class="op" id="7220524">(</span><span class="string" id="7220525">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="7220684">)</span><span class="op" id="7220685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7220688">}</span><span class="op" id="7220689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7220692">D</span><span class="op" id="7220693">:</span>&nbsp;<span class="ident" id="7220695">bigFromString</span><span class="op" id="7220708">(</span><span class="string" id="7220709">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="7220868">)</span><span class="op" id="7220869">,</span><br>
<span class="lineno"></span><span class="op" id="7220871">}</span>
</div>
</body>
</html>
