<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2387072">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2387128">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2387182">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2387233">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2387261">package</span>&nbsp;<span class="ident" id="2387269">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2387278">import</span>&nbsp;<span class="string" id="2387285">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2387295">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2387364">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2387420">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2387439">func</span>&nbsp;<span class="ident" id="2387444">UnixCredentials</span><span class="op" id="2387459">(</span><span class="ident" id="2387460">ucred</span>&nbsp;<span class="op" id="2387466">*</span><span class="ident" id="2387467">Ucred</span><span class="op" id="2387472">)</span>&nbsp;<span class="op" id="2387474">[</span><span class="op" id="2387475">]</span><span class="builtintype" id="2387476">byte</span>&nbsp;<span class="op" id="2387481">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387484">b</span>&nbsp;<span class="op" id="2387486">:=</span>&nbsp;<span class="builtinfunc" id="2387489">make</span><span class="op" id="2387493">(</span><span class="op" id="2387494">[</span><span class="op" id="2387495">]</span><span class="builtintype" id="2387496">byte</span><span class="op" id="2387500">,</span>&nbsp;<span class="ident" id="2387502">CmsgSpace</span><span class="op" id="2387511">(</span><span class="ident" id="2387512">SizeofUcred</span><span class="op" id="2387523">)</span><span class="op" id="2387524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387527">h</span>&nbsp;<span class="op" id="2387529">:=</span>&nbsp;<span class="op" id="2387532">(</span><span class="op" id="2387533">*</span><span class="ident" id="2387534">Cmsghdr</span><span class="op" id="2387541">)</span><span class="op" id="2387542">(</span><span class="ident" id="2387543">unsafe</span><span class="op" id="2387549">.</span><span class="ident" id="2387550">Pointer</span><span class="op" id="2387557">(</span><span class="op" id="2387558">&amp;</span><span class="ident" id="2387559">b</span><span class="op" id="2387560">[</span><span class="num" id="2387561">0</span><span class="op" id="2387562">]</span><span class="op" id="2387563">)</span><span class="op" id="2387564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387567">h</span><span class="op" id="2387568">.</span><span class="ident" id="2387569">Level</span>&nbsp;<span class="op" id="2387575">=</span>&nbsp;<span class="ident" id="2387577">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387589">h</span><span class="op" id="2387590">.</span><span class="ident" id="2387591">Type</span>&nbsp;<span class="op" id="2387596">=</span>&nbsp;<span class="ident" id="2387598">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2387615">h</span><span class="op" id="2387616">.</span><span class="ident" id="2387617">SetLen</span><span class="op" id="2387623">(</span><span class="ident" id="2387624">CmsgLen</span><span class="op" id="2387631">(</span><span class="ident" id="2387632">SizeofUcred</span><span class="op" id="2387643">)</span><span class="op" id="2387644">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2387647">*</span><span class="op" id="2387648">(</span><span class="op" id="2387649">(</span><span class="op" id="2387650">*</span><span class="ident" id="2387651">Ucred</span><span class="op" id="2387656">)</span><span class="op" id="2387657">(</span><span class="ident" id="2387658">cmsgData</span><span class="op" id="2387666">(</span><span class="ident" id="2387667">h</span><span class="op" id="2387668">)</span><span class="op" id="2387669">)</span><span class="op" id="2387670">)</span>&nbsp;<span class="op" id="2387672">=</span>&nbsp;<span class="op" id="2387674">*</span><span class="ident" id="2387675">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387682">return</span>&nbsp;<span class="ident" id="2387689">b</span><br>
<span class="lineno"></span><span class="op" id="2387691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2387694">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2387765">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2387833">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2387886">func</span>&nbsp;<span class="ident" id="2387891">ParseUnixCredentials</span><span class="op" id="2387911">(</span><span class="ident" id="2387912">m</span>&nbsp;<span class="op" id="2387914">*</span><span class="ident" id="2387915">SocketControlMessage</span><span class="op" id="2387935">)</span>&nbsp;<span class="op" id="2387937">(</span><span class="op" id="2387938">*</span><span class="ident" id="2387939">Ucred</span><span class="op" id="2387944">,</span>&nbsp;<span class="builtintype" id="2387946">error</span><span class="op" id="2387951">)</span>&nbsp;<span class="op" id="2387953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387956">if</span>&nbsp;<span class="ident" id="2387959">m</span><span class="op" id="2387960">.</span><span class="ident" id="2387961">Header</span><span class="op" id="2387967">.</span><span class="ident" id="2387968">Level</span>&nbsp;<span class="op" id="2387974">!=</span>&nbsp;<span class="ident" id="2387977">SOL_SOCKET</span>&nbsp;<span class="op" id="2387988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2387992">return</span>&nbsp;<span class="ident" id="2387999">nil</span><span class="op" id="2388002">,</span>&nbsp;<span class="ident" id="2388004">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2388012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388015">if</span>&nbsp;<span class="ident" id="2388018">m</span><span class="op" id="2388019">.</span><span class="ident" id="2388020">Header</span><span class="op" id="2388026">.</span><span class="ident" id="2388027">Type</span>&nbsp;<span class="op" id="2388032">!=</span>&nbsp;<span class="ident" id="2388035">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2388051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388055">return</span>&nbsp;<span class="ident" id="2388062">nil</span><span class="op" id="2388065">,</span>&nbsp;<span class="ident" id="2388067">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2388075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388078">ucred</span>&nbsp;<span class="op" id="2388084">:=</span>&nbsp;<span class="op" id="2388087">*</span><span class="op" id="2388088">(</span><span class="op" id="2388089">*</span><span class="ident" id="2388090">Ucred</span><span class="op" id="2388095">)</span><span class="op" id="2388096">(</span><span class="ident" id="2388097">unsafe</span><span class="op" id="2388103">.</span><span class="ident" id="2388104">Pointer</span><span class="op" id="2388111">(</span><span class="op" id="2388112">&amp;</span><span class="ident" id="2388113">m</span><span class="op" id="2388114">.</span><span class="ident" id="2388115">Data</span><span class="op" id="2388119">[</span><span class="num" id="2388120">0</span><span class="op" id="2388121">]</span><span class="op" id="2388122">)</span><span class="op" id="2388123">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388126">return</span>&nbsp;<span class="op" id="2388133">&amp;</span><span class="ident" id="2388134">ucred</span><span class="op" id="2388139">,</span>&nbsp;<span class="ident" id="2388141">nil</span><br>
<span class="lineno"></span><span class="op" id="2388145">}</span>
</div>
</body>
</html>
