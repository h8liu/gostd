<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1996374">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1996429">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1996483">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1996534">package</span>&nbsp;<span class="ident" id="1996542">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1996548">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="1996608">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="1996668">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="1996727">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1996757">//</span><br>
<span class="lineno"></span><span class="comment" id="1996760">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="1996816">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1996885">//</span><br>
<span class="lineno">15</span><span class="comment" id="1996888">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="1996947">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="1997003">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="1997060">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="1997077">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="1997133">//</span><br>
<span class="lineno"></span><span class="comment" id="1997136">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="1997148">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1997199">//</span><br>
<span class="lineno"></span><span class="comment" id="1997202">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="1997212">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="1997240">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1997288">//</span><br>
<span class="lineno"></span><span class="comment" id="1997291">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="1997349">//</span><br>
<span class="lineno">30</span><span class="comment" id="1997352">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="1997416">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="1997480">//</span><br>
<span class="lineno"></span><span class="comment" id="1997483">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1997548">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="1997582">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="1997596">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1997661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1997690">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="1997748">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="1997765">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="1997823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="1997884">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1997951">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="1998016">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="1998079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="1998145">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="1998180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="1998251">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="1998301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="1998351">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="1998401">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="1998451">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="1998501">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="1998568">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="1998598">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="1998651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="1998701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="1998746">//</span><br>
<span class="lineno"></span><span class="comment" id="1998749">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="1998811">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="1998880">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="1998919">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="1998983">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="1999047">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="1999111">//</span><br>
<span class="lineno"></span><span class="comment" id="1999114">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1999180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="1999235">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="1999283">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="1999347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="1999412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="1999430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1999502">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1999574">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="1999646">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1999718">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1999790">//</span><br>
<span class="lineno"></span><span class="comment" id="1999793">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="1999820">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="1999859">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1999888">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="1999939">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="1999996">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2000026">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2000095">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2000147">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2000212">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2000283">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2000318">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2000364">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2000423">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2000483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2000554">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2000617">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2000662">//</span><br>
<span class="lineno"></span><span class="comment" id="2000665">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2000683">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2000729">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2000760">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2000815">//</span><br>
<span class="lineno"></span><span class="comment" id="2000818">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2000831">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2000901">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2000941">//</span><br>
<span class="lineno">105</span><span class="comment" id="2000944">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2000959">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2000983">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2001053">//</span><br>
<span class="lineno"></span><span class="comment" id="2001056">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2001070">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2001136">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2001200">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2001266">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2001310">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2001314">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2001378">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2001438">//</span><br>
<span class="lineno"></span><span class="comment" id="2001441">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2001463">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2001485">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2001505">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2001525">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2001570">func</span>&nbsp;<span class="ident" id="2001575">Expm1</span><span class="op" id="2001580">(</span><span class="ident" id="2001581">x</span>&nbsp;<span class="builtintype" id="2001583">float64</span><span class="op" id="2001590">)</span>&nbsp;<span class="builtintype" id="2001592">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2001601">func</span>&nbsp;<span class="ident" id="2001606">expm1</span><span class="op" id="2001611">(</span><span class="ident" id="2001612">x</span>&nbsp;<span class="builtintype" id="2001614">float64</span><span class="op" id="2001621">)</span>&nbsp;<span class="builtintype" id="2001623">float64</span>&nbsp;<span class="op" id="2001631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2001634">const</span>&nbsp;<span class="op" id="2001640">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001644">Othreshold</span>&nbsp;<span class="op" id="2001655">=</span>&nbsp;<span class="num" id="2001657">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2001684">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001708">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001719">=</span>&nbsp;<span class="num" id="2001721">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2001748">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001772">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2001783">=</span>&nbsp;<span class="num" id="2001785">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2001812">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001836">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001847">=</span>&nbsp;<span class="num" id="2001849">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2001876">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001900">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001911">=</span>&nbsp;<span class="num" id="2001913">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2001940">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2001964">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2001975">=</span>&nbsp;<span class="num" id="2001977">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2002004">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002028">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002039">=</span>&nbsp;<span class="num" id="2002041">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2002068">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002092">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2002103">=</span>&nbsp;<span class="num" id="2002105">1.0</span>&nbsp;<span class="op" id="2002109">/</span>&nbsp;<span class="op" id="2002111">(</span><span class="num" id="2002112">1</span>&nbsp;<span class="op" id="2002114">&lt;&lt;</span>&nbsp;<span class="num" id="2002117">54</span><span class="op" id="2002119">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2002132">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002165">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002207">Q1</span>&nbsp;<span class="op" id="2002210">=</span>&nbsp;<span class="op" id="2002212">-</span><span class="num" id="2002213">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2002240">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002264">Q2</span>&nbsp;<span class="op" id="2002267">=</span>&nbsp;<span class="num" id="2002269">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2002297">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002321">Q3</span>&nbsp;<span class="op" id="2002324">=</span>&nbsp;<span class="op" id="2002326">-</span><span class="num" id="2002327">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2002354">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002378">Q4</span>&nbsp;<span class="op" id="2002381">=</span>&nbsp;<span class="num" id="2002383">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2002411">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002435">Q5</span>&nbsp;<span class="op" id="2002438">=</span>&nbsp;<span class="op" id="2002440">-</span><span class="num" id="2002441">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2002468">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002495">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002513">switch</span>&nbsp;<span class="op" id="2002520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002523">case</span>&nbsp;<span class="ident" id="2002528">IsInf</span><span class="op" id="2002533">(</span><span class="ident" id="2002534">x</span><span class="op" id="2002535">,</span>&nbsp;<span class="num" id="2002537">1</span><span class="op" id="2002538">)</span>&nbsp;<span class="op" id="2002540">||</span>&nbsp;<span class="ident" id="2002543">IsNaN</span><span class="op" id="2002548">(</span><span class="ident" id="2002549">x</span><span class="op" id="2002550">)</span><span class="op" id="2002551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002555">return</span>&nbsp;<span class="ident" id="2002562">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002565">case</span>&nbsp;<span class="ident" id="2002570">IsInf</span><span class="op" id="2002575">(</span><span class="ident" id="2002576">x</span><span class="op" id="2002577">,</span>&nbsp;<span class="op" id="2002579">-</span><span class="num" id="2002580">1</span><span class="op" id="2002581">)</span><span class="op" id="2002582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002586">return</span>&nbsp;<span class="op" id="2002593">-</span><span class="num" id="2002594">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002601">absx</span>&nbsp;<span class="op" id="2002606">:=</span>&nbsp;<span class="ident" id="2002609">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002612">sign</span>&nbsp;<span class="op" id="2002617">:=</span>&nbsp;<span class="ident" id="2002620">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002627">if</span>&nbsp;<span class="ident" id="2002630">x</span>&nbsp;<span class="op" id="2002632">&lt;</span>&nbsp;<span class="num" id="2002634">0</span>&nbsp;<span class="op" id="2002636">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002640">absx</span>&nbsp;<span class="op" id="2002645">=</span>&nbsp;<span class="op" id="2002647">-</span><span class="ident" id="2002648">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2002655">sign</span>&nbsp;<span class="op" id="2002660">=</span>&nbsp;<span class="ident" id="2002662">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002672">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002701">if</span>&nbsp;<span class="ident" id="2002704">absx</span>&nbsp;<span class="op" id="2002709">&gt;=</span>&nbsp;<span class="ident" id="2002712">Ln2X56</span>&nbsp;<span class="op" id="2002719">{</span>&nbsp;<span class="comment" id="2002721">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002745">if</span>&nbsp;<span class="ident" id="2002748">absx</span>&nbsp;<span class="op" id="2002753">&gt;=</span>&nbsp;<span class="ident" id="2002756">Othreshold</span>&nbsp;<span class="op" id="2002767">{</span>&nbsp;<span class="comment" id="2002769">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002795">return</span>&nbsp;<span class="ident" id="2002802">Inf</span><span class="op" id="2002805">(</span><span class="num" id="2002806">1</span><span class="op" id="2002807">)</span>&nbsp;<span class="comment" id="2002809">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002827">if</span>&nbsp;<span class="ident" id="2002830">sign</span>&nbsp;<span class="op" id="2002835">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002840">return</span>&nbsp;<span class="op" id="2002847">-</span><span class="num" id="2002848">1</span>&nbsp;<span class="comment" id="2002850">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2002883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2002887">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002910">var</span>&nbsp;<span class="ident" id="2002914">c</span>&nbsp;<span class="builtintype" id="2002916">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002925">var</span>&nbsp;<span class="ident" id="2002929">k</span>&nbsp;<span class="builtintype" id="2002931">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002936">if</span>&nbsp;<span class="ident" id="2002939">absx</span>&nbsp;<span class="op" id="2002944">&gt;</span>&nbsp;<span class="ident" id="2002946">Ln2Half</span>&nbsp;<span class="op" id="2002954">{</span>&nbsp;<span class="comment" id="2002956">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2002981">var</span>&nbsp;<span class="ident" id="2002985">hi</span><span class="op" id="2002987">,</span>&nbsp;<span class="ident" id="2002989">lo</span>&nbsp;<span class="builtintype" id="2002992">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003002">if</span>&nbsp;<span class="ident" id="2003005">absx</span>&nbsp;<span class="op" id="2003010">&lt;</span>&nbsp;<span class="ident" id="2003012">Ln2HalfX3</span>&nbsp;<span class="op" id="2003022">{</span>&nbsp;<span class="comment" id="2003024">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003050">if</span>&nbsp;<span class="op" id="2003053">!</span><span class="ident" id="2003054">sign</span>&nbsp;<span class="op" id="2003059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003065">hi</span>&nbsp;<span class="op" id="2003068">=</span>&nbsp;<span class="ident" id="2003070">x</span>&nbsp;<span class="op" id="2003072">-</span>&nbsp;<span class="ident" id="2003074">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003084">lo</span>&nbsp;<span class="op" id="2003087">=</span>&nbsp;<span class="ident" id="2003089">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003099">k</span>&nbsp;<span class="op" id="2003101">=</span>&nbsp;<span class="num" id="2003103">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003108">}</span>&nbsp;<span class="keyword" id="2003110">else</span>&nbsp;<span class="op" id="2003115">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003121">hi</span>&nbsp;<span class="op" id="2003124">=</span>&nbsp;<span class="ident" id="2003126">x</span>&nbsp;<span class="op" id="2003128">+</span>&nbsp;<span class="ident" id="2003130">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003140">lo</span>&nbsp;<span class="op" id="2003143">=</span>&nbsp;<span class="op" id="2003145">-</span><span class="ident" id="2003146">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003156">k</span>&nbsp;<span class="op" id="2003158">=</span>&nbsp;<span class="op" id="2003160">-</span><span class="num" id="2003161">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003170">}</span>&nbsp;<span class="keyword" id="2003172">else</span>&nbsp;<span class="op" id="2003177">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003182">if</span>&nbsp;<span class="op" id="2003185">!</span><span class="ident" id="2003186">sign</span>&nbsp;<span class="op" id="2003191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003197">k</span>&nbsp;<span class="op" id="2003199">=</span>&nbsp;<span class="builtintype" id="2003201">int</span><span class="op" id="2003204">(</span><span class="ident" id="2003205">InvLn2</span><span class="op" id="2003211">*</span><span class="ident" id="2003212">x</span>&nbsp;<span class="op" id="2003214">+</span>&nbsp;<span class="num" id="2003216">0.5</span><span class="op" id="2003219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003224">}</span>&nbsp;<span class="keyword" id="2003226">else</span>&nbsp;<span class="op" id="2003231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003237">k</span>&nbsp;<span class="op" id="2003239">=</span>&nbsp;<span class="builtintype" id="2003241">int</span><span class="op" id="2003244">(</span><span class="ident" id="2003245">InvLn2</span><span class="op" id="2003251">*</span><span class="ident" id="2003252">x</span>&nbsp;<span class="op" id="2003254">-</span>&nbsp;<span class="num" id="2003256">0.5</span><span class="op" id="2003259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003264">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003269">t</span>&nbsp;<span class="op" id="2003271">:=</span>&nbsp;<span class="builtintype" id="2003274">float64</span><span class="op" id="2003281">(</span><span class="ident" id="2003282">k</span><span class="op" id="2003283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003288">hi</span>&nbsp;<span class="op" id="2003291">=</span>&nbsp;<span class="ident" id="2003293">x</span>&nbsp;<span class="op" id="2003295">-</span>&nbsp;<span class="ident" id="2003297">t</span><span class="op" id="2003298">*</span><span class="ident" id="2003299">Ln2Hi</span>&nbsp;<span class="comment" id="2003305">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003335">lo</span>&nbsp;<span class="op" id="2003338">=</span>&nbsp;<span class="ident" id="2003340">t</span>&nbsp;<span class="op" id="2003342">*</span>&nbsp;<span class="ident" id="2003344">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003356">x</span>&nbsp;<span class="op" id="2003358">=</span>&nbsp;<span class="ident" id="2003360">hi</span>&nbsp;<span class="op" id="2003363">-</span>&nbsp;<span class="ident" id="2003365">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003370">c</span>&nbsp;<span class="op" id="2003372">=</span>&nbsp;<span class="op" id="2003374">(</span><span class="ident" id="2003375">hi</span>&nbsp;<span class="op" id="2003378">-</span>&nbsp;<span class="ident" id="2003380">x</span><span class="op" id="2003381">)</span>&nbsp;<span class="op" id="2003383">-</span>&nbsp;<span class="ident" id="2003385">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003389">}</span>&nbsp;<span class="keyword" id="2003391">else</span>&nbsp;<span class="keyword" id="2003396">if</span>&nbsp;<span class="ident" id="2003399">absx</span>&nbsp;<span class="op" id="2003404">&lt;</span>&nbsp;<span class="ident" id="2003406">Tiny</span>&nbsp;<span class="op" id="2003411">{</span>&nbsp;<span class="comment" id="2003413">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003446">return</span>&nbsp;<span class="ident" id="2003453">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003456">}</span>&nbsp;<span class="keyword" id="2003458">else</span>&nbsp;<span class="op" id="2003463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003467">k</span>&nbsp;<span class="op" id="2003469">=</span>&nbsp;<span class="num" id="2003471">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2003478">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003508">hfx</span>&nbsp;<span class="op" id="2003512">:=</span>&nbsp;<span class="num" id="2003515">0.5</span>&nbsp;<span class="op" id="2003519">*</span>&nbsp;<span class="ident" id="2003521">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003524">hxs</span>&nbsp;<span class="op" id="2003528">:=</span>&nbsp;<span class="ident" id="2003531">x</span>&nbsp;<span class="op" id="2003533">*</span>&nbsp;<span class="ident" id="2003535">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003540">r1</span>&nbsp;<span class="op" id="2003543">:=</span>&nbsp;<span class="num" id="2003546">1</span>&nbsp;<span class="op" id="2003548">+</span>&nbsp;<span class="ident" id="2003550">hxs</span><span class="op" id="2003553">*</span><span class="op" id="2003554">(</span><span class="ident" id="2003555">Q1</span><span class="op" id="2003557">+</span><span class="ident" id="2003558">hxs</span><span class="op" id="2003561">*</span><span class="op" id="2003562">(</span><span class="ident" id="2003563">Q2</span><span class="op" id="2003565">+</span><span class="ident" id="2003566">hxs</span><span class="op" id="2003569">*</span><span class="op" id="2003570">(</span><span class="ident" id="2003571">Q3</span><span class="op" id="2003573">+</span><span class="ident" id="2003574">hxs</span><span class="op" id="2003577">*</span><span class="op" id="2003578">(</span><span class="ident" id="2003579">Q4</span><span class="op" id="2003581">+</span><span class="ident" id="2003582">hxs</span><span class="op" id="2003585">*</span><span class="ident" id="2003586">Q5</span><span class="op" id="2003588">)</span><span class="op" id="2003589">)</span><span class="op" id="2003590">)</span><span class="op" id="2003591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003594">t</span>&nbsp;<span class="op" id="2003596">:=</span>&nbsp;<span class="num" id="2003599">3</span>&nbsp;<span class="op" id="2003601">-</span>&nbsp;<span class="ident" id="2003603">r1</span><span class="op" id="2003605">*</span><span class="ident" id="2003606">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003611">e</span>&nbsp;<span class="op" id="2003613">:=</span>&nbsp;<span class="ident" id="2003616">hxs</span>&nbsp;<span class="op" id="2003620">*</span>&nbsp;<span class="op" id="2003622">(</span><span class="op" id="2003623">(</span><span class="ident" id="2003624">r1</span>&nbsp;<span class="op" id="2003627">-</span>&nbsp;<span class="ident" id="2003629">t</span><span class="op" id="2003630">)</span>&nbsp;<span class="op" id="2003632">/</span>&nbsp;<span class="op" id="2003634">(</span><span class="num" id="2003635">6.0</span>&nbsp;<span class="op" id="2003639">-</span>&nbsp;<span class="ident" id="2003641">x</span><span class="op" id="2003642">*</span><span class="ident" id="2003643">t</span><span class="op" id="2003644">)</span><span class="op" id="2003645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003648">if</span>&nbsp;<span class="ident" id="2003651">k</span>&nbsp;<span class="op" id="2003653">!=</span>&nbsp;<span class="num" id="2003656">0</span>&nbsp;<span class="op" id="2003658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003662">e</span>&nbsp;<span class="op" id="2003664">=</span>&nbsp;<span class="op" id="2003666">(</span><span class="ident" id="2003667">x</span><span class="op" id="2003668">*</span><span class="op" id="2003669">(</span><span class="ident" id="2003670">e</span><span class="op" id="2003671">-</span><span class="ident" id="2003672">c</span><span class="op" id="2003673">)</span>&nbsp;<span class="op" id="2003675">-</span>&nbsp;<span class="ident" id="2003677">c</span><span class="op" id="2003678">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003682">e</span>&nbsp;<span class="op" id="2003684">-=</span>&nbsp;<span class="ident" id="2003687">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003693">switch</span>&nbsp;<span class="op" id="2003700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003704">case</span>&nbsp;<span class="ident" id="2003709">k</span>&nbsp;<span class="op" id="2003711">==</span>&nbsp;<span class="op" id="2003714">-</span><span class="num" id="2003715">1</span><span class="op" id="2003716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003721">return</span>&nbsp;<span class="num" id="2003728">0.5</span><span class="op" id="2003731">*</span><span class="op" id="2003732">(</span><span class="ident" id="2003733">x</span><span class="op" id="2003734">-</span><span class="ident" id="2003735">e</span><span class="op" id="2003736">)</span>&nbsp;<span class="op" id="2003738">-</span>&nbsp;<span class="num" id="2003740">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003746">case</span>&nbsp;<span class="ident" id="2003751">k</span>&nbsp;<span class="op" id="2003753">==</span>&nbsp;<span class="num" id="2003756">1</span><span class="op" id="2003757">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003762">if</span>&nbsp;<span class="ident" id="2003765">x</span>&nbsp;<span class="op" id="2003767">&lt;</span>&nbsp;<span class="op" id="2003769">-</span><span class="num" id="2003770">0.25</span>&nbsp;<span class="op" id="2003775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003781">return</span>&nbsp;<span class="op" id="2003788">-</span><span class="num" id="2003789">2</span>&nbsp;<span class="op" id="2003791">*</span>&nbsp;<span class="op" id="2003793">(</span><span class="ident" id="2003794">e</span>&nbsp;<span class="op" id="2003796">-</span>&nbsp;<span class="op" id="2003798">(</span><span class="ident" id="2003799">x</span>&nbsp;<span class="op" id="2003801">+</span>&nbsp;<span class="num" id="2003803">0.5</span><span class="op" id="2003806">)</span><span class="op" id="2003807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2003812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003817">return</span>&nbsp;<span class="num" id="2003824">1</span>&nbsp;<span class="op" id="2003826">+</span>&nbsp;<span class="num" id="2003828">2</span><span class="op" id="2003829">*</span><span class="op" id="2003830">(</span><span class="ident" id="2003831">x</span><span class="op" id="2003832">-</span><span class="ident" id="2003833">e</span><span class="op" id="2003834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003838">case</span>&nbsp;<span class="ident" id="2003843">k</span>&nbsp;<span class="op" id="2003845">&lt;=</span>&nbsp;<span class="op" id="2003848">-</span><span class="num" id="2003849">2</span>&nbsp;<span class="op" id="2003851">||</span>&nbsp;<span class="ident" id="2003854">k</span>&nbsp;<span class="op" id="2003856">&gt;</span>&nbsp;<span class="num" id="2003858">56</span><span class="op" id="2003860">:</span>&nbsp;<span class="comment" id="2003862">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003895">y</span>&nbsp;<span class="op" id="2003897">:=</span>&nbsp;<span class="num" id="2003900">1</span>&nbsp;<span class="op" id="2003902">-</span>&nbsp;<span class="op" id="2003904">(</span><span class="ident" id="2003905">e</span>&nbsp;<span class="op" id="2003907">-</span>&nbsp;<span class="ident" id="2003909">x</span><span class="op" id="2003910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2003915">y</span>&nbsp;<span class="op" id="2003917">=</span>&nbsp;<span class="ident" id="2003919">Float64frombits</span><span class="op" id="2003934">(</span><span class="ident" id="2003935">Float64bits</span><span class="op" id="2003946">(</span><span class="ident" id="2003947">y</span><span class="op" id="2003948">)</span>&nbsp;<span class="op" id="2003950">+</span>&nbsp;<span class="ident" id="2003952">uint64</span><span class="op" id="2003958">(</span><span class="ident" id="2003959">k</span><span class="op" id="2003960">)</span><span class="op" id="2003961">&lt;&lt;</span><span class="num" id="2003963">52</span><span class="op" id="2003965">)</span>&nbsp;<span class="comment" id="2003967">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2003995">return</span>&nbsp;<span class="ident" id="2004002">y</span>&nbsp;<span class="op" id="2004004">-</span>&nbsp;<span class="num" id="2004006">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004014">if</span>&nbsp;<span class="ident" id="2004017">k</span>&nbsp;<span class="op" id="2004019">&lt;</span>&nbsp;<span class="num" id="2004021">20</span>&nbsp;<span class="op" id="2004024">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004029">t</span>&nbsp;<span class="op" id="2004031">:=</span>&nbsp;<span class="ident" id="2004034">Float64frombits</span><span class="op" id="2004049">(</span><span class="num" id="2004050">0x3ff0000000000000</span>&nbsp;<span class="op" id="2004069">-</span>&nbsp;<span class="op" id="2004071">(</span><span class="num" id="2004072">0x20000000000000</span>&nbsp;<span class="op" id="2004089">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2004092">uint</span><span class="op" id="2004096">(</span><span class="ident" id="2004097">k</span><span class="op" id="2004098">)</span><span class="op" id="2004099">)</span><span class="op" id="2004100">)</span>&nbsp;<span class="comment" id="2004102">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004118">y</span>&nbsp;<span class="op" id="2004120">:=</span>&nbsp;<span class="ident" id="2004123">t</span>&nbsp;<span class="op" id="2004125">-</span>&nbsp;<span class="op" id="2004127">(</span><span class="ident" id="2004128">e</span>&nbsp;<span class="op" id="2004130">-</span>&nbsp;<span class="ident" id="2004132">x</span><span class="op" id="2004133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004138">y</span>&nbsp;<span class="op" id="2004140">=</span>&nbsp;<span class="ident" id="2004142">Float64frombits</span><span class="op" id="2004157">(</span><span class="ident" id="2004158">Float64bits</span><span class="op" id="2004169">(</span><span class="ident" id="2004170">y</span><span class="op" id="2004171">)</span>&nbsp;<span class="op" id="2004173">+</span>&nbsp;<span class="ident" id="2004175">uint64</span><span class="op" id="2004181">(</span><span class="ident" id="2004182">k</span><span class="op" id="2004183">)</span><span class="op" id="2004184">&lt;&lt;</span><span class="num" id="2004186">52</span><span class="op" id="2004188">)</span>&nbsp;<span class="comment" id="2004190">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004218">return</span>&nbsp;<span class="ident" id="2004225">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004229">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004233">t</span>&nbsp;<span class="op" id="2004235">:=</span>&nbsp;<span class="ident" id="2004238">Float64frombits</span><span class="op" id="2004253">(</span><span class="ident" id="2004254">uint64</span><span class="op" id="2004260">(</span><span class="op" id="2004261">(</span><span class="num" id="2004262">0x3ff</span>&nbsp;<span class="op" id="2004268">-</span>&nbsp;<span class="ident" id="2004270">k</span><span class="op" id="2004271">)</span>&nbsp;<span class="op" id="2004273">&lt;&lt;</span>&nbsp;<span class="num" id="2004276">52</span><span class="op" id="2004278">)</span><span class="op" id="2004279">)</span>&nbsp;<span class="comment" id="2004281">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004292">y</span>&nbsp;<span class="op" id="2004294">:=</span>&nbsp;<span class="ident" id="2004297">x</span>&nbsp;<span class="op" id="2004299">-</span>&nbsp;<span class="op" id="2004301">(</span><span class="ident" id="2004302">e</span>&nbsp;<span class="op" id="2004304">+</span>&nbsp;<span class="ident" id="2004306">t</span><span class="op" id="2004307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004311">y</span>&nbsp;<span class="op" id="2004313">+=</span>&nbsp;<span class="num" id="2004316">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2004320">y</span>&nbsp;<span class="op" id="2004322">=</span>&nbsp;<span class="ident" id="2004324">Float64frombits</span><span class="op" id="2004339">(</span><span class="ident" id="2004340">Float64bits</span><span class="op" id="2004351">(</span><span class="ident" id="2004352">y</span><span class="op" id="2004353">)</span>&nbsp;<span class="op" id="2004355">+</span>&nbsp;<span class="ident" id="2004357">uint64</span><span class="op" id="2004363">(</span><span class="ident" id="2004364">k</span><span class="op" id="2004365">)</span><span class="op" id="2004366">&lt;&lt;</span><span class="num" id="2004368">52</span><span class="op" id="2004370">)</span>&nbsp;<span class="comment" id="2004372">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004399">return</span>&nbsp;<span class="ident" id="2004406">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2004409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2004412">return</span>&nbsp;<span class="ident" id="2004419">x</span>&nbsp;<span class="op" id="2004421">-</span>&nbsp;<span class="op" id="2004423">(</span><span class="ident" id="2004424">x</span><span class="op" id="2004425">*</span><span class="ident" id="2004426">e</span>&nbsp;<span class="op" id="2004428">-</span>&nbsp;<span class="ident" id="2004430">hxs</span><span class="op" id="2004433">)</span>&nbsp;<span class="comment" id="2004435">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2004445">}</span>
</div>
</body>
</html>
