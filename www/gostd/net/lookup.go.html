<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3347837">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3347893">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3347947">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3347998">package</span>&nbsp;<span class="ident" id="3348006">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348011">import</span>&nbsp;<span class="string" id="3348018">&#34;time&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348026">//&nbsp;protocols&nbsp;contains&nbsp;minimal&nbsp;mappings&nbsp;between&nbsp;internet&nbsp;protocol</span><br>
<span class="lineno">10</span><span class="comment" id="3348091">//&nbsp;names&nbsp;and&nbsp;numbers&nbsp;for&nbsp;platforms&nbsp;that&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;complete&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3348161">//&nbsp;protocol&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="3348182">//</span><br>
<span class="lineno"></span><span class="comment" id="3348185">//&nbsp;See&nbsp;http://www.iana.org/assignments/protocol-numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3348241">var</span>&nbsp;<span class="ident" id="3348245">protocols</span>&nbsp;<span class="op" id="3348255">=</span>&nbsp;<span class="keyword" id="3348257">map</span><span class="op" id="3348260">[</span><span class="builtintype" id="3348261">string</span><span class="op" id="3348267">]</span><span class="builtintype" id="3348268">int</span><span class="op" id="3348271">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3348274">&#34;icmp&#34;</span><span class="op" id="3348280">:</span>&nbsp;<span class="num" id="3348282">1</span><span class="op" id="3348283">,</span>&nbsp;<span class="string" id="3348285">&#34;ICMP&#34;</span><span class="op" id="3348291">:</span>&nbsp;<span class="num" id="3348293">1</span><span class="op" id="3348294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3348297">&#34;igmp&#34;</span><span class="op" id="3348303">:</span>&nbsp;<span class="num" id="3348305">2</span><span class="op" id="3348306">,</span>&nbsp;<span class="string" id="3348308">&#34;IGMP&#34;</span><span class="op" id="3348314">:</span>&nbsp;<span class="num" id="3348316">2</span><span class="op" id="3348317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3348320">&#34;tcp&#34;</span><span class="op" id="3348325">:</span>&nbsp;<span class="num" id="3348327">6</span><span class="op" id="3348328">,</span>&nbsp;<span class="string" id="3348330">&#34;TCP&#34;</span><span class="op" id="3348335">:</span>&nbsp;<span class="num" id="3348337">6</span><span class="op" id="3348338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3348341">&#34;udp&#34;</span><span class="op" id="3348346">:</span>&nbsp;<span class="num" id="3348348">17</span><span class="op" id="3348350">,</span>&nbsp;<span class="string" id="3348352">&#34;UDP&#34;</span><span class="op" id="3348357">:</span>&nbsp;<span class="num" id="3348359">17</span><span class="op" id="3348361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3348364">&#34;ipv6-icmp&#34;</span><span class="op" id="3348375">:</span>&nbsp;<span class="num" id="3348377">58</span><span class="op" id="3348379">,</span>&nbsp;<span class="string" id="3348381">&#34;IPV6-ICMP&#34;</span><span class="op" id="3348392">:</span>&nbsp;<span class="num" id="3348394">58</span><span class="op" id="3348396">,</span>&nbsp;<span class="string" id="3348398">&#34;IPv6-ICMP&#34;</span><span class="op" id="3348409">:</span>&nbsp;<span class="num" id="3348411">58</span><span class="op" id="3348413">,</span><br>
<span class="lineno">20</span><span class="op" id="3348415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348418">//&nbsp;LookupHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;given&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="3348482">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3348531">func</span>&nbsp;<span class="ident" id="3348536">LookupHost</span><span class="op" id="3348546">(</span><span class="ident" id="3348547">host</span>&nbsp;<span class="builtintype" id="3348552">string</span><span class="op" id="3348558">)</span>&nbsp;<span class="op" id="3348560">(</span><span class="ident" id="3348561">addrs</span>&nbsp;<span class="op" id="3348567">[</span><span class="op" id="3348568">]</span><span class="builtintype" id="3348569">string</span><span class="op" id="3348575">,</span>&nbsp;<span class="ident" id="3348577">err</span>&nbsp;<span class="builtintype" id="3348581">error</span><span class="op" id="3348586">)</span>&nbsp;<span class="op" id="3348588">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348591">return</span>&nbsp;<span class="ident" id="3348598">lookupHost</span><span class="op" id="3348608">(</span><span class="ident" id="3348609">host</span><span class="op" id="3348613">)</span><br>
<span class="lineno"></span><span class="op" id="3348615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3348618">//&nbsp;LookupIP&nbsp;looks&nbsp;up&nbsp;host&nbsp;using&nbsp;the&nbsp;local&nbsp;resolver.</span><br>
<span class="lineno"></span><span class="comment" id="3348670">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;that&nbsp;host&#39;s&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno">30</span><span class="keyword" id="3348733">func</span>&nbsp;<span class="ident" id="3348738">LookupIP</span><span class="op" id="3348746">(</span><span class="ident" id="3348747">host</span>&nbsp;<span class="builtintype" id="3348752">string</span><span class="op" id="3348758">)</span>&nbsp;<span class="op" id="3348760">(</span><span class="ident" id="3348761">addrs</span>&nbsp;<span class="op" id="3348767">[</span><span class="op" id="3348768">]</span><span class="ident" id="3348769">IP</span><span class="op" id="3348771">,</span>&nbsp;<span class="ident" id="3348773">err</span>&nbsp;<span class="builtintype" id="3348777">error</span><span class="op" id="3348782">)</span>&nbsp;<span class="op" id="3348784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348787">return</span>&nbsp;<span class="ident" id="3348794">lookupIPMerge</span><span class="op" id="3348807">(</span><span class="ident" id="3348808">host</span><span class="op" id="3348812">)</span><br>
<span class="lineno"></span><span class="op" id="3348814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3348817">var</span>&nbsp;<span class="ident" id="3348821">lookupGroup</span>&nbsp;<span class="ident" id="3348833">singleflight</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3348847">//&nbsp;lookupIPMerge&nbsp;wraps&nbsp;lookupIP,&nbsp;but&nbsp;makes&nbsp;sure&nbsp;that&nbsp;for&nbsp;any&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3348914">//&nbsp;host,&nbsp;only&nbsp;one&nbsp;lookup&nbsp;is&nbsp;in-flight&nbsp;at&nbsp;a&nbsp;time.&nbsp;The&nbsp;returned&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="3348983">//&nbsp;is&nbsp;always&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="keyword" id="3349017">func</span>&nbsp;<span class="ident" id="3349022">lookupIPMerge</span><span class="op" id="3349035">(</span><span class="ident" id="3349036">host</span>&nbsp;<span class="builtintype" id="3349041">string</span><span class="op" id="3349047">)</span>&nbsp;<span class="op" id="3349049">(</span><span class="ident" id="3349050">addrs</span>&nbsp;<span class="op" id="3349056">[</span><span class="op" id="3349057">]</span><span class="ident" id="3349058">IP</span><span class="op" id="3349060">,</span>&nbsp;<span class="ident" id="3349062">err</span>&nbsp;<span class="builtintype" id="3349066">error</span><span class="op" id="3349071">)</span>&nbsp;<span class="op" id="3349073">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349076">addrsi</span><span class="op" id="3349082">,</span>&nbsp;<span class="ident" id="3349084">err</span><span class="op" id="3349087">,</span>&nbsp;<span class="ident" id="3349089">shared</span>&nbsp;<span class="op" id="3349096">:=</span>&nbsp;<span class="ident" id="3349099">lookupGroup</span><span class="op" id="3349110">.</span><span class="ident" id="3349111">Do</span><span class="op" id="3349113">(</span><span class="ident" id="3349114">host</span><span class="op" id="3349118">,</span>&nbsp;<span class="keyword" id="3349120">func</span><span class="op" id="3349124">(</span><span class="op" id="3349125">)</span>&nbsp;<span class="op" id="3349127">(</span><span class="keyword" id="3349128">interface</span><span class="op" id="3349137">{</span><span class="op" id="3349138">}</span><span class="op" id="3349139">,</span>&nbsp;<span class="builtintype" id="3349141">error</span><span class="op" id="3349146">)</span>&nbsp;<span class="op" id="3349148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349152">return</span>&nbsp;<span class="ident" id="3349159">lookupIP</span><span class="op" id="3349167">(</span><span class="ident" id="3349168">host</span><span class="op" id="3349172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349175">}</span><span class="op" id="3349176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349179">return</span>&nbsp;<span class="ident" id="3349186">lookupIPReturn</span><span class="op" id="3349200">(</span><span class="ident" id="3349201">addrsi</span><span class="op" id="3349207">,</span>&nbsp;<span class="ident" id="3349209">err</span><span class="op" id="3349212">,</span>&nbsp;<span class="ident" id="3349214">shared</span><span class="op" id="3349220">)</span><br>
<span class="lineno"></span><span class="op" id="3349222">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3349225">//&nbsp;lookupIPReturn&nbsp;turns&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;singleflight.Do&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="3349293">//&nbsp;the&nbsp;return&nbsp;values&nbsp;from&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="keyword" id="3349329">func</span>&nbsp;<span class="ident" id="3349334">lookupIPReturn</span><span class="op" id="3349348">(</span><span class="ident" id="3349349">addrsi</span>&nbsp;<span class="keyword" id="3349356">interface</span><span class="op" id="3349365">{</span><span class="op" id="3349366">}</span><span class="op" id="3349367">,</span>&nbsp;<span class="ident" id="3349369">err</span>&nbsp;<span class="builtintype" id="3349373">error</span><span class="op" id="3349378">,</span>&nbsp;<span class="ident" id="3349380">shared</span>&nbsp;<span class="builtintype" id="3349387">bool</span><span class="op" id="3349391">)</span>&nbsp;<span class="op" id="3349393">(</span><span class="op" id="3349394">[</span><span class="op" id="3349395">]</span><span class="ident" id="3349396">IP</span><span class="op" id="3349398">,</span>&nbsp;<span class="builtintype" id="3349400">error</span><span class="op" id="3349405">)</span>&nbsp;<span class="op" id="3349407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349410">if</span>&nbsp;<span class="ident" id="3349413">err</span>&nbsp;<span class="op" id="3349417">!=</span>&nbsp;<span class="ident" id="3349420">nil</span>&nbsp;<span class="op" id="3349424">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349428">return</span>&nbsp;<span class="ident" id="3349435">nil</span><span class="op" id="3349438">,</span>&nbsp;<span class="ident" id="3349440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349448">addrs</span>&nbsp;<span class="op" id="3349454">:=</span>&nbsp;<span class="ident" id="3349457">addrsi</span><span class="op" id="3349463">.</span><span class="op" id="3349464">(</span><span class="op" id="3349465">[</span><span class="op" id="3349466">]</span><span class="ident" id="3349467">IP</span><span class="op" id="3349469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349472">if</span>&nbsp;<span class="ident" id="3349475">shared</span>&nbsp;<span class="op" id="3349482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349486">clone</span>&nbsp;<span class="op" id="3349492">:=</span>&nbsp;<span class="builtinfunc" id="3349495">make</span><span class="op" id="3349499">(</span><span class="op" id="3349500">[</span><span class="op" id="3349501">]</span><span class="ident" id="3349502">IP</span><span class="op" id="3349504">,</span>&nbsp;<span class="builtinfunc" id="3349506">len</span><span class="op" id="3349509">(</span><span class="ident" id="3349510">addrs</span><span class="op" id="3349515">)</span><span class="op" id="3349516">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3349520">copy</span><span class="op" id="3349524">(</span><span class="ident" id="3349525">clone</span><span class="op" id="3349530">,</span>&nbsp;<span class="ident" id="3349532">addrs</span><span class="op" id="3349537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349541">addrs</span>&nbsp;<span class="op" id="3349547">=</span>&nbsp;<span class="ident" id="3349549">clone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349559">return</span>&nbsp;<span class="ident" id="3349566">addrs</span><span class="op" id="3349571">,</span>&nbsp;<span class="ident" id="3349573">nil</span><br>
<span class="lineno"></span><span class="op" id="3349577">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3349580">//&nbsp;lookupIPDeadline&nbsp;looks&nbsp;up&nbsp;a&nbsp;hostname&nbsp;with&nbsp;a&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3349637">func</span>&nbsp;<span class="ident" id="3349642">lookupIPDeadline</span><span class="op" id="3349658">(</span><span class="ident" id="3349659">host</span>&nbsp;<span class="builtintype" id="3349664">string</span><span class="op" id="3349670">,</span>&nbsp;<span class="ident" id="3349672">deadline</span>&nbsp;<span class="ident" id="3349681">time</span><span class="op" id="3349685">.</span><span class="ident" id="3349686">Time</span><span class="op" id="3349690">)</span>&nbsp;<span class="op" id="3349692">(</span><span class="ident" id="3349693">addrs</span>&nbsp;<span class="op" id="3349699">[</span><span class="op" id="3349700">]</span><span class="ident" id="3349701">IP</span><span class="op" id="3349703">,</span>&nbsp;<span class="ident" id="3349705">err</span>&nbsp;<span class="builtintype" id="3349709">error</span><span class="op" id="3349714">)</span>&nbsp;<span class="op" id="3349716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349719">if</span>&nbsp;<span class="ident" id="3349722">deadline</span><span class="op" id="3349730">.</span><span class="ident" id="3349731">IsZero</span><span class="op" id="3349737">(</span><span class="op" id="3349738">)</span>&nbsp;<span class="op" id="3349740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349744">return</span>&nbsp;<span class="ident" id="3349751">lookupIPMerge</span><span class="op" id="3349764">(</span><span class="ident" id="3349765">host</span><span class="op" id="3349769">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3349772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349776">//&nbsp;We&nbsp;could&nbsp;push&nbsp;the&nbsp;deadline&nbsp;down&nbsp;into&nbsp;the&nbsp;name&nbsp;resolution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349837">//&nbsp;functions.&nbsp;&nbsp;However,&nbsp;the&nbsp;most&nbsp;commonly&nbsp;used&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3349900">//&nbsp;calls&nbsp;getaddrinfo,&nbsp;which&nbsp;has&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3349946">timeout</span>&nbsp;<span class="op" id="3349954">:=</span>&nbsp;<span class="ident" id="3349957">deadline</span><span class="op" id="3349965">.</span><span class="ident" id="3349966">Sub</span><span class="op" id="3349969">(</span><span class="ident" id="3349970">time</span><span class="op" id="3349974">.</span><span class="ident" id="3349975">Now</span><span class="op" id="3349978">(</span><span class="op" id="3349979">)</span><span class="op" id="3349980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3349983">if</span>&nbsp;<span class="ident" id="3349986">timeout</span>&nbsp;<span class="op" id="3349994">&lt;=</span>&nbsp;<span class="num" id="3349997">0</span>&nbsp;<span class="op" id="3349999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350003">return</span>&nbsp;<span class="ident" id="3350010">nil</span><span class="op" id="3350013">,</span>&nbsp;<span class="ident" id="3350015">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350027">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350030">t</span>&nbsp;<span class="op" id="3350032">:=</span>&nbsp;<span class="ident" id="3350035">time</span><span class="op" id="3350039">.</span><span class="ident" id="3350040">NewTimer</span><span class="op" id="3350048">(</span><span class="ident" id="3350049">timeout</span><span class="op" id="3350056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350059">defer</span>&nbsp;<span class="ident" id="3350065">t</span><span class="op" id="3350066">.</span><span class="ident" id="3350067">Stop</span><span class="op" id="3350071">(</span><span class="op" id="3350072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350076">ch</span>&nbsp;<span class="op" id="3350079">:=</span>&nbsp;<span class="ident" id="3350082">lookupGroup</span><span class="op" id="3350093">.</span><span class="ident" id="3350094">DoChan</span><span class="op" id="3350100">(</span><span class="ident" id="3350101">host</span><span class="op" id="3350105">,</span>&nbsp;<span class="keyword" id="3350107">func</span><span class="op" id="3350111">(</span><span class="op" id="3350112">)</span>&nbsp;<span class="op" id="3350114">(</span><span class="keyword" id="3350115">interface</span><span class="op" id="3350124">{</span><span class="op" id="3350125">}</span><span class="op" id="3350126">,</span>&nbsp;<span class="builtintype" id="3350128">error</span><span class="op" id="3350133">)</span>&nbsp;<span class="op" id="3350135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350139">return</span>&nbsp;<span class="ident" id="3350146">lookupIP</span><span class="op" id="3350154">(</span><span class="ident" id="3350155">host</span><span class="op" id="3350159">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350162">}</span><span class="op" id="3350163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350167">select</span>&nbsp;<span class="op" id="3350174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350177">case</span>&nbsp;<span class="op" id="3350182">&lt;-</span><span class="ident" id="3350184">t</span><span class="op" id="3350185">.</span><span class="ident" id="3350186">C</span><span class="op" id="3350187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350191">//&nbsp;The&nbsp;DNS&nbsp;lookup&nbsp;timed&nbsp;out&nbsp;for&nbsp;some&nbsp;reason.&nbsp;&nbsp;Force</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350245">//&nbsp;future&nbsp;requests&nbsp;to&nbsp;start&nbsp;the&nbsp;DNS&nbsp;lookup&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350296">//&nbsp;rather&nbsp;than&nbsp;waiting&nbsp;for&nbsp;the&nbsp;current&nbsp;lookup&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3350347">//&nbsp;complete.&nbsp;&nbsp;See&nbsp;issue&nbsp;8602.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3350379">lookupGroup</span><span class="op" id="3350390">.</span><span class="ident" id="3350391">Forget</span><span class="op" id="3350397">(</span><span class="ident" id="3350398">host</span><span class="op" id="3350402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350407">return</span>&nbsp;<span class="ident" id="3350414">nil</span><span class="op" id="3350417">,</span>&nbsp;<span class="ident" id="3350419">errTimeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350432">case</span>&nbsp;<span class="ident" id="3350437">r</span>&nbsp;<span class="op" id="3350439">:=</span>&nbsp;<span class="op" id="3350442">&lt;-</span><span class="ident" id="3350444">ch</span><span class="op" id="3350446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350450">return</span>&nbsp;<span class="ident" id="3350457">lookupIPReturn</span><span class="op" id="3350471">(</span><span class="ident" id="3350472">r</span><span class="op" id="3350473">.</span><span class="ident" id="3350474">v</span><span class="op" id="3350475">,</span>&nbsp;<span class="ident" id="3350477">r</span><span class="op" id="3350478">.</span><span class="ident" id="3350479">err</span><span class="op" id="3350482">,</span>&nbsp;<span class="ident" id="3350484">r</span><span class="op" id="3350485">.</span><span class="ident" id="3350486">shared</span><span class="op" id="3350492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3350495">}</span><br>
<span class="lineno">95</span><span class="op" id="3350497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350500">//&nbsp;LookupPort&nbsp;looks&nbsp;up&nbsp;the&nbsp;port&nbsp;for&nbsp;the&nbsp;given&nbsp;network&nbsp;and&nbsp;service.</span><br>
<span class="lineno"></span><span class="keyword" id="3350567">func</span>&nbsp;<span class="ident" id="3350572">LookupPort</span><span class="op" id="3350582">(</span><span class="ident" id="3350583">network</span><span class="op" id="3350590">,</span>&nbsp;<span class="ident" id="3350592">service</span>&nbsp;<span class="builtintype" id="3350600">string</span><span class="op" id="3350606">)</span>&nbsp;<span class="op" id="3350608">(</span><span class="ident" id="3350609">port</span>&nbsp;<span class="builtintype" id="3350614">int</span><span class="op" id="3350617">,</span>&nbsp;<span class="ident" id="3350619">err</span>&nbsp;<span class="builtintype" id="3350623">error</span><span class="op" id="3350628">)</span>&nbsp;<span class="op" id="3350630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350633">return</span>&nbsp;<span class="ident" id="3350640">lookupPort</span><span class="op" id="3350650">(</span><span class="ident" id="3350651">network</span><span class="op" id="3350658">,</span>&nbsp;<span class="ident" id="3350660">service</span><span class="op" id="3350667">)</span><br>
<span class="lineno">100</span><span class="op" id="3350669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3350672">//&nbsp;LookupCNAME&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;DNS&nbsp;host&nbsp;for&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3350738">//&nbsp;Callers&nbsp;that&nbsp;do&nbsp;not&nbsp;care&nbsp;about&nbsp;the&nbsp;canonical&nbsp;name&nbsp;can&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3350800">//&nbsp;LookupHost&nbsp;or&nbsp;LookupIP&nbsp;directly;&nbsp;both&nbsp;take&nbsp;care&nbsp;of&nbsp;resolving</span><br>
<span class="lineno">105</span><span class="comment" id="3350864">//&nbsp;the&nbsp;canonical&nbsp;name&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;lookup.</span><br>
<span class="lineno"></span><span class="keyword" id="3350909">func</span>&nbsp;<span class="ident" id="3350914">LookupCNAME</span><span class="op" id="3350925">(</span><span class="ident" id="3350926">name</span>&nbsp;<span class="builtintype" id="3350931">string</span><span class="op" id="3350937">)</span>&nbsp;<span class="op" id="3350939">(</span><span class="ident" id="3350940">cname</span>&nbsp;<span class="builtintype" id="3350946">string</span><span class="op" id="3350952">,</span>&nbsp;<span class="ident" id="3350954">err</span>&nbsp;<span class="builtintype" id="3350958">error</span><span class="op" id="3350963">)</span>&nbsp;<span class="op" id="3350965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3350968">return</span>&nbsp;<span class="ident" id="3350975">lookupCNAME</span><span class="op" id="3350986">(</span><span class="ident" id="3350987">name</span><span class="op" id="3350991">)</span><br>
<span class="lineno"></span><span class="op" id="3350993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3350996">//&nbsp;LookupSRV&nbsp;tries&nbsp;to&nbsp;resolve&nbsp;an&nbsp;SRV&nbsp;query&nbsp;of&nbsp;the&nbsp;given&nbsp;service,</span><br>
<span class="lineno"></span><span class="comment" id="3351061">//&nbsp;protocol,&nbsp;and&nbsp;domain&nbsp;name.&nbsp;&nbsp;The&nbsp;proto&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;or&nbsp;&#34;udp&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3351121">//&nbsp;The&nbsp;returned&nbsp;records&nbsp;are&nbsp;sorted&nbsp;by&nbsp;priority&nbsp;and&nbsp;randomized</span><br>
<span class="lineno"></span><span class="comment" id="3351183">//&nbsp;by&nbsp;weight&nbsp;within&nbsp;a&nbsp;priority.</span><br>
<span class="lineno"></span><span class="comment" id="3351215">//</span><br>
<span class="lineno">115</span><span class="comment" id="3351218">//&nbsp;LookupSRV&nbsp;constructs&nbsp;the&nbsp;DNS&nbsp;name&nbsp;to&nbsp;look&nbsp;up&nbsp;following&nbsp;RFC&nbsp;2782.</span><br>
<span class="lineno"></span><span class="comment" id="3351286">//&nbsp;That&nbsp;is,&nbsp;it&nbsp;looks&nbsp;up&nbsp;_service._proto.name.&nbsp;&nbsp;To&nbsp;accommodate&nbsp;services</span><br>
<span class="lineno"></span><span class="comment" id="3351357">//&nbsp;publishing&nbsp;SRV&nbsp;records&nbsp;under&nbsp;non-standard&nbsp;names,&nbsp;if&nbsp;both&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3351425">//&nbsp;and&nbsp;proto&nbsp;are&nbsp;empty&nbsp;strings,&nbsp;LookupSRV&nbsp;looks&nbsp;up&nbsp;name&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3351491">func</span>&nbsp;<span class="ident" id="3351496">LookupSRV</span><span class="op" id="3351505">(</span><span class="ident" id="3351506">service</span><span class="op" id="3351513">,</span>&nbsp;<span class="ident" id="3351515">proto</span><span class="op" id="3351520">,</span>&nbsp;<span class="ident" id="3351522">name</span>&nbsp;<span class="builtintype" id="3351527">string</span><span class="op" id="3351533">)</span>&nbsp;<span class="op" id="3351535">(</span><span class="ident" id="3351536">cname</span>&nbsp;<span class="builtintype" id="3351542">string</span><span class="op" id="3351548">,</span>&nbsp;<span class="ident" id="3351550">addrs</span>&nbsp;<span class="op" id="3351556">[</span><span class="op" id="3351557">]</span><span class="op" id="3351558">*</span><span class="ident" id="3351559">SRV</span><span class="op" id="3351562">,</span>&nbsp;<span class="ident" id="3351564">err</span>&nbsp;<span class="builtintype" id="3351568">error</span><span class="op" id="3351573">)</span>&nbsp;<span class="op" id="3351575">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351578">return</span>&nbsp;<span class="ident" id="3351585">lookupSRV</span><span class="op" id="3351594">(</span><span class="ident" id="3351595">service</span><span class="op" id="3351602">,</span>&nbsp;<span class="ident" id="3351604">proto</span><span class="op" id="3351609">,</span>&nbsp;<span class="ident" id="3351611">name</span><span class="op" id="3351615">)</span><br>
<span class="lineno"></span><span class="op" id="3351617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351620">//&nbsp;LookupMX&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;MX&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name&nbsp;sorted&nbsp;by&nbsp;preference.</span><br>
<span class="lineno"></span><span class="keyword" id="3351707">func</span>&nbsp;<span class="ident" id="3351712">LookupMX</span><span class="op" id="3351720">(</span><span class="ident" id="3351721">name</span>&nbsp;<span class="builtintype" id="3351726">string</span><span class="op" id="3351732">)</span>&nbsp;<span class="op" id="3351734">(</span><span class="ident" id="3351735">mx</span>&nbsp;<span class="op" id="3351738">[</span><span class="op" id="3351739">]</span><span class="op" id="3351740">*</span><span class="ident" id="3351741">MX</span><span class="op" id="3351743">,</span>&nbsp;<span class="ident" id="3351745">err</span>&nbsp;<span class="builtintype" id="3351749">error</span><span class="op" id="3351754">)</span>&nbsp;<span class="op" id="3351756">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351759">return</span>&nbsp;<span class="ident" id="3351766">lookupMX</span><span class="op" id="3351774">(</span><span class="ident" id="3351775">name</span><span class="op" id="3351779">)</span><br>
<span class="lineno"></span><span class="op" id="3351781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351784">//&nbsp;LookupNS&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;NS&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3351850">func</span>&nbsp;<span class="ident" id="3351855">LookupNS</span><span class="op" id="3351863">(</span><span class="ident" id="3351864">name</span>&nbsp;<span class="builtintype" id="3351869">string</span><span class="op" id="3351875">)</span>&nbsp;<span class="op" id="3351877">(</span><span class="ident" id="3351878">ns</span>&nbsp;<span class="op" id="3351881">[</span><span class="op" id="3351882">]</span><span class="op" id="3351883">*</span><span class="ident" id="3351884">NS</span><span class="op" id="3351886">,</span>&nbsp;<span class="ident" id="3351888">err</span>&nbsp;<span class="builtintype" id="3351892">error</span><span class="op" id="3351897">)</span>&nbsp;<span class="op" id="3351899">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3351902">return</span>&nbsp;<span class="ident" id="3351909">lookupNS</span><span class="op" id="3351917">(</span><span class="ident" id="3351918">name</span><span class="op" id="3351922">)</span><br>
<span class="lineno"></span><span class="op" id="3351924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3351927">//&nbsp;LookupTXT&nbsp;returns&nbsp;the&nbsp;DNS&nbsp;TXT&nbsp;records&nbsp;for&nbsp;the&nbsp;given&nbsp;domain&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3351995">func</span>&nbsp;<span class="ident" id="3352000">LookupTXT</span><span class="op" id="3352009">(</span><span class="ident" id="3352010">name</span>&nbsp;<span class="builtintype" id="3352015">string</span><span class="op" id="3352021">)</span>&nbsp;<span class="op" id="3352023">(</span><span class="ident" id="3352024">txt</span>&nbsp;<span class="op" id="3352028">[</span><span class="op" id="3352029">]</span><span class="builtintype" id="3352030">string</span><span class="op" id="3352036">,</span>&nbsp;<span class="ident" id="3352038">err</span>&nbsp;<span class="builtintype" id="3352042">error</span><span class="op" id="3352047">)</span>&nbsp;<span class="op" id="3352049">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352052">return</span>&nbsp;<span class="ident" id="3352059">lookupTXT</span><span class="op" id="3352068">(</span><span class="ident" id="3352069">name</span><span class="op" id="3352073">)</span><br>
<span class="lineno"></span><span class="op" id="3352075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3352078">//&nbsp;LookupAddr&nbsp;performs&nbsp;a&nbsp;reverse&nbsp;lookup&nbsp;for&nbsp;the&nbsp;given&nbsp;address,&nbsp;returning&nbsp;a&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3352158">//&nbsp;of&nbsp;names&nbsp;mapping&nbsp;to&nbsp;that&nbsp;address.</span><br>
<span class="lineno">140</span><span class="keyword" id="3352195">func</span>&nbsp;<span class="ident" id="3352200">LookupAddr</span><span class="op" id="3352210">(</span><span class="ident" id="3352211">addr</span>&nbsp;<span class="builtintype" id="3352216">string</span><span class="op" id="3352222">)</span>&nbsp;<span class="op" id="3352224">(</span><span class="ident" id="3352225">name</span>&nbsp;<span class="op" id="3352230">[</span><span class="op" id="3352231">]</span><span class="builtintype" id="3352232">string</span><span class="op" id="3352238">,</span>&nbsp;<span class="ident" id="3352240">err</span>&nbsp;<span class="builtintype" id="3352244">error</span><span class="op" id="3352249">)</span>&nbsp;<span class="op" id="3352251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3352254">return</span>&nbsp;<span class="ident" id="3352261">lookupAddr</span><span class="op" id="3352271">(</span><span class="ident" id="3352272">addr</span><span class="op" id="3352276">)</span><br>
<span class="lineno"></span><span class="op" id="3352278">}</span>
</div>
</body>
</html>
