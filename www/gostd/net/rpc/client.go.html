<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5852984">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5853039">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5853093">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5853144">package</span>&nbsp;<span class="ident" id="5853152">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5853157">import</span>&nbsp;<span class="op" id="5853164">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853167">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853176">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853192">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853202">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853208">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853215">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853222">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5853234">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5853241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5853244">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5853307">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5853349">type</span>&nbsp;<span class="ident" id="5853354">ServerError</span>&nbsp;<span class="builtintype" id="5853366">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5853374">func</span>&nbsp;<span class="op" id="5853379">(</span><span class="ident" id="5853380">e</span>&nbsp;<span class="ident" id="5853382">ServerError</span><span class="op" id="5853393">)</span>&nbsp;<span class="ident" id="5853395">Error</span><span class="op" id="5853400">(</span><span class="op" id="5853401">)</span>&nbsp;<span class="builtintype" id="5853403">string</span>&nbsp;<span class="op" id="5853410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853413">return</span>&nbsp;<span class="builtintype" id="5853420">string</span><span class="op" id="5853426">(</span><span class="ident" id="5853427">e</span><span class="op" id="5853428">)</span><br>
<span class="lineno"></span><span class="op" id="5853430">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5853433">var</span>&nbsp;<span class="ident" id="5853437">ErrShutdown</span>&nbsp;<span class="op" id="5853449">=</span>&nbsp;<span class="ident" id="5853451">errors</span><span class="op" id="5853457">.</span><span class="ident" id="5853458">New</span><span class="op" id="5853461">(</span><span class="string" id="5853462">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5853487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5853490">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5853524">type</span>&nbsp;<span class="ident" id="5853529">Call</span>&nbsp;<span class="keyword" id="5853534">struct</span>&nbsp;<span class="op" id="5853541">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853544">ServiceMethod</span>&nbsp;<span class="builtintype" id="5853558">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853570">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853618">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853632">interface</span><span class="op" id="5853641">{</span><span class="op" id="5853642">}</span>&nbsp;<span class="comment" id="5853644">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853688">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853702">interface</span><span class="op" id="5853711">{</span><span class="op" id="5853712">}</span>&nbsp;<span class="comment" id="5853714">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853757">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5853771">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853783">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853823">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853837">chan</span>&nbsp;<span class="op" id="5853842">*</span><span class="ident" id="5853843">Call</span>&nbsp;&nbsp;<span class="comment" id="5853849">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5853883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5853886">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5853922">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5853976">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5854029">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5854068">type</span>&nbsp;<span class="ident" id="5854073">Client</span>&nbsp;<span class="keyword" id="5854080">struct</span>&nbsp;<span class="op" id="5854087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854090">codec</span>&nbsp;<span class="ident" id="5854096">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854110">reqMutex</span>&nbsp;<span class="ident" id="5854119">sync</span><span class="op" id="5854123">.</span><span class="ident" id="5854124">Mutex</span>&nbsp;<span class="comment" id="5854130">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854153">request</span>&nbsp;&nbsp;<span class="ident" id="5854162">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854172">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854181">sync</span><span class="op" id="5854185">.</span><span class="ident" id="5854186">Mutex</span>&nbsp;<span class="comment" id="5854192">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854215">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854224">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854232">pending</span>&nbsp;&nbsp;<span class="keyword" id="5854241">map</span><span class="op" id="5854244">[</span><span class="ident" id="5854245">uint64</span><span class="op" id="5854251">]</span><span class="op" id="5854252">*</span><span class="ident" id="5854253">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854259">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5854268">bool</span>&nbsp;<span class="comment" id="5854273">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854299">shutdown</span>&nbsp;<span class="builtintype" id="5854308">bool</span>&nbsp;<span class="comment" id="5854313">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5854343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5854346">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5854402">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5854469">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5854539">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5854601">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5854670">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5854727">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5854793">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5854807">type</span>&nbsp;<span class="ident" id="5854812">ClientCodec</span>&nbsp;<span class="keyword" id="5854824">interface</span>&nbsp;<span class="op" id="5854834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854837">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854910">WriteRequest</span><span class="op" id="5854922">(</span><span class="op" id="5854923">*</span><span class="ident" id="5854924">Request</span><span class="op" id="5854931">,</span>&nbsp;<span class="keyword" id="5854933">interface</span><span class="op" id="5854942">{</span><span class="op" id="5854943">}</span><span class="op" id="5854944">)</span>&nbsp;<span class="builtintype" id="5854946">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854953">ReadResponseHeader</span><span class="op" id="5854971">(</span><span class="op" id="5854972">*</span><span class="ident" id="5854973">Response</span><span class="op" id="5854981">)</span>&nbsp;<span class="builtintype" id="5854983">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854990">ReadResponseBody</span><span class="op" id="5855006">(</span><span class="keyword" id="5855007">interface</span><span class="op" id="5855016">{</span><span class="op" id="5855017">}</span><span class="op" id="5855018">)</span>&nbsp;<span class="builtintype" id="5855020">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855028">Close</span><span class="op" id="5855033">(</span><span class="op" id="5855034">)</span>&nbsp;<span class="builtintype" id="5855036">error</span><br>
<span class="lineno"></span><span class="op" id="5855042">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5855045">func</span>&nbsp;<span class="op" id="5855050">(</span><span class="ident" id="5855051">client</span>&nbsp;<span class="op" id="5855058">*</span><span class="ident" id="5855059">Client</span><span class="op" id="5855065">)</span>&nbsp;<span class="ident" id="5855067">send</span><span class="op" id="5855071">(</span><span class="ident" id="5855072">call</span>&nbsp;<span class="op" id="5855077">*</span><span class="ident" id="5855078">Call</span><span class="op" id="5855082">)</span>&nbsp;<span class="op" id="5855084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855087">client</span><span class="op" id="5855093">.</span><span class="ident" id="5855094">reqMutex</span><span class="op" id="5855102">.</span><span class="ident" id="5855103">Lock</span><span class="op" id="5855107">(</span><span class="op" id="5855108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855111">defer</span>&nbsp;<span class="ident" id="5855117">client</span><span class="op" id="5855123">.</span><span class="ident" id="5855124">reqMutex</span><span class="op" id="5855132">.</span><span class="ident" id="5855133">Unlock</span><span class="op" id="5855139">(</span><span class="op" id="5855140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855144">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855168">client</span><span class="op" id="5855174">.</span><span class="ident" id="5855175">mutex</span><span class="op" id="5855180">.</span><span class="ident" id="5855181">Lock</span><span class="op" id="5855185">(</span><span class="op" id="5855186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855189">if</span>&nbsp;<span class="ident" id="5855192">client</span><span class="op" id="5855198">.</span><span class="ident" id="5855199">shutdown</span>&nbsp;<span class="op" id="5855208">||</span>&nbsp;<span class="ident" id="5855211">client</span><span class="op" id="5855217">.</span><span class="ident" id="5855218">closing</span>&nbsp;<span class="op" id="5855226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855230">call</span><span class="op" id="5855234">.</span><span class="ident" id="5855235">Error</span>&nbsp;<span class="op" id="5855241">=</span>&nbsp;<span class="ident" id="5855243">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855257">client</span><span class="op" id="5855263">.</span><span class="ident" id="5855264">mutex</span><span class="op" id="5855269">.</span><span class="ident" id="5855270">Unlock</span><span class="op" id="5855276">(</span><span class="op" id="5855277">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855281">call</span><span class="op" id="5855285">.</span><span class="ident" id="5855286">done</span><span class="op" id="5855290">(</span><span class="op" id="5855291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855295">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855306">seq</span>&nbsp;<span class="op" id="5855310">:=</span>&nbsp;<span class="ident" id="5855313">client</span><span class="op" id="5855319">.</span><span class="ident" id="5855320">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855325">client</span><span class="op" id="5855331">.</span><span class="ident" id="5855332">seq</span><span class="op" id="5855335">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855339">client</span><span class="op" id="5855345">.</span><span class="ident" id="5855346">pending</span><span class="op" id="5855353">[</span><span class="ident" id="5855354">seq</span><span class="op" id="5855357">]</span>&nbsp;<span class="op" id="5855359">=</span>&nbsp;<span class="ident" id="5855361">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855367">client</span><span class="op" id="5855373">.</span><span class="ident" id="5855374">mutex</span><span class="op" id="5855379">.</span><span class="ident" id="5855380">Unlock</span><span class="op" id="5855386">(</span><span class="op" id="5855387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855391">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855424">client</span><span class="op" id="5855430">.</span><span class="ident" id="5855431">request</span><span class="op" id="5855438">.</span><span class="ident" id="5855439">Seq</span>&nbsp;<span class="op" id="5855443">=</span>&nbsp;<span class="ident" id="5855445">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855450">client</span><span class="op" id="5855456">.</span><span class="ident" id="5855457">request</span><span class="op" id="5855464">.</span><span class="ident" id="5855465">ServiceMethod</span>&nbsp;<span class="op" id="5855479">=</span>&nbsp;<span class="ident" id="5855481">call</span><span class="op" id="5855485">.</span><span class="ident" id="5855486">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855501">err</span>&nbsp;<span class="op" id="5855505">:=</span>&nbsp;<span class="ident" id="5855508">client</span><span class="op" id="5855514">.</span><span class="ident" id="5855515">codec</span><span class="op" id="5855520">.</span><span class="ident" id="5855521">WriteRequest</span><span class="op" id="5855533">(</span><span class="op" id="5855534">&amp;</span><span class="ident" id="5855535">client</span><span class="op" id="5855541">.</span><span class="ident" id="5855542">request</span><span class="op" id="5855549">,</span>&nbsp;<span class="ident" id="5855551">call</span><span class="op" id="5855555">.</span><span class="ident" id="5855556">Args</span><span class="op" id="5855560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855563">if</span>&nbsp;<span class="ident" id="5855566">err</span>&nbsp;<span class="op" id="5855570">!=</span>&nbsp;<span class="ident" id="5855573">nil</span>&nbsp;<span class="op" id="5855577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855581">client</span><span class="op" id="5855587">.</span><span class="ident" id="5855588">mutex</span><span class="op" id="5855593">.</span><span class="ident" id="5855594">Lock</span><span class="op" id="5855598">(</span><span class="op" id="5855599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855603">call</span>&nbsp;<span class="op" id="5855608">=</span>&nbsp;<span class="ident" id="5855610">client</span><span class="op" id="5855616">.</span><span class="ident" id="5855617">pending</span><span class="op" id="5855624">[</span><span class="ident" id="5855625">seq</span><span class="op" id="5855628">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5855632">delete</span><span class="op" id="5855638">(</span><span class="ident" id="5855639">client</span><span class="op" id="5855645">.</span><span class="ident" id="5855646">pending</span><span class="op" id="5855653">,</span>&nbsp;<span class="ident" id="5855655">seq</span><span class="op" id="5855658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855662">client</span><span class="op" id="5855668">.</span><span class="ident" id="5855669">mutex</span><span class="op" id="5855674">.</span><span class="ident" id="5855675">Unlock</span><span class="op" id="5855681">(</span><span class="op" id="5855682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855686">if</span>&nbsp;<span class="ident" id="5855689">call</span>&nbsp;<span class="op" id="5855694">!=</span>&nbsp;<span class="ident" id="5855697">nil</span>&nbsp;<span class="op" id="5855701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855706">call</span><span class="op" id="5855710">.</span><span class="ident" id="5855711">Error</span>&nbsp;<span class="op" id="5855717">=</span>&nbsp;<span class="ident" id="5855719">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855726">call</span><span class="op" id="5855730">.</span><span class="ident" id="5855731">done</span><span class="op" id="5855735">(</span><span class="op" id="5855736">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855743">}</span><br>
<span class="lineno"></span><span class="op" id="5855745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5855748">func</span>&nbsp;<span class="op" id="5855753">(</span><span class="ident" id="5855754">client</span>&nbsp;<span class="op" id="5855761">*</span><span class="ident" id="5855762">Client</span><span class="op" id="5855768">)</span>&nbsp;<span class="ident" id="5855770">input</span><span class="op" id="5855775">(</span><span class="op" id="5855776">)</span>&nbsp;<span class="op" id="5855778">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855781">var</span>&nbsp;<span class="ident" id="5855785">err</span>&nbsp;<span class="builtintype" id="5855789">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855796">var</span>&nbsp;<span class="ident" id="5855800">response</span>&nbsp;<span class="ident" id="5855809">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855819">for</span>&nbsp;<span class="ident" id="5855823">err</span>&nbsp;<span class="op" id="5855827">==</span>&nbsp;<span class="ident" id="5855830">nil</span>&nbsp;<span class="op" id="5855834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855838">response</span>&nbsp;<span class="op" id="5855847">=</span>&nbsp;<span class="ident" id="5855849">Response</span><span class="op" id="5855857">{</span><span class="op" id="5855858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855862">err</span>&nbsp;<span class="op" id="5855866">=</span>&nbsp;<span class="ident" id="5855868">client</span><span class="op" id="5855874">.</span><span class="ident" id="5855875">codec</span><span class="op" id="5855880">.</span><span class="ident" id="5855881">ReadResponseHeader</span><span class="op" id="5855899">(</span><span class="op" id="5855900">&amp;</span><span class="ident" id="5855901">response</span><span class="op" id="5855909">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855913">if</span>&nbsp;<span class="ident" id="5855916">err</span>&nbsp;<span class="op" id="5855920">!=</span>&nbsp;<span class="ident" id="5855923">nil</span>&nbsp;<span class="op" id="5855927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855932">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855944">seq</span>&nbsp;<span class="op" id="5855948">:=</span>&nbsp;<span class="ident" id="5855951">response</span><span class="op" id="5855959">.</span><span class="ident" id="5855960">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855966">client</span><span class="op" id="5855972">.</span><span class="ident" id="5855973">mutex</span><span class="op" id="5855978">.</span><span class="ident" id="5855979">Lock</span><span class="op" id="5855983">(</span><span class="op" id="5855984">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855988">call</span>&nbsp;<span class="op" id="5855993">:=</span>&nbsp;<span class="ident" id="5855996">client</span><span class="op" id="5856002">.</span><span class="ident" id="5856003">pending</span><span class="op" id="5856010">[</span><span class="ident" id="5856011">seq</span><span class="op" id="5856014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5856018">delete</span><span class="op" id="5856024">(</span><span class="ident" id="5856025">client</span><span class="op" id="5856031">.</span><span class="ident" id="5856032">pending</span><span class="op" id="5856039">,</span>&nbsp;<span class="ident" id="5856041">seq</span><span class="op" id="5856044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856048">client</span><span class="op" id="5856054">.</span><span class="ident" id="5856055">mutex</span><span class="op" id="5856060">.</span><span class="ident" id="5856061">Unlock</span><span class="op" id="5856067">(</span><span class="op" id="5856068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856073">switch</span>&nbsp;<span class="op" id="5856080">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856084">case</span>&nbsp;<span class="ident" id="5856089">call</span>&nbsp;<span class="op" id="5856094">==</span>&nbsp;<span class="ident" id="5856097">nil</span><span class="op" id="5856100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856105">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856162">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856220">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856276">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856334">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856394">err</span>&nbsp;<span class="op" id="5856398">=</span>&nbsp;<span class="ident" id="5856400">client</span><span class="op" id="5856406">.</span><span class="ident" id="5856407">codec</span><span class="op" id="5856412">.</span><span class="ident" id="5856413">ReadResponseBody</span><span class="op" id="5856429">(</span><span class="ident" id="5856430">nil</span><span class="op" id="5856433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856438">if</span>&nbsp;<span class="ident" id="5856441">err</span>&nbsp;<span class="op" id="5856445">!=</span>&nbsp;<span class="ident" id="5856448">nil</span>&nbsp;<span class="op" id="5856452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856458">err</span>&nbsp;<span class="op" id="5856462">=</span>&nbsp;<span class="ident" id="5856464">errors</span><span class="op" id="5856470">.</span><span class="ident" id="5856471">New</span><span class="op" id="5856474">(</span><span class="string" id="5856475">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5856498">+</span>&nbsp;<span class="ident" id="5856500">err</span><span class="op" id="5856503">.</span><span class="ident" id="5856504">Error</span><span class="op" id="5856509">(</span><span class="op" id="5856510">)</span><span class="op" id="5856511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856516">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856520">case</span>&nbsp;<span class="ident" id="5856525">response</span><span class="op" id="5856533">.</span><span class="ident" id="5856534">Error</span>&nbsp;<span class="op" id="5856540">!=</span>&nbsp;<span class="string" id="5856543">&#34;&#34;</span><span class="op" id="5856545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856550">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856611">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856671">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856700">call</span><span class="op" id="5856704">.</span><span class="ident" id="5856705">Error</span>&nbsp;<span class="op" id="5856711">=</span>&nbsp;<span class="ident" id="5856713">ServerError</span><span class="op" id="5856724">(</span><span class="ident" id="5856725">response</span><span class="op" id="5856733">.</span><span class="ident" id="5856734">Error</span><span class="op" id="5856739">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856744">err</span>&nbsp;<span class="op" id="5856748">=</span>&nbsp;<span class="ident" id="5856750">client</span><span class="op" id="5856756">.</span><span class="ident" id="5856757">codec</span><span class="op" id="5856762">.</span><span class="ident" id="5856763">ReadResponseBody</span><span class="op" id="5856779">(</span><span class="ident" id="5856780">nil</span><span class="op" id="5856783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856788">if</span>&nbsp;<span class="ident" id="5856791">err</span>&nbsp;<span class="op" id="5856795">!=</span>&nbsp;<span class="ident" id="5856798">nil</span>&nbsp;<span class="op" id="5856802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856808">err</span>&nbsp;<span class="op" id="5856812">=</span>&nbsp;<span class="ident" id="5856814">errors</span><span class="op" id="5856820">.</span><span class="ident" id="5856821">New</span><span class="op" id="5856824">(</span><span class="string" id="5856825">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5856848">+</span>&nbsp;<span class="ident" id="5856850">err</span><span class="op" id="5856853">.</span><span class="ident" id="5856854">Error</span><span class="op" id="5856859">(</span><span class="op" id="5856860">)</span><span class="op" id="5856861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856871">call</span><span class="op" id="5856875">.</span><span class="ident" id="5856876">done</span><span class="op" id="5856880">(</span><span class="op" id="5856881">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856885">default</span><span class="op" id="5856892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856897">err</span>&nbsp;<span class="op" id="5856901">=</span>&nbsp;<span class="ident" id="5856903">client</span><span class="op" id="5856909">.</span><span class="ident" id="5856910">codec</span><span class="op" id="5856915">.</span><span class="ident" id="5856916">ReadResponseBody</span><span class="op" id="5856932">(</span><span class="ident" id="5856933">call</span><span class="op" id="5856937">.</span><span class="ident" id="5856938">Reply</span><span class="op" id="5856943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856948">if</span>&nbsp;<span class="ident" id="5856951">err</span>&nbsp;<span class="op" id="5856955">!=</span>&nbsp;<span class="ident" id="5856958">nil</span>&nbsp;<span class="op" id="5856962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856968">call</span><span class="op" id="5856972">.</span><span class="ident" id="5856973">Error</span>&nbsp;<span class="op" id="5856979">=</span>&nbsp;<span class="ident" id="5856981">errors</span><span class="op" id="5856987">.</span><span class="ident" id="5856988">New</span><span class="op" id="5856991">(</span><span class="string" id="5856992">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5857008">+</span>&nbsp;<span class="ident" id="5857010">err</span><span class="op" id="5857013">.</span><span class="ident" id="5857014">Error</span><span class="op" id="5857019">(</span><span class="op" id="5857020">)</span><span class="op" id="5857021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857026">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857031">call</span><span class="op" id="5857035">.</span><span class="ident" id="5857036">done</span><span class="op" id="5857040">(</span><span class="op" id="5857041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857051">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857080">client</span><span class="op" id="5857086">.</span><span class="ident" id="5857087">reqMutex</span><span class="op" id="5857095">.</span><span class="ident" id="5857096">Lock</span><span class="op" id="5857100">(</span><span class="op" id="5857101">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857104">client</span><span class="op" id="5857110">.</span><span class="ident" id="5857111">mutex</span><span class="op" id="5857116">.</span><span class="ident" id="5857117">Lock</span><span class="op" id="5857121">(</span><span class="op" id="5857122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857125">client</span><span class="op" id="5857131">.</span><span class="ident" id="5857132">shutdown</span>&nbsp;<span class="op" id="5857141">=</span>&nbsp;<span class="builtintype" id="5857143">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857149">closing</span>&nbsp;<span class="op" id="5857157">:=</span>&nbsp;<span class="ident" id="5857160">client</span><span class="op" id="5857166">.</span><span class="ident" id="5857167">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857176">if</span>&nbsp;<span class="ident" id="5857179">err</span>&nbsp;<span class="op" id="5857183">==</span>&nbsp;<span class="ident" id="5857186">io</span><span class="op" id="5857188">.</span><span class="ident" id="5857189">EOF</span>&nbsp;<span class="op" id="5857193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857197">if</span>&nbsp;<span class="ident" id="5857200">closing</span>&nbsp;<span class="op" id="5857208">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857213">err</span>&nbsp;<span class="op" id="5857217">=</span>&nbsp;<span class="ident" id="5857219">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857233">}</span>&nbsp;<span class="keyword" id="5857235">else</span>&nbsp;<span class="op" id="5857240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857245">err</span>&nbsp;<span class="op" id="5857249">=</span>&nbsp;<span class="ident" id="5857251">io</span><span class="op" id="5857253">.</span><span class="ident" id="5857254">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857276">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857279">for</span>&nbsp;<span class="ident" id="5857283">_</span><span class="op" id="5857284">,</span>&nbsp;<span class="ident" id="5857286">call</span>&nbsp;<span class="op" id="5857291">:=</span>&nbsp;<span class="keyword" id="5857294">range</span>&nbsp;<span class="ident" id="5857300">client</span><span class="op" id="5857306">.</span><span class="ident" id="5857307">pending</span>&nbsp;<span class="op" id="5857315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857319">call</span><span class="op" id="5857323">.</span><span class="ident" id="5857324">Error</span>&nbsp;<span class="op" id="5857330">=</span>&nbsp;<span class="ident" id="5857332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857338">call</span><span class="op" id="5857342">.</span><span class="ident" id="5857343">done</span><span class="op" id="5857347">(</span><span class="op" id="5857348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857354">client</span><span class="op" id="5857360">.</span><span class="ident" id="5857361">mutex</span><span class="op" id="5857366">.</span><span class="ident" id="5857367">Unlock</span><span class="op" id="5857373">(</span><span class="op" id="5857374">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857377">client</span><span class="op" id="5857383">.</span><span class="ident" id="5857384">reqMutex</span><span class="op" id="5857392">.</span><span class="ident" id="5857393">Unlock</span><span class="op" id="5857399">(</span><span class="op" id="5857400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857403">if</span>&nbsp;<span class="ident" id="5857406">debugLog</span>&nbsp;<span class="op" id="5857415">&amp;&amp;</span>&nbsp;<span class="ident" id="5857418">err</span>&nbsp;<span class="op" id="5857422">!=</span>&nbsp;<span class="ident" id="5857425">io</span><span class="op" id="5857427">.</span><span class="ident" id="5857428">EOF</span>&nbsp;<span class="op" id="5857432">&amp;&amp;</span>&nbsp;<span class="op" id="5857435">!</span><span class="ident" id="5857436">closing</span>&nbsp;<span class="op" id="5857444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857448">log</span><span class="op" id="5857451">.</span><span class="ident" id="5857452">Println</span><span class="op" id="5857459">(</span><span class="string" id="5857460">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5857489">,</span>&nbsp;<span class="ident" id="5857491">err</span><span class="op" id="5857494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857497">}</span><br>
<span class="lineno"></span><span class="op" id="5857499">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5857502">func</span>&nbsp;<span class="op" id="5857507">(</span><span class="ident" id="5857508">call</span>&nbsp;<span class="op" id="5857513">*</span><span class="ident" id="5857514">Call</span><span class="op" id="5857518">)</span>&nbsp;<span class="ident" id="5857520">done</span><span class="op" id="5857524">(</span><span class="op" id="5857525">)</span>&nbsp;<span class="op" id="5857527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857530">select</span>&nbsp;<span class="op" id="5857537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857540">case</span>&nbsp;<span class="ident" id="5857545">call</span><span class="op" id="5857549">.</span><span class="ident" id="5857550">Done</span>&nbsp;<span class="op" id="5857555">&lt;-</span>&nbsp;<span class="ident" id="5857558">call</span><span class="op" id="5857562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857566">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857573">default</span><span class="op" id="5857580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857584">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857661">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857729">if</span>&nbsp;<span class="ident" id="5857732">debugLog</span>&nbsp;<span class="op" id="5857741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857746">log</span><span class="op" id="5857749">.</span><span class="ident" id="5857750">Println</span><span class="op" id="5857757">(</span><span class="string" id="5857758">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5857825">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857832">}</span><br>
<span class="lineno"></span><span class="op" id="5857834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5857837">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5857897">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5857952">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5858011">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5858057">func</span>&nbsp;<span class="ident" id="5858062">NewClient</span><span class="op" id="5858071">(</span><span class="ident" id="5858072">conn</span>&nbsp;<span class="ident" id="5858077">io</span><span class="op" id="5858079">.</span><span class="ident" id="5858080">ReadWriteCloser</span><span class="op" id="5858095">)</span>&nbsp;<span class="op" id="5858097">*</span><span class="ident" id="5858098">Client</span>&nbsp;<span class="op" id="5858105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858108">encBuf</span>&nbsp;<span class="op" id="5858115">:=</span>&nbsp;<span class="ident" id="5858118">bufio</span><span class="op" id="5858123">.</span><span class="ident" id="5858124">NewWriter</span><span class="op" id="5858133">(</span><span class="ident" id="5858134">conn</span><span class="op" id="5858138">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858141">client</span>&nbsp;<span class="op" id="5858148">:=</span>&nbsp;<span class="op" id="5858151">&amp;</span><span class="ident" id="5858152">gobClientCodec</span><span class="op" id="5858166">{</span><span class="ident" id="5858167">conn</span><span class="op" id="5858171">,</span>&nbsp;<span class="ident" id="5858173">gob</span><span class="op" id="5858176">.</span><span class="ident" id="5858177">NewDecoder</span><span class="op" id="5858187">(</span><span class="ident" id="5858188">conn</span><span class="op" id="5858192">)</span><span class="op" id="5858193">,</span>&nbsp;<span class="ident" id="5858195">gob</span><span class="op" id="5858198">.</span><span class="ident" id="5858199">NewEncoder</span><span class="op" id="5858209">(</span><span class="ident" id="5858210">encBuf</span><span class="op" id="5858216">)</span><span class="op" id="5858217">,</span>&nbsp;<span class="ident" id="5858219">encBuf</span><span class="op" id="5858225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858228">return</span>&nbsp;<span class="ident" id="5858235">NewClientWithCodec</span><span class="op" id="5858253">(</span><span class="ident" id="5858254">client</span><span class="op" id="5858260">)</span><br>
<span class="lineno"></span><span class="op" id="5858262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858265">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5858328">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5858378">func</span>&nbsp;<span class="ident" id="5858383">NewClientWithCodec</span><span class="op" id="5858401">(</span><span class="ident" id="5858402">codec</span>&nbsp;<span class="ident" id="5858408">ClientCodec</span><span class="op" id="5858419">)</span>&nbsp;<span class="op" id="5858421">*</span><span class="ident" id="5858422">Client</span>&nbsp;<span class="op" id="5858429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858432">client</span>&nbsp;<span class="op" id="5858439">:=</span>&nbsp;<span class="op" id="5858442">&amp;</span><span class="ident" id="5858443">Client</span><span class="op" id="5858449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858453">codec</span><span class="op" id="5858458">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5858462">codec</span><span class="op" id="5858467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858471">pending</span><span class="op" id="5858478">:</span>&nbsp;<span class="builtinfunc" id="5858480">make</span><span class="op" id="5858484">(</span><span class="keyword" id="5858485">map</span><span class="op" id="5858488">[</span><span class="ident" id="5858489">uint64</span><span class="op" id="5858495">]</span><span class="op" id="5858496">*</span><span class="ident" id="5858497">Call</span><span class="op" id="5858501">)</span><span class="op" id="5858502">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858508">go</span>&nbsp;<span class="ident" id="5858511">client</span><span class="op" id="5858517">.</span><span class="ident" id="5858518">input</span><span class="op" id="5858523">(</span><span class="op" id="5858524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858527">return</span>&nbsp;<span class="ident" id="5858534">client</span><br>
<span class="lineno"></span><span class="op" id="5858541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5858544">type</span>&nbsp;<span class="ident" id="5858549">gobClientCodec</span>&nbsp;<span class="keyword" id="5858564">struct</span>&nbsp;<span class="op" id="5858571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858574">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858581">io</span><span class="op" id="5858583">.</span><span class="ident" id="5858584">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858601">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858608">*</span><span class="ident" id="5858609">gob</span><span class="op" id="5858612">.</span><span class="ident" id="5858613">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858622">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858629">*</span><span class="ident" id="5858630">gob</span><span class="op" id="5858633">.</span><span class="ident" id="5858634">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858643">encBuf</span>&nbsp;<span class="op" id="5858650">*</span><span class="ident" id="5858651">bufio</span><span class="op" id="5858656">.</span><span class="ident" id="5858657">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5858664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5858667">func</span>&nbsp;<span class="op" id="5858672">(</span><span class="ident" id="5858673">c</span>&nbsp;<span class="op" id="5858675">*</span><span class="ident" id="5858676">gobClientCodec</span><span class="op" id="5858690">)</span>&nbsp;<span class="ident" id="5858692">WriteRequest</span><span class="op" id="5858704">(</span><span class="ident" id="5858705">r</span>&nbsp;<span class="op" id="5858707">*</span><span class="ident" id="5858708">Request</span><span class="op" id="5858715">,</span>&nbsp;<span class="ident" id="5858717">body</span>&nbsp;<span class="keyword" id="5858722">interface</span><span class="op" id="5858731">{</span><span class="op" id="5858732">}</span><span class="op" id="5858733">)</span>&nbsp;<span class="op" id="5858735">(</span><span class="ident" id="5858736">err</span>&nbsp;<span class="builtintype" id="5858740">error</span><span class="op" id="5858745">)</span>&nbsp;<span class="op" id="5858747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858750">if</span>&nbsp;<span class="ident" id="5858753">err</span>&nbsp;<span class="op" id="5858757">=</span>&nbsp;<span class="ident" id="5858759">c</span><span class="op" id="5858760">.</span><span class="ident" id="5858761">enc</span><span class="op" id="5858764">.</span><span class="ident" id="5858765">Encode</span><span class="op" id="5858771">(</span><span class="ident" id="5858772">r</span><span class="op" id="5858773">)</span><span class="op" id="5858774">;</span>&nbsp;<span class="ident" id="5858776">err</span>&nbsp;<span class="op" id="5858780">!=</span>&nbsp;<span class="ident" id="5858783">nil</span>&nbsp;<span class="op" id="5858787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858791">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858802">if</span>&nbsp;<span class="ident" id="5858805">err</span>&nbsp;<span class="op" id="5858809">=</span>&nbsp;<span class="ident" id="5858811">c</span><span class="op" id="5858812">.</span><span class="ident" id="5858813">enc</span><span class="op" id="5858816">.</span><span class="ident" id="5858817">Encode</span><span class="op" id="5858823">(</span><span class="ident" id="5858824">body</span><span class="op" id="5858828">)</span><span class="op" id="5858829">;</span>&nbsp;<span class="ident" id="5858831">err</span>&nbsp;<span class="op" id="5858835">!=</span>&nbsp;<span class="ident" id="5858838">nil</span>&nbsp;<span class="op" id="5858842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858857">return</span>&nbsp;<span class="ident" id="5858864">c</span><span class="op" id="5858865">.</span><span class="ident" id="5858866">encBuf</span><span class="op" id="5858872">.</span><span class="ident" id="5858873">Flush</span><span class="op" id="5858878">(</span><span class="op" id="5858879">)</span><br>
<span class="lineno">220</span><span class="op" id="5858881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5858884">func</span>&nbsp;<span class="op" id="5858889">(</span><span class="ident" id="5858890">c</span>&nbsp;<span class="op" id="5858892">*</span><span class="ident" id="5858893">gobClientCodec</span><span class="op" id="5858907">)</span>&nbsp;<span class="ident" id="5858909">ReadResponseHeader</span><span class="op" id="5858927">(</span><span class="ident" id="5858928">r</span>&nbsp;<span class="op" id="5858930">*</span><span class="ident" id="5858931">Response</span><span class="op" id="5858939">)</span>&nbsp;<span class="builtintype" id="5858941">error</span>&nbsp;<span class="op" id="5858947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858950">return</span>&nbsp;<span class="ident" id="5858957">c</span><span class="op" id="5858958">.</span><span class="ident" id="5858959">dec</span><span class="op" id="5858962">.</span><span class="ident" id="5858963">Decode</span><span class="op" id="5858969">(</span><span class="ident" id="5858970">r</span><span class="op" id="5858971">)</span><br>
<span class="lineno"></span><span class="op" id="5858973">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5858976">func</span>&nbsp;<span class="op" id="5858981">(</span><span class="ident" id="5858982">c</span>&nbsp;<span class="op" id="5858984">*</span><span class="ident" id="5858985">gobClientCodec</span><span class="op" id="5858999">)</span>&nbsp;<span class="ident" id="5859001">ReadResponseBody</span><span class="op" id="5859017">(</span><span class="ident" id="5859018">body</span>&nbsp;<span class="keyword" id="5859023">interface</span><span class="op" id="5859032">{</span><span class="op" id="5859033">}</span><span class="op" id="5859034">)</span>&nbsp;<span class="builtintype" id="5859036">error</span>&nbsp;<span class="op" id="5859042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859045">return</span>&nbsp;<span class="ident" id="5859052">c</span><span class="op" id="5859053">.</span><span class="ident" id="5859054">dec</span><span class="op" id="5859057">.</span><span class="ident" id="5859058">Decode</span><span class="op" id="5859064">(</span><span class="ident" id="5859065">body</span><span class="op" id="5859069">)</span><br>
<span class="lineno"></span><span class="op" id="5859071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5859074">func</span>&nbsp;<span class="op" id="5859079">(</span><span class="ident" id="5859080">c</span>&nbsp;<span class="op" id="5859082">*</span><span class="ident" id="5859083">gobClientCodec</span><span class="op" id="5859097">)</span>&nbsp;<span class="ident" id="5859099">Close</span><span class="op" id="5859104">(</span><span class="op" id="5859105">)</span>&nbsp;<span class="builtintype" id="5859107">error</span>&nbsp;<span class="op" id="5859113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859116">return</span>&nbsp;<span class="ident" id="5859123">c</span><span class="op" id="5859124">.</span><span class="ident" id="5859125">rwc</span><span class="op" id="5859128">.</span><span class="ident" id="5859129">Close</span><span class="op" id="5859134">(</span><span class="op" id="5859135">)</span><br>
<span class="lineno"></span><span class="op" id="5859137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5859140">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5859216">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5859259">func</span>&nbsp;<span class="ident" id="5859264">DialHTTP</span><span class="op" id="5859272">(</span><span class="ident" id="5859273">network</span><span class="op" id="5859280">,</span>&nbsp;<span class="ident" id="5859282">address</span>&nbsp;<span class="builtintype" id="5859290">string</span><span class="op" id="5859296">)</span>&nbsp;<span class="op" id="5859298">(</span><span class="op" id="5859299">*</span><span class="ident" id="5859300">Client</span><span class="op" id="5859306">,</span>&nbsp;<span class="builtintype" id="5859308">error</span><span class="op" id="5859313">)</span>&nbsp;<span class="op" id="5859315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859318">return</span>&nbsp;<span class="ident" id="5859325">DialHTTPPath</span><span class="op" id="5859337">(</span><span class="ident" id="5859338">network</span><span class="op" id="5859345">,</span>&nbsp;<span class="ident" id="5859347">address</span><span class="op" id="5859354">,</span>&nbsp;<span class="ident" id="5859356">DefaultRPCPath</span><span class="op" id="5859370">)</span><br>
<span class="lineno"></span><span class="op" id="5859372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5859375">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5859422">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5859468">func</span>&nbsp;<span class="ident" id="5859473">DialHTTPPath</span><span class="op" id="5859485">(</span><span class="ident" id="5859486">network</span><span class="op" id="5859493">,</span>&nbsp;<span class="ident" id="5859495">address</span><span class="op" id="5859502">,</span>&nbsp;<span class="ident" id="5859504">path</span>&nbsp;<span class="builtintype" id="5859509">string</span><span class="op" id="5859515">)</span>&nbsp;<span class="op" id="5859517">(</span><span class="op" id="5859518">*</span><span class="ident" id="5859519">Client</span><span class="op" id="5859525">,</span>&nbsp;<span class="builtintype" id="5859527">error</span><span class="op" id="5859532">)</span>&nbsp;<span class="op" id="5859534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859537">var</span>&nbsp;<span class="ident" id="5859541">err</span>&nbsp;<span class="builtintype" id="5859545">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859552">conn</span><span class="op" id="5859556">,</span>&nbsp;<span class="ident" id="5859558">err</span>&nbsp;<span class="op" id="5859562">:=</span>&nbsp;<span class="ident" id="5859565">net</span><span class="op" id="5859568">.</span><span class="ident" id="5859569">Dial</span><span class="op" id="5859573">(</span><span class="ident" id="5859574">network</span><span class="op" id="5859581">,</span>&nbsp;<span class="ident" id="5859583">address</span><span class="op" id="5859590">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859593">if</span>&nbsp;<span class="ident" id="5859596">err</span>&nbsp;<span class="op" id="5859600">!=</span>&nbsp;<span class="ident" id="5859603">nil</span>&nbsp;<span class="op" id="5859607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859611">return</span>&nbsp;<span class="ident" id="5859618">nil</span><span class="op" id="5859621">,</span>&nbsp;<span class="ident" id="5859623">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859631">io</span><span class="op" id="5859633">.</span><span class="ident" id="5859634">WriteString</span><span class="op" id="5859645">(</span><span class="ident" id="5859646">conn</span><span class="op" id="5859650">,</span>&nbsp;<span class="string" id="5859652">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5859662">+</span><span class="ident" id="5859663">path</span><span class="op" id="5859667">+</span><span class="string" id="5859668">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5859683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859687">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859724">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859762">resp</span><span class="op" id="5859766">,</span>&nbsp;<span class="ident" id="5859768">err</span>&nbsp;<span class="op" id="5859772">:=</span>&nbsp;<span class="ident" id="5859775">http</span><span class="op" id="5859779">.</span><span class="ident" id="5859780">ReadResponse</span><span class="op" id="5859792">(</span><span class="ident" id="5859793">bufio</span><span class="op" id="5859798">.</span><span class="ident" id="5859799">NewReader</span><span class="op" id="5859808">(</span><span class="ident" id="5859809">conn</span><span class="op" id="5859813">)</span><span class="op" id="5859814">,</span>&nbsp;<span class="op" id="5859816">&amp;</span><span class="ident" id="5859817">http</span><span class="op" id="5859821">.</span><span class="ident" id="5859822">Request</span><span class="op" id="5859829">{</span><span class="ident" id="5859830">Method</span><span class="op" id="5859836">:</span>&nbsp;<span class="string" id="5859838">&#34;CONNECT&#34;</span><span class="op" id="5859847">}</span><span class="op" id="5859848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859851">if</span>&nbsp;<span class="ident" id="5859854">err</span>&nbsp;<span class="op" id="5859858">==</span>&nbsp;<span class="ident" id="5859861">nil</span>&nbsp;<span class="op" id="5859865">&amp;&amp;</span>&nbsp;<span class="ident" id="5859868">resp</span><span class="op" id="5859872">.</span><span class="ident" id="5859873">Status</span>&nbsp;<span class="op" id="5859880">==</span>&nbsp;<span class="ident" id="5859883">connected</span>&nbsp;<span class="op" id="5859893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859897">return</span>&nbsp;<span class="ident" id="5859904">NewClient</span><span class="op" id="5859913">(</span><span class="ident" id="5859914">conn</span><span class="op" id="5859918">)</span><span class="op" id="5859919">,</span>&nbsp;<span class="ident" id="5859921">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859929">if</span>&nbsp;<span class="ident" id="5859932">err</span>&nbsp;<span class="op" id="5859936">==</span>&nbsp;<span class="ident" id="5859939">nil</span>&nbsp;<span class="op" id="5859943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859947">err</span>&nbsp;<span class="op" id="5859951">=</span>&nbsp;<span class="ident" id="5859953">errors</span><span class="op" id="5859959">.</span><span class="ident" id="5859960">New</span><span class="op" id="5859963">(</span><span class="string" id="5859964">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5859993">+</span>&nbsp;<span class="ident" id="5859995">resp</span><span class="op" id="5859999">.</span><span class="ident" id="5860000">Status</span><span class="op" id="5860006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860012">conn</span><span class="op" id="5860016">.</span><span class="ident" id="5860017">Close</span><span class="op" id="5860022">(</span><span class="op" id="5860023">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860026">return</span>&nbsp;<span class="ident" id="5860033">nil</span><span class="op" id="5860036">,</span>&nbsp;<span class="op" id="5860038">&amp;</span><span class="ident" id="5860039">net</span><span class="op" id="5860042">.</span><span class="ident" id="5860043">OpError</span><span class="op" id="5860050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860054">Op</span><span class="op" id="5860056">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5860060">&#34;dial-http&#34;</span><span class="op" id="5860071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860075">Net</span><span class="op" id="5860078">:</span>&nbsp;&nbsp;<span class="ident" id="5860081">network</span>&nbsp;<span class="op" id="5860089">+</span>&nbsp;<span class="string" id="5860091">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5860095">+</span>&nbsp;<span class="ident" id="5860097">address</span><span class="op" id="5860104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860108">Addr</span><span class="op" id="5860112">:</span>&nbsp;<span class="ident" id="5860114">nil</span><span class="op" id="5860117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860121">Err</span><span class="op" id="5860124">:</span>&nbsp;&nbsp;<span class="ident" id="5860127">err</span><span class="op" id="5860130">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860133">}</span><br>
<span class="lineno"></span><span class="op" id="5860135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860138">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5860206">func</span>&nbsp;<span class="ident" id="5860211">Dial</span><span class="op" id="5860215">(</span><span class="ident" id="5860216">network</span><span class="op" id="5860223">,</span>&nbsp;<span class="ident" id="5860225">address</span>&nbsp;<span class="builtintype" id="5860233">string</span><span class="op" id="5860239">)</span>&nbsp;<span class="op" id="5860241">(</span><span class="op" id="5860242">*</span><span class="ident" id="5860243">Client</span><span class="op" id="5860249">,</span>&nbsp;<span class="builtintype" id="5860251">error</span><span class="op" id="5860256">)</span>&nbsp;<span class="op" id="5860258">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860261">conn</span><span class="op" id="5860265">,</span>&nbsp;<span class="ident" id="5860267">err</span>&nbsp;<span class="op" id="5860271">:=</span>&nbsp;<span class="ident" id="5860274">net</span><span class="op" id="5860277">.</span><span class="ident" id="5860278">Dial</span><span class="op" id="5860282">(</span><span class="ident" id="5860283">network</span><span class="op" id="5860290">,</span>&nbsp;<span class="ident" id="5860292">address</span><span class="op" id="5860299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860302">if</span>&nbsp;<span class="ident" id="5860305">err</span>&nbsp;<span class="op" id="5860309">!=</span>&nbsp;<span class="ident" id="5860312">nil</span>&nbsp;<span class="op" id="5860316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860320">return</span>&nbsp;<span class="ident" id="5860327">nil</span><span class="op" id="5860330">,</span>&nbsp;<span class="ident" id="5860332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860340">return</span>&nbsp;<span class="ident" id="5860347">NewClient</span><span class="op" id="5860356">(</span><span class="ident" id="5860357">conn</span><span class="op" id="5860361">)</span><span class="op" id="5860362">,</span>&nbsp;<span class="ident" id="5860364">nil</span><br>
<span class="lineno">275</span><span class="op" id="5860368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5860371">func</span>&nbsp;<span class="op" id="5860376">(</span><span class="ident" id="5860377">client</span>&nbsp;<span class="op" id="5860384">*</span><span class="ident" id="5860385">Client</span><span class="op" id="5860391">)</span>&nbsp;<span class="ident" id="5860393">Close</span><span class="op" id="5860398">(</span><span class="op" id="5860399">)</span>&nbsp;<span class="builtintype" id="5860401">error</span>&nbsp;<span class="op" id="5860407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860410">client</span><span class="op" id="5860416">.</span><span class="ident" id="5860417">mutex</span><span class="op" id="5860422">.</span><span class="ident" id="5860423">Lock</span><span class="op" id="5860427">(</span><span class="op" id="5860428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860431">if</span>&nbsp;<span class="ident" id="5860434">client</span><span class="op" id="5860440">.</span><span class="ident" id="5860441">closing</span>&nbsp;<span class="op" id="5860449">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860453">client</span><span class="op" id="5860459">.</span><span class="ident" id="5860460">mutex</span><span class="op" id="5860465">.</span><span class="ident" id="5860466">Unlock</span><span class="op" id="5860472">(</span><span class="op" id="5860473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860477">return</span>&nbsp;<span class="ident" id="5860484">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860500">client</span><span class="op" id="5860506">.</span><span class="ident" id="5860507">closing</span>&nbsp;<span class="op" id="5860515">=</span>&nbsp;<span class="builtintype" id="5860517">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860523">client</span><span class="op" id="5860529">.</span><span class="ident" id="5860530">mutex</span><span class="op" id="5860535">.</span><span class="ident" id="5860536">Unlock</span><span class="op" id="5860542">(</span><span class="op" id="5860543">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860546">return</span>&nbsp;<span class="ident" id="5860553">client</span><span class="op" id="5860559">.</span><span class="ident" id="5860560">codec</span><span class="op" id="5860565">.</span><span class="ident" id="5860566">Close</span><span class="op" id="5860571">(</span><span class="op" id="5860572">)</span><br>
<span class="lineno"></span><span class="op" id="5860574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860577">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5860664">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5860752">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5860826">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5860894">func</span>&nbsp;<span class="op" id="5860899">(</span><span class="ident" id="5860900">client</span>&nbsp;<span class="op" id="5860907">*</span><span class="ident" id="5860908">Client</span><span class="op" id="5860914">)</span>&nbsp;<span class="ident" id="5860916">Go</span><span class="op" id="5860918">(</span><span class="ident" id="5860919">serviceMethod</span>&nbsp;<span class="builtintype" id="5860933">string</span><span class="op" id="5860939">,</span>&nbsp;<span class="ident" id="5860941">args</span>&nbsp;<span class="keyword" id="5860946">interface</span><span class="op" id="5860955">{</span><span class="op" id="5860956">}</span><span class="op" id="5860957">,</span>&nbsp;<span class="ident" id="5860959">reply</span>&nbsp;<span class="keyword" id="5860965">interface</span><span class="op" id="5860974">{</span><span class="op" id="5860975">}</span><span class="op" id="5860976">,</span>&nbsp;<span class="ident" id="5860978">done</span>&nbsp;<span class="keyword" id="5860983">chan</span>&nbsp;<span class="op" id="5860988">*</span><span class="ident" id="5860989">Call</span><span class="op" id="5860993">)</span>&nbsp;<span class="op" id="5860995">*</span><span class="ident" id="5860996">Call</span>&nbsp;<span class="op" id="5861001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861004">call</span>&nbsp;<span class="op" id="5861009">:=</span>&nbsp;<span class="builtinfunc" id="5861012">new</span><span class="op" id="5861015">(</span><span class="ident" id="5861016">Call</span><span class="op" id="5861020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861023">call</span><span class="op" id="5861027">.</span><span class="ident" id="5861028">ServiceMethod</span>&nbsp;<span class="op" id="5861042">=</span>&nbsp;<span class="ident" id="5861044">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861059">call</span><span class="op" id="5861063">.</span><span class="ident" id="5861064">Args</span>&nbsp;<span class="op" id="5861069">=</span>&nbsp;<span class="ident" id="5861071">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861077">call</span><span class="op" id="5861081">.</span><span class="ident" id="5861082">Reply</span>&nbsp;<span class="op" id="5861088">=</span>&nbsp;<span class="ident" id="5861090">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861097">if</span>&nbsp;<span class="ident" id="5861100">done</span>&nbsp;<span class="op" id="5861105">==</span>&nbsp;<span class="ident" id="5861108">nil</span>&nbsp;<span class="op" id="5861112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861116">done</span>&nbsp;<span class="op" id="5861121">=</span>&nbsp;<span class="builtinfunc" id="5861123">make</span><span class="op" id="5861127">(</span><span class="keyword" id="5861128">chan</span>&nbsp;<span class="op" id="5861133">*</span><span class="ident" id="5861134">Call</span><span class="op" id="5861138">,</span>&nbsp;<span class="num" id="5861140">10</span><span class="op" id="5861142">)</span>&nbsp;<span class="comment" id="5861144">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861158">}</span>&nbsp;<span class="keyword" id="5861160">else</span>&nbsp;<span class="op" id="5861165">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861169">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861225">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861284">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861343">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861400">if</span>&nbsp;<span class="builtinfunc" id="5861403">cap</span><span class="op" id="5861406">(</span><span class="ident" id="5861407">done</span><span class="op" id="5861411">)</span>&nbsp;<span class="op" id="5861413">==</span>&nbsp;<span class="num" id="5861416">0</span>&nbsp;<span class="op" id="5861418">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861423">log</span><span class="op" id="5861426">.</span><span class="ident" id="5861427">Panic</span><span class="op" id="5861432">(</span><span class="string" id="5861433">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5861466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861476">call</span><span class="op" id="5861480">.</span><span class="ident" id="5861481">Done</span>&nbsp;<span class="op" id="5861486">=</span>&nbsp;<span class="ident" id="5861488">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861494">client</span><span class="op" id="5861500">.</span><span class="ident" id="5861501">send</span><span class="op" id="5861505">(</span><span class="ident" id="5861506">call</span><span class="op" id="5861510">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861513">return</span>&nbsp;<span class="ident" id="5861520">call</span><br>
<span class="lineno"></span><span class="op" id="5861525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5861528">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5861620">func</span>&nbsp;<span class="op" id="5861625">(</span><span class="ident" id="5861626">client</span>&nbsp;<span class="op" id="5861633">*</span><span class="ident" id="5861634">Client</span><span class="op" id="5861640">)</span>&nbsp;<span class="ident" id="5861642">Call</span><span class="op" id="5861646">(</span><span class="ident" id="5861647">serviceMethod</span>&nbsp;<span class="builtintype" id="5861661">string</span><span class="op" id="5861667">,</span>&nbsp;<span class="ident" id="5861669">args</span>&nbsp;<span class="keyword" id="5861674">interface</span><span class="op" id="5861683">{</span><span class="op" id="5861684">}</span><span class="op" id="5861685">,</span>&nbsp;<span class="ident" id="5861687">reply</span>&nbsp;<span class="keyword" id="5861693">interface</span><span class="op" id="5861702">{</span><span class="op" id="5861703">}</span><span class="op" id="5861704">)</span>&nbsp;<span class="builtintype" id="5861706">error</span>&nbsp;<span class="op" id="5861712">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861715">call</span>&nbsp;<span class="op" id="5861720">:=</span>&nbsp;<span class="op" id="5861723">&lt;-</span><span class="ident" id="5861725">client</span><span class="op" id="5861731">.</span><span class="ident" id="5861732">Go</span><span class="op" id="5861734">(</span><span class="ident" id="5861735">serviceMethod</span><span class="op" id="5861748">,</span>&nbsp;<span class="ident" id="5861750">args</span><span class="op" id="5861754">,</span>&nbsp;<span class="ident" id="5861756">reply</span><span class="op" id="5861761">,</span>&nbsp;<span class="builtinfunc" id="5861763">make</span><span class="op" id="5861767">(</span><span class="keyword" id="5861768">chan</span>&nbsp;<span class="op" id="5861773">*</span><span class="ident" id="5861774">Call</span><span class="op" id="5861778">,</span>&nbsp;<span class="num" id="5861780">1</span><span class="op" id="5861781">)</span><span class="op" id="5861782">)</span><span class="op" id="5861783">.</span><span class="ident" id="5861784">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861790">return</span>&nbsp;<span class="ident" id="5861797">call</span><span class="op" id="5861801">.</span><span class="ident" id="5861802">Error</span><br>
<span class="lineno"></span><span class="op" id="5861808">}</span>
</div>
</body>
</html>
