<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6531315">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6531370">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6531424">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6531475">package</span>&nbsp;<span class="ident" id="6531483">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6531488">import</span>&nbsp;<span class="op" id="6531495">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531498">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531507">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531523">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531532">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531547">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531558">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6531568">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6531571">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6531638">const</span>&nbsp;<span class="op" id="6531644">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531647">headerStr</span>&nbsp;<span class="op" id="6531657">=</span>&nbsp;<span class="string" id="6531659">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6531668">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531672">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="6531691">+</span>&nbsp;<span class="comment" id="6531693">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6531716">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="6531731">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531799">paletteStr</span>&nbsp;<span class="op" id="6531810">=</span>&nbsp;<span class="string" id="6531812">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="6531839">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6531882">trailerStr</span>&nbsp;<span class="op" id="6531893">=</span>&nbsp;<span class="string" id="6531895">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="6531902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6531905">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="6531977">func</span>&nbsp;<span class="ident" id="6531982">lzwEncode</span><span class="op" id="6531991">(</span><span class="ident" id="6531992">n</span>&nbsp;<span class="builtintype" id="6531994">int</span><span class="op" id="6531997">)</span>&nbsp;<span class="op" id="6531999">[</span><span class="op" id="6532000">]</span><span class="builtintype" id="6532001">byte</span>&nbsp;<span class="op" id="6532006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532009">b</span>&nbsp;<span class="op" id="6532011">:=</span>&nbsp;<span class="op" id="6532014">&amp;</span><span class="ident" id="6532015">bytes</span><span class="op" id="6532020">.</span><span class="ident" id="6532021">Buffer</span><span class="op" id="6532027">{</span><span class="op" id="6532028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532031">w</span>&nbsp;<span class="op" id="6532033">:=</span>&nbsp;<span class="ident" id="6532036">lzw</span><span class="op" id="6532039">.</span><span class="ident" id="6532040">NewWriter</span><span class="op" id="6532049">(</span><span class="ident" id="6532050">b</span><span class="op" id="6532051">,</span>&nbsp;<span class="ident" id="6532053">lzw</span><span class="op" id="6532056">.</span><span class="ident" id="6532057">LSB</span><span class="op" id="6532060">,</span>&nbsp;<span class="num" id="6532062">2</span><span class="op" id="6532063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532066">w</span><span class="op" id="6532067">.</span><span class="ident" id="6532068">Write</span><span class="op" id="6532073">(</span><span class="builtinfunc" id="6532074">make</span><span class="op" id="6532078">(</span><span class="op" id="6532079">[</span><span class="op" id="6532080">]</span><span class="builtintype" id="6532081">byte</span><span class="op" id="6532085">,</span>&nbsp;<span class="ident" id="6532087">n</span><span class="op" id="6532088">)</span><span class="op" id="6532089">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532092">w</span><span class="op" id="6532093">.</span><span class="ident" id="6532094">Close</span><span class="op" id="6532099">(</span><span class="op" id="6532100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532103">return</span>&nbsp;<span class="ident" id="6532110">b</span><span class="op" id="6532111">.</span><span class="ident" id="6532112">Bytes</span><span class="op" id="6532117">(</span><span class="op" id="6532118">)</span><br>
<span class="lineno"></span><span class="op" id="6532120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6532123">func</span>&nbsp;<span class="ident" id="6532128">TestDecode</span><span class="op" id="6532138">(</span><span class="ident" id="6532139">t</span>&nbsp;<span class="op" id="6532141">*</span><span class="ident" id="6532142">testing</span><span class="op" id="6532149">.</span><span class="ident" id="6532150">T</span><span class="op" id="6532151">)</span>&nbsp;<span class="op" id="6532153">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532156">testCases</span>&nbsp;<span class="op" id="6532166">:=</span>&nbsp;<span class="op" id="6532169">[</span><span class="op" id="6532170">]</span><span class="keyword" id="6532171">struct</span>&nbsp;<span class="op" id="6532178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532182">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6532190">int</span>&nbsp;&nbsp;<span class="comment" id="6532195">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532240">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6532248">bool</span>&nbsp;<span class="comment" id="6532253">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532318">wantErr</span>&nbsp;<span class="builtintype" id="6532326">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532333">}</span><span class="op" id="6532334">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532338">{</span><span class="num" id="6532339">0</span><span class="op" id="6532340">,</span>&nbsp;<span class="builtintype" id="6532342">false</span><span class="op" id="6532347">,</span>&nbsp;<span class="ident" id="6532349">errNotEnough</span><span class="op" id="6532361">}</span><span class="op" id="6532362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532366">{</span><span class="num" id="6532367">1</span><span class="op" id="6532368">,</span>&nbsp;<span class="builtintype" id="6532370">false</span><span class="op" id="6532375">,</span>&nbsp;<span class="ident" id="6532377">errNotEnough</span><span class="op" id="6532389">}</span><span class="op" id="6532390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532394">{</span><span class="num" id="6532395">2</span><span class="op" id="6532396">,</span>&nbsp;<span class="builtintype" id="6532398">false</span><span class="op" id="6532403">,</span>&nbsp;<span class="ident" id="6532405">nil</span><span class="op" id="6532408">}</span><span class="op" id="6532409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532413">{</span><span class="num" id="6532414">2</span><span class="op" id="6532415">,</span>&nbsp;<span class="builtintype" id="6532417">true</span><span class="op" id="6532421">,</span>&nbsp;<span class="ident" id="6532423">errTooMuch</span><span class="op" id="6532433">}</span><span class="op" id="6532434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532438">{</span><span class="num" id="6532439">3</span><span class="op" id="6532440">,</span>&nbsp;<span class="builtintype" id="6532442">false</span><span class="op" id="6532447">,</span>&nbsp;<span class="ident" id="6532449">errTooMuch</span><span class="op" id="6532459">}</span><span class="op" id="6532460">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6532463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532466">for</span>&nbsp;<span class="ident" id="6532470">_</span><span class="op" id="6532471">,</span>&nbsp;<span class="ident" id="6532473">tc</span>&nbsp;<span class="op" id="6532476">:=</span>&nbsp;<span class="keyword" id="6532479">range</span>&nbsp;<span class="ident" id="6532485">testCases</span>&nbsp;<span class="op" id="6532495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532499">b</span>&nbsp;<span class="op" id="6532501">:=</span>&nbsp;<span class="op" id="6532504">&amp;</span><span class="ident" id="6532505">bytes</span><span class="op" id="6532510">.</span><span class="ident" id="6532511">Buffer</span><span class="op" id="6532517">{</span><span class="op" id="6532518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532522">b</span><span class="op" id="6532523">.</span><span class="ident" id="6532524">WriteString</span><span class="op" id="6532535">(</span><span class="ident" id="6532536">headerStr</span><span class="op" id="6532545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532549">b</span><span class="op" id="6532550">.</span><span class="ident" id="6532551">WriteString</span><span class="op" id="6532562">(</span><span class="ident" id="6532563">paletteStr</span><span class="op" id="6532573">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6532577">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6532649">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6532718">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6532787">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532822">b</span><span class="op" id="6532823">.</span><span class="ident" id="6532824">WriteString</span><span class="op" id="6532835">(</span><span class="string" id="6532836">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6532882">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532886">if</span>&nbsp;<span class="ident" id="6532889">tc</span><span class="op" id="6532891">.</span><span class="ident" id="6532892">nPix</span>&nbsp;<span class="op" id="6532897">&gt;</span>&nbsp;<span class="num" id="6532899">0</span>&nbsp;<span class="op" id="6532901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532906">enc</span>&nbsp;<span class="op" id="6532910">:=</span>&nbsp;<span class="ident" id="6532913">lzwEncode</span><span class="op" id="6532922">(</span><span class="ident" id="6532923">tc</span><span class="op" id="6532925">.</span><span class="ident" id="6532926">nPix</span><span class="op" id="6532930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6532935">if</span>&nbsp;<span class="builtinfunc" id="6532938">len</span><span class="op" id="6532941">(</span><span class="ident" id="6532942">enc</span><span class="op" id="6532945">)</span>&nbsp;<span class="op" id="6532947">&gt;</span>&nbsp;<span class="num" id="6532949">0xff</span>&nbsp;<span class="op" id="6532954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6532960">t</span><span class="op" id="6532961">.</span><span class="ident" id="6532962">Errorf</span><span class="op" id="6532968">(</span><span class="string" id="6532969">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="6533023">,</span>&nbsp;<span class="ident" id="6533025">tc</span><span class="op" id="6533027">.</span><span class="ident" id="6533028">nPix</span><span class="op" id="6533032">,</span>&nbsp;<span class="ident" id="6533034">tc</span><span class="op" id="6533036">.</span><span class="ident" id="6533037">extra</span><span class="op" id="6533042">,</span>&nbsp;<span class="builtinfunc" id="6533044">len</span><span class="op" id="6533047">(</span><span class="ident" id="6533048">enc</span><span class="op" id="6533051">)</span><span class="op" id="6533052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533058">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533075">b</span><span class="op" id="6533076">.</span><span class="ident" id="6533077">WriteByte</span><span class="op" id="6533086">(</span><span class="builtintype" id="6533087">byte</span><span class="op" id="6533091">(</span><span class="builtinfunc" id="6533092">len</span><span class="op" id="6533095">(</span><span class="ident" id="6533096">enc</span><span class="op" id="6533099">)</span><span class="op" id="6533100">)</span><span class="op" id="6533101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533106">b</span><span class="op" id="6533107">.</span><span class="ident" id="6533108">Write</span><span class="op" id="6533113">(</span><span class="ident" id="6533114">enc</span><span class="op" id="6533117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533125">if</span>&nbsp;<span class="ident" id="6533128">tc</span><span class="op" id="6533130">.</span><span class="ident" id="6533131">extra</span>&nbsp;<span class="op" id="6533137">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533142">b</span><span class="op" id="6533143">.</span><span class="ident" id="6533144">WriteString</span><span class="op" id="6533155">(</span><span class="string" id="6533156">&#34;\x01\x02&#34;</span><span class="op" id="6533166">)</span>&nbsp;<span class="comment" id="6533168">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533213">b</span><span class="op" id="6533214">.</span><span class="ident" id="6533215">WriteByte</span><span class="op" id="6533224">(</span><span class="num" id="6533225">0x00</span><span class="op" id="6533229">)</span>&nbsp;<span class="comment" id="6533231">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533288">b</span><span class="op" id="6533289">.</span><span class="ident" id="6533290">WriteString</span><span class="op" id="6533301">(</span><span class="ident" id="6533302">trailerStr</span><span class="op" id="6533312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533317">got</span><span class="op" id="6533320">,</span>&nbsp;<span class="ident" id="6533322">err</span>&nbsp;<span class="op" id="6533326">:=</span>&nbsp;<span class="ident" id="6533329">Decode</span><span class="op" id="6533335">(</span><span class="ident" id="6533336">b</span><span class="op" id="6533337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533341">if</span>&nbsp;<span class="ident" id="6533344">err</span>&nbsp;<span class="op" id="6533348">!=</span>&nbsp;<span class="ident" id="6533351">tc</span><span class="op" id="6533353">.</span><span class="ident" id="6533354">wantErr</span>&nbsp;<span class="op" id="6533362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533367">t</span><span class="op" id="6533368">.</span><span class="ident" id="6533369">Errorf</span><span class="op" id="6533375">(</span><span class="string" id="6533376">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6533413">,</span>&nbsp;<span class="ident" id="6533415">tc</span><span class="op" id="6533417">.</span><span class="ident" id="6533418">nPix</span><span class="op" id="6533422">,</span>&nbsp;<span class="ident" id="6533424">tc</span><span class="op" id="6533426">.</span><span class="ident" id="6533427">extra</span><span class="op" id="6533432">,</span>&nbsp;<span class="ident" id="6533434">err</span><span class="op" id="6533437">,</span>&nbsp;<span class="ident" id="6533439">tc</span><span class="op" id="6533441">.</span><span class="ident" id="6533442">wantErr</span><span class="op" id="6533449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533458">if</span>&nbsp;<span class="ident" id="6533461">tc</span><span class="op" id="6533463">.</span><span class="ident" id="6533464">wantErr</span>&nbsp;<span class="op" id="6533472">!=</span>&nbsp;<span class="ident" id="6533475">nil</span>&nbsp;<span class="op" id="6533479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533484">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533499">want</span>&nbsp;<span class="op" id="6533504">:=</span>&nbsp;<span class="op" id="6533507">&amp;</span><span class="ident" id="6533508">image</span><span class="op" id="6533513">.</span><span class="ident" id="6533514">Paletted</span><span class="op" id="6533522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533527">Pix</span><span class="op" id="6533530">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6533535">[</span><span class="op" id="6533536">]</span><span class="builtintype" id="6533537">uint8</span><span class="op" id="6533542">{</span><span class="num" id="6533543">0</span><span class="op" id="6533544">,</span>&nbsp;<span class="num" id="6533546">0</span><span class="op" id="6533547">}</span><span class="op" id="6533548">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533553">Stride</span><span class="op" id="6533559">:</span>&nbsp;<span class="num" id="6533561">2</span><span class="op" id="6533562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533567">Rect</span><span class="op" id="6533571">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6533575">image</span><span class="op" id="6533580">.</span><span class="ident" id="6533581">Rect</span><span class="op" id="6533585">(</span><span class="num" id="6533586">0</span><span class="op" id="6533587">,</span>&nbsp;<span class="num" id="6533589">0</span><span class="op" id="6533590">,</span>&nbsp;<span class="num" id="6533592">2</span><span class="op" id="6533593">,</span>&nbsp;<span class="num" id="6533595">1</span><span class="op" id="6533596">)</span><span class="op" id="6533597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533602">Palette</span><span class="op" id="6533609">:</span>&nbsp;<span class="ident" id="6533611">color</span><span class="op" id="6533616">.</span><span class="ident" id="6533617">Palette</span><span class="op" id="6533624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533630">color</span><span class="op" id="6533635">.</span><span class="ident" id="6533636">RGBA</span><span class="op" id="6533640">{</span><span class="num" id="6533641">0x10</span><span class="op" id="6533645">,</span>&nbsp;<span class="num" id="6533647">0x20</span><span class="op" id="6533651">,</span>&nbsp;<span class="num" id="6533653">0x30</span><span class="op" id="6533657">,</span>&nbsp;<span class="num" id="6533659">0xff</span><span class="op" id="6533663">}</span><span class="op" id="6533664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533670">color</span><span class="op" id="6533675">.</span><span class="ident" id="6533676">RGBA</span><span class="op" id="6533680">{</span><span class="num" id="6533681">0x40</span><span class="op" id="6533685">,</span>&nbsp;<span class="num" id="6533687">0x50</span><span class="op" id="6533691">,</span>&nbsp;<span class="num" id="6533693">0x60</span><span class="op" id="6533697">,</span>&nbsp;<span class="num" id="6533699">0xff</span><span class="op" id="6533703">}</span><span class="op" id="6533704">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533709">}</span><span class="op" id="6533710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533718">if</span>&nbsp;<span class="op" id="6533721">!</span><span class="ident" id="6533722">reflect</span><span class="op" id="6533729">.</span><span class="ident" id="6533730">DeepEqual</span><span class="op" id="6533739">(</span><span class="ident" id="6533740">got</span><span class="op" id="6533743">,</span>&nbsp;<span class="ident" id="6533745">want</span><span class="op" id="6533749">)</span>&nbsp;<span class="op" id="6533751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533756">t</span><span class="op" id="6533757">.</span><span class="ident" id="6533758">Errorf</span><span class="op" id="6533764">(</span><span class="string" id="6533765">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6533802">,</span>&nbsp;<span class="ident" id="6533804">tc</span><span class="op" id="6533806">.</span><span class="ident" id="6533807">nPix</span><span class="op" id="6533811">,</span>&nbsp;<span class="ident" id="6533813">tc</span><span class="op" id="6533815">.</span><span class="ident" id="6533816">extra</span><span class="op" id="6533821">,</span>&nbsp;<span class="ident" id="6533823">got</span><span class="op" id="6533826">,</span>&nbsp;<span class="ident" id="6533828">want</span><span class="op" id="6533832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533836">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6533839">}</span><br>
<span class="lineno"></span><span class="op" id="6533841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533844">func</span>&nbsp;<span class="ident" id="6533849">TestTransparentIndex</span><span class="op" id="6533869">(</span><span class="ident" id="6533870">t</span>&nbsp;<span class="op" id="6533872">*</span><span class="ident" id="6533873">testing</span><span class="op" id="6533880">.</span><span class="ident" id="6533881">T</span><span class="op" id="6533882">)</span>&nbsp;<span class="op" id="6533884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533887">b</span>&nbsp;<span class="op" id="6533889">:=</span>&nbsp;<span class="op" id="6533892">&amp;</span><span class="ident" id="6533893">bytes</span><span class="op" id="6533898">.</span><span class="ident" id="6533899">Buffer</span><span class="op" id="6533905">{</span><span class="op" id="6533906">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533909">b</span><span class="op" id="6533910">.</span><span class="ident" id="6533911">WriteString</span><span class="op" id="6533922">(</span><span class="ident" id="6533923">headerStr</span><span class="op" id="6533932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6533935">b</span><span class="op" id="6533936">.</span><span class="ident" id="6533937">WriteString</span><span class="op" id="6533948">(</span><span class="ident" id="6533949">paletteStr</span><span class="op" id="6533959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6533962">for</span>&nbsp;<span class="ident" id="6533966">transparentIndex</span>&nbsp;<span class="op" id="6533983">:=</span>&nbsp;<span class="num" id="6533986">0</span><span class="op" id="6533987">;</span>&nbsp;<span class="ident" id="6533989">transparentIndex</span>&nbsp;<span class="op" id="6534006">&lt;</span>&nbsp;<span class="num" id="6534008">3</span><span class="op" id="6534009">;</span>&nbsp;<span class="ident" id="6534011">transparentIndex</span><span class="op" id="6534027">++</span>&nbsp;<span class="op" id="6534030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534034">if</span>&nbsp;<span class="ident" id="6534037">transparentIndex</span>&nbsp;<span class="op" id="6534054">&lt;</span>&nbsp;<span class="num" id="6534056">2</span>&nbsp;<span class="op" id="6534058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534063">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534122">b</span><span class="op" id="6534123">.</span><span class="ident" id="6534124">WriteString</span><span class="op" id="6534135">(</span><span class="string" id="6534136">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="6534162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534167">b</span><span class="op" id="6534168">.</span><span class="ident" id="6534169">WriteByte</span><span class="op" id="6534178">(</span><span class="builtintype" id="6534179">byte</span><span class="op" id="6534183">(</span><span class="ident" id="6534184">transparentIndex</span><span class="op" id="6534200">)</span><span class="op" id="6534201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534206">b</span><span class="op" id="6534207">.</span><span class="ident" id="6534208">WriteByte</span><span class="op" id="6534217">(</span><span class="num" id="6534218">0</span><span class="op" id="6534219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534227">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534283">b</span><span class="op" id="6534284">.</span><span class="ident" id="6534285">WriteString</span><span class="op" id="6534296">(</span><span class="string" id="6534297">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6534343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534347">enc</span>&nbsp;<span class="op" id="6534351">:=</span>&nbsp;<span class="ident" id="6534354">lzwEncode</span><span class="op" id="6534363">(</span><span class="num" id="6534364">2</span><span class="op" id="6534365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534369">if</span>&nbsp;<span class="builtinfunc" id="6534372">len</span><span class="op" id="6534375">(</span><span class="ident" id="6534376">enc</span><span class="op" id="6534379">)</span>&nbsp;<span class="op" id="6534381">&gt;</span>&nbsp;<span class="num" id="6534383">0xff</span>&nbsp;<span class="op" id="6534388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534393">t</span><span class="op" id="6534394">.</span><span class="ident" id="6534395">Fatalf</span><span class="op" id="6534401">(</span><span class="string" id="6534402">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="6534437">,</span>&nbsp;<span class="builtinfunc" id="6534439">len</span><span class="op" id="6534442">(</span><span class="ident" id="6534443">enc</span><span class="op" id="6534446">)</span><span class="op" id="6534447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534451">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534455">b</span><span class="op" id="6534456">.</span><span class="ident" id="6534457">WriteByte</span><span class="op" id="6534466">(</span><span class="builtintype" id="6534467">byte</span><span class="op" id="6534471">(</span><span class="builtinfunc" id="6534472">len</span><span class="op" id="6534475">(</span><span class="ident" id="6534476">enc</span><span class="op" id="6534479">)</span><span class="op" id="6534480">)</span><span class="op" id="6534481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534485">b</span><span class="op" id="6534486">.</span><span class="ident" id="6534487">Write</span><span class="op" id="6534492">(</span><span class="ident" id="6534493">enc</span><span class="op" id="6534496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534500">b</span><span class="op" id="6534501">.</span><span class="ident" id="6534502">WriteByte</span><span class="op" id="6534511">(</span><span class="num" id="6534512">0x00</span><span class="op" id="6534516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534522">b</span><span class="op" id="6534523">.</span><span class="ident" id="6534524">WriteString</span><span class="op" id="6534535">(</span><span class="ident" id="6534536">trailerStr</span><span class="op" id="6534546">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534550">g</span><span class="op" id="6534551">,</span>&nbsp;<span class="ident" id="6534553">err</span>&nbsp;<span class="op" id="6534557">:=</span>&nbsp;<span class="ident" id="6534560">DecodeAll</span><span class="op" id="6534569">(</span><span class="ident" id="6534570">b</span><span class="op" id="6534571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534574">if</span>&nbsp;<span class="ident" id="6534577">err</span>&nbsp;<span class="op" id="6534581">!=</span>&nbsp;<span class="ident" id="6534584">nil</span>&nbsp;<span class="op" id="6534588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534592">t</span><span class="op" id="6534593">.</span><span class="ident" id="6534594">Fatalf</span><span class="op" id="6534600">(</span><span class="string" id="6534601">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="6534616">,</span>&nbsp;<span class="ident" id="6534618">err</span><span class="op" id="6534621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534624">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534627">c0</span>&nbsp;<span class="op" id="6534630">:=</span>&nbsp;<span class="ident" id="6534633">color</span><span class="op" id="6534638">.</span><span class="ident" id="6534639">RGBA</span><span class="op" id="6534643">{</span><span class="ident" id="6534644">paletteStr</span><span class="op" id="6534654">[</span><span class="num" id="6534655">0</span><span class="op" id="6534656">]</span><span class="op" id="6534657">,</span>&nbsp;<span class="ident" id="6534659">paletteStr</span><span class="op" id="6534669">[</span><span class="num" id="6534670">1</span><span class="op" id="6534671">]</span><span class="op" id="6534672">,</span>&nbsp;<span class="ident" id="6534674">paletteStr</span><span class="op" id="6534684">[</span><span class="num" id="6534685">2</span><span class="op" id="6534686">]</span><span class="op" id="6534687">,</span>&nbsp;<span class="num" id="6534689">0xff</span><span class="op" id="6534693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534696">c1</span>&nbsp;<span class="op" id="6534699">:=</span>&nbsp;<span class="ident" id="6534702">color</span><span class="op" id="6534707">.</span><span class="ident" id="6534708">RGBA</span><span class="op" id="6534712">{</span><span class="ident" id="6534713">paletteStr</span><span class="op" id="6534723">[</span><span class="num" id="6534724">3</span><span class="op" id="6534725">]</span><span class="op" id="6534726">,</span>&nbsp;<span class="ident" id="6534728">paletteStr</span><span class="op" id="6534738">[</span><span class="num" id="6534739">4</span><span class="op" id="6534740">]</span><span class="op" id="6534741">,</span>&nbsp;<span class="ident" id="6534743">paletteStr</span><span class="op" id="6534753">[</span><span class="num" id="6534754">5</span><span class="op" id="6534755">]</span><span class="op" id="6534756">,</span>&nbsp;<span class="num" id="6534758">0xff</span><span class="op" id="6534762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534765">cz</span>&nbsp;<span class="op" id="6534768">:=</span>&nbsp;<span class="ident" id="6534771">color</span><span class="op" id="6534776">.</span><span class="ident" id="6534777">RGBA</span><span class="op" id="6534781">{</span><span class="op" id="6534782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534785">wants</span>&nbsp;<span class="op" id="6534791">:=</span>&nbsp;<span class="op" id="6534794">[</span><span class="op" id="6534795">]</span><span class="ident" id="6534796">color</span><span class="op" id="6534801">.</span><span class="ident" id="6534802">Palette</span><span class="op" id="6534809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534813">{</span><span class="ident" id="6534814">cz</span><span class="op" id="6534816">,</span>&nbsp;<span class="ident" id="6534818">c1</span><span class="op" id="6534820">}</span><span class="op" id="6534821">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534825">{</span><span class="ident" id="6534826">c0</span><span class="op" id="6534828">,</span>&nbsp;<span class="ident" id="6534830">cz</span><span class="op" id="6534832">}</span><span class="op" id="6534833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534837">{</span><span class="ident" id="6534838">c0</span><span class="op" id="6534840">,</span>&nbsp;<span class="ident" id="6534842">c1</span><span class="op" id="6534844">}</span><span class="op" id="6534845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534851">if</span>&nbsp;<span class="builtinfunc" id="6534854">len</span><span class="op" id="6534857">(</span><span class="ident" id="6534858">g</span><span class="op" id="6534859">.</span><span class="ident" id="6534860">Image</span><span class="op" id="6534865">)</span>&nbsp;<span class="op" id="6534867">!=</span>&nbsp;<span class="builtinfunc" id="6534870">len</span><span class="op" id="6534873">(</span><span class="ident" id="6534874">wants</span><span class="op" id="6534879">)</span>&nbsp;<span class="op" id="6534881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534885">t</span><span class="op" id="6534886">.</span><span class="ident" id="6534887">Fatalf</span><span class="op" id="6534893">(</span><span class="string" id="6534894">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6534918">,</span>&nbsp;<span class="builtinfunc" id="6534920">len</span><span class="op" id="6534923">(</span><span class="ident" id="6534924">g</span><span class="op" id="6534925">.</span><span class="ident" id="6534926">Image</span><span class="op" id="6534931">)</span><span class="op" id="6534932">,</span>&nbsp;<span class="builtinfunc" id="6534934">len</span><span class="op" id="6534937">(</span><span class="ident" id="6534938">wants</span><span class="op" id="6534943">)</span><span class="op" id="6534944">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534950">for</span>&nbsp;<span class="ident" id="6534954">i</span><span class="op" id="6534955">,</span>&nbsp;<span class="ident" id="6534957">want</span>&nbsp;<span class="op" id="6534962">:=</span>&nbsp;<span class="keyword" id="6534965">range</span>&nbsp;<span class="ident" id="6534971">wants</span>&nbsp;<span class="op" id="6534977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534981">got</span>&nbsp;<span class="op" id="6534985">:=</span>&nbsp;<span class="ident" id="6534988">g</span><span class="op" id="6534989">.</span><span class="ident" id="6534990">Image</span><span class="op" id="6534995">[</span><span class="ident" id="6534996">i</span><span class="op" id="6534997">]</span><span class="op" id="6534998">.</span><span class="ident" id="6534999">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535009">if</span>&nbsp;<span class="op" id="6535012">!</span><span class="ident" id="6535013">reflect</span><span class="op" id="6535020">.</span><span class="ident" id="6535021">DeepEqual</span><span class="op" id="6535030">(</span><span class="ident" id="6535031">got</span><span class="op" id="6535034">,</span>&nbsp;<span class="ident" id="6535036">want</span><span class="op" id="6535040">)</span>&nbsp;<span class="op" id="6535042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535047">t</span><span class="op" id="6535048">.</span><span class="ident" id="6535049">Errorf</span><span class="op" id="6535055">(</span><span class="string" id="6535056">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="6535088">,</span>&nbsp;<span class="ident" id="6535090">i</span><span class="op" id="6535091">,</span>&nbsp;<span class="ident" id="6535093">got</span><span class="op" id="6535096">,</span>&nbsp;<span class="ident" id="6535098">want</span><span class="op" id="6535102">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535109">}</span><br>
<span class="lineno"></span><span class="op" id="6535111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6535114">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="6535189">var</span>&nbsp;<span class="ident" id="6535193">testGIF</span>&nbsp;<span class="op" id="6535201">=</span>&nbsp;<span class="op" id="6535203">[</span><span class="op" id="6535204">]</span><span class="builtintype" id="6535205">byte</span><span class="op" id="6535209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6535212">&#39;G&#39;</span><span class="op" id="6535215">,</span>&nbsp;<span class="string" id="6535217">&#39;I&#39;</span><span class="op" id="6535220">,</span>&nbsp;<span class="string" id="6535222">&#39;F&#39;</span><span class="op" id="6535225">,</span>&nbsp;<span class="string" id="6535227">&#39;8&#39;</span><span class="op" id="6535230">,</span>&nbsp;<span class="string" id="6535232">&#39;9&#39;</span><span class="op" id="6535235">,</span>&nbsp;<span class="string" id="6535237">&#39;a&#39;</span><span class="op" id="6535240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535243">1</span><span class="op" id="6535244">,</span>&nbsp;<span class="num" id="6535246">0</span><span class="op" id="6535247">,</span>&nbsp;<span class="num" id="6535249">1</span><span class="op" id="6535250">,</span>&nbsp;<span class="num" id="6535252">0</span><span class="op" id="6535253">,</span>&nbsp;<span class="comment" id="6535255">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535272">128</span><span class="op" id="6535275">,</span>&nbsp;<span class="num" id="6535277">0</span><span class="op" id="6535278">,</span>&nbsp;<span class="num" id="6535280">0</span><span class="op" id="6535281">,</span>&nbsp;<span class="comment" id="6535283">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535317">0</span><span class="op" id="6535318">,</span>&nbsp;<span class="num" id="6535320">0</span><span class="op" id="6535321">,</span>&nbsp;<span class="num" id="6535323">0</span><span class="op" id="6535324">,</span>&nbsp;<span class="num" id="6535326">1</span><span class="op" id="6535327">,</span>&nbsp;<span class="num" id="6535329">1</span><span class="op" id="6535330">,</span>&nbsp;<span class="num" id="6535332">1</span><span class="op" id="6535333">,</span>&nbsp;<span class="comment" id="6535335">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535375">0x21</span><span class="op" id="6535379">,</span>&nbsp;<span class="num" id="6535381">0xf9</span><span class="op" id="6535385">,</span>&nbsp;<span class="num" id="6535387">0x04</span><span class="op" id="6535391">,</span>&nbsp;<span class="num" id="6535393">0x00</span><span class="op" id="6535397">,</span>&nbsp;<span class="num" id="6535399">0x00</span><span class="op" id="6535403">,</span>&nbsp;<span class="num" id="6535405">0x00</span><span class="op" id="6535409">,</span>&nbsp;<span class="num" id="6535411">0xff</span><span class="op" id="6535415">,</span>&nbsp;<span class="num" id="6535417">0x00</span><span class="op" id="6535421">,</span>&nbsp;<span class="comment" id="6535423">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6535432">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535456">0x2c</span><span class="op" id="6535460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535463">0x00</span><span class="op" id="6535467">,</span>&nbsp;<span class="num" id="6535469">0x00</span><span class="op" id="6535473">,</span>&nbsp;<span class="num" id="6535475">0x00</span><span class="op" id="6535479">,</span>&nbsp;<span class="num" id="6535481">0x00</span><span class="op" id="6535485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535488">0x01</span><span class="op" id="6535492">,</span>&nbsp;<span class="num" id="6535494">0x00</span><span class="op" id="6535498">,</span>&nbsp;<span class="num" id="6535500">0x01</span><span class="op" id="6535504">,</span>&nbsp;<span class="num" id="6535506">0x00</span><span class="op" id="6535510">,</span>&nbsp;<span class="comment" id="6535512">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535521">0x00</span><span class="op" id="6535525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535528">0x02</span><span class="op" id="6535532">,</span>&nbsp;<span class="num" id="6535534">0x02</span><span class="op" id="6535538">,</span>&nbsp;<span class="num" id="6535540">0x4c</span><span class="op" id="6535544">,</span>&nbsp;<span class="num" id="6535546">0x01</span><span class="op" id="6535550">,</span>&nbsp;<span class="num" id="6535552">0x00</span><span class="op" id="6535556">,</span>&nbsp;<span class="comment" id="6535558">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6535573">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6535585">0x3b</span><span class="op" id="6535589">,</span><br>
<span class="lineno"></span><span class="op" id="6535591">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6535594">func</span>&nbsp;<span class="ident" id="6535599">try</span><span class="op" id="6535602">(</span><span class="ident" id="6535603">t</span>&nbsp;<span class="op" id="6535605">*</span><span class="ident" id="6535606">testing</span><span class="op" id="6535613">.</span><span class="ident" id="6535614">T</span><span class="op" id="6535615">,</span>&nbsp;<span class="ident" id="6535617">b</span>&nbsp;<span class="op" id="6535619">[</span><span class="op" id="6535620">]</span><span class="builtintype" id="6535621">byte</span><span class="op" id="6535625">,</span>&nbsp;<span class="ident" id="6535627">want</span>&nbsp;<span class="builtintype" id="6535632">string</span><span class="op" id="6535638">)</span>&nbsp;<span class="op" id="6535640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535643">_</span><span class="op" id="6535644">,</span>&nbsp;<span class="ident" id="6535646">err</span>&nbsp;<span class="op" id="6535650">:=</span>&nbsp;<span class="ident" id="6535653">DecodeAll</span><span class="op" id="6535662">(</span><span class="ident" id="6535663">bytes</span><span class="op" id="6535668">.</span><span class="ident" id="6535669">NewReader</span><span class="op" id="6535678">(</span><span class="ident" id="6535679">b</span><span class="op" id="6535680">)</span><span class="op" id="6535681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535684">var</span>&nbsp;<span class="ident" id="6535688">got</span>&nbsp;<span class="builtintype" id="6535692">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535700">if</span>&nbsp;<span class="ident" id="6535703">err</span>&nbsp;<span class="op" id="6535707">!=</span>&nbsp;<span class="ident" id="6535710">nil</span>&nbsp;<span class="op" id="6535714">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535718">got</span>&nbsp;<span class="op" id="6535722">=</span>&nbsp;<span class="ident" id="6535724">err</span><span class="op" id="6535727">.</span><span class="ident" id="6535728">Error</span><span class="op" id="6535733">(</span><span class="op" id="6535734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535740">if</span>&nbsp;<span class="ident" id="6535743">got</span>&nbsp;<span class="op" id="6535747">!=</span>&nbsp;<span class="ident" id="6535750">want</span>&nbsp;<span class="op" id="6535755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535759">t</span><span class="op" id="6535760">.</span><span class="ident" id="6535761">Fatalf</span><span class="op" id="6535767">(</span><span class="string" id="6535768">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6535785">,</span>&nbsp;<span class="ident" id="6535787">got</span><span class="op" id="6535790">,</span>&nbsp;<span class="ident" id="6535792">want</span><span class="op" id="6535796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535799">}</span><br>
<span class="lineno">165</span><span class="op" id="6535801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535804">func</span>&nbsp;<span class="ident" id="6535809">TestBounds</span><span class="op" id="6535819">(</span><span class="ident" id="6535820">t</span>&nbsp;<span class="op" id="6535822">*</span><span class="ident" id="6535823">testing</span><span class="op" id="6535830">.</span><span class="ident" id="6535831">T</span><span class="op" id="6535832">)</span>&nbsp;<span class="op" id="6535834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6535837">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535871">gif</span>&nbsp;<span class="op" id="6535875">:=</span>&nbsp;<span class="builtinfunc" id="6535878">make</span><span class="op" id="6535882">(</span><span class="op" id="6535883">[</span><span class="op" id="6535884">]</span><span class="builtintype" id="6535885">byte</span><span class="op" id="6535889">,</span>&nbsp;<span class="builtinfunc" id="6535891">len</span><span class="op" id="6535894">(</span><span class="ident" id="6535895">testGIF</span><span class="op" id="6535902">)</span><span class="op" id="6535903">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6535906">copy</span><span class="op" id="6535910">(</span><span class="ident" id="6535911">gif</span><span class="op" id="6535914">,</span>&nbsp;<span class="ident" id="6535916">testGIF</span><span class="op" id="6535923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6535926">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535968">gif</span><span class="op" id="6535971">[</span><span class="num" id="6535972">32</span><span class="op" id="6535974">]</span>&nbsp;<span class="op" id="6535976">=</span>&nbsp;<span class="num" id="6535978">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535981">want</span>&nbsp;<span class="op" id="6535986">:=</span>&nbsp;<span class="string" id="6535989">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536035">try</span><span class="op" id="6536038">(</span><span class="ident" id="6536039">t</span><span class="op" id="6536040">,</span>&nbsp;<span class="ident" id="6536042">gif</span><span class="op" id="6536045">,</span>&nbsp;<span class="ident" id="6536047">want</span><span class="op" id="6536051">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536055">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536110">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536152">gif</span><span class="op" id="6536155">[</span><span class="num" id="6536156">32</span><span class="op" id="6536158">]</span>&nbsp;<span class="op" id="6536160">=</span>&nbsp;<span class="num" id="6536162">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536165">want</span>&nbsp;<span class="op" id="6536170">=</span>&nbsp;<span class="string" id="6536172">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536200">try</span><span class="op" id="6536203">(</span><span class="ident" id="6536204">t</span><span class="op" id="6536205">,</span>&nbsp;<span class="ident" id="6536207">gif</span><span class="op" id="6536210">,</span>&nbsp;<span class="ident" id="6536212">want</span><span class="op" id="6536216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536219">gif</span><span class="op" id="6536222">[</span><span class="num" id="6536223">32</span><span class="op" id="6536225">]</span>&nbsp;<span class="op" id="6536227">=</span>&nbsp;<span class="num" id="6536229">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536233">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536282">want</span>&nbsp;<span class="op" id="6536287">=</span>&nbsp;<span class="string" id="6536289">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536335">for</span>&nbsp;<span class="ident" id="6536339">i</span>&nbsp;<span class="op" id="6536341">:=</span>&nbsp;<span class="num" id="6536344">0</span><span class="op" id="6536345">;</span>&nbsp;<span class="ident" id="6536347">i</span>&nbsp;<span class="op" id="6536349">&lt;</span>&nbsp;<span class="num" id="6536351">4</span><span class="op" id="6536352">;</span>&nbsp;<span class="ident" id="6536354">i</span><span class="op" id="6536355">++</span>&nbsp;<span class="op" id="6536358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536362">gif</span><span class="op" id="6536365">[</span><span class="num" id="6536366">32</span><span class="op" id="6536368">+</span><span class="ident" id="6536369">i</span><span class="op" id="6536370">]</span>&nbsp;<span class="op" id="6536372">=</span>&nbsp;<span class="num" id="6536374">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536383">try</span><span class="op" id="6536386">(</span><span class="ident" id="6536387">t</span><span class="op" id="6536388">,</span>&nbsp;<span class="ident" id="6536390">gif</span><span class="op" id="6536393">,</span>&nbsp;<span class="ident" id="6536395">want</span><span class="op" id="6536399">)</span><br>
<span class="lineno"></span><span class="op" id="6536401">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="6536404">func</span>&nbsp;<span class="ident" id="6536409">TestNoPalette</span><span class="op" id="6536422">(</span><span class="ident" id="6536423">t</span>&nbsp;<span class="op" id="6536425">*</span><span class="ident" id="6536426">testing</span><span class="op" id="6536433">.</span><span class="ident" id="6536434">T</span><span class="op" id="6536435">)</span>&nbsp;<span class="op" id="6536437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536440">b</span>&nbsp;<span class="op" id="6536442">:=</span>&nbsp;<span class="op" id="6536445">&amp;</span><span class="ident" id="6536446">bytes</span><span class="op" id="6536451">.</span><span class="ident" id="6536452">Buffer</span><span class="op" id="6536458">{</span><span class="op" id="6536459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536463">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536522">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536543">b</span><span class="op" id="6536544">.</span><span class="ident" id="6536545">WriteString</span><span class="op" id="6536556">(</span><span class="ident" id="6536557">headerStr</span><span class="op" id="6536566">[</span><span class="op" id="6536567">:</span><span class="builtinfunc" id="6536568">len</span><span class="op" id="6536571">(</span><span class="ident" id="6536572">headerStr</span><span class="op" id="6536581">)</span><span class="op" id="6536582">-</span><span class="num" id="6536583">3</span><span class="op" id="6536584">]</span><span class="op" id="6536585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536588">b</span><span class="op" id="6536589">.</span><span class="ident" id="6536590">WriteString</span><span class="op" id="6536601">(</span><span class="string" id="6536602">&#34;\x00\x00\x00&#34;</span><span class="op" id="6536616">)</span>&nbsp;<span class="comment" id="6536618">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536642">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536687">b</span><span class="op" id="6536688">.</span><span class="ident" id="6536689">WriteString</span><span class="op" id="6536700">(</span><span class="string" id="6536701">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6536747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6536751">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536824">pix</span>&nbsp;<span class="op" id="6536828">:=</span>&nbsp;<span class="op" id="6536831">[</span><span class="op" id="6536832">]</span><span class="builtintype" id="6536833">byte</span><span class="op" id="6536837">{</span><span class="num" id="6536838">0</span><span class="op" id="6536839">,</span>&nbsp;<span class="num" id="6536841">128</span><span class="op" id="6536844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536847">enc</span>&nbsp;<span class="op" id="6536851">:=</span>&nbsp;<span class="op" id="6536854">&amp;</span><span class="ident" id="6536855">bytes</span><span class="op" id="6536860">.</span><span class="ident" id="6536861">Buffer</span><span class="op" id="6536867">{</span><span class="op" id="6536868">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536871">w</span>&nbsp;<span class="op" id="6536873">:=</span>&nbsp;<span class="ident" id="6536876">lzw</span><span class="op" id="6536879">.</span><span class="ident" id="6536880">NewWriter</span><span class="op" id="6536889">(</span><span class="ident" id="6536890">enc</span><span class="op" id="6536893">,</span>&nbsp;<span class="ident" id="6536895">lzw</span><span class="op" id="6536898">.</span><span class="ident" id="6536899">LSB</span><span class="op" id="6536902">,</span>&nbsp;<span class="num" id="6536904">2</span><span class="op" id="6536905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536908">w</span><span class="op" id="6536909">.</span><span class="ident" id="6536910">Write</span><span class="op" id="6536915">(</span><span class="ident" id="6536916">pix</span><span class="op" id="6536919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536922">w</span><span class="op" id="6536923">.</span><span class="ident" id="6536924">Close</span><span class="op" id="6536929">(</span><span class="op" id="6536930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536933">b</span><span class="op" id="6536934">.</span><span class="ident" id="6536935">WriteByte</span><span class="op" id="6536944">(</span><span class="builtintype" id="6536945">byte</span><span class="op" id="6536949">(</span><span class="builtinfunc" id="6536950">len</span><span class="op" id="6536953">(</span><span class="ident" id="6536954">enc</span><span class="op" id="6536957">.</span><span class="ident" id="6536958">Bytes</span><span class="op" id="6536963">(</span><span class="op" id="6536964">)</span><span class="op" id="6536965">)</span><span class="op" id="6536966">)</span><span class="op" id="6536967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536970">b</span><span class="op" id="6536971">.</span><span class="ident" id="6536972">Write</span><span class="op" id="6536977">(</span><span class="ident" id="6536978">enc</span><span class="op" id="6536981">.</span><span class="ident" id="6536982">Bytes</span><span class="op" id="6536987">(</span><span class="op" id="6536988">)</span><span class="op" id="6536989">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536992">b</span><span class="op" id="6536993">.</span><span class="ident" id="6536994">WriteByte</span><span class="op" id="6537003">(</span><span class="num" id="6537004">0x00</span><span class="op" id="6537008">)</span>&nbsp;<span class="comment" id="6537010">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537067">b</span><span class="op" id="6537068">.</span><span class="ident" id="6537069">WriteString</span><span class="op" id="6537080">(</span><span class="ident" id="6537081">trailerStr</span><span class="op" id="6537091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537095">try</span><span class="op" id="6537098">(</span><span class="ident" id="6537099">t</span><span class="op" id="6537100">,</span>&nbsp;<span class="ident" id="6537102">b</span><span class="op" id="6537103">.</span><span class="ident" id="6537104">Bytes</span><span class="op" id="6537109">(</span><span class="op" id="6537110">)</span><span class="op" id="6537111">,</span>&nbsp;<span class="string" id="6537113">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6537139">)</span><br>
<span class="lineno">215</span><span class="op" id="6537141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6537144">func</span>&nbsp;<span class="ident" id="6537149">TestPixelOutsidePaletteRange</span><span class="op" id="6537177">(</span><span class="ident" id="6537178">t</span>&nbsp;<span class="op" id="6537180">*</span><span class="ident" id="6537181">testing</span><span class="op" id="6537188">.</span><span class="ident" id="6537189">T</span><span class="op" id="6537190">)</span>&nbsp;<span class="op" id="6537192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537195">for</span>&nbsp;<span class="ident" id="6537199">_</span><span class="op" id="6537200">,</span>&nbsp;<span class="ident" id="6537202">pval</span>&nbsp;<span class="op" id="6537207">:=</span>&nbsp;<span class="keyword" id="6537210">range</span>&nbsp;<span class="op" id="6537216">[</span><span class="op" id="6537217">]</span><span class="builtintype" id="6537218">byte</span><span class="op" id="6537222">{</span><span class="num" id="6537223">0</span><span class="op" id="6537224">,</span>&nbsp;<span class="num" id="6537226">1</span><span class="op" id="6537227">,</span>&nbsp;<span class="num" id="6537229">2</span><span class="op" id="6537230">,</span>&nbsp;<span class="num" id="6537232">3</span><span class="op" id="6537233">,</span>&nbsp;<span class="num" id="6537235">255</span><span class="op" id="6537238">}</span>&nbsp;<span class="op" id="6537240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537244">b</span>&nbsp;<span class="op" id="6537246">:=</span>&nbsp;<span class="op" id="6537249">&amp;</span><span class="ident" id="6537250">bytes</span><span class="op" id="6537255">.</span><span class="ident" id="6537256">Buffer</span><span class="op" id="6537262">{</span><span class="op" id="6537263">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537268">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537315">b</span><span class="op" id="6537316">.</span><span class="ident" id="6537317">WriteString</span><span class="op" id="6537328">(</span><span class="ident" id="6537329">headerStr</span><span class="op" id="6537338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537342">b</span><span class="op" id="6537343">.</span><span class="ident" id="6537344">WriteString</span><span class="op" id="6537355">(</span><span class="ident" id="6537356">paletteStr</span><span class="op" id="6537366">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537371">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537417">b</span><span class="op" id="6537418">.</span><span class="ident" id="6537419">WriteString</span><span class="op" id="6537430">(</span><span class="string" id="6537431">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="6537477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537482">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537545">pix</span>&nbsp;<span class="op" id="6537549">:=</span>&nbsp;<span class="op" id="6537552">[</span><span class="op" id="6537553">]</span><span class="builtintype" id="6537554">byte</span><span class="op" id="6537558">{</span><span class="ident" id="6537559">pval</span><span class="op" id="6537563">,</span>&nbsp;<span class="ident" id="6537565">pval</span><span class="op" id="6537569">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537573">enc</span>&nbsp;<span class="op" id="6537577">:=</span>&nbsp;<span class="op" id="6537580">&amp;</span><span class="ident" id="6537581">bytes</span><span class="op" id="6537586">.</span><span class="ident" id="6537587">Buffer</span><span class="op" id="6537593">{</span><span class="op" id="6537594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537598">w</span>&nbsp;<span class="op" id="6537600">:=</span>&nbsp;<span class="ident" id="6537603">lzw</span><span class="op" id="6537606">.</span><span class="ident" id="6537607">NewWriter</span><span class="op" id="6537616">(</span><span class="ident" id="6537617">enc</span><span class="op" id="6537620">,</span>&nbsp;<span class="ident" id="6537622">lzw</span><span class="op" id="6537625">.</span><span class="ident" id="6537626">LSB</span><span class="op" id="6537629">,</span>&nbsp;<span class="num" id="6537631">2</span><span class="op" id="6537632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537636">w</span><span class="op" id="6537637">.</span><span class="ident" id="6537638">Write</span><span class="op" id="6537643">(</span><span class="ident" id="6537644">pix</span><span class="op" id="6537647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537651">w</span><span class="op" id="6537652">.</span><span class="ident" id="6537653">Close</span><span class="op" id="6537658">(</span><span class="op" id="6537659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537663">b</span><span class="op" id="6537664">.</span><span class="ident" id="6537665">WriteByte</span><span class="op" id="6537674">(</span><span class="builtintype" id="6537675">byte</span><span class="op" id="6537679">(</span><span class="builtinfunc" id="6537680">len</span><span class="op" id="6537683">(</span><span class="ident" id="6537684">enc</span><span class="op" id="6537687">.</span><span class="ident" id="6537688">Bytes</span><span class="op" id="6537693">(</span><span class="op" id="6537694">)</span><span class="op" id="6537695">)</span><span class="op" id="6537696">)</span><span class="op" id="6537697">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537701">b</span><span class="op" id="6537702">.</span><span class="ident" id="6537703">Write</span><span class="op" id="6537708">(</span><span class="ident" id="6537709">enc</span><span class="op" id="6537712">.</span><span class="ident" id="6537713">Bytes</span><span class="op" id="6537718">(</span><span class="op" id="6537719">)</span><span class="op" id="6537720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537724">b</span><span class="op" id="6537725">.</span><span class="ident" id="6537726">WriteByte</span><span class="op" id="6537735">(</span><span class="num" id="6537736">0x00</span><span class="op" id="6537740">)</span>&nbsp;<span class="comment" id="6537742">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537800">b</span><span class="op" id="6537801">.</span><span class="ident" id="6537802">WriteString</span><span class="op" id="6537813">(</span><span class="ident" id="6537814">trailerStr</span><span class="op" id="6537824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6537829">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537903">want</span>&nbsp;<span class="op" id="6537908">:=</span>&nbsp;<span class="string" id="6537911">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537916">if</span>&nbsp;<span class="ident" id="6537919">pval</span>&nbsp;<span class="op" id="6537924">&gt;=</span>&nbsp;<span class="num" id="6537927">2</span>&nbsp;<span class="op" id="6537929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537934">want</span>&nbsp;<span class="op" id="6537939">=</span>&nbsp;<span class="string" id="6537941">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537970">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537974">try</span><span class="op" id="6537977">(</span><span class="ident" id="6537978">t</span><span class="op" id="6537979">,</span>&nbsp;<span class="ident" id="6537981">b</span><span class="op" id="6537982">.</span><span class="ident" id="6537983">Bytes</span><span class="op" id="6537988">(</span><span class="op" id="6537989">)</span><span class="op" id="6537990">,</span>&nbsp;<span class="ident" id="6537992">want</span><span class="op" id="6537996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537999">}</span><br>
<span class="lineno"></span><span class="op" id="6538001">}</span>
</div>
</body>
</html>
