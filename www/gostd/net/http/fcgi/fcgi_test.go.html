<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6448272">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6448327">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6448381">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6448432">package</span>&nbsp;<span class="ident" id="6448440">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448446">import</span>&nbsp;<span class="op" id="6448453">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6448456">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6448465">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6448475">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6448481">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6448491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448494">var</span>&nbsp;<span class="ident" id="6448498">sizeTests</span>&nbsp;<span class="op" id="6448508">=</span>&nbsp;<span class="op" id="6448510">[</span><span class="op" id="6448511">]</span><span class="keyword" id="6448512">struct</span>&nbsp;<span class="op" id="6448519">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448522">size</span>&nbsp;&nbsp;<span class="builtintype" id="6448528">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448536">bytes</span>&nbsp;<span class="op" id="6448542">[</span><span class="op" id="6448543">]</span><span class="builtintype" id="6448544">byte</span><br>
<span class="lineno"></span><span class="op" id="6448549">}</span><span class="op" id="6448550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448553">{</span><span class="num" id="6448554">0</span><span class="op" id="6448555">,</span>&nbsp;<span class="op" id="6448557">[</span><span class="op" id="6448558">]</span><span class="builtintype" id="6448559">byte</span><span class="op" id="6448563">{</span><span class="num" id="6448564">0x00</span><span class="op" id="6448568">}</span><span class="op" id="6448569">}</span><span class="op" id="6448570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448573">{</span><span class="num" id="6448574">127</span><span class="op" id="6448577">,</span>&nbsp;<span class="op" id="6448579">[</span><span class="op" id="6448580">]</span><span class="builtintype" id="6448581">byte</span><span class="op" id="6448585">{</span><span class="num" id="6448586">0x7F</span><span class="op" id="6448590">}</span><span class="op" id="6448591">}</span><span class="op" id="6448592">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448595">{</span><span class="num" id="6448596">128</span><span class="op" id="6448599">,</span>&nbsp;<span class="op" id="6448601">[</span><span class="op" id="6448602">]</span><span class="builtintype" id="6448603">byte</span><span class="op" id="6448607">{</span><span class="num" id="6448608">0x80</span><span class="op" id="6448612">,</span>&nbsp;<span class="num" id="6448614">0x00</span><span class="op" id="6448618">,</span>&nbsp;<span class="num" id="6448620">0x00</span><span class="op" id="6448624">,</span>&nbsp;<span class="num" id="6448626">0x80</span><span class="op" id="6448630">}</span><span class="op" id="6448631">}</span><span class="op" id="6448632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448635">{</span><span class="num" id="6448636">1000</span><span class="op" id="6448640">,</span>&nbsp;<span class="op" id="6448642">[</span><span class="op" id="6448643">]</span><span class="builtintype" id="6448644">byte</span><span class="op" id="6448648">{</span><span class="num" id="6448649">0x80</span><span class="op" id="6448653">,</span>&nbsp;<span class="num" id="6448655">0x00</span><span class="op" id="6448659">,</span>&nbsp;<span class="num" id="6448661">0x03</span><span class="op" id="6448665">,</span>&nbsp;<span class="num" id="6448667">0xE8</span><span class="op" id="6448671">}</span><span class="op" id="6448672">}</span><span class="op" id="6448673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448676">{</span><span class="num" id="6448677">33554431</span><span class="op" id="6448685">,</span>&nbsp;<span class="op" id="6448687">[</span><span class="op" id="6448688">]</span><span class="builtintype" id="6448689">byte</span><span class="op" id="6448693">{</span><span class="num" id="6448694">0x81</span><span class="op" id="6448698">,</span>&nbsp;<span class="num" id="6448700">0xFF</span><span class="op" id="6448704">,</span>&nbsp;<span class="num" id="6448706">0xFF</span><span class="op" id="6448710">,</span>&nbsp;<span class="num" id="6448712">0xFF</span><span class="op" id="6448716">}</span><span class="op" id="6448717">}</span><span class="op" id="6448718">,</span><br>
<span class="lineno"></span><span class="op" id="6448720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6448723">func</span>&nbsp;<span class="ident" id="6448728">TestSize</span><span class="op" id="6448736">(</span><span class="ident" id="6448737">t</span>&nbsp;<span class="op" id="6448739">*</span><span class="ident" id="6448740">testing</span><span class="op" id="6448747">.</span><span class="ident" id="6448748">T</span><span class="op" id="6448749">)</span>&nbsp;<span class="op" id="6448751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448754">b</span>&nbsp;<span class="op" id="6448756">:=</span>&nbsp;<span class="builtinfunc" id="6448759">make</span><span class="op" id="6448763">(</span><span class="op" id="6448764">[</span><span class="op" id="6448765">]</span><span class="builtintype" id="6448766">byte</span><span class="op" id="6448770">,</span>&nbsp;<span class="num" id="6448772">4</span><span class="op" id="6448773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448776">for</span>&nbsp;<span class="ident" id="6448780">i</span><span class="op" id="6448781">,</span>&nbsp;<span class="ident" id="6448783">test</span>&nbsp;<span class="op" id="6448788">:=</span>&nbsp;<span class="keyword" id="6448791">range</span>&nbsp;<span class="ident" id="6448797">sizeTests</span>&nbsp;<span class="op" id="6448807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448811">n</span>&nbsp;<span class="op" id="6448813">:=</span>&nbsp;<span class="ident" id="6448816">encodeSize</span><span class="op" id="6448826">(</span><span class="ident" id="6448827">b</span><span class="op" id="6448828">,</span>&nbsp;<span class="ident" id="6448830">test</span><span class="op" id="6448834">.</span><span class="ident" id="6448835">size</span><span class="op" id="6448839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448843">if</span>&nbsp;<span class="op" id="6448846">!</span><span class="ident" id="6448847">bytes</span><span class="op" id="6448852">.</span><span class="ident" id="6448853">Equal</span><span class="op" id="6448858">(</span><span class="ident" id="6448859">b</span><span class="op" id="6448860">[</span><span class="op" id="6448861">:</span><span class="ident" id="6448862">n</span><span class="op" id="6448863">]</span><span class="op" id="6448864">,</span>&nbsp;<span class="ident" id="6448866">test</span><span class="op" id="6448870">.</span><span class="ident" id="6448871">bytes</span><span class="op" id="6448876">)</span>&nbsp;<span class="op" id="6448878">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448883">t</span><span class="op" id="6448884">.</span><span class="ident" id="6448885">Errorf</span><span class="op" id="6448891">(</span><span class="string" id="6448892">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6448920">,</span>&nbsp;<span class="ident" id="6448922">i</span><span class="op" id="6448923">,</span>&nbsp;<span class="ident" id="6448925">test</span><span class="op" id="6448929">.</span><span class="ident" id="6448930">bytes</span><span class="op" id="6448935">,</span>&nbsp;<span class="ident" id="6448937">b</span><span class="op" id="6448938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448946">size</span><span class="op" id="6448950">,</span>&nbsp;<span class="ident" id="6448952">n</span>&nbsp;<span class="op" id="6448954">:=</span>&nbsp;<span class="ident" id="6448957">readSize</span><span class="op" id="6448965">(</span><span class="ident" id="6448966">test</span><span class="op" id="6448970">.</span><span class="ident" id="6448971">bytes</span><span class="op" id="6448976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448980">if</span>&nbsp;<span class="ident" id="6448983">size</span>&nbsp;<span class="op" id="6448988">!=</span>&nbsp;<span class="ident" id="6448991">test</span><span class="op" id="6448995">.</span><span class="ident" id="6448996">size</span>&nbsp;<span class="op" id="6449001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449006">t</span><span class="op" id="6449007">.</span><span class="ident" id="6449008">Errorf</span><span class="op" id="6449014">(</span><span class="string" id="6449015">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6449040">,</span>&nbsp;<span class="ident" id="6449042">i</span><span class="op" id="6449043">,</span>&nbsp;<span class="ident" id="6449045">test</span><span class="op" id="6449049">.</span><span class="ident" id="6449050">size</span><span class="op" id="6449054">,</span>&nbsp;<span class="ident" id="6449056">size</span><span class="op" id="6449060">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449068">if</span>&nbsp;<span class="builtinfunc" id="6449071">len</span><span class="op" id="6449074">(</span><span class="ident" id="6449075">test</span><span class="op" id="6449079">.</span><span class="ident" id="6449080">bytes</span><span class="op" id="6449085">)</span>&nbsp;<span class="op" id="6449087">!=</span>&nbsp;<span class="ident" id="6449090">n</span>&nbsp;<span class="op" id="6449092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449097">t</span><span class="op" id="6449098">.</span><span class="ident" id="6449099">Errorf</span><span class="op" id="6449105">(</span><span class="string" id="6449106">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6449140">,</span>&nbsp;<span class="ident" id="6449142">i</span><span class="op" id="6449143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449150">}</span><br>
<span class="lineno">40</span><span class="op" id="6449152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6449155">var</span>&nbsp;<span class="ident" id="6449159">streamTests</span>&nbsp;<span class="op" id="6449171">=</span>&nbsp;<span class="op" id="6449173">[</span><span class="op" id="6449174">]</span><span class="keyword" id="6449175">struct</span>&nbsp;<span class="op" id="6449182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449185">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6449193">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449201">recType</span>&nbsp;<span class="ident" id="6449209">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449218">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6449226">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449234">content</span>&nbsp;<span class="op" id="6449242">[</span><span class="op" id="6449243">]</span><span class="builtintype" id="6449244">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449250">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6449258">[</span><span class="op" id="6449259">]</span><span class="builtintype" id="6449260">byte</span><br>
<span class="lineno"></span><span class="op" id="6449265">}</span><span class="op" id="6449266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449269">{</span><span class="string" id="6449270">&#34;single&nbsp;record&#34;</span><span class="op" id="6449285">,</span>&nbsp;<span class="ident" id="6449287">typeStdout</span><span class="op" id="6449297">,</span>&nbsp;<span class="num" id="6449299">1</span><span class="op" id="6449300">,</span>&nbsp;<span class="ident" id="6449302">nil</span><span class="op" id="6449305">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449309">[</span><span class="op" id="6449310">]</span><span class="builtintype" id="6449311">byte</span><span class="op" id="6449315">{</span><span class="num" id="6449316">1</span><span class="op" id="6449317">,</span>&nbsp;<span class="builtintype" id="6449319">byte</span><span class="op" id="6449323">(</span><span class="ident" id="6449324">typeStdout</span><span class="op" id="6449334">)</span><span class="op" id="6449335">,</span>&nbsp;<span class="num" id="6449337">0</span><span class="op" id="6449338">,</span>&nbsp;<span class="num" id="6449340">1</span><span class="op" id="6449341">,</span>&nbsp;<span class="num" id="6449343">0</span><span class="op" id="6449344">,</span>&nbsp;<span class="num" id="6449346">0</span><span class="op" id="6449347">,</span>&nbsp;<span class="num" id="6449349">0</span><span class="op" id="6449350">,</span>&nbsp;<span class="num" id="6449352">0</span><span class="op" id="6449353">}</span><span class="op" id="6449354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449357">}</span><span class="op" id="6449358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6449361">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449414">{</span><span class="string" id="6449415">&#34;two&nbsp;records&#34;</span><span class="op" id="6449428">,</span>&nbsp;<span class="ident" id="6449430">typeStdin</span><span class="op" id="6449439">,</span>&nbsp;<span class="num" id="6449441">300</span><span class="op" id="6449444">,</span>&nbsp;<span class="builtinfunc" id="6449446">make</span><span class="op" id="6449450">(</span><span class="op" id="6449451">[</span><span class="op" id="6449452">]</span><span class="builtintype" id="6449453">byte</span><span class="op" id="6449457">,</span>&nbsp;<span class="num" id="6449459">66000</span><span class="op" id="6449464">)</span><span class="op" id="6449465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449469">bytes</span><span class="op" id="6449474">.</span><span class="ident" id="6449475">Join</span><span class="op" id="6449479">(</span><span class="op" id="6449480">[</span><span class="op" id="6449481">]</span><span class="op" id="6449482">[</span><span class="op" id="6449483">]</span><span class="builtintype" id="6449484">byte</span><span class="op" id="6449488">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6449493">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449527">{</span><span class="num" id="6449528">1</span><span class="op" id="6449529">,</span>&nbsp;<span class="builtintype" id="6449531">byte</span><span class="op" id="6449535">(</span><span class="ident" id="6449536">typeStdin</span><span class="op" id="6449545">)</span><span class="op" id="6449546">,</span>&nbsp;<span class="num" id="6449548">0x01</span><span class="op" id="6449552">,</span>&nbsp;<span class="num" id="6449554">0x2C</span><span class="op" id="6449558">,</span>&nbsp;<span class="num" id="6449560">0xFF</span><span class="op" id="6449564">,</span>&nbsp;<span class="num" id="6449566">0xFF</span><span class="op" id="6449570">,</span>&nbsp;<span class="num" id="6449572">1</span><span class="op" id="6449573">,</span>&nbsp;<span class="num" id="6449575">0</span><span class="op" id="6449576">}</span><span class="op" id="6449577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6449582">make</span><span class="op" id="6449586">(</span><span class="op" id="6449587">[</span><span class="op" id="6449588">]</span><span class="builtintype" id="6449589">byte</span><span class="op" id="6449593">,</span>&nbsp;<span class="num" id="6449595">65536</span><span class="op" id="6449600">)</span><span class="op" id="6449601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6449606">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449634">{</span><span class="num" id="6449635">1</span><span class="op" id="6449636">,</span>&nbsp;<span class="builtintype" id="6449638">byte</span><span class="op" id="6449642">(</span><span class="ident" id="6449643">typeStdin</span><span class="op" id="6449652">)</span><span class="op" id="6449653">,</span>&nbsp;<span class="num" id="6449655">0x01</span><span class="op" id="6449659">,</span>&nbsp;<span class="num" id="6449661">0x2C</span><span class="op" id="6449665">,</span>&nbsp;<span class="num" id="6449667">0x01</span><span class="op" id="6449671">,</span>&nbsp;<span class="num" id="6449673">0xD1</span><span class="op" id="6449677">,</span>&nbsp;<span class="num" id="6449679">7</span><span class="op" id="6449680">,</span>&nbsp;<span class="num" id="6449682">0</span><span class="op" id="6449683">}</span><span class="op" id="6449684">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6449689">make</span><span class="op" id="6449693">(</span><span class="op" id="6449694">[</span><span class="op" id="6449695">]</span><span class="builtintype" id="6449696">byte</span><span class="op" id="6449700">,</span>&nbsp;<span class="num" id="6449702">472</span><span class="op" id="6449705">)</span><span class="op" id="6449706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6449711">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449745">{</span><span class="num" id="6449746">1</span><span class="op" id="6449747">,</span>&nbsp;<span class="builtintype" id="6449749">byte</span><span class="op" id="6449753">(</span><span class="ident" id="6449754">typeStdin</span><span class="op" id="6449763">)</span><span class="op" id="6449764">,</span>&nbsp;<span class="num" id="6449766">0x01</span><span class="op" id="6449770">,</span>&nbsp;<span class="num" id="6449772">0x2C</span><span class="op" id="6449776">,</span>&nbsp;<span class="num" id="6449778">0</span><span class="op" id="6449779">,</span>&nbsp;<span class="num" id="6449781">0</span><span class="op" id="6449782">,</span>&nbsp;<span class="num" id="6449784">0</span><span class="op" id="6449785">,</span>&nbsp;<span class="num" id="6449787">0</span><span class="op" id="6449788">}</span><span class="op" id="6449789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449793">}</span><span class="op" id="6449794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449799">nil</span><span class="op" id="6449802">)</span><span class="op" id="6449803">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449806">}</span><span class="op" id="6449807">,</span><br>
<span class="lineno"></span><span class="op" id="6449809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6449812">type</span>&nbsp;<span class="ident" id="6449817">nilCloser</span>&nbsp;<span class="keyword" id="6449827">struct</span>&nbsp;<span class="op" id="6449834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449837">io</span><span class="op" id="6449839">.</span><span class="ident" id="6449840">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6449851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6449854">func</span>&nbsp;<span class="op" id="6449859">(</span><span class="ident" id="6449860">c</span>&nbsp;<span class="op" id="6449862">*</span><span class="ident" id="6449863">nilCloser</span><span class="op" id="6449872">)</span>&nbsp;<span class="ident" id="6449874">Close</span><span class="op" id="6449879">(</span><span class="op" id="6449880">)</span>&nbsp;<span class="builtintype" id="6449882">error</span>&nbsp;<span class="op" id="6449888">{</span>&nbsp;<span class="keyword" id="6449890">return</span>&nbsp;<span class="ident" id="6449897">nil</span>&nbsp;<span class="op" id="6449901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6449904">func</span>&nbsp;<span class="ident" id="6449909">TestStreams</span><span class="op" id="6449920">(</span><span class="ident" id="6449921">t</span>&nbsp;<span class="op" id="6449923">*</span><span class="ident" id="6449924">testing</span><span class="op" id="6449931">.</span><span class="ident" id="6449932">T</span><span class="op" id="6449933">)</span>&nbsp;<span class="op" id="6449935">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449938">var</span>&nbsp;<span class="ident" id="6449942">rec</span>&nbsp;<span class="ident" id="6449946">record</span><br>
<span class="lineno"></span><span class="ident" id="6449953">outer</span><span class="op" id="6449958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449961">for</span>&nbsp;<span class="ident" id="6449965">_</span><span class="op" id="6449966">,</span>&nbsp;<span class="ident" id="6449968">test</span>&nbsp;<span class="op" id="6449973">:=</span>&nbsp;<span class="keyword" id="6449976">range</span>&nbsp;<span class="ident" id="6449982">streamTests</span>&nbsp;<span class="op" id="6449994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449998">buf</span>&nbsp;<span class="op" id="6450002">:=</span>&nbsp;<span class="ident" id="6450005">bytes</span><span class="op" id="6450010">.</span><span class="ident" id="6450011">NewBuffer</span><span class="op" id="6450020">(</span><span class="ident" id="6450021">test</span><span class="op" id="6450025">.</span><span class="ident" id="6450026">raw</span><span class="op" id="6450029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450033">var</span>&nbsp;<span class="ident" id="6450037">content</span>&nbsp;<span class="op" id="6450045">[</span><span class="op" id="6450046">]</span><span class="builtintype" id="6450047">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450054">for</span>&nbsp;<span class="ident" id="6450058">buf</span><span class="op" id="6450061">.</span><span class="ident" id="6450062">Len</span><span class="op" id="6450065">(</span><span class="op" id="6450066">)</span>&nbsp;<span class="op" id="6450068">&gt;</span>&nbsp;<span class="num" id="6450070">0</span>&nbsp;<span class="op" id="6450072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450077">if</span>&nbsp;<span class="ident" id="6450080">err</span>&nbsp;<span class="op" id="6450084">:=</span>&nbsp;<span class="ident" id="6450087">rec</span><span class="op" id="6450090">.</span><span class="ident" id="6450091">read</span><span class="op" id="6450095">(</span><span class="ident" id="6450096">buf</span><span class="op" id="6450099">)</span><span class="op" id="6450100">;</span>&nbsp;<span class="ident" id="6450102">err</span>&nbsp;<span class="op" id="6450106">!=</span>&nbsp;<span class="ident" id="6450109">nil</span>&nbsp;<span class="op" id="6450113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450119">t</span><span class="op" id="6450120">.</span><span class="ident" id="6450121">Errorf</span><span class="op" id="6450127">(</span><span class="string" id="6450128">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6450158">,</span>&nbsp;<span class="ident" id="6450160">test</span><span class="op" id="6450164">.</span><span class="ident" id="6450165">desc</span><span class="op" id="6450169">,</span>&nbsp;<span class="ident" id="6450171">err</span><span class="op" id="6450174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450180">continue</span>&nbsp;<span class="ident" id="6450189">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450198">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450203">content</span>&nbsp;<span class="op" id="6450211">=</span>&nbsp;<span class="builtinfunc" id="6450213">append</span><span class="op" id="6450219">(</span><span class="ident" id="6450220">content</span><span class="op" id="6450227">,</span>&nbsp;<span class="ident" id="6450229">rec</span><span class="op" id="6450232">.</span><span class="ident" id="6450233">content</span><span class="op" id="6450240">(</span><span class="op" id="6450241">)</span><span class="op" id="6450242">...</span><span class="op" id="6450245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450253">if</span>&nbsp;<span class="ident" id="6450256">rec</span><span class="op" id="6450259">.</span><span class="ident" id="6450260">h</span><span class="op" id="6450261">.</span><span class="ident" id="6450262">Type</span>&nbsp;<span class="op" id="6450267">!=</span>&nbsp;<span class="ident" id="6450270">test</span><span class="op" id="6450274">.</span><span class="ident" id="6450275">recType</span>&nbsp;<span class="op" id="6450283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450288">t</span><span class="op" id="6450289">.</span><span class="ident" id="6450290">Errorf</span><span class="op" id="6450296">(</span><span class="string" id="6450297">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6450326">,</span>&nbsp;<span class="ident" id="6450328">test</span><span class="op" id="6450332">.</span><span class="ident" id="6450333">desc</span><span class="op" id="6450337">,</span>&nbsp;<span class="ident" id="6450339">rec</span><span class="op" id="6450342">.</span><span class="ident" id="6450343">h</span><span class="op" id="6450344">.</span><span class="ident" id="6450345">Type</span><span class="op" id="6450349">,</span>&nbsp;<span class="ident" id="6450351">test</span><span class="op" id="6450355">.</span><span class="ident" id="6450356">recType</span><span class="op" id="6450363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450368">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450383">if</span>&nbsp;<span class="ident" id="6450386">rec</span><span class="op" id="6450389">.</span><span class="ident" id="6450390">h</span><span class="op" id="6450391">.</span><span class="ident" id="6450392">Id</span>&nbsp;<span class="op" id="6450395">!=</span>&nbsp;<span class="ident" id="6450398">test</span><span class="op" id="6450402">.</span><span class="ident" id="6450403">reqId</span>&nbsp;<span class="op" id="6450409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450414">t</span><span class="op" id="6450415">.</span><span class="ident" id="6450416">Errorf</span><span class="op" id="6450422">(</span><span class="string" id="6450423">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6450458">,</span>&nbsp;<span class="ident" id="6450460">test</span><span class="op" id="6450464">.</span><span class="ident" id="6450465">desc</span><span class="op" id="6450469">,</span>&nbsp;<span class="ident" id="6450471">rec</span><span class="op" id="6450474">.</span><span class="ident" id="6450475">h</span><span class="op" id="6450476">.</span><span class="ident" id="6450477">Id</span><span class="op" id="6450479">,</span>&nbsp;<span class="ident" id="6450481">test</span><span class="op" id="6450485">.</span><span class="ident" id="6450486">reqId</span><span class="op" id="6450491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450496">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450507">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450511">if</span>&nbsp;<span class="op" id="6450514">!</span><span class="ident" id="6450515">bytes</span><span class="op" id="6450520">.</span><span class="ident" id="6450521">Equal</span><span class="op" id="6450526">(</span><span class="ident" id="6450527">content</span><span class="op" id="6450534">,</span>&nbsp;<span class="ident" id="6450536">test</span><span class="op" id="6450540">.</span><span class="ident" id="6450541">content</span><span class="op" id="6450548">)</span>&nbsp;<span class="op" id="6450550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450555">t</span><span class="op" id="6450556">.</span><span class="ident" id="6450557">Errorf</span><span class="op" id="6450563">(</span><span class="string" id="6450564">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6450588">,</span>&nbsp;<span class="ident" id="6450590">test</span><span class="op" id="6450594">.</span><span class="ident" id="6450595">desc</span><span class="op" id="6450599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450604">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450619">buf</span><span class="op" id="6450622">.</span><span class="ident" id="6450623">Reset</span><span class="op" id="6450628">(</span><span class="op" id="6450629">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450633">c</span>&nbsp;<span class="op" id="6450635">:=</span>&nbsp;<span class="ident" id="6450638">newConn</span><span class="op" id="6450645">(</span><span class="op" id="6450646">&amp;</span><span class="ident" id="6450647">nilCloser</span><span class="op" id="6450656">{</span><span class="ident" id="6450657">buf</span><span class="op" id="6450660">}</span><span class="op" id="6450661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450665">w</span>&nbsp;<span class="op" id="6450667">:=</span>&nbsp;<span class="ident" id="6450670">newWriter</span><span class="op" id="6450679">(</span><span class="ident" id="6450680">c</span><span class="op" id="6450681">,</span>&nbsp;<span class="ident" id="6450683">test</span><span class="op" id="6450687">.</span><span class="ident" id="6450688">recType</span><span class="op" id="6450695">,</span>&nbsp;<span class="ident" id="6450697">test</span><span class="op" id="6450701">.</span><span class="ident" id="6450702">reqId</span><span class="op" id="6450707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450711">if</span>&nbsp;<span class="ident" id="6450714">_</span><span class="op" id="6450715">,</span>&nbsp;<span class="ident" id="6450717">err</span>&nbsp;<span class="op" id="6450721">:=</span>&nbsp;<span class="ident" id="6450724">w</span><span class="op" id="6450725">.</span><span class="ident" id="6450726">Write</span><span class="op" id="6450731">(</span><span class="ident" id="6450732">test</span><span class="op" id="6450736">.</span><span class="ident" id="6450737">content</span><span class="op" id="6450744">)</span><span class="op" id="6450745">;</span>&nbsp;<span class="ident" id="6450747">err</span>&nbsp;<span class="op" id="6450751">!=</span>&nbsp;<span class="ident" id="6450754">nil</span>&nbsp;<span class="op" id="6450758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450763">t</span><span class="op" id="6450764">.</span><span class="ident" id="6450765">Errorf</span><span class="op" id="6450771">(</span><span class="string" id="6450772">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6450802">,</span>&nbsp;<span class="ident" id="6450804">test</span><span class="op" id="6450808">.</span><span class="ident" id="6450809">desc</span><span class="op" id="6450813">,</span>&nbsp;<span class="ident" id="6450815">err</span><span class="op" id="6450818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450823">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450838">if</span>&nbsp;<span class="ident" id="6450841">err</span>&nbsp;<span class="op" id="6450845">:=</span>&nbsp;<span class="ident" id="6450848">w</span><span class="op" id="6450849">.</span><span class="ident" id="6450850">Close</span><span class="op" id="6450855">(</span><span class="op" id="6450856">)</span><span class="op" id="6450857">;</span>&nbsp;<span class="ident" id="6450859">err</span>&nbsp;<span class="op" id="6450863">!=</span>&nbsp;<span class="ident" id="6450866">nil</span>&nbsp;<span class="op" id="6450870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450875">t</span><span class="op" id="6450876">.</span><span class="ident" id="6450877">Errorf</span><span class="op" id="6450883">(</span><span class="string" id="6450884">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6450914">,</span>&nbsp;<span class="ident" id="6450916">test</span><span class="op" id="6450920">.</span><span class="ident" id="6450921">desc</span><span class="op" id="6450925">,</span>&nbsp;<span class="ident" id="6450927">err</span><span class="op" id="6450930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450935">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450946">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450950">if</span>&nbsp;<span class="op" id="6450953">!</span><span class="ident" id="6450954">bytes</span><span class="op" id="6450959">.</span><span class="ident" id="6450960">Equal</span><span class="op" id="6450965">(</span><span class="ident" id="6450966">buf</span><span class="op" id="6450969">.</span><span class="ident" id="6450970">Bytes</span><span class="op" id="6450975">(</span><span class="op" id="6450976">)</span><span class="op" id="6450977">,</span>&nbsp;<span class="ident" id="6450979">test</span><span class="op" id="6450983">.</span><span class="ident" id="6450984">raw</span><span class="op" id="6450987">)</span>&nbsp;<span class="op" id="6450989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450994">t</span><span class="op" id="6450995">.</span><span class="ident" id="6450996">Errorf</span><span class="op" id="6451002">(</span><span class="string" id="6451003">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6451028">,</span>&nbsp;<span class="ident" id="6451030">test</span><span class="op" id="6451034">.</span><span class="ident" id="6451035">desc</span><span class="op" id="6451039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451046">}</span><br>
<span class="lineno"></span><span class="op" id="6451048">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6451051">type</span>&nbsp;<span class="ident" id="6451056">writeOnlyConn</span>&nbsp;<span class="keyword" id="6451070">struct</span>&nbsp;<span class="op" id="6451077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451080">buf</span>&nbsp;<span class="op" id="6451084">[</span><span class="op" id="6451085">]</span><span class="builtintype" id="6451086">byte</span><br>
<span class="lineno"></span><span class="op" id="6451091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6451094">func</span>&nbsp;<span class="op" id="6451099">(</span><span class="ident" id="6451100">c</span>&nbsp;<span class="op" id="6451102">*</span><span class="ident" id="6451103">writeOnlyConn</span><span class="op" id="6451116">)</span>&nbsp;<span class="ident" id="6451118">Write</span><span class="op" id="6451123">(</span><span class="ident" id="6451124">p</span>&nbsp;<span class="op" id="6451126">[</span><span class="op" id="6451127">]</span><span class="builtintype" id="6451128">byte</span><span class="op" id="6451132">)</span>&nbsp;<span class="op" id="6451134">(</span><span class="builtintype" id="6451135">int</span><span class="op" id="6451138">,</span>&nbsp;<span class="builtintype" id="6451140">error</span><span class="op" id="6451145">)</span>&nbsp;<span class="op" id="6451147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451150">c</span><span class="op" id="6451151">.</span><span class="ident" id="6451152">buf</span>&nbsp;<span class="op" id="6451156">=</span>&nbsp;<span class="builtinfunc" id="6451158">append</span><span class="op" id="6451164">(</span><span class="ident" id="6451165">c</span><span class="op" id="6451166">.</span><span class="ident" id="6451167">buf</span><span class="op" id="6451170">,</span>&nbsp;<span class="ident" id="6451172">p</span><span class="op" id="6451173">...</span><span class="op" id="6451176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451179">return</span>&nbsp;<span class="builtinfunc" id="6451186">len</span><span class="op" id="6451189">(</span><span class="ident" id="6451190">p</span><span class="op" id="6451191">)</span><span class="op" id="6451192">,</span>&nbsp;<span class="ident" id="6451194">nil</span><br>
<span class="lineno"></span><span class="op" id="6451198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6451201">func</span>&nbsp;<span class="op" id="6451206">(</span><span class="ident" id="6451207">c</span>&nbsp;<span class="op" id="6451209">*</span><span class="ident" id="6451210">writeOnlyConn</span><span class="op" id="6451223">)</span>&nbsp;<span class="ident" id="6451225">Read</span><span class="op" id="6451229">(</span><span class="ident" id="6451230">p</span>&nbsp;<span class="op" id="6451232">[</span><span class="op" id="6451233">]</span><span class="builtintype" id="6451234">byte</span><span class="op" id="6451238">)</span>&nbsp;<span class="op" id="6451240">(</span><span class="builtintype" id="6451241">int</span><span class="op" id="6451244">,</span>&nbsp;<span class="builtintype" id="6451246">error</span><span class="op" id="6451251">)</span>&nbsp;<span class="op" id="6451253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451256">return</span>&nbsp;<span class="num" id="6451263">0</span><span class="op" id="6451264">,</span>&nbsp;<span class="ident" id="6451266">errors</span><span class="op" id="6451272">.</span><span class="ident" id="6451273">New</span><span class="op" id="6451276">(</span><span class="string" id="6451277">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6451297">)</span><br>
<span class="lineno"></span><span class="op" id="6451299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6451302">func</span>&nbsp;<span class="op" id="6451307">(</span><span class="ident" id="6451308">c</span>&nbsp;<span class="op" id="6451310">*</span><span class="ident" id="6451311">writeOnlyConn</span><span class="op" id="6451324">)</span>&nbsp;<span class="ident" id="6451326">Close</span><span class="op" id="6451331">(</span><span class="op" id="6451332">)</span>&nbsp;<span class="builtintype" id="6451334">error</span>&nbsp;<span class="op" id="6451340">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451343">return</span>&nbsp;<span class="ident" id="6451350">nil</span><br>
<span class="lineno"></span><span class="op" id="6451354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6451357">func</span>&nbsp;<span class="ident" id="6451362">TestGetValues</span><span class="op" id="6451375">(</span><span class="ident" id="6451376">t</span>&nbsp;<span class="op" id="6451378">*</span><span class="ident" id="6451379">testing</span><span class="op" id="6451386">.</span><span class="ident" id="6451387">T</span><span class="op" id="6451388">)</span>&nbsp;<span class="op" id="6451390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451393">var</span>&nbsp;<span class="ident" id="6451397">rec</span>&nbsp;<span class="ident" id="6451401">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451409">rec</span><span class="op" id="6451412">.</span><span class="ident" id="6451413">h</span><span class="op" id="6451414">.</span><span class="ident" id="6451415">Type</span>&nbsp;<span class="op" id="6451420">=</span>&nbsp;<span class="ident" id="6451422">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451438">wc</span>&nbsp;<span class="op" id="6451441">:=</span>&nbsp;<span class="builtinfunc" id="6451444">new</span><span class="op" id="6451447">(</span><span class="ident" id="6451448">writeOnlyConn</span><span class="op" id="6451461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451464">c</span>&nbsp;<span class="op" id="6451466">:=</span>&nbsp;<span class="ident" id="6451469">newChild</span><span class="op" id="6451477">(</span><span class="ident" id="6451478">wc</span><span class="op" id="6451480">,</span>&nbsp;<span class="ident" id="6451482">nil</span><span class="op" id="6451485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451488">err</span>&nbsp;<span class="op" id="6451492">:=</span>&nbsp;<span class="ident" id="6451495">c</span><span class="op" id="6451496">.</span><span class="ident" id="6451497">handleRecord</span><span class="op" id="6451509">(</span><span class="op" id="6451510">&amp;</span><span class="ident" id="6451511">rec</span><span class="op" id="6451514">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451517">if</span>&nbsp;<span class="ident" id="6451520">err</span>&nbsp;<span class="op" id="6451524">!=</span>&nbsp;<span class="ident" id="6451527">nil</span>&nbsp;<span class="op" id="6451531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451535">t</span><span class="op" id="6451536">.</span><span class="ident" id="6451537">Fatalf</span><span class="op" id="6451543">(</span><span class="string" id="6451544">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6451562">,</span>&nbsp;<span class="ident" id="6451564">err</span><span class="op" id="6451567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451574">const</span>&nbsp;<span class="ident" id="6451580">want</span>&nbsp;<span class="op" id="6451585">=</span>&nbsp;<span class="string" id="6451587">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6451620">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6451624">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6451651">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6451655">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451713">if</span>&nbsp;<span class="ident" id="6451716">got</span>&nbsp;<span class="op" id="6451720">:=</span>&nbsp;<span class="builtintype" id="6451723">string</span><span class="op" id="6451729">(</span><span class="ident" id="6451730">wc</span><span class="op" id="6451732">.</span><span class="ident" id="6451733">buf</span><span class="op" id="6451736">)</span><span class="op" id="6451737">;</span>&nbsp;<span class="ident" id="6451739">got</span>&nbsp;<span class="op" id="6451743">!=</span>&nbsp;<span class="ident" id="6451746">want</span>&nbsp;<span class="op" id="6451751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451755">t</span><span class="op" id="6451756">.</span><span class="ident" id="6451757">Errorf</span><span class="op" id="6451763">(</span><span class="string" id="6451764">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6451786">,</span>&nbsp;<span class="ident" id="6451788">got</span><span class="op" id="6451791">,</span>&nbsp;<span class="ident" id="6451793">want</span><span class="op" id="6451797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451800">}</span><br>
<span class="lineno">150</span><span class="op" id="6451802">}</span>
</div>
</body>
</html>
