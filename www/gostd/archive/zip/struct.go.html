<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html" class="current">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5958823">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5958878">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5958932">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5958983">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="5959492">package</span>&nbsp;<span class="ident" id="5959500">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959505">import</span>&nbsp;<span class="op" id="5959512">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5959515">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5959521">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5959529">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5959536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5959539">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5959563">const</span>&nbsp;<span class="op" id="5959569">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959572">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5959580">uint16</span>&nbsp;<span class="op" id="5959587">=</span>&nbsp;<span class="num" id="5959589">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959592">Deflate</span>&nbsp;<span class="builtintype" id="5959600">uint16</span>&nbsp;<span class="op" id="5959607">=</span>&nbsp;<span class="num" id="5959609">8</span><br>
<span class="lineno"></span><span class="op" id="5959611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959614">const</span>&nbsp;<span class="op" id="5959620">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959623">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959648">=</span>&nbsp;<span class="num" id="5959650">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959662">directoryHeaderSignature</span>&nbsp;<span class="op" id="5959687">=</span>&nbsp;<span class="num" id="5959689">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959701">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959726">=</span>&nbsp;<span class="num" id="5959728">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959740">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="5959765">=</span>&nbsp;<span class="num" id="5959767">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959779">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="5959804">=</span>&nbsp;<span class="num" id="5959806">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959818">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="5959843">=</span>&nbsp;<span class="num" id="5959845">0x08074b50</span>&nbsp;<span class="comment" id="5959856">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959903">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959928">=</span>&nbsp;<span class="num" id="5959930">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959941">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5959964">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959989">=</span>&nbsp;<span class="num" id="5959991">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960002">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960035">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960060">=</span>&nbsp;<span class="num" id="5960062">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960073">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960087">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960112">=</span>&nbsp;<span class="num" id="5960114">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960125">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960193">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960218">=</span>&nbsp;<span class="num" id="5960220">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960231">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960264">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960289">=</span>&nbsp;<span class="num" id="5960291">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960302">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960306">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960331">=</span>&nbsp;<span class="num" id="5960333">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5960344">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960357">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960408">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960422">=</span>&nbsp;<span class="num" id="5960424">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960427">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5960441">=</span>&nbsp;<span class="num" id="5960443">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960446">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5960460">=</span>&nbsp;<span class="num" id="5960462">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960466">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5960480">=</span>&nbsp;<span class="num" id="5960482">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960486">creatorMacOSX</span>&nbsp;<span class="op" id="5960500">=</span>&nbsp;<span class="num" id="5960502">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960507">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960527">zipVersion20</span>&nbsp;<span class="op" id="5960540">=</span>&nbsp;<span class="num" id="5960542">20</span>&nbsp;<span class="comment" id="5960545">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960553">zipVersion45</span>&nbsp;<span class="op" id="5960566">=</span>&nbsp;<span class="num" id="5960568">45</span>&nbsp;<span class="comment" id="5960571">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960614">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960645">uint16max</span>&nbsp;<span class="op" id="5960655">=</span>&nbsp;<span class="op" id="5960657">(</span><span class="num" id="5960658">1</span>&nbsp;<span class="op" id="5960660">&lt;&lt;</span>&nbsp;<span class="num" id="5960663">16</span><span class="op" id="5960665">)</span>&nbsp;<span class="op" id="5960667">-</span>&nbsp;<span class="num" id="5960669">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960672">uint32max</span>&nbsp;<span class="op" id="5960682">=</span>&nbsp;<span class="op" id="5960684">(</span><span class="num" id="5960685">1</span>&nbsp;<span class="op" id="5960687">&lt;&lt;</span>&nbsp;<span class="num" id="5960690">32</span><span class="op" id="5960692">)</span>&nbsp;<span class="op" id="5960694">-</span>&nbsp;<span class="num" id="5960696">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960700">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960722">zip64ExtraId</span>&nbsp;<span class="op" id="5960735">=</span>&nbsp;<span class="num" id="5960737">0x0001</span>&nbsp;<span class="comment" id="5960744">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="5960786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5960789">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5960839">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="5960872">type</span>&nbsp;<span class="ident" id="5960877">FileHeader</span>&nbsp;<span class="keyword" id="5960888">struct</span>&nbsp;<span class="op" id="5960895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960898">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960932">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5960995">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5961059">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961076">Name</span>&nbsp;<span class="builtintype" id="5961081">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961090">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961109">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961117">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961136">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961144">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961163">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961171">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961190">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961198">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961217">uint16</span>&nbsp;<span class="comment" id="5961224">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961240">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961259">uint16</span>&nbsp;<span class="comment" id="5961266">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961282">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961301">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961309">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961328">uint32</span>&nbsp;<span class="comment" id="5961335">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961372">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961391">uint32</span>&nbsp;<span class="comment" id="5961398">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961437">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5961456">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961464">UncompressedSize64</span>&nbsp;<span class="ident" id="5961483">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961491">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961510">[</span><span class="op" id="5961511">]</span><span class="builtintype" id="5961512">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961518">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961537">uint32</span>&nbsp;<span class="comment" id="5961544">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961582">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5961601">string</span><br>
<span class="lineno"></span><span class="op" id="5961608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961611">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5961666">func</span>&nbsp;<span class="op" id="5961671">(</span><span class="ident" id="5961672">h</span>&nbsp;<span class="op" id="5961674">*</span><span class="ident" id="5961675">FileHeader</span><span class="op" id="5961685">)</span>&nbsp;<span class="ident" id="5961687">FileInfo</span><span class="op" id="5961695">(</span><span class="op" id="5961696">)</span>&nbsp;<span class="ident" id="5961698">os</span><span class="op" id="5961700">.</span><span class="ident" id="5961701">FileInfo</span>&nbsp;<span class="op" id="5961710">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961713">return</span>&nbsp;<span class="ident" id="5961720">headerFileInfo</span><span class="op" id="5961734">{</span><span class="ident" id="5961735">h</span><span class="op" id="5961736">}</span><br>
<span class="lineno"></span><span class="op" id="5961738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961741">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5961783">type</span>&nbsp;<span class="ident" id="5961788">headerFileInfo</span>&nbsp;<span class="keyword" id="5961803">struct</span>&nbsp;<span class="op" id="5961810">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961813">fh</span>&nbsp;<span class="op" id="5961816">*</span><span class="ident" id="5961817">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="5961828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5961831">func</span>&nbsp;<span class="op" id="5961836">(</span><span class="ident" id="5961837">fi</span>&nbsp;<span class="ident" id="5961840">headerFileInfo</span><span class="op" id="5961854">)</span>&nbsp;<span class="ident" id="5961856">Name</span><span class="op" id="5961860">(</span><span class="op" id="5961861">)</span>&nbsp;<span class="builtintype" id="5961863">string</span>&nbsp;<span class="op" id="5961870">{</span>&nbsp;<span class="keyword" id="5961872">return</span>&nbsp;<span class="ident" id="5961879">path</span><span class="op" id="5961883">.</span><span class="ident" id="5961884">Base</span><span class="op" id="5961888">(</span><span class="ident" id="5961889">fi</span><span class="op" id="5961891">.</span><span class="ident" id="5961892">fh</span><span class="op" id="5961894">.</span><span class="ident" id="5961895">Name</span><span class="op" id="5961899">)</span>&nbsp;<span class="op" id="5961901">}</span><br>
<span class="lineno"></span><span class="keyword" id="5961903">func</span>&nbsp;<span class="op" id="5961908">(</span><span class="ident" id="5961909">fi</span>&nbsp;<span class="ident" id="5961912">headerFileInfo</span><span class="op" id="5961926">)</span>&nbsp;<span class="ident" id="5961928">Size</span><span class="op" id="5961932">(</span><span class="op" id="5961933">)</span>&nbsp;<span class="ident" id="5961935">int64</span>&nbsp;<span class="op" id="5961941">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961944">if</span>&nbsp;<span class="ident" id="5961947">fi</span><span class="op" id="5961949">.</span><span class="ident" id="5961950">fh</span><span class="op" id="5961952">.</span><span class="ident" id="5961953">UncompressedSize64</span>&nbsp;<span class="op" id="5961972">&gt;</span>&nbsp;<span class="num" id="5961974">0</span>&nbsp;<span class="op" id="5961976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961980">return</span>&nbsp;<span class="ident" id="5961987">int64</span><span class="op" id="5961992">(</span><span class="ident" id="5961993">fi</span><span class="op" id="5961995">.</span><span class="ident" id="5961996">fh</span><span class="op" id="5961998">.</span><span class="ident" id="5961999">UncompressedSize64</span><span class="op" id="5962017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962023">return</span>&nbsp;<span class="ident" id="5962030">int64</span><span class="op" id="5962035">(</span><span class="ident" id="5962036">fi</span><span class="op" id="5962038">.</span><span class="ident" id="5962039">fh</span><span class="op" id="5962041">.</span><span class="ident" id="5962042">UncompressedSize</span><span class="op" id="5962058">)</span><br>
<span class="lineno"></span><span class="op" id="5962060">}</span><br>
<span class="lineno">110</span><span class="keyword" id="5962062">func</span>&nbsp;<span class="op" id="5962067">(</span><span class="ident" id="5962068">fi</span>&nbsp;<span class="ident" id="5962071">headerFileInfo</span><span class="op" id="5962085">)</span>&nbsp;<span class="ident" id="5962087">IsDir</span><span class="op" id="5962092">(</span><span class="op" id="5962093">)</span>&nbsp;<span class="builtintype" id="5962095">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5962107">{</span>&nbsp;<span class="keyword" id="5962109">return</span>&nbsp;<span class="ident" id="5962116">fi</span><span class="op" id="5962118">.</span><span class="ident" id="5962119">Mode</span><span class="op" id="5962123">(</span><span class="op" id="5962124">)</span><span class="op" id="5962125">.</span><span class="ident" id="5962126">IsDir</span><span class="op" id="5962131">(</span><span class="op" id="5962132">)</span>&nbsp;<span class="op" id="5962134">}</span><br>
<span class="lineno"></span><span class="keyword" id="5962136">func</span>&nbsp;<span class="op" id="5962141">(</span><span class="ident" id="5962142">fi</span>&nbsp;<span class="ident" id="5962145">headerFileInfo</span><span class="op" id="5962159">)</span>&nbsp;<span class="ident" id="5962161">ModTime</span><span class="op" id="5962168">(</span><span class="op" id="5962169">)</span>&nbsp;<span class="ident" id="5962171">time</span><span class="op" id="5962175">.</span><span class="ident" id="5962176">Time</span>&nbsp;<span class="op" id="5962181">{</span>&nbsp;<span class="keyword" id="5962183">return</span>&nbsp;<span class="ident" id="5962190">fi</span><span class="op" id="5962192">.</span><span class="ident" id="5962193">fh</span><span class="op" id="5962195">.</span><span class="ident" id="5962196">ModTime</span><span class="op" id="5962203">(</span><span class="op" id="5962204">)</span>&nbsp;<span class="op" id="5962206">}</span><br>
<span class="lineno"></span><span class="keyword" id="5962208">func</span>&nbsp;<span class="op" id="5962213">(</span><span class="ident" id="5962214">fi</span>&nbsp;<span class="ident" id="5962217">headerFileInfo</span><span class="op" id="5962231">)</span>&nbsp;<span class="ident" id="5962233">Mode</span><span class="op" id="5962237">(</span><span class="op" id="5962238">)</span>&nbsp;<span class="ident" id="5962240">os</span><span class="op" id="5962242">.</span><span class="ident" id="5962243">FileMode</span>&nbsp;&nbsp;<span class="op" id="5962253">{</span>&nbsp;<span class="keyword" id="5962255">return</span>&nbsp;<span class="ident" id="5962262">fi</span><span class="op" id="5962264">.</span><span class="ident" id="5962265">fh</span><span class="op" id="5962267">.</span><span class="ident" id="5962268">Mode</span><span class="op" id="5962272">(</span><span class="op" id="5962273">)</span>&nbsp;<span class="op" id="5962275">}</span><br>
<span class="lineno"></span><span class="keyword" id="5962277">func</span>&nbsp;<span class="op" id="5962282">(</span><span class="ident" id="5962283">fi</span>&nbsp;<span class="ident" id="5962286">headerFileInfo</span><span class="op" id="5962300">)</span>&nbsp;<span class="ident" id="5962302">Sys</span><span class="op" id="5962305">(</span><span class="op" id="5962306">)</span>&nbsp;<span class="keyword" id="5962308">interface</span><span class="op" id="5962317">{</span><span class="op" id="5962318">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5962322">{</span>&nbsp;<span class="keyword" id="5962324">return</span>&nbsp;<span class="ident" id="5962331">fi</span><span class="op" id="5962333">.</span><span class="ident" id="5962334">fh</span>&nbsp;<span class="op" id="5962337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5962340">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5962407">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5962423">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5962490">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5962561">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="5962630">func</span>&nbsp;<span class="ident" id="5962635">FileInfoHeader</span><span class="op" id="5962649">(</span><span class="ident" id="5962650">fi</span>&nbsp;<span class="ident" id="5962653">os</span><span class="op" id="5962655">.</span><span class="ident" id="5962656">FileInfo</span><span class="op" id="5962664">)</span>&nbsp;<span class="op" id="5962666">(</span><span class="op" id="5962667">*</span><span class="ident" id="5962668">FileHeader</span><span class="op" id="5962678">,</span>&nbsp;<span class="builtintype" id="5962680">error</span><span class="op" id="5962685">)</span>&nbsp;<span class="op" id="5962687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962690">size</span>&nbsp;<span class="op" id="5962695">:=</span>&nbsp;<span class="ident" id="5962698">fi</span><span class="op" id="5962700">.</span><span class="ident" id="5962701">Size</span><span class="op" id="5962705">(</span><span class="op" id="5962706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962709">fh</span>&nbsp;<span class="op" id="5962712">:=</span>&nbsp;<span class="op" id="5962715">&amp;</span><span class="ident" id="5962716">FileHeader</span><span class="op" id="5962726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962730">Name</span><span class="op" id="5962734">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5962750">fi</span><span class="op" id="5962752">.</span><span class="ident" id="5962753">Name</span><span class="op" id="5962757">(</span><span class="op" id="5962758">)</span><span class="op" id="5962759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962763">UncompressedSize64</span><span class="op" id="5962781">:</span>&nbsp;<span class="ident" id="5962783">uint64</span><span class="op" id="5962789">(</span><span class="ident" id="5962790">size</span><span class="op" id="5962794">)</span><span class="op" id="5962795">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962801">fh</span><span class="op" id="5962803">.</span><span class="ident" id="5962804">SetModTime</span><span class="op" id="5962814">(</span><span class="ident" id="5962815">fi</span><span class="op" id="5962817">.</span><span class="ident" id="5962818">ModTime</span><span class="op" id="5962825">(</span><span class="op" id="5962826">)</span><span class="op" id="5962827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962830">fh</span><span class="op" id="5962832">.</span><span class="ident" id="5962833">SetMode</span><span class="op" id="5962840">(</span><span class="ident" id="5962841">fi</span><span class="op" id="5962843">.</span><span class="ident" id="5962844">Mode</span><span class="op" id="5962848">(</span><span class="op" id="5962849">)</span><span class="op" id="5962850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962853">if</span>&nbsp;<span class="ident" id="5962856">fh</span><span class="op" id="5962858">.</span><span class="ident" id="5962859">UncompressedSize64</span>&nbsp;<span class="op" id="5962878">&gt;</span>&nbsp;<span class="ident" id="5962880">uint32max</span>&nbsp;<span class="op" id="5962890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962894">fh</span><span class="op" id="5962896">.</span><span class="ident" id="5962897">UncompressedSize</span>&nbsp;<span class="op" id="5962914">=</span>&nbsp;<span class="ident" id="5962916">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962927">}</span>&nbsp;<span class="keyword" id="5962929">else</span>&nbsp;<span class="op" id="5962934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962938">fh</span><span class="op" id="5962940">.</span><span class="ident" id="5962941">UncompressedSize</span>&nbsp;<span class="op" id="5962958">=</span>&nbsp;<span class="builtintype" id="5962960">uint32</span><span class="op" id="5962966">(</span><span class="ident" id="5962967">fh</span><span class="op" id="5962969">.</span><span class="ident" id="5962970">UncompressedSize64</span><span class="op" id="5962988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962994">return</span>&nbsp;<span class="ident" id="5963001">fh</span><span class="op" id="5963003">,</span>&nbsp;<span class="ident" id="5963005">nil</span><br>
<span class="lineno"></span><span class="op" id="5963009">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5963012">type</span>&nbsp;<span class="ident" id="5963017">directoryEnd</span>&nbsp;<span class="keyword" id="5963030">struct</span>&nbsp;<span class="op" id="5963037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963040">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5963059">uint32</span>&nbsp;<span class="comment" id="5963066">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963077">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5963096">uint32</span>&nbsp;<span class="comment" id="5963103">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963114">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="5963133">uint64</span>&nbsp;<span class="comment" id="5963140">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963151">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5963170">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963178">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963197">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963205">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5963224">uint64</span>&nbsp;<span class="comment" id="5963231">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963252">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5963271">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963279">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5963298">string</span><br>
<span class="lineno">145</span><span class="op" id="5963305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963308">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="5963378">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5963403">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="5963474">func</span>&nbsp;<span class="ident" id="5963479">msDosTimeToTime</span><span class="op" id="5963494">(</span><span class="ident" id="5963495">dosDate</span><span class="op" id="5963502">,</span>&nbsp;<span class="ident" id="5963504">dosTime</span>&nbsp;<span class="builtintype" id="5963512">uint16</span><span class="op" id="5963518">)</span>&nbsp;<span class="ident" id="5963520">time</span><span class="op" id="5963524">.</span><span class="ident" id="5963525">Time</span>&nbsp;<span class="op" id="5963530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963533">return</span>&nbsp;<span class="ident" id="5963540">time</span><span class="op" id="5963544">.</span><span class="ident" id="5963545">Date</span><span class="op" id="5963549">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963553">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5963622">int</span><span class="op" id="5963625">(</span><span class="ident" id="5963626">dosDate</span><span class="op" id="5963633">&gt;&gt;</span><span class="num" id="5963635">9</span><span class="op" id="5963636">+</span><span class="num" id="5963637">1980</span><span class="op" id="5963641">)</span><span class="op" id="5963642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963646">time</span><span class="op" id="5963650">.</span><span class="ident" id="5963651">Month</span><span class="op" id="5963656">(</span><span class="ident" id="5963657">dosDate</span><span class="op" id="5963664">&gt;&gt;</span><span class="num" id="5963666">5</span><span class="op" id="5963667">&amp;</span><span class="num" id="5963668">0xf</span><span class="op" id="5963671">)</span><span class="op" id="5963672">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5963676">int</span><span class="op" id="5963679">(</span><span class="ident" id="5963680">dosDate</span><span class="op" id="5963687">&amp;</span><span class="num" id="5963688">0x1f</span><span class="op" id="5963692">)</span><span class="op" id="5963693">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5963698">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5963754">int</span><span class="op" id="5963757">(</span><span class="ident" id="5963758">dosTime</span><span class="op" id="5963765">&gt;&gt;</span><span class="num" id="5963767">11</span><span class="op" id="5963769">)</span><span class="op" id="5963770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5963774">int</span><span class="op" id="5963777">(</span><span class="ident" id="5963778">dosTime</span><span class="op" id="5963785">&gt;&gt;</span><span class="num" id="5963787">5</span><span class="op" id="5963788">&amp;</span><span class="num" id="5963789">0x3f</span><span class="op" id="5963793">)</span><span class="op" id="5963794">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5963798">int</span><span class="op" id="5963801">(</span><span class="ident" id="5963802">dosTime</span><span class="op" id="5963809">&amp;</span><span class="num" id="5963810">0x1f</span><span class="op" id="5963814">*</span><span class="num" id="5963815">2</span><span class="op" id="5963816">)</span><span class="op" id="5963817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5963821">0</span><span class="op" id="5963822">,</span>&nbsp;<span class="comment" id="5963824">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963842">time</span><span class="op" id="5963846">.</span><span class="ident" id="5963847">UTC</span><span class="op" id="5963850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963853">)</span><br>
<span class="lineno">165</span><span class="op" id="5963855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963858">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5963926">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5963951">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="5964022">func</span>&nbsp;<span class="ident" id="5964027">timeToMsDosTime</span><span class="op" id="5964042">(</span><span class="ident" id="5964043">t</span>&nbsp;<span class="ident" id="5964045">time</span><span class="op" id="5964049">.</span><span class="ident" id="5964050">Time</span><span class="op" id="5964054">)</span>&nbsp;<span class="op" id="5964056">(</span><span class="ident" id="5964057">fDate</span>&nbsp;<span class="builtintype" id="5964063">uint16</span><span class="op" id="5964069">,</span>&nbsp;<span class="ident" id="5964071">fTime</span>&nbsp;<span class="builtintype" id="5964077">uint16</span><span class="op" id="5964083">)</span>&nbsp;<span class="op" id="5964085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964088">t</span>&nbsp;<span class="op" id="5964090">=</span>&nbsp;<span class="ident" id="5964092">t</span><span class="op" id="5964093">.</span><span class="ident" id="5964094">In</span><span class="op" id="5964096">(</span><span class="ident" id="5964097">time</span><span class="op" id="5964101">.</span><span class="ident" id="5964102">UTC</span><span class="op" id="5964105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964108">fDate</span>&nbsp;<span class="op" id="5964114">=</span>&nbsp;<span class="builtintype" id="5964116">uint16</span><span class="op" id="5964122">(</span><span class="ident" id="5964123">t</span><span class="op" id="5964124">.</span><span class="ident" id="5964125">Day</span><span class="op" id="5964128">(</span><span class="op" id="5964129">)</span>&nbsp;<span class="op" id="5964131">+</span>&nbsp;<span class="builtintype" id="5964133">int</span><span class="op" id="5964136">(</span><span class="ident" id="5964137">t</span><span class="op" id="5964138">.</span><span class="ident" id="5964139">Month</span><span class="op" id="5964144">(</span><span class="op" id="5964145">)</span><span class="op" id="5964146">)</span><span class="op" id="5964147">&lt;&lt;</span><span class="num" id="5964149">5</span>&nbsp;<span class="op" id="5964151">+</span>&nbsp;<span class="op" id="5964153">(</span><span class="ident" id="5964154">t</span><span class="op" id="5964155">.</span><span class="ident" id="5964156">Year</span><span class="op" id="5964160">(</span><span class="op" id="5964161">)</span><span class="op" id="5964162">-</span><span class="num" id="5964163">1980</span><span class="op" id="5964167">)</span><span class="op" id="5964168">&lt;&lt;</span><span class="num" id="5964170">9</span><span class="op" id="5964171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964174">fTime</span>&nbsp;<span class="op" id="5964180">=</span>&nbsp;<span class="builtintype" id="5964182">uint16</span><span class="op" id="5964188">(</span><span class="ident" id="5964189">t</span><span class="op" id="5964190">.</span><span class="ident" id="5964191">Second</span><span class="op" id="5964197">(</span><span class="op" id="5964198">)</span><span class="op" id="5964199">/</span><span class="num" id="5964200">2</span>&nbsp;<span class="op" id="5964202">+</span>&nbsp;<span class="ident" id="5964204">t</span><span class="op" id="5964205">.</span><span class="ident" id="5964206">Minute</span><span class="op" id="5964212">(</span><span class="op" id="5964213">)</span><span class="op" id="5964214">&lt;&lt;</span><span class="num" id="5964216">5</span>&nbsp;<span class="op" id="5964218">+</span>&nbsp;<span class="ident" id="5964220">t</span><span class="op" id="5964221">.</span><span class="ident" id="5964222">Hour</span><span class="op" id="5964226">(</span><span class="op" id="5964227">)</span><span class="op" id="5964228">&lt;&lt;</span><span class="num" id="5964230">11</span><span class="op" id="5964232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964235">return</span><br>
<span class="lineno">175</span><span class="op" id="5964242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964245">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5964294">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="5964319">func</span>&nbsp;<span class="op" id="5964324">(</span><span class="ident" id="5964325">h</span>&nbsp;<span class="op" id="5964327">*</span><span class="ident" id="5964328">FileHeader</span><span class="op" id="5964338">)</span>&nbsp;<span class="ident" id="5964340">ModTime</span><span class="op" id="5964347">(</span><span class="op" id="5964348">)</span>&nbsp;<span class="ident" id="5964350">time</span><span class="op" id="5964354">.</span><span class="ident" id="5964355">Time</span>&nbsp;<span class="op" id="5964360">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964363">return</span>&nbsp;<span class="ident" id="5964370">msDosTimeToTime</span><span class="op" id="5964385">(</span><span class="ident" id="5964386">h</span><span class="op" id="5964387">.</span><span class="ident" id="5964388">ModifiedDate</span><span class="op" id="5964400">,</span>&nbsp;<span class="ident" id="5964402">h</span><span class="op" id="5964403">.</span><span class="ident" id="5964404">ModifiedTime</span><span class="op" id="5964416">)</span><br>
<span class="lineno"></span><span class="op" id="5964418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964421">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5964507">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="5964532">func</span>&nbsp;<span class="op" id="5964537">(</span><span class="ident" id="5964538">h</span>&nbsp;<span class="op" id="5964540">*</span><span class="ident" id="5964541">FileHeader</span><span class="op" id="5964551">)</span>&nbsp;<span class="ident" id="5964553">SetModTime</span><span class="op" id="5964563">(</span><span class="ident" id="5964564">t</span>&nbsp;<span class="ident" id="5964566">time</span><span class="op" id="5964570">.</span><span class="ident" id="5964571">Time</span><span class="op" id="5964575">)</span>&nbsp;<span class="op" id="5964577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964580">h</span><span class="op" id="5964581">.</span><span class="ident" id="5964582">ModifiedDate</span><span class="op" id="5964594">,</span>&nbsp;<span class="ident" id="5964596">h</span><span class="op" id="5964597">.</span><span class="ident" id="5964598">ModifiedTime</span>&nbsp;<span class="op" id="5964611">=</span>&nbsp;<span class="ident" id="5964613">timeToMsDosTime</span><span class="op" id="5964628">(</span><span class="ident" id="5964629">t</span><span class="op" id="5964630">)</span><br>
<span class="lineno"></span><span class="op" id="5964632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5964635">const</span>&nbsp;<span class="op" id="5964641">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964644">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5964704">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964760">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5964769">=</span>&nbsp;<span class="num" id="5964771">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964779">s_IFSOCK</span>&nbsp;<span class="op" id="5964788">=</span>&nbsp;<span class="num" id="5964790">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964798">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="5964807">=</span>&nbsp;<span class="num" id="5964809">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964817">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="5964826">=</span>&nbsp;<span class="num" id="5964828">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964836">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="5964845">=</span>&nbsp;<span class="num" id="5964847">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964855">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="5964864">=</span>&nbsp;<span class="num" id="5964866">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964874">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="5964883">=</span>&nbsp;<span class="num" id="5964885">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964893">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="5964902">=</span>&nbsp;<span class="num" id="5964904">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964912">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="5964921">=</span>&nbsp;<span class="num" id="5964923">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964930">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="5964939">=</span>&nbsp;<span class="num" id="5964941">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964948">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5964957">=</span>&nbsp;<span class="num" id="5964959">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964967">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5964981">=</span>&nbsp;<span class="num" id="5964983">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964989">msdosReadOnly</span>&nbsp;<span class="op" id="5965003">=</span>&nbsp;<span class="num" id="5965005">0x01</span><br>
<span class="lineno"></span><span class="op" id="5965010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965013">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5965078">func</span>&nbsp;<span class="op" id="5965083">(</span><span class="ident" id="5965084">h</span>&nbsp;<span class="op" id="5965086">*</span><span class="ident" id="5965087">FileHeader</span><span class="op" id="5965097">)</span>&nbsp;<span class="ident" id="5965099">Mode</span><span class="op" id="5965103">(</span><span class="op" id="5965104">)</span>&nbsp;<span class="op" id="5965106">(</span><span class="ident" id="5965107">mode</span>&nbsp;<span class="ident" id="5965112">os</span><span class="op" id="5965114">.</span><span class="ident" id="5965115">FileMode</span><span class="op" id="5965123">)</span>&nbsp;<span class="op" id="5965125">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965128">switch</span>&nbsp;<span class="ident" id="5965135">h</span><span class="op" id="5965136">.</span><span class="ident" id="5965137">CreatorVersion</span>&nbsp;<span class="op" id="5965152">&gt;&gt;</span>&nbsp;<span class="num" id="5965155">8</span>&nbsp;<span class="op" id="5965157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965160">case</span>&nbsp;<span class="ident" id="5965165">creatorUnix</span><span class="op" id="5965176">,</span>&nbsp;<span class="ident" id="5965178">creatorMacOSX</span><span class="op" id="5965191">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965195">mode</span>&nbsp;<span class="op" id="5965200">=</span>&nbsp;<span class="ident" id="5965202">unixModeToFileMode</span><span class="op" id="5965220">(</span><span class="ident" id="5965221">h</span><span class="op" id="5965222">.</span><span class="ident" id="5965223">ExternalAttrs</span>&nbsp;<span class="op" id="5965237">&gt;&gt;</span>&nbsp;<span class="num" id="5965240">16</span><span class="op" id="5965242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965245">case</span>&nbsp;<span class="ident" id="5965250">creatorNTFS</span><span class="op" id="5965261">,</span>&nbsp;<span class="ident" id="5965263">creatorVFAT</span><span class="op" id="5965274">,</span>&nbsp;<span class="ident" id="5965276">creatorFAT</span><span class="op" id="5965286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965290">mode</span>&nbsp;<span class="op" id="5965295">=</span>&nbsp;<span class="ident" id="5965297">msdosModeToFileMode</span><span class="op" id="5965316">(</span><span class="ident" id="5965317">h</span><span class="op" id="5965318">.</span><span class="ident" id="5965319">ExternalAttrs</span><span class="op" id="5965332">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965338">if</span>&nbsp;<span class="builtinfunc" id="5965341">len</span><span class="op" id="5965344">(</span><span class="ident" id="5965345">h</span><span class="op" id="5965346">.</span><span class="ident" id="5965347">Name</span><span class="op" id="5965351">)</span>&nbsp;<span class="op" id="5965353">&gt;</span>&nbsp;<span class="num" id="5965355">0</span>&nbsp;<span class="op" id="5965357">&amp;&amp;</span>&nbsp;<span class="ident" id="5965360">h</span><span class="op" id="5965361">.</span><span class="ident" id="5965362">Name</span><span class="op" id="5965366">[</span><span class="builtinfunc" id="5965367">len</span><span class="op" id="5965370">(</span><span class="ident" id="5965371">h</span><span class="op" id="5965372">.</span><span class="ident" id="5965373">Name</span><span class="op" id="5965377">)</span><span class="op" id="5965378">-</span><span class="num" id="5965379">1</span><span class="op" id="5965380">]</span>&nbsp;<span class="op" id="5965382">==</span>&nbsp;<span class="string" id="5965385">&#39;/&#39;</span>&nbsp;<span class="op" id="5965389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965393">mode</span>&nbsp;<span class="op" id="5965398">|=</span>&nbsp;<span class="ident" id="5965401">os</span><span class="op" id="5965403">.</span><span class="ident" id="5965404">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965416">return</span>&nbsp;<span class="ident" id="5965423">mode</span><br>
<span class="lineno">220</span><span class="op" id="5965428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965431">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5965499">func</span>&nbsp;<span class="op" id="5965504">(</span><span class="ident" id="5965505">h</span>&nbsp;<span class="op" id="5965507">*</span><span class="ident" id="5965508">FileHeader</span><span class="op" id="5965518">)</span>&nbsp;<span class="ident" id="5965520">SetMode</span><span class="op" id="5965527">(</span><span class="ident" id="5965528">mode</span>&nbsp;<span class="ident" id="5965533">os</span><span class="op" id="5965535">.</span><span class="ident" id="5965536">FileMode</span><span class="op" id="5965544">)</span>&nbsp;<span class="op" id="5965546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965549">h</span><span class="op" id="5965550">.</span><span class="ident" id="5965551">CreatorVersion</span>&nbsp;<span class="op" id="5965566">=</span>&nbsp;<span class="ident" id="5965568">h</span><span class="op" id="5965569">.</span><span class="ident" id="5965570">CreatorVersion</span><span class="op" id="5965584">&amp;</span><span class="num" id="5965585">0xff</span>&nbsp;<span class="op" id="5965590">|</span>&nbsp;<span class="ident" id="5965592">creatorUnix</span><span class="op" id="5965603">&lt;&lt;</span><span class="num" id="5965605">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965608">h</span><span class="op" id="5965609">.</span><span class="ident" id="5965610">ExternalAttrs</span>&nbsp;<span class="op" id="5965624">=</span>&nbsp;<span class="ident" id="5965626">fileModeToUnixMode</span><span class="op" id="5965644">(</span><span class="ident" id="5965645">mode</span><span class="op" id="5965649">)</span>&nbsp;<span class="op" id="5965651">&lt;&lt;</span>&nbsp;<span class="num" id="5965654">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965659">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965715">if</span>&nbsp;<span class="ident" id="5965718">mode</span><span class="op" id="5965722">&amp;</span><span class="ident" id="5965723">os</span><span class="op" id="5965725">.</span><span class="ident" id="5965726">ModeDir</span>&nbsp;<span class="op" id="5965734">!=</span>&nbsp;<span class="num" id="5965737">0</span>&nbsp;<span class="op" id="5965739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965743">h</span><span class="op" id="5965744">.</span><span class="ident" id="5965745">ExternalAttrs</span>&nbsp;<span class="op" id="5965759">|=</span>&nbsp;<span class="ident" id="5965762">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965775">if</span>&nbsp;<span class="ident" id="5965778">mode</span><span class="op" id="5965782">&amp;</span><span class="num" id="5965783">0200</span>&nbsp;<span class="op" id="5965788">==</span>&nbsp;<span class="num" id="5965791">0</span>&nbsp;<span class="op" id="5965793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965797">h</span><span class="op" id="5965798">.</span><span class="ident" id="5965799">ExternalAttrs</span>&nbsp;<span class="op" id="5965813">|=</span>&nbsp;<span class="ident" id="5965816">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965831">}</span><br>
<span class="lineno"></span><span class="op" id="5965833">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5965836">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="5965902">func</span>&nbsp;<span class="op" id="5965907">(</span><span class="ident" id="5965908">fh</span>&nbsp;<span class="op" id="5965911">*</span><span class="ident" id="5965912">FileHeader</span><span class="op" id="5965922">)</span>&nbsp;<span class="ident" id="5965924">isZip64</span><span class="op" id="5965931">(</span><span class="op" id="5965932">)</span>&nbsp;<span class="builtintype" id="5965934">bool</span>&nbsp;<span class="op" id="5965939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965942">return</span>&nbsp;<span class="ident" id="5965949">fh</span><span class="op" id="5965951">.</span><span class="ident" id="5965952">CompressedSize64</span>&nbsp;<span class="op" id="5965969">&gt;</span>&nbsp;<span class="ident" id="5965971">uint32max</span>&nbsp;<span class="op" id="5965981">||</span>&nbsp;<span class="ident" id="5965984">fh</span><span class="op" id="5965986">.</span><span class="ident" id="5965987">UncompressedSize64</span>&nbsp;<span class="op" id="5966006">&gt;</span>&nbsp;<span class="ident" id="5966008">uint32max</span><br>
<span class="lineno"></span><span class="op" id="5966018">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5966021">func</span>&nbsp;<span class="ident" id="5966026">msdosModeToFileMode</span><span class="op" id="5966045">(</span><span class="ident" id="5966046">m</span>&nbsp;<span class="builtintype" id="5966048">uint32</span><span class="op" id="5966054">)</span>&nbsp;<span class="op" id="5966056">(</span><span class="ident" id="5966057">mode</span>&nbsp;<span class="ident" id="5966062">os</span><span class="op" id="5966064">.</span><span class="ident" id="5966065">FileMode</span><span class="op" id="5966073">)</span>&nbsp;<span class="op" id="5966075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966078">if</span>&nbsp;<span class="ident" id="5966081">m</span><span class="op" id="5966082">&amp;</span><span class="ident" id="5966083">msdosDir</span>&nbsp;<span class="op" id="5966092">!=</span>&nbsp;<span class="num" id="5966095">0</span>&nbsp;<span class="op" id="5966097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966101">mode</span>&nbsp;<span class="op" id="5966106">=</span>&nbsp;<span class="ident" id="5966108">os</span><span class="op" id="5966110">.</span><span class="ident" id="5966111">ModeDir</span>&nbsp;<span class="op" id="5966119">|</span>&nbsp;<span class="num" id="5966121">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966127">}</span>&nbsp;<span class="keyword" id="5966129">else</span>&nbsp;<span class="op" id="5966134">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966138">mode</span>&nbsp;<span class="op" id="5966143">=</span>&nbsp;<span class="num" id="5966145">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966154">if</span>&nbsp;<span class="ident" id="5966157">m</span><span class="op" id="5966158">&amp;</span><span class="ident" id="5966159">msdosReadOnly</span>&nbsp;<span class="op" id="5966173">!=</span>&nbsp;<span class="num" id="5966176">0</span>&nbsp;<span class="op" id="5966178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966182">mode</span>&nbsp;<span class="op" id="5966187">&amp;^=</span>&nbsp;<span class="num" id="5966191">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966197">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966200">return</span>&nbsp;<span class="ident" id="5966207">mode</span><br>
<span class="lineno"></span><span class="op" id="5966212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5966215">func</span>&nbsp;<span class="ident" id="5966220">fileModeToUnixMode</span><span class="op" id="5966238">(</span><span class="ident" id="5966239">mode</span>&nbsp;<span class="ident" id="5966244">os</span><span class="op" id="5966246">.</span><span class="ident" id="5966247">FileMode</span><span class="op" id="5966255">)</span>&nbsp;<span class="builtintype" id="5966257">uint32</span>&nbsp;<span class="op" id="5966264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966267">var</span>&nbsp;<span class="ident" id="5966271">m</span>&nbsp;<span class="builtintype" id="5966273">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966281">switch</span>&nbsp;<span class="ident" id="5966288">mode</span>&nbsp;<span class="op" id="5966293">&amp;</span>&nbsp;<span class="ident" id="5966295">os</span><span class="op" id="5966297">.</span><span class="ident" id="5966298">ModeType</span>&nbsp;<span class="op" id="5966307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966310">default</span><span class="op" id="5966317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966321">m</span>&nbsp;<span class="op" id="5966323">=</span>&nbsp;<span class="ident" id="5966325">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966334">case</span>&nbsp;<span class="ident" id="5966339">os</span><span class="op" id="5966341">.</span><span class="ident" id="5966342">ModeDir</span><span class="op" id="5966349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966353">m</span>&nbsp;<span class="op" id="5966355">=</span>&nbsp;<span class="ident" id="5966357">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966366">case</span>&nbsp;<span class="ident" id="5966371">os</span><span class="op" id="5966373">.</span><span class="ident" id="5966374">ModeSymlink</span><span class="op" id="5966385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966389">m</span>&nbsp;<span class="op" id="5966391">=</span>&nbsp;<span class="ident" id="5966393">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966402">case</span>&nbsp;<span class="ident" id="5966407">os</span><span class="op" id="5966409">.</span><span class="ident" id="5966410">ModeNamedPipe</span><span class="op" id="5966423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966427">m</span>&nbsp;<span class="op" id="5966429">=</span>&nbsp;<span class="ident" id="5966431">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966440">case</span>&nbsp;<span class="ident" id="5966445">os</span><span class="op" id="5966447">.</span><span class="ident" id="5966448">ModeSocket</span><span class="op" id="5966458">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966462">m</span>&nbsp;<span class="op" id="5966464">=</span>&nbsp;<span class="ident" id="5966466">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966476">case</span>&nbsp;<span class="ident" id="5966481">os</span><span class="op" id="5966483">.</span><span class="ident" id="5966484">ModeDevice</span><span class="op" id="5966494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966498">if</span>&nbsp;<span class="ident" id="5966501">mode</span><span class="op" id="5966505">&amp;</span><span class="ident" id="5966506">os</span><span class="op" id="5966508">.</span><span class="ident" id="5966509">ModeCharDevice</span>&nbsp;<span class="op" id="5966524">!=</span>&nbsp;<span class="num" id="5966527">0</span>&nbsp;<span class="op" id="5966529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966534">m</span>&nbsp;<span class="op" id="5966536">=</span>&nbsp;<span class="ident" id="5966538">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966548">}</span>&nbsp;<span class="keyword" id="5966550">else</span>&nbsp;<span class="op" id="5966555">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966560">m</span>&nbsp;<span class="op" id="5966562">=</span>&nbsp;<span class="ident" id="5966564">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966580">if</span>&nbsp;<span class="ident" id="5966583">mode</span><span class="op" id="5966587">&amp;</span><span class="ident" id="5966588">os</span><span class="op" id="5966590">.</span><span class="ident" id="5966591">ModeSetuid</span>&nbsp;<span class="op" id="5966602">!=</span>&nbsp;<span class="num" id="5966605">0</span>&nbsp;<span class="op" id="5966607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966611">m</span>&nbsp;<span class="op" id="5966613">|=</span>&nbsp;<span class="ident" id="5966616">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966628">if</span>&nbsp;<span class="ident" id="5966631">mode</span><span class="op" id="5966635">&amp;</span><span class="ident" id="5966636">os</span><span class="op" id="5966638">.</span><span class="ident" id="5966639">ModeSetgid</span>&nbsp;<span class="op" id="5966650">!=</span>&nbsp;<span class="num" id="5966653">0</span>&nbsp;<span class="op" id="5966655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966659">m</span>&nbsp;<span class="op" id="5966661">|=</span>&nbsp;<span class="ident" id="5966664">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966676">if</span>&nbsp;<span class="ident" id="5966679">mode</span><span class="op" id="5966683">&amp;</span><span class="ident" id="5966684">os</span><span class="op" id="5966686">.</span><span class="ident" id="5966687">ModeSticky</span>&nbsp;<span class="op" id="5966698">!=</span>&nbsp;<span class="num" id="5966701">0</span>&nbsp;<span class="op" id="5966703">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966707">m</span>&nbsp;<span class="op" id="5966709">|=</span>&nbsp;<span class="ident" id="5966712">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966724">return</span>&nbsp;<span class="ident" id="5966731">m</span>&nbsp;<span class="op" id="5966733">|</span>&nbsp;<span class="builtintype" id="5966735">uint32</span><span class="op" id="5966741">(</span><span class="ident" id="5966742">mode</span><span class="op" id="5966746">&amp;</span><span class="num" id="5966747">0777</span><span class="op" id="5966751">)</span><br>
<span class="lineno"></span><span class="op" id="5966753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5966756">func</span>&nbsp;<span class="ident" id="5966761">unixModeToFileMode</span><span class="op" id="5966779">(</span><span class="ident" id="5966780">m</span>&nbsp;<span class="builtintype" id="5966782">uint32</span><span class="op" id="5966788">)</span>&nbsp;<span class="ident" id="5966790">os</span><span class="op" id="5966792">.</span><span class="ident" id="5966793">FileMode</span>&nbsp;<span class="op" id="5966802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966805">mode</span>&nbsp;<span class="op" id="5966810">:=</span>&nbsp;<span class="ident" id="5966813">os</span><span class="op" id="5966815">.</span><span class="ident" id="5966816">FileMode</span><span class="op" id="5966824">(</span><span class="ident" id="5966825">m</span>&nbsp;<span class="op" id="5966827">&amp;</span>&nbsp;<span class="num" id="5966829">0777</span><span class="op" id="5966833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966836">switch</span>&nbsp;<span class="ident" id="5966843">m</span>&nbsp;<span class="op" id="5966845">&amp;</span>&nbsp;<span class="ident" id="5966847">s_IFMT</span>&nbsp;<span class="op" id="5966854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966857">case</span>&nbsp;<span class="ident" id="5966862">s_IFBLK</span><span class="op" id="5966869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966873">mode</span>&nbsp;<span class="op" id="5966878">|=</span>&nbsp;<span class="ident" id="5966881">os</span><span class="op" id="5966883">.</span><span class="ident" id="5966884">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966896">case</span>&nbsp;<span class="ident" id="5966901">s_IFCHR</span><span class="op" id="5966908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966912">mode</span>&nbsp;<span class="op" id="5966917">|=</span>&nbsp;<span class="ident" id="5966920">os</span><span class="op" id="5966922">.</span><span class="ident" id="5966923">ModeDevice</span>&nbsp;<span class="op" id="5966934">|</span>&nbsp;<span class="ident" id="5966936">os</span><span class="op" id="5966938">.</span><span class="ident" id="5966939">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966955">case</span>&nbsp;<span class="ident" id="5966960">s_IFDIR</span><span class="op" id="5966967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966971">mode</span>&nbsp;<span class="op" id="5966976">|=</span>&nbsp;<span class="ident" id="5966979">os</span><span class="op" id="5966981">.</span><span class="ident" id="5966982">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966991">case</span>&nbsp;<span class="ident" id="5966996">s_IFIFO</span><span class="op" id="5967003">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967007">mode</span>&nbsp;<span class="op" id="5967012">|=</span>&nbsp;<span class="ident" id="5967015">os</span><span class="op" id="5967017">.</span><span class="ident" id="5967018">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967033">case</span>&nbsp;<span class="ident" id="5967038">s_IFLNK</span><span class="op" id="5967045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967049">mode</span>&nbsp;<span class="op" id="5967054">|=</span>&nbsp;<span class="ident" id="5967057">os</span><span class="op" id="5967059">.</span><span class="ident" id="5967060">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967073">case</span>&nbsp;<span class="ident" id="5967078">s_IFREG</span><span class="op" id="5967085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967089">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967107">case</span>&nbsp;<span class="ident" id="5967112">s_IFSOCK</span><span class="op" id="5967120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967124">mode</span>&nbsp;<span class="op" id="5967129">|=</span>&nbsp;<span class="ident" id="5967132">os</span><span class="op" id="5967134">.</span><span class="ident" id="5967135">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967150">if</span>&nbsp;<span class="ident" id="5967153">m</span><span class="op" id="5967154">&amp;</span><span class="ident" id="5967155">s_ISGID</span>&nbsp;<span class="op" id="5967163">!=</span>&nbsp;<span class="num" id="5967166">0</span>&nbsp;<span class="op" id="5967168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967172">mode</span>&nbsp;<span class="op" id="5967177">|=</span>&nbsp;<span class="ident" id="5967180">os</span><span class="op" id="5967182">.</span><span class="ident" id="5967183">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967198">if</span>&nbsp;<span class="ident" id="5967201">m</span><span class="op" id="5967202">&amp;</span><span class="ident" id="5967203">s_ISUID</span>&nbsp;<span class="op" id="5967211">!=</span>&nbsp;<span class="num" id="5967214">0</span>&nbsp;<span class="op" id="5967216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967220">mode</span>&nbsp;<span class="op" id="5967225">|=</span>&nbsp;<span class="ident" id="5967228">os</span><span class="op" id="5967230">.</span><span class="ident" id="5967231">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967246">if</span>&nbsp;<span class="ident" id="5967249">m</span><span class="op" id="5967250">&amp;</span><span class="ident" id="5967251">s_ISVTX</span>&nbsp;<span class="op" id="5967259">!=</span>&nbsp;<span class="num" id="5967262">0</span>&nbsp;<span class="op" id="5967264">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967268">mode</span>&nbsp;<span class="op" id="5967273">|=</span>&nbsp;<span class="ident" id="5967276">os</span><span class="op" id="5967278">.</span><span class="ident" id="5967279">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967294">return</span>&nbsp;<span class="ident" id="5967301">mode</span><br>
<span class="lineno"></span><span class="op" id="5967306">}</span>
</div>
</body>
</html>
