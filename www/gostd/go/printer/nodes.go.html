<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5415114">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5415169">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5415223">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5415274">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;printing&nbsp;of&nbsp;AST&nbsp;nodes;&nbsp;specifically</span><br>
<span class="lineno"></span><span class="comment" id="5415334">//&nbsp;expressions,&nbsp;statements,&nbsp;declarations,&nbsp;and&nbsp;files.&nbsp;It&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="5415395">//&nbsp;the&nbsp;print&nbsp;functionality&nbsp;implemented&nbsp;in&nbsp;printer.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5415450">package</span>&nbsp;<span class="ident" id="5415458">printer</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="5415467">import</span>&nbsp;<span class="op" id="5415474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5415477">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5415486">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5415496">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5415508">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5415523">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5415526">//&nbsp;Formatting&nbsp;issues:</span><br>
<span class="lineno"></span><span class="comment" id="5415548">//&nbsp;-&nbsp;better&nbsp;comment&nbsp;formatting&nbsp;for&nbsp;/*-style&nbsp;comments&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;(e.g.&nbsp;a&nbsp;declaration)</span><br>
<span class="lineno">20</span><span class="comment" id="5415643">//&nbsp;&nbsp;&nbsp;when&nbsp;the&nbsp;comment&nbsp;spans&nbsp;multiple&nbsp;lines;&nbsp;if&nbsp;such&nbsp;a&nbsp;comment&nbsp;is&nbsp;just&nbsp;two&nbsp;lines,&nbsp;formatting&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5415738">//&nbsp;&nbsp;&nbsp;not&nbsp;idempotent</span><br>
<span class="lineno"></span><span class="comment" id="5415758">//&nbsp;-&nbsp;formatting&nbsp;of&nbsp;expression&nbsp;lists</span><br>
<span class="lineno"></span><span class="comment" id="5415794">//&nbsp;-&nbsp;should&nbsp;use&nbsp;blank&nbsp;instead&nbsp;of&nbsp;tab&nbsp;to&nbsp;separate&nbsp;one-line&nbsp;function&nbsp;bodies&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5415873">//&nbsp;&nbsp;&nbsp;the&nbsp;function&nbsp;header&nbsp;unless&nbsp;there&nbsp;is&nbsp;a&nbsp;group&nbsp;of&nbsp;consecutive&nbsp;one-liners</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5415949">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5416029">//&nbsp;Common&nbsp;AST&nbsp;nodes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416051">//&nbsp;Print&nbsp;as&nbsp;many&nbsp;newlines&nbsp;as&nbsp;necessary&nbsp;(but&nbsp;at&nbsp;least&nbsp;min&nbsp;newlines)&nbsp;to&nbsp;get&nbsp;to</span><br>
<span class="lineno">30</span><span class="comment" id="5416128">//&nbsp;the&nbsp;current&nbsp;line.&nbsp;ws&nbsp;is&nbsp;printed&nbsp;before&nbsp;the&nbsp;first&nbsp;line&nbsp;break.&nbsp;If&nbsp;newSection</span><br>
<span class="lineno"></span><span class="comment" id="5416206">//&nbsp;is&nbsp;set,&nbsp;the&nbsp;first&nbsp;line&nbsp;break&nbsp;is&nbsp;printed&nbsp;as&nbsp;formfeed.&nbsp;Returns&nbsp;true&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5416282">//&nbsp;line&nbsp;break&nbsp;was&nbsp;printed;&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5416334">//</span><br>
<span class="lineno"></span><span class="comment" id="5416337">//&nbsp;TODO(gri):&nbsp;linebreak&nbsp;may&nbsp;add&nbsp;too&nbsp;many&nbsp;lines&nbsp;if&nbsp;the&nbsp;next&nbsp;statement&nbsp;at&nbsp;&#34;line&#34;</span><br>
<span class="lineno">35</span><span class="comment" id="5416416">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;preceded&nbsp;by&nbsp;comments&nbsp;because&nbsp;the&nbsp;computation&nbsp;of&nbsp;n&nbsp;assumes</span><br>
<span class="lineno"></span><span class="comment" id="5416491">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;position&nbsp;before&nbsp;the&nbsp;comment&nbsp;and&nbsp;the&nbsp;target&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5416569">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;the&nbsp;comment.&nbsp;Thus,&nbsp;after&nbsp;interspersing&nbsp;such&nbsp;comments,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5416647">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;space&nbsp;taken&nbsp;up&nbsp;by&nbsp;them&nbsp;is&nbsp;not&nbsp;considered&nbsp;to&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5416726">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;linebreaks.&nbsp;At&nbsp;the&nbsp;moment&nbsp;there&nbsp;is&nbsp;no&nbsp;easy&nbsp;way&nbsp;to&nbsp;know&nbsp;about</span><br>
<span class="lineno">40</span><span class="comment" id="5416801">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;(not&nbsp;yet&nbsp;interspersed)&nbsp;comments&nbsp;in&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5416872">//</span><br>
<span class="lineno"></span><span class="keyword" id="5416875">func</span>&nbsp;<span class="op" id="5416880">(</span><span class="ident" id="5416881">p</span>&nbsp;<span class="op" id="5416883">*</span><span class="ident" id="5416884">printer</span><span class="op" id="5416891">)</span>&nbsp;<span class="ident" id="5416893">linebreak</span><span class="op" id="5416902">(</span><span class="ident" id="5416903">line</span><span class="op" id="5416907">,</span>&nbsp;<span class="ident" id="5416909">min</span>&nbsp;<span class="builtintype" id="5416913">int</span><span class="op" id="5416916">,</span>&nbsp;<span class="ident" id="5416918">ws</span>&nbsp;<span class="ident" id="5416921">whiteSpace</span><span class="op" id="5416931">,</span>&nbsp;<span class="ident" id="5416933">newSection</span>&nbsp;<span class="builtintype" id="5416944">bool</span><span class="op" id="5416948">)</span>&nbsp;<span class="op" id="5416950">(</span><span class="ident" id="5416951">printedBreak</span>&nbsp;<span class="builtintype" id="5416964">bool</span><span class="op" id="5416968">)</span>&nbsp;<span class="op" id="5416970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416973">n</span>&nbsp;<span class="op" id="5416975">:=</span>&nbsp;<span class="ident" id="5416978">nlimit</span><span class="op" id="5416984">(</span><span class="ident" id="5416985">line</span>&nbsp;<span class="op" id="5416990">-</span>&nbsp;<span class="ident" id="5416992">p</span><span class="op" id="5416993">.</span><span class="ident" id="5416994">pos</span><span class="op" id="5416997">.</span><span class="ident" id="5416998">Line</span><span class="op" id="5417002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417005">if</span>&nbsp;<span class="ident" id="5417008">n</span>&nbsp;<span class="op" id="5417010">&lt;</span>&nbsp;<span class="ident" id="5417012">min</span>&nbsp;<span class="op" id="5417016">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417020">n</span>&nbsp;<span class="op" id="5417022">=</span>&nbsp;<span class="ident" id="5417024">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417032">if</span>&nbsp;<span class="ident" id="5417035">n</span>&nbsp;<span class="op" id="5417037">&gt;</span>&nbsp;<span class="num" id="5417039">0</span>&nbsp;<span class="op" id="5417041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417045">p</span><span class="op" id="5417046">.</span><span class="builtinfunc" id="5417047">print</span><span class="op" id="5417052">(</span><span class="ident" id="5417053">ws</span><span class="op" id="5417055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417059">if</span>&nbsp;<span class="ident" id="5417062">newSection</span>&nbsp;<span class="op" id="5417073">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417078">p</span><span class="op" id="5417079">.</span><span class="builtinfunc" id="5417080">print</span><span class="op" id="5417085">(</span><span class="ident" id="5417086">formfeed</span><span class="op" id="5417094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417099">n</span><span class="op" id="5417100">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417109">for</span>&nbsp;<span class="op" id="5417113">;</span>&nbsp;<span class="ident" id="5417115">n</span>&nbsp;<span class="op" id="5417117">&gt;</span>&nbsp;<span class="num" id="5417119">0</span><span class="op" id="5417120">;</span>&nbsp;<span class="ident" id="5417122">n</span><span class="op" id="5417123">--</span>&nbsp;<span class="op" id="5417126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417131">p</span><span class="op" id="5417132">.</span><span class="builtinfunc" id="5417133">print</span><span class="op" id="5417138">(</span><span class="ident" id="5417139">newline</span><span class="op" id="5417146">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417154">printedBreak</span>&nbsp;<span class="op" id="5417167">=</span>&nbsp;<span class="builtintype" id="5417169">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417178">return</span><br>
<span class="lineno"></span><span class="op" id="5417185">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5417188">//&nbsp;setComment&nbsp;sets&nbsp;g&nbsp;as&nbsp;the&nbsp;next&nbsp;comment&nbsp;if&nbsp;g&nbsp;!=&nbsp;nil&nbsp;and&nbsp;if&nbsp;node&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5417262">//&nbsp;are&nbsp;enabled&nbsp;-&nbsp;this&nbsp;mode&nbsp;is&nbsp;used&nbsp;when&nbsp;printing&nbsp;source&nbsp;code&nbsp;fragments&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5417338">//&nbsp;as&nbsp;exports&nbsp;only.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;pending&nbsp;comment&nbsp;in&nbsp;p.comments</span><br>
<span class="lineno"></span><span class="comment" id="5417416">//&nbsp;and&nbsp;at&nbsp;most&nbsp;one&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache.</span><br>
<span class="lineno">65</span><span class="keyword" id="5417475">func</span>&nbsp;<span class="op" id="5417480">(</span><span class="ident" id="5417481">p</span>&nbsp;<span class="op" id="5417483">*</span><span class="ident" id="5417484">printer</span><span class="op" id="5417491">)</span>&nbsp;<span class="ident" id="5417493">setComment</span><span class="op" id="5417503">(</span><span class="ident" id="5417504">g</span>&nbsp;<span class="op" id="5417506">*</span><span class="ident" id="5417507">ast</span><span class="op" id="5417510">.</span><span class="ident" id="5417511">CommentGroup</span><span class="op" id="5417523">)</span>&nbsp;<span class="op" id="5417525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417528">if</span>&nbsp;<span class="ident" id="5417531">g</span>&nbsp;<span class="op" id="5417533">==</span>&nbsp;<span class="ident" id="5417536">nil</span>&nbsp;<span class="op" id="5417540">||</span>&nbsp;<span class="op" id="5417543">!</span><span class="ident" id="5417544">p</span><span class="op" id="5417545">.</span><span class="ident" id="5417546">useNodeComments</span>&nbsp;<span class="op" id="5417562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417566">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417577">if</span>&nbsp;<span class="ident" id="5417580">p</span><span class="op" id="5417581">.</span><span class="ident" id="5417582">comments</span>&nbsp;<span class="op" id="5417591">==</span>&nbsp;<span class="ident" id="5417594">nil</span>&nbsp;<span class="op" id="5417598">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417602">//&nbsp;initialize&nbsp;p.comments&nbsp;lazily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417636">p</span><span class="op" id="5417637">.</span><span class="ident" id="5417638">comments</span>&nbsp;<span class="op" id="5417647">=</span>&nbsp;<span class="builtinfunc" id="5417649">make</span><span class="op" id="5417653">(</span><span class="op" id="5417654">[</span><span class="op" id="5417655">]</span><span class="op" id="5417656">*</span><span class="ident" id="5417657">ast</span><span class="op" id="5417660">.</span><span class="ident" id="5417661">CommentGroup</span><span class="op" id="5417673">,</span>&nbsp;<span class="num" id="5417675">1</span><span class="op" id="5417676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417679">}</span>&nbsp;<span class="keyword" id="5417681">else</span>&nbsp;<span class="keyword" id="5417686">if</span>&nbsp;<span class="ident" id="5417689">p</span><span class="op" id="5417690">.</span><span class="ident" id="5417691">cindex</span>&nbsp;<span class="op" id="5417698">&lt;</span>&nbsp;<span class="builtinfunc" id="5417700">len</span><span class="op" id="5417703">(</span><span class="ident" id="5417704">p</span><span class="op" id="5417705">.</span><span class="ident" id="5417706">comments</span><span class="op" id="5417714">)</span>&nbsp;<span class="op" id="5417716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417720">//&nbsp;for&nbsp;some&nbsp;reason&nbsp;there&nbsp;are&nbsp;pending&nbsp;comments;&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417774">//&nbsp;should&nbsp;never&nbsp;happen&nbsp;-&nbsp;handle&nbsp;gracefully&nbsp;and&nbsp;flush</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417829">//&nbsp;all&nbsp;comments&nbsp;up&nbsp;to&nbsp;g,&nbsp;ignore&nbsp;anything&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417883">p</span><span class="op" id="5417884">.</span><span class="ident" id="5417885">flush</span><span class="op" id="5417890">(</span><span class="ident" id="5417891">p</span><span class="op" id="5417892">.</span><span class="ident" id="5417893">posFor</span><span class="op" id="5417899">(</span><span class="ident" id="5417900">g</span><span class="op" id="5417901">.</span><span class="ident" id="5417902">List</span><span class="op" id="5417906">[</span><span class="num" id="5417907">0</span><span class="op" id="5417908">]</span><span class="op" id="5417909">.</span><span class="ident" id="5417910">Pos</span><span class="op" id="5417913">(</span><span class="op" id="5417914">)</span><span class="op" id="5417915">)</span><span class="op" id="5417916">,</span>&nbsp;<span class="ident" id="5417918">token</span><span class="op" id="5417923">.</span><span class="ident" id="5417924">ILLEGAL</span><span class="op" id="5417931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417935">p</span><span class="op" id="5417936">.</span><span class="ident" id="5417937">comments</span>&nbsp;<span class="op" id="5417946">=</span>&nbsp;<span class="ident" id="5417948">p</span><span class="op" id="5417949">.</span><span class="ident" id="5417950">comments</span><span class="op" id="5417958">[</span><span class="num" id="5417959">0</span><span class="op" id="5417960">:</span><span class="num" id="5417961">1</span><span class="op" id="5417962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5417966">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;report&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417999">p</span><span class="op" id="5418000">.</span><span class="ident" id="5418001">internalError</span><span class="op" id="5418014">(</span><span class="string" id="5418015">&#34;setComment&nbsp;found&nbsp;pending&nbsp;comments&#34;</span><span class="op" id="5418050">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418056">p</span><span class="op" id="5418057">.</span><span class="ident" id="5418058">comments</span><span class="op" id="5418066">[</span><span class="num" id="5418067">0</span><span class="op" id="5418068">]</span>&nbsp;<span class="op" id="5418070">=</span>&nbsp;<span class="ident" id="5418072">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418075">p</span><span class="op" id="5418076">.</span><span class="ident" id="5418077">cindex</span>&nbsp;<span class="op" id="5418084">=</span>&nbsp;<span class="num" id="5418086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418089">//&nbsp;don&#39;t&nbsp;overwrite&nbsp;any&nbsp;pending&nbsp;comment&nbsp;in&nbsp;the&nbsp;p.comment&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418152">//&nbsp;(there&nbsp;may&nbsp;be&nbsp;a&nbsp;pending&nbsp;comment&nbsp;when&nbsp;a&nbsp;line&nbsp;comment&nbsp;is</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418211">//&nbsp;immediately&nbsp;followed&nbsp;by&nbsp;a&nbsp;lead&nbsp;comment&nbsp;with&nbsp;no&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418268">//&nbsp;tokens&nbsp;between)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418288">if</span>&nbsp;<span class="ident" id="5418291">p</span><span class="op" id="5418292">.</span><span class="ident" id="5418293">commentOffset</span>&nbsp;<span class="op" id="5418307">==</span>&nbsp;<span class="ident" id="5418310">infinity</span>&nbsp;<span class="op" id="5418319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418323">p</span><span class="op" id="5418324">.</span><span class="ident" id="5418325">nextComment</span><span class="op" id="5418336">(</span><span class="op" id="5418337">)</span>&nbsp;<span class="comment" id="5418339">//&nbsp;get&nbsp;comment&nbsp;ready&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418369">}</span><br>
<span class="lineno">90</span><span class="op" id="5418371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5418374">type</span>&nbsp;<span class="ident" id="5418379">exprListMode</span>&nbsp;<span class="builtintype" id="5418392">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5418398">const</span>&nbsp;<span class="op" id="5418404">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418407">commaTerm</span>&nbsp;<span class="ident" id="5418417">exprListMode</span>&nbsp;<span class="op" id="5418430">=</span>&nbsp;<span class="num" id="5418432">1</span>&nbsp;<span class="op" id="5418434">&lt;&lt;</span>&nbsp;<span class="ident" id="5418437">iota</span>&nbsp;<span class="comment" id="5418442">//&nbsp;list&nbsp;is&nbsp;optionally&nbsp;terminated&nbsp;by&nbsp;a&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418487">noIndent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5418522">//&nbsp;no&nbsp;extra&nbsp;indentation&nbsp;in&nbsp;multi-line&nbsp;lists</span><br>
<span class="lineno"></span><span class="op" id="5418566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5418569">//&nbsp;If&nbsp;indent&nbsp;is&nbsp;set,&nbsp;a&nbsp;multi-line&nbsp;identifier&nbsp;list&nbsp;is&nbsp;indented&nbsp;after&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="5418641">//&nbsp;first&nbsp;linebreak&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="5418673">func</span>&nbsp;<span class="op" id="5418678">(</span><span class="ident" id="5418679">p</span>&nbsp;<span class="op" id="5418681">*</span><span class="ident" id="5418682">printer</span><span class="op" id="5418689">)</span>&nbsp;<span class="ident" id="5418691">identList</span><span class="op" id="5418700">(</span><span class="ident" id="5418701">list</span>&nbsp;<span class="op" id="5418706">[</span><span class="op" id="5418707">]</span><span class="op" id="5418708">*</span><span class="ident" id="5418709">ast</span><span class="op" id="5418712">.</span><span class="ident" id="5418713">Ident</span><span class="op" id="5418718">,</span>&nbsp;<span class="ident" id="5418720">indent</span>&nbsp;<span class="builtintype" id="5418727">bool</span><span class="op" id="5418731">)</span>&nbsp;<span class="op" id="5418733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418736">//&nbsp;convert&nbsp;into&nbsp;an&nbsp;expression&nbsp;list&nbsp;so&nbsp;we&nbsp;can&nbsp;re-use&nbsp;exprList&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418809">xlist</span>&nbsp;<span class="op" id="5418815">:=</span>&nbsp;<span class="builtinfunc" id="5418818">make</span><span class="op" id="5418822">(</span><span class="op" id="5418823">[</span><span class="op" id="5418824">]</span><span class="ident" id="5418825">ast</span><span class="op" id="5418828">.</span><span class="ident" id="5418829">Expr</span><span class="op" id="5418833">,</span>&nbsp;<span class="builtinfunc" id="5418835">len</span><span class="op" id="5418838">(</span><span class="ident" id="5418839">list</span><span class="op" id="5418843">)</span><span class="op" id="5418844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418847">for</span>&nbsp;<span class="ident" id="5418851">i</span><span class="op" id="5418852">,</span>&nbsp;<span class="ident" id="5418854">x</span>&nbsp;<span class="op" id="5418856">:=</span>&nbsp;<span class="keyword" id="5418859">range</span>&nbsp;<span class="ident" id="5418865">list</span>&nbsp;<span class="op" id="5418870">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418874">xlist</span><span class="op" id="5418879">[</span><span class="ident" id="5418880">i</span><span class="op" id="5418881">]</span>&nbsp;<span class="op" id="5418883">=</span>&nbsp;<span class="ident" id="5418885">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418891">var</span>&nbsp;<span class="ident" id="5418895">mode</span>&nbsp;<span class="ident" id="5418900">exprListMode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418914">if</span>&nbsp;<span class="op" id="5418917">!</span><span class="ident" id="5418918">indent</span>&nbsp;<span class="op" id="5418925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418929">mode</span>&nbsp;<span class="op" id="5418934">=</span>&nbsp;<span class="ident" id="5418936">noIndent</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418949">p</span><span class="op" id="5418950">.</span><span class="ident" id="5418951">exprList</span><span class="op" id="5418959">(</span><span class="ident" id="5418960">token</span><span class="op" id="5418965">.</span><span class="ident" id="5418966">NoPos</span><span class="op" id="5418971">,</span>&nbsp;<span class="ident" id="5418973">xlist</span><span class="op" id="5418978">,</span>&nbsp;<span class="num" id="5418980">1</span><span class="op" id="5418981">,</span>&nbsp;<span class="ident" id="5418983">mode</span><span class="op" id="5418987">,</span>&nbsp;<span class="ident" id="5418989">token</span><span class="op" id="5418994">.</span><span class="ident" id="5418995">NoPos</span><span class="op" id="5419000">)</span><br>
<span class="lineno"></span><span class="op" id="5419002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5419005">//&nbsp;Print&nbsp;a&nbsp;list&nbsp;of&nbsp;expressions.&nbsp;If&nbsp;the&nbsp;list&nbsp;spans&nbsp;multiple</span><br>
<span class="lineno">115</span><span class="comment" id="5419064">//&nbsp;source&nbsp;lines,&nbsp;the&nbsp;original&nbsp;line&nbsp;breaks&nbsp;are&nbsp;respected&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5419128">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5419144">//</span><br>
<span class="lineno"></span><span class="comment" id="5419147">//&nbsp;TODO(gri)&nbsp;Consider&nbsp;rewriting&nbsp;this&nbsp;to&nbsp;be&nbsp;independent&nbsp;of&nbsp;[]ast.Expr</span><br>
<span class="lineno"></span><span class="comment" id="5419216">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;algorithm&nbsp;for&nbsp;any&nbsp;kind&nbsp;of&nbsp;list</span><br>
<span class="lineno">120</span><span class="comment" id="5419283">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.,&nbsp;pass&nbsp;list&nbsp;via&nbsp;a&nbsp;channel&nbsp;over&nbsp;which&nbsp;to&nbsp;range).</span><br>
<span class="lineno"></span><span class="keyword" id="5419349">func</span>&nbsp;<span class="op" id="5419354">(</span><span class="ident" id="5419355">p</span>&nbsp;<span class="op" id="5419357">*</span><span class="ident" id="5419358">printer</span><span class="op" id="5419365">)</span>&nbsp;<span class="ident" id="5419367">exprList</span><span class="op" id="5419375">(</span><span class="ident" id="5419376">prev0</span>&nbsp;<span class="ident" id="5419382">token</span><span class="op" id="5419387">.</span><span class="ident" id="5419388">Pos</span><span class="op" id="5419391">,</span>&nbsp;<span class="ident" id="5419393">list</span>&nbsp;<span class="op" id="5419398">[</span><span class="op" id="5419399">]</span><span class="ident" id="5419400">ast</span><span class="op" id="5419403">.</span><span class="ident" id="5419404">Expr</span><span class="op" id="5419408">,</span>&nbsp;<span class="ident" id="5419410">depth</span>&nbsp;<span class="builtintype" id="5419416">int</span><span class="op" id="5419419">,</span>&nbsp;<span class="ident" id="5419421">mode</span>&nbsp;<span class="ident" id="5419426">exprListMode</span><span class="op" id="5419438">,</span>&nbsp;<span class="ident" id="5419440">next0</span>&nbsp;<span class="ident" id="5419446">token</span><span class="op" id="5419451">.</span><span class="ident" id="5419452">Pos</span><span class="op" id="5419455">)</span>&nbsp;<span class="op" id="5419457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419460">if</span>&nbsp;<span class="builtinfunc" id="5419463">len</span><span class="op" id="5419466">(</span><span class="ident" id="5419467">list</span><span class="op" id="5419471">)</span>&nbsp;<span class="op" id="5419473">==</span>&nbsp;<span class="num" id="5419476">0</span>&nbsp;<span class="op" id="5419478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419490">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419494">prev</span>&nbsp;<span class="op" id="5419499">:=</span>&nbsp;<span class="ident" id="5419502">p</span><span class="op" id="5419503">.</span><span class="ident" id="5419504">posFor</span><span class="op" id="5419510">(</span><span class="ident" id="5419511">prev0</span><span class="op" id="5419516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419519">next</span>&nbsp;<span class="op" id="5419524">:=</span>&nbsp;<span class="ident" id="5419527">p</span><span class="op" id="5419528">.</span><span class="ident" id="5419529">posFor</span><span class="op" id="5419535">(</span><span class="ident" id="5419536">next0</span><span class="op" id="5419541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419544">line</span>&nbsp;<span class="op" id="5419549">:=</span>&nbsp;<span class="ident" id="5419552">p</span><span class="op" id="5419553">.</span><span class="ident" id="5419554">lineFor</span><span class="op" id="5419561">(</span><span class="ident" id="5419562">list</span><span class="op" id="5419566">[</span><span class="num" id="5419567">0</span><span class="op" id="5419568">]</span><span class="op" id="5419569">.</span><span class="ident" id="5419570">Pos</span><span class="op" id="5419573">(</span><span class="op" id="5419574">)</span><span class="op" id="5419575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419578">endLine</span>&nbsp;<span class="op" id="5419586">:=</span>&nbsp;<span class="ident" id="5419589">p</span><span class="op" id="5419590">.</span><span class="ident" id="5419591">lineFor</span><span class="op" id="5419598">(</span><span class="ident" id="5419599">list</span><span class="op" id="5419603">[</span><span class="builtinfunc" id="5419604">len</span><span class="op" id="5419607">(</span><span class="ident" id="5419608">list</span><span class="op" id="5419612">)</span><span class="op" id="5419613">-</span><span class="num" id="5419614">1</span><span class="op" id="5419615">]</span><span class="op" id="5419616">.</span><span class="ident" id="5419617">End</span><span class="op" id="5419620">(</span><span class="op" id="5419621">)</span><span class="op" id="5419622">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419626">if</span>&nbsp;<span class="ident" id="5419629">prev</span><span class="op" id="5419633">.</span><span class="ident" id="5419634">IsValid</span><span class="op" id="5419641">(</span><span class="op" id="5419642">)</span>&nbsp;<span class="op" id="5419644">&amp;&amp;</span>&nbsp;<span class="ident" id="5419647">prev</span><span class="op" id="5419651">.</span><span class="ident" id="5419652">Line</span>&nbsp;<span class="op" id="5419657">==</span>&nbsp;<span class="ident" id="5419660">line</span>&nbsp;<span class="op" id="5419665">&amp;&amp;</span>&nbsp;<span class="ident" id="5419668">line</span>&nbsp;<span class="op" id="5419673">==</span>&nbsp;<span class="ident" id="5419676">endLine</span>&nbsp;<span class="op" id="5419684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419688">//&nbsp;all&nbsp;list&nbsp;entries&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419727">for</span>&nbsp;<span class="ident" id="5419731">i</span><span class="op" id="5419732">,</span>&nbsp;<span class="ident" id="5419734">x</span>&nbsp;<span class="op" id="5419736">:=</span>&nbsp;<span class="keyword" id="5419739">range</span>&nbsp;<span class="ident" id="5419745">list</span>&nbsp;<span class="op" id="5419750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419755">if</span>&nbsp;<span class="ident" id="5419758">i</span>&nbsp;<span class="op" id="5419760">&gt;</span>&nbsp;<span class="num" id="5419762">0</span>&nbsp;<span class="op" id="5419764">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419770">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419827">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419879">p</span><span class="op" id="5419880">.</span><span class="builtinfunc" id="5419881">print</span><span class="op" id="5419886">(</span><span class="ident" id="5419887">x</span><span class="op" id="5419888">.</span><span class="ident" id="5419889">Pos</span><span class="op" id="5419892">(</span><span class="op" id="5419893">)</span><span class="op" id="5419894">,</span>&nbsp;<span class="ident" id="5419896">token</span><span class="op" id="5419901">.</span><span class="ident" id="5419902">COMMA</span><span class="op" id="5419907">,</span>&nbsp;<span class="ident" id="5419909">blank</span><span class="op" id="5419914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419924">p</span><span class="op" id="5419925">.</span><span class="ident" id="5419926">expr0</span><span class="op" id="5419931">(</span><span class="ident" id="5419932">x</span><span class="op" id="5419933">,</span>&nbsp;<span class="ident" id="5419935">depth</span><span class="op" id="5419940">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419948">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5419956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419960">//&nbsp;list&nbsp;entries&nbsp;span&nbsp;multiple&nbsp;lines;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5419998">//&nbsp;use&nbsp;source&nbsp;code&nbsp;positions&nbsp;to&nbsp;guide&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420050">//&nbsp;don&#39;t&nbsp;add&nbsp;extra&nbsp;indentation&nbsp;if&nbsp;noIndent&nbsp;is&nbsp;set;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420102">//&nbsp;i.e.,&nbsp;pretend&nbsp;that&nbsp;the&nbsp;first&nbsp;line&nbsp;is&nbsp;already&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420160">ws</span>&nbsp;<span class="op" id="5420163">:=</span>&nbsp;<span class="ident" id="5420166">ignore</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420174">if</span>&nbsp;<span class="ident" id="5420177">mode</span><span class="op" id="5420181">&amp;</span><span class="ident" id="5420182">noIndent</span>&nbsp;<span class="op" id="5420191">==</span>&nbsp;<span class="num" id="5420194">0</span>&nbsp;<span class="op" id="5420196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420200">ws</span>&nbsp;<span class="op" id="5420203">=</span>&nbsp;<span class="ident" id="5420205">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420217">//&nbsp;the&nbsp;first&nbsp;linebreak&nbsp;is&nbsp;always&nbsp;a&nbsp;formfeed&nbsp;since&nbsp;this&nbsp;section&nbsp;must&nbsp;not</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420290">//&nbsp;depend&nbsp;on&nbsp;any&nbsp;previous&nbsp;formatting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420328">prevBreak</span>&nbsp;<span class="op" id="5420338">:=</span>&nbsp;<span class="op" id="5420341">-</span><span class="num" id="5420342">1</span>&nbsp;<span class="comment" id="5420344">//&nbsp;index&nbsp;of&nbsp;last&nbsp;expression&nbsp;that&nbsp;was&nbsp;followed&nbsp;by&nbsp;a&nbsp;linebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420406">if</span>&nbsp;<span class="ident" id="5420409">prev</span><span class="op" id="5420413">.</span><span class="ident" id="5420414">IsValid</span><span class="op" id="5420421">(</span><span class="op" id="5420422">)</span>&nbsp;<span class="op" id="5420424">&amp;&amp;</span>&nbsp;<span class="ident" id="5420427">prev</span><span class="op" id="5420431">.</span><span class="ident" id="5420432">Line</span>&nbsp;<span class="op" id="5420437">&lt;</span>&nbsp;<span class="ident" id="5420439">line</span>&nbsp;<span class="op" id="5420444">&amp;&amp;</span>&nbsp;<span class="ident" id="5420447">p</span><span class="op" id="5420448">.</span><span class="ident" id="5420449">linebreak</span><span class="op" id="5420458">(</span><span class="ident" id="5420459">line</span><span class="op" id="5420463">,</span>&nbsp;<span class="num" id="5420465">0</span><span class="op" id="5420466">,</span>&nbsp;<span class="ident" id="5420468">ws</span><span class="op" id="5420470">,</span>&nbsp;<span class="builtintype" id="5420472">true</span><span class="op" id="5420476">)</span>&nbsp;<span class="op" id="5420478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420482">ws</span>&nbsp;<span class="op" id="5420485">=</span>&nbsp;<span class="ident" id="5420487">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420496">prevBreak</span>&nbsp;<span class="op" id="5420506">=</span>&nbsp;<span class="num" id="5420508">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5420511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420515">//&nbsp;initialize&nbsp;expression/key&nbsp;size:&nbsp;a&nbsp;zero&nbsp;value&nbsp;indicates&nbsp;expr/key&nbsp;doesn&#39;t&nbsp;fit&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420612">size</span>&nbsp;<span class="op" id="5420617">:=</span>&nbsp;<span class="num" id="5420620">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420624">//&nbsp;print&nbsp;all&nbsp;list&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420652">prevLine</span>&nbsp;<span class="op" id="5420661">:=</span>&nbsp;<span class="ident" id="5420664">prev</span><span class="op" id="5420668">.</span><span class="ident" id="5420669">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5420675">for</span>&nbsp;<span class="ident" id="5420679">i</span><span class="op" id="5420680">,</span>&nbsp;<span class="ident" id="5420682">x</span>&nbsp;<span class="op" id="5420684">:=</span>&nbsp;<span class="keyword" id="5420687">range</span>&nbsp;<span class="ident" id="5420693">list</span>&nbsp;<span class="op" id="5420698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5420702">line</span>&nbsp;<span class="op" id="5420707">=</span>&nbsp;<span class="ident" id="5420709">p</span><span class="op" id="5420710">.</span><span class="ident" id="5420711">lineFor</span><span class="op" id="5420718">(</span><span class="ident" id="5420719">x</span><span class="op" id="5420720">.</span><span class="ident" id="5420721">Pos</span><span class="op" id="5420724">(</span><span class="op" id="5420725">)</span><span class="op" id="5420726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420731">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;next&nbsp;linebreak,&nbsp;if&nbsp;any,&nbsp;needs&nbsp;to&nbsp;use&nbsp;formfeed:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420800">//&nbsp;in&nbsp;general,&nbsp;use&nbsp;the&nbsp;entire&nbsp;node&nbsp;size&nbsp;to&nbsp;make&nbsp;the&nbsp;decision;&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420868">//&nbsp;key:value&nbsp;expressions,&nbsp;use&nbsp;the&nbsp;key&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420913">//&nbsp;TODO(gri)&nbsp;for&nbsp;a&nbsp;better&nbsp;result,&nbsp;should&nbsp;probably&nbsp;incorporate&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5420982">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;key&nbsp;and&nbsp;the&nbsp;node&nbsp;size&nbsp;into&nbsp;the&nbsp;decision&nbsp;process</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421049">useFF</span>&nbsp;<span class="op" id="5421055">:=</span>&nbsp;<span class="builtintype" id="5421058">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421066">//&nbsp;determine&nbsp;element&nbsp;size:&nbsp;all&nbsp;bets&nbsp;are&nbsp;off&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421129">//&nbsp;position&nbsp;information&nbsp;for&nbsp;the&nbsp;previous&nbsp;and&nbsp;next&nbsp;token&nbsp;(likely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421195">//&nbsp;generated&nbsp;code&nbsp;-&nbsp;simply&nbsp;ignore&nbsp;the&nbsp;size&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;setting</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421264">//&nbsp;it&nbsp;to&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421278">prevSize</span>&nbsp;<span class="op" id="5421287">:=</span>&nbsp;<span class="ident" id="5421290">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421297">const</span>&nbsp;<span class="ident" id="5421303">infinity</span>&nbsp;<span class="op" id="5421312">=</span>&nbsp;<span class="num" id="5421314">1e6</span>&nbsp;<span class="comment" id="5421318">//&nbsp;larger&nbsp;than&nbsp;any&nbsp;source&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421351">size</span>&nbsp;<span class="op" id="5421356">=</span>&nbsp;<span class="ident" id="5421358">p</span><span class="op" id="5421359">.</span><span class="ident" id="5421360">nodeSize</span><span class="op" id="5421368">(</span><span class="ident" id="5421369">x</span><span class="op" id="5421370">,</span>&nbsp;<span class="ident" id="5421372">infinity</span><span class="op" id="5421380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421384">pair</span><span class="op" id="5421388">,</span>&nbsp;<span class="ident" id="5421390">isPair</span>&nbsp;<span class="op" id="5421397">:=</span>&nbsp;<span class="ident" id="5421400">x</span><span class="op" id="5421401">.</span><span class="op" id="5421402">(</span><span class="op" id="5421403">*</span><span class="ident" id="5421404">ast</span><span class="op" id="5421407">.</span><span class="ident" id="5421408">KeyValueExpr</span><span class="op" id="5421420">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421424">if</span>&nbsp;<span class="ident" id="5421427">size</span>&nbsp;<span class="op" id="5421432">&lt;=</span>&nbsp;<span class="ident" id="5421435">infinity</span>&nbsp;<span class="op" id="5421444">&amp;&amp;</span>&nbsp;<span class="ident" id="5421447">prev</span><span class="op" id="5421451">.</span><span class="ident" id="5421452">IsValid</span><span class="op" id="5421459">(</span><span class="op" id="5421460">)</span>&nbsp;<span class="op" id="5421462">&amp;&amp;</span>&nbsp;<span class="ident" id="5421465">next</span><span class="op" id="5421469">.</span><span class="ident" id="5421470">IsValid</span><span class="op" id="5421477">(</span><span class="op" id="5421478">)</span>&nbsp;<span class="op" id="5421480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421485">//&nbsp;x&nbsp;fits&nbsp;on&nbsp;a&nbsp;single&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421515">if</span>&nbsp;<span class="ident" id="5421518">isPair</span>&nbsp;<span class="op" id="5421525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421531">size</span>&nbsp;<span class="op" id="5421536">=</span>&nbsp;<span class="ident" id="5421538">p</span><span class="op" id="5421539">.</span><span class="ident" id="5421540">nodeSize</span><span class="op" id="5421548">(</span><span class="ident" id="5421549">pair</span><span class="op" id="5421553">.</span><span class="ident" id="5421554">Key</span><span class="op" id="5421557">,</span>&nbsp;<span class="ident" id="5421559">infinity</span><span class="op" id="5421567">)</span>&nbsp;<span class="comment" id="5421569">//&nbsp;size&nbsp;&lt;=&nbsp;infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5421592">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5421596">}</span>&nbsp;<span class="keyword" id="5421598">else</span>&nbsp;<span class="op" id="5421603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421608">//&nbsp;size&nbsp;too&nbsp;large&nbsp;or&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;good&nbsp;layout&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5421670">size</span>&nbsp;<span class="op" id="5421675">=</span>&nbsp;<span class="num" id="5421677">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5421681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421686">//&nbsp;if&nbsp;the&nbsp;previous&nbsp;line&nbsp;and&nbsp;the&nbsp;current&nbsp;line&nbsp;had&nbsp;single-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421745">//&nbsp;line-expressions&nbsp;and&nbsp;the&nbsp;key&nbsp;sizes&nbsp;are&nbsp;small&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421802">//&nbsp;the&nbsp;ratio&nbsp;between&nbsp;the&nbsp;key&nbsp;sizes&nbsp;does&nbsp;not&nbsp;exceed&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5421857">//&nbsp;threshold,&nbsp;align&nbsp;columns&nbsp;and&nbsp;do&nbsp;not&nbsp;use&nbsp;formfeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421911">if</span>&nbsp;<span class="ident" id="5421914">prevSize</span>&nbsp;<span class="op" id="5421923">&gt;</span>&nbsp;<span class="num" id="5421925">0</span>&nbsp;<span class="op" id="5421927">&amp;&amp;</span>&nbsp;<span class="ident" id="5421930">size</span>&nbsp;<span class="op" id="5421935">&gt;</span>&nbsp;<span class="num" id="5421937">0</span>&nbsp;<span class="op" id="5421939">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421944">const</span>&nbsp;<span class="ident" id="5421950">smallSize</span>&nbsp;<span class="op" id="5421960">=</span>&nbsp;<span class="num" id="5421962">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5421968">if</span>&nbsp;<span class="ident" id="5421971">prevSize</span>&nbsp;<span class="op" id="5421980">&lt;=</span>&nbsp;<span class="ident" id="5421983">smallSize</span>&nbsp;<span class="op" id="5421993">&amp;&amp;</span>&nbsp;<span class="ident" id="5421996">size</span>&nbsp;<span class="op" id="5422001">&lt;=</span>&nbsp;<span class="ident" id="5422004">smallSize</span>&nbsp;<span class="op" id="5422014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422020">useFF</span>&nbsp;<span class="op" id="5422026">=</span>&nbsp;<span class="builtintype" id="5422028">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422037">}</span>&nbsp;<span class="keyword" id="5422039">else</span>&nbsp;<span class="op" id="5422044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422050">const</span>&nbsp;<span class="ident" id="5422056">r</span>&nbsp;<span class="op" id="5422058">=</span>&nbsp;<span class="num" id="5422060">4</span>&nbsp;<span class="comment" id="5422062">//&nbsp;threshold</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422079">ratio</span>&nbsp;<span class="op" id="5422085">:=</span>&nbsp;<span class="builtintype" id="5422088">float64</span><span class="op" id="5422095">(</span><span class="ident" id="5422096">size</span><span class="op" id="5422100">)</span>&nbsp;<span class="op" id="5422102">/</span>&nbsp;<span class="builtintype" id="5422104">float64</span><span class="op" id="5422111">(</span><span class="ident" id="5422112">prevSize</span><span class="op" id="5422120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422126">useFF</span>&nbsp;<span class="op" id="5422132">=</span>&nbsp;<span class="ident" id="5422134">ratio</span>&nbsp;<span class="op" id="5422140">&lt;=</span>&nbsp;<span class="num" id="5422143">1.0</span><span class="op" id="5422146">/</span><span class="ident" id="5422147">r</span>&nbsp;<span class="op" id="5422149">||</span>&nbsp;<span class="ident" id="5422152">r</span>&nbsp;<span class="op" id="5422154">&lt;=</span>&nbsp;<span class="ident" id="5422157">ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422175">needsLinebreak</span>&nbsp;<span class="op" id="5422190">:=</span>&nbsp;<span class="num" id="5422193">0</span>&nbsp;<span class="op" id="5422195">&lt;</span>&nbsp;<span class="ident" id="5422197">prevLine</span>&nbsp;<span class="op" id="5422206">&amp;&amp;</span>&nbsp;<span class="ident" id="5422209">prevLine</span>&nbsp;<span class="op" id="5422218">&lt;</span>&nbsp;<span class="ident" id="5422220">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422227">if</span>&nbsp;<span class="ident" id="5422230">i</span>&nbsp;<span class="op" id="5422232">&gt;</span>&nbsp;<span class="num" id="5422234">0</span>&nbsp;<span class="op" id="5422236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422241">//&nbsp;use&nbsp;position&nbsp;of&nbsp;expression&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422297">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422353">//&nbsp;only&nbsp;if&nbsp;the&nbsp;expression&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422402">if</span>&nbsp;<span class="op" id="5422405">!</span><span class="ident" id="5422406">needsLinebreak</span>&nbsp;<span class="op" id="5422421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422427">p</span><span class="op" id="5422428">.</span><span class="builtinfunc" id="5422429">print</span><span class="op" id="5422434">(</span><span class="ident" id="5422435">x</span><span class="op" id="5422436">.</span><span class="ident" id="5422437">Pos</span><span class="op" id="5422440">(</span><span class="op" id="5422441">)</span><span class="op" id="5422442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422452">p</span><span class="op" id="5422453">.</span><span class="builtinfunc" id="5422454">print</span><span class="op" id="5422459">(</span><span class="ident" id="5422460">token</span><span class="op" id="5422465">.</span><span class="ident" id="5422466">COMMA</span><span class="op" id="5422471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422476">needsBlank</span>&nbsp;<span class="op" id="5422487">:=</span>&nbsp;<span class="builtintype" id="5422490">true</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422498">if</span>&nbsp;<span class="ident" id="5422501">needsLinebreak</span>&nbsp;<span class="op" id="5422516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422522">//&nbsp;lines&nbsp;are&nbsp;broken&nbsp;using&nbsp;newlines&nbsp;so&nbsp;comments&nbsp;remain&nbsp;aligned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422588">//&nbsp;unless&nbsp;forceFF&nbsp;is&nbsp;set&nbsp;or&nbsp;there&nbsp;are&nbsp;multiple&nbsp;expressions&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422654">//&nbsp;the&nbsp;same&nbsp;line&nbsp;in&nbsp;which&nbsp;case&nbsp;formfeed&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422706">if</span>&nbsp;<span class="ident" id="5422709">p</span><span class="op" id="5422710">.</span><span class="ident" id="5422711">linebreak</span><span class="op" id="5422720">(</span><span class="ident" id="5422721">line</span><span class="op" id="5422725">,</span>&nbsp;<span class="num" id="5422727">0</span><span class="op" id="5422728">,</span>&nbsp;<span class="ident" id="5422730">ws</span><span class="op" id="5422732">,</span>&nbsp;<span class="ident" id="5422734">useFF</span>&nbsp;<span class="op" id="5422740">||</span>&nbsp;<span class="ident" id="5422743">prevBreak</span><span class="op" id="5422752">+</span><span class="num" id="5422753">1</span>&nbsp;<span class="op" id="5422755">&lt;</span>&nbsp;<span class="ident" id="5422757">i</span><span class="op" id="5422758">)</span>&nbsp;<span class="op" id="5422760">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422767">ws</span>&nbsp;<span class="op" id="5422770">=</span>&nbsp;<span class="ident" id="5422772">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422784">prevBreak</span>&nbsp;<span class="op" id="5422794">=</span>&nbsp;<span class="ident" id="5422796">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422803">needsBlank</span>&nbsp;<span class="op" id="5422814">=</span>&nbsp;<span class="builtintype" id="5422816">false</span>&nbsp;<span class="comment" id="5422822">//&nbsp;we&nbsp;got&nbsp;a&nbsp;line&nbsp;break&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422862">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422867">if</span>&nbsp;<span class="ident" id="5422870">needsBlank</span>&nbsp;<span class="op" id="5422881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5422887">p</span><span class="op" id="5422888">.</span><span class="builtinfunc" id="5422889">print</span><span class="op" id="5422894">(</span><span class="ident" id="5422895">blank</span><span class="op" id="5422900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5422909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5422914">if</span>&nbsp;<span class="builtinfunc" id="5422917">len</span><span class="op" id="5422920">(</span><span class="ident" id="5422921">list</span><span class="op" id="5422925">)</span>&nbsp;<span class="op" id="5422927">&gt;</span>&nbsp;<span class="num" id="5422929">1</span>&nbsp;<span class="op" id="5422931">&amp;&amp;</span>&nbsp;<span class="ident" id="5422934">isPair</span>&nbsp;<span class="op" id="5422941">&amp;&amp;</span>&nbsp;<span class="ident" id="5422944">size</span>&nbsp;<span class="op" id="5422949">&gt;</span>&nbsp;<span class="num" id="5422951">0</span>&nbsp;<span class="op" id="5422953">&amp;&amp;</span>&nbsp;<span class="ident" id="5422956">needsLinebreak</span>&nbsp;<span class="op" id="5422971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5422976">//&nbsp;we&nbsp;have&nbsp;a&nbsp;key:value&nbsp;expression&nbsp;that&nbsp;fits&nbsp;onto&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423037">//&nbsp;and&nbsp;it&#39;s&nbsp;not&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;prior&nbsp;expression:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423098">//&nbsp;use&nbsp;a&nbsp;column&nbsp;for&nbsp;the&nbsp;key&nbsp;such&nbsp;that&nbsp;consecutive&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423159">//&nbsp;can&nbsp;align&nbsp;if&nbsp;possible</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423187">//&nbsp;(needsLinebreak&nbsp;is&nbsp;set&nbsp;if&nbsp;we&nbsp;started&nbsp;a&nbsp;new&nbsp;line&nbsp;before)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423249">p</span><span class="op" id="5423250">.</span><span class="ident" id="5423251">expr</span><span class="op" id="5423255">(</span><span class="ident" id="5423256">pair</span><span class="op" id="5423260">.</span><span class="ident" id="5423261">Key</span><span class="op" id="5423264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423269">p</span><span class="op" id="5423270">.</span><span class="builtinfunc" id="5423271">print</span><span class="op" id="5423276">(</span><span class="ident" id="5423277">pair</span><span class="op" id="5423281">.</span><span class="ident" id="5423282">Colon</span><span class="op" id="5423287">,</span>&nbsp;<span class="ident" id="5423289">token</span><span class="op" id="5423294">.</span><span class="ident" id="5423295">COLON</span><span class="op" id="5423300">,</span>&nbsp;<span class="ident" id="5423302">vtab</span><span class="op" id="5423306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423311">p</span><span class="op" id="5423312">.</span><span class="ident" id="5423313">expr</span><span class="op" id="5423317">(</span><span class="ident" id="5423318">pair</span><span class="op" id="5423322">.</span><span class="ident" id="5423323">Value</span><span class="op" id="5423328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423332">}</span>&nbsp;<span class="keyword" id="5423334">else</span>&nbsp;<span class="op" id="5423339">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423344">p</span><span class="op" id="5423345">.</span><span class="ident" id="5423346">expr0</span><span class="op" id="5423351">(</span><span class="ident" id="5423352">x</span><span class="op" id="5423353">,</span>&nbsp;<span class="ident" id="5423355">depth</span><span class="op" id="5423360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423369">prevLine</span>&nbsp;<span class="op" id="5423378">=</span>&nbsp;<span class="ident" id="5423380">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423386">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5423390">if</span>&nbsp;<span class="ident" id="5423393">mode</span><span class="op" id="5423397">&amp;</span><span class="ident" id="5423398">commaTerm</span>&nbsp;<span class="op" id="5423408">!=</span>&nbsp;<span class="num" id="5423411">0</span>&nbsp;<span class="op" id="5423413">&amp;&amp;</span>&nbsp;<span class="ident" id="5423416">next</span><span class="op" id="5423420">.</span><span class="ident" id="5423421">IsValid</span><span class="op" id="5423428">(</span><span class="op" id="5423429">)</span>&nbsp;<span class="op" id="5423431">&amp;&amp;</span>&nbsp;<span class="ident" id="5423434">p</span><span class="op" id="5423435">.</span><span class="ident" id="5423436">pos</span><span class="op" id="5423439">.</span><span class="ident" id="5423440">Line</span>&nbsp;<span class="op" id="5423445">&lt;</span>&nbsp;<span class="ident" id="5423447">next</span><span class="op" id="5423451">.</span><span class="ident" id="5423452">Line</span>&nbsp;<span class="op" id="5423457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423461">//&nbsp;print&nbsp;a&nbsp;terminating&nbsp;comma&nbsp;if&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423527">p</span><span class="op" id="5423528">.</span><span class="builtinfunc" id="5423529">print</span><span class="op" id="5423534">(</span><span class="ident" id="5423535">token</span><span class="op" id="5423540">.</span><span class="ident" id="5423541">COMMA</span><span class="op" id="5423546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5423550">if</span>&nbsp;<span class="ident" id="5423553">ws</span>&nbsp;<span class="op" id="5423556">==</span>&nbsp;<span class="ident" id="5423559">ignore</span>&nbsp;<span class="op" id="5423566">&amp;&amp;</span>&nbsp;<span class="ident" id="5423569">mode</span><span class="op" id="5423573">&amp;</span><span class="ident" id="5423574">noIndent</span>&nbsp;<span class="op" id="5423583">==</span>&nbsp;<span class="num" id="5423586">0</span>&nbsp;<span class="op" id="5423588">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423593">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423623">p</span><span class="op" id="5423624">.</span><span class="builtinfunc" id="5423625">print</span><span class="op" id="5423630">(</span><span class="ident" id="5423631">unindent</span><span class="op" id="5423639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423647">p</span><span class="op" id="5423648">.</span><span class="builtinfunc" id="5423649">print</span><span class="op" id="5423654">(</span><span class="ident" id="5423655">formfeed</span><span class="op" id="5423663">)</span>&nbsp;<span class="comment" id="5423665">//&nbsp;terminating&nbsp;comma&nbsp;needs&nbsp;a&nbsp;line&nbsp;break&nbsp;to&nbsp;look&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5423720">return</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5423732">if</span>&nbsp;<span class="ident" id="5423735">ws</span>&nbsp;<span class="op" id="5423738">==</span>&nbsp;<span class="ident" id="5423741">ignore</span>&nbsp;<span class="op" id="5423748">&amp;&amp;</span>&nbsp;<span class="ident" id="5423751">mode</span><span class="op" id="5423755">&amp;</span><span class="ident" id="5423756">noIndent</span>&nbsp;<span class="op" id="5423765">==</span>&nbsp;<span class="num" id="5423768">0</span>&nbsp;<span class="op" id="5423770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5423774">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423803">p</span><span class="op" id="5423804">.</span><span class="builtinfunc" id="5423805">print</span><span class="op" id="5423810">(</span><span class="ident" id="5423811">unindent</span><span class="op" id="5423819">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5423822">}</span><br>
<span class="lineno"></span><span class="op" id="5423824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5423827">func</span>&nbsp;<span class="op" id="5423832">(</span><span class="ident" id="5423833">p</span>&nbsp;<span class="op" id="5423835">*</span><span class="ident" id="5423836">printer</span><span class="op" id="5423843">)</span>&nbsp;<span class="ident" id="5423845">parameters</span><span class="op" id="5423855">(</span><span class="ident" id="5423856">fields</span>&nbsp;<span class="op" id="5423863">*</span><span class="ident" id="5423864">ast</span><span class="op" id="5423867">.</span><span class="ident" id="5423868">FieldList</span><span class="op" id="5423877">)</span>&nbsp;<span class="op" id="5423879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423882">p</span><span class="op" id="5423883">.</span><span class="builtinfunc" id="5423884">print</span><span class="op" id="5423889">(</span><span class="ident" id="5423890">fields</span><span class="op" id="5423896">.</span><span class="ident" id="5423897">Opening</span><span class="op" id="5423904">,</span>&nbsp;<span class="ident" id="5423906">token</span><span class="op" id="5423911">.</span><span class="ident" id="5423912">LPAREN</span><span class="op" id="5423918">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5423921">if</span>&nbsp;<span class="builtinfunc" id="5423924">len</span><span class="op" id="5423927">(</span><span class="ident" id="5423928">fields</span><span class="op" id="5423934">.</span><span class="ident" id="5423935">List</span><span class="op" id="5423939">)</span>&nbsp;<span class="op" id="5423941">&gt;</span>&nbsp;<span class="num" id="5423943">0</span>&nbsp;<span class="op" id="5423945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423949">prevLine</span>&nbsp;<span class="op" id="5423958">:=</span>&nbsp;<span class="ident" id="5423961">p</span><span class="op" id="5423962">.</span><span class="ident" id="5423963">lineFor</span><span class="op" id="5423970">(</span><span class="ident" id="5423971">fields</span><span class="op" id="5423977">.</span><span class="ident" id="5423978">Opening</span><span class="op" id="5423985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5423989">ws</span>&nbsp;<span class="op" id="5423992">:=</span>&nbsp;<span class="ident" id="5423995">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424004">for</span>&nbsp;<span class="ident" id="5424008">i</span><span class="op" id="5424009">,</span>&nbsp;<span class="ident" id="5424011">par</span>&nbsp;<span class="op" id="5424015">:=</span>&nbsp;<span class="keyword" id="5424018">range</span>&nbsp;<span class="ident" id="5424024">fields</span><span class="op" id="5424030">.</span><span class="ident" id="5424031">List</span>&nbsp;<span class="op" id="5424036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424041">//&nbsp;determine&nbsp;par&nbsp;begin&nbsp;and&nbsp;end&nbsp;line&nbsp;(may&nbsp;be&nbsp;different</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424098">//&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;parameter&nbsp;names&nbsp;for&nbsp;this&nbsp;par</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424155">//&nbsp;or&nbsp;the&nbsp;type&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424196">var</span>&nbsp;<span class="ident" id="5424200">parLineBeg</span>&nbsp;<span class="builtintype" id="5424211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424218">if</span>&nbsp;<span class="builtinfunc" id="5424221">len</span><span class="op" id="5424224">(</span><span class="ident" id="5424225">par</span><span class="op" id="5424228">.</span><span class="ident" id="5424229">Names</span><span class="op" id="5424234">)</span>&nbsp;<span class="op" id="5424236">&gt;</span>&nbsp;<span class="num" id="5424238">0</span>&nbsp;<span class="op" id="5424240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424246">parLineBeg</span>&nbsp;<span class="op" id="5424257">=</span>&nbsp;<span class="ident" id="5424259">p</span><span class="op" id="5424260">.</span><span class="ident" id="5424261">lineFor</span><span class="op" id="5424268">(</span><span class="ident" id="5424269">par</span><span class="op" id="5424272">.</span><span class="ident" id="5424273">Names</span><span class="op" id="5424278">[</span><span class="num" id="5424279">0</span><span class="op" id="5424280">]</span><span class="op" id="5424281">.</span><span class="ident" id="5424282">Pos</span><span class="op" id="5424285">(</span><span class="op" id="5424286">)</span><span class="op" id="5424287">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5424292">}</span>&nbsp;<span class="keyword" id="5424294">else</span>&nbsp;<span class="op" id="5424299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424305">parLineBeg</span>&nbsp;<span class="op" id="5424316">=</span>&nbsp;<span class="ident" id="5424318">p</span><span class="op" id="5424319">.</span><span class="ident" id="5424320">lineFor</span><span class="op" id="5424327">(</span><span class="ident" id="5424328">par</span><span class="op" id="5424331">.</span><span class="ident" id="5424332">Type</span><span class="op" id="5424336">.</span><span class="ident" id="5424337">Pos</span><span class="op" id="5424340">(</span><span class="op" id="5424341">)</span><span class="op" id="5424342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5424347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424352">var</span>&nbsp;<span class="ident" id="5424356">parLineEnd</span>&nbsp;<span class="op" id="5424367">=</span>&nbsp;<span class="ident" id="5424369">p</span><span class="op" id="5424370">.</span><span class="ident" id="5424371">lineFor</span><span class="op" id="5424378">(</span><span class="ident" id="5424379">par</span><span class="op" id="5424382">.</span><span class="ident" id="5424383">Type</span><span class="op" id="5424387">.</span><span class="ident" id="5424388">End</span><span class="op" id="5424391">(</span><span class="op" id="5424392">)</span><span class="op" id="5424393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424398">//&nbsp;separating&nbsp;&#34;,&#34;&nbsp;if&nbsp;needed</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424429">needsLinebreak</span>&nbsp;<span class="op" id="5424444">:=</span>&nbsp;<span class="num" id="5424447">0</span>&nbsp;<span class="op" id="5424449">&lt;</span>&nbsp;<span class="ident" id="5424451">prevLine</span>&nbsp;<span class="op" id="5424460">&amp;&amp;</span>&nbsp;<span class="ident" id="5424463">prevLine</span>&nbsp;<span class="op" id="5424472">&lt;</span>&nbsp;<span class="ident" id="5424474">parLineBeg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424488">if</span>&nbsp;<span class="ident" id="5424491">i</span>&nbsp;<span class="op" id="5424493">&gt;</span>&nbsp;<span class="num" id="5424495">0</span>&nbsp;<span class="op" id="5424497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424503">//&nbsp;use&nbsp;position&nbsp;of&nbsp;parameter&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424559">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comma&nbsp;placement,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424614">//&nbsp;only&nbsp;if&nbsp;the&nbsp;next&nbsp;parameter&nbsp;is&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424668">if</span>&nbsp;<span class="op" id="5424671">!</span><span class="ident" id="5424672">needsLinebreak</span>&nbsp;<span class="op" id="5424687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424694">p</span><span class="op" id="5424695">.</span><span class="builtinfunc" id="5424696">print</span><span class="op" id="5424701">(</span><span class="ident" id="5424702">par</span><span class="op" id="5424705">.</span><span class="ident" id="5424706">Pos</span><span class="op" id="5424709">(</span><span class="op" id="5424710">)</span><span class="op" id="5424711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5424717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424723">p</span><span class="op" id="5424724">.</span><span class="builtinfunc" id="5424725">print</span><span class="op" id="5424730">(</span><span class="ident" id="5424731">token</span><span class="op" id="5424736">.</span><span class="ident" id="5424737">COMMA</span><span class="op" id="5424742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5424747">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424752">//&nbsp;separator&nbsp;if&nbsp;needed&nbsp;(linebreak&nbsp;or&nbsp;blank)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5424799">if</span>&nbsp;<span class="ident" id="5424802">needsLinebreak</span>&nbsp;<span class="op" id="5424817">&amp;&amp;</span>&nbsp;<span class="ident" id="5424820">p</span><span class="op" id="5424821">.</span><span class="ident" id="5424822">linebreak</span><span class="op" id="5424831">(</span><span class="ident" id="5424832">parLineBeg</span><span class="op" id="5424842">,</span>&nbsp;<span class="num" id="5424844">0</span><span class="op" id="5424845">,</span>&nbsp;<span class="ident" id="5424847">ws</span><span class="op" id="5424849">,</span>&nbsp;<span class="builtintype" id="5424851">true</span><span class="op" id="5424855">)</span>&nbsp;<span class="op" id="5424857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5424863">//&nbsp;break&nbsp;line&nbsp;if&nbsp;the&nbsp;opening&nbsp;&#34;(&#34;&nbsp;or&nbsp;previous&nbsp;parameter&nbsp;ended&nbsp;on&nbsp;a&nbsp;different&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424948">ws</span>&nbsp;<span class="op" id="5424951">=</span>&nbsp;<span class="ident" id="5424953">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5424963">}</span>&nbsp;<span class="keyword" id="5424965">else</span>&nbsp;<span class="keyword" id="5424970">if</span>&nbsp;<span class="ident" id="5424973">i</span>&nbsp;<span class="op" id="5424975">&gt;</span>&nbsp;<span class="num" id="5424977">0</span>&nbsp;<span class="op" id="5424979">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5424985">p</span><span class="op" id="5424986">.</span><span class="builtinfunc" id="5424987">print</span><span class="op" id="5424992">(</span><span class="ident" id="5424993">blank</span><span class="op" id="5424998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425008">//&nbsp;parameter&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5425030">if</span>&nbsp;<span class="builtinfunc" id="5425033">len</span><span class="op" id="5425036">(</span><span class="ident" id="5425037">par</span><span class="op" id="5425040">.</span><span class="ident" id="5425041">Names</span><span class="op" id="5425046">)</span>&nbsp;<span class="op" id="5425048">&gt;</span>&nbsp;<span class="num" id="5425050">0</span>&nbsp;<span class="op" id="5425052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425058">//&nbsp;Very&nbsp;subtle:&nbsp;If&nbsp;we&nbsp;indented&nbsp;before&nbsp;(ws&nbsp;==&nbsp;ignore),&nbsp;identList</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425126">//&nbsp;won&#39;t&nbsp;indent&nbsp;again.&nbsp;If&nbsp;we&nbsp;didn&#39;t&nbsp;(ws&nbsp;==&nbsp;indent),&nbsp;identList&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425197">//&nbsp;indent&nbsp;if&nbsp;the&nbsp;identList&nbsp;spans&nbsp;multiple&nbsp;lines,&nbsp;and&nbsp;it&nbsp;will&nbsp;outdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425270">//&nbsp;again&nbsp;at&nbsp;the&nbsp;end&nbsp;(and&nbsp;still&nbsp;ws&nbsp;==&nbsp;indent).&nbsp;Thus,&nbsp;a&nbsp;subsequent&nbsp;indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425346">//&nbsp;by&nbsp;a&nbsp;linebreak&nbsp;call&nbsp;after&nbsp;a&nbsp;type,&nbsp;or&nbsp;in&nbsp;the&nbsp;next&nbsp;multi-line&nbsp;identList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425423">//&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425455">p</span><span class="op" id="5425456">.</span><span class="ident" id="5425457">identList</span><span class="op" id="5425466">(</span><span class="ident" id="5425467">par</span><span class="op" id="5425470">.</span><span class="ident" id="5425471">Names</span><span class="op" id="5425476">,</span>&nbsp;<span class="ident" id="5425478">ws</span>&nbsp;<span class="op" id="5425481">==</span>&nbsp;<span class="ident" id="5425484">indent</span><span class="op" id="5425490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425496">p</span><span class="op" id="5425497">.</span><span class="builtinfunc" id="5425498">print</span><span class="op" id="5425503">(</span><span class="ident" id="5425504">blank</span><span class="op" id="5425509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425519">//&nbsp;parameter&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425540">p</span><span class="op" id="5425541">.</span><span class="ident" id="5425542">expr</span><span class="op" id="5425546">(</span><span class="ident" id="5425547">stripParensAlways</span><span class="op" id="5425564">(</span><span class="ident" id="5425565">par</span><span class="op" id="5425568">.</span><span class="ident" id="5425569">Type</span><span class="op" id="5425573">)</span><span class="op" id="5425574">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425579">prevLine</span>&nbsp;<span class="op" id="5425588">=</span>&nbsp;<span class="ident" id="5425590">parLineEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425607">//&nbsp;if&nbsp;the&nbsp;closing&nbsp;&#34;)&#34;&nbsp;is&nbsp;on&nbsp;a&nbsp;separate&nbsp;line&nbsp;from&nbsp;the&nbsp;last&nbsp;parameter,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425678">//&nbsp;print&nbsp;an&nbsp;additional&nbsp;&#34;,&#34;&nbsp;and&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5425722">if</span>&nbsp;<span class="ident" id="5425725">closing</span>&nbsp;<span class="op" id="5425733">:=</span>&nbsp;<span class="ident" id="5425736">p</span><span class="op" id="5425737">.</span><span class="ident" id="5425738">lineFor</span><span class="op" id="5425745">(</span><span class="ident" id="5425746">fields</span><span class="op" id="5425752">.</span><span class="ident" id="5425753">Closing</span><span class="op" id="5425760">)</span><span class="op" id="5425761">;</span>&nbsp;<span class="num" id="5425763">0</span>&nbsp;<span class="op" id="5425765">&lt;</span>&nbsp;<span class="ident" id="5425767">prevLine</span>&nbsp;<span class="op" id="5425776">&amp;&amp;</span>&nbsp;<span class="ident" id="5425779">prevLine</span>&nbsp;<span class="op" id="5425788">&lt;</span>&nbsp;<span class="ident" id="5425790">closing</span>&nbsp;<span class="op" id="5425798">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425803">p</span><span class="op" id="5425804">.</span><span class="builtinfunc" id="5425805">print</span><span class="op" id="5425810">(</span><span class="ident" id="5425811">token</span><span class="op" id="5425816">.</span><span class="ident" id="5425817">COMMA</span><span class="op" id="5425822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425827">p</span><span class="op" id="5425828">.</span><span class="ident" id="5425829">linebreak</span><span class="op" id="5425838">(</span><span class="ident" id="5425839">closing</span><span class="op" id="5425846">,</span>&nbsp;<span class="num" id="5425848">0</span><span class="op" id="5425849">,</span>&nbsp;<span class="ident" id="5425851">ignore</span><span class="op" id="5425857">,</span>&nbsp;<span class="builtintype" id="5425859">true</span><span class="op" id="5425863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5425871">//&nbsp;unindent&nbsp;if&nbsp;we&nbsp;indented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5425900">if</span>&nbsp;<span class="ident" id="5425903">ws</span>&nbsp;<span class="op" id="5425906">==</span>&nbsp;<span class="ident" id="5425909">ignore</span>&nbsp;<span class="op" id="5425916">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425921">p</span><span class="op" id="5425922">.</span><span class="builtinfunc" id="5425923">print</span><span class="op" id="5425928">(</span><span class="ident" id="5425929">unindent</span><span class="op" id="5425937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5425944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5425947">p</span><span class="op" id="5425948">.</span><span class="builtinfunc" id="5425949">print</span><span class="op" id="5425954">(</span><span class="ident" id="5425955">fields</span><span class="op" id="5425961">.</span><span class="ident" id="5425962">Closing</span><span class="op" id="5425969">,</span>&nbsp;<span class="ident" id="5425971">token</span><span class="op" id="5425976">.</span><span class="ident" id="5425977">RPAREN</span><span class="op" id="5425983">)</span><br>
<span class="lineno"></span><span class="op" id="5425985">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5425988">func</span>&nbsp;<span class="op" id="5425993">(</span><span class="ident" id="5425994">p</span>&nbsp;<span class="op" id="5425996">*</span><span class="ident" id="5425997">printer</span><span class="op" id="5426004">)</span>&nbsp;<span class="ident" id="5426006">signature</span><span class="op" id="5426015">(</span><span class="ident" id="5426016">params</span><span class="op" id="5426022">,</span>&nbsp;<span class="ident" id="5426024">result</span>&nbsp;<span class="op" id="5426031">*</span><span class="ident" id="5426032">ast</span><span class="op" id="5426035">.</span><span class="ident" id="5426036">FieldList</span><span class="op" id="5426045">)</span>&nbsp;<span class="op" id="5426047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426050">if</span>&nbsp;<span class="ident" id="5426053">params</span>&nbsp;<span class="op" id="5426060">!=</span>&nbsp;<span class="ident" id="5426063">nil</span>&nbsp;<span class="op" id="5426067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426071">p</span><span class="op" id="5426072">.</span><span class="ident" id="5426073">parameters</span><span class="op" id="5426083">(</span><span class="ident" id="5426084">params</span><span class="op" id="5426090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426093">}</span>&nbsp;<span class="keyword" id="5426095">else</span>&nbsp;<span class="op" id="5426100">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426104">p</span><span class="op" id="5426105">.</span><span class="builtinfunc" id="5426106">print</span><span class="op" id="5426111">(</span><span class="ident" id="5426112">token</span><span class="op" id="5426117">.</span><span class="ident" id="5426118">LPAREN</span><span class="op" id="5426124">,</span>&nbsp;<span class="ident" id="5426126">token</span><span class="op" id="5426131">.</span><span class="ident" id="5426132">RPAREN</span><span class="op" id="5426138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426144">n</span>&nbsp;<span class="op" id="5426146">:=</span>&nbsp;<span class="ident" id="5426149">result</span><span class="op" id="5426155">.</span><span class="ident" id="5426156">NumFields</span><span class="op" id="5426165">(</span><span class="op" id="5426166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426169">if</span>&nbsp;<span class="ident" id="5426172">n</span>&nbsp;<span class="op" id="5426174">&gt;</span>&nbsp;<span class="num" id="5426176">0</span>&nbsp;<span class="op" id="5426178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5426182">//&nbsp;result&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426201">p</span><span class="op" id="5426202">.</span><span class="builtinfunc" id="5426203">print</span><span class="op" id="5426208">(</span><span class="ident" id="5426209">blank</span><span class="op" id="5426214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426218">if</span>&nbsp;<span class="ident" id="5426221">n</span>&nbsp;<span class="op" id="5426223">==</span>&nbsp;<span class="num" id="5426226">1</span>&nbsp;<span class="op" id="5426228">&amp;&amp;</span>&nbsp;<span class="ident" id="5426231">result</span><span class="op" id="5426237">.</span><span class="ident" id="5426238">List</span><span class="op" id="5426242">[</span><span class="num" id="5426243">0</span><span class="op" id="5426244">]</span><span class="op" id="5426245">.</span><span class="ident" id="5426246">Names</span>&nbsp;<span class="op" id="5426252">==</span>&nbsp;<span class="ident" id="5426255">nil</span>&nbsp;<span class="op" id="5426259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5426264">//&nbsp;single&nbsp;anonymous&nbsp;result;&nbsp;no&nbsp;()&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426303">p</span><span class="op" id="5426304">.</span><span class="ident" id="5426305">expr</span><span class="op" id="5426309">(</span><span class="ident" id="5426310">stripParensAlways</span><span class="op" id="5426327">(</span><span class="ident" id="5426328">result</span><span class="op" id="5426334">.</span><span class="ident" id="5426335">List</span><span class="op" id="5426339">[</span><span class="num" id="5426340">0</span><span class="op" id="5426341">]</span><span class="op" id="5426342">.</span><span class="ident" id="5426343">Type</span><span class="op" id="5426347">)</span><span class="op" id="5426348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426353">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426366">p</span><span class="op" id="5426367">.</span><span class="ident" id="5426368">parameters</span><span class="op" id="5426378">(</span><span class="ident" id="5426379">result</span><span class="op" id="5426385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426388">}</span><br>
<span class="lineno"></span><span class="op" id="5426390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5426393">func</span>&nbsp;<span class="ident" id="5426398">identListSize</span><span class="op" id="5426411">(</span><span class="ident" id="5426412">list</span>&nbsp;<span class="op" id="5426417">[</span><span class="op" id="5426418">]</span><span class="op" id="5426419">*</span><span class="ident" id="5426420">ast</span><span class="op" id="5426423">.</span><span class="ident" id="5426424">Ident</span><span class="op" id="5426429">,</span>&nbsp;<span class="ident" id="5426431">maxSize</span>&nbsp;<span class="builtintype" id="5426439">int</span><span class="op" id="5426442">)</span>&nbsp;<span class="op" id="5426444">(</span><span class="ident" id="5426445">size</span>&nbsp;<span class="builtintype" id="5426450">int</span><span class="op" id="5426453">)</span>&nbsp;<span class="op" id="5426455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426458">for</span>&nbsp;<span class="ident" id="5426462">i</span><span class="op" id="5426463">,</span>&nbsp;<span class="ident" id="5426465">x</span>&nbsp;<span class="op" id="5426467">:=</span>&nbsp;<span class="keyword" id="5426470">range</span>&nbsp;<span class="ident" id="5426476">list</span>&nbsp;<span class="op" id="5426481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426485">if</span>&nbsp;<span class="ident" id="5426488">i</span>&nbsp;<span class="op" id="5426490">&gt;</span>&nbsp;<span class="num" id="5426492">0</span>&nbsp;<span class="op" id="5426494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426499">size</span>&nbsp;<span class="op" id="5426504">+=</span>&nbsp;<span class="builtinfunc" id="5426507">len</span><span class="op" id="5426510">(</span><span class="string" id="5426511">&#34;,&nbsp;&#34;</span><span class="op" id="5426515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426519">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426523">size</span>&nbsp;<span class="op" id="5426528">+=</span>&nbsp;<span class="ident" id="5426531">utf8</span><span class="op" id="5426535">.</span><span class="ident" id="5426536">RuneCountInString</span><span class="op" id="5426553">(</span><span class="ident" id="5426554">x</span><span class="op" id="5426555">.</span><span class="ident" id="5426556">Name</span><span class="op" id="5426560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426564">if</span>&nbsp;<span class="ident" id="5426567">size</span>&nbsp;<span class="op" id="5426572">&gt;=</span>&nbsp;<span class="ident" id="5426575">maxSize</span>&nbsp;<span class="op" id="5426583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426588">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426599">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426602">return</span><br>
<span class="lineno"></span><span class="op" id="5426609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5426612">func</span>&nbsp;<span class="op" id="5426617">(</span><span class="ident" id="5426618">p</span>&nbsp;<span class="op" id="5426620">*</span><span class="ident" id="5426621">printer</span><span class="op" id="5426628">)</span>&nbsp;<span class="ident" id="5426630">isOneLineFieldList</span><span class="op" id="5426648">(</span><span class="ident" id="5426649">list</span>&nbsp;<span class="op" id="5426654">[</span><span class="op" id="5426655">]</span><span class="op" id="5426656">*</span><span class="ident" id="5426657">ast</span><span class="op" id="5426660">.</span><span class="ident" id="5426661">Field</span><span class="op" id="5426666">)</span>&nbsp;<span class="builtintype" id="5426668">bool</span>&nbsp;<span class="op" id="5426673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426676">if</span>&nbsp;<span class="builtinfunc" id="5426679">len</span><span class="op" id="5426682">(</span><span class="ident" id="5426683">list</span><span class="op" id="5426687">)</span>&nbsp;<span class="op" id="5426689">!=</span>&nbsp;<span class="num" id="5426692">1</span>&nbsp;<span class="op" id="5426694">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426698">return</span>&nbsp;<span class="builtintype" id="5426705">false</span>&nbsp;<span class="comment" id="5426711">//&nbsp;allow&nbsp;only&nbsp;one&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426739">f</span>&nbsp;<span class="op" id="5426741">:=</span>&nbsp;<span class="ident" id="5426744">list</span><span class="op" id="5426748">[</span><span class="num" id="5426749">0</span><span class="op" id="5426750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426753">if</span>&nbsp;<span class="ident" id="5426756">f</span><span class="op" id="5426757">.</span><span class="ident" id="5426758">Tag</span>&nbsp;<span class="op" id="5426762">!=</span>&nbsp;<span class="ident" id="5426765">nil</span>&nbsp;<span class="op" id="5426769">||</span>&nbsp;<span class="ident" id="5426772">f</span><span class="op" id="5426773">.</span><span class="ident" id="5426774">Comment</span>&nbsp;<span class="op" id="5426782">!=</span>&nbsp;<span class="ident" id="5426785">nil</span>&nbsp;<span class="op" id="5426789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426793">return</span>&nbsp;<span class="builtintype" id="5426800">false</span>&nbsp;<span class="comment" id="5426806">//&nbsp;don&#39;t&nbsp;allow&nbsp;tags&nbsp;or&nbsp;comments</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5426839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5426842">//&nbsp;only&nbsp;name(s)&nbsp;and&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426868">const</span>&nbsp;<span class="ident" id="5426874">maxSize</span>&nbsp;<span class="op" id="5426882">=</span>&nbsp;<span class="num" id="5426884">30</span>&nbsp;<span class="comment" id="5426887">//&nbsp;adjust&nbsp;as&nbsp;appropriate,&nbsp;this&nbsp;is&nbsp;an&nbsp;approximate&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5426943">namesSize</span>&nbsp;<span class="op" id="5426953">:=</span>&nbsp;<span class="ident" id="5426956">identListSize</span><span class="op" id="5426969">(</span><span class="ident" id="5426970">f</span><span class="op" id="5426971">.</span><span class="ident" id="5426972">Names</span><span class="op" id="5426977">,</span>&nbsp;<span class="ident" id="5426979">maxSize</span><span class="op" id="5426986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5426989">if</span>&nbsp;<span class="ident" id="5426992">namesSize</span>&nbsp;<span class="op" id="5427002">&gt;</span>&nbsp;<span class="num" id="5427004">0</span>&nbsp;<span class="op" id="5427006">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427010">namesSize</span>&nbsp;<span class="op" id="5427020">=</span>&nbsp;<span class="num" id="5427022">1</span>&nbsp;<span class="comment" id="5427024">//&nbsp;blank&nbsp;between&nbsp;names&nbsp;and&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427061">typeSize</span>&nbsp;<span class="op" id="5427070">:=</span>&nbsp;<span class="ident" id="5427073">p</span><span class="op" id="5427074">.</span><span class="ident" id="5427075">nodeSize</span><span class="op" id="5427083">(</span><span class="ident" id="5427084">f</span><span class="op" id="5427085">.</span><span class="ident" id="5427086">Type</span><span class="op" id="5427090">,</span>&nbsp;<span class="ident" id="5427092">maxSize</span><span class="op" id="5427099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427102">return</span>&nbsp;<span class="ident" id="5427109">namesSize</span><span class="op" id="5427118">+</span><span class="ident" id="5427119">typeSize</span>&nbsp;<span class="op" id="5427128">&lt;=</span>&nbsp;<span class="ident" id="5427131">maxSize</span><br>
<span class="lineno"></span><span class="op" id="5427139">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="5427142">func</span>&nbsp;<span class="op" id="5427147">(</span><span class="ident" id="5427148">p</span>&nbsp;<span class="op" id="5427150">*</span><span class="ident" id="5427151">printer</span><span class="op" id="5427158">)</span>&nbsp;<span class="ident" id="5427160">setLineComment</span><span class="op" id="5427174">(</span><span class="ident" id="5427175">text</span>&nbsp;<span class="builtintype" id="5427180">string</span><span class="op" id="5427186">)</span>&nbsp;<span class="op" id="5427188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427191">p</span><span class="op" id="5427192">.</span><span class="ident" id="5427193">setComment</span><span class="op" id="5427203">(</span><span class="op" id="5427204">&amp;</span><span class="ident" id="5427205">ast</span><span class="op" id="5427208">.</span><span class="ident" id="5427209">CommentGroup</span><span class="op" id="5427221">{</span><span class="ident" id="5427222">List</span><span class="op" id="5427226">:</span>&nbsp;<span class="op" id="5427228">[</span><span class="op" id="5427229">]</span><span class="op" id="5427230">*</span><span class="ident" id="5427231">ast</span><span class="op" id="5427234">.</span><span class="ident" id="5427235">Comment</span><span class="op" id="5427242">{</span><span class="op" id="5427243">{</span><span class="ident" id="5427244">Slash</span><span class="op" id="5427249">:</span>&nbsp;<span class="ident" id="5427251">token</span><span class="op" id="5427256">.</span><span class="ident" id="5427257">NoPos</span><span class="op" id="5427262">,</span>&nbsp;<span class="ident" id="5427264">Text</span><span class="op" id="5427268">:</span>&nbsp;<span class="ident" id="5427270">text</span><span class="op" id="5427274">}</span><span class="op" id="5427275">}</span><span class="op" id="5427276">}</span><span class="op" id="5427277">)</span><br>
<span class="lineno"></span><span class="op" id="5427279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5427282">func</span>&nbsp;<span class="op" id="5427287">(</span><span class="ident" id="5427288">p</span>&nbsp;<span class="op" id="5427290">*</span><span class="ident" id="5427291">printer</span><span class="op" id="5427298">)</span>&nbsp;<span class="ident" id="5427300">fieldList</span><span class="op" id="5427309">(</span><span class="ident" id="5427310">fields</span>&nbsp;<span class="op" id="5427317">*</span><span class="ident" id="5427318">ast</span><span class="op" id="5427321">.</span><span class="ident" id="5427322">FieldList</span><span class="op" id="5427331">,</span>&nbsp;<span class="ident" id="5427333">isStruct</span><span class="op" id="5427341">,</span>&nbsp;<span class="ident" id="5427343">isIncomplete</span>&nbsp;<span class="builtintype" id="5427356">bool</span><span class="op" id="5427360">)</span>&nbsp;<span class="op" id="5427362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427365">lbrace</span>&nbsp;<span class="op" id="5427372">:=</span>&nbsp;<span class="ident" id="5427375">fields</span><span class="op" id="5427381">.</span><span class="ident" id="5427382">Opening</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427391">list</span>&nbsp;<span class="op" id="5427396">:=</span>&nbsp;<span class="ident" id="5427399">fields</span><span class="op" id="5427405">.</span><span class="ident" id="5427406">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427412">rbrace</span>&nbsp;<span class="op" id="5427419">:=</span>&nbsp;<span class="ident" id="5427422">fields</span><span class="op" id="5427428">.</span><span class="ident" id="5427429">Closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427438">hasComments</span>&nbsp;<span class="op" id="5427450">:=</span>&nbsp;<span class="ident" id="5427453">isIncomplete</span>&nbsp;<span class="op" id="5427466">||</span>&nbsp;<span class="ident" id="5427469">p</span><span class="op" id="5427470">.</span><span class="ident" id="5427471">commentBefore</span><span class="op" id="5427484">(</span><span class="ident" id="5427485">p</span><span class="op" id="5427486">.</span><span class="ident" id="5427487">posFor</span><span class="op" id="5427493">(</span><span class="ident" id="5427494">rbrace</span><span class="op" id="5427500">)</span><span class="op" id="5427501">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427504">srcIsOneLine</span>&nbsp;<span class="op" id="5427517">:=</span>&nbsp;<span class="ident" id="5427520">lbrace</span><span class="op" id="5427526">.</span><span class="ident" id="5427527">IsValid</span><span class="op" id="5427534">(</span><span class="op" id="5427535">)</span>&nbsp;<span class="op" id="5427537">&amp;&amp;</span>&nbsp;<span class="ident" id="5427540">rbrace</span><span class="op" id="5427546">.</span><span class="ident" id="5427547">IsValid</span><span class="op" id="5427554">(</span><span class="op" id="5427555">)</span>&nbsp;<span class="op" id="5427557">&amp;&amp;</span>&nbsp;<span class="ident" id="5427560">p</span><span class="op" id="5427561">.</span><span class="ident" id="5427562">lineFor</span><span class="op" id="5427569">(</span><span class="ident" id="5427570">lbrace</span><span class="op" id="5427576">)</span>&nbsp;<span class="op" id="5427578">==</span>&nbsp;<span class="ident" id="5427581">p</span><span class="op" id="5427582">.</span><span class="ident" id="5427583">lineFor</span><span class="op" id="5427590">(</span><span class="ident" id="5427591">rbrace</span><span class="op" id="5427597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427601">if</span>&nbsp;<span class="op" id="5427604">!</span><span class="ident" id="5427605">hasComments</span>&nbsp;<span class="op" id="5427617">&amp;&amp;</span>&nbsp;<span class="ident" id="5427620">srcIsOneLine</span>&nbsp;<span class="op" id="5427633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5427637">//&nbsp;possibly&nbsp;a&nbsp;one-line&nbsp;struct/interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427679">if</span>&nbsp;<span class="builtinfunc" id="5427682">len</span><span class="op" id="5427685">(</span><span class="ident" id="5427686">list</span><span class="op" id="5427690">)</span>&nbsp;<span class="op" id="5427692">==</span>&nbsp;<span class="num" id="5427695">0</span>&nbsp;<span class="op" id="5427697">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5427702">//&nbsp;no&nbsp;blank&nbsp;between&nbsp;keyword&nbsp;and&nbsp;{}&nbsp;in&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427753">p</span><span class="op" id="5427754">.</span><span class="builtinfunc" id="5427755">print</span><span class="op" id="5427760">(</span><span class="ident" id="5427761">lbrace</span><span class="op" id="5427767">,</span>&nbsp;<span class="ident" id="5427769">token</span><span class="op" id="5427774">.</span><span class="ident" id="5427775">LBRACE</span><span class="op" id="5427781">,</span>&nbsp;<span class="ident" id="5427783">rbrace</span><span class="op" id="5427789">,</span>&nbsp;<span class="ident" id="5427791">token</span><span class="op" id="5427796">.</span><span class="ident" id="5427797">RBRACE</span><span class="op" id="5427803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5427808">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5427817">}</span>&nbsp;<span class="keyword" id="5427819">else</span>&nbsp;<span class="keyword" id="5427824">if</span>&nbsp;<span class="ident" id="5427827">isStruct</span>&nbsp;<span class="op" id="5427836">&amp;&amp;</span>&nbsp;<span class="ident" id="5427839">p</span><span class="op" id="5427840">.</span><span class="ident" id="5427841">isOneLineFieldList</span><span class="op" id="5427859">(</span><span class="ident" id="5427860">list</span><span class="op" id="5427864">)</span>&nbsp;<span class="op" id="5427866">{</span>&nbsp;<span class="comment" id="5427868">//&nbsp;for&nbsp;now&nbsp;ignore&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5427900">//&nbsp;small&nbsp;enough&nbsp;-&nbsp;print&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5427939">//&nbsp;(don&#39;t&nbsp;use&nbsp;identList&nbsp;and&nbsp;ignore&nbsp;source&nbsp;line&nbsp;breaks)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5427997">p</span><span class="op" id="5427998">.</span><span class="builtinfunc" id="5427999">print</span><span class="op" id="5428004">(</span><span class="ident" id="5428005">lbrace</span><span class="op" id="5428011">,</span>&nbsp;<span class="ident" id="5428013">token</span><span class="op" id="5428018">.</span><span class="ident" id="5428019">LBRACE</span><span class="op" id="5428025">,</span>&nbsp;<span class="ident" id="5428027">blank</span><span class="op" id="5428032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428037">f</span>&nbsp;<span class="op" id="5428039">:=</span>&nbsp;<span class="ident" id="5428042">list</span><span class="op" id="5428046">[</span><span class="num" id="5428047">0</span><span class="op" id="5428048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428053">for</span>&nbsp;<span class="ident" id="5428057">i</span><span class="op" id="5428058">,</span>&nbsp;<span class="ident" id="5428060">x</span>&nbsp;<span class="op" id="5428062">:=</span>&nbsp;<span class="keyword" id="5428065">range</span>&nbsp;<span class="ident" id="5428071">f</span><span class="op" id="5428072">.</span><span class="ident" id="5428073">Names</span>&nbsp;<span class="op" id="5428079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428085">if</span>&nbsp;<span class="ident" id="5428088">i</span>&nbsp;<span class="op" id="5428090">&gt;</span>&nbsp;<span class="num" id="5428092">0</span>&nbsp;<span class="op" id="5428094">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428101">//&nbsp;no&nbsp;comments&nbsp;so&nbsp;no&nbsp;need&nbsp;for&nbsp;comma&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428151">p</span><span class="op" id="5428152">.</span><span class="builtinfunc" id="5428153">print</span><span class="op" id="5428158">(</span><span class="ident" id="5428159">token</span><span class="op" id="5428164">.</span><span class="ident" id="5428165">COMMA</span><span class="op" id="5428170">,</span>&nbsp;<span class="ident" id="5428172">blank</span><span class="op" id="5428177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428189">p</span><span class="op" id="5428190">.</span><span class="ident" id="5428191">expr</span><span class="op" id="5428195">(</span><span class="ident" id="5428196">x</span><span class="op" id="5428197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428202">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428207">if</span>&nbsp;<span class="builtinfunc" id="5428210">len</span><span class="op" id="5428213">(</span><span class="ident" id="5428214">f</span><span class="op" id="5428215">.</span><span class="ident" id="5428216">Names</span><span class="op" id="5428221">)</span>&nbsp;<span class="op" id="5428223">&gt;</span>&nbsp;<span class="num" id="5428225">0</span>&nbsp;<span class="op" id="5428227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428233">p</span><span class="op" id="5428234">.</span><span class="builtinfunc" id="5428235">print</span><span class="op" id="5428240">(</span><span class="ident" id="5428241">blank</span><span class="op" id="5428246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428256">p</span><span class="op" id="5428257">.</span><span class="ident" id="5428258">expr</span><span class="op" id="5428262">(</span><span class="ident" id="5428263">f</span><span class="op" id="5428264">.</span><span class="ident" id="5428265">Type</span><span class="op" id="5428269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428274">p</span><span class="op" id="5428275">.</span><span class="builtinfunc" id="5428276">print</span><span class="op" id="5428281">(</span><span class="ident" id="5428282">blank</span><span class="op" id="5428287">,</span>&nbsp;<span class="ident" id="5428289">rbrace</span><span class="op" id="5428295">,</span>&nbsp;<span class="ident" id="5428297">token</span><span class="op" id="5428302">.</span><span class="ident" id="5428303">RBRACE</span><span class="op" id="5428309">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428329">//&nbsp;hasComments&nbsp;||&nbsp;!srcIsOneLine</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428363">p</span><span class="op" id="5428364">.</span><span class="builtinfunc" id="5428365">print</span><span class="op" id="5428370">(</span><span class="ident" id="5428371">blank</span><span class="op" id="5428376">,</span>&nbsp;<span class="ident" id="5428378">lbrace</span><span class="op" id="5428384">,</span>&nbsp;<span class="ident" id="5428386">token</span><span class="op" id="5428391">.</span><span class="ident" id="5428392">LBRACE</span><span class="op" id="5428398">,</span>&nbsp;<span class="ident" id="5428400">indent</span><span class="op" id="5428406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428409">if</span>&nbsp;<span class="ident" id="5428412">hasComments</span>&nbsp;<span class="op" id="5428424">||</span>&nbsp;<span class="builtinfunc" id="5428427">len</span><span class="op" id="5428430">(</span><span class="ident" id="5428431">list</span><span class="op" id="5428435">)</span>&nbsp;<span class="op" id="5428437">&gt;</span>&nbsp;<span class="num" id="5428439">0</span>&nbsp;<span class="op" id="5428441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428445">p</span><span class="op" id="5428446">.</span><span class="builtinfunc" id="5428447">print</span><span class="op" id="5428452">(</span><span class="ident" id="5428453">formfeed</span><span class="op" id="5428461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428468">if</span>&nbsp;<span class="ident" id="5428471">isStruct</span>&nbsp;<span class="op" id="5428480">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428485">sep</span>&nbsp;<span class="op" id="5428489">:=</span>&nbsp;<span class="ident" id="5428492">vtab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428499">if</span>&nbsp;<span class="builtinfunc" id="5428502">len</span><span class="op" id="5428505">(</span><span class="ident" id="5428506">list</span><span class="op" id="5428510">)</span>&nbsp;<span class="op" id="5428512">==</span>&nbsp;<span class="num" id="5428515">1</span>&nbsp;<span class="op" id="5428517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428522">sep</span>&nbsp;<span class="op" id="5428526">=</span>&nbsp;<span class="ident" id="5428528">blank</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428540">var</span>&nbsp;<span class="ident" id="5428544">line</span>&nbsp;<span class="builtintype" id="5428549">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428555">for</span>&nbsp;<span class="ident" id="5428559">i</span><span class="op" id="5428560">,</span>&nbsp;<span class="ident" id="5428562">f</span>&nbsp;<span class="op" id="5428564">:=</span>&nbsp;<span class="keyword" id="5428567">range</span>&nbsp;<span class="ident" id="5428573">list</span>&nbsp;<span class="op" id="5428578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428583">if</span>&nbsp;<span class="ident" id="5428586">i</span>&nbsp;<span class="op" id="5428588">&gt;</span>&nbsp;<span class="num" id="5428590">0</span>&nbsp;<span class="op" id="5428592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428598">p</span><span class="op" id="5428599">.</span><span class="ident" id="5428600">linebreak</span><span class="op" id="5428609">(</span><span class="ident" id="5428610">p</span><span class="op" id="5428611">.</span><span class="ident" id="5428612">lineFor</span><span class="op" id="5428619">(</span><span class="ident" id="5428620">f</span><span class="op" id="5428621">.</span><span class="ident" id="5428622">Pos</span><span class="op" id="5428625">(</span><span class="op" id="5428626">)</span><span class="op" id="5428627">)</span><span class="op" id="5428628">,</span>&nbsp;<span class="num" id="5428630">1</span><span class="op" id="5428631">,</span>&nbsp;<span class="ident" id="5428633">ignore</span><span class="op" id="5428639">,</span>&nbsp;<span class="ident" id="5428641">p</span><span class="op" id="5428642">.</span><span class="ident" id="5428643">linesFrom</span><span class="op" id="5428652">(</span><span class="ident" id="5428653">line</span><span class="op" id="5428657">)</span>&nbsp;<span class="op" id="5428659">&gt;</span>&nbsp;<span class="num" id="5428661">0</span><span class="op" id="5428662">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428672">extraTabs</span>&nbsp;<span class="op" id="5428682">:=</span>&nbsp;<span class="num" id="5428685">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428690">p</span><span class="op" id="5428691">.</span><span class="ident" id="5428692">setComment</span><span class="op" id="5428702">(</span><span class="ident" id="5428703">f</span><span class="op" id="5428704">.</span><span class="ident" id="5428705">Doc</span><span class="op" id="5428708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428713">p</span><span class="op" id="5428714">.</span><span class="ident" id="5428715">recordLine</span><span class="op" id="5428725">(</span><span class="op" id="5428726">&amp;</span><span class="ident" id="5428727">line</span><span class="op" id="5428731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428736">if</span>&nbsp;<span class="builtinfunc" id="5428739">len</span><span class="op" id="5428742">(</span><span class="ident" id="5428743">f</span><span class="op" id="5428744">.</span><span class="ident" id="5428745">Names</span><span class="op" id="5428750">)</span>&nbsp;<span class="op" id="5428752">&gt;</span>&nbsp;<span class="num" id="5428754">0</span>&nbsp;<span class="op" id="5428756">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428762">//&nbsp;named&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428782">p</span><span class="op" id="5428783">.</span><span class="ident" id="5428784">identList</span><span class="op" id="5428793">(</span><span class="ident" id="5428794">f</span><span class="op" id="5428795">.</span><span class="ident" id="5428796">Names</span><span class="op" id="5428801">,</span>&nbsp;<span class="builtintype" id="5428803">false</span><span class="op" id="5428808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428814">p</span><span class="op" id="5428815">.</span><span class="builtinfunc" id="5428816">print</span><span class="op" id="5428821">(</span><span class="ident" id="5428822">sep</span><span class="op" id="5428825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428831">p</span><span class="op" id="5428832">.</span><span class="ident" id="5428833">expr</span><span class="op" id="5428837">(</span><span class="ident" id="5428838">f</span><span class="op" id="5428839">.</span><span class="ident" id="5428840">Type</span><span class="op" id="5428844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428850">extraTabs</span>&nbsp;<span class="op" id="5428860">=</span>&nbsp;<span class="num" id="5428862">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428867">}</span>&nbsp;<span class="keyword" id="5428869">else</span>&nbsp;<span class="op" id="5428874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5428880">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428903">p</span><span class="op" id="5428904">.</span><span class="ident" id="5428905">expr</span><span class="op" id="5428909">(</span><span class="ident" id="5428910">f</span><span class="op" id="5428911">.</span><span class="ident" id="5428912">Type</span><span class="op" id="5428916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5428922">extraTabs</span>&nbsp;<span class="op" id="5428932">=</span>&nbsp;<span class="num" id="5428934">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5428939">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428944">if</span>&nbsp;<span class="ident" id="5428947">f</span><span class="op" id="5428948">.</span><span class="ident" id="5428949">Tag</span>&nbsp;<span class="op" id="5428953">!=</span>&nbsp;<span class="ident" id="5428956">nil</span>&nbsp;<span class="op" id="5428960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5428966">if</span>&nbsp;<span class="builtinfunc" id="5428969">len</span><span class="op" id="5428972">(</span><span class="ident" id="5428973">f</span><span class="op" id="5428974">.</span><span class="ident" id="5428975">Names</span><span class="op" id="5428980">)</span>&nbsp;<span class="op" id="5428982">&gt;</span>&nbsp;<span class="num" id="5428984">0</span>&nbsp;<span class="op" id="5428986">&amp;&amp;</span>&nbsp;<span class="ident" id="5428989">sep</span>&nbsp;<span class="op" id="5428993">==</span>&nbsp;<span class="ident" id="5428996">vtab</span>&nbsp;<span class="op" id="5429001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429008">p</span><span class="op" id="5429009">.</span><span class="builtinfunc" id="5429010">print</span><span class="op" id="5429015">(</span><span class="ident" id="5429016">sep</span><span class="op" id="5429019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429031">p</span><span class="op" id="5429032">.</span><span class="builtinfunc" id="5429033">print</span><span class="op" id="5429038">(</span><span class="ident" id="5429039">sep</span><span class="op" id="5429042">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429048">p</span><span class="op" id="5429049">.</span><span class="ident" id="5429050">expr</span><span class="op" id="5429054">(</span><span class="ident" id="5429055">f</span><span class="op" id="5429056">.</span><span class="ident" id="5429057">Tag</span><span class="op" id="5429060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429066">extraTabs</span>&nbsp;<span class="op" id="5429076">=</span>&nbsp;<span class="num" id="5429078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429088">if</span>&nbsp;<span class="ident" id="5429091">f</span><span class="op" id="5429092">.</span><span class="ident" id="5429093">Comment</span>&nbsp;<span class="op" id="5429101">!=</span>&nbsp;<span class="ident" id="5429104">nil</span>&nbsp;<span class="op" id="5429108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429114">for</span>&nbsp;<span class="op" id="5429118">;</span>&nbsp;<span class="ident" id="5429120">extraTabs</span>&nbsp;<span class="op" id="5429130">&gt;</span>&nbsp;<span class="num" id="5429132">0</span><span class="op" id="5429133">;</span>&nbsp;<span class="ident" id="5429135">extraTabs</span><span class="op" id="5429144">--</span>&nbsp;<span class="op" id="5429147">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429154">p</span><span class="op" id="5429155">.</span><span class="builtinfunc" id="5429156">print</span><span class="op" id="5429161">(</span><span class="ident" id="5429162">sep</span><span class="op" id="5429165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429177">p</span><span class="op" id="5429178">.</span><span class="ident" id="5429179">setComment</span><span class="op" id="5429189">(</span><span class="ident" id="5429190">f</span><span class="op" id="5429191">.</span><span class="ident" id="5429192">Comment</span><span class="op" id="5429199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429208">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429212">if</span>&nbsp;<span class="ident" id="5429215">isIncomplete</span>&nbsp;<span class="op" id="5429228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429233">if</span>&nbsp;<span class="builtinfunc" id="5429236">len</span><span class="op" id="5429239">(</span><span class="ident" id="5429240">list</span><span class="op" id="5429244">)</span>&nbsp;<span class="op" id="5429246">&gt;</span>&nbsp;<span class="num" id="5429248">0</span>&nbsp;<span class="op" id="5429250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429256">p</span><span class="op" id="5429257">.</span><span class="builtinfunc" id="5429258">print</span><span class="op" id="5429263">(</span><span class="ident" id="5429264">formfeed</span><span class="op" id="5429272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429282">p</span><span class="op" id="5429283">.</span><span class="ident" id="5429284">flush</span><span class="op" id="5429289">(</span><span class="ident" id="5429290">p</span><span class="op" id="5429291">.</span><span class="ident" id="5429292">posFor</span><span class="op" id="5429298">(</span><span class="ident" id="5429299">rbrace</span><span class="op" id="5429305">)</span><span class="op" id="5429306">,</span>&nbsp;<span class="ident" id="5429308">token</span><span class="op" id="5429313">.</span><span class="ident" id="5429314">RBRACE</span><span class="op" id="5429320">)</span>&nbsp;<span class="comment" id="5429322">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429374">p</span><span class="op" id="5429375">.</span><span class="ident" id="5429376">setLineComment</span><span class="op" id="5429390">(</span><span class="string" id="5429391">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;fields&#34;</span><span class="op" id="5429434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429442">}</span>&nbsp;<span class="keyword" id="5429444">else</span>&nbsp;<span class="op" id="5429449">{</span>&nbsp;<span class="comment" id="5429451">//&nbsp;interface</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429467">var</span>&nbsp;<span class="ident" id="5429471">line</span>&nbsp;<span class="builtintype" id="5429476">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429482">for</span>&nbsp;<span class="ident" id="5429486">i</span><span class="op" id="5429487">,</span>&nbsp;<span class="ident" id="5429489">f</span>&nbsp;<span class="op" id="5429491">:=</span>&nbsp;<span class="keyword" id="5429494">range</span>&nbsp;<span class="ident" id="5429500">list</span>&nbsp;<span class="op" id="5429505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429510">if</span>&nbsp;<span class="ident" id="5429513">i</span>&nbsp;<span class="op" id="5429515">&gt;</span>&nbsp;<span class="num" id="5429517">0</span>&nbsp;<span class="op" id="5429519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429525">p</span><span class="op" id="5429526">.</span><span class="ident" id="5429527">linebreak</span><span class="op" id="5429536">(</span><span class="ident" id="5429537">p</span><span class="op" id="5429538">.</span><span class="ident" id="5429539">lineFor</span><span class="op" id="5429546">(</span><span class="ident" id="5429547">f</span><span class="op" id="5429548">.</span><span class="ident" id="5429549">Pos</span><span class="op" id="5429552">(</span><span class="op" id="5429553">)</span><span class="op" id="5429554">)</span><span class="op" id="5429555">,</span>&nbsp;<span class="num" id="5429557">1</span><span class="op" id="5429558">,</span>&nbsp;<span class="ident" id="5429560">ignore</span><span class="op" id="5429566">,</span>&nbsp;<span class="ident" id="5429568">p</span><span class="op" id="5429569">.</span><span class="ident" id="5429570">linesFrom</span><span class="op" id="5429579">(</span><span class="ident" id="5429580">line</span><span class="op" id="5429584">)</span>&nbsp;<span class="op" id="5429586">&gt;</span>&nbsp;<span class="num" id="5429588">0</span><span class="op" id="5429589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429594">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429599">p</span><span class="op" id="5429600">.</span><span class="ident" id="5429601">setComment</span><span class="op" id="5429611">(</span><span class="ident" id="5429612">f</span><span class="op" id="5429613">.</span><span class="ident" id="5429614">Doc</span><span class="op" id="5429617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429622">p</span><span class="op" id="5429623">.</span><span class="ident" id="5429624">recordLine</span><span class="op" id="5429634">(</span><span class="op" id="5429635">&amp;</span><span class="ident" id="5429636">line</span><span class="op" id="5429640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429645">if</span>&nbsp;<span class="ident" id="5429648">ftyp</span><span class="op" id="5429652">,</span>&nbsp;<span class="ident" id="5429654">isFtyp</span>&nbsp;<span class="op" id="5429661">:=</span>&nbsp;<span class="ident" id="5429664">f</span><span class="op" id="5429665">.</span><span class="ident" id="5429666">Type</span><span class="op" id="5429670">.</span><span class="op" id="5429671">(</span><span class="op" id="5429672">*</span><span class="ident" id="5429673">ast</span><span class="op" id="5429676">.</span><span class="ident" id="5429677">FuncType</span><span class="op" id="5429685">)</span><span class="op" id="5429686">;</span>&nbsp;<span class="ident" id="5429688">isFtyp</span>&nbsp;<span class="op" id="5429695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429701">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429715">p</span><span class="op" id="5429716">.</span><span class="ident" id="5429717">expr</span><span class="op" id="5429721">(</span><span class="ident" id="5429722">f</span><span class="op" id="5429723">.</span><span class="ident" id="5429724">Names</span><span class="op" id="5429729">[</span><span class="num" id="5429730">0</span><span class="op" id="5429731">]</span><span class="op" id="5429732">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429738">p</span><span class="op" id="5429739">.</span><span class="ident" id="5429740">signature</span><span class="op" id="5429749">(</span><span class="ident" id="5429750">ftyp</span><span class="op" id="5429754">.</span><span class="ident" id="5429755">Params</span><span class="op" id="5429761">,</span>&nbsp;<span class="ident" id="5429763">ftyp</span><span class="op" id="5429767">.</span><span class="ident" id="5429768">Results</span><span class="op" id="5429775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429780">}</span>&nbsp;<span class="keyword" id="5429782">else</span>&nbsp;<span class="op" id="5429787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5429793">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429819">p</span><span class="op" id="5429820">.</span><span class="ident" id="5429821">expr</span><span class="op" id="5429825">(</span><span class="ident" id="5429826">f</span><span class="op" id="5429827">.</span><span class="ident" id="5429828">Type</span><span class="op" id="5429832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429837">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429842">p</span><span class="op" id="5429843">.</span><span class="ident" id="5429844">setComment</span><span class="op" id="5429854">(</span><span class="ident" id="5429855">f</span><span class="op" id="5429856">.</span><span class="ident" id="5429857">Comment</span><span class="op" id="5429864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429872">if</span>&nbsp;<span class="ident" id="5429875">isIncomplete</span>&nbsp;<span class="op" id="5429888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5429893">if</span>&nbsp;<span class="builtinfunc" id="5429896">len</span><span class="op" id="5429899">(</span><span class="ident" id="5429900">list</span><span class="op" id="5429904">)</span>&nbsp;<span class="op" id="5429906">&gt;</span>&nbsp;<span class="num" id="5429908">0</span>&nbsp;<span class="op" id="5429910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429916">p</span><span class="op" id="5429917">.</span><span class="builtinfunc" id="5429918">print</span><span class="op" id="5429923">(</span><span class="ident" id="5429924">formfeed</span><span class="op" id="5429932">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5429937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5429942">p</span><span class="op" id="5429943">.</span><span class="ident" id="5429944">flush</span><span class="op" id="5429949">(</span><span class="ident" id="5429950">p</span><span class="op" id="5429951">.</span><span class="ident" id="5429952">posFor</span><span class="op" id="5429958">(</span><span class="ident" id="5429959">rbrace</span><span class="op" id="5429965">)</span><span class="op" id="5429966">,</span>&nbsp;<span class="ident" id="5429968">token</span><span class="op" id="5429973">.</span><span class="ident" id="5429974">RBRACE</span><span class="op" id="5429980">)</span>&nbsp;<span class="comment" id="5429982">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;the&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430034">p</span><span class="op" id="5430035">.</span><span class="ident" id="5430036">setLineComment</span><span class="op" id="5430050">(</span><span class="string" id="5430051">&#34;//&nbsp;contains&nbsp;filtered&nbsp;or&nbsp;unexported&nbsp;methods&#34;</span><span class="op" id="5430095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430106">p</span><span class="op" id="5430107">.</span><span class="builtinfunc" id="5430108">print</span><span class="op" id="5430113">(</span><span class="ident" id="5430114">unindent</span><span class="op" id="5430122">,</span>&nbsp;<span class="ident" id="5430124">formfeed</span><span class="op" id="5430132">,</span>&nbsp;<span class="ident" id="5430134">rbrace</span><span class="op" id="5430140">,</span>&nbsp;<span class="ident" id="5430142">token</span><span class="op" id="5430147">.</span><span class="ident" id="5430148">RBRACE</span><span class="op" id="5430154">)</span><br>
<span class="lineno"></span><span class="op" id="5430156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5430159">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">505</span><span class="comment" id="5430239">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5430255">func</span>&nbsp;<span class="ident" id="5430260">walkBinary</span><span class="op" id="5430270">(</span><span class="ident" id="5430271">e</span>&nbsp;<span class="op" id="5430273">*</span><span class="ident" id="5430274">ast</span><span class="op" id="5430277">.</span><span class="ident" id="5430278">BinaryExpr</span><span class="op" id="5430288">)</span>&nbsp;<span class="op" id="5430290">(</span><span class="ident" id="5430291">has4</span><span class="op" id="5430295">,</span>&nbsp;<span class="ident" id="5430297">has5</span>&nbsp;<span class="builtintype" id="5430302">bool</span><span class="op" id="5430306">,</span>&nbsp;<span class="ident" id="5430308">maxProblem</span>&nbsp;<span class="builtintype" id="5430319">int</span><span class="op" id="5430322">)</span>&nbsp;<span class="op" id="5430324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430327">switch</span>&nbsp;<span class="ident" id="5430334">e</span><span class="op" id="5430335">.</span><span class="ident" id="5430336">Op</span><span class="op" id="5430338">.</span><span class="ident" id="5430339">Precedence</span><span class="op" id="5430349">(</span><span class="op" id="5430350">)</span>&nbsp;<span class="op" id="5430352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430355">case</span>&nbsp;<span class="num" id="5430360">4</span><span class="op" id="5430361">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430365">has4</span>&nbsp;<span class="op" id="5430370">=</span>&nbsp;<span class="builtintype" id="5430372">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430378">case</span>&nbsp;<span class="num" id="5430383">5</span><span class="op" id="5430384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430388">has5</span>&nbsp;<span class="op" id="5430393">=</span>&nbsp;<span class="builtintype" id="5430395">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430405">switch</span>&nbsp;<span class="ident" id="5430412">l</span>&nbsp;<span class="op" id="5430414">:=</span>&nbsp;<span class="ident" id="5430417">e</span><span class="op" id="5430418">.</span><span class="ident" id="5430419">X</span><span class="op" id="5430420">.</span><span class="op" id="5430421">(</span><span class="keyword" id="5430422">type</span><span class="op" id="5430426">)</span>&nbsp;<span class="op" id="5430428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430431">case</span>&nbsp;<span class="op" id="5430436">*</span><span class="ident" id="5430437">ast</span><span class="op" id="5430440">.</span><span class="ident" id="5430441">BinaryExpr</span><span class="op" id="5430451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430455">if</span>&nbsp;<span class="ident" id="5430458">l</span><span class="op" id="5430459">.</span><span class="ident" id="5430460">Op</span><span class="op" id="5430462">.</span><span class="ident" id="5430463">Precedence</span><span class="op" id="5430473">(</span><span class="op" id="5430474">)</span>&nbsp;<span class="op" id="5430476">&lt;</span>&nbsp;<span class="ident" id="5430478">e</span><span class="op" id="5430479">.</span><span class="ident" id="5430480">Op</span><span class="op" id="5430482">.</span><span class="ident" id="5430483">Precedence</span><span class="op" id="5430493">(</span><span class="op" id="5430494">)</span>&nbsp;<span class="op" id="5430496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430501">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430532">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430588">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430600">h4</span><span class="op" id="5430602">,</span>&nbsp;<span class="ident" id="5430604">h5</span><span class="op" id="5430606">,</span>&nbsp;<span class="ident" id="5430608">mp</span>&nbsp;<span class="op" id="5430611">:=</span>&nbsp;<span class="ident" id="5430614">walkBinary</span><span class="op" id="5430624">(</span><span class="ident" id="5430625">l</span><span class="op" id="5430626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430630">has4</span>&nbsp;<span class="op" id="5430635">=</span>&nbsp;<span class="ident" id="5430637">has4</span>&nbsp;<span class="op" id="5430642">||</span>&nbsp;<span class="ident" id="5430645">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430650">has5</span>&nbsp;<span class="op" id="5430655">=</span>&nbsp;<span class="ident" id="5430657">has5</span>&nbsp;<span class="op" id="5430662">||</span>&nbsp;<span class="ident" id="5430665">h5</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430670">if</span>&nbsp;<span class="ident" id="5430673">maxProblem</span>&nbsp;<span class="op" id="5430684">&lt;</span>&nbsp;<span class="ident" id="5430686">mp</span>&nbsp;<span class="op" id="5430689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430694">maxProblem</span>&nbsp;<span class="op" id="5430705">=</span>&nbsp;<span class="ident" id="5430707">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430719">switch</span>&nbsp;<span class="ident" id="5430726">r</span>&nbsp;<span class="op" id="5430728">:=</span>&nbsp;<span class="ident" id="5430731">e</span><span class="op" id="5430732">.</span><span class="ident" id="5430733">Y</span><span class="op" id="5430734">.</span><span class="op" id="5430735">(</span><span class="keyword" id="5430736">type</span><span class="op" id="5430740">)</span>&nbsp;<span class="op" id="5430742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430745">case</span>&nbsp;<span class="op" id="5430750">*</span><span class="ident" id="5430751">ast</span><span class="op" id="5430754">.</span><span class="ident" id="5430755">BinaryExpr</span><span class="op" id="5430765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430769">if</span>&nbsp;<span class="ident" id="5430772">r</span><span class="op" id="5430773">.</span><span class="ident" id="5430774">Op</span><span class="op" id="5430776">.</span><span class="ident" id="5430777">Precedence</span><span class="op" id="5430787">(</span><span class="op" id="5430788">)</span>&nbsp;<span class="op" id="5430790">&lt;=</span>&nbsp;<span class="ident" id="5430793">e</span><span class="op" id="5430794">.</span><span class="ident" id="5430795">Op</span><span class="op" id="5430797">.</span><span class="ident" id="5430798">Precedence</span><span class="op" id="5430808">(</span><span class="op" id="5430809">)</span>&nbsp;<span class="op" id="5430811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430816">//&nbsp;parens&nbsp;will&nbsp;be&nbsp;inserted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5430847">//&nbsp;pretend&nbsp;this&nbsp;is&nbsp;an&nbsp;*ast.ParenExpr&nbsp;and&nbsp;do&nbsp;nothing.</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430903">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5430911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430915">h4</span><span class="op" id="5430917">,</span>&nbsp;<span class="ident" id="5430919">h5</span><span class="op" id="5430921">,</span>&nbsp;<span class="ident" id="5430923">mp</span>&nbsp;<span class="op" id="5430926">:=</span>&nbsp;<span class="ident" id="5430929">walkBinary</span><span class="op" id="5430939">(</span><span class="ident" id="5430940">r</span><span class="op" id="5430941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430945">has4</span>&nbsp;<span class="op" id="5430950">=</span>&nbsp;<span class="ident" id="5430952">has4</span>&nbsp;<span class="op" id="5430957">||</span>&nbsp;<span class="ident" id="5430960">h4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5430965">has5</span>&nbsp;<span class="op" id="5430970">=</span>&nbsp;<span class="ident" id="5430972">has5</span>&nbsp;<span class="op" id="5430977">||</span>&nbsp;<span class="ident" id="5430980">h5</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5430985">if</span>&nbsp;<span class="ident" id="5430988">maxProblem</span>&nbsp;<span class="op" id="5430999">&lt;</span>&nbsp;<span class="ident" id="5431001">mp</span>&nbsp;<span class="op" id="5431004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431009">maxProblem</span>&nbsp;<span class="op" id="5431020">=</span>&nbsp;<span class="ident" id="5431022">mp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431031">case</span>&nbsp;<span class="op" id="5431036">*</span><span class="ident" id="5431037">ast</span><span class="op" id="5431040">.</span><span class="ident" id="5431041">StarExpr</span><span class="op" id="5431049">:</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431053">if</span>&nbsp;<span class="ident" id="5431056">e</span><span class="op" id="5431057">.</span><span class="ident" id="5431058">Op</span>&nbsp;<span class="op" id="5431061">==</span>&nbsp;<span class="ident" id="5431064">token</span><span class="op" id="5431069">.</span><span class="ident" id="5431070">QUO</span>&nbsp;<span class="op" id="5431074">{</span>&nbsp;<span class="comment" id="5431076">//&nbsp;`*/`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431087">maxProblem</span>&nbsp;<span class="op" id="5431098">=</span>&nbsp;<span class="num" id="5431100">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431108">case</span>&nbsp;<span class="op" id="5431113">*</span><span class="ident" id="5431114">ast</span><span class="op" id="5431117">.</span><span class="ident" id="5431118">UnaryExpr</span><span class="op" id="5431127">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431131">switch</span>&nbsp;<span class="ident" id="5431138">e</span><span class="op" id="5431139">.</span><span class="ident" id="5431140">Op</span><span class="op" id="5431142">.</span><span class="ident" id="5431143">String</span><span class="op" id="5431149">(</span><span class="op" id="5431150">)</span>&nbsp;<span class="op" id="5431152">+</span>&nbsp;<span class="ident" id="5431154">r</span><span class="op" id="5431155">.</span><span class="ident" id="5431156">Op</span><span class="op" id="5431158">.</span><span class="ident" id="5431159">String</span><span class="op" id="5431165">(</span><span class="op" id="5431166">)</span>&nbsp;<span class="op" id="5431168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431172">case</span>&nbsp;<span class="string" id="5431177">&#34;/*&#34;</span><span class="op" id="5431181">,</span>&nbsp;<span class="string" id="5431183">&#34;&amp;&amp;&#34;</span><span class="op" id="5431187">,</span>&nbsp;<span class="string" id="5431189">&#34;&amp;^&#34;</span><span class="op" id="5431193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431198">maxProblem</span>&nbsp;<span class="op" id="5431209">=</span>&nbsp;<span class="num" id="5431211">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431215">case</span>&nbsp;<span class="string" id="5431220">&#34;++&#34;</span><span class="op" id="5431224">,</span>&nbsp;<span class="string" id="5431226">&#34;--&#34;</span><span class="op" id="5431230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431235">if</span>&nbsp;<span class="ident" id="5431238">maxProblem</span>&nbsp;<span class="op" id="5431249">&lt;</span>&nbsp;<span class="num" id="5431251">4</span>&nbsp;<span class="op" id="5431253">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431259">maxProblem</span>&nbsp;<span class="op" id="5431270">=</span>&nbsp;<span class="num" id="5431272">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431287">return</span><br>
<span class="lineno">560</span><span class="op" id="5431294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431297">func</span>&nbsp;<span class="ident" id="5431302">cutoff</span><span class="op" id="5431308">(</span><span class="ident" id="5431309">e</span>&nbsp;<span class="op" id="5431311">*</span><span class="ident" id="5431312">ast</span><span class="op" id="5431315">.</span><span class="ident" id="5431316">BinaryExpr</span><span class="op" id="5431326">,</span>&nbsp;<span class="ident" id="5431328">depth</span>&nbsp;<span class="builtintype" id="5431334">int</span><span class="op" id="5431337">)</span>&nbsp;<span class="builtintype" id="5431339">int</span>&nbsp;<span class="op" id="5431343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431346">has4</span><span class="op" id="5431350">,</span>&nbsp;<span class="ident" id="5431352">has5</span><span class="op" id="5431356">,</span>&nbsp;<span class="ident" id="5431358">maxProblem</span>&nbsp;<span class="op" id="5431369">:=</span>&nbsp;<span class="ident" id="5431372">walkBinary</span><span class="op" id="5431382">(</span><span class="ident" id="5431383">e</span><span class="op" id="5431384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431387">if</span>&nbsp;<span class="ident" id="5431390">maxProblem</span>&nbsp;<span class="op" id="5431401">&gt;</span>&nbsp;<span class="num" id="5431403">0</span>&nbsp;<span class="op" id="5431405">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431409">return</span>&nbsp;<span class="ident" id="5431416">maxProblem</span>&nbsp;<span class="op" id="5431427">+</span>&nbsp;<span class="num" id="5431429">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431435">if</span>&nbsp;<span class="ident" id="5431438">has4</span>&nbsp;<span class="op" id="5431443">&amp;&amp;</span>&nbsp;<span class="ident" id="5431446">has5</span>&nbsp;<span class="op" id="5431451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431455">if</span>&nbsp;<span class="ident" id="5431458">depth</span>&nbsp;<span class="op" id="5431464">==</span>&nbsp;<span class="num" id="5431467">1</span>&nbsp;<span class="op" id="5431469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431474">return</span>&nbsp;<span class="num" id="5431481">5</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431489">return</span>&nbsp;<span class="num" id="5431496">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431502">if</span>&nbsp;<span class="ident" id="5431505">depth</span>&nbsp;<span class="op" id="5431511">==</span>&nbsp;<span class="num" id="5431514">1</span>&nbsp;<span class="op" id="5431516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431520">return</span>&nbsp;<span class="num" id="5431527">6</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431533">return</span>&nbsp;<span class="num" id="5431540">4</span><br>
<span class="lineno"></span><span class="op" id="5431542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431545">func</span>&nbsp;<span class="ident" id="5431550">diffPrec</span><span class="op" id="5431558">(</span><span class="ident" id="5431559">expr</span>&nbsp;<span class="ident" id="5431564">ast</span><span class="op" id="5431567">.</span><span class="ident" id="5431568">Expr</span><span class="op" id="5431572">,</span>&nbsp;<span class="ident" id="5431574">prec</span>&nbsp;<span class="builtintype" id="5431579">int</span><span class="op" id="5431582">)</span>&nbsp;<span class="builtintype" id="5431584">int</span>&nbsp;<span class="op" id="5431588">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431591">x</span><span class="op" id="5431592">,</span>&nbsp;<span class="ident" id="5431594">ok</span>&nbsp;<span class="op" id="5431597">:=</span>&nbsp;<span class="ident" id="5431600">expr</span><span class="op" id="5431604">.</span><span class="op" id="5431605">(</span><span class="op" id="5431606">*</span><span class="ident" id="5431607">ast</span><span class="op" id="5431610">.</span><span class="ident" id="5431611">BinaryExpr</span><span class="op" id="5431621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431624">if</span>&nbsp;<span class="op" id="5431627">!</span><span class="ident" id="5431628">ok</span>&nbsp;<span class="op" id="5431631">||</span>&nbsp;<span class="ident" id="5431634">prec</span>&nbsp;<span class="op" id="5431639">!=</span>&nbsp;<span class="ident" id="5431642">x</span><span class="op" id="5431643">.</span><span class="ident" id="5431644">Op</span><span class="op" id="5431646">.</span><span class="ident" id="5431647">Precedence</span><span class="op" id="5431657">(</span><span class="op" id="5431658">)</span>&nbsp;<span class="op" id="5431660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431664">return</span>&nbsp;<span class="num" id="5431671">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431677">return</span>&nbsp;<span class="num" id="5431684">0</span><br>
<span class="lineno">585</span><span class="op" id="5431686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5431689">func</span>&nbsp;<span class="ident" id="5431694">reduceDepth</span><span class="op" id="5431705">(</span><span class="ident" id="5431706">depth</span>&nbsp;<span class="builtintype" id="5431712">int</span><span class="op" id="5431715">)</span>&nbsp;<span class="builtintype" id="5431717">int</span>&nbsp;<span class="op" id="5431721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431724">depth</span><span class="op" id="5431729">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431733">if</span>&nbsp;<span class="ident" id="5431736">depth</span>&nbsp;<span class="op" id="5431742">&lt;</span>&nbsp;<span class="num" id="5431744">1</span>&nbsp;<span class="op" id="5431746">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5431750">depth</span>&nbsp;<span class="op" id="5431756">=</span>&nbsp;<span class="num" id="5431758">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5431761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5431764">return</span>&nbsp;<span class="ident" id="5431771">depth</span><br>
<span class="lineno"></span><span class="op" id="5431777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5431780">//&nbsp;Format&nbsp;the&nbsp;binary&nbsp;expression:&nbsp;decide&nbsp;the&nbsp;cutoff&nbsp;and&nbsp;then&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5431848">//&nbsp;Let&#39;s&nbsp;call&nbsp;depth&nbsp;==&nbsp;1&nbsp;Normal&nbsp;mode,&nbsp;and&nbsp;depth&nbsp;&gt;&nbsp;1&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5431914">//&nbsp;(Algorithm&nbsp;suggestion&nbsp;by&nbsp;Russ&nbsp;Cox.)</span><br>
<span class="lineno"></span><span class="comment" id="5431953">//</span><br>
<span class="lineno"></span><span class="comment" id="5431956">//&nbsp;The&nbsp;precedences&nbsp;are:</span><br>
<span class="lineno">600</span><span class="comment" id="5431980">//&nbsp;&nbsp;&nbsp;&nbsp5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;/&nbsp;&nbsp;%&nbsp;&nbsp;&lt;&lt;&nbsp;&nbsp;&gt;&gt;&nbsp;&nbsp;&amp;&nbsp;&nbsp;&amp;^</span><br>
<span class="lineno"></span><span class="comment" id="5432020">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;-&nbsp;&nbsp;|&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="5432048">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;==&nbsp;&nbsp;!=&nbsp;&nbsp;&lt;&nbsp;&nbsp;&lt;=&nbsp;&nbsp;&gt;&nbsp;&nbsp;&gt;=</span><br>
<span class="lineno"></span><span class="comment" id="5432086">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;</span><br>
<span class="lineno"></span><span class="comment" id="5432106">//&nbsp;&nbsp;&nbsp;&nbsp1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;||</span><br>
<span class="lineno">605</span><span class="comment" id="5432126">//</span><br>
<span class="lineno"></span><span class="comment" id="5432129">//&nbsp;The&nbsp;only&nbsp;decision&nbsp;is&nbsp;whether&nbsp;there&nbsp;will&nbsp;be&nbsp;spaces&nbsp;around&nbsp;levels&nbsp;4&nbsp;and&nbsp;5.</span><br>
<span class="lineno"></span><span class="comment" id="5432205">//&nbsp;There&nbsp;are&nbsp;never&nbsp;spaces&nbsp;at&nbsp;level&nbsp;6&nbsp;(unary),&nbsp;and&nbsp;always&nbsp;spaces&nbsp;at&nbsp;levels&nbsp;3&nbsp;and&nbsp;below.</span><br>
<span class="lineno"></span><span class="comment" id="5432292">//</span><br>
<span class="lineno"></span><span class="comment" id="5432295">//&nbsp;To&nbsp;choose&nbsp;the&nbsp;cutoff,&nbsp;look&nbsp;at&nbsp;the&nbsp;whole&nbsp;expression&nbsp;but&nbsp;excluding&nbsp;primary</span><br>
<span class="lineno">610</span><span class="comment" id="5432371">//&nbsp;expressions&nbsp;(function&nbsp;calls,&nbsp;parenthesized&nbsp;exprs),&nbsp;and&nbsp;apply&nbsp;these&nbsp;rules:</span><br>
<span class="lineno"></span><span class="comment" id="5432448">//</span><br>
<span class="lineno"></span><span class="comment" id="5432451">//&nbsp;&nbsp;&nbsp;&nbsp1)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;binary&nbsp;operator&nbsp;with&nbsp;a&nbsp;right&nbsp;side&nbsp;unary&nbsp;operand</span><br>
<span class="lineno"></span><span class="comment" id="5432519">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;would&nbsp;clash&nbsp;without&nbsp;a&nbsp;space,&nbsp;the&nbsp;cutoff&nbsp;must&nbsp;be&nbsp;(in&nbsp;order):</span><br>
<span class="lineno"></span><span class="comment" id="5432590">//</span><br>
<span class="lineno">615</span><span class="comment" id="5432593">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/*&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5432602">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&amp;&amp;&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5432611">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&amp;^&nbsp;&nbsp;&nbsp;&nbsp6</span><br>
<span class="lineno"></span><span class="comment" id="5432620">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp++&nbsp;&nbsp;&nbsp;&nbsp5</span><br>
<span class="lineno"></span><span class="comment" id="5432629">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp--&nbsp;&nbsp;&nbsp;&nbsp5</span><br>
<span class="lineno">620</span><span class="comment" id="5432638">//</span><br>
<span class="lineno"></span><span class="comment" id="5432641">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Comparison&nbsp;operators&nbsp;always&nbsp;have&nbsp;spaces&nbsp;around&nbsp;them.)</span><br>
<span class="lineno"></span><span class="comment" id="5432707">//</span><br>
<span class="lineno"></span><span class="comment" id="5432710">//&nbsp;&nbsp;&nbsp;&nbsp2)&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;mix&nbsp;of&nbsp;level&nbsp;5&nbsp;and&nbsp;level&nbsp;4&nbsp;operators,&nbsp;then&nbsp;the&nbsp;cutoff</span><br>
<span class="lineno"></span><span class="comment" id="5432784">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;is&nbsp;5&nbsp;(use&nbsp;spaces&nbsp;to&nbsp;distinguish&nbsp;precedence)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno">625</span><span class="comment" id="5432849">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno"></span><span class="comment" id="5432897">//</span><br>
<span class="lineno"></span><span class="comment" id="5432900">//&nbsp;&nbsp;&nbsp;&nbsp3)&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;level&nbsp;4&nbsp;operators&nbsp;or&nbsp;no&nbsp;level&nbsp;5&nbsp;operators,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5432974">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;cutoff&nbsp;is&nbsp;6&nbsp;(always&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Normal&nbsp;mode</span><br>
<span class="lineno"></span><span class="comment" id="5433027">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;and&nbsp;4&nbsp;(never&nbsp;use&nbsp;spaces)&nbsp;in&nbsp;Compact&nbsp;mode.</span><br>
<span class="lineno">630</span><span class="comment" id="5433075">//</span><br>
<span class="lineno"></span><span class="keyword" id="5433078">func</span>&nbsp;<span class="op" id="5433083">(</span><span class="ident" id="5433084">p</span>&nbsp;<span class="op" id="5433086">*</span><span class="ident" id="5433087">printer</span><span class="op" id="5433094">)</span>&nbsp;<span class="ident" id="5433096">binaryExpr</span><span class="op" id="5433106">(</span><span class="ident" id="5433107">x</span>&nbsp;<span class="op" id="5433109">*</span><span class="ident" id="5433110">ast</span><span class="op" id="5433113">.</span><span class="ident" id="5433114">BinaryExpr</span><span class="op" id="5433124">,</span>&nbsp;<span class="ident" id="5433126">prec1</span><span class="op" id="5433131">,</span>&nbsp;<span class="ident" id="5433133">cutoff</span><span class="op" id="5433139">,</span>&nbsp;<span class="ident" id="5433141">depth</span>&nbsp;<span class="builtintype" id="5433147">int</span><span class="op" id="5433150">)</span>&nbsp;<span class="op" id="5433152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433155">prec</span>&nbsp;<span class="op" id="5433160">:=</span>&nbsp;<span class="ident" id="5433163">x</span><span class="op" id="5433164">.</span><span class="ident" id="5433165">Op</span><span class="op" id="5433167">.</span><span class="ident" id="5433168">Precedence</span><span class="op" id="5433178">(</span><span class="op" id="5433179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433182">if</span>&nbsp;<span class="ident" id="5433185">prec</span>&nbsp;<span class="op" id="5433190">&lt;</span>&nbsp;<span class="ident" id="5433192">prec1</span>&nbsp;<span class="op" id="5433198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433202">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433226">//&nbsp;Note:&nbsp;The&nbsp;parser&nbsp;inserts&nbsp;an&nbsp;ast.ParenExpr&nbsp;node;&nbsp;thus&nbsp;this&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;can&nbsp;only&nbsp;occur&nbsp;if&nbsp;the&nbsp;AST&nbsp;is&nbsp;created&nbsp;in&nbsp;a&nbsp;different&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433362">p</span><span class="op" id="5433363">.</span><span class="builtinfunc" id="5433364">print</span><span class="op" id="5433369">(</span><span class="ident" id="5433370">token</span><span class="op" id="5433375">.</span><span class="ident" id="5433376">LPAREN</span><span class="op" id="5433382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433386">p</span><span class="op" id="5433387">.</span><span class="ident" id="5433388">expr0</span><span class="op" id="5433393">(</span><span class="ident" id="5433394">x</span><span class="op" id="5433395">,</span>&nbsp;<span class="ident" id="5433397">reduceDepth</span><span class="op" id="5433408">(</span><span class="ident" id="5433409">depth</span><span class="op" id="5433414">)</span><span class="op" id="5433415">)</span>&nbsp;<span class="comment" id="5433417">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433458">p</span><span class="op" id="5433459">.</span><span class="builtinfunc" id="5433460">print</span><span class="op" id="5433465">(</span><span class="ident" id="5433466">token</span><span class="op" id="5433471">.</span><span class="ident" id="5433472">RPAREN</span><span class="op" id="5433478">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433494">printBlank</span>&nbsp;<span class="op" id="5433505">:=</span>&nbsp;<span class="ident" id="5433508">prec</span>&nbsp;<span class="op" id="5433513">&lt;</span>&nbsp;<span class="ident" id="5433515">cutoff</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433524">ws</span>&nbsp;<span class="op" id="5433527">:=</span>&nbsp;<span class="ident" id="5433530">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433538">p</span><span class="op" id="5433539">.</span><span class="ident" id="5433540">expr1</span><span class="op" id="5433545">(</span><span class="ident" id="5433546">x</span><span class="op" id="5433547">.</span><span class="ident" id="5433548">X</span><span class="op" id="5433549">,</span>&nbsp;<span class="ident" id="5433551">prec</span><span class="op" id="5433555">,</span>&nbsp;<span class="ident" id="5433557">depth</span><span class="op" id="5433562">+</span><span class="ident" id="5433563">diffPrec</span><span class="op" id="5433571">(</span><span class="ident" id="5433572">x</span><span class="op" id="5433573">.</span><span class="ident" id="5433574">X</span><span class="op" id="5433575">,</span>&nbsp;<span class="ident" id="5433577">prec</span><span class="op" id="5433581">)</span><span class="op" id="5433582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433585">if</span>&nbsp;<span class="ident" id="5433588">printBlank</span>&nbsp;<span class="op" id="5433599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433603">p</span><span class="op" id="5433604">.</span><span class="builtinfunc" id="5433605">print</span><span class="op" id="5433610">(</span><span class="ident" id="5433611">blank</span><span class="op" id="5433616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433619">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433622">xline</span>&nbsp;<span class="op" id="5433628">:=</span>&nbsp;<span class="ident" id="5433631">p</span><span class="op" id="5433632">.</span><span class="ident" id="5433633">pos</span><span class="op" id="5433636">.</span><span class="ident" id="5433637">Line</span>&nbsp;<span class="comment" id="5433642">//&nbsp;before&nbsp;the&nbsp;operator&nbsp;(it&nbsp;may&nbsp;be&nbsp;on&nbsp;the&nbsp;next&nbsp;line!)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433696">yline</span>&nbsp;<span class="op" id="5433702">:=</span>&nbsp;<span class="ident" id="5433705">p</span><span class="op" id="5433706">.</span><span class="ident" id="5433707">lineFor</span><span class="op" id="5433714">(</span><span class="ident" id="5433715">x</span><span class="op" id="5433716">.</span><span class="ident" id="5433717">Y</span><span class="op" id="5433718">.</span><span class="ident" id="5433719">Pos</span><span class="op" id="5433722">(</span><span class="op" id="5433723">)</span><span class="op" id="5433724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433727">p</span><span class="op" id="5433728">.</span><span class="builtinfunc" id="5433729">print</span><span class="op" id="5433734">(</span><span class="ident" id="5433735">x</span><span class="op" id="5433736">.</span><span class="ident" id="5433737">OpPos</span><span class="op" id="5433742">,</span>&nbsp;<span class="ident" id="5433744">x</span><span class="op" id="5433745">.</span><span class="ident" id="5433746">Op</span><span class="op" id="5433748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433751">if</span>&nbsp;<span class="ident" id="5433754">xline</span>&nbsp;<span class="op" id="5433760">!=</span>&nbsp;<span class="ident" id="5433763">yline</span>&nbsp;<span class="op" id="5433769">&amp;&amp;</span>&nbsp;<span class="ident" id="5433772">xline</span>&nbsp;<span class="op" id="5433778">&gt;</span>&nbsp;<span class="num" id="5433780">0</span>&nbsp;<span class="op" id="5433782">&amp;&amp;</span>&nbsp;<span class="ident" id="5433785">yline</span>&nbsp;<span class="op" id="5433791">&gt;</span>&nbsp;<span class="num" id="5433793">0</span>&nbsp;<span class="op" id="5433795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433799">//&nbsp;at&nbsp;least&nbsp;one&nbsp;line&nbsp;break,&nbsp;but&nbsp;respect&nbsp;an&nbsp;extra&nbsp;empty&nbsp;line</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5433861">//&nbsp;in&nbsp;the&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433880">if</span>&nbsp;<span class="ident" id="5433883">p</span><span class="op" id="5433884">.</span><span class="ident" id="5433885">linebreak</span><span class="op" id="5433894">(</span><span class="ident" id="5433895">yline</span><span class="op" id="5433900">,</span>&nbsp;<span class="num" id="5433902">1</span><span class="op" id="5433903">,</span>&nbsp;<span class="ident" id="5433905">ws</span><span class="op" id="5433907">,</span>&nbsp;<span class="builtintype" id="5433909">true</span><span class="op" id="5433913">)</span>&nbsp;<span class="op" id="5433915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433920">ws</span>&nbsp;<span class="op" id="5433923">=</span>&nbsp;<span class="ident" id="5433925">ignore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5433935">printBlank</span>&nbsp;<span class="op" id="5433946">=</span>&nbsp;<span class="builtintype" id="5433948">false</span>&nbsp;<span class="comment" id="5433954">//&nbsp;no&nbsp;blank&nbsp;after&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433985">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5433988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5433991">if</span>&nbsp;<span class="ident" id="5433994">printBlank</span>&nbsp;<span class="op" id="5434005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434009">p</span><span class="op" id="5434010">.</span><span class="builtinfunc" id="5434011">print</span><span class="op" id="5434016">(</span><span class="ident" id="5434017">blank</span><span class="op" id="5434022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434028">p</span><span class="op" id="5434029">.</span><span class="ident" id="5434030">expr1</span><span class="op" id="5434035">(</span><span class="ident" id="5434036">x</span><span class="op" id="5434037">.</span><span class="ident" id="5434038">Y</span><span class="op" id="5434039">,</span>&nbsp;<span class="ident" id="5434041">prec</span><span class="op" id="5434045">+</span><span class="num" id="5434046">1</span><span class="op" id="5434047">,</span>&nbsp;<span class="ident" id="5434049">depth</span><span class="op" id="5434054">+</span><span class="num" id="5434055">1</span><span class="op" id="5434056">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434059">if</span>&nbsp;<span class="ident" id="5434062">ws</span>&nbsp;<span class="op" id="5434065">==</span>&nbsp;<span class="ident" id="5434068">ignore</span>&nbsp;<span class="op" id="5434075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434079">p</span><span class="op" id="5434080">.</span><span class="builtinfunc" id="5434081">print</span><span class="op" id="5434086">(</span><span class="ident" id="5434087">unindent</span><span class="op" id="5434095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434098">}</span><br>
<span class="lineno"></span><span class="op" id="5434100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">670</span><span class="keyword" id="5434103">func</span>&nbsp;<span class="ident" id="5434108">isBinary</span><span class="op" id="5434116">(</span><span class="ident" id="5434117">expr</span>&nbsp;<span class="ident" id="5434122">ast</span><span class="op" id="5434125">.</span><span class="ident" id="5434126">Expr</span><span class="op" id="5434130">)</span>&nbsp;<span class="builtintype" id="5434132">bool</span>&nbsp;<span class="op" id="5434137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434140">_</span><span class="op" id="5434141">,</span>&nbsp;<span class="ident" id="5434143">ok</span>&nbsp;<span class="op" id="5434146">:=</span>&nbsp;<span class="ident" id="5434149">expr</span><span class="op" id="5434153">.</span><span class="op" id="5434154">(</span><span class="op" id="5434155">*</span><span class="ident" id="5434156">ast</span><span class="op" id="5434159">.</span><span class="ident" id="5434160">BinaryExpr</span><span class="op" id="5434170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434173">return</span>&nbsp;<span class="ident" id="5434180">ok</span><br>
<span class="lineno"></span><span class="op" id="5434183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="5434186">func</span>&nbsp;<span class="op" id="5434191">(</span><span class="ident" id="5434192">p</span>&nbsp;<span class="op" id="5434194">*</span><span class="ident" id="5434195">printer</span><span class="op" id="5434202">)</span>&nbsp;<span class="ident" id="5434204">expr1</span><span class="op" id="5434209">(</span><span class="ident" id="5434210">expr</span>&nbsp;<span class="ident" id="5434215">ast</span><span class="op" id="5434218">.</span><span class="ident" id="5434219">Expr</span><span class="op" id="5434223">,</span>&nbsp;<span class="ident" id="5434225">prec1</span><span class="op" id="5434230">,</span>&nbsp;<span class="ident" id="5434232">depth</span>&nbsp;<span class="builtintype" id="5434238">int</span><span class="op" id="5434241">)</span>&nbsp;<span class="op" id="5434243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434246">p</span><span class="op" id="5434247">.</span><span class="builtinfunc" id="5434248">print</span><span class="op" id="5434253">(</span><span class="ident" id="5434254">expr</span><span class="op" id="5434258">.</span><span class="ident" id="5434259">Pos</span><span class="op" id="5434262">(</span><span class="op" id="5434263">)</span><span class="op" id="5434264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434268">switch</span>&nbsp;<span class="ident" id="5434275">x</span>&nbsp;<span class="op" id="5434277">:=</span>&nbsp;<span class="ident" id="5434280">expr</span><span class="op" id="5434284">.</span><span class="op" id="5434285">(</span><span class="keyword" id="5434286">type</span><span class="op" id="5434290">)</span>&nbsp;<span class="op" id="5434292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434295">case</span>&nbsp;<span class="op" id="5434300">*</span><span class="ident" id="5434301">ast</span><span class="op" id="5434304">.</span><span class="ident" id="5434305">BadExpr</span><span class="op" id="5434312">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434316">p</span><span class="op" id="5434317">.</span><span class="builtinfunc" id="5434318">print</span><span class="op" id="5434323">(</span><span class="string" id="5434324">&#34;BadExpr&#34;</span><span class="op" id="5434333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434337">case</span>&nbsp;<span class="op" id="5434342">*</span><span class="ident" id="5434343">ast</span><span class="op" id="5434346">.</span><span class="ident" id="5434347">Ident</span><span class="op" id="5434352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434356">p</span><span class="op" id="5434357">.</span><span class="builtinfunc" id="5434358">print</span><span class="op" id="5434363">(</span><span class="ident" id="5434364">x</span><span class="op" id="5434365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434369">case</span>&nbsp;<span class="op" id="5434374">*</span><span class="ident" id="5434375">ast</span><span class="op" id="5434378">.</span><span class="ident" id="5434379">BinaryExpr</span><span class="op" id="5434389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434393">if</span>&nbsp;<span class="ident" id="5434396">depth</span>&nbsp;<span class="op" id="5434402">&lt;</span>&nbsp;<span class="num" id="5434404">1</span>&nbsp;<span class="op" id="5434406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434411">p</span><span class="op" id="5434412">.</span><span class="ident" id="5434413">internalError</span><span class="op" id="5434426">(</span><span class="string" id="5434427">&#34;depth&nbsp;&lt;&nbsp;1:&#34;</span><span class="op" id="5434439">,</span>&nbsp;<span class="ident" id="5434441">depth</span><span class="op" id="5434446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434451">depth</span>&nbsp;<span class="op" id="5434457">=</span>&nbsp;<span class="num" id="5434459">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434463">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434467">p</span><span class="op" id="5434468">.</span><span class="ident" id="5434469">binaryExpr</span><span class="op" id="5434479">(</span><span class="ident" id="5434480">x</span><span class="op" id="5434481">,</span>&nbsp;<span class="ident" id="5434483">prec1</span><span class="op" id="5434488">,</span>&nbsp;<span class="ident" id="5434490">cutoff</span><span class="op" id="5434496">(</span><span class="ident" id="5434497">x</span><span class="op" id="5434498">,</span>&nbsp;<span class="ident" id="5434500">depth</span><span class="op" id="5434505">)</span><span class="op" id="5434506">,</span>&nbsp;<span class="ident" id="5434508">depth</span><span class="op" id="5434513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434517">case</span>&nbsp;<span class="op" id="5434522">*</span><span class="ident" id="5434523">ast</span><span class="op" id="5434526">.</span><span class="ident" id="5434527">KeyValueExpr</span><span class="op" id="5434539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434543">p</span><span class="op" id="5434544">.</span><span class="ident" id="5434545">expr</span><span class="op" id="5434549">(</span><span class="ident" id="5434550">x</span><span class="op" id="5434551">.</span><span class="ident" id="5434552">Key</span><span class="op" id="5434555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434559">p</span><span class="op" id="5434560">.</span><span class="builtinfunc" id="5434561">print</span><span class="op" id="5434566">(</span><span class="ident" id="5434567">x</span><span class="op" id="5434568">.</span><span class="ident" id="5434569">Colon</span><span class="op" id="5434574">,</span>&nbsp;<span class="ident" id="5434576">token</span><span class="op" id="5434581">.</span><span class="ident" id="5434582">COLON</span><span class="op" id="5434587">,</span>&nbsp;<span class="ident" id="5434589">blank</span><span class="op" id="5434594">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434598">p</span><span class="op" id="5434599">.</span><span class="ident" id="5434600">expr</span><span class="op" id="5434604">(</span><span class="ident" id="5434605">x</span><span class="op" id="5434606">.</span><span class="ident" id="5434607">Value</span><span class="op" id="5434612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434616">case</span>&nbsp;<span class="op" id="5434621">*</span><span class="ident" id="5434622">ast</span><span class="op" id="5434625">.</span><span class="ident" id="5434626">StarExpr</span><span class="op" id="5434634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434638">const</span>&nbsp;<span class="ident" id="5434644">prec</span>&nbsp;<span class="op" id="5434649">=</span>&nbsp;<span class="ident" id="5434651">token</span><span class="op" id="5434656">.</span><span class="ident" id="5434657">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434669">if</span>&nbsp;<span class="ident" id="5434672">prec</span>&nbsp;<span class="op" id="5434677">&lt;</span>&nbsp;<span class="ident" id="5434679">prec1</span>&nbsp;<span class="op" id="5434685">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5434690">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434715">p</span><span class="op" id="5434716">.</span><span class="builtinfunc" id="5434717">print</span><span class="op" id="5434722">(</span><span class="ident" id="5434723">token</span><span class="op" id="5434728">.</span><span class="ident" id="5434729">LPAREN</span><span class="op" id="5434735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434740">p</span><span class="op" id="5434741">.</span><span class="builtinfunc" id="5434742">print</span><span class="op" id="5434747">(</span><span class="ident" id="5434748">token</span><span class="op" id="5434753">.</span><span class="ident" id="5434754">MUL</span><span class="op" id="5434757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434762">p</span><span class="op" id="5434763">.</span><span class="ident" id="5434764">expr</span><span class="op" id="5434768">(</span><span class="ident" id="5434769">x</span><span class="op" id="5434770">.</span><span class="ident" id="5434771">X</span><span class="op" id="5434772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434777">p</span><span class="op" id="5434778">.</span><span class="builtinfunc" id="5434779">print</span><span class="op" id="5434784">(</span><span class="ident" id="5434785">token</span><span class="op" id="5434790">.</span><span class="ident" id="5434791">RPAREN</span><span class="op" id="5434797">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434801">}</span>&nbsp;<span class="keyword" id="5434803">else</span>&nbsp;<span class="op" id="5434808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5434813">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434841">p</span><span class="op" id="5434842">.</span><span class="builtinfunc" id="5434843">print</span><span class="op" id="5434848">(</span><span class="ident" id="5434849">token</span><span class="op" id="5434854">.</span><span class="ident" id="5434855">MUL</span><span class="op" id="5434858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434863">p</span><span class="op" id="5434864">.</span><span class="ident" id="5434865">expr</span><span class="op" id="5434869">(</span><span class="ident" id="5434870">x</span><span class="op" id="5434871">.</span><span class="ident" id="5434872">X</span><span class="op" id="5434873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5434877">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434881">case</span>&nbsp;<span class="op" id="5434886">*</span><span class="ident" id="5434887">ast</span><span class="op" id="5434890">.</span><span class="ident" id="5434891">UnaryExpr</span><span class="op" id="5434900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434904">const</span>&nbsp;<span class="ident" id="5434910">prec</span>&nbsp;<span class="op" id="5434915">=</span>&nbsp;<span class="ident" id="5434917">token</span><span class="op" id="5434922">.</span><span class="ident" id="5434923">UnaryPrec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5434935">if</span>&nbsp;<span class="ident" id="5434938">prec</span>&nbsp;<span class="op" id="5434943">&lt;</span>&nbsp;<span class="ident" id="5434945">prec1</span>&nbsp;<span class="op" id="5434951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5434956">//&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5434981">p</span><span class="op" id="5434982">.</span><span class="builtinfunc" id="5434983">print</span><span class="op" id="5434988">(</span><span class="ident" id="5434989">token</span><span class="op" id="5434994">.</span><span class="ident" id="5434995">LPAREN</span><span class="op" id="5435001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435006">p</span><span class="op" id="5435007">.</span><span class="ident" id="5435008">expr</span><span class="op" id="5435012">(</span><span class="ident" id="5435013">x</span><span class="op" id="5435014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435019">p</span><span class="op" id="5435020">.</span><span class="builtinfunc" id="5435021">print</span><span class="op" id="5435026">(</span><span class="ident" id="5435027">token</span><span class="op" id="5435032">.</span><span class="ident" id="5435033">RPAREN</span><span class="op" id="5435039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435043">}</span>&nbsp;<span class="keyword" id="5435045">else</span>&nbsp;<span class="op" id="5435050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435055">//&nbsp;no&nbsp;parenthesis&nbsp;needed</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435083">p</span><span class="op" id="5435084">.</span><span class="builtinfunc" id="5435085">print</span><span class="op" id="5435090">(</span><span class="ident" id="5435091">x</span><span class="op" id="5435092">.</span><span class="ident" id="5435093">Op</span><span class="op" id="5435095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435100">if</span>&nbsp;<span class="ident" id="5435103">x</span><span class="op" id="5435104">.</span><span class="ident" id="5435105">Op</span>&nbsp;<span class="op" id="5435108">==</span>&nbsp;<span class="ident" id="5435111">token</span><span class="op" id="5435116">.</span><span class="ident" id="5435117">RANGE</span>&nbsp;<span class="op" id="5435123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435129">//&nbsp;TODO(gri)&nbsp;Remove&nbsp;this&nbsp;code&nbsp;if&nbsp;it&nbsp;cannot&nbsp;be&nbsp;reached.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435188">p</span><span class="op" id="5435189">.</span><span class="builtinfunc" id="5435190">print</span><span class="op" id="5435195">(</span><span class="ident" id="5435196">blank</span><span class="op" id="5435201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435206">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435211">p</span><span class="op" id="5435212">.</span><span class="ident" id="5435213">expr1</span><span class="op" id="5435218">(</span><span class="ident" id="5435219">x</span><span class="op" id="5435220">.</span><span class="ident" id="5435221">X</span><span class="op" id="5435222">,</span>&nbsp;<span class="ident" id="5435224">prec</span><span class="op" id="5435228">,</span>&nbsp;<span class="ident" id="5435230">depth</span><span class="op" id="5435235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435243">case</span>&nbsp;<span class="op" id="5435248">*</span><span class="ident" id="5435249">ast</span><span class="op" id="5435252">.</span><span class="ident" id="5435253">BasicLit</span><span class="op" id="5435261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435265">p</span><span class="op" id="5435266">.</span><span class="builtinfunc" id="5435267">print</span><span class="op" id="5435272">(</span><span class="ident" id="5435273">x</span><span class="op" id="5435274">)</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435278">case</span>&nbsp;<span class="op" id="5435283">*</span><span class="ident" id="5435284">ast</span><span class="op" id="5435287">.</span><span class="ident" id="5435288">FuncLit</span><span class="op" id="5435295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435299">p</span><span class="op" id="5435300">.</span><span class="ident" id="5435301">expr</span><span class="op" id="5435305">(</span><span class="ident" id="5435306">x</span><span class="op" id="5435307">.</span><span class="ident" id="5435308">Type</span><span class="op" id="5435312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435316">p</span><span class="op" id="5435317">.</span><span class="ident" id="5435318">adjBlock</span><span class="op" id="5435326">(</span><span class="ident" id="5435327">p</span><span class="op" id="5435328">.</span><span class="ident" id="5435329">distanceFrom</span><span class="op" id="5435341">(</span><span class="ident" id="5435342">x</span><span class="op" id="5435343">.</span><span class="ident" id="5435344">Type</span><span class="op" id="5435348">.</span><span class="ident" id="5435349">Pos</span><span class="op" id="5435352">(</span><span class="op" id="5435353">)</span><span class="op" id="5435354">)</span><span class="op" id="5435355">,</span>&nbsp;<span class="ident" id="5435357">blank</span><span class="op" id="5435362">,</span>&nbsp;<span class="ident" id="5435364">x</span><span class="op" id="5435365">.</span><span class="ident" id="5435366">Body</span><span class="op" id="5435370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435374">case</span>&nbsp;<span class="op" id="5435379">*</span><span class="ident" id="5435380">ast</span><span class="op" id="5435383">.</span><span class="ident" id="5435384">ParenExpr</span><span class="op" id="5435393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435397">if</span>&nbsp;<span class="ident" id="5435400">_</span><span class="op" id="5435401">,</span>&nbsp;<span class="ident" id="5435403">hasParens</span>&nbsp;<span class="op" id="5435413">:=</span>&nbsp;<span class="ident" id="5435416">x</span><span class="op" id="5435417">.</span><span class="ident" id="5435418">X</span><span class="op" id="5435419">.</span><span class="op" id="5435420">(</span><span class="op" id="5435421">*</span><span class="ident" id="5435422">ast</span><span class="op" id="5435425">.</span><span class="ident" id="5435426">ParenExpr</span><span class="op" id="5435435">)</span><span class="op" id="5435436">;</span>&nbsp;<span class="ident" id="5435438">hasParens</span>&nbsp;<span class="op" id="5435448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435453">//&nbsp;don&#39;t&nbsp;print&nbsp;parentheses&nbsp;around&nbsp;an&nbsp;already&nbsp;parenthesized&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5435526">//&nbsp;TODO(gri)&nbsp;consider&nbsp;making&nbsp;this&nbsp;more&nbsp;general&nbsp;and&nbsp;incorporate&nbsp;precedence&nbsp;levels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435610">p</span><span class="op" id="5435611">.</span><span class="ident" id="5435612">expr0</span><span class="op" id="5435617">(</span><span class="ident" id="5435618">x</span><span class="op" id="5435619">.</span><span class="ident" id="5435620">X</span><span class="op" id="5435621">,</span>&nbsp;<span class="ident" id="5435623">depth</span><span class="op" id="5435628">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435632">}</span>&nbsp;<span class="keyword" id="5435634">else</span>&nbsp;<span class="op" id="5435639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435644">p</span><span class="op" id="5435645">.</span><span class="builtinfunc" id="5435646">print</span><span class="op" id="5435651">(</span><span class="ident" id="5435652">token</span><span class="op" id="5435657">.</span><span class="ident" id="5435658">LPAREN</span><span class="op" id="5435664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435669">p</span><span class="op" id="5435670">.</span><span class="ident" id="5435671">expr0</span><span class="op" id="5435676">(</span><span class="ident" id="5435677">x</span><span class="op" id="5435678">.</span><span class="ident" id="5435679">X</span><span class="op" id="5435680">,</span>&nbsp;<span class="ident" id="5435682">reduceDepth</span><span class="op" id="5435693">(</span><span class="ident" id="5435694">depth</span><span class="op" id="5435699">)</span><span class="op" id="5435700">)</span>&nbsp;<span class="comment" id="5435702">//&nbsp;parentheses&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435744">p</span><span class="op" id="5435745">.</span><span class="builtinfunc" id="5435746">print</span><span class="op" id="5435751">(</span><span class="ident" id="5435752">x</span><span class="op" id="5435753">.</span><span class="ident" id="5435754">Rparen</span><span class="op" id="5435760">,</span>&nbsp;<span class="ident" id="5435762">token</span><span class="op" id="5435767">.</span><span class="ident" id="5435768">RPAREN</span><span class="op" id="5435774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5435778">}</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435782">case</span>&nbsp;<span class="op" id="5435787">*</span><span class="ident" id="5435788">ast</span><span class="op" id="5435791">.</span><span class="ident" id="5435792">SelectorExpr</span><span class="op" id="5435804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435808">p</span><span class="op" id="5435809">.</span><span class="ident" id="5435810">expr1</span><span class="op" id="5435815">(</span><span class="ident" id="5435816">x</span><span class="op" id="5435817">.</span><span class="ident" id="5435818">X</span><span class="op" id="5435819">,</span>&nbsp;<span class="ident" id="5435821">token</span><span class="op" id="5435826">.</span><span class="ident" id="5435827">HighestPrec</span><span class="op" id="5435838">,</span>&nbsp;<span class="ident" id="5435840">depth</span><span class="op" id="5435845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435849">p</span><span class="op" id="5435850">.</span><span class="builtinfunc" id="5435851">print</span><span class="op" id="5435856">(</span><span class="ident" id="5435857">token</span><span class="op" id="5435862">.</span><span class="ident" id="5435863">PERIOD</span><span class="op" id="5435869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5435873">if</span>&nbsp;<span class="ident" id="5435876">line</span>&nbsp;<span class="op" id="5435881">:=</span>&nbsp;<span class="ident" id="5435884">p</span><span class="op" id="5435885">.</span><span class="ident" id="5435886">lineFor</span><span class="op" id="5435893">(</span><span class="ident" id="5435894">x</span><span class="op" id="5435895">.</span><span class="ident" id="5435896">Sel</span><span class="op" id="5435899">.</span><span class="ident" id="5435900">Pos</span><span class="op" id="5435903">(</span><span class="op" id="5435904">)</span><span class="op" id="5435905">)</span><span class="op" id="5435906">;</span>&nbsp;<span class="ident" id="5435908">p</span><span class="op" id="5435909">.</span><span class="ident" id="5435910">pos</span><span class="op" id="5435913">.</span><span class="ident" id="5435914">IsValid</span><span class="op" id="5435921">(</span><span class="op" id="5435922">)</span>&nbsp;<span class="op" id="5435924">&amp;&amp;</span>&nbsp;<span class="ident" id="5435927">p</span><span class="op" id="5435928">.</span><span class="ident" id="5435929">pos</span><span class="op" id="5435932">.</span><span class="ident" id="5435933">Line</span>&nbsp;<span class="op" id="5435938">&lt;</span>&nbsp;<span class="ident" id="5435940">line</span>&nbsp;<span class="op" id="5435945">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5435950">p</span><span class="op" id="5435951">.</span><span class="builtinfunc" id="5435952">print</span><span class="op" id="5435957">(</span><span class="ident" id="5435958">indent</span><span class="op" id="5435964">,</span>&nbsp;<span class="ident" id="5435966">newline</span><span class="op" id="5435973">,</span>&nbsp;<span class="ident" id="5435975">x</span><span class="op" id="5435976">.</span><span class="ident" id="5435977">Sel</span><span class="op" id="5435980">.</span><span class="ident" id="5435981">Pos</span><span class="op" id="5435984">(</span><span class="op" id="5435985">)</span><span class="op" id="5435986">,</span>&nbsp;<span class="ident" id="5435988">x</span><span class="op" id="5435989">.</span><span class="ident" id="5435990">Sel</span><span class="op" id="5435993">,</span>&nbsp;<span class="ident" id="5435995">unindent</span><span class="op" id="5436003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436007">}</span>&nbsp;<span class="keyword" id="5436009">else</span>&nbsp;<span class="op" id="5436014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436019">p</span><span class="op" id="5436020">.</span><span class="builtinfunc" id="5436021">print</span><span class="op" id="5436026">(</span><span class="ident" id="5436027">x</span><span class="op" id="5436028">.</span><span class="ident" id="5436029">Sel</span><span class="op" id="5436032">.</span><span class="ident" id="5436033">Pos</span><span class="op" id="5436036">(</span><span class="op" id="5436037">)</span><span class="op" id="5436038">,</span>&nbsp;<span class="ident" id="5436040">x</span><span class="op" id="5436041">.</span><span class="ident" id="5436042">Sel</span><span class="op" id="5436045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436053">case</span>&nbsp;<span class="op" id="5436058">*</span><span class="ident" id="5436059">ast</span><span class="op" id="5436062">.</span><span class="ident" id="5436063">TypeAssertExpr</span><span class="op" id="5436077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436081">p</span><span class="op" id="5436082">.</span><span class="ident" id="5436083">expr1</span><span class="op" id="5436088">(</span><span class="ident" id="5436089">x</span><span class="op" id="5436090">.</span><span class="ident" id="5436091">X</span><span class="op" id="5436092">,</span>&nbsp;<span class="ident" id="5436094">token</span><span class="op" id="5436099">.</span><span class="ident" id="5436100">HighestPrec</span><span class="op" id="5436111">,</span>&nbsp;<span class="ident" id="5436113">depth</span><span class="op" id="5436118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436122">p</span><span class="op" id="5436123">.</span><span class="builtinfunc" id="5436124">print</span><span class="op" id="5436129">(</span><span class="ident" id="5436130">token</span><span class="op" id="5436135">.</span><span class="ident" id="5436136">PERIOD</span><span class="op" id="5436142">,</span>&nbsp;<span class="ident" id="5436144">x</span><span class="op" id="5436145">.</span><span class="ident" id="5436146">Lparen</span><span class="op" id="5436152">,</span>&nbsp;<span class="ident" id="5436154">token</span><span class="op" id="5436159">.</span><span class="ident" id="5436160">LPAREN</span><span class="op" id="5436166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436170">if</span>&nbsp;<span class="ident" id="5436173">x</span><span class="op" id="5436174">.</span><span class="ident" id="5436175">Type</span>&nbsp;<span class="op" id="5436180">!=</span>&nbsp;<span class="ident" id="5436183">nil</span>&nbsp;<span class="op" id="5436187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436192">p</span><span class="op" id="5436193">.</span><span class="ident" id="5436194">expr</span><span class="op" id="5436198">(</span><span class="ident" id="5436199">x</span><span class="op" id="5436200">.</span><span class="ident" id="5436201">Type</span><span class="op" id="5436205">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436209">}</span>&nbsp;<span class="keyword" id="5436211">else</span>&nbsp;<span class="op" id="5436216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436221">p</span><span class="op" id="5436222">.</span><span class="builtinfunc" id="5436223">print</span><span class="op" id="5436228">(</span><span class="ident" id="5436229">token</span><span class="op" id="5436234">.</span><span class="ident" id="5436235">TYPE</span><span class="op" id="5436239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436247">p</span><span class="op" id="5436248">.</span><span class="builtinfunc" id="5436249">print</span><span class="op" id="5436254">(</span><span class="ident" id="5436255">x</span><span class="op" id="5436256">.</span><span class="ident" id="5436257">Rparen</span><span class="op" id="5436263">,</span>&nbsp;<span class="ident" id="5436265">token</span><span class="op" id="5436270">.</span><span class="ident" id="5436271">RPAREN</span><span class="op" id="5436277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436281">case</span>&nbsp;<span class="op" id="5436286">*</span><span class="ident" id="5436287">ast</span><span class="op" id="5436290">.</span><span class="ident" id="5436291">IndexExpr</span><span class="op" id="5436300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436304">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436380">p</span><span class="op" id="5436381">.</span><span class="ident" id="5436382">expr1</span><span class="op" id="5436387">(</span><span class="ident" id="5436388">x</span><span class="op" id="5436389">.</span><span class="ident" id="5436390">X</span><span class="op" id="5436391">,</span>&nbsp;<span class="ident" id="5436393">token</span><span class="op" id="5436398">.</span><span class="ident" id="5436399">HighestPrec</span><span class="op" id="5436410">,</span>&nbsp;<span class="num" id="5436412">1</span><span class="op" id="5436413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436417">p</span><span class="op" id="5436418">.</span><span class="builtinfunc" id="5436419">print</span><span class="op" id="5436424">(</span><span class="ident" id="5436425">x</span><span class="op" id="5436426">.</span><span class="ident" id="5436427">Lbrack</span><span class="op" id="5436433">,</span>&nbsp;<span class="ident" id="5436435">token</span><span class="op" id="5436440">.</span><span class="ident" id="5436441">LBRACK</span><span class="op" id="5436447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436451">p</span><span class="op" id="5436452">.</span><span class="ident" id="5436453">expr0</span><span class="op" id="5436458">(</span><span class="ident" id="5436459">x</span><span class="op" id="5436460">.</span><span class="ident" id="5436461">Index</span><span class="op" id="5436466">,</span>&nbsp;<span class="ident" id="5436468">depth</span><span class="op" id="5436473">+</span><span class="num" id="5436474">1</span><span class="op" id="5436475">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436479">p</span><span class="op" id="5436480">.</span><span class="builtinfunc" id="5436481">print</span><span class="op" id="5436486">(</span><span class="ident" id="5436487">x</span><span class="op" id="5436488">.</span><span class="ident" id="5436489">Rbrack</span><span class="op" id="5436495">,</span>&nbsp;<span class="ident" id="5436497">token</span><span class="op" id="5436502">.</span><span class="ident" id="5436503">RBRACK</span><span class="op" id="5436509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436513">case</span>&nbsp;<span class="op" id="5436518">*</span><span class="ident" id="5436519">ast</span><span class="op" id="5436522">.</span><span class="ident" id="5436523">SliceExpr</span><span class="op" id="5436532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436536">//&nbsp;TODO(gri):&nbsp;should&nbsp;treat[]&nbsp;like&nbsp;parentheses&nbsp;and&nbsp;undo&nbsp;one&nbsp;level&nbsp;of&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436612">p</span><span class="op" id="5436613">.</span><span class="ident" id="5436614">expr1</span><span class="op" id="5436619">(</span><span class="ident" id="5436620">x</span><span class="op" id="5436621">.</span><span class="ident" id="5436622">X</span><span class="op" id="5436623">,</span>&nbsp;<span class="ident" id="5436625">token</span><span class="op" id="5436630">.</span><span class="ident" id="5436631">HighestPrec</span><span class="op" id="5436642">,</span>&nbsp;<span class="num" id="5436644">1</span><span class="op" id="5436645">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436649">p</span><span class="op" id="5436650">.</span><span class="builtinfunc" id="5436651">print</span><span class="op" id="5436656">(</span><span class="ident" id="5436657">x</span><span class="op" id="5436658">.</span><span class="ident" id="5436659">Lbrack</span><span class="op" id="5436665">,</span>&nbsp;<span class="ident" id="5436667">token</span><span class="op" id="5436672">.</span><span class="ident" id="5436673">LBRACK</span><span class="op" id="5436679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436683">indices</span>&nbsp;<span class="op" id="5436691">:=</span>&nbsp;<span class="op" id="5436694">[</span><span class="op" id="5436695">]</span><span class="ident" id="5436696">ast</span><span class="op" id="5436699">.</span><span class="ident" id="5436700">Expr</span><span class="op" id="5436704">{</span><span class="ident" id="5436705">x</span><span class="op" id="5436706">.</span><span class="ident" id="5436707">Low</span><span class="op" id="5436710">,</span>&nbsp;<span class="ident" id="5436712">x</span><span class="op" id="5436713">.</span><span class="ident" id="5436714">High</span><span class="op" id="5436718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436722">if</span>&nbsp;<span class="ident" id="5436725">x</span><span class="op" id="5436726">.</span><span class="ident" id="5436727">Max</span>&nbsp;<span class="op" id="5436731">!=</span>&nbsp;<span class="ident" id="5436734">nil</span>&nbsp;<span class="op" id="5436738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5436743">indices</span>&nbsp;<span class="op" id="5436751">=</span>&nbsp;<span class="builtinfunc" id="5436753">append</span><span class="op" id="5436759">(</span><span class="ident" id="5436760">indices</span><span class="op" id="5436767">,</span>&nbsp;<span class="ident" id="5436769">x</span><span class="op" id="5436770">.</span><span class="ident" id="5436771">Max</span><span class="op" id="5436774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5436778">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436782">for</span>&nbsp;<span class="ident" id="5436786">i</span><span class="op" id="5436787">,</span>&nbsp;<span class="ident" id="5436789">y</span>&nbsp;<span class="op" id="5436791">:=</span>&nbsp;<span class="keyword" id="5436794">range</span>&nbsp;<span class="ident" id="5436800">indices</span>&nbsp;<span class="op" id="5436808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5436813">if</span>&nbsp;<span class="ident" id="5436816">i</span>&nbsp;<span class="op" id="5436818">&gt;</span>&nbsp;<span class="num" id="5436820">0</span>&nbsp;<span class="op" id="5436822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436828">//&nbsp;blanks&nbsp;around&nbsp;&#34;:&#34;&nbsp;if&nbsp;both&nbsp;sides&nbsp;exist&nbsp;and&nbsp;either&nbsp;side&nbsp;is&nbsp;a&nbsp;binary&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436912">//&nbsp;TODO(gri)&nbsp;once&nbsp;we&nbsp;have&nbsp;committed&nbsp;a&nbsp;variant&nbsp;of&nbsp;a[i:j:k]&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;fine-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5436995">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tune&nbsp;the&nbsp;formatting&nbsp;here</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437037">x</span>&nbsp;<span class="op" id="5437039">:=</span>&nbsp;<span class="ident" id="5437042">indices</span><span class="op" id="5437049">[</span><span class="ident" id="5437050">i</span><span class="op" id="5437051">-</span><span class="num" id="5437052">1</span><span class="op" id="5437053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437059">if</span>&nbsp;<span class="ident" id="5437062">depth</span>&nbsp;<span class="op" id="5437068">&lt;=</span>&nbsp;<span class="num" id="5437071">1</span>&nbsp;<span class="op" id="5437073">&amp;&amp;</span>&nbsp;<span class="ident" id="5437076">x</span>&nbsp;<span class="op" id="5437078">!=</span>&nbsp;<span class="ident" id="5437081">nil</span>&nbsp;<span class="op" id="5437085">&amp;&amp;</span>&nbsp;<span class="ident" id="5437088">y</span>&nbsp;<span class="op" id="5437090">!=</span>&nbsp;<span class="ident" id="5437093">nil</span>&nbsp;<span class="op" id="5437097">&amp;&amp;</span>&nbsp;<span class="op" id="5437100">(</span><span class="ident" id="5437101">isBinary</span><span class="op" id="5437109">(</span><span class="ident" id="5437110">x</span><span class="op" id="5437111">)</span>&nbsp;<span class="op" id="5437113">||</span>&nbsp;<span class="ident" id="5437116">isBinary</span><span class="op" id="5437124">(</span><span class="ident" id="5437125">y</span><span class="op" id="5437126">)</span><span class="op" id="5437127">)</span>&nbsp;<span class="op" id="5437129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437136">p</span><span class="op" id="5437137">.</span><span class="builtinfunc" id="5437138">print</span><span class="op" id="5437143">(</span><span class="ident" id="5437144">blank</span><span class="op" id="5437149">,</span>&nbsp;<span class="ident" id="5437151">token</span><span class="op" id="5437156">.</span><span class="ident" id="5437157">COLON</span><span class="op" id="5437162">,</span>&nbsp;<span class="ident" id="5437164">blank</span><span class="op" id="5437169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437175">}</span>&nbsp;<span class="keyword" id="5437177">else</span>&nbsp;<span class="op" id="5437182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437189">p</span><span class="op" id="5437190">.</span><span class="builtinfunc" id="5437191">print</span><span class="op" id="5437196">(</span><span class="ident" id="5437197">token</span><span class="op" id="5437202">.</span><span class="ident" id="5437203">COLON</span><span class="op" id="5437208">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437224">if</span>&nbsp;<span class="ident" id="5437227">y</span>&nbsp;<span class="op" id="5437229">!=</span>&nbsp;<span class="ident" id="5437232">nil</span>&nbsp;<span class="op" id="5437236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437242">p</span><span class="op" id="5437243">.</span><span class="ident" id="5437244">expr0</span><span class="op" id="5437249">(</span><span class="ident" id="5437250">y</span><span class="op" id="5437251">,</span>&nbsp;<span class="ident" id="5437253">depth</span><span class="op" id="5437258">+</span><span class="num" id="5437259">1</span><span class="op" id="5437260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437265">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437273">p</span><span class="op" id="5437274">.</span><span class="builtinfunc" id="5437275">print</span><span class="op" id="5437280">(</span><span class="ident" id="5437281">x</span><span class="op" id="5437282">.</span><span class="ident" id="5437283">Rbrack</span><span class="op" id="5437289">,</span>&nbsp;<span class="ident" id="5437291">token</span><span class="op" id="5437296">.</span><span class="ident" id="5437297">RBRACK</span><span class="op" id="5437303">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437307">case</span>&nbsp;<span class="op" id="5437312">*</span><span class="ident" id="5437313">ast</span><span class="op" id="5437316">.</span><span class="ident" id="5437317">CallExpr</span><span class="op" id="5437325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437329">if</span>&nbsp;<span class="builtinfunc" id="5437332">len</span><span class="op" id="5437335">(</span><span class="ident" id="5437336">x</span><span class="op" id="5437337">.</span><span class="ident" id="5437338">Args</span><span class="op" id="5437342">)</span>&nbsp;<span class="op" id="5437344">&gt;</span>&nbsp;<span class="num" id="5437346">1</span>&nbsp;<span class="op" id="5437348">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437353">depth</span><span class="op" id="5437358">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437367">if</span>&nbsp;<span class="ident" id="5437370">_</span><span class="op" id="5437371">,</span>&nbsp;<span class="ident" id="5437373">ok</span>&nbsp;<span class="op" id="5437376">:=</span>&nbsp;<span class="ident" id="5437379">x</span><span class="op" id="5437380">.</span><span class="ident" id="5437381">Fun</span><span class="op" id="5437384">.</span><span class="op" id="5437385">(</span><span class="op" id="5437386">*</span><span class="ident" id="5437387">ast</span><span class="op" id="5437390">.</span><span class="ident" id="5437391">FuncType</span><span class="op" id="5437399">)</span><span class="op" id="5437400">;</span>&nbsp;<span class="ident" id="5437402">ok</span>&nbsp;<span class="op" id="5437405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5437410">//&nbsp;conversions&nbsp;to&nbsp;literal&nbsp;function&nbsp;types&nbsp;require&nbsp;parentheses&nbsp;around&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437490">p</span><span class="op" id="5437491">.</span><span class="builtinfunc" id="5437492">print</span><span class="op" id="5437497">(</span><span class="ident" id="5437498">token</span><span class="op" id="5437503">.</span><span class="ident" id="5437504">LPAREN</span><span class="op" id="5437510">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437515">p</span><span class="op" id="5437516">.</span><span class="ident" id="5437517">expr1</span><span class="op" id="5437522">(</span><span class="ident" id="5437523">x</span><span class="op" id="5437524">.</span><span class="ident" id="5437525">Fun</span><span class="op" id="5437528">,</span>&nbsp;<span class="ident" id="5437530">token</span><span class="op" id="5437535">.</span><span class="ident" id="5437536">HighestPrec</span><span class="op" id="5437547">,</span>&nbsp;<span class="ident" id="5437549">depth</span><span class="op" id="5437554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437559">p</span><span class="op" id="5437560">.</span><span class="builtinfunc" id="5437561">print</span><span class="op" id="5437566">(</span><span class="ident" id="5437567">token</span><span class="op" id="5437572">.</span><span class="ident" id="5437573">RPAREN</span><span class="op" id="5437579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437583">}</span>&nbsp;<span class="keyword" id="5437585">else</span>&nbsp;<span class="op" id="5437590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437595">p</span><span class="op" id="5437596">.</span><span class="ident" id="5437597">expr1</span><span class="op" id="5437602">(</span><span class="ident" id="5437603">x</span><span class="op" id="5437604">.</span><span class="ident" id="5437605">Fun</span><span class="op" id="5437608">,</span>&nbsp;<span class="ident" id="5437610">token</span><span class="op" id="5437615">.</span><span class="ident" id="5437616">HighestPrec</span><span class="op" id="5437627">,</span>&nbsp;<span class="ident" id="5437629">depth</span><span class="op" id="5437634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437638">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437642">p</span><span class="op" id="5437643">.</span><span class="builtinfunc" id="5437644">print</span><span class="op" id="5437649">(</span><span class="ident" id="5437650">x</span><span class="op" id="5437651">.</span><span class="ident" id="5437652">Lparen</span><span class="op" id="5437658">,</span>&nbsp;<span class="ident" id="5437660">token</span><span class="op" id="5437665">.</span><span class="ident" id="5437666">LPAREN</span><span class="op" id="5437672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437676">if</span>&nbsp;<span class="ident" id="5437679">x</span><span class="op" id="5437680">.</span><span class="ident" id="5437681">Ellipsis</span><span class="op" id="5437689">.</span><span class="ident" id="5437690">IsValid</span><span class="op" id="5437697">(</span><span class="op" id="5437698">)</span>&nbsp;<span class="op" id="5437700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437705">p</span><span class="op" id="5437706">.</span><span class="ident" id="5437707">exprList</span><span class="op" id="5437715">(</span><span class="ident" id="5437716">x</span><span class="op" id="5437717">.</span><span class="ident" id="5437718">Lparen</span><span class="op" id="5437724">,</span>&nbsp;<span class="ident" id="5437726">x</span><span class="op" id="5437727">.</span><span class="ident" id="5437728">Args</span><span class="op" id="5437732">,</span>&nbsp;<span class="ident" id="5437734">depth</span><span class="op" id="5437739">,</span>&nbsp;<span class="num" id="5437741">0</span><span class="op" id="5437742">,</span>&nbsp;<span class="ident" id="5437744">x</span><span class="op" id="5437745">.</span><span class="ident" id="5437746">Ellipsis</span><span class="op" id="5437754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437759">p</span><span class="op" id="5437760">.</span><span class="builtinfunc" id="5437761">print</span><span class="op" id="5437766">(</span><span class="ident" id="5437767">x</span><span class="op" id="5437768">.</span><span class="ident" id="5437769">Ellipsis</span><span class="op" id="5437777">,</span>&nbsp;<span class="ident" id="5437779">token</span><span class="op" id="5437784">.</span><span class="ident" id="5437785">ELLIPSIS</span><span class="op" id="5437793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5437798">if</span>&nbsp;<span class="ident" id="5437801">x</span><span class="op" id="5437802">.</span><span class="ident" id="5437803">Rparen</span><span class="op" id="5437809">.</span><span class="ident" id="5437810">IsValid</span><span class="op" id="5437817">(</span><span class="op" id="5437818">)</span>&nbsp;<span class="op" id="5437820">&amp;&amp;</span>&nbsp;<span class="ident" id="5437823">p</span><span class="op" id="5437824">.</span><span class="ident" id="5437825">lineFor</span><span class="op" id="5437832">(</span><span class="ident" id="5437833">x</span><span class="op" id="5437834">.</span><span class="ident" id="5437835">Ellipsis</span><span class="op" id="5437843">)</span>&nbsp;<span class="op" id="5437845">&lt;</span>&nbsp;<span class="ident" id="5437847">p</span><span class="op" id="5437848">.</span><span class="ident" id="5437849">lineFor</span><span class="op" id="5437856">(</span><span class="ident" id="5437857">x</span><span class="op" id="5437858">.</span><span class="ident" id="5437859">Rparen</span><span class="op" id="5437865">)</span>&nbsp;<span class="op" id="5437867">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437873">p</span><span class="op" id="5437874">.</span><span class="builtinfunc" id="5437875">print</span><span class="op" id="5437880">(</span><span class="ident" id="5437881">token</span><span class="op" id="5437886">.</span><span class="ident" id="5437887">COMMA</span><span class="op" id="5437892">,</span>&nbsp;<span class="ident" id="5437894">formfeed</span><span class="op" id="5437902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437911">}</span>&nbsp;<span class="keyword" id="5437913">else</span>&nbsp;<span class="op" id="5437918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437923">p</span><span class="op" id="5437924">.</span><span class="ident" id="5437925">exprList</span><span class="op" id="5437933">(</span><span class="ident" id="5437934">x</span><span class="op" id="5437935">.</span><span class="ident" id="5437936">Lparen</span><span class="op" id="5437942">,</span>&nbsp;<span class="ident" id="5437944">x</span><span class="op" id="5437945">.</span><span class="ident" id="5437946">Args</span><span class="op" id="5437950">,</span>&nbsp;<span class="ident" id="5437952">depth</span><span class="op" id="5437957">,</span>&nbsp;<span class="ident" id="5437959">commaTerm</span><span class="op" id="5437968">,</span>&nbsp;<span class="ident" id="5437970">x</span><span class="op" id="5437971">.</span><span class="ident" id="5437972">Rparen</span><span class="op" id="5437978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5437982">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5437986">p</span><span class="op" id="5437987">.</span><span class="builtinfunc" id="5437988">print</span><span class="op" id="5437993">(</span><span class="ident" id="5437994">x</span><span class="op" id="5437995">.</span><span class="ident" id="5437996">Rparen</span><span class="op" id="5438002">,</span>&nbsp;<span class="ident" id="5438004">token</span><span class="op" id="5438009">.</span><span class="ident" id="5438010">RPAREN</span><span class="op" id="5438016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438020">case</span>&nbsp;<span class="op" id="5438025">*</span><span class="ident" id="5438026">ast</span><span class="op" id="5438029">.</span><span class="ident" id="5438030">CompositeLit</span><span class="op" id="5438042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438046">//&nbsp;composite&nbsp;literal&nbsp;elements&nbsp;that&nbsp;are&nbsp;composite&nbsp;literals&nbsp;themselves&nbsp;may&nbsp;have&nbsp;the&nbsp;type&nbsp;omitted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438143">if</span>&nbsp;<span class="ident" id="5438146">x</span><span class="op" id="5438147">.</span><span class="ident" id="5438148">Type</span>&nbsp;<span class="op" id="5438153">!=</span>&nbsp;<span class="ident" id="5438156">nil</span>&nbsp;<span class="op" id="5438160">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438165">p</span><span class="op" id="5438166">.</span><span class="ident" id="5438167">expr1</span><span class="op" id="5438172">(</span><span class="ident" id="5438173">x</span><span class="op" id="5438174">.</span><span class="ident" id="5438175">Type</span><span class="op" id="5438179">,</span>&nbsp;<span class="ident" id="5438181">token</span><span class="op" id="5438186">.</span><span class="ident" id="5438187">HighestPrec</span><span class="op" id="5438198">,</span>&nbsp;<span class="ident" id="5438200">depth</span><span class="op" id="5438205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438213">p</span><span class="op" id="5438214">.</span><span class="builtinfunc" id="5438215">print</span><span class="op" id="5438220">(</span><span class="ident" id="5438221">x</span><span class="op" id="5438222">.</span><span class="ident" id="5438223">Lbrace</span><span class="op" id="5438229">,</span>&nbsp;<span class="ident" id="5438231">token</span><span class="op" id="5438236">.</span><span class="ident" id="5438237">LBRACE</span><span class="op" id="5438243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438247">p</span><span class="op" id="5438248">.</span><span class="ident" id="5438249">exprList</span><span class="op" id="5438257">(</span><span class="ident" id="5438258">x</span><span class="op" id="5438259">.</span><span class="ident" id="5438260">Lbrace</span><span class="op" id="5438266">,</span>&nbsp;<span class="ident" id="5438268">x</span><span class="op" id="5438269">.</span><span class="ident" id="5438270">Elts</span><span class="op" id="5438274">,</span>&nbsp;<span class="num" id="5438276">1</span><span class="op" id="5438277">,</span>&nbsp;<span class="ident" id="5438279">commaTerm</span><span class="op" id="5438288">,</span>&nbsp;<span class="ident" id="5438290">x</span><span class="op" id="5438291">.</span><span class="ident" id="5438292">Rbrace</span><span class="op" id="5438298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438302">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;line&nbsp;break&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438367">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;as&nbsp;it&nbsp;might&nbsp;break&nbsp;the&nbsp;code&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438431">//&nbsp;is&nbsp;no&nbsp;trailing&nbsp;&#39;,&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438455">mode</span>&nbsp;<span class="op" id="5438460">:=</span>&nbsp;<span class="ident" id="5438463">noExtraLinebreak</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438482">//&nbsp;do&nbsp;not&nbsp;insert&nbsp;extra&nbsp;blank&nbsp;following&nbsp;a&nbsp;/*-style&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5438542">//&nbsp;before&nbsp;the&nbsp;closing&nbsp;&#39;}&#39;&nbsp;unless&nbsp;the&nbsp;literal&nbsp;is&nbsp;empty</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438598">if</span>&nbsp;<span class="builtinfunc" id="5438601">len</span><span class="op" id="5438604">(</span><span class="ident" id="5438605">x</span><span class="op" id="5438606">.</span><span class="ident" id="5438607">Elts</span><span class="op" id="5438611">)</span>&nbsp;<span class="op" id="5438613">&gt;</span>&nbsp;<span class="num" id="5438615">0</span>&nbsp;<span class="op" id="5438617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438622">mode</span>&nbsp;<span class="op" id="5438627">|=</span>&nbsp;<span class="ident" id="5438630">noExtraBlank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438649">p</span><span class="op" id="5438650">.</span><span class="builtinfunc" id="5438651">print</span><span class="op" id="5438656">(</span><span class="ident" id="5438657">mode</span><span class="op" id="5438661">,</span>&nbsp;<span class="ident" id="5438663">x</span><span class="op" id="5438664">.</span><span class="ident" id="5438665">Rbrace</span><span class="op" id="5438671">,</span>&nbsp;<span class="ident" id="5438673">token</span><span class="op" id="5438678">.</span><span class="ident" id="5438679">RBRACE</span><span class="op" id="5438685">,</span>&nbsp;<span class="ident" id="5438687">mode</span><span class="op" id="5438691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438695">case</span>&nbsp;<span class="op" id="5438700">*</span><span class="ident" id="5438701">ast</span><span class="op" id="5438704">.</span><span class="ident" id="5438705">Ellipsis</span><span class="op" id="5438713">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438717">p</span><span class="op" id="5438718">.</span><span class="builtinfunc" id="5438719">print</span><span class="op" id="5438724">(</span><span class="ident" id="5438725">token</span><span class="op" id="5438730">.</span><span class="ident" id="5438731">ELLIPSIS</span><span class="op" id="5438739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438743">if</span>&nbsp;<span class="ident" id="5438746">x</span><span class="op" id="5438747">.</span><span class="ident" id="5438748">Elt</span>&nbsp;<span class="op" id="5438752">!=</span>&nbsp;<span class="ident" id="5438755">nil</span>&nbsp;<span class="op" id="5438759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438764">p</span><span class="op" id="5438765">.</span><span class="ident" id="5438766">expr</span><span class="op" id="5438770">(</span><span class="ident" id="5438771">x</span><span class="op" id="5438772">.</span><span class="ident" id="5438773">Elt</span><span class="op" id="5438776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438780">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438784">case</span>&nbsp;<span class="op" id="5438789">*</span><span class="ident" id="5438790">ast</span><span class="op" id="5438793">.</span><span class="ident" id="5438794">ArrayType</span><span class="op" id="5438803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438807">p</span><span class="op" id="5438808">.</span><span class="builtinfunc" id="5438809">print</span><span class="op" id="5438814">(</span><span class="ident" id="5438815">token</span><span class="op" id="5438820">.</span><span class="ident" id="5438821">LBRACK</span><span class="op" id="5438827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438831">if</span>&nbsp;<span class="ident" id="5438834">x</span><span class="op" id="5438835">.</span><span class="ident" id="5438836">Len</span>&nbsp;<span class="op" id="5438840">!=</span>&nbsp;<span class="ident" id="5438843">nil</span>&nbsp;<span class="op" id="5438847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438852">p</span><span class="op" id="5438853">.</span><span class="ident" id="5438854">expr</span><span class="op" id="5438858">(</span><span class="ident" id="5438859">x</span><span class="op" id="5438860">.</span><span class="ident" id="5438861">Len</span><span class="op" id="5438864">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5438868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438872">p</span><span class="op" id="5438873">.</span><span class="builtinfunc" id="5438874">print</span><span class="op" id="5438879">(</span><span class="ident" id="5438880">token</span><span class="op" id="5438885">.</span><span class="ident" id="5438886">RBRACK</span><span class="op" id="5438892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438896">p</span><span class="op" id="5438897">.</span><span class="ident" id="5438898">expr</span><span class="op" id="5438902">(</span><span class="ident" id="5438903">x</span><span class="op" id="5438904">.</span><span class="ident" id="5438905">Elt</span><span class="op" id="5438908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5438912">case</span>&nbsp;<span class="op" id="5438917">*</span><span class="ident" id="5438918">ast</span><span class="op" id="5438921">.</span><span class="ident" id="5438922">StructType</span><span class="op" id="5438932">:</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438936">p</span><span class="op" id="5438937">.</span><span class="builtinfunc" id="5438938">print</span><span class="op" id="5438943">(</span><span class="ident" id="5438944">token</span><span class="op" id="5438949">.</span><span class="ident" id="5438950">STRUCT</span><span class="op" id="5438956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5438960">p</span><span class="op" id="5438961">.</span><span class="ident" id="5438962">fieldList</span><span class="op" id="5438971">(</span><span class="ident" id="5438972">x</span><span class="op" id="5438973">.</span><span class="ident" id="5438974">Fields</span><span class="op" id="5438980">,</span>&nbsp;<span class="builtintype" id="5438982">true</span><span class="op" id="5438986">,</span>&nbsp;<span class="ident" id="5438988">x</span><span class="op" id="5438989">.</span><span class="ident" id="5438990">Incomplete</span><span class="op" id="5439000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439004">case</span>&nbsp;<span class="op" id="5439009">*</span><span class="ident" id="5439010">ast</span><span class="op" id="5439013">.</span><span class="ident" id="5439014">FuncType</span><span class="op" id="5439022">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439026">p</span><span class="op" id="5439027">.</span><span class="builtinfunc" id="5439028">print</span><span class="op" id="5439033">(</span><span class="ident" id="5439034">token</span><span class="op" id="5439039">.</span><span class="ident" id="5439040">FUNC</span><span class="op" id="5439044">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439048">p</span><span class="op" id="5439049">.</span><span class="ident" id="5439050">signature</span><span class="op" id="5439059">(</span><span class="ident" id="5439060">x</span><span class="op" id="5439061">.</span><span class="ident" id="5439062">Params</span><span class="op" id="5439068">,</span>&nbsp;<span class="ident" id="5439070">x</span><span class="op" id="5439071">.</span><span class="ident" id="5439072">Results</span><span class="op" id="5439079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439083">case</span>&nbsp;<span class="op" id="5439088">*</span><span class="ident" id="5439089">ast</span><span class="op" id="5439092">.</span><span class="ident" id="5439093">InterfaceType</span><span class="op" id="5439106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439110">p</span><span class="op" id="5439111">.</span><span class="builtinfunc" id="5439112">print</span><span class="op" id="5439117">(</span><span class="ident" id="5439118">token</span><span class="op" id="5439123">.</span><span class="ident" id="5439124">INTERFACE</span><span class="op" id="5439133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439137">p</span><span class="op" id="5439138">.</span><span class="ident" id="5439139">fieldList</span><span class="op" id="5439148">(</span><span class="ident" id="5439149">x</span><span class="op" id="5439150">.</span><span class="ident" id="5439151">Methods</span><span class="op" id="5439158">,</span>&nbsp;<span class="builtintype" id="5439160">false</span><span class="op" id="5439165">,</span>&nbsp;<span class="ident" id="5439167">x</span><span class="op" id="5439168">.</span><span class="ident" id="5439169">Incomplete</span><span class="op" id="5439179">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439183">case</span>&nbsp;<span class="op" id="5439188">*</span><span class="ident" id="5439189">ast</span><span class="op" id="5439192">.</span><span class="ident" id="5439193">MapType</span><span class="op" id="5439200">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439204">p</span><span class="op" id="5439205">.</span><span class="builtinfunc" id="5439206">print</span><span class="op" id="5439211">(</span><span class="ident" id="5439212">token</span><span class="op" id="5439217">.</span><span class="ident" id="5439218">MAP</span><span class="op" id="5439221">,</span>&nbsp;<span class="ident" id="5439223">token</span><span class="op" id="5439228">.</span><span class="ident" id="5439229">LBRACK</span><span class="op" id="5439235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439239">p</span><span class="op" id="5439240">.</span><span class="ident" id="5439241">expr</span><span class="op" id="5439245">(</span><span class="ident" id="5439246">x</span><span class="op" id="5439247">.</span><span class="ident" id="5439248">Key</span><span class="op" id="5439251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439255">p</span><span class="op" id="5439256">.</span><span class="builtinfunc" id="5439257">print</span><span class="op" id="5439262">(</span><span class="ident" id="5439263">token</span><span class="op" id="5439268">.</span><span class="ident" id="5439269">RBRACK</span><span class="op" id="5439275">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439279">p</span><span class="op" id="5439280">.</span><span class="ident" id="5439281">expr</span><span class="op" id="5439285">(</span><span class="ident" id="5439286">x</span><span class="op" id="5439287">.</span><span class="ident" id="5439288">Value</span><span class="op" id="5439293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439297">case</span>&nbsp;<span class="op" id="5439302">*</span><span class="ident" id="5439303">ast</span><span class="op" id="5439306">.</span><span class="ident" id="5439307">ChanType</span><span class="op" id="5439315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439319">switch</span>&nbsp;<span class="ident" id="5439326">x</span><span class="op" id="5439327">.</span><span class="ident" id="5439328">Dir</span>&nbsp;<span class="op" id="5439332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439336">case</span>&nbsp;<span class="ident" id="5439341">ast</span><span class="op" id="5439344">.</span><span class="ident" id="5439345">SEND</span>&nbsp;<span class="op" id="5439350">|</span>&nbsp;<span class="ident" id="5439352">ast</span><span class="op" id="5439355">.</span><span class="ident" id="5439356">RECV</span><span class="op" id="5439360">:</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439365">p</span><span class="op" id="5439366">.</span><span class="builtinfunc" id="5439367">print</span><span class="op" id="5439372">(</span><span class="ident" id="5439373">token</span><span class="op" id="5439378">.</span><span class="ident" id="5439379">CHAN</span><span class="op" id="5439383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439387">case</span>&nbsp;<span class="ident" id="5439392">ast</span><span class="op" id="5439395">.</span><span class="ident" id="5439396">RECV</span><span class="op" id="5439400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439405">p</span><span class="op" id="5439406">.</span><span class="builtinfunc" id="5439407">print</span><span class="op" id="5439412">(</span><span class="ident" id="5439413">token</span><span class="op" id="5439418">.</span><span class="ident" id="5439419">ARROW</span><span class="op" id="5439424">,</span>&nbsp;<span class="ident" id="5439426">token</span><span class="op" id="5439431">.</span><span class="ident" id="5439432">CHAN</span><span class="op" id="5439436">)</span>&nbsp;<span class="comment" id="5439438">//&nbsp;x.Arrow&nbsp;and&nbsp;x.Pos()&nbsp;are&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439476">case</span>&nbsp;<span class="ident" id="5439481">ast</span><span class="op" id="5439484">.</span><span class="ident" id="5439485">SEND</span><span class="op" id="5439489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439494">p</span><span class="op" id="5439495">.</span><span class="builtinfunc" id="5439496">print</span><span class="op" id="5439501">(</span><span class="ident" id="5439502">token</span><span class="op" id="5439507">.</span><span class="ident" id="5439508">CHAN</span><span class="op" id="5439512">,</span>&nbsp;<span class="ident" id="5439514">x</span><span class="op" id="5439515">.</span><span class="ident" id="5439516">Arrow</span><span class="op" id="5439521">,</span>&nbsp;<span class="ident" id="5439523">token</span><span class="op" id="5439528">.</span><span class="ident" id="5439529">ARROW</span><span class="op" id="5439534">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5439538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439542">p</span><span class="op" id="5439543">.</span><span class="builtinfunc" id="5439544">print</span><span class="op" id="5439549">(</span><span class="ident" id="5439550">blank</span><span class="op" id="5439555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439559">p</span><span class="op" id="5439560">.</span><span class="ident" id="5439561">expr</span><span class="op" id="5439565">(</span><span class="ident" id="5439566">x</span><span class="op" id="5439567">.</span><span class="ident" id="5439568">Value</span><span class="op" id="5439573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439577">default</span><span class="op" id="5439584">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5439588">panic</span><span class="op" id="5439593">(</span><span class="string" id="5439594">&#34;unreachable&#34;</span><span class="op" id="5439607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5439610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439614">return</span><br>
<span class="lineno"></span><span class="op" id="5439621">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="keyword" id="5439624">func</span>&nbsp;<span class="op" id="5439629">(</span><span class="ident" id="5439630">p</span>&nbsp;<span class="op" id="5439632">*</span><span class="ident" id="5439633">printer</span><span class="op" id="5439640">)</span>&nbsp;<span class="ident" id="5439642">expr0</span><span class="op" id="5439647">(</span><span class="ident" id="5439648">x</span>&nbsp;<span class="ident" id="5439650">ast</span><span class="op" id="5439653">.</span><span class="ident" id="5439654">Expr</span><span class="op" id="5439658">,</span>&nbsp;<span class="ident" id="5439660">depth</span>&nbsp;<span class="builtintype" id="5439666">int</span><span class="op" id="5439669">)</span>&nbsp;<span class="op" id="5439671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439674">p</span><span class="op" id="5439675">.</span><span class="ident" id="5439676">expr1</span><span class="op" id="5439681">(</span><span class="ident" id="5439682">x</span><span class="op" id="5439683">,</span>&nbsp;<span class="ident" id="5439685">token</span><span class="op" id="5439690">.</span><span class="ident" id="5439691">LowestPrec</span><span class="op" id="5439701">,</span>&nbsp;<span class="ident" id="5439703">depth</span><span class="op" id="5439708">)</span><br>
<span class="lineno"></span><span class="op" id="5439710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">895</span><span class="keyword" id="5439713">func</span>&nbsp;<span class="op" id="5439718">(</span><span class="ident" id="5439719">p</span>&nbsp;<span class="op" id="5439721">*</span><span class="ident" id="5439722">printer</span><span class="op" id="5439729">)</span>&nbsp;<span class="ident" id="5439731">expr</span><span class="op" id="5439735">(</span><span class="ident" id="5439736">x</span>&nbsp;<span class="ident" id="5439738">ast</span><span class="op" id="5439741">.</span><span class="ident" id="5439742">Expr</span><span class="op" id="5439746">)</span>&nbsp;<span class="op" id="5439748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5439751">const</span>&nbsp;<span class="ident" id="5439757">depth</span>&nbsp;<span class="op" id="5439763">=</span>&nbsp;<span class="num" id="5439765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5439768">p</span><span class="op" id="5439769">.</span><span class="ident" id="5439770">expr1</span><span class="op" id="5439775">(</span><span class="ident" id="5439776">x</span><span class="op" id="5439777">,</span>&nbsp;<span class="ident" id="5439779">token</span><span class="op" id="5439784">.</span><span class="ident" id="5439785">LowestPrec</span><span class="op" id="5439795">,</span>&nbsp;<span class="ident" id="5439797">depth</span><span class="op" id="5439802">)</span><br>
<span class="lineno"></span><span class="op" id="5439804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span><span class="comment" id="5439807">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5439887">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5439902">//&nbsp;Print&nbsp;the&nbsp;statement&nbsp;list&nbsp;indented,&nbsp;but&nbsp;without&nbsp;a&nbsp;newline&nbsp;after&nbsp;the&nbsp;last&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5439988">//&nbsp;Extra&nbsp;line&nbsp;breaks&nbsp;between&nbsp;statements&nbsp;in&nbsp;the&nbsp;source&nbsp;are&nbsp;respected&nbsp;but&nbsp;at&nbsp;most&nbsp;one</span><br>
<span class="lineno">905</span><span class="comment" id="5440072">//&nbsp;empty&nbsp;line&nbsp;is&nbsp;printed&nbsp;between&nbsp;statements.</span><br>
<span class="lineno"></span><span class="keyword" id="5440117">func</span>&nbsp;<span class="op" id="5440122">(</span><span class="ident" id="5440123">p</span>&nbsp;<span class="op" id="5440125">*</span><span class="ident" id="5440126">printer</span><span class="op" id="5440133">)</span>&nbsp;<span class="ident" id="5440135">stmtList</span><span class="op" id="5440143">(</span><span class="ident" id="5440144">list</span>&nbsp;<span class="op" id="5440149">[</span><span class="op" id="5440150">]</span><span class="ident" id="5440151">ast</span><span class="op" id="5440154">.</span><span class="ident" id="5440155">Stmt</span><span class="op" id="5440159">,</span>&nbsp;<span class="ident" id="5440161">nindent</span>&nbsp;<span class="builtintype" id="5440169">int</span><span class="op" id="5440172">,</span>&nbsp;<span class="ident" id="5440174">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5440187">bool</span><span class="op" id="5440191">)</span>&nbsp;<span class="op" id="5440193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440196">if</span>&nbsp;<span class="ident" id="5440199">nindent</span>&nbsp;<span class="op" id="5440207">&gt;</span>&nbsp;<span class="num" id="5440209">0</span>&nbsp;<span class="op" id="5440211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440215">p</span><span class="op" id="5440216">.</span><span class="builtinfunc" id="5440217">print</span><span class="op" id="5440222">(</span><span class="ident" id="5440223">indent</span><span class="op" id="5440229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440232">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440235">var</span>&nbsp;<span class="ident" id="5440239">line</span>&nbsp;<span class="builtintype" id="5440244">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440249">i</span>&nbsp;<span class="op" id="5440251">:=</span>&nbsp;<span class="num" id="5440254">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440257">for</span>&nbsp;<span class="ident" id="5440261">_</span><span class="op" id="5440262">,</span>&nbsp;<span class="ident" id="5440264">s</span>&nbsp;<span class="op" id="5440266">:=</span>&nbsp;<span class="keyword" id="5440269">range</span>&nbsp;<span class="ident" id="5440275">list</span>&nbsp;<span class="op" id="5440280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440284">//&nbsp;ignore&nbsp;empty&nbsp;statements&nbsp;(was&nbsp;issue&nbsp;3466)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440330">if</span>&nbsp;<span class="ident" id="5440333">_</span><span class="op" id="5440334">,</span>&nbsp;<span class="ident" id="5440336">isEmpty</span>&nbsp;<span class="op" id="5440344">:=</span>&nbsp;<span class="ident" id="5440347">s</span><span class="op" id="5440348">.</span><span class="op" id="5440349">(</span><span class="op" id="5440350">*</span><span class="ident" id="5440351">ast</span><span class="op" id="5440354">.</span><span class="ident" id="5440355">EmptyStmt</span><span class="op" id="5440364">)</span><span class="op" id="5440365">;</span>&nbsp;<span class="op" id="5440367">!</span><span class="ident" id="5440368">isEmpty</span>&nbsp;<span class="op" id="5440376">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440381">//&nbsp;nindent&nbsp;==&nbsp;0&nbsp;only&nbsp;for&nbsp;lists&nbsp;of&nbsp;switch/select&nbsp;case&nbsp;clauses;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440446">//&nbsp;in&nbsp;those&nbsp;cases&nbsp;each&nbsp;clause&nbsp;is&nbsp;a&nbsp;new&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5440496">if</span>&nbsp;<span class="builtinfunc" id="5440499">len</span><span class="op" id="5440502">(</span><span class="ident" id="5440503">p</span><span class="op" id="5440504">.</span><span class="ident" id="5440505">output</span><span class="op" id="5440511">)</span>&nbsp;<span class="op" id="5440513">&gt;</span>&nbsp;<span class="num" id="5440515">0</span>&nbsp;<span class="op" id="5440517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440523">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440597">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440655">p</span><span class="op" id="5440656">.</span><span class="ident" id="5440657">linebreak</span><span class="op" id="5440666">(</span><span class="ident" id="5440667">p</span><span class="op" id="5440668">.</span><span class="ident" id="5440669">lineFor</span><span class="op" id="5440676">(</span><span class="ident" id="5440677">s</span><span class="op" id="5440678">.</span><span class="ident" id="5440679">Pos</span><span class="op" id="5440682">(</span><span class="op" id="5440683">)</span><span class="op" id="5440684">)</span><span class="op" id="5440685">,</span>&nbsp;<span class="num" id="5440687">1</span><span class="op" id="5440688">,</span>&nbsp;<span class="ident" id="5440690">ignore</span><span class="op" id="5440696">,</span>&nbsp;<span class="ident" id="5440698">i</span>&nbsp;<span class="op" id="5440700">==</span>&nbsp;<span class="num" id="5440703">0</span>&nbsp;<span class="op" id="5440705">||</span>&nbsp;<span class="ident" id="5440708">nindent</span>&nbsp;<span class="op" id="5440716">==</span>&nbsp;<span class="num" id="5440719">0</span>&nbsp;<span class="op" id="5440721">||</span>&nbsp;<span class="ident" id="5440724">p</span><span class="op" id="5440725">.</span><span class="ident" id="5440726">linesFrom</span><span class="op" id="5440735">(</span><span class="ident" id="5440736">line</span><span class="op" id="5440740">)</span>&nbsp;<span class="op" id="5440742">&gt;</span>&nbsp;<span class="num" id="5440744">0</span><span class="op" id="5440745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5440750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440755">p</span><span class="op" id="5440756">.</span><span class="ident" id="5440757">recordLine</span><span class="op" id="5440767">(</span><span class="op" id="5440768">&amp;</span><span class="ident" id="5440769">line</span><span class="op" id="5440773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5440778">p</span><span class="op" id="5440779">.</span><span class="ident" id="5440780">stmt</span><span class="op" id="5440784">(</span><span class="ident" id="5440785">s</span><span class="op" id="5440786">,</span>&nbsp;<span class="ident" id="5440788">nextIsRBrace</span>&nbsp;<span class="op" id="5440801">&amp;&amp;</span>&nbsp;<span class="ident" id="5440804">i</span>&nbsp;<span class="op" id="5440806">==</span>&nbsp;<span class="builtinfunc" id="5440809">len</span><span class="op" id="5440812">(</span><span class="ident" id="5440813">list</span><span class="op" id="5440817">)</span><span class="op" id="5440818">-</span><span class="num" id="5440819">1</span><span class="op" id="5440820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440825">//&nbsp;labeled&nbsp;statements&nbsp;put&nbsp;labels&nbsp;on&nbsp;a&nbsp;separate&nbsp;line,&nbsp;but&nbsp;here</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440890">//&nbsp;we&nbsp;only&nbsp;care&nbsp;about&nbsp;the&nbsp;start&nbsp;line&nbsp;of&nbsp;the&nbsp;actual&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5440954">//&nbsp;without&nbsp;label&nbsp;-&nbsp;correct&nbsp;line&nbsp;for&nbsp;each&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441004">for</span>&nbsp;<span class="ident" id="5441008">t</span>&nbsp;<span class="op" id="5441010">:=</span>&nbsp;<span class="ident" id="5441013">s</span><span class="op" id="5441014">;</span>&nbsp;<span class="op" id="5441016">;</span>&nbsp;<span class="op" id="5441018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441024">lt</span><span class="op" id="5441026">,</span>&nbsp;<span class="ident" id="5441028">_</span>&nbsp;<span class="op" id="5441030">:=</span>&nbsp;<span class="ident" id="5441033">t</span><span class="op" id="5441034">.</span><span class="op" id="5441035">(</span><span class="op" id="5441036">*</span><span class="ident" id="5441037">ast</span><span class="op" id="5441040">.</span><span class="ident" id="5441041">LabeledStmt</span><span class="op" id="5441052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441058">if</span>&nbsp;<span class="ident" id="5441061">lt</span>&nbsp;<span class="op" id="5441064">==</span>&nbsp;<span class="ident" id="5441067">nil</span>&nbsp;<span class="op" id="5441071">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441078">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441094">line</span><span class="op" id="5441098">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441105">t</span>&nbsp;<span class="op" id="5441107">=</span>&nbsp;<span class="ident" id="5441109">lt</span><span class="op" id="5441111">.</span><span class="ident" id="5441112">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441120">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441125">i</span><span class="op" id="5441126">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441137">if</span>&nbsp;<span class="ident" id="5441140">nindent</span>&nbsp;<span class="op" id="5441148">&gt;</span>&nbsp;<span class="num" id="5441150">0</span>&nbsp;<span class="op" id="5441152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441156">p</span><span class="op" id="5441157">.</span><span class="builtinfunc" id="5441158">print</span><span class="op" id="5441163">(</span><span class="ident" id="5441164">unindent</span><span class="op" id="5441172">)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441175">}</span><br>
<span class="lineno"></span><span class="op" id="5441177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5441180">//&nbsp;block&nbsp;prints&nbsp;an&nbsp;*ast.BlockStmt;&nbsp;it&nbsp;always&nbsp;spans&nbsp;at&nbsp;least&nbsp;two&nbsp;lines.</span><br>
<span class="lineno"></span><span class="keyword" id="5441251">func</span>&nbsp;<span class="op" id="5441256">(</span><span class="ident" id="5441257">p</span>&nbsp;<span class="op" id="5441259">*</span><span class="ident" id="5441260">printer</span><span class="op" id="5441267">)</span>&nbsp;<span class="ident" id="5441269">block</span><span class="op" id="5441274">(</span><span class="ident" id="5441275">b</span>&nbsp;<span class="op" id="5441277">*</span><span class="ident" id="5441278">ast</span><span class="op" id="5441281">.</span><span class="ident" id="5441282">BlockStmt</span><span class="op" id="5441291">,</span>&nbsp;<span class="ident" id="5441293">nindent</span>&nbsp;<span class="builtintype" id="5441301">int</span><span class="op" id="5441304">)</span>&nbsp;<span class="op" id="5441306">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441309">p</span><span class="op" id="5441310">.</span><span class="builtinfunc" id="5441311">print</span><span class="op" id="5441316">(</span><span class="ident" id="5441317">b</span><span class="op" id="5441318">.</span><span class="ident" id="5441319">Lbrace</span><span class="op" id="5441325">,</span>&nbsp;<span class="ident" id="5441327">token</span><span class="op" id="5441332">.</span><span class="ident" id="5441333">LBRACE</span><span class="op" id="5441339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441342">p</span><span class="op" id="5441343">.</span><span class="ident" id="5441344">stmtList</span><span class="op" id="5441352">(</span><span class="ident" id="5441353">b</span><span class="op" id="5441354">.</span><span class="ident" id="5441355">List</span><span class="op" id="5441359">,</span>&nbsp;<span class="ident" id="5441361">nindent</span><span class="op" id="5441368">,</span>&nbsp;<span class="builtintype" id="5441370">true</span><span class="op" id="5441374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441377">p</span><span class="op" id="5441378">.</span><span class="ident" id="5441379">linebreak</span><span class="op" id="5441388">(</span><span class="ident" id="5441389">p</span><span class="op" id="5441390">.</span><span class="ident" id="5441391">lineFor</span><span class="op" id="5441398">(</span><span class="ident" id="5441399">b</span><span class="op" id="5441400">.</span><span class="ident" id="5441401">Rbrace</span><span class="op" id="5441407">)</span><span class="op" id="5441408">,</span>&nbsp;<span class="num" id="5441410">1</span><span class="op" id="5441411">,</span>&nbsp;<span class="ident" id="5441413">ignore</span><span class="op" id="5441419">,</span>&nbsp;<span class="builtintype" id="5441421">true</span><span class="op" id="5441425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441428">p</span><span class="op" id="5441429">.</span><span class="builtinfunc" id="5441430">print</span><span class="op" id="5441435">(</span><span class="ident" id="5441436">b</span><span class="op" id="5441437">.</span><span class="ident" id="5441438">Rbrace</span><span class="op" id="5441444">,</span>&nbsp;<span class="ident" id="5441446">token</span><span class="op" id="5441451">.</span><span class="ident" id="5441452">RBRACE</span><span class="op" id="5441458">)</span><br>
<span class="lineno"></span><span class="op" id="5441460">}</span><br>
<span class="lineno">950</span><br>
<span class="lineno"></span><span class="keyword" id="5441463">func</span>&nbsp;<span class="ident" id="5441468">isTypeName</span><span class="op" id="5441478">(</span><span class="ident" id="5441479">x</span>&nbsp;<span class="ident" id="5441481">ast</span><span class="op" id="5441484">.</span><span class="ident" id="5441485">Expr</span><span class="op" id="5441489">)</span>&nbsp;<span class="builtintype" id="5441491">bool</span>&nbsp;<span class="op" id="5441496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441499">switch</span>&nbsp;<span class="ident" id="5441506">t</span>&nbsp;<span class="op" id="5441508">:=</span>&nbsp;<span class="ident" id="5441511">x</span><span class="op" id="5441512">.</span><span class="op" id="5441513">(</span><span class="keyword" id="5441514">type</span><span class="op" id="5441518">)</span>&nbsp;<span class="op" id="5441520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441523">case</span>&nbsp;<span class="op" id="5441528">*</span><span class="ident" id="5441529">ast</span><span class="op" id="5441532">.</span><span class="ident" id="5441533">Ident</span><span class="op" id="5441538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441542">return</span>&nbsp;<span class="builtintype" id="5441549">true</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441555">case</span>&nbsp;<span class="op" id="5441560">*</span><span class="ident" id="5441561">ast</span><span class="op" id="5441564">.</span><span class="ident" id="5441565">SelectorExpr</span><span class="op" id="5441577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441581">return</span>&nbsp;<span class="ident" id="5441588">isTypeName</span><span class="op" id="5441598">(</span><span class="ident" id="5441599">t</span><span class="op" id="5441600">.</span><span class="ident" id="5441601">X</span><span class="op" id="5441602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5441605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441608">return</span>&nbsp;<span class="builtintype" id="5441615">false</span><br>
<span class="lineno"></span><span class="op" id="5441621">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span><span class="keyword" id="5441624">func</span>&nbsp;<span class="ident" id="5441629">stripParens</span><span class="op" id="5441640">(</span><span class="ident" id="5441641">x</span>&nbsp;<span class="ident" id="5441643">ast</span><span class="op" id="5441646">.</span><span class="ident" id="5441647">Expr</span><span class="op" id="5441651">)</span>&nbsp;<span class="ident" id="5441653">ast</span><span class="op" id="5441656">.</span><span class="ident" id="5441657">Expr</span>&nbsp;<span class="op" id="5441662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441665">if</span>&nbsp;<span class="ident" id="5441668">px</span><span class="op" id="5441670">,</span>&nbsp;<span class="ident" id="5441672">strip</span>&nbsp;<span class="op" id="5441678">:=</span>&nbsp;<span class="ident" id="5441681">x</span><span class="op" id="5441682">.</span><span class="op" id="5441683">(</span><span class="op" id="5441684">*</span><span class="ident" id="5441685">ast</span><span class="op" id="5441688">.</span><span class="ident" id="5441689">ParenExpr</span><span class="op" id="5441698">)</span><span class="op" id="5441699">;</span>&nbsp;<span class="ident" id="5441701">strip</span>&nbsp;<span class="op" id="5441707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5441711">//&nbsp;parentheses&nbsp;must&nbsp;not&nbsp;be&nbsp;stripped&nbsp;if&nbsp;there&nbsp;are&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5441766">//&nbsp;unparenthesized&nbsp;composite&nbsp;literals&nbsp;starting&nbsp;with</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5441820">//&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5441837">ast</span><span class="op" id="5441840">.</span><span class="ident" id="5441841">Inspect</span><span class="op" id="5441848">(</span><span class="ident" id="5441849">px</span><span class="op" id="5441851">.</span><span class="ident" id="5441852">X</span><span class="op" id="5441853">,</span>&nbsp;<span class="keyword" id="5441855">func</span><span class="op" id="5441859">(</span><span class="ident" id="5441860">node</span>&nbsp;<span class="ident" id="5441865">ast</span><span class="op" id="5441868">.</span><span class="ident" id="5441869">Node</span><span class="op" id="5441873">)</span>&nbsp;<span class="builtintype" id="5441875">bool</span>&nbsp;<span class="op" id="5441880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441885">switch</span>&nbsp;<span class="ident" id="5441892">x</span>&nbsp;<span class="op" id="5441894">:=</span>&nbsp;<span class="ident" id="5441897">node</span><span class="op" id="5441901">.</span><span class="op" id="5441902">(</span><span class="keyword" id="5441903">type</span><span class="op" id="5441907">)</span>&nbsp;<span class="op" id="5441909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441914">case</span>&nbsp;<span class="op" id="5441919">*</span><span class="ident" id="5441920">ast</span><span class="op" id="5441923">.</span><span class="ident" id="5441924">ParenExpr</span><span class="op" id="5441933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5441939">//&nbsp;parentheses&nbsp;protect&nbsp;enclosed&nbsp;composite&nbsp;literals</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5441994">return</span>&nbsp;<span class="builtintype" id="5442001">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442010">case</span>&nbsp;<span class="op" id="5442015">*</span><span class="ident" id="5442016">ast</span><span class="op" id="5442019">.</span><span class="ident" id="5442020">CompositeLit</span><span class="op" id="5442032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442038">if</span>&nbsp;<span class="ident" id="5442041">isTypeName</span><span class="op" id="5442051">(</span><span class="ident" id="5442052">x</span><span class="op" id="5442053">.</span><span class="ident" id="5442054">Type</span><span class="op" id="5442058">)</span>&nbsp;<span class="op" id="5442060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442067">strip</span>&nbsp;<span class="op" id="5442073">=</span>&nbsp;<span class="builtintype" id="5442075">false</span>&nbsp;<span class="comment" id="5442081">//&nbsp;do&nbsp;not&nbsp;strip&nbsp;parentheses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442113">}</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442119">return</span>&nbsp;<span class="builtintype" id="5442126">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5442140">//&nbsp;in&nbsp;all&nbsp;other&nbsp;cases,&nbsp;keep&nbsp;inspecting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442182">return</span>&nbsp;<span class="builtintype" id="5442189">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442196">}</span><span class="op" id="5442197">)</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442201">if</span>&nbsp;<span class="ident" id="5442204">strip</span>&nbsp;<span class="op" id="5442210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442215">return</span>&nbsp;<span class="ident" id="5442222">stripParens</span><span class="op" id="5442233">(</span><span class="ident" id="5442234">px</span><span class="op" id="5442236">.</span><span class="ident" id="5442237">X</span><span class="op" id="5442238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442248">return</span>&nbsp;<span class="ident" id="5442255">x</span><br>
<span class="lineno">985</span><span class="op" id="5442257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442260">func</span>&nbsp;<span class="ident" id="5442265">stripParensAlways</span><span class="op" id="5442282">(</span><span class="ident" id="5442283">x</span>&nbsp;<span class="ident" id="5442285">ast</span><span class="op" id="5442288">.</span><span class="ident" id="5442289">Expr</span><span class="op" id="5442293">)</span>&nbsp;<span class="ident" id="5442295">ast</span><span class="op" id="5442298">.</span><span class="ident" id="5442299">Expr</span>&nbsp;<span class="op" id="5442304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442307">if</span>&nbsp;<span class="ident" id="5442310">x</span><span class="op" id="5442311">,</span>&nbsp;<span class="ident" id="5442313">ok</span>&nbsp;<span class="op" id="5442316">:=</span>&nbsp;<span class="ident" id="5442319">x</span><span class="op" id="5442320">.</span><span class="op" id="5442321">(</span><span class="op" id="5442322">*</span><span class="ident" id="5442323">ast</span><span class="op" id="5442326">.</span><span class="ident" id="5442327">ParenExpr</span><span class="op" id="5442336">)</span><span class="op" id="5442337">;</span>&nbsp;<span class="ident" id="5442339">ok</span>&nbsp;<span class="op" id="5442342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442346">return</span>&nbsp;<span class="ident" id="5442353">stripParensAlways</span><span class="op" id="5442370">(</span><span class="ident" id="5442371">x</span><span class="op" id="5442372">.</span><span class="ident" id="5442373">X</span><span class="op" id="5442374">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442380">return</span>&nbsp;<span class="ident" id="5442387">x</span><br>
<span class="lineno"></span><span class="op" id="5442389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5442392">func</span>&nbsp;<span class="op" id="5442397">(</span><span class="ident" id="5442398">p</span>&nbsp;<span class="op" id="5442400">*</span><span class="ident" id="5442401">printer</span><span class="op" id="5442408">)</span>&nbsp;<span class="ident" id="5442410">controlClause</span><span class="op" id="5442423">(</span><span class="ident" id="5442424">isForStmt</span>&nbsp;<span class="builtintype" id="5442434">bool</span><span class="op" id="5442438">,</span>&nbsp;<span class="ident" id="5442440">init</span>&nbsp;<span class="ident" id="5442445">ast</span><span class="op" id="5442448">.</span><span class="ident" id="5442449">Stmt</span><span class="op" id="5442453">,</span>&nbsp;<span class="ident" id="5442455">expr</span>&nbsp;<span class="ident" id="5442460">ast</span><span class="op" id="5442463">.</span><span class="ident" id="5442464">Expr</span><span class="op" id="5442468">,</span>&nbsp;<span class="ident" id="5442470">post</span>&nbsp;<span class="ident" id="5442475">ast</span><span class="op" id="5442478">.</span><span class="ident" id="5442479">Stmt</span><span class="op" id="5442483">)</span>&nbsp;<span class="op" id="5442485">{</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442488">p</span><span class="op" id="5442489">.</span><span class="builtinfunc" id="5442490">print</span><span class="op" id="5442495">(</span><span class="ident" id="5442496">blank</span><span class="op" id="5442501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442504">needsBlank</span>&nbsp;<span class="op" id="5442515">:=</span>&nbsp;<span class="builtintype" id="5442518">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442525">if</span>&nbsp;<span class="ident" id="5442528">init</span>&nbsp;<span class="op" id="5442533">==</span>&nbsp;<span class="ident" id="5442536">nil</span>&nbsp;<span class="op" id="5442540">&amp;&amp;</span>&nbsp;<span class="ident" id="5442543">post</span>&nbsp;<span class="op" id="5442548">==</span>&nbsp;<span class="ident" id="5442551">nil</span>&nbsp;<span class="op" id="5442555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5442559">//&nbsp;no&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442587">if</span>&nbsp;<span class="ident" id="5442590">expr</span>&nbsp;<span class="op" id="5442595">!=</span>&nbsp;<span class="ident" id="5442598">nil</span>&nbsp;<span class="op" id="5442602">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442607">p</span><span class="op" id="5442608">.</span><span class="ident" id="5442609">expr</span><span class="op" id="5442613">(</span><span class="ident" id="5442614">stripParens</span><span class="op" id="5442625">(</span><span class="ident" id="5442626">expr</span><span class="op" id="5442630">)</span><span class="op" id="5442631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442636">needsBlank</span>&nbsp;<span class="op" id="5442647">=</span>&nbsp;<span class="builtintype" id="5442649">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442659">}</span>&nbsp;<span class="keyword" id="5442661">else</span>&nbsp;<span class="op" id="5442666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5442670">//&nbsp;all&nbsp;semicolons&nbsp;required</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5442699">//&nbsp;(they&nbsp;are&nbsp;not&nbsp;separators,&nbsp;print&nbsp;them&nbsp;explicitly)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442753">if</span>&nbsp;<span class="ident" id="5442756">init</span>&nbsp;<span class="op" id="5442761">!=</span>&nbsp;<span class="ident" id="5442764">nil</span>&nbsp;<span class="op" id="5442768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442773">p</span><span class="op" id="5442774">.</span><span class="ident" id="5442775">stmt</span><span class="op" id="5442779">(</span><span class="ident" id="5442780">init</span><span class="op" id="5442784">,</span>&nbsp;<span class="builtintype" id="5442786">false</span><span class="op" id="5442791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442799">p</span><span class="op" id="5442800">.</span><span class="builtinfunc" id="5442801">print</span><span class="op" id="5442806">(</span><span class="ident" id="5442807">token</span><span class="op" id="5442812">.</span><span class="ident" id="5442813">SEMICOLON</span><span class="op" id="5442822">,</span>&nbsp;<span class="ident" id="5442824">blank</span><span class="op" id="5442829">)</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442833">if</span>&nbsp;<span class="ident" id="5442836">expr</span>&nbsp;<span class="op" id="5442841">!=</span>&nbsp;<span class="ident" id="5442844">nil</span>&nbsp;<span class="op" id="5442848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442853">p</span><span class="op" id="5442854">.</span><span class="ident" id="5442855">expr</span><span class="op" id="5442859">(</span><span class="ident" id="5442860">stripParens</span><span class="op" id="5442871">(</span><span class="ident" id="5442872">expr</span><span class="op" id="5442876">)</span><span class="op" id="5442877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442882">needsBlank</span>&nbsp;<span class="op" id="5442893">=</span>&nbsp;<span class="builtintype" id="5442895">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5442902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442906">if</span>&nbsp;<span class="ident" id="5442909">isForStmt</span>&nbsp;<span class="op" id="5442919">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442924">p</span><span class="op" id="5442925">.</span><span class="builtinfunc" id="5442926">print</span><span class="op" id="5442931">(</span><span class="ident" id="5442932">token</span><span class="op" id="5442937">.</span><span class="ident" id="5442938">SEMICOLON</span><span class="op" id="5442947">,</span>&nbsp;<span class="ident" id="5442949">blank</span><span class="op" id="5442954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5442959">needsBlank</span>&nbsp;<span class="op" id="5442970">=</span>&nbsp;<span class="builtintype" id="5442972">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5442981">if</span>&nbsp;<span class="ident" id="5442984">post</span>&nbsp;<span class="op" id="5442989">!=</span>&nbsp;<span class="ident" id="5442992">nil</span>&nbsp;<span class="op" id="5442996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443002">p</span><span class="op" id="5443003">.</span><span class="ident" id="5443004">stmt</span><span class="op" id="5443008">(</span><span class="ident" id="5443009">post</span><span class="op" id="5443013">,</span>&nbsp;<span class="builtintype" id="5443015">false</span><span class="op" id="5443020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443026">needsBlank</span>&nbsp;<span class="op" id="5443037">=</span>&nbsp;<span class="builtintype" id="5443039">true</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443057">if</span>&nbsp;<span class="ident" id="5443060">needsBlank</span>&nbsp;<span class="op" id="5443071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443075">p</span><span class="op" id="5443076">.</span><span class="builtinfunc" id="5443077">print</span><span class="op" id="5443082">(</span><span class="ident" id="5443083">blank</span><span class="op" id="5443088">)</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443091">}</span><br>
<span class="lineno"></span><span class="op" id="5443093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5443096">//&nbsp;indentList&nbsp;reports&nbsp;whether&nbsp;an&nbsp;expression&nbsp;list&nbsp;would&nbsp;look&nbsp;better&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5443169">//&nbsp;were&nbsp;indented&nbsp;wholesale&nbsp;(starting&nbsp;with&nbsp;the&nbsp;very&nbsp;first&nbsp;element,&nbsp;rather</span><br>
<span class="lineno">1030</span><span class="comment" id="5443242">//&nbsp;than&nbsp;starting&nbsp;at&nbsp;the&nbsp;first&nbsp;line&nbsp;break).</span><br>
<span class="lineno"></span><span class="comment" id="5443285">//</span><br>
<span class="lineno"></span><span class="keyword" id="5443288">func</span>&nbsp;<span class="op" id="5443293">(</span><span class="ident" id="5443294">p</span>&nbsp;<span class="op" id="5443296">*</span><span class="ident" id="5443297">printer</span><span class="op" id="5443304">)</span>&nbsp;<span class="ident" id="5443306">indentList</span><span class="op" id="5443316">(</span><span class="ident" id="5443317">list</span>&nbsp;<span class="op" id="5443322">[</span><span class="op" id="5443323">]</span><span class="ident" id="5443324">ast</span><span class="op" id="5443327">.</span><span class="ident" id="5443328">Expr</span><span class="op" id="5443332">)</span>&nbsp;<span class="builtintype" id="5443334">bool</span>&nbsp;<span class="op" id="5443339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443342">//&nbsp;Heuristic:&nbsp;indentList&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;one&nbsp;multi-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443415">//&nbsp;line&nbsp;element&nbsp;in&nbsp;the&nbsp;list,&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;element&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443484">//&nbsp;starting&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ends.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443540">if</span>&nbsp;<span class="builtinfunc" id="5443543">len</span><span class="op" id="5443546">(</span><span class="ident" id="5443547">list</span><span class="op" id="5443551">)</span>&nbsp;<span class="op" id="5443553">&gt;=</span>&nbsp;<span class="num" id="5443556">2</span>&nbsp;<span class="op" id="5443558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443562">var</span>&nbsp;<span class="ident" id="5443566">b</span>&nbsp;<span class="op" id="5443568">=</span>&nbsp;<span class="ident" id="5443570">p</span><span class="op" id="5443571">.</span><span class="ident" id="5443572">lineFor</span><span class="op" id="5443579">(</span><span class="ident" id="5443580">list</span><span class="op" id="5443584">[</span><span class="num" id="5443585">0</span><span class="op" id="5443586">]</span><span class="op" id="5443587">.</span><span class="ident" id="5443588">Pos</span><span class="op" id="5443591">(</span><span class="op" id="5443592">)</span><span class="op" id="5443593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443597">var</span>&nbsp;<span class="ident" id="5443601">e</span>&nbsp;<span class="op" id="5443603">=</span>&nbsp;<span class="ident" id="5443605">p</span><span class="op" id="5443606">.</span><span class="ident" id="5443607">lineFor</span><span class="op" id="5443614">(</span><span class="ident" id="5443615">list</span><span class="op" id="5443619">[</span><span class="builtinfunc" id="5443620">len</span><span class="op" id="5443623">(</span><span class="ident" id="5443624">list</span><span class="op" id="5443628">)</span><span class="op" id="5443629">-</span><span class="num" id="5443630">1</span><span class="op" id="5443631">]</span><span class="op" id="5443632">.</span><span class="ident" id="5443633">End</span><span class="op" id="5443636">(</span><span class="op" id="5443637">)</span><span class="op" id="5443638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443642">if</span>&nbsp;<span class="num" id="5443645">0</span>&nbsp;<span class="op" id="5443647">&lt;</span>&nbsp;<span class="ident" id="5443649">b</span>&nbsp;<span class="op" id="5443651">&amp;&amp;</span>&nbsp;<span class="ident" id="5443654">b</span>&nbsp;<span class="op" id="5443656">&lt;</span>&nbsp;<span class="ident" id="5443658">e</span>&nbsp;<span class="op" id="5443660">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443665">//&nbsp;list&nbsp;spans&nbsp;multiple&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443697">n</span>&nbsp;<span class="op" id="5443699">:=</span>&nbsp;<span class="num" id="5443702">0</span>&nbsp;<span class="comment" id="5443704">//&nbsp;multi-line&nbsp;element&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443735">line</span>&nbsp;<span class="op" id="5443740">:=</span>&nbsp;<span class="ident" id="5443743">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443748">for</span>&nbsp;<span class="ident" id="5443752">_</span><span class="op" id="5443753">,</span>&nbsp;<span class="ident" id="5443755">x</span>&nbsp;<span class="op" id="5443757">:=</span>&nbsp;<span class="keyword" id="5443760">range</span>&nbsp;<span class="ident" id="5443766">list</span>&nbsp;<span class="op" id="5443771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443777">xb</span>&nbsp;<span class="op" id="5443780">:=</span>&nbsp;<span class="ident" id="5443783">p</span><span class="op" id="5443784">.</span><span class="ident" id="5443785">lineFor</span><span class="op" id="5443792">(</span><span class="ident" id="5443793">x</span><span class="op" id="5443794">.</span><span class="ident" id="5443795">Pos</span><span class="op" id="5443798">(</span><span class="op" id="5443799">)</span><span class="op" id="5443800">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5443806">xe</span>&nbsp;<span class="op" id="5443809">:=</span>&nbsp;<span class="ident" id="5443812">p</span><span class="op" id="5443813">.</span><span class="ident" id="5443814">lineFor</span><span class="op" id="5443821">(</span><span class="ident" id="5443822">x</span><span class="op" id="5443823">.</span><span class="ident" id="5443824">End</span><span class="op" id="5443827">(</span><span class="op" id="5443828">)</span><span class="op" id="5443829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443835">if</span>&nbsp;<span class="ident" id="5443838">line</span>&nbsp;<span class="op" id="5443843">&lt;</span>&nbsp;<span class="ident" id="5443845">xb</span>&nbsp;<span class="op" id="5443848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443855">//&nbsp;x&nbsp;is&nbsp;not&nbsp;starting&nbsp;on&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443893">//&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;one&nbsp;ended</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443932">return</span>&nbsp;<span class="builtintype" id="5443939">true</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5443948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5443954">if</span>&nbsp;<span class="ident" id="5443957">xb</span>&nbsp;<span class="op" id="5443960">&lt;</span>&nbsp;<span class="ident" id="5443962">xe</span>&nbsp;<span class="op" id="5443965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5443972">//&nbsp;x&nbsp;is&nbsp;a&nbsp;multi-line&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444006">n</span><span class="op" id="5444007">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444014">}</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444020">line</span>&nbsp;<span class="op" id="5444025">=</span>&nbsp;<span class="ident" id="5444027">xe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444038">return</span>&nbsp;<span class="ident" id="5444045">n</span>&nbsp;<span class="op" id="5444047">&gt;</span>&nbsp;<span class="num" id="5444049">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444056">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444059">return</span>&nbsp;<span class="builtintype" id="5444066">false</span><br>
<span class="lineno"></span><span class="op" id="5444072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5444075">func</span>&nbsp;<span class="op" id="5444080">(</span><span class="ident" id="5444081">p</span>&nbsp;<span class="op" id="5444083">*</span><span class="ident" id="5444084">printer</span><span class="op" id="5444091">)</span>&nbsp;<span class="ident" id="5444093">stmt</span><span class="op" id="5444097">(</span><span class="ident" id="5444098">stmt</span>&nbsp;<span class="ident" id="5444103">ast</span><span class="op" id="5444106">.</span><span class="ident" id="5444107">Stmt</span><span class="op" id="5444111">,</span>&nbsp;<span class="ident" id="5444113">nextIsRBrace</span>&nbsp;<span class="builtintype" id="5444126">bool</span><span class="op" id="5444130">)</span>&nbsp;<span class="op" id="5444132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444135">p</span><span class="op" id="5444136">.</span><span class="builtinfunc" id="5444137">print</span><span class="op" id="5444142">(</span><span class="ident" id="5444143">stmt</span><span class="op" id="5444147">.</span><span class="ident" id="5444148">Pos</span><span class="op" id="5444151">(</span><span class="op" id="5444152">)</span><span class="op" id="5444153">)</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444157">switch</span>&nbsp;<span class="ident" id="5444164">s</span>&nbsp;<span class="op" id="5444166">:=</span>&nbsp;<span class="ident" id="5444169">stmt</span><span class="op" id="5444173">.</span><span class="op" id="5444174">(</span><span class="keyword" id="5444175">type</span><span class="op" id="5444179">)</span>&nbsp;<span class="op" id="5444181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444184">case</span>&nbsp;<span class="op" id="5444189">*</span><span class="ident" id="5444190">ast</span><span class="op" id="5444193">.</span><span class="ident" id="5444194">BadStmt</span><span class="op" id="5444201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444205">p</span><span class="op" id="5444206">.</span><span class="builtinfunc" id="5444207">print</span><span class="op" id="5444212">(</span><span class="string" id="5444213">&#34;BadStmt&#34;</span><span class="op" id="5444222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444226">case</span>&nbsp;<span class="op" id="5444231">*</span><span class="ident" id="5444232">ast</span><span class="op" id="5444235">.</span><span class="ident" id="5444236">DeclStmt</span><span class="op" id="5444244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444248">p</span><span class="op" id="5444249">.</span><span class="ident" id="5444250">decl</span><span class="op" id="5444254">(</span><span class="ident" id="5444255">s</span><span class="op" id="5444256">.</span><span class="ident" id="5444257">Decl</span><span class="op" id="5444261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444265">case</span>&nbsp;<span class="op" id="5444270">*</span><span class="ident" id="5444271">ast</span><span class="op" id="5444274">.</span><span class="ident" id="5444275">EmptyStmt</span><span class="op" id="5444284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444288">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444307">case</span>&nbsp;<span class="op" id="5444312">*</span><span class="ident" id="5444313">ast</span><span class="op" id="5444316">.</span><span class="ident" id="5444317">LabeledStmt</span><span class="op" id="5444328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444332">//&nbsp;a&nbsp;&#34;correcting&#34;&nbsp;unindent&nbsp;immediately&nbsp;following&nbsp;a&nbsp;line&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444396">//&nbsp;is&nbsp;applied&nbsp;before&nbsp;the&nbsp;line&nbsp;break&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5444457">//&nbsp;between&nbsp;(see&nbsp;writeWhitespace)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444492">p</span><span class="op" id="5444493">.</span><span class="builtinfunc" id="5444494">print</span><span class="op" id="5444499">(</span><span class="ident" id="5444500">unindent</span><span class="op" id="5444508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444512">p</span><span class="op" id="5444513">.</span><span class="ident" id="5444514">expr</span><span class="op" id="5444518">(</span><span class="ident" id="5444519">s</span><span class="op" id="5444520">.</span><span class="ident" id="5444521">Label</span><span class="op" id="5444526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444530">p</span><span class="op" id="5444531">.</span><span class="builtinfunc" id="5444532">print</span><span class="op" id="5444537">(</span><span class="ident" id="5444538">s</span><span class="op" id="5444539">.</span><span class="ident" id="5444540">Colon</span><span class="op" id="5444545">,</span>&nbsp;<span class="ident" id="5444547">token</span><span class="op" id="5444552">.</span><span class="ident" id="5444553">COLON</span><span class="op" id="5444558">,</span>&nbsp;<span class="ident" id="5444560">indent</span><span class="op" id="5444566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444570">if</span>&nbsp;<span class="ident" id="5444573">e</span><span class="op" id="5444574">,</span>&nbsp;<span class="ident" id="5444576">isEmpty</span>&nbsp;<span class="op" id="5444584">:=</span>&nbsp;<span class="ident" id="5444587">s</span><span class="op" id="5444588">.</span><span class="ident" id="5444589">Stmt</span><span class="op" id="5444593">.</span><span class="op" id="5444594">(</span><span class="op" id="5444595">*</span><span class="ident" id="5444596">ast</span><span class="op" id="5444599">.</span><span class="ident" id="5444600">EmptyStmt</span><span class="op" id="5444609">)</span><span class="op" id="5444610">;</span>&nbsp;<span class="ident" id="5444612">isEmpty</span>&nbsp;<span class="op" id="5444620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444625">if</span>&nbsp;<span class="op" id="5444628">!</span><span class="ident" id="5444629">nextIsRBrace</span>&nbsp;<span class="op" id="5444642">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444648">p</span><span class="op" id="5444649">.</span><span class="builtinfunc" id="5444650">print</span><span class="op" id="5444655">(</span><span class="ident" id="5444656">newline</span><span class="op" id="5444663">,</span>&nbsp;<span class="ident" id="5444665">e</span><span class="op" id="5444666">.</span><span class="ident" id="5444667">Pos</span><span class="op" id="5444670">(</span><span class="op" id="5444671">)</span><span class="op" id="5444672">,</span>&nbsp;<span class="ident" id="5444674">token</span><span class="op" id="5444679">.</span><span class="ident" id="5444680">SEMICOLON</span><span class="op" id="5444689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444695">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444708">}</span>&nbsp;<span class="keyword" id="5444710">else</span>&nbsp;<span class="op" id="5444715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444720">p</span><span class="op" id="5444721">.</span><span class="ident" id="5444722">linebreak</span><span class="op" id="5444731">(</span><span class="ident" id="5444732">p</span><span class="op" id="5444733">.</span><span class="ident" id="5444734">lineFor</span><span class="op" id="5444741">(</span><span class="ident" id="5444742">s</span><span class="op" id="5444743">.</span><span class="ident" id="5444744">Stmt</span><span class="op" id="5444748">.</span><span class="ident" id="5444749">Pos</span><span class="op" id="5444752">(</span><span class="op" id="5444753">)</span><span class="op" id="5444754">)</span><span class="op" id="5444755">,</span>&nbsp;<span class="num" id="5444757">1</span><span class="op" id="5444758">,</span>&nbsp;<span class="ident" id="5444760">ignore</span><span class="op" id="5444766">,</span>&nbsp;<span class="builtintype" id="5444768">true</span><span class="op" id="5444772">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5444776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444780">p</span><span class="op" id="5444781">.</span><span class="ident" id="5444782">stmt</span><span class="op" id="5444786">(</span><span class="ident" id="5444787">s</span><span class="op" id="5444788">.</span><span class="ident" id="5444789">Stmt</span><span class="op" id="5444793">,</span>&nbsp;<span class="ident" id="5444795">nextIsRBrace</span><span class="op" id="5444807">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444811">case</span>&nbsp;<span class="op" id="5444816">*</span><span class="ident" id="5444817">ast</span><span class="op" id="5444820">.</span><span class="ident" id="5444821">ExprStmt</span><span class="op" id="5444829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444833">const</span>&nbsp;<span class="ident" id="5444839">depth</span>&nbsp;<span class="op" id="5444845">=</span>&nbsp;<span class="num" id="5444847">1</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444851">p</span><span class="op" id="5444852">.</span><span class="ident" id="5444853">expr0</span><span class="op" id="5444858">(</span><span class="ident" id="5444859">s</span><span class="op" id="5444860">.</span><span class="ident" id="5444861">X</span><span class="op" id="5444862">,</span>&nbsp;<span class="ident" id="5444864">depth</span><span class="op" id="5444869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444873">case</span>&nbsp;<span class="op" id="5444878">*</span><span class="ident" id="5444879">ast</span><span class="op" id="5444882">.</span><span class="ident" id="5444883">SendStmt</span><span class="op" id="5444891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5444895">const</span>&nbsp;<span class="ident" id="5444901">depth</span>&nbsp;<span class="op" id="5444907">=</span>&nbsp;<span class="num" id="5444909">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444913">p</span><span class="op" id="5444914">.</span><span class="ident" id="5444915">expr0</span><span class="op" id="5444920">(</span><span class="ident" id="5444921">s</span><span class="op" id="5444922">.</span><span class="ident" id="5444923">Chan</span><span class="op" id="5444927">,</span>&nbsp;<span class="ident" id="5444929">depth</span><span class="op" id="5444934">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444938">p</span><span class="op" id="5444939">.</span><span class="builtinfunc" id="5444940">print</span><span class="op" id="5444945">(</span><span class="ident" id="5444946">blank</span><span class="op" id="5444951">,</span>&nbsp;<span class="ident" id="5444953">s</span><span class="op" id="5444954">.</span><span class="ident" id="5444955">Arrow</span><span class="op" id="5444960">,</span>&nbsp;<span class="ident" id="5444962">token</span><span class="op" id="5444967">.</span><span class="ident" id="5444968">ARROW</span><span class="op" id="5444973">,</span>&nbsp;<span class="ident" id="5444975">blank</span><span class="op" id="5444980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5444984">p</span><span class="op" id="5444985">.</span><span class="ident" id="5444986">expr0</span><span class="op" id="5444991">(</span><span class="ident" id="5444992">s</span><span class="op" id="5444993">.</span><span class="ident" id="5444994">Value</span><span class="op" id="5444999">,</span>&nbsp;<span class="ident" id="5445001">depth</span><span class="op" id="5445006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445010">case</span>&nbsp;<span class="op" id="5445015">*</span><span class="ident" id="5445016">ast</span><span class="op" id="5445019">.</span><span class="ident" id="5445020">IncDecStmt</span><span class="op" id="5445030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445034">const</span>&nbsp;<span class="ident" id="5445040">depth</span>&nbsp;<span class="op" id="5445046">=</span>&nbsp;<span class="num" id="5445048">1</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445052">p</span><span class="op" id="5445053">.</span><span class="ident" id="5445054">expr0</span><span class="op" id="5445059">(</span><span class="ident" id="5445060">s</span><span class="op" id="5445061">.</span><span class="ident" id="5445062">X</span><span class="op" id="5445063">,</span>&nbsp;<span class="ident" id="5445065">depth</span><span class="op" id="5445070">+</span><span class="num" id="5445071">1</span><span class="op" id="5445072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445076">p</span><span class="op" id="5445077">.</span><span class="builtinfunc" id="5445078">print</span><span class="op" id="5445083">(</span><span class="ident" id="5445084">s</span><span class="op" id="5445085">.</span><span class="ident" id="5445086">TokPos</span><span class="op" id="5445092">,</span>&nbsp;<span class="ident" id="5445094">s</span><span class="op" id="5445095">.</span><span class="ident" id="5445096">Tok</span><span class="op" id="5445099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445103">case</span>&nbsp;<span class="op" id="5445108">*</span><span class="ident" id="5445109">ast</span><span class="op" id="5445112">.</span><span class="ident" id="5445113">AssignStmt</span><span class="op" id="5445123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445127">var</span>&nbsp;<span class="ident" id="5445131">depth</span>&nbsp;<span class="op" id="5445137">=</span>&nbsp;<span class="num" id="5445139">1</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445143">if</span>&nbsp;<span class="builtinfunc" id="5445146">len</span><span class="op" id="5445149">(</span><span class="ident" id="5445150">s</span><span class="op" id="5445151">.</span><span class="ident" id="5445152">Lhs</span><span class="op" id="5445155">)</span>&nbsp;<span class="op" id="5445157">&gt;</span>&nbsp;<span class="num" id="5445159">1</span>&nbsp;<span class="op" id="5445161">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5445164">len</span><span class="op" id="5445167">(</span><span class="ident" id="5445168">s</span><span class="op" id="5445169">.</span><span class="ident" id="5445170">Rhs</span><span class="op" id="5445173">)</span>&nbsp;<span class="op" id="5445175">&gt;</span>&nbsp;<span class="num" id="5445177">1</span>&nbsp;<span class="op" id="5445179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445184">depth</span><span class="op" id="5445189">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445198">p</span><span class="op" id="5445199">.</span><span class="ident" id="5445200">exprList</span><span class="op" id="5445208">(</span><span class="ident" id="5445209">s</span><span class="op" id="5445210">.</span><span class="ident" id="5445211">Pos</span><span class="op" id="5445214">(</span><span class="op" id="5445215">)</span><span class="op" id="5445216">,</span>&nbsp;<span class="ident" id="5445218">s</span><span class="op" id="5445219">.</span><span class="ident" id="5445220">Lhs</span><span class="op" id="5445223">,</span>&nbsp;<span class="ident" id="5445225">depth</span><span class="op" id="5445230">,</span>&nbsp;<span class="num" id="5445232">0</span><span class="op" id="5445233">,</span>&nbsp;<span class="ident" id="5445235">s</span><span class="op" id="5445236">.</span><span class="ident" id="5445237">TokPos</span><span class="op" id="5445243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445247">p</span><span class="op" id="5445248">.</span><span class="builtinfunc" id="5445249">print</span><span class="op" id="5445254">(</span><span class="ident" id="5445255">blank</span><span class="op" id="5445260">,</span>&nbsp;<span class="ident" id="5445262">s</span><span class="op" id="5445263">.</span><span class="ident" id="5445264">TokPos</span><span class="op" id="5445270">,</span>&nbsp;<span class="ident" id="5445272">s</span><span class="op" id="5445273">.</span><span class="ident" id="5445274">Tok</span><span class="op" id="5445277">,</span>&nbsp;<span class="ident" id="5445279">blank</span><span class="op" id="5445284">)</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445288">p</span><span class="op" id="5445289">.</span><span class="ident" id="5445290">exprList</span><span class="op" id="5445298">(</span><span class="ident" id="5445299">s</span><span class="op" id="5445300">.</span><span class="ident" id="5445301">TokPos</span><span class="op" id="5445307">,</span>&nbsp;<span class="ident" id="5445309">s</span><span class="op" id="5445310">.</span><span class="ident" id="5445311">Rhs</span><span class="op" id="5445314">,</span>&nbsp;<span class="ident" id="5445316">depth</span><span class="op" id="5445321">,</span>&nbsp;<span class="num" id="5445323">0</span><span class="op" id="5445324">,</span>&nbsp;<span class="ident" id="5445326">token</span><span class="op" id="5445331">.</span><span class="ident" id="5445332">NoPos</span><span class="op" id="5445337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445341">case</span>&nbsp;<span class="op" id="5445346">*</span><span class="ident" id="5445347">ast</span><span class="op" id="5445350">.</span><span class="ident" id="5445351">GoStmt</span><span class="op" id="5445357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445361">p</span><span class="op" id="5445362">.</span><span class="builtinfunc" id="5445363">print</span><span class="op" id="5445368">(</span><span class="ident" id="5445369">token</span><span class="op" id="5445374">.</span><span class="ident" id="5445375">GO</span><span class="op" id="5445377">,</span>&nbsp;<span class="ident" id="5445379">blank</span><span class="op" id="5445384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445388">p</span><span class="op" id="5445389">.</span><span class="ident" id="5445390">expr</span><span class="op" id="5445394">(</span><span class="ident" id="5445395">s</span><span class="op" id="5445396">.</span><span class="ident" id="5445397">Call</span><span class="op" id="5445401">)</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445405">case</span>&nbsp;<span class="op" id="5445410">*</span><span class="ident" id="5445411">ast</span><span class="op" id="5445414">.</span><span class="ident" id="5445415">DeferStmt</span><span class="op" id="5445424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445428">p</span><span class="op" id="5445429">.</span><span class="builtinfunc" id="5445430">print</span><span class="op" id="5445435">(</span><span class="ident" id="5445436">token</span><span class="op" id="5445441">.</span><span class="ident" id="5445442">DEFER</span><span class="op" id="5445447">,</span>&nbsp;<span class="ident" id="5445449">blank</span><span class="op" id="5445454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445458">p</span><span class="op" id="5445459">.</span><span class="ident" id="5445460">expr</span><span class="op" id="5445464">(</span><span class="ident" id="5445465">s</span><span class="op" id="5445466">.</span><span class="ident" id="5445467">Call</span><span class="op" id="5445471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445475">case</span>&nbsp;<span class="op" id="5445480">*</span><span class="ident" id="5445481">ast</span><span class="op" id="5445484">.</span><span class="ident" id="5445485">ReturnStmt</span><span class="op" id="5445495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445499">p</span><span class="op" id="5445500">.</span><span class="builtinfunc" id="5445501">print</span><span class="op" id="5445506">(</span><span class="ident" id="5445507">token</span><span class="op" id="5445512">.</span><span class="ident" id="5445513">RETURN</span><span class="op" id="5445519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445523">if</span>&nbsp;<span class="ident" id="5445526">s</span><span class="op" id="5445527">.</span><span class="ident" id="5445528">Results</span>&nbsp;<span class="op" id="5445536">!=</span>&nbsp;<span class="ident" id="5445539">nil</span>&nbsp;<span class="op" id="5445543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445548">p</span><span class="op" id="5445549">.</span><span class="builtinfunc" id="5445550">print</span><span class="op" id="5445555">(</span><span class="ident" id="5445556">blank</span><span class="op" id="5445561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445566">//&nbsp;Use&nbsp;indentList&nbsp;heuristic&nbsp;to&nbsp;make&nbsp;corner&nbsp;cases&nbsp;look</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445623">//&nbsp;better&nbsp;(issue&nbsp;1207).&nbsp;A&nbsp;more&nbsp;systematic&nbsp;approach&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445683">//&nbsp;always&nbsp;indent,&nbsp;but&nbsp;this&nbsp;would&nbsp;cause&nbsp;significant</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445737">//&nbsp;reformatting&nbsp;of&nbsp;the&nbsp;code&nbsp;base&nbsp;and&nbsp;not&nbsp;necessarily</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5445793">//&nbsp;lead&nbsp;to&nbsp;more&nbsp;nicely&nbsp;formatted&nbsp;code&nbsp;in&nbsp;general.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5445846">if</span>&nbsp;<span class="ident" id="5445849">p</span><span class="op" id="5445850">.</span><span class="ident" id="5445851">indentList</span><span class="op" id="5445861">(</span><span class="ident" id="5445862">s</span><span class="op" id="5445863">.</span><span class="ident" id="5445864">Results</span><span class="op" id="5445871">)</span>&nbsp;<span class="op" id="5445873">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445879">p</span><span class="op" id="5445880">.</span><span class="builtinfunc" id="5445881">print</span><span class="op" id="5445886">(</span><span class="ident" id="5445887">indent</span><span class="op" id="5445893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445899">p</span><span class="op" id="5445900">.</span><span class="ident" id="5445901">exprList</span><span class="op" id="5445909">(</span><span class="ident" id="5445910">s</span><span class="op" id="5445911">.</span><span class="ident" id="5445912">Pos</span><span class="op" id="5445915">(</span><span class="op" id="5445916">)</span><span class="op" id="5445917">,</span>&nbsp;<span class="ident" id="5445919">s</span><span class="op" id="5445920">.</span><span class="ident" id="5445921">Results</span><span class="op" id="5445928">,</span>&nbsp;<span class="num" id="5445930">1</span><span class="op" id="5445931">,</span>&nbsp;<span class="ident" id="5445933">noIndent</span><span class="op" id="5445941">,</span>&nbsp;<span class="ident" id="5445943">token</span><span class="op" id="5445948">.</span><span class="ident" id="5445949">NoPos</span><span class="op" id="5445954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445960">p</span><span class="op" id="5445961">.</span><span class="builtinfunc" id="5445962">print</span><span class="op" id="5445967">(</span><span class="ident" id="5445968">unindent</span><span class="op" id="5445976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5445981">}</span>&nbsp;<span class="keyword" id="5445983">else</span>&nbsp;<span class="op" id="5445988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445994">p</span><span class="op" id="5445995">.</span><span class="ident" id="5445996">exprList</span><span class="op" id="5446004">(</span><span class="ident" id="5446005">s</span><span class="op" id="5446006">.</span><span class="ident" id="5446007">Pos</span><span class="op" id="5446010">(</span><span class="op" id="5446011">)</span><span class="op" id="5446012">,</span>&nbsp;<span class="ident" id="5446014">s</span><span class="op" id="5446015">.</span><span class="ident" id="5446016">Results</span><span class="op" id="5446023">,</span>&nbsp;<span class="num" id="5446025">1</span><span class="op" id="5446026">,</span>&nbsp;<span class="num" id="5446028">0</span><span class="op" id="5446029">,</span>&nbsp;<span class="ident" id="5446031">token</span><span class="op" id="5446036">.</span><span class="ident" id="5446037">NoPos</span><span class="op" id="5446042">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446055">case</span>&nbsp;<span class="op" id="5446060">*</span><span class="ident" id="5446061">ast</span><span class="op" id="5446064">.</span><span class="ident" id="5446065">BranchStmt</span><span class="op" id="5446075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446079">p</span><span class="op" id="5446080">.</span><span class="builtinfunc" id="5446081">print</span><span class="op" id="5446086">(</span><span class="ident" id="5446087">s</span><span class="op" id="5446088">.</span><span class="ident" id="5446089">Tok</span><span class="op" id="5446092">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446096">if</span>&nbsp;<span class="ident" id="5446099">s</span><span class="op" id="5446100">.</span><span class="ident" id="5446101">Label</span>&nbsp;<span class="op" id="5446107">!=</span>&nbsp;<span class="ident" id="5446110">nil</span>&nbsp;<span class="op" id="5446114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446119">p</span><span class="op" id="5446120">.</span><span class="builtinfunc" id="5446121">print</span><span class="op" id="5446126">(</span><span class="ident" id="5446127">blank</span><span class="op" id="5446132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446137">p</span><span class="op" id="5446138">.</span><span class="ident" id="5446139">expr</span><span class="op" id="5446143">(</span><span class="ident" id="5446144">s</span><span class="op" id="5446145">.</span><span class="ident" id="5446146">Label</span><span class="op" id="5446151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446159">case</span>&nbsp;<span class="op" id="5446164">*</span><span class="ident" id="5446165">ast</span><span class="op" id="5446168">.</span><span class="ident" id="5446169">BlockStmt</span><span class="op" id="5446178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446182">p</span><span class="op" id="5446183">.</span><span class="ident" id="5446184">block</span><span class="op" id="5446189">(</span><span class="ident" id="5446190">s</span><span class="op" id="5446191">,</span>&nbsp;<span class="num" id="5446193">1</span><span class="op" id="5446194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446198">case</span>&nbsp;<span class="op" id="5446203">*</span><span class="ident" id="5446204">ast</span><span class="op" id="5446207">.</span><span class="ident" id="5446208">IfStmt</span><span class="op" id="5446214">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446218">p</span><span class="op" id="5446219">.</span><span class="builtinfunc" id="5446220">print</span><span class="op" id="5446225">(</span><span class="ident" id="5446226">token</span><span class="op" id="5446231">.</span><span class="ident" id="5446232">IF</span><span class="op" id="5446234">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446238">p</span><span class="op" id="5446239">.</span><span class="ident" id="5446240">controlClause</span><span class="op" id="5446253">(</span><span class="builtintype" id="5446254">false</span><span class="op" id="5446259">,</span>&nbsp;<span class="ident" id="5446261">s</span><span class="op" id="5446262">.</span><span class="ident" id="5446263">Init</span><span class="op" id="5446267">,</span>&nbsp;<span class="ident" id="5446269">s</span><span class="op" id="5446270">.</span><span class="ident" id="5446271">Cond</span><span class="op" id="5446275">,</span>&nbsp;<span class="ident" id="5446277">nil</span><span class="op" id="5446280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446284">p</span><span class="op" id="5446285">.</span><span class="ident" id="5446286">block</span><span class="op" id="5446291">(</span><span class="ident" id="5446292">s</span><span class="op" id="5446293">.</span><span class="ident" id="5446294">Body</span><span class="op" id="5446298">,</span>&nbsp;<span class="num" id="5446300">1</span><span class="op" id="5446301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446305">if</span>&nbsp;<span class="ident" id="5446308">s</span><span class="op" id="5446309">.</span><span class="ident" id="5446310">Else</span>&nbsp;<span class="op" id="5446315">!=</span>&nbsp;<span class="ident" id="5446318">nil</span>&nbsp;<span class="op" id="5446322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446327">p</span><span class="op" id="5446328">.</span><span class="builtinfunc" id="5446329">print</span><span class="op" id="5446334">(</span><span class="ident" id="5446335">blank</span><span class="op" id="5446340">,</span>&nbsp;<span class="ident" id="5446342">token</span><span class="op" id="5446347">.</span><span class="ident" id="5446348">ELSE</span><span class="op" id="5446352">,</span>&nbsp;<span class="ident" id="5446354">blank</span><span class="op" id="5446359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446364">switch</span>&nbsp;<span class="ident" id="5446371">s</span><span class="op" id="5446372">.</span><span class="ident" id="5446373">Else</span><span class="op" id="5446377">.</span><span class="op" id="5446378">(</span><span class="keyword" id="5446379">type</span><span class="op" id="5446383">)</span>&nbsp;<span class="op" id="5446385">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446390">case</span>&nbsp;<span class="op" id="5446395">*</span><span class="ident" id="5446396">ast</span><span class="op" id="5446399">.</span><span class="ident" id="5446400">BlockStmt</span><span class="op" id="5446409">,</span>&nbsp;<span class="op" id="5446411">*</span><span class="ident" id="5446412">ast</span><span class="op" id="5446415">.</span><span class="ident" id="5446416">IfStmt</span><span class="op" id="5446422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446428">p</span><span class="op" id="5446429">.</span><span class="ident" id="5446430">stmt</span><span class="op" id="5446434">(</span><span class="ident" id="5446435">s</span><span class="op" id="5446436">.</span><span class="ident" id="5446437">Else</span><span class="op" id="5446441">,</span>&nbsp;<span class="ident" id="5446443">nextIsRBrace</span><span class="op" id="5446455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446460">default</span><span class="op" id="5446467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446473">p</span><span class="op" id="5446474">.</span><span class="builtinfunc" id="5446475">print</span><span class="op" id="5446480">(</span><span class="ident" id="5446481">token</span><span class="op" id="5446486">.</span><span class="ident" id="5446487">LBRACE</span><span class="op" id="5446493">,</span>&nbsp;<span class="ident" id="5446495">indent</span><span class="op" id="5446501">,</span>&nbsp;<span class="ident" id="5446503">formfeed</span><span class="op" id="5446511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446517">p</span><span class="op" id="5446518">.</span><span class="ident" id="5446519">stmt</span><span class="op" id="5446523">(</span><span class="ident" id="5446524">s</span><span class="op" id="5446525">.</span><span class="ident" id="5446526">Else</span><span class="op" id="5446530">,</span>&nbsp;<span class="builtintype" id="5446532">true</span><span class="op" id="5446536">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446542">p</span><span class="op" id="5446543">.</span><span class="builtinfunc" id="5446544">print</span><span class="op" id="5446549">(</span><span class="ident" id="5446550">unindent</span><span class="op" id="5446558">,</span>&nbsp;<span class="ident" id="5446560">formfeed</span><span class="op" id="5446568">,</span>&nbsp;<span class="ident" id="5446570">token</span><span class="op" id="5446575">.</span><span class="ident" id="5446576">RBRACE</span><span class="op" id="5446582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446595">case</span>&nbsp;<span class="op" id="5446600">*</span><span class="ident" id="5446601">ast</span><span class="op" id="5446604">.</span><span class="ident" id="5446605">CaseClause</span><span class="op" id="5446615">:</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446619">if</span>&nbsp;<span class="ident" id="5446622">s</span><span class="op" id="5446623">.</span><span class="ident" id="5446624">List</span>&nbsp;<span class="op" id="5446629">!=</span>&nbsp;<span class="ident" id="5446632">nil</span>&nbsp;<span class="op" id="5446636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446641">p</span><span class="op" id="5446642">.</span><span class="builtinfunc" id="5446643">print</span><span class="op" id="5446648">(</span><span class="ident" id="5446649">token</span><span class="op" id="5446654">.</span><span class="ident" id="5446655">CASE</span><span class="op" id="5446659">,</span>&nbsp;<span class="ident" id="5446661">blank</span><span class="op" id="5446666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446671">p</span><span class="op" id="5446672">.</span><span class="ident" id="5446673">exprList</span><span class="op" id="5446681">(</span><span class="ident" id="5446682">s</span><span class="op" id="5446683">.</span><span class="ident" id="5446684">Pos</span><span class="op" id="5446687">(</span><span class="op" id="5446688">)</span><span class="op" id="5446689">,</span>&nbsp;<span class="ident" id="5446691">s</span><span class="op" id="5446692">.</span><span class="ident" id="5446693">List</span><span class="op" id="5446697">,</span>&nbsp;<span class="num" id="5446699">1</span><span class="op" id="5446700">,</span>&nbsp;<span class="num" id="5446702">0</span><span class="op" id="5446703">,</span>&nbsp;<span class="ident" id="5446705">s</span><span class="op" id="5446706">.</span><span class="ident" id="5446707">Colon</span><span class="op" id="5446712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446716">}</span>&nbsp;<span class="keyword" id="5446718">else</span>&nbsp;<span class="op" id="5446723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446728">p</span><span class="op" id="5446729">.</span><span class="builtinfunc" id="5446730">print</span><span class="op" id="5446735">(</span><span class="ident" id="5446736">token</span><span class="op" id="5446741">.</span><span class="ident" id="5446742">DEFAULT</span><span class="op" id="5446749">)</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5446753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446757">p</span><span class="op" id="5446758">.</span><span class="builtinfunc" id="5446759">print</span><span class="op" id="5446764">(</span><span class="ident" id="5446765">s</span><span class="op" id="5446766">.</span><span class="ident" id="5446767">Colon</span><span class="op" id="5446772">,</span>&nbsp;<span class="ident" id="5446774">token</span><span class="op" id="5446779">.</span><span class="ident" id="5446780">COLON</span><span class="op" id="5446785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446789">p</span><span class="op" id="5446790">.</span><span class="ident" id="5446791">stmtList</span><span class="op" id="5446799">(</span><span class="ident" id="5446800">s</span><span class="op" id="5446801">.</span><span class="ident" id="5446802">Body</span><span class="op" id="5446806">,</span>&nbsp;<span class="num" id="5446808">1</span><span class="op" id="5446809">,</span>&nbsp;<span class="ident" id="5446811">nextIsRBrace</span><span class="op" id="5446823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446827">case</span>&nbsp;<span class="op" id="5446832">*</span><span class="ident" id="5446833">ast</span><span class="op" id="5446836">.</span><span class="ident" id="5446837">SwitchStmt</span><span class="op" id="5446847">:</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446851">p</span><span class="op" id="5446852">.</span><span class="builtinfunc" id="5446853">print</span><span class="op" id="5446858">(</span><span class="ident" id="5446859">token</span><span class="op" id="5446864">.</span><span class="ident" id="5446865">SWITCH</span><span class="op" id="5446871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446875">p</span><span class="op" id="5446876">.</span><span class="ident" id="5446877">controlClause</span><span class="op" id="5446890">(</span><span class="builtintype" id="5446891">false</span><span class="op" id="5446896">,</span>&nbsp;<span class="ident" id="5446898">s</span><span class="op" id="5446899">.</span><span class="ident" id="5446900">Init</span><span class="op" id="5446904">,</span>&nbsp;<span class="ident" id="5446906">s</span><span class="op" id="5446907">.</span><span class="ident" id="5446908">Tag</span><span class="op" id="5446911">,</span>&nbsp;<span class="ident" id="5446913">nil</span><span class="op" id="5446916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446920">p</span><span class="op" id="5446921">.</span><span class="ident" id="5446922">block</span><span class="op" id="5446927">(</span><span class="ident" id="5446928">s</span><span class="op" id="5446929">.</span><span class="ident" id="5446930">Body</span><span class="op" id="5446934">,</span>&nbsp;<span class="num" id="5446936">0</span><span class="op" id="5446937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446941">case</span>&nbsp;<span class="op" id="5446946">*</span><span class="ident" id="5446947">ast</span><span class="op" id="5446950">.</span><span class="ident" id="5446951">TypeSwitchStmt</span><span class="op" id="5446965">:</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446969">p</span><span class="op" id="5446970">.</span><span class="builtinfunc" id="5446971">print</span><span class="op" id="5446976">(</span><span class="ident" id="5446977">token</span><span class="op" id="5446982">.</span><span class="ident" id="5446983">SWITCH</span><span class="op" id="5446989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446993">if</span>&nbsp;<span class="ident" id="5446996">s</span><span class="op" id="5446997">.</span><span class="ident" id="5446998">Init</span>&nbsp;<span class="op" id="5447003">!=</span>&nbsp;<span class="ident" id="5447006">nil</span>&nbsp;<span class="op" id="5447010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447015">p</span><span class="op" id="5447016">.</span><span class="builtinfunc" id="5447017">print</span><span class="op" id="5447022">(</span><span class="ident" id="5447023">blank</span><span class="op" id="5447028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447033">p</span><span class="op" id="5447034">.</span><span class="ident" id="5447035">stmt</span><span class="op" id="5447039">(</span><span class="ident" id="5447040">s</span><span class="op" id="5447041">.</span><span class="ident" id="5447042">Init</span><span class="op" id="5447046">,</span>&nbsp;<span class="builtintype" id="5447048">false</span><span class="op" id="5447053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447058">p</span><span class="op" id="5447059">.</span><span class="builtinfunc" id="5447060">print</span><span class="op" id="5447065">(</span><span class="ident" id="5447066">token</span><span class="op" id="5447071">.</span><span class="ident" id="5447072">SEMICOLON</span><span class="op" id="5447081">)</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447089">p</span><span class="op" id="5447090">.</span><span class="builtinfunc" id="5447091">print</span><span class="op" id="5447096">(</span><span class="ident" id="5447097">blank</span><span class="op" id="5447102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447106">p</span><span class="op" id="5447107">.</span><span class="ident" id="5447108">stmt</span><span class="op" id="5447112">(</span><span class="ident" id="5447113">s</span><span class="op" id="5447114">.</span><span class="ident" id="5447115">Assign</span><span class="op" id="5447121">,</span>&nbsp;<span class="builtintype" id="5447123">false</span><span class="op" id="5447128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447132">p</span><span class="op" id="5447133">.</span><span class="builtinfunc" id="5447134">print</span><span class="op" id="5447139">(</span><span class="ident" id="5447140">blank</span><span class="op" id="5447145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447149">p</span><span class="op" id="5447150">.</span><span class="ident" id="5447151">block</span><span class="op" id="5447156">(</span><span class="ident" id="5447157">s</span><span class="op" id="5447158">.</span><span class="ident" id="5447159">Body</span><span class="op" id="5447163">,</span>&nbsp;<span class="num" id="5447165">0</span><span class="op" id="5447166">)</span><br>
<span class="lineno">1195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447170">case</span>&nbsp;<span class="op" id="5447175">*</span><span class="ident" id="5447176">ast</span><span class="op" id="5447179">.</span><span class="ident" id="5447180">CommClause</span><span class="op" id="5447190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447194">if</span>&nbsp;<span class="ident" id="5447197">s</span><span class="op" id="5447198">.</span><span class="ident" id="5447199">Comm</span>&nbsp;<span class="op" id="5447204">!=</span>&nbsp;<span class="ident" id="5447207">nil</span>&nbsp;<span class="op" id="5447211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447216">p</span><span class="op" id="5447217">.</span><span class="builtinfunc" id="5447218">print</span><span class="op" id="5447223">(</span><span class="ident" id="5447224">token</span><span class="op" id="5447229">.</span><span class="ident" id="5447230">CASE</span><span class="op" id="5447234">,</span>&nbsp;<span class="ident" id="5447236">blank</span><span class="op" id="5447241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447246">p</span><span class="op" id="5447247">.</span><span class="ident" id="5447248">stmt</span><span class="op" id="5447252">(</span><span class="ident" id="5447253">s</span><span class="op" id="5447254">.</span><span class="ident" id="5447255">Comm</span><span class="op" id="5447259">,</span>&nbsp;<span class="builtintype" id="5447261">false</span><span class="op" id="5447266">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447270">}</span>&nbsp;<span class="keyword" id="5447272">else</span>&nbsp;<span class="op" id="5447277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447282">p</span><span class="op" id="5447283">.</span><span class="builtinfunc" id="5447284">print</span><span class="op" id="5447289">(</span><span class="ident" id="5447290">token</span><span class="op" id="5447295">.</span><span class="ident" id="5447296">DEFAULT</span><span class="op" id="5447303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447311">p</span><span class="op" id="5447312">.</span><span class="builtinfunc" id="5447313">print</span><span class="op" id="5447318">(</span><span class="ident" id="5447319">s</span><span class="op" id="5447320">.</span><span class="ident" id="5447321">Colon</span><span class="op" id="5447326">,</span>&nbsp;<span class="ident" id="5447328">token</span><span class="op" id="5447333">.</span><span class="ident" id="5447334">COLON</span><span class="op" id="5447339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447343">p</span><span class="op" id="5447344">.</span><span class="ident" id="5447345">stmtList</span><span class="op" id="5447353">(</span><span class="ident" id="5447354">s</span><span class="op" id="5447355">.</span><span class="ident" id="5447356">Body</span><span class="op" id="5447360">,</span>&nbsp;<span class="num" id="5447362">1</span><span class="op" id="5447363">,</span>&nbsp;<span class="ident" id="5447365">nextIsRBrace</span><span class="op" id="5447377">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447381">case</span>&nbsp;<span class="op" id="5447386">*</span><span class="ident" id="5447387">ast</span><span class="op" id="5447390">.</span><span class="ident" id="5447391">SelectStmt</span><span class="op" id="5447401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447405">p</span><span class="op" id="5447406">.</span><span class="builtinfunc" id="5447407">print</span><span class="op" id="5447412">(</span><span class="ident" id="5447413">token</span><span class="op" id="5447418">.</span><span class="ident" id="5447419">SELECT</span><span class="op" id="5447425">,</span>&nbsp;<span class="ident" id="5447427">blank</span><span class="op" id="5447432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447436">body</span>&nbsp;<span class="op" id="5447441">:=</span>&nbsp;<span class="ident" id="5447444">s</span><span class="op" id="5447445">.</span><span class="ident" id="5447446">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447453">if</span>&nbsp;<span class="builtinfunc" id="5447456">len</span><span class="op" id="5447459">(</span><span class="ident" id="5447460">body</span><span class="op" id="5447464">.</span><span class="ident" id="5447465">List</span><span class="op" id="5447469">)</span>&nbsp;<span class="op" id="5447471">==</span>&nbsp;<span class="num" id="5447474">0</span>&nbsp;<span class="op" id="5447476">&amp;&amp;</span>&nbsp;<span class="op" id="5447479">!</span><span class="ident" id="5447480">p</span><span class="op" id="5447481">.</span><span class="ident" id="5447482">commentBefore</span><span class="op" id="5447495">(</span><span class="ident" id="5447496">p</span><span class="op" id="5447497">.</span><span class="ident" id="5447498">posFor</span><span class="op" id="5447504">(</span><span class="ident" id="5447505">body</span><span class="op" id="5447509">.</span><span class="ident" id="5447510">Rbrace</span><span class="op" id="5447516">)</span><span class="op" id="5447517">)</span>&nbsp;<span class="op" id="5447519">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447524">//&nbsp;print&nbsp;empty&nbsp;select&nbsp;statement&nbsp;w/o&nbsp;comments&nbsp;on&nbsp;one&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447584">p</span><span class="op" id="5447585">.</span><span class="builtinfunc" id="5447586">print</span><span class="op" id="5447591">(</span><span class="ident" id="5447592">body</span><span class="op" id="5447596">.</span><span class="ident" id="5447597">Lbrace</span><span class="op" id="5447603">,</span>&nbsp;<span class="ident" id="5447605">token</span><span class="op" id="5447610">.</span><span class="ident" id="5447611">LBRACE</span><span class="op" id="5447617">,</span>&nbsp;<span class="ident" id="5447619">body</span><span class="op" id="5447623">.</span><span class="ident" id="5447624">Rbrace</span><span class="op" id="5447630">,</span>&nbsp;<span class="ident" id="5447632">token</span><span class="op" id="5447637">.</span><span class="ident" id="5447638">RBRACE</span><span class="op" id="5447644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447648">}</span>&nbsp;<span class="keyword" id="5447650">else</span>&nbsp;<span class="op" id="5447655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447660">p</span><span class="op" id="5447661">.</span><span class="ident" id="5447662">block</span><span class="op" id="5447667">(</span><span class="ident" id="5447668">body</span><span class="op" id="5447672">,</span>&nbsp;<span class="num" id="5447674">0</span><span class="op" id="5447675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447679">}</span><br>
<span class="lineno">1215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447683">case</span>&nbsp;<span class="op" id="5447688">*</span><span class="ident" id="5447689">ast</span><span class="op" id="5447692">.</span><span class="ident" id="5447693">ForStmt</span><span class="op" id="5447700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447704">p</span><span class="op" id="5447705">.</span><span class="builtinfunc" id="5447706">print</span><span class="op" id="5447711">(</span><span class="ident" id="5447712">token</span><span class="op" id="5447717">.</span><span class="ident" id="5447718">FOR</span><span class="op" id="5447721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447725">p</span><span class="op" id="5447726">.</span><span class="ident" id="5447727">controlClause</span><span class="op" id="5447740">(</span><span class="builtintype" id="5447741">true</span><span class="op" id="5447745">,</span>&nbsp;<span class="ident" id="5447747">s</span><span class="op" id="5447748">.</span><span class="ident" id="5447749">Init</span><span class="op" id="5447753">,</span>&nbsp;<span class="ident" id="5447755">s</span><span class="op" id="5447756">.</span><span class="ident" id="5447757">Cond</span><span class="op" id="5447761">,</span>&nbsp;<span class="ident" id="5447763">s</span><span class="op" id="5447764">.</span><span class="ident" id="5447765">Post</span><span class="op" id="5447769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447773">p</span><span class="op" id="5447774">.</span><span class="ident" id="5447775">block</span><span class="op" id="5447780">(</span><span class="ident" id="5447781">s</span><span class="op" id="5447782">.</span><span class="ident" id="5447783">Body</span><span class="op" id="5447787">,</span>&nbsp;<span class="num" id="5447789">1</span><span class="op" id="5447790">)</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447794">case</span>&nbsp;<span class="op" id="5447799">*</span><span class="ident" id="5447800">ast</span><span class="op" id="5447803">.</span><span class="ident" id="5447804">RangeStmt</span><span class="op" id="5447813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447817">p</span><span class="op" id="5447818">.</span><span class="builtinfunc" id="5447819">print</span><span class="op" id="5447824">(</span><span class="ident" id="5447825">token</span><span class="op" id="5447830">.</span><span class="ident" id="5447831">FOR</span><span class="op" id="5447834">,</span>&nbsp;<span class="ident" id="5447836">blank</span><span class="op" id="5447841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447845">if</span>&nbsp;<span class="ident" id="5447848">s</span><span class="op" id="5447849">.</span><span class="ident" id="5447850">Key</span>&nbsp;<span class="op" id="5447854">!=</span>&nbsp;<span class="ident" id="5447857">nil</span>&nbsp;<span class="op" id="5447861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447866">p</span><span class="op" id="5447867">.</span><span class="ident" id="5447868">expr</span><span class="op" id="5447872">(</span><span class="ident" id="5447873">s</span><span class="op" id="5447874">.</span><span class="ident" id="5447875">Key</span><span class="op" id="5447878">)</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447883">if</span>&nbsp;<span class="ident" id="5447886">s</span><span class="op" id="5447887">.</span><span class="ident" id="5447888">Value</span>&nbsp;<span class="op" id="5447894">!=</span>&nbsp;<span class="ident" id="5447897">nil</span>&nbsp;<span class="op" id="5447901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447907">//&nbsp;use&nbsp;position&nbsp;of&nbsp;value&nbsp;following&nbsp;the&nbsp;comma&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447959">//&nbsp;comma&nbsp;position&nbsp;for&nbsp;correct&nbsp;comment&nbsp;placement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448011">p</span><span class="op" id="5448012">.</span><span class="builtinfunc" id="5448013">print</span><span class="op" id="5448018">(</span><span class="ident" id="5448019">s</span><span class="op" id="5448020">.</span><span class="ident" id="5448021">Value</span><span class="op" id="5448026">.</span><span class="ident" id="5448027">Pos</span><span class="op" id="5448030">(</span><span class="op" id="5448031">)</span><span class="op" id="5448032">,</span>&nbsp;<span class="ident" id="5448034">token</span><span class="op" id="5448039">.</span><span class="ident" id="5448040">COMMA</span><span class="op" id="5448045">,</span>&nbsp;<span class="ident" id="5448047">blank</span><span class="op" id="5448052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448058">p</span><span class="op" id="5448059">.</span><span class="ident" id="5448060">expr</span><span class="op" id="5448064">(</span><span class="ident" id="5448065">s</span><span class="op" id="5448066">.</span><span class="ident" id="5448067">Value</span><span class="op" id="5448072">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448082">p</span><span class="op" id="5448083">.</span><span class="builtinfunc" id="5448084">print</span><span class="op" id="5448089">(</span><span class="ident" id="5448090">blank</span><span class="op" id="5448095">,</span>&nbsp;<span class="ident" id="5448097">s</span><span class="op" id="5448098">.</span><span class="ident" id="5448099">TokPos</span><span class="op" id="5448105">,</span>&nbsp;<span class="ident" id="5448107">s</span><span class="op" id="5448108">.</span><span class="ident" id="5448109">Tok</span><span class="op" id="5448112">,</span>&nbsp;<span class="ident" id="5448114">blank</span><span class="op" id="5448119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448127">p</span><span class="op" id="5448128">.</span><span class="builtinfunc" id="5448129">print</span><span class="op" id="5448134">(</span><span class="ident" id="5448135">token</span><span class="op" id="5448140">.</span><span class="ident" id="5448141">RANGE</span><span class="op" id="5448146">,</span>&nbsp;<span class="ident" id="5448148">blank</span><span class="op" id="5448153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448157">p</span><span class="op" id="5448158">.</span><span class="ident" id="5448159">expr</span><span class="op" id="5448163">(</span><span class="ident" id="5448164">stripParens</span><span class="op" id="5448175">(</span><span class="ident" id="5448176">s</span><span class="op" id="5448177">.</span><span class="ident" id="5448178">X</span><span class="op" id="5448179">)</span><span class="op" id="5448180">)</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448184">p</span><span class="op" id="5448185">.</span><span class="builtinfunc" id="5448186">print</span><span class="op" id="5448191">(</span><span class="ident" id="5448192">blank</span><span class="op" id="5448197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448201">p</span><span class="op" id="5448202">.</span><span class="ident" id="5448203">block</span><span class="op" id="5448208">(</span><span class="ident" id="5448209">s</span><span class="op" id="5448210">.</span><span class="ident" id="5448211">Body</span><span class="op" id="5448215">,</span>&nbsp;<span class="num" id="5448217">1</span><span class="op" id="5448218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448222">default</span><span class="op" id="5448229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5448233">panic</span><span class="op" id="5448238">(</span><span class="string" id="5448239">&#34;unreachable&#34;</span><span class="op" id="5448252">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448259">return</span><br>
<span class="lineno"></span><span class="op" id="5448266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1245</span><span class="comment" id="5448269">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5448349">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5448366">//&nbsp;The&nbsp;keepTypeColumn&nbsp;function&nbsp;determines&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;of&nbsp;a&nbsp;series&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5448442">//&nbsp;consecutive&nbsp;const&nbsp;or&nbsp;var&nbsp;declarations&nbsp;must&nbsp;be&nbsp;kept,&nbsp;or&nbsp;if&nbsp;initialization</span><br>
<span class="lineno">1250</span><span class="comment" id="5448518">//&nbsp;values&nbsp;(V)&nbsp;can&nbsp;be&nbsp;placed&nbsp;in&nbsp;the&nbsp;type&nbsp;column&nbsp;(T)&nbsp;instead.&nbsp;The&nbsp;i&#39;th&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5448593">//&nbsp;in&nbsp;the&nbsp;result&nbsp;slice&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;in&nbsp;spec[i]&nbsp;must&nbsp;be&nbsp;kept.</span><br>
<span class="lineno"></span><span class="comment" id="5448668">//</span><br>
<span class="lineno"></span><span class="comment" id="5448671">//&nbsp;For&nbsp;example,&nbsp;the&nbsp;declaration:</span><br>
<span class="lineno"></span><span class="comment" id="5448704">//</span><br>
<span class="lineno">1255</span><span class="comment" id="5448707">//&nbsp;&nbsp;&nbsp;&nbspconst&nbsp;(</span><br>
<span class="lineno"></span><span class="comment" id="5448718">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfoobar&nbsp;int&nbsp;=&nbsp;42&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5448749">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;7&nbsp;&nbsp;//&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5448780">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfoo</span><br>
<span class="lineno"></span><span class="comment" id="5448788">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bar&nbsp;=&nbsp;991</span><br>
<span class="lineno">1260</span><span class="comment" id="5448814">//&nbsp;&nbsp;&nbsp;&nbsp)</span><br>
<span class="lineno"></span><span class="comment" id="5448819">//</span><br>
<span class="lineno"></span><span class="comment" id="5448822">//&nbsp;leads&nbsp;to&nbsp;the&nbsp;type/values&nbsp;matrix&nbsp;below.&nbsp;A&nbsp;run&nbsp;of&nbsp;value&nbsp;columns&nbsp;(V)&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5448895">//&nbsp;be&nbsp;moved&nbsp;into&nbsp;the&nbsp;type&nbsp;column&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;type&nbsp;for&nbsp;any&nbsp;of&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5448970">//&nbsp;in&nbsp;that&nbsp;column&nbsp;(we&nbsp;only&nbsp;move&nbsp;entire&nbsp;columns&nbsp;so&nbsp;that&nbsp;they&nbsp;align&nbsp;properly).</span><br>
<span class="lineno">1265</span><span class="comment" id="5449047">//</span><br>
<span class="lineno"></span><span class="comment" id="5449050">//&nbsp;&nbsp;&nbsp;&nbspmatrix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatted&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="5449088">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matrix</span><br>
<span class="lineno"></span><span class="comment" id="5449117">//&nbsp;&nbsp;&nbsp;&nbspT&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;a&nbsp;T&nbsp;and&nbsp;so&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5449187">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno">1270</span><span class="comment" id="5449248">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="5449285">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;is&nbsp;moved&nbsp;into&nbsp;T&nbsp;column</span><br>
<span class="lineno"></span><span class="comment" id="5449351">//</span><br>
<span class="lineno"></span><span class="keyword" id="5449354">func</span>&nbsp;<span class="ident" id="5449359">keepTypeColumn</span><span class="op" id="5449373">(</span><span class="ident" id="5449374">specs</span>&nbsp;<span class="op" id="5449380">[</span><span class="op" id="5449381">]</span><span class="ident" id="5449382">ast</span><span class="op" id="5449385">.</span><span class="ident" id="5449386">Spec</span><span class="op" id="5449390">)</span>&nbsp;<span class="op" id="5449392">[</span><span class="op" id="5449393">]</span><span class="builtintype" id="5449394">bool</span>&nbsp;<span class="op" id="5449399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449402">m</span>&nbsp;<span class="op" id="5449404">:=</span>&nbsp;<span class="builtinfunc" id="5449407">make</span><span class="op" id="5449411">(</span><span class="op" id="5449412">[</span><span class="op" id="5449413">]</span><span class="builtintype" id="5449414">bool</span><span class="op" id="5449418">,</span>&nbsp;<span class="builtinfunc" id="5449420">len</span><span class="op" id="5449423">(</span><span class="ident" id="5449424">specs</span><span class="op" id="5449429">)</span><span class="op" id="5449430">)</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449434">populate</span>&nbsp;<span class="op" id="5449443">:=</span>&nbsp;<span class="keyword" id="5449446">func</span><span class="op" id="5449450">(</span><span class="ident" id="5449451">i</span><span class="op" id="5449452">,</span>&nbsp;<span class="ident" id="5449454">j</span>&nbsp;<span class="builtintype" id="5449456">int</span><span class="op" id="5449459">,</span>&nbsp;<span class="ident" id="5449461">keepType</span>&nbsp;<span class="builtintype" id="5449470">bool</span><span class="op" id="5449474">)</span>&nbsp;<span class="op" id="5449476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449480">if</span>&nbsp;<span class="ident" id="5449483">keepType</span>&nbsp;<span class="op" id="5449492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449497">for</span>&nbsp;<span class="op" id="5449501">;</span>&nbsp;<span class="ident" id="5449503">i</span>&nbsp;<span class="op" id="5449505">&lt;</span>&nbsp;<span class="ident" id="5449507">j</span><span class="op" id="5449508">;</span>&nbsp;<span class="ident" id="5449510">i</span><span class="op" id="5449511">++</span>&nbsp;<span class="op" id="5449514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449520">m</span><span class="op" id="5449521">[</span><span class="ident" id="5449522">i</span><span class="op" id="5449523">]</span>&nbsp;<span class="op" id="5449525">=</span>&nbsp;<span class="builtintype" id="5449527">true</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449546">i0</span>&nbsp;<span class="op" id="5449549">:=</span>&nbsp;<span class="op" id="5449552">-</span><span class="num" id="5449553">1</span>&nbsp;<span class="comment" id="5449555">//&nbsp;if&nbsp;i0&nbsp;&gt;=&nbsp;0&nbsp;we&nbsp;are&nbsp;in&nbsp;a&nbsp;run&nbsp;and&nbsp;i0&nbsp;is&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;run</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449617">var</span>&nbsp;<span class="ident" id="5449621">keepType</span>&nbsp;<span class="builtintype" id="5449630">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449636">for</span>&nbsp;<span class="ident" id="5449640">i</span><span class="op" id="5449641">,</span>&nbsp;<span class="ident" id="5449643">s</span>&nbsp;<span class="op" id="5449645">:=</span>&nbsp;<span class="keyword" id="5449648">range</span>&nbsp;<span class="ident" id="5449654">specs</span>&nbsp;<span class="op" id="5449660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449664">t</span>&nbsp;<span class="op" id="5449666">:=</span>&nbsp;<span class="ident" id="5449669">s</span><span class="op" id="5449670">.</span><span class="op" id="5449671">(</span><span class="op" id="5449672">*</span><span class="ident" id="5449673">ast</span><span class="op" id="5449676">.</span><span class="ident" id="5449677">ValueSpec</span><span class="op" id="5449686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449690">if</span>&nbsp;<span class="ident" id="5449693">t</span><span class="op" id="5449694">.</span><span class="ident" id="5449695">Values</span>&nbsp;<span class="op" id="5449702">!=</span>&nbsp;<span class="ident" id="5449705">nil</span>&nbsp;<span class="op" id="5449709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449714">if</span>&nbsp;<span class="ident" id="5449717">i0</span>&nbsp;<span class="op" id="5449720">&lt;</span>&nbsp;<span class="num" id="5449722">0</span>&nbsp;<span class="op" id="5449724">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449730">//&nbsp;start&nbsp;of&nbsp;a&nbsp;run&nbsp;of&nbsp;ValueSpecs&nbsp;with&nbsp;non-nil&nbsp;Values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449786">i0</span>&nbsp;<span class="op" id="5449789">=</span>&nbsp;<span class="ident" id="5449791">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449797">keepType</span>&nbsp;<span class="op" id="5449806">=</span>&nbsp;<span class="builtintype" id="5449808">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449821">}</span>&nbsp;<span class="keyword" id="5449823">else</span>&nbsp;<span class="op" id="5449828">{</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449833">if</span>&nbsp;<span class="ident" id="5449836">i0</span>&nbsp;<span class="op" id="5449839">&gt;=</span>&nbsp;<span class="num" id="5449842">0</span>&nbsp;<span class="op" id="5449844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449850">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449870">populate</span><span class="op" id="5449878">(</span><span class="ident" id="5449879">i0</span><span class="op" id="5449881">,</span>&nbsp;<span class="ident" id="5449883">i</span><span class="op" id="5449884">,</span>&nbsp;<span class="ident" id="5449886">keepType</span><span class="op" id="5449894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449900">i0</span>&nbsp;<span class="op" id="5449903">=</span>&nbsp;<span class="op" id="5449905">-</span><span class="num" id="5449906">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449911">}</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449919">if</span>&nbsp;<span class="ident" id="5449922">t</span><span class="op" id="5449923">.</span><span class="ident" id="5449924">Type</span>&nbsp;<span class="op" id="5449929">!=</span>&nbsp;<span class="ident" id="5449932">nil</span>&nbsp;<span class="op" id="5449936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449941">keepType</span>&nbsp;<span class="op" id="5449950">=</span>&nbsp;<span class="builtintype" id="5449952">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449962">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449965">if</span>&nbsp;<span class="ident" id="5449968">i0</span>&nbsp;<span class="op" id="5449971">&gt;=</span>&nbsp;<span class="num" id="5449974">0</span>&nbsp;<span class="op" id="5449976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449980">//&nbsp;end&nbsp;of&nbsp;a&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449998">populate</span><span class="op" id="5450006">(</span><span class="ident" id="5450007">i0</span><span class="op" id="5450009">,</span>&nbsp;<span class="builtinfunc" id="5450011">len</span><span class="op" id="5450014">(</span><span class="ident" id="5450015">specs</span><span class="op" id="5450020">)</span><span class="op" id="5450021">,</span>&nbsp;<span class="ident" id="5450023">keepType</span><span class="op" id="5450031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450038">return</span>&nbsp;<span class="ident" id="5450045">m</span><br>
<span class="lineno"></span><span class="op" id="5450047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450050">func</span>&nbsp;<span class="op" id="5450055">(</span><span class="ident" id="5450056">p</span>&nbsp;<span class="op" id="5450058">*</span><span class="ident" id="5450059">printer</span><span class="op" id="5450066">)</span>&nbsp;<span class="ident" id="5450068">valueSpec</span><span class="op" id="5450077">(</span><span class="ident" id="5450078">s</span>&nbsp;<span class="op" id="5450080">*</span><span class="ident" id="5450081">ast</span><span class="op" id="5450084">.</span><span class="ident" id="5450085">ValueSpec</span><span class="op" id="5450094">,</span>&nbsp;<span class="ident" id="5450096">keepType</span>&nbsp;<span class="builtintype" id="5450105">bool</span><span class="op" id="5450109">)</span>&nbsp;<span class="op" id="5450111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450114">p</span><span class="op" id="5450115">.</span><span class="ident" id="5450116">setComment</span><span class="op" id="5450126">(</span><span class="ident" id="5450127">s</span><span class="op" id="5450128">.</span><span class="ident" id="5450129">Doc</span><span class="op" id="5450132">)</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450135">p</span><span class="op" id="5450136">.</span><span class="ident" id="5450137">identList</span><span class="op" id="5450146">(</span><span class="ident" id="5450147">s</span><span class="op" id="5450148">.</span><span class="ident" id="5450149">Names</span><span class="op" id="5450154">,</span>&nbsp;<span class="builtintype" id="5450156">false</span><span class="op" id="5450161">)</span>&nbsp;<span class="comment" id="5450163">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450182">extraTabs</span>&nbsp;<span class="op" id="5450192">:=</span>&nbsp;<span class="num" id="5450195">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450198">if</span>&nbsp;<span class="ident" id="5450201">s</span><span class="op" id="5450202">.</span><span class="ident" id="5450203">Type</span>&nbsp;<span class="op" id="5450208">!=</span>&nbsp;<span class="ident" id="5450211">nil</span>&nbsp;<span class="op" id="5450215">||</span>&nbsp;<span class="ident" id="5450218">keepType</span>&nbsp;<span class="op" id="5450227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450231">p</span><span class="op" id="5450232">.</span><span class="builtinfunc" id="5450233">print</span><span class="op" id="5450238">(</span><span class="ident" id="5450239">vtab</span><span class="op" id="5450243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450247">extraTabs</span><span class="op" id="5450256">--</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450263">if</span>&nbsp;<span class="ident" id="5450266">s</span><span class="op" id="5450267">.</span><span class="ident" id="5450268">Type</span>&nbsp;<span class="op" id="5450273">!=</span>&nbsp;<span class="ident" id="5450276">nil</span>&nbsp;<span class="op" id="5450280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450284">p</span><span class="op" id="5450285">.</span><span class="ident" id="5450286">expr</span><span class="op" id="5450290">(</span><span class="ident" id="5450291">s</span><span class="op" id="5450292">.</span><span class="ident" id="5450293">Type</span><span class="op" id="5450297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450303">if</span>&nbsp;<span class="ident" id="5450306">s</span><span class="op" id="5450307">.</span><span class="ident" id="5450308">Values</span>&nbsp;<span class="op" id="5450315">!=</span>&nbsp;<span class="ident" id="5450318">nil</span>&nbsp;<span class="op" id="5450322">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450326">p</span><span class="op" id="5450327">.</span><span class="builtinfunc" id="5450328">print</span><span class="op" id="5450333">(</span><span class="ident" id="5450334">vtab</span><span class="op" id="5450338">,</span>&nbsp;<span class="ident" id="5450340">token</span><span class="op" id="5450345">.</span><span class="ident" id="5450346">ASSIGN</span><span class="op" id="5450352">,</span>&nbsp;<span class="ident" id="5450354">blank</span><span class="op" id="5450359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450363">p</span><span class="op" id="5450364">.</span><span class="ident" id="5450365">exprList</span><span class="op" id="5450373">(</span><span class="ident" id="5450374">token</span><span class="op" id="5450379">.</span><span class="ident" id="5450380">NoPos</span><span class="op" id="5450385">,</span>&nbsp;<span class="ident" id="5450387">s</span><span class="op" id="5450388">.</span><span class="ident" id="5450389">Values</span><span class="op" id="5450395">,</span>&nbsp;<span class="num" id="5450397">1</span><span class="op" id="5450398">,</span>&nbsp;<span class="num" id="5450400">0</span><span class="op" id="5450401">,</span>&nbsp;<span class="ident" id="5450403">token</span><span class="op" id="5450408">.</span><span class="ident" id="5450409">NoPos</span><span class="op" id="5450414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450418">extraTabs</span><span class="op" id="5450427">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450434">if</span>&nbsp;<span class="ident" id="5450437">s</span><span class="op" id="5450438">.</span><span class="ident" id="5450439">Comment</span>&nbsp;<span class="op" id="5450447">!=</span>&nbsp;<span class="ident" id="5450450">nil</span>&nbsp;<span class="op" id="5450454">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450458">for</span>&nbsp;<span class="op" id="5450462">;</span>&nbsp;<span class="ident" id="5450464">extraTabs</span>&nbsp;<span class="op" id="5450474">&gt;</span>&nbsp;<span class="num" id="5450476">0</span><span class="op" id="5450477">;</span>&nbsp;<span class="ident" id="5450479">extraTabs</span><span class="op" id="5450488">--</span>&nbsp;<span class="op" id="5450491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450496">p</span><span class="op" id="5450497">.</span><span class="builtinfunc" id="5450498">print</span><span class="op" id="5450503">(</span><span class="ident" id="5450504">vtab</span><span class="op" id="5450508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450516">p</span><span class="op" id="5450517">.</span><span class="ident" id="5450518">setComment</span><span class="op" id="5450528">(</span><span class="ident" id="5450529">s</span><span class="op" id="5450530">.</span><span class="ident" id="5450531">Comment</span><span class="op" id="5450538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450541">}</span><br>
<span class="lineno">1335</span><span class="op" id="5450543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450546">//&nbsp;The&nbsp;parameter&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;specs&nbsp;in&nbsp;the&nbsp;group.&nbsp;If&nbsp;doIndent&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5450622">//&nbsp;multi-line&nbsp;identifier&nbsp;lists&nbsp;in&nbsp;the&nbsp;spec&nbsp;are&nbsp;indented&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5450693">//&nbsp;linebreak&nbsp;is&nbsp;encountered.</span><br>
<span class="lineno">1340</span><span class="comment" id="5450722">//</span><br>
<span class="lineno"></span><span class="keyword" id="5450725">func</span>&nbsp;<span class="op" id="5450730">(</span><span class="ident" id="5450731">p</span>&nbsp;<span class="op" id="5450733">*</span><span class="ident" id="5450734">printer</span><span class="op" id="5450741">)</span>&nbsp;<span class="ident" id="5450743">spec</span><span class="op" id="5450747">(</span><span class="ident" id="5450748">spec</span>&nbsp;<span class="ident" id="5450753">ast</span><span class="op" id="5450756">.</span><span class="ident" id="5450757">Spec</span><span class="op" id="5450761">,</span>&nbsp;<span class="ident" id="5450763">n</span>&nbsp;<span class="builtintype" id="5450765">int</span><span class="op" id="5450768">,</span>&nbsp;<span class="ident" id="5450770">doIndent</span>&nbsp;<span class="builtintype" id="5450779">bool</span><span class="op" id="5450783">)</span>&nbsp;<span class="op" id="5450785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450788">switch</span>&nbsp;<span class="ident" id="5450795">s</span>&nbsp;<span class="op" id="5450797">:=</span>&nbsp;<span class="ident" id="5450800">spec</span><span class="op" id="5450804">.</span><span class="op" id="5450805">(</span><span class="keyword" id="5450806">type</span><span class="op" id="5450810">)</span>&nbsp;<span class="op" id="5450812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450815">case</span>&nbsp;<span class="op" id="5450820">*</span><span class="ident" id="5450821">ast</span><span class="op" id="5450824">.</span><span class="ident" id="5450825">ImportSpec</span><span class="op" id="5450835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450839">p</span><span class="op" id="5450840">.</span><span class="ident" id="5450841">setComment</span><span class="op" id="5450851">(</span><span class="ident" id="5450852">s</span><span class="op" id="5450853">.</span><span class="ident" id="5450854">Doc</span><span class="op" id="5450857">)</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450861">if</span>&nbsp;<span class="ident" id="5450864">s</span><span class="op" id="5450865">.</span><span class="ident" id="5450866">Name</span>&nbsp;<span class="op" id="5450871">!=</span>&nbsp;<span class="ident" id="5450874">nil</span>&nbsp;<span class="op" id="5450878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450883">p</span><span class="op" id="5450884">.</span><span class="ident" id="5450885">expr</span><span class="op" id="5450889">(</span><span class="ident" id="5450890">s</span><span class="op" id="5450891">.</span><span class="ident" id="5450892">Name</span><span class="op" id="5450896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450901">p</span><span class="op" id="5450902">.</span><span class="builtinfunc" id="5450903">print</span><span class="op" id="5450908">(</span><span class="ident" id="5450909">blank</span><span class="op" id="5450914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450922">p</span><span class="op" id="5450923">.</span><span class="ident" id="5450924">expr</span><span class="op" id="5450928">(</span><span class="ident" id="5450929">s</span><span class="op" id="5450930">.</span><span class="ident" id="5450931">Path</span><span class="op" id="5450935">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450939">p</span><span class="op" id="5450940">.</span><span class="ident" id="5450941">setComment</span><span class="op" id="5450951">(</span><span class="ident" id="5450952">s</span><span class="op" id="5450953">.</span><span class="ident" id="5450954">Comment</span><span class="op" id="5450961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450965">p</span><span class="op" id="5450966">.</span><span class="builtinfunc" id="5450967">print</span><span class="op" id="5450972">(</span><span class="ident" id="5450973">s</span><span class="op" id="5450974">.</span><span class="ident" id="5450975">EndPos</span><span class="op" id="5450981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450985">case</span>&nbsp;<span class="op" id="5450990">*</span><span class="ident" id="5450991">ast</span><span class="op" id="5450994">.</span><span class="ident" id="5450995">ValueSpec</span><span class="op" id="5451004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451008">if</span>&nbsp;<span class="ident" id="5451011">n</span>&nbsp;<span class="op" id="5451013">!=</span>&nbsp;<span class="num" id="5451016">1</span>&nbsp;<span class="op" id="5451018">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451023">p</span><span class="op" id="5451024">.</span><span class="ident" id="5451025">internalError</span><span class="op" id="5451038">(</span><span class="string" id="5451039">&#34;expected&nbsp;n&nbsp;=&nbsp;1;&nbsp;got&#34;</span><span class="op" id="5451060">,</span>&nbsp;<span class="ident" id="5451062">n</span><span class="op" id="5451063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451071">p</span><span class="op" id="5451072">.</span><span class="ident" id="5451073">setComment</span><span class="op" id="5451083">(</span><span class="ident" id="5451084">s</span><span class="op" id="5451085">.</span><span class="ident" id="5451086">Doc</span><span class="op" id="5451089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451093">p</span><span class="op" id="5451094">.</span><span class="ident" id="5451095">identList</span><span class="op" id="5451104">(</span><span class="ident" id="5451105">s</span><span class="op" id="5451106">.</span><span class="ident" id="5451107">Names</span><span class="op" id="5451112">,</span>&nbsp;<span class="ident" id="5451114">doIndent</span><span class="op" id="5451122">)</span>&nbsp;<span class="comment" id="5451124">//&nbsp;always&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451144">if</span>&nbsp;<span class="ident" id="5451147">s</span><span class="op" id="5451148">.</span><span class="ident" id="5451149">Type</span>&nbsp;<span class="op" id="5451154">!=</span>&nbsp;<span class="ident" id="5451157">nil</span>&nbsp;<span class="op" id="5451161">{</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451166">p</span><span class="op" id="5451167">.</span><span class="builtinfunc" id="5451168">print</span><span class="op" id="5451173">(</span><span class="ident" id="5451174">blank</span><span class="op" id="5451179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451184">p</span><span class="op" id="5451185">.</span><span class="ident" id="5451186">expr</span><span class="op" id="5451190">(</span><span class="ident" id="5451191">s</span><span class="op" id="5451192">.</span><span class="ident" id="5451193">Type</span><span class="op" id="5451197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451205">if</span>&nbsp;<span class="ident" id="5451208">s</span><span class="op" id="5451209">.</span><span class="ident" id="5451210">Values</span>&nbsp;<span class="op" id="5451217">!=</span>&nbsp;<span class="ident" id="5451220">nil</span>&nbsp;<span class="op" id="5451224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451229">p</span><span class="op" id="5451230">.</span><span class="builtinfunc" id="5451231">print</span><span class="op" id="5451236">(</span><span class="ident" id="5451237">blank</span><span class="op" id="5451242">,</span>&nbsp;<span class="ident" id="5451244">token</span><span class="op" id="5451249">.</span><span class="ident" id="5451250">ASSIGN</span><span class="op" id="5451256">,</span>&nbsp;<span class="ident" id="5451258">blank</span><span class="op" id="5451263">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451268">p</span><span class="op" id="5451269">.</span><span class="ident" id="5451270">exprList</span><span class="op" id="5451278">(</span><span class="ident" id="5451279">token</span><span class="op" id="5451284">.</span><span class="ident" id="5451285">NoPos</span><span class="op" id="5451290">,</span>&nbsp;<span class="ident" id="5451292">s</span><span class="op" id="5451293">.</span><span class="ident" id="5451294">Values</span><span class="op" id="5451300">,</span>&nbsp;<span class="num" id="5451302">1</span><span class="op" id="5451303">,</span>&nbsp;<span class="num" id="5451305">0</span><span class="op" id="5451306">,</span>&nbsp;<span class="ident" id="5451308">token</span><span class="op" id="5451313">.</span><span class="ident" id="5451314">NoPos</span><span class="op" id="5451319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451327">p</span><span class="op" id="5451328">.</span><span class="ident" id="5451329">setComment</span><span class="op" id="5451339">(</span><span class="ident" id="5451340">s</span><span class="op" id="5451341">.</span><span class="ident" id="5451342">Comment</span><span class="op" id="5451349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451353">case</span>&nbsp;<span class="op" id="5451358">*</span><span class="ident" id="5451359">ast</span><span class="op" id="5451362">.</span><span class="ident" id="5451363">TypeSpec</span><span class="op" id="5451371">:</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451375">p</span><span class="op" id="5451376">.</span><span class="ident" id="5451377">setComment</span><span class="op" id="5451387">(</span><span class="ident" id="5451388">s</span><span class="op" id="5451389">.</span><span class="ident" id="5451390">Doc</span><span class="op" id="5451393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451397">p</span><span class="op" id="5451398">.</span><span class="ident" id="5451399">expr</span><span class="op" id="5451403">(</span><span class="ident" id="5451404">s</span><span class="op" id="5451405">.</span><span class="ident" id="5451406">Name</span><span class="op" id="5451410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451414">if</span>&nbsp;<span class="ident" id="5451417">n</span>&nbsp;<span class="op" id="5451419">==</span>&nbsp;<span class="num" id="5451422">1</span>&nbsp;<span class="op" id="5451424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451429">p</span><span class="op" id="5451430">.</span><span class="builtinfunc" id="5451431">print</span><span class="op" id="5451436">(</span><span class="ident" id="5451437">blank</span><span class="op" id="5451442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451446">}</span>&nbsp;<span class="keyword" id="5451448">else</span>&nbsp;<span class="op" id="5451453">{</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451458">p</span><span class="op" id="5451459">.</span><span class="builtinfunc" id="5451460">print</span><span class="op" id="5451465">(</span><span class="ident" id="5451466">vtab</span><span class="op" id="5451470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451478">p</span><span class="op" id="5451479">.</span><span class="ident" id="5451480">expr</span><span class="op" id="5451484">(</span><span class="ident" id="5451485">s</span><span class="op" id="5451486">.</span><span class="ident" id="5451487">Type</span><span class="op" id="5451491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451495">p</span><span class="op" id="5451496">.</span><span class="ident" id="5451497">setComment</span><span class="op" id="5451507">(</span><span class="ident" id="5451508">s</span><span class="op" id="5451509">.</span><span class="ident" id="5451510">Comment</span><span class="op" id="5451517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451521">default</span><span class="op" id="5451528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5451532">panic</span><span class="op" id="5451537">(</span><span class="string" id="5451538">&#34;unreachable&#34;</span><span class="op" id="5451551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5451554">}</span><br>
<span class="lineno"></span><span class="op" id="5451556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1385</span><span class="keyword" id="5451559">func</span>&nbsp;<span class="op" id="5451564">(</span><span class="ident" id="5451565">p</span>&nbsp;<span class="op" id="5451567">*</span><span class="ident" id="5451568">printer</span><span class="op" id="5451575">)</span>&nbsp;<span class="ident" id="5451577">genDecl</span><span class="op" id="5451584">(</span><span class="ident" id="5451585">d</span>&nbsp;<span class="op" id="5451587">*</span><span class="ident" id="5451588">ast</span><span class="op" id="5451591">.</span><span class="ident" id="5451592">GenDecl</span><span class="op" id="5451599">)</span>&nbsp;<span class="op" id="5451601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451604">p</span><span class="op" id="5451605">.</span><span class="ident" id="5451606">setComment</span><span class="op" id="5451616">(</span><span class="ident" id="5451617">d</span><span class="op" id="5451618">.</span><span class="ident" id="5451619">Doc</span><span class="op" id="5451622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451625">p</span><span class="op" id="5451626">.</span><span class="builtinfunc" id="5451627">print</span><span class="op" id="5451632">(</span><span class="ident" id="5451633">d</span><span class="op" id="5451634">.</span><span class="ident" id="5451635">Pos</span><span class="op" id="5451638">(</span><span class="op" id="5451639">)</span><span class="op" id="5451640">,</span>&nbsp;<span class="ident" id="5451642">d</span><span class="op" id="5451643">.</span><span class="ident" id="5451644">Tok</span><span class="op" id="5451647">,</span>&nbsp;<span class="ident" id="5451649">blank</span><span class="op" id="5451654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451658">if</span>&nbsp;<span class="ident" id="5451661">d</span><span class="op" id="5451662">.</span><span class="ident" id="5451663">Lparen</span><span class="op" id="5451669">.</span><span class="ident" id="5451670">IsValid</span><span class="op" id="5451677">(</span><span class="op" id="5451678">)</span>&nbsp;<span class="op" id="5451680">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451684">//&nbsp;group&nbsp;of&nbsp;parenthesized&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451725">p</span><span class="op" id="5451726">.</span><span class="builtinfunc" id="5451727">print</span><span class="op" id="5451732">(</span><span class="ident" id="5451733">d</span><span class="op" id="5451734">.</span><span class="ident" id="5451735">Lparen</span><span class="op" id="5451741">,</span>&nbsp;<span class="ident" id="5451743">token</span><span class="op" id="5451748">.</span><span class="ident" id="5451749">LPAREN</span><span class="op" id="5451755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451759">if</span>&nbsp;<span class="ident" id="5451762">n</span>&nbsp;<span class="op" id="5451764">:=</span>&nbsp;<span class="builtinfunc" id="5451767">len</span><span class="op" id="5451770">(</span><span class="ident" id="5451771">d</span><span class="op" id="5451772">.</span><span class="ident" id="5451773">Specs</span><span class="op" id="5451778">)</span><span class="op" id="5451779">;</span>&nbsp;<span class="ident" id="5451781">n</span>&nbsp;<span class="op" id="5451783">&gt;</span>&nbsp;<span class="num" id="5451785">0</span>&nbsp;<span class="op" id="5451787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451792">p</span><span class="op" id="5451793">.</span><span class="builtinfunc" id="5451794">print</span><span class="op" id="5451799">(</span><span class="ident" id="5451800">indent</span><span class="op" id="5451806">,</span>&nbsp;<span class="ident" id="5451808">formfeed</span><span class="op" id="5451816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451821">if</span>&nbsp;<span class="ident" id="5451824">n</span>&nbsp;<span class="op" id="5451826">&gt;</span>&nbsp;<span class="num" id="5451828">1</span>&nbsp;<span class="op" id="5451830">&amp;&amp;</span>&nbsp;<span class="op" id="5451833">(</span><span class="ident" id="5451834">d</span><span class="op" id="5451835">.</span><span class="ident" id="5451836">Tok</span>&nbsp;<span class="op" id="5451840">==</span>&nbsp;<span class="ident" id="5451843">token</span><span class="op" id="5451848">.</span><span class="ident" id="5451849">CONST</span>&nbsp;<span class="op" id="5451855">||</span>&nbsp;<span class="ident" id="5451858">d</span><span class="op" id="5451859">.</span><span class="ident" id="5451860">Tok</span>&nbsp;<span class="op" id="5451864">==</span>&nbsp;<span class="ident" id="5451867">token</span><span class="op" id="5451872">.</span><span class="ident" id="5451873">VAR</span><span class="op" id="5451876">)</span>&nbsp;<span class="op" id="5451878">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451884">//&nbsp;two&nbsp;or&nbsp;more&nbsp;grouped&nbsp;const/var&nbsp;declarations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5451935">//&nbsp;determine&nbsp;if&nbsp;the&nbsp;type&nbsp;column&nbsp;must&nbsp;be&nbsp;kept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5451984">keepType</span>&nbsp;<span class="op" id="5451993">:=</span>&nbsp;<span class="ident" id="5451996">keepTypeColumn</span><span class="op" id="5452010">(</span><span class="ident" id="5452011">d</span><span class="op" id="5452012">.</span><span class="ident" id="5452013">Specs</span><span class="op" id="5452018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452024">var</span>&nbsp;<span class="ident" id="5452028">line</span>&nbsp;<span class="builtintype" id="5452033">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452041">for</span>&nbsp;<span class="ident" id="5452045">i</span><span class="op" id="5452046">,</span>&nbsp;<span class="ident" id="5452048">s</span>&nbsp;<span class="op" id="5452050">:=</span>&nbsp;<span class="keyword" id="5452053">range</span>&nbsp;<span class="ident" id="5452059">d</span><span class="op" id="5452060">.</span><span class="ident" id="5452061">Specs</span>&nbsp;<span class="op" id="5452067">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452074">if</span>&nbsp;<span class="ident" id="5452077">i</span>&nbsp;<span class="op" id="5452079">&gt;</span>&nbsp;<span class="num" id="5452081">0</span>&nbsp;<span class="op" id="5452083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452091">p</span><span class="op" id="5452092">.</span><span class="ident" id="5452093">linebreak</span><span class="op" id="5452102">(</span><span class="ident" id="5452103">p</span><span class="op" id="5452104">.</span><span class="ident" id="5452105">lineFor</span><span class="op" id="5452112">(</span><span class="ident" id="5452113">s</span><span class="op" id="5452114">.</span><span class="ident" id="5452115">Pos</span><span class="op" id="5452118">(</span><span class="op" id="5452119">)</span><span class="op" id="5452120">)</span><span class="op" id="5452121">,</span>&nbsp;<span class="num" id="5452123">1</span><span class="op" id="5452124">,</span>&nbsp;<span class="ident" id="5452126">ignore</span><span class="op" id="5452132">,</span>&nbsp;<span class="ident" id="5452134">p</span><span class="op" id="5452135">.</span><span class="ident" id="5452136">linesFrom</span><span class="op" id="5452145">(</span><span class="ident" id="5452146">line</span><span class="op" id="5452150">)</span>&nbsp;<span class="op" id="5452152">&gt;</span>&nbsp;<span class="num" id="5452154">0</span><span class="op" id="5452155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452169">p</span><span class="op" id="5452170">.</span><span class="ident" id="5452171">recordLine</span><span class="op" id="5452181">(</span><span class="op" id="5452182">&amp;</span><span class="ident" id="5452183">line</span><span class="op" id="5452187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452194">p</span><span class="op" id="5452195">.</span><span class="ident" id="5452196">valueSpec</span><span class="op" id="5452205">(</span><span class="ident" id="5452206">s</span><span class="op" id="5452207">.</span><span class="op" id="5452208">(</span><span class="op" id="5452209">*</span><span class="ident" id="5452210">ast</span><span class="op" id="5452213">.</span><span class="ident" id="5452214">ValueSpec</span><span class="op" id="5452223">)</span><span class="op" id="5452224">,</span>&nbsp;<span class="ident" id="5452226">keepType</span><span class="op" id="5452234">[</span><span class="ident" id="5452235">i</span><span class="op" id="5452236">]</span><span class="op" id="5452237">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452248">}</span>&nbsp;<span class="keyword" id="5452250">else</span>&nbsp;<span class="op" id="5452255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452261">var</span>&nbsp;<span class="ident" id="5452265">line</span>&nbsp;<span class="builtintype" id="5452270">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452278">for</span>&nbsp;<span class="ident" id="5452282">i</span><span class="op" id="5452283">,</span>&nbsp;<span class="ident" id="5452285">s</span>&nbsp;<span class="op" id="5452287">:=</span>&nbsp;<span class="keyword" id="5452290">range</span>&nbsp;<span class="ident" id="5452296">d</span><span class="op" id="5452297">.</span><span class="ident" id="5452298">Specs</span>&nbsp;<span class="op" id="5452304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5452311">if</span>&nbsp;<span class="ident" id="5452314">i</span>&nbsp;<span class="op" id="5452316">&gt;</span>&nbsp;<span class="num" id="5452318">0</span>&nbsp;<span class="op" id="5452320">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452328">p</span><span class="op" id="5452329">.</span><span class="ident" id="5452330">linebreak</span><span class="op" id="5452339">(</span><span class="ident" id="5452340">p</span><span class="op" id="5452341">.</span><span class="ident" id="5452342">lineFor</span><span class="op" id="5452349">(</span><span class="ident" id="5452350">s</span><span class="op" id="5452351">.</span><span class="ident" id="5452352">Pos</span><span class="op" id="5452355">(</span><span class="op" id="5452356">)</span><span class="op" id="5452357">)</span><span class="op" id="5452358">,</span>&nbsp;<span class="num" id="5452360">1</span><span class="op" id="5452361">,</span>&nbsp;<span class="ident" id="5452363">ignore</span><span class="op" id="5452369">,</span>&nbsp;<span class="ident" id="5452371">p</span><span class="op" id="5452372">.</span><span class="ident" id="5452373">linesFrom</span><span class="op" id="5452382">(</span><span class="ident" id="5452383">line</span><span class="op" id="5452387">)</span>&nbsp;<span class="op" id="5452389">&gt;</span>&nbsp;<span class="num" id="5452391">0</span><span class="op" id="5452392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452406">p</span><span class="op" id="5452407">.</span><span class="ident" id="5452408">recordLine</span><span class="op" id="5452418">(</span><span class="op" id="5452419">&amp;</span><span class="ident" id="5452420">line</span><span class="op" id="5452424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452431">p</span><span class="op" id="5452432">.</span><span class="ident" id="5452433">spec</span><span class="op" id="5452437">(</span><span class="ident" id="5452438">s</span><span class="op" id="5452439">,</span>&nbsp;<span class="ident" id="5452441">n</span><span class="op" id="5452442">,</span>&nbsp;<span class="builtintype" id="5452444">false</span><span class="op" id="5452449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452455">}</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452465">p</span><span class="op" id="5452466">.</span><span class="builtinfunc" id="5452467">print</span><span class="op" id="5452472">(</span><span class="ident" id="5452473">unindent</span><span class="op" id="5452481">,</span>&nbsp;<span class="ident" id="5452483">formfeed</span><span class="op" id="5452491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452499">p</span><span class="op" id="5452500">.</span><span class="builtinfunc" id="5452501">print</span><span class="op" id="5452506">(</span><span class="ident" id="5452507">d</span><span class="op" id="5452508">.</span><span class="ident" id="5452509">Rparen</span><span class="op" id="5452515">,</span>&nbsp;<span class="ident" id="5452517">token</span><span class="op" id="5452522">.</span><span class="ident" id="5452523">RPAREN</span><span class="op" id="5452529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452533">}</span>&nbsp;<span class="keyword" id="5452535">else</span>&nbsp;<span class="op" id="5452540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5452544">//&nbsp;single&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5452568">p</span><span class="op" id="5452569">.</span><span class="ident" id="5452570">spec</span><span class="op" id="5452574">(</span><span class="ident" id="5452575">d</span><span class="op" id="5452576">.</span><span class="ident" id="5452577">Specs</span><span class="op" id="5452582">[</span><span class="num" id="5452583">0</span><span class="op" id="5452584">]</span><span class="op" id="5452585">,</span>&nbsp;<span class="num" id="5452587">1</span><span class="op" id="5452588">,</span>&nbsp;<span class="builtintype" id="5452590">true</span><span class="op" id="5452594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5452597">}</span><br>
<span class="lineno"></span><span class="op" id="5452599">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5452602">//&nbsp;nodeSize&nbsp;determines&nbsp;the&nbsp;size&nbsp;of&nbsp;n&nbsp;in&nbsp;chars&nbsp;after&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="comment" id="5452666">//&nbsp;The&nbsp;result&nbsp;is&nbsp;&lt;=&nbsp;maxSize&nbsp;if&nbsp;the&nbsp;node&nbsp;fits&nbsp;on&nbsp;one&nbsp;line&nbsp;with&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5452731">//&nbsp;most&nbsp;maxSize&nbsp;chars&nbsp;and&nbsp;the&nbsp;formatted&nbsp;output&nbsp;doesn&#39;t&nbsp;contain</span><br>
<span class="lineno"></span><span class="comment" id="5452794">//&nbsp;any&nbsp;control&nbsp;chars.&nbsp;Otherwise,&nbsp;the&nbsp;result&nbsp;is&nbsp;&gt;&nbsp;maxSize.</span><br>
<span class="lineno">1430</span><span class="comment" id="5452852">//</span><br>
<span class="lineno"></span><span class="keyword" id="5452855">func</span>&nbsp;<span class="op" id="5452860">(</span><span class="ident" id="5452861">p</span>&nbsp;<span class="op" id="5452863">*</span><span class="ident" id="5452864">printer</span><span class="op" id="5452871">)</span>&nbsp;<span class="ident" id="5452873">nodeSize</span><span class="op" id="5452881">(</span><span class="ident" id="5452882">n</span>&nbsp;<span class="ident" id="5452884">ast</span><span class="op" id="5452887">.</span><span class="ident" id="5452888">Node</span><span class="op" id="5452892">,</span>&nbsp;<span class="ident" id="5452894">maxSize</span>&nbsp;<span class="builtintype" id="5452902">int</span><span class="op" id="5452905">)</span>&nbsp;<span class="op" id="5452907">(</span><span class="ident" id="5452908">size</span>&nbsp;<span class="builtintype" id="5452913">int</span><span class="op" id="5452916">)</span>&nbsp;<span class="op" id="5452918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5452921">//&nbsp;nodeSize&nbsp;invokes&nbsp;the&nbsp;printer,&nbsp;which&nbsp;may&nbsp;invoke&nbsp;nodeSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5452981">//&nbsp;recursively.&nbsp;For&nbsp;deep&nbsp;composite&nbsp;literal&nbsp;nests,&nbsp;this&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453041">//&nbsp;lead&nbsp;to&nbsp;an&nbsp;exponential&nbsp;algorithm.&nbsp;Remember&nbsp;previous</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453097">//&nbsp;results&nbsp;to&nbsp;prune&nbsp;the&nbsp;recursion&nbsp;(was&nbsp;issue&nbsp;1628).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453150">if</span>&nbsp;<span class="ident" id="5453153">size</span><span class="op" id="5453157">,</span>&nbsp;<span class="ident" id="5453159">found</span>&nbsp;<span class="op" id="5453165">:=</span>&nbsp;<span class="ident" id="5453168">p</span><span class="op" id="5453169">.</span><span class="ident" id="5453170">nodeSizes</span><span class="op" id="5453179">[</span><span class="ident" id="5453180">n</span><span class="op" id="5453181">]</span><span class="op" id="5453182">;</span>&nbsp;<span class="ident" id="5453184">found</span>&nbsp;<span class="op" id="5453190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453194">return</span>&nbsp;<span class="ident" id="5453201">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453211">size</span>&nbsp;<span class="op" id="5453216">=</span>&nbsp;<span class="ident" id="5453218">maxSize</span>&nbsp;<span class="op" id="5453226">+</span>&nbsp;<span class="num" id="5453228">1</span>&nbsp;<span class="comment" id="5453230">//&nbsp;assume&nbsp;n&nbsp;doesn&#39;t&nbsp;fit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453255">p</span><span class="op" id="5453256">.</span><span class="ident" id="5453257">nodeSizes</span><span class="op" id="5453266">[</span><span class="ident" id="5453267">n</span><span class="op" id="5453268">]</span>&nbsp;<span class="op" id="5453270">=</span>&nbsp;<span class="ident" id="5453272">size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453279">//&nbsp;nodeSize&nbsp;computation&nbsp;must&nbsp;be&nbsp;independent&nbsp;of&nbsp;particular</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453338">//&nbsp;style&nbsp;so&nbsp;that&nbsp;we&nbsp;always&nbsp;get&nbsp;the&nbsp;same&nbsp;decision;&nbsp;print</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453395">//&nbsp;in&nbsp;RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453412">cfg</span>&nbsp;<span class="op" id="5453416">:=</span>&nbsp;<span class="ident" id="5453419">Config</span><span class="op" id="5453425">{</span><span class="ident" id="5453426">Mode</span><span class="op" id="5453430">:</span>&nbsp;<span class="ident" id="5453432">RawFormat</span><span class="op" id="5453441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453444">var</span>&nbsp;<span class="ident" id="5453448">buf</span>&nbsp;<span class="ident" id="5453452">bytes</span><span class="op" id="5453457">.</span><span class="ident" id="5453458">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453466">if</span>&nbsp;<span class="ident" id="5453469">err</span>&nbsp;<span class="op" id="5453473">:=</span>&nbsp;<span class="ident" id="5453476">cfg</span><span class="op" id="5453479">.</span><span class="ident" id="5453480">fprint</span><span class="op" id="5453486">(</span><span class="op" id="5453487">&amp;</span><span class="ident" id="5453488">buf</span><span class="op" id="5453491">,</span>&nbsp;<span class="ident" id="5453493">p</span><span class="op" id="5453494">.</span><span class="ident" id="5453495">fset</span><span class="op" id="5453499">,</span>&nbsp;<span class="ident" id="5453501">n</span><span class="op" id="5453502">,</span>&nbsp;<span class="ident" id="5453504">p</span><span class="op" id="5453505">.</span><span class="ident" id="5453506">nodeSizes</span><span class="op" id="5453515">)</span><span class="op" id="5453516">;</span>&nbsp;<span class="ident" id="5453518">err</span>&nbsp;<span class="op" id="5453522">!=</span>&nbsp;<span class="ident" id="5453525">nil</span>&nbsp;<span class="op" id="5453529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453533">return</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453544">if</span>&nbsp;<span class="ident" id="5453547">buf</span><span class="op" id="5453550">.</span><span class="ident" id="5453551">Len</span><span class="op" id="5453554">(</span><span class="op" id="5453555">)</span>&nbsp;<span class="op" id="5453557">&lt;=</span>&nbsp;<span class="ident" id="5453560">maxSize</span>&nbsp;<span class="op" id="5453568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453572">for</span>&nbsp;<span class="ident" id="5453576">_</span><span class="op" id="5453577">,</span>&nbsp;<span class="ident" id="5453579">ch</span>&nbsp;<span class="op" id="5453582">:=</span>&nbsp;<span class="keyword" id="5453585">range</span>&nbsp;<span class="ident" id="5453591">buf</span><span class="op" id="5453594">.</span><span class="ident" id="5453595">Bytes</span><span class="op" id="5453600">(</span><span class="op" id="5453601">)</span>&nbsp;<span class="op" id="5453603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453608">if</span>&nbsp;<span class="ident" id="5453611">ch</span>&nbsp;<span class="op" id="5453614">&lt;</span>&nbsp;<span class="string" id="5453616">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5453620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453626">return</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453644">size</span>&nbsp;<span class="op" id="5453649">=</span>&nbsp;<span class="ident" id="5453651">buf</span><span class="op" id="5453654">.</span><span class="ident" id="5453655">Len</span><span class="op" id="5453658">(</span><span class="op" id="5453659">)</span>&nbsp;<span class="comment" id="5453661">//&nbsp;n&nbsp;fits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453673">p</span><span class="op" id="5453674">.</span><span class="ident" id="5453675">nodeSizes</span><span class="op" id="5453684">[</span><span class="ident" id="5453685">n</span><span class="op" id="5453686">]</span>&nbsp;<span class="op" id="5453688">=</span>&nbsp;<span class="ident" id="5453690">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5453696">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453699">return</span><br>
<span class="lineno"></span><span class="op" id="5453706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453709">//&nbsp;bodySize&nbsp;is&nbsp;like&nbsp;nodeSize&nbsp;but&nbsp;it&nbsp;is&nbsp;specialized&nbsp;for&nbsp;*ast.BlockStmt&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5453782">func</span>&nbsp;<span class="op" id="5453787">(</span><span class="ident" id="5453788">p</span>&nbsp;<span class="op" id="5453790">*</span><span class="ident" id="5453791">printer</span><span class="op" id="5453798">)</span>&nbsp;<span class="ident" id="5453800">bodySize</span><span class="op" id="5453808">(</span><span class="ident" id="5453809">b</span>&nbsp;<span class="op" id="5453811">*</span><span class="ident" id="5453812">ast</span><span class="op" id="5453815">.</span><span class="ident" id="5453816">BlockStmt</span><span class="op" id="5453825">,</span>&nbsp;<span class="ident" id="5453827">maxSize</span>&nbsp;<span class="builtintype" id="5453835">int</span><span class="op" id="5453838">)</span>&nbsp;<span class="builtintype" id="5453840">int</span>&nbsp;<span class="op" id="5453844">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453847">pos1</span>&nbsp;<span class="op" id="5453852">:=</span>&nbsp;<span class="ident" id="5453855">b</span><span class="op" id="5453856">.</span><span class="ident" id="5453857">Pos</span><span class="op" id="5453860">(</span><span class="op" id="5453861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5453864">pos2</span>&nbsp;<span class="op" id="5453869">:=</span>&nbsp;<span class="ident" id="5453872">b</span><span class="op" id="5453873">.</span><span class="ident" id="5453874">Rbrace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5453882">if</span>&nbsp;<span class="ident" id="5453885">pos1</span><span class="op" id="5453889">.</span><span class="ident" id="5453890">IsValid</span><span class="op" id="5453897">(</span><span class="op" id="5453898">)</span>&nbsp;<span class="op" id="5453900">&amp;&amp;</span>&nbsp;<span class="ident" id="5453903">pos2</span><span class="op" id="5453907">.</span><span class="ident" id="5453908">IsValid</span><span class="op" id="5453915">(</span><span class="op" id="5453916">)</span>&nbsp;<span class="op" id="5453918">&amp;&amp;</span>&nbsp;<span class="ident" id="5453921">p</span><span class="op" id="5453922">.</span><span class="ident" id="5453923">lineFor</span><span class="op" id="5453930">(</span><span class="ident" id="5453931">pos1</span><span class="op" id="5453935">)</span>&nbsp;<span class="op" id="5453937">!=</span>&nbsp;<span class="ident" id="5453940">p</span><span class="op" id="5453941">.</span><span class="ident" id="5453942">lineFor</span><span class="op" id="5453949">(</span><span class="ident" id="5453950">pos2</span><span class="op" id="5453954">)</span>&nbsp;<span class="op" id="5453956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5453960">//&nbsp;opening&nbsp;and&nbsp;closing&nbsp;brace&nbsp;are&nbsp;on&nbsp;different&nbsp;lines&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454042">return</span>&nbsp;<span class="ident" id="5454049">maxSize</span>&nbsp;<span class="op" id="5454057">+</span>&nbsp;<span class="num" id="5454059">1</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454065">if</span>&nbsp;<span class="builtinfunc" id="5454068">len</span><span class="op" id="5454071">(</span><span class="ident" id="5454072">b</span><span class="op" id="5454073">.</span><span class="ident" id="5454074">List</span><span class="op" id="5454078">)</span>&nbsp;<span class="op" id="5454080">&gt;</span>&nbsp;<span class="num" id="5454082">5</span>&nbsp;<span class="op" id="5454084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454088">//&nbsp;too&nbsp;many&nbsp;statements&nbsp;-&nbsp;don&#39;t&nbsp;make&nbsp;it&nbsp;a&nbsp;one-liner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454141">return</span>&nbsp;<span class="ident" id="5454148">maxSize</span>&nbsp;<span class="op" id="5454156">+</span>&nbsp;<span class="num" id="5454158">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454161">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5454164">//&nbsp;otherwise,&nbsp;estimate&nbsp;body&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454198">bodySize</span>&nbsp;<span class="op" id="5454207">:=</span>&nbsp;<span class="ident" id="5454210">p</span><span class="op" id="5454211">.</span><span class="ident" id="5454212">commentSizeBefore</span><span class="op" id="5454229">(</span><span class="ident" id="5454230">p</span><span class="op" id="5454231">.</span><span class="ident" id="5454232">posFor</span><span class="op" id="5454238">(</span><span class="ident" id="5454239">pos2</span><span class="op" id="5454243">)</span><span class="op" id="5454244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454247">for</span>&nbsp;<span class="ident" id="5454251">i</span><span class="op" id="5454252">,</span>&nbsp;<span class="ident" id="5454254">s</span>&nbsp;<span class="op" id="5454256">:=</span>&nbsp;<span class="keyword" id="5454259">range</span>&nbsp;<span class="ident" id="5454265">b</span><span class="op" id="5454266">.</span><span class="ident" id="5454267">List</span>&nbsp;<span class="op" id="5454272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454276">if</span>&nbsp;<span class="ident" id="5454279">bodySize</span>&nbsp;<span class="op" id="5454288">&gt;</span>&nbsp;<span class="ident" id="5454290">maxSize</span>&nbsp;<span class="op" id="5454298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454303">break</span>&nbsp;<span class="comment" id="5454309">//&nbsp;no&nbsp;need&nbsp;to&nbsp;continue</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454338">if</span>&nbsp;<span class="ident" id="5454341">i</span>&nbsp;<span class="op" id="5454343">&gt;</span>&nbsp;<span class="num" id="5454345">0</span>&nbsp;<span class="op" id="5454347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454352">bodySize</span>&nbsp;<span class="op" id="5454361">+=</span>&nbsp;<span class="num" id="5454364">2</span>&nbsp;<span class="comment" id="5454366">//&nbsp;space&nbsp;for&nbsp;a&nbsp;semicolon&nbsp;and&nbsp;blank</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5454407">bodySize</span>&nbsp;<span class="op" id="5454416">+=</span>&nbsp;<span class="ident" id="5454419">p</span><span class="op" id="5454420">.</span><span class="ident" id="5454421">nodeSize</span><span class="op" id="5454429">(</span><span class="ident" id="5454430">s</span><span class="op" id="5454431">,</span>&nbsp;<span class="ident" id="5454433">maxSize</span><span class="op" id="5454440">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5454443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5454446">return</span>&nbsp;<span class="ident" id="5454453">bodySize</span><br>
<span class="lineno"></span><span class="op" id="5454462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454465">//&nbsp;adjBlock&nbsp;prints&nbsp;an&nbsp;&#34;adjacent&#34;&nbsp;block&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;or&nbsp;function&nbsp;body)&nbsp;following</span><br>
<span class="lineno">1490</span><span class="comment" id="5454550">//&nbsp;a&nbsp;header&nbsp;(e.g.,&nbsp;a&nbsp;for-loop&nbsp;control&nbsp;clause&nbsp;or&nbsp;function&nbsp;signature)&nbsp;of&nbsp;given&nbsp;headerSize.</span><br>
<span class="lineno"></span><span class="comment" id="5454639">//&nbsp;If&nbsp;the&nbsp;header&#39;s&nbsp;and&nbsp;block&#39;s&nbsp;size&nbsp;are&nbsp;&#34;small&nbsp;enough&#34;&nbsp;and&nbsp;the&nbsp;block&nbsp;is&nbsp;&#34;simple&nbsp;enough&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5454728">//&nbsp;the&nbsp;block&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;without&nbsp;line&nbsp;breaks,&nbsp;spaced&nbsp;from&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5454817">//&nbsp;by&nbsp;sep.&nbsp;Otherwise&nbsp;the&nbsp;block&#39;s&nbsp;opening&nbsp;&#34;{&#34;&nbsp;is&nbsp;printed&nbsp;on&nbsp;the&nbsp;current&nbsp;line,&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5454906">//&nbsp;lines&nbsp;for&nbsp;the&nbsp;block&#39;s&nbsp;statements&nbsp;and&nbsp;its&nbsp;closing&nbsp;&#34;}&#34;.</span><br>
<span class="lineno">1495</span><span class="comment" id="5454963">//</span><br>
<span class="lineno"></span><span class="keyword" id="5454966">func</span>&nbsp;<span class="op" id="5454971">(</span><span class="ident" id="5454972">p</span>&nbsp;<span class="op" id="5454974">*</span><span class="ident" id="5454975">printer</span><span class="op" id="5454982">)</span>&nbsp;<span class="ident" id="5454984">adjBlock</span><span class="op" id="5454992">(</span><span class="ident" id="5454993">headerSize</span>&nbsp;<span class="builtintype" id="5455004">int</span><span class="op" id="5455007">,</span>&nbsp;<span class="ident" id="5455009">sep</span>&nbsp;<span class="ident" id="5455013">whiteSpace</span><span class="op" id="5455023">,</span>&nbsp;<span class="ident" id="5455025">b</span>&nbsp;<span class="op" id="5455027">*</span><span class="ident" id="5455028">ast</span><span class="op" id="5455031">.</span><span class="ident" id="5455032">BlockStmt</span><span class="op" id="5455041">)</span>&nbsp;<span class="op" id="5455043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455046">if</span>&nbsp;<span class="ident" id="5455049">b</span>&nbsp;<span class="op" id="5455051">==</span>&nbsp;<span class="ident" id="5455054">nil</span>&nbsp;<span class="op" id="5455058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455070">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455074">const</span>&nbsp;<span class="ident" id="5455080">maxSize</span>&nbsp;<span class="op" id="5455088">=</span>&nbsp;<span class="num" id="5455090">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455095">if</span>&nbsp;<span class="ident" id="5455098">headerSize</span><span class="op" id="5455108">+</span><span class="ident" id="5455109">p</span><span class="op" id="5455110">.</span><span class="ident" id="5455111">bodySize</span><span class="op" id="5455119">(</span><span class="ident" id="5455120">b</span><span class="op" id="5455121">,</span>&nbsp;<span class="ident" id="5455123">maxSize</span><span class="op" id="5455130">)</span>&nbsp;<span class="op" id="5455132">&lt;=</span>&nbsp;<span class="ident" id="5455135">maxSize</span>&nbsp;<span class="op" id="5455143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455147">p</span><span class="op" id="5455148">.</span><span class="builtinfunc" id="5455149">print</span><span class="op" id="5455154">(</span><span class="ident" id="5455155">sep</span><span class="op" id="5455158">,</span>&nbsp;<span class="ident" id="5455160">b</span><span class="op" id="5455161">.</span><span class="ident" id="5455162">Lbrace</span><span class="op" id="5455168">,</span>&nbsp;<span class="ident" id="5455170">token</span><span class="op" id="5455175">.</span><span class="ident" id="5455176">LBRACE</span><span class="op" id="5455182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455186">if</span>&nbsp;<span class="builtinfunc" id="5455189">len</span><span class="op" id="5455192">(</span><span class="ident" id="5455193">b</span><span class="op" id="5455194">.</span><span class="ident" id="5455195">List</span><span class="op" id="5455199">)</span>&nbsp;<span class="op" id="5455201">&gt;</span>&nbsp;<span class="num" id="5455203">0</span>&nbsp;<span class="op" id="5455205">{</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455210">p</span><span class="op" id="5455211">.</span><span class="builtinfunc" id="5455212">print</span><span class="op" id="5455217">(</span><span class="ident" id="5455218">blank</span><span class="op" id="5455223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455228">for</span>&nbsp;<span class="ident" id="5455232">i</span><span class="op" id="5455233">,</span>&nbsp;<span class="ident" id="5455235">s</span>&nbsp;<span class="op" id="5455237">:=</span>&nbsp;<span class="keyword" id="5455240">range</span>&nbsp;<span class="ident" id="5455246">b</span><span class="op" id="5455247">.</span><span class="ident" id="5455248">List</span>&nbsp;<span class="op" id="5455253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455259">if</span>&nbsp;<span class="ident" id="5455262">i</span>&nbsp;<span class="op" id="5455264">&gt;</span>&nbsp;<span class="num" id="5455266">0</span>&nbsp;<span class="op" id="5455268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455275">p</span><span class="op" id="5455276">.</span><span class="builtinfunc" id="5455277">print</span><span class="op" id="5455282">(</span><span class="ident" id="5455283">token</span><span class="op" id="5455288">.</span><span class="ident" id="5455289">SEMICOLON</span><span class="op" id="5455298">,</span>&nbsp;<span class="ident" id="5455300">blank</span><span class="op" id="5455305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455311">}</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455317">p</span><span class="op" id="5455318">.</span><span class="ident" id="5455319">stmt</span><span class="op" id="5455323">(</span><span class="ident" id="5455324">s</span><span class="op" id="5455325">,</span>&nbsp;<span class="ident" id="5455327">i</span>&nbsp;<span class="op" id="5455329">==</span>&nbsp;<span class="builtinfunc" id="5455332">len</span><span class="op" id="5455335">(</span><span class="ident" id="5455336">b</span><span class="op" id="5455337">.</span><span class="ident" id="5455338">List</span><span class="op" id="5455342">)</span><span class="op" id="5455343">-</span><span class="num" id="5455344">1</span><span class="op" id="5455345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455355">p</span><span class="op" id="5455356">.</span><span class="builtinfunc" id="5455357">print</span><span class="op" id="5455362">(</span><span class="ident" id="5455363">blank</span><span class="op" id="5455368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455376">p</span><span class="op" id="5455377">.</span><span class="builtinfunc" id="5455378">print</span><span class="op" id="5455383">(</span><span class="ident" id="5455384">noExtraLinebreak</span><span class="op" id="5455400">,</span>&nbsp;<span class="ident" id="5455402">b</span><span class="op" id="5455403">.</span><span class="ident" id="5455404">Rbrace</span><span class="op" id="5455410">,</span>&nbsp;<span class="ident" id="5455412">token</span><span class="op" id="5455417">.</span><span class="ident" id="5455418">RBRACE</span><span class="op" id="5455424">,</span>&nbsp;<span class="ident" id="5455426">noExtraLinebreak</span><span class="op" id="5455442">)</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455446">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455458">if</span>&nbsp;<span class="ident" id="5455461">sep</span>&nbsp;<span class="op" id="5455465">!=</span>&nbsp;<span class="ident" id="5455468">ignore</span>&nbsp;<span class="op" id="5455475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455479">p</span><span class="op" id="5455480">.</span><span class="builtinfunc" id="5455481">print</span><span class="op" id="5455486">(</span><span class="ident" id="5455487">blank</span><span class="op" id="5455492">)</span>&nbsp;<span class="comment" id="5455494">//&nbsp;always&nbsp;use&nbsp;blank</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455518">p</span><span class="op" id="5455519">.</span><span class="ident" id="5455520">block</span><span class="op" id="5455525">(</span><span class="ident" id="5455526">b</span><span class="op" id="5455527">,</span>&nbsp;<span class="num" id="5455529">1</span><span class="op" id="5455530">)</span><br>
<span class="lineno"></span><span class="op" id="5455532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5455535">//&nbsp;distanceFrom&nbsp;returns&nbsp;the&nbsp;column&nbsp;difference&nbsp;between&nbsp;from&nbsp;and&nbsp;p.pos&nbsp;(the&nbsp;current</span><br>
<span class="lineno">1525</span><span class="comment" id="5455617">//&nbsp;estimated&nbsp;position)&nbsp;if&nbsp;both&nbsp;are&nbsp;on&nbsp;the&nbsp;same&nbsp;line;&nbsp;if&nbsp;they&nbsp;are&nbsp;on&nbsp;different&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="5455701">//&nbsp;(or&nbsp;unknown)&nbsp;the&nbsp;result&nbsp;is&nbsp;infinity.</span><br>
<span class="lineno"></span><span class="keyword" id="5455741">func</span>&nbsp;<span class="op" id="5455746">(</span><span class="ident" id="5455747">p</span>&nbsp;<span class="op" id="5455749">*</span><span class="ident" id="5455750">printer</span><span class="op" id="5455757">)</span>&nbsp;<span class="ident" id="5455759">distanceFrom</span><span class="op" id="5455771">(</span><span class="ident" id="5455772">from</span>&nbsp;<span class="ident" id="5455777">token</span><span class="op" id="5455782">.</span><span class="ident" id="5455783">Pos</span><span class="op" id="5455786">)</span>&nbsp;<span class="builtintype" id="5455788">int</span>&nbsp;<span class="op" id="5455792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455795">if</span>&nbsp;<span class="ident" id="5455798">from</span><span class="op" id="5455802">.</span><span class="ident" id="5455803">IsValid</span><span class="op" id="5455810">(</span><span class="op" id="5455811">)</span>&nbsp;<span class="op" id="5455813">&amp;&amp;</span>&nbsp;<span class="ident" id="5455816">p</span><span class="op" id="5455817">.</span><span class="ident" id="5455818">pos</span><span class="op" id="5455821">.</span><span class="ident" id="5455822">IsValid</span><span class="op" id="5455829">(</span><span class="op" id="5455830">)</span>&nbsp;<span class="op" id="5455832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455836">if</span>&nbsp;<span class="ident" id="5455839">f</span>&nbsp;<span class="op" id="5455841">:=</span>&nbsp;<span class="ident" id="5455844">p</span><span class="op" id="5455845">.</span><span class="ident" id="5455846">posFor</span><span class="op" id="5455852">(</span><span class="ident" id="5455853">from</span><span class="op" id="5455857">)</span><span class="op" id="5455858">;</span>&nbsp;<span class="ident" id="5455860">f</span><span class="op" id="5455861">.</span><span class="ident" id="5455862">Line</span>&nbsp;<span class="op" id="5455867">==</span>&nbsp;<span class="ident" id="5455870">p</span><span class="op" id="5455871">.</span><span class="ident" id="5455872">pos</span><span class="op" id="5455875">.</span><span class="ident" id="5455876">Line</span>&nbsp;<span class="op" id="5455881">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455886">return</span>&nbsp;<span class="ident" id="5455893">p</span><span class="op" id="5455894">.</span><span class="ident" id="5455895">pos</span><span class="op" id="5455898">.</span><span class="ident" id="5455899">Column</span>&nbsp;<span class="op" id="5455906">-</span>&nbsp;<span class="ident" id="5455908">f</span><span class="op" id="5455909">.</span><span class="ident" id="5455910">Column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5455922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5455925">return</span>&nbsp;<span class="ident" id="5455932">infinity</span><br>
<span class="lineno"></span><span class="op" id="5455941">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span><span class="keyword" id="5455944">func</span>&nbsp;<span class="op" id="5455949">(</span><span class="ident" id="5455950">p</span>&nbsp;<span class="op" id="5455952">*</span><span class="ident" id="5455953">printer</span><span class="op" id="5455960">)</span>&nbsp;<span class="ident" id="5455962">funcDecl</span><span class="op" id="5455970">(</span><span class="ident" id="5455971">d</span>&nbsp;<span class="op" id="5455973">*</span><span class="ident" id="5455974">ast</span><span class="op" id="5455977">.</span><span class="ident" id="5455978">FuncDecl</span><span class="op" id="5455986">)</span>&nbsp;<span class="op" id="5455988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5455991">p</span><span class="op" id="5455992">.</span><span class="ident" id="5455993">setComment</span><span class="op" id="5456003">(</span><span class="ident" id="5456004">d</span><span class="op" id="5456005">.</span><span class="ident" id="5456006">Doc</span><span class="op" id="5456009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456012">p</span><span class="op" id="5456013">.</span><span class="builtinfunc" id="5456014">print</span><span class="op" id="5456019">(</span><span class="ident" id="5456020">d</span><span class="op" id="5456021">.</span><span class="ident" id="5456022">Pos</span><span class="op" id="5456025">(</span><span class="op" id="5456026">)</span><span class="op" id="5456027">,</span>&nbsp;<span class="ident" id="5456029">token</span><span class="op" id="5456034">.</span><span class="ident" id="5456035">FUNC</span><span class="op" id="5456039">,</span>&nbsp;<span class="ident" id="5456041">blank</span><span class="op" id="5456046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456049">if</span>&nbsp;<span class="ident" id="5456052">d</span><span class="op" id="5456053">.</span><span class="ident" id="5456054">Recv</span>&nbsp;<span class="op" id="5456059">!=</span>&nbsp;<span class="ident" id="5456062">nil</span>&nbsp;<span class="op" id="5456066">{</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456070">p</span><span class="op" id="5456071">.</span><span class="ident" id="5456072">parameters</span><span class="op" id="5456082">(</span><span class="ident" id="5456083">d</span><span class="op" id="5456084">.</span><span class="ident" id="5456085">Recv</span><span class="op" id="5456089">)</span>&nbsp;<span class="comment" id="5456091">//&nbsp;method:&nbsp;print&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456119">p</span><span class="op" id="5456120">.</span><span class="builtinfunc" id="5456121">print</span><span class="op" id="5456126">(</span><span class="ident" id="5456127">blank</span><span class="op" id="5456132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456138">p</span><span class="op" id="5456139">.</span><span class="ident" id="5456140">expr</span><span class="op" id="5456144">(</span><span class="ident" id="5456145">d</span><span class="op" id="5456146">.</span><span class="ident" id="5456147">Name</span><span class="op" id="5456151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456154">p</span><span class="op" id="5456155">.</span><span class="ident" id="5456156">signature</span><span class="op" id="5456165">(</span><span class="ident" id="5456166">d</span><span class="op" id="5456167">.</span><span class="ident" id="5456168">Type</span><span class="op" id="5456172">.</span><span class="ident" id="5456173">Params</span><span class="op" id="5456179">,</span>&nbsp;<span class="ident" id="5456181">d</span><span class="op" id="5456182">.</span><span class="ident" id="5456183">Type</span><span class="op" id="5456187">.</span><span class="ident" id="5456188">Results</span><span class="op" id="5456195">)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456198">p</span><span class="op" id="5456199">.</span><span class="ident" id="5456200">adjBlock</span><span class="op" id="5456208">(</span><span class="ident" id="5456209">p</span><span class="op" id="5456210">.</span><span class="ident" id="5456211">distanceFrom</span><span class="op" id="5456223">(</span><span class="ident" id="5456224">d</span><span class="op" id="5456225">.</span><span class="ident" id="5456226">Pos</span><span class="op" id="5456229">(</span><span class="op" id="5456230">)</span><span class="op" id="5456231">)</span><span class="op" id="5456232">,</span>&nbsp;<span class="ident" id="5456234">vtab</span><span class="op" id="5456238">,</span>&nbsp;<span class="ident" id="5456240">d</span><span class="op" id="5456241">.</span><span class="ident" id="5456242">Body</span><span class="op" id="5456246">)</span><br>
<span class="lineno"></span><span class="op" id="5456248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456251">func</span>&nbsp;<span class="op" id="5456256">(</span><span class="ident" id="5456257">p</span>&nbsp;<span class="op" id="5456259">*</span><span class="ident" id="5456260">printer</span><span class="op" id="5456267">)</span>&nbsp;<span class="ident" id="5456269">decl</span><span class="op" id="5456273">(</span><span class="ident" id="5456274">decl</span>&nbsp;<span class="ident" id="5456279">ast</span><span class="op" id="5456282">.</span><span class="ident" id="5456283">Decl</span><span class="op" id="5456287">)</span>&nbsp;<span class="op" id="5456289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456292">switch</span>&nbsp;<span class="ident" id="5456299">d</span>&nbsp;<span class="op" id="5456301">:=</span>&nbsp;<span class="ident" id="5456304">decl</span><span class="op" id="5456308">.</span><span class="op" id="5456309">(</span><span class="keyword" id="5456310">type</span><span class="op" id="5456314">)</span>&nbsp;<span class="op" id="5456316">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456319">case</span>&nbsp;<span class="op" id="5456324">*</span><span class="ident" id="5456325">ast</span><span class="op" id="5456328">.</span><span class="ident" id="5456329">BadDecl</span><span class="op" id="5456336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456340">p</span><span class="op" id="5456341">.</span><span class="builtinfunc" id="5456342">print</span><span class="op" id="5456347">(</span><span class="ident" id="5456348">d</span><span class="op" id="5456349">.</span><span class="ident" id="5456350">Pos</span><span class="op" id="5456353">(</span><span class="op" id="5456354">)</span><span class="op" id="5456355">,</span>&nbsp;<span class="string" id="5456357">&#34;BadDecl&#34;</span><span class="op" id="5456366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456369">case</span>&nbsp;<span class="op" id="5456374">*</span><span class="ident" id="5456375">ast</span><span class="op" id="5456378">.</span><span class="ident" id="5456379">GenDecl</span><span class="op" id="5456386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456390">p</span><span class="op" id="5456391">.</span><span class="ident" id="5456392">genDecl</span><span class="op" id="5456399">(</span><span class="ident" id="5456400">d</span><span class="op" id="5456401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456404">case</span>&nbsp;<span class="op" id="5456409">*</span><span class="ident" id="5456410">ast</span><span class="op" id="5456413">.</span><span class="ident" id="5456414">FuncDecl</span><span class="op" id="5456422">:</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456426">p</span><span class="op" id="5456427">.</span><span class="ident" id="5456428">funcDecl</span><span class="op" id="5456436">(</span><span class="ident" id="5456437">d</span><span class="op" id="5456438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456441">default</span><span class="op" id="5456448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5456452">panic</span><span class="op" id="5456457">(</span><span class="string" id="5456458">&#34;unreachable&#34;</span><span class="op" id="5456471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456474">}</span><br>
<span class="lineno"></span><span class="op" id="5456476">}</span><br>
<span class="lineno">1560</span><br>
<span class="lineno"></span><span class="comment" id="5456479">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5456559">//&nbsp;Files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456569">func</span>&nbsp;<span class="ident" id="5456574">declToken</span><span class="op" id="5456583">(</span><span class="ident" id="5456584">decl</span>&nbsp;<span class="ident" id="5456589">ast</span><span class="op" id="5456592">.</span><span class="ident" id="5456593">Decl</span><span class="op" id="5456597">)</span>&nbsp;<span class="op" id="5456599">(</span><span class="ident" id="5456600">tok</span>&nbsp;<span class="ident" id="5456604">token</span><span class="op" id="5456609">.</span><span class="ident" id="5456610">Token</span><span class="op" id="5456615">)</span>&nbsp;<span class="op" id="5456617">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456620">tok</span>&nbsp;<span class="op" id="5456624">=</span>&nbsp;<span class="ident" id="5456626">token</span><span class="op" id="5456631">.</span><span class="ident" id="5456632">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456641">switch</span>&nbsp;<span class="ident" id="5456648">d</span>&nbsp;<span class="op" id="5456650">:=</span>&nbsp;<span class="ident" id="5456653">decl</span><span class="op" id="5456657">.</span><span class="op" id="5456658">(</span><span class="keyword" id="5456659">type</span><span class="op" id="5456663">)</span>&nbsp;<span class="op" id="5456665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456668">case</span>&nbsp;<span class="op" id="5456673">*</span><span class="ident" id="5456674">ast</span><span class="op" id="5456677">.</span><span class="ident" id="5456678">GenDecl</span><span class="op" id="5456685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456689">tok</span>&nbsp;<span class="op" id="5456693">=</span>&nbsp;<span class="ident" id="5456695">d</span><span class="op" id="5456696">.</span><span class="ident" id="5456697">Tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456702">case</span>&nbsp;<span class="op" id="5456707">*</span><span class="ident" id="5456708">ast</span><span class="op" id="5456711">.</span><span class="ident" id="5456712">FuncDecl</span><span class="op" id="5456720">:</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456724">tok</span>&nbsp;<span class="op" id="5456728">=</span>&nbsp;<span class="ident" id="5456730">token</span><span class="op" id="5456735">.</span><span class="ident" id="5456736">FUNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5456742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456745">return</span><br>
<span class="lineno"></span><span class="op" id="5456752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span><span class="keyword" id="5456755">func</span>&nbsp;<span class="op" id="5456760">(</span><span class="ident" id="5456761">p</span>&nbsp;<span class="op" id="5456763">*</span><span class="ident" id="5456764">printer</span><span class="op" id="5456771">)</span>&nbsp;<span class="ident" id="5456773">declList</span><span class="op" id="5456781">(</span><span class="ident" id="5456782">list</span>&nbsp;<span class="op" id="5456787">[</span><span class="op" id="5456788">]</span><span class="ident" id="5456789">ast</span><span class="op" id="5456792">.</span><span class="ident" id="5456793">Decl</span><span class="op" id="5456797">)</span>&nbsp;<span class="op" id="5456799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456802">tok</span>&nbsp;<span class="op" id="5456806">:=</span>&nbsp;<span class="ident" id="5456809">token</span><span class="op" id="5456814">.</span><span class="ident" id="5456815">ILLEGAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5456824">for</span>&nbsp;<span class="ident" id="5456828">_</span><span class="op" id="5456829">,</span>&nbsp;<span class="ident" id="5456831">d</span>&nbsp;<span class="op" id="5456833">:=</span>&nbsp;<span class="keyword" id="5456836">range</span>&nbsp;<span class="ident" id="5456842">list</span>&nbsp;<span class="op" id="5456847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456851">prev</span>&nbsp;<span class="op" id="5456856">:=</span>&nbsp;<span class="ident" id="5456859">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5456865">tok</span>&nbsp;<span class="op" id="5456869">=</span>&nbsp;<span class="ident" id="5456871">declToken</span><span class="op" id="5456880">(</span><span class="ident" id="5456881">d</span><span class="op" id="5456882">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456886">//&nbsp;If&nbsp;the&nbsp;declaration&nbsp;token&nbsp;changed&nbsp;(e.g.,&nbsp;from&nbsp;CONST&nbsp;to&nbsp;TYPE)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5456951">//&nbsp;or&nbsp;the&nbsp;next&nbsp;declaration&nbsp;has&nbsp;documentation&nbsp;associated&nbsp;with&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457018">//&nbsp;print&nbsp;an&nbsp;empty&nbsp;line&nbsp;between&nbsp;top-level&nbsp;declarations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457075">//&nbsp;(because&nbsp;p.linebreak&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;position&nbsp;of&nbsp;d,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457141">//&nbsp;is&nbsp;past&nbsp;any&nbsp;documentation,&nbsp;the&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;satisfied</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457210">//&nbsp;even&nbsp;w/o&nbsp;the&nbsp;extra&nbsp;getDoc(d)&nbsp;nil-check&nbsp;-&nbsp;leave&nbsp;it&nbsp;in&nbsp;case&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457277">//&nbsp;linebreak&nbsp;logic&nbsp;improves&nbsp;-&nbsp;there&#39;s&nbsp;already&nbsp;a&nbsp;TODO).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457334">if</span>&nbsp;<span class="builtinfunc" id="5457337">len</span><span class="op" id="5457340">(</span><span class="ident" id="5457341">p</span><span class="op" id="5457342">.</span><span class="ident" id="5457343">output</span><span class="op" id="5457349">)</span>&nbsp;<span class="op" id="5457351">&gt;</span>&nbsp;<span class="num" id="5457353">0</span>&nbsp;<span class="op" id="5457355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457360">//&nbsp;only&nbsp;print&nbsp;line&nbsp;break&nbsp;if&nbsp;we&nbsp;are&nbsp;not&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5457433">//&nbsp;(i.e.,&nbsp;we&nbsp;are&nbsp;not&nbsp;printing&nbsp;only&nbsp;a&nbsp;partial&nbsp;program)</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457490">min</span>&nbsp;<span class="op" id="5457494">:=</span>&nbsp;<span class="num" id="5457497">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5457502">if</span>&nbsp;<span class="ident" id="5457505">prev</span>&nbsp;<span class="op" id="5457510">!=</span>&nbsp;<span class="ident" id="5457513">tok</span>&nbsp;<span class="op" id="5457517">||</span>&nbsp;<span class="ident" id="5457520">getDoc</span><span class="op" id="5457526">(</span><span class="ident" id="5457527">d</span><span class="op" id="5457528">)</span>&nbsp;<span class="op" id="5457530">!=</span>&nbsp;<span class="ident" id="5457533">nil</span>&nbsp;<span class="op" id="5457537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457543">min</span>&nbsp;<span class="op" id="5457547">=</span>&nbsp;<span class="num" id="5457549">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457559">p</span><span class="op" id="5457560">.</span><span class="ident" id="5457561">linebreak</span><span class="op" id="5457570">(</span><span class="ident" id="5457571">p</span><span class="op" id="5457572">.</span><span class="ident" id="5457573">lineFor</span><span class="op" id="5457580">(</span><span class="ident" id="5457581">d</span><span class="op" id="5457582">.</span><span class="ident" id="5457583">Pos</span><span class="op" id="5457586">(</span><span class="op" id="5457587">)</span><span class="op" id="5457588">)</span><span class="op" id="5457589">,</span>&nbsp;<span class="ident" id="5457591">min</span><span class="op" id="5457594">,</span>&nbsp;<span class="ident" id="5457596">ignore</span><span class="op" id="5457602">,</span>&nbsp;<span class="builtintype" id="5457604">false</span><span class="op" id="5457609">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457617">p</span><span class="op" id="5457618">.</span><span class="ident" id="5457619">decl</span><span class="op" id="5457623">(</span><span class="ident" id="5457624">d</span><span class="op" id="5457625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5457628">}</span><br>
<span class="lineno"></span><span class="op" id="5457630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="keyword" id="5457633">func</span>&nbsp;<span class="op" id="5457638">(</span><span class="ident" id="5457639">p</span>&nbsp;<span class="op" id="5457641">*</span><span class="ident" id="5457642">printer</span><span class="op" id="5457649">)</span>&nbsp;<span class="ident" id="5457651">file</span><span class="op" id="5457655">(</span><span class="ident" id="5457656">src</span>&nbsp;<span class="op" id="5457660">*</span><span class="ident" id="5457661">ast</span><span class="op" id="5457664">.</span><span class="ident" id="5457665">File</span><span class="op" id="5457669">)</span>&nbsp;<span class="op" id="5457671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457674">p</span><span class="op" id="5457675">.</span><span class="ident" id="5457676">setComment</span><span class="op" id="5457686">(</span><span class="ident" id="5457687">src</span><span class="op" id="5457690">.</span><span class="ident" id="5457691">Doc</span><span class="op" id="5457694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457697">p</span><span class="op" id="5457698">.</span><span class="builtinfunc" id="5457699">print</span><span class="op" id="5457704">(</span><span class="ident" id="5457705">src</span><span class="op" id="5457708">.</span><span class="ident" id="5457709">Pos</span><span class="op" id="5457712">(</span><span class="op" id="5457713">)</span><span class="op" id="5457714">,</span>&nbsp;<span class="ident" id="5457716">token</span><span class="op" id="5457721">.</span><span class="ident" id="5457722">PACKAGE</span><span class="op" id="5457729">,</span>&nbsp;<span class="ident" id="5457731">blank</span><span class="op" id="5457736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457739">p</span><span class="op" id="5457740">.</span><span class="ident" id="5457741">expr</span><span class="op" id="5457745">(</span><span class="ident" id="5457746">src</span><span class="op" id="5457749">.</span><span class="ident" id="5457750">Name</span><span class="op" id="5457754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457757">p</span><span class="op" id="5457758">.</span><span class="ident" id="5457759">declList</span><span class="op" id="5457767">(</span><span class="ident" id="5457768">src</span><span class="op" id="5457771">.</span><span class="ident" id="5457772">Decls</span><span class="op" id="5457777">)</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5457780">p</span><span class="op" id="5457781">.</span><span class="builtinfunc" id="5457782">print</span><span class="op" id="5457787">(</span><span class="ident" id="5457788">newline</span><span class="op" id="5457795">)</span><br>
<span class="lineno"></span><span class="op" id="5457797">}</span>
</div>
</body>
</html>
