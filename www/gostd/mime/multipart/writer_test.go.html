<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7890332">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7890387">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7890441">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7890492">package</span>&nbsp;<span class="ident" id="7890500">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7890511">import</span>&nbsp;<span class="op" id="7890518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7890521">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7890530">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7890543">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7890554">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7890564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7890567">func</span>&nbsp;<span class="ident" id="7890572">TestWriter</span><span class="op" id="7890582">(</span><span class="ident" id="7890583">t</span>&nbsp;<span class="op" id="7890585">*</span><span class="ident" id="7890586">testing</span><span class="op" id="7890593">.</span><span class="ident" id="7890594">T</span><span class="op" id="7890595">)</span>&nbsp;<span class="op" id="7890597">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890600">fileContents</span>&nbsp;<span class="op" id="7890613">:=</span>&nbsp;<span class="op" id="7890616">[</span><span class="op" id="7890617">]</span><span class="builtintype" id="7890618">byte</span><span class="op" id="7890622">(</span><span class="string" id="7890623">&#34;my&nbsp;file&nbsp;contents&#34;</span><span class="op" id="7890641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890645">var</span>&nbsp;<span class="ident" id="7890649">b</span>&nbsp;<span class="ident" id="7890651">bytes</span><span class="op" id="7890656">.</span><span class="ident" id="7890657">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890665">w</span>&nbsp;<span class="op" id="7890667">:=</span>&nbsp;<span class="ident" id="7890670">NewWriter</span><span class="op" id="7890679">(</span><span class="op" id="7890680">&amp;</span><span class="ident" id="7890681">b</span><span class="op" id="7890682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890685">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890689">part</span><span class="op" id="7890693">,</span>&nbsp;<span class="ident" id="7890695">err</span>&nbsp;<span class="op" id="7890699">:=</span>&nbsp;<span class="ident" id="7890702">w</span><span class="op" id="7890703">.</span><span class="ident" id="7890704">CreateFormFile</span><span class="op" id="7890718">(</span><span class="string" id="7890719">&#34;myfile&#34;</span><span class="op" id="7890727">,</span>&nbsp;<span class="string" id="7890729">&#34;my-file.txt&#34;</span><span class="op" id="7890742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890746">if</span>&nbsp;<span class="ident" id="7890749">err</span>&nbsp;<span class="op" id="7890753">!=</span>&nbsp;<span class="ident" id="7890756">nil</span>&nbsp;<span class="op" id="7890760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890765">t</span><span class="op" id="7890766">.</span><span class="ident" id="7890767">Fatalf</span><span class="op" id="7890773">(</span><span class="string" id="7890774">&#34;CreateFormFile:&nbsp;%v&#34;</span><span class="op" id="7890794">,</span>&nbsp;<span class="ident" id="7890796">err</span><span class="op" id="7890799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890807">part</span><span class="op" id="7890811">.</span><span class="ident" id="7890812">Write</span><span class="op" id="7890817">(</span><span class="ident" id="7890818">fileContents</span><span class="op" id="7890830">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890834">err</span>&nbsp;<span class="op" id="7890838">=</span>&nbsp;<span class="ident" id="7890840">w</span><span class="op" id="7890841">.</span><span class="ident" id="7890842">WriteField</span><span class="op" id="7890852">(</span><span class="string" id="7890853">&#34;key&#34;</span><span class="op" id="7890858">,</span>&nbsp;<span class="string" id="7890860">&#34;val&#34;</span><span class="op" id="7890865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890869">if</span>&nbsp;<span class="ident" id="7890872">err</span>&nbsp;<span class="op" id="7890876">!=</span>&nbsp;<span class="ident" id="7890879">nil</span>&nbsp;<span class="op" id="7890883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890888">t</span><span class="op" id="7890889">.</span><span class="ident" id="7890890">Fatalf</span><span class="op" id="7890896">(</span><span class="string" id="7890897">&#34;WriteField:&nbsp;%v&#34;</span><span class="op" id="7890913">,</span>&nbsp;<span class="ident" id="7890915">err</span><span class="op" id="7890918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7890922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890926">part</span><span class="op" id="7890930">.</span><span class="ident" id="7890931">Write</span><span class="op" id="7890936">(</span><span class="op" id="7890937">[</span><span class="op" id="7890938">]</span><span class="builtintype" id="7890939">byte</span><span class="op" id="7890943">(</span><span class="string" id="7890944">&#34;val&#34;</span><span class="op" id="7890949">)</span><span class="op" id="7890950">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890954">err</span>&nbsp;<span class="op" id="7890958">=</span>&nbsp;<span class="ident" id="7890960">w</span><span class="op" id="7890961">.</span><span class="ident" id="7890962">Close</span><span class="op" id="7890967">(</span><span class="op" id="7890968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7890972">if</span>&nbsp;<span class="ident" id="7890975">err</span>&nbsp;<span class="op" id="7890979">!=</span>&nbsp;<span class="ident" id="7890982">nil</span>&nbsp;<span class="op" id="7890986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7890991">t</span><span class="op" id="7890992">.</span><span class="ident" id="7890993">Fatalf</span><span class="op" id="7890999">(</span><span class="string" id="7891000">&#34;Close:&nbsp;%v&#34;</span><span class="op" id="7891011">,</span>&nbsp;<span class="ident" id="7891013">err</span><span class="op" id="7891016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891024">s</span>&nbsp;<span class="op" id="7891026">:=</span>&nbsp;<span class="ident" id="7891029">b</span><span class="op" id="7891030">.</span><span class="ident" id="7891031">String</span><span class="op" id="7891037">(</span><span class="op" id="7891038">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891042">if</span>&nbsp;<span class="builtinfunc" id="7891045">len</span><span class="op" id="7891048">(</span><span class="ident" id="7891049">s</span><span class="op" id="7891050">)</span>&nbsp;<span class="op" id="7891052">==</span>&nbsp;<span class="num" id="7891055">0</span>&nbsp;<span class="op" id="7891057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891062">t</span><span class="op" id="7891063">.</span><span class="ident" id="7891064">Fatal</span><span class="op" id="7891069">(</span><span class="string" id="7891070">&#34;String:&nbsp;unexpected&nbsp;empty&nbsp;result&#34;</span><span class="op" id="7891103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891111">if</span>&nbsp;<span class="ident" id="7891114">s</span><span class="op" id="7891115">[</span><span class="num" id="7891116">0</span><span class="op" id="7891117">]</span>&nbsp;<span class="op" id="7891119">==</span>&nbsp;<span class="string" id="7891122">&#39;\r&#39;</span>&nbsp;<span class="op" id="7891127">||</span>&nbsp;<span class="ident" id="7891130">s</span><span class="op" id="7891131">[</span><span class="num" id="7891132">0</span><span class="op" id="7891133">]</span>&nbsp;<span class="op" id="7891135">==</span>&nbsp;<span class="string" id="7891138">&#39;\n&#39;</span>&nbsp;<span class="op" id="7891143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891148">t</span><span class="op" id="7891149">.</span><span class="ident" id="7891150">Fatal</span><span class="op" id="7891155">(</span><span class="string" id="7891156">&#34;String:&nbsp;unexpected&nbsp;newline&#34;</span><span class="op" id="7891184">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891195">r</span>&nbsp;<span class="op" id="7891197">:=</span>&nbsp;<span class="ident" id="7891200">NewReader</span><span class="op" id="7891209">(</span><span class="op" id="7891210">&amp;</span><span class="ident" id="7891211">b</span><span class="op" id="7891212">,</span>&nbsp;<span class="ident" id="7891214">w</span><span class="op" id="7891215">.</span><span class="ident" id="7891216">Boundary</span><span class="op" id="7891224">(</span><span class="op" id="7891225">)</span><span class="op" id="7891226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891230">part</span><span class="op" id="7891234">,</span>&nbsp;<span class="ident" id="7891236">err</span>&nbsp;<span class="op" id="7891240">:=</span>&nbsp;<span class="ident" id="7891243">r</span><span class="op" id="7891244">.</span><span class="ident" id="7891245">NextPart</span><span class="op" id="7891253">(</span><span class="op" id="7891254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891257">if</span>&nbsp;<span class="ident" id="7891260">err</span>&nbsp;<span class="op" id="7891264">!=</span>&nbsp;<span class="ident" id="7891267">nil</span>&nbsp;<span class="op" id="7891271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891275">t</span><span class="op" id="7891276">.</span><span class="ident" id="7891277">Fatalf</span><span class="op" id="7891283">(</span><span class="string" id="7891284">&#34;part&nbsp;1:&nbsp;%v&#34;</span><span class="op" id="7891296">,</span>&nbsp;<span class="ident" id="7891298">err</span><span class="op" id="7891301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891307">if</span>&nbsp;<span class="ident" id="7891310">g</span><span class="op" id="7891311">,</span>&nbsp;<span class="ident" id="7891313">e</span>&nbsp;<span class="op" id="7891315">:=</span>&nbsp;<span class="ident" id="7891318">part</span><span class="op" id="7891322">.</span><span class="ident" id="7891323">FormName</span><span class="op" id="7891331">(</span><span class="op" id="7891332">)</span><span class="op" id="7891333">,</span>&nbsp;<span class="string" id="7891335">&#34;myfile&#34;</span><span class="op" id="7891343">;</span>&nbsp;<span class="ident" id="7891345">g</span>&nbsp;<span class="op" id="7891347">!=</span>&nbsp;<span class="ident" id="7891350">e</span>&nbsp;<span class="op" id="7891352">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891356">t</span><span class="op" id="7891357">.</span><span class="ident" id="7891358">Errorf</span><span class="op" id="7891364">(</span><span class="string" id="7891365">&#34;part&nbsp;1:&nbsp;want&nbsp;form&nbsp;name&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7891400">,</span>&nbsp;<span class="ident" id="7891402">e</span><span class="op" id="7891403">,</span>&nbsp;<span class="ident" id="7891405">g</span><span class="op" id="7891406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891412">slurp</span><span class="op" id="7891417">,</span>&nbsp;<span class="ident" id="7891419">err</span>&nbsp;<span class="op" id="7891423">:=</span>&nbsp;<span class="ident" id="7891426">ioutil</span><span class="op" id="7891432">.</span><span class="ident" id="7891433">ReadAll</span><span class="op" id="7891440">(</span><span class="ident" id="7891441">part</span><span class="op" id="7891445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891448">if</span>&nbsp;<span class="ident" id="7891451">err</span>&nbsp;<span class="op" id="7891455">!=</span>&nbsp;<span class="ident" id="7891458">nil</span>&nbsp;<span class="op" id="7891462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891466">t</span><span class="op" id="7891467">.</span><span class="ident" id="7891468">Fatalf</span><span class="op" id="7891474">(</span><span class="string" id="7891475">&#34;part&nbsp;1:&nbsp;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7891496">,</span>&nbsp;<span class="ident" id="7891498">err</span><span class="op" id="7891501">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891507">if</span>&nbsp;<span class="ident" id="7891510">e</span><span class="op" id="7891511">,</span>&nbsp;<span class="ident" id="7891513">g</span>&nbsp;<span class="op" id="7891515">:=</span>&nbsp;<span class="builtintype" id="7891518">string</span><span class="op" id="7891524">(</span><span class="ident" id="7891525">fileContents</span><span class="op" id="7891537">)</span><span class="op" id="7891538">,</span>&nbsp;<span class="builtintype" id="7891540">string</span><span class="op" id="7891546">(</span><span class="ident" id="7891547">slurp</span><span class="op" id="7891552">)</span><span class="op" id="7891553">;</span>&nbsp;<span class="ident" id="7891555">e</span>&nbsp;<span class="op" id="7891557">!=</span>&nbsp;<span class="ident" id="7891560">g</span>&nbsp;<span class="op" id="7891562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891566">t</span><span class="op" id="7891567">.</span><span class="ident" id="7891568">Errorf</span><span class="op" id="7891574">(</span><span class="string" id="7891575">&#34;part&nbsp;1:&nbsp;want&nbsp;contents&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7891609">,</span>&nbsp;<span class="ident" id="7891611">e</span><span class="op" id="7891612">,</span>&nbsp;<span class="ident" id="7891614">g</span><span class="op" id="7891615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891622">part</span><span class="op" id="7891626">,</span>&nbsp;<span class="ident" id="7891628">err</span>&nbsp;<span class="op" id="7891632">=</span>&nbsp;<span class="ident" id="7891634">r</span><span class="op" id="7891635">.</span><span class="ident" id="7891636">NextPart</span><span class="op" id="7891644">(</span><span class="op" id="7891645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891648">if</span>&nbsp;<span class="ident" id="7891651">err</span>&nbsp;<span class="op" id="7891655">!=</span>&nbsp;<span class="ident" id="7891658">nil</span>&nbsp;<span class="op" id="7891662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891666">t</span><span class="op" id="7891667">.</span><span class="ident" id="7891668">Fatalf</span><span class="op" id="7891674">(</span><span class="string" id="7891675">&#34;part&nbsp;2:&nbsp;%v&#34;</span><span class="op" id="7891687">,</span>&nbsp;<span class="ident" id="7891689">err</span><span class="op" id="7891692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891698">if</span>&nbsp;<span class="ident" id="7891701">g</span><span class="op" id="7891702">,</span>&nbsp;<span class="ident" id="7891704">e</span>&nbsp;<span class="op" id="7891706">:=</span>&nbsp;<span class="ident" id="7891709">part</span><span class="op" id="7891713">.</span><span class="ident" id="7891714">FormName</span><span class="op" id="7891722">(</span><span class="op" id="7891723">)</span><span class="op" id="7891724">,</span>&nbsp;<span class="string" id="7891726">&#34;key&#34;</span><span class="op" id="7891731">;</span>&nbsp;<span class="ident" id="7891733">g</span>&nbsp;<span class="op" id="7891735">!=</span>&nbsp;<span class="ident" id="7891738">e</span>&nbsp;<span class="op" id="7891740">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891744">t</span><span class="op" id="7891745">.</span><span class="ident" id="7891746">Errorf</span><span class="op" id="7891752">(</span><span class="string" id="7891753">&#34;part&nbsp;2:&nbsp;want&nbsp;form&nbsp;name&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7891788">,</span>&nbsp;<span class="ident" id="7891790">e</span><span class="op" id="7891791">,</span>&nbsp;<span class="ident" id="7891793">g</span><span class="op" id="7891794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891800">slurp</span><span class="op" id="7891805">,</span>&nbsp;<span class="ident" id="7891807">err</span>&nbsp;<span class="op" id="7891811">=</span>&nbsp;<span class="ident" id="7891813">ioutil</span><span class="op" id="7891819">.</span><span class="ident" id="7891820">ReadAll</span><span class="op" id="7891827">(</span><span class="ident" id="7891828">part</span><span class="op" id="7891832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891835">if</span>&nbsp;<span class="ident" id="7891838">err</span>&nbsp;<span class="op" id="7891842">!=</span>&nbsp;<span class="ident" id="7891845">nil</span>&nbsp;<span class="op" id="7891849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891853">t</span><span class="op" id="7891854">.</span><span class="ident" id="7891855">Fatalf</span><span class="op" id="7891861">(</span><span class="string" id="7891862">&#34;part&nbsp;2:&nbsp;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7891883">,</span>&nbsp;<span class="ident" id="7891885">err</span><span class="op" id="7891888">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891894">if</span>&nbsp;<span class="ident" id="7891897">e</span><span class="op" id="7891898">,</span>&nbsp;<span class="ident" id="7891900">g</span>&nbsp;<span class="op" id="7891902">:=</span>&nbsp;<span class="string" id="7891905">&#34;val&#34;</span><span class="op" id="7891910">,</span>&nbsp;<span class="builtintype" id="7891912">string</span><span class="op" id="7891918">(</span><span class="ident" id="7891919">slurp</span><span class="op" id="7891924">)</span><span class="op" id="7891925">;</span>&nbsp;<span class="ident" id="7891927">e</span>&nbsp;<span class="op" id="7891929">!=</span>&nbsp;<span class="ident" id="7891932">g</span>&nbsp;<span class="op" id="7891934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891938">t</span><span class="op" id="7891939">.</span><span class="ident" id="7891940">Errorf</span><span class="op" id="7891946">(</span><span class="string" id="7891947">&#34;part&nbsp;2:&nbsp;want&nbsp;contents&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7891981">,</span>&nbsp;<span class="ident" id="7891983">e</span><span class="op" id="7891984">,</span>&nbsp;<span class="ident" id="7891986">g</span><span class="op" id="7891987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891994">part</span><span class="op" id="7891998">,</span>&nbsp;<span class="ident" id="7892000">err</span>&nbsp;<span class="op" id="7892004">=</span>&nbsp;<span class="ident" id="7892006">r</span><span class="op" id="7892007">.</span><span class="ident" id="7892008">NextPart</span><span class="op" id="7892016">(</span><span class="op" id="7892017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892020">if</span>&nbsp;<span class="ident" id="7892023">part</span>&nbsp;<span class="op" id="7892028">!=</span>&nbsp;<span class="ident" id="7892031">nil</span>&nbsp;<span class="op" id="7892035">||</span>&nbsp;<span class="ident" id="7892038">err</span>&nbsp;<span class="op" id="7892042">==</span>&nbsp;<span class="ident" id="7892045">nil</span>&nbsp;<span class="op" id="7892049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892053">t</span><span class="op" id="7892054">.</span><span class="ident" id="7892055">Fatalf</span><span class="op" id="7892061">(</span><span class="string" id="7892062">&#34;expected&nbsp;end&nbsp;of&nbsp;parts;&nbsp;got&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7892097">,</span>&nbsp;<span class="ident" id="7892099">part</span><span class="op" id="7892103">,</span>&nbsp;<span class="ident" id="7892105">err</span><span class="op" id="7892108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892111">}</span><br>
<span class="lineno"></span><span class="op" id="7892113">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7892116">func</span>&nbsp;<span class="ident" id="7892121">TestWriterSetBoundary</span><span class="op" id="7892142">(</span><span class="ident" id="7892143">t</span>&nbsp;<span class="op" id="7892145">*</span><span class="ident" id="7892146">testing</span><span class="op" id="7892153">.</span><span class="ident" id="7892154">T</span><span class="op" id="7892155">)</span>&nbsp;<span class="op" id="7892157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892160">var</span>&nbsp;<span class="ident" id="7892164">b</span>&nbsp;<span class="ident" id="7892166">bytes</span><span class="op" id="7892171">.</span><span class="ident" id="7892172">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892180">w</span>&nbsp;<span class="op" id="7892182">:=</span>&nbsp;<span class="ident" id="7892185">NewWriter</span><span class="op" id="7892194">(</span><span class="op" id="7892195">&amp;</span><span class="ident" id="7892196">b</span><span class="op" id="7892197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892200">tests</span>&nbsp;<span class="op" id="7892206">:=</span>&nbsp;<span class="op" id="7892209">[</span><span class="op" id="7892210">]</span><span class="keyword" id="7892211">struct</span>&nbsp;<span class="op" id="7892218">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892222">b</span>&nbsp;&nbsp;<span class="builtintype" id="7892225">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892234">ok</span>&nbsp;<span class="builtintype" id="7892237">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892243">}</span><span class="op" id="7892244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892248">{</span><span class="string" id="7892249">&#34;abc&#34;</span><span class="op" id="7892254">,</span>&nbsp;<span class="builtintype" id="7892256">true</span><span class="op" id="7892260">}</span><span class="op" id="7892261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892265">{</span><span class="string" id="7892266">&#34;&#34;</span><span class="op" id="7892268">,</span>&nbsp;<span class="builtintype" id="7892270">false</span><span class="op" id="7892275">}</span><span class="op" id="7892276">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892280">{</span><span class="string" id="7892281">&#34;ung√ºltig&#34;</span><span class="op" id="7892292">,</span>&nbsp;<span class="builtintype" id="7892294">false</span><span class="op" id="7892299">}</span><span class="op" id="7892300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892304">{</span><span class="string" id="7892305">&#34;!&#34;</span><span class="op" id="7892308">,</span>&nbsp;<span class="builtintype" id="7892310">false</span><span class="op" id="7892315">}</span><span class="op" id="7892316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892320">{</span><span class="ident" id="7892321">strings</span><span class="op" id="7892328">.</span><span class="ident" id="7892329">Repeat</span><span class="op" id="7892335">(</span><span class="string" id="7892336">&#34;x&#34;</span><span class="op" id="7892339">,</span>&nbsp;<span class="num" id="7892341">69</span><span class="op" id="7892343">)</span><span class="op" id="7892344">,</span>&nbsp;<span class="builtintype" id="7892346">true</span><span class="op" id="7892350">}</span><span class="op" id="7892351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892355">{</span><span class="ident" id="7892356">strings</span><span class="op" id="7892363">.</span><span class="ident" id="7892364">Repeat</span><span class="op" id="7892370">(</span><span class="string" id="7892371">&#34;x&#34;</span><span class="op" id="7892374">,</span>&nbsp;<span class="num" id="7892376">70</span><span class="op" id="7892378">)</span><span class="op" id="7892379">,</span>&nbsp;<span class="builtintype" id="7892381">false</span><span class="op" id="7892386">}</span><span class="op" id="7892387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892391">{</span><span class="string" id="7892392">&#34;bad!ascii!&#34;</span><span class="op" id="7892404">,</span>&nbsp;<span class="builtintype" id="7892406">false</span><span class="op" id="7892411">}</span><span class="op" id="7892412">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892416">{</span><span class="string" id="7892417">&#34;my-separator&#34;</span><span class="op" id="7892431">,</span>&nbsp;<span class="builtintype" id="7892433">true</span><span class="op" id="7892437">}</span><span class="op" id="7892438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892444">for</span>&nbsp;<span class="ident" id="7892448">i</span><span class="op" id="7892449">,</span>&nbsp;<span class="ident" id="7892451">tt</span>&nbsp;<span class="op" id="7892454">:=</span>&nbsp;<span class="keyword" id="7892457">range</span>&nbsp;<span class="ident" id="7892463">tests</span>&nbsp;<span class="op" id="7892469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892473">err</span>&nbsp;<span class="op" id="7892477">:=</span>&nbsp;<span class="ident" id="7892480">w</span><span class="op" id="7892481">.</span><span class="ident" id="7892482">SetBoundary</span><span class="op" id="7892493">(</span><span class="ident" id="7892494">tt</span><span class="op" id="7892496">.</span><span class="ident" id="7892497">b</span><span class="op" id="7892498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892502">got</span>&nbsp;<span class="op" id="7892506">:=</span>&nbsp;<span class="ident" id="7892509">err</span>&nbsp;<span class="op" id="7892513">==</span>&nbsp;<span class="ident" id="7892516">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892522">if</span>&nbsp;<span class="ident" id="7892525">got</span>&nbsp;<span class="op" id="7892529">!=</span>&nbsp;<span class="ident" id="7892532">tt</span><span class="op" id="7892534">.</span><span class="ident" id="7892535">ok</span>&nbsp;<span class="op" id="7892538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892543">t</span><span class="op" id="7892544">.</span><span class="ident" id="7892545">Errorf</span><span class="op" id="7892551">(</span><span class="string" id="7892552">&#34;%d.&nbsp;boundary&nbsp;%q&nbsp;=&nbsp;%v&nbsp;(%v);&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7892588">,</span>&nbsp;<span class="ident" id="7892590">i</span><span class="op" id="7892591">,</span>&nbsp;<span class="ident" id="7892593">tt</span><span class="op" id="7892595">.</span><span class="ident" id="7892596">b</span><span class="op" id="7892597">,</span>&nbsp;<span class="ident" id="7892599">got</span><span class="op" id="7892602">,</span>&nbsp;<span class="ident" id="7892604">err</span><span class="op" id="7892607">,</span>&nbsp;<span class="ident" id="7892609">tt</span><span class="op" id="7892611">.</span><span class="ident" id="7892612">ok</span><span class="op" id="7892614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892618">}</span>&nbsp;<span class="keyword" id="7892620">else</span>&nbsp;<span class="keyword" id="7892625">if</span>&nbsp;<span class="ident" id="7892628">tt</span><span class="op" id="7892630">.</span><span class="ident" id="7892631">ok</span>&nbsp;<span class="op" id="7892634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892639">got</span>&nbsp;<span class="op" id="7892643">:=</span>&nbsp;<span class="ident" id="7892646">w</span><span class="op" id="7892647">.</span><span class="ident" id="7892648">Boundary</span><span class="op" id="7892656">(</span><span class="op" id="7892657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892662">if</span>&nbsp;<span class="ident" id="7892665">got</span>&nbsp;<span class="op" id="7892669">!=</span>&nbsp;<span class="ident" id="7892672">tt</span><span class="op" id="7892674">.</span><span class="ident" id="7892675">b</span>&nbsp;<span class="op" id="7892677">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892683">t</span><span class="op" id="7892684">.</span><span class="ident" id="7892685">Errorf</span><span class="op" id="7892691">(</span><span class="string" id="7892692">&#34;boundary&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7892716">,</span>&nbsp;<span class="ident" id="7892718">got</span><span class="op" id="7892721">,</span>&nbsp;<span class="ident" id="7892723">tt</span><span class="op" id="7892725">.</span><span class="ident" id="7892726">b</span><span class="op" id="7892727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892742">w</span><span class="op" id="7892743">.</span><span class="ident" id="7892744">Close</span><span class="op" id="7892749">(</span><span class="op" id="7892750">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892753">if</span>&nbsp;<span class="ident" id="7892756">got</span>&nbsp;<span class="op" id="7892760">:=</span>&nbsp;<span class="ident" id="7892763">b</span><span class="op" id="7892764">.</span><span class="ident" id="7892765">String</span><span class="op" id="7892771">(</span><span class="op" id="7892772">)</span><span class="op" id="7892773">;</span>&nbsp;<span class="op" id="7892775">!</span><span class="ident" id="7892776">strings</span><span class="op" id="7892783">.</span><span class="ident" id="7892784">Contains</span><span class="op" id="7892792">(</span><span class="ident" id="7892793">got</span><span class="op" id="7892796">,</span>&nbsp;<span class="string" id="7892798">&#34;\r\n--my-separator--\r\n&#34;</span><span class="op" id="7892824">)</span>&nbsp;<span class="op" id="7892826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892830">t</span><span class="op" id="7892831">.</span><span class="ident" id="7892832">Errorf</span><span class="op" id="7892838">(</span><span class="string" id="7892839">&#34;expected&nbsp;my-separator&nbsp;in&nbsp;output.&nbsp;got:&nbsp;%q&#34;</span><span class="op" id="7892881">,</span>&nbsp;<span class="ident" id="7892883">got</span><span class="op" id="7892886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892889">}</span><br>
<span class="lineno"></span><span class="op" id="7892891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7892894">func</span>&nbsp;<span class="ident" id="7892899">TestWriterBoundaryGoroutines</span><span class="op" id="7892927">(</span><span class="ident" id="7892928">t</span>&nbsp;<span class="op" id="7892930">*</span><span class="ident" id="7892931">testing</span><span class="op" id="7892938">.</span><span class="ident" id="7892939">T</span><span class="op" id="7892940">)</span>&nbsp;<span class="op" id="7892942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7892945">//&nbsp;Verify&nbsp;there&#39;s&nbsp;no&nbsp;data&nbsp;race&nbsp;accessing&nbsp;any&nbsp;lazy&nbsp;boundary&nbsp;if&nbsp;it&#39;s&nbsp;used&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893021">//&nbsp;different&nbsp;goroutines.&nbsp;This&nbsp;was&nbsp;previously&nbsp;broken&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893077">//&nbsp;https://codereview.appspot.com/95760043/&nbsp;and&nbsp;reverted&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893138">//&nbsp;https://codereview.appspot.com/117600043/</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893184">w</span>&nbsp;<span class="op" id="7893186">:=</span>&nbsp;<span class="ident" id="7893189">NewWriter</span><span class="op" id="7893198">(</span><span class="ident" id="7893199">ioutil</span><span class="op" id="7893205">.</span><span class="ident" id="7893206">Discard</span><span class="op" id="7893213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893216">done</span>&nbsp;<span class="op" id="7893221">:=</span>&nbsp;<span class="builtinfunc" id="7893224">make</span><span class="op" id="7893228">(</span><span class="keyword" id="7893229">chan</span>&nbsp;<span class="builtintype" id="7893234">int</span><span class="op" id="7893237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893240">go</span>&nbsp;<span class="keyword" id="7893243">func</span><span class="op" id="7893247">(</span><span class="op" id="7893248">)</span>&nbsp;<span class="op" id="7893250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893254">w</span><span class="op" id="7893255">.</span><span class="ident" id="7893256">CreateFormField</span><span class="op" id="7893271">(</span><span class="string" id="7893272">&#34;foo&#34;</span><span class="op" id="7893277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893281">done</span>&nbsp;<span class="op" id="7893286">&lt;-</span>&nbsp;<span class="num" id="7893289">1</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893292">}</span><span class="op" id="7893293">(</span><span class="op" id="7893294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893297">w</span><span class="op" id="7893298">.</span><span class="ident" id="7893299">Boundary</span><span class="op" id="7893307">(</span><span class="op" id="7893308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893311">&lt;-</span><span class="ident" id="7893313">done</span><br>
<span class="lineno"></span><span class="op" id="7893318">}</span>
</div>
</body>
</html>
