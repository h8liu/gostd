<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html" class="current">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6059679">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6059734">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6059788">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6059839">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6059895">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6059972">package</span>&nbsp;<span class="ident" id="6059980">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6059989">import</span>&nbsp;<span class="op" id="6059996">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6059999">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6060005">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6060015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6060018">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6060037">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6060096">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6060159">//</span><br>
<span class="lineno"></span><span class="comment" id="6060162">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6060226">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6060292">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6060364">//</span><br>
<span class="lineno">25</span><span class="comment" id="6060367">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6060431">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6060461">func</span>&nbsp;<span class="ident" id="6060466">Encode</span><span class="op" id="6060472">(</span><span class="ident" id="6060473">dst</span><span class="op" id="6060476">,</span>&nbsp;<span class="ident" id="6060478">src</span>&nbsp;<span class="op" id="6060482">[</span><span class="op" id="6060483">]</span><span class="builtintype" id="6060484">byte</span><span class="op" id="6060488">)</span>&nbsp;<span class="builtintype" id="6060490">int</span>&nbsp;<span class="op" id="6060494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060497">if</span>&nbsp;<span class="builtinfunc" id="6060500">len</span><span class="op" id="6060503">(</span><span class="ident" id="6060504">src</span><span class="op" id="6060507">)</span>&nbsp;<span class="op" id="6060509">==</span>&nbsp;<span class="num" id="6060512">0</span>&nbsp;<span class="op" id="6060514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060518">return</span>&nbsp;<span class="num" id="6060525">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060532">n</span>&nbsp;<span class="op" id="6060534">:=</span>&nbsp;<span class="num" id="6060537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060540">for</span>&nbsp;<span class="builtinfunc" id="6060544">len</span><span class="op" id="6060547">(</span><span class="ident" id="6060548">src</span><span class="op" id="6060551">)</span>&nbsp;<span class="op" id="6060553">&gt;</span>&nbsp;<span class="num" id="6060555">0</span>&nbsp;<span class="op" id="6060557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060561">dst</span><span class="op" id="6060564">[</span><span class="num" id="6060565">0</span><span class="op" id="6060566">]</span>&nbsp;<span class="op" id="6060568">=</span>&nbsp;<span class="num" id="6060570">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060574">dst</span><span class="op" id="6060577">[</span><span class="num" id="6060578">1</span><span class="op" id="6060579">]</span>&nbsp;<span class="op" id="6060581">=</span>&nbsp;<span class="num" id="6060583">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060587">dst</span><span class="op" id="6060590">[</span><span class="num" id="6060591">2</span><span class="op" id="6060592">]</span>&nbsp;<span class="op" id="6060594">=</span>&nbsp;<span class="num" id="6060596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060600">dst</span><span class="op" id="6060603">[</span><span class="num" id="6060604">3</span><span class="op" id="6060605">]</span>&nbsp;<span class="op" id="6060607">=</span>&nbsp;<span class="num" id="6060609">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060613">dst</span><span class="op" id="6060616">[</span><span class="num" id="6060617">4</span><span class="op" id="6060618">]</span>&nbsp;<span class="op" id="6060620">=</span>&nbsp;<span class="num" id="6060622">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060627">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060690">var</span>&nbsp;<span class="ident" id="6060694">v</span>&nbsp;<span class="builtintype" id="6060696">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060705">switch</span>&nbsp;<span class="builtinfunc" id="6060712">len</span><span class="op" id="6060715">(</span><span class="ident" id="6060716">src</span><span class="op" id="6060719">)</span>&nbsp;<span class="op" id="6060721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060725">default</span><span class="op" id="6060732">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060737">v</span>&nbsp;<span class="op" id="6060739">|=</span>&nbsp;<span class="builtintype" id="6060742">uint32</span><span class="op" id="6060748">(</span><span class="ident" id="6060749">src</span><span class="op" id="6060752">[</span><span class="num" id="6060753">3</span><span class="op" id="6060754">]</span><span class="op" id="6060755">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060760">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060774">case</span>&nbsp;<span class="num" id="6060779">3</span><span class="op" id="6060780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060785">v</span>&nbsp;<span class="op" id="6060787">|=</span>&nbsp;<span class="builtintype" id="6060790">uint32</span><span class="op" id="6060796">(</span><span class="ident" id="6060797">src</span><span class="op" id="6060800">[</span><span class="num" id="6060801">2</span><span class="op" id="6060802">]</span><span class="op" id="6060803">)</span>&nbsp;<span class="op" id="6060805">&lt;&lt;</span>&nbsp;<span class="num" id="6060808">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060813">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060827">case</span>&nbsp;<span class="num" id="6060832">2</span><span class="op" id="6060833">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060838">v</span>&nbsp;<span class="op" id="6060840">|=</span>&nbsp;<span class="builtintype" id="6060843">uint32</span><span class="op" id="6060849">(</span><span class="ident" id="6060850">src</span><span class="op" id="6060853">[</span><span class="num" id="6060854">1</span><span class="op" id="6060855">]</span><span class="op" id="6060856">)</span>&nbsp;<span class="op" id="6060858">&lt;&lt;</span>&nbsp;<span class="num" id="6060861">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060867">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060881">case</span>&nbsp;<span class="num" id="6060886">1</span><span class="op" id="6060887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060892">v</span>&nbsp;<span class="op" id="6060894">|=</span>&nbsp;<span class="builtintype" id="6060897">uint32</span><span class="op" id="6060903">(</span><span class="ident" id="6060904">src</span><span class="op" id="6060907">[</span><span class="num" id="6060908">0</span><span class="op" id="6060909">]</span><span class="op" id="6060910">)</span>&nbsp;<span class="op" id="6060912">&lt;&lt;</span>&nbsp;<span class="num" id="6060915">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060920">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060925">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060972">if</span>&nbsp;<span class="ident" id="6060975">v</span>&nbsp;<span class="op" id="6060977">==</span>&nbsp;<span class="num" id="6060980">0</span>&nbsp;<span class="op" id="6060982">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6060985">len</span><span class="op" id="6060988">(</span><span class="ident" id="6060989">src</span><span class="op" id="6060992">)</span>&nbsp;<span class="op" id="6060994">&gt;=</span>&nbsp;<span class="num" id="6060997">4</span>&nbsp;<span class="op" id="6060999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061004">dst</span><span class="op" id="6061007">[</span><span class="num" id="6061008">0</span><span class="op" id="6061009">]</span>&nbsp;<span class="op" id="6061011">=</span>&nbsp;<span class="string" id="6061013">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061020">dst</span>&nbsp;<span class="op" id="6061024">=</span>&nbsp;<span class="ident" id="6061026">dst</span><span class="op" id="6061029">[</span><span class="num" id="6061030">1</span><span class="op" id="6061031">:</span><span class="op" id="6061032">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061037">src</span>&nbsp;<span class="op" id="6061041">=</span>&nbsp;<span class="ident" id="6061043">src</span><span class="op" id="6061046">[</span><span class="num" id="6061047">4</span><span class="op" id="6061048">:</span><span class="op" id="6061049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061054">n</span><span class="op" id="6061055">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061061">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6061077">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061125">for</span>&nbsp;<span class="ident" id="6061129">i</span>&nbsp;<span class="op" id="6061131">:=</span>&nbsp;<span class="num" id="6061134">4</span><span class="op" id="6061135">;</span>&nbsp;<span class="ident" id="6061137">i</span>&nbsp;<span class="op" id="6061139">&gt;=</span>&nbsp;<span class="num" id="6061142">0</span><span class="op" id="6061143">;</span>&nbsp;<span class="ident" id="6061145">i</span><span class="op" id="6061146">--</span>&nbsp;<span class="op" id="6061149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061154">dst</span><span class="op" id="6061157">[</span><span class="ident" id="6061158">i</span><span class="op" id="6061159">]</span>&nbsp;<span class="op" id="6061161">=</span>&nbsp;<span class="string" id="6061163">&#39;!&#39;</span>&nbsp;<span class="op" id="6061167">+</span>&nbsp;<span class="builtintype" id="6061169">byte</span><span class="op" id="6061173">(</span><span class="ident" id="6061174">v</span><span class="op" id="6061175">%</span><span class="num" id="6061176">85</span><span class="op" id="6061178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061183">v</span>&nbsp;<span class="op" id="6061185">/=</span>&nbsp;<span class="num" id="6061188">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061193">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6061198">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061256">m</span>&nbsp;<span class="op" id="6061258">:=</span>&nbsp;<span class="num" id="6061261">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061265">if</span>&nbsp;<span class="builtinfunc" id="6061268">len</span><span class="op" id="6061271">(</span><span class="ident" id="6061272">src</span><span class="op" id="6061275">)</span>&nbsp;<span class="op" id="6061277">&lt;</span>&nbsp;<span class="num" id="6061279">4</span>&nbsp;<span class="op" id="6061281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061286">m</span>&nbsp;<span class="op" id="6061288">-=</span>&nbsp;<span class="num" id="6061291">4</span>&nbsp;<span class="op" id="6061293">-</span>&nbsp;<span class="builtinfunc" id="6061295">len</span><span class="op" id="6061298">(</span><span class="ident" id="6061299">src</span><span class="op" id="6061302">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061307">src</span>&nbsp;<span class="op" id="6061311">=</span>&nbsp;<span class="ident" id="6061313">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061319">}</span>&nbsp;<span class="keyword" id="6061321">else</span>&nbsp;<span class="op" id="6061326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061331">src</span>&nbsp;<span class="op" id="6061335">=</span>&nbsp;<span class="ident" id="6061337">src</span><span class="op" id="6061340">[</span><span class="num" id="6061341">4</span><span class="op" id="6061342">:</span><span class="op" id="6061343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061351">dst</span>&nbsp;<span class="op" id="6061355">=</span>&nbsp;<span class="ident" id="6061357">dst</span><span class="op" id="6061360">[</span><span class="ident" id="6061361">m</span><span class="op" id="6061362">:</span><span class="op" id="6061363">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061367">n</span>&nbsp;<span class="op" id="6061369">+=</span>&nbsp;<span class="ident" id="6061372">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061378">return</span>&nbsp;<span class="ident" id="6061385">n</span><br>
<span class="lineno"></span><span class="op" id="6061387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6061390">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6061468">func</span>&nbsp;<span class="ident" id="6061473">MaxEncodedLen</span><span class="op" id="6061486">(</span><span class="ident" id="6061487">n</span>&nbsp;<span class="builtintype" id="6061489">int</span><span class="op" id="6061492">)</span>&nbsp;<span class="builtintype" id="6061494">int</span>&nbsp;<span class="op" id="6061498">{</span>&nbsp;<span class="keyword" id="6061500">return</span>&nbsp;<span class="op" id="6061507">(</span><span class="ident" id="6061508">n</span>&nbsp;<span class="op" id="6061510">+</span>&nbsp;<span class="num" id="6061512">3</span><span class="op" id="6061513">)</span>&nbsp;<span class="op" id="6061515">/</span>&nbsp;<span class="num" id="6061517">4</span>&nbsp;<span class="op" id="6061519">*</span>&nbsp;<span class="num" id="6061521">5</span>&nbsp;<span class="op" id="6061523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6061526">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6061595">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6061657">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6061718">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6061786">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6061813">func</span>&nbsp;<span class="ident" id="6061818">NewEncoder</span><span class="op" id="6061828">(</span><span class="ident" id="6061829">w</span>&nbsp;<span class="ident" id="6061831">io</span><span class="op" id="6061833">.</span><span class="ident" id="6061834">Writer</span><span class="op" id="6061840">)</span>&nbsp;<span class="ident" id="6061842">io</span><span class="op" id="6061844">.</span><span class="ident" id="6061845">WriteCloser</span>&nbsp;<span class="op" id="6061857">{</span>&nbsp;<span class="keyword" id="6061859">return</span>&nbsp;<span class="op" id="6061866">&amp;</span><span class="ident" id="6061867">encoder</span><span class="op" id="6061874">{</span><span class="ident" id="6061875">w</span><span class="op" id="6061876">:</span>&nbsp;<span class="ident" id="6061878">w</span><span class="op" id="6061879">}</span>&nbsp;<span class="op" id="6061881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6061884">type</span>&nbsp;<span class="ident" id="6061889">encoder</span>&nbsp;<span class="keyword" id="6061897">struct</span>&nbsp;<span class="op" id="6061904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061907">err</span>&nbsp;&nbsp;<span class="builtintype" id="6061912">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061919">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6061924">io</span><span class="op" id="6061926">.</span><span class="ident" id="6061927">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061935">buf</span>&nbsp;&nbsp;<span class="op" id="6061940">[</span><span class="num" id="6061941">4</span><span class="op" id="6061942">]</span><span class="builtintype" id="6061943">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6061951">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061991">nbuf</span>&nbsp;<span class="builtintype" id="6061996">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6062007">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062034">out</span>&nbsp;&nbsp;<span class="op" id="6062039">[</span><span class="num" id="6062040">1024</span><span class="op" id="6062044">]</span><span class="builtintype" id="6062045">byte</span>&nbsp;<span class="comment" id="6062050">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6062067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6062070">func</span>&nbsp;<span class="op" id="6062075">(</span><span class="ident" id="6062076">e</span>&nbsp;<span class="op" id="6062078">*</span><span class="ident" id="6062079">encoder</span><span class="op" id="6062086">)</span>&nbsp;<span class="ident" id="6062088">Write</span><span class="op" id="6062093">(</span><span class="ident" id="6062094">p</span>&nbsp;<span class="op" id="6062096">[</span><span class="op" id="6062097">]</span><span class="builtintype" id="6062098">byte</span><span class="op" id="6062102">)</span>&nbsp;<span class="op" id="6062104">(</span><span class="ident" id="6062105">n</span>&nbsp;<span class="builtintype" id="6062107">int</span><span class="op" id="6062110">,</span>&nbsp;<span class="ident" id="6062112">err</span>&nbsp;<span class="builtintype" id="6062116">error</span><span class="op" id="6062121">)</span>&nbsp;<span class="op" id="6062123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062126">if</span>&nbsp;<span class="ident" id="6062129">e</span><span class="op" id="6062130">.</span><span class="ident" id="6062131">err</span>&nbsp;<span class="op" id="6062135">!=</span>&nbsp;<span class="ident" id="6062138">nil</span>&nbsp;<span class="op" id="6062142">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062146">return</span>&nbsp;<span class="num" id="6062153">0</span><span class="op" id="6062154">,</span>&nbsp;<span class="ident" id="6062156">e</span><span class="op" id="6062157">.</span><span class="ident" id="6062158">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062167">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062187">if</span>&nbsp;<span class="ident" id="6062190">e</span><span class="op" id="6062191">.</span><span class="ident" id="6062192">nbuf</span>&nbsp;<span class="op" id="6062197">&gt;</span>&nbsp;<span class="num" id="6062199">0</span>&nbsp;<span class="op" id="6062201">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062205">var</span>&nbsp;<span class="ident" id="6062209">i</span>&nbsp;<span class="builtintype" id="6062211">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062217">for</span>&nbsp;<span class="ident" id="6062221">i</span>&nbsp;<span class="op" id="6062223">=</span>&nbsp;<span class="num" id="6062225">0</span><span class="op" id="6062226">;</span>&nbsp;<span class="ident" id="6062228">i</span>&nbsp;<span class="op" id="6062230">&lt;</span>&nbsp;<span class="builtinfunc" id="6062232">len</span><span class="op" id="6062235">(</span><span class="ident" id="6062236">p</span><span class="op" id="6062237">)</span>&nbsp;<span class="op" id="6062239">&amp;&amp;</span>&nbsp;<span class="ident" id="6062242">e</span><span class="op" id="6062243">.</span><span class="ident" id="6062244">nbuf</span>&nbsp;<span class="op" id="6062249">&lt;</span>&nbsp;<span class="num" id="6062251">4</span><span class="op" id="6062252">;</span>&nbsp;<span class="ident" id="6062254">i</span><span class="op" id="6062255">++</span>&nbsp;<span class="op" id="6062258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062263">e</span><span class="op" id="6062264">.</span><span class="ident" id="6062265">buf</span><span class="op" id="6062268">[</span><span class="ident" id="6062269">e</span><span class="op" id="6062270">.</span><span class="ident" id="6062271">nbuf</span><span class="op" id="6062275">]</span>&nbsp;<span class="op" id="6062277">=</span>&nbsp;<span class="ident" id="6062279">p</span><span class="op" id="6062280">[</span><span class="ident" id="6062281">i</span><span class="op" id="6062282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062287">e</span><span class="op" id="6062288">.</span><span class="ident" id="6062289">nbuf</span><span class="op" id="6062293">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062298">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062302">n</span>&nbsp;<span class="op" id="6062304">+=</span>&nbsp;<span class="ident" id="6062307">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062311">p</span>&nbsp;<span class="op" id="6062313">=</span>&nbsp;<span class="ident" id="6062315">p</span><span class="op" id="6062316">[</span><span class="ident" id="6062317">i</span><span class="op" id="6062318">:</span><span class="op" id="6062319">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062323">if</span>&nbsp;<span class="ident" id="6062326">e</span><span class="op" id="6062327">.</span><span class="ident" id="6062328">nbuf</span>&nbsp;<span class="op" id="6062333">&lt;</span>&nbsp;<span class="num" id="6062335">4</span>&nbsp;<span class="op" id="6062337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062342">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062351">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062355">nout</span>&nbsp;<span class="op" id="6062360">:=</span>&nbsp;<span class="ident" id="6062363">Encode</span><span class="op" id="6062369">(</span><span class="ident" id="6062370">e</span><span class="op" id="6062371">.</span><span class="ident" id="6062372">out</span><span class="op" id="6062375">[</span><span class="num" id="6062376">0</span><span class="op" id="6062377">:</span><span class="op" id="6062378">]</span><span class="op" id="6062379">,</span>&nbsp;<span class="ident" id="6062381">e</span><span class="op" id="6062382">.</span><span class="ident" id="6062383">buf</span><span class="op" id="6062386">[</span><span class="num" id="6062387">0</span><span class="op" id="6062388">:</span><span class="op" id="6062389">]</span><span class="op" id="6062390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062394">if</span>&nbsp;<span class="ident" id="6062397">_</span><span class="op" id="6062398">,</span>&nbsp;<span class="ident" id="6062400">e</span><span class="op" id="6062401">.</span><span class="ident" id="6062402">err</span>&nbsp;<span class="op" id="6062406">=</span>&nbsp;<span class="ident" id="6062408">e</span><span class="op" id="6062409">.</span><span class="ident" id="6062410">w</span><span class="op" id="6062411">.</span><span class="ident" id="6062412">Write</span><span class="op" id="6062417">(</span><span class="ident" id="6062418">e</span><span class="op" id="6062419">.</span><span class="ident" id="6062420">out</span><span class="op" id="6062423">[</span><span class="num" id="6062424">0</span><span class="op" id="6062425">:</span><span class="ident" id="6062426">nout</span><span class="op" id="6062430">]</span><span class="op" id="6062431">)</span><span class="op" id="6062432">;</span>&nbsp;<span class="ident" id="6062434">e</span><span class="op" id="6062435">.</span><span class="ident" id="6062436">err</span>&nbsp;<span class="op" id="6062440">!=</span>&nbsp;<span class="ident" id="6062443">nil</span>&nbsp;<span class="op" id="6062447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062452">return</span>&nbsp;<span class="ident" id="6062459">n</span><span class="op" id="6062460">,</span>&nbsp;<span class="ident" id="6062462">e</span><span class="op" id="6062463">.</span><span class="ident" id="6062464">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062474">e</span><span class="op" id="6062475">.</span><span class="ident" id="6062476">nbuf</span>&nbsp;<span class="op" id="6062481">=</span>&nbsp;<span class="num" id="6062483">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062490">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062517">for</span>&nbsp;<span class="builtinfunc" id="6062521">len</span><span class="op" id="6062524">(</span><span class="ident" id="6062525">p</span><span class="op" id="6062526">)</span>&nbsp;<span class="op" id="6062528">&gt;=</span>&nbsp;<span class="num" id="6062531">4</span>&nbsp;<span class="op" id="6062533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062537">nn</span>&nbsp;<span class="op" id="6062540">:=</span>&nbsp;<span class="builtinfunc" id="6062543">len</span><span class="op" id="6062546">(</span><span class="ident" id="6062547">e</span><span class="op" id="6062548">.</span><span class="ident" id="6062549">out</span><span class="op" id="6062552">)</span>&nbsp;<span class="op" id="6062554">/</span>&nbsp;<span class="num" id="6062556">5</span>&nbsp;<span class="op" id="6062558">*</span>&nbsp;<span class="num" id="6062560">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062564">if</span>&nbsp;<span class="ident" id="6062567">nn</span>&nbsp;<span class="op" id="6062570">&gt;</span>&nbsp;<span class="builtinfunc" id="6062572">len</span><span class="op" id="6062575">(</span><span class="ident" id="6062576">p</span><span class="op" id="6062577">)</span>&nbsp;<span class="op" id="6062579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062584">nn</span>&nbsp;<span class="op" id="6062587">=</span>&nbsp;<span class="builtinfunc" id="6062589">len</span><span class="op" id="6062592">(</span><span class="ident" id="6062593">p</span><span class="op" id="6062594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062602">nn</span>&nbsp;<span class="op" id="6062605">-=</span>&nbsp;<span class="ident" id="6062608">nn</span>&nbsp;<span class="op" id="6062611">%</span>&nbsp;<span class="num" id="6062613">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062617">if</span>&nbsp;<span class="ident" id="6062620">nn</span>&nbsp;<span class="op" id="6062623">&gt;</span>&nbsp;<span class="num" id="6062625">0</span>&nbsp;<span class="op" id="6062627">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062632">nout</span>&nbsp;<span class="op" id="6062637">:=</span>&nbsp;<span class="ident" id="6062640">Encode</span><span class="op" id="6062646">(</span><span class="ident" id="6062647">e</span><span class="op" id="6062648">.</span><span class="ident" id="6062649">out</span><span class="op" id="6062652">[</span><span class="num" id="6062653">0</span><span class="op" id="6062654">:</span><span class="op" id="6062655">]</span><span class="op" id="6062656">,</span>&nbsp;<span class="ident" id="6062658">p</span><span class="op" id="6062659">[</span><span class="num" id="6062660">0</span><span class="op" id="6062661">:</span><span class="ident" id="6062662">nn</span><span class="op" id="6062664">]</span><span class="op" id="6062665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062670">if</span>&nbsp;<span class="ident" id="6062673">_</span><span class="op" id="6062674">,</span>&nbsp;<span class="ident" id="6062676">e</span><span class="op" id="6062677">.</span><span class="ident" id="6062678">err</span>&nbsp;<span class="op" id="6062682">=</span>&nbsp;<span class="ident" id="6062684">e</span><span class="op" id="6062685">.</span><span class="ident" id="6062686">w</span><span class="op" id="6062687">.</span><span class="ident" id="6062688">Write</span><span class="op" id="6062693">(</span><span class="ident" id="6062694">e</span><span class="op" id="6062695">.</span><span class="ident" id="6062696">out</span><span class="op" id="6062699">[</span><span class="num" id="6062700">0</span><span class="op" id="6062701">:</span><span class="ident" id="6062702">nout</span><span class="op" id="6062706">]</span><span class="op" id="6062707">)</span><span class="op" id="6062708">;</span>&nbsp;<span class="ident" id="6062710">e</span><span class="op" id="6062711">.</span><span class="ident" id="6062712">err</span>&nbsp;<span class="op" id="6062716">!=</span>&nbsp;<span class="ident" id="6062719">nil</span>&nbsp;<span class="op" id="6062723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062729">return</span>&nbsp;<span class="ident" id="6062736">n</span><span class="op" id="6062737">,</span>&nbsp;<span class="ident" id="6062739">e</span><span class="op" id="6062740">.</span><span class="ident" id="6062741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062752">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062756">n</span>&nbsp;<span class="op" id="6062758">+=</span>&nbsp;<span class="ident" id="6062761">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062766">p</span>&nbsp;<span class="op" id="6062768">=</span>&nbsp;<span class="ident" id="6062770">p</span><span class="op" id="6062771">[</span><span class="ident" id="6062772">nn</span><span class="op" id="6062774">:</span><span class="op" id="6062775">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062782">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062803">for</span>&nbsp;<span class="ident" id="6062807">i</span>&nbsp;<span class="op" id="6062809">:=</span>&nbsp;<span class="num" id="6062812">0</span><span class="op" id="6062813">;</span>&nbsp;<span class="ident" id="6062815">i</span>&nbsp;<span class="op" id="6062817">&lt;</span>&nbsp;<span class="builtinfunc" id="6062819">len</span><span class="op" id="6062822">(</span><span class="ident" id="6062823">p</span><span class="op" id="6062824">)</span><span class="op" id="6062825">;</span>&nbsp;<span class="ident" id="6062827">i</span><span class="op" id="6062828">++</span>&nbsp;<span class="op" id="6062831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062835">e</span><span class="op" id="6062836">.</span><span class="ident" id="6062837">buf</span><span class="op" id="6062840">[</span><span class="ident" id="6062841">i</span><span class="op" id="6062842">]</span>&nbsp;<span class="op" id="6062844">=</span>&nbsp;<span class="ident" id="6062846">p</span><span class="op" id="6062847">[</span><span class="ident" id="6062848">i</span><span class="op" id="6062849">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062855">e</span><span class="op" id="6062856">.</span><span class="ident" id="6062857">nbuf</span>&nbsp;<span class="op" id="6062862">=</span>&nbsp;<span class="builtinfunc" id="6062864">len</span><span class="op" id="6062867">(</span><span class="ident" id="6062868">p</span><span class="op" id="6062869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062872">n</span>&nbsp;<span class="op" id="6062874">+=</span>&nbsp;<span class="builtinfunc" id="6062877">len</span><span class="op" id="6062880">(</span><span class="ident" id="6062881">p</span><span class="op" id="6062882">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062885">return</span><br>
<span class="lineno"></span><span class="op" id="6062892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6062895">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6062949">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6063002">func</span>&nbsp;<span class="op" id="6063007">(</span><span class="ident" id="6063008">e</span>&nbsp;<span class="op" id="6063010">*</span><span class="ident" id="6063011">encoder</span><span class="op" id="6063018">)</span>&nbsp;<span class="ident" id="6063020">Close</span><span class="op" id="6063025">(</span><span class="op" id="6063026">)</span>&nbsp;<span class="builtintype" id="6063028">error</span>&nbsp;<span class="op" id="6063034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6063037">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063094">if</span>&nbsp;<span class="ident" id="6063097">e</span><span class="op" id="6063098">.</span><span class="ident" id="6063099">err</span>&nbsp;<span class="op" id="6063103">==</span>&nbsp;<span class="ident" id="6063106">nil</span>&nbsp;<span class="op" id="6063110">&amp;&amp;</span>&nbsp;<span class="ident" id="6063113">e</span><span class="op" id="6063114">.</span><span class="ident" id="6063115">nbuf</span>&nbsp;<span class="op" id="6063120">&gt;</span>&nbsp;<span class="num" id="6063122">0</span>&nbsp;<span class="op" id="6063124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063128">nout</span>&nbsp;<span class="op" id="6063133">:=</span>&nbsp;<span class="ident" id="6063136">Encode</span><span class="op" id="6063142">(</span><span class="ident" id="6063143">e</span><span class="op" id="6063144">.</span><span class="ident" id="6063145">out</span><span class="op" id="6063148">[</span><span class="num" id="6063149">0</span><span class="op" id="6063150">:</span><span class="op" id="6063151">]</span><span class="op" id="6063152">,</span>&nbsp;<span class="ident" id="6063154">e</span><span class="op" id="6063155">.</span><span class="ident" id="6063156">buf</span><span class="op" id="6063159">[</span><span class="num" id="6063160">0</span><span class="op" id="6063161">:</span><span class="ident" id="6063162">e</span><span class="op" id="6063163">.</span><span class="ident" id="6063164">nbuf</span><span class="op" id="6063168">]</span><span class="op" id="6063169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063173">e</span><span class="op" id="6063174">.</span><span class="ident" id="6063175">nbuf</span>&nbsp;<span class="op" id="6063180">=</span>&nbsp;<span class="num" id="6063182">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063186">_</span><span class="op" id="6063187">,</span>&nbsp;<span class="ident" id="6063189">e</span><span class="op" id="6063190">.</span><span class="ident" id="6063191">err</span>&nbsp;<span class="op" id="6063195">=</span>&nbsp;<span class="ident" id="6063197">e</span><span class="op" id="6063198">.</span><span class="ident" id="6063199">w</span><span class="op" id="6063200">.</span><span class="ident" id="6063201">Write</span><span class="op" id="6063206">(</span><span class="ident" id="6063207">e</span><span class="op" id="6063208">.</span><span class="ident" id="6063209">out</span><span class="op" id="6063212">[</span><span class="num" id="6063213">0</span><span class="op" id="6063214">:</span><span class="ident" id="6063215">nout</span><span class="op" id="6063219">]</span><span class="op" id="6063220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063226">return</span>&nbsp;<span class="ident" id="6063233">e</span><span class="op" id="6063234">.</span><span class="ident" id="6063235">err</span><br>
<span class="lineno"></span><span class="op" id="6063239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6063242">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063261">type</span>&nbsp;<span class="ident" id="6063266">CorruptInputError</span>&nbsp;<span class="ident" id="6063284">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6063291">func</span>&nbsp;<span class="op" id="6063296">(</span><span class="ident" id="6063297">e</span>&nbsp;<span class="ident" id="6063299">CorruptInputError</span><span class="op" id="6063316">)</span>&nbsp;<span class="ident" id="6063318">Error</span><span class="op" id="6063323">(</span><span class="op" id="6063324">)</span>&nbsp;<span class="builtintype" id="6063326">string</span>&nbsp;<span class="op" id="6063333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063336">return</span>&nbsp;<span class="string" id="6063343">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6063381">+</span>&nbsp;<span class="ident" id="6063383">strconv</span><span class="op" id="6063390">.</span><span class="ident" id="6063391">FormatInt</span><span class="op" id="6063400">(</span><span class="ident" id="6063401">int64</span><span class="op" id="6063406">(</span><span class="ident" id="6063407">e</span><span class="op" id="6063408">)</span><span class="op" id="6063409">,</span>&nbsp;<span class="num" id="6063411">10</span><span class="op" id="6063413">)</span><br>
<span class="lineno"></span><span class="op" id="6063415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6063418">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6063476">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6063537">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6063601">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6063666">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6063721">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6063785">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6063846">//</span><br>
<span class="lineno"></span><span class="comment" id="6063849">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6063909">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6063971">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6064028">//</span><br>
<span class="lineno"></span><span class="comment" id="6064031">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6064089">//</span><br>
<span class="lineno"></span><span class="keyword" id="6064092">func</span>&nbsp;<span class="ident" id="6064097">Decode</span><span class="op" id="6064103">(</span><span class="ident" id="6064104">dst</span><span class="op" id="6064107">,</span>&nbsp;<span class="ident" id="6064109">src</span>&nbsp;<span class="op" id="6064113">[</span><span class="op" id="6064114">]</span><span class="builtintype" id="6064115">byte</span><span class="op" id="6064119">,</span>&nbsp;<span class="ident" id="6064121">flush</span>&nbsp;<span class="builtintype" id="6064127">bool</span><span class="op" id="6064131">)</span>&nbsp;<span class="op" id="6064133">(</span><span class="ident" id="6064134">ndst</span><span class="op" id="6064138">,</span>&nbsp;<span class="ident" id="6064140">nsrc</span>&nbsp;<span class="builtintype" id="6064145">int</span><span class="op" id="6064148">,</span>&nbsp;<span class="ident" id="6064150">err</span>&nbsp;<span class="builtintype" id="6064154">error</span><span class="op" id="6064159">)</span>&nbsp;<span class="op" id="6064161">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064164">var</span>&nbsp;<span class="ident" id="6064168">v</span>&nbsp;<span class="builtintype" id="6064170">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064178">var</span>&nbsp;<span class="ident" id="6064182">nb</span>&nbsp;<span class="builtintype" id="6064185">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064190">for</span>&nbsp;<span class="ident" id="6064194">i</span><span class="op" id="6064195">,</span>&nbsp;<span class="ident" id="6064197">b</span>&nbsp;<span class="op" id="6064199">:=</span>&nbsp;<span class="keyword" id="6064202">range</span>&nbsp;<span class="ident" id="6064208">src</span>&nbsp;<span class="op" id="6064212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064216">if</span>&nbsp;<span class="builtinfunc" id="6064219">len</span><span class="op" id="6064222">(</span><span class="ident" id="6064223">dst</span><span class="op" id="6064226">)</span><span class="op" id="6064227">-</span><span class="ident" id="6064228">ndst</span>&nbsp;<span class="op" id="6064233">&lt;</span>&nbsp;<span class="num" id="6064235">4</span>&nbsp;<span class="op" id="6064237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064242">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064255">switch</span>&nbsp;<span class="op" id="6064262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064266">case</span>&nbsp;<span class="ident" id="6064271">b</span>&nbsp;<span class="op" id="6064273">&lt;=</span>&nbsp;<span class="string" id="6064276">&#39;&nbsp;&#39;</span><span class="op" id="6064279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064284">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064295">case</span>&nbsp;<span class="ident" id="6064300">b</span>&nbsp;<span class="op" id="6064302">==</span>&nbsp;<span class="string" id="6064305">&#39;z&#39;</span>&nbsp;<span class="op" id="6064309">&amp;&amp;</span>&nbsp;<span class="ident" id="6064312">nb</span>&nbsp;<span class="op" id="6064315">==</span>&nbsp;<span class="num" id="6064318">0</span><span class="op" id="6064319">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064324">nb</span>&nbsp;<span class="op" id="6064327">=</span>&nbsp;<span class="num" id="6064329">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064334">v</span>&nbsp;<span class="op" id="6064336">=</span>&nbsp;<span class="num" id="6064338">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064342">case</span>&nbsp;<span class="string" id="6064347">&#39;!&#39;</span>&nbsp;<span class="op" id="6064351">&lt;=</span>&nbsp;<span class="ident" id="6064354">b</span>&nbsp;<span class="op" id="6064356">&amp;&amp;</span>&nbsp;<span class="ident" id="6064359">b</span>&nbsp;<span class="op" id="6064361">&lt;=</span>&nbsp;<span class="string" id="6064364">&#39;u&#39;</span><span class="op" id="6064367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064372">v</span>&nbsp;<span class="op" id="6064374">=</span>&nbsp;<span class="ident" id="6064376">v</span><span class="op" id="6064377">*</span><span class="num" id="6064378">85</span>&nbsp;<span class="op" id="6064381">+</span>&nbsp;<span class="builtintype" id="6064383">uint32</span><span class="op" id="6064389">(</span><span class="ident" id="6064390">b</span><span class="op" id="6064391">-</span><span class="string" id="6064392">&#39;!&#39;</span><span class="op" id="6064395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064400">nb</span><span class="op" id="6064402">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064407">default</span><span class="op" id="6064414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064419">return</span>&nbsp;<span class="num" id="6064426">0</span><span class="op" id="6064427">,</span>&nbsp;<span class="num" id="6064429">0</span><span class="op" id="6064430">,</span>&nbsp;<span class="ident" id="6064432">CorruptInputError</span><span class="op" id="6064449">(</span><span class="ident" id="6064450">i</span><span class="op" id="6064451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064459">if</span>&nbsp;<span class="ident" id="6064462">nb</span>&nbsp;<span class="op" id="6064465">==</span>&nbsp;<span class="num" id="6064468">5</span>&nbsp;<span class="op" id="6064470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064475">nsrc</span>&nbsp;<span class="op" id="6064480">=</span>&nbsp;<span class="ident" id="6064482">i</span>&nbsp;<span class="op" id="6064484">+</span>&nbsp;<span class="num" id="6064486">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064491">dst</span><span class="op" id="6064494">[</span><span class="ident" id="6064495">ndst</span><span class="op" id="6064499">]</span>&nbsp;<span class="op" id="6064501">=</span>&nbsp;<span class="builtintype" id="6064503">byte</span><span class="op" id="6064507">(</span><span class="ident" id="6064508">v</span>&nbsp;<span class="op" id="6064510">&gt;&gt;</span>&nbsp;<span class="num" id="6064513">24</span><span class="op" id="6064515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064520">dst</span><span class="op" id="6064523">[</span><span class="ident" id="6064524">ndst</span><span class="op" id="6064528">+</span><span class="num" id="6064529">1</span><span class="op" id="6064530">]</span>&nbsp;<span class="op" id="6064532">=</span>&nbsp;<span class="builtintype" id="6064534">byte</span><span class="op" id="6064538">(</span><span class="ident" id="6064539">v</span>&nbsp;<span class="op" id="6064541">&gt;&gt;</span>&nbsp;<span class="num" id="6064544">16</span><span class="op" id="6064546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064551">dst</span><span class="op" id="6064554">[</span><span class="ident" id="6064555">ndst</span><span class="op" id="6064559">+</span><span class="num" id="6064560">2</span><span class="op" id="6064561">]</span>&nbsp;<span class="op" id="6064563">=</span>&nbsp;<span class="builtintype" id="6064565">byte</span><span class="op" id="6064569">(</span><span class="ident" id="6064570">v</span>&nbsp;<span class="op" id="6064572">&gt;&gt;</span>&nbsp;<span class="num" id="6064575">8</span><span class="op" id="6064576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064581">dst</span><span class="op" id="6064584">[</span><span class="ident" id="6064585">ndst</span><span class="op" id="6064589">+</span><span class="num" id="6064590">3</span><span class="op" id="6064591">]</span>&nbsp;<span class="op" id="6064593">=</span>&nbsp;<span class="builtintype" id="6064595">byte</span><span class="op" id="6064599">(</span><span class="ident" id="6064600">v</span><span class="op" id="6064601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064606">ndst</span>&nbsp;<span class="op" id="6064611">+=</span>&nbsp;<span class="num" id="6064614">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064619">nb</span>&nbsp;<span class="op" id="6064622">=</span>&nbsp;<span class="num" id="6064624">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064629">v</span>&nbsp;<span class="op" id="6064631">=</span>&nbsp;<span class="num" id="6064633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064643">if</span>&nbsp;<span class="ident" id="6064646">flush</span>&nbsp;<span class="op" id="6064652">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064656">nsrc</span>&nbsp;<span class="op" id="6064661">=</span>&nbsp;<span class="builtinfunc" id="6064663">len</span><span class="op" id="6064666">(</span><span class="ident" id="6064667">src</span><span class="op" id="6064670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064674">if</span>&nbsp;<span class="ident" id="6064677">nb</span>&nbsp;<span class="op" id="6064680">&gt;</span>&nbsp;<span class="num" id="6064682">0</span>&nbsp;<span class="op" id="6064684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064689">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064743">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064792">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064843">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064897">if</span>&nbsp;<span class="ident" id="6064900">nb</span>&nbsp;<span class="op" id="6064903">==</span>&nbsp;<span class="num" id="6064906">1</span>&nbsp;<span class="op" id="6064908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064914">return</span>&nbsp;<span class="num" id="6064921">0</span><span class="op" id="6064922">,</span>&nbsp;<span class="num" id="6064924">0</span><span class="op" id="6064925">,</span>&nbsp;<span class="ident" id="6064927">CorruptInputError</span><span class="op" id="6064944">(</span><span class="builtinfunc" id="6064945">len</span><span class="op" id="6064948">(</span><span class="ident" id="6064949">src</span><span class="op" id="6064952">)</span><span class="op" id="6064953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064963">for</span>&nbsp;<span class="ident" id="6064967">i</span>&nbsp;<span class="op" id="6064969">:=</span>&nbsp;<span class="ident" id="6064972">nb</span><span class="op" id="6064974">;</span>&nbsp;<span class="ident" id="6064976">i</span>&nbsp;<span class="op" id="6064978">&lt;</span>&nbsp;<span class="num" id="6064980">5</span><span class="op" id="6064981">;</span>&nbsp;<span class="ident" id="6064983">i</span><span class="op" id="6064984">++</span>&nbsp;<span class="op" id="6064987">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064993">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065047">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065105">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065162">v</span>&nbsp;<span class="op" id="6065164">=</span>&nbsp;<span class="ident" id="6065166">v</span><span class="op" id="6065167">*</span><span class="num" id="6065168">85</span>&nbsp;<span class="op" id="6065171">+</span>&nbsp;<span class="num" id="6065173">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065179">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065184">for</span>&nbsp;<span class="ident" id="6065188">i</span>&nbsp;<span class="op" id="6065190">:=</span>&nbsp;<span class="num" id="6065193">0</span><span class="op" id="6065194">;</span>&nbsp;<span class="ident" id="6065196">i</span>&nbsp;<span class="op" id="6065198">&lt;</span>&nbsp;<span class="ident" id="6065200">nb</span><span class="op" id="6065202">-</span><span class="num" id="6065203">1</span><span class="op" id="6065204">;</span>&nbsp;<span class="ident" id="6065206">i</span><span class="op" id="6065207">++</span>&nbsp;<span class="op" id="6065210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065216">dst</span><span class="op" id="6065219">[</span><span class="ident" id="6065220">ndst</span><span class="op" id="6065224">]</span>&nbsp;<span class="op" id="6065226">=</span>&nbsp;<span class="builtintype" id="6065228">byte</span><span class="op" id="6065232">(</span><span class="ident" id="6065233">v</span>&nbsp;<span class="op" id="6065235">&gt;&gt;</span>&nbsp;<span class="num" id="6065238">24</span><span class="op" id="6065240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065246">v</span>&nbsp;<span class="op" id="6065248">&lt;&lt;=</span>&nbsp;<span class="num" id="6065252">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065258">ndst</span><span class="op" id="6065262">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065268">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065278">return</span><br>
<span class="lineno"></span><span class="op" id="6065285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6065288">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6065343">func</span>&nbsp;<span class="ident" id="6065348">NewDecoder</span><span class="op" id="6065358">(</span><span class="ident" id="6065359">r</span>&nbsp;<span class="ident" id="6065361">io</span><span class="op" id="6065363">.</span><span class="ident" id="6065364">Reader</span><span class="op" id="6065370">)</span>&nbsp;<span class="ident" id="6065372">io</span><span class="op" id="6065374">.</span><span class="ident" id="6065375">Reader</span>&nbsp;<span class="op" id="6065382">{</span>&nbsp;<span class="keyword" id="6065384">return</span>&nbsp;<span class="op" id="6065391">&amp;</span><span class="ident" id="6065392">decoder</span><span class="op" id="6065399">{</span><span class="ident" id="6065400">r</span><span class="op" id="6065401">:</span>&nbsp;<span class="ident" id="6065403">r</span><span class="op" id="6065404">}</span>&nbsp;<span class="op" id="6065406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065409">type</span>&nbsp;<span class="ident" id="6065414">decoder</span>&nbsp;<span class="keyword" id="6065422">struct</span>&nbsp;<span class="op" id="6065429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065432">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6065440">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065447">readErr</span>&nbsp;<span class="builtintype" id="6065455">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065462">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6065470">io</span><span class="op" id="6065472">.</span><span class="ident" id="6065473">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065481">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065489">[</span><span class="num" id="6065490">1024</span><span class="op" id="6065494">]</span><span class="builtintype" id="6065495">byte</span>&nbsp;<span class="comment" id="6065500">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065519">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6065527">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065532">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6065540">[</span><span class="op" id="6065541">]</span><span class="builtintype" id="6065542">byte</span>&nbsp;<span class="comment" id="6065547">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065575">outbuf</span>&nbsp;&nbsp;<span class="op" id="6065583">[</span><span class="num" id="6065584">1024</span><span class="op" id="6065588">]</span><span class="builtintype" id="6065589">byte</span><br>
<span class="lineno"></span><span class="op" id="6065594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065597">func</span>&nbsp;<span class="op" id="6065602">(</span><span class="ident" id="6065603">d</span>&nbsp;<span class="op" id="6065605">*</span><span class="ident" id="6065606">decoder</span><span class="op" id="6065613">)</span>&nbsp;<span class="ident" id="6065615">Read</span><span class="op" id="6065619">(</span><span class="ident" id="6065620">p</span>&nbsp;<span class="op" id="6065622">[</span><span class="op" id="6065623">]</span><span class="builtintype" id="6065624">byte</span><span class="op" id="6065628">)</span>&nbsp;<span class="op" id="6065630">(</span><span class="ident" id="6065631">n</span>&nbsp;<span class="builtintype" id="6065633">int</span><span class="op" id="6065636">,</span>&nbsp;<span class="ident" id="6065638">err</span>&nbsp;<span class="builtintype" id="6065642">error</span><span class="op" id="6065647">)</span>&nbsp;<span class="op" id="6065649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065652">if</span>&nbsp;<span class="builtinfunc" id="6065655">len</span><span class="op" id="6065658">(</span><span class="ident" id="6065659">p</span><span class="op" id="6065660">)</span>&nbsp;<span class="op" id="6065662">==</span>&nbsp;<span class="num" id="6065665">0</span>&nbsp;<span class="op" id="6065667">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065671">return</span>&nbsp;<span class="num" id="6065678">0</span><span class="op" id="6065679">,</span>&nbsp;<span class="ident" id="6065681">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065689">if</span>&nbsp;<span class="ident" id="6065692">d</span><span class="op" id="6065693">.</span><span class="ident" id="6065694">err</span>&nbsp;<span class="op" id="6065698">!=</span>&nbsp;<span class="ident" id="6065701">nil</span>&nbsp;<span class="op" id="6065705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065709">return</span>&nbsp;<span class="num" id="6065716">0</span><span class="op" id="6065717">,</span>&nbsp;<span class="ident" id="6065719">d</span><span class="op" id="6065720">.</span><span class="ident" id="6065721">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065726">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065730">for</span>&nbsp;<span class="op" id="6065734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065738">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065782">if</span>&nbsp;<span class="builtinfunc" id="6065785">len</span><span class="op" id="6065788">(</span><span class="ident" id="6065789">d</span><span class="op" id="6065790">.</span><span class="ident" id="6065791">out</span><span class="op" id="6065794">)</span>&nbsp;<span class="op" id="6065796">&gt;</span>&nbsp;<span class="num" id="6065798">0</span>&nbsp;<span class="op" id="6065800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065805">n</span>&nbsp;<span class="op" id="6065807">=</span>&nbsp;<span class="builtinfunc" id="6065809">copy</span><span class="op" id="6065813">(</span><span class="ident" id="6065814">p</span><span class="op" id="6065815">,</span>&nbsp;<span class="ident" id="6065817">d</span><span class="op" id="6065818">.</span><span class="ident" id="6065819">out</span><span class="op" id="6065822">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065827">d</span><span class="op" id="6065828">.</span><span class="ident" id="6065829">out</span>&nbsp;<span class="op" id="6065833">=</span>&nbsp;<span class="ident" id="6065835">d</span><span class="op" id="6065836">.</span><span class="ident" id="6065837">out</span><span class="op" id="6065840">[</span><span class="ident" id="6065841">n</span><span class="op" id="6065842">:</span><span class="op" id="6065843">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065848">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065862">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065905">var</span>&nbsp;<span class="ident" id="6065909">nn</span><span class="op" id="6065911">,</span>&nbsp;<span class="ident" id="6065913">nsrc</span><span class="op" id="6065917">,</span>&nbsp;<span class="ident" id="6065919">ndst</span>&nbsp;<span class="builtintype" id="6065924">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065930">if</span>&nbsp;<span class="ident" id="6065933">d</span><span class="op" id="6065934">.</span><span class="ident" id="6065935">nbuf</span>&nbsp;<span class="op" id="6065940">&gt;</span>&nbsp;<span class="num" id="6065942">0</span>&nbsp;<span class="op" id="6065944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065949">ndst</span><span class="op" id="6065953">,</span>&nbsp;<span class="ident" id="6065955">nsrc</span><span class="op" id="6065959">,</span>&nbsp;<span class="ident" id="6065961">d</span><span class="op" id="6065962">.</span><span class="ident" id="6065963">err</span>&nbsp;<span class="op" id="6065967">=</span>&nbsp;<span class="ident" id="6065969">Decode</span><span class="op" id="6065975">(</span><span class="ident" id="6065976">d</span><span class="op" id="6065977">.</span><span class="ident" id="6065978">outbuf</span><span class="op" id="6065984">[</span><span class="num" id="6065985">0</span><span class="op" id="6065986">:</span><span class="op" id="6065987">]</span><span class="op" id="6065988">,</span>&nbsp;<span class="ident" id="6065990">d</span><span class="op" id="6065991">.</span><span class="ident" id="6065992">buf</span><span class="op" id="6065995">[</span><span class="num" id="6065996">0</span><span class="op" id="6065997">:</span><span class="ident" id="6065998">d</span><span class="op" id="6065999">.</span><span class="ident" id="6066000">nbuf</span><span class="op" id="6066004">]</span><span class="op" id="6066005">,</span>&nbsp;<span class="ident" id="6066007">d</span><span class="op" id="6066008">.</span><span class="ident" id="6066009">readErr</span>&nbsp;<span class="op" id="6066017">!=</span>&nbsp;<span class="ident" id="6066020">nil</span><span class="op" id="6066023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066028">if</span>&nbsp;<span class="ident" id="6066031">ndst</span>&nbsp;<span class="op" id="6066036">&gt;</span>&nbsp;<span class="num" id="6066038">0</span>&nbsp;<span class="op" id="6066040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066046">d</span><span class="op" id="6066047">.</span><span class="ident" id="6066048">out</span>&nbsp;<span class="op" id="6066052">=</span>&nbsp;<span class="ident" id="6066054">d</span><span class="op" id="6066055">.</span><span class="ident" id="6066056">outbuf</span><span class="op" id="6066062">[</span><span class="num" id="6066063">0</span><span class="op" id="6066064">:</span><span class="ident" id="6066065">ndst</span><span class="op" id="6066069">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066075">d</span><span class="op" id="6066076">.</span><span class="ident" id="6066077">nbuf</span>&nbsp;<span class="op" id="6066082">=</span>&nbsp;<span class="builtinfunc" id="6066084">copy</span><span class="op" id="6066088">(</span><span class="ident" id="6066089">d</span><span class="op" id="6066090">.</span><span class="ident" id="6066091">buf</span><span class="op" id="6066094">[</span><span class="num" id="6066095">0</span><span class="op" id="6066096">:</span><span class="op" id="6066097">]</span><span class="op" id="6066098">,</span>&nbsp;<span class="ident" id="6066100">d</span><span class="op" id="6066101">.</span><span class="ident" id="6066102">buf</span><span class="op" id="6066105">[</span><span class="ident" id="6066106">nsrc</span><span class="op" id="6066110">:</span><span class="ident" id="6066111">d</span><span class="op" id="6066112">.</span><span class="ident" id="6066113">nbuf</span><span class="op" id="6066117">]</span><span class="op" id="6066118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066124">continue</span>&nbsp;<span class="comment" id="6066133">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066164">if</span>&nbsp;<span class="ident" id="6066167">ndst</span>&nbsp;<span class="op" id="6066172">==</span>&nbsp;<span class="num" id="6066175">0</span>&nbsp;<span class="op" id="6066177">&amp;&amp;</span>&nbsp;<span class="ident" id="6066180">d</span><span class="op" id="6066181">.</span><span class="ident" id="6066182">err</span>&nbsp;<span class="op" id="6066186">==</span>&nbsp;<span class="ident" id="6066189">nil</span>&nbsp;<span class="op" id="6066193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066199">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066271">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066329">off</span>&nbsp;<span class="op" id="6066333">:=</span>&nbsp;<span class="num" id="6066336">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066342">for</span>&nbsp;<span class="ident" id="6066346">i</span>&nbsp;<span class="op" id="6066348">:=</span>&nbsp;<span class="num" id="6066351">0</span><span class="op" id="6066352">;</span>&nbsp;<span class="ident" id="6066354">i</span>&nbsp;<span class="op" id="6066356">&lt;</span>&nbsp;<span class="ident" id="6066358">d</span><span class="op" id="6066359">.</span><span class="ident" id="6066360">nbuf</span><span class="op" id="6066364">;</span>&nbsp;<span class="ident" id="6066366">i</span><span class="op" id="6066367">++</span>&nbsp;<span class="op" id="6066370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066377">if</span>&nbsp;<span class="ident" id="6066380">d</span><span class="op" id="6066381">.</span><span class="ident" id="6066382">buf</span><span class="op" id="6066385">[</span><span class="ident" id="6066386">i</span><span class="op" id="6066387">]</span>&nbsp;<span class="op" id="6066389">&gt;</span>&nbsp;<span class="string" id="6066391">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6066395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066403">d</span><span class="op" id="6066404">.</span><span class="ident" id="6066405">buf</span><span class="op" id="6066408">[</span><span class="ident" id="6066409">off</span><span class="op" id="6066412">]</span>&nbsp;<span class="op" id="6066414">=</span>&nbsp;<span class="ident" id="6066416">d</span><span class="op" id="6066417">.</span><span class="ident" id="6066418">buf</span><span class="op" id="6066421">[</span><span class="ident" id="6066422">i</span><span class="op" id="6066423">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066431">off</span><span class="op" id="6066434">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066454">d</span><span class="op" id="6066455">.</span><span class="ident" id="6066456">nbuf</span>&nbsp;<span class="op" id="6066461">=</span>&nbsp;<span class="ident" id="6066463">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066470">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066479">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066536">if</span>&nbsp;<span class="ident" id="6066539">d</span><span class="op" id="6066540">.</span><span class="ident" id="6066541">err</span>&nbsp;<span class="op" id="6066545">!=</span>&nbsp;<span class="ident" id="6066548">nil</span>&nbsp;<span class="op" id="6066552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066557">return</span>&nbsp;<span class="num" id="6066564">0</span><span class="op" id="6066565">,</span>&nbsp;<span class="ident" id="6066567">d</span><span class="op" id="6066568">.</span><span class="ident" id="6066569">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066579">if</span>&nbsp;<span class="ident" id="6066582">d</span><span class="op" id="6066583">.</span><span class="ident" id="6066584">readErr</span>&nbsp;<span class="op" id="6066592">!=</span>&nbsp;<span class="ident" id="6066595">nil</span>&nbsp;<span class="op" id="6066599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066604">d</span><span class="op" id="6066605">.</span><span class="ident" id="6066606">err</span>&nbsp;<span class="op" id="6066610">=</span>&nbsp;<span class="ident" id="6066612">d</span><span class="op" id="6066613">.</span><span class="ident" id="6066614">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066625">return</span>&nbsp;<span class="num" id="6066632">0</span><span class="op" id="6066633">,</span>&nbsp;<span class="ident" id="6066635">d</span><span class="op" id="6066636">.</span><span class="ident" id="6066637">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066643">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066648">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066669">nn</span><span class="op" id="6066671">,</span>&nbsp;<span class="ident" id="6066673">d</span><span class="op" id="6066674">.</span><span class="ident" id="6066675">readErr</span>&nbsp;<span class="op" id="6066683">=</span>&nbsp;<span class="ident" id="6066685">d</span><span class="op" id="6066686">.</span><span class="ident" id="6066687">r</span><span class="op" id="6066688">.</span><span class="ident" id="6066689">Read</span><span class="op" id="6066693">(</span><span class="ident" id="6066694">d</span><span class="op" id="6066695">.</span><span class="ident" id="6066696">buf</span><span class="op" id="6066699">[</span><span class="ident" id="6066700">d</span><span class="op" id="6066701">.</span><span class="ident" id="6066702">nbuf</span><span class="op" id="6066706">:</span><span class="op" id="6066707">]</span><span class="op" id="6066708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066712">d</span><span class="op" id="6066713">.</span><span class="ident" id="6066714">nbuf</span>&nbsp;<span class="op" id="6066719">+=</span>&nbsp;<span class="ident" id="6066722">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066726">}</span><br>
<span class="lineno">310</span><span class="op" id="6066728">}</span>
</div>
</body>
</html>
