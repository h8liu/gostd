<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/md5</h2>
<ul>
<li><a href="/gostd/crypto/md5/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5.go.html">md5.go</a></li>
<li><a href="/gostd/crypto/md5/md5_test.go.html">md5_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5block.go.html">md5block.go</a></li>
<li><a href="/gostd/crypto/md5/md5block_decl.go.html">md5block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3679334">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3679389">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3679443">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3679494">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679549">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="3679622">package</span>&nbsp;<span class="ident" id="3679630">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3679635">import</span>&nbsp;<span class="op" id="3679642">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3679645">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3679655">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3679662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3679665">func</span>&nbsp;<span class="ident" id="3679670">init</span><span class="op" id="3679674">(</span><span class="op" id="3679675">)</span>&nbsp;<span class="op" id="3679677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679680">crypto</span><span class="op" id="3679686">.</span><span class="ident" id="3679687">RegisterHash</span><span class="op" id="3679699">(</span><span class="ident" id="3679700">crypto</span><span class="op" id="3679706">.</span><span class="ident" id="3679707">MD5</span><span class="op" id="3679710">,</span>&nbsp;<span class="ident" id="3679712">New</span><span class="op" id="3679715">)</span><br>
<span class="lineno"></span><span class="op" id="3679717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679720">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="3679761">const</span>&nbsp;<span class="ident" id="3679767">Size</span>&nbsp;<span class="op" id="3679772">=</span>&nbsp;<span class="num" id="3679774">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679778">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3679812">const</span>&nbsp;<span class="ident" id="3679818">BlockSize</span>&nbsp;<span class="op" id="3679828">=</span>&nbsp;<span class="num" id="3679830">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3679834">const</span>&nbsp;<span class="op" id="3679840">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679843">chunk</span>&nbsp;<span class="op" id="3679849">=</span>&nbsp;<span class="num" id="3679851">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679855">init0</span>&nbsp;<span class="op" id="3679861">=</span>&nbsp;<span class="num" id="3679863">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679875">init1</span>&nbsp;<span class="op" id="3679881">=</span>&nbsp;<span class="num" id="3679883">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679895">init2</span>&nbsp;<span class="op" id="3679901">=</span>&nbsp;<span class="num" id="3679903">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679915">init3</span>&nbsp;<span class="op" id="3679921">=</span>&nbsp;<span class="num" id="3679923">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="3679934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679937">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3679996">type</span>&nbsp;<span class="ident" id="3680001">digest</span>&nbsp;<span class="keyword" id="3680008">struct</span>&nbsp;<span class="op" id="3680015">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680018">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3680022">[</span><span class="num" id="3680023">4</span><span class="op" id="3680024">]</span><span class="builtintype" id="3680025">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680033">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3680037">[</span><span class="ident" id="3680038">chunk</span><span class="op" id="3680043">]</span><span class="builtintype" id="3680044">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680050">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3680054">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3680059">len</span>&nbsp;<span class="ident" id="3680063">uint64</span><br>
<span class="lineno"></span><span class="op" id="3680070">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3680073">func</span>&nbsp;<span class="op" id="3680078">(</span><span class="ident" id="3680079">d</span>&nbsp;<span class="op" id="3680081">*</span><span class="ident" id="3680082">digest</span><span class="op" id="3680088">)</span>&nbsp;<span class="ident" id="3680090">Reset</span><span class="op" id="3680095">(</span><span class="op" id="3680096">)</span>&nbsp;<span class="op" id="3680098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680101">d</span><span class="op" id="3680102">.</span><span class="ident" id="3680103">s</span><span class="op" id="3680104">[</span><span class="num" id="3680105">0</span><span class="op" id="3680106">]</span>&nbsp;<span class="op" id="3680108">=</span>&nbsp;<span class="ident" id="3680110">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680117">d</span><span class="op" id="3680118">.</span><span class="ident" id="3680119">s</span><span class="op" id="3680120">[</span><span class="num" id="3680121">1</span><span class="op" id="3680122">]</span>&nbsp;<span class="op" id="3680124">=</span>&nbsp;<span class="ident" id="3680126">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680133">d</span><span class="op" id="3680134">.</span><span class="ident" id="3680135">s</span><span class="op" id="3680136">[</span><span class="num" id="3680137">2</span><span class="op" id="3680138">]</span>&nbsp;<span class="op" id="3680140">=</span>&nbsp;<span class="ident" id="3680142">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680149">d</span><span class="op" id="3680150">.</span><span class="ident" id="3680151">s</span><span class="op" id="3680152">[</span><span class="num" id="3680153">3</span><span class="op" id="3680154">]</span>&nbsp;<span class="op" id="3680156">=</span>&nbsp;<span class="ident" id="3680158">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680165">d</span><span class="op" id="3680166">.</span><span class="ident" id="3680167">nx</span>&nbsp;<span class="op" id="3680170">=</span>&nbsp;<span class="num" id="3680172">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680175">d</span><span class="op" id="3680176">.</span><span class="builtinfunc" id="3680177">len</span>&nbsp;<span class="op" id="3680181">=</span>&nbsp;<span class="num" id="3680183">0</span><br>
<span class="lineno"></span><span class="op" id="3680185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3680188">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3680247">func</span>&nbsp;<span class="ident" id="3680252">New</span><span class="op" id="3680255">(</span><span class="op" id="3680256">)</span>&nbsp;<span class="ident" id="3680258">hash</span><span class="op" id="3680262">.</span><span class="ident" id="3680263">Hash</span>&nbsp;<span class="op" id="3680268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680271">d</span>&nbsp;<span class="op" id="3680273">:=</span>&nbsp;<span class="builtinfunc" id="3680276">new</span><span class="op" id="3680279">(</span><span class="ident" id="3680280">digest</span><span class="op" id="3680286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680289">d</span><span class="op" id="3680290">.</span><span class="ident" id="3680291">Reset</span><span class="op" id="3680296">(</span><span class="op" id="3680297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680300">return</span>&nbsp;<span class="ident" id="3680307">d</span><br>
<span class="lineno">55</span><span class="op" id="3680309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3680312">func</span>&nbsp;<span class="op" id="3680317">(</span><span class="ident" id="3680318">d</span>&nbsp;<span class="op" id="3680320">*</span><span class="ident" id="3680321">digest</span><span class="op" id="3680327">)</span>&nbsp;<span class="ident" id="3680329">Size</span><span class="op" id="3680333">(</span><span class="op" id="3680334">)</span>&nbsp;<span class="builtintype" id="3680336">int</span>&nbsp;<span class="op" id="3680340">{</span>&nbsp;<span class="keyword" id="3680342">return</span>&nbsp;<span class="ident" id="3680349">Size</span>&nbsp;<span class="op" id="3680354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3680357">func</span>&nbsp;<span class="op" id="3680362">(</span><span class="ident" id="3680363">d</span>&nbsp;<span class="op" id="3680365">*</span><span class="ident" id="3680366">digest</span><span class="op" id="3680372">)</span>&nbsp;<span class="ident" id="3680374">BlockSize</span><span class="op" id="3680383">(</span><span class="op" id="3680384">)</span>&nbsp;<span class="builtintype" id="3680386">int</span>&nbsp;<span class="op" id="3680390">{</span>&nbsp;<span class="keyword" id="3680392">return</span>&nbsp;<span class="ident" id="3680399">BlockSize</span>&nbsp;<span class="op" id="3680409">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3680412">func</span>&nbsp;<span class="op" id="3680417">(</span><span class="ident" id="3680418">d</span>&nbsp;<span class="op" id="3680420">*</span><span class="ident" id="3680421">digest</span><span class="op" id="3680427">)</span>&nbsp;<span class="ident" id="3680429">Write</span><span class="op" id="3680434">(</span><span class="ident" id="3680435">p</span>&nbsp;<span class="op" id="3680437">[</span><span class="op" id="3680438">]</span><span class="builtintype" id="3680439">byte</span><span class="op" id="3680443">)</span>&nbsp;<span class="op" id="3680445">(</span><span class="ident" id="3680446">nn</span>&nbsp;<span class="builtintype" id="3680449">int</span><span class="op" id="3680452">,</span>&nbsp;<span class="ident" id="3680454">err</span>&nbsp;<span class="builtintype" id="3680458">error</span><span class="op" id="3680463">)</span>&nbsp;<span class="op" id="3680465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680468">nn</span>&nbsp;<span class="op" id="3680471">=</span>&nbsp;<span class="builtinfunc" id="3680473">len</span><span class="op" id="3680476">(</span><span class="ident" id="3680477">p</span><span class="op" id="3680478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680481">d</span><span class="op" id="3680482">.</span><span class="builtinfunc" id="3680483">len</span>&nbsp;<span class="op" id="3680487">+=</span>&nbsp;<span class="ident" id="3680490">uint64</span><span class="op" id="3680496">(</span><span class="ident" id="3680497">nn</span><span class="op" id="3680499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680502">if</span>&nbsp;<span class="ident" id="3680505">d</span><span class="op" id="3680506">.</span><span class="ident" id="3680507">nx</span>&nbsp;<span class="op" id="3680510">&gt;</span>&nbsp;<span class="num" id="3680512">0</span>&nbsp;<span class="op" id="3680514">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680518">n</span>&nbsp;<span class="op" id="3680520">:=</span>&nbsp;<span class="builtinfunc" id="3680523">len</span><span class="op" id="3680526">(</span><span class="ident" id="3680527">p</span><span class="op" id="3680528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680532">if</span>&nbsp;<span class="ident" id="3680535">n</span>&nbsp;<span class="op" id="3680537">&gt;</span>&nbsp;<span class="ident" id="3680539">chunk</span><span class="op" id="3680544">-</span><span class="ident" id="3680545">d</span><span class="op" id="3680546">.</span><span class="ident" id="3680547">nx</span>&nbsp;<span class="op" id="3680550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680555">n</span>&nbsp;<span class="op" id="3680557">=</span>&nbsp;<span class="ident" id="3680559">chunk</span>&nbsp;<span class="op" id="3680565">-</span>&nbsp;<span class="ident" id="3680567">d</span><span class="op" id="3680568">.</span><span class="ident" id="3680569">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680578">for</span>&nbsp;<span class="ident" id="3680582">i</span>&nbsp;<span class="op" id="3680584">:=</span>&nbsp;<span class="num" id="3680587">0</span><span class="op" id="3680588">;</span>&nbsp;<span class="ident" id="3680590">i</span>&nbsp;<span class="op" id="3680592">&lt;</span>&nbsp;<span class="ident" id="3680594">n</span><span class="op" id="3680595">;</span>&nbsp;<span class="ident" id="3680597">i</span><span class="op" id="3680598">++</span>&nbsp;<span class="op" id="3680601">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680606">d</span><span class="op" id="3680607">.</span><span class="ident" id="3680608">x</span><span class="op" id="3680609">[</span><span class="ident" id="3680610">d</span><span class="op" id="3680611">.</span><span class="ident" id="3680612">nx</span><span class="op" id="3680614">+</span><span class="ident" id="3680615">i</span><span class="op" id="3680616">]</span>&nbsp;<span class="op" id="3680618">=</span>&nbsp;<span class="ident" id="3680620">p</span><span class="op" id="3680621">[</span><span class="ident" id="3680622">i</span><span class="op" id="3680623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680631">d</span><span class="op" id="3680632">.</span><span class="ident" id="3680633">nx</span>&nbsp;<span class="op" id="3680636">+=</span>&nbsp;<span class="ident" id="3680639">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680643">if</span>&nbsp;<span class="ident" id="3680646">d</span><span class="op" id="3680647">.</span><span class="ident" id="3680648">nx</span>&nbsp;<span class="op" id="3680651">==</span>&nbsp;<span class="ident" id="3680654">chunk</span>&nbsp;<span class="op" id="3680660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680665">block</span><span class="op" id="3680670">(</span><span class="ident" id="3680671">d</span><span class="op" id="3680672">,</span>&nbsp;<span class="ident" id="3680674">d</span><span class="op" id="3680675">.</span><span class="ident" id="3680676">x</span><span class="op" id="3680677">[</span><span class="num" id="3680678">0</span><span class="op" id="3680679">:</span><span class="ident" id="3680680">chunk</span><span class="op" id="3680685">]</span><span class="op" id="3680686">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680691">d</span><span class="op" id="3680692">.</span><span class="ident" id="3680693">nx</span>&nbsp;<span class="op" id="3680696">=</span>&nbsp;<span class="num" id="3680698">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680706">p</span>&nbsp;<span class="op" id="3680708">=</span>&nbsp;<span class="ident" id="3680710">p</span><span class="op" id="3680711">[</span><span class="ident" id="3680712">n</span><span class="op" id="3680713">:</span><span class="op" id="3680714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680720">if</span>&nbsp;<span class="builtinfunc" id="3680723">len</span><span class="op" id="3680726">(</span><span class="ident" id="3680727">p</span><span class="op" id="3680728">)</span>&nbsp;<span class="op" id="3680730">&gt;=</span>&nbsp;<span class="ident" id="3680733">chunk</span>&nbsp;<span class="op" id="3680739">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680743">n</span>&nbsp;<span class="op" id="3680745">:=</span>&nbsp;<span class="builtinfunc" id="3680748">len</span><span class="op" id="3680751">(</span><span class="ident" id="3680752">p</span><span class="op" id="3680753">)</span>&nbsp;<span class="op" id="3680755">&amp;^</span>&nbsp;<span class="op" id="3680758">(</span><span class="ident" id="3680759">chunk</span>&nbsp;<span class="op" id="3680765">-</span>&nbsp;<span class="num" id="3680767">1</span><span class="op" id="3680768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680772">block</span><span class="op" id="3680777">(</span><span class="ident" id="3680778">d</span><span class="op" id="3680779">,</span>&nbsp;<span class="ident" id="3680781">p</span><span class="op" id="3680782">[</span><span class="op" id="3680783">:</span><span class="ident" id="3680784">n</span><span class="op" id="3680785">]</span><span class="op" id="3680786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680790">p</span>&nbsp;<span class="op" id="3680792">=</span>&nbsp;<span class="ident" id="3680794">p</span><span class="op" id="3680795">[</span><span class="ident" id="3680796">n</span><span class="op" id="3680797">:</span><span class="op" id="3680798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680804">if</span>&nbsp;<span class="builtinfunc" id="3680807">len</span><span class="op" id="3680810">(</span><span class="ident" id="3680811">p</span><span class="op" id="3680812">)</span>&nbsp;<span class="op" id="3680814">&gt;</span>&nbsp;<span class="num" id="3680816">0</span>&nbsp;<span class="op" id="3680818">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680822">d</span><span class="op" id="3680823">.</span><span class="ident" id="3680824">nx</span>&nbsp;<span class="op" id="3680827">=</span>&nbsp;<span class="builtinfunc" id="3680829">copy</span><span class="op" id="3680833">(</span><span class="ident" id="3680834">d</span><span class="op" id="3680835">.</span><span class="ident" id="3680836">x</span><span class="op" id="3680837">[</span><span class="op" id="3680838">:</span><span class="op" id="3680839">]</span><span class="op" id="3680840">,</span>&nbsp;<span class="ident" id="3680842">p</span><span class="op" id="3680843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680849">return</span><br>
<span class="lineno"></span><span class="op" id="3680856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3680859">func</span>&nbsp;<span class="op" id="3680864">(</span><span class="ident" id="3680865">d0</span>&nbsp;<span class="op" id="3680868">*</span><span class="ident" id="3680869">digest</span><span class="op" id="3680875">)</span>&nbsp;<span class="ident" id="3680877">Sum</span><span class="op" id="3680880">(</span><span class="ident" id="3680881">in</span>&nbsp;<span class="op" id="3680884">[</span><span class="op" id="3680885">]</span><span class="builtintype" id="3680886">byte</span><span class="op" id="3680890">)</span>&nbsp;<span class="op" id="3680892">[</span><span class="op" id="3680893">]</span><span class="builtintype" id="3680894">byte</span>&nbsp;<span class="op" id="3680899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3680902">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680969">d</span>&nbsp;<span class="op" id="3680971">:=</span>&nbsp;<span class="op" id="3680974">*</span><span class="ident" id="3680975">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680979">hash</span>&nbsp;<span class="op" id="3680984">:=</span>&nbsp;<span class="ident" id="3680987">d</span><span class="op" id="3680988">.</span><span class="ident" id="3680989">checkSum</span><span class="op" id="3680997">(</span><span class="op" id="3680998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681001">return</span>&nbsp;<span class="builtinfunc" id="3681008">append</span><span class="op" id="3681014">(</span><span class="ident" id="3681015">in</span><span class="op" id="3681017">,</span>&nbsp;<span class="ident" id="3681019">hash</span><span class="op" id="3681023">[</span><span class="op" id="3681024">:</span><span class="op" id="3681025">]</span><span class="op" id="3681026">...</span><span class="op" id="3681029">)</span><br>
<span class="lineno">95</span><span class="op" id="3681031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3681034">func</span>&nbsp;<span class="op" id="3681039">(</span><span class="ident" id="3681040">d</span>&nbsp;<span class="op" id="3681042">*</span><span class="ident" id="3681043">digest</span><span class="op" id="3681049">)</span>&nbsp;<span class="ident" id="3681051">checkSum</span><span class="op" id="3681059">(</span><span class="op" id="3681060">)</span>&nbsp;<span class="op" id="3681062">[</span><span class="ident" id="3681063">Size</span><span class="op" id="3681067">]</span><span class="builtintype" id="3681068">byte</span>&nbsp;<span class="op" id="3681073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681076">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3681136">len</span>&nbsp;<span class="op" id="3681140">:=</span>&nbsp;<span class="ident" id="3681143">d</span><span class="op" id="3681144">.</span><span class="builtinfunc" id="3681145">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681150">var</span>&nbsp;<span class="ident" id="3681154">tmp</span>&nbsp;<span class="op" id="3681158">[</span><span class="num" id="3681159">64</span><span class="op" id="3681161">]</span><span class="builtintype" id="3681162">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681168">tmp</span><span class="op" id="3681171">[</span><span class="num" id="3681172">0</span><span class="op" id="3681173">]</span>&nbsp;<span class="op" id="3681175">=</span>&nbsp;<span class="num" id="3681177">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681183">if</span>&nbsp;<span class="builtinfunc" id="3681186">len</span><span class="op" id="3681189">%</span><span class="num" id="3681190">64</span>&nbsp;<span class="op" id="3681193">&lt;</span>&nbsp;<span class="num" id="3681195">56</span>&nbsp;<span class="op" id="3681198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681202">d</span><span class="op" id="3681203">.</span><span class="ident" id="3681204">Write</span><span class="op" id="3681209">(</span><span class="ident" id="3681210">tmp</span><span class="op" id="3681213">[</span><span class="num" id="3681214">0</span>&nbsp;<span class="op" id="3681216">:</span>&nbsp;<span class="num" id="3681218">56</span><span class="op" id="3681220">-</span><span class="builtinfunc" id="3681221">len</span><span class="op" id="3681224">%</span><span class="num" id="3681225">64</span><span class="op" id="3681227">]</span><span class="op" id="3681228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681231">}</span>&nbsp;<span class="keyword" id="3681233">else</span>&nbsp;<span class="op" id="3681238">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681242">d</span><span class="op" id="3681243">.</span><span class="ident" id="3681244">Write</span><span class="op" id="3681249">(</span><span class="ident" id="3681250">tmp</span><span class="op" id="3681253">[</span><span class="num" id="3681254">0</span>&nbsp;<span class="op" id="3681256">:</span>&nbsp;<span class="num" id="3681258">64</span><span class="op" id="3681260">+</span><span class="num" id="3681261">56</span><span class="op" id="3681263">-</span><span class="builtinfunc" id="3681264">len</span><span class="op" id="3681267">%</span><span class="num" id="3681268">64</span><span class="op" id="3681270">]</span><span class="op" id="3681271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3681278">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3681298">len</span>&nbsp;<span class="op" id="3681302">&lt;&lt;=</span>&nbsp;<span class="num" id="3681306">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681309">for</span>&nbsp;<span class="ident" id="3681313">i</span>&nbsp;<span class="op" id="3681315">:=</span>&nbsp;<span class="builtintype" id="3681318">uint</span><span class="op" id="3681322">(</span><span class="num" id="3681323">0</span><span class="op" id="3681324">)</span><span class="op" id="3681325">;</span>&nbsp;<span class="ident" id="3681327">i</span>&nbsp;<span class="op" id="3681329">&lt;</span>&nbsp;<span class="num" id="3681331">8</span><span class="op" id="3681332">;</span>&nbsp;<span class="ident" id="3681334">i</span><span class="op" id="3681335">++</span>&nbsp;<span class="op" id="3681338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681342">tmp</span><span class="op" id="3681345">[</span><span class="ident" id="3681346">i</span><span class="op" id="3681347">]</span>&nbsp;<span class="op" id="3681349">=</span>&nbsp;<span class="builtintype" id="3681351">byte</span><span class="op" id="3681355">(</span><span class="builtinfunc" id="3681356">len</span>&nbsp;<span class="op" id="3681360">&gt;&gt;</span>&nbsp;<span class="op" id="3681363">(</span><span class="num" id="3681364">8</span>&nbsp;<span class="op" id="3681366">*</span>&nbsp;<span class="ident" id="3681368">i</span><span class="op" id="3681369">)</span><span class="op" id="3681370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681376">d</span><span class="op" id="3681377">.</span><span class="ident" id="3681378">Write</span><span class="op" id="3681383">(</span><span class="ident" id="3681384">tmp</span><span class="op" id="3681387">[</span><span class="num" id="3681388">0</span><span class="op" id="3681389">:</span><span class="num" id="3681390">8</span><span class="op" id="3681391">]</span><span class="op" id="3681392">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681396">if</span>&nbsp;<span class="ident" id="3681399">d</span><span class="op" id="3681400">.</span><span class="ident" id="3681401">nx</span>&nbsp;<span class="op" id="3681404">!=</span>&nbsp;<span class="num" id="3681407">0</span>&nbsp;<span class="op" id="3681409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3681413">panic</span><span class="op" id="3681418">(</span><span class="string" id="3681419">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="3681430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681437">var</span>&nbsp;<span class="ident" id="3681441">digest</span>&nbsp;<span class="op" id="3681448">[</span><span class="ident" id="3681449">Size</span><span class="op" id="3681453">]</span><span class="builtintype" id="3681454">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681460">for</span>&nbsp;<span class="ident" id="3681464">i</span><span class="op" id="3681465">,</span>&nbsp;<span class="ident" id="3681467">s</span>&nbsp;<span class="op" id="3681469">:=</span>&nbsp;<span class="keyword" id="3681472">range</span>&nbsp;<span class="ident" id="3681478">d</span><span class="op" id="3681479">.</span><span class="ident" id="3681480">s</span>&nbsp;<span class="op" id="3681482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681486">digest</span><span class="op" id="3681492">[</span><span class="ident" id="3681493">i</span><span class="op" id="3681494">*</span><span class="num" id="3681495">4</span><span class="op" id="3681496">]</span>&nbsp;<span class="op" id="3681498">=</span>&nbsp;<span class="builtintype" id="3681500">byte</span><span class="op" id="3681504">(</span><span class="ident" id="3681505">s</span><span class="op" id="3681506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681510">digest</span><span class="op" id="3681516">[</span><span class="ident" id="3681517">i</span><span class="op" id="3681518">*</span><span class="num" id="3681519">4</span><span class="op" id="3681520">+</span><span class="num" id="3681521">1</span><span class="op" id="3681522">]</span>&nbsp;<span class="op" id="3681524">=</span>&nbsp;<span class="builtintype" id="3681526">byte</span><span class="op" id="3681530">(</span><span class="ident" id="3681531">s</span>&nbsp;<span class="op" id="3681533">&gt;&gt;</span>&nbsp;<span class="num" id="3681536">8</span><span class="op" id="3681537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681541">digest</span><span class="op" id="3681547">[</span><span class="ident" id="3681548">i</span><span class="op" id="3681549">*</span><span class="num" id="3681550">4</span><span class="op" id="3681551">+</span><span class="num" id="3681552">2</span><span class="op" id="3681553">]</span>&nbsp;<span class="op" id="3681555">=</span>&nbsp;<span class="builtintype" id="3681557">byte</span><span class="op" id="3681561">(</span><span class="ident" id="3681562">s</span>&nbsp;<span class="op" id="3681564">&gt;&gt;</span>&nbsp;<span class="num" id="3681567">16</span><span class="op" id="3681569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681573">digest</span><span class="op" id="3681579">[</span><span class="ident" id="3681580">i</span><span class="op" id="3681581">*</span><span class="num" id="3681582">4</span><span class="op" id="3681583">+</span><span class="num" id="3681584">3</span><span class="op" id="3681585">]</span>&nbsp;<span class="op" id="3681587">=</span>&nbsp;<span class="builtintype" id="3681589">byte</span><span class="op" id="3681593">(</span><span class="ident" id="3681594">s</span>&nbsp;<span class="op" id="3681596">&gt;&gt;</span>&nbsp;<span class="num" id="3681599">24</span><span class="op" id="3681601">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3681604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681608">return</span>&nbsp;<span class="ident" id="3681615">digest</span><br>
<span class="lineno"></span><span class="op" id="3681622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3681625">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3681670">func</span>&nbsp;<span class="ident" id="3681675">Sum</span><span class="op" id="3681678">(</span><span class="ident" id="3681679">data</span>&nbsp;<span class="op" id="3681684">[</span><span class="op" id="3681685">]</span><span class="builtintype" id="3681686">byte</span><span class="op" id="3681690">)</span>&nbsp;<span class="op" id="3681692">[</span><span class="ident" id="3681693">Size</span><span class="op" id="3681697">]</span><span class="builtintype" id="3681698">byte</span>&nbsp;<span class="op" id="3681703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681706">var</span>&nbsp;<span class="ident" id="3681710">d</span>&nbsp;<span class="ident" id="3681712">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681720">d</span><span class="op" id="3681721">.</span><span class="ident" id="3681722">Reset</span><span class="op" id="3681727">(</span><span class="op" id="3681728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3681731">d</span><span class="op" id="3681732">.</span><span class="ident" id="3681733">Write</span><span class="op" id="3681738">(</span><span class="ident" id="3681739">data</span><span class="op" id="3681743">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3681746">return</span>&nbsp;<span class="ident" id="3681753">d</span><span class="op" id="3681754">.</span><span class="ident" id="3681755">checkSum</span><span class="op" id="3681763">(</span><span class="op" id="3681764">)</span><br>
<span class="lineno"></span><span class="op" id="3681766">}</span>
</div>
</body>
</html>
