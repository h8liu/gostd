<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5415826">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5415881">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5415935">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5415986">package</span>&nbsp;<span class="ident" id="5415994">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416002">import</span>&nbsp;<span class="string" id="5416009">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416020">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5416106">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5416185">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5416256">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5416322">//</span><br>
<span class="lineno"></span><span class="comment" id="5416325">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5416403">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5416464">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5416511">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5416581">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5416658">type</span>&nbsp;<span class="ident" id="5416663">patchList</span>&nbsp;<span class="builtintype" id="5416673">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5416681">func</span>&nbsp;<span class="op" id="5416686">(</span><span class="ident" id="5416687">l</span>&nbsp;<span class="ident" id="5416689">patchList</span><span class="op" id="5416698">)</span>&nbsp;<span class="ident" id="5416700">next</span><span class="op" id="5416704">(</span><span class="ident" id="5416705">p</span>&nbsp;<span class="op" id="5416707">*</span><span class="ident" id="5416708">Prog</span><span class="op" id="5416712">)</span>&nbsp;<span class="ident" id="5416714">patchList</span>&nbsp;<span class="op" id="5416724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416727">i</span>&nbsp;<span class="op" id="5416729">:=</span>&nbsp;<span class="op" id="5416732">&amp;</span><span class="ident" id="5416733">p</span><span class="op" id="5416734">.</span><span class="ident" id="5416735">Inst</span><span class="op" id="5416739">[</span><span class="ident" id="5416740">l</span><span class="op" id="5416741">&gt;&gt;</span><span class="num" id="5416743">1</span><span class="op" id="5416744">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416747">if</span>&nbsp;<span class="ident" id="5416750">l</span><span class="op" id="5416751">&amp;</span><span class="num" id="5416752">1</span>&nbsp;<span class="op" id="5416754">==</span>&nbsp;<span class="num" id="5416757">0</span>&nbsp;<span class="op" id="5416759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416763">return</span>&nbsp;<span class="ident" id="5416770">patchList</span><span class="op" id="5416779">(</span><span class="ident" id="5416780">i</span><span class="op" id="5416781">.</span><span class="ident" id="5416782">Out</span><span class="op" id="5416785">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416791">return</span>&nbsp;<span class="ident" id="5416798">patchList</span><span class="op" id="5416807">(</span><span class="ident" id="5416808">i</span><span class="op" id="5416809">.</span><span class="ident" id="5416810">Arg</span><span class="op" id="5416813">)</span><br>
<span class="lineno"></span><span class="op" id="5416815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416818">func</span>&nbsp;<span class="op" id="5416823">(</span><span class="ident" id="5416824">l</span>&nbsp;<span class="ident" id="5416826">patchList</span><span class="op" id="5416835">)</span>&nbsp;<span class="ident" id="5416837">patch</span><span class="op" id="5416842">(</span><span class="ident" id="5416843">p</span>&nbsp;<span class="op" id="5416845">*</span><span class="ident" id="5416846">Prog</span><span class="op" id="5416850">,</span>&nbsp;<span class="ident" id="5416852">val</span>&nbsp;<span class="builtintype" id="5416856">uint32</span><span class="op" id="5416862">)</span>&nbsp;<span class="op" id="5416864">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416867">for</span>&nbsp;<span class="ident" id="5416871">l</span>&nbsp;<span class="op" id="5416873">!=</span>&nbsp;<span class="num" id="5416876">0</span>&nbsp;<span class="op" id="5416878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416882">i</span>&nbsp;<span class="op" id="5416884">:=</span>&nbsp;<span class="op" id="5416887">&amp;</span><span class="ident" id="5416888">p</span><span class="op" id="5416889">.</span><span class="ident" id="5416890">Inst</span><span class="op" id="5416894">[</span><span class="ident" id="5416895">l</span><span class="op" id="5416896">&gt;&gt;</span><span class="num" id="5416898">1</span><span class="op" id="5416899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5416903">if</span>&nbsp;<span class="ident" id="5416906">l</span><span class="op" id="5416907">&amp;</span><span class="num" id="5416908">1</span>&nbsp;<span class="op" id="5416910">==</span>&nbsp;<span class="num" id="5416913">0</span>&nbsp;<span class="op" id="5416915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416920">l</span>&nbsp;<span class="op" id="5416922">=</span>&nbsp;<span class="ident" id="5416924">patchList</span><span class="op" id="5416933">(</span><span class="ident" id="5416934">i</span><span class="op" id="5416935">.</span><span class="ident" id="5416936">Out</span><span class="op" id="5416939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416944">i</span><span class="op" id="5416945">.</span><span class="ident" id="5416946">Out</span>&nbsp;<span class="op" id="5416950">=</span>&nbsp;<span class="ident" id="5416952">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5416958">}</span>&nbsp;<span class="keyword" id="5416960">else</span>&nbsp;<span class="op" id="5416965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416970">l</span>&nbsp;<span class="op" id="5416972">=</span>&nbsp;<span class="ident" id="5416974">patchList</span><span class="op" id="5416983">(</span><span class="ident" id="5416984">i</span><span class="op" id="5416985">.</span><span class="ident" id="5416986">Arg</span><span class="op" id="5416989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416994">i</span><span class="op" id="5416995">.</span><span class="ident" id="5416996">Arg</span>&nbsp;<span class="op" id="5417000">=</span>&nbsp;<span class="ident" id="5417002">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417011">}</span><br>
<span class="lineno">40</span><span class="op" id="5417013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417016">func</span>&nbsp;<span class="op" id="5417021">(</span><span class="ident" id="5417022">l1</span>&nbsp;<span class="ident" id="5417025">patchList</span><span class="op" id="5417034">)</span>&nbsp;<span class="builtinfunc" id="5417036">append</span><span class="op" id="5417042">(</span><span class="ident" id="5417043">p</span>&nbsp;<span class="op" id="5417045">*</span><span class="ident" id="5417046">Prog</span><span class="op" id="5417050">,</span>&nbsp;<span class="ident" id="5417052">l2</span>&nbsp;<span class="ident" id="5417055">patchList</span><span class="op" id="5417064">)</span>&nbsp;<span class="ident" id="5417066">patchList</span>&nbsp;<span class="op" id="5417076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417079">if</span>&nbsp;<span class="ident" id="5417082">l1</span>&nbsp;<span class="op" id="5417085">==</span>&nbsp;<span class="num" id="5417088">0</span>&nbsp;<span class="op" id="5417090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417094">return</span>&nbsp;<span class="ident" id="5417101">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417108">if</span>&nbsp;<span class="ident" id="5417111">l2</span>&nbsp;<span class="op" id="5417114">==</span>&nbsp;<span class="num" id="5417117">0</span>&nbsp;<span class="op" id="5417119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417123">return</span>&nbsp;<span class="ident" id="5417130">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417138">last</span>&nbsp;<span class="op" id="5417143">:=</span>&nbsp;<span class="ident" id="5417146">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417150">for</span>&nbsp;<span class="op" id="5417154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417158">next</span>&nbsp;<span class="op" id="5417163">:=</span>&nbsp;<span class="ident" id="5417166">last</span><span class="op" id="5417170">.</span><span class="ident" id="5417171">next</span><span class="op" id="5417175">(</span><span class="ident" id="5417176">p</span><span class="op" id="5417177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417181">if</span>&nbsp;<span class="ident" id="5417184">next</span>&nbsp;<span class="op" id="5417189">==</span>&nbsp;<span class="num" id="5417192">0</span>&nbsp;<span class="op" id="5417194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417199">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417211">last</span>&nbsp;<span class="op" id="5417216">=</span>&nbsp;<span class="ident" id="5417218">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417228">i</span>&nbsp;<span class="op" id="5417230">:=</span>&nbsp;<span class="op" id="5417233">&amp;</span><span class="ident" id="5417234">p</span><span class="op" id="5417235">.</span><span class="ident" id="5417236">Inst</span><span class="op" id="5417240">[</span><span class="ident" id="5417241">last</span><span class="op" id="5417245">&gt;&gt;</span><span class="num" id="5417247">1</span><span class="op" id="5417248">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417251">if</span>&nbsp;<span class="ident" id="5417254">last</span><span class="op" id="5417258">&amp;</span><span class="num" id="5417259">1</span>&nbsp;<span class="op" id="5417261">==</span>&nbsp;<span class="num" id="5417264">0</span>&nbsp;<span class="op" id="5417266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417270">i</span><span class="op" id="5417271">.</span><span class="ident" id="5417272">Out</span>&nbsp;<span class="op" id="5417276">=</span>&nbsp;<span class="builtintype" id="5417278">uint32</span><span class="op" id="5417284">(</span><span class="ident" id="5417285">l2</span><span class="op" id="5417287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417290">}</span>&nbsp;<span class="keyword" id="5417292">else</span>&nbsp;<span class="op" id="5417297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417301">i</span><span class="op" id="5417302">.</span><span class="ident" id="5417303">Arg</span>&nbsp;<span class="op" id="5417307">=</span>&nbsp;<span class="builtintype" id="5417309">uint32</span><span class="op" id="5417315">(</span><span class="ident" id="5417316">l2</span><span class="op" id="5417318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417321">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417324">return</span>&nbsp;<span class="ident" id="5417331">l1</span><br>
<span class="lineno"></span><span class="op" id="5417334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417337">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5417387">type</span>&nbsp;<span class="ident" id="5417392">frag</span>&nbsp;<span class="keyword" id="5417397">struct</span>&nbsp;<span class="op" id="5417404">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417407">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5417411">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5417421">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417452">out</span>&nbsp;<span class="ident" id="5417456">patchList</span>&nbsp;<span class="comment" id="5417466">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5417501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417504">type</span>&nbsp;<span class="ident" id="5417509">compiler</span>&nbsp;<span class="keyword" id="5417518">struct</span>&nbsp;<span class="op" id="5417525">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417528">p</span>&nbsp;<span class="op" id="5417530">*</span><span class="ident" id="5417531">Prog</span><br>
<span class="lineno"></span><span class="op" id="5417536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417539">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5417601">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5417680">func</span>&nbsp;<span class="ident" id="5417685">Compile</span><span class="op" id="5417692">(</span><span class="ident" id="5417693">re</span>&nbsp;<span class="op" id="5417696">*</span><span class="ident" id="5417697">Regexp</span><span class="op" id="5417703">)</span>&nbsp;<span class="op" id="5417705">(</span><span class="op" id="5417706">*</span><span class="ident" id="5417707">Prog</span><span class="op" id="5417711">,</span>&nbsp;<span class="builtintype" id="5417713">error</span><span class="op" id="5417718">)</span>&nbsp;<span class="op" id="5417720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417723">var</span>&nbsp;<span class="ident" id="5417727">c</span>&nbsp;<span class="ident" id="5417729">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417739">c</span><span class="op" id="5417740">.</span><span class="ident" id="5417741">init</span><span class="op" id="5417745">(</span><span class="op" id="5417746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417749">f</span>&nbsp;<span class="op" id="5417751">:=</span>&nbsp;<span class="ident" id="5417754">c</span><span class="op" id="5417755">.</span><span class="ident" id="5417756">compile</span><span class="op" id="5417763">(</span><span class="ident" id="5417764">re</span><span class="op" id="5417766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417769">f</span><span class="op" id="5417770">.</span><span class="ident" id="5417771">out</span><span class="op" id="5417774">.</span><span class="ident" id="5417775">patch</span><span class="op" id="5417780">(</span><span class="ident" id="5417781">c</span><span class="op" id="5417782">.</span><span class="ident" id="5417783">p</span><span class="op" id="5417784">,</span>&nbsp;<span class="ident" id="5417786">c</span><span class="op" id="5417787">.</span><span class="ident" id="5417788">inst</span><span class="op" id="5417792">(</span><span class="ident" id="5417793">InstMatch</span><span class="op" id="5417802">)</span><span class="op" id="5417803">.</span><span class="ident" id="5417804">i</span><span class="op" id="5417805">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417808">c</span><span class="op" id="5417809">.</span><span class="ident" id="5417810">p</span><span class="op" id="5417811">.</span><span class="ident" id="5417812">Start</span>&nbsp;<span class="op" id="5417818">=</span>&nbsp;<span class="builtintype" id="5417820">int</span><span class="op" id="5417823">(</span><span class="ident" id="5417824">f</span><span class="op" id="5417825">.</span><span class="ident" id="5417826">i</span><span class="op" id="5417827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417830">return</span>&nbsp;<span class="ident" id="5417837">c</span><span class="op" id="5417838">.</span><span class="ident" id="5417839">p</span><span class="op" id="5417840">,</span>&nbsp;<span class="ident" id="5417842">nil</span><br>
<span class="lineno"></span><span class="op" id="5417846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417849">func</span>&nbsp;<span class="op" id="5417854">(</span><span class="ident" id="5417855">c</span>&nbsp;<span class="op" id="5417857">*</span><span class="ident" id="5417858">compiler</span><span class="op" id="5417866">)</span>&nbsp;<span class="ident" id="5417868">init</span><span class="op" id="5417872">(</span><span class="op" id="5417873">)</span>&nbsp;<span class="op" id="5417875">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417878">c</span><span class="op" id="5417879">.</span><span class="ident" id="5417880">p</span>&nbsp;<span class="op" id="5417882">=</span>&nbsp;<span class="builtinfunc" id="5417884">new</span><span class="op" id="5417887">(</span><span class="ident" id="5417888">Prog</span><span class="op" id="5417892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417895">c</span><span class="op" id="5417896">.</span><span class="ident" id="5417897">p</span><span class="op" id="5417898">.</span><span class="ident" id="5417899">NumCap</span>&nbsp;<span class="op" id="5417906">=</span>&nbsp;<span class="num" id="5417908">2</span>&nbsp;<span class="comment" id="5417910">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417950">c</span><span class="op" id="5417951">.</span><span class="ident" id="5417952">inst</span><span class="op" id="5417956">(</span><span class="ident" id="5417957">InstFail</span><span class="op" id="5417965">)</span><br>
<span class="lineno"></span><span class="op" id="5417967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5417970">var</span>&nbsp;<span class="ident" id="5417974">anyRuneNotNL</span>&nbsp;<span class="op" id="5417987">=</span>&nbsp;<span class="op" id="5417989">[</span><span class="op" id="5417990">]</span><span class="builtintype" id="5417991">rune</span><span class="op" id="5417995">{</span><span class="num" id="5417996">0</span><span class="op" id="5417997">,</span>&nbsp;<span class="string" id="5417999">&#39;\n&#39;</span>&nbsp;<span class="op" id="5418004">-</span>&nbsp;<span class="num" id="5418006">1</span><span class="op" id="5418007">,</span>&nbsp;<span class="string" id="5418009">&#39;\n&#39;</span>&nbsp;<span class="op" id="5418014">+</span>&nbsp;<span class="num" id="5418016">1</span><span class="op" id="5418017">,</span>&nbsp;<span class="ident" id="5418019">unicode</span><span class="op" id="5418026">.</span><span class="ident" id="5418027">MaxRune</span><span class="op" id="5418034">}</span><br>
<span class="lineno"></span><span class="keyword" id="5418036">var</span>&nbsp;<span class="ident" id="5418040">anyRune</span>&nbsp;<span class="op" id="5418048">=</span>&nbsp;<span class="op" id="5418050">[</span><span class="op" id="5418051">]</span><span class="builtintype" id="5418052">rune</span><span class="op" id="5418056">{</span><span class="num" id="5418057">0</span><span class="op" id="5418058">,</span>&nbsp;<span class="ident" id="5418060">unicode</span><span class="op" id="5418067">.</span><span class="ident" id="5418068">MaxRune</span><span class="op" id="5418075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5418078">func</span>&nbsp;<span class="op" id="5418083">(</span><span class="ident" id="5418084">c</span>&nbsp;<span class="op" id="5418086">*</span><span class="ident" id="5418087">compiler</span><span class="op" id="5418095">)</span>&nbsp;<span class="ident" id="5418097">compile</span><span class="op" id="5418104">(</span><span class="ident" id="5418105">re</span>&nbsp;<span class="op" id="5418108">*</span><span class="ident" id="5418109">Regexp</span><span class="op" id="5418115">)</span>&nbsp;<span class="ident" id="5418117">frag</span>&nbsp;<span class="op" id="5418122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418125">switch</span>&nbsp;<span class="ident" id="5418132">re</span><span class="op" id="5418134">.</span><span class="ident" id="5418135">Op</span>&nbsp;<span class="op" id="5418138">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418141">case</span>&nbsp;<span class="ident" id="5418146">OpNoMatch</span><span class="op" id="5418155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418159">return</span>&nbsp;<span class="ident" id="5418166">c</span><span class="op" id="5418167">.</span><span class="ident" id="5418168">fail</span><span class="op" id="5418172">(</span><span class="op" id="5418173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418176">case</span>&nbsp;<span class="ident" id="5418181">OpEmptyMatch</span><span class="op" id="5418193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418197">return</span>&nbsp;<span class="ident" id="5418204">c</span><span class="op" id="5418205">.</span><span class="ident" id="5418206">nop</span><span class="op" id="5418209">(</span><span class="op" id="5418210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418213">case</span>&nbsp;<span class="ident" id="5418218">OpLiteral</span><span class="op" id="5418227">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418231">if</span>&nbsp;<span class="builtinfunc" id="5418234">len</span><span class="op" id="5418237">(</span><span class="ident" id="5418238">re</span><span class="op" id="5418240">.</span><span class="ident" id="5418241">Rune</span><span class="op" id="5418245">)</span>&nbsp;<span class="op" id="5418247">==</span>&nbsp;<span class="num" id="5418250">0</span>&nbsp;<span class="op" id="5418252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418257">return</span>&nbsp;<span class="ident" id="5418264">c</span><span class="op" id="5418265">.</span><span class="ident" id="5418266">nop</span><span class="op" id="5418269">(</span><span class="op" id="5418270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418278">var</span>&nbsp;<span class="ident" id="5418282">f</span>&nbsp;<span class="ident" id="5418284">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418291">for</span>&nbsp;<span class="ident" id="5418295">j</span>&nbsp;<span class="op" id="5418297">:=</span>&nbsp;<span class="keyword" id="5418300">range</span>&nbsp;<span class="ident" id="5418306">re</span><span class="op" id="5418308">.</span><span class="ident" id="5418309">Rune</span>&nbsp;<span class="op" id="5418314">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418319">f1</span>&nbsp;<span class="op" id="5418322">:=</span>&nbsp;<span class="ident" id="5418325">c</span><span class="op" id="5418326">.</span><span class="builtintype" id="5418327">rune</span><span class="op" id="5418331">(</span><span class="ident" id="5418332">re</span><span class="op" id="5418334">.</span><span class="ident" id="5418335">Rune</span><span class="op" id="5418339">[</span><span class="ident" id="5418340">j</span><span class="op" id="5418341">:</span><span class="ident" id="5418342">j</span><span class="op" id="5418343">+</span><span class="num" id="5418344">1</span><span class="op" id="5418345">]</span><span class="op" id="5418346">,</span>&nbsp;<span class="ident" id="5418348">re</span><span class="op" id="5418350">.</span><span class="ident" id="5418351">Flags</span><span class="op" id="5418356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418361">if</span>&nbsp;<span class="ident" id="5418364">j</span>&nbsp;<span class="op" id="5418366">==</span>&nbsp;<span class="num" id="5418369">0</span>&nbsp;<span class="op" id="5418371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418377">f</span>&nbsp;<span class="op" id="5418379">=</span>&nbsp;<span class="ident" id="5418381">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418387">}</span>&nbsp;<span class="keyword" id="5418389">else</span>&nbsp;<span class="op" id="5418394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418400">f</span>&nbsp;<span class="op" id="5418402">=</span>&nbsp;<span class="ident" id="5418404">c</span><span class="op" id="5418405">.</span><span class="ident" id="5418406">cat</span><span class="op" id="5418409">(</span><span class="ident" id="5418410">f</span><span class="op" id="5418411">,</span>&nbsp;<span class="ident" id="5418413">f1</span><span class="op" id="5418415">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418428">return</span>&nbsp;<span class="ident" id="5418435">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418438">case</span>&nbsp;<span class="ident" id="5418443">OpCharClass</span><span class="op" id="5418454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418458">return</span>&nbsp;<span class="ident" id="5418465">c</span><span class="op" id="5418466">.</span><span class="builtintype" id="5418467">rune</span><span class="op" id="5418471">(</span><span class="ident" id="5418472">re</span><span class="op" id="5418474">.</span><span class="ident" id="5418475">Rune</span><span class="op" id="5418479">,</span>&nbsp;<span class="ident" id="5418481">re</span><span class="op" id="5418483">.</span><span class="ident" id="5418484">Flags</span><span class="op" id="5418489">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418492">case</span>&nbsp;<span class="ident" id="5418497">OpAnyCharNotNL</span><span class="op" id="5418511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418515">return</span>&nbsp;<span class="ident" id="5418522">c</span><span class="op" id="5418523">.</span><span class="builtintype" id="5418524">rune</span><span class="op" id="5418528">(</span><span class="ident" id="5418529">anyRuneNotNL</span><span class="op" id="5418541">,</span>&nbsp;<span class="num" id="5418543">0</span><span class="op" id="5418544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418547">case</span>&nbsp;<span class="ident" id="5418552">OpAnyChar</span><span class="op" id="5418561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418565">return</span>&nbsp;<span class="ident" id="5418572">c</span><span class="op" id="5418573">.</span><span class="builtintype" id="5418574">rune</span><span class="op" id="5418578">(</span><span class="ident" id="5418579">anyRune</span><span class="op" id="5418586">,</span>&nbsp;<span class="num" id="5418588">0</span><span class="op" id="5418589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418592">case</span>&nbsp;<span class="ident" id="5418597">OpBeginLine</span><span class="op" id="5418608">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418612">return</span>&nbsp;<span class="ident" id="5418619">c</span><span class="op" id="5418620">.</span><span class="ident" id="5418621">empty</span><span class="op" id="5418626">(</span><span class="ident" id="5418627">EmptyBeginLine</span><span class="op" id="5418641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418644">case</span>&nbsp;<span class="ident" id="5418649">OpEndLine</span><span class="op" id="5418658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418662">return</span>&nbsp;<span class="ident" id="5418669">c</span><span class="op" id="5418670">.</span><span class="ident" id="5418671">empty</span><span class="op" id="5418676">(</span><span class="ident" id="5418677">EmptyEndLine</span><span class="op" id="5418689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418692">case</span>&nbsp;<span class="ident" id="5418697">OpBeginText</span><span class="op" id="5418708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418712">return</span>&nbsp;<span class="ident" id="5418719">c</span><span class="op" id="5418720">.</span><span class="ident" id="5418721">empty</span><span class="op" id="5418726">(</span><span class="ident" id="5418727">EmptyBeginText</span><span class="op" id="5418741">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418744">case</span>&nbsp;<span class="ident" id="5418749">OpEndText</span><span class="op" id="5418758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418762">return</span>&nbsp;<span class="ident" id="5418769">c</span><span class="op" id="5418770">.</span><span class="ident" id="5418771">empty</span><span class="op" id="5418776">(</span><span class="ident" id="5418777">EmptyEndText</span><span class="op" id="5418789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418792">case</span>&nbsp;<span class="ident" id="5418797">OpWordBoundary</span><span class="op" id="5418811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418815">return</span>&nbsp;<span class="ident" id="5418822">c</span><span class="op" id="5418823">.</span><span class="ident" id="5418824">empty</span><span class="op" id="5418829">(</span><span class="ident" id="5418830">EmptyWordBoundary</span><span class="op" id="5418847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418850">case</span>&nbsp;<span class="ident" id="5418855">OpNoWordBoundary</span><span class="op" id="5418871">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418875">return</span>&nbsp;<span class="ident" id="5418882">c</span><span class="op" id="5418883">.</span><span class="ident" id="5418884">empty</span><span class="op" id="5418889">(</span><span class="ident" id="5418890">EmptyNoWordBoundary</span><span class="op" id="5418909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418912">case</span>&nbsp;<span class="ident" id="5418917">OpCapture</span><span class="op" id="5418926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418930">bra</span>&nbsp;<span class="op" id="5418934">:=</span>&nbsp;<span class="ident" id="5418937">c</span><span class="op" id="5418938">.</span><span class="builtinfunc" id="5418939">cap</span><span class="op" id="5418942">(</span><span class="builtintype" id="5418943">uint32</span><span class="op" id="5418949">(</span><span class="ident" id="5418950">re</span><span class="op" id="5418952">.</span><span class="ident" id="5418953">Cap</span>&nbsp;<span class="op" id="5418957">&lt;&lt;</span>&nbsp;<span class="num" id="5418960">1</span><span class="op" id="5418961">)</span><span class="op" id="5418962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418966">sub</span>&nbsp;<span class="op" id="5418970">:=</span>&nbsp;<span class="ident" id="5418973">c</span><span class="op" id="5418974">.</span><span class="ident" id="5418975">compile</span><span class="op" id="5418982">(</span><span class="ident" id="5418983">re</span><span class="op" id="5418985">.</span><span class="ident" id="5418986">Sub</span><span class="op" id="5418989">[</span><span class="num" id="5418990">0</span><span class="op" id="5418991">]</span><span class="op" id="5418992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418996">ket</span>&nbsp;<span class="op" id="5419000">:=</span>&nbsp;<span class="ident" id="5419003">c</span><span class="op" id="5419004">.</span><span class="builtinfunc" id="5419005">cap</span><span class="op" id="5419008">(</span><span class="builtintype" id="5419009">uint32</span><span class="op" id="5419015">(</span><span class="ident" id="5419016">re</span><span class="op" id="5419018">.</span><span class="ident" id="5419019">Cap</span><span class="op" id="5419022">&lt;&lt;</span><span class="num" id="5419024">1</span>&nbsp;<span class="op" id="5419026">|</span>&nbsp;<span class="num" id="5419028">1</span><span class="op" id="5419029">)</span><span class="op" id="5419030">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419034">return</span>&nbsp;<span class="ident" id="5419041">c</span><span class="op" id="5419042">.</span><span class="ident" id="5419043">cat</span><span class="op" id="5419046">(</span><span class="ident" id="5419047">c</span><span class="op" id="5419048">.</span><span class="ident" id="5419049">cat</span><span class="op" id="5419052">(</span><span class="ident" id="5419053">bra</span><span class="op" id="5419056">,</span>&nbsp;<span class="ident" id="5419058">sub</span><span class="op" id="5419061">)</span><span class="op" id="5419062">,</span>&nbsp;<span class="ident" id="5419064">ket</span><span class="op" id="5419067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419070">case</span>&nbsp;<span class="ident" id="5419075">OpStar</span><span class="op" id="5419081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419085">return</span>&nbsp;<span class="ident" id="5419092">c</span><span class="op" id="5419093">.</span><span class="ident" id="5419094">star</span><span class="op" id="5419098">(</span><span class="ident" id="5419099">c</span><span class="op" id="5419100">.</span><span class="ident" id="5419101">compile</span><span class="op" id="5419108">(</span><span class="ident" id="5419109">re</span><span class="op" id="5419111">.</span><span class="ident" id="5419112">Sub</span><span class="op" id="5419115">[</span><span class="num" id="5419116">0</span><span class="op" id="5419117">]</span><span class="op" id="5419118">)</span><span class="op" id="5419119">,</span>&nbsp;<span class="ident" id="5419121">re</span><span class="op" id="5419123">.</span><span class="ident" id="5419124">Flags</span><span class="op" id="5419129">&amp;</span><span class="ident" id="5419130">NonGreedy</span>&nbsp;<span class="op" id="5419140">!=</span>&nbsp;<span class="num" id="5419143">0</span><span class="op" id="5419144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419147">case</span>&nbsp;<span class="ident" id="5419152">OpPlus</span><span class="op" id="5419158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419162">return</span>&nbsp;<span class="ident" id="5419169">c</span><span class="op" id="5419170">.</span><span class="ident" id="5419171">plus</span><span class="op" id="5419175">(</span><span class="ident" id="5419176">c</span><span class="op" id="5419177">.</span><span class="ident" id="5419178">compile</span><span class="op" id="5419185">(</span><span class="ident" id="5419186">re</span><span class="op" id="5419188">.</span><span class="ident" id="5419189">Sub</span><span class="op" id="5419192">[</span><span class="num" id="5419193">0</span><span class="op" id="5419194">]</span><span class="op" id="5419195">)</span><span class="op" id="5419196">,</span>&nbsp;<span class="ident" id="5419198">re</span><span class="op" id="5419200">.</span><span class="ident" id="5419201">Flags</span><span class="op" id="5419206">&amp;</span><span class="ident" id="5419207">NonGreedy</span>&nbsp;<span class="op" id="5419217">!=</span>&nbsp;<span class="num" id="5419220">0</span><span class="op" id="5419221">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419224">case</span>&nbsp;<span class="ident" id="5419229">OpQuest</span><span class="op" id="5419236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419240">return</span>&nbsp;<span class="ident" id="5419247">c</span><span class="op" id="5419248">.</span><span class="ident" id="5419249">quest</span><span class="op" id="5419254">(</span><span class="ident" id="5419255">c</span><span class="op" id="5419256">.</span><span class="ident" id="5419257">compile</span><span class="op" id="5419264">(</span><span class="ident" id="5419265">re</span><span class="op" id="5419267">.</span><span class="ident" id="5419268">Sub</span><span class="op" id="5419271">[</span><span class="num" id="5419272">0</span><span class="op" id="5419273">]</span><span class="op" id="5419274">)</span><span class="op" id="5419275">,</span>&nbsp;<span class="ident" id="5419277">re</span><span class="op" id="5419279">.</span><span class="ident" id="5419280">Flags</span><span class="op" id="5419285">&amp;</span><span class="ident" id="5419286">NonGreedy</span>&nbsp;<span class="op" id="5419296">!=</span>&nbsp;<span class="num" id="5419299">0</span><span class="op" id="5419300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419303">case</span>&nbsp;<span class="ident" id="5419308">OpConcat</span><span class="op" id="5419316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419320">if</span>&nbsp;<span class="builtinfunc" id="5419323">len</span><span class="op" id="5419326">(</span><span class="ident" id="5419327">re</span><span class="op" id="5419329">.</span><span class="ident" id="5419330">Sub</span><span class="op" id="5419333">)</span>&nbsp;<span class="op" id="5419335">==</span>&nbsp;<span class="num" id="5419338">0</span>&nbsp;<span class="op" id="5419340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419345">return</span>&nbsp;<span class="ident" id="5419352">c</span><span class="op" id="5419353">.</span><span class="ident" id="5419354">nop</span><span class="op" id="5419357">(</span><span class="op" id="5419358">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419366">var</span>&nbsp;<span class="ident" id="5419370">f</span>&nbsp;<span class="ident" id="5419372">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419379">for</span>&nbsp;<span class="ident" id="5419383">i</span><span class="op" id="5419384">,</span>&nbsp;<span class="ident" id="5419386">sub</span>&nbsp;<span class="op" id="5419390">:=</span>&nbsp;<span class="keyword" id="5419393">range</span>&nbsp;<span class="ident" id="5419399">re</span><span class="op" id="5419401">.</span><span class="ident" id="5419402">Sub</span>&nbsp;<span class="op" id="5419406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419411">if</span>&nbsp;<span class="ident" id="5419414">i</span>&nbsp;<span class="op" id="5419416">==</span>&nbsp;<span class="num" id="5419419">0</span>&nbsp;<span class="op" id="5419421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419427">f</span>&nbsp;<span class="op" id="5419429">=</span>&nbsp;<span class="ident" id="5419431">c</span><span class="op" id="5419432">.</span><span class="ident" id="5419433">compile</span><span class="op" id="5419440">(</span><span class="ident" id="5419441">sub</span><span class="op" id="5419444">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419449">}</span>&nbsp;<span class="keyword" id="5419451">else</span>&nbsp;<span class="op" id="5419456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419462">f</span>&nbsp;<span class="op" id="5419464">=</span>&nbsp;<span class="ident" id="5419466">c</span><span class="op" id="5419467">.</span><span class="ident" id="5419468">cat</span><span class="op" id="5419471">(</span><span class="ident" id="5419472">f</span><span class="op" id="5419473">,</span>&nbsp;<span class="ident" id="5419475">c</span><span class="op" id="5419476">.</span><span class="ident" id="5419477">compile</span><span class="op" id="5419484">(</span><span class="ident" id="5419485">sub</span><span class="op" id="5419488">)</span><span class="op" id="5419489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419502">return</span>&nbsp;<span class="ident" id="5419509">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419512">case</span>&nbsp;<span class="ident" id="5419517">OpAlternate</span><span class="op" id="5419528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419532">var</span>&nbsp;<span class="ident" id="5419536">f</span>&nbsp;<span class="ident" id="5419538">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419545">for</span>&nbsp;<span class="ident" id="5419549">_</span><span class="op" id="5419550">,</span>&nbsp;<span class="ident" id="5419552">sub</span>&nbsp;<span class="op" id="5419556">:=</span>&nbsp;<span class="keyword" id="5419559">range</span>&nbsp;<span class="ident" id="5419565">re</span><span class="op" id="5419567">.</span><span class="ident" id="5419568">Sub</span>&nbsp;<span class="op" id="5419572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419577">f</span>&nbsp;<span class="op" id="5419579">=</span>&nbsp;<span class="ident" id="5419581">c</span><span class="op" id="5419582">.</span><span class="ident" id="5419583">alt</span><span class="op" id="5419586">(</span><span class="ident" id="5419587">f</span><span class="op" id="5419588">,</span>&nbsp;<span class="ident" id="5419590">c</span><span class="op" id="5419591">.</span><span class="ident" id="5419592">compile</span><span class="op" id="5419599">(</span><span class="ident" id="5419600">sub</span><span class="op" id="5419603">)</span><span class="op" id="5419604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419608">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419612">return</span>&nbsp;<span class="ident" id="5419619">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5419625">panic</span><span class="op" id="5419630">(</span><span class="string" id="5419631">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5419666">)</span><br>
<span class="lineno"></span><span class="op" id="5419668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5419671">func</span>&nbsp;<span class="op" id="5419676">(</span><span class="ident" id="5419677">c</span>&nbsp;<span class="op" id="5419679">*</span><span class="ident" id="5419680">compiler</span><span class="op" id="5419688">)</span>&nbsp;<span class="ident" id="5419690">inst</span><span class="op" id="5419694">(</span><span class="ident" id="5419695">op</span>&nbsp;<span class="ident" id="5419698">InstOp</span><span class="op" id="5419704">)</span>&nbsp;<span class="ident" id="5419706">frag</span>&nbsp;<span class="op" id="5419711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419714">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419744">f</span>&nbsp;<span class="op" id="5419746">:=</span>&nbsp;<span class="ident" id="5419749">frag</span><span class="op" id="5419753">{</span><span class="ident" id="5419754">i</span><span class="op" id="5419755">:</span>&nbsp;<span class="builtintype" id="5419757">uint32</span><span class="op" id="5419763">(</span><span class="builtinfunc" id="5419764">len</span><span class="op" id="5419767">(</span><span class="ident" id="5419768">c</span><span class="op" id="5419769">.</span><span class="ident" id="5419770">p</span><span class="op" id="5419771">.</span><span class="ident" id="5419772">Inst</span><span class="op" id="5419776">)</span><span class="op" id="5419777">)</span><span class="op" id="5419778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419781">c</span><span class="op" id="5419782">.</span><span class="ident" id="5419783">p</span><span class="op" id="5419784">.</span><span class="ident" id="5419785">Inst</span>&nbsp;<span class="op" id="5419790">=</span>&nbsp;<span class="builtinfunc" id="5419792">append</span><span class="op" id="5419798">(</span><span class="ident" id="5419799">c</span><span class="op" id="5419800">.</span><span class="ident" id="5419801">p</span><span class="op" id="5419802">.</span><span class="ident" id="5419803">Inst</span><span class="op" id="5419807">,</span>&nbsp;<span class="ident" id="5419809">Inst</span><span class="op" id="5419813">{</span><span class="ident" id="5419814">Op</span><span class="op" id="5419816">:</span>&nbsp;<span class="ident" id="5419818">op</span><span class="op" id="5419820">}</span><span class="op" id="5419821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419824">return</span>&nbsp;<span class="ident" id="5419831">f</span><br>
<span class="lineno">175</span><span class="op" id="5419833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5419836">func</span>&nbsp;<span class="op" id="5419841">(</span><span class="ident" id="5419842">c</span>&nbsp;<span class="op" id="5419844">*</span><span class="ident" id="5419845">compiler</span><span class="op" id="5419853">)</span>&nbsp;<span class="ident" id="5419855">nop</span><span class="op" id="5419858">(</span><span class="op" id="5419859">)</span>&nbsp;<span class="ident" id="5419861">frag</span>&nbsp;<span class="op" id="5419866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419869">f</span>&nbsp;<span class="op" id="5419871">:=</span>&nbsp;<span class="ident" id="5419874">c</span><span class="op" id="5419875">.</span><span class="ident" id="5419876">inst</span><span class="op" id="5419880">(</span><span class="ident" id="5419881">InstNop</span><span class="op" id="5419888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419891">f</span><span class="op" id="5419892">.</span><span class="ident" id="5419893">out</span>&nbsp;<span class="op" id="5419897">=</span>&nbsp;<span class="ident" id="5419899">patchList</span><span class="op" id="5419908">(</span><span class="ident" id="5419909">f</span><span class="op" id="5419910">.</span><span class="ident" id="5419911">i</span>&nbsp;<span class="op" id="5419913">&lt;&lt;</span>&nbsp;<span class="num" id="5419916">1</span><span class="op" id="5419917">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419920">return</span>&nbsp;<span class="ident" id="5419927">f</span><br>
<span class="lineno"></span><span class="op" id="5419929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5419932">func</span>&nbsp;<span class="op" id="5419937">(</span><span class="ident" id="5419938">c</span>&nbsp;<span class="op" id="5419940">*</span><span class="ident" id="5419941">compiler</span><span class="op" id="5419949">)</span>&nbsp;<span class="ident" id="5419951">fail</span><span class="op" id="5419955">(</span><span class="op" id="5419956">)</span>&nbsp;<span class="ident" id="5419958">frag</span>&nbsp;<span class="op" id="5419963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419966">return</span>&nbsp;<span class="ident" id="5419973">frag</span><span class="op" id="5419977">{</span><span class="op" id="5419978">}</span><br>
<span class="lineno">185</span><span class="op" id="5419980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5419983">func</span>&nbsp;<span class="op" id="5419988">(</span><span class="ident" id="5419989">c</span>&nbsp;<span class="op" id="5419991">*</span><span class="ident" id="5419992">compiler</span><span class="op" id="5420000">)</span>&nbsp;<span class="builtinfunc" id="5420002">cap</span><span class="op" id="5420005">(</span><span class="ident" id="5420006">arg</span>&nbsp;<span class="builtintype" id="5420010">uint32</span><span class="op" id="5420016">)</span>&nbsp;<span class="ident" id="5420018">frag</span>&nbsp;<span class="op" id="5420023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420026">f</span>&nbsp;<span class="op" id="5420028">:=</span>&nbsp;<span class="ident" id="5420031">c</span><span class="op" id="5420032">.</span><span class="ident" id="5420033">inst</span><span class="op" id="5420037">(</span><span class="ident" id="5420038">InstCapture</span><span class="op" id="5420049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420052">f</span><span class="op" id="5420053">.</span><span class="ident" id="5420054">out</span>&nbsp;<span class="op" id="5420058">=</span>&nbsp;<span class="ident" id="5420060">patchList</span><span class="op" id="5420069">(</span><span class="ident" id="5420070">f</span><span class="op" id="5420071">.</span><span class="ident" id="5420072">i</span>&nbsp;<span class="op" id="5420074">&lt;&lt;</span>&nbsp;<span class="num" id="5420077">1</span><span class="op" id="5420078">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420081">c</span><span class="op" id="5420082">.</span><span class="ident" id="5420083">p</span><span class="op" id="5420084">.</span><span class="ident" id="5420085">Inst</span><span class="op" id="5420089">[</span><span class="ident" id="5420090">f</span><span class="op" id="5420091">.</span><span class="ident" id="5420092">i</span><span class="op" id="5420093">]</span><span class="op" id="5420094">.</span><span class="ident" id="5420095">Arg</span>&nbsp;<span class="op" id="5420099">=</span>&nbsp;<span class="ident" id="5420101">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420107">if</span>&nbsp;<span class="ident" id="5420110">c</span><span class="op" id="5420111">.</span><span class="ident" id="5420112">p</span><span class="op" id="5420113">.</span><span class="ident" id="5420114">NumCap</span>&nbsp;<span class="op" id="5420121">&lt;</span>&nbsp;<span class="builtintype" id="5420123">int</span><span class="op" id="5420126">(</span><span class="ident" id="5420127">arg</span><span class="op" id="5420130">)</span><span class="op" id="5420131">+</span><span class="num" id="5420132">1</span>&nbsp;<span class="op" id="5420134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420138">c</span><span class="op" id="5420139">.</span><span class="ident" id="5420140">p</span><span class="op" id="5420141">.</span><span class="ident" id="5420142">NumCap</span>&nbsp;<span class="op" id="5420149">=</span>&nbsp;<span class="builtintype" id="5420151">int</span><span class="op" id="5420154">(</span><span class="ident" id="5420155">arg</span><span class="op" id="5420158">)</span>&nbsp;<span class="op" id="5420160">+</span>&nbsp;<span class="num" id="5420162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420165">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420168">return</span>&nbsp;<span class="ident" id="5420175">f</span><br>
<span class="lineno"></span><span class="op" id="5420177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420180">func</span>&nbsp;<span class="op" id="5420185">(</span><span class="ident" id="5420186">c</span>&nbsp;<span class="op" id="5420188">*</span><span class="ident" id="5420189">compiler</span><span class="op" id="5420197">)</span>&nbsp;<span class="ident" id="5420199">cat</span><span class="op" id="5420202">(</span><span class="ident" id="5420203">f1</span><span class="op" id="5420205">,</span>&nbsp;<span class="ident" id="5420207">f2</span>&nbsp;<span class="ident" id="5420210">frag</span><span class="op" id="5420214">)</span>&nbsp;<span class="ident" id="5420216">frag</span>&nbsp;<span class="op" id="5420221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5420224">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420257">if</span>&nbsp;<span class="ident" id="5420260">f1</span><span class="op" id="5420262">.</span><span class="ident" id="5420263">i</span>&nbsp;<span class="op" id="5420265">==</span>&nbsp;<span class="num" id="5420268">0</span>&nbsp;<span class="op" id="5420270">||</span>&nbsp;<span class="ident" id="5420273">f2</span><span class="op" id="5420275">.</span><span class="ident" id="5420276">i</span>&nbsp;<span class="op" id="5420278">==</span>&nbsp;<span class="num" id="5420281">0</span>&nbsp;<span class="op" id="5420283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420287">return</span>&nbsp;<span class="ident" id="5420294">frag</span><span class="op" id="5420298">{</span><span class="op" id="5420299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5420306">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420327">f1</span><span class="op" id="5420329">.</span><span class="ident" id="5420330">out</span><span class="op" id="5420333">.</span><span class="ident" id="5420334">patch</span><span class="op" id="5420339">(</span><span class="ident" id="5420340">c</span><span class="op" id="5420341">.</span><span class="ident" id="5420342">p</span><span class="op" id="5420343">,</span>&nbsp;<span class="ident" id="5420345">f2</span><span class="op" id="5420347">.</span><span class="ident" id="5420348">i</span><span class="op" id="5420349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420352">return</span>&nbsp;<span class="ident" id="5420359">frag</span><span class="op" id="5420363">{</span><span class="ident" id="5420364">f1</span><span class="op" id="5420366">.</span><span class="ident" id="5420367">i</span><span class="op" id="5420368">,</span>&nbsp;<span class="ident" id="5420370">f2</span><span class="op" id="5420372">.</span><span class="ident" id="5420373">out</span><span class="op" id="5420376">}</span><br>
<span class="lineno"></span><span class="op" id="5420378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5420381">func</span>&nbsp;<span class="op" id="5420386">(</span><span class="ident" id="5420387">c</span>&nbsp;<span class="op" id="5420389">*</span><span class="ident" id="5420390">compiler</span><span class="op" id="5420398">)</span>&nbsp;<span class="ident" id="5420400">alt</span><span class="op" id="5420403">(</span><span class="ident" id="5420404">f1</span><span class="op" id="5420406">,</span>&nbsp;<span class="ident" id="5420408">f2</span>&nbsp;<span class="ident" id="5420411">frag</span><span class="op" id="5420415">)</span>&nbsp;<span class="ident" id="5420417">frag</span>&nbsp;<span class="op" id="5420422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5420425">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420453">if</span>&nbsp;<span class="ident" id="5420456">f1</span><span class="op" id="5420458">.</span><span class="ident" id="5420459">i</span>&nbsp;<span class="op" id="5420461">==</span>&nbsp;<span class="num" id="5420464">0</span>&nbsp;<span class="op" id="5420466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420470">return</span>&nbsp;<span class="ident" id="5420477">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420481">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420484">if</span>&nbsp;<span class="ident" id="5420487">f2</span><span class="op" id="5420489">.</span><span class="ident" id="5420490">i</span>&nbsp;<span class="op" id="5420492">==</span>&nbsp;<span class="num" id="5420495">0</span>&nbsp;<span class="op" id="5420497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420501">return</span>&nbsp;<span class="ident" id="5420508">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420516">f</span>&nbsp;<span class="op" id="5420518">:=</span>&nbsp;<span class="ident" id="5420521">c</span><span class="op" id="5420522">.</span><span class="ident" id="5420523">inst</span><span class="op" id="5420527">(</span><span class="ident" id="5420528">InstAlt</span><span class="op" id="5420535">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420538">i</span>&nbsp;<span class="op" id="5420540">:=</span>&nbsp;<span class="op" id="5420543">&amp;</span><span class="ident" id="5420544">c</span><span class="op" id="5420545">.</span><span class="ident" id="5420546">p</span><span class="op" id="5420547">.</span><span class="ident" id="5420548">Inst</span><span class="op" id="5420552">[</span><span class="ident" id="5420553">f</span><span class="op" id="5420554">.</span><span class="ident" id="5420555">i</span><span class="op" id="5420556">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420559">i</span><span class="op" id="5420560">.</span><span class="ident" id="5420561">Out</span>&nbsp;<span class="op" id="5420565">=</span>&nbsp;<span class="ident" id="5420567">f1</span><span class="op" id="5420569">.</span><span class="ident" id="5420570">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420573">i</span><span class="op" id="5420574">.</span><span class="ident" id="5420575">Arg</span>&nbsp;<span class="op" id="5420579">=</span>&nbsp;<span class="ident" id="5420581">f2</span><span class="op" id="5420583">.</span><span class="ident" id="5420584">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420587">f</span><span class="op" id="5420588">.</span><span class="ident" id="5420589">out</span>&nbsp;<span class="op" id="5420593">=</span>&nbsp;<span class="ident" id="5420595">f1</span><span class="op" id="5420597">.</span><span class="ident" id="5420598">out</span><span class="op" id="5420601">.</span><span class="builtinfunc" id="5420602">append</span><span class="op" id="5420608">(</span><span class="ident" id="5420609">c</span><span class="op" id="5420610">.</span><span class="ident" id="5420611">p</span><span class="op" id="5420612">,</span>&nbsp;<span class="ident" id="5420614">f2</span><span class="op" id="5420616">.</span><span class="ident" id="5420617">out</span><span class="op" id="5420620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420623">return</span>&nbsp;<span class="ident" id="5420630">f</span><br>
<span class="lineno">225</span><span class="op" id="5420632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420635">func</span>&nbsp;<span class="op" id="5420640">(</span><span class="ident" id="5420641">c</span>&nbsp;<span class="op" id="5420643">*</span><span class="ident" id="5420644">compiler</span><span class="op" id="5420652">)</span>&nbsp;<span class="ident" id="5420654">quest</span><span class="op" id="5420659">(</span><span class="ident" id="5420660">f1</span>&nbsp;<span class="ident" id="5420663">frag</span><span class="op" id="5420667">,</span>&nbsp;<span class="ident" id="5420669">nongreedy</span>&nbsp;<span class="builtintype" id="5420679">bool</span><span class="op" id="5420683">)</span>&nbsp;<span class="ident" id="5420685">frag</span>&nbsp;<span class="op" id="5420690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420693">f</span>&nbsp;<span class="op" id="5420695">:=</span>&nbsp;<span class="ident" id="5420698">c</span><span class="op" id="5420699">.</span><span class="ident" id="5420700">inst</span><span class="op" id="5420704">(</span><span class="ident" id="5420705">InstAlt</span><span class="op" id="5420712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420715">i</span>&nbsp;<span class="op" id="5420717">:=</span>&nbsp;<span class="op" id="5420720">&amp;</span><span class="ident" id="5420721">c</span><span class="op" id="5420722">.</span><span class="ident" id="5420723">p</span><span class="op" id="5420724">.</span><span class="ident" id="5420725">Inst</span><span class="op" id="5420729">[</span><span class="ident" id="5420730">f</span><span class="op" id="5420731">.</span><span class="ident" id="5420732">i</span><span class="op" id="5420733">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420736">if</span>&nbsp;<span class="ident" id="5420739">nongreedy</span>&nbsp;<span class="op" id="5420749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420753">i</span><span class="op" id="5420754">.</span><span class="ident" id="5420755">Arg</span>&nbsp;<span class="op" id="5420759">=</span>&nbsp;<span class="ident" id="5420761">f1</span><span class="op" id="5420763">.</span><span class="ident" id="5420764">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420768">f</span><span class="op" id="5420769">.</span><span class="ident" id="5420770">out</span>&nbsp;<span class="op" id="5420774">=</span>&nbsp;<span class="ident" id="5420776">patchList</span><span class="op" id="5420785">(</span><span class="ident" id="5420786">f</span><span class="op" id="5420787">.</span><span class="ident" id="5420788">i</span>&nbsp;<span class="op" id="5420790">&lt;&lt;</span>&nbsp;<span class="num" id="5420793">1</span><span class="op" id="5420794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420797">}</span>&nbsp;<span class="keyword" id="5420799">else</span>&nbsp;<span class="op" id="5420804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420808">i</span><span class="op" id="5420809">.</span><span class="ident" id="5420810">Out</span>&nbsp;<span class="op" id="5420814">=</span>&nbsp;<span class="ident" id="5420816">f1</span><span class="op" id="5420818">.</span><span class="ident" id="5420819">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420823">f</span><span class="op" id="5420824">.</span><span class="ident" id="5420825">out</span>&nbsp;<span class="op" id="5420829">=</span>&nbsp;<span class="ident" id="5420831">patchList</span><span class="op" id="5420840">(</span><span class="ident" id="5420841">f</span><span class="op" id="5420842">.</span><span class="ident" id="5420843">i</span><span class="op" id="5420844">&lt;&lt;</span><span class="num" id="5420846">1</span>&nbsp;<span class="op" id="5420848">|</span>&nbsp;<span class="num" id="5420850">1</span><span class="op" id="5420851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420857">f</span><span class="op" id="5420858">.</span><span class="ident" id="5420859">out</span>&nbsp;<span class="op" id="5420863">=</span>&nbsp;<span class="ident" id="5420865">f</span><span class="op" id="5420866">.</span><span class="ident" id="5420867">out</span><span class="op" id="5420870">.</span><span class="builtinfunc" id="5420871">append</span><span class="op" id="5420877">(</span><span class="ident" id="5420878">c</span><span class="op" id="5420879">.</span><span class="ident" id="5420880">p</span><span class="op" id="5420881">,</span>&nbsp;<span class="ident" id="5420883">f1</span><span class="op" id="5420885">.</span><span class="ident" id="5420886">out</span><span class="op" id="5420889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420892">return</span>&nbsp;<span class="ident" id="5420899">f</span><br>
<span class="lineno"></span><span class="op" id="5420901">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5420904">func</span>&nbsp;<span class="op" id="5420909">(</span><span class="ident" id="5420910">c</span>&nbsp;<span class="op" id="5420912">*</span><span class="ident" id="5420913">compiler</span><span class="op" id="5420921">)</span>&nbsp;<span class="ident" id="5420923">star</span><span class="op" id="5420927">(</span><span class="ident" id="5420928">f1</span>&nbsp;<span class="ident" id="5420931">frag</span><span class="op" id="5420935">,</span>&nbsp;<span class="ident" id="5420937">nongreedy</span>&nbsp;<span class="builtintype" id="5420947">bool</span><span class="op" id="5420951">)</span>&nbsp;<span class="ident" id="5420953">frag</span>&nbsp;<span class="op" id="5420958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420961">f</span>&nbsp;<span class="op" id="5420963">:=</span>&nbsp;<span class="ident" id="5420966">c</span><span class="op" id="5420967">.</span><span class="ident" id="5420968">inst</span><span class="op" id="5420972">(</span><span class="ident" id="5420973">InstAlt</span><span class="op" id="5420980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420983">i</span>&nbsp;<span class="op" id="5420985">:=</span>&nbsp;<span class="op" id="5420988">&amp;</span><span class="ident" id="5420989">c</span><span class="op" id="5420990">.</span><span class="ident" id="5420991">p</span><span class="op" id="5420992">.</span><span class="ident" id="5420993">Inst</span><span class="op" id="5420997">[</span><span class="ident" id="5420998">f</span><span class="op" id="5420999">.</span><span class="ident" id="5421000">i</span><span class="op" id="5421001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421004">if</span>&nbsp;<span class="ident" id="5421007">nongreedy</span>&nbsp;<span class="op" id="5421017">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421021">i</span><span class="op" id="5421022">.</span><span class="ident" id="5421023">Arg</span>&nbsp;<span class="op" id="5421027">=</span>&nbsp;<span class="ident" id="5421029">f1</span><span class="op" id="5421031">.</span><span class="ident" id="5421032">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421036">f</span><span class="op" id="5421037">.</span><span class="ident" id="5421038">out</span>&nbsp;<span class="op" id="5421042">=</span>&nbsp;<span class="ident" id="5421044">patchList</span><span class="op" id="5421053">(</span><span class="ident" id="5421054">f</span><span class="op" id="5421055">.</span><span class="ident" id="5421056">i</span>&nbsp;<span class="op" id="5421058">&lt;&lt;</span>&nbsp;<span class="num" id="5421061">1</span><span class="op" id="5421062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421065">}</span>&nbsp;<span class="keyword" id="5421067">else</span>&nbsp;<span class="op" id="5421072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421076">i</span><span class="op" id="5421077">.</span><span class="ident" id="5421078">Out</span>&nbsp;<span class="op" id="5421082">=</span>&nbsp;<span class="ident" id="5421084">f1</span><span class="op" id="5421086">.</span><span class="ident" id="5421087">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421091">f</span><span class="op" id="5421092">.</span><span class="ident" id="5421093">out</span>&nbsp;<span class="op" id="5421097">=</span>&nbsp;<span class="ident" id="5421099">patchList</span><span class="op" id="5421108">(</span><span class="ident" id="5421109">f</span><span class="op" id="5421110">.</span><span class="ident" id="5421111">i</span><span class="op" id="5421112">&lt;&lt;</span><span class="num" id="5421114">1</span>&nbsp;<span class="op" id="5421116">|</span>&nbsp;<span class="num" id="5421118">1</span><span class="op" id="5421119">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421125">f1</span><span class="op" id="5421127">.</span><span class="ident" id="5421128">out</span><span class="op" id="5421131">.</span><span class="ident" id="5421132">patch</span><span class="op" id="5421137">(</span><span class="ident" id="5421138">c</span><span class="op" id="5421139">.</span><span class="ident" id="5421140">p</span><span class="op" id="5421141">,</span>&nbsp;<span class="ident" id="5421143">f</span><span class="op" id="5421144">.</span><span class="ident" id="5421145">i</span><span class="op" id="5421146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421149">return</span>&nbsp;<span class="ident" id="5421156">f</span><br>
<span class="lineno"></span><span class="op" id="5421158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5421161">func</span>&nbsp;<span class="op" id="5421166">(</span><span class="ident" id="5421167">c</span>&nbsp;<span class="op" id="5421169">*</span><span class="ident" id="5421170">compiler</span><span class="op" id="5421178">)</span>&nbsp;<span class="ident" id="5421180">plus</span><span class="op" id="5421184">(</span><span class="ident" id="5421185">f1</span>&nbsp;<span class="ident" id="5421188">frag</span><span class="op" id="5421192">,</span>&nbsp;<span class="ident" id="5421194">nongreedy</span>&nbsp;<span class="builtintype" id="5421204">bool</span><span class="op" id="5421208">)</span>&nbsp;<span class="ident" id="5421210">frag</span>&nbsp;<span class="op" id="5421215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421218">return</span>&nbsp;<span class="ident" id="5421225">frag</span><span class="op" id="5421229">{</span><span class="ident" id="5421230">f1</span><span class="op" id="5421232">.</span><span class="ident" id="5421233">i</span><span class="op" id="5421234">,</span>&nbsp;<span class="ident" id="5421236">c</span><span class="op" id="5421237">.</span><span class="ident" id="5421238">star</span><span class="op" id="5421242">(</span><span class="ident" id="5421243">f1</span><span class="op" id="5421245">,</span>&nbsp;<span class="ident" id="5421247">nongreedy</span><span class="op" id="5421256">)</span><span class="op" id="5421257">.</span><span class="ident" id="5421258">out</span><span class="op" id="5421261">}</span><br>
<span class="lineno"></span><span class="op" id="5421263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421266">func</span>&nbsp;<span class="op" id="5421271">(</span><span class="ident" id="5421272">c</span>&nbsp;<span class="op" id="5421274">*</span><span class="ident" id="5421275">compiler</span><span class="op" id="5421283">)</span>&nbsp;<span class="ident" id="5421285">empty</span><span class="op" id="5421290">(</span><span class="ident" id="5421291">op</span>&nbsp;<span class="ident" id="5421294">EmptyOp</span><span class="op" id="5421301">)</span>&nbsp;<span class="ident" id="5421303">frag</span>&nbsp;<span class="op" id="5421308">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421311">f</span>&nbsp;<span class="op" id="5421313">:=</span>&nbsp;<span class="ident" id="5421316">c</span><span class="op" id="5421317">.</span><span class="ident" id="5421318">inst</span><span class="op" id="5421322">(</span><span class="ident" id="5421323">InstEmptyWidth</span><span class="op" id="5421337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421340">c</span><span class="op" id="5421341">.</span><span class="ident" id="5421342">p</span><span class="op" id="5421343">.</span><span class="ident" id="5421344">Inst</span><span class="op" id="5421348">[</span><span class="ident" id="5421349">f</span><span class="op" id="5421350">.</span><span class="ident" id="5421351">i</span><span class="op" id="5421352">]</span><span class="op" id="5421353">.</span><span class="ident" id="5421354">Arg</span>&nbsp;<span class="op" id="5421358">=</span>&nbsp;<span class="builtintype" id="5421360">uint32</span><span class="op" id="5421366">(</span><span class="ident" id="5421367">op</span><span class="op" id="5421369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421372">f</span><span class="op" id="5421373">.</span><span class="ident" id="5421374">out</span>&nbsp;<span class="op" id="5421378">=</span>&nbsp;<span class="ident" id="5421380">patchList</span><span class="op" id="5421389">(</span><span class="ident" id="5421390">f</span><span class="op" id="5421391">.</span><span class="ident" id="5421392">i</span>&nbsp;<span class="op" id="5421394">&lt;&lt;</span>&nbsp;<span class="num" id="5421397">1</span><span class="op" id="5421398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421401">return</span>&nbsp;<span class="ident" id="5421408">f</span><br>
<span class="lineno"></span><span class="op" id="5421410">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5421413">func</span>&nbsp;<span class="op" id="5421418">(</span><span class="ident" id="5421419">c</span>&nbsp;<span class="op" id="5421421">*</span><span class="ident" id="5421422">compiler</span><span class="op" id="5421430">)</span>&nbsp;<span class="builtintype" id="5421432">rune</span><span class="op" id="5421436">(</span><span class="ident" id="5421437">r</span>&nbsp;<span class="op" id="5421439">[</span><span class="op" id="5421440">]</span><span class="builtintype" id="5421441">rune</span><span class="op" id="5421445">,</span>&nbsp;<span class="ident" id="5421447">flags</span>&nbsp;<span class="ident" id="5421453">Flags</span><span class="op" id="5421458">)</span>&nbsp;<span class="ident" id="5421460">frag</span>&nbsp;<span class="op" id="5421465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421468">f</span>&nbsp;<span class="op" id="5421470">:=</span>&nbsp;<span class="ident" id="5421473">c</span><span class="op" id="5421474">.</span><span class="ident" id="5421475">inst</span><span class="op" id="5421479">(</span><span class="ident" id="5421480">InstRune</span><span class="op" id="5421488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421491">i</span>&nbsp;<span class="op" id="5421493">:=</span>&nbsp;<span class="op" id="5421496">&amp;</span><span class="ident" id="5421497">c</span><span class="op" id="5421498">.</span><span class="ident" id="5421499">p</span><span class="op" id="5421500">.</span><span class="ident" id="5421501">Inst</span><span class="op" id="5421505">[</span><span class="ident" id="5421506">f</span><span class="op" id="5421507">.</span><span class="ident" id="5421508">i</span><span class="op" id="5421509">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421512">i</span><span class="op" id="5421513">.</span><span class="ident" id="5421514">Rune</span>&nbsp;<span class="op" id="5421519">=</span>&nbsp;<span class="ident" id="5421521">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421524">flags</span>&nbsp;<span class="op" id="5421530">&amp;=</span>&nbsp;<span class="ident" id="5421533">FoldCase</span>&nbsp;<span class="comment" id="5421542">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421577">if</span>&nbsp;<span class="builtinfunc" id="5421580">len</span><span class="op" id="5421583">(</span><span class="ident" id="5421584">r</span><span class="op" id="5421585">)</span>&nbsp;<span class="op" id="5421587">!=</span>&nbsp;<span class="num" id="5421590">1</span>&nbsp;<span class="op" id="5421592">||</span>&nbsp;<span class="ident" id="5421595">unicode</span><span class="op" id="5421602">.</span><span class="ident" id="5421603">SimpleFold</span><span class="op" id="5421613">(</span><span class="ident" id="5421614">r</span><span class="op" id="5421615">[</span><span class="num" id="5421616">0</span><span class="op" id="5421617">]</span><span class="op" id="5421618">)</span>&nbsp;<span class="op" id="5421620">==</span>&nbsp;<span class="ident" id="5421623">r</span><span class="op" id="5421624">[</span><span class="num" id="5421625">0</span><span class="op" id="5421626">]</span>&nbsp;<span class="op" id="5421628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421632">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421665">flags</span>&nbsp;<span class="op" id="5421671">&amp;^=</span>&nbsp;<span class="ident" id="5421675">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421685">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421688">i</span><span class="op" id="5421689">.</span><span class="ident" id="5421690">Arg</span>&nbsp;<span class="op" id="5421694">=</span>&nbsp;<span class="builtintype" id="5421696">uint32</span><span class="op" id="5421702">(</span><span class="ident" id="5421703">flags</span><span class="op" id="5421708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421711">f</span><span class="op" id="5421712">.</span><span class="ident" id="5421713">out</span>&nbsp;<span class="op" id="5421717">=</span>&nbsp;<span class="ident" id="5421719">patchList</span><span class="op" id="5421728">(</span><span class="ident" id="5421729">f</span><span class="op" id="5421730">.</span><span class="ident" id="5421731">i</span>&nbsp;<span class="op" id="5421733">&lt;&lt;</span>&nbsp;<span class="num" id="5421736">1</span><span class="op" id="5421737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421741">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421777">switch</span>&nbsp;<span class="op" id="5421784">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421787">case</span>&nbsp;<span class="ident" id="5421792">flags</span><span class="op" id="5421797">&amp;</span><span class="ident" id="5421798">FoldCase</span>&nbsp;<span class="op" id="5421807">==</span>&nbsp;<span class="num" id="5421810">0</span>&nbsp;<span class="op" id="5421812">&amp;&amp;</span>&nbsp;<span class="op" id="5421815">(</span><span class="builtinfunc" id="5421816">len</span><span class="op" id="5421819">(</span><span class="ident" id="5421820">r</span><span class="op" id="5421821">)</span>&nbsp;<span class="op" id="5421823">==</span>&nbsp;<span class="num" id="5421826">1</span>&nbsp;<span class="op" id="5421828">||</span>&nbsp;<span class="builtinfunc" id="5421831">len</span><span class="op" id="5421834">(</span><span class="ident" id="5421835">r</span><span class="op" id="5421836">)</span>&nbsp;<span class="op" id="5421838">==</span>&nbsp;<span class="num" id="5421841">2</span>&nbsp;<span class="op" id="5421843">&amp;&amp;</span>&nbsp;<span class="ident" id="5421846">r</span><span class="op" id="5421847">[</span><span class="num" id="5421848">0</span><span class="op" id="5421849">]</span>&nbsp;<span class="op" id="5421851">==</span>&nbsp;<span class="ident" id="5421854">r</span><span class="op" id="5421855">[</span><span class="num" id="5421856">1</span><span class="op" id="5421857">]</span><span class="op" id="5421858">)</span><span class="op" id="5421859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421863">i</span><span class="op" id="5421864">.</span><span class="ident" id="5421865">Op</span>&nbsp;<span class="op" id="5421868">=</span>&nbsp;<span class="ident" id="5421870">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421881">case</span>&nbsp;<span class="builtinfunc" id="5421886">len</span><span class="op" id="5421889">(</span><span class="ident" id="5421890">r</span><span class="op" id="5421891">)</span>&nbsp;<span class="op" id="5421893">==</span>&nbsp;<span class="num" id="5421896">2</span>&nbsp;<span class="op" id="5421898">&amp;&amp;</span>&nbsp;<span class="ident" id="5421901">r</span><span class="op" id="5421902">[</span><span class="num" id="5421903">0</span><span class="op" id="5421904">]</span>&nbsp;<span class="op" id="5421906">==</span>&nbsp;<span class="num" id="5421909">0</span>&nbsp;<span class="op" id="5421911">&amp;&amp;</span>&nbsp;<span class="ident" id="5421914">r</span><span class="op" id="5421915">[</span><span class="num" id="5421916">1</span><span class="op" id="5421917">]</span>&nbsp;<span class="op" id="5421919">==</span>&nbsp;<span class="ident" id="5421922">unicode</span><span class="op" id="5421929">.</span><span class="ident" id="5421930">MaxRune</span><span class="op" id="5421937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421941">i</span><span class="op" id="5421942">.</span><span class="ident" id="5421943">Op</span>&nbsp;<span class="op" id="5421946">=</span>&nbsp;<span class="ident" id="5421948">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421961">case</span>&nbsp;<span class="builtinfunc" id="5421966">len</span><span class="op" id="5421969">(</span><span class="ident" id="5421970">r</span><span class="op" id="5421971">)</span>&nbsp;<span class="op" id="5421973">==</span>&nbsp;<span class="num" id="5421976">4</span>&nbsp;<span class="op" id="5421978">&amp;&amp;</span>&nbsp;<span class="ident" id="5421981">r</span><span class="op" id="5421982">[</span><span class="num" id="5421983">0</span><span class="op" id="5421984">]</span>&nbsp;<span class="op" id="5421986">==</span>&nbsp;<span class="num" id="5421989">0</span>&nbsp;<span class="op" id="5421991">&amp;&amp;</span>&nbsp;<span class="ident" id="5421994">r</span><span class="op" id="5421995">[</span><span class="num" id="5421996">1</span><span class="op" id="5421997">]</span>&nbsp;<span class="op" id="5421999">==</span>&nbsp;<span class="string" id="5422002">&#39;\n&#39;</span><span class="op" id="5422006">-</span><span class="num" id="5422007">1</span>&nbsp;<span class="op" id="5422009">&amp;&amp;</span>&nbsp;<span class="ident" id="5422012">r</span><span class="op" id="5422013">[</span><span class="num" id="5422014">2</span><span class="op" id="5422015">]</span>&nbsp;<span class="op" id="5422017">==</span>&nbsp;<span class="string" id="5422020">&#39;\n&#39;</span><span class="op" id="5422024">+</span><span class="num" id="5422025">1</span>&nbsp;<span class="op" id="5422027">&amp;&amp;</span>&nbsp;<span class="ident" id="5422030">r</span><span class="op" id="5422031">[</span><span class="num" id="5422032">3</span><span class="op" id="5422033">]</span>&nbsp;<span class="op" id="5422035">==</span>&nbsp;<span class="ident" id="5422038">unicode</span><span class="op" id="5422045">.</span><span class="ident" id="5422046">MaxRune</span><span class="op" id="5422053">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422057">i</span><span class="op" id="5422058">.</span><span class="ident" id="5422059">Op</span>&nbsp;<span class="op" id="5422062">=</span>&nbsp;<span class="ident" id="5422064">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422086">return</span>&nbsp;<span class="ident" id="5422093">f</span><br>
<span class="lineno"></span><span class="op" id="5422095">}</span>
</div>
</body>
</html>
