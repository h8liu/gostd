<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/md5</h2>
<ul>
<li><a href="/gostd/crypto/md5/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5.go.html" class="current">md5.go</a></li>
<li><a href="/gostd/crypto/md5/md5_test.go.html">md5_test.go</a></li>
<li><a href="/gostd/crypto/md5/md5block.go.html">md5block.go</a></li>
<li><a href="/gostd/crypto/md5/md5block_decl.go.html">md5block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3998616">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3998671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3998725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3998776">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3998831">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="3998904">package</span>&nbsp;<span class="ident" id="3998912">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3998917">import</span>&nbsp;<span class="op" id="3998924">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3998927">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3998937">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3998944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3998947">func</span>&nbsp;<span class="ident" id="3998952">init</span><span class="op" id="3998956">(</span><span class="op" id="3998957">)</span>&nbsp;<span class="op" id="3998959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998962">crypto</span><span class="op" id="3998968">.</span><span class="ident" id="3998969">RegisterHash</span><span class="op" id="3998981">(</span><span class="ident" id="3998982">crypto</span><span class="op" id="3998988">.</span><span class="ident" id="3998989">MD5</span><span class="op" id="3998992">,</span>&nbsp;<span class="ident" id="3998994">New</span><span class="op" id="3998997">)</span><br>
<span class="lineno"></span><span class="op" id="3998999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3999002">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="3999043">const</span>&nbsp;<span class="ident" id="3999049">Size</span>&nbsp;<span class="op" id="3999054">=</span>&nbsp;<span class="num" id="3999056">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3999060">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3999094">const</span>&nbsp;<span class="ident" id="3999100">BlockSize</span>&nbsp;<span class="op" id="3999110">=</span>&nbsp;<span class="num" id="3999112">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3999116">const</span>&nbsp;<span class="op" id="3999122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999125">chunk</span>&nbsp;<span class="op" id="3999131">=</span>&nbsp;<span class="num" id="3999133">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999137">init0</span>&nbsp;<span class="op" id="3999143">=</span>&nbsp;<span class="num" id="3999145">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999157">init1</span>&nbsp;<span class="op" id="3999163">=</span>&nbsp;<span class="num" id="3999165">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999177">init2</span>&nbsp;<span class="op" id="3999183">=</span>&nbsp;<span class="num" id="3999185">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999197">init3</span>&nbsp;<span class="op" id="3999203">=</span>&nbsp;<span class="num" id="3999205">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="3999216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3999219">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3999278">type</span>&nbsp;<span class="ident" id="3999283">digest</span>&nbsp;<span class="keyword" id="3999290">struct</span>&nbsp;<span class="op" id="3999297">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999300">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3999304">[</span><span class="num" id="3999305">4</span><span class="op" id="3999306">]</span><span class="builtintype" id="3999307">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999315">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3999319">[</span><span class="ident" id="3999320">chunk</span><span class="op" id="3999325">]</span><span class="builtintype" id="3999326">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999332">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3999336">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3999341">len</span>&nbsp;<span class="ident" id="3999345">uint64</span><br>
<span class="lineno"></span><span class="op" id="3999352">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3999355">func</span>&nbsp;<span class="op" id="3999360">(</span><span class="ident" id="3999361">d</span>&nbsp;<span class="op" id="3999363">*</span><span class="ident" id="3999364">digest</span><span class="op" id="3999370">)</span>&nbsp;<span class="ident" id="3999372">Reset</span><span class="op" id="3999377">(</span><span class="op" id="3999378">)</span>&nbsp;<span class="op" id="3999380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999383">d</span><span class="op" id="3999384">.</span><span class="ident" id="3999385">s</span><span class="op" id="3999386">[</span><span class="num" id="3999387">0</span><span class="op" id="3999388">]</span>&nbsp;<span class="op" id="3999390">=</span>&nbsp;<span class="ident" id="3999392">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999399">d</span><span class="op" id="3999400">.</span><span class="ident" id="3999401">s</span><span class="op" id="3999402">[</span><span class="num" id="3999403">1</span><span class="op" id="3999404">]</span>&nbsp;<span class="op" id="3999406">=</span>&nbsp;<span class="ident" id="3999408">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999415">d</span><span class="op" id="3999416">.</span><span class="ident" id="3999417">s</span><span class="op" id="3999418">[</span><span class="num" id="3999419">2</span><span class="op" id="3999420">]</span>&nbsp;<span class="op" id="3999422">=</span>&nbsp;<span class="ident" id="3999424">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999431">d</span><span class="op" id="3999432">.</span><span class="ident" id="3999433">s</span><span class="op" id="3999434">[</span><span class="num" id="3999435">3</span><span class="op" id="3999436">]</span>&nbsp;<span class="op" id="3999438">=</span>&nbsp;<span class="ident" id="3999440">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999447">d</span><span class="op" id="3999448">.</span><span class="ident" id="3999449">nx</span>&nbsp;<span class="op" id="3999452">=</span>&nbsp;<span class="num" id="3999454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999457">d</span><span class="op" id="3999458">.</span><span class="builtinfunc" id="3999459">len</span>&nbsp;<span class="op" id="3999463">=</span>&nbsp;<span class="num" id="3999465">0</span><br>
<span class="lineno"></span><span class="op" id="3999467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3999470">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3999529">func</span>&nbsp;<span class="ident" id="3999534">New</span><span class="op" id="3999537">(</span><span class="op" id="3999538">)</span>&nbsp;<span class="ident" id="3999540">hash</span><span class="op" id="3999544">.</span><span class="ident" id="3999545">Hash</span>&nbsp;<span class="op" id="3999550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999553">d</span>&nbsp;<span class="op" id="3999555">:=</span>&nbsp;<span class="builtinfunc" id="3999558">new</span><span class="op" id="3999561">(</span><span class="ident" id="3999562">digest</span><span class="op" id="3999568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999571">d</span><span class="op" id="3999572">.</span><span class="ident" id="3999573">Reset</span><span class="op" id="3999578">(</span><span class="op" id="3999579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999582">return</span>&nbsp;<span class="ident" id="3999589">d</span><br>
<span class="lineno">55</span><span class="op" id="3999591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3999594">func</span>&nbsp;<span class="op" id="3999599">(</span><span class="ident" id="3999600">d</span>&nbsp;<span class="op" id="3999602">*</span><span class="ident" id="3999603">digest</span><span class="op" id="3999609">)</span>&nbsp;<span class="ident" id="3999611">Size</span><span class="op" id="3999615">(</span><span class="op" id="3999616">)</span>&nbsp;<span class="builtintype" id="3999618">int</span>&nbsp;<span class="op" id="3999622">{</span>&nbsp;<span class="keyword" id="3999624">return</span>&nbsp;<span class="ident" id="3999631">Size</span>&nbsp;<span class="op" id="3999636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3999639">func</span>&nbsp;<span class="op" id="3999644">(</span><span class="ident" id="3999645">d</span>&nbsp;<span class="op" id="3999647">*</span><span class="ident" id="3999648">digest</span><span class="op" id="3999654">)</span>&nbsp;<span class="ident" id="3999656">BlockSize</span><span class="op" id="3999665">(</span><span class="op" id="3999666">)</span>&nbsp;<span class="builtintype" id="3999668">int</span>&nbsp;<span class="op" id="3999672">{</span>&nbsp;<span class="keyword" id="3999674">return</span>&nbsp;<span class="ident" id="3999681">BlockSize</span>&nbsp;<span class="op" id="3999691">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3999694">func</span>&nbsp;<span class="op" id="3999699">(</span><span class="ident" id="3999700">d</span>&nbsp;<span class="op" id="3999702">*</span><span class="ident" id="3999703">digest</span><span class="op" id="3999709">)</span>&nbsp;<span class="ident" id="3999711">Write</span><span class="op" id="3999716">(</span><span class="ident" id="3999717">p</span>&nbsp;<span class="op" id="3999719">[</span><span class="op" id="3999720">]</span><span class="builtintype" id="3999721">byte</span><span class="op" id="3999725">)</span>&nbsp;<span class="op" id="3999727">(</span><span class="ident" id="3999728">nn</span>&nbsp;<span class="builtintype" id="3999731">int</span><span class="op" id="3999734">,</span>&nbsp;<span class="ident" id="3999736">err</span>&nbsp;<span class="builtintype" id="3999740">error</span><span class="op" id="3999745">)</span>&nbsp;<span class="op" id="3999747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999750">nn</span>&nbsp;<span class="op" id="3999753">=</span>&nbsp;<span class="builtinfunc" id="3999755">len</span><span class="op" id="3999758">(</span><span class="ident" id="3999759">p</span><span class="op" id="3999760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999763">d</span><span class="op" id="3999764">.</span><span class="builtinfunc" id="3999765">len</span>&nbsp;<span class="op" id="3999769">+=</span>&nbsp;<span class="ident" id="3999772">uint64</span><span class="op" id="3999778">(</span><span class="ident" id="3999779">nn</span><span class="op" id="3999781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999784">if</span>&nbsp;<span class="ident" id="3999787">d</span><span class="op" id="3999788">.</span><span class="ident" id="3999789">nx</span>&nbsp;<span class="op" id="3999792">&gt;</span>&nbsp;<span class="num" id="3999794">0</span>&nbsp;<span class="op" id="3999796">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999800">n</span>&nbsp;<span class="op" id="3999802">:=</span>&nbsp;<span class="builtinfunc" id="3999805">len</span><span class="op" id="3999808">(</span><span class="ident" id="3999809">p</span><span class="op" id="3999810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999814">if</span>&nbsp;<span class="ident" id="3999817">n</span>&nbsp;<span class="op" id="3999819">&gt;</span>&nbsp;<span class="ident" id="3999821">chunk</span><span class="op" id="3999826">-</span><span class="ident" id="3999827">d</span><span class="op" id="3999828">.</span><span class="ident" id="3999829">nx</span>&nbsp;<span class="op" id="3999832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999837">n</span>&nbsp;<span class="op" id="3999839">=</span>&nbsp;<span class="ident" id="3999841">chunk</span>&nbsp;<span class="op" id="3999847">-</span>&nbsp;<span class="ident" id="3999849">d</span><span class="op" id="3999850">.</span><span class="ident" id="3999851">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999860">for</span>&nbsp;<span class="ident" id="3999864">i</span>&nbsp;<span class="op" id="3999866">:=</span>&nbsp;<span class="num" id="3999869">0</span><span class="op" id="3999870">;</span>&nbsp;<span class="ident" id="3999872">i</span>&nbsp;<span class="op" id="3999874">&lt;</span>&nbsp;<span class="ident" id="3999876">n</span><span class="op" id="3999877">;</span>&nbsp;<span class="ident" id="3999879">i</span><span class="op" id="3999880">++</span>&nbsp;<span class="op" id="3999883">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999888">d</span><span class="op" id="3999889">.</span><span class="ident" id="3999890">x</span><span class="op" id="3999891">[</span><span class="ident" id="3999892">d</span><span class="op" id="3999893">.</span><span class="ident" id="3999894">nx</span><span class="op" id="3999896">+</span><span class="ident" id="3999897">i</span><span class="op" id="3999898">]</span>&nbsp;<span class="op" id="3999900">=</span>&nbsp;<span class="ident" id="3999902">p</span><span class="op" id="3999903">[</span><span class="ident" id="3999904">i</span><span class="op" id="3999905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999913">d</span><span class="op" id="3999914">.</span><span class="ident" id="3999915">nx</span>&nbsp;<span class="op" id="3999918">+=</span>&nbsp;<span class="ident" id="3999921">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999925">if</span>&nbsp;<span class="ident" id="3999928">d</span><span class="op" id="3999929">.</span><span class="ident" id="3999930">nx</span>&nbsp;<span class="op" id="3999933">==</span>&nbsp;<span class="ident" id="3999936">chunk</span>&nbsp;<span class="op" id="3999942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999947">block</span><span class="op" id="3999952">(</span><span class="ident" id="3999953">d</span><span class="op" id="3999954">,</span>&nbsp;<span class="ident" id="3999956">d</span><span class="op" id="3999957">.</span><span class="ident" id="3999958">x</span><span class="op" id="3999959">[</span><span class="num" id="3999960">0</span><span class="op" id="3999961">:</span><span class="ident" id="3999962">chunk</span><span class="op" id="3999967">]</span><span class="op" id="3999968">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999973">d</span><span class="op" id="3999974">.</span><span class="ident" id="3999975">nx</span>&nbsp;<span class="op" id="3999978">=</span>&nbsp;<span class="num" id="3999980">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999988">p</span>&nbsp;<span class="op" id="3999990">=</span>&nbsp;<span class="ident" id="3999992">p</span><span class="op" id="3999993">[</span><span class="ident" id="3999994">n</span><span class="op" id="3999995">:</span><span class="op" id="3999996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000002">if</span>&nbsp;<span class="builtinfunc" id="4000005">len</span><span class="op" id="4000008">(</span><span class="ident" id="4000009">p</span><span class="op" id="4000010">)</span>&nbsp;<span class="op" id="4000012">&gt;=</span>&nbsp;<span class="ident" id="4000015">chunk</span>&nbsp;<span class="op" id="4000021">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000025">n</span>&nbsp;<span class="op" id="4000027">:=</span>&nbsp;<span class="builtinfunc" id="4000030">len</span><span class="op" id="4000033">(</span><span class="ident" id="4000034">p</span><span class="op" id="4000035">)</span>&nbsp;<span class="op" id="4000037">&amp;^</span>&nbsp;<span class="op" id="4000040">(</span><span class="ident" id="4000041">chunk</span>&nbsp;<span class="op" id="4000047">-</span>&nbsp;<span class="num" id="4000049">1</span><span class="op" id="4000050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000054">block</span><span class="op" id="4000059">(</span><span class="ident" id="4000060">d</span><span class="op" id="4000061">,</span>&nbsp;<span class="ident" id="4000063">p</span><span class="op" id="4000064">[</span><span class="op" id="4000065">:</span><span class="ident" id="4000066">n</span><span class="op" id="4000067">]</span><span class="op" id="4000068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000072">p</span>&nbsp;<span class="op" id="4000074">=</span>&nbsp;<span class="ident" id="4000076">p</span><span class="op" id="4000077">[</span><span class="ident" id="4000078">n</span><span class="op" id="4000079">:</span><span class="op" id="4000080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000086">if</span>&nbsp;<span class="builtinfunc" id="4000089">len</span><span class="op" id="4000092">(</span><span class="ident" id="4000093">p</span><span class="op" id="4000094">)</span>&nbsp;<span class="op" id="4000096">&gt;</span>&nbsp;<span class="num" id="4000098">0</span>&nbsp;<span class="op" id="4000100">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000104">d</span><span class="op" id="4000105">.</span><span class="ident" id="4000106">nx</span>&nbsp;<span class="op" id="4000109">=</span>&nbsp;<span class="builtinfunc" id="4000111">copy</span><span class="op" id="4000115">(</span><span class="ident" id="4000116">d</span><span class="op" id="4000117">.</span><span class="ident" id="4000118">x</span><span class="op" id="4000119">[</span><span class="op" id="4000120">:</span><span class="op" id="4000121">]</span><span class="op" id="4000122">,</span>&nbsp;<span class="ident" id="4000124">p</span><span class="op" id="4000125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000131">return</span><br>
<span class="lineno"></span><span class="op" id="4000138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4000141">func</span>&nbsp;<span class="op" id="4000146">(</span><span class="ident" id="4000147">d0</span>&nbsp;<span class="op" id="4000150">*</span><span class="ident" id="4000151">digest</span><span class="op" id="4000157">)</span>&nbsp;<span class="ident" id="4000159">Sum</span><span class="op" id="4000162">(</span><span class="ident" id="4000163">in</span>&nbsp;<span class="op" id="4000166">[</span><span class="op" id="4000167">]</span><span class="builtintype" id="4000168">byte</span><span class="op" id="4000172">)</span>&nbsp;<span class="op" id="4000174">[</span><span class="op" id="4000175">]</span><span class="builtintype" id="4000176">byte</span>&nbsp;<span class="op" id="4000181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000184">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000251">d</span>&nbsp;<span class="op" id="4000253">:=</span>&nbsp;<span class="op" id="4000256">*</span><span class="ident" id="4000257">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000261">hash</span>&nbsp;<span class="op" id="4000266">:=</span>&nbsp;<span class="ident" id="4000269">d</span><span class="op" id="4000270">.</span><span class="ident" id="4000271">checkSum</span><span class="op" id="4000279">(</span><span class="op" id="4000280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000283">return</span>&nbsp;<span class="builtinfunc" id="4000290">append</span><span class="op" id="4000296">(</span><span class="ident" id="4000297">in</span><span class="op" id="4000299">,</span>&nbsp;<span class="ident" id="4000301">hash</span><span class="op" id="4000305">[</span><span class="op" id="4000306">:</span><span class="op" id="4000307">]</span><span class="op" id="4000308">...</span><span class="op" id="4000311">)</span><br>
<span class="lineno">95</span><span class="op" id="4000313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4000316">func</span>&nbsp;<span class="op" id="4000321">(</span><span class="ident" id="4000322">d</span>&nbsp;<span class="op" id="4000324">*</span><span class="ident" id="4000325">digest</span><span class="op" id="4000331">)</span>&nbsp;<span class="ident" id="4000333">checkSum</span><span class="op" id="4000341">(</span><span class="op" id="4000342">)</span>&nbsp;<span class="op" id="4000344">[</span><span class="ident" id="4000345">Size</span><span class="op" id="4000349">]</span><span class="builtintype" id="4000350">byte</span>&nbsp;<span class="op" id="4000355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000358">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4000418">len</span>&nbsp;<span class="op" id="4000422">:=</span>&nbsp;<span class="ident" id="4000425">d</span><span class="op" id="4000426">.</span><span class="builtinfunc" id="4000427">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000432">var</span>&nbsp;<span class="ident" id="4000436">tmp</span>&nbsp;<span class="op" id="4000440">[</span><span class="num" id="4000441">64</span><span class="op" id="4000443">]</span><span class="builtintype" id="4000444">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000450">tmp</span><span class="op" id="4000453">[</span><span class="num" id="4000454">0</span><span class="op" id="4000455">]</span>&nbsp;<span class="op" id="4000457">=</span>&nbsp;<span class="num" id="4000459">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000465">if</span>&nbsp;<span class="builtinfunc" id="4000468">len</span><span class="op" id="4000471">%</span><span class="num" id="4000472">64</span>&nbsp;<span class="op" id="4000475">&lt;</span>&nbsp;<span class="num" id="4000477">56</span>&nbsp;<span class="op" id="4000480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000484">d</span><span class="op" id="4000485">.</span><span class="ident" id="4000486">Write</span><span class="op" id="4000491">(</span><span class="ident" id="4000492">tmp</span><span class="op" id="4000495">[</span><span class="num" id="4000496">0</span>&nbsp;<span class="op" id="4000498">:</span>&nbsp;<span class="num" id="4000500">56</span><span class="op" id="4000502">-</span><span class="builtinfunc" id="4000503">len</span><span class="op" id="4000506">%</span><span class="num" id="4000507">64</span><span class="op" id="4000509">]</span><span class="op" id="4000510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000513">}</span>&nbsp;<span class="keyword" id="4000515">else</span>&nbsp;<span class="op" id="4000520">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000524">d</span><span class="op" id="4000525">.</span><span class="ident" id="4000526">Write</span><span class="op" id="4000531">(</span><span class="ident" id="4000532">tmp</span><span class="op" id="4000535">[</span><span class="num" id="4000536">0</span>&nbsp;<span class="op" id="4000538">:</span>&nbsp;<span class="num" id="4000540">64</span><span class="op" id="4000542">+</span><span class="num" id="4000543">56</span><span class="op" id="4000545">-</span><span class="builtinfunc" id="4000546">len</span><span class="op" id="4000549">%</span><span class="num" id="4000550">64</span><span class="op" id="4000552">]</span><span class="op" id="4000553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000560">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4000580">len</span>&nbsp;<span class="op" id="4000584">&lt;&lt;=</span>&nbsp;<span class="num" id="4000588">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000591">for</span>&nbsp;<span class="ident" id="4000595">i</span>&nbsp;<span class="op" id="4000597">:=</span>&nbsp;<span class="builtintype" id="4000600">uint</span><span class="op" id="4000604">(</span><span class="num" id="4000605">0</span><span class="op" id="4000606">)</span><span class="op" id="4000607">;</span>&nbsp;<span class="ident" id="4000609">i</span>&nbsp;<span class="op" id="4000611">&lt;</span>&nbsp;<span class="num" id="4000613">8</span><span class="op" id="4000614">;</span>&nbsp;<span class="ident" id="4000616">i</span><span class="op" id="4000617">++</span>&nbsp;<span class="op" id="4000620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000624">tmp</span><span class="op" id="4000627">[</span><span class="ident" id="4000628">i</span><span class="op" id="4000629">]</span>&nbsp;<span class="op" id="4000631">=</span>&nbsp;<span class="builtintype" id="4000633">byte</span><span class="op" id="4000637">(</span><span class="builtinfunc" id="4000638">len</span>&nbsp;<span class="op" id="4000642">&gt;&gt;</span>&nbsp;<span class="op" id="4000645">(</span><span class="num" id="4000646">8</span>&nbsp;<span class="op" id="4000648">*</span>&nbsp;<span class="ident" id="4000650">i</span><span class="op" id="4000651">)</span><span class="op" id="4000652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000658">d</span><span class="op" id="4000659">.</span><span class="ident" id="4000660">Write</span><span class="op" id="4000665">(</span><span class="ident" id="4000666">tmp</span><span class="op" id="4000669">[</span><span class="num" id="4000670">0</span><span class="op" id="4000671">:</span><span class="num" id="4000672">8</span><span class="op" id="4000673">]</span><span class="op" id="4000674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000678">if</span>&nbsp;<span class="ident" id="4000681">d</span><span class="op" id="4000682">.</span><span class="ident" id="4000683">nx</span>&nbsp;<span class="op" id="4000686">!=</span>&nbsp;<span class="num" id="4000689">0</span>&nbsp;<span class="op" id="4000691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4000695">panic</span><span class="op" id="4000700">(</span><span class="string" id="4000701">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4000712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000719">var</span>&nbsp;<span class="ident" id="4000723">digest</span>&nbsp;<span class="op" id="4000730">[</span><span class="ident" id="4000731">Size</span><span class="op" id="4000735">]</span><span class="builtintype" id="4000736">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000742">for</span>&nbsp;<span class="ident" id="4000746">i</span><span class="op" id="4000747">,</span>&nbsp;<span class="ident" id="4000749">s</span>&nbsp;<span class="op" id="4000751">:=</span>&nbsp;<span class="keyword" id="4000754">range</span>&nbsp;<span class="ident" id="4000760">d</span><span class="op" id="4000761">.</span><span class="ident" id="4000762">s</span>&nbsp;<span class="op" id="4000764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000768">digest</span><span class="op" id="4000774">[</span><span class="ident" id="4000775">i</span><span class="op" id="4000776">*</span><span class="num" id="4000777">4</span><span class="op" id="4000778">]</span>&nbsp;<span class="op" id="4000780">=</span>&nbsp;<span class="builtintype" id="4000782">byte</span><span class="op" id="4000786">(</span><span class="ident" id="4000787">s</span><span class="op" id="4000788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000792">digest</span><span class="op" id="4000798">[</span><span class="ident" id="4000799">i</span><span class="op" id="4000800">*</span><span class="num" id="4000801">4</span><span class="op" id="4000802">+</span><span class="num" id="4000803">1</span><span class="op" id="4000804">]</span>&nbsp;<span class="op" id="4000806">=</span>&nbsp;<span class="builtintype" id="4000808">byte</span><span class="op" id="4000812">(</span><span class="ident" id="4000813">s</span>&nbsp;<span class="op" id="4000815">&gt;&gt;</span>&nbsp;<span class="num" id="4000818">8</span><span class="op" id="4000819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000823">digest</span><span class="op" id="4000829">[</span><span class="ident" id="4000830">i</span><span class="op" id="4000831">*</span><span class="num" id="4000832">4</span><span class="op" id="4000833">+</span><span class="num" id="4000834">2</span><span class="op" id="4000835">]</span>&nbsp;<span class="op" id="4000837">=</span>&nbsp;<span class="builtintype" id="4000839">byte</span><span class="op" id="4000843">(</span><span class="ident" id="4000844">s</span>&nbsp;<span class="op" id="4000846">&gt;&gt;</span>&nbsp;<span class="num" id="4000849">16</span><span class="op" id="4000851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000855">digest</span><span class="op" id="4000861">[</span><span class="ident" id="4000862">i</span><span class="op" id="4000863">*</span><span class="num" id="4000864">4</span><span class="op" id="4000865">+</span><span class="num" id="4000866">3</span><span class="op" id="4000867">]</span>&nbsp;<span class="op" id="4000869">=</span>&nbsp;<span class="builtintype" id="4000871">byte</span><span class="op" id="4000875">(</span><span class="ident" id="4000876">s</span>&nbsp;<span class="op" id="4000878">&gt;&gt;</span>&nbsp;<span class="num" id="4000881">24</span><span class="op" id="4000883">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000890">return</span>&nbsp;<span class="ident" id="4000897">digest</span><br>
<span class="lineno"></span><span class="op" id="4000904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4000907">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4000952">func</span>&nbsp;<span class="ident" id="4000957">Sum</span><span class="op" id="4000960">(</span><span class="ident" id="4000961">data</span>&nbsp;<span class="op" id="4000966">[</span><span class="op" id="4000967">]</span><span class="builtintype" id="4000968">byte</span><span class="op" id="4000972">)</span>&nbsp;<span class="op" id="4000974">[</span><span class="ident" id="4000975">Size</span><span class="op" id="4000979">]</span><span class="builtintype" id="4000980">byte</span>&nbsp;<span class="op" id="4000985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000988">var</span>&nbsp;<span class="ident" id="4000992">d</span>&nbsp;<span class="ident" id="4000994">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001002">d</span><span class="op" id="4001003">.</span><span class="ident" id="4001004">Reset</span><span class="op" id="4001009">(</span><span class="op" id="4001010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001013">d</span><span class="op" id="4001014">.</span><span class="ident" id="4001015">Write</span><span class="op" id="4001020">(</span><span class="ident" id="4001021">data</span><span class="op" id="4001025">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001028">return</span>&nbsp;<span class="ident" id="4001035">d</span><span class="op" id="4001036">.</span><span class="ident" id="4001037">checkSum</span><span class="op" id="4001045">(</span><span class="op" id="4001046">)</span><br>
<span class="lineno"></span><span class="op" id="4001048">}</span>
</div>
</body>
</html>
