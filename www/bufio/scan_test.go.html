<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="42667">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="42722">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="42776">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="42827">package</span>&nbsp;<span class="ident" id="42835">bufio_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="42847">import</span>&nbsp;<span class="op" id="42854">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="42857">.</span>&nbsp;<span class="string" id="42859">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42868">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42877">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42887">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42893">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42904">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42915">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="42926">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="42941">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="42944">const</span>&nbsp;<span class="ident" id="42950">smallMaxTokenSize</span>&nbsp;<span class="op" id="42968">=</span>&nbsp;<span class="num" id="42970">256</span>&nbsp;<span class="comment" id="42974">//&nbsp;Much&nbsp;smaller&nbsp;for&nbsp;more&nbsp;efficient&nbsp;testing.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="43019">//&nbsp;Test&nbsp;white&nbsp;space&nbsp;table&nbsp;matches&nbsp;the&nbsp;Unicode&nbsp;definition.</span><br>
<span class="lineno"></span><span class="keyword" id="43077">func</span>&nbsp;<span class="ident" id="43082">TestSpace</span><span class="op" id="43091">(</span><span class="ident" id="43092">t</span>&nbsp;<span class="op" id="43094">*</span><span class="ident" id="43095">testing</span><span class="op" id="43102">.</span><span class="ident" id="43103">T</span><span class="op" id="43104">)</span>&nbsp;<span class="op" id="43106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43109">for</span>&nbsp;<span class="ident" id="43113">r</span>&nbsp;<span class="op" id="43115">:=</span>&nbsp;<span class="builtintype" id="43118">rune</span><span class="op" id="43122">(</span><span class="num" id="43123">0</span><span class="op" id="43124">)</span><span class="op" id="43125">;</span>&nbsp;<span class="ident" id="43127">r</span>&nbsp;<span class="op" id="43129">&lt;=</span>&nbsp;<span class="ident" id="43132">utf8</span><span class="op" id="43136">.</span><span class="ident" id="43137">MaxRune</span><span class="op" id="43144">;</span>&nbsp;<span class="ident" id="43146">r</span><span class="op" id="43147">++</span>&nbsp;<span class="op" id="43150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43154">if</span>&nbsp;<span class="ident" id="43157">IsSpace</span><span class="op" id="43164">(</span><span class="ident" id="43165">r</span><span class="op" id="43166">)</span>&nbsp;<span class="op" id="43168">!=</span>&nbsp;<span class="ident" id="43171">unicode</span><span class="op" id="43178">.</span><span class="ident" id="43179">IsSpace</span><span class="op" id="43186">(</span><span class="ident" id="43187">r</span><span class="op" id="43188">)</span>&nbsp;<span class="op" id="43190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43195">t</span><span class="op" id="43196">.</span><span class="ident" id="43197">Fatalf</span><span class="op" id="43203">(</span><span class="string" id="43204">&#34;white&nbsp;space&nbsp;property&nbsp;disagrees:&nbsp;%#U&nbsp;should&nbsp;be&nbsp;%t&#34;</span><span class="op" id="43254">,</span>&nbsp;<span class="ident" id="43256">r</span><span class="op" id="43257">,</span>&nbsp;<span class="ident" id="43259">unicode</span><span class="op" id="43266">.</span><span class="ident" id="43267">IsSpace</span><span class="op" id="43274">(</span><span class="ident" id="43275">r</span><span class="op" id="43276">)</span><span class="op" id="43277">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43284">}</span><br>
<span class="lineno"></span><span class="op" id="43286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="43289">var</span>&nbsp;<span class="ident" id="43293">scanTests</span>&nbsp;<span class="op" id="43303">=</span>&nbsp;<span class="op" id="43305">[</span><span class="op" id="43306">]</span><span class="builtintype" id="43307">string</span><span class="op" id="43313">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43316">&#34;&#34;</span><span class="op" id="43318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43321">&#34;a&#34;</span><span class="op" id="43324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43327">&#34;¼&#34;</span><span class="op" id="43331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43334">&#34;☹&#34;</span><span class="op" id="43339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43342">&#34;\x81&#34;</span><span class="op" id="43348">,</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="43352">//&nbsp;UTF-8&nbsp;error</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43368">&#34;\uFFFD&#34;</span><span class="op" id="43376">,</span>&nbsp;<span class="comment" id="43378">//&nbsp;correctly&nbsp;encoded&nbsp;RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43410">&#34;abcdefgh&#34;</span><span class="op" id="43420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43423">&#34;abc&nbsp;def\n\t\tgh&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="43444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="43447">&#34;abc¼☹\x81\uFFFD日本語\x82abc&#34;</span><span class="op" id="43483">,</span><br>
<span class="lineno"></span><span class="op" id="43485">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="43488">func</span>&nbsp;<span class="ident" id="43493">TestScanByte</span><span class="op" id="43505">(</span><span class="ident" id="43506">t</span>&nbsp;<span class="op" id="43508">*</span><span class="ident" id="43509">testing</span><span class="op" id="43516">.</span><span class="ident" id="43517">T</span><span class="op" id="43518">)</span>&nbsp;<span class="op" id="43520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43523">for</span>&nbsp;<span class="ident" id="43527">n</span><span class="op" id="43528">,</span>&nbsp;<span class="ident" id="43530">test</span>&nbsp;<span class="op" id="43535">:=</span>&nbsp;<span class="keyword" id="43538">range</span>&nbsp;<span class="ident" id="43544">scanTests</span>&nbsp;<span class="op" id="43554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43558">buf</span>&nbsp;<span class="op" id="43562">:=</span>&nbsp;<span class="ident" id="43565">strings</span><span class="op" id="43572">.</span><span class="ident" id="43573">NewReader</span><span class="op" id="43582">(</span><span class="ident" id="43583">test</span><span class="op" id="43587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43591">s</span>&nbsp;<span class="op" id="43593">:=</span>&nbsp;<span class="ident" id="43596">NewScanner</span><span class="op" id="43606">(</span><span class="ident" id="43607">buf</span><span class="op" id="43610">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43614">s</span><span class="op" id="43615">.</span><span class="ident" id="43616">Split</span><span class="op" id="43621">(</span><span class="ident" id="43622">ScanBytes</span><span class="op" id="43631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43635">var</span>&nbsp;<span class="ident" id="43639">i</span>&nbsp;<span class="builtintype" id="43641">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43647">for</span>&nbsp;<span class="ident" id="43651">i</span>&nbsp;<span class="op" id="43653">=</span>&nbsp;<span class="num" id="43655">0</span><span class="op" id="43656">;</span>&nbsp;<span class="ident" id="43658">s</span><span class="op" id="43659">.</span><span class="ident" id="43660">Scan</span><span class="op" id="43664">(</span><span class="op" id="43665">)</span><span class="op" id="43666">;</span>&nbsp;<span class="ident" id="43668">i</span><span class="op" id="43669">++</span>&nbsp;<span class="op" id="43672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43677">if</span>&nbsp;<span class="ident" id="43680">b</span>&nbsp;<span class="op" id="43682">:=</span>&nbsp;<span class="ident" id="43685">s</span><span class="op" id="43686">.</span><span class="ident" id="43687">Bytes</span><span class="op" id="43692">(</span><span class="op" id="43693">)</span><span class="op" id="43694">;</span>&nbsp;<span class="builtinfunc" id="43696">len</span><span class="op" id="43699">(</span><span class="ident" id="43700">b</span><span class="op" id="43701">)</span>&nbsp;<span class="op" id="43703">!=</span>&nbsp;<span class="num" id="43706">1</span>&nbsp;<span class="op" id="43708">||</span>&nbsp;<span class="ident" id="43711">b</span><span class="op" id="43712">[</span><span class="num" id="43713">0</span><span class="op" id="43714">]</span>&nbsp;<span class="op" id="43716">!=</span>&nbsp;<span class="ident" id="43719">test</span><span class="op" id="43723">[</span><span class="ident" id="43724">i</span><span class="op" id="43725">]</span>&nbsp;<span class="op" id="43727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43733">t</span><span class="op" id="43734">.</span><span class="ident" id="43735">Errorf</span><span class="op" id="43741">(</span><span class="string" id="43742">&#34;#%d:&nbsp;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="43771">,</span>&nbsp;<span class="ident" id="43773">n</span><span class="op" id="43774">,</span>&nbsp;<span class="ident" id="43776">i</span><span class="op" id="43777">,</span>&nbsp;<span class="ident" id="43779">test</span><span class="op" id="43783">,</span>&nbsp;<span class="ident" id="43785">b</span><span class="op" id="43786">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43799">if</span>&nbsp;<span class="ident" id="43802">i</span>&nbsp;<span class="op" id="43804">!=</span>&nbsp;<span class="builtinfunc" id="43807">len</span><span class="op" id="43810">(</span><span class="ident" id="43811">test</span><span class="op" id="43815">)</span>&nbsp;<span class="op" id="43817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43822">t</span><span class="op" id="43823">.</span><span class="ident" id="43824">Errorf</span><span class="op" id="43830">(</span><span class="string" id="43831">&#34;#%d:&nbsp;termination&nbsp;expected&nbsp;at&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="43872">,</span>&nbsp;<span class="ident" id="43874">n</span><span class="op" id="43875">,</span>&nbsp;<span class="builtinfunc" id="43877">len</span><span class="op" id="43880">(</span><span class="ident" id="43881">test</span><span class="op" id="43885">)</span><span class="op" id="43886">,</span>&nbsp;<span class="ident" id="43888">i</span><span class="op" id="43889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43893">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43897">err</span>&nbsp;<span class="op" id="43901">:=</span>&nbsp;<span class="ident" id="43904">s</span><span class="op" id="43905">.</span><span class="ident" id="43906">Err</span><span class="op" id="43909">(</span><span class="op" id="43910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="43914">if</span>&nbsp;<span class="ident" id="43917">err</span>&nbsp;<span class="op" id="43921">!=</span>&nbsp;<span class="ident" id="43924">nil</span>&nbsp;<span class="op" id="43928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="43933">t</span><span class="op" id="43934">.</span><span class="ident" id="43935">Errorf</span><span class="op" id="43941">(</span><span class="string" id="43942">&#34;#%d:&nbsp;%v&#34;</span><span class="op" id="43951">,</span>&nbsp;<span class="ident" id="43953">n</span><span class="op" id="43954">,</span>&nbsp;<span class="ident" id="43956">err</span><span class="op" id="43959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="43966">}</span><br>
<span class="lineno">60</span><span class="op" id="43968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="43971">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;rune&nbsp;splitter&nbsp;returns&nbsp;same&nbsp;sequence&nbsp;of&nbsp;runes&nbsp;(not&nbsp;bytes)&nbsp;as&nbsp;for&nbsp;range&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="44066">func</span>&nbsp;<span class="ident" id="44071">TestScanRune</span><span class="op" id="44083">(</span><span class="ident" id="44084">t</span>&nbsp;<span class="op" id="44086">*</span><span class="ident" id="44087">testing</span><span class="op" id="44094">.</span><span class="ident" id="44095">T</span><span class="op" id="44096">)</span>&nbsp;<span class="op" id="44098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44101">for</span>&nbsp;<span class="ident" id="44105">n</span><span class="op" id="44106">,</span>&nbsp;<span class="ident" id="44108">test</span>&nbsp;<span class="op" id="44113">:=</span>&nbsp;<span class="keyword" id="44116">range</span>&nbsp;<span class="ident" id="44122">scanTests</span>&nbsp;<span class="op" id="44132">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44136">buf</span>&nbsp;<span class="op" id="44140">:=</span>&nbsp;<span class="ident" id="44143">strings</span><span class="op" id="44150">.</span><span class="ident" id="44151">NewReader</span><span class="op" id="44160">(</span><span class="ident" id="44161">test</span><span class="op" id="44165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44169">s</span>&nbsp;<span class="op" id="44171">:=</span>&nbsp;<span class="ident" id="44174">NewScanner</span><span class="op" id="44184">(</span><span class="ident" id="44185">buf</span><span class="op" id="44188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44192">s</span><span class="op" id="44193">.</span><span class="ident" id="44194">Split</span><span class="op" id="44199">(</span><span class="ident" id="44200">ScanRunes</span><span class="op" id="44209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44213">var</span>&nbsp;<span class="ident" id="44217">i</span><span class="op" id="44218">,</span>&nbsp;<span class="ident" id="44220">runeCount</span>&nbsp;<span class="builtintype" id="44230">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44236">var</span>&nbsp;<span class="ident" id="44240">expect</span>&nbsp;<span class="builtintype" id="44247">rune</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="44254">//&nbsp;Use&nbsp;a&nbsp;string&nbsp;range&nbsp;loop&nbsp;to&nbsp;validate&nbsp;the&nbsp;sequence&nbsp;of&nbsp;runes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44318">for</span>&nbsp;<span class="ident" id="44322">i</span><span class="op" id="44323">,</span>&nbsp;<span class="ident" id="44325">expect</span>&nbsp;<span class="op" id="44332">=</span>&nbsp;<span class="keyword" id="44334">range</span>&nbsp;<span class="builtintype" id="44340">string</span><span class="op" id="44346">(</span><span class="ident" id="44347">test</span><span class="op" id="44351">)</span>&nbsp;<span class="op" id="44353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44358">if</span>&nbsp;<span class="op" id="44361">!</span><span class="ident" id="44362">s</span><span class="op" id="44363">.</span><span class="ident" id="44364">Scan</span><span class="op" id="44368">(</span><span class="op" id="44369">)</span>&nbsp;<span class="op" id="44371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44377">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44386">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44391">runeCount</span><span class="op" id="44400">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44406">got</span><span class="op" id="44409">,</span>&nbsp;<span class="ident" id="44411">_</span>&nbsp;<span class="op" id="44413">:=</span>&nbsp;<span class="ident" id="44416">utf8</span><span class="op" id="44420">.</span><span class="ident" id="44421">DecodeRune</span><span class="op" id="44431">(</span><span class="ident" id="44432">s</span><span class="op" id="44433">.</span><span class="ident" id="44434">Bytes</span><span class="op" id="44439">(</span><span class="op" id="44440">)</span><span class="op" id="44441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44446">if</span>&nbsp;<span class="ident" id="44449">got</span>&nbsp;<span class="op" id="44453">!=</span>&nbsp;<span class="ident" id="44456">expect</span>&nbsp;<span class="op" id="44463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44469">t</span><span class="op" id="44470">.</span><span class="ident" id="44471">Errorf</span><span class="op" id="44477">(</span><span class="string" id="44478">&#34;#%d:&nbsp;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="44507">,</span>&nbsp;<span class="ident" id="44509">n</span><span class="op" id="44510">,</span>&nbsp;<span class="ident" id="44512">i</span><span class="op" id="44513">,</span>&nbsp;<span class="ident" id="44515">expect</span><span class="op" id="44521">,</span>&nbsp;<span class="ident" id="44523">got</span><span class="op" id="44526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44531">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44539">if</span>&nbsp;<span class="ident" id="44542">s</span><span class="op" id="44543">.</span><span class="ident" id="44544">Scan</span><span class="op" id="44548">(</span><span class="op" id="44549">)</span>&nbsp;<span class="op" id="44551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44556">t</span><span class="op" id="44557">.</span><span class="ident" id="44558">Errorf</span><span class="op" id="44564">(</span><span class="string" id="44565">&#34;#%d:&nbsp;scan&nbsp;ran&nbsp;too&nbsp;long,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="44597">,</span>&nbsp;<span class="ident" id="44599">n</span><span class="op" id="44600">,</span>&nbsp;<span class="ident" id="44602">s</span><span class="op" id="44603">.</span><span class="ident" id="44604">Text</span><span class="op" id="44608">(</span><span class="op" id="44609">)</span><span class="op" id="44610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44618">testRuneCount</span>&nbsp;<span class="op" id="44632">:=</span>&nbsp;<span class="ident" id="44635">utf8</span><span class="op" id="44639">.</span><span class="ident" id="44640">RuneCountInString</span><span class="op" id="44657">(</span><span class="ident" id="44658">test</span><span class="op" id="44662">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44666">if</span>&nbsp;<span class="ident" id="44669">runeCount</span>&nbsp;<span class="op" id="44679">!=</span>&nbsp;<span class="ident" id="44682">testRuneCount</span>&nbsp;<span class="op" id="44696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44701">t</span><span class="op" id="44702">.</span><span class="ident" id="44703">Errorf</span><span class="op" id="44709">(</span><span class="string" id="44710">&#34;#%d:&nbsp;termination&nbsp;expected&nbsp;at&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="44751">,</span>&nbsp;<span class="ident" id="44753">n</span><span class="op" id="44754">,</span>&nbsp;<span class="ident" id="44756">testRuneCount</span><span class="op" id="44769">,</span>&nbsp;<span class="ident" id="44771">runeCount</span><span class="op" id="44780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44788">err</span>&nbsp;<span class="op" id="44792">:=</span>&nbsp;<span class="ident" id="44795">s</span><span class="op" id="44796">.</span><span class="ident" id="44797">Err</span><span class="op" id="44800">(</span><span class="op" id="44801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="44805">if</span>&nbsp;<span class="ident" id="44808">err</span>&nbsp;<span class="op" id="44812">!=</span>&nbsp;<span class="ident" id="44815">nil</span>&nbsp;<span class="op" id="44819">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="44824">t</span><span class="op" id="44825">.</span><span class="ident" id="44826">Errorf</span><span class="op" id="44832">(</span><span class="string" id="44833">&#34;#%d:&nbsp;%v&#34;</span><span class="op" id="44842">,</span>&nbsp;<span class="ident" id="44844">n</span><span class="op" id="44845">,</span>&nbsp;<span class="ident" id="44847">err</span><span class="op" id="44850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="44857">}</span><br>
<span class="lineno"></span><span class="op" id="44859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="44862">var</span>&nbsp;<span class="ident" id="44866">wordScanTests</span>&nbsp;<span class="op" id="44880">=</span>&nbsp;<span class="op" id="44882">[</span><span class="op" id="44883">]</span><span class="builtintype" id="44884">string</span><span class="op" id="44890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44893">&#34;&#34;</span><span class="op" id="44895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44898">&#34;&nbsp;&#34;</span><span class="op" id="44901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44904">&#34;\n&#34;</span><span class="op" id="44908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44911">&#34;a&#34;</span><span class="op" id="44914">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44917">&#34;&nbsp;a&nbsp;&#34;</span><span class="op" id="44922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44925">&#34;abc&nbsp;def&#34;</span><span class="op" id="44934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44937">&#34;&nbsp;abc&nbsp;def&nbsp;&#34;</span><span class="op" id="44948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="44951">&#34;&nbsp;abc\tdef\nghi\rjkl\fmno\vpqr\u0085stu\u00a0\n&#34;</span><span class="op" id="44999">,</span><br>
<span class="lineno"></span><span class="op" id="45001">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="45004">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;word&nbsp;splitter&nbsp;returns&nbsp;the&nbsp;same&nbsp;data&nbsp;as&nbsp;strings.Fields.</span><br>
<span class="lineno"></span><span class="keyword" id="45076">func</span>&nbsp;<span class="ident" id="45081">TestScanWords</span><span class="op" id="45094">(</span><span class="ident" id="45095">t</span>&nbsp;<span class="op" id="45097">*</span><span class="ident" id="45098">testing</span><span class="op" id="45105">.</span><span class="ident" id="45106">T</span><span class="op" id="45107">)</span>&nbsp;<span class="op" id="45109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45112">for</span>&nbsp;<span class="ident" id="45116">n</span><span class="op" id="45117">,</span>&nbsp;<span class="ident" id="45119">test</span>&nbsp;<span class="op" id="45124">:=</span>&nbsp;<span class="keyword" id="45127">range</span>&nbsp;<span class="ident" id="45133">wordScanTests</span>&nbsp;<span class="op" id="45147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45151">buf</span>&nbsp;<span class="op" id="45155">:=</span>&nbsp;<span class="ident" id="45158">strings</span><span class="op" id="45165">.</span><span class="ident" id="45166">NewReader</span><span class="op" id="45175">(</span><span class="ident" id="45176">test</span><span class="op" id="45180">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45184">s</span>&nbsp;<span class="op" id="45186">:=</span>&nbsp;<span class="ident" id="45189">NewScanner</span><span class="op" id="45199">(</span><span class="ident" id="45200">buf</span><span class="op" id="45203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45207">s</span><span class="op" id="45208">.</span><span class="ident" id="45209">Split</span><span class="op" id="45214">(</span><span class="ident" id="45215">ScanWords</span><span class="op" id="45224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45228">words</span>&nbsp;<span class="op" id="45234">:=</span>&nbsp;<span class="ident" id="45237">strings</span><span class="op" id="45244">.</span><span class="ident" id="45245">Fields</span><span class="op" id="45251">(</span><span class="ident" id="45252">test</span><span class="op" id="45256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45260">var</span>&nbsp;<span class="ident" id="45264">wordCount</span>&nbsp;<span class="builtintype" id="45274">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45280">for</span>&nbsp;<span class="ident" id="45284">wordCount</span>&nbsp;<span class="op" id="45294">=</span>&nbsp;<span class="num" id="45296">0</span><span class="op" id="45297">;</span>&nbsp;<span class="ident" id="45299">wordCount</span>&nbsp;<span class="op" id="45309">&lt;</span>&nbsp;<span class="builtinfunc" id="45311">len</span><span class="op" id="45314">(</span><span class="ident" id="45315">words</span><span class="op" id="45320">)</span><span class="op" id="45321">;</span>&nbsp;<span class="ident" id="45323">wordCount</span><span class="op" id="45332">++</span>&nbsp;<span class="op" id="45335">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45340">if</span>&nbsp;<span class="op" id="45343">!</span><span class="ident" id="45344">s</span><span class="op" id="45345">.</span><span class="ident" id="45346">Scan</span><span class="op" id="45350">(</span><span class="op" id="45351">)</span>&nbsp;<span class="op" id="45353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45359">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45373">got</span>&nbsp;<span class="op" id="45377">:=</span>&nbsp;<span class="ident" id="45380">s</span><span class="op" id="45381">.</span><span class="ident" id="45382">Text</span><span class="op" id="45386">(</span><span class="op" id="45387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45392">if</span>&nbsp;<span class="ident" id="45395">got</span>&nbsp;<span class="op" id="45399">!=</span>&nbsp;<span class="ident" id="45402">words</span><span class="op" id="45407">[</span><span class="ident" id="45408">wordCount</span><span class="op" id="45417">]</span>&nbsp;<span class="op" id="45419">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45425">t</span><span class="op" id="45426">.</span><span class="ident" id="45427">Errorf</span><span class="op" id="45433">(</span><span class="string" id="45434">&#34;#%d:&nbsp;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="45463">,</span>&nbsp;<span class="ident" id="45465">n</span><span class="op" id="45466">,</span>&nbsp;<span class="ident" id="45468">wordCount</span><span class="op" id="45477">,</span>&nbsp;<span class="ident" id="45479">words</span><span class="op" id="45484">[</span><span class="ident" id="45485">wordCount</span><span class="op" id="45494">]</span><span class="op" id="45495">,</span>&nbsp;<span class="ident" id="45497">got</span><span class="op" id="45500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45513">if</span>&nbsp;<span class="ident" id="45516">s</span><span class="op" id="45517">.</span><span class="ident" id="45518">Scan</span><span class="op" id="45522">(</span><span class="op" id="45523">)</span>&nbsp;<span class="op" id="45525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45530">t</span><span class="op" id="45531">.</span><span class="ident" id="45532">Errorf</span><span class="op" id="45538">(</span><span class="string" id="45539">&#34;#%d:&nbsp;scan&nbsp;ran&nbsp;too&nbsp;long,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="45571">,</span>&nbsp;<span class="ident" id="45573">n</span><span class="op" id="45574">,</span>&nbsp;<span class="ident" id="45576">s</span><span class="op" id="45577">.</span><span class="ident" id="45578">Text</span><span class="op" id="45582">(</span><span class="op" id="45583">)</span><span class="op" id="45584">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45592">if</span>&nbsp;<span class="ident" id="45595">wordCount</span>&nbsp;<span class="op" id="45605">!=</span>&nbsp;<span class="builtinfunc" id="45608">len</span><span class="op" id="45611">(</span><span class="ident" id="45612">words</span><span class="op" id="45617">)</span>&nbsp;<span class="op" id="45619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45624">t</span><span class="op" id="45625">.</span><span class="ident" id="45626">Errorf</span><span class="op" id="45632">(</span><span class="string" id="45633">&#34;#%d:&nbsp;termination&nbsp;expected&nbsp;at&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="45674">,</span>&nbsp;<span class="ident" id="45676">n</span><span class="op" id="45677">,</span>&nbsp;<span class="builtinfunc" id="45679">len</span><span class="op" id="45682">(</span><span class="ident" id="45683">words</span><span class="op" id="45688">)</span><span class="op" id="45689">,</span>&nbsp;<span class="ident" id="45691">wordCount</span><span class="op" id="45700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45708">err</span>&nbsp;<span class="op" id="45712">:=</span>&nbsp;<span class="ident" id="45715">s</span><span class="op" id="45716">.</span><span class="ident" id="45717">Err</span><span class="op" id="45720">(</span><span class="op" id="45721">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="45725">if</span>&nbsp;<span class="ident" id="45728">err</span>&nbsp;<span class="op" id="45732">!=</span>&nbsp;<span class="ident" id="45735">nil</span>&nbsp;<span class="op" id="45739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45744">t</span><span class="op" id="45745">.</span><span class="ident" id="45746">Errorf</span><span class="op" id="45752">(</span><span class="string" id="45753">&#34;#%d:&nbsp;%v&#34;</span><span class="op" id="45762">,</span>&nbsp;<span class="ident" id="45764">n</span><span class="op" id="45765">,</span>&nbsp;<span class="ident" id="45767">err</span><span class="op" id="45770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="45777">}</span><br>
<span class="lineno"></span><span class="op" id="45779">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="45782">//&nbsp;slowReader&nbsp;is&nbsp;a&nbsp;reader&nbsp;that&nbsp;returns&nbsp;only&nbsp;a&nbsp;few&nbsp;bytes&nbsp;at&nbsp;a&nbsp;time,&nbsp;to&nbsp;test&nbsp;the&nbsp;incremental</span><br>
<span class="lineno"></span><span class="comment" id="45873">//&nbsp;reads&nbsp;in&nbsp;Scanner.Scan.</span><br>
<span class="lineno"></span><span class="keyword" id="45899">type</span>&nbsp;<span class="ident" id="45904">slowReader</span>&nbsp;<span class="keyword" id="45915">struct</span>&nbsp;<span class="op" id="45922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45925">max</span>&nbsp;<span class="builtintype" id="45929">int</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="45934">buf</span>&nbsp;<span class="ident" id="45938">io</span><span class="op" id="45940">.</span><span class="ident" id="45941">Reader</span><br>
<span class="lineno"></span><span class="op" id="45948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="45951">func</span>&nbsp;<span class="op" id="45956">(</span><span class="ident" id="45957">sr</span>&nbsp;<span class="op" id="45960">*</span><span class="ident" id="45961">slowReader</span><span class="op" id="45971">)</span>&nbsp;<span class="ident" id="45973">Read</span><span class="op" id="45977">(</span><span class="ident" id="45978">p</span>&nbsp;<span class="op" id="45980">[</span><span class="op" id="45981">]</span><span class="builtintype" id="45982">byte</span><span class="op" id="45986">)</span>&nbsp;<span class="op" id="45988">(</span><span class="ident" id="45989">n</span>&nbsp;<span class="builtintype" id="45991">int</span><span class="op" id="45994">,</span>&nbsp;<span class="ident" id="45996">err</span>&nbsp;<span class="builtintype" id="46000">error</span><span class="op" id="46005">)</span>&nbsp;<span class="op" id="46007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46010">if</span>&nbsp;<span class="builtinfunc" id="46013">len</span><span class="op" id="46016">(</span><span class="ident" id="46017">p</span><span class="op" id="46018">)</span>&nbsp;<span class="op" id="46020">&gt;</span>&nbsp;<span class="ident" id="46022">sr</span><span class="op" id="46024">.</span><span class="ident" id="46025">max</span>&nbsp;<span class="op" id="46029">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46033">p</span>&nbsp;<span class="op" id="46035">=</span>&nbsp;<span class="ident" id="46037">p</span><span class="op" id="46038">[</span><span class="num" id="46039">0</span><span class="op" id="46040">:</span><span class="ident" id="46041">sr</span><span class="op" id="46043">.</span><span class="ident" id="46044">max</span><span class="op" id="46047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46053">return</span>&nbsp;<span class="ident" id="46060">sr</span><span class="op" id="46062">.</span><span class="ident" id="46063">buf</span><span class="op" id="46066">.</span><span class="ident" id="46067">Read</span><span class="op" id="46071">(</span><span class="ident" id="46072">p</span><span class="op" id="46073">)</span><br>
<span class="lineno"></span><span class="op" id="46075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="46078">//&nbsp;genLine&nbsp;writes&nbsp;to&nbsp;buf&nbsp;a&nbsp;predictable&nbsp;but&nbsp;non-trivial&nbsp;line&nbsp;of&nbsp;text&nbsp;of&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="46156">//&nbsp;n,&nbsp;including&nbsp;the&nbsp;terminal&nbsp;newline&nbsp;and&nbsp;an&nbsp;occasional&nbsp;carriage&nbsp;return.</span><br>
<span class="lineno"></span><span class="comment" id="46228">//&nbsp;If&nbsp;addNewline&nbsp;is&nbsp;false,&nbsp;the&nbsp;\r&nbsp;and&nbsp;\n&nbsp;are&nbsp;not&nbsp;emitted.</span><br>
<span class="lineno"></span><span class="keyword" id="46286">func</span>&nbsp;<span class="ident" id="46291">genLine</span><span class="op" id="46298">(</span><span class="ident" id="46299">buf</span>&nbsp;<span class="op" id="46303">*</span><span class="ident" id="46304">bytes</span><span class="op" id="46309">.</span><span class="ident" id="46310">Buffer</span><span class="op" id="46316">,</span>&nbsp;<span class="ident" id="46318">lineNum</span><span class="op" id="46325">,</span>&nbsp;<span class="ident" id="46327">n</span>&nbsp;<span class="builtintype" id="46329">int</span><span class="op" id="46332">,</span>&nbsp;<span class="ident" id="46334">addNewline</span>&nbsp;<span class="builtintype" id="46345">bool</span><span class="op" id="46349">)</span>&nbsp;<span class="op" id="46351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46354">buf</span><span class="op" id="46357">.</span><span class="ident" id="46358">Reset</span><span class="op" id="46363">(</span><span class="op" id="46364">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46367">doCR</span>&nbsp;<span class="op" id="46372">:=</span>&nbsp;<span class="ident" id="46375">lineNum</span><span class="op" id="46382">%</span><span class="num" id="46383">5</span>&nbsp;<span class="op" id="46385">==</span>&nbsp;<span class="num" id="46388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46391">if</span>&nbsp;<span class="ident" id="46394">doCR</span>&nbsp;<span class="op" id="46399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46403">n</span><span class="op" id="46404">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46411">for</span>&nbsp;<span class="ident" id="46415">i</span>&nbsp;<span class="op" id="46417">:=</span>&nbsp;<span class="num" id="46420">0</span><span class="op" id="46421">;</span>&nbsp;<span class="ident" id="46423">i</span>&nbsp;<span class="op" id="46425">&lt;</span>&nbsp;<span class="ident" id="46427">n</span><span class="op" id="46428">-</span><span class="num" id="46429">1</span><span class="op" id="46430">;</span>&nbsp;<span class="ident" id="46432">i</span><span class="op" id="46433">++</span>&nbsp;<span class="op" id="46436">{</span>&nbsp;<span class="comment" id="46438">//&nbsp;Stop&nbsp;early&nbsp;for&nbsp;\n.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46462">c</span>&nbsp;<span class="op" id="46464">:=</span>&nbsp;<span class="string" id="46467">&#39;a&#39;</span>&nbsp;<span class="op" id="46471">+</span>&nbsp;<span class="builtintype" id="46473">byte</span><span class="op" id="46477">(</span><span class="ident" id="46478">lineNum</span><span class="op" id="46485">+</span><span class="ident" id="46486">i</span><span class="op" id="46487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46491">if</span>&nbsp;<span class="ident" id="46494">c</span>&nbsp;<span class="op" id="46496">==</span>&nbsp;<span class="string" id="46499">&#39;\n&#39;</span>&nbsp;<span class="op" id="46504">||</span>&nbsp;<span class="ident" id="46507">c</span>&nbsp;<span class="op" id="46509">==</span>&nbsp;<span class="string" id="46512">&#39;\r&#39;</span>&nbsp;<span class="op" id="46517">{</span>&nbsp;<span class="comment" id="46519">//&nbsp;Don&#39;t&nbsp;confuse&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46543">c</span>&nbsp;<span class="op" id="46545">=</span>&nbsp;<span class="string" id="46547">&#39;N&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46557">buf</span><span class="op" id="46560">.</span><span class="ident" id="46561">WriteByte</span><span class="op" id="46570">(</span><span class="ident" id="46571">c</span><span class="op" id="46572">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46578">if</span>&nbsp;<span class="ident" id="46581">addNewline</span>&nbsp;<span class="op" id="46592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46596">if</span>&nbsp;<span class="ident" id="46599">doCR</span>&nbsp;<span class="op" id="46604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46609">buf</span><span class="op" id="46612">.</span><span class="ident" id="46613">WriteByte</span><span class="op" id="46622">(</span><span class="string" id="46623">&#39;\r&#39;</span><span class="op" id="46627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46631">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46635">buf</span><span class="op" id="46638">.</span><span class="ident" id="46639">WriteByte</span><span class="op" id="46648">(</span><span class="string" id="46649">&#39;\n&#39;</span><span class="op" id="46653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="46656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46659">return</span><br>
<span class="lineno"></span><span class="op" id="46666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="46669">//&nbsp;Test&nbsp;the&nbsp;line&nbsp;splitter,&nbsp;including&nbsp;some&nbsp;carriage&nbsp;returns&nbsp;but&nbsp;no&nbsp;long&nbsp;lines.</span><br>
<span class="lineno"></span><span class="keyword" id="46747">func</span>&nbsp;<span class="ident" id="46752">TestScanLongLines</span><span class="op" id="46769">(</span><span class="ident" id="46770">t</span>&nbsp;<span class="op" id="46772">*</span><span class="ident" id="46773">testing</span><span class="op" id="46780">.</span><span class="ident" id="46781">T</span><span class="op" id="46782">)</span>&nbsp;<span class="op" id="46784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="46787">//&nbsp;Build&nbsp;a&nbsp;buffer&nbsp;of&nbsp;lots&nbsp;of&nbsp;line&nbsp;lengths&nbsp;up&nbsp;to&nbsp;but&nbsp;not&nbsp;exceeding&nbsp;smallMaxTokenSize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46873">tmp</span>&nbsp;<span class="op" id="46877">:=</span>&nbsp;<span class="builtinfunc" id="46880">new</span><span class="op" id="46883">(</span><span class="ident" id="46884">bytes</span><span class="op" id="46889">.</span><span class="ident" id="46890">Buffer</span><span class="op" id="46896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46899">buf</span>&nbsp;<span class="op" id="46903">:=</span>&nbsp;<span class="builtinfunc" id="46906">new</span><span class="op" id="46909">(</span><span class="ident" id="46910">bytes</span><span class="op" id="46915">.</span><span class="ident" id="46916">Buffer</span><span class="op" id="46922">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46925">lineNum</span>&nbsp;<span class="op" id="46933">:=</span>&nbsp;<span class="num" id="46936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46939">j</span>&nbsp;<span class="op" id="46941">:=</span>&nbsp;<span class="num" id="46944">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="46947">for</span>&nbsp;<span class="ident" id="46951">i</span>&nbsp;<span class="op" id="46953">:=</span>&nbsp;<span class="num" id="46956">0</span><span class="op" id="46957">;</span>&nbsp;<span class="ident" id="46959">i</span>&nbsp;<span class="op" id="46961">&lt;</span>&nbsp;<span class="num" id="46963">2</span><span class="op" id="46964">*</span><span class="ident" id="46965">smallMaxTokenSize</span><span class="op" id="46982">;</span>&nbsp;<span class="ident" id="46984">i</span><span class="op" id="46985">++</span>&nbsp;<span class="op" id="46988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="46992">genLine</span><span class="op" id="46999">(</span><span class="ident" id="47000">tmp</span><span class="op" id="47003">,</span>&nbsp;<span class="ident" id="47005">lineNum</span><span class="op" id="47012">,</span>&nbsp;<span class="ident" id="47014">j</span><span class="op" id="47015">,</span>&nbsp;<span class="ident" id="47017">true</span><span class="op" id="47021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47025">if</span>&nbsp;<span class="ident" id="47028">j</span>&nbsp;<span class="op" id="47030">&lt;</span>&nbsp;<span class="ident" id="47032">smallMaxTokenSize</span>&nbsp;<span class="op" id="47050">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47055">j</span><span class="op" id="47056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47061">}</span>&nbsp;<span class="keyword" id="47063">else</span>&nbsp;<span class="op" id="47068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47073">j</span><span class="op" id="47074">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47083">buf</span><span class="op" id="47086">.</span><span class="ident" id="47087">Write</span><span class="op" id="47092">(</span><span class="ident" id="47093">tmp</span><span class="op" id="47096">.</span><span class="ident" id="47097">Bytes</span><span class="op" id="47102">(</span><span class="op" id="47103">)</span><span class="op" id="47104">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47108">lineNum</span><span class="op" id="47115">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47122">s</span>&nbsp;<span class="op" id="47124">:=</span>&nbsp;<span class="ident" id="47127">NewScanner</span><span class="op" id="47137">(</span><span class="op" id="47138">&amp;</span><span class="ident" id="47139">slowReader</span><span class="op" id="47149">{</span><span class="num" id="47150">1</span><span class="op" id="47151">,</span>&nbsp;<span class="ident" id="47153">buf</span><span class="op" id="47156">}</span><span class="op" id="47157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47160">s</span><span class="op" id="47161">.</span><span class="ident" id="47162">Split</span><span class="op" id="47167">(</span><span class="ident" id="47168">ScanLines</span><span class="op" id="47177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47180">s</span><span class="op" id="47181">.</span><span class="ident" id="47182">MaxTokenSize</span><span class="op" id="47194">(</span><span class="ident" id="47195">smallMaxTokenSize</span><span class="op" id="47212">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47215">j</span>&nbsp;<span class="op" id="47217">=</span>&nbsp;<span class="num" id="47219">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47222">for</span>&nbsp;<span class="ident" id="47226">lineNum</span>&nbsp;<span class="op" id="47234">:=</span>&nbsp;<span class="num" id="47237">0</span><span class="op" id="47238">;</span>&nbsp;<span class="ident" id="47240">s</span><span class="op" id="47241">.</span><span class="ident" id="47242">Scan</span><span class="op" id="47246">(</span><span class="op" id="47247">)</span><span class="op" id="47248">;</span>&nbsp;<span class="ident" id="47250">lineNum</span><span class="op" id="47257">++</span>&nbsp;<span class="op" id="47260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47264">genLine</span><span class="op" id="47271">(</span><span class="ident" id="47272">tmp</span><span class="op" id="47275">,</span>&nbsp;<span class="ident" id="47277">lineNum</span><span class="op" id="47284">,</span>&nbsp;<span class="ident" id="47286">j</span><span class="op" id="47287">,</span>&nbsp;<span class="ident" id="47289">false</span><span class="op" id="47294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47298">if</span>&nbsp;<span class="ident" id="47301">j</span>&nbsp;<span class="op" id="47303">&lt;</span>&nbsp;<span class="ident" id="47305">smallMaxTokenSize</span>&nbsp;<span class="op" id="47323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47328">j</span><span class="op" id="47329">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47334">}</span>&nbsp;<span class="keyword" id="47336">else</span>&nbsp;<span class="op" id="47341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47346">j</span><span class="op" id="47347">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47356">line</span>&nbsp;<span class="op" id="47361">:=</span>&nbsp;<span class="ident" id="47364">tmp</span><span class="op" id="47367">.</span><span class="ident" id="47368">String</span><span class="op" id="47374">(</span><span class="op" id="47375">)</span>&nbsp;<span class="comment" id="47377">//&nbsp;We&nbsp;use&nbsp;the&nbsp;string-valued&nbsp;token&nbsp;here,&nbsp;for&nbsp;variety.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47432">if</span>&nbsp;<span class="ident" id="47435">s</span><span class="op" id="47436">.</span><span class="ident" id="47437">Text</span><span class="op" id="47441">(</span><span class="op" id="47442">)</span>&nbsp;<span class="op" id="47444">!=</span>&nbsp;<span class="ident" id="47447">line</span>&nbsp;<span class="op" id="47452">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47457">t</span><span class="op" id="47458">.</span><span class="ident" id="47459">Errorf</span><span class="op" id="47465">(</span><span class="string" id="47466">&#34;%d:&nbsp;bad&nbsp;line:&nbsp;%d&nbsp;%d\n%.100q\n%.100q\n&#34;</span><span class="op" id="47505">,</span>&nbsp;<span class="ident" id="47507">lineNum</span><span class="op" id="47514">,</span>&nbsp;<span class="builtinfunc" id="47516">len</span><span class="op" id="47519">(</span><span class="ident" id="47520">s</span><span class="op" id="47521">.</span><span class="ident" id="47522">Bytes</span><span class="op" id="47527">(</span><span class="op" id="47528">)</span><span class="op" id="47529">)</span><span class="op" id="47530">,</span>&nbsp;<span class="builtinfunc" id="47532">len</span><span class="op" id="47535">(</span><span class="ident" id="47536">line</span><span class="op" id="47540">)</span><span class="op" id="47541">,</span>&nbsp;<span class="ident" id="47543">s</span><span class="op" id="47544">.</span><span class="ident" id="47545">Text</span><span class="op" id="47549">(</span><span class="op" id="47550">)</span><span class="op" id="47551">,</span>&nbsp;<span class="ident" id="47553">line</span><span class="op" id="47557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47567">err</span>&nbsp;<span class="op" id="47571">:=</span>&nbsp;<span class="ident" id="47574">s</span><span class="op" id="47575">.</span><span class="ident" id="47576">Err</span><span class="op" id="47579">(</span><span class="op" id="47580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47583">if</span>&nbsp;<span class="ident" id="47586">err</span>&nbsp;<span class="op" id="47590">!=</span>&nbsp;<span class="ident" id="47593">nil</span>&nbsp;<span class="op" id="47597">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47601">t</span><span class="op" id="47602">.</span><span class="ident" id="47603">Fatal</span><span class="op" id="47608">(</span><span class="ident" id="47609">err</span><span class="op" id="47612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="47615">}</span><br>
<span class="lineno"></span><span class="op" id="47617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="47620">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;errors&nbsp;out&nbsp;on&nbsp;a&nbsp;long&nbsp;line.</span><br>
<span class="lineno">215</span><span class="keyword" id="47678">func</span>&nbsp;<span class="ident" id="47683">TestScanLineTooLong</span><span class="op" id="47702">(</span><span class="ident" id="47703">t</span>&nbsp;<span class="op" id="47705">*</span><span class="ident" id="47706">testing</span><span class="op" id="47713">.</span><span class="ident" id="47714">T</span><span class="op" id="47715">)</span>&nbsp;<span class="op" id="47717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47720">const</span>&nbsp;<span class="ident" id="47726">smallMaxTokenSize</span>&nbsp;<span class="op" id="47744">=</span>&nbsp;<span class="num" id="47746">256</span>&nbsp;<span class="comment" id="47750">//&nbsp;Much&nbsp;smaller&nbsp;for&nbsp;more&nbsp;efficient&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="47795">//&nbsp;Build&nbsp;a&nbsp;buffer&nbsp;of&nbsp;lots&nbsp;of&nbsp;line&nbsp;lengths&nbsp;up&nbsp;to&nbsp;but&nbsp;not&nbsp;exceeding&nbsp;smallMaxTokenSize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47881">tmp</span>&nbsp;<span class="op" id="47885">:=</span>&nbsp;<span class="builtinfunc" id="47888">new</span><span class="op" id="47891">(</span><span class="ident" id="47892">bytes</span><span class="op" id="47897">.</span><span class="ident" id="47898">Buffer</span><span class="op" id="47904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47907">buf</span>&nbsp;<span class="op" id="47911">:=</span>&nbsp;<span class="builtinfunc" id="47914">new</span><span class="op" id="47917">(</span><span class="ident" id="47918">bytes</span><span class="op" id="47923">.</span><span class="ident" id="47924">Buffer</span><span class="op" id="47930">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47933">lineNum</span>&nbsp;<span class="op" id="47941">:=</span>&nbsp;<span class="num" id="47944">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="47947">j</span>&nbsp;<span class="op" id="47949">:=</span>&nbsp;<span class="num" id="47952">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="47955">for</span>&nbsp;<span class="ident" id="47959">i</span>&nbsp;<span class="op" id="47961">:=</span>&nbsp;<span class="num" id="47964">0</span><span class="op" id="47965">;</span>&nbsp;<span class="ident" id="47967">i</span>&nbsp;<span class="op" id="47969">&lt;</span>&nbsp;<span class="num" id="47971">2</span><span class="op" id="47972">*</span><span class="ident" id="47973">smallMaxTokenSize</span><span class="op" id="47990">;</span>&nbsp;<span class="ident" id="47992">i</span><span class="op" id="47993">++</span>&nbsp;<span class="op" id="47996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48000">genLine</span><span class="op" id="48007">(</span><span class="ident" id="48008">tmp</span><span class="op" id="48011">,</span>&nbsp;<span class="ident" id="48013">lineNum</span><span class="op" id="48020">,</span>&nbsp;<span class="ident" id="48022">j</span><span class="op" id="48023">,</span>&nbsp;<span class="ident" id="48025">true</span><span class="op" id="48029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48033">j</span><span class="op" id="48034">++</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48039">buf</span><span class="op" id="48042">.</span><span class="ident" id="48043">Write</span><span class="op" id="48048">(</span><span class="ident" id="48049">tmp</span><span class="op" id="48052">.</span><span class="ident" id="48053">Bytes</span><span class="op" id="48058">(</span><span class="op" id="48059">)</span><span class="op" id="48060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48064">lineNum</span><span class="op" id="48071">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48078">s</span>&nbsp;<span class="op" id="48080">:=</span>&nbsp;<span class="ident" id="48083">NewScanner</span><span class="op" id="48093">(</span><span class="op" id="48094">&amp;</span><span class="ident" id="48095">slowReader</span><span class="op" id="48105">{</span><span class="num" id="48106">3</span><span class="op" id="48107">,</span>&nbsp;<span class="ident" id="48109">buf</span><span class="op" id="48112">}</span><span class="op" id="48113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48116">s</span><span class="op" id="48117">.</span><span class="ident" id="48118">Split</span><span class="op" id="48123">(</span><span class="ident" id="48124">ScanLines</span><span class="op" id="48133">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48136">s</span><span class="op" id="48137">.</span><span class="ident" id="48138">MaxTokenSize</span><span class="op" id="48150">(</span><span class="ident" id="48151">smallMaxTokenSize</span><span class="op" id="48168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48171">j</span>&nbsp;<span class="op" id="48173">=</span>&nbsp;<span class="num" id="48175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48178">for</span>&nbsp;<span class="ident" id="48182">lineNum</span>&nbsp;<span class="op" id="48190">:=</span>&nbsp;<span class="num" id="48193">0</span><span class="op" id="48194">;</span>&nbsp;<span class="ident" id="48196">s</span><span class="op" id="48197">.</span><span class="ident" id="48198">Scan</span><span class="op" id="48202">(</span><span class="op" id="48203">)</span><span class="op" id="48204">;</span>&nbsp;<span class="ident" id="48206">lineNum</span><span class="op" id="48213">++</span>&nbsp;<span class="op" id="48216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48220">genLine</span><span class="op" id="48227">(</span><span class="ident" id="48228">tmp</span><span class="op" id="48231">,</span>&nbsp;<span class="ident" id="48233">lineNum</span><span class="op" id="48240">,</span>&nbsp;<span class="ident" id="48242">j</span><span class="op" id="48243">,</span>&nbsp;<span class="ident" id="48245">false</span><span class="op" id="48250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48254">if</span>&nbsp;<span class="ident" id="48257">j</span>&nbsp;<span class="op" id="48259">&lt;</span>&nbsp;<span class="ident" id="48261">smallMaxTokenSize</span>&nbsp;<span class="op" id="48279">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48284">j</span><span class="op" id="48285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48290">}</span>&nbsp;<span class="keyword" id="48292">else</span>&nbsp;<span class="op" id="48297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48302">j</span><span class="op" id="48303">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48312">line</span>&nbsp;<span class="op" id="48317">:=</span>&nbsp;<span class="ident" id="48320">tmp</span><span class="op" id="48323">.</span><span class="ident" id="48324">Bytes</span><span class="op" id="48329">(</span><span class="op" id="48330">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48334">if</span>&nbsp;<span class="op" id="48337">!</span><span class="ident" id="48338">bytes</span><span class="op" id="48343">.</span><span class="ident" id="48344">Equal</span><span class="op" id="48349">(</span><span class="ident" id="48350">s</span><span class="op" id="48351">.</span><span class="ident" id="48352">Bytes</span><span class="op" id="48357">(</span><span class="op" id="48358">)</span><span class="op" id="48359">,</span>&nbsp;<span class="ident" id="48361">line</span><span class="op" id="48365">)</span>&nbsp;<span class="op" id="48367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48372">t</span><span class="op" id="48373">.</span><span class="ident" id="48374">Errorf</span><span class="op" id="48380">(</span><span class="string" id="48381">&#34;%d:&nbsp;bad&nbsp;line:&nbsp;%d&nbsp;%d\n%.100q\n%.100q\n&#34;</span><span class="op" id="48420">,</span>&nbsp;<span class="ident" id="48422">lineNum</span><span class="op" id="48429">,</span>&nbsp;<span class="builtinfunc" id="48431">len</span><span class="op" id="48434">(</span><span class="ident" id="48435">s</span><span class="op" id="48436">.</span><span class="ident" id="48437">Bytes</span><span class="op" id="48442">(</span><span class="op" id="48443">)</span><span class="op" id="48444">)</span><span class="op" id="48445">,</span>&nbsp;<span class="builtinfunc" id="48447">len</span><span class="op" id="48450">(</span><span class="ident" id="48451">line</span><span class="op" id="48455">)</span><span class="op" id="48456">,</span>&nbsp;<span class="ident" id="48458">s</span><span class="op" id="48459">.</span><span class="ident" id="48460">Bytes</span><span class="op" id="48465">(</span><span class="op" id="48466">)</span><span class="op" id="48467">,</span>&nbsp;<span class="ident" id="48469">line</span><span class="op" id="48473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48483">err</span>&nbsp;<span class="op" id="48487">:=</span>&nbsp;<span class="ident" id="48490">s</span><span class="op" id="48491">.</span><span class="ident" id="48492">Err</span><span class="op" id="48495">(</span><span class="op" id="48496">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48499">if</span>&nbsp;<span class="ident" id="48502">err</span>&nbsp;<span class="op" id="48506">!=</span>&nbsp;<span class="ident" id="48509">ErrTooLong</span>&nbsp;<span class="op" id="48520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48524">t</span><span class="op" id="48525">.</span><span class="ident" id="48526">Fatalf</span><span class="op" id="48532">(</span><span class="string" id="48533">&#34;expected&nbsp;ErrTooLong;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="48562">,</span>&nbsp;<span class="ident" id="48564">err</span><span class="op" id="48567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48570">}</span><br>
<span class="lineno"></span><span class="op" id="48572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="48575">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;handles&nbsp;a&nbsp;final&nbsp;line&nbsp;without&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="keyword" id="48646">func</span>&nbsp;<span class="ident" id="48651">testNoNewline</span><span class="op" id="48664">(</span><span class="ident" id="48665">text</span>&nbsp;<span class="builtintype" id="48670">string</span><span class="op" id="48676">,</span>&nbsp;<span class="ident" id="48678">lines</span>&nbsp;<span class="op" id="48684">[</span><span class="op" id="48685">]</span><span class="builtintype" id="48686">string</span><span class="op" id="48692">,</span>&nbsp;<span class="ident" id="48694">t</span>&nbsp;<span class="op" id="48696">*</span><span class="ident" id="48697">testing</span><span class="op" id="48704">.</span><span class="ident" id="48705">T</span><span class="op" id="48706">)</span>&nbsp;<span class="op" id="48708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48711">buf</span>&nbsp;<span class="op" id="48715">:=</span>&nbsp;<span class="ident" id="48718">strings</span><span class="op" id="48725">.</span><span class="ident" id="48726">NewReader</span><span class="op" id="48735">(</span><span class="ident" id="48736">text</span><span class="op" id="48740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48743">s</span>&nbsp;<span class="op" id="48745">:=</span>&nbsp;<span class="ident" id="48748">NewScanner</span><span class="op" id="48758">(</span><span class="op" id="48759">&amp;</span><span class="ident" id="48760">slowReader</span><span class="op" id="48770">{</span><span class="num" id="48771">7</span><span class="op" id="48772">,</span>&nbsp;<span class="ident" id="48774">buf</span><span class="op" id="48777">}</span><span class="op" id="48778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48781">s</span><span class="op" id="48782">.</span><span class="ident" id="48783">Split</span><span class="op" id="48788">(</span><span class="ident" id="48789">ScanLines</span><span class="op" id="48798">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48801">for</span>&nbsp;<span class="ident" id="48805">lineNum</span>&nbsp;<span class="op" id="48813">:=</span>&nbsp;<span class="num" id="48816">0</span><span class="op" id="48817">;</span>&nbsp;<span class="ident" id="48819">s</span><span class="op" id="48820">.</span><span class="ident" id="48821">Scan</span><span class="op" id="48825">(</span><span class="op" id="48826">)</span><span class="op" id="48827">;</span>&nbsp;<span class="ident" id="48829">lineNum</span><span class="op" id="48836">++</span>&nbsp;<span class="op" id="48839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48843">line</span>&nbsp;<span class="op" id="48848">:=</span>&nbsp;<span class="ident" id="48851">lines</span><span class="op" id="48856">[</span><span class="ident" id="48857">lineNum</span><span class="op" id="48864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="48868">if</span>&nbsp;<span class="ident" id="48871">s</span><span class="op" id="48872">.</span><span class="ident" id="48873">Text</span><span class="op" id="48877">(</span><span class="op" id="48878">)</span>&nbsp;<span class="op" id="48880">!=</span>&nbsp;<span class="ident" id="48883">line</span>&nbsp;<span class="op" id="48888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="48893">t</span><span class="op" id="48894">.</span><span class="ident" id="48895">Errorf</span><span class="op" id="48901">(</span><span class="string" id="48902">&#34;%d:&nbsp;bad&nbsp;line:&nbsp;%d&nbsp;%d\n%.100q\n%.100q\n&#34;</span><span class="op" id="48941">,</span>&nbsp;<span class="ident" id="48943">lineNum</span><span class="op" id="48950">,</span>&nbsp;<span class="builtinfunc" id="48952">len</span><span class="op" id="48955">(</span><span class="ident" id="48956">s</span><span class="op" id="48957">.</span><span class="ident" id="48958">Bytes</span><span class="op" id="48963">(</span><span class="op" id="48964">)</span><span class="op" id="48965">)</span><span class="op" id="48966">,</span>&nbsp;<span class="builtinfunc" id="48968">len</span><span class="op" id="48971">(</span><span class="ident" id="48972">line</span><span class="op" id="48976">)</span><span class="op" id="48977">,</span>&nbsp;<span class="ident" id="48979">s</span><span class="op" id="48980">.</span><span class="ident" id="48981">Bytes</span><span class="op" id="48986">(</span><span class="op" id="48987">)</span><span class="op" id="48988">,</span>&nbsp;<span class="ident" id="48990">line</span><span class="op" id="48994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="48998">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="49001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49004">err</span>&nbsp;<span class="op" id="49008">:=</span>&nbsp;<span class="ident" id="49011">s</span><span class="op" id="49012">.</span><span class="ident" id="49013">Err</span><span class="op" id="49016">(</span><span class="op" id="49017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="49020">if</span>&nbsp;<span class="ident" id="49023">err</span>&nbsp;<span class="op" id="49027">!=</span>&nbsp;<span class="ident" id="49030">nil</span>&nbsp;<span class="op" id="49034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49038">t</span><span class="op" id="49039">.</span><span class="ident" id="49040">Fatal</span><span class="op" id="49045">(</span><span class="ident" id="49046">err</span><span class="op" id="49049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="49052">}</span><br>
<span class="lineno">265</span><span class="op" id="49054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="49057">var</span>&nbsp;<span class="ident" id="49061">noNewlineLines</span>&nbsp;<span class="op" id="49076">=</span>&nbsp;<span class="op" id="49078">[</span><span class="op" id="49079">]</span><span class="builtintype" id="49080">string</span><span class="op" id="49086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49089">&#34;abcdefghijklmn\nopqrstuvwxyz&#34;</span><span class="op" id="49119">,</span><br>
<span class="lineno"></span><span class="op" id="49121">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="49124">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;handles&nbsp;a&nbsp;final&nbsp;line&nbsp;without&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="keyword" id="49195">func</span>&nbsp;<span class="ident" id="49200">TestScanLineNoNewline</span><span class="op" id="49221">(</span><span class="ident" id="49222">t</span>&nbsp;<span class="op" id="49224">*</span><span class="ident" id="49225">testing</span><span class="op" id="49232">.</span><span class="ident" id="49233">T</span><span class="op" id="49234">)</span>&nbsp;<span class="op" id="49236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="49239">const</span>&nbsp;<span class="ident" id="49245">text</span>&nbsp;<span class="op" id="49250">=</span>&nbsp;<span class="string" id="49252">&#34;abcdefghijklmn\nopqrstuvwxyz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49284">lines</span>&nbsp;<span class="op" id="49290">:=</span>&nbsp;<span class="op" id="49293">[</span><span class="op" id="49294">]</span><span class="builtintype" id="49295">string</span><span class="op" id="49301">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49305">&#34;abcdefghijklmn&#34;</span><span class="op" id="49321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49325">&#34;opqrstuvwxyz&#34;</span><span class="op" id="49339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="49342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49345">testNoNewline</span><span class="op" id="49358">(</span><span class="ident" id="49359">text</span><span class="op" id="49363">,</span>&nbsp;<span class="ident" id="49365">lines</span><span class="op" id="49370">,</span>&nbsp;<span class="ident" id="49372">t</span><span class="op" id="49373">)</span><br>
<span class="lineno"></span><span class="op" id="49375">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="49378">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;handles&nbsp;a&nbsp;final&nbsp;line&nbsp;with&nbsp;a&nbsp;carriage&nbsp;return&nbsp;but&nbsp;no&nbsp;newline.</span><br>
<span class="lineno"></span><span class="keyword" id="49469">func</span>&nbsp;<span class="ident" id="49474">TestScanLineReturnButNoNewline</span><span class="op" id="49504">(</span><span class="ident" id="49505">t</span>&nbsp;<span class="op" id="49507">*</span><span class="ident" id="49508">testing</span><span class="op" id="49515">.</span><span class="ident" id="49516">T</span><span class="op" id="49517">)</span>&nbsp;<span class="op" id="49519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="49522">const</span>&nbsp;<span class="ident" id="49528">text</span>&nbsp;<span class="op" id="49533">=</span>&nbsp;<span class="string" id="49535">&#34;abcdefghijklmn\nopqrstuvwxyz\r&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49569">lines</span>&nbsp;<span class="op" id="49575">:=</span>&nbsp;<span class="op" id="49578">[</span><span class="op" id="49579">]</span><span class="builtintype" id="49580">string</span><span class="op" id="49586">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49590">&#34;abcdefghijklmn&#34;</span><span class="op" id="49606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49610">&#34;opqrstuvwxyz&#34;</span><span class="op" id="49624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="49627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49630">testNoNewline</span><span class="op" id="49643">(</span><span class="ident" id="49644">text</span><span class="op" id="49648">,</span>&nbsp;<span class="ident" id="49650">lines</span><span class="op" id="49655">,</span>&nbsp;<span class="ident" id="49657">t</span><span class="op" id="49658">)</span><br>
<span class="lineno"></span><span class="op" id="49660">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="49663">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;handles&nbsp;a&nbsp;final&nbsp;empty&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="49722">func</span>&nbsp;<span class="ident" id="49727">TestScanLineEmptyFinalLine</span><span class="op" id="49753">(</span><span class="ident" id="49754">t</span>&nbsp;<span class="op" id="49756">*</span><span class="ident" id="49757">testing</span><span class="op" id="49764">.</span><span class="ident" id="49765">T</span><span class="op" id="49766">)</span>&nbsp;<span class="op" id="49768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="49771">const</span>&nbsp;<span class="ident" id="49777">text</span>&nbsp;<span class="op" id="49782">=</span>&nbsp;<span class="string" id="49784">&#34;abcdefghijklmn\nopqrstuvwxyz\n\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49820">lines</span>&nbsp;<span class="op" id="49826">:=</span>&nbsp;<span class="op" id="49829">[</span><span class="op" id="49830">]</span><span class="builtintype" id="49831">string</span><span class="op" id="49837">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49841">&#34;abcdefghijklmn&#34;</span><span class="op" id="49857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49861">&#34;opqrstuvwxyz&#34;</span><span class="op" id="49875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="49879">&#34;&#34;</span><span class="op" id="49881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="49884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="49887">testNoNewline</span><span class="op" id="49900">(</span><span class="ident" id="49901">text</span><span class="op" id="49905">,</span>&nbsp;<span class="ident" id="49907">lines</span><span class="op" id="49912">,</span>&nbsp;<span class="ident" id="49914">t</span><span class="op" id="49915">)</span><br>
<span class="lineno">300</span><span class="op" id="49917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="49920">//&nbsp;Test&nbsp;that&nbsp;the&nbsp;line&nbsp;splitter&nbsp;handles&nbsp;a&nbsp;final&nbsp;empty&nbsp;line&nbsp;with&nbsp;a&nbsp;carriage&nbsp;return&nbsp;but&nbsp;no&nbsp;newline.</span><br>
<span class="lineno"></span><span class="keyword" id="50017">func</span>&nbsp;<span class="ident" id="50022">TestScanLineEmptyFinalLineWithCR</span><span class="op" id="50054">(</span><span class="ident" id="50055">t</span>&nbsp;<span class="op" id="50057">*</span><span class="ident" id="50058">testing</span><span class="op" id="50065">.</span><span class="ident" id="50066">T</span><span class="op" id="50067">)</span>&nbsp;<span class="op" id="50069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50072">const</span>&nbsp;<span class="ident" id="50078">text</span>&nbsp;<span class="op" id="50083">=</span>&nbsp;<span class="string" id="50085">&#34;abcdefghijklmn\nopqrstuvwxyz\n\r&#34;</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50121">lines</span>&nbsp;<span class="op" id="50127">:=</span>&nbsp;<span class="op" id="50130">[</span><span class="op" id="50131">]</span><span class="builtintype" id="50132">string</span><span class="op" id="50138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="50142">&#34;abcdefghijklmn&#34;</span><span class="op" id="50158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="50162">&#34;opqrstuvwxyz&#34;</span><span class="op" id="50176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="50180">&#34;&#34;</span><span class="op" id="50182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="50185">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50188">testNoNewline</span><span class="op" id="50201">(</span><span class="ident" id="50202">text</span><span class="op" id="50206">,</span>&nbsp;<span class="ident" id="50208">lines</span><span class="op" id="50213">,</span>&nbsp;<span class="ident" id="50215">t</span><span class="op" id="50216">)</span><br>
<span class="lineno"></span><span class="op" id="50218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="50221">var</span>&nbsp;<span class="ident" id="50225">testError</span>&nbsp;<span class="op" id="50235">=</span>&nbsp;<span class="ident" id="50237">errors</span><span class="op" id="50243">.</span><span class="ident" id="50244">New</span><span class="op" id="50247">(</span><span class="string" id="50248">&#34;testError&#34;</span><span class="op" id="50259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="50262">//&nbsp;Test&nbsp;the&nbsp;correct&nbsp;error&nbsp;is&nbsp;returned&nbsp;when&nbsp;the&nbsp;split&nbsp;function&nbsp;errors&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="50336">func</span>&nbsp;<span class="ident" id="50341">TestSplitError</span><span class="op" id="50355">(</span><span class="ident" id="50356">t</span>&nbsp;<span class="op" id="50358">*</span><span class="ident" id="50359">testing</span><span class="op" id="50366">.</span><span class="ident" id="50367">T</span><span class="op" id="50368">)</span>&nbsp;<span class="op" id="50370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="50373">//&nbsp;Create&nbsp;a&nbsp;split&nbsp;function&nbsp;that&nbsp;delivers&nbsp;a&nbsp;little&nbsp;data,&nbsp;then&nbsp;a&nbsp;predictable&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50456">numSplits</span>&nbsp;<span class="op" id="50466">:=</span>&nbsp;<span class="num" id="50469">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50472">const</span>&nbsp;<span class="ident" id="50478">okCount</span>&nbsp;<span class="op" id="50486">=</span>&nbsp;<span class="num" id="50488">7</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50491">errorSplit</span>&nbsp;<span class="op" id="50502">:=</span>&nbsp;<span class="keyword" id="50505">func</span><span class="op" id="50509">(</span><span class="ident" id="50510">data</span>&nbsp;<span class="op" id="50515">[</span><span class="op" id="50516">]</span><span class="builtintype" id="50517">byte</span><span class="op" id="50521">,</span>&nbsp;<span class="ident" id="50523">atEOF</span>&nbsp;<span class="builtintype" id="50529">bool</span><span class="op" id="50533">)</span>&nbsp;<span class="op" id="50535">(</span><span class="ident" id="50536">advance</span>&nbsp;<span class="builtintype" id="50544">int</span><span class="op" id="50547">,</span>&nbsp;<span class="ident" id="50549">token</span>&nbsp;<span class="op" id="50555">[</span><span class="op" id="50556">]</span><span class="builtintype" id="50557">byte</span><span class="op" id="50561">,</span>&nbsp;<span class="ident" id="50563">err</span>&nbsp;<span class="builtintype" id="50567">error</span><span class="op" id="50572">)</span>&nbsp;<span class="op" id="50574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50578">if</span>&nbsp;<span class="ident" id="50581">atEOF</span>&nbsp;<span class="op" id="50587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="50592">panic</span><span class="op" id="50597">(</span><span class="string" id="50598">&#34;didn&#39;t&nbsp;get&nbsp;enough&nbsp;data&#34;</span><span class="op" id="50622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="50626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50630">if</span>&nbsp;<span class="ident" id="50633">numSplits</span>&nbsp;<span class="op" id="50643">&gt;=</span>&nbsp;<span class="ident" id="50646">okCount</span>&nbsp;<span class="op" id="50654">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50659">return</span>&nbsp;<span class="num" id="50666">0</span><span class="op" id="50667">,</span>&nbsp;<span class="ident" id="50669">nil</span><span class="op" id="50672">,</span>&nbsp;<span class="ident" id="50674">testError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="50686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50690">numSplits</span><span class="op" id="50699">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50704">return</span>&nbsp;<span class="num" id="50711">1</span><span class="op" id="50712">,</span>&nbsp;<span class="ident" id="50714">data</span><span class="op" id="50718">[</span><span class="num" id="50719">0</span><span class="op" id="50720">:</span><span class="num" id="50721">1</span><span class="op" id="50722">]</span><span class="op" id="50723">,</span>&nbsp;<span class="ident" id="50725">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="50730">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="50733">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50752">const</span>&nbsp;<span class="ident" id="50758">text</span>&nbsp;<span class="op" id="50763">=</span>&nbsp;<span class="string" id="50765">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50795">buf</span>&nbsp;<span class="op" id="50799">:=</span>&nbsp;<span class="ident" id="50802">strings</span><span class="op" id="50809">.</span><span class="ident" id="50810">NewReader</span><span class="op" id="50819">(</span><span class="ident" id="50820">text</span><span class="op" id="50824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50827">s</span>&nbsp;<span class="op" id="50829">:=</span>&nbsp;<span class="ident" id="50832">NewScanner</span><span class="op" id="50842">(</span><span class="op" id="50843">&amp;</span><span class="ident" id="50844">slowReader</span><span class="op" id="50854">{</span><span class="num" id="50855">1</span><span class="op" id="50856">,</span>&nbsp;<span class="ident" id="50858">buf</span><span class="op" id="50861">}</span><span class="op" id="50862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50865">s</span><span class="op" id="50866">.</span><span class="ident" id="50867">Split</span><span class="op" id="50872">(</span><span class="ident" id="50873">errorSplit</span><span class="op" id="50883">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50886">var</span>&nbsp;<span class="ident" id="50890">i</span>&nbsp;<span class="builtintype" id="50892">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50897">for</span>&nbsp;<span class="ident" id="50901">i</span>&nbsp;<span class="op" id="50903">=</span>&nbsp;<span class="num" id="50905">0</span><span class="op" id="50906">;</span>&nbsp;<span class="ident" id="50908">s</span><span class="op" id="50909">.</span><span class="ident" id="50910">Scan</span><span class="op" id="50914">(</span><span class="op" id="50915">)</span><span class="op" id="50916">;</span>&nbsp;<span class="ident" id="50918">i</span><span class="op" id="50919">++</span>&nbsp;<span class="op" id="50922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="50926">if</span>&nbsp;<span class="builtinfunc" id="50929">len</span><span class="op" id="50932">(</span><span class="ident" id="50933">s</span><span class="op" id="50934">.</span><span class="ident" id="50935">Bytes</span><span class="op" id="50940">(</span><span class="op" id="50941">)</span><span class="op" id="50942">)</span>&nbsp;<span class="op" id="50944">!=</span>&nbsp;<span class="num" id="50947">1</span>&nbsp;<span class="op" id="50949">||</span>&nbsp;<span class="ident" id="50952">text</span><span class="op" id="50956">[</span><span class="ident" id="50957">i</span><span class="op" id="50958">]</span>&nbsp;<span class="op" id="50960">!=</span>&nbsp;<span class="ident" id="50963">s</span><span class="op" id="50964">.</span><span class="ident" id="50965">Bytes</span><span class="op" id="50970">(</span><span class="op" id="50971">)</span><span class="op" id="50972">[</span><span class="num" id="50973">0</span><span class="op" id="50974">]</span>&nbsp;<span class="op" id="50976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="50981">t</span><span class="op" id="50982">.</span><span class="ident" id="50983">Errorf</span><span class="op" id="50989">(</span><span class="string" id="50990">&#34;#%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="51015">,</span>&nbsp;<span class="ident" id="51017">i</span><span class="op" id="51018">,</span>&nbsp;<span class="ident" id="51020">text</span><span class="op" id="51024">[</span><span class="ident" id="51025">i</span><span class="op" id="51026">]</span><span class="op" id="51027">,</span>&nbsp;<span class="ident" id="51029">s</span><span class="op" id="51030">.</span><span class="ident" id="51031">Bytes</span><span class="op" id="51036">(</span><span class="op" id="51037">)</span><span class="op" id="51038">[</span><span class="num" id="51039">0</span><span class="op" id="51040">]</span><span class="op" id="51041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51045">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="51051">//&nbsp;Check&nbsp;correct&nbsp;termination&nbsp;location&nbsp;and&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51101">if</span>&nbsp;<span class="ident" id="51104">i</span>&nbsp;<span class="op" id="51106">!=</span>&nbsp;<span class="ident" id="51109">okCount</span>&nbsp;<span class="op" id="51117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51121">t</span><span class="op" id="51122">.</span><span class="ident" id="51123">Errorf</span><span class="op" id="51129">(</span><span class="string" id="51130">&#34;unexpected&nbsp;termination;&nbsp;expected&nbsp;%d&nbsp;tokens&nbsp;got&nbsp;%d&#34;</span><span class="op" id="51181">,</span>&nbsp;<span class="ident" id="51183">okCount</span><span class="op" id="51190">,</span>&nbsp;<span class="ident" id="51192">i</span><span class="op" id="51193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51196">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51199">err</span>&nbsp;<span class="op" id="51203">:=</span>&nbsp;<span class="ident" id="51206">s</span><span class="op" id="51207">.</span><span class="ident" id="51208">Err</span><span class="op" id="51211">(</span><span class="op" id="51212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51215">if</span>&nbsp;<span class="ident" id="51218">err</span>&nbsp;<span class="op" id="51222">!=</span>&nbsp;<span class="ident" id="51225">testError</span>&nbsp;<span class="op" id="51235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51239">t</span><span class="op" id="51240">.</span><span class="ident" id="51241">Fatalf</span><span class="op" id="51247">(</span><span class="string" id="51248">&#34;expected&nbsp;%q&nbsp;got&nbsp;%v&#34;</span><span class="op" id="51268">,</span>&nbsp;<span class="ident" id="51270">testError</span><span class="op" id="51279">,</span>&nbsp;<span class="ident" id="51281">err</span><span class="op" id="51284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51287">}</span><br>
<span class="lineno"></span><span class="op" id="51289">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="comment" id="51292">//&nbsp;Test&nbsp;that&nbsp;an&nbsp;EOF&nbsp;is&nbsp;overridden&nbsp;by&nbsp;a&nbsp;user-generated&nbsp;scan&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="51358">func</span>&nbsp;<span class="ident" id="51363">TestErrAtEOF</span><span class="op" id="51375">(</span><span class="ident" id="51376">t</span>&nbsp;<span class="op" id="51378">*</span><span class="ident" id="51379">testing</span><span class="op" id="51386">.</span><span class="ident" id="51387">T</span><span class="op" id="51388">)</span>&nbsp;<span class="op" id="51390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51393">s</span>&nbsp;<span class="op" id="51395">:=</span>&nbsp;<span class="ident" id="51398">NewScanner</span><span class="op" id="51408">(</span><span class="ident" id="51409">strings</span><span class="op" id="51416">.</span><span class="ident" id="51417">NewReader</span><span class="op" id="51426">(</span><span class="string" id="51427">&#34;1&nbsp;2&nbsp;33&#34;</span><span class="op" id="51435">)</span><span class="op" id="51436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="51439">//&nbsp;This&nbsp;spitter&nbsp;will&nbsp;fail&nbsp;on&nbsp;last&nbsp;entry,&nbsp;after&nbsp;s.err==EOF.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51499">split</span>&nbsp;<span class="op" id="51505">:=</span>&nbsp;<span class="keyword" id="51508">func</span><span class="op" id="51512">(</span><span class="ident" id="51513">data</span>&nbsp;<span class="op" id="51518">[</span><span class="op" id="51519">]</span><span class="builtintype" id="51520">byte</span><span class="op" id="51524">,</span>&nbsp;<span class="ident" id="51526">atEOF</span>&nbsp;<span class="builtintype" id="51532">bool</span><span class="op" id="51536">)</span>&nbsp;<span class="op" id="51538">(</span><span class="ident" id="51539">advance</span>&nbsp;<span class="builtintype" id="51547">int</span><span class="op" id="51550">,</span>&nbsp;<span class="ident" id="51552">token</span>&nbsp;<span class="op" id="51558">[</span><span class="op" id="51559">]</span><span class="builtintype" id="51560">byte</span><span class="op" id="51564">,</span>&nbsp;<span class="ident" id="51566">err</span>&nbsp;<span class="builtintype" id="51570">error</span><span class="op" id="51575">)</span>&nbsp;<span class="op" id="51577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51581">advance</span><span class="op" id="51588">,</span>&nbsp;<span class="ident" id="51590">token</span><span class="op" id="51595">,</span>&nbsp;<span class="ident" id="51597">err</span>&nbsp;<span class="op" id="51601">=</span>&nbsp;<span class="ident" id="51603">ScanWords</span><span class="op" id="51612">(</span><span class="ident" id="51613">data</span><span class="op" id="51617">,</span>&nbsp;<span class="ident" id="51619">atEOF</span><span class="op" id="51624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51628">if</span>&nbsp;<span class="builtinfunc" id="51631">len</span><span class="op" id="51634">(</span><span class="ident" id="51635">token</span><span class="op" id="51640">)</span>&nbsp;<span class="op" id="51642">&gt;</span>&nbsp;<span class="num" id="51644">1</span>&nbsp;<span class="op" id="51646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51651">if</span>&nbsp;<span class="ident" id="51654">s</span><span class="op" id="51655">.</span><span class="ident" id="51656">ErrOrEOF</span><span class="op" id="51664">(</span><span class="op" id="51665">)</span>&nbsp;<span class="op" id="51667">!=</span>&nbsp;<span class="ident" id="51670">io</span><span class="op" id="51672">.</span><span class="ident" id="51673">EOF</span>&nbsp;<span class="op" id="51677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51683">t</span><span class="op" id="51684">.</span><span class="ident" id="51685">Fatal</span><span class="op" id="51690">(</span><span class="string" id="51691">&#34;not&nbsp;testing&nbsp;EOF&#34;</span><span class="op" id="51708">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51718">err</span>&nbsp;<span class="op" id="51722">=</span>&nbsp;<span class="ident" id="51724">testError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51740">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51748">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51751">s</span><span class="op" id="51752">.</span><span class="ident" id="51753">Split</span><span class="op" id="51758">(</span><span class="ident" id="51759">split</span><span class="op" id="51764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51767">for</span>&nbsp;<span class="ident" id="51771">s</span><span class="op" id="51772">.</span><span class="ident" id="51773">Scan</span><span class="op" id="51777">(</span><span class="op" id="51778">)</span>&nbsp;<span class="op" id="51780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51786">if</span>&nbsp;<span class="ident" id="51789">s</span><span class="op" id="51790">.</span><span class="ident" id="51791">Err</span><span class="op" id="51794">(</span><span class="op" id="51795">)</span>&nbsp;<span class="op" id="51797">!=</span>&nbsp;<span class="ident" id="51800">testError</span>&nbsp;<span class="op" id="51810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="51814">t</span><span class="op" id="51815">.</span><span class="ident" id="51816">Fatal</span><span class="op" id="51821">(</span><span class="string" id="51822">&#34;wrong&nbsp;error:&#34;</span><span class="op" id="51836">,</span>&nbsp;<span class="ident" id="51838">s</span><span class="op" id="51839">.</span><span class="ident" id="51840">Err</span><span class="op" id="51843">(</span><span class="op" id="51844">)</span><span class="op" id="51845">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="51848">}</span><br>
<span class="lineno"></span><span class="op" id="51850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="51853">//&nbsp;Test&nbsp;for&nbsp;issue&nbsp;5268.</span><br>
<span class="lineno"></span><span class="keyword" id="51877">type</span>&nbsp;<span class="ident" id="51882">alwaysError</span>&nbsp;<span class="keyword" id="51894">struct</span><span class="op" id="51900">{</span><span class="op" id="51901">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="51904">func</span>&nbsp;<span class="op" id="51909">(</span><span class="ident" id="51910">alwaysError</span><span class="op" id="51921">)</span>&nbsp;<span class="ident" id="51923">Read</span><span class="op" id="51927">(</span><span class="ident" id="51928">p</span>&nbsp;<span class="op" id="51930">[</span><span class="op" id="51931">]</span><span class="builtintype" id="51932">byte</span><span class="op" id="51936">)</span>&nbsp;<span class="op" id="51938">(</span><span class="builtintype" id="51939">int</span><span class="op" id="51942">,</span>&nbsp;<span class="builtintype" id="51944">error</span><span class="op" id="51949">)</span>&nbsp;<span class="op" id="51951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="51954">return</span>&nbsp;<span class="num" id="51961">0</span><span class="op" id="51962">,</span>&nbsp;<span class="ident" id="51964">io</span><span class="op" id="51966">.</span><span class="ident" id="51967">ErrUnexpectedEOF</span><br>
<span class="lineno"></span><span class="op" id="51984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="51987">func</span>&nbsp;<span class="ident" id="51992">TestNonEOFWithEmptyRead</span><span class="op" id="52015">(</span><span class="ident" id="52016">t</span>&nbsp;<span class="op" id="52018">*</span><span class="ident" id="52019">testing</span><span class="op" id="52026">.</span><span class="ident" id="52027">T</span><span class="op" id="52028">)</span>&nbsp;<span class="op" id="52030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52033">scanner</span>&nbsp;<span class="op" id="52041">:=</span>&nbsp;<span class="ident" id="52044">NewScanner</span><span class="op" id="52054">(</span><span class="ident" id="52055">alwaysError</span><span class="op" id="52066">{</span><span class="op" id="52067">}</span><span class="op" id="52068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52071">for</span>&nbsp;<span class="ident" id="52075">scanner</span><span class="op" id="52082">.</span><span class="ident" id="52083">Scan</span><span class="op" id="52087">(</span><span class="op" id="52088">)</span>&nbsp;<span class="op" id="52090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52094">t</span><span class="op" id="52095">.</span><span class="ident" id="52096">Fatal</span><span class="op" id="52101">(</span><span class="string" id="52102">&#34;read&nbsp;should&nbsp;fail&#34;</span><span class="op" id="52120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="52123">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52126">err</span>&nbsp;<span class="op" id="52130">:=</span>&nbsp;<span class="ident" id="52133">scanner</span><span class="op" id="52140">.</span><span class="ident" id="52141">Err</span><span class="op" id="52144">(</span><span class="op" id="52145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52148">if</span>&nbsp;<span class="ident" id="52151">err</span>&nbsp;<span class="op" id="52155">!=</span>&nbsp;<span class="ident" id="52158">io</span><span class="op" id="52160">.</span><span class="ident" id="52161">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="52178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52182">t</span><span class="op" id="52183">.</span><span class="ident" id="52184">Errorf</span><span class="op" id="52190">(</span><span class="string" id="52191">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="52213">,</span>&nbsp;<span class="ident" id="52215">err</span><span class="op" id="52218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="52221">}</span><br>
<span class="lineno"></span><span class="op" id="52223">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="52226">//&nbsp;Test&nbsp;that&nbsp;Scan&nbsp;finishes&nbsp;if&nbsp;we&nbsp;have&nbsp;endless&nbsp;empty&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="52285">type</span>&nbsp;<span class="ident" id="52290">endlessZeros</span>&nbsp;<span class="keyword" id="52303">struct</span><span class="op" id="52309">{</span><span class="op" id="52310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="52313">func</span>&nbsp;<span class="op" id="52318">(</span><span class="ident" id="52319">endlessZeros</span><span class="op" id="52331">)</span>&nbsp;<span class="ident" id="52333">Read</span><span class="op" id="52337">(</span><span class="ident" id="52338">p</span>&nbsp;<span class="op" id="52340">[</span><span class="op" id="52341">]</span><span class="builtintype" id="52342">byte</span><span class="op" id="52346">)</span>&nbsp;<span class="op" id="52348">(</span><span class="builtintype" id="52349">int</span><span class="op" id="52352">,</span>&nbsp;<span class="builtintype" id="52354">error</span><span class="op" id="52359">)</span>&nbsp;<span class="op" id="52361">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52364">return</span>&nbsp;<span class="num" id="52371">0</span><span class="op" id="52372">,</span>&nbsp;<span class="ident" id="52374">nil</span><br>
<span class="lineno"></span><span class="op" id="52378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="52381">func</span>&nbsp;<span class="ident" id="52386">TestBadReader</span><span class="op" id="52399">(</span><span class="ident" id="52400">t</span>&nbsp;<span class="op" id="52402">*</span><span class="ident" id="52403">testing</span><span class="op" id="52410">.</span><span class="ident" id="52411">T</span><span class="op" id="52412">)</span>&nbsp;<span class="op" id="52414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52417">scanner</span>&nbsp;<span class="op" id="52425">:=</span>&nbsp;<span class="ident" id="52428">NewScanner</span><span class="op" id="52438">(</span><span class="ident" id="52439">endlessZeros</span><span class="op" id="52451">{</span><span class="op" id="52452">}</span><span class="op" id="52453">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52456">for</span>&nbsp;<span class="ident" id="52460">scanner</span><span class="op" id="52467">.</span><span class="ident" id="52468">Scan</span><span class="op" id="52472">(</span><span class="op" id="52473">)</span>&nbsp;<span class="op" id="52475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52479">t</span><span class="op" id="52480">.</span><span class="ident" id="52481">Fatal</span><span class="op" id="52486">(</span><span class="string" id="52487">&#34;read&nbsp;should&nbsp;fail&#34;</span><span class="op" id="52505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="52508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52511">err</span>&nbsp;<span class="op" id="52515">:=</span>&nbsp;<span class="ident" id="52518">scanner</span><span class="op" id="52525">.</span><span class="ident" id="52526">Err</span><span class="op" id="52529">(</span><span class="op" id="52530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52533">if</span>&nbsp;<span class="ident" id="52536">err</span>&nbsp;<span class="op" id="52540">!=</span>&nbsp;<span class="ident" id="52543">io</span><span class="op" id="52545">.</span><span class="ident" id="52546">ErrNoProgress</span>&nbsp;<span class="op" id="52560">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52564">t</span><span class="op" id="52565">.</span><span class="ident" id="52566">Errorf</span><span class="op" id="52572">(</span><span class="string" id="52573">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="52595">,</span>&nbsp;<span class="ident" id="52597">err</span><span class="op" id="52600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="52603">}</span><br>
<span class="lineno"></span><span class="op" id="52605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="52608">func</span>&nbsp;<span class="ident" id="52613">TestScanWordsExcessiveWhiteSpace</span><span class="op" id="52645">(</span><span class="ident" id="52646">t</span>&nbsp;<span class="op" id="52648">*</span><span class="ident" id="52649">testing</span><span class="op" id="52656">.</span><span class="ident" id="52657">T</span><span class="op" id="52658">)</span>&nbsp;<span class="op" id="52660">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52663">const</span>&nbsp;<span class="ident" id="52669">word</span>&nbsp;<span class="op" id="52674">=</span>&nbsp;<span class="string" id="52676">&#34;ipsum&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52685">s</span>&nbsp;<span class="op" id="52687">:=</span>&nbsp;<span class="ident" id="52690">strings</span><span class="op" id="52697">.</span><span class="ident" id="52698">Repeat</span><span class="op" id="52704">(</span><span class="string" id="52705">&#34;&nbsp;&#34;</span><span class="op" id="52708">,</span>&nbsp;<span class="num" id="52710">4</span><span class="op" id="52711">*</span><span class="ident" id="52712">smallMaxTokenSize</span><span class="op" id="52729">)</span>&nbsp;<span class="op" id="52731">+</span>&nbsp;<span class="ident" id="52733">word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52739">scanner</span>&nbsp;<span class="op" id="52747">:=</span>&nbsp;<span class="ident" id="52750">NewScanner</span><span class="op" id="52760">(</span><span class="ident" id="52761">strings</span><span class="op" id="52768">.</span><span class="ident" id="52769">NewReader</span><span class="op" id="52778">(</span><span class="ident" id="52779">s</span><span class="op" id="52780">)</span><span class="op" id="52781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52784">scanner</span><span class="op" id="52791">.</span><span class="ident" id="52792">MaxTokenSize</span><span class="op" id="52804">(</span><span class="ident" id="52805">smallMaxTokenSize</span><span class="op" id="52822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52825">scanner</span><span class="op" id="52832">.</span><span class="ident" id="52833">Split</span><span class="op" id="52838">(</span><span class="ident" id="52839">ScanWords</span><span class="op" id="52848">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52851">if</span>&nbsp;<span class="op" id="52854">!</span><span class="ident" id="52855">scanner</span><span class="op" id="52862">.</span><span class="ident" id="52863">Scan</span><span class="op" id="52867">(</span><span class="op" id="52868">)</span>&nbsp;<span class="op" id="52870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52874">t</span><span class="op" id="52875">.</span><span class="ident" id="52876">Fatalf</span><span class="op" id="52882">(</span><span class="string" id="52883">&#34;scan&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="52900">,</span>&nbsp;<span class="ident" id="52902">scanner</span><span class="op" id="52909">.</span><span class="ident" id="52910">Err</span><span class="op" id="52913">(</span><span class="op" id="52914">)</span><span class="op" id="52915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="52918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="52921">if</span>&nbsp;<span class="ident" id="52924">token</span>&nbsp;<span class="op" id="52930">:=</span>&nbsp;<span class="ident" id="52933">scanner</span><span class="op" id="52940">.</span><span class="ident" id="52941">Text</span><span class="op" id="52945">(</span><span class="op" id="52946">)</span><span class="op" id="52947">;</span>&nbsp;<span class="ident" id="52949">token</span>&nbsp;<span class="op" id="52955">!=</span>&nbsp;<span class="ident" id="52958">word</span>&nbsp;<span class="op" id="52963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="52967">t</span><span class="op" id="52968">.</span><span class="ident" id="52969">Fatalf</span><span class="op" id="52975">(</span><span class="string" id="52976">&#34;unexpected&nbsp;token:&nbsp;%v&#34;</span><span class="op" id="52998">,</span>&nbsp;<span class="ident" id="53000">token</span><span class="op" id="53005">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53008">}</span><br>
<span class="lineno"></span><span class="op" id="53010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="53013">//&nbsp;Test&nbsp;that&nbsp;empty&nbsp;tokens,&nbsp;including&nbsp;at&nbsp;end&nbsp;of&nbsp;line&nbsp;or&nbsp;end&nbsp;of&nbsp;file,&nbsp;are&nbsp;found&nbsp;by&nbsp;the&nbsp;scanner.</span><br>
<span class="lineno"></span><span class="comment" id="53107">//&nbsp;Issue&nbsp;8672:&nbsp;Could&nbsp;miss&nbsp;final&nbsp;empty&nbsp;token.</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="53153">func</span>&nbsp;<span class="ident" id="53158">commaSplit</span><span class="op" id="53168">(</span><span class="ident" id="53169">data</span>&nbsp;<span class="op" id="53174">[</span><span class="op" id="53175">]</span><span class="builtintype" id="53176">byte</span><span class="op" id="53180">,</span>&nbsp;<span class="ident" id="53182">atEOF</span>&nbsp;<span class="builtintype" id="53188">bool</span><span class="op" id="53192">)</span>&nbsp;<span class="op" id="53194">(</span><span class="ident" id="53195">advance</span>&nbsp;<span class="builtintype" id="53203">int</span><span class="op" id="53206">,</span>&nbsp;<span class="ident" id="53208">token</span>&nbsp;<span class="op" id="53214">[</span><span class="op" id="53215">]</span><span class="builtintype" id="53216">byte</span><span class="op" id="53220">,</span>&nbsp;<span class="ident" id="53222">err</span>&nbsp;<span class="builtintype" id="53226">error</span><span class="op" id="53231">)</span>&nbsp;<span class="op" id="53233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53236">for</span>&nbsp;<span class="ident" id="53240">i</span>&nbsp;<span class="op" id="53242">:=</span>&nbsp;<span class="num" id="53245">0</span><span class="op" id="53246">;</span>&nbsp;<span class="ident" id="53248">i</span>&nbsp;<span class="op" id="53250">&lt;</span>&nbsp;<span class="builtinfunc" id="53252">len</span><span class="op" id="53255">(</span><span class="ident" id="53256">data</span><span class="op" id="53260">)</span><span class="op" id="53261">;</span>&nbsp;<span class="ident" id="53263">i</span><span class="op" id="53264">++</span>&nbsp;<span class="op" id="53267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53271">if</span>&nbsp;<span class="ident" id="53274">data</span><span class="op" id="53278">[</span><span class="ident" id="53279">i</span><span class="op" id="53280">]</span>&nbsp;<span class="op" id="53282">==</span>&nbsp;<span class="string" id="53285">&#39;,&#39;</span>&nbsp;<span class="op" id="53289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53294">return</span>&nbsp;<span class="ident" id="53301">i</span>&nbsp;<span class="op" id="53303">+</span>&nbsp;<span class="num" id="53305">1</span><span class="op" id="53306">,</span>&nbsp;<span class="ident" id="53308">data</span><span class="op" id="53312">[</span><span class="op" id="53313">:</span><span class="ident" id="53314">i</span><span class="op" id="53315">]</span><span class="op" id="53316">,</span>&nbsp;<span class="ident" id="53318">nil</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53330">if</span>&nbsp;<span class="op" id="53333">!</span><span class="ident" id="53334">atEOF</span>&nbsp;<span class="op" id="53340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53344">return</span>&nbsp;<span class="num" id="53351">0</span><span class="op" id="53352">,</span>&nbsp;<span class="ident" id="53354">nil</span><span class="op" id="53357">,</span>&nbsp;<span class="ident" id="53359">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53364">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53367">return</span>&nbsp;<span class="num" id="53374">0</span><span class="op" id="53375">,</span>&nbsp;<span class="ident" id="53377">data</span><span class="op" id="53381">,</span>&nbsp;<span class="ident" id="53383">nil</span><br>
<span class="lineno"></span><span class="op" id="53387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="53390">func</span>&nbsp;<span class="ident" id="53395">TestEmptyTokens</span><span class="op" id="53410">(</span><span class="ident" id="53411">t</span>&nbsp;<span class="op" id="53413">*</span><span class="ident" id="53414">testing</span><span class="op" id="53421">.</span><span class="ident" id="53422">T</span><span class="op" id="53423">)</span>&nbsp;<span class="op" id="53425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53428">s</span>&nbsp;<span class="op" id="53430">:=</span>&nbsp;<span class="ident" id="53433">NewScanner</span><span class="op" id="53443">(</span><span class="ident" id="53444">strings</span><span class="op" id="53451">.</span><span class="ident" id="53452">NewReader</span><span class="op" id="53461">(</span><span class="string" id="53462">&#34;1,2,3,&#34;</span><span class="op" id="53470">)</span><span class="op" id="53471">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53474">values</span>&nbsp;<span class="op" id="53481">:=</span>&nbsp;<span class="op" id="53484">[</span><span class="op" id="53485">]</span><span class="builtintype" id="53486">string</span><span class="op" id="53492">{</span><span class="string" id="53493">&#34;1&#34;</span><span class="op" id="53496">,</span>&nbsp;<span class="string" id="53498">&#34;2&#34;</span><span class="op" id="53501">,</span>&nbsp;<span class="string" id="53503">&#34;3&#34;</span><span class="op" id="53506">,</span>&nbsp;<span class="string" id="53508">&#34;&#34;</span><span class="op" id="53510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53513">s</span><span class="op" id="53514">.</span><span class="ident" id="53515">Split</span><span class="op" id="53520">(</span><span class="ident" id="53521">commaSplit</span><span class="op" id="53531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53534">var</span>&nbsp;<span class="ident" id="53538">i</span>&nbsp;<span class="builtintype" id="53540">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53545">for</span>&nbsp;<span class="ident" id="53549">i</span>&nbsp;<span class="op" id="53551">=</span>&nbsp;<span class="num" id="53553">0</span><span class="op" id="53554">;</span>&nbsp;<span class="ident" id="53556">i</span>&nbsp;<span class="op" id="53558">&lt;</span>&nbsp;<span class="builtinfunc" id="53560">len</span><span class="op" id="53563">(</span><span class="ident" id="53564">values</span><span class="op" id="53570">)</span><span class="op" id="53571">;</span>&nbsp;<span class="ident" id="53573">i</span><span class="op" id="53574">++</span>&nbsp;<span class="op" id="53577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53581">if</span>&nbsp;<span class="op" id="53584">!</span><span class="ident" id="53585">s</span><span class="op" id="53586">.</span><span class="ident" id="53587">Scan</span><span class="op" id="53591">(</span><span class="op" id="53592">)</span>&nbsp;<span class="op" id="53594">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53599">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53611">if</span>&nbsp;<span class="ident" id="53614">s</span><span class="op" id="53615">.</span><span class="ident" id="53616">Text</span><span class="op" id="53620">(</span><span class="op" id="53621">)</span>&nbsp;<span class="op" id="53623">!=</span>&nbsp;<span class="ident" id="53626">values</span><span class="op" id="53632">[</span><span class="ident" id="53633">i</span><span class="op" id="53634">]</span>&nbsp;<span class="op" id="53636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53641">t</span><span class="op" id="53642">.</span><span class="ident" id="53643">Errorf</span><span class="op" id="53649">(</span><span class="string" id="53650">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="53674">,</span>&nbsp;<span class="ident" id="53676">i</span><span class="op" id="53677">,</span>&nbsp;<span class="ident" id="53679">values</span><span class="op" id="53685">[</span><span class="ident" id="53686">i</span><span class="op" id="53687">]</span><span class="op" id="53688">,</span>&nbsp;<span class="ident" id="53690">s</span><span class="op" id="53691">.</span><span class="ident" id="53692">Text</span><span class="op" id="53696">(</span><span class="op" id="53697">)</span><span class="op" id="53698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53702">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53708">if</span>&nbsp;<span class="ident" id="53711">i</span>&nbsp;<span class="op" id="53713">!=</span>&nbsp;<span class="builtinfunc" id="53716">len</span><span class="op" id="53719">(</span><span class="ident" id="53720">values</span><span class="op" id="53726">)</span>&nbsp;<span class="op" id="53728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53732">t</span><span class="op" id="53733">.</span><span class="ident" id="53734">Errorf</span><span class="op" id="53740">(</span><span class="string" id="53741">&#34;got&nbsp;%d&nbsp;fields,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="53769">,</span>&nbsp;<span class="ident" id="53771">i</span><span class="op" id="53772">,</span>&nbsp;<span class="builtinfunc" id="53774">len</span><span class="op" id="53777">(</span><span class="ident" id="53778">values</span><span class="op" id="53784">)</span><span class="op" id="53785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53791">if</span>&nbsp;<span class="ident" id="53794">err</span>&nbsp;<span class="op" id="53798">:=</span>&nbsp;<span class="ident" id="53801">s</span><span class="op" id="53802">.</span><span class="ident" id="53803">Err</span><span class="op" id="53806">(</span><span class="op" id="53807">)</span><span class="op" id="53808">;</span>&nbsp;<span class="ident" id="53810">err</span>&nbsp;<span class="op" id="53814">!=</span>&nbsp;<span class="ident" id="53817">nil</span>&nbsp;<span class="op" id="53821">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="53825">t</span><span class="op" id="53826">.</span><span class="ident" id="53827">Fatal</span><span class="op" id="53832">(</span><span class="ident" id="53833">err</span><span class="op" id="53836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53839">}</span><br>
<span class="lineno"></span><span class="op" id="53841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="53844">func</span>&nbsp;<span class="ident" id="53849">loopAtEOFSplit</span><span class="op" id="53863">(</span><span class="ident" id="53864">data</span>&nbsp;<span class="op" id="53869">[</span><span class="op" id="53870">]</span><span class="builtintype" id="53871">byte</span><span class="op" id="53875">,</span>&nbsp;<span class="ident" id="53877">atEOF</span>&nbsp;<span class="builtintype" id="53883">bool</span><span class="op" id="53887">)</span>&nbsp;<span class="op" id="53889">(</span><span class="ident" id="53890">advance</span>&nbsp;<span class="builtintype" id="53898">int</span><span class="op" id="53901">,</span>&nbsp;<span class="ident" id="53903">token</span>&nbsp;<span class="op" id="53909">[</span><span class="op" id="53910">]</span><span class="builtintype" id="53911">byte</span><span class="op" id="53915">,</span>&nbsp;<span class="ident" id="53917">err</span>&nbsp;<span class="builtintype" id="53921">error</span><span class="op" id="53926">)</span>&nbsp;<span class="op" id="53928">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53931">if</span>&nbsp;<span class="builtinfunc" id="53934">len</span><span class="op" id="53937">(</span><span class="ident" id="53938">data</span><span class="op" id="53942">)</span>&nbsp;<span class="op" id="53944">&gt;</span>&nbsp;<span class="num" id="53946">0</span>&nbsp;<span class="op" id="53948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53952">return</span>&nbsp;<span class="num" id="53959">1</span><span class="op" id="53960">,</span>&nbsp;<span class="ident" id="53962">data</span><span class="op" id="53966">[</span><span class="op" id="53967">:</span><span class="num" id="53968">1</span><span class="op" id="53969">]</span><span class="op" id="53970">,</span>&nbsp;<span class="ident" id="53972">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="53977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="53980">return</span>&nbsp;<span class="num" id="53987">0</span><span class="op" id="53988">,</span>&nbsp;<span class="ident" id="53990">data</span><span class="op" id="53994">,</span>&nbsp;<span class="ident" id="53996">nil</span><br>
<span class="lineno"></span><span class="op" id="54000">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span><span class="keyword" id="54003">func</span>&nbsp;<span class="ident" id="54008">TestDontLoopForever</span><span class="op" id="54027">(</span><span class="ident" id="54028">t</span>&nbsp;<span class="op" id="54030">*</span><span class="ident" id="54031">testing</span><span class="op" id="54038">.</span><span class="ident" id="54039">T</span><span class="op" id="54040">)</span>&nbsp;<span class="op" id="54042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54045">s</span>&nbsp;<span class="op" id="54047">:=</span>&nbsp;<span class="ident" id="54050">NewScanner</span><span class="op" id="54060">(</span><span class="ident" id="54061">strings</span><span class="op" id="54068">.</span><span class="ident" id="54069">NewReader</span><span class="op" id="54078">(</span><span class="string" id="54079">&#34;abc&#34;</span><span class="op" id="54084">)</span><span class="op" id="54085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54088">s</span><span class="op" id="54089">.</span><span class="ident" id="54090">Split</span><span class="op" id="54095">(</span><span class="ident" id="54096">loopAtEOFSplit</span><span class="op" id="54110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="54113">//&nbsp;Expect&nbsp;a&nbsp;panic</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54132">defer</span>&nbsp;<span class="keyword" id="54138">func</span><span class="op" id="54142">(</span><span class="op" id="54143">)</span>&nbsp;<span class="op" id="54145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54149">err</span>&nbsp;<span class="op" id="54153">:=</span>&nbsp;<span class="builtinfunc" id="54156">recover</span><span class="op" id="54163">(</span><span class="op" id="54164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54168">if</span>&nbsp;<span class="ident" id="54171">err</span>&nbsp;<span class="op" id="54175">==</span>&nbsp;<span class="ident" id="54178">nil</span>&nbsp;<span class="op" id="54182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54187">t</span><span class="op" id="54188">.</span><span class="ident" id="54189">Fatal</span><span class="op" id="54194">(</span><span class="string" id="54195">&#34;should&nbsp;have&nbsp;panicked&#34;</span><span class="op" id="54217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54221">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54225">if</span>&nbsp;<span class="ident" id="54228">msg</span><span class="op" id="54231">,</span>&nbsp;<span class="ident" id="54233">ok</span>&nbsp;<span class="op" id="54236">:=</span>&nbsp;<span class="ident" id="54239">err</span><span class="op" id="54242">.</span><span class="op" id="54243">(</span><span class="builtintype" id="54244">string</span><span class="op" id="54250">)</span><span class="op" id="54251">;</span>&nbsp;<span class="op" id="54253">!</span><span class="ident" id="54254">ok</span>&nbsp;<span class="op" id="54257">||</span>&nbsp;<span class="op" id="54260">!</span><span class="ident" id="54261">strings</span><span class="op" id="54268">.</span><span class="ident" id="54269">Contains</span><span class="op" id="54277">(</span><span class="ident" id="54278">msg</span><span class="op" id="54281">,</span>&nbsp;<span class="string" id="54283">&#34;empty&nbsp;tokens&#34;</span><span class="op" id="54297">)</span>&nbsp;<span class="op" id="54299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="54304">panic</span><span class="op" id="54309">(</span><span class="ident" id="54310">err</span><span class="op" id="54313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54320">}</span><span class="op" id="54321">(</span><span class="op" id="54322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54325">for</span>&nbsp;<span class="ident" id="54329">count</span>&nbsp;<span class="op" id="54335">:=</span>&nbsp;<span class="num" id="54338">0</span><span class="op" id="54339">;</span>&nbsp;<span class="ident" id="54341">s</span><span class="op" id="54342">.</span><span class="ident" id="54343">Scan</span><span class="op" id="54347">(</span><span class="op" id="54348">)</span><span class="op" id="54349">;</span>&nbsp;<span class="ident" id="54351">count</span><span class="op" id="54356">++</span>&nbsp;<span class="op" id="54359">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54363">if</span>&nbsp;<span class="ident" id="54366">count</span>&nbsp;<span class="op" id="54372">&gt;</span>&nbsp;<span class="num" id="54374">1000</span>&nbsp;<span class="op" id="54379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54384">t</span><span class="op" id="54385">.</span><span class="ident" id="54386">Fatal</span><span class="op" id="54391">(</span><span class="string" id="54392">&#34;looping&#34;</span><span class="op" id="54401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54411">if</span>&nbsp;<span class="ident" id="54414">s</span><span class="op" id="54415">.</span><span class="ident" id="54416">Err</span><span class="op" id="54419">(</span><span class="op" id="54420">)</span>&nbsp;<span class="op" id="54422">!=</span>&nbsp;<span class="ident" id="54425">nil</span>&nbsp;<span class="op" id="54429">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54433">t</span><span class="op" id="54434">.</span><span class="ident" id="54435">Fatal</span><span class="op" id="54440">(</span><span class="string" id="54441">&#34;after&nbsp;scan:&#34;</span><span class="op" id="54454">,</span>&nbsp;<span class="ident" id="54456">s</span><span class="op" id="54457">.</span><span class="ident" id="54458">Err</span><span class="op" id="54461">(</span><span class="op" id="54462">)</span><span class="op" id="54463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54466">}</span><br>
<span class="lineno"></span><span class="op" id="54468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="54471">func</span>&nbsp;<span class="ident" id="54476">TestBlankLines</span><span class="op" id="54490">(</span><span class="ident" id="54491">t</span>&nbsp;<span class="op" id="54493">*</span><span class="ident" id="54494">testing</span><span class="op" id="54501">.</span><span class="ident" id="54502">T</span><span class="op" id="54503">)</span>&nbsp;<span class="op" id="54505">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54508">s</span>&nbsp;<span class="op" id="54510">:=</span>&nbsp;<span class="ident" id="54513">NewScanner</span><span class="op" id="54523">(</span><span class="ident" id="54524">strings</span><span class="op" id="54531">.</span><span class="ident" id="54532">NewReader</span><span class="op" id="54541">(</span><span class="ident" id="54542">strings</span><span class="op" id="54549">.</span><span class="ident" id="54550">Repeat</span><span class="op" id="54556">(</span><span class="string" id="54557">&#34;\n&#34;</span><span class="op" id="54561">,</span>&nbsp;<span class="num" id="54563">1000</span><span class="op" id="54567">)</span><span class="op" id="54568">)</span><span class="op" id="54569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54572">for</span>&nbsp;<span class="ident" id="54576">count</span>&nbsp;<span class="op" id="54582">:=</span>&nbsp;<span class="num" id="54585">0</span><span class="op" id="54586">;</span>&nbsp;<span class="ident" id="54588">s</span><span class="op" id="54589">.</span><span class="ident" id="54590">Scan</span><span class="op" id="54594">(</span><span class="op" id="54595">)</span><span class="op" id="54596">;</span>&nbsp;<span class="ident" id="54598">count</span><span class="op" id="54603">++</span>&nbsp;<span class="op" id="54606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54610">if</span>&nbsp;<span class="ident" id="54613">count</span>&nbsp;<span class="op" id="54619">&gt;</span>&nbsp;<span class="num" id="54621">2000</span>&nbsp;<span class="op" id="54626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54631">t</span><span class="op" id="54632">.</span><span class="ident" id="54633">Fatal</span><span class="op" id="54638">(</span><span class="string" id="54639">&#34;looping&#34;</span><span class="op" id="54648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54652">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54658">if</span>&nbsp;<span class="ident" id="54661">s</span><span class="op" id="54662">.</span><span class="ident" id="54663">Err</span><span class="op" id="54666">(</span><span class="op" id="54667">)</span>&nbsp;<span class="op" id="54669">!=</span>&nbsp;<span class="ident" id="54672">nil</span>&nbsp;<span class="op" id="54676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="54680">t</span><span class="op" id="54681">.</span><span class="ident" id="54682">Fatal</span><span class="op" id="54687">(</span><span class="string" id="54688">&#34;after&nbsp;scan:&#34;</span><span class="op" id="54701">,</span>&nbsp;<span class="ident" id="54703">s</span><span class="op" id="54704">.</span><span class="ident" id="54705">Err</span><span class="op" id="54708">(</span><span class="op" id="54709">)</span><span class="op" id="54710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54713">}</span><br>
<span class="lineno"></span><span class="op" id="54715">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="54718">type</span>&nbsp;<span class="ident" id="54723">countdown</span>&nbsp;<span class="builtintype" id="54733">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="54738">func</span>&nbsp;<span class="op" id="54743">(</span><span class="ident" id="54744">c</span>&nbsp;<span class="op" id="54746">*</span><span class="ident" id="54747">countdown</span><span class="op" id="54756">)</span>&nbsp;<span class="ident" id="54758">split</span><span class="op" id="54763">(</span><span class="ident" id="54764">data</span>&nbsp;<span class="op" id="54769">[</span><span class="op" id="54770">]</span><span class="builtintype" id="54771">byte</span><span class="op" id="54775">,</span>&nbsp;<span class="ident" id="54777">atEOF</span>&nbsp;<span class="builtintype" id="54783">bool</span><span class="op" id="54787">)</span>&nbsp;<span class="op" id="54789">(</span><span class="ident" id="54790">advance</span>&nbsp;<span class="builtintype" id="54798">int</span><span class="op" id="54801">,</span>&nbsp;<span class="ident" id="54803">token</span>&nbsp;<span class="op" id="54809">[</span><span class="op" id="54810">]</span><span class="builtintype" id="54811">byte</span><span class="op" id="54815">,</span>&nbsp;<span class="ident" id="54817">err</span>&nbsp;<span class="builtintype" id="54821">error</span><span class="op" id="54826">)</span>&nbsp;<span class="op" id="54828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54831">if</span>&nbsp;<span class="op" id="54834">*</span><span class="ident" id="54835">c</span>&nbsp;<span class="op" id="54837">&gt;</span>&nbsp;<span class="num" id="54839">0</span>&nbsp;<span class="op" id="54841">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54845">*</span><span class="ident" id="54846">c</span><span class="op" id="54847">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54852">return</span>&nbsp;<span class="num" id="54859">1</span><span class="op" id="54860">,</span>&nbsp;<span class="ident" id="54862">data</span><span class="op" id="54866">[</span><span class="op" id="54867">:</span><span class="num" id="54868">1</span><span class="op" id="54869">]</span><span class="op" id="54870">,</span>&nbsp;<span class="ident" id="54872">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="54877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="54880">return</span>&nbsp;<span class="num" id="54887">0</span><span class="op" id="54888">,</span>&nbsp;<span class="ident" id="54890">nil</span><span class="op" id="54893">,</span>&nbsp;<span class="ident" id="54895">nil</span><br>
<span class="lineno"></span><span class="op" id="54899">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="54902">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;looping-at-EOF&nbsp;check&nbsp;doesn&#39;t&nbsp;trigger&nbsp;for&nbsp;merely&nbsp;empty&nbsp;tokens.</span><br>
<span class="lineno"></span><span class="keyword" id="54982">func</span>&nbsp;<span class="ident" id="54987">TestEmptyLinesOK</span><span class="op" id="55003">(</span><span class="ident" id="55004">t</span>&nbsp;<span class="op" id="55006">*</span><span class="ident" id="55007">testing</span><span class="op" id="55014">.</span><span class="ident" id="55015">T</span><span class="op" id="55016">)</span>&nbsp;<span class="op" id="55018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55021">c</span>&nbsp;<span class="op" id="55023">:=</span>&nbsp;<span class="ident" id="55026">countdown</span><span class="op" id="55035">(</span><span class="num" id="55036">10000</span><span class="op" id="55041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55044">s</span>&nbsp;<span class="op" id="55046">:=</span>&nbsp;<span class="ident" id="55049">NewScanner</span><span class="op" id="55059">(</span><span class="ident" id="55060">strings</span><span class="op" id="55067">.</span><span class="ident" id="55068">NewReader</span><span class="op" id="55077">(</span><span class="ident" id="55078">strings</span><span class="op" id="55085">.</span><span class="ident" id="55086">Repeat</span><span class="op" id="55092">(</span><span class="string" id="55093">&#34;\n&#34;</span><span class="op" id="55097">,</span>&nbsp;<span class="num" id="55099">10000</span><span class="op" id="55104">)</span><span class="op" id="55105">)</span><span class="op" id="55106">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55109">s</span><span class="op" id="55110">.</span><span class="ident" id="55111">Split</span><span class="op" id="55116">(</span><span class="ident" id="55117">c</span><span class="op" id="55118">.</span><span class="ident" id="55119">split</span><span class="op" id="55124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="55127">for</span>&nbsp;<span class="ident" id="55131">s</span><span class="op" id="55132">.</span><span class="ident" id="55133">Scan</span><span class="op" id="55137">(</span><span class="op" id="55138">)</span>&nbsp;<span class="op" id="55140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="55143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="55146">if</span>&nbsp;<span class="ident" id="55149">s</span><span class="op" id="55150">.</span><span class="ident" id="55151">Err</span><span class="op" id="55154">(</span><span class="op" id="55155">)</span>&nbsp;<span class="op" id="55157">!=</span>&nbsp;<span class="ident" id="55160">nil</span>&nbsp;<span class="op" id="55164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55168">t</span><span class="op" id="55169">.</span><span class="ident" id="55170">Fatal</span><span class="op" id="55175">(</span><span class="string" id="55176">&#34;after&nbsp;scan:&#34;</span><span class="op" id="55189">,</span>&nbsp;<span class="ident" id="55191">s</span><span class="op" id="55192">.</span><span class="ident" id="55193">Err</span><span class="op" id="55196">(</span><span class="op" id="55197">)</span><span class="op" id="55198">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="55201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="55204">if</span>&nbsp;<span class="ident" id="55207">c</span>&nbsp;<span class="op" id="55209">!=</span>&nbsp;<span class="num" id="55212">0</span>&nbsp;<span class="op" id="55214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="55218">t</span><span class="op" id="55219">.</span><span class="ident" id="55220">Fatalf</span><span class="op" id="55226">(</span><span class="string" id="55227">&#34;stopped&nbsp;with&nbsp;%d&nbsp;left&nbsp;to&nbsp;process&#34;</span><span class="op" id="55260">,</span>&nbsp;<span class="ident" id="55262">c</span><span class="op" id="55263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="55266">}</span><br>
<span class="lineno"></span><span class="op" id="55268">}</span>
</div>
</body>
</html>
