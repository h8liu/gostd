<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/mail</h2>
<ul>
<li><a href="/gostd/net/mail/message.go.html">message.go</a></li>
<li><a href="/gostd/net/mail/message_test.go.html">message_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6147944">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6147999">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6148053">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6148104">/*<br>
<span class="lineno"></span>Package&nbsp;mail&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;mail&nbsp;messages.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>For&nbsp;the&nbsp;most&nbsp;part,&nbsp;this&nbsp;package&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;5322.<br>
<span class="lineno"></span>Notable&nbsp;divergences:<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Obsolete&nbsp;address&nbsp;formats&nbsp;are&nbsp;not&nbsp;parsed,&nbsp;including&nbsp;addresses&nbsp;with<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;embedded&nbsp;route&nbsp;information.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Group&nbsp;addresses&nbsp;are&nbsp;not&nbsp;parsed.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;The&nbsp;full&nbsp;range&nbsp;of&nbsp;spacing&nbsp;(the&nbsp;CFWS&nbsp;syntax&nbsp;element)&nbsp;is&nbsp;not&nbsp;supported,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;such&nbsp;as&nbsp;breaking&nbsp;addresses&nbsp;across&nbsp;lines.<br>
<span class="lineno">15</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="6148511">package</span>&nbsp;<span class="ident" id="6148519">mail</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6148525">import</span>&nbsp;<span class="op" id="6148532">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148535">&#34;bufio&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148544">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148553">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148572">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148582">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148589">&#34;io&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148595">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148608">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148615">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148632">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148643">&#34;strings&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148654">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6148662">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6148672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6148675">var</span>&nbsp;<span class="ident" id="6148679">debug</span>&nbsp;<span class="op" id="6148685">=</span>&nbsp;<span class="ident" id="6148687">debugT</span><span class="op" id="6148693">(</span><span class="builtintype" id="6148694">false</span><span class="op" id="6148699">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6148702">type</span>&nbsp;<span class="ident" id="6148707">debugT</span>&nbsp;<span class="builtintype" id="6148714">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6148720">func</span>&nbsp;<span class="op" id="6148725">(</span><span class="ident" id="6148726">d</span>&nbsp;<span class="ident" id="6148728">debugT</span><span class="op" id="6148734">)</span>&nbsp;<span class="ident" id="6148736">Printf</span><span class="op" id="6148742">(</span><span class="ident" id="6148743">format</span>&nbsp;<span class="builtintype" id="6148750">string</span><span class="op" id="6148756">,</span>&nbsp;<span class="ident" id="6148758">args</span>&nbsp;<span class="op" id="6148763">...</span><span class="keyword" id="6148766">interface</span><span class="op" id="6148775">{</span><span class="op" id="6148776">}</span><span class="op" id="6148777">)</span>&nbsp;<span class="op" id="6148779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6148782">if</span>&nbsp;<span class="ident" id="6148785">d</span>&nbsp;<span class="op" id="6148787">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148791">log</span><span class="op" id="6148794">.</span><span class="ident" id="6148795">Printf</span><span class="op" id="6148801">(</span><span class="ident" id="6148802">format</span><span class="op" id="6148808">,</span>&nbsp;<span class="ident" id="6148810">args</span><span class="op" id="6148814">...</span><span class="op" id="6148817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6148820">}</span><br>
<span class="lineno"></span><span class="op" id="6148822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6148825">//&nbsp;A&nbsp;Message&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;mail&nbsp;message.</span><br>
<span class="lineno">45</span><span class="keyword" id="6148872">type</span>&nbsp;<span class="ident" id="6148877">Message</span>&nbsp;<span class="keyword" id="6148885">struct</span>&nbsp;<span class="op" id="6148892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148895">Header</span>&nbsp;<span class="ident" id="6148902">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6148910">Body</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6148917">io</span><span class="op" id="6148919">.</span><span class="ident" id="6148920">Reader</span><br>
<span class="lineno"></span><span class="op" id="6148927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="6148930">//&nbsp;ReadMessage&nbsp;reads&nbsp;a&nbsp;message&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="6148969">//&nbsp;The&nbsp;headers&nbsp;are&nbsp;parsed,&nbsp;and&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;message&nbsp;will&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="6149042">//&nbsp;for&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="6149065">func</span>&nbsp;<span class="ident" id="6149070">ReadMessage</span><span class="op" id="6149081">(</span><span class="ident" id="6149082">r</span>&nbsp;<span class="ident" id="6149084">io</span><span class="op" id="6149086">.</span><span class="ident" id="6149087">Reader</span><span class="op" id="6149093">)</span>&nbsp;<span class="op" id="6149095">(</span><span class="ident" id="6149096">msg</span>&nbsp;<span class="op" id="6149100">*</span><span class="ident" id="6149101">Message</span><span class="op" id="6149108">,</span>&nbsp;<span class="ident" id="6149110">err</span>&nbsp;<span class="builtintype" id="6149114">error</span><span class="op" id="6149119">)</span>&nbsp;<span class="op" id="6149121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149124">tp</span>&nbsp;<span class="op" id="6149127">:=</span>&nbsp;<span class="ident" id="6149130">textproto</span><span class="op" id="6149139">.</span><span class="ident" id="6149140">NewReader</span><span class="op" id="6149149">(</span><span class="ident" id="6149150">bufio</span><span class="op" id="6149155">.</span><span class="ident" id="6149156">NewReader</span><span class="op" id="6149165">(</span><span class="ident" id="6149166">r</span><span class="op" id="6149167">)</span><span class="op" id="6149168">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149172">hdr</span><span class="op" id="6149175">,</span>&nbsp;<span class="ident" id="6149177">err</span>&nbsp;<span class="op" id="6149181">:=</span>&nbsp;<span class="ident" id="6149184">tp</span><span class="op" id="6149186">.</span><span class="ident" id="6149187">ReadMIMEHeader</span><span class="op" id="6149201">(</span><span class="op" id="6149202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149205">if</span>&nbsp;<span class="ident" id="6149208">err</span>&nbsp;<span class="op" id="6149212">!=</span>&nbsp;<span class="ident" id="6149215">nil</span>&nbsp;<span class="op" id="6149219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149223">return</span>&nbsp;<span class="ident" id="6149230">nil</span><span class="op" id="6149233">,</span>&nbsp;<span class="ident" id="6149235">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149240">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149244">return</span>&nbsp;<span class="op" id="6149251">&amp;</span><span class="ident" id="6149252">Message</span><span class="op" id="6149259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149263">Header</span><span class="op" id="6149269">:</span>&nbsp;<span class="ident" id="6149271">Header</span><span class="op" id="6149277">(</span><span class="ident" id="6149278">hdr</span><span class="op" id="6149281">)</span><span class="op" id="6149282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149286">Body</span><span class="op" id="6149290">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6149294">tp</span><span class="op" id="6149296">.</span><span class="ident" id="6149297">R</span><span class="op" id="6149298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6149301">}</span><span class="op" id="6149302">,</span>&nbsp;<span class="ident" id="6149304">nil</span><br>
<span class="lineno">65</span><span class="op" id="6149308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6149311">//&nbsp;Layouts&nbsp;suitable&nbsp;for&nbsp;passing&nbsp;to&nbsp;time.Parse.</span><br>
<span class="lineno"></span><span class="comment" id="6149358">//&nbsp;These&nbsp;are&nbsp;tried&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6149387">var</span>&nbsp;<span class="ident" id="6149391">dateLayouts</span>&nbsp;<span class="op" id="6149403">[</span><span class="op" id="6149404">]</span><span class="builtintype" id="6149405">string</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="6149413">func</span>&nbsp;<span class="ident" id="6149418">init</span><span class="op" id="6149422">(</span><span class="op" id="6149423">)</span>&nbsp;<span class="op" id="6149425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149428">//&nbsp;Generate&nbsp;layouts&nbsp;based&nbsp;on&nbsp;RFC&nbsp;5322,&nbsp;section&nbsp;3.3.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149482">dows</span>&nbsp;<span class="op" id="6149487">:=</span>&nbsp;<span class="op" id="6149490">[</span><span class="op" id="6149491">...</span><span class="op" id="6149494">]</span><span class="builtintype" id="6149495">string</span><span class="op" id="6149501">{</span><span class="string" id="6149502">&#34;&#34;</span><span class="op" id="6149504">,</span>&nbsp;<span class="string" id="6149506">&#34;Mon,&nbsp;&#34;</span><span class="op" id="6149513">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6149517">//&nbsp;day-of-week</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149533">days</span>&nbsp;<span class="op" id="6149538">:=</span>&nbsp;<span class="op" id="6149541">[</span><span class="op" id="6149542">...</span><span class="op" id="6149545">]</span><span class="builtintype" id="6149546">string</span><span class="op" id="6149552">{</span><span class="string" id="6149553">&#34;2&#34;</span><span class="op" id="6149556">,</span>&nbsp;<span class="string" id="6149558">&#34;02&#34;</span><span class="op" id="6149562">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6149568">//&nbsp;day&nbsp;=&nbsp;1*2DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149587">years</span>&nbsp;<span class="op" id="6149593">:=</span>&nbsp;<span class="op" id="6149596">[</span><span class="op" id="6149597">...</span><span class="op" id="6149600">]</span><span class="builtintype" id="6149601">string</span><span class="op" id="6149607">{</span><span class="string" id="6149608">&#34;2006&#34;</span><span class="op" id="6149614">,</span>&nbsp;<span class="string" id="6149616">&#34;06&#34;</span><span class="op" id="6149620">}</span>&nbsp;<span class="comment" id="6149622">//&nbsp;year&nbsp;=&nbsp;4*DIGIT&nbsp;/&nbsp;2*DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149651">seconds</span>&nbsp;<span class="op" id="6149659">:=</span>&nbsp;<span class="op" id="6149662">[</span><span class="op" id="6149663">...</span><span class="op" id="6149666">]</span><span class="builtintype" id="6149667">string</span><span class="op" id="6149673">{</span><span class="string" id="6149674">&#34;:05&#34;</span><span class="op" id="6149679">,</span>&nbsp;<span class="string" id="6149681">&#34;&#34;</span><span class="op" id="6149683">}</span>&nbsp;&nbsp;<span class="comment" id="6149686">//&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6149697">//&nbsp;&#34;-0700&nbsp;(MST)&#34;&nbsp;is&nbsp;not&nbsp;in&nbsp;RFC&nbsp;5322,&nbsp;but&nbsp;is&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6149750">zones</span>&nbsp;<span class="op" id="6149756">:=</span>&nbsp;<span class="op" id="6149759">[</span><span class="op" id="6149760">...</span><span class="op" id="6149763">]</span><span class="builtintype" id="6149764">string</span><span class="op" id="6149770">{</span><span class="string" id="6149771">&#34;-0700&#34;</span><span class="op" id="6149778">,</span>&nbsp;<span class="string" id="6149780">&#34;MST&#34;</span><span class="op" id="6149785">,</span>&nbsp;<span class="string" id="6149787">&#34;-0700&nbsp;(MST)&#34;</span><span class="op" id="6149800">}</span>&nbsp;<span class="comment" id="6149802">//&nbsp;zone&nbsp;=&nbsp;((&#34;+&#34;&nbsp;/&nbsp;&#34;-&#34;)&nbsp;4DIGIT)&nbsp;/&nbsp;&#34;GMT&#34;&nbsp;/&nbsp;...</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149849">for</span>&nbsp;<span class="ident" id="6149853">_</span><span class="op" id="6149854">,</span>&nbsp;<span class="ident" id="6149856">dow</span>&nbsp;<span class="op" id="6149860">:=</span>&nbsp;<span class="keyword" id="6149863">range</span>&nbsp;<span class="ident" id="6149869">dows</span>&nbsp;<span class="op" id="6149874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149878">for</span>&nbsp;<span class="ident" id="6149882">_</span><span class="op" id="6149883">,</span>&nbsp;<span class="ident" id="6149885">day</span>&nbsp;<span class="op" id="6149889">:=</span>&nbsp;<span class="keyword" id="6149892">range</span>&nbsp;<span class="ident" id="6149898">days</span>&nbsp;<span class="op" id="6149903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149908">for</span>&nbsp;<span class="ident" id="6149912">_</span><span class="op" id="6149913">,</span>&nbsp;<span class="ident" id="6149915">year</span>&nbsp;<span class="op" id="6149920">:=</span>&nbsp;<span class="keyword" id="6149923">range</span>&nbsp;<span class="ident" id="6149929">years</span>&nbsp;<span class="op" id="6149935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149941">for</span>&nbsp;<span class="ident" id="6149945">_</span><span class="op" id="6149946">,</span>&nbsp;<span class="ident" id="6149948">second</span>&nbsp;<span class="op" id="6149955">:=</span>&nbsp;<span class="keyword" id="6149958">range</span>&nbsp;<span class="ident" id="6149964">seconds</span>&nbsp;<span class="op" id="6149972">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6149979">for</span>&nbsp;<span class="ident" id="6149983">_</span><span class="op" id="6149984">,</span>&nbsp;<span class="ident" id="6149986">zone</span>&nbsp;<span class="op" id="6149991">:=</span>&nbsp;<span class="keyword" id="6149994">range</span>&nbsp;<span class="ident" id="6150000">zones</span>&nbsp;<span class="op" id="6150006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150014">s</span>&nbsp;<span class="op" id="6150016">:=</span>&nbsp;<span class="ident" id="6150019">dow</span>&nbsp;<span class="op" id="6150023">+</span>&nbsp;<span class="ident" id="6150025">day</span>&nbsp;<span class="op" id="6150029">+</span>&nbsp;<span class="string" id="6150031">&#34;&nbsp;Jan&nbsp;&#34;</span>&nbsp;<span class="op" id="6150039">+</span>&nbsp;<span class="ident" id="6150041">year</span>&nbsp;<span class="op" id="6150046">+</span>&nbsp;<span class="string" id="6150048">&#34;&nbsp;15:04&#34;</span>&nbsp;<span class="op" id="6150057">+</span>&nbsp;<span class="ident" id="6150059">second</span>&nbsp;<span class="op" id="6150066">+</span>&nbsp;<span class="string" id="6150068">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="6150072">+</span>&nbsp;<span class="ident" id="6150074">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150085">dateLayouts</span>&nbsp;<span class="op" id="6150097">=</span>&nbsp;<span class="builtinfunc" id="6150099">append</span><span class="op" id="6150105">(</span><span class="ident" id="6150106">dateLayouts</span><span class="op" id="6150117">,</span>&nbsp;<span class="ident" id="6150119">s</span><span class="op" id="6150120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150133">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150145">}</span><br>
<span class="lineno"></span><span class="op" id="6150147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6150150">func</span>&nbsp;<span class="ident" id="6150155">parseDate</span><span class="op" id="6150164">(</span><span class="ident" id="6150165">date</span>&nbsp;<span class="builtintype" id="6150170">string</span><span class="op" id="6150176">)</span>&nbsp;<span class="op" id="6150178">(</span><span class="ident" id="6150179">time</span><span class="op" id="6150183">.</span><span class="ident" id="6150184">Time</span><span class="op" id="6150188">,</span>&nbsp;<span class="builtintype" id="6150190">error</span><span class="op" id="6150195">)</span>&nbsp;<span class="op" id="6150197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150200">for</span>&nbsp;<span class="ident" id="6150204">_</span><span class="op" id="6150205">,</span>&nbsp;<span class="ident" id="6150207">layout</span>&nbsp;<span class="op" id="6150214">:=</span>&nbsp;<span class="keyword" id="6150217">range</span>&nbsp;<span class="ident" id="6150223">dateLayouts</span>&nbsp;<span class="op" id="6150235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150239">t</span><span class="op" id="6150240">,</span>&nbsp;<span class="ident" id="6150242">err</span>&nbsp;<span class="op" id="6150246">:=</span>&nbsp;<span class="ident" id="6150249">time</span><span class="op" id="6150253">.</span><span class="ident" id="6150254">Parse</span><span class="op" id="6150259">(</span><span class="ident" id="6150260">layout</span><span class="op" id="6150266">,</span>&nbsp;<span class="ident" id="6150268">date</span><span class="op" id="6150272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150276">if</span>&nbsp;<span class="ident" id="6150279">err</span>&nbsp;<span class="op" id="6150283">==</span>&nbsp;<span class="ident" id="6150286">nil</span>&nbsp;<span class="op" id="6150290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150295">return</span>&nbsp;<span class="ident" id="6150302">t</span><span class="op" id="6150303">,</span>&nbsp;<span class="ident" id="6150305">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150317">return</span>&nbsp;<span class="ident" id="6150324">time</span><span class="op" id="6150328">.</span><span class="ident" id="6150329">Time</span><span class="op" id="6150333">{</span><span class="op" id="6150334">}</span><span class="op" id="6150335">,</span>&nbsp;<span class="ident" id="6150337">errors</span><span class="op" id="6150343">.</span><span class="ident" id="6150344">New</span><span class="op" id="6150347">(</span><span class="string" id="6150348">&#34;mail:&nbsp;header&nbsp;could&nbsp;not&nbsp;be&nbsp;parsed&#34;</span><span class="op" id="6150382">)</span><br>
<span class="lineno"></span><span class="op" id="6150384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6150387">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;in&nbsp;a&nbsp;mail&nbsp;message&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6150456">type</span>&nbsp;<span class="ident" id="6150461">Header</span>&nbsp;<span class="keyword" id="6150468">map</span><span class="op" id="6150471">[</span><span class="builtintype" id="6150472">string</span><span class="op" id="6150478">]</span><span class="op" id="6150479">[</span><span class="op" id="6150480">]</span><span class="builtintype" id="6150481">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6150489">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="6150548">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno">110</span><span class="keyword" id="6150615">func</span>&nbsp;<span class="op" id="6150620">(</span><span class="ident" id="6150621">h</span>&nbsp;<span class="ident" id="6150623">Header</span><span class="op" id="6150629">)</span>&nbsp;<span class="ident" id="6150631">Get</span><span class="op" id="6150634">(</span><span class="ident" id="6150635">key</span>&nbsp;<span class="builtintype" id="6150639">string</span><span class="op" id="6150645">)</span>&nbsp;<span class="builtintype" id="6150647">string</span>&nbsp;<span class="op" id="6150654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150657">return</span>&nbsp;<span class="ident" id="6150664">textproto</span><span class="op" id="6150673">.</span><span class="ident" id="6150674">MIMEHeader</span><span class="op" id="6150684">(</span><span class="ident" id="6150685">h</span><span class="op" id="6150686">)</span><span class="op" id="6150687">.</span><span class="ident" id="6150688">Get</span><span class="op" id="6150691">(</span><span class="ident" id="6150692">key</span><span class="op" id="6150695">)</span><br>
<span class="lineno"></span><span class="op" id="6150697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6150700">var</span>&nbsp;<span class="ident" id="6150704">ErrHeaderNotPresent</span>&nbsp;<span class="op" id="6150724">=</span>&nbsp;<span class="ident" id="6150726">errors</span><span class="op" id="6150732">.</span><span class="ident" id="6150733">New</span><span class="op" id="6150736">(</span><span class="string" id="6150737">&#34;mail:&nbsp;header&nbsp;not&nbsp;in&nbsp;message&#34;</span><span class="op" id="6150766">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6150769">//&nbsp;Date&nbsp;parses&nbsp;the&nbsp;Date&nbsp;header&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6150807">func</span>&nbsp;<span class="op" id="6150812">(</span><span class="ident" id="6150813">h</span>&nbsp;<span class="ident" id="6150815">Header</span><span class="op" id="6150821">)</span>&nbsp;<span class="ident" id="6150823">Date</span><span class="op" id="6150827">(</span><span class="op" id="6150828">)</span>&nbsp;<span class="op" id="6150830">(</span><span class="ident" id="6150831">time</span><span class="op" id="6150835">.</span><span class="ident" id="6150836">Time</span><span class="op" id="6150840">,</span>&nbsp;<span class="builtintype" id="6150842">error</span><span class="op" id="6150847">)</span>&nbsp;<span class="op" id="6150849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6150852">hdr</span>&nbsp;<span class="op" id="6150856">:=</span>&nbsp;<span class="ident" id="6150859">h</span><span class="op" id="6150860">.</span><span class="ident" id="6150861">Get</span><span class="op" id="6150864">(</span><span class="string" id="6150865">&#34;Date&#34;</span><span class="op" id="6150871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150874">if</span>&nbsp;<span class="ident" id="6150877">hdr</span>&nbsp;<span class="op" id="6150881">==</span>&nbsp;<span class="string" id="6150884">&#34;&#34;</span>&nbsp;<span class="op" id="6150887">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150891">return</span>&nbsp;<span class="ident" id="6150898">time</span><span class="op" id="6150902">.</span><span class="ident" id="6150903">Time</span><span class="op" id="6150907">{</span><span class="op" id="6150908">}</span><span class="op" id="6150909">,</span>&nbsp;<span class="ident" id="6150911">ErrHeaderNotPresent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6150932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6150935">return</span>&nbsp;<span class="ident" id="6150942">parseDate</span><span class="op" id="6150951">(</span><span class="ident" id="6150952">hdr</span><span class="op" id="6150955">)</span><br>
<span class="lineno"></span><span class="op" id="6150957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6150960">//&nbsp;AddressList&nbsp;parses&nbsp;the&nbsp;named&nbsp;header&nbsp;field&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="6151029">func</span>&nbsp;<span class="op" id="6151034">(</span><span class="ident" id="6151035">h</span>&nbsp;<span class="ident" id="6151037">Header</span><span class="op" id="6151043">)</span>&nbsp;<span class="ident" id="6151045">AddressList</span><span class="op" id="6151056">(</span><span class="ident" id="6151057">key</span>&nbsp;<span class="builtintype" id="6151061">string</span><span class="op" id="6151067">)</span>&nbsp;<span class="op" id="6151069">(</span><span class="op" id="6151070">[</span><span class="op" id="6151071">]</span><span class="op" id="6151072">*</span><span class="ident" id="6151073">Address</span><span class="op" id="6151080">,</span>&nbsp;<span class="builtintype" id="6151082">error</span><span class="op" id="6151087">)</span>&nbsp;<span class="op" id="6151089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151092">hdr</span>&nbsp;<span class="op" id="6151096">:=</span>&nbsp;<span class="ident" id="6151099">h</span><span class="op" id="6151100">.</span><span class="ident" id="6151101">Get</span><span class="op" id="6151104">(</span><span class="ident" id="6151105">key</span><span class="op" id="6151108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151111">if</span>&nbsp;<span class="ident" id="6151114">hdr</span>&nbsp;<span class="op" id="6151118">==</span>&nbsp;<span class="string" id="6151121">&#34;&#34;</span>&nbsp;<span class="op" id="6151124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151128">return</span>&nbsp;<span class="ident" id="6151135">nil</span><span class="op" id="6151138">,</span>&nbsp;<span class="ident" id="6151140">ErrHeaderNotPresent</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6151161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151164">return</span>&nbsp;<span class="ident" id="6151171">ParseAddressList</span><span class="op" id="6151187">(</span><span class="ident" id="6151188">hdr</span><span class="op" id="6151191">)</span><br>
<span class="lineno"></span><span class="op" id="6151193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151196">//&nbsp;Address&nbsp;represents&nbsp;a&nbsp;single&nbsp;mail&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="6151241">//&nbsp;An&nbsp;address&nbsp;such&nbsp;as&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;&nbsp;is&nbsp;represented</span><br>
<span class="lineno"></span><span class="comment" id="6151309">//&nbsp;as&nbsp;Address{Name:&nbsp;&#34;Barry&nbsp;Gibbs&#34;,&nbsp;Address:&nbsp;&#34;bg@example.com&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="6151372">type</span>&nbsp;<span class="ident" id="6151377">Address</span>&nbsp;<span class="keyword" id="6151385">struct</span>&nbsp;<span class="op" id="6151392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151395">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6151403">string</span>&nbsp;<span class="comment" id="6151410">//&nbsp;Proper&nbsp;name;&nbsp;may&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6151441">Address</span>&nbsp;<span class="builtintype" id="6151449">string</span>&nbsp;<span class="comment" id="6151456">//&nbsp;user@domain</span><br>
<span class="lineno">140</span><span class="op" id="6151471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151474">//&nbsp;Parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address,&nbsp;e.g.&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="6151547">func</span>&nbsp;<span class="ident" id="6151552">ParseAddress</span><span class="op" id="6151564">(</span><span class="ident" id="6151565">address</span>&nbsp;<span class="builtintype" id="6151573">string</span><span class="op" id="6151579">)</span>&nbsp;<span class="op" id="6151581">(</span><span class="op" id="6151582">*</span><span class="ident" id="6151583">Address</span><span class="op" id="6151590">,</span>&nbsp;<span class="builtintype" id="6151592">error</span><span class="op" id="6151597">)</span>&nbsp;<span class="op" id="6151599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151602">return</span>&nbsp;<span class="ident" id="6151609">newAddrParser</span><span class="op" id="6151622">(</span><span class="ident" id="6151623">address</span><span class="op" id="6151630">)</span><span class="op" id="6151631">.</span><span class="ident" id="6151632">parseAddress</span><span class="op" id="6151644">(</span><span class="op" id="6151645">)</span><br>
<span class="lineno">145</span><span class="op" id="6151647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151650">//&nbsp;ParseAddressList&nbsp;parses&nbsp;the&nbsp;given&nbsp;string&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="6151718">func</span>&nbsp;<span class="ident" id="6151723">ParseAddressList</span><span class="op" id="6151739">(</span><span class="ident" id="6151740">list</span>&nbsp;<span class="builtintype" id="6151745">string</span><span class="op" id="6151751">)</span>&nbsp;<span class="op" id="6151753">(</span><span class="op" id="6151754">[</span><span class="op" id="6151755">]</span><span class="op" id="6151756">*</span><span class="ident" id="6151757">Address</span><span class="op" id="6151764">,</span>&nbsp;<span class="builtintype" id="6151766">error</span><span class="op" id="6151771">)</span>&nbsp;<span class="op" id="6151773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6151776">return</span>&nbsp;<span class="ident" id="6151783">newAddrParser</span><span class="op" id="6151796">(</span><span class="ident" id="6151797">list</span><span class="op" id="6151801">)</span><span class="op" id="6151802">.</span><span class="ident" id="6151803">parseAddressList</span><span class="op" id="6151819">(</span><span class="op" id="6151820">)</span><br>
<span class="lineno">150</span><span class="op" id="6151822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6151825">//&nbsp;String&nbsp;formats&nbsp;the&nbsp;address&nbsp;as&nbsp;a&nbsp;valid&nbsp;RFC&nbsp;5322&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6151884">//&nbsp;If&nbsp;the&nbsp;address&#39;s&nbsp;name&nbsp;contains&nbsp;non-ASCII&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="6151939">//&nbsp;the&nbsp;name&nbsp;will&nbsp;be&nbsp;rendered&nbsp;according&nbsp;to&nbsp;RFC&nbsp;2047.</span><br>
<span class="lineno">155</span><span class="keyword" id="6151991">func</span>&nbsp;<span class="op" id="6151996">(</span><span class="ident" id="6151997">a</span>&nbsp;<span class="op" id="6151999">*</span><span class="ident" id="6152000">Address</span><span class="op" id="6152007">)</span>&nbsp;<span class="ident" id="6152009">String</span><span class="op" id="6152015">(</span><span class="op" id="6152016">)</span>&nbsp;<span class="builtintype" id="6152018">string</span>&nbsp;<span class="op" id="6152025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152028">s</span>&nbsp;<span class="op" id="6152030">:=</span>&nbsp;<span class="string" id="6152033">&#34;&lt;&#34;</span>&nbsp;<span class="op" id="6152037">+</span>&nbsp;<span class="ident" id="6152039">a</span><span class="op" id="6152040">.</span><span class="ident" id="6152041">Address</span>&nbsp;<span class="op" id="6152049">+</span>&nbsp;<span class="string" id="6152051">&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152056">if</span>&nbsp;<span class="ident" id="6152059">a</span><span class="op" id="6152060">.</span><span class="ident" id="6152061">Name</span>&nbsp;<span class="op" id="6152066">==</span>&nbsp;<span class="string" id="6152069">&#34;&#34;</span>&nbsp;<span class="op" id="6152072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152076">return</span>&nbsp;<span class="ident" id="6152083">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152086">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152089">//&nbsp;If&nbsp;every&nbsp;character&nbsp;is&nbsp;printable&nbsp;ASCII,&nbsp;quoting&nbsp;is&nbsp;simple.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152151">allPrintable</span>&nbsp;<span class="op" id="6152164">:=</span>&nbsp;<span class="builtintype" id="6152167">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152173">for</span>&nbsp;<span class="ident" id="6152177">i</span>&nbsp;<span class="op" id="6152179">:=</span>&nbsp;<span class="num" id="6152182">0</span><span class="op" id="6152183">;</span>&nbsp;<span class="ident" id="6152185">i</span>&nbsp;<span class="op" id="6152187">&lt;</span>&nbsp;<span class="builtinfunc" id="6152189">len</span><span class="op" id="6152192">(</span><span class="ident" id="6152193">a</span><span class="op" id="6152194">.</span><span class="ident" id="6152195">Name</span><span class="op" id="6152199">)</span><span class="op" id="6152200">;</span>&nbsp;<span class="ident" id="6152202">i</span><span class="op" id="6152203">++</span>&nbsp;<span class="op" id="6152206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152210">//&nbsp;isWSP&nbsp;here&nbsp;should&nbsp;actually&nbsp;be&nbsp;isFWS,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152252">//&nbsp;but&nbsp;we&nbsp;don&#39;t&nbsp;support&nbsp;folding&nbsp;yet.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152291">if</span>&nbsp;<span class="op" id="6152294">!</span><span class="ident" id="6152295">isVchar</span><span class="op" id="6152302">(</span><span class="ident" id="6152303">a</span><span class="op" id="6152304">.</span><span class="ident" id="6152305">Name</span><span class="op" id="6152309">[</span><span class="ident" id="6152310">i</span><span class="op" id="6152311">]</span><span class="op" id="6152312">)</span>&nbsp;<span class="op" id="6152314">&amp;&amp;</span>&nbsp;<span class="op" id="6152317">!</span><span class="ident" id="6152318">isWSP</span><span class="op" id="6152323">(</span><span class="ident" id="6152324">a</span><span class="op" id="6152325">.</span><span class="ident" id="6152326">Name</span><span class="op" id="6152330">[</span><span class="ident" id="6152331">i</span><span class="op" id="6152332">]</span><span class="op" id="6152333">)</span>&nbsp;<span class="op" id="6152335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152340">allPrintable</span>&nbsp;<span class="op" id="6152353">=</span>&nbsp;<span class="builtintype" id="6152355">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152364">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152375">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152378">if</span>&nbsp;<span class="ident" id="6152381">allPrintable</span>&nbsp;<span class="op" id="6152394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152398">b</span>&nbsp;<span class="op" id="6152400">:=</span>&nbsp;<span class="ident" id="6152403">bytes</span><span class="op" id="6152408">.</span><span class="ident" id="6152409">NewBufferString</span><span class="op" id="6152424">(</span><span class="string" id="6152425">`&#34;`</span><span class="op" id="6152428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152432">for</span>&nbsp;<span class="ident" id="6152436">i</span>&nbsp;<span class="op" id="6152438">:=</span>&nbsp;<span class="num" id="6152441">0</span><span class="op" id="6152442">;</span>&nbsp;<span class="ident" id="6152444">i</span>&nbsp;<span class="op" id="6152446">&lt;</span>&nbsp;<span class="builtinfunc" id="6152448">len</span><span class="op" id="6152451">(</span><span class="ident" id="6152452">a</span><span class="op" id="6152453">.</span><span class="ident" id="6152454">Name</span><span class="op" id="6152458">)</span><span class="op" id="6152459">;</span>&nbsp;<span class="ident" id="6152461">i</span><span class="op" id="6152462">++</span>&nbsp;<span class="op" id="6152465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152470">if</span>&nbsp;<span class="op" id="6152473">!</span><span class="ident" id="6152474">isQtext</span><span class="op" id="6152481">(</span><span class="ident" id="6152482">a</span><span class="op" id="6152483">.</span><span class="ident" id="6152484">Name</span><span class="op" id="6152488">[</span><span class="ident" id="6152489">i</span><span class="op" id="6152490">]</span><span class="op" id="6152491">)</span>&nbsp;<span class="op" id="6152493">&amp;&amp;</span>&nbsp;<span class="op" id="6152496">!</span><span class="ident" id="6152497">isWSP</span><span class="op" id="6152502">(</span><span class="ident" id="6152503">a</span><span class="op" id="6152504">.</span><span class="ident" id="6152505">Name</span><span class="op" id="6152509">[</span><span class="ident" id="6152510">i</span><span class="op" id="6152511">]</span><span class="op" id="6152512">)</span>&nbsp;<span class="op" id="6152514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152520">b</span><span class="op" id="6152521">.</span><span class="ident" id="6152522">WriteByte</span><span class="op" id="6152531">(</span><span class="string" id="6152532">&#39;\\&#39;</span><span class="op" id="6152536">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152546">b</span><span class="op" id="6152547">.</span><span class="ident" id="6152548">WriteByte</span><span class="op" id="6152557">(</span><span class="ident" id="6152558">a</span><span class="op" id="6152559">.</span><span class="ident" id="6152560">Name</span><span class="op" id="6152564">[</span><span class="ident" id="6152565">i</span><span class="op" id="6152566">]</span><span class="op" id="6152567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152575">b</span><span class="op" id="6152576">.</span><span class="ident" id="6152577">WriteString</span><span class="op" id="6152588">(</span><span class="string" id="6152589">`&#34;&nbsp;`</span><span class="op" id="6152593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152597">b</span><span class="op" id="6152598">.</span><span class="ident" id="6152599">WriteString</span><span class="op" id="6152610">(</span><span class="ident" id="6152611">s</span><span class="op" id="6152612">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152616">return</span>&nbsp;<span class="ident" id="6152623">b</span><span class="op" id="6152624">.</span><span class="ident" id="6152625">String</span><span class="op" id="6152631">(</span><span class="op" id="6152632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6152639">//&nbsp;UTF-8&nbsp;&#34;Q&#34;&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152662">b</span>&nbsp;<span class="op" id="6152664">:=</span>&nbsp;<span class="ident" id="6152667">bytes</span><span class="op" id="6152672">.</span><span class="ident" id="6152673">NewBufferString</span><span class="op" id="6152688">(</span><span class="string" id="6152689">&#34;=?utf-8?q?&#34;</span><span class="op" id="6152701">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152704">for</span>&nbsp;<span class="ident" id="6152708">i</span>&nbsp;<span class="op" id="6152710">:=</span>&nbsp;<span class="num" id="6152713">0</span><span class="op" id="6152714">;</span>&nbsp;<span class="ident" id="6152716">i</span>&nbsp;<span class="op" id="6152718">&lt;</span>&nbsp;<span class="builtinfunc" id="6152720">len</span><span class="op" id="6152723">(</span><span class="ident" id="6152724">a</span><span class="op" id="6152725">.</span><span class="ident" id="6152726">Name</span><span class="op" id="6152730">)</span><span class="op" id="6152731">;</span>&nbsp;<span class="ident" id="6152733">i</span><span class="op" id="6152734">++</span>&nbsp;<span class="op" id="6152737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152741">switch</span>&nbsp;<span class="ident" id="6152748">c</span>&nbsp;<span class="op" id="6152750">:=</span>&nbsp;<span class="ident" id="6152753">a</span><span class="op" id="6152754">.</span><span class="ident" id="6152755">Name</span><span class="op" id="6152759">[</span><span class="ident" id="6152760">i</span><span class="op" id="6152761">]</span><span class="op" id="6152762">;</span>&nbsp;<span class="op" id="6152764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152768">case</span>&nbsp;<span class="ident" id="6152773">c</span>&nbsp;<span class="op" id="6152775">==</span>&nbsp;<span class="string" id="6152778">&#39;&nbsp;&#39;</span><span class="op" id="6152781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152786">b</span><span class="op" id="6152787">.</span><span class="ident" id="6152788">WriteByte</span><span class="op" id="6152797">(</span><span class="string" id="6152798">&#39;_&#39;</span><span class="op" id="6152801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152805">case</span>&nbsp;<span class="ident" id="6152810">isVchar</span><span class="op" id="6152817">(</span><span class="ident" id="6152818">c</span><span class="op" id="6152819">)</span>&nbsp;<span class="op" id="6152821">&amp;&amp;</span>&nbsp;<span class="ident" id="6152824">c</span>&nbsp;<span class="op" id="6152826">!=</span>&nbsp;<span class="string" id="6152829">&#39;=&#39;</span>&nbsp;<span class="op" id="6152833">&amp;&amp;</span>&nbsp;<span class="ident" id="6152836">c</span>&nbsp;<span class="op" id="6152838">!=</span>&nbsp;<span class="string" id="6152841">&#39;?&#39;</span>&nbsp;<span class="op" id="6152845">&amp;&amp;</span>&nbsp;<span class="ident" id="6152848">c</span>&nbsp;<span class="op" id="6152850">!=</span>&nbsp;<span class="string" id="6152853">&#39;_&#39;</span><span class="op" id="6152856">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152861">b</span><span class="op" id="6152862">.</span><span class="ident" id="6152863">WriteByte</span><span class="op" id="6152872">(</span><span class="ident" id="6152873">c</span><span class="op" id="6152874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152878">default</span><span class="op" id="6152885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152890">fmt</span><span class="op" id="6152893">.</span><span class="ident" id="6152894">Fprintf</span><span class="op" id="6152901">(</span><span class="ident" id="6152902">b</span><span class="op" id="6152903">,</span>&nbsp;<span class="string" id="6152905">&#34;=%02X&#34;</span><span class="op" id="6152912">,</span>&nbsp;<span class="ident" id="6152914">c</span><span class="op" id="6152915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6152922">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152925">b</span><span class="op" id="6152926">.</span><span class="ident" id="6152927">WriteString</span><span class="op" id="6152938">(</span><span class="string" id="6152939">&#34;?=&nbsp;&#34;</span><span class="op" id="6152944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6152947">b</span><span class="op" id="6152948">.</span><span class="ident" id="6152949">WriteString</span><span class="op" id="6152960">(</span><span class="ident" id="6152961">s</span><span class="op" id="6152962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6152965">return</span>&nbsp;<span class="ident" id="6152972">b</span><span class="op" id="6152973">.</span><span class="ident" id="6152974">String</span><span class="op" id="6152980">(</span><span class="op" id="6152981">)</span><br>
<span class="lineno"></span><span class="op" id="6152983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="6152986">type</span>&nbsp;<span class="ident" id="6152991">addrParser</span>&nbsp;<span class="op" id="6153002">[</span><span class="op" id="6153003">]</span><span class="builtintype" id="6153004">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6153010">func</span>&nbsp;<span class="ident" id="6153015">newAddrParser</span><span class="op" id="6153028">(</span><span class="ident" id="6153029">s</span>&nbsp;<span class="builtintype" id="6153031">string</span><span class="op" id="6153037">)</span>&nbsp;<span class="op" id="6153039">*</span><span class="ident" id="6153040">addrParser</span>&nbsp;<span class="op" id="6153051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153054">p</span>&nbsp;<span class="op" id="6153056">:=</span>&nbsp;<span class="ident" id="6153059">addrParser</span><span class="op" id="6153069">(</span><span class="ident" id="6153070">s</span><span class="op" id="6153071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153074">return</span>&nbsp;<span class="op" id="6153081">&amp;</span><span class="ident" id="6153082">p</span><br>
<span class="lineno">205</span><span class="op" id="6153084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6153087">func</span>&nbsp;<span class="op" id="6153092">(</span><span class="ident" id="6153093">p</span>&nbsp;<span class="op" id="6153095">*</span><span class="ident" id="6153096">addrParser</span><span class="op" id="6153106">)</span>&nbsp;<span class="ident" id="6153108">parseAddressList</span><span class="op" id="6153124">(</span><span class="op" id="6153125">)</span>&nbsp;<span class="op" id="6153127">(</span><span class="op" id="6153128">[</span><span class="op" id="6153129">]</span><span class="op" id="6153130">*</span><span class="ident" id="6153131">Address</span><span class="op" id="6153138">,</span>&nbsp;<span class="builtintype" id="6153140">error</span><span class="op" id="6153145">)</span>&nbsp;<span class="op" id="6153147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153150">var</span>&nbsp;<span class="ident" id="6153154">list</span>&nbsp;<span class="op" id="6153159">[</span><span class="op" id="6153160">]</span><span class="op" id="6153161">*</span><span class="ident" id="6153162">Address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153171">for</span>&nbsp;<span class="op" id="6153175">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153179">p</span><span class="op" id="6153180">.</span><span class="ident" id="6153181">skipSpace</span><span class="op" id="6153190">(</span><span class="op" id="6153191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153195">addr</span><span class="op" id="6153199">,</span>&nbsp;<span class="ident" id="6153201">err</span>&nbsp;<span class="op" id="6153205">:=</span>&nbsp;<span class="ident" id="6153208">p</span><span class="op" id="6153209">.</span><span class="ident" id="6153210">parseAddress</span><span class="op" id="6153222">(</span><span class="op" id="6153223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153227">if</span>&nbsp;<span class="ident" id="6153230">err</span>&nbsp;<span class="op" id="6153234">!=</span>&nbsp;<span class="ident" id="6153237">nil</span>&nbsp;<span class="op" id="6153241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153246">return</span>&nbsp;<span class="ident" id="6153253">nil</span><span class="op" id="6153256">,</span>&nbsp;<span class="ident" id="6153258">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153264">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153268">list</span>&nbsp;<span class="op" id="6153273">=</span>&nbsp;<span class="builtinfunc" id="6153275">append</span><span class="op" id="6153281">(</span><span class="ident" id="6153282">list</span><span class="op" id="6153286">,</span>&nbsp;<span class="ident" id="6153288">addr</span><span class="op" id="6153292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153297">p</span><span class="op" id="6153298">.</span><span class="ident" id="6153299">skipSpace</span><span class="op" id="6153308">(</span><span class="op" id="6153309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153313">if</span>&nbsp;<span class="ident" id="6153316">p</span><span class="op" id="6153317">.</span><span class="ident" id="6153318">empty</span><span class="op" id="6153323">(</span><span class="op" id="6153324">)</span>&nbsp;<span class="op" id="6153326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153331">break</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153343">if</span>&nbsp;<span class="op" id="6153346">!</span><span class="ident" id="6153347">p</span><span class="op" id="6153348">.</span><span class="ident" id="6153349">consume</span><span class="op" id="6153356">(</span><span class="string" id="6153357">&#39;,&#39;</span><span class="op" id="6153360">)</span>&nbsp;<span class="op" id="6153362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153367">return</span>&nbsp;<span class="ident" id="6153374">nil</span><span class="op" id="6153377">,</span>&nbsp;<span class="ident" id="6153379">errors</span><span class="op" id="6153385">.</span><span class="ident" id="6153386">New</span><span class="op" id="6153389">(</span><span class="string" id="6153390">&#34;mail:&nbsp;expected&nbsp;comma&#34;</span><span class="op" id="6153412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153419">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153422">return</span>&nbsp;<span class="ident" id="6153429">list</span><span class="op" id="6153433">,</span>&nbsp;<span class="ident" id="6153435">nil</span><br>
<span class="lineno"></span><span class="op" id="6153439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6153442">//&nbsp;parseAddress&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="6153510">func</span>&nbsp;<span class="op" id="6153515">(</span><span class="ident" id="6153516">p</span>&nbsp;<span class="op" id="6153518">*</span><span class="ident" id="6153519">addrParser</span><span class="op" id="6153529">)</span>&nbsp;<span class="ident" id="6153531">parseAddress</span><span class="op" id="6153543">(</span><span class="op" id="6153544">)</span>&nbsp;<span class="op" id="6153546">(</span><span class="ident" id="6153547">addr</span>&nbsp;<span class="op" id="6153552">*</span><span class="ident" id="6153553">Address</span><span class="op" id="6153560">,</span>&nbsp;<span class="ident" id="6153562">err</span>&nbsp;<span class="builtintype" id="6153566">error</span><span class="op" id="6153571">)</span>&nbsp;<span class="op" id="6153573">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153576">debug</span><span class="op" id="6153581">.</span><span class="ident" id="6153582">Printf</span><span class="op" id="6153588">(</span><span class="string" id="6153589">&#34;parseAddress:&nbsp;%q&#34;</span><span class="op" id="6153607">,</span>&nbsp;<span class="op" id="6153609">*</span><span class="ident" id="6153610">p</span><span class="op" id="6153611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153614">p</span><span class="op" id="6153615">.</span><span class="ident" id="6153616">skipSpace</span><span class="op" id="6153625">(</span><span class="op" id="6153626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153629">if</span>&nbsp;<span class="ident" id="6153632">p</span><span class="op" id="6153633">.</span><span class="ident" id="6153634">empty</span><span class="op" id="6153639">(</span><span class="op" id="6153640">)</span>&nbsp;<span class="op" id="6153642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153646">return</span>&nbsp;<span class="ident" id="6153653">nil</span><span class="op" id="6153656">,</span>&nbsp;<span class="ident" id="6153658">errors</span><span class="op" id="6153664">.</span><span class="ident" id="6153665">New</span><span class="op" id="6153668">(</span><span class="string" id="6153669">&#34;mail:&nbsp;no&nbsp;address&#34;</span><span class="op" id="6153687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6153690">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153694">//&nbsp;address&nbsp;=&nbsp;name-addr&nbsp;/&nbsp;addr-spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153730">//&nbsp;TODO(dsymonds):&nbsp;Support&nbsp;parsing&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153782">//&nbsp;addr-spec&nbsp;has&nbsp;a&nbsp;more&nbsp;restricted&nbsp;grammar&nbsp;than&nbsp;name-addr,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153842">//&nbsp;so&nbsp;try&nbsp;parsing&nbsp;it&nbsp;first,&nbsp;and&nbsp;fallback&nbsp;to&nbsp;name-addr.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6153898">//&nbsp;TODO(dsymonds):&nbsp;Is&nbsp;this&nbsp;really&nbsp;correct?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6153942">spec</span><span class="op" id="6153946">,</span>&nbsp;<span class="ident" id="6153948">err</span>&nbsp;<span class="op" id="6153952">:=</span>&nbsp;<span class="ident" id="6153955">p</span><span class="op" id="6153956">.</span><span class="ident" id="6153957">consumeAddrSpec</span><span class="op" id="6153972">(</span><span class="op" id="6153973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153976">if</span>&nbsp;<span class="ident" id="6153979">err</span>&nbsp;<span class="op" id="6153983">==</span>&nbsp;<span class="ident" id="6153986">nil</span>&nbsp;<span class="op" id="6153990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6153994">return</span>&nbsp;<span class="op" id="6154001">&amp;</span><span class="ident" id="6154002">Address</span><span class="op" id="6154009">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154014">Address</span><span class="op" id="6154021">:</span>&nbsp;<span class="ident" id="6154023">spec</span><span class="op" id="6154027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154031">}</span><span class="op" id="6154032">,</span>&nbsp;<span class="ident" id="6154034">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154042">debug</span><span class="op" id="6154047">.</span><span class="ident" id="6154048">Printf</span><span class="op" id="6154054">(</span><span class="string" id="6154055">&#34;parseAddress:&nbsp;not&nbsp;an&nbsp;addr-spec:&nbsp;%v&#34;</span><span class="op" id="6154091">,</span>&nbsp;<span class="ident" id="6154093">err</span><span class="op" id="6154096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154099">debug</span><span class="op" id="6154104">.</span><span class="ident" id="6154105">Printf</span><span class="op" id="6154111">(</span><span class="string" id="6154112">&#34;parseAddress:&nbsp;state&nbsp;is&nbsp;now&nbsp;%q&#34;</span><span class="op" id="6154143">,</span>&nbsp;<span class="op" id="6154145">*</span><span class="ident" id="6154146">p</span><span class="op" id="6154147">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154151">//&nbsp;display-name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154168">var</span>&nbsp;<span class="ident" id="6154172">displayName</span>&nbsp;<span class="builtintype" id="6154184">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154192">if</span>&nbsp;<span class="ident" id="6154195">p</span><span class="op" id="6154196">.</span><span class="ident" id="6154197">peek</span><span class="op" id="6154201">(</span><span class="op" id="6154202">)</span>&nbsp;<span class="op" id="6154204">!=</span>&nbsp;<span class="string" id="6154207">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="6154211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154215">displayName</span><span class="op" id="6154226">,</span>&nbsp;<span class="ident" id="6154228">err</span>&nbsp;<span class="op" id="6154232">=</span>&nbsp;<span class="ident" id="6154234">p</span><span class="op" id="6154235">.</span><span class="ident" id="6154236">consumePhrase</span><span class="op" id="6154249">(</span><span class="op" id="6154250">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154254">if</span>&nbsp;<span class="ident" id="6154257">err</span>&nbsp;<span class="op" id="6154261">!=</span>&nbsp;<span class="ident" id="6154264">nil</span>&nbsp;<span class="op" id="6154268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154273">return</span>&nbsp;<span class="ident" id="6154280">nil</span><span class="op" id="6154283">,</span>&nbsp;<span class="ident" id="6154285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154297">debug</span><span class="op" id="6154302">.</span><span class="ident" id="6154303">Printf</span><span class="op" id="6154309">(</span><span class="string" id="6154310">&#34;parseAddress:&nbsp;displayName=%q&#34;</span><span class="op" id="6154340">,</span>&nbsp;<span class="ident" id="6154342">displayName</span><span class="op" id="6154353">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154357">//&nbsp;angle-addr&nbsp;=&nbsp;&#34;&lt;&#34;&nbsp;addr-spec&nbsp;&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154392">p</span><span class="op" id="6154393">.</span><span class="ident" id="6154394">skipSpace</span><span class="op" id="6154403">(</span><span class="op" id="6154404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154407">if</span>&nbsp;<span class="op" id="6154410">!</span><span class="ident" id="6154411">p</span><span class="op" id="6154412">.</span><span class="ident" id="6154413">consume</span><span class="op" id="6154420">(</span><span class="string" id="6154421">&#39;&lt;&#39;</span><span class="op" id="6154424">)</span>&nbsp;<span class="op" id="6154426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154430">return</span>&nbsp;<span class="ident" id="6154437">nil</span><span class="op" id="6154440">,</span>&nbsp;<span class="ident" id="6154442">errors</span><span class="op" id="6154448">.</span><span class="ident" id="6154449">New</span><span class="op" id="6154452">(</span><span class="string" id="6154453">&#34;mail:&nbsp;no&nbsp;angle-addr&#34;</span><span class="op" id="6154474">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154480">spec</span><span class="op" id="6154484">,</span>&nbsp;<span class="ident" id="6154486">err</span>&nbsp;<span class="op" id="6154490">=</span>&nbsp;<span class="ident" id="6154492">p</span><span class="op" id="6154493">.</span><span class="ident" id="6154494">consumeAddrSpec</span><span class="op" id="6154509">(</span><span class="op" id="6154510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154513">if</span>&nbsp;<span class="ident" id="6154516">err</span>&nbsp;<span class="op" id="6154520">!=</span>&nbsp;<span class="ident" id="6154523">nil</span>&nbsp;<span class="op" id="6154527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154531">return</span>&nbsp;<span class="ident" id="6154538">nil</span><span class="op" id="6154541">,</span>&nbsp;<span class="ident" id="6154543">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154548">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154551">if</span>&nbsp;<span class="op" id="6154554">!</span><span class="ident" id="6154555">p</span><span class="op" id="6154556">.</span><span class="ident" id="6154557">consume</span><span class="op" id="6154564">(</span><span class="string" id="6154565">&#39;&gt;&#39;</span><span class="op" id="6154568">)</span>&nbsp;<span class="op" id="6154570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154574">return</span>&nbsp;<span class="ident" id="6154581">nil</span><span class="op" id="6154584">,</span>&nbsp;<span class="ident" id="6154586">errors</span><span class="op" id="6154592">.</span><span class="ident" id="6154593">New</span><span class="op" id="6154596">(</span><span class="string" id="6154597">&#34;mail:&nbsp;unclosed&nbsp;angle-addr&#34;</span><span class="op" id="6154624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154630">debug</span><span class="op" id="6154635">.</span><span class="ident" id="6154636">Printf</span><span class="op" id="6154642">(</span><span class="string" id="6154643">&#34;parseAddress:&nbsp;spec=%q&#34;</span><span class="op" id="6154666">,</span>&nbsp;<span class="ident" id="6154668">spec</span><span class="op" id="6154672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154676">return</span>&nbsp;<span class="op" id="6154683">&amp;</span><span class="ident" id="6154684">Address</span><span class="op" id="6154691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154695">Name</span><span class="op" id="6154699">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6154704">displayName</span><span class="op" id="6154715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154719">Address</span><span class="op" id="6154726">:</span>&nbsp;<span class="ident" id="6154728">spec</span><span class="op" id="6154732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154735">}</span><span class="op" id="6154736">,</span>&nbsp;<span class="ident" id="6154738">nil</span><br>
<span class="lineno"></span><span class="op" id="6154742">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="6154745">//&nbsp;consumeAddrSpec&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;addr-spec&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="6154818">func</span>&nbsp;<span class="op" id="6154823">(</span><span class="ident" id="6154824">p</span>&nbsp;<span class="op" id="6154826">*</span><span class="ident" id="6154827">addrParser</span><span class="op" id="6154837">)</span>&nbsp;<span class="ident" id="6154839">consumeAddrSpec</span><span class="op" id="6154854">(</span><span class="op" id="6154855">)</span>&nbsp;<span class="op" id="6154857">(</span><span class="ident" id="6154858">spec</span>&nbsp;<span class="builtintype" id="6154863">string</span><span class="op" id="6154869">,</span>&nbsp;<span class="ident" id="6154871">err</span>&nbsp;<span class="builtintype" id="6154875">error</span><span class="op" id="6154880">)</span>&nbsp;<span class="op" id="6154882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154885">debug</span><span class="op" id="6154890">.</span><span class="ident" id="6154891">Printf</span><span class="op" id="6154897">(</span><span class="string" id="6154898">&#34;consumeAddrSpec:&nbsp;%q&#34;</span><span class="op" id="6154919">,</span>&nbsp;<span class="op" id="6154921">*</span><span class="ident" id="6154922">p</span><span class="op" id="6154923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6154927">orig</span>&nbsp;<span class="op" id="6154932">:=</span>&nbsp;<span class="op" id="6154935">*</span><span class="ident" id="6154936">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154939">defer</span>&nbsp;<span class="keyword" id="6154945">func</span><span class="op" id="6154949">(</span><span class="op" id="6154950">)</span>&nbsp;<span class="op" id="6154952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6154956">if</span>&nbsp;<span class="ident" id="6154959">err</span>&nbsp;<span class="op" id="6154963">!=</span>&nbsp;<span class="ident" id="6154966">nil</span>&nbsp;<span class="op" id="6154970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154975">*</span><span class="ident" id="6154976">p</span>&nbsp;<span class="op" id="6154978">=</span>&nbsp;<span class="ident" id="6154980">orig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154987">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6154990">}</span><span class="op" id="6154991">(</span><span class="op" id="6154992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6154996">//&nbsp;local-part&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155038">var</span>&nbsp;<span class="ident" id="6155042">localPart</span>&nbsp;<span class="builtintype" id="6155052">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155060">p</span><span class="op" id="6155061">.</span><span class="ident" id="6155062">skipSpace</span><span class="op" id="6155071">(</span><span class="op" id="6155072">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155075">if</span>&nbsp;<span class="ident" id="6155078">p</span><span class="op" id="6155079">.</span><span class="ident" id="6155080">empty</span><span class="op" id="6155085">(</span><span class="op" id="6155086">)</span>&nbsp;<span class="op" id="6155088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155092">return</span>&nbsp;<span class="string" id="6155099">&#34;&#34;</span><span class="op" id="6155101">,</span>&nbsp;<span class="ident" id="6155103">errors</span><span class="op" id="6155109">.</span><span class="ident" id="6155110">New</span><span class="op" id="6155113">(</span><span class="string" id="6155114">&#34;mail:&nbsp;no&nbsp;addr-spec&#34;</span><span class="op" id="6155134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155140">if</span>&nbsp;<span class="ident" id="6155143">p</span><span class="op" id="6155144">.</span><span class="ident" id="6155145">peek</span><span class="op" id="6155149">(</span><span class="op" id="6155150">)</span>&nbsp;<span class="op" id="6155152">==</span>&nbsp;<span class="string" id="6155155">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="6155159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155163">//&nbsp;quoted-string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155182">debug</span><span class="op" id="6155187">.</span><span class="ident" id="6155188">Printf</span><span class="op" id="6155194">(</span><span class="string" id="6155195">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;quoted-string&#34;</span><span class="op" id="6155235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155239">localPart</span><span class="op" id="6155248">,</span>&nbsp;<span class="ident" id="6155250">err</span>&nbsp;<span class="op" id="6155254">=</span>&nbsp;<span class="ident" id="6155256">p</span><span class="op" id="6155257">.</span><span class="ident" id="6155258">consumeQuotedString</span><span class="op" id="6155277">(</span><span class="op" id="6155278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155281">}</span>&nbsp;<span class="keyword" id="6155283">else</span>&nbsp;<span class="op" id="6155288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155292">//&nbsp;dot-atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155306">debug</span><span class="op" id="6155311">.</span><span class="ident" id="6155312">Printf</span><span class="op" id="6155318">(</span><span class="string" id="6155319">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;dot-atom&#34;</span><span class="op" id="6155354">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155358">localPart</span><span class="op" id="6155367">,</span>&nbsp;<span class="ident" id="6155369">err</span>&nbsp;<span class="op" id="6155373">=</span>&nbsp;<span class="ident" id="6155375">p</span><span class="op" id="6155376">.</span><span class="ident" id="6155377">consumeAtom</span><span class="op" id="6155388">(</span><span class="builtintype" id="6155389">true</span><span class="op" id="6155393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155399">if</span>&nbsp;<span class="ident" id="6155402">err</span>&nbsp;<span class="op" id="6155406">!=</span>&nbsp;<span class="ident" id="6155409">nil</span>&nbsp;<span class="op" id="6155413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155417">debug</span><span class="op" id="6155422">.</span><span class="ident" id="6155423">Printf</span><span class="op" id="6155429">(</span><span class="string" id="6155430">&#34;consumeAddrSpec:&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6155459">,</span>&nbsp;<span class="ident" id="6155461">err</span><span class="op" id="6155464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155468">return</span>&nbsp;<span class="string" id="6155475">&#34;&#34;</span><span class="op" id="6155477">,</span>&nbsp;<span class="ident" id="6155479">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155488">if</span>&nbsp;<span class="op" id="6155491">!</span><span class="ident" id="6155492">p</span><span class="op" id="6155493">.</span><span class="ident" id="6155494">consume</span><span class="op" id="6155501">(</span><span class="string" id="6155502">&#39;@&#39;</span><span class="op" id="6155505">)</span>&nbsp;<span class="op" id="6155507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155511">return</span>&nbsp;<span class="string" id="6155518">&#34;&#34;</span><span class="op" id="6155520">,</span>&nbsp;<span class="ident" id="6155522">errors</span><span class="op" id="6155528">.</span><span class="ident" id="6155529">New</span><span class="op" id="6155532">(</span><span class="string" id="6155533">&#34;mail:&nbsp;missing&nbsp;@&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="6155563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155566">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155570">//&nbsp;domain&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155609">var</span>&nbsp;<span class="ident" id="6155613">domain</span>&nbsp;<span class="builtintype" id="6155620">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155628">p</span><span class="op" id="6155629">.</span><span class="ident" id="6155630">skipSpace</span><span class="op" id="6155639">(</span><span class="op" id="6155640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155643">if</span>&nbsp;<span class="ident" id="6155646">p</span><span class="op" id="6155647">.</span><span class="ident" id="6155648">empty</span><span class="op" id="6155653">(</span><span class="op" id="6155654">)</span>&nbsp;<span class="op" id="6155656">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155660">return</span>&nbsp;<span class="string" id="6155667">&#34;&#34;</span><span class="op" id="6155669">,</span>&nbsp;<span class="ident" id="6155671">errors</span><span class="op" id="6155677">.</span><span class="ident" id="6155678">New</span><span class="op" id="6155681">(</span><span class="string" id="6155682">&#34;mail:&nbsp;no&nbsp;domain&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="6155712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6155718">//&nbsp;TODO(dsymonds):&nbsp;Handle&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6155760">domain</span><span class="op" id="6155766">,</span>&nbsp;<span class="ident" id="6155768">err</span>&nbsp;<span class="op" id="6155772">=</span>&nbsp;<span class="ident" id="6155774">p</span><span class="op" id="6155775">.</span><span class="ident" id="6155776">consumeAtom</span><span class="op" id="6155787">(</span><span class="builtintype" id="6155788">true</span><span class="op" id="6155792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155795">if</span>&nbsp;<span class="ident" id="6155798">err</span>&nbsp;<span class="op" id="6155802">!=</span>&nbsp;<span class="ident" id="6155805">nil</span>&nbsp;<span class="op" id="6155809">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155813">return</span>&nbsp;<span class="string" id="6155820">&#34;&#34;</span><span class="op" id="6155822">,</span>&nbsp;<span class="ident" id="6155824">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6155829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6155833">return</span>&nbsp;<span class="ident" id="6155840">localPart</span>&nbsp;<span class="op" id="6155850">+</span>&nbsp;<span class="string" id="6155852">&#34;@&#34;</span>&nbsp;<span class="op" id="6155856">+</span>&nbsp;<span class="ident" id="6155858">domain</span><span class="op" id="6155864">,</span>&nbsp;<span class="ident" id="6155866">nil</span><br>
<span class="lineno"></span><span class="op" id="6155870">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="6155873">//&nbsp;consumePhrase&nbsp;parses&nbsp;the&nbsp;RFC&nbsp;5322&nbsp;phrase&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="6155936">func</span>&nbsp;<span class="op" id="6155941">(</span><span class="ident" id="6155942">p</span>&nbsp;<span class="op" id="6155944">*</span><span class="ident" id="6155945">addrParser</span><span class="op" id="6155955">)</span>&nbsp;<span class="ident" id="6155957">consumePhrase</span><span class="op" id="6155970">(</span><span class="op" id="6155971">)</span>&nbsp;<span class="op" id="6155973">(</span><span class="ident" id="6155974">phrase</span>&nbsp;<span class="builtintype" id="6155981">string</span><span class="op" id="6155987">,</span>&nbsp;<span class="ident" id="6155989">err</span>&nbsp;<span class="builtintype" id="6155993">error</span><span class="op" id="6155998">)</span>&nbsp;<span class="op" id="6156000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156003">debug</span><span class="op" id="6156008">.</span><span class="ident" id="6156009">Printf</span><span class="op" id="6156015">(</span><span class="string" id="6156016">&#34;consumePhrase:&nbsp;[%s]&#34;</span><span class="op" id="6156037">,</span>&nbsp;<span class="op" id="6156039">*</span><span class="ident" id="6156040">p</span><span class="op" id="6156041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156044">//&nbsp;phrase&nbsp;=&nbsp;1*word</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156064">var</span>&nbsp;<span class="ident" id="6156068">words</span>&nbsp;<span class="op" id="6156074">[</span><span class="op" id="6156075">]</span><span class="builtintype" id="6156076">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156084">for</span>&nbsp;<span class="op" id="6156088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156092">//&nbsp;word&nbsp;=&nbsp;atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156125">var</span>&nbsp;<span class="ident" id="6156129">word</span>&nbsp;<span class="builtintype" id="6156134">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156143">p</span><span class="op" id="6156144">.</span><span class="ident" id="6156145">skipSpace</span><span class="op" id="6156154">(</span><span class="op" id="6156155">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156159">if</span>&nbsp;<span class="ident" id="6156162">p</span><span class="op" id="6156163">.</span><span class="ident" id="6156164">empty</span><span class="op" id="6156169">(</span><span class="op" id="6156170">)</span>&nbsp;<span class="op" id="6156172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156177">return</span>&nbsp;<span class="string" id="6156184">&#34;&#34;</span><span class="op" id="6156186">,</span>&nbsp;<span class="ident" id="6156188">errors</span><span class="op" id="6156194">.</span><span class="ident" id="6156195">New</span><span class="op" id="6156198">(</span><span class="string" id="6156199">&#34;mail:&nbsp;missing&nbsp;phrase&#34;</span><span class="op" id="6156221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156229">if</span>&nbsp;<span class="ident" id="6156232">p</span><span class="op" id="6156233">.</span><span class="ident" id="6156234">peek</span><span class="op" id="6156238">(</span><span class="op" id="6156239">)</span>&nbsp;<span class="op" id="6156241">==</span>&nbsp;<span class="string" id="6156244">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="6156248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156253">//&nbsp;quoted-string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156273">word</span><span class="op" id="6156277">,</span>&nbsp;<span class="ident" id="6156279">err</span>&nbsp;<span class="op" id="6156283">=</span>&nbsp;<span class="ident" id="6156285">p</span><span class="op" id="6156286">.</span><span class="ident" id="6156287">consumeQuotedString</span><span class="op" id="6156306">(</span><span class="op" id="6156307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156311">}</span>&nbsp;<span class="keyword" id="6156313">else</span>&nbsp;<span class="op" id="6156318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156323">//&nbsp;atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156334">//&nbsp;We&nbsp;actually&nbsp;parse&nbsp;dot-atom&nbsp;here&nbsp;to&nbsp;be&nbsp;more&nbsp;permissive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156394">//&nbsp;than&nbsp;what&nbsp;RFC&nbsp;5322&nbsp;specifies.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156430">word</span><span class="op" id="6156434">,</span>&nbsp;<span class="ident" id="6156436">err</span>&nbsp;<span class="op" id="6156440">=</span>&nbsp;<span class="ident" id="6156442">p</span><span class="op" id="6156443">.</span><span class="ident" id="6156444">consumeAtom</span><span class="op" id="6156455">(</span><span class="builtintype" id="6156456">true</span><span class="op" id="6156460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156469">//&nbsp;RFC&nbsp;2047&nbsp;encoded-word&nbsp;starts&nbsp;with&nbsp;=?,&nbsp;ends&nbsp;with&nbsp;?=,&nbsp;and&nbsp;has&nbsp;two&nbsp;other&nbsp;?s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156548">if</span>&nbsp;<span class="ident" id="6156551">err</span>&nbsp;<span class="op" id="6156555">==</span>&nbsp;<span class="ident" id="6156558">nil</span>&nbsp;<span class="op" id="6156562">&amp;&amp;</span>&nbsp;<span class="ident" id="6156565">strings</span><span class="op" id="6156572">.</span><span class="ident" id="6156573">HasPrefix</span><span class="op" id="6156582">(</span><span class="ident" id="6156583">word</span><span class="op" id="6156587">,</span>&nbsp;<span class="string" id="6156589">&#34;=?&#34;</span><span class="op" id="6156593">)</span>&nbsp;<span class="op" id="6156595">&amp;&amp;</span>&nbsp;<span class="ident" id="6156598">strings</span><span class="op" id="6156605">.</span><span class="ident" id="6156606">HasSuffix</span><span class="op" id="6156615">(</span><span class="ident" id="6156616">word</span><span class="op" id="6156620">,</span>&nbsp;<span class="string" id="6156622">&#34;?=&#34;</span><span class="op" id="6156626">)</span>&nbsp;<span class="op" id="6156628">&amp;&amp;</span>&nbsp;<span class="ident" id="6156631">strings</span><span class="op" id="6156638">.</span><span class="ident" id="6156639">Count</span><span class="op" id="6156644">(</span><span class="ident" id="6156645">word</span><span class="op" id="6156649">,</span>&nbsp;<span class="string" id="6156651">&#34;?&#34;</span><span class="op" id="6156654">)</span>&nbsp;<span class="op" id="6156656">==</span>&nbsp;<span class="num" id="6156659">4</span>&nbsp;<span class="op" id="6156661">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156666">word</span><span class="op" id="6156670">,</span>&nbsp;<span class="ident" id="6156672">err</span>&nbsp;<span class="op" id="6156676">=</span>&nbsp;<span class="ident" id="6156678">decodeRFC2047Word</span><span class="op" id="6156695">(</span><span class="ident" id="6156696">word</span><span class="op" id="6156700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156709">if</span>&nbsp;<span class="ident" id="6156712">err</span>&nbsp;<span class="op" id="6156716">!=</span>&nbsp;<span class="ident" id="6156719">nil</span>&nbsp;<span class="op" id="6156723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156728">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156740">debug</span><span class="op" id="6156745">.</span><span class="ident" id="6156746">Printf</span><span class="op" id="6156752">(</span><span class="string" id="6156753">&#34;consumePhrase:&nbsp;consumed&nbsp;%q&#34;</span><span class="op" id="6156781">,</span>&nbsp;<span class="ident" id="6156783">word</span><span class="op" id="6156787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156791">words</span>&nbsp;<span class="op" id="6156797">=</span>&nbsp;<span class="builtinfunc" id="6156799">append</span><span class="op" id="6156805">(</span><span class="ident" id="6156806">words</span><span class="op" id="6156811">,</span>&nbsp;<span class="ident" id="6156813">word</span><span class="op" id="6156817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6156820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6156823">//&nbsp;Ignore&nbsp;any&nbsp;error&nbsp;if&nbsp;we&nbsp;got&nbsp;at&nbsp;least&nbsp;one&nbsp;word.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156873">if</span>&nbsp;<span class="ident" id="6156876">err</span>&nbsp;<span class="op" id="6156880">!=</span>&nbsp;<span class="ident" id="6156883">nil</span>&nbsp;<span class="op" id="6156887">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6156890">len</span><span class="op" id="6156893">(</span><span class="ident" id="6156894">words</span><span class="op" id="6156899">)</span>&nbsp;<span class="op" id="6156901">==</span>&nbsp;<span class="num" id="6156904">0</span>&nbsp;<span class="op" id="6156906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6156910">debug</span><span class="op" id="6156915">.</span><span class="ident" id="6156916">Printf</span><span class="op" id="6156922">(</span><span class="string" id="6156923">&#34;consumePhrase:&nbsp;hit&nbsp;err:&nbsp;%v&#34;</span><span class="op" id="6156951">,</span>&nbsp;<span class="ident" id="6156953">err</span><span class="op" id="6156956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6156960">return</span>&nbsp;<span class="string" id="6156967">&#34;&#34;</span><span class="op" id="6156969">,</span>&nbsp;<span class="ident" id="6156971">fmt</span><span class="op" id="6156974">.</span><span class="ident" id="6156975">Errorf</span><span class="op" id="6156981">(</span><span class="string" id="6156982">&#34;mail:&nbsp;missing&nbsp;word&nbsp;in&nbsp;phrase:&nbsp;%v&#34;</span><span class="op" id="6157016">,</span>&nbsp;<span class="ident" id="6157018">err</span><span class="op" id="6157021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157027">phrase</span>&nbsp;<span class="op" id="6157034">=</span>&nbsp;<span class="ident" id="6157036">strings</span><span class="op" id="6157043">.</span><span class="ident" id="6157044">Join</span><span class="op" id="6157048">(</span><span class="ident" id="6157049">words</span><span class="op" id="6157054">,</span>&nbsp;<span class="string" id="6157056">&#34;&nbsp;&#34;</span><span class="op" id="6157059">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157062">return</span>&nbsp;<span class="ident" id="6157069">phrase</span><span class="op" id="6157075">,</span>&nbsp;<span class="ident" id="6157077">nil</span><br>
<span class="lineno"></span><span class="op" id="6157081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6157084">//&nbsp;consumeQuotedString&nbsp;parses&nbsp;the&nbsp;quoted&nbsp;string&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="6157151">func</span>&nbsp;<span class="op" id="6157156">(</span><span class="ident" id="6157157">p</span>&nbsp;<span class="op" id="6157159">*</span><span class="ident" id="6157160">addrParser</span><span class="op" id="6157170">)</span>&nbsp;<span class="ident" id="6157172">consumeQuotedString</span><span class="op" id="6157191">(</span><span class="op" id="6157192">)</span>&nbsp;<span class="op" id="6157194">(</span><span class="ident" id="6157195">qs</span>&nbsp;<span class="builtintype" id="6157198">string</span><span class="op" id="6157204">,</span>&nbsp;<span class="ident" id="6157206">err</span>&nbsp;<span class="builtintype" id="6157210">error</span><span class="op" id="6157215">)</span>&nbsp;<span class="op" id="6157217">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157220">//&nbsp;Assume&nbsp;first&nbsp;byte&nbsp;is&nbsp;&#39;&#34;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157250">i</span>&nbsp;<span class="op" id="6157252">:=</span>&nbsp;<span class="num" id="6157255">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157258">qsb</span>&nbsp;<span class="op" id="6157262">:=</span>&nbsp;<span class="builtinfunc" id="6157265">make</span><span class="op" id="6157269">(</span><span class="op" id="6157270">[</span><span class="op" id="6157271">]</span><span class="builtintype" id="6157272">byte</span><span class="op" id="6157276">,</span>&nbsp;<span class="num" id="6157278">0</span><span class="op" id="6157279">,</span>&nbsp;<span class="num" id="6157281">10</span><span class="op" id="6157283">)</span><br>
<span class="lineno"></span><span class="ident" id="6157285">Loop</span><span class="op" id="6157289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157292">for</span>&nbsp;<span class="op" id="6157296">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157300">if</span>&nbsp;<span class="ident" id="6157303">i</span>&nbsp;<span class="op" id="6157305">&gt;=</span>&nbsp;<span class="ident" id="6157308">p</span><span class="op" id="6157309">.</span><span class="builtinfunc" id="6157310">len</span><span class="op" id="6157313">(</span><span class="op" id="6157314">)</span>&nbsp;<span class="op" id="6157316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157321">return</span>&nbsp;<span class="string" id="6157328">&#34;&#34;</span><span class="op" id="6157330">,</span>&nbsp;<span class="ident" id="6157332">errors</span><span class="op" id="6157338">.</span><span class="ident" id="6157339">New</span><span class="op" id="6157342">(</span><span class="string" id="6157343">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="6157373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157381">switch</span>&nbsp;<span class="ident" id="6157388">c</span>&nbsp;<span class="op" id="6157390">:=</span>&nbsp;<span class="op" id="6157393">(</span><span class="op" id="6157394">*</span><span class="ident" id="6157395">p</span><span class="op" id="6157396">)</span><span class="op" id="6157397">[</span><span class="ident" id="6157398">i</span><span class="op" id="6157399">]</span><span class="op" id="6157400">;</span>&nbsp;<span class="op" id="6157402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157406">case</span>&nbsp;<span class="ident" id="6157411">c</span>&nbsp;<span class="op" id="6157413">==</span>&nbsp;<span class="string" id="6157416">&#39;&#34;&#39;</span><span class="op" id="6157419">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157424">break</span>&nbsp;<span class="ident" id="6157430">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157437">case</span>&nbsp;<span class="ident" id="6157442">c</span>&nbsp;<span class="op" id="6157444">==</span>&nbsp;<span class="string" id="6157447">&#39;\\&#39;</span><span class="op" id="6157451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157456">if</span>&nbsp;<span class="ident" id="6157459">i</span><span class="op" id="6157460">+</span><span class="num" id="6157461">1</span>&nbsp;<span class="op" id="6157463">==</span>&nbsp;<span class="ident" id="6157466">p</span><span class="op" id="6157467">.</span><span class="builtinfunc" id="6157468">len</span><span class="op" id="6157471">(</span><span class="op" id="6157472">)</span>&nbsp;<span class="op" id="6157474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157480">return</span>&nbsp;<span class="string" id="6157487">&#34;&#34;</span><span class="op" id="6157489">,</span>&nbsp;<span class="ident" id="6157491">errors</span><span class="op" id="6157497">.</span><span class="ident" id="6157498">New</span><span class="op" id="6157501">(</span><span class="string" id="6157502">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="6157532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157537">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157542">qsb</span>&nbsp;<span class="op" id="6157546">=</span>&nbsp;<span class="builtinfunc" id="6157548">append</span><span class="op" id="6157554">(</span><span class="ident" id="6157555">qsb</span><span class="op" id="6157558">,</span>&nbsp;<span class="op" id="6157560">(</span><span class="op" id="6157561">*</span><span class="ident" id="6157562">p</span><span class="op" id="6157563">)</span><span class="op" id="6157564">[</span><span class="ident" id="6157565">i</span><span class="op" id="6157566">+</span><span class="num" id="6157567">1</span><span class="op" id="6157568">]</span><span class="op" id="6157569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157574">i</span>&nbsp;<span class="op" id="6157576">+=</span>&nbsp;<span class="num" id="6157579">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157583">case</span>&nbsp;<span class="ident" id="6157588">isQtext</span><span class="op" id="6157595">(</span><span class="ident" id="6157596">c</span><span class="op" id="6157597">)</span><span class="op" id="6157598">,</span>&nbsp;<span class="ident" id="6157600">c</span>&nbsp;<span class="op" id="6157602">==</span>&nbsp;<span class="string" id="6157605">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6157609">||</span>&nbsp;<span class="ident" id="6157612">c</span>&nbsp;<span class="op" id="6157614">==</span>&nbsp;<span class="string" id="6157617">&#39;\t&#39;</span><span class="op" id="6157621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157626">//&nbsp;qtext&nbsp;(printable&nbsp;US-ASCII&nbsp;excluding&nbsp;&#34;&nbsp;and&nbsp;\),&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6157681">//&nbsp;FWS&nbsp;(almost;&nbsp;we&#39;re&nbsp;ignoring&nbsp;CRLF)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157721">qsb</span>&nbsp;<span class="op" id="6157725">=</span>&nbsp;<span class="builtinfunc" id="6157727">append</span><span class="op" id="6157733">(</span><span class="ident" id="6157734">qsb</span><span class="op" id="6157737">,</span>&nbsp;<span class="ident" id="6157739">c</span><span class="op" id="6157740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6157745">i</span><span class="op" id="6157746">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157751">default</span><span class="op" id="6157758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157763">return</span>&nbsp;<span class="string" id="6157770">&#34;&#34;</span><span class="op" id="6157772">,</span>&nbsp;<span class="ident" id="6157774">fmt</span><span class="op" id="6157777">.</span><span class="ident" id="6157778">Errorf</span><span class="op" id="6157784">(</span><span class="string" id="6157785">&#34;mail:&nbsp;bad&nbsp;character&nbsp;in&nbsp;quoted-string:&nbsp;%q&#34;</span><span class="op" id="6157827">,</span>&nbsp;<span class="ident" id="6157829">c</span><span class="op" id="6157830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157834">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6157840">*</span><span class="ident" id="6157841">p</span>&nbsp;<span class="op" id="6157843">=</span>&nbsp;<span class="op" id="6157845">(</span><span class="op" id="6157846">*</span><span class="ident" id="6157847">p</span><span class="op" id="6157848">)</span><span class="op" id="6157849">[</span><span class="ident" id="6157850">i</span><span class="op" id="6157851">+</span><span class="num" id="6157852">1</span><span class="op" id="6157853">:</span><span class="op" id="6157854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6157857">return</span>&nbsp;<span class="builtintype" id="6157864">string</span><span class="op" id="6157870">(</span><span class="ident" id="6157871">qsb</span><span class="op" id="6157874">)</span><span class="op" id="6157875">,</span>&nbsp;<span class="ident" id="6157877">nil</span><br>
<span class="lineno"></span><span class="op" id="6157881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6157884">//&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atom&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="6157942">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;dot-atom&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="6158010">func</span>&nbsp;<span class="op" id="6158015">(</span><span class="ident" id="6158016">p</span>&nbsp;<span class="op" id="6158018">*</span><span class="ident" id="6158019">addrParser</span><span class="op" id="6158029">)</span>&nbsp;<span class="ident" id="6158031">consumeAtom</span><span class="op" id="6158042">(</span><span class="ident" id="6158043">dot</span>&nbsp;<span class="builtintype" id="6158047">bool</span><span class="op" id="6158051">)</span>&nbsp;<span class="op" id="6158053">(</span><span class="ident" id="6158054">atom</span>&nbsp;<span class="builtintype" id="6158059">string</span><span class="op" id="6158065">,</span>&nbsp;<span class="ident" id="6158067">err</span>&nbsp;<span class="builtintype" id="6158071">error</span><span class="op" id="6158076">)</span>&nbsp;<span class="op" id="6158078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158081">if</span>&nbsp;<span class="op" id="6158084">!</span><span class="ident" id="6158085">isAtext</span><span class="op" id="6158092">(</span><span class="ident" id="6158093">p</span><span class="op" id="6158094">.</span><span class="ident" id="6158095">peek</span><span class="op" id="6158099">(</span><span class="op" id="6158100">)</span><span class="op" id="6158101">,</span>&nbsp;<span class="builtintype" id="6158103">false</span><span class="op" id="6158108">)</span>&nbsp;<span class="op" id="6158110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158114">return</span>&nbsp;<span class="string" id="6158121">&#34;&#34;</span><span class="op" id="6158123">,</span>&nbsp;<span class="ident" id="6158125">errors</span><span class="op" id="6158131">.</span><span class="ident" id="6158132">New</span><span class="op" id="6158135">(</span><span class="string" id="6158136">&#34;mail:&nbsp;invalid&nbsp;string&#34;</span><span class="op" id="6158158">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158164">i</span>&nbsp;<span class="op" id="6158166">:=</span>&nbsp;<span class="num" id="6158169">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158172">for</span>&nbsp;<span class="op" id="6158176">;</span>&nbsp;<span class="ident" id="6158178">i</span>&nbsp;<span class="op" id="6158180">&lt;</span>&nbsp;<span class="ident" id="6158182">p</span><span class="op" id="6158183">.</span><span class="builtinfunc" id="6158184">len</span><span class="op" id="6158187">(</span><span class="op" id="6158188">)</span>&nbsp;<span class="op" id="6158190">&amp;&amp;</span>&nbsp;<span class="ident" id="6158193">isAtext</span><span class="op" id="6158200">(</span><span class="op" id="6158201">(</span><span class="op" id="6158202">*</span><span class="ident" id="6158203">p</span><span class="op" id="6158204">)</span><span class="op" id="6158205">[</span><span class="ident" id="6158206">i</span><span class="op" id="6158207">]</span><span class="op" id="6158208">,</span>&nbsp;<span class="ident" id="6158210">dot</span><span class="op" id="6158213">)</span><span class="op" id="6158214">;</span>&nbsp;<span class="ident" id="6158216">i</span><span class="op" id="6158217">++</span>&nbsp;<span class="op" id="6158220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158226">atom</span><span class="op" id="6158230">,</span>&nbsp;<span class="op" id="6158232">*</span><span class="ident" id="6158233">p</span>&nbsp;<span class="op" id="6158235">=</span>&nbsp;<span class="builtintype" id="6158237">string</span><span class="op" id="6158243">(</span><span class="op" id="6158244">(</span><span class="op" id="6158245">*</span><span class="ident" id="6158246">p</span><span class="op" id="6158247">)</span><span class="op" id="6158248">[</span><span class="op" id="6158249">:</span><span class="ident" id="6158250">i</span><span class="op" id="6158251">]</span><span class="op" id="6158252">)</span><span class="op" id="6158253">,</span>&nbsp;<span class="op" id="6158255">(</span><span class="op" id="6158256">*</span><span class="ident" id="6158257">p</span><span class="op" id="6158258">)</span><span class="op" id="6158259">[</span><span class="ident" id="6158260">i</span><span class="op" id="6158261">:</span><span class="op" id="6158262">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158265">return</span>&nbsp;<span class="ident" id="6158272">atom</span><span class="op" id="6158276">,</span>&nbsp;<span class="ident" id="6158278">nil</span><br>
<span class="lineno"></span><span class="op" id="6158282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158285">func</span>&nbsp;<span class="op" id="6158290">(</span><span class="ident" id="6158291">p</span>&nbsp;<span class="op" id="6158293">*</span><span class="ident" id="6158294">addrParser</span><span class="op" id="6158304">)</span>&nbsp;<span class="ident" id="6158306">consume</span><span class="op" id="6158313">(</span><span class="ident" id="6158314">c</span>&nbsp;<span class="builtintype" id="6158316">byte</span><span class="op" id="6158320">)</span>&nbsp;<span class="builtintype" id="6158322">bool</span>&nbsp;<span class="op" id="6158327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158330">if</span>&nbsp;<span class="ident" id="6158333">p</span><span class="op" id="6158334">.</span><span class="ident" id="6158335">empty</span><span class="op" id="6158340">(</span><span class="op" id="6158341">)</span>&nbsp;<span class="op" id="6158343">||</span>&nbsp;<span class="ident" id="6158346">p</span><span class="op" id="6158347">.</span><span class="ident" id="6158348">peek</span><span class="op" id="6158352">(</span><span class="op" id="6158353">)</span>&nbsp;<span class="op" id="6158355">!=</span>&nbsp;<span class="ident" id="6158358">c</span>&nbsp;<span class="op" id="6158360">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158364">return</span>&nbsp;<span class="builtintype" id="6158371">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158381">*</span><span class="ident" id="6158382">p</span>&nbsp;<span class="op" id="6158384">=</span>&nbsp;<span class="op" id="6158386">(</span><span class="op" id="6158387">*</span><span class="ident" id="6158388">p</span><span class="op" id="6158389">)</span><span class="op" id="6158390">[</span><span class="num" id="6158391">1</span><span class="op" id="6158392">:</span><span class="op" id="6158393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158396">return</span>&nbsp;<span class="builtintype" id="6158403">true</span><br>
<span class="lineno"></span><span class="op" id="6158408">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="6158411">//&nbsp;skipSpace&nbsp;skips&nbsp;the&nbsp;leading&nbsp;space&nbsp;and&nbsp;tab&nbsp;characters.</span><br>
<span class="lineno"></span><span class="keyword" id="6158468">func</span>&nbsp;<span class="op" id="6158473">(</span><span class="ident" id="6158474">p</span>&nbsp;<span class="op" id="6158476">*</span><span class="ident" id="6158477">addrParser</span><span class="op" id="6158487">)</span>&nbsp;<span class="ident" id="6158489">skipSpace</span><span class="op" id="6158498">(</span><span class="op" id="6158499">)</span>&nbsp;<span class="op" id="6158501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158504">*</span><span class="ident" id="6158505">p</span>&nbsp;<span class="op" id="6158507">=</span>&nbsp;<span class="ident" id="6158509">bytes</span><span class="op" id="6158514">.</span><span class="ident" id="6158515">TrimLeft</span><span class="op" id="6158523">(</span><span class="op" id="6158524">*</span><span class="ident" id="6158525">p</span><span class="op" id="6158526">,</span>&nbsp;<span class="string" id="6158528">&#34;&nbsp;\t&#34;</span><span class="op" id="6158533">)</span><br>
<span class="lineno"></span><span class="op" id="6158535">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="6158538">func</span>&nbsp;<span class="op" id="6158543">(</span><span class="ident" id="6158544">p</span>&nbsp;<span class="op" id="6158546">*</span><span class="ident" id="6158547">addrParser</span><span class="op" id="6158557">)</span>&nbsp;<span class="ident" id="6158559">peek</span><span class="op" id="6158563">(</span><span class="op" id="6158564">)</span>&nbsp;<span class="builtintype" id="6158566">byte</span>&nbsp;<span class="op" id="6158571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158574">return</span>&nbsp;<span class="op" id="6158581">(</span><span class="op" id="6158582">*</span><span class="ident" id="6158583">p</span><span class="op" id="6158584">)</span><span class="op" id="6158585">[</span><span class="num" id="6158586">0</span><span class="op" id="6158587">]</span><br>
<span class="lineno"></span><span class="op" id="6158589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6158592">func</span>&nbsp;<span class="op" id="6158597">(</span><span class="ident" id="6158598">p</span>&nbsp;<span class="op" id="6158600">*</span><span class="ident" id="6158601">addrParser</span><span class="op" id="6158611">)</span>&nbsp;<span class="ident" id="6158613">empty</span><span class="op" id="6158618">(</span><span class="op" id="6158619">)</span>&nbsp;<span class="builtintype" id="6158621">bool</span>&nbsp;<span class="op" id="6158626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158629">return</span>&nbsp;<span class="ident" id="6158636">p</span><span class="op" id="6158637">.</span><span class="builtinfunc" id="6158638">len</span><span class="op" id="6158641">(</span><span class="op" id="6158642">)</span>&nbsp;<span class="op" id="6158644">==</span>&nbsp;<span class="num" id="6158647">0</span><br>
<span class="lineno"></span><span class="op" id="6158649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158652">func</span>&nbsp;<span class="op" id="6158657">(</span><span class="ident" id="6158658">p</span>&nbsp;<span class="op" id="6158660">*</span><span class="ident" id="6158661">addrParser</span><span class="op" id="6158671">)</span>&nbsp;<span class="builtinfunc" id="6158673">len</span><span class="op" id="6158676">(</span><span class="op" id="6158677">)</span>&nbsp;<span class="builtintype" id="6158679">int</span>&nbsp;<span class="op" id="6158683">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158686">return</span>&nbsp;<span class="builtinfunc" id="6158693">len</span><span class="op" id="6158696">(</span><span class="op" id="6158697">*</span><span class="ident" id="6158698">p</span><span class="op" id="6158699">)</span><br>
<span class="lineno"></span><span class="op" id="6158701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6158704">func</span>&nbsp;<span class="ident" id="6158709">decodeRFC2047Word</span><span class="op" id="6158726">(</span><span class="ident" id="6158727">s</span>&nbsp;<span class="builtintype" id="6158729">string</span><span class="op" id="6158735">)</span>&nbsp;<span class="op" id="6158737">(</span><span class="builtintype" id="6158738">string</span><span class="op" id="6158744">,</span>&nbsp;<span class="builtintype" id="6158746">error</span><span class="op" id="6158751">)</span>&nbsp;<span class="op" id="6158753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158756">fields</span>&nbsp;<span class="op" id="6158763">:=</span>&nbsp;<span class="ident" id="6158766">strings</span><span class="op" id="6158773">.</span><span class="ident" id="6158774">Split</span><span class="op" id="6158779">(</span><span class="ident" id="6158780">s</span><span class="op" id="6158781">,</span>&nbsp;<span class="string" id="6158783">&#34;?&#34;</span><span class="op" id="6158786">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158789">if</span>&nbsp;<span class="builtinfunc" id="6158792">len</span><span class="op" id="6158795">(</span><span class="ident" id="6158796">fields</span><span class="op" id="6158802">)</span>&nbsp;<span class="op" id="6158804">!=</span>&nbsp;<span class="num" id="6158807">5</span>&nbsp;<span class="op" id="6158809">||</span>&nbsp;<span class="ident" id="6158812">fields</span><span class="op" id="6158818">[</span><span class="num" id="6158819">0</span><span class="op" id="6158820">]</span>&nbsp;<span class="op" id="6158822">!=</span>&nbsp;<span class="string" id="6158825">&#34;=&#34;</span>&nbsp;<span class="op" id="6158829">||</span>&nbsp;<span class="ident" id="6158832">fields</span><span class="op" id="6158838">[</span><span class="num" id="6158839">4</span><span class="op" id="6158840">]</span>&nbsp;<span class="op" id="6158842">!=</span>&nbsp;<span class="string" id="6158845">&#34;=&#34;</span>&nbsp;<span class="op" id="6158849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158853">return</span>&nbsp;<span class="string" id="6158860">&#34;&#34;</span><span class="op" id="6158862">,</span>&nbsp;<span class="ident" id="6158864">errors</span><span class="op" id="6158870">.</span><span class="ident" id="6158871">New</span><span class="op" id="6158874">(</span><span class="string" id="6158875">&#34;address&nbsp;not&nbsp;RFC&nbsp;2047&nbsp;encoded&#34;</span><span class="op" id="6158905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6158908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6158911">charset</span><span class="op" id="6158918">,</span>&nbsp;<span class="ident" id="6158920">enc</span>&nbsp;<span class="op" id="6158924">:=</span>&nbsp;<span class="ident" id="6158927">strings</span><span class="op" id="6158934">.</span><span class="ident" id="6158935">ToLower</span><span class="op" id="6158942">(</span><span class="ident" id="6158943">fields</span><span class="op" id="6158949">[</span><span class="num" id="6158950">1</span><span class="op" id="6158951">]</span><span class="op" id="6158952">)</span><span class="op" id="6158953">,</span>&nbsp;<span class="ident" id="6158955">strings</span><span class="op" id="6158962">.</span><span class="ident" id="6158963">ToLower</span><span class="op" id="6158970">(</span><span class="ident" id="6158971">fields</span><span class="op" id="6158977">[</span><span class="num" id="6158978">2</span><span class="op" id="6158979">]</span><span class="op" id="6158980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6158983">if</span>&nbsp;<span class="ident" id="6158986">charset</span>&nbsp;<span class="op" id="6158994">!=</span>&nbsp;<span class="string" id="6158997">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="6159008">&amp;&amp;</span>&nbsp;<span class="ident" id="6159011">charset</span>&nbsp;<span class="op" id="6159019">!=</span>&nbsp;<span class="string" id="6159022">&#34;iso-8859-1&#34;</span>&nbsp;<span class="op" id="6159035">&amp;&amp;</span>&nbsp;<span class="ident" id="6159038">charset</span>&nbsp;<span class="op" id="6159046">!=</span>&nbsp;<span class="string" id="6159049">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="6159057">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159061">return</span>&nbsp;<span class="string" id="6159068">&#34;&#34;</span><span class="op" id="6159070">,</span>&nbsp;<span class="ident" id="6159072">fmt</span><span class="op" id="6159075">.</span><span class="ident" id="6159076">Errorf</span><span class="op" id="6159082">(</span><span class="string" id="6159083">&#34;charset&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="6159110">,</span>&nbsp;<span class="ident" id="6159112">charset</span><span class="op" id="6159119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159126">in</span>&nbsp;<span class="op" id="6159129">:=</span>&nbsp;<span class="ident" id="6159132">bytes</span><span class="op" id="6159137">.</span><span class="ident" id="6159138">NewBufferString</span><span class="op" id="6159153">(</span><span class="ident" id="6159154">fields</span><span class="op" id="6159160">[</span><span class="num" id="6159161">3</span><span class="op" id="6159162">]</span><span class="op" id="6159163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159166">var</span>&nbsp;<span class="ident" id="6159170">r</span>&nbsp;<span class="ident" id="6159172">io</span><span class="op" id="6159174">.</span><span class="ident" id="6159175">Reader</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159183">switch</span>&nbsp;<span class="ident" id="6159190">enc</span>&nbsp;<span class="op" id="6159194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159197">case</span>&nbsp;<span class="string" id="6159202">&#34;b&#34;</span><span class="op" id="6159205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159209">r</span>&nbsp;<span class="op" id="6159211">=</span>&nbsp;<span class="ident" id="6159213">base64</span><span class="op" id="6159219">.</span><span class="ident" id="6159220">NewDecoder</span><span class="op" id="6159230">(</span><span class="ident" id="6159231">base64</span><span class="op" id="6159237">.</span><span class="ident" id="6159238">StdEncoding</span><span class="op" id="6159249">,</span>&nbsp;<span class="ident" id="6159251">in</span><span class="op" id="6159253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159256">case</span>&nbsp;<span class="string" id="6159261">&#34;q&#34;</span><span class="op" id="6159264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159268">r</span>&nbsp;<span class="op" id="6159270">=</span>&nbsp;<span class="ident" id="6159272">qDecoder</span><span class="op" id="6159280">{</span><span class="ident" id="6159281">r</span><span class="op" id="6159282">:</span>&nbsp;<span class="ident" id="6159284">in</span><span class="op" id="6159286">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159289">default</span><span class="op" id="6159296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159300">return</span>&nbsp;<span class="string" id="6159307">&#34;&#34;</span><span class="op" id="6159309">,</span>&nbsp;<span class="ident" id="6159311">fmt</span><span class="op" id="6159314">.</span><span class="ident" id="6159315">Errorf</span><span class="op" id="6159321">(</span><span class="string" id="6159322">&#34;RFC&nbsp;2047&nbsp;encoding&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="6159359">,</span>&nbsp;<span class="ident" id="6159361">enc</span><span class="op" id="6159364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159371">dec</span><span class="op" id="6159374">,</span>&nbsp;<span class="ident" id="6159376">err</span>&nbsp;<span class="op" id="6159380">:=</span>&nbsp;<span class="ident" id="6159383">ioutil</span><span class="op" id="6159389">.</span><span class="ident" id="6159390">ReadAll</span><span class="op" id="6159397">(</span><span class="ident" id="6159398">r</span><span class="op" id="6159399">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159402">if</span>&nbsp;<span class="ident" id="6159405">err</span>&nbsp;<span class="op" id="6159409">!=</span>&nbsp;<span class="ident" id="6159412">nil</span>&nbsp;<span class="op" id="6159416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159420">return</span>&nbsp;<span class="string" id="6159427">&#34;&#34;</span><span class="op" id="6159429">,</span>&nbsp;<span class="ident" id="6159431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159440">switch</span>&nbsp;<span class="ident" id="6159447">charset</span>&nbsp;<span class="op" id="6159455">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159458">case</span>&nbsp;<span class="string" id="6159463">&#34;us-ascii&#34;</span><span class="op" id="6159473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159477">b</span>&nbsp;<span class="op" id="6159479">:=</span>&nbsp;<span class="builtinfunc" id="6159482">new</span><span class="op" id="6159485">(</span><span class="ident" id="6159486">bytes</span><span class="op" id="6159491">.</span><span class="ident" id="6159492">Buffer</span><span class="op" id="6159498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159502">for</span>&nbsp;<span class="ident" id="6159506">_</span><span class="op" id="6159507">,</span>&nbsp;<span class="ident" id="6159509">c</span>&nbsp;<span class="op" id="6159511">:=</span>&nbsp;<span class="keyword" id="6159514">range</span>&nbsp;<span class="ident" id="6159520">dec</span>&nbsp;<span class="op" id="6159524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159529">if</span>&nbsp;<span class="ident" id="6159532">c</span>&nbsp;<span class="op" id="6159534">&gt;=</span>&nbsp;<span class="num" id="6159537">0x80</span>&nbsp;<span class="op" id="6159542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159548">b</span><span class="op" id="6159549">.</span><span class="ident" id="6159550">WriteRune</span><span class="op" id="6159559">(</span><span class="ident" id="6159560">unicode</span><span class="op" id="6159567">.</span><span class="ident" id="6159568">ReplacementChar</span><span class="op" id="6159583">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159588">}</span>&nbsp;<span class="keyword" id="6159590">else</span>&nbsp;<span class="op" id="6159595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159601">b</span><span class="op" id="6159602">.</span><span class="ident" id="6159603">WriteRune</span><span class="op" id="6159612">(</span><span class="builtintype" id="6159613">rune</span><span class="op" id="6159617">(</span><span class="ident" id="6159618">c</span><span class="op" id="6159619">)</span><span class="op" id="6159620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159633">return</span>&nbsp;<span class="ident" id="6159640">b</span><span class="op" id="6159641">.</span><span class="ident" id="6159642">String</span><span class="op" id="6159648">(</span><span class="op" id="6159649">)</span><span class="op" id="6159650">,</span>&nbsp;<span class="ident" id="6159652">nil</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159657">case</span>&nbsp;<span class="string" id="6159662">&#34;iso-8859-1&#34;</span><span class="op" id="6159674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159678">b</span>&nbsp;<span class="op" id="6159680">:=</span>&nbsp;<span class="builtinfunc" id="6159683">new</span><span class="op" id="6159686">(</span><span class="ident" id="6159687">bytes</span><span class="op" id="6159692">.</span><span class="ident" id="6159693">Buffer</span><span class="op" id="6159699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159703">for</span>&nbsp;<span class="ident" id="6159707">_</span><span class="op" id="6159708">,</span>&nbsp;<span class="ident" id="6159710">c</span>&nbsp;<span class="op" id="6159712">:=</span>&nbsp;<span class="keyword" id="6159715">range</span>&nbsp;<span class="ident" id="6159721">dec</span>&nbsp;<span class="op" id="6159725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159730">b</span><span class="op" id="6159731">.</span><span class="ident" id="6159732">WriteRune</span><span class="op" id="6159741">(</span><span class="builtintype" id="6159742">rune</span><span class="op" id="6159746">(</span><span class="ident" id="6159747">c</span><span class="op" id="6159748">)</span><span class="op" id="6159749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159753">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159757">return</span>&nbsp;<span class="ident" id="6159764">b</span><span class="op" id="6159765">.</span><span class="ident" id="6159766">String</span><span class="op" id="6159772">(</span><span class="op" id="6159773">)</span><span class="op" id="6159774">,</span>&nbsp;<span class="ident" id="6159776">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159781">case</span>&nbsp;<span class="string" id="6159786">&#34;utf-8&#34;</span><span class="op" id="6159793">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6159797">return</span>&nbsp;<span class="builtintype" id="6159804">string</span><span class="op" id="6159810">(</span><span class="ident" id="6159811">dec</span><span class="op" id="6159814">)</span><span class="op" id="6159815">,</span>&nbsp;<span class="ident" id="6159817">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6159822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6159825">panic</span><span class="op" id="6159830">(</span><span class="string" id="6159831">&#34;unreachable&#34;</span><span class="op" id="6159844">)</span><br>
<span class="lineno">490</span><span class="op" id="6159846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6159849">type</span>&nbsp;<span class="ident" id="6159854">qDecoder</span>&nbsp;<span class="keyword" id="6159863">struct</span>&nbsp;<span class="op" id="6159870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159873">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6159881">io</span><span class="op" id="6159883">.</span><span class="ident" id="6159884">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6159892">scratch</span>&nbsp;<span class="op" id="6159900">[</span><span class="num" id="6159901">2</span><span class="op" id="6159902">]</span><span class="builtintype" id="6159903">byte</span><br>
<span class="lineno">495</span><span class="op" id="6159908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6159911">func</span>&nbsp;<span class="op" id="6159916">(</span><span class="ident" id="6159917">qd</span>&nbsp;<span class="ident" id="6159920">qDecoder</span><span class="op" id="6159928">)</span>&nbsp;<span class="ident" id="6159930">Read</span><span class="op" id="6159934">(</span><span class="ident" id="6159935">p</span>&nbsp;<span class="op" id="6159937">[</span><span class="op" id="6159938">]</span><span class="builtintype" id="6159939">byte</span><span class="op" id="6159943">)</span>&nbsp;<span class="op" id="6159945">(</span><span class="ident" id="6159946">n</span>&nbsp;<span class="builtintype" id="6159948">int</span><span class="op" id="6159951">,</span>&nbsp;<span class="ident" id="6159953">err</span>&nbsp;<span class="builtintype" id="6159957">error</span><span class="op" id="6159962">)</span>&nbsp;<span class="op" id="6159964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6159967">//&nbsp;This&nbsp;method&nbsp;writes&nbsp;at&nbsp;most&nbsp;one&nbsp;byte&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160015">if</span>&nbsp;<span class="builtinfunc" id="6160018">len</span><span class="op" id="6160021">(</span><span class="ident" id="6160022">p</span><span class="op" id="6160023">)</span>&nbsp;<span class="op" id="6160025">==</span>&nbsp;<span class="num" id="6160028">0</span>&nbsp;<span class="op" id="6160030">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160034">return</span>&nbsp;<span class="num" id="6160041">0</span><span class="op" id="6160042">,</span>&nbsp;<span class="ident" id="6160044">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160052">if</span>&nbsp;<span class="ident" id="6160055">_</span><span class="op" id="6160056">,</span>&nbsp;<span class="ident" id="6160058">err</span>&nbsp;<span class="op" id="6160062">:=</span>&nbsp;<span class="ident" id="6160065">qd</span><span class="op" id="6160067">.</span><span class="ident" id="6160068">r</span><span class="op" id="6160069">.</span><span class="ident" id="6160070">Read</span><span class="op" id="6160074">(</span><span class="ident" id="6160075">qd</span><span class="op" id="6160077">.</span><span class="ident" id="6160078">scratch</span><span class="op" id="6160085">[</span><span class="op" id="6160086">:</span><span class="num" id="6160087">1</span><span class="op" id="6160088">]</span><span class="op" id="6160089">)</span><span class="op" id="6160090">;</span>&nbsp;<span class="ident" id="6160092">err</span>&nbsp;<span class="op" id="6160096">!=</span>&nbsp;<span class="ident" id="6160099">nil</span>&nbsp;<span class="op" id="6160103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160107">return</span>&nbsp;<span class="num" id="6160114">0</span><span class="op" id="6160115">,</span>&nbsp;<span class="ident" id="6160117">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160122">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160125">switch</span>&nbsp;<span class="ident" id="6160132">c</span>&nbsp;<span class="op" id="6160134">:=</span>&nbsp;<span class="ident" id="6160137">qd</span><span class="op" id="6160139">.</span><span class="ident" id="6160140">scratch</span><span class="op" id="6160147">[</span><span class="num" id="6160148">0</span><span class="op" id="6160149">]</span><span class="op" id="6160150">;</span>&nbsp;<span class="op" id="6160152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160155">case</span>&nbsp;<span class="ident" id="6160160">c</span>&nbsp;<span class="op" id="6160162">==</span>&nbsp;<span class="string" id="6160165">&#39;=&#39;</span><span class="op" id="6160168">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160172">if</span>&nbsp;<span class="ident" id="6160175">_</span><span class="op" id="6160176">,</span>&nbsp;<span class="ident" id="6160178">err</span>&nbsp;<span class="op" id="6160182">:=</span>&nbsp;<span class="ident" id="6160185">io</span><span class="op" id="6160187">.</span><span class="ident" id="6160188">ReadFull</span><span class="op" id="6160196">(</span><span class="ident" id="6160197">qd</span><span class="op" id="6160199">.</span><span class="ident" id="6160200">r</span><span class="op" id="6160201">,</span>&nbsp;<span class="ident" id="6160203">qd</span><span class="op" id="6160205">.</span><span class="ident" id="6160206">scratch</span><span class="op" id="6160213">[</span><span class="op" id="6160214">:</span><span class="num" id="6160215">2</span><span class="op" id="6160216">]</span><span class="op" id="6160217">)</span><span class="op" id="6160218">;</span>&nbsp;<span class="ident" id="6160220">err</span>&nbsp;<span class="op" id="6160224">!=</span>&nbsp;<span class="ident" id="6160227">nil</span>&nbsp;<span class="op" id="6160231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160236">return</span>&nbsp;<span class="num" id="6160243">0</span><span class="op" id="6160244">,</span>&nbsp;<span class="ident" id="6160246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160252">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6160256">x</span><span class="op" id="6160257">,</span>&nbsp;<span class="ident" id="6160259">err</span>&nbsp;<span class="op" id="6160263">:=</span>&nbsp;<span class="ident" id="6160266">strconv</span><span class="op" id="6160273">.</span><span class="ident" id="6160274">ParseInt</span><span class="op" id="6160282">(</span><span class="builtintype" id="6160283">string</span><span class="op" id="6160289">(</span><span class="ident" id="6160290">qd</span><span class="op" id="6160292">.</span><span class="ident" id="6160293">scratch</span><span class="op" id="6160300">[</span><span class="op" id="6160301">:</span><span class="num" id="6160302">2</span><span class="op" id="6160303">]</span><span class="op" id="6160304">)</span><span class="op" id="6160305">,</span>&nbsp;<span class="num" id="6160307">16</span><span class="op" id="6160309">,</span>&nbsp;<span class="num" id="6160311">64</span><span class="op" id="6160313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160317">if</span>&nbsp;<span class="ident" id="6160320">err</span>&nbsp;<span class="op" id="6160324">!=</span>&nbsp;<span class="ident" id="6160327">nil</span>&nbsp;<span class="op" id="6160331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160336">return</span>&nbsp;<span class="num" id="6160343">0</span><span class="op" id="6160344">,</span>&nbsp;<span class="ident" id="6160346">fmt</span><span class="op" id="6160349">.</span><span class="ident" id="6160350">Errorf</span><span class="op" id="6160356">(</span><span class="string" id="6160357">&#34;mail:&nbsp;invalid&nbsp;RFC&nbsp;2047&nbsp;encoding:&nbsp;%q&#34;</span><span class="op" id="6160394">,</span>&nbsp;<span class="ident" id="6160396">qd</span><span class="op" id="6160398">.</span><span class="ident" id="6160399">scratch</span><span class="op" id="6160406">[</span><span class="op" id="6160407">:</span><span class="num" id="6160408">2</span><span class="op" id="6160409">]</span><span class="op" id="6160410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6160418">p</span><span class="op" id="6160419">[</span><span class="num" id="6160420">0</span><span class="op" id="6160421">]</span>&nbsp;<span class="op" id="6160423">=</span>&nbsp;<span class="builtintype" id="6160425">byte</span><span class="op" id="6160429">(</span><span class="ident" id="6160430">x</span><span class="op" id="6160431">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160434">case</span>&nbsp;<span class="ident" id="6160439">c</span>&nbsp;<span class="op" id="6160441">==</span>&nbsp;<span class="string" id="6160444">&#39;_&#39;</span><span class="op" id="6160447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6160451">p</span><span class="op" id="6160452">[</span><span class="num" id="6160453">0</span><span class="op" id="6160454">]</span>&nbsp;<span class="op" id="6160456">=</span>&nbsp;<span class="string" id="6160458">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160463">default</span><span class="op" id="6160470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6160474">p</span><span class="op" id="6160475">[</span><span class="num" id="6160476">0</span><span class="op" id="6160477">]</span>&nbsp;<span class="op" id="6160479">=</span>&nbsp;<span class="ident" id="6160481">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160484">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160487">return</span>&nbsp;<span class="num" id="6160494">1</span><span class="op" id="6160495">,</span>&nbsp;<span class="ident" id="6160497">nil</span><br>
<span class="lineno"></span><span class="op" id="6160501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6160504">var</span>&nbsp;<span class="ident" id="6160508">atextChars</span>&nbsp;<span class="op" id="6160519">=</span>&nbsp;<span class="op" id="6160521">[</span><span class="op" id="6160522">]</span><span class="builtintype" id="6160523">byte</span><span class="op" id="6160527">(</span><span class="string" id="6160528">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>&nbsp;<span class="op" id="6160557">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6160560">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span>&nbsp;<span class="op" id="6160589">+</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6160592">&#34;0123456789&#34;</span>&nbsp;<span class="op" id="6160605">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6160608">&#34;!#$%&amp;&#39;*+-/=?^_`{|}~&#34;</span><span class="op" id="6160629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160632">//&nbsp;isAtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atext&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="6160693">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;period&nbsp;is&nbsp;included.</span><br>
<span class="lineno">530</span><span class="keyword" id="6160732">func</span>&nbsp;<span class="ident" id="6160737">isAtext</span><span class="op" id="6160744">(</span><span class="ident" id="6160745">c</span>&nbsp;<span class="builtintype" id="6160747">byte</span><span class="op" id="6160751">,</span>&nbsp;<span class="ident" id="6160753">dot</span>&nbsp;<span class="builtintype" id="6160757">bool</span><span class="op" id="6160761">)</span>&nbsp;<span class="builtintype" id="6160763">bool</span>&nbsp;<span class="op" id="6160768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160771">if</span>&nbsp;<span class="ident" id="6160774">dot</span>&nbsp;<span class="op" id="6160778">&amp;&amp;</span>&nbsp;<span class="ident" id="6160781">c</span>&nbsp;<span class="op" id="6160783">==</span>&nbsp;<span class="string" id="6160786">&#39;.&#39;</span>&nbsp;<span class="op" id="6160790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160794">return</span>&nbsp;<span class="builtintype" id="6160801">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6160807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6160810">return</span>&nbsp;<span class="ident" id="6160817">bytes</span><span class="op" id="6160822">.</span><span class="ident" id="6160823">IndexByte</span><span class="op" id="6160832">(</span><span class="ident" id="6160833">atextChars</span><span class="op" id="6160843">,</span>&nbsp;<span class="ident" id="6160845">c</span><span class="op" id="6160846">)</span>&nbsp;<span class="op" id="6160848">&gt;=</span>&nbsp;<span class="num" id="6160851">0</span><br>
<span class="lineno">535</span><span class="op" id="6160853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6160856">//&nbsp;isQtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;qtext&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="6160917">func</span>&nbsp;<span class="ident" id="6160922">isQtext</span><span class="op" id="6160929">(</span><span class="ident" id="6160930">c</span>&nbsp;<span class="builtintype" id="6160932">byte</span><span class="op" id="6160936">)</span>&nbsp;<span class="builtintype" id="6160938">bool</span>&nbsp;<span class="op" id="6160943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6160946">//&nbsp;Printable&nbsp;US-ASCII,&nbsp;excluding&nbsp;backslash&nbsp;or&nbsp;quote.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161000">if</span>&nbsp;<span class="ident" id="6161003">c</span>&nbsp;<span class="op" id="6161005">==</span>&nbsp;<span class="string" id="6161008">&#39;\\&#39;</span>&nbsp;<span class="op" id="6161013">||</span>&nbsp;<span class="ident" id="6161016">c</span>&nbsp;<span class="op" id="6161018">==</span>&nbsp;<span class="string" id="6161021">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="6161025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161029">return</span>&nbsp;<span class="builtintype" id="6161036">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6161043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161046">return</span>&nbsp;<span class="string" id="6161053">&#39;!&#39;</span>&nbsp;<span class="op" id="6161057">&lt;=</span>&nbsp;<span class="ident" id="6161060">c</span>&nbsp;<span class="op" id="6161062">&amp;&amp;</span>&nbsp;<span class="ident" id="6161065">c</span>&nbsp;<span class="op" id="6161067">&lt;=</span>&nbsp;<span class="string" id="6161070">&#39;~&#39;</span><br>
<span class="lineno"></span><span class="op" id="6161074">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6161077">//&nbsp;isVchar&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;VCHAR&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="6161138">func</span>&nbsp;<span class="ident" id="6161143">isVchar</span><span class="op" id="6161150">(</span><span class="ident" id="6161151">c</span>&nbsp;<span class="builtintype" id="6161153">byte</span><span class="op" id="6161157">)</span>&nbsp;<span class="builtintype" id="6161159">bool</span>&nbsp;<span class="op" id="6161164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6161167">//&nbsp;Visible&nbsp;(printing)&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161202">return</span>&nbsp;<span class="string" id="6161209">&#39;!&#39;</span>&nbsp;<span class="op" id="6161213">&lt;=</span>&nbsp;<span class="ident" id="6161216">c</span>&nbsp;<span class="op" id="6161218">&amp;&amp;</span>&nbsp;<span class="ident" id="6161221">c</span>&nbsp;<span class="op" id="6161223">&lt;=</span>&nbsp;<span class="string" id="6161226">&#39;~&#39;</span><br>
<span class="lineno">550</span><span class="op" id="6161230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6161233">//&nbsp;isWSP&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;WSP&nbsp;(white&nbsp;space).</span><br>
<span class="lineno"></span><span class="comment" id="6161284">//&nbsp;WSP&nbsp;is&nbsp;a&nbsp;space&nbsp;or&nbsp;horizontal&nbsp;tab&nbsp;(RFC5234&nbsp;Appendix&nbsp;B).</span><br>
<span class="lineno"></span><span class="keyword" id="6161342">func</span>&nbsp;<span class="ident" id="6161347">isWSP</span><span class="op" id="6161352">(</span><span class="ident" id="6161353">c</span>&nbsp;<span class="builtintype" id="6161355">byte</span><span class="op" id="6161359">)</span>&nbsp;<span class="builtintype" id="6161361">bool</span>&nbsp;<span class="op" id="6161366">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6161369">return</span>&nbsp;<span class="ident" id="6161376">c</span>&nbsp;<span class="op" id="6161378">==</span>&nbsp;<span class="string" id="6161381">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6161385">||</span>&nbsp;<span class="ident" id="6161388">c</span>&nbsp;<span class="op" id="6161390">==</span>&nbsp;<span class="string" id="6161393">&#39;\t&#39;</span><br>
<span class="lineno"></span><span class="op" id="6161398">}</span>
</div>
</body>
</html>
