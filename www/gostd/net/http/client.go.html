<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3787709">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3787764">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3787818">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3787869">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3787899">//</span><br>
<span class="lineno"></span><span class="comment" id="3787902">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3787946">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3787999">package</span>&nbsp;<span class="ident" id="3788007">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788013">import</span>&nbsp;<span class="op" id="3788020">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788023">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788042">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788052">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788059">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788065">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788078">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788085">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788096">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788107">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788115">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3788122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3788125">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3788192">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="3788237">//</span><br>
<span class="lineno"></span><span class="comment" id="3788240">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3788307">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="3788374">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="3788445">//</span><br>
<span class="lineno"></span><span class="comment" id="3788448">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3788516">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3788577">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="3788591">type</span>&nbsp;<span class="ident" id="3788596">Client</span>&nbsp;<span class="keyword" id="3788603">struct</span>&nbsp;<span class="op" id="3788610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788613">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788671">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788699">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788737">Transport</span>&nbsp;<span class="ident" id="3788747">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788762">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788825">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788885">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788947">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789010">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789073">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789123">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789185">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789214">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789218">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789283">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789335">CheckRedirect</span>&nbsp;<span class="keyword" id="3789349">func</span><span class="op" id="3789353">(</span><span class="ident" id="3789354">req</span>&nbsp;<span class="op" id="3789358">*</span><span class="ident" id="3789359">Request</span><span class="op" id="3789366">,</span>&nbsp;<span class="ident" id="3789368">via</span>&nbsp;<span class="op" id="3789372">[</span><span class="op" id="3789373">]</span><span class="op" id="3789374">*</span><span class="ident" id="3789375">Request</span><span class="op" id="3789382">)</span>&nbsp;<span class="builtintype" id="3789384">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789392">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789426">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789490">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789508">Jar</span>&nbsp;<span class="ident" id="3789512">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789524">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789585">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789639">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789703">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789760">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789804">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789808">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789848">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789852">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789910">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789974">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790034">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790091">Timeout</span>&nbsp;<span class="ident" id="3790099">time</span><span class="op" id="3790103">.</span><span class="ident" id="3790104">Duration</span><br>
<span class="lineno"></span><span class="op" id="3790113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3790116">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="3790191">var</span>&nbsp;<span class="ident" id="3790195">DefaultClient</span>&nbsp;<span class="op" id="3790209">=</span>&nbsp;<span class="op" id="3790211">&amp;</span><span class="ident" id="3790212">Client</span><span class="op" id="3790218">{</span><span class="op" id="3790219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3790222">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3790292">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="3790364">//</span><br>
<span class="lineno">80</span><span class="comment" id="3790367">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="3790429">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3790444">type</span>&nbsp;<span class="ident" id="3790449">RoundTripper</span>&nbsp;<span class="keyword" id="3790462">interface</span>&nbsp;<span class="op" id="3790472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790475">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790535">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790595">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790650">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790714">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790776">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790837">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790891">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790944">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790976">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790980">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791036">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791097">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791154">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791171">RoundTrip</span><span class="op" id="3791180">(</span><span class="op" id="3791181">*</span><span class="ident" id="3791182">Request</span><span class="op" id="3791189">)</span>&nbsp;<span class="op" id="3791191">(</span><span class="op" id="3791192">*</span><span class="ident" id="3791193">Response</span><span class="op" id="3791201">,</span>&nbsp;<span class="builtintype" id="3791203">error</span><span class="op" id="3791208">)</span><br>
<span class="lineno"></span><span class="op" id="3791210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3791213">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3791291">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3791337">func</span>&nbsp;<span class="ident" id="3791342">hasPort</span><span class="op" id="3791349">(</span><span class="ident" id="3791350">s</span>&nbsp;<span class="builtintype" id="3791352">string</span><span class="op" id="3791358">)</span>&nbsp;<span class="builtintype" id="3791360">bool</span>&nbsp;<span class="op" id="3791365">{</span>&nbsp;<span class="keyword" id="3791367">return</span>&nbsp;<span class="ident" id="3791374">strings</span><span class="op" id="3791381">.</span><span class="ident" id="3791382">LastIndex</span><span class="op" id="3791391">(</span><span class="ident" id="3791392">s</span><span class="op" id="3791393">,</span>&nbsp;<span class="string" id="3791395">&#34;:&#34;</span><span class="op" id="3791398">)</span>&nbsp;<span class="op" id="3791400">&gt;</span>&nbsp;<span class="ident" id="3791402">strings</span><span class="op" id="3791409">.</span><span class="ident" id="3791410">LastIndex</span><span class="op" id="3791419">(</span><span class="ident" id="3791420">s</span><span class="op" id="3791421">,</span>&nbsp;<span class="string" id="3791423">&#34;]&#34;</span><span class="op" id="3791426">)</span>&nbsp;<span class="op" id="3791428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3791431">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="3791501">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="3791574">func</span>&nbsp;<span class="ident" id="3791579">refererForURL</span><span class="op" id="3791592">(</span><span class="ident" id="3791593">lastReq</span><span class="op" id="3791600">,</span>&nbsp;<span class="ident" id="3791602">newReq</span>&nbsp;<span class="op" id="3791609">*</span><span class="ident" id="3791610">url</span><span class="op" id="3791613">.</span><span class="ident" id="3791614">URL</span><span class="op" id="3791617">)</span>&nbsp;<span class="builtintype" id="3791619">string</span>&nbsp;<span class="op" id="3791626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791629">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791683">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791745">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791804">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791848">if</span>&nbsp;<span class="ident" id="3791851">lastReq</span><span class="op" id="3791858">.</span><span class="ident" id="3791859">Scheme</span>&nbsp;<span class="op" id="3791866">==</span>&nbsp;<span class="string" id="3791869">&#34;https&#34;</span>&nbsp;<span class="op" id="3791877">&amp;&amp;</span>&nbsp;<span class="ident" id="3791880">newReq</span><span class="op" id="3791886">.</span><span class="ident" id="3791887">Scheme</span>&nbsp;<span class="op" id="3791894">==</span>&nbsp;<span class="string" id="3791897">&#34;http&#34;</span>&nbsp;<span class="op" id="3791904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791908">return</span>&nbsp;<span class="string" id="3791915">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791922">referer</span>&nbsp;<span class="op" id="3791930">:=</span>&nbsp;<span class="ident" id="3791933">lastReq</span><span class="op" id="3791940">.</span><span class="ident" id="3791941">String</span><span class="op" id="3791947">(</span><span class="op" id="3791948">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791951">if</span>&nbsp;<span class="ident" id="3791954">lastReq</span><span class="op" id="3791961">.</span><span class="ident" id="3791962">User</span>&nbsp;<span class="op" id="3791967">!=</span>&nbsp;<span class="ident" id="3791970">nil</span>&nbsp;<span class="op" id="3791974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791978">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792034">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792051">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792090">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792123">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792181">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792223">auth</span>&nbsp;<span class="op" id="3792228">:=</span>&nbsp;<span class="ident" id="3792231">lastReq</span><span class="op" id="3792238">.</span><span class="ident" id="3792239">User</span><span class="op" id="3792243">.</span><span class="ident" id="3792244">String</span><span class="op" id="3792250">(</span><span class="op" id="3792251">)</span>&nbsp;<span class="op" id="3792253">+</span>&nbsp;<span class="string" id="3792255">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792261">referer</span>&nbsp;<span class="op" id="3792269">=</span>&nbsp;<span class="ident" id="3792271">strings</span><span class="op" id="3792278">.</span><span class="ident" id="3792279">Replace</span><span class="op" id="3792286">(</span><span class="ident" id="3792287">referer</span><span class="op" id="3792294">,</span>&nbsp;<span class="ident" id="3792296">auth</span><span class="op" id="3792300">,</span>&nbsp;<span class="string" id="3792302">&#34;&#34;</span><span class="op" id="3792304">,</span>&nbsp;<span class="num" id="3792306">1</span><span class="op" id="3792307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792310">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792313">return</span>&nbsp;<span class="ident" id="3792320">referer</span><br>
<span class="lineno"></span><span class="op" id="3792328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3792331">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3792399">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="3792470">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3792493">type</span>&nbsp;<span class="ident" id="3792498">readClose</span>&nbsp;<span class="keyword" id="3792508">struct</span>&nbsp;<span class="op" id="3792515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792518">io</span><span class="op" id="3792520">.</span><span class="ident" id="3792521">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792529">io</span><span class="op" id="3792531">.</span><span class="ident" id="3792532">Closer</span><br>
<span class="lineno"></span><span class="op" id="3792539">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="3792542">func</span>&nbsp;<span class="op" id="3792547">(</span><span class="ident" id="3792548">c</span>&nbsp;<span class="op" id="3792550">*</span><span class="ident" id="3792551">Client</span><span class="op" id="3792557">)</span>&nbsp;<span class="ident" id="3792559">send</span><span class="op" id="3792563">(</span><span class="ident" id="3792564">req</span>&nbsp;<span class="op" id="3792568">*</span><span class="ident" id="3792569">Request</span><span class="op" id="3792576">)</span>&nbsp;<span class="op" id="3792578">(</span><span class="op" id="3792579">*</span><span class="ident" id="3792580">Response</span><span class="op" id="3792588">,</span>&nbsp;<span class="builtintype" id="3792590">error</span><span class="op" id="3792595">)</span>&nbsp;<span class="op" id="3792597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792600">if</span>&nbsp;<span class="ident" id="3792603">c</span><span class="op" id="3792604">.</span><span class="ident" id="3792605">Jar</span>&nbsp;<span class="op" id="3792609">!=</span>&nbsp;<span class="ident" id="3792612">nil</span>&nbsp;<span class="op" id="3792616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792620">for</span>&nbsp;<span class="ident" id="3792624">_</span><span class="op" id="3792625">,</span>&nbsp;<span class="ident" id="3792627">cookie</span>&nbsp;<span class="op" id="3792634">:=</span>&nbsp;<span class="keyword" id="3792637">range</span>&nbsp;<span class="ident" id="3792643">c</span><span class="op" id="3792644">.</span><span class="ident" id="3792645">Jar</span><span class="op" id="3792648">.</span><span class="ident" id="3792649">Cookies</span><span class="op" id="3792656">(</span><span class="ident" id="3792657">req</span><span class="op" id="3792660">.</span><span class="ident" id="3792661">URL</span><span class="op" id="3792664">)</span>&nbsp;<span class="op" id="3792666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792671">req</span><span class="op" id="3792674">.</span><span class="ident" id="3792675">AddCookie</span><span class="op" id="3792684">(</span><span class="ident" id="3792685">cookie</span><span class="op" id="3792691">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792701">resp</span><span class="op" id="3792705">,</span>&nbsp;<span class="ident" id="3792707">err</span>&nbsp;<span class="op" id="3792711">:=</span>&nbsp;<span class="ident" id="3792714">send</span><span class="op" id="3792718">(</span><span class="ident" id="3792719">req</span><span class="op" id="3792722">,</span>&nbsp;<span class="ident" id="3792724">c</span><span class="op" id="3792725">.</span><span class="ident" id="3792726">transport</span><span class="op" id="3792735">(</span><span class="op" id="3792736">)</span><span class="op" id="3792737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792740">if</span>&nbsp;<span class="ident" id="3792743">err</span>&nbsp;<span class="op" id="3792747">!=</span>&nbsp;<span class="ident" id="3792750">nil</span>&nbsp;<span class="op" id="3792754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792758">return</span>&nbsp;<span class="ident" id="3792765">nil</span><span class="op" id="3792768">,</span>&nbsp;<span class="ident" id="3792770">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792778">if</span>&nbsp;<span class="ident" id="3792781">c</span><span class="op" id="3792782">.</span><span class="ident" id="3792783">Jar</span>&nbsp;<span class="op" id="3792787">!=</span>&nbsp;<span class="ident" id="3792790">nil</span>&nbsp;<span class="op" id="3792794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792798">if</span>&nbsp;<span class="ident" id="3792801">rc</span>&nbsp;<span class="op" id="3792804">:=</span>&nbsp;<span class="ident" id="3792807">resp</span><span class="op" id="3792811">.</span><span class="ident" id="3792812">Cookies</span><span class="op" id="3792819">(</span><span class="op" id="3792820">)</span><span class="op" id="3792821">;</span>&nbsp;<span class="builtinfunc" id="3792823">len</span><span class="op" id="3792826">(</span><span class="ident" id="3792827">rc</span><span class="op" id="3792829">)</span>&nbsp;<span class="op" id="3792831">&gt;</span>&nbsp;<span class="num" id="3792833">0</span>&nbsp;<span class="op" id="3792835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792840">c</span><span class="op" id="3792841">.</span><span class="ident" id="3792842">Jar</span><span class="op" id="3792845">.</span><span class="ident" id="3792846">SetCookies</span><span class="op" id="3792856">(</span><span class="ident" id="3792857">req</span><span class="op" id="3792860">.</span><span class="ident" id="3792861">URL</span><span class="op" id="3792864">,</span>&nbsp;<span class="ident" id="3792866">rc</span><span class="op" id="3792868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792872">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792878">return</span>&nbsp;<span class="ident" id="3792885">resp</span><span class="op" id="3792889">,</span>&nbsp;<span class="ident" id="3792891">err</span><br>
<span class="lineno"></span><span class="op" id="3792895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3792898">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="3792966">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3793037">//</span><br>
<span class="lineno"></span><span class="comment" id="3793040">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3793100">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3793159">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="3793205">//</span><br>
<span class="lineno"></span><span class="comment" id="3793208">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3793270">//</span><br>
<span class="lineno"></span><span class="comment" id="3793273">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3793337">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="3793402">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="3793470">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3793537">//</span><br>
<span class="lineno"></span><span class="comment" id="3793540">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3793606">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="3793636">//</span><br>
<span class="lineno"></span><span class="comment" id="3793639">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="3793703">func</span>&nbsp;<span class="op" id="3793708">(</span><span class="ident" id="3793709">c</span>&nbsp;<span class="op" id="3793711">*</span><span class="ident" id="3793712">Client</span><span class="op" id="3793718">)</span>&nbsp;<span class="ident" id="3793720">Do</span><span class="op" id="3793722">(</span><span class="ident" id="3793723">req</span>&nbsp;<span class="op" id="3793727">*</span><span class="ident" id="3793728">Request</span><span class="op" id="3793735">)</span>&nbsp;<span class="op" id="3793737">(</span><span class="ident" id="3793738">resp</span>&nbsp;<span class="op" id="3793743">*</span><span class="ident" id="3793744">Response</span><span class="op" id="3793752">,</span>&nbsp;<span class="ident" id="3793754">err</span>&nbsp;<span class="builtintype" id="3793758">error</span><span class="op" id="3793763">)</span>&nbsp;<span class="op" id="3793765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793768">if</span>&nbsp;<span class="ident" id="3793771">req</span><span class="op" id="3793774">.</span><span class="ident" id="3793775">Method</span>&nbsp;<span class="op" id="3793782">==</span>&nbsp;<span class="string" id="3793785">&#34;GET&#34;</span>&nbsp;<span class="op" id="3793791">||</span>&nbsp;<span class="ident" id="3793794">req</span><span class="op" id="3793797">.</span><span class="ident" id="3793798">Method</span>&nbsp;<span class="op" id="3793805">==</span>&nbsp;<span class="string" id="3793808">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3793815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793819">return</span>&nbsp;<span class="ident" id="3793826">c</span><span class="op" id="3793827">.</span><span class="ident" id="3793828">doFollowingRedirects</span><span class="op" id="3793848">(</span><span class="ident" id="3793849">req</span><span class="op" id="3793852">,</span>&nbsp;<span class="ident" id="3793854">shouldRedirectGet</span><span class="op" id="3793871">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793877">if</span>&nbsp;<span class="ident" id="3793880">req</span><span class="op" id="3793883">.</span><span class="ident" id="3793884">Method</span>&nbsp;<span class="op" id="3793891">==</span>&nbsp;<span class="string" id="3793894">&#34;POST&#34;</span>&nbsp;<span class="op" id="3793901">||</span>&nbsp;<span class="ident" id="3793904">req</span><span class="op" id="3793907">.</span><span class="ident" id="3793908">Method</span>&nbsp;<span class="op" id="3793915">==</span>&nbsp;<span class="string" id="3793918">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3793924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793928">return</span>&nbsp;<span class="ident" id="3793935">c</span><span class="op" id="3793936">.</span><span class="ident" id="3793937">doFollowingRedirects</span><span class="op" id="3793957">(</span><span class="ident" id="3793958">req</span><span class="op" id="3793961">,</span>&nbsp;<span class="ident" id="3793963">shouldRedirectPost</span><span class="op" id="3793981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793987">return</span>&nbsp;<span class="ident" id="3793994">c</span><span class="op" id="3793995">.</span><span class="ident" id="3793996">send</span><span class="op" id="3794000">(</span><span class="ident" id="3794001">req</span><span class="op" id="3794004">)</span><br>
<span class="lineno">180</span><span class="op" id="3794006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3794009">func</span>&nbsp;<span class="op" id="3794014">(</span><span class="ident" id="3794015">c</span>&nbsp;<span class="op" id="3794017">*</span><span class="ident" id="3794018">Client</span><span class="op" id="3794024">)</span>&nbsp;<span class="ident" id="3794026">transport</span><span class="op" id="3794035">(</span><span class="op" id="3794036">)</span>&nbsp;<span class="ident" id="3794038">RoundTripper</span>&nbsp;<span class="op" id="3794051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794054">if</span>&nbsp;<span class="ident" id="3794057">c</span><span class="op" id="3794058">.</span><span class="ident" id="3794059">Transport</span>&nbsp;<span class="op" id="3794069">!=</span>&nbsp;<span class="ident" id="3794072">nil</span>&nbsp;<span class="op" id="3794076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794080">return</span>&nbsp;<span class="ident" id="3794087">c</span><span class="op" id="3794088">.</span><span class="ident" id="3794089">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794103">return</span>&nbsp;<span class="ident" id="3794110">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="3794127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3794130">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="3794162">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3794222">func</span>&nbsp;<span class="ident" id="3794227">send</span><span class="op" id="3794231">(</span><span class="ident" id="3794232">req</span>&nbsp;<span class="op" id="3794236">*</span><span class="ident" id="3794237">Request</span><span class="op" id="3794244">,</span>&nbsp;<span class="ident" id="3794246">t</span>&nbsp;<span class="ident" id="3794248">RoundTripper</span><span class="op" id="3794260">)</span>&nbsp;<span class="op" id="3794262">(</span><span class="ident" id="3794263">resp</span>&nbsp;<span class="op" id="3794268">*</span><span class="ident" id="3794269">Response</span><span class="op" id="3794277">,</span>&nbsp;<span class="ident" id="3794279">err</span>&nbsp;<span class="builtintype" id="3794283">error</span><span class="op" id="3794288">)</span>&nbsp;<span class="op" id="3794290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794293">if</span>&nbsp;<span class="ident" id="3794296">t</span>&nbsp;<span class="op" id="3794298">==</span>&nbsp;<span class="ident" id="3794301">nil</span>&nbsp;<span class="op" id="3794305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794309">req</span><span class="op" id="3794312">.</span><span class="ident" id="3794313">closeBody</span><span class="op" id="3794322">(</span><span class="op" id="3794323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794327">return</span>&nbsp;<span class="ident" id="3794334">nil</span><span class="op" id="3794337">,</span>&nbsp;<span class="ident" id="3794339">errors</span><span class="op" id="3794345">.</span><span class="ident" id="3794346">New</span><span class="op" id="3794349">(</span><span class="string" id="3794350">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="3794397">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794404">if</span>&nbsp;<span class="ident" id="3794407">req</span><span class="op" id="3794410">.</span><span class="ident" id="3794411">URL</span>&nbsp;<span class="op" id="3794415">==</span>&nbsp;<span class="ident" id="3794418">nil</span>&nbsp;<span class="op" id="3794422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794426">req</span><span class="op" id="3794429">.</span><span class="ident" id="3794430">closeBody</span><span class="op" id="3794439">(</span><span class="op" id="3794440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794444">return</span>&nbsp;<span class="ident" id="3794451">nil</span><span class="op" id="3794454">,</span>&nbsp;<span class="ident" id="3794456">errors</span><span class="op" id="3794462">.</span><span class="ident" id="3794463">New</span><span class="op" id="3794466">(</span><span class="string" id="3794467">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3794490">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794497">if</span>&nbsp;<span class="ident" id="3794500">req</span><span class="op" id="3794503">.</span><span class="ident" id="3794504">RequestURI</span>&nbsp;<span class="op" id="3794515">!=</span>&nbsp;<span class="string" id="3794518">&#34;&#34;</span>&nbsp;<span class="op" id="3794521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794525">req</span><span class="op" id="3794528">.</span><span class="ident" id="3794529">closeBody</span><span class="op" id="3794538">(</span><span class="op" id="3794539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794543">return</span>&nbsp;<span class="ident" id="3794550">nil</span><span class="op" id="3794553">,</span>&nbsp;<span class="ident" id="3794555">errors</span><span class="op" id="3794561">.</span><span class="ident" id="3794562">New</span><span class="op" id="3794565">(</span><span class="string" id="3794566">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="3794625">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794632">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794691">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3794751">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794805">if</span>&nbsp;<span class="ident" id="3794808">req</span><span class="op" id="3794811">.</span><span class="ident" id="3794812">Header</span>&nbsp;<span class="op" id="3794819">==</span>&nbsp;<span class="ident" id="3794822">nil</span>&nbsp;<span class="op" id="3794826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794830">req</span><span class="op" id="3794833">.</span><span class="ident" id="3794834">Header</span>&nbsp;<span class="op" id="3794841">=</span>&nbsp;<span class="builtinfunc" id="3794843">make</span><span class="op" id="3794847">(</span><span class="ident" id="3794848">Header</span><span class="op" id="3794854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794861">if</span>&nbsp;<span class="ident" id="3794864">u</span>&nbsp;<span class="op" id="3794866">:=</span>&nbsp;<span class="ident" id="3794869">req</span><span class="op" id="3794872">.</span><span class="ident" id="3794873">URL</span><span class="op" id="3794876">.</span><span class="ident" id="3794877">User</span><span class="op" id="3794881">;</span>&nbsp;<span class="ident" id="3794883">u</span>&nbsp;<span class="op" id="3794885">!=</span>&nbsp;<span class="ident" id="3794888">nil</span>&nbsp;<span class="op" id="3794892">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794896">username</span>&nbsp;<span class="op" id="3794905">:=</span>&nbsp;<span class="ident" id="3794908">u</span><span class="op" id="3794909">.</span><span class="ident" id="3794910">Username</span><span class="op" id="3794918">(</span><span class="op" id="3794919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794923">password</span><span class="op" id="3794931">,</span>&nbsp;<span class="ident" id="3794933">_</span>&nbsp;<span class="op" id="3794935">:=</span>&nbsp;<span class="ident" id="3794938">u</span><span class="op" id="3794939">.</span><span class="ident" id="3794940">Password</span><span class="op" id="3794948">(</span><span class="op" id="3794949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794953">req</span><span class="op" id="3794956">.</span><span class="ident" id="3794957">Header</span><span class="op" id="3794963">.</span><span class="ident" id="3794964">Set</span><span class="op" id="3794967">(</span><span class="string" id="3794968">&#34;Authorization&#34;</span><span class="op" id="3794983">,</span>&nbsp;<span class="string" id="3794985">&#34;Basic&nbsp;&#34;</span><span class="op" id="3794993">+</span><span class="ident" id="3794994">basicAuth</span><span class="op" id="3795003">(</span><span class="ident" id="3795004">username</span><span class="op" id="3795012">,</span>&nbsp;<span class="ident" id="3795014">password</span><span class="op" id="3795022">)</span><span class="op" id="3795023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795029">resp</span><span class="op" id="3795033">,</span>&nbsp;<span class="ident" id="3795035">err</span>&nbsp;<span class="op" id="3795039">=</span>&nbsp;<span class="ident" id="3795041">t</span><span class="op" id="3795042">.</span><span class="ident" id="3795043">RoundTrip</span><span class="op" id="3795052">(</span><span class="ident" id="3795053">req</span><span class="op" id="3795056">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795059">if</span>&nbsp;<span class="ident" id="3795062">err</span>&nbsp;<span class="op" id="3795066">!=</span>&nbsp;<span class="ident" id="3795069">nil</span>&nbsp;<span class="op" id="3795073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795077">if</span>&nbsp;<span class="ident" id="3795080">resp</span>&nbsp;<span class="op" id="3795085">!=</span>&nbsp;<span class="ident" id="3795088">nil</span>&nbsp;<span class="op" id="3795092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795097">log</span><span class="op" id="3795100">.</span><span class="ident" id="3795101">Printf</span><span class="op" id="3795107">(</span><span class="string" id="3795108">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="3795169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795177">return</span>&nbsp;<span class="ident" id="3795184">nil</span><span class="op" id="3795187">,</span>&nbsp;<span class="ident" id="3795189">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795197">return</span>&nbsp;<span class="ident" id="3795204">resp</span><span class="op" id="3795208">,</span>&nbsp;<span class="ident" id="3795210">nil</span><br>
<span class="lineno"></span><span class="op" id="3795214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3795217">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="3795278">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="3795350">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="3795414">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3795453">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="3795490">func</span>&nbsp;<span class="ident" id="3795495">basicAuth</span><span class="op" id="3795504">(</span><span class="ident" id="3795505">username</span><span class="op" id="3795513">,</span>&nbsp;<span class="ident" id="3795515">password</span>&nbsp;<span class="builtintype" id="3795524">string</span><span class="op" id="3795530">)</span>&nbsp;<span class="builtintype" id="3795532">string</span>&nbsp;<span class="op" id="3795539">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795542">auth</span>&nbsp;<span class="op" id="3795547">:=</span>&nbsp;<span class="ident" id="3795550">username</span>&nbsp;<span class="op" id="3795559">+</span>&nbsp;<span class="string" id="3795561">&#34;:&#34;</span>&nbsp;<span class="op" id="3795565">+</span>&nbsp;<span class="ident" id="3795567">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795577">return</span>&nbsp;<span class="ident" id="3795584">base64</span><span class="op" id="3795590">.</span><span class="ident" id="3795591">StdEncoding</span><span class="op" id="3795602">.</span><span class="ident" id="3795603">EncodeToString</span><span class="op" id="3795617">(</span><span class="op" id="3795618">[</span><span class="op" id="3795619">]</span><span class="builtintype" id="3795620">byte</span><span class="op" id="3795624">(</span><span class="ident" id="3795625">auth</span><span class="op" id="3795629">)</span><span class="op" id="3795630">)</span><br>
<span class="lineno"></span><span class="op" id="3795632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3795635">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="3795717">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3795744">func</span>&nbsp;<span class="ident" id="3795749">shouldRedirectGet</span><span class="op" id="3795766">(</span><span class="ident" id="3795767">statusCode</span>&nbsp;<span class="builtintype" id="3795778">int</span><span class="op" id="3795781">)</span>&nbsp;<span class="builtintype" id="3795783">bool</span>&nbsp;<span class="op" id="3795788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795791">switch</span>&nbsp;<span class="ident" id="3795798">statusCode</span>&nbsp;<span class="op" id="3795809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795812">case</span>&nbsp;<span class="ident" id="3795817">StatusMovedPermanently</span><span class="op" id="3795839">,</span>&nbsp;<span class="ident" id="3795841">StatusFound</span><span class="op" id="3795852">,</span>&nbsp;<span class="ident" id="3795854">StatusSeeOther</span><span class="op" id="3795868">,</span>&nbsp;<span class="ident" id="3795870">StatusTemporaryRedirect</span><span class="op" id="3795893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795897">return</span>&nbsp;<span class="builtintype" id="3795904">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795913">return</span>&nbsp;<span class="builtintype" id="3795920">false</span><br>
<span class="lineno"></span><span class="op" id="3795926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3795929">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="3796012">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="3796039">func</span>&nbsp;<span class="ident" id="3796044">shouldRedirectPost</span><span class="op" id="3796062">(</span><span class="ident" id="3796063">statusCode</span>&nbsp;<span class="builtintype" id="3796074">int</span><span class="op" id="3796077">)</span>&nbsp;<span class="builtintype" id="3796079">bool</span>&nbsp;<span class="op" id="3796084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796087">switch</span>&nbsp;<span class="ident" id="3796094">statusCode</span>&nbsp;<span class="op" id="3796105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796108">case</span>&nbsp;<span class="ident" id="3796113">StatusFound</span><span class="op" id="3796124">,</span>&nbsp;<span class="ident" id="3796126">StatusSeeOther</span><span class="op" id="3796140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796144">return</span>&nbsp;<span class="builtintype" id="3796151">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796160">return</span>&nbsp;<span class="builtintype" id="3796167">false</span><br>
<span class="lineno"></span><span class="op" id="3796173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3796176">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3796259">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="3796337">//</span><br>
<span class="lineno"></span><span class="comment" id="3796340">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3796370">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3796388">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="3796410">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3796441">//</span><br>
<span class="lineno"></span><span class="comment" id="3796444">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3796513">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3796580">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="3796590">//</span><br>
<span class="lineno"></span><span class="comment" id="3796593">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3796655">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3796715">//</span><br>
<span class="lineno"></span><span class="comment" id="3796718">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="3796764">func</span>&nbsp;<span class="ident" id="3796769">Get</span><span class="op" id="3796772">(</span><span class="ident" id="3796773">url</span>&nbsp;<span class="builtintype" id="3796777">string</span><span class="op" id="3796783">)</span>&nbsp;<span class="op" id="3796785">(</span><span class="ident" id="3796786">resp</span>&nbsp;<span class="op" id="3796791">*</span><span class="ident" id="3796792">Response</span><span class="op" id="3796800">,</span>&nbsp;<span class="ident" id="3796802">err</span>&nbsp;<span class="builtintype" id="3796806">error</span><span class="op" id="3796811">)</span>&nbsp;<span class="op" id="3796813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796816">return</span>&nbsp;<span class="ident" id="3796823">DefaultClient</span><span class="op" id="3796836">.</span><span class="ident" id="3796837">Get</span><span class="op" id="3796840">(</span><span class="ident" id="3796841">url</span><span class="op" id="3796844">)</span><br>
<span class="lineno"></span><span class="op" id="3796846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3796849">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="3796922">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3796994">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3797030">//</span><br>
<span class="lineno"></span><span class="comment" id="3797033">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3797063">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="3797081">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3797103">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3797134">//</span><br>
<span class="lineno"></span><span class="comment" id="3797137">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="3797206">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="3797276">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3797295">//</span><br>
<span class="lineno"></span><span class="comment" id="3797298">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3797360">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3797420">func</span>&nbsp;<span class="op" id="3797425">(</span><span class="ident" id="3797426">c</span>&nbsp;<span class="op" id="3797428">*</span><span class="ident" id="3797429">Client</span><span class="op" id="3797435">)</span>&nbsp;<span class="ident" id="3797437">Get</span><span class="op" id="3797440">(</span><span class="ident" id="3797441">url</span>&nbsp;<span class="builtintype" id="3797445">string</span><span class="op" id="3797451">)</span>&nbsp;<span class="op" id="3797453">(</span><span class="ident" id="3797454">resp</span>&nbsp;<span class="op" id="3797459">*</span><span class="ident" id="3797460">Response</span><span class="op" id="3797468">,</span>&nbsp;<span class="ident" id="3797470">err</span>&nbsp;<span class="builtintype" id="3797474">error</span><span class="op" id="3797479">)</span>&nbsp;<span class="op" id="3797481">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797484">req</span><span class="op" id="3797487">,</span>&nbsp;<span class="ident" id="3797489">err</span>&nbsp;<span class="op" id="3797493">:=</span>&nbsp;<span class="ident" id="3797496">NewRequest</span><span class="op" id="3797506">(</span><span class="string" id="3797507">&#34;GET&#34;</span><span class="op" id="3797512">,</span>&nbsp;<span class="ident" id="3797514">url</span><span class="op" id="3797517">,</span>&nbsp;<span class="ident" id="3797519">nil</span><span class="op" id="3797522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797525">if</span>&nbsp;<span class="ident" id="3797528">err</span>&nbsp;<span class="op" id="3797532">!=</span>&nbsp;<span class="ident" id="3797535">nil</span>&nbsp;<span class="op" id="3797539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797543">return</span>&nbsp;<span class="ident" id="3797550">nil</span><span class="op" id="3797553">,</span>&nbsp;<span class="ident" id="3797555">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797563">return</span>&nbsp;<span class="ident" id="3797570">c</span><span class="op" id="3797571">.</span><span class="ident" id="3797572">doFollowingRedirects</span><span class="op" id="3797592">(</span><span class="ident" id="3797593">req</span><span class="op" id="3797596">,</span>&nbsp;<span class="ident" id="3797598">shouldRedirectGet</span><span class="op" id="3797615">)</span><br>
<span class="lineno">300</span><span class="op" id="3797617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3797620">func</span>&nbsp;<span class="op" id="3797625">(</span><span class="ident" id="3797626">c</span>&nbsp;<span class="op" id="3797628">*</span><span class="ident" id="3797629">Client</span><span class="op" id="3797635">)</span>&nbsp;<span class="ident" id="3797637">doFollowingRedirects</span><span class="op" id="3797657">(</span><span class="ident" id="3797658">ireq</span>&nbsp;<span class="op" id="3797663">*</span><span class="ident" id="3797664">Request</span><span class="op" id="3797671">,</span>&nbsp;<span class="ident" id="3797673">shouldRedirect</span>&nbsp;<span class="keyword" id="3797688">func</span><span class="op" id="3797692">(</span><span class="builtintype" id="3797693">int</span><span class="op" id="3797696">)</span>&nbsp;<span class="builtintype" id="3797698">bool</span><span class="op" id="3797702">)</span>&nbsp;<span class="op" id="3797704">(</span><span class="ident" id="3797705">resp</span>&nbsp;<span class="op" id="3797710">*</span><span class="ident" id="3797711">Response</span><span class="op" id="3797719">,</span>&nbsp;<span class="ident" id="3797721">err</span>&nbsp;<span class="builtintype" id="3797725">error</span><span class="op" id="3797730">)</span>&nbsp;<span class="op" id="3797732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797735">var</span>&nbsp;<span class="ident" id="3797739">base</span>&nbsp;<span class="op" id="3797744">*</span><span class="ident" id="3797745">url</span><span class="op" id="3797748">.</span><span class="ident" id="3797749">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797754">redirectChecker</span>&nbsp;<span class="op" id="3797770">:=</span>&nbsp;<span class="ident" id="3797773">c</span><span class="op" id="3797774">.</span><span class="ident" id="3797775">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797790">if</span>&nbsp;<span class="ident" id="3797793">redirectChecker</span>&nbsp;<span class="op" id="3797809">==</span>&nbsp;<span class="ident" id="3797812">nil</span>&nbsp;<span class="op" id="3797816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797820">redirectChecker</span>&nbsp;<span class="op" id="3797836">=</span>&nbsp;<span class="ident" id="3797838">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797863">var</span>&nbsp;<span class="ident" id="3797867">via</span>&nbsp;<span class="op" id="3797871">[</span><span class="op" id="3797872">]</span><span class="op" id="3797873">*</span><span class="ident" id="3797874">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797884">if</span>&nbsp;<span class="ident" id="3797887">ireq</span><span class="op" id="3797891">.</span><span class="ident" id="3797892">URL</span>&nbsp;<span class="op" id="3797896">==</span>&nbsp;<span class="ident" id="3797899">nil</span>&nbsp;<span class="op" id="3797903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3797907">ireq</span><span class="op" id="3797911">.</span><span class="ident" id="3797912">closeBody</span><span class="op" id="3797921">(</span><span class="op" id="3797922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797926">return</span>&nbsp;<span class="ident" id="3797933">nil</span><span class="op" id="3797936">,</span>&nbsp;<span class="ident" id="3797938">errors</span><span class="op" id="3797944">.</span><span class="ident" id="3797945">New</span><span class="op" id="3797948">(</span><span class="string" id="3797949">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3797972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3797975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3797979">var</span>&nbsp;<span class="ident" id="3797983">reqmu</span>&nbsp;<span class="ident" id="3797989">sync</span><span class="op" id="3797993">.</span><span class="ident" id="3797994">Mutex</span>&nbsp;<span class="comment" id="3798000">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798015">req</span>&nbsp;<span class="op" id="3798019">:=</span>&nbsp;<span class="ident" id="3798022">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798029">var</span>&nbsp;<span class="ident" id="3798033">timer</span>&nbsp;<span class="op" id="3798039">*</span><span class="ident" id="3798040">time</span><span class="op" id="3798044">.</span><span class="ident" id="3798045">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798052">if</span>&nbsp;<span class="ident" id="3798055">c</span><span class="op" id="3798056">.</span><span class="ident" id="3798057">Timeout</span>&nbsp;<span class="op" id="3798065">&gt;</span>&nbsp;<span class="num" id="3798067">0</span>&nbsp;<span class="op" id="3798069">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798073">type</span>&nbsp;<span class="ident" id="3798078">canceler</span>&nbsp;<span class="keyword" id="3798087">interface</span>&nbsp;<span class="op" id="3798097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798102">CancelRequest</span><span class="op" id="3798115">(</span><span class="op" id="3798116">*</span><span class="ident" id="3798117">Request</span><span class="op" id="3798124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798132">tr</span><span class="op" id="3798134">,</span>&nbsp;<span class="ident" id="3798136">ok</span>&nbsp;<span class="op" id="3798139">:=</span>&nbsp;<span class="ident" id="3798142">c</span><span class="op" id="3798143">.</span><span class="ident" id="3798144">transport</span><span class="op" id="3798153">(</span><span class="op" id="3798154">)</span><span class="op" id="3798155">.</span><span class="op" id="3798156">(</span><span class="ident" id="3798157">canceler</span><span class="op" id="3798165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798169">if</span>&nbsp;<span class="op" id="3798172">!</span><span class="ident" id="3798173">ok</span>&nbsp;<span class="op" id="3798176">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798181">return</span>&nbsp;<span class="ident" id="3798188">nil</span><span class="op" id="3798191">,</span>&nbsp;<span class="ident" id="3798193">fmt</span><span class="op" id="3798196">.</span><span class="ident" id="3798197">Errorf</span><span class="op" id="3798203">(</span><span class="string" id="3798204">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3798296">,</span>&nbsp;<span class="ident" id="3798298">c</span><span class="op" id="3798299">.</span><span class="ident" id="3798300">transport</span><span class="op" id="3798309">(</span><span class="op" id="3798310">)</span><span class="op" id="3798311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798319">timer</span>&nbsp;<span class="op" id="3798325">=</span>&nbsp;<span class="ident" id="3798327">time</span><span class="op" id="3798331">.</span><span class="ident" id="3798332">AfterFunc</span><span class="op" id="3798341">(</span><span class="ident" id="3798342">c</span><span class="op" id="3798343">.</span><span class="ident" id="3798344">Timeout</span><span class="op" id="3798351">,</span>&nbsp;<span class="keyword" id="3798353">func</span><span class="op" id="3798357">(</span><span class="op" id="3798358">)</span>&nbsp;<span class="op" id="3798360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798365">reqmu</span><span class="op" id="3798370">.</span><span class="ident" id="3798371">Lock</span><span class="op" id="3798375">(</span><span class="op" id="3798376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798381">defer</span>&nbsp;<span class="ident" id="3798387">reqmu</span><span class="op" id="3798392">.</span><span class="ident" id="3798393">Unlock</span><span class="op" id="3798399">(</span><span class="op" id="3798400">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798405">tr</span><span class="op" id="3798407">.</span><span class="ident" id="3798408">CancelRequest</span><span class="op" id="3798421">(</span><span class="ident" id="3798422">req</span><span class="op" id="3798425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798429">}</span><span class="op" id="3798430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798437">urlStr</span>&nbsp;<span class="op" id="3798444">:=</span>&nbsp;<span class="string" id="3798447">&#34;&#34;</span>&nbsp;<span class="comment" id="3798450">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798515">redirectFailed</span>&nbsp;<span class="op" id="3798530">:=</span>&nbsp;<span class="builtintype" id="3798533">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798540">for</span>&nbsp;<span class="ident" id="3798544">redirect</span>&nbsp;<span class="op" id="3798553">:=</span>&nbsp;<span class="num" id="3798556">0</span><span class="op" id="3798557">;</span>&nbsp;<span class="op" id="3798559">;</span>&nbsp;<span class="ident" id="3798561">redirect</span><span class="op" id="3798569">++</span>&nbsp;<span class="op" id="3798572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798576">if</span>&nbsp;<span class="ident" id="3798579">redirect</span>&nbsp;<span class="op" id="3798588">!=</span>&nbsp;<span class="num" id="3798591">0</span>&nbsp;<span class="op" id="3798593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798598">nreq</span>&nbsp;<span class="op" id="3798603">:=</span>&nbsp;<span class="builtinfunc" id="3798606">new</span><span class="op" id="3798609">(</span><span class="ident" id="3798610">Request</span><span class="op" id="3798617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798622">nreq</span><span class="op" id="3798626">.</span><span class="ident" id="3798627">Method</span>&nbsp;<span class="op" id="3798634">=</span>&nbsp;<span class="ident" id="3798636">ireq</span><span class="op" id="3798640">.</span><span class="ident" id="3798641">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798651">if</span>&nbsp;<span class="ident" id="3798654">ireq</span><span class="op" id="3798658">.</span><span class="ident" id="3798659">Method</span>&nbsp;<span class="op" id="3798666">==</span>&nbsp;<span class="string" id="3798669">&#34;POST&#34;</span>&nbsp;<span class="op" id="3798676">||</span>&nbsp;<span class="ident" id="3798679">ireq</span><span class="op" id="3798683">.</span><span class="ident" id="3798684">Method</span>&nbsp;<span class="op" id="3798691">==</span>&nbsp;<span class="string" id="3798694">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3798700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798706">nreq</span><span class="op" id="3798710">.</span><span class="ident" id="3798711">Method</span>&nbsp;<span class="op" id="3798718">=</span>&nbsp;<span class="string" id="3798720">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798734">nreq</span><span class="op" id="3798738">.</span><span class="ident" id="3798739">Header</span>&nbsp;<span class="op" id="3798746">=</span>&nbsp;<span class="builtinfunc" id="3798748">make</span><span class="op" id="3798752">(</span><span class="ident" id="3798753">Header</span><span class="op" id="3798759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798764">nreq</span><span class="op" id="3798768">.</span><span class="ident" id="3798769">URL</span><span class="op" id="3798772">,</span>&nbsp;<span class="ident" id="3798774">err</span>&nbsp;<span class="op" id="3798778">=</span>&nbsp;<span class="ident" id="3798780">base</span><span class="op" id="3798784">.</span><span class="ident" id="3798785">Parse</span><span class="op" id="3798790">(</span><span class="ident" id="3798791">urlStr</span><span class="op" id="3798797">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798802">if</span>&nbsp;<span class="ident" id="3798805">err</span>&nbsp;<span class="op" id="3798809">!=</span>&nbsp;<span class="ident" id="3798812">nil</span>&nbsp;<span class="op" id="3798816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798822">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3798831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798836">if</span>&nbsp;<span class="builtinfunc" id="3798839">len</span><span class="op" id="3798842">(</span><span class="ident" id="3798843">via</span><span class="op" id="3798846">)</span>&nbsp;<span class="op" id="3798848">&gt;</span>&nbsp;<span class="num" id="3798850">0</span>&nbsp;<span class="op" id="3798852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3798858">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798889">lastReq</span>&nbsp;<span class="op" id="3798897">:=</span>&nbsp;<span class="ident" id="3798900">via</span><span class="op" id="3798903">[</span><span class="builtinfunc" id="3798904">len</span><span class="op" id="3798907">(</span><span class="ident" id="3798908">via</span><span class="op" id="3798911">)</span><span class="op" id="3798912">-</span><span class="num" id="3798913">1</span><span class="op" id="3798914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3798920">if</span>&nbsp;<span class="ident" id="3798923">ref</span>&nbsp;<span class="op" id="3798927">:=</span>&nbsp;<span class="ident" id="3798930">refererForURL</span><span class="op" id="3798943">(</span><span class="ident" id="3798944">lastReq</span><span class="op" id="3798951">.</span><span class="ident" id="3798952">URL</span><span class="op" id="3798955">,</span>&nbsp;<span class="ident" id="3798957">nreq</span><span class="op" id="3798961">.</span><span class="ident" id="3798962">URL</span><span class="op" id="3798965">)</span><span class="op" id="3798966">;</span>&nbsp;<span class="ident" id="3798968">ref</span>&nbsp;<span class="op" id="3798972">!=</span>&nbsp;<span class="string" id="3798975">&#34;&#34;</span>&nbsp;<span class="op" id="3798978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3798985">nreq</span><span class="op" id="3798989">.</span><span class="ident" id="3798990">Header</span><span class="op" id="3798996">.</span><span class="ident" id="3798997">Set</span><span class="op" id="3799000">(</span><span class="string" id="3799001">&#34;Referer&#34;</span><span class="op" id="3799010">,</span>&nbsp;<span class="ident" id="3799012">ref</span><span class="op" id="3799015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799028">err</span>&nbsp;<span class="op" id="3799032">=</span>&nbsp;<span class="ident" id="3799034">redirectChecker</span><span class="op" id="3799049">(</span><span class="ident" id="3799050">nreq</span><span class="op" id="3799054">,</span>&nbsp;<span class="ident" id="3799056">via</span><span class="op" id="3799059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799065">if</span>&nbsp;<span class="ident" id="3799068">err</span>&nbsp;<span class="op" id="3799072">!=</span>&nbsp;<span class="ident" id="3799075">nil</span>&nbsp;<span class="op" id="3799079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799086">redirectFailed</span>&nbsp;<span class="op" id="3799101">=</span>&nbsp;<span class="builtintype" id="3799103">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799113">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799123">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799133">reqmu</span><span class="op" id="3799138">.</span><span class="ident" id="3799139">Lock</span><span class="op" id="3799143">(</span><span class="op" id="3799144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799149">req</span>&nbsp;<span class="op" id="3799153">=</span>&nbsp;<span class="ident" id="3799155">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799163">reqmu</span><span class="op" id="3799168">.</span><span class="ident" id="3799169">Unlock</span><span class="op" id="3799175">(</span><span class="op" id="3799176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799180">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799185">urlStr</span>&nbsp;<span class="op" id="3799192">=</span>&nbsp;<span class="ident" id="3799194">req</span><span class="op" id="3799197">.</span><span class="ident" id="3799198">URL</span><span class="op" id="3799201">.</span><span class="ident" id="3799202">String</span><span class="op" id="3799208">(</span><span class="op" id="3799209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799213">if</span>&nbsp;<span class="ident" id="3799216">resp</span><span class="op" id="3799220">,</span>&nbsp;<span class="ident" id="3799222">err</span>&nbsp;<span class="op" id="3799226">=</span>&nbsp;<span class="ident" id="3799228">c</span><span class="op" id="3799229">.</span><span class="ident" id="3799230">send</span><span class="op" id="3799234">(</span><span class="ident" id="3799235">req</span><span class="op" id="3799238">)</span><span class="op" id="3799239">;</span>&nbsp;<span class="ident" id="3799241">err</span>&nbsp;<span class="op" id="3799245">!=</span>&nbsp;<span class="ident" id="3799248">nil</span>&nbsp;<span class="op" id="3799252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799257">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799265">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799270">if</span>&nbsp;<span class="ident" id="3799273">shouldRedirect</span><span class="op" id="3799287">(</span><span class="ident" id="3799288">resp</span><span class="op" id="3799292">.</span><span class="ident" id="3799293">StatusCode</span><span class="op" id="3799303">)</span>&nbsp;<span class="op" id="3799305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799310">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3799385">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799466">const</span>&nbsp;<span class="ident" id="3799472">maxBodySlurpSize</span>&nbsp;<span class="op" id="3799489">=</span>&nbsp;<span class="num" id="3799491">2</span>&nbsp;<span class="op" id="3799493">&lt;&lt;</span>&nbsp;<span class="num" id="3799496">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799502">if</span>&nbsp;<span class="ident" id="3799505">resp</span><span class="op" id="3799509">.</span><span class="ident" id="3799510">ContentLength</span>&nbsp;<span class="op" id="3799524">==</span>&nbsp;<span class="op" id="3799527">-</span><span class="num" id="3799528">1</span>&nbsp;<span class="op" id="3799530">||</span>&nbsp;<span class="ident" id="3799533">resp</span><span class="op" id="3799537">.</span><span class="ident" id="3799538">ContentLength</span>&nbsp;<span class="op" id="3799552">&lt;=</span>&nbsp;<span class="ident" id="3799555">maxBodySlurpSize</span>&nbsp;<span class="op" id="3799572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799578">io</span><span class="op" id="3799580">.</span><span class="ident" id="3799581">CopyN</span><span class="op" id="3799586">(</span><span class="ident" id="3799587">ioutil</span><span class="op" id="3799593">.</span><span class="ident" id="3799594">Discard</span><span class="op" id="3799601">,</span>&nbsp;<span class="ident" id="3799603">resp</span><span class="op" id="3799607">.</span><span class="ident" id="3799608">Body</span><span class="op" id="3799612">,</span>&nbsp;<span class="ident" id="3799614">maxBodySlurpSize</span><span class="op" id="3799630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799640">resp</span><span class="op" id="3799644">.</span><span class="ident" id="3799645">Body</span><span class="op" id="3799649">.</span><span class="ident" id="3799650">Close</span><span class="op" id="3799655">(</span><span class="op" id="3799656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799661">if</span>&nbsp;<span class="ident" id="3799664">urlStr</span>&nbsp;<span class="op" id="3799671">=</span>&nbsp;<span class="ident" id="3799673">resp</span><span class="op" id="3799677">.</span><span class="ident" id="3799678">Header</span><span class="op" id="3799684">.</span><span class="ident" id="3799685">Get</span><span class="op" id="3799688">(</span><span class="string" id="3799689">&#34;Location&#34;</span><span class="op" id="3799699">)</span><span class="op" id="3799700">;</span>&nbsp;<span class="ident" id="3799702">urlStr</span>&nbsp;<span class="op" id="3799709">==</span>&nbsp;<span class="string" id="3799712">&#34;&#34;</span>&nbsp;<span class="op" id="3799715">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799721">err</span>&nbsp;<span class="op" id="3799725">=</span>&nbsp;<span class="ident" id="3799727">errors</span><span class="op" id="3799733">.</span><span class="ident" id="3799734">New</span><span class="op" id="3799737">(</span><span class="ident" id="3799738">fmt</span><span class="op" id="3799741">.</span><span class="ident" id="3799742">Sprintf</span><span class="op" id="3799749">(</span><span class="string" id="3799750">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="3799787">,</span>&nbsp;<span class="ident" id="3799789">resp</span><span class="op" id="3799793">.</span><span class="ident" id="3799794">StatusCode</span><span class="op" id="3799804">)</span><span class="op" id="3799805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799811">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799825">base</span>&nbsp;<span class="op" id="3799830">=</span>&nbsp;<span class="ident" id="3799832">req</span><span class="op" id="3799835">.</span><span class="ident" id="3799836">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799843">via</span>&nbsp;<span class="op" id="3799847">=</span>&nbsp;<span class="builtinfunc" id="3799849">append</span><span class="op" id="3799855">(</span><span class="ident" id="3799856">via</span><span class="op" id="3799859">,</span>&nbsp;<span class="ident" id="3799861">req</span><span class="op" id="3799864">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799869">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799884">if</span>&nbsp;<span class="ident" id="3799887">timer</span>&nbsp;<span class="op" id="3799893">!=</span>&nbsp;<span class="ident" id="3799896">nil</span>&nbsp;<span class="op" id="3799900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799905">resp</span><span class="op" id="3799909">.</span><span class="ident" id="3799910">Body</span>&nbsp;<span class="op" id="3799915">=</span>&nbsp;<span class="op" id="3799917">&amp;</span><span class="ident" id="3799918">cancelTimerBody</span><span class="op" id="3799933">{</span><span class="ident" id="3799934">timer</span><span class="op" id="3799939">,</span>&nbsp;<span class="ident" id="3799941">resp</span><span class="op" id="3799945">.</span><span class="ident" id="3799946">Body</span><span class="op" id="3799950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799954">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3799958">return</span>&nbsp;<span class="ident" id="3799965">resp</span><span class="op" id="3799969">,</span>&nbsp;<span class="ident" id="3799971">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3799976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3799980">method</span>&nbsp;<span class="op" id="3799987">:=</span>&nbsp;<span class="ident" id="3799990">ireq</span><span class="op" id="3799994">.</span><span class="ident" id="3799995">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800003">urlErr</span>&nbsp;<span class="op" id="3800010">:=</span>&nbsp;<span class="op" id="3800013">&amp;</span><span class="ident" id="3800014">url</span><span class="op" id="3800017">.</span><span class="ident" id="3800018">Error</span><span class="op" id="3800023">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800027">Op</span><span class="op" id="3800029">:</span>&nbsp;&nbsp;<span class="ident" id="3800032">method</span><span class="op" id="3800038">[</span><span class="num" id="3800039">0</span><span class="op" id="3800040">:</span><span class="num" id="3800041">1</span><span class="op" id="3800042">]</span>&nbsp;<span class="op" id="3800044">+</span>&nbsp;<span class="ident" id="3800046">strings</span><span class="op" id="3800053">.</span><span class="ident" id="3800054">ToLower</span><span class="op" id="3800061">(</span><span class="ident" id="3800062">method</span><span class="op" id="3800068">[</span><span class="num" id="3800069">1</span><span class="op" id="3800070">:</span><span class="op" id="3800071">]</span><span class="op" id="3800072">)</span><span class="op" id="3800073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800077">URL</span><span class="op" id="3800080">:</span>&nbsp;<span class="ident" id="3800082">urlStr</span><span class="op" id="3800088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800092">Err</span><span class="op" id="3800095">:</span>&nbsp;<span class="ident" id="3800097">err</span><span class="op" id="3800100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800107">if</span>&nbsp;<span class="ident" id="3800110">redirectFailed</span>&nbsp;<span class="op" id="3800125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800129">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800196">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3800252">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800290">return</span>&nbsp;<span class="ident" id="3800297">resp</span><span class="op" id="3800301">,</span>&nbsp;<span class="ident" id="3800303">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800315">if</span>&nbsp;<span class="ident" id="3800318">resp</span>&nbsp;<span class="op" id="3800323">!=</span>&nbsp;<span class="ident" id="3800326">nil</span>&nbsp;<span class="op" id="3800330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3800334">resp</span><span class="op" id="3800338">.</span><span class="ident" id="3800339">Body</span><span class="op" id="3800343">.</span><span class="ident" id="3800344">Close</span><span class="op" id="3800349">(</span><span class="op" id="3800350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800353">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800356">return</span>&nbsp;<span class="ident" id="3800363">nil</span><span class="op" id="3800366">,</span>&nbsp;<span class="ident" id="3800368">urlErr</span><br>
<span class="lineno"></span><span class="op" id="3800375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3800378">func</span>&nbsp;<span class="ident" id="3800383">defaultCheckRedirect</span><span class="op" id="3800403">(</span><span class="ident" id="3800404">req</span>&nbsp;<span class="op" id="3800408">*</span><span class="ident" id="3800409">Request</span><span class="op" id="3800416">,</span>&nbsp;<span class="ident" id="3800418">via</span>&nbsp;<span class="op" id="3800422">[</span><span class="op" id="3800423">]</span><span class="op" id="3800424">*</span><span class="ident" id="3800425">Request</span><span class="op" id="3800432">)</span>&nbsp;<span class="builtintype" id="3800434">error</span>&nbsp;<span class="op" id="3800440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800443">if</span>&nbsp;<span class="builtinfunc" id="3800446">len</span><span class="op" id="3800449">(</span><span class="ident" id="3800450">via</span><span class="op" id="3800453">)</span>&nbsp;<span class="op" id="3800455">&gt;=</span>&nbsp;<span class="num" id="3800458">10</span>&nbsp;<span class="op" id="3800461">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800465">return</span>&nbsp;<span class="ident" id="3800472">errors</span><span class="op" id="3800478">.</span><span class="ident" id="3800479">New</span><span class="op" id="3800482">(</span><span class="string" id="3800483">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="3800511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3800514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800517">return</span>&nbsp;<span class="ident" id="3800524">nil</span><br>
<span class="lineno"></span><span class="op" id="3800528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3800531">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="3800575">//</span><br>
<span class="lineno"></span><span class="comment" id="3800578">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3800638">//</span><br>
<span class="lineno"></span><span class="comment" id="3800641">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="3800688">func</span>&nbsp;<span class="ident" id="3800693">Post</span><span class="op" id="3800697">(</span><span class="ident" id="3800698">url</span>&nbsp;<span class="builtintype" id="3800702">string</span><span class="op" id="3800708">,</span>&nbsp;<span class="ident" id="3800710">bodyType</span>&nbsp;<span class="builtintype" id="3800719">string</span><span class="op" id="3800725">,</span>&nbsp;<span class="ident" id="3800727">body</span>&nbsp;<span class="ident" id="3800732">io</span><span class="op" id="3800734">.</span><span class="ident" id="3800735">Reader</span><span class="op" id="3800741">)</span>&nbsp;<span class="op" id="3800743">(</span><span class="ident" id="3800744">resp</span>&nbsp;<span class="op" id="3800749">*</span><span class="ident" id="3800750">Response</span><span class="op" id="3800758">,</span>&nbsp;<span class="ident" id="3800760">err</span>&nbsp;<span class="builtintype" id="3800764">error</span><span class="op" id="3800769">)</span>&nbsp;<span class="op" id="3800771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3800774">return</span>&nbsp;<span class="ident" id="3800781">DefaultClient</span><span class="op" id="3800794">.</span><span class="ident" id="3800795">Post</span><span class="op" id="3800799">(</span><span class="ident" id="3800800">url</span><span class="op" id="3800803">,</span>&nbsp;<span class="ident" id="3800805">bodyType</span><span class="op" id="3800813">,</span>&nbsp;<span class="ident" id="3800815">body</span><span class="op" id="3800819">)</span><br>
<span class="lineno"></span><span class="op" id="3800821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3800824">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="3800868">//</span><br>
<span class="lineno"></span><span class="comment" id="3800871">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3800931">//</span><br>
<span class="lineno"></span><span class="comment" id="3800934">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3801003">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="3801015">func</span>&nbsp;<span class="op" id="3801020">(</span><span class="ident" id="3801021">c</span>&nbsp;<span class="op" id="3801023">*</span><span class="ident" id="3801024">Client</span><span class="op" id="3801030">)</span>&nbsp;<span class="ident" id="3801032">Post</span><span class="op" id="3801036">(</span><span class="ident" id="3801037">url</span>&nbsp;<span class="builtintype" id="3801041">string</span><span class="op" id="3801047">,</span>&nbsp;<span class="ident" id="3801049">bodyType</span>&nbsp;<span class="builtintype" id="3801058">string</span><span class="op" id="3801064">,</span>&nbsp;<span class="ident" id="3801066">body</span>&nbsp;<span class="ident" id="3801071">io</span><span class="op" id="3801073">.</span><span class="ident" id="3801074">Reader</span><span class="op" id="3801080">)</span>&nbsp;<span class="op" id="3801082">(</span><span class="ident" id="3801083">resp</span>&nbsp;<span class="op" id="3801088">*</span><span class="ident" id="3801089">Response</span><span class="op" id="3801097">,</span>&nbsp;<span class="ident" id="3801099">err</span>&nbsp;<span class="builtintype" id="3801103">error</span><span class="op" id="3801108">)</span>&nbsp;<span class="op" id="3801110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801113">req</span><span class="op" id="3801116">,</span>&nbsp;<span class="ident" id="3801118">err</span>&nbsp;<span class="op" id="3801122">:=</span>&nbsp;<span class="ident" id="3801125">NewRequest</span><span class="op" id="3801135">(</span><span class="string" id="3801136">&#34;POST&#34;</span><span class="op" id="3801142">,</span>&nbsp;<span class="ident" id="3801144">url</span><span class="op" id="3801147">,</span>&nbsp;<span class="ident" id="3801149">body</span><span class="op" id="3801153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801156">if</span>&nbsp;<span class="ident" id="3801159">err</span>&nbsp;<span class="op" id="3801163">!=</span>&nbsp;<span class="ident" id="3801166">nil</span>&nbsp;<span class="op" id="3801170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801174">return</span>&nbsp;<span class="ident" id="3801181">nil</span><span class="op" id="3801184">,</span>&nbsp;<span class="ident" id="3801186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3801191">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3801194">req</span><span class="op" id="3801197">.</span><span class="ident" id="3801198">Header</span><span class="op" id="3801204">.</span><span class="ident" id="3801205">Set</span><span class="op" id="3801208">(</span><span class="string" id="3801209">&#34;Content-Type&#34;</span><span class="op" id="3801223">,</span>&nbsp;<span class="ident" id="3801225">bodyType</span><span class="op" id="3801233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801236">return</span>&nbsp;<span class="ident" id="3801243">c</span><span class="op" id="3801244">.</span><span class="ident" id="3801245">doFollowingRedirects</span><span class="op" id="3801265">(</span><span class="ident" id="3801266">req</span><span class="op" id="3801269">,</span>&nbsp;<span class="ident" id="3801271">shouldRedirectPost</span><span class="op" id="3801289">)</span><br>
<span class="lineno"></span><span class="op" id="3801291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3801294">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="3801363">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3801406">//</span><br>
<span class="lineno"></span><span class="comment" id="3801409">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3801471">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3801531">//</span><br>
<span class="lineno">450</span><span class="comment" id="3801534">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="3801589">func</span>&nbsp;<span class="ident" id="3801594">PostForm</span><span class="op" id="3801602">(</span><span class="ident" id="3801603">url</span>&nbsp;<span class="builtintype" id="3801607">string</span><span class="op" id="3801613">,</span>&nbsp;<span class="ident" id="3801615">data</span>&nbsp;<span class="ident" id="3801620">url</span><span class="op" id="3801623">.</span><span class="ident" id="3801624">Values</span><span class="op" id="3801630">)</span>&nbsp;<span class="op" id="3801632">(</span><span class="ident" id="3801633">resp</span>&nbsp;<span class="op" id="3801638">*</span><span class="ident" id="3801639">Response</span><span class="op" id="3801647">,</span>&nbsp;<span class="ident" id="3801649">err</span>&nbsp;<span class="builtintype" id="3801653">error</span><span class="op" id="3801658">)</span>&nbsp;<span class="op" id="3801660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3801663">return</span>&nbsp;<span class="ident" id="3801670">DefaultClient</span><span class="op" id="3801683">.</span><span class="ident" id="3801684">PostForm</span><span class="op" id="3801692">(</span><span class="ident" id="3801693">url</span><span class="op" id="3801696">,</span>&nbsp;<span class="ident" id="3801698">data</span><span class="op" id="3801702">)</span><br>
<span class="lineno"></span><span class="op" id="3801704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3801707">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="3801755">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3801818">//</span><br>
<span class="lineno"></span><span class="comment" id="3801821">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3801883">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="3801943">func</span>&nbsp;<span class="op" id="3801948">(</span><span class="ident" id="3801949">c</span>&nbsp;<span class="op" id="3801951">*</span><span class="ident" id="3801952">Client</span><span class="op" id="3801958">)</span>&nbsp;<span class="ident" id="3801960">PostForm</span><span class="op" id="3801968">(</span><span class="ident" id="3801969">url</span>&nbsp;<span class="builtintype" id="3801973">string</span><span class="op" id="3801979">,</span>&nbsp;<span class="ident" id="3801981">data</span>&nbsp;<span class="ident" id="3801986">url</span><span class="op" id="3801989">.</span><span class="ident" id="3801990">Values</span><span class="op" id="3801996">)</span>&nbsp;<span class="op" id="3801998">(</span><span class="ident" id="3801999">resp</span>&nbsp;<span class="op" id="3802004">*</span><span class="ident" id="3802005">Response</span><span class="op" id="3802013">,</span>&nbsp;<span class="ident" id="3802015">err</span>&nbsp;<span class="builtintype" id="3802019">error</span><span class="op" id="3802024">)</span>&nbsp;<span class="op" id="3802026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802029">return</span>&nbsp;<span class="ident" id="3802036">c</span><span class="op" id="3802037">.</span><span class="ident" id="3802038">Post</span><span class="op" id="3802042">(</span><span class="ident" id="3802043">url</span><span class="op" id="3802046">,</span>&nbsp;<span class="string" id="3802048">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3802083">,</span>&nbsp;<span class="ident" id="3802085">strings</span><span class="op" id="3802092">.</span><span class="ident" id="3802093">NewReader</span><span class="op" id="3802102">(</span><span class="ident" id="3802103">data</span><span class="op" id="3802107">.</span><span class="ident" id="3802108">Encode</span><span class="op" id="3802114">(</span><span class="op" id="3802115">)</span><span class="op" id="3802116">)</span><span class="op" id="3802117">)</span><br>
<span class="lineno"></span><span class="op" id="3802119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802122">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3802197">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3802270">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3802306">//</span><br>
<span class="lineno"></span><span class="comment" id="3802309">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3802339">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="3802357">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="3802379">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="3802410">//</span><br>
<span class="lineno"></span><span class="comment" id="3802413">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="3802460">func</span>&nbsp;<span class="ident" id="3802465">Head</span><span class="op" id="3802469">(</span><span class="ident" id="3802470">url</span>&nbsp;<span class="builtintype" id="3802474">string</span><span class="op" id="3802480">)</span>&nbsp;<span class="op" id="3802482">(</span><span class="ident" id="3802483">resp</span>&nbsp;<span class="op" id="3802488">*</span><span class="ident" id="3802489">Response</span><span class="op" id="3802497">,</span>&nbsp;<span class="ident" id="3802499">err</span>&nbsp;<span class="builtintype" id="3802503">error</span><span class="op" id="3802508">)</span>&nbsp;<span class="op" id="3802510">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802513">return</span>&nbsp;<span class="ident" id="3802520">DefaultClient</span><span class="op" id="3802533">.</span><span class="ident" id="3802534">Head</span><span class="op" id="3802538">(</span><span class="ident" id="3802539">url</span><span class="op" id="3802542">)</span><br>
<span class="lineno"></span><span class="op" id="3802544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3802547">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3802622">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="3802695">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="3802731">//</span><br>
<span class="lineno"></span><span class="comment" id="3802734">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="3802764">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="3802782">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="3802804">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="3802835">func</span>&nbsp;<span class="op" id="3802840">(</span><span class="ident" id="3802841">c</span>&nbsp;<span class="op" id="3802843">*</span><span class="ident" id="3802844">Client</span><span class="op" id="3802850">)</span>&nbsp;<span class="ident" id="3802852">Head</span><span class="op" id="3802856">(</span><span class="ident" id="3802857">url</span>&nbsp;<span class="builtintype" id="3802861">string</span><span class="op" id="3802867">)</span>&nbsp;<span class="op" id="3802869">(</span><span class="ident" id="3802870">resp</span>&nbsp;<span class="op" id="3802875">*</span><span class="ident" id="3802876">Response</span><span class="op" id="3802884">,</span>&nbsp;<span class="ident" id="3802886">err</span>&nbsp;<span class="builtintype" id="3802890">error</span><span class="op" id="3802895">)</span>&nbsp;<span class="op" id="3802897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3802900">req</span><span class="op" id="3802903">,</span>&nbsp;<span class="ident" id="3802905">err</span>&nbsp;<span class="op" id="3802909">:=</span>&nbsp;<span class="ident" id="3802912">NewRequest</span><span class="op" id="3802922">(</span><span class="string" id="3802923">&#34;HEAD&#34;</span><span class="op" id="3802929">,</span>&nbsp;<span class="ident" id="3802931">url</span><span class="op" id="3802934">,</span>&nbsp;<span class="ident" id="3802936">nil</span><span class="op" id="3802939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802942">if</span>&nbsp;<span class="ident" id="3802945">err</span>&nbsp;<span class="op" id="3802949">!=</span>&nbsp;<span class="ident" id="3802952">nil</span>&nbsp;<span class="op" id="3802956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802960">return</span>&nbsp;<span class="ident" id="3802967">nil</span><span class="op" id="3802970">,</span>&nbsp;<span class="ident" id="3802972">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3802977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3802980">return</span>&nbsp;<span class="ident" id="3802987">c</span><span class="op" id="3802988">.</span><span class="ident" id="3802989">doFollowingRedirects</span><span class="op" id="3803009">(</span><span class="ident" id="3803010">req</span><span class="op" id="3803013">,</span>&nbsp;<span class="ident" id="3803015">shouldRedirectGet</span><span class="op" id="3803032">)</span><br>
<span class="lineno"></span><span class="op" id="3803034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803037">type</span>&nbsp;<span class="ident" id="3803042">cancelTimerBody</span>&nbsp;<span class="keyword" id="3803058">struct</span>&nbsp;<span class="op" id="3803065">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803068">t</span>&nbsp;&nbsp;<span class="op" id="3803071">*</span><span class="ident" id="3803072">time</span><span class="op" id="3803076">.</span><span class="ident" id="3803077">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803084">rc</span>&nbsp;<span class="ident" id="3803087">io</span><span class="op" id="3803089">.</span><span class="ident" id="3803090">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="3803101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803104">func</span>&nbsp;<span class="op" id="3803109">(</span><span class="ident" id="3803110">b</span>&nbsp;<span class="op" id="3803112">*</span><span class="ident" id="3803113">cancelTimerBody</span><span class="op" id="3803128">)</span>&nbsp;<span class="ident" id="3803130">Read</span><span class="op" id="3803134">(</span><span class="ident" id="3803135">p</span>&nbsp;<span class="op" id="3803137">[</span><span class="op" id="3803138">]</span><span class="builtintype" id="3803139">byte</span><span class="op" id="3803143">)</span>&nbsp;<span class="op" id="3803145">(</span><span class="ident" id="3803146">n</span>&nbsp;<span class="builtintype" id="3803148">int</span><span class="op" id="3803151">,</span>&nbsp;<span class="ident" id="3803153">err</span>&nbsp;<span class="builtintype" id="3803157">error</span><span class="op" id="3803162">)</span>&nbsp;<span class="op" id="3803164">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803167">n</span><span class="op" id="3803168">,</span>&nbsp;<span class="ident" id="3803170">err</span>&nbsp;<span class="op" id="3803174">=</span>&nbsp;<span class="ident" id="3803176">b</span><span class="op" id="3803177">.</span><span class="ident" id="3803178">rc</span><span class="op" id="3803180">.</span><span class="ident" id="3803181">Read</span><span class="op" id="3803185">(</span><span class="ident" id="3803186">p</span><span class="op" id="3803187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803190">if</span>&nbsp;<span class="ident" id="3803193">err</span>&nbsp;<span class="op" id="3803197">==</span>&nbsp;<span class="ident" id="3803200">io</span><span class="op" id="3803202">.</span><span class="ident" id="3803203">EOF</span>&nbsp;<span class="op" id="3803207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803211">b</span><span class="op" id="3803212">.</span><span class="ident" id="3803213">t</span><span class="op" id="3803214">.</span><span class="ident" id="3803215">Stop</span><span class="op" id="3803219">(</span><span class="op" id="3803220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3803223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803226">return</span><br>
<span class="lineno">505</span><span class="op" id="3803233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3803236">func</span>&nbsp;<span class="op" id="3803241">(</span><span class="ident" id="3803242">b</span>&nbsp;<span class="op" id="3803244">*</span><span class="ident" id="3803245">cancelTimerBody</span><span class="op" id="3803260">)</span>&nbsp;<span class="ident" id="3803262">Close</span><span class="op" id="3803267">(</span><span class="op" id="3803268">)</span>&nbsp;<span class="builtintype" id="3803270">error</span>&nbsp;<span class="op" id="3803276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803279">err</span>&nbsp;<span class="op" id="3803283">:=</span>&nbsp;<span class="ident" id="3803286">b</span><span class="op" id="3803287">.</span><span class="ident" id="3803288">rc</span><span class="op" id="3803290">.</span><span class="ident" id="3803291">Close</span><span class="op" id="3803296">(</span><span class="op" id="3803297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3803300">b</span><span class="op" id="3803301">.</span><span class="ident" id="3803302">t</span><span class="op" id="3803303">.</span><span class="ident" id="3803304">Stop</span><span class="op" id="3803308">(</span><span class="op" id="3803309">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3803312">return</span>&nbsp;<span class="ident" id="3803319">err</span><br>
<span class="lineno"></span><span class="op" id="3803323">}</span>
</div>
</body>
</html>
