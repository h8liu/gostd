<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4250646">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4250701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4250755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4250806">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4250856">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4250933">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="4251013">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="4251025">package</span>&nbsp;<span class="ident" id="4251033">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4251040">import</span>&nbsp;<span class="op" id="4251047">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4251050">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4251059">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4251065">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="4251075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4251078">const</span>&nbsp;<span class="op" id="4251084">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251087">maxCodeLen</span>&nbsp;<span class="op" id="4251098">=</span>&nbsp;<span class="num" id="4251100">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251106">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251137">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4251148">=</span>&nbsp;<span class="num" id="4251150">32768</span>&nbsp;<span class="comment" id="4251156">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4251181">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251242">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4251251">=</span>&nbsp;<span class="num" id="4251253">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251258">maxDist</span>&nbsp;&nbsp;<span class="op" id="4251267">=</span>&nbsp;<span class="num" id="4251269">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251273">numCodes</span>&nbsp;<span class="op" id="4251282">=</span>&nbsp;<span class="num" id="4251284">19</span>&nbsp;<span class="comment" id="4251287">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="4251327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4251330">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4251410">type</span>&nbsp;<span class="ident" id="4251415">CorruptInputError</span>&nbsp;<span class="ident" id="4251433">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4251440">func</span>&nbsp;<span class="op" id="4251445">(</span><span class="ident" id="4251446">e</span>&nbsp;<span class="ident" id="4251448">CorruptInputError</span><span class="op" id="4251465">)</span>&nbsp;<span class="ident" id="4251467">Error</span><span class="op" id="4251472">(</span><span class="op" id="4251473">)</span>&nbsp;<span class="builtintype" id="4251475">string</span>&nbsp;<span class="op" id="4251482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251485">return</span>&nbsp;<span class="string" id="4251492">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4251530">+</span>&nbsp;<span class="ident" id="4251532">strconv</span><span class="op" id="4251539">.</span><span class="ident" id="4251540">FormatInt</span><span class="op" id="4251549">(</span><span class="ident" id="4251550">int64</span><span class="op" id="4251555">(</span><span class="ident" id="4251556">e</span><span class="op" id="4251557">)</span><span class="op" id="4251558">,</span>&nbsp;<span class="num" id="4251560">10</span><span class="op" id="4251562">)</span><br>
<span class="lineno"></span><span class="op" id="4251564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4251567">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="4251630">type</span>&nbsp;<span class="ident" id="4251635">InternalError</span>&nbsp;<span class="builtintype" id="4251649">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4251657">func</span>&nbsp;<span class="op" id="4251662">(</span><span class="ident" id="4251663">e</span>&nbsp;<span class="ident" id="4251665">InternalError</span><span class="op" id="4251678">)</span>&nbsp;<span class="ident" id="4251680">Error</span><span class="op" id="4251685">(</span><span class="op" id="4251686">)</span>&nbsp;<span class="builtintype" id="4251688">string</span>&nbsp;<span class="op" id="4251695">{</span>&nbsp;<span class="keyword" id="4251697">return</span>&nbsp;<span class="string" id="4251704">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="4251730">+</span>&nbsp;<span class="builtintype" id="4251732">string</span><span class="op" id="4251738">(</span><span class="ident" id="4251739">e</span><span class="op" id="4251740">)</span>&nbsp;<span class="op" id="4251742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4251745">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="4251810">type</span>&nbsp;<span class="ident" id="4251815">ReadError</span>&nbsp;<span class="keyword" id="4251825">struct</span>&nbsp;<span class="op" id="4251832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251835">Offset</span>&nbsp;<span class="ident" id="4251842">int64</span>&nbsp;<span class="comment" id="4251848">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4251885">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4251892">error</span>&nbsp;<span class="comment" id="4251898">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="4251935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4251938">func</span>&nbsp;<span class="op" id="4251943">(</span><span class="ident" id="4251944">e</span>&nbsp;<span class="op" id="4251946">*</span><span class="ident" id="4251947">ReadError</span><span class="op" id="4251956">)</span>&nbsp;<span class="ident" id="4251958">Error</span><span class="op" id="4251963">(</span><span class="op" id="4251964">)</span>&nbsp;<span class="builtintype" id="4251966">string</span>&nbsp;<span class="op" id="4251973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4251976">return</span>&nbsp;<span class="string" id="4251983">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4252014">+</span>&nbsp;<span class="ident" id="4252016">strconv</span><span class="op" id="4252023">.</span><span class="ident" id="4252024">FormatInt</span><span class="op" id="4252033">(</span><span class="ident" id="4252034">e</span><span class="op" id="4252035">.</span><span class="ident" id="4252036">Offset</span><span class="op" id="4252042">,</span>&nbsp;<span class="num" id="4252044">10</span><span class="op" id="4252046">)</span>&nbsp;<span class="op" id="4252048">+</span>&nbsp;<span class="string" id="4252050">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4252055">+</span>&nbsp;<span class="ident" id="4252057">e</span><span class="op" id="4252058">.</span><span class="ident" id="4252059">Err</span><span class="op" id="4252062">.</span><span class="ident" id="4252063">Error</span><span class="op" id="4252068">(</span><span class="op" id="4252069">)</span><br>
<span class="lineno"></span><span class="op" id="4252071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4252074">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="4252141">type</span>&nbsp;<span class="ident" id="4252146">WriteError</span>&nbsp;<span class="keyword" id="4252157">struct</span>&nbsp;<span class="op" id="4252164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4252167">Offset</span>&nbsp;<span class="ident" id="4252174">int64</span>&nbsp;<span class="comment" id="4252180">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4252217">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4252224">error</span>&nbsp;<span class="comment" id="4252230">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="4252268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4252271">func</span>&nbsp;<span class="op" id="4252276">(</span><span class="ident" id="4252277">e</span>&nbsp;<span class="op" id="4252279">*</span><span class="ident" id="4252280">WriteError</span><span class="op" id="4252290">)</span>&nbsp;<span class="ident" id="4252292">Error</span><span class="op" id="4252297">(</span><span class="op" id="4252298">)</span>&nbsp;<span class="builtintype" id="4252300">string</span>&nbsp;<span class="op" id="4252307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4252310">return</span>&nbsp;<span class="string" id="4252317">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="4252349">+</span>&nbsp;<span class="ident" id="4252351">strconv</span><span class="op" id="4252358">.</span><span class="ident" id="4252359">FormatInt</span><span class="op" id="4252368">(</span><span class="ident" id="4252369">e</span><span class="op" id="4252370">.</span><span class="ident" id="4252371">Offset</span><span class="op" id="4252377">,</span>&nbsp;<span class="num" id="4252379">10</span><span class="op" id="4252381">)</span>&nbsp;<span class="op" id="4252383">+</span>&nbsp;<span class="string" id="4252385">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4252390">+</span>&nbsp;<span class="ident" id="4252392">e</span><span class="op" id="4252393">.</span><span class="ident" id="4252394">Err</span><span class="op" id="4252397">.</span><span class="ident" id="4252398">Error</span><span class="op" id="4252403">(</span><span class="op" id="4252404">)</span><br>
<span class="lineno"></span><span class="op" id="4252406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4252409">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="4252483">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="4252558">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4252594">type</span>&nbsp;<span class="ident" id="4252599">Resetter</span>&nbsp;<span class="keyword" id="4252608">interface</span>&nbsp;<span class="op" id="4252618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252621">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4252695">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4252740">Reset</span><span class="op" id="4252745">(</span><span class="ident" id="4252746">r</span>&nbsp;<span class="ident" id="4252748">io</span><span class="op" id="4252750">.</span><span class="ident" id="4252751">Reader</span><span class="op" id="4252757">,</span>&nbsp;<span class="ident" id="4252759">dict</span>&nbsp;<span class="op" id="4252764">[</span><span class="op" id="4252765">]</span><span class="builtintype" id="4252766">byte</span><span class="op" id="4252770">)</span>&nbsp;<span class="builtintype" id="4252772">error</span><br>
<span class="lineno"></span><span class="op" id="4252778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4252781">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4252854">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4252923">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4252984">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4253054">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="4253128">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="4253198">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4253267">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="4253340">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="4253412">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4253444">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4253512">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="4253584">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4253653">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="4253721">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4253741">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4253773">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4253819">const</span>&nbsp;<span class="op" id="4253825">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253828">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="4253846">=</span>&nbsp;<span class="num" id="4253848">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253851">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="4253869">=</span>&nbsp;<span class="num" id="4253871">1</span>&nbsp;<span class="op" id="4253873">&lt;&lt;</span>&nbsp;<span class="ident" id="4253876">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253894">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="4253912">=</span>&nbsp;<span class="num" id="4253914">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253918">huffmanValueShift</span>&nbsp;<span class="op" id="4253936">=</span>&nbsp;<span class="num" id="4253938">4</span><br>
<span class="lineno"></span><span class="op" id="4253940">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4253943">type</span>&nbsp;<span class="ident" id="4253948">huffmanDecoder</span>&nbsp;<span class="keyword" id="4253963">struct</span>&nbsp;<span class="op" id="4253970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4253973">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4253982">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254007">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254035">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4254044">[</span><span class="ident" id="4254045">huffmanNumChunks</span><span class="op" id="4254061">]</span><span class="builtintype" id="4254062">uint32</span>&nbsp;<span class="comment" id="4254069">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254099">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254108">[</span><span class="op" id="4254109">]</span><span class="op" id="4254110">[</span><span class="op" id="4254111">]</span><span class="builtintype" id="4254112">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254133">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254152">linkMask</span>&nbsp;<span class="builtintype" id="4254161">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254186">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="4254222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254225">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="4254291">func</span>&nbsp;<span class="op" id="4254296">(</span><span class="ident" id="4254297">h</span>&nbsp;<span class="op" id="4254299">*</span><span class="ident" id="4254300">huffmanDecoder</span><span class="op" id="4254314">)</span>&nbsp;<span class="ident" id="4254316">init</span><span class="op" id="4254320">(</span><span class="ident" id="4254321">bits</span>&nbsp;<span class="op" id="4254326">[</span><span class="op" id="4254327">]</span><span class="builtintype" id="4254328">int</span><span class="op" id="4254331">)</span>&nbsp;<span class="builtintype" id="4254333">bool</span>&nbsp;<span class="op" id="4254338">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254341">if</span>&nbsp;<span class="ident" id="4254344">h</span><span class="op" id="4254345">.</span><span class="ident" id="4254346">min</span>&nbsp;<span class="op" id="4254350">!=</span>&nbsp;<span class="num" id="4254353">0</span>&nbsp;<span class="op" id="4254355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254359">*</span><span class="ident" id="4254360">h</span>&nbsp;<span class="op" id="4254362">=</span>&nbsp;<span class="ident" id="4254364">huffmanDecoder</span><span class="op" id="4254378">{</span><span class="op" id="4254379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254386">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254428">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254460">var</span>&nbsp;<span class="ident" id="4254464">count</span>&nbsp;<span class="op" id="4254470">[</span><span class="ident" id="4254471">maxCodeLen</span><span class="op" id="4254481">]</span><span class="builtintype" id="4254482">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254487">var</span>&nbsp;<span class="ident" id="4254491">min</span><span class="op" id="4254494">,</span>&nbsp;<span class="ident" id="4254496">max</span>&nbsp;<span class="builtintype" id="4254500">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254505">for</span>&nbsp;<span class="ident" id="4254509">_</span><span class="op" id="4254510">,</span>&nbsp;<span class="ident" id="4254512">n</span>&nbsp;<span class="op" id="4254514">:=</span>&nbsp;<span class="keyword" id="4254517">range</span>&nbsp;<span class="ident" id="4254523">bits</span>&nbsp;<span class="op" id="4254528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254532">if</span>&nbsp;<span class="ident" id="4254535">n</span>&nbsp;<span class="op" id="4254537">==</span>&nbsp;<span class="num" id="4254540">0</span>&nbsp;<span class="op" id="4254542">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254547">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254562">if</span>&nbsp;<span class="ident" id="4254565">min</span>&nbsp;<span class="op" id="4254569">==</span>&nbsp;<span class="num" id="4254572">0</span>&nbsp;<span class="op" id="4254574">||</span>&nbsp;<span class="ident" id="4254577">n</span>&nbsp;<span class="op" id="4254579">&lt;</span>&nbsp;<span class="ident" id="4254581">min</span>&nbsp;<span class="op" id="4254585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254590">min</span>&nbsp;<span class="op" id="4254594">=</span>&nbsp;<span class="ident" id="4254596">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254600">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254604">if</span>&nbsp;<span class="ident" id="4254607">n</span>&nbsp;<span class="op" id="4254609">&gt;</span>&nbsp;<span class="ident" id="4254611">max</span>&nbsp;<span class="op" id="4254615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254620">max</span>&nbsp;<span class="op" id="4254624">=</span>&nbsp;<span class="ident" id="4254626">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254634">count</span><span class="op" id="4254639">[</span><span class="ident" id="4254640">n</span><span class="op" id="4254641">]</span><span class="op" id="4254642">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254646">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254649">if</span>&nbsp;<span class="ident" id="4254652">max</span>&nbsp;<span class="op" id="4254656">==</span>&nbsp;<span class="num" id="4254659">0</span>&nbsp;<span class="op" id="4254661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254665">return</span>&nbsp;<span class="builtintype" id="4254672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254683">h</span><span class="op" id="4254684">.</span><span class="ident" id="4254685">min</span>&nbsp;<span class="op" id="4254689">=</span>&nbsp;<span class="ident" id="4254691">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254696">var</span>&nbsp;<span class="ident" id="4254700">linkBits</span>&nbsp;<span class="builtintype" id="4254709">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254715">var</span>&nbsp;<span class="ident" id="4254719">numLinks</span>&nbsp;<span class="builtintype" id="4254728">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254733">if</span>&nbsp;<span class="ident" id="4254736">max</span>&nbsp;<span class="op" id="4254740">&gt;</span>&nbsp;<span class="ident" id="4254742">huffmanChunkBits</span>&nbsp;<span class="op" id="4254759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254763">linkBits</span>&nbsp;<span class="op" id="4254772">=</span>&nbsp;<span class="builtintype" id="4254774">uint</span><span class="op" id="4254778">(</span><span class="ident" id="4254779">max</span><span class="op" id="4254782">)</span>&nbsp;<span class="op" id="4254784">-</span>&nbsp;<span class="ident" id="4254786">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254805">numLinks</span>&nbsp;<span class="op" id="4254814">=</span>&nbsp;<span class="num" id="4254816">1</span>&nbsp;<span class="op" id="4254818">&lt;&lt;</span>&nbsp;<span class="ident" id="4254821">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254832">h</span><span class="op" id="4254833">.</span><span class="ident" id="4254834">linkMask</span>&nbsp;<span class="op" id="4254843">=</span>&nbsp;<span class="builtintype" id="4254845">uint32</span><span class="op" id="4254851">(</span><span class="ident" id="4254852">numLinks</span>&nbsp;<span class="op" id="4254861">-</span>&nbsp;<span class="num" id="4254863">1</span><span class="op" id="4254864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4254867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4254870">code</span>&nbsp;<span class="op" id="4254875">:=</span>&nbsp;<span class="num" id="4254878">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254881">var</span>&nbsp;<span class="ident" id="4254885">nextcode</span>&nbsp;<span class="op" id="4254894">[</span><span class="ident" id="4254895">maxCodeLen</span><span class="op" id="4254905">]</span><span class="builtintype" id="4254906">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254911">for</span>&nbsp;<span class="ident" id="4254915">i</span>&nbsp;<span class="op" id="4254917">:=</span>&nbsp;<span class="ident" id="4254920">min</span><span class="op" id="4254923">;</span>&nbsp;<span class="ident" id="4254925">i</span>&nbsp;<span class="op" id="4254927">&lt;=</span>&nbsp;<span class="ident" id="4254930">max</span><span class="op" id="4254933">;</span>&nbsp;<span class="ident" id="4254935">i</span><span class="op" id="4254936">++</span>&nbsp;<span class="op" id="4254939">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4254943">if</span>&nbsp;<span class="ident" id="4254946">i</span>&nbsp;<span class="op" id="4254948">==</span>&nbsp;<span class="ident" id="4254951">huffmanChunkBits</span><span class="op" id="4254967">+</span><span class="num" id="4254968">1</span>&nbsp;<span class="op" id="4254970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4254975">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255000">link</span>&nbsp;<span class="op" id="4255005">:=</span>&nbsp;<span class="ident" id="4255008">code</span>&nbsp;<span class="op" id="4255013">&gt;&gt;</span>&nbsp;<span class="num" id="4255016">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255021">if</span>&nbsp;<span class="ident" id="4255024">huffmanNumChunks</span>&nbsp;<span class="op" id="4255041">&lt;</span>&nbsp;<span class="ident" id="4255043">link</span>&nbsp;<span class="op" id="4255048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255054">return</span>&nbsp;<span class="builtintype" id="4255061">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255075">h</span><span class="op" id="4255076">.</span><span class="ident" id="4255077">links</span>&nbsp;<span class="op" id="4255083">=</span>&nbsp;<span class="builtinfunc" id="4255085">make</span><span class="op" id="4255089">(</span><span class="op" id="4255090">[</span><span class="op" id="4255091">]</span><span class="op" id="4255092">[</span><span class="op" id="4255093">]</span><span class="builtintype" id="4255094">uint32</span><span class="op" id="4255100">,</span>&nbsp;<span class="ident" id="4255102">huffmanNumChunks</span><span class="op" id="4255118">-</span><span class="ident" id="4255119">link</span><span class="op" id="4255123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255128">for</span>&nbsp;<span class="ident" id="4255132">j</span>&nbsp;<span class="op" id="4255134">:=</span>&nbsp;<span class="builtintype" id="4255137">uint</span><span class="op" id="4255141">(</span><span class="ident" id="4255142">link</span><span class="op" id="4255146">)</span><span class="op" id="4255147">;</span>&nbsp;<span class="ident" id="4255149">j</span>&nbsp;<span class="op" id="4255151">&lt;</span>&nbsp;<span class="ident" id="4255153">huffmanNumChunks</span><span class="op" id="4255169">;</span>&nbsp;<span class="ident" id="4255171">j</span><span class="op" id="4255172">++</span>&nbsp;<span class="op" id="4255175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255181">reverse</span>&nbsp;<span class="op" id="4255189">:=</span>&nbsp;<span class="builtintype" id="4255192">int</span><span class="op" id="4255195">(</span><span class="ident" id="4255196">reverseByte</span><span class="op" id="4255207">[</span><span class="ident" id="4255208">j</span><span class="op" id="4255209">&gt;&gt;</span><span class="num" id="4255211">8</span><span class="op" id="4255212">]</span><span class="op" id="4255213">)</span>&nbsp;<span class="op" id="4255215">|</span>&nbsp;<span class="builtintype" id="4255217">int</span><span class="op" id="4255220">(</span><span class="ident" id="4255221">reverseByte</span><span class="op" id="4255232">[</span><span class="ident" id="4255233">j</span><span class="op" id="4255234">&amp;</span><span class="num" id="4255235">0xff</span><span class="op" id="4255239">]</span><span class="op" id="4255240">)</span><span class="op" id="4255241">&lt;&lt;</span><span class="num" id="4255243">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255249">reverse</span>&nbsp;<span class="op" id="4255257">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4255261">uint</span><span class="op" id="4255265">(</span><span class="num" id="4255266">16</span>&nbsp;<span class="op" id="4255269">-</span>&nbsp;<span class="ident" id="4255271">huffmanChunkBits</span><span class="op" id="4255287">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255293">off</span>&nbsp;<span class="op" id="4255297">:=</span>&nbsp;<span class="ident" id="4255300">j</span>&nbsp;<span class="op" id="4255302">-</span>&nbsp;<span class="builtintype" id="4255304">uint</span><span class="op" id="4255308">(</span><span class="ident" id="4255309">link</span><span class="op" id="4255313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255319">h</span><span class="op" id="4255320">.</span><span class="ident" id="4255321">chunks</span><span class="op" id="4255327">[</span><span class="ident" id="4255328">reverse</span><span class="op" id="4255335">]</span>&nbsp;<span class="op" id="4255337">=</span>&nbsp;<span class="builtintype" id="4255339">uint32</span><span class="op" id="4255345">(</span><span class="ident" id="4255346">off</span><span class="op" id="4255349">&lt;&lt;</span><span class="ident" id="4255351">huffmanValueShift</span>&nbsp;<span class="op" id="4255369">+</span>&nbsp;<span class="builtintype" id="4255371">uint</span><span class="op" id="4255375">(</span><span class="ident" id="4255376">i</span><span class="op" id="4255377">)</span><span class="op" id="4255378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255384">h</span><span class="op" id="4255385">.</span><span class="ident" id="4255386">links</span><span class="op" id="4255391">[</span><span class="ident" id="4255392">off</span><span class="op" id="4255395">]</span>&nbsp;<span class="op" id="4255397">=</span>&nbsp;<span class="builtinfunc" id="4255399">make</span><span class="op" id="4255403">(</span><span class="op" id="4255404">[</span><span class="op" id="4255405">]</span><span class="builtintype" id="4255406">uint32</span><span class="op" id="4255412">,</span>&nbsp;<span class="num" id="4255414">1</span><span class="op" id="4255415">&lt;&lt;</span><span class="ident" id="4255417">linkBits</span><span class="op" id="4255425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255434">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255438">n</span>&nbsp;<span class="op" id="4255440">:=</span>&nbsp;<span class="ident" id="4255443">count</span><span class="op" id="4255448">[</span><span class="ident" id="4255449">i</span><span class="op" id="4255450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255454">nextcode</span><span class="op" id="4255462">[</span><span class="ident" id="4255463">i</span><span class="op" id="4255464">]</span>&nbsp;<span class="op" id="4255466">=</span>&nbsp;<span class="ident" id="4255468">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255475">code</span>&nbsp;<span class="op" id="4255480">+=</span>&nbsp;<span class="ident" id="4255483">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255487">code</span>&nbsp;<span class="op" id="4255492">&lt;&lt;=</span>&nbsp;<span class="num" id="4255496">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255499">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255503">for</span>&nbsp;<span class="ident" id="4255507">i</span><span class="op" id="4255508">,</span>&nbsp;<span class="ident" id="4255510">n</span>&nbsp;<span class="op" id="4255512">:=</span>&nbsp;<span class="keyword" id="4255515">range</span>&nbsp;<span class="ident" id="4255521">bits</span>&nbsp;<span class="op" id="4255526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255530">if</span>&nbsp;<span class="ident" id="4255533">n</span>&nbsp;<span class="op" id="4255535">==</span>&nbsp;<span class="num" id="4255538">0</span>&nbsp;<span class="op" id="4255540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255545">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255556">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255560">code</span>&nbsp;<span class="op" id="4255565">:=</span>&nbsp;<span class="ident" id="4255568">nextcode</span><span class="op" id="4255576">[</span><span class="ident" id="4255577">n</span><span class="op" id="4255578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255582">nextcode</span><span class="op" id="4255590">[</span><span class="ident" id="4255591">n</span><span class="op" id="4255592">]</span><span class="op" id="4255593">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255598">chunk</span>&nbsp;<span class="op" id="4255604">:=</span>&nbsp;<span class="builtintype" id="4255607">uint32</span><span class="op" id="4255613">(</span><span class="ident" id="4255614">i</span><span class="op" id="4255615">&lt;&lt;</span><span class="ident" id="4255617">huffmanValueShift</span>&nbsp;<span class="op" id="4255635">|</span>&nbsp;<span class="ident" id="4255637">n</span><span class="op" id="4255638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255642">reverse</span>&nbsp;<span class="op" id="4255650">:=</span>&nbsp;<span class="builtintype" id="4255653">int</span><span class="op" id="4255656">(</span><span class="ident" id="4255657">reverseByte</span><span class="op" id="4255668">[</span><span class="ident" id="4255669">code</span><span class="op" id="4255673">&gt;&gt;</span><span class="num" id="4255675">8</span><span class="op" id="4255676">]</span><span class="op" id="4255677">)</span>&nbsp;<span class="op" id="4255679">|</span>&nbsp;<span class="builtintype" id="4255681">int</span><span class="op" id="4255684">(</span><span class="ident" id="4255685">reverseByte</span><span class="op" id="4255696">[</span><span class="ident" id="4255697">code</span><span class="op" id="4255701">&amp;</span><span class="num" id="4255702">0xff</span><span class="op" id="4255706">]</span><span class="op" id="4255707">)</span><span class="op" id="4255708">&lt;&lt;</span><span class="num" id="4255710">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255714">reverse</span>&nbsp;<span class="op" id="4255722">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="4255726">uint</span><span class="op" id="4255730">(</span><span class="num" id="4255731">16</span>&nbsp;<span class="op" id="4255734">-</span>&nbsp;<span class="ident" id="4255736">n</span><span class="op" id="4255737">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255741">if</span>&nbsp;<span class="ident" id="4255744">n</span>&nbsp;<span class="op" id="4255746">&lt;=</span>&nbsp;<span class="ident" id="4255749">huffmanChunkBits</span>&nbsp;<span class="op" id="4255766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255771">for</span>&nbsp;<span class="ident" id="4255775">off</span>&nbsp;<span class="op" id="4255779">:=</span>&nbsp;<span class="ident" id="4255782">reverse</span><span class="op" id="4255789">;</span>&nbsp;<span class="ident" id="4255791">off</span>&nbsp;<span class="op" id="4255795">&lt;</span>&nbsp;<span class="ident" id="4255797">huffmanNumChunks</span><span class="op" id="4255813">;</span>&nbsp;<span class="ident" id="4255815">off</span>&nbsp;<span class="op" id="4255819">+=</span>&nbsp;<span class="num" id="4255822">1</span>&nbsp;<span class="op" id="4255824">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4255827">uint</span><span class="op" id="4255831">(</span><span class="ident" id="4255832">n</span><span class="op" id="4255833">)</span>&nbsp;<span class="op" id="4255835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255841">h</span><span class="op" id="4255842">.</span><span class="ident" id="4255843">chunks</span><span class="op" id="4255849">[</span><span class="ident" id="4255850">off</span><span class="op" id="4255853">]</span>&nbsp;<span class="op" id="4255855">=</span>&nbsp;<span class="ident" id="4255857">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4255870">}</span>&nbsp;<span class="keyword" id="4255872">else</span>&nbsp;<span class="op" id="4255877">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4255882">value</span>&nbsp;<span class="op" id="4255888">:=</span>&nbsp;<span class="ident" id="4255891">h</span><span class="op" id="4255892">.</span><span class="ident" id="4255893">chunks</span><span class="op" id="4255899">[</span><span class="ident" id="4255900">reverse</span><span class="op" id="4255907">&amp;</span><span class="op" id="4255908">(</span><span class="ident" id="4255909">huffmanNumChunks</span><span class="op" id="4255925">-</span><span class="num" id="4255926">1</span><span class="op" id="4255927">)</span><span class="op" id="4255928">]</span>&nbsp;<span class="op" id="4255930">&gt;&gt;</span>&nbsp;<span class="ident" id="4255933">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255954">if</span>&nbsp;<span class="ident" id="4255957">value</span>&nbsp;<span class="op" id="4255963">&gt;=</span>&nbsp;<span class="builtintype" id="4255966">uint32</span><span class="op" id="4255972">(</span><span class="builtinfunc" id="4255973">len</span><span class="op" id="4255976">(</span><span class="ident" id="4255977">h</span><span class="op" id="4255978">.</span><span class="ident" id="4255979">links</span><span class="op" id="4255984">)</span><span class="op" id="4255985">)</span>&nbsp;<span class="op" id="4255987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4255993">return</span>&nbsp;<span class="builtintype" id="4256000">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256014">linktab</span>&nbsp;<span class="op" id="4256022">:=</span>&nbsp;<span class="ident" id="4256025">h</span><span class="op" id="4256026">.</span><span class="ident" id="4256027">links</span><span class="op" id="4256032">[</span><span class="ident" id="4256033">value</span><span class="op" id="4256038">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256043">reverse</span>&nbsp;<span class="op" id="4256051">&gt;&gt;=</span>&nbsp;<span class="ident" id="4256055">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256075">for</span>&nbsp;<span class="ident" id="4256079">off</span>&nbsp;<span class="op" id="4256083">:=</span>&nbsp;<span class="ident" id="4256086">reverse</span><span class="op" id="4256093">;</span>&nbsp;<span class="ident" id="4256095">off</span>&nbsp;<span class="op" id="4256099">&lt;</span>&nbsp;<span class="ident" id="4256101">numLinks</span><span class="op" id="4256109">;</span>&nbsp;<span class="ident" id="4256111">off</span>&nbsp;<span class="op" id="4256115">+=</span>&nbsp;<span class="num" id="4256118">1</span>&nbsp;<span class="op" id="4256120">&lt;&lt;</span>&nbsp;<span class="builtintype" id="4256123">uint</span><span class="op" id="4256127">(</span><span class="ident" id="4256128">n</span><span class="op" id="4256129">-</span><span class="ident" id="4256130">huffmanChunkBits</span><span class="op" id="4256146">)</span>&nbsp;<span class="op" id="4256148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256154">linktab</span><span class="op" id="4256161">[</span><span class="ident" id="4256162">off</span><span class="op" id="4256165">]</span>&nbsp;<span class="op" id="4256167">=</span>&nbsp;<span class="ident" id="4256169">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256182">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4256188">return</span>&nbsp;<span class="builtintype" id="4256195">true</span><br>
<span class="lineno"></span><span class="op" id="4256200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4256203">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="4256253">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="4256312">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="4256363">type</span>&nbsp;<span class="ident" id="4256368">Reader</span>&nbsp;<span class="keyword" id="4256375">interface</span>&nbsp;<span class="op" id="4256385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256388">io</span><span class="op" id="4256390">.</span><span class="ident" id="4256391">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256399">io</span><span class="op" id="4256401">.</span><span class="ident" id="4256402">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="4256413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4256416">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4256437">type</span>&nbsp;<span class="ident" id="4256442">decompressor</span>&nbsp;<span class="keyword" id="4256455">struct</span>&nbsp;<span class="op" id="4256462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256465">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256483">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256491">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256499">roffset</span>&nbsp;<span class="ident" id="4256507">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256514">woffset</span>&nbsp;<span class="ident" id="4256522">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256530">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256559">b</span>&nbsp;&nbsp;<span class="builtintype" id="4256562">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256570">nb</span>&nbsp;<span class="builtintype" id="4256573">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256580">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256631">h1</span><span class="op" id="4256633">,</span>&nbsp;<span class="ident" id="4256635">h2</span>&nbsp;<span class="ident" id="4256638">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256655">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256703">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4256712">*</span><span class="op" id="4256713">[</span><span class="ident" id="4256714">maxLit</span>&nbsp;<span class="op" id="4256721">+</span>&nbsp;<span class="ident" id="4256723">maxDist</span><span class="op" id="4256730">]</span><span class="builtintype" id="4256731">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256736">codebits</span>&nbsp;<span class="op" id="4256745">*</span><span class="op" id="4256746">[</span><span class="ident" id="4256747">numCodes</span><span class="op" id="4256755">]</span><span class="builtintype" id="4256756">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256762">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256790">hist</span>&nbsp;&nbsp;<span class="op" id="4256796">*</span><span class="op" id="4256797">[</span><span class="ident" id="4256798">maxHist</span><span class="op" id="4256805">]</span><span class="builtintype" id="4256806">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256812">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4256818">int</span>&nbsp;&nbsp;<span class="comment" id="4256823">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256861">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4256867">int</span>&nbsp;&nbsp;<span class="comment" id="4256872">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4256908">hfull</span>&nbsp;<span class="builtintype" id="4256914">bool</span>&nbsp;<span class="comment" id="4256919">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4256956">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257007">buf</span>&nbsp;<span class="op" id="4257011">[</span><span class="num" id="4257012">4</span><span class="op" id="4257013">]</span><span class="builtintype" id="4257014">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257021">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257057">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257086">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257095">func</span><span class="op" id="4257099">(</span><span class="op" id="4257100">*</span><span class="ident" id="4257101">decompressor</span><span class="op" id="4257113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257116">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4257125">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257131">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4257140">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257147">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4257156">[</span><span class="op" id="4257157">]</span><span class="builtintype" id="4257158">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257164">hl</span><span class="op" id="4257166">,</span>&nbsp;<span class="ident" id="4257168">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4257173">*</span><span class="ident" id="4257174">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257190">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="4257199">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257204">copyDist</span>&nbsp;<span class="builtintype" id="4257213">int</span><br>
<span class="lineno"></span><span class="op" id="4257217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4257220">func</span>&nbsp;<span class="op" id="4257225">(</span><span class="ident" id="4257226">f</span>&nbsp;<span class="op" id="4257228">*</span><span class="ident" id="4257229">decompressor</span><span class="op" id="4257241">)</span>&nbsp;<span class="ident" id="4257243">nextBlock</span><span class="op" id="4257252">(</span><span class="op" id="4257253">)</span>&nbsp;<span class="op" id="4257255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257258">if</span>&nbsp;<span class="ident" id="4257261">f</span><span class="op" id="4257262">.</span><span class="ident" id="4257263">final</span>&nbsp;<span class="op" id="4257269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257273">if</span>&nbsp;<span class="ident" id="4257276">f</span><span class="op" id="4257277">.</span><span class="ident" id="4257278">hw</span>&nbsp;<span class="op" id="4257281">!=</span>&nbsp;<span class="ident" id="4257284">f</span><span class="op" id="4257285">.</span><span class="ident" id="4257286">hp</span>&nbsp;<span class="op" id="4257289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257294">f</span><span class="op" id="4257295">.</span><span class="ident" id="4257296">flush</span><span class="op" id="4257301">(</span><span class="op" id="4257302">(</span><span class="op" id="4257303">*</span><span class="ident" id="4257304">decompressor</span><span class="op" id="4257316">)</span><span class="op" id="4257317">.</span><span class="ident" id="4257318">nextBlock</span><span class="op" id="4257327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257332">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257345">f</span><span class="op" id="4257346">.</span><span class="ident" id="4257347">err</span>&nbsp;<span class="op" id="4257351">=</span>&nbsp;<span class="ident" id="4257353">io</span><span class="op" id="4257355">.</span><span class="ident" id="4257356">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257362">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257373">for</span>&nbsp;<span class="ident" id="4257377">f</span><span class="op" id="4257378">.</span><span class="ident" id="4257379">nb</span>&nbsp;<span class="op" id="4257382">&lt;</span>&nbsp;<span class="num" id="4257384">1</span><span class="op" id="4257385">+</span><span class="num" id="4257386">2</span>&nbsp;<span class="op" id="4257388">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257392">if</span>&nbsp;<span class="ident" id="4257395">f</span><span class="op" id="4257396">.</span><span class="ident" id="4257397">err</span>&nbsp;<span class="op" id="4257401">=</span>&nbsp;<span class="ident" id="4257403">f</span><span class="op" id="4257404">.</span><span class="ident" id="4257405">moreBits</span><span class="op" id="4257413">(</span><span class="op" id="4257414">)</span><span class="op" id="4257415">;</span>&nbsp;<span class="ident" id="4257417">f</span><span class="op" id="4257418">.</span><span class="ident" id="4257419">err</span>&nbsp;<span class="op" id="4257423">!=</span>&nbsp;<span class="builtintype" id="4257426">nil</span>&nbsp;<span class="op" id="4257430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257435">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257450">f</span><span class="op" id="4257451">.</span><span class="ident" id="4257452">final</span>&nbsp;<span class="op" id="4257458">=</span>&nbsp;<span class="ident" id="4257460">f</span><span class="op" id="4257461">.</span><span class="ident" id="4257462">b</span><span class="op" id="4257463">&amp;</span><span class="num" id="4257464">1</span>&nbsp;<span class="op" id="4257466">==</span>&nbsp;<span class="num" id="4257469">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257472">f</span><span class="op" id="4257473">.</span><span class="ident" id="4257474">b</span>&nbsp;<span class="op" id="4257476">&gt;&gt;=</span>&nbsp;<span class="num" id="4257480">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257483">typ</span>&nbsp;<span class="op" id="4257487">:=</span>&nbsp;<span class="ident" id="4257490">f</span><span class="op" id="4257491">.</span><span class="ident" id="4257492">b</span>&nbsp;<span class="op" id="4257494">&amp;</span>&nbsp;<span class="num" id="4257496">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257499">f</span><span class="op" id="4257500">.</span><span class="ident" id="4257501">b</span>&nbsp;<span class="op" id="4257503">&gt;&gt;=</span>&nbsp;<span class="num" id="4257507">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257510">f</span><span class="op" id="4257511">.</span><span class="ident" id="4257512">nb</span>&nbsp;<span class="op" id="4257515">-=</span>&nbsp;<span class="num" id="4257518">1</span>&nbsp;<span class="op" id="4257520">+</span>&nbsp;<span class="num" id="4257522">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257525">switch</span>&nbsp;<span class="ident" id="4257532">typ</span>&nbsp;<span class="op" id="4257536">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257539">case</span>&nbsp;<span class="num" id="4257544">0</span><span class="op" id="4257545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257549">f</span><span class="op" id="4257550">.</span><span class="ident" id="4257551">dataBlock</span><span class="op" id="4257560">(</span><span class="op" id="4257561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257564">case</span>&nbsp;<span class="num" id="4257569">1</span><span class="op" id="4257570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257574">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257612">f</span><span class="op" id="4257613">.</span><span class="ident" id="4257614">hl</span>&nbsp;<span class="op" id="4257617">=</span>&nbsp;<span class="op" id="4257619">&amp;</span><span class="ident" id="4257620">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257642">f</span><span class="op" id="4257643">.</span><span class="ident" id="4257644">hd</span>&nbsp;<span class="op" id="4257647">=</span>&nbsp;<span class="builtintype" id="4257649">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257655">f</span><span class="op" id="4257656">.</span><span class="ident" id="4257657">huffmanBlock</span><span class="op" id="4257669">(</span><span class="op" id="4257670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257673">case</span>&nbsp;<span class="num" id="4257678">2</span><span class="op" id="4257679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257683">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257723">if</span>&nbsp;<span class="ident" id="4257726">f</span><span class="op" id="4257727">.</span><span class="ident" id="4257728">err</span>&nbsp;<span class="op" id="4257732">=</span>&nbsp;<span class="ident" id="4257734">f</span><span class="op" id="4257735">.</span><span class="ident" id="4257736">readHuffman</span><span class="op" id="4257747">(</span><span class="op" id="4257748">)</span><span class="op" id="4257749">;</span>&nbsp;<span class="ident" id="4257751">f</span><span class="op" id="4257752">.</span><span class="ident" id="4257753">err</span>&nbsp;<span class="op" id="4257757">!=</span>&nbsp;<span class="builtintype" id="4257760">nil</span>&nbsp;<span class="op" id="4257764">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257769">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257781">f</span><span class="op" id="4257782">.</span><span class="ident" id="4257783">hl</span>&nbsp;<span class="op" id="4257786">=</span>&nbsp;<span class="op" id="4257788">&amp;</span><span class="ident" id="4257789">f</span><span class="op" id="4257790">.</span><span class="ident" id="4257791">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257796">f</span><span class="op" id="4257797">.</span><span class="ident" id="4257798">hd</span>&nbsp;<span class="op" id="4257801">=</span>&nbsp;<span class="op" id="4257803">&amp;</span><span class="ident" id="4257804">f</span><span class="op" id="4257805">.</span><span class="ident" id="4257806">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257811">f</span><span class="op" id="4257812">.</span><span class="ident" id="4257813">huffmanBlock</span><span class="op" id="4257825">(</span><span class="op" id="4257826">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257829">default</span><span class="op" id="4257836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4257840">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257860">f</span><span class="op" id="4257861">.</span><span class="ident" id="4257862">err</span>&nbsp;<span class="op" id="4257866">=</span>&nbsp;<span class="ident" id="4257868">CorruptInputError</span><span class="op" id="4257885">(</span><span class="ident" id="4257886">f</span><span class="op" id="4257887">.</span><span class="ident" id="4257888">roffset</span><span class="op" id="4257895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257898">}</span><br>
<span class="lineno"></span><span class="op" id="4257900">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="4257903">func</span>&nbsp;<span class="op" id="4257908">(</span><span class="ident" id="4257909">f</span>&nbsp;<span class="op" id="4257911">*</span><span class="ident" id="4257912">decompressor</span><span class="op" id="4257924">)</span>&nbsp;<span class="ident" id="4257926">Read</span><span class="op" id="4257930">(</span><span class="ident" id="4257931">b</span>&nbsp;<span class="op" id="4257933">[</span><span class="op" id="4257934">]</span><span class="builtintype" id="4257935">byte</span><span class="op" id="4257939">)</span>&nbsp;<span class="op" id="4257941">(</span><span class="builtintype" id="4257942">int</span><span class="op" id="4257945">,</span>&nbsp;<span class="builtintype" id="4257947">error</span><span class="op" id="4257952">)</span>&nbsp;<span class="op" id="4257954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257957">for</span>&nbsp;<span class="op" id="4257961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4257965">if</span>&nbsp;<span class="builtinfunc" id="4257968">len</span><span class="op" id="4257971">(</span><span class="ident" id="4257972">f</span><span class="op" id="4257973">.</span><span class="ident" id="4257974">toRead</span><span class="op" id="4257980">)</span>&nbsp;<span class="op" id="4257982">&gt;</span>&nbsp;<span class="num" id="4257984">0</span>&nbsp;<span class="op" id="4257986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4257991">n</span>&nbsp;<span class="op" id="4257993">:=</span>&nbsp;<span class="builtinfunc" id="4257996">copy</span><span class="op" id="4258000">(</span><span class="ident" id="4258001">b</span><span class="op" id="4258002">,</span>&nbsp;<span class="ident" id="4258004">f</span><span class="op" id="4258005">.</span><span class="ident" id="4258006">toRead</span><span class="op" id="4258012">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258017">f</span><span class="op" id="4258018">.</span><span class="ident" id="4258019">toRead</span>&nbsp;<span class="op" id="4258026">=</span>&nbsp;<span class="ident" id="4258028">f</span><span class="op" id="4258029">.</span><span class="ident" id="4258030">toRead</span><span class="op" id="4258036">[</span><span class="ident" id="4258037">n</span><span class="op" id="4258038">:</span><span class="op" id="4258039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258044">return</span>&nbsp;<span class="ident" id="4258051">n</span><span class="op" id="4258052">,</span>&nbsp;<span class="builtintype" id="4258054">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258064">if</span>&nbsp;<span class="ident" id="4258067">f</span><span class="op" id="4258068">.</span><span class="ident" id="4258069">err</span>&nbsp;<span class="op" id="4258073">!=</span>&nbsp;<span class="builtintype" id="4258076">nil</span>&nbsp;<span class="op" id="4258080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258085">return</span>&nbsp;<span class="num" id="4258092">0</span><span class="op" id="4258093">,</span>&nbsp;<span class="ident" id="4258095">f</span><span class="op" id="4258096">.</span><span class="ident" id="4258097">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258107">f</span><span class="op" id="4258108">.</span><span class="ident" id="4258109">step</span><span class="op" id="4258113">(</span><span class="ident" id="4258114">f</span><span class="op" id="4258115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258118">}</span><br>
<span class="lineno"></span><span class="op" id="4258120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="4258123">func</span>&nbsp;<span class="op" id="4258128">(</span><span class="ident" id="4258129">f</span>&nbsp;<span class="op" id="4258131">*</span><span class="ident" id="4258132">decompressor</span><span class="op" id="4258144">)</span>&nbsp;<span class="ident" id="4258146">Close</span><span class="op" id="4258151">(</span><span class="op" id="4258152">)</span>&nbsp;<span class="builtintype" id="4258154">error</span>&nbsp;<span class="op" id="4258160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258163">if</span>&nbsp;<span class="ident" id="4258166">f</span><span class="op" id="4258167">.</span><span class="ident" id="4258168">err</span>&nbsp;<span class="op" id="4258172">==</span>&nbsp;<span class="ident" id="4258175">io</span><span class="op" id="4258177">.</span><span class="ident" id="4258178">EOF</span>&nbsp;<span class="op" id="4258182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258186">return</span>&nbsp;<span class="builtintype" id="4258193">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258201">return</span>&nbsp;<span class="ident" id="4258208">f</span><span class="op" id="4258209">.</span><span class="ident" id="4258210">err</span><br>
<span class="lineno">295</span><span class="op" id="4258214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4258217">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="4258244">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="4258287">var</span>&nbsp;<span class="ident" id="4258291">codeOrder</span>&nbsp;<span class="op" id="4258301">=</span>&nbsp;<span class="op" id="4258303">[</span><span class="op" id="4258304">...</span><span class="op" id="4258307">]</span><span class="builtintype" id="4258308">int</span><span class="op" id="4258311">{</span><span class="num" id="4258312">16</span><span class="op" id="4258314">,</span>&nbsp;<span class="num" id="4258316">17</span><span class="op" id="4258318">,</span>&nbsp;<span class="num" id="4258320">18</span><span class="op" id="4258322">,</span>&nbsp;<span class="num" id="4258324">0</span><span class="op" id="4258325">,</span>&nbsp;<span class="num" id="4258327">8</span><span class="op" id="4258328">,</span>&nbsp;<span class="num" id="4258330">7</span><span class="op" id="4258331">,</span>&nbsp;<span class="num" id="4258333">9</span><span class="op" id="4258334">,</span>&nbsp;<span class="num" id="4258336">6</span><span class="op" id="4258337">,</span>&nbsp;<span class="num" id="4258339">10</span><span class="op" id="4258341">,</span>&nbsp;<span class="num" id="4258343">5</span><span class="op" id="4258344">,</span>&nbsp;<span class="num" id="4258346">11</span><span class="op" id="4258348">,</span>&nbsp;<span class="num" id="4258350">4</span><span class="op" id="4258351">,</span>&nbsp;<span class="num" id="4258353">12</span><span class="op" id="4258355">,</span>&nbsp;<span class="num" id="4258357">3</span><span class="op" id="4258358">,</span>&nbsp;<span class="num" id="4258360">13</span><span class="op" id="4258362">,</span>&nbsp;<span class="num" id="4258364">2</span><span class="op" id="4258365">,</span>&nbsp;<span class="num" id="4258367">14</span><span class="op" id="4258369">,</span>&nbsp;<span class="num" id="4258371">1</span><span class="op" id="4258372">,</span>&nbsp;<span class="num" id="4258374">15</span><span class="op" id="4258376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258379">func</span>&nbsp;<span class="op" id="4258384">(</span><span class="ident" id="4258385">f</span>&nbsp;<span class="op" id="4258387">*</span><span class="ident" id="4258388">decompressor</span><span class="op" id="4258400">)</span>&nbsp;<span class="ident" id="4258402">readHuffman</span><span class="op" id="4258413">(</span><span class="op" id="4258414">)</span>&nbsp;<span class="builtintype" id="4258416">error</span>&nbsp;<span class="op" id="4258422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258425">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258458">for</span>&nbsp;<span class="ident" id="4258462">f</span><span class="op" id="4258463">.</span><span class="ident" id="4258464">nb</span>&nbsp;<span class="op" id="4258467">&lt;</span>&nbsp;<span class="num" id="4258469">5</span><span class="op" id="4258470">+</span><span class="num" id="4258471">5</span><span class="op" id="4258472">+</span><span class="num" id="4258473">4</span>&nbsp;<span class="op" id="4258475">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258479">if</span>&nbsp;<span class="ident" id="4258482">err</span>&nbsp;<span class="op" id="4258486">:=</span>&nbsp;<span class="ident" id="4258489">f</span><span class="op" id="4258490">.</span><span class="ident" id="4258491">moreBits</span><span class="op" id="4258499">(</span><span class="op" id="4258500">)</span><span class="op" id="4258501">;</span>&nbsp;<span class="ident" id="4258503">err</span>&nbsp;<span class="op" id="4258507">!=</span>&nbsp;<span class="builtintype" id="4258510">nil</span>&nbsp;<span class="op" id="4258514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258519">return</span>&nbsp;<span class="ident" id="4258526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258538">nlit</span>&nbsp;<span class="op" id="4258543">:=</span>&nbsp;<span class="builtintype" id="4258546">int</span><span class="op" id="4258549">(</span><span class="ident" id="4258550">f</span><span class="op" id="4258551">.</span><span class="ident" id="4258552">b</span><span class="op" id="4258553">&amp;</span><span class="num" id="4258554">0x1F</span><span class="op" id="4258558">)</span>&nbsp;<span class="op" id="4258560">+</span>&nbsp;<span class="num" id="4258562">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258567">if</span>&nbsp;<span class="ident" id="4258570">nlit</span>&nbsp;<span class="op" id="4258575">&gt;</span>&nbsp;<span class="ident" id="4258577">maxLit</span>&nbsp;<span class="op" id="4258584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258588">return</span>&nbsp;<span class="ident" id="4258595">CorruptInputError</span><span class="op" id="4258612">(</span><span class="ident" id="4258613">f</span><span class="op" id="4258614">.</span><span class="ident" id="4258615">roffset</span><span class="op" id="4258622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258628">f</span><span class="op" id="4258629">.</span><span class="ident" id="4258630">b</span>&nbsp;<span class="op" id="4258632">&gt;&gt;=</span>&nbsp;<span class="num" id="4258636">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258639">ndist</span>&nbsp;<span class="op" id="4258645">:=</span>&nbsp;<span class="builtintype" id="4258648">int</span><span class="op" id="4258651">(</span><span class="ident" id="4258652">f</span><span class="op" id="4258653">.</span><span class="ident" id="4258654">b</span><span class="op" id="4258655">&amp;</span><span class="num" id="4258656">0x1F</span><span class="op" id="4258660">)</span>&nbsp;<span class="op" id="4258662">+</span>&nbsp;<span class="num" id="4258664">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258667">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258712">f</span><span class="op" id="4258713">.</span><span class="ident" id="4258714">b</span>&nbsp;<span class="op" id="4258716">&gt;&gt;=</span>&nbsp;<span class="num" id="4258720">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258723">nclen</span>&nbsp;<span class="op" id="4258729">:=</span>&nbsp;<span class="builtintype" id="4258732">int</span><span class="op" id="4258735">(</span><span class="ident" id="4258736">f</span><span class="op" id="4258737">.</span><span class="ident" id="4258738">b</span><span class="op" id="4258739">&amp;</span><span class="num" id="4258740">0xF</span><span class="op" id="4258743">)</span>&nbsp;<span class="op" id="4258745">+</span>&nbsp;<span class="num" id="4258747">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258750">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258796">f</span><span class="op" id="4258797">.</span><span class="ident" id="4258798">b</span>&nbsp;<span class="op" id="4258800">&gt;&gt;=</span>&nbsp;<span class="num" id="4258804">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4258807">f</span><span class="op" id="4258808">.</span><span class="ident" id="4258809">nb</span>&nbsp;<span class="op" id="4258812">-=</span>&nbsp;<span class="num" id="4258815">5</span>&nbsp;<span class="op" id="4258817">+</span>&nbsp;<span class="num" id="4258819">5</span>&nbsp;<span class="op" id="4258821">+</span>&nbsp;<span class="num" id="4258823">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4258827">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258892">for</span>&nbsp;<span class="ident" id="4258896">i</span>&nbsp;<span class="op" id="4258898">:=</span>&nbsp;<span class="num" id="4258901">0</span><span class="op" id="4258902">;</span>&nbsp;<span class="ident" id="4258904">i</span>&nbsp;<span class="op" id="4258906">&lt;</span>&nbsp;<span class="ident" id="4258908">nclen</span><span class="op" id="4258913">;</span>&nbsp;<span class="ident" id="4258915">i</span><span class="op" id="4258916">++</span>&nbsp;<span class="op" id="4258919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258923">for</span>&nbsp;<span class="ident" id="4258927">f</span><span class="op" id="4258928">.</span><span class="ident" id="4258929">nb</span>&nbsp;<span class="op" id="4258932">&lt;</span>&nbsp;<span class="num" id="4258934">3</span>&nbsp;<span class="op" id="4258936">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258941">if</span>&nbsp;<span class="ident" id="4258944">err</span>&nbsp;<span class="op" id="4258948">:=</span>&nbsp;<span class="ident" id="4258951">f</span><span class="op" id="4258952">.</span><span class="ident" id="4258953">moreBits</span><span class="op" id="4258961">(</span><span class="op" id="4258962">)</span><span class="op" id="4258963">;</span>&nbsp;<span class="ident" id="4258965">err</span>&nbsp;<span class="op" id="4258969">!=</span>&nbsp;<span class="builtintype" id="4258972">nil</span>&nbsp;<span class="op" id="4258976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4258982">return</span>&nbsp;<span class="ident" id="4258989">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4258996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259004">f</span><span class="op" id="4259005">.</span><span class="ident" id="4259006">codebits</span><span class="op" id="4259014">[</span><span class="ident" id="4259015">codeOrder</span><span class="op" id="4259024">[</span><span class="ident" id="4259025">i</span><span class="op" id="4259026">]</span><span class="op" id="4259027">]</span>&nbsp;<span class="op" id="4259029">=</span>&nbsp;<span class="builtintype" id="4259031">int</span><span class="op" id="4259034">(</span><span class="ident" id="4259035">f</span><span class="op" id="4259036">.</span><span class="ident" id="4259037">b</span>&nbsp;<span class="op" id="4259039">&amp;</span>&nbsp;<span class="num" id="4259041">0x7</span><span class="op" id="4259044">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259048">f</span><span class="op" id="4259049">.</span><span class="ident" id="4259050">b</span>&nbsp;<span class="op" id="4259052">&gt;&gt;=</span>&nbsp;<span class="num" id="4259056">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259060">f</span><span class="op" id="4259061">.</span><span class="ident" id="4259062">nb</span>&nbsp;<span class="op" id="4259065">-=</span>&nbsp;<span class="num" id="4259068">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259074">for</span>&nbsp;<span class="ident" id="4259078">i</span>&nbsp;<span class="op" id="4259080">:=</span>&nbsp;<span class="ident" id="4259083">nclen</span><span class="op" id="4259088">;</span>&nbsp;<span class="ident" id="4259090">i</span>&nbsp;<span class="op" id="4259092">&lt;</span>&nbsp;<span class="builtinfunc" id="4259094">len</span><span class="op" id="4259097">(</span><span class="ident" id="4259098">codeOrder</span><span class="op" id="4259107">)</span><span class="op" id="4259108">;</span>&nbsp;<span class="ident" id="4259110">i</span><span class="op" id="4259111">++</span>&nbsp;<span class="op" id="4259114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259118">f</span><span class="op" id="4259119">.</span><span class="ident" id="4259120">codebits</span><span class="op" id="4259128">[</span><span class="ident" id="4259129">codeOrder</span><span class="op" id="4259138">[</span><span class="ident" id="4259139">i</span><span class="op" id="4259140">]</span><span class="op" id="4259141">]</span>&nbsp;<span class="op" id="4259143">=</span>&nbsp;<span class="num" id="4259145">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259151">if</span>&nbsp;<span class="op" id="4259154">!</span><span class="ident" id="4259155">f</span><span class="op" id="4259156">.</span><span class="ident" id="4259157">h1</span><span class="op" id="4259159">.</span><span class="ident" id="4259160">init</span><span class="op" id="4259164">(</span><span class="ident" id="4259165">f</span><span class="op" id="4259166">.</span><span class="ident" id="4259167">codebits</span><span class="op" id="4259175">[</span><span class="num" id="4259176">0</span><span class="op" id="4259177">:</span><span class="op" id="4259178">]</span><span class="op" id="4259179">)</span>&nbsp;<span class="op" id="4259181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259185">return</span>&nbsp;<span class="ident" id="4259192">CorruptInputError</span><span class="op" id="4259209">(</span><span class="ident" id="4259210">f</span><span class="op" id="4259211">.</span><span class="ident" id="4259212">roffset</span><span class="op" id="4259219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259226">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259279">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259319">for</span>&nbsp;<span class="ident" id="4259323">i</span><span class="op" id="4259324">,</span>&nbsp;<span class="ident" id="4259326">n</span>&nbsp;<span class="op" id="4259328">:=</span>&nbsp;<span class="num" id="4259331">0</span><span class="op" id="4259332">,</span>&nbsp;<span class="ident" id="4259334">nlit</span><span class="op" id="4259338">+</span><span class="ident" id="4259339">ndist</span><span class="op" id="4259344">;</span>&nbsp;<span class="ident" id="4259346">i</span>&nbsp;<span class="op" id="4259348">&lt;</span>&nbsp;<span class="ident" id="4259350">n</span><span class="op" id="4259351">;</span>&nbsp;<span class="op" id="4259353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259357">x</span><span class="op" id="4259358">,</span>&nbsp;<span class="ident" id="4259360">err</span>&nbsp;<span class="op" id="4259364">:=</span>&nbsp;<span class="ident" id="4259367">f</span><span class="op" id="4259368">.</span><span class="ident" id="4259369">huffSym</span><span class="op" id="4259376">(</span><span class="op" id="4259377">&amp;</span><span class="ident" id="4259378">f</span><span class="op" id="4259379">.</span><span class="ident" id="4259380">h1</span><span class="op" id="4259382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259386">if</span>&nbsp;<span class="ident" id="4259389">err</span>&nbsp;<span class="op" id="4259393">!=</span>&nbsp;<span class="builtintype" id="4259396">nil</span>&nbsp;<span class="op" id="4259400">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259405">return</span>&nbsp;<span class="ident" id="4259412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259422">if</span>&nbsp;<span class="ident" id="4259425">x</span>&nbsp;<span class="op" id="4259427">&lt;</span>&nbsp;<span class="num" id="4259429">16</span>&nbsp;<span class="op" id="4259432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259437">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259458">f</span><span class="op" id="4259459">.</span><span class="ident" id="4259460">bits</span><span class="op" id="4259464">[</span><span class="ident" id="4259465">i</span><span class="op" id="4259466">]</span>&nbsp;<span class="op" id="4259468">=</span>&nbsp;<span class="ident" id="4259470">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259475">i</span><span class="op" id="4259476">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259482">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4259497">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259534">var</span>&nbsp;<span class="ident" id="4259538">rep</span>&nbsp;<span class="builtintype" id="4259542">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259548">var</span>&nbsp;<span class="ident" id="4259552">nb</span>&nbsp;<span class="builtintype" id="4259555">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259562">var</span>&nbsp;<span class="ident" id="4259566">b</span>&nbsp;<span class="builtintype" id="4259568">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259574">switch</span>&nbsp;<span class="ident" id="4259581">x</span>&nbsp;<span class="op" id="4259583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259587">default</span><span class="op" id="4259594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259599">return</span>&nbsp;<span class="ident" id="4259606">InternalError</span><span class="op" id="4259619">(</span><span class="string" id="4259620">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="4259644">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259648">case</span>&nbsp;<span class="num" id="4259653">16</span><span class="op" id="4259655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259660">rep</span>&nbsp;<span class="op" id="4259664">=</span>&nbsp;<span class="num" id="4259666">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259671">nb</span>&nbsp;<span class="op" id="4259674">=</span>&nbsp;<span class="num" id="4259676">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259681">if</span>&nbsp;<span class="ident" id="4259684">i</span>&nbsp;<span class="op" id="4259686">==</span>&nbsp;<span class="num" id="4259689">0</span>&nbsp;<span class="op" id="4259691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259697">return</span>&nbsp;<span class="ident" id="4259704">CorruptInputError</span><span class="op" id="4259721">(</span><span class="ident" id="4259722">f</span><span class="op" id="4259723">.</span><span class="ident" id="4259724">roffset</span><span class="op" id="4259731">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259741">b</span>&nbsp;<span class="op" id="4259743">=</span>&nbsp;<span class="ident" id="4259745">f</span><span class="op" id="4259746">.</span><span class="ident" id="4259747">bits</span><span class="op" id="4259751">[</span><span class="ident" id="4259752">i</span><span class="op" id="4259753">-</span><span class="num" id="4259754">1</span><span class="op" id="4259755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259759">case</span>&nbsp;<span class="num" id="4259764">17</span><span class="op" id="4259766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259771">rep</span>&nbsp;<span class="op" id="4259775">=</span>&nbsp;<span class="num" id="4259777">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259782">nb</span>&nbsp;<span class="op" id="4259785">=</span>&nbsp;<span class="num" id="4259787">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259792">b</span>&nbsp;<span class="op" id="4259794">=</span>&nbsp;<span class="num" id="4259796">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259800">case</span>&nbsp;<span class="num" id="4259805">18</span><span class="op" id="4259807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259812">rep</span>&nbsp;<span class="op" id="4259816">=</span>&nbsp;<span class="num" id="4259818">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259824">nb</span>&nbsp;<span class="op" id="4259827">=</span>&nbsp;<span class="num" id="4259829">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259834">b</span>&nbsp;<span class="op" id="4259836">=</span>&nbsp;<span class="num" id="4259838">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259846">for</span>&nbsp;<span class="ident" id="4259850">f</span><span class="op" id="4259851">.</span><span class="ident" id="4259852">nb</span>&nbsp;<span class="op" id="4259855">&lt;</span>&nbsp;<span class="ident" id="4259857">nb</span>&nbsp;<span class="op" id="4259860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259865">if</span>&nbsp;<span class="ident" id="4259868">err</span>&nbsp;<span class="op" id="4259872">:=</span>&nbsp;<span class="ident" id="4259875">f</span><span class="op" id="4259876">.</span><span class="ident" id="4259877">moreBits</span><span class="op" id="4259885">(</span><span class="op" id="4259886">)</span><span class="op" id="4259887">;</span>&nbsp;<span class="ident" id="4259889">err</span>&nbsp;<span class="op" id="4259893">!=</span>&nbsp;<span class="builtintype" id="4259896">nil</span>&nbsp;<span class="op" id="4259900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259906">return</span>&nbsp;<span class="ident" id="4259913">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259920">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259928">rep</span>&nbsp;<span class="op" id="4259932">+=</span>&nbsp;<span class="builtintype" id="4259935">int</span><span class="op" id="4259938">(</span><span class="ident" id="4259939">f</span><span class="op" id="4259940">.</span><span class="ident" id="4259941">b</span>&nbsp;<span class="op" id="4259943">&amp;</span>&nbsp;<span class="builtintype" id="4259945">uint32</span><span class="op" id="4259951">(</span><span class="num" id="4259952">1</span><span class="op" id="4259953">&lt;&lt;</span><span class="ident" id="4259955">nb</span><span class="op" id="4259957">-</span><span class="num" id="4259958">1</span><span class="op" id="4259959">)</span><span class="op" id="4259960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259964">f</span><span class="op" id="4259965">.</span><span class="ident" id="4259966">b</span>&nbsp;<span class="op" id="4259968">&gt;&gt;=</span>&nbsp;<span class="ident" id="4259972">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4259977">f</span><span class="op" id="4259978">.</span><span class="ident" id="4259979">nb</span>&nbsp;<span class="op" id="4259982">-=</span>&nbsp;<span class="ident" id="4259985">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4259990">if</span>&nbsp;<span class="ident" id="4259993">i</span><span class="op" id="4259994">+</span><span class="ident" id="4259995">rep</span>&nbsp;<span class="op" id="4259999">&gt;</span>&nbsp;<span class="ident" id="4260001">n</span>&nbsp;<span class="op" id="4260003">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260008">return</span>&nbsp;<span class="ident" id="4260015">CorruptInputError</span><span class="op" id="4260032">(</span><span class="ident" id="4260033">f</span><span class="op" id="4260034">.</span><span class="ident" id="4260035">roffset</span><span class="op" id="4260042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260050">for</span>&nbsp;<span class="ident" id="4260054">j</span>&nbsp;<span class="op" id="4260056">:=</span>&nbsp;<span class="num" id="4260059">0</span><span class="op" id="4260060">;</span>&nbsp;<span class="ident" id="4260062">j</span>&nbsp;<span class="op" id="4260064">&lt;</span>&nbsp;<span class="ident" id="4260066">rep</span><span class="op" id="4260069">;</span>&nbsp;<span class="ident" id="4260071">j</span><span class="op" id="4260072">++</span>&nbsp;<span class="op" id="4260075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260080">f</span><span class="op" id="4260081">.</span><span class="ident" id="4260082">bits</span><span class="op" id="4260086">[</span><span class="ident" id="4260087">i</span><span class="op" id="4260088">]</span>&nbsp;<span class="op" id="4260090">=</span>&nbsp;<span class="ident" id="4260092">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260097">i</span><span class="op" id="4260098">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260110">if</span>&nbsp;<span class="op" id="4260113">!</span><span class="ident" id="4260114">f</span><span class="op" id="4260115">.</span><span class="ident" id="4260116">h1</span><span class="op" id="4260118">.</span><span class="ident" id="4260119">init</span><span class="op" id="4260123">(</span><span class="ident" id="4260124">f</span><span class="op" id="4260125">.</span><span class="ident" id="4260126">bits</span><span class="op" id="4260130">[</span><span class="num" id="4260131">0</span><span class="op" id="4260132">:</span><span class="ident" id="4260133">nlit</span><span class="op" id="4260137">]</span><span class="op" id="4260138">)</span>&nbsp;<span class="op" id="4260140">||</span>&nbsp;<span class="op" id="4260143">!</span><span class="ident" id="4260144">f</span><span class="op" id="4260145">.</span><span class="ident" id="4260146">h2</span><span class="op" id="4260148">.</span><span class="ident" id="4260149">init</span><span class="op" id="4260153">(</span><span class="ident" id="4260154">f</span><span class="op" id="4260155">.</span><span class="ident" id="4260156">bits</span><span class="op" id="4260160">[</span><span class="ident" id="4260161">nlit</span><span class="op" id="4260165">:</span><span class="ident" id="4260166">nlit</span><span class="op" id="4260170">+</span><span class="ident" id="4260171">ndist</span><span class="op" id="4260176">]</span><span class="op" id="4260177">)</span>&nbsp;<span class="op" id="4260179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260183">return</span>&nbsp;<span class="ident" id="4260190">CorruptInputError</span><span class="op" id="4260207">(</span><span class="ident" id="4260208">f</span><span class="op" id="4260209">.</span><span class="ident" id="4260210">roffset</span><span class="op" id="4260217">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260224">return</span>&nbsp;<span class="builtintype" id="4260231">nil</span><br>
<span class="lineno"></span><span class="op" id="4260235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="4260238">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4260279">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4260341">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4260408">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="4260473">func</span>&nbsp;<span class="op" id="4260478">(</span><span class="ident" id="4260479">f</span>&nbsp;<span class="op" id="4260481">*</span><span class="ident" id="4260482">decompressor</span><span class="op" id="4260494">)</span>&nbsp;<span class="ident" id="4260496">huffmanBlock</span><span class="op" id="4260508">(</span><span class="op" id="4260509">)</span>&nbsp;<span class="op" id="4260511">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260514">for</span>&nbsp;<span class="op" id="4260518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260522">v</span><span class="op" id="4260523">,</span>&nbsp;<span class="ident" id="4260525">err</span>&nbsp;<span class="op" id="4260529">:=</span>&nbsp;<span class="ident" id="4260532">f</span><span class="op" id="4260533">.</span><span class="ident" id="4260534">huffSym</span><span class="op" id="4260541">(</span><span class="ident" id="4260542">f</span><span class="op" id="4260543">.</span><span class="ident" id="4260544">hl</span><span class="op" id="4260546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260550">if</span>&nbsp;<span class="ident" id="4260553">err</span>&nbsp;<span class="op" id="4260557">!=</span>&nbsp;<span class="builtintype" id="4260560">nil</span>&nbsp;<span class="op" id="4260564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260569">f</span><span class="op" id="4260570">.</span><span class="ident" id="4260571">err</span>&nbsp;<span class="op" id="4260575">=</span>&nbsp;<span class="ident" id="4260577">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260584">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260597">var</span>&nbsp;<span class="ident" id="4260601">n</span>&nbsp;<span class="builtintype" id="4260603">uint</span>&nbsp;<span class="comment" id="4260608">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260634">var</span>&nbsp;<span class="ident" id="4260638">length</span>&nbsp;<span class="builtintype" id="4260645">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260651">switch</span>&nbsp;<span class="op" id="4260658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260662">case</span>&nbsp;<span class="ident" id="4260667">v</span>&nbsp;<span class="op" id="4260669">&lt;</span>&nbsp;<span class="num" id="4260671">256</span><span class="op" id="4260674">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260679">f</span><span class="op" id="4260680">.</span><span class="ident" id="4260681">hist</span><span class="op" id="4260685">[</span><span class="ident" id="4260686">f</span><span class="op" id="4260687">.</span><span class="ident" id="4260688">hp</span><span class="op" id="4260690">]</span>&nbsp;<span class="op" id="4260692">=</span>&nbsp;<span class="builtintype" id="4260694">byte</span><span class="op" id="4260698">(</span><span class="ident" id="4260699">v</span><span class="op" id="4260700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260705">f</span><span class="op" id="4260706">.</span><span class="ident" id="4260707">hp</span><span class="op" id="4260709">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260715">if</span>&nbsp;<span class="ident" id="4260718">f</span><span class="op" id="4260719">.</span><span class="ident" id="4260720">hp</span>&nbsp;<span class="op" id="4260723">==</span>&nbsp;<span class="builtinfunc" id="4260726">len</span><span class="op" id="4260729">(</span><span class="ident" id="4260730">f</span><span class="op" id="4260731">.</span><span class="ident" id="4260732">hist</span><span class="op" id="4260736">)</span>&nbsp;<span class="op" id="4260738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4260744">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260788">f</span><span class="op" id="4260789">.</span><span class="ident" id="4260790">flush</span><span class="op" id="4260795">(</span><span class="op" id="4260796">(</span><span class="op" id="4260797">*</span><span class="ident" id="4260798">decompressor</span><span class="op" id="4260810">)</span><span class="op" id="4260811">.</span><span class="ident" id="4260812">huffmanBlock</span><span class="op" id="4260824">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260845">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260856">case</span>&nbsp;<span class="ident" id="4260861">v</span>&nbsp;<span class="op" id="4260863">==</span>&nbsp;<span class="num" id="4260866">256</span><span class="op" id="4260869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4260874">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260922">f</span><span class="op" id="4260923">.</span><span class="ident" id="4260924">step</span>&nbsp;<span class="op" id="4260929">=</span>&nbsp;<span class="op" id="4260931">(</span><span class="op" id="4260932">*</span><span class="ident" id="4260933">decompressor</span><span class="op" id="4260945">)</span><span class="op" id="4260946">.</span><span class="ident" id="4260947">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4260969">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261009">case</span>&nbsp;<span class="ident" id="4261014">v</span>&nbsp;<span class="op" id="4261016">&lt;</span>&nbsp;<span class="num" id="4261018">265</span><span class="op" id="4261021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261026">length</span>&nbsp;<span class="op" id="4261033">=</span>&nbsp;<span class="ident" id="4261035">v</span>&nbsp;<span class="op" id="4261037">-</span>&nbsp;<span class="op" id="4261039">(</span><span class="num" id="4261040">257</span>&nbsp;<span class="op" id="4261044">-</span>&nbsp;<span class="num" id="4261046">3</span><span class="op" id="4261047">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261052">n</span>&nbsp;<span class="op" id="4261054">=</span>&nbsp;<span class="num" id="4261056">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261060">case</span>&nbsp;<span class="ident" id="4261065">v</span>&nbsp;<span class="op" id="4261067">&lt;</span>&nbsp;<span class="num" id="4261069">269</span><span class="op" id="4261072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261077">length</span>&nbsp;<span class="op" id="4261084">=</span>&nbsp;<span class="ident" id="4261086">v</span><span class="op" id="4261087">*</span><span class="num" id="4261088">2</span>&nbsp;<span class="op" id="4261090">-</span>&nbsp;<span class="op" id="4261092">(</span><span class="num" id="4261093">265</span><span class="op" id="4261096">*</span><span class="num" id="4261097">2</span>&nbsp;<span class="op" id="4261099">-</span>&nbsp;<span class="num" id="4261101">11</span><span class="op" id="4261103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261108">n</span>&nbsp;<span class="op" id="4261110">=</span>&nbsp;<span class="num" id="4261112">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261116">case</span>&nbsp;<span class="ident" id="4261121">v</span>&nbsp;<span class="op" id="4261123">&lt;</span>&nbsp;<span class="num" id="4261125">273</span><span class="op" id="4261128">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261133">length</span>&nbsp;<span class="op" id="4261140">=</span>&nbsp;<span class="ident" id="4261142">v</span><span class="op" id="4261143">*</span><span class="num" id="4261144">4</span>&nbsp;<span class="op" id="4261146">-</span>&nbsp;<span class="op" id="4261148">(</span><span class="num" id="4261149">269</span><span class="op" id="4261152">*</span><span class="num" id="4261153">4</span>&nbsp;<span class="op" id="4261155">-</span>&nbsp;<span class="num" id="4261157">19</span><span class="op" id="4261159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261164">n</span>&nbsp;<span class="op" id="4261166">=</span>&nbsp;<span class="num" id="4261168">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261172">case</span>&nbsp;<span class="ident" id="4261177">v</span>&nbsp;<span class="op" id="4261179">&lt;</span>&nbsp;<span class="num" id="4261181">277</span><span class="op" id="4261184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261189">length</span>&nbsp;<span class="op" id="4261196">=</span>&nbsp;<span class="ident" id="4261198">v</span><span class="op" id="4261199">*</span><span class="num" id="4261200">8</span>&nbsp;<span class="op" id="4261202">-</span>&nbsp;<span class="op" id="4261204">(</span><span class="num" id="4261205">273</span><span class="op" id="4261208">*</span><span class="num" id="4261209">8</span>&nbsp;<span class="op" id="4261211">-</span>&nbsp;<span class="num" id="4261213">35</span><span class="op" id="4261215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261220">n</span>&nbsp;<span class="op" id="4261222">=</span>&nbsp;<span class="num" id="4261224">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261228">case</span>&nbsp;<span class="ident" id="4261233">v</span>&nbsp;<span class="op" id="4261235">&lt;</span>&nbsp;<span class="num" id="4261237">281</span><span class="op" id="4261240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261245">length</span>&nbsp;<span class="op" id="4261252">=</span>&nbsp;<span class="ident" id="4261254">v</span><span class="op" id="4261255">*</span><span class="num" id="4261256">16</span>&nbsp;<span class="op" id="4261259">-</span>&nbsp;<span class="op" id="4261261">(</span><span class="num" id="4261262">277</span><span class="op" id="4261265">*</span><span class="num" id="4261266">16</span>&nbsp;<span class="op" id="4261269">-</span>&nbsp;<span class="num" id="4261271">67</span><span class="op" id="4261273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261278">n</span>&nbsp;<span class="op" id="4261280">=</span>&nbsp;<span class="num" id="4261282">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261286">case</span>&nbsp;<span class="ident" id="4261291">v</span>&nbsp;<span class="op" id="4261293">&lt;</span>&nbsp;<span class="num" id="4261295">285</span><span class="op" id="4261298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261303">length</span>&nbsp;<span class="op" id="4261310">=</span>&nbsp;<span class="ident" id="4261312">v</span><span class="op" id="4261313">*</span><span class="num" id="4261314">32</span>&nbsp;<span class="op" id="4261317">-</span>&nbsp;<span class="op" id="4261319">(</span><span class="num" id="4261320">281</span><span class="op" id="4261323">*</span><span class="num" id="4261324">32</span>&nbsp;<span class="op" id="4261327">-</span>&nbsp;<span class="num" id="4261329">131</span><span class="op" id="4261332">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261337">n</span>&nbsp;<span class="op" id="4261339">=</span>&nbsp;<span class="num" id="4261341">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261345">default</span><span class="op" id="4261352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261357">length</span>&nbsp;<span class="op" id="4261364">=</span>&nbsp;<span class="num" id="4261366">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261373">n</span>&nbsp;<span class="op" id="4261375">=</span>&nbsp;<span class="num" id="4261377">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261381">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261385">if</span>&nbsp;<span class="ident" id="4261388">n</span>&nbsp;<span class="op" id="4261390">&gt;</span>&nbsp;<span class="num" id="4261392">0</span>&nbsp;<span class="op" id="4261394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261399">for</span>&nbsp;<span class="ident" id="4261403">f</span><span class="op" id="4261404">.</span><span class="ident" id="4261405">nb</span>&nbsp;<span class="op" id="4261408">&lt;</span>&nbsp;<span class="ident" id="4261410">n</span>&nbsp;<span class="op" id="4261412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261418">if</span>&nbsp;<span class="ident" id="4261421">err</span>&nbsp;<span class="op" id="4261425">=</span>&nbsp;<span class="ident" id="4261427">f</span><span class="op" id="4261428">.</span><span class="ident" id="4261429">moreBits</span><span class="op" id="4261437">(</span><span class="op" id="4261438">)</span><span class="op" id="4261439">;</span>&nbsp;<span class="ident" id="4261441">err</span>&nbsp;<span class="op" id="4261445">!=</span>&nbsp;<span class="builtintype" id="4261448">nil</span>&nbsp;<span class="op" id="4261452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261459">f</span><span class="op" id="4261460">.</span><span class="ident" id="4261461">err</span>&nbsp;<span class="op" id="4261465">=</span>&nbsp;<span class="ident" id="4261467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261476">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261497">length</span>&nbsp;<span class="op" id="4261504">+=</span>&nbsp;<span class="builtintype" id="4261507">int</span><span class="op" id="4261510">(</span><span class="ident" id="4261511">f</span><span class="op" id="4261512">.</span><span class="ident" id="4261513">b</span>&nbsp;<span class="op" id="4261515">&amp;</span>&nbsp;<span class="builtintype" id="4261517">uint32</span><span class="op" id="4261523">(</span><span class="num" id="4261524">1</span><span class="op" id="4261525">&lt;&lt;</span><span class="ident" id="4261527">n</span><span class="op" id="4261528">-</span><span class="num" id="4261529">1</span><span class="op" id="4261530">)</span><span class="op" id="4261531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261536">f</span><span class="op" id="4261537">.</span><span class="ident" id="4261538">b</span>&nbsp;<span class="op" id="4261540">&gt;&gt;=</span>&nbsp;<span class="ident" id="4261544">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261549">f</span><span class="op" id="4261550">.</span><span class="ident" id="4261551">nb</span>&nbsp;<span class="op" id="4261554">-=</span>&nbsp;<span class="ident" id="4261557">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261566">var</span>&nbsp;<span class="ident" id="4261570">dist</span>&nbsp;<span class="builtintype" id="4261575">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261581">if</span>&nbsp;<span class="ident" id="4261584">f</span><span class="op" id="4261585">.</span><span class="ident" id="4261586">hd</span>&nbsp;<span class="op" id="4261589">==</span>&nbsp;<span class="builtintype" id="4261592">nil</span>&nbsp;<span class="op" id="4261596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261601">for</span>&nbsp;<span class="ident" id="4261605">f</span><span class="op" id="4261606">.</span><span class="ident" id="4261607">nb</span>&nbsp;<span class="op" id="4261610">&lt;</span>&nbsp;<span class="num" id="4261612">5</span>&nbsp;<span class="op" id="4261614">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261620">if</span>&nbsp;<span class="ident" id="4261623">err</span>&nbsp;<span class="op" id="4261627">=</span>&nbsp;<span class="ident" id="4261629">f</span><span class="op" id="4261630">.</span><span class="ident" id="4261631">moreBits</span><span class="op" id="4261639">(</span><span class="op" id="4261640">)</span><span class="op" id="4261641">;</span>&nbsp;<span class="ident" id="4261643">err</span>&nbsp;<span class="op" id="4261647">!=</span>&nbsp;<span class="builtintype" id="4261650">nil</span>&nbsp;<span class="op" id="4261654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261661">f</span><span class="op" id="4261662">.</span><span class="ident" id="4261663">err</span>&nbsp;<span class="op" id="4261667">=</span>&nbsp;<span class="ident" id="4261669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261678">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261694">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261699">dist</span>&nbsp;<span class="op" id="4261704">=</span>&nbsp;<span class="builtintype" id="4261706">int</span><span class="op" id="4261709">(</span><span class="ident" id="4261710">reverseByte</span><span class="op" id="4261721">[</span><span class="op" id="4261722">(</span><span class="ident" id="4261723">f</span><span class="op" id="4261724">.</span><span class="ident" id="4261725">b</span><span class="op" id="4261726">&amp;</span><span class="num" id="4261727">0x1F</span><span class="op" id="4261731">)</span><span class="op" id="4261732">&lt;&lt;</span><span class="num" id="4261734">3</span><span class="op" id="4261735">]</span><span class="op" id="4261736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261741">f</span><span class="op" id="4261742">.</span><span class="ident" id="4261743">b</span>&nbsp;<span class="op" id="4261745">&gt;&gt;=</span>&nbsp;<span class="num" id="4261749">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261754">f</span><span class="op" id="4261755">.</span><span class="ident" id="4261756">nb</span>&nbsp;<span class="op" id="4261759">-=</span>&nbsp;<span class="num" id="4261762">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261766">}</span>&nbsp;<span class="keyword" id="4261768">else</span>&nbsp;<span class="op" id="4261773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261778">if</span>&nbsp;<span class="ident" id="4261781">dist</span><span class="op" id="4261785">,</span>&nbsp;<span class="ident" id="4261787">err</span>&nbsp;<span class="op" id="4261791">=</span>&nbsp;<span class="ident" id="4261793">f</span><span class="op" id="4261794">.</span><span class="ident" id="4261795">huffSym</span><span class="op" id="4261802">(</span><span class="ident" id="4261803">f</span><span class="op" id="4261804">.</span><span class="ident" id="4261805">hd</span><span class="op" id="4261807">)</span><span class="op" id="4261808">;</span>&nbsp;<span class="ident" id="4261810">err</span>&nbsp;<span class="op" id="4261814">!=</span>&nbsp;<span class="builtintype" id="4261817">nil</span>&nbsp;<span class="op" id="4261821">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261827">f</span><span class="op" id="4261828">.</span><span class="ident" id="4261829">err</span>&nbsp;<span class="op" id="4261833">=</span>&nbsp;<span class="ident" id="4261835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261843">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4261857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261862">switch</span>&nbsp;<span class="op" id="4261869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261873">case</span>&nbsp;<span class="ident" id="4261878">dist</span>&nbsp;<span class="op" id="4261883">&lt;</span>&nbsp;<span class="num" id="4261885">4</span><span class="op" id="4261886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261891">dist</span><span class="op" id="4261895">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261900">case</span>&nbsp;<span class="ident" id="4261905">dist</span>&nbsp;<span class="op" id="4261910">&gt;=</span>&nbsp;<span class="num" id="4261913">30</span><span class="op" id="4261915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261920">f</span><span class="op" id="4261921">.</span><span class="ident" id="4261922">err</span>&nbsp;<span class="op" id="4261926">=</span>&nbsp;<span class="ident" id="4261928">CorruptInputError</span><span class="op" id="4261945">(</span><span class="ident" id="4261946">f</span><span class="op" id="4261947">.</span><span class="ident" id="4261948">roffset</span><span class="op" id="4261955">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4261969">default</span><span class="op" id="4261976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261981">nb</span>&nbsp;<span class="op" id="4261984">:=</span>&nbsp;<span class="builtintype" id="4261987">uint</span><span class="op" id="4261991">(</span><span class="ident" id="4261992">dist</span><span class="op" id="4261996">-</span><span class="num" id="4261997">2</span><span class="op" id="4261998">)</span>&nbsp;<span class="op" id="4262000">&gt;&gt;</span>&nbsp;<span class="num" id="4262003">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262008">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262058">extra</span>&nbsp;<span class="op" id="4262064">:=</span>&nbsp;<span class="op" id="4262067">(</span><span class="ident" id="4262068">dist</span>&nbsp;<span class="op" id="4262073">&amp;</span>&nbsp;<span class="num" id="4262075">1</span><span class="op" id="4262076">)</span>&nbsp;<span class="op" id="4262078">&lt;&lt;</span>&nbsp;<span class="ident" id="4262081">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262087">for</span>&nbsp;<span class="ident" id="4262091">f</span><span class="op" id="4262092">.</span><span class="ident" id="4262093">nb</span>&nbsp;<span class="op" id="4262096">&lt;</span>&nbsp;<span class="ident" id="4262098">nb</span>&nbsp;<span class="op" id="4262101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262107">if</span>&nbsp;<span class="ident" id="4262110">err</span>&nbsp;<span class="op" id="4262114">=</span>&nbsp;<span class="ident" id="4262116">f</span><span class="op" id="4262117">.</span><span class="ident" id="4262118">moreBits</span><span class="op" id="4262126">(</span><span class="op" id="4262127">)</span><span class="op" id="4262128">;</span>&nbsp;<span class="ident" id="4262130">err</span>&nbsp;<span class="op" id="4262134">!=</span>&nbsp;<span class="builtintype" id="4262137">nil</span>&nbsp;<span class="op" id="4262141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262148">f</span><span class="op" id="4262149">.</span><span class="ident" id="4262150">err</span>&nbsp;<span class="op" id="4262154">=</span>&nbsp;<span class="ident" id="4262156">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262165">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262176">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262186">extra</span>&nbsp;<span class="op" id="4262192">|=</span>&nbsp;<span class="builtintype" id="4262195">int</span><span class="op" id="4262198">(</span><span class="ident" id="4262199">f</span><span class="op" id="4262200">.</span><span class="ident" id="4262201">b</span>&nbsp;<span class="op" id="4262203">&amp;</span>&nbsp;<span class="builtintype" id="4262205">uint32</span><span class="op" id="4262211">(</span><span class="num" id="4262212">1</span><span class="op" id="4262213">&lt;&lt;</span><span class="ident" id="4262215">nb</span><span class="op" id="4262217">-</span><span class="num" id="4262218">1</span><span class="op" id="4262219">)</span><span class="op" id="4262220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262225">f</span><span class="op" id="4262226">.</span><span class="ident" id="4262227">b</span>&nbsp;<span class="op" id="4262229">&gt;&gt;=</span>&nbsp;<span class="ident" id="4262233">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262239">f</span><span class="op" id="4262240">.</span><span class="ident" id="4262241">nb</span>&nbsp;<span class="op" id="4262244">-=</span>&nbsp;<span class="ident" id="4262247">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262253">dist</span>&nbsp;<span class="op" id="4262258">=</span>&nbsp;<span class="num" id="4262260">1</span><span class="op" id="4262261">&lt;&lt;</span><span class="op" id="4262263">(</span><span class="ident" id="4262264">nb</span><span class="op" id="4262266">+</span><span class="num" id="4262267">1</span><span class="op" id="4262268">)</span>&nbsp;<span class="op" id="4262270">+</span>&nbsp;<span class="num" id="4262272">1</span>&nbsp;<span class="op" id="4262274">+</span>&nbsp;<span class="ident" id="4262276">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262289">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262340">if</span>&nbsp;<span class="ident" id="4262343">dist</span>&nbsp;<span class="op" id="4262348">&gt;</span>&nbsp;<span class="builtinfunc" id="4262350">len</span><span class="op" id="4262353">(</span><span class="ident" id="4262354">f</span><span class="op" id="4262355">.</span><span class="ident" id="4262356">hist</span><span class="op" id="4262360">)</span>&nbsp;<span class="op" id="4262362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262367">f</span><span class="op" id="4262368">.</span><span class="ident" id="4262369">err</span>&nbsp;<span class="op" id="4262373">=</span>&nbsp;<span class="ident" id="4262375">InternalError</span><span class="op" id="4262388">(</span><span class="string" id="4262389">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="4262411">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262416">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262430">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262482">if</span>&nbsp;<span class="op" id="4262485">!</span><span class="ident" id="4262486">f</span><span class="op" id="4262487">.</span><span class="ident" id="4262488">hfull</span>&nbsp;<span class="op" id="4262494">&amp;&amp;</span>&nbsp;<span class="ident" id="4262497">dist</span>&nbsp;<span class="op" id="4262502">&gt;</span>&nbsp;<span class="ident" id="4262504">f</span><span class="op" id="4262505">.</span><span class="ident" id="4262506">hp</span>&nbsp;<span class="op" id="4262509">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262514">f</span><span class="op" id="4262515">.</span><span class="ident" id="4262516">err</span>&nbsp;<span class="op" id="4262520">=</span>&nbsp;<span class="ident" id="4262522">CorruptInputError</span><span class="op" id="4262539">(</span><span class="ident" id="4262540">f</span><span class="op" id="4262541">.</span><span class="ident" id="4262542">roffset</span><span class="op" id="4262549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262568">f</span><span class="op" id="4262569">.</span><span class="ident" id="4262570">copyLen</span><span class="op" id="4262577">,</span>&nbsp;<span class="ident" id="4262579">f</span><span class="op" id="4262580">.</span><span class="ident" id="4262581">copyDist</span>&nbsp;<span class="op" id="4262590">=</span>&nbsp;<span class="ident" id="4262592">length</span><span class="op" id="4262598">,</span>&nbsp;<span class="ident" id="4262600">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262607">if</span>&nbsp;<span class="ident" id="4262610">f</span><span class="op" id="4262611">.</span><span class="ident" id="4262612">copyHist</span><span class="op" id="4262620">(</span><span class="op" id="4262621">)</span>&nbsp;<span class="op" id="4262623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262628">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262640">}</span><br>
<span class="lineno"></span><span class="op" id="4262642">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="4262645">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="4262726">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4262775">func</span>&nbsp;<span class="op" id="4262780">(</span><span class="ident" id="4262781">f</span>&nbsp;<span class="op" id="4262783">*</span><span class="ident" id="4262784">decompressor</span><span class="op" id="4262796">)</span>&nbsp;<span class="ident" id="4262798">copyHist</span><span class="op" id="4262806">(</span><span class="op" id="4262807">)</span>&nbsp;<span class="builtintype" id="4262809">bool</span>&nbsp;<span class="op" id="4262814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262817">p</span>&nbsp;<span class="op" id="4262819">:=</span>&nbsp;<span class="ident" id="4262822">f</span><span class="op" id="4262823">.</span><span class="ident" id="4262824">hp</span>&nbsp;<span class="op" id="4262827">-</span>&nbsp;<span class="ident" id="4262829">f</span><span class="op" id="4262830">.</span><span class="ident" id="4262831">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262841">if</span>&nbsp;<span class="ident" id="4262844">p</span>&nbsp;<span class="op" id="4262846">&lt;</span>&nbsp;<span class="num" id="4262848">0</span>&nbsp;<span class="op" id="4262850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262854">p</span>&nbsp;<span class="op" id="4262856">+=</span>&nbsp;<span class="builtinfunc" id="4262859">len</span><span class="op" id="4262862">(</span><span class="ident" id="4262863">f</span><span class="op" id="4262864">.</span><span class="ident" id="4262865">hist</span><span class="op" id="4262869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262875">for</span>&nbsp;<span class="ident" id="4262879">f</span><span class="op" id="4262880">.</span><span class="ident" id="4262881">copyLen</span>&nbsp;<span class="op" id="4262889">&gt;</span>&nbsp;<span class="num" id="4262891">0</span>&nbsp;<span class="op" id="4262893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262897">n</span>&nbsp;<span class="op" id="4262899">:=</span>&nbsp;<span class="ident" id="4262902">f</span><span class="op" id="4262903">.</span><span class="ident" id="4262904">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262914">if</span>&nbsp;<span class="ident" id="4262917">x</span>&nbsp;<span class="op" id="4262919">:=</span>&nbsp;<span class="builtinfunc" id="4262922">len</span><span class="op" id="4262925">(</span><span class="ident" id="4262926">f</span><span class="op" id="4262927">.</span><span class="ident" id="4262928">hist</span><span class="op" id="4262932">)</span>&nbsp;<span class="op" id="4262934">-</span>&nbsp;<span class="ident" id="4262936">f</span><span class="op" id="4262937">.</span><span class="ident" id="4262938">hp</span><span class="op" id="4262940">;</span>&nbsp;<span class="ident" id="4262942">n</span>&nbsp;<span class="op" id="4262944">&gt;</span>&nbsp;<span class="ident" id="4262946">x</span>&nbsp;<span class="op" id="4262948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262953">n</span>&nbsp;<span class="op" id="4262955">=</span>&nbsp;<span class="ident" id="4262957">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4262961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4262965">if</span>&nbsp;<span class="ident" id="4262968">x</span>&nbsp;<span class="op" id="4262970">:=</span>&nbsp;<span class="builtinfunc" id="4262973">len</span><span class="op" id="4262976">(</span><span class="ident" id="4262977">f</span><span class="op" id="4262978">.</span><span class="ident" id="4262979">hist</span><span class="op" id="4262983">)</span>&nbsp;<span class="op" id="4262985">-</span>&nbsp;<span class="ident" id="4262987">p</span><span class="op" id="4262988">;</span>&nbsp;<span class="ident" id="4262990">n</span>&nbsp;<span class="op" id="4262992">&gt;</span>&nbsp;<span class="ident" id="4262994">x</span>&nbsp;<span class="op" id="4262996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263001">n</span>&nbsp;<span class="op" id="4263003">=</span>&nbsp;<span class="ident" id="4263005">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263013">forwardCopy</span><span class="op" id="4263024">(</span><span class="ident" id="4263025">f</span><span class="op" id="4263026">.</span><span class="ident" id="4263027">hist</span><span class="op" id="4263031">[</span><span class="op" id="4263032">:</span><span class="op" id="4263033">]</span><span class="op" id="4263034">,</span>&nbsp;<span class="ident" id="4263036">f</span><span class="op" id="4263037">.</span><span class="ident" id="4263038">hp</span><span class="op" id="4263040">,</span>&nbsp;<span class="ident" id="4263042">p</span><span class="op" id="4263043">,</span>&nbsp;<span class="ident" id="4263045">n</span><span class="op" id="4263046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263050">p</span>&nbsp;<span class="op" id="4263052">+=</span>&nbsp;<span class="ident" id="4263055">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263059">f</span><span class="op" id="4263060">.</span><span class="ident" id="4263061">hp</span>&nbsp;<span class="op" id="4263064">+=</span>&nbsp;<span class="ident" id="4263067">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263071">f</span><span class="op" id="4263072">.</span><span class="ident" id="4263073">copyLen</span>&nbsp;<span class="op" id="4263081">-=</span>&nbsp;<span class="ident" id="4263084">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263088">if</span>&nbsp;<span class="ident" id="4263091">f</span><span class="op" id="4263092">.</span><span class="ident" id="4263093">hp</span>&nbsp;<span class="op" id="4263096">==</span>&nbsp;<span class="builtinfunc" id="4263099">len</span><span class="op" id="4263102">(</span><span class="ident" id="4263103">f</span><span class="op" id="4263104">.</span><span class="ident" id="4263105">hist</span><span class="op" id="4263109">)</span>&nbsp;<span class="op" id="4263111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263116">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263167">f</span><span class="op" id="4263168">.</span><span class="ident" id="4263169">flush</span><span class="op" id="4263174">(</span><span class="op" id="4263175">(</span><span class="op" id="4263176">*</span><span class="ident" id="4263177">decompressor</span><span class="op" id="4263189">)</span><span class="op" id="4263190">.</span><span class="ident" id="4263191">copyHuff</span><span class="op" id="4263199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263204">return</span>&nbsp;<span class="builtintype" id="4263211">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263218">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263222">if</span>&nbsp;<span class="ident" id="4263225">p</span>&nbsp;<span class="op" id="4263227">==</span>&nbsp;<span class="builtinfunc" id="4263230">len</span><span class="op" id="4263233">(</span><span class="ident" id="4263234">f</span><span class="op" id="4263235">.</span><span class="ident" id="4263236">hist</span><span class="op" id="4263240">)</span>&nbsp;<span class="op" id="4263242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263247">p</span>&nbsp;<span class="op" id="4263249">=</span>&nbsp;<span class="num" id="4263251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263261">return</span>&nbsp;<span class="builtintype" id="4263268">false</span><br>
<span class="lineno">550</span><span class="op" id="4263274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4263277">func</span>&nbsp;<span class="op" id="4263282">(</span><span class="ident" id="4263283">f</span>&nbsp;<span class="op" id="4263285">*</span><span class="ident" id="4263286">decompressor</span><span class="op" id="4263298">)</span>&nbsp;<span class="ident" id="4263300">copyHuff</span><span class="op" id="4263308">(</span><span class="op" id="4263309">)</span>&nbsp;<span class="op" id="4263311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263314">if</span>&nbsp;<span class="ident" id="4263317">f</span><span class="op" id="4263318">.</span><span class="ident" id="4263319">copyHist</span><span class="op" id="4263327">(</span><span class="op" id="4263328">)</span>&nbsp;<span class="op" id="4263330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263334">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263345">f</span><span class="op" id="4263346">.</span><span class="ident" id="4263347">huffmanBlock</span><span class="op" id="4263359">(</span><span class="op" id="4263360">)</span><br>
<span class="lineno"></span><span class="op" id="4263362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4263365">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="4263428">func</span>&nbsp;<span class="op" id="4263433">(</span><span class="ident" id="4263434">f</span>&nbsp;<span class="op" id="4263436">*</span><span class="ident" id="4263437">decompressor</span><span class="op" id="4263449">)</span>&nbsp;<span class="ident" id="4263451">dataBlock</span><span class="op" id="4263460">(</span><span class="op" id="4263461">)</span>&nbsp;<span class="op" id="4263463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263466">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263484">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263515">f</span><span class="op" id="4263516">.</span><span class="ident" id="4263517">nb</span>&nbsp;<span class="op" id="4263520">=</span>&nbsp;<span class="num" id="4263522">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263525">f</span><span class="op" id="4263526">.</span><span class="ident" id="4263527">b</span>&nbsp;<span class="op" id="4263529">=</span>&nbsp;<span class="num" id="4263531">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263535">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263578">nr</span><span class="op" id="4263580">,</span>&nbsp;<span class="ident" id="4263582">err</span>&nbsp;<span class="op" id="4263586">:=</span>&nbsp;<span class="ident" id="4263589">io</span><span class="op" id="4263591">.</span><span class="ident" id="4263592">ReadFull</span><span class="op" id="4263600">(</span><span class="ident" id="4263601">f</span><span class="op" id="4263602">.</span><span class="ident" id="4263603">r</span><span class="op" id="4263604">,</span>&nbsp;<span class="ident" id="4263606">f</span><span class="op" id="4263607">.</span><span class="ident" id="4263608">buf</span><span class="op" id="4263611">[</span><span class="num" id="4263612">0</span><span class="op" id="4263613">:</span><span class="num" id="4263614">4</span><span class="op" id="4263615">]</span><span class="op" id="4263616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263619">f</span><span class="op" id="4263620">.</span><span class="ident" id="4263621">roffset</span>&nbsp;<span class="op" id="4263629">+=</span>&nbsp;<span class="ident" id="4263632">int64</span><span class="op" id="4263637">(</span><span class="ident" id="4263638">nr</span><span class="op" id="4263640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263643">if</span>&nbsp;<span class="ident" id="4263646">err</span>&nbsp;<span class="op" id="4263650">!=</span>&nbsp;<span class="builtintype" id="4263653">nil</span>&nbsp;<span class="op" id="4263657">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263661">f</span><span class="op" id="4263662">.</span><span class="ident" id="4263663">err</span>&nbsp;<span class="op" id="4263667">=</span>&nbsp;<span class="op" id="4263669">&amp;</span><span class="ident" id="4263670">ReadError</span><span class="op" id="4263679">{</span><span class="ident" id="4263680">f</span><span class="op" id="4263681">.</span><span class="ident" id="4263682">roffset</span><span class="op" id="4263689">,</span>&nbsp;<span class="ident" id="4263691">err</span><span class="op" id="4263694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263709">n</span>&nbsp;<span class="op" id="4263711">:=</span>&nbsp;<span class="builtintype" id="4263714">int</span><span class="op" id="4263717">(</span><span class="ident" id="4263718">f</span><span class="op" id="4263719">.</span><span class="ident" id="4263720">buf</span><span class="op" id="4263723">[</span><span class="num" id="4263724">0</span><span class="op" id="4263725">]</span><span class="op" id="4263726">)</span>&nbsp;<span class="op" id="4263728">|</span>&nbsp;<span class="builtintype" id="4263730">int</span><span class="op" id="4263733">(</span><span class="ident" id="4263734">f</span><span class="op" id="4263735">.</span><span class="ident" id="4263736">buf</span><span class="op" id="4263739">[</span><span class="num" id="4263740">1</span><span class="op" id="4263741">]</span><span class="op" id="4263742">)</span><span class="op" id="4263743">&lt;&lt;</span><span class="num" id="4263745">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263748">nn</span>&nbsp;<span class="op" id="4263751">:=</span>&nbsp;<span class="builtintype" id="4263754">int</span><span class="op" id="4263757">(</span><span class="ident" id="4263758">f</span><span class="op" id="4263759">.</span><span class="ident" id="4263760">buf</span><span class="op" id="4263763">[</span><span class="num" id="4263764">2</span><span class="op" id="4263765">]</span><span class="op" id="4263766">)</span>&nbsp;<span class="op" id="4263768">|</span>&nbsp;<span class="builtintype" id="4263770">int</span><span class="op" id="4263773">(</span><span class="ident" id="4263774">f</span><span class="op" id="4263775">.</span><span class="ident" id="4263776">buf</span><span class="op" id="4263779">[</span><span class="num" id="4263780">3</span><span class="op" id="4263781">]</span><span class="op" id="4263782">)</span><span class="op" id="4263783">&lt;&lt;</span><span class="num" id="4263785">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263788">if</span>&nbsp;<span class="builtintype" id="4263791">uint16</span><span class="op" id="4263797">(</span><span class="ident" id="4263798">nn</span><span class="op" id="4263800">)</span>&nbsp;<span class="op" id="4263802">!=</span>&nbsp;<span class="builtintype" id="4263805">uint16</span><span class="op" id="4263811">(</span><span class="op" id="4263812">^</span><span class="ident" id="4263813">n</span><span class="op" id="4263814">)</span>&nbsp;<span class="op" id="4263816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263820">f</span><span class="op" id="4263821">.</span><span class="ident" id="4263822">err</span>&nbsp;<span class="op" id="4263826">=</span>&nbsp;<span class="ident" id="4263828">CorruptInputError</span><span class="op" id="4263845">(</span><span class="ident" id="4263846">f</span><span class="op" id="4263847">.</span><span class="ident" id="4263848">roffset</span><span class="op" id="4263855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263859">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263871">if</span>&nbsp;<span class="ident" id="4263874">n</span>&nbsp;<span class="op" id="4263876">==</span>&nbsp;<span class="num" id="4263879">0</span>&nbsp;<span class="op" id="4263881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263885">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263916">f</span><span class="op" id="4263917">.</span><span class="ident" id="4263918">flush</span><span class="op" id="4263923">(</span><span class="op" id="4263924">(</span><span class="op" id="4263925">*</span><span class="ident" id="4263926">decompressor</span><span class="op" id="4263938">)</span><span class="op" id="4263939">.</span><span class="ident" id="4263940">nextBlock</span><span class="op" id="4263949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4263953">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4263961">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263965">f</span><span class="op" id="4263966">.</span><span class="ident" id="4263967">copyLen</span>&nbsp;<span class="op" id="4263975">=</span>&nbsp;<span class="ident" id="4263977">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263980">f</span><span class="op" id="4263981">.</span><span class="ident" id="4263982">copyData</span><span class="op" id="4263990">(</span><span class="op" id="4263991">)</span><br>
<span class="lineno"></span><span class="op" id="4263993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4263996">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="4264071">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="4264115">func</span>&nbsp;<span class="op" id="4264120">(</span><span class="ident" id="4264121">f</span>&nbsp;<span class="op" id="4264123">*</span><span class="ident" id="4264124">decompressor</span><span class="op" id="4264136">)</span>&nbsp;<span class="ident" id="4264138">copyData</span><span class="op" id="4264146">(</span><span class="op" id="4264147">)</span>&nbsp;<span class="op" id="4264149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264152">n</span>&nbsp;<span class="op" id="4264154">:=</span>&nbsp;<span class="ident" id="4264157">f</span><span class="op" id="4264158">.</span><span class="ident" id="4264159">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264168">for</span>&nbsp;<span class="ident" id="4264172">n</span>&nbsp;<span class="op" id="4264174">&gt;</span>&nbsp;<span class="num" id="4264176">0</span>&nbsp;<span class="op" id="4264178">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264182">m</span>&nbsp;<span class="op" id="4264184">:=</span>&nbsp;<span class="builtinfunc" id="4264187">len</span><span class="op" id="4264190">(</span><span class="ident" id="4264191">f</span><span class="op" id="4264192">.</span><span class="ident" id="4264193">hist</span><span class="op" id="4264197">)</span>&nbsp;<span class="op" id="4264199">-</span>&nbsp;<span class="ident" id="4264201">f</span><span class="op" id="4264202">.</span><span class="ident" id="4264203">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264208">if</span>&nbsp;<span class="ident" id="4264211">m</span>&nbsp;<span class="op" id="4264213">&gt;</span>&nbsp;<span class="ident" id="4264215">n</span>&nbsp;<span class="op" id="4264217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264222">m</span>&nbsp;<span class="op" id="4264224">=</span>&nbsp;<span class="ident" id="4264226">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264234">m</span><span class="op" id="4264235">,</span>&nbsp;<span class="ident" id="4264237">err</span>&nbsp;<span class="op" id="4264241">:=</span>&nbsp;<span class="ident" id="4264244">io</span><span class="op" id="4264246">.</span><span class="ident" id="4264247">ReadFull</span><span class="op" id="4264255">(</span><span class="ident" id="4264256">f</span><span class="op" id="4264257">.</span><span class="ident" id="4264258">r</span><span class="op" id="4264259">,</span>&nbsp;<span class="ident" id="4264261">f</span><span class="op" id="4264262">.</span><span class="ident" id="4264263">hist</span><span class="op" id="4264267">[</span><span class="ident" id="4264268">f</span><span class="op" id="4264269">.</span><span class="ident" id="4264270">hp</span><span class="op" id="4264272">:</span><span class="ident" id="4264273">f</span><span class="op" id="4264274">.</span><span class="ident" id="4264275">hp</span><span class="op" id="4264277">+</span><span class="ident" id="4264278">m</span><span class="op" id="4264279">]</span><span class="op" id="4264280">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264284">f</span><span class="op" id="4264285">.</span><span class="ident" id="4264286">roffset</span>&nbsp;<span class="op" id="4264294">+=</span>&nbsp;<span class="ident" id="4264297">int64</span><span class="op" id="4264302">(</span><span class="ident" id="4264303">m</span><span class="op" id="4264304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264308">if</span>&nbsp;<span class="ident" id="4264311">err</span>&nbsp;<span class="op" id="4264315">!=</span>&nbsp;<span class="builtintype" id="4264318">nil</span>&nbsp;<span class="op" id="4264322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264327">f</span><span class="op" id="4264328">.</span><span class="ident" id="4264329">err</span>&nbsp;<span class="op" id="4264333">=</span>&nbsp;<span class="op" id="4264335">&amp;</span><span class="ident" id="4264336">ReadError</span><span class="op" id="4264345">{</span><span class="ident" id="4264346">f</span><span class="op" id="4264347">.</span><span class="ident" id="4264348">roffset</span><span class="op" id="4264355">,</span>&nbsp;<span class="ident" id="4264357">err</span><span class="op" id="4264360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264374">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264378">n</span>&nbsp;<span class="op" id="4264380">-=</span>&nbsp;<span class="ident" id="4264383">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264387">f</span><span class="op" id="4264388">.</span><span class="ident" id="4264389">hp</span>&nbsp;<span class="op" id="4264392">+=</span>&nbsp;<span class="ident" id="4264395">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264399">if</span>&nbsp;<span class="ident" id="4264402">f</span><span class="op" id="4264403">.</span><span class="ident" id="4264404">hp</span>&nbsp;<span class="op" id="4264407">==</span>&nbsp;<span class="builtinfunc" id="4264410">len</span><span class="op" id="4264413">(</span><span class="ident" id="4264414">f</span><span class="op" id="4264415">.</span><span class="ident" id="4264416">hist</span><span class="op" id="4264420">)</span>&nbsp;<span class="op" id="4264422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264427">f</span><span class="op" id="4264428">.</span><span class="ident" id="4264429">copyLen</span>&nbsp;<span class="op" id="4264437">=</span>&nbsp;<span class="ident" id="4264439">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264444">f</span><span class="op" id="4264445">.</span><span class="ident" id="4264446">flush</span><span class="op" id="4264451">(</span><span class="op" id="4264452">(</span><span class="op" id="4264453">*</span><span class="ident" id="4264454">decompressor</span><span class="op" id="4264466">)</span><span class="op" id="4264467">.</span><span class="ident" id="4264468">copyData</span><span class="op" id="4264476">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264496">f</span><span class="op" id="4264497">.</span><span class="ident" id="4264498">step</span>&nbsp;<span class="op" id="4264503">=</span>&nbsp;<span class="op" id="4264505">(</span><span class="op" id="4264506">*</span><span class="ident" id="4264507">decompressor</span><span class="op" id="4264519">)</span><span class="op" id="4264520">.</span><span class="ident" id="4264521">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="4264531">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="4264534">func</span>&nbsp;<span class="op" id="4264539">(</span><span class="ident" id="4264540">f</span>&nbsp;<span class="op" id="4264542">*</span><span class="ident" id="4264543">decompressor</span><span class="op" id="4264555">)</span>&nbsp;<span class="ident" id="4264557">setDict</span><span class="op" id="4264564">(</span><span class="ident" id="4264565">dict</span>&nbsp;<span class="op" id="4264570">[</span><span class="op" id="4264571">]</span><span class="builtintype" id="4264572">byte</span><span class="op" id="4264576">)</span>&nbsp;<span class="op" id="4264578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264581">if</span>&nbsp;<span class="builtinfunc" id="4264584">len</span><span class="op" id="4264587">(</span><span class="ident" id="4264588">dict</span><span class="op" id="4264592">)</span>&nbsp;<span class="op" id="4264594">&gt;</span>&nbsp;<span class="builtinfunc" id="4264596">len</span><span class="op" id="4264599">(</span><span class="ident" id="4264600">f</span><span class="op" id="4264601">.</span><span class="ident" id="4264602">hist</span><span class="op" id="4264606">)</span>&nbsp;<span class="op" id="4264608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4264612">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264646">dict</span>&nbsp;<span class="op" id="4264651">=</span>&nbsp;<span class="ident" id="4264653">dict</span><span class="op" id="4264657">[</span><span class="builtinfunc" id="4264658">len</span><span class="op" id="4264661">(</span><span class="ident" id="4264662">dict</span><span class="op" id="4264666">)</span><span class="op" id="4264667">-</span><span class="builtinfunc" id="4264668">len</span><span class="op" id="4264671">(</span><span class="ident" id="4264672">f</span><span class="op" id="4264673">.</span><span class="ident" id="4264674">hist</span><span class="op" id="4264678">)</span><span class="op" id="4264679">:</span><span class="op" id="4264680">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264687">f</span><span class="op" id="4264688">.</span><span class="ident" id="4264689">hp</span>&nbsp;<span class="op" id="4264692">=</span>&nbsp;<span class="builtinfunc" id="4264694">copy</span><span class="op" id="4264698">(</span><span class="ident" id="4264699">f</span><span class="op" id="4264700">.</span><span class="ident" id="4264701">hist</span><span class="op" id="4264705">[</span><span class="op" id="4264706">:</span><span class="op" id="4264707">]</span><span class="op" id="4264708">,</span>&nbsp;<span class="ident" id="4264710">dict</span><span class="op" id="4264714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264717">if</span>&nbsp;<span class="ident" id="4264720">f</span><span class="op" id="4264721">.</span><span class="ident" id="4264722">hp</span>&nbsp;<span class="op" id="4264725">==</span>&nbsp;<span class="builtinfunc" id="4264728">len</span><span class="op" id="4264731">(</span><span class="ident" id="4264732">f</span><span class="op" id="4264733">.</span><span class="ident" id="4264734">hist</span><span class="op" id="4264738">)</span>&nbsp;<span class="op" id="4264740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264744">f</span><span class="op" id="4264745">.</span><span class="ident" id="4264746">hp</span>&nbsp;<span class="op" id="4264749">=</span>&nbsp;<span class="num" id="4264751">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264755">f</span><span class="op" id="4264756">.</span><span class="ident" id="4264757">hfull</span>&nbsp;<span class="op" id="4264763">=</span>&nbsp;<span class="builtintype" id="4264765">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264774">f</span><span class="op" id="4264775">.</span><span class="ident" id="4264776">hw</span>&nbsp;<span class="op" id="4264779">=</span>&nbsp;<span class="ident" id="4264781">f</span><span class="op" id="4264782">.</span><span class="ident" id="4264783">hp</span><br>
<span class="lineno"></span><span class="op" id="4264786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="4264789">func</span>&nbsp;<span class="op" id="4264794">(</span><span class="ident" id="4264795">f</span>&nbsp;<span class="op" id="4264797">*</span><span class="ident" id="4264798">decompressor</span><span class="op" id="4264810">)</span>&nbsp;<span class="ident" id="4264812">moreBits</span><span class="op" id="4264820">(</span><span class="op" id="4264821">)</span>&nbsp;<span class="builtintype" id="4264823">error</span>&nbsp;<span class="op" id="4264829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264832">c</span><span class="op" id="4264833">,</span>&nbsp;<span class="ident" id="4264835">err</span>&nbsp;<span class="op" id="4264839">:=</span>&nbsp;<span class="ident" id="4264842">f</span><span class="op" id="4264843">.</span><span class="ident" id="4264844">r</span><span class="op" id="4264845">.</span><span class="ident" id="4264846">ReadByte</span><span class="op" id="4264854">(</span><span class="op" id="4264855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264858">if</span>&nbsp;<span class="ident" id="4264861">err</span>&nbsp;<span class="op" id="4264865">!=</span>&nbsp;<span class="builtintype" id="4264868">nil</span>&nbsp;<span class="op" id="4264872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264876">if</span>&nbsp;<span class="ident" id="4264879">err</span>&nbsp;<span class="op" id="4264883">==</span>&nbsp;<span class="ident" id="4264886">io</span><span class="op" id="4264888">.</span><span class="ident" id="4264889">EOF</span>&nbsp;<span class="op" id="4264893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264898">err</span>&nbsp;<span class="op" id="4264902">=</span>&nbsp;<span class="ident" id="4264904">io</span><span class="op" id="4264906">.</span><span class="ident" id="4264907">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264930">return</span>&nbsp;<span class="ident" id="4264937">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264945">f</span><span class="op" id="4264946">.</span><span class="ident" id="4264947">roffset</span><span class="op" id="4264954">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264958">f</span><span class="op" id="4264959">.</span><span class="ident" id="4264960">b</span>&nbsp;<span class="op" id="4264962">|=</span>&nbsp;<span class="builtintype" id="4264965">uint32</span><span class="op" id="4264971">(</span><span class="ident" id="4264972">c</span><span class="op" id="4264973">)</span>&nbsp;<span class="op" id="4264975">&lt;&lt;</span>&nbsp;<span class="ident" id="4264978">f</span><span class="op" id="4264979">.</span><span class="ident" id="4264980">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264984">f</span><span class="op" id="4264985">.</span><span class="ident" id="4264986">nb</span>&nbsp;<span class="op" id="4264989">+=</span>&nbsp;<span class="num" id="4264992">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264995">return</span>&nbsp;<span class="builtintype" id="4265002">nil</span><br>
<span class="lineno"></span><span class="op" id="4265006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265009">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="4265072">func</span>&nbsp;<span class="op" id="4265077">(</span><span class="ident" id="4265078">f</span>&nbsp;<span class="op" id="4265080">*</span><span class="ident" id="4265081">decompressor</span><span class="op" id="4265093">)</span>&nbsp;<span class="ident" id="4265095">huffSym</span><span class="op" id="4265102">(</span><span class="ident" id="4265103">h</span>&nbsp;<span class="op" id="4265105">*</span><span class="ident" id="4265106">huffmanDecoder</span><span class="op" id="4265120">)</span>&nbsp;<span class="op" id="4265122">(</span><span class="builtintype" id="4265123">int</span><span class="op" id="4265126">,</span>&nbsp;<span class="builtintype" id="4265128">error</span><span class="op" id="4265133">)</span>&nbsp;<span class="op" id="4265135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265138">n</span>&nbsp;<span class="op" id="4265140">:=</span>&nbsp;<span class="builtintype" id="4265143">uint</span><span class="op" id="4265147">(</span><span class="ident" id="4265148">h</span><span class="op" id="4265149">.</span><span class="ident" id="4265150">min</span><span class="op" id="4265153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265156">for</span>&nbsp;<span class="op" id="4265160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265164">for</span>&nbsp;<span class="ident" id="4265168">f</span><span class="op" id="4265169">.</span><span class="ident" id="4265170">nb</span>&nbsp;<span class="op" id="4265173">&lt;</span>&nbsp;<span class="ident" id="4265175">n</span>&nbsp;<span class="op" id="4265177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265182">if</span>&nbsp;<span class="ident" id="4265185">err</span>&nbsp;<span class="op" id="4265189">:=</span>&nbsp;<span class="ident" id="4265192">f</span><span class="op" id="4265193">.</span><span class="ident" id="4265194">moreBits</span><span class="op" id="4265202">(</span><span class="op" id="4265203">)</span><span class="op" id="4265204">;</span>&nbsp;<span class="ident" id="4265206">err</span>&nbsp;<span class="op" id="4265210">!=</span>&nbsp;<span class="builtintype" id="4265213">nil</span>&nbsp;<span class="op" id="4265217">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265223">return</span>&nbsp;<span class="num" id="4265230">0</span><span class="op" id="4265231">,</span>&nbsp;<span class="ident" id="4265233">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265248">chunk</span>&nbsp;<span class="op" id="4265254">:=</span>&nbsp;<span class="ident" id="4265257">h</span><span class="op" id="4265258">.</span><span class="ident" id="4265259">chunks</span><span class="op" id="4265265">[</span><span class="ident" id="4265266">f</span><span class="op" id="4265267">.</span><span class="ident" id="4265268">b</span><span class="op" id="4265269">&amp;</span><span class="op" id="4265270">(</span><span class="ident" id="4265271">huffmanNumChunks</span><span class="op" id="4265287">-</span><span class="num" id="4265288">1</span><span class="op" id="4265289">)</span><span class="op" id="4265290">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265294">n</span>&nbsp;<span class="op" id="4265296">=</span>&nbsp;<span class="builtintype" id="4265298">uint</span><span class="op" id="4265302">(</span><span class="ident" id="4265303">chunk</span>&nbsp;<span class="op" id="4265309">&amp;</span>&nbsp;<span class="ident" id="4265311">huffmanCountMask</span><span class="op" id="4265327">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265331">if</span>&nbsp;<span class="ident" id="4265334">n</span>&nbsp;<span class="op" id="4265336">&gt;</span>&nbsp;<span class="ident" id="4265338">huffmanChunkBits</span>&nbsp;<span class="op" id="4265355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265360">chunk</span>&nbsp;<span class="op" id="4265366">=</span>&nbsp;<span class="ident" id="4265368">h</span><span class="op" id="4265369">.</span><span class="ident" id="4265370">links</span><span class="op" id="4265375">[</span><span class="ident" id="4265376">chunk</span><span class="op" id="4265381">&gt;&gt;</span><span class="ident" id="4265383">huffmanValueShift</span><span class="op" id="4265400">]</span><span class="op" id="4265401">[</span><span class="op" id="4265402">(</span><span class="ident" id="4265403">f</span><span class="op" id="4265404">.</span><span class="ident" id="4265405">b</span><span class="op" id="4265406">&gt;&gt;</span><span class="ident" id="4265408">huffmanChunkBits</span><span class="op" id="4265424">)</span><span class="op" id="4265425">&amp;</span><span class="ident" id="4265426">h</span><span class="op" id="4265427">.</span><span class="ident" id="4265428">linkMask</span><span class="op" id="4265436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265441">n</span>&nbsp;<span class="op" id="4265443">=</span>&nbsp;<span class="builtintype" id="4265445">uint</span><span class="op" id="4265449">(</span><span class="ident" id="4265450">chunk</span>&nbsp;<span class="op" id="4265456">&amp;</span>&nbsp;<span class="ident" id="4265458">huffmanCountMask</span><span class="op" id="4265474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265479">if</span>&nbsp;<span class="ident" id="4265482">n</span>&nbsp;<span class="op" id="4265484">==</span>&nbsp;<span class="num" id="4265487">0</span>&nbsp;<span class="op" id="4265489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265495">f</span><span class="op" id="4265496">.</span><span class="ident" id="4265497">err</span>&nbsp;<span class="op" id="4265501">=</span>&nbsp;<span class="ident" id="4265503">CorruptInputError</span><span class="op" id="4265520">(</span><span class="ident" id="4265521">f</span><span class="op" id="4265522">.</span><span class="ident" id="4265523">roffset</span><span class="op" id="4265530">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265536">return</span>&nbsp;<span class="num" id="4265543">0</span><span class="op" id="4265544">,</span>&nbsp;<span class="ident" id="4265546">f</span><span class="op" id="4265547">.</span><span class="ident" id="4265548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265563">if</span>&nbsp;<span class="ident" id="4265566">n</span>&nbsp;<span class="op" id="4265568">&lt;=</span>&nbsp;<span class="ident" id="4265571">f</span><span class="op" id="4265572">.</span><span class="ident" id="4265573">nb</span>&nbsp;<span class="op" id="4265576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265581">f</span><span class="op" id="4265582">.</span><span class="ident" id="4265583">b</span>&nbsp;<span class="op" id="4265585">&gt;&gt;=</span>&nbsp;<span class="ident" id="4265589">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265594">f</span><span class="op" id="4265595">.</span><span class="ident" id="4265596">nb</span>&nbsp;<span class="op" id="4265599">-=</span>&nbsp;<span class="ident" id="4265602">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265607">return</span>&nbsp;<span class="builtintype" id="4265614">int</span><span class="op" id="4265617">(</span><span class="ident" id="4265618">chunk</span>&nbsp;<span class="op" id="4265624">&gt;&gt;</span>&nbsp;<span class="ident" id="4265627">huffmanValueShift</span><span class="op" id="4265644">)</span><span class="op" id="4265645">,</span>&nbsp;<span class="builtintype" id="4265647">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265656">}</span><br>
<span class="lineno"></span><span class="op" id="4265658">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="4265661">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4265716">func</span>&nbsp;<span class="op" id="4265721">(</span><span class="ident" id="4265722">f</span>&nbsp;<span class="op" id="4265724">*</span><span class="ident" id="4265725">decompressor</span><span class="op" id="4265737">)</span>&nbsp;<span class="ident" id="4265739">flush</span><span class="op" id="4265744">(</span><span class="ident" id="4265745">step</span>&nbsp;<span class="keyword" id="4265750">func</span><span class="op" id="4265754">(</span><span class="op" id="4265755">*</span><span class="ident" id="4265756">decompressor</span><span class="op" id="4265768">)</span><span class="op" id="4265769">)</span>&nbsp;<span class="op" id="4265771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265774">f</span><span class="op" id="4265775">.</span><span class="ident" id="4265776">toRead</span>&nbsp;<span class="op" id="4265783">=</span>&nbsp;<span class="ident" id="4265785">f</span><span class="op" id="4265786">.</span><span class="ident" id="4265787">hist</span><span class="op" id="4265791">[</span><span class="ident" id="4265792">f</span><span class="op" id="4265793">.</span><span class="ident" id="4265794">hw</span><span class="op" id="4265796">:</span><span class="ident" id="4265797">f</span><span class="op" id="4265798">.</span><span class="ident" id="4265799">hp</span><span class="op" id="4265801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265804">f</span><span class="op" id="4265805">.</span><span class="ident" id="4265806">woffset</span>&nbsp;<span class="op" id="4265814">+=</span>&nbsp;<span class="ident" id="4265817">int64</span><span class="op" id="4265822">(</span><span class="ident" id="4265823">f</span><span class="op" id="4265824">.</span><span class="ident" id="4265825">hp</span>&nbsp;<span class="op" id="4265828">-</span>&nbsp;<span class="ident" id="4265830">f</span><span class="op" id="4265831">.</span><span class="ident" id="4265832">hw</span><span class="op" id="4265834">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265837">f</span><span class="op" id="4265838">.</span><span class="ident" id="4265839">hw</span>&nbsp;<span class="op" id="4265842">=</span>&nbsp;<span class="ident" id="4265844">f</span><span class="op" id="4265845">.</span><span class="ident" id="4265846">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265850">if</span>&nbsp;<span class="ident" id="4265853">f</span><span class="op" id="4265854">.</span><span class="ident" id="4265855">hp</span>&nbsp;<span class="op" id="4265858">==</span>&nbsp;<span class="builtinfunc" id="4265861">len</span><span class="op" id="4265864">(</span><span class="ident" id="4265865">f</span><span class="op" id="4265866">.</span><span class="ident" id="4265867">hist</span><span class="op" id="4265871">)</span>&nbsp;<span class="op" id="4265873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265877">f</span><span class="op" id="4265878">.</span><span class="ident" id="4265879">hp</span>&nbsp;<span class="op" id="4265882">=</span>&nbsp;<span class="num" id="4265884">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265888">f</span><span class="op" id="4265889">.</span><span class="ident" id="4265890">hw</span>&nbsp;<span class="op" id="4265893">=</span>&nbsp;<span class="num" id="4265895">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265899">f</span><span class="op" id="4265900">.</span><span class="ident" id="4265901">hfull</span>&nbsp;<span class="op" id="4265907">=</span>&nbsp;<span class="builtintype" id="4265909">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265918">f</span><span class="op" id="4265919">.</span><span class="ident" id="4265920">step</span>&nbsp;<span class="op" id="4265925">=</span>&nbsp;<span class="ident" id="4265927">step</span><br>
<span class="lineno"></span><span class="op" id="4265932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4265935">func</span>&nbsp;<span class="ident" id="4265940">makeReader</span><span class="op" id="4265950">(</span><span class="ident" id="4265951">r</span>&nbsp;<span class="ident" id="4265953">io</span><span class="op" id="4265955">.</span><span class="ident" id="4265956">Reader</span><span class="op" id="4265962">)</span>&nbsp;<span class="ident" id="4265964">Reader</span>&nbsp;<span class="op" id="4265971">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265974">if</span>&nbsp;<span class="ident" id="4265977">rr</span><span class="op" id="4265979">,</span>&nbsp;<span class="ident" id="4265981">ok</span>&nbsp;<span class="op" id="4265984">:=</span>&nbsp;<span class="ident" id="4265987">r</span><span class="op" id="4265988">.</span><span class="op" id="4265989">(</span><span class="ident" id="4265990">Reader</span><span class="op" id="4265996">)</span><span class="op" id="4265997">;</span>&nbsp;<span class="ident" id="4265999">ok</span>&nbsp;<span class="op" id="4266002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266006">return</span>&nbsp;<span class="ident" id="4266013">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266020">return</span>&nbsp;<span class="ident" id="4266027">bufio</span><span class="op" id="4266032">.</span><span class="ident" id="4266033">NewReader</span><span class="op" id="4266042">(</span><span class="ident" id="4266043">r</span><span class="op" id="4266044">)</span><br>
<span class="lineno"></span><span class="op" id="4266046">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4266049">func</span>&nbsp;<span class="op" id="4266054">(</span><span class="ident" id="4266055">f</span>&nbsp;<span class="op" id="4266057">*</span><span class="ident" id="4266058">decompressor</span><span class="op" id="4266070">)</span>&nbsp;<span class="ident" id="4266072">Reset</span><span class="op" id="4266077">(</span><span class="ident" id="4266078">r</span>&nbsp;<span class="ident" id="4266080">io</span><span class="op" id="4266082">.</span><span class="ident" id="4266083">Reader</span><span class="op" id="4266089">,</span>&nbsp;<span class="ident" id="4266091">dict</span>&nbsp;<span class="op" id="4266096">[</span><span class="op" id="4266097">]</span><span class="builtintype" id="4266098">byte</span><span class="op" id="4266102">)</span>&nbsp;<span class="builtintype" id="4266104">error</span>&nbsp;<span class="op" id="4266110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266113">*</span><span class="ident" id="4266114">f</span>&nbsp;<span class="op" id="4266116">=</span>&nbsp;<span class="ident" id="4266118">decompressor</span><span class="op" id="4266130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266134">r</span><span class="op" id="4266135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266144">makeReader</span><span class="op" id="4266154">(</span><span class="ident" id="4266155">r</span><span class="op" id="4266156">)</span><span class="op" id="4266157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266161">bits</span><span class="op" id="4266165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266171">f</span><span class="op" id="4266172">.</span><span class="ident" id="4266173">bits</span><span class="op" id="4266177">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266181">codebits</span><span class="op" id="4266189">:</span>&nbsp;<span class="ident" id="4266191">f</span><span class="op" id="4266192">.</span><span class="ident" id="4266193">codebits</span><span class="op" id="4266201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266205">hist</span><span class="op" id="4266209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266215">f</span><span class="op" id="4266216">.</span><span class="ident" id="4266217">hist</span><span class="op" id="4266221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266225">step</span><span class="op" id="4266229">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266235">(</span><span class="op" id="4266236">*</span><span class="ident" id="4266237">decompressor</span><span class="op" id="4266249">)</span><span class="op" id="4266250">.</span><span class="ident" id="4266251">nextBlock</span><span class="op" id="4266260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266266">if</span>&nbsp;<span class="ident" id="4266269">dict</span>&nbsp;<span class="op" id="4266274">!=</span>&nbsp;<span class="builtintype" id="4266277">nil</span>&nbsp;<span class="op" id="4266281">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266285">f</span><span class="op" id="4266286">.</span><span class="ident" id="4266287">setDict</span><span class="op" id="4266294">(</span><span class="ident" id="4266295">dict</span><span class="op" id="4266299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266305">return</span>&nbsp;<span class="builtintype" id="4266312">nil</span><br>
<span class="lineno"></span><span class="op" id="4266316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="4266319">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4266374">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4266416">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4266463">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4266525">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="4266594">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="4266620">//</span><br>
<span class="lineno"></span><span class="comment" id="4266623">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="4266689">func</span>&nbsp;<span class="ident" id="4266694">NewReader</span><span class="op" id="4266703">(</span><span class="ident" id="4266704">r</span>&nbsp;<span class="ident" id="4266706">io</span><span class="op" id="4266708">.</span><span class="ident" id="4266709">Reader</span><span class="op" id="4266715">)</span>&nbsp;<span class="ident" id="4266717">io</span><span class="op" id="4266719">.</span><span class="ident" id="4266720">ReadCloser</span>&nbsp;<span class="op" id="4266731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266734">var</span>&nbsp;<span class="ident" id="4266738">f</span>&nbsp;<span class="ident" id="4266740">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266754">f</span><span class="op" id="4266755">.</span><span class="ident" id="4266756">bits</span>&nbsp;<span class="op" id="4266761">=</span>&nbsp;<span class="builtinfunc" id="4266763">new</span><span class="op" id="4266766">(</span><span class="op" id="4266767">[</span><span class="ident" id="4266768">maxLit</span>&nbsp;<span class="op" id="4266775">+</span>&nbsp;<span class="ident" id="4266777">maxDist</span><span class="op" id="4266784">]</span><span class="builtintype" id="4266785">int</span><span class="op" id="4266788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266791">f</span><span class="op" id="4266792">.</span><span class="ident" id="4266793">codebits</span>&nbsp;<span class="op" id="4266802">=</span>&nbsp;<span class="builtinfunc" id="4266804">new</span><span class="op" id="4266807">(</span><span class="op" id="4266808">[</span><span class="ident" id="4266809">numCodes</span><span class="op" id="4266817">]</span><span class="builtintype" id="4266818">int</span><span class="op" id="4266821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266824">f</span><span class="op" id="4266825">.</span><span class="ident" id="4266826">r</span>&nbsp;<span class="op" id="4266828">=</span>&nbsp;<span class="ident" id="4266830">makeReader</span><span class="op" id="4266840">(</span><span class="ident" id="4266841">r</span><span class="op" id="4266842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266845">f</span><span class="op" id="4266846">.</span><span class="ident" id="4266847">hist</span>&nbsp;<span class="op" id="4266852">=</span>&nbsp;<span class="builtinfunc" id="4266854">new</span><span class="op" id="4266857">(</span><span class="op" id="4266858">[</span><span class="ident" id="4266859">maxHist</span><span class="op" id="4266866">]</span><span class="builtintype" id="4266867">byte</span><span class="op" id="4266871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266874">f</span><span class="op" id="4266875">.</span><span class="ident" id="4266876">step</span>&nbsp;<span class="op" id="4266881">=</span>&nbsp;<span class="op" id="4266883">(</span><span class="op" id="4266884">*</span><span class="ident" id="4266885">decompressor</span><span class="op" id="4266897">)</span><span class="op" id="4266898">.</span><span class="ident" id="4266899">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266910">return</span>&nbsp;<span class="op" id="4266917">&amp;</span><span class="ident" id="4266918">f</span><br>
<span class="lineno"></span><span class="op" id="4266920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4266923">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="4266985">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="4267049">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="4267116">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4267181">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="4267226">//</span><br>
<span class="lineno"></span><span class="comment" id="4267229">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="4267295">func</span>&nbsp;<span class="ident" id="4267300">NewReaderDict</span><span class="op" id="4267313">(</span><span class="ident" id="4267314">r</span>&nbsp;<span class="ident" id="4267316">io</span><span class="op" id="4267318">.</span><span class="ident" id="4267319">Reader</span><span class="op" id="4267325">,</span>&nbsp;<span class="ident" id="4267327">dict</span>&nbsp;<span class="op" id="4267332">[</span><span class="op" id="4267333">]</span><span class="builtintype" id="4267334">byte</span><span class="op" id="4267338">)</span>&nbsp;<span class="ident" id="4267340">io</span><span class="op" id="4267342">.</span><span class="ident" id="4267343">ReadCloser</span>&nbsp;<span class="op" id="4267354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267357">var</span>&nbsp;<span class="ident" id="4267361">f</span>&nbsp;<span class="ident" id="4267363">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267377">f</span><span class="op" id="4267378">.</span><span class="ident" id="4267379">r</span>&nbsp;<span class="op" id="4267381">=</span>&nbsp;<span class="ident" id="4267383">makeReader</span><span class="op" id="4267393">(</span><span class="ident" id="4267394">r</span><span class="op" id="4267395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267398">f</span><span class="op" id="4267399">.</span><span class="ident" id="4267400">hist</span>&nbsp;<span class="op" id="4267405">=</span>&nbsp;<span class="builtinfunc" id="4267407">new</span><span class="op" id="4267410">(</span><span class="op" id="4267411">[</span><span class="ident" id="4267412">maxHist</span><span class="op" id="4267419">]</span><span class="builtintype" id="4267420">byte</span><span class="op" id="4267424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267427">f</span><span class="op" id="4267428">.</span><span class="ident" id="4267429">bits</span>&nbsp;<span class="op" id="4267434">=</span>&nbsp;<span class="builtinfunc" id="4267436">new</span><span class="op" id="4267439">(</span><span class="op" id="4267440">[</span><span class="ident" id="4267441">maxLit</span>&nbsp;<span class="op" id="4267448">+</span>&nbsp;<span class="ident" id="4267450">maxDist</span><span class="op" id="4267457">]</span><span class="builtintype" id="4267458">int</span><span class="op" id="4267461">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267464">f</span><span class="op" id="4267465">.</span><span class="ident" id="4267466">codebits</span>&nbsp;<span class="op" id="4267475">=</span>&nbsp;<span class="builtinfunc" id="4267477">new</span><span class="op" id="4267480">(</span><span class="op" id="4267481">[</span><span class="ident" id="4267482">numCodes</span><span class="op" id="4267490">]</span><span class="builtintype" id="4267491">int</span><span class="op" id="4267494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267497">f</span><span class="op" id="4267498">.</span><span class="ident" id="4267499">step</span>&nbsp;<span class="op" id="4267504">=</span>&nbsp;<span class="op" id="4267506">(</span><span class="op" id="4267507">*</span><span class="ident" id="4267508">decompressor</span><span class="op" id="4267520">)</span><span class="op" id="4267521">.</span><span class="ident" id="4267522">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267533">f</span><span class="op" id="4267534">.</span><span class="ident" id="4267535">setDict</span><span class="op" id="4267542">(</span><span class="ident" id="4267543">dict</span><span class="op" id="4267547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267550">return</span>&nbsp;<span class="op" id="4267557">&amp;</span><span class="ident" id="4267558">f</span><br>
<span class="lineno"></span><span class="op" id="4267560">}</span>
</div>
</body>
</html>
