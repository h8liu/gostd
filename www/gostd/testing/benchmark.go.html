<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6082267">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6082322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6082376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6082427">package</span>&nbsp;<span class="ident" id="6082435">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082444">import</span>&nbsp;<span class="op" id="6082451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082454">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082462">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082469">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082475">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082486">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082494">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6082509">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6082516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082519">var</span>&nbsp;<span class="ident" id="6082523">matchBenchmarks</span>&nbsp;<span class="op" id="6082539">=</span>&nbsp;<span class="ident" id="6082541">flag</span><span class="op" id="6082545">.</span><span class="ident" id="6082546">String</span><span class="op" id="6082552">(</span><span class="string" id="6082553">&#34;test.bench&#34;</span><span class="op" id="6082565">,</span>&nbsp;<span class="string" id="6082567">&#34;&#34;</span><span class="op" id="6082569">,</span>&nbsp;<span class="string" id="6082571">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6082619">)</span><br>
<span class="lineno"></span><span class="keyword" id="6082621">var</span>&nbsp;<span class="ident" id="6082625">benchTime</span>&nbsp;<span class="op" id="6082635">=</span>&nbsp;<span class="ident" id="6082637">flag</span><span class="op" id="6082641">.</span><span class="ident" id="6082642">Duration</span><span class="op" id="6082650">(</span><span class="string" id="6082651">&#34;test.benchtime&#34;</span><span class="op" id="6082667">,</span>&nbsp;<span class="num" id="6082669">1</span><span class="op" id="6082670">*</span><span class="ident" id="6082671">time</span><span class="op" id="6082675">.</span><span class="ident" id="6082676">Second</span><span class="op" id="6082682">,</span>&nbsp;<span class="string" id="6082684">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6082725">)</span><br>
<span class="lineno"></span><span class="keyword" id="6082727">var</span>&nbsp;<span class="ident" id="6082731">benchmarkMemory</span>&nbsp;<span class="op" id="6082747">=</span>&nbsp;<span class="ident" id="6082749">flag</span><span class="op" id="6082753">.</span><span class="ident" id="6082754">Bool</span><span class="op" id="6082758">(</span><span class="string" id="6082759">&#34;test.benchmem&#34;</span><span class="op" id="6082774">,</span>&nbsp;<span class="builtintype" id="6082776">false</span><span class="op" id="6082781">,</span>&nbsp;<span class="string" id="6082783">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6082824">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6082827">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6082887">var</span>&nbsp;<span class="ident" id="6082891">benchmarkLock</span>&nbsp;<span class="ident" id="6082905">sync</span><span class="op" id="6082909">.</span><span class="ident" id="6082910">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082917">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6082967">var</span>&nbsp;<span class="ident" id="6082971">memStats</span>&nbsp;<span class="ident" id="6082980">runtime</span><span class="op" id="6082987">.</span><span class="ident" id="6082988">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082998">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6083087">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6083116">type</span>&nbsp;<span class="ident" id="6083121">InternalBenchmark</span>&nbsp;<span class="keyword" id="6083139">struct</span>&nbsp;<span class="op" id="6083146">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083149">Name</span>&nbsp;<span class="builtintype" id="6083154">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083162">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6083167">func</span><span class="op" id="6083171">(</span><span class="ident" id="6083172">b</span>&nbsp;<span class="op" id="6083174">*</span><span class="ident" id="6083175">B</span><span class="op" id="6083176">)</span><br>
<span class="lineno"></span><span class="op" id="6083178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083181">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6083246">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6083304">type</span>&nbsp;<span class="ident" id="6083309">B</span>&nbsp;<span class="keyword" id="6083311">struct</span>&nbsp;<span class="op" id="6083318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083321">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083329">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6083346">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083351">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6083368">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083382">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083427">previousDuration</span>&nbsp;<span class="ident" id="6083444">time</span><span class="op" id="6083448">.</span><span class="ident" id="6083449">Duration</span>&nbsp;<span class="comment" id="6083458">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083497">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083514">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083533">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083550">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083557">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6083574">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083580">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6083597">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083603">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083620">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083637">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6083654">int</span>&nbsp;<span class="comment" id="6083658">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083716">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083784">startAllocs</span>&nbsp;<span class="ident" id="6083796">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083804">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6083816">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6083824">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083872">netAllocs</span>&nbsp;<span class="ident" id="6083882">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6083890">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6083900">uint64</span><br>
<span class="lineno"></span><span class="op" id="6083907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6083910">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6083985">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6084059">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6084083">func</span>&nbsp;<span class="op" id="6084088">(</span><span class="ident" id="6084089">b</span>&nbsp;<span class="op" id="6084091">*</span><span class="ident" id="6084092">B</span><span class="op" id="6084093">)</span>&nbsp;<span class="ident" id="6084095">StartTimer</span><span class="op" id="6084105">(</span><span class="op" id="6084106">)</span>&nbsp;<span class="op" id="6084108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084111">if</span>&nbsp;<span class="op" id="6084114">!</span><span class="ident" id="6084115">b</span><span class="op" id="6084116">.</span><span class="ident" id="6084117">timerOn</span>&nbsp;<span class="op" id="6084125">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084129">runtime</span><span class="op" id="6084136">.</span><span class="ident" id="6084137">ReadMemStats</span><span class="op" id="6084149">(</span><span class="op" id="6084150">&amp;</span><span class="ident" id="6084151">memStats</span><span class="op" id="6084159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084163">b</span><span class="op" id="6084164">.</span><span class="ident" id="6084165">startAllocs</span>&nbsp;<span class="op" id="6084177">=</span>&nbsp;<span class="ident" id="6084179">memStats</span><span class="op" id="6084187">.</span><span class="ident" id="6084188">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084198">b</span><span class="op" id="6084199">.</span><span class="ident" id="6084200">startBytes</span>&nbsp;<span class="op" id="6084211">=</span>&nbsp;<span class="ident" id="6084213">memStats</span><span class="op" id="6084221">.</span><span class="ident" id="6084222">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084235">b</span><span class="op" id="6084236">.</span><span class="ident" id="6084237">start</span>&nbsp;<span class="op" id="6084243">=</span>&nbsp;<span class="ident" id="6084245">time</span><span class="op" id="6084249">.</span><span class="ident" id="6084250">Now</span><span class="op" id="6084253">(</span><span class="op" id="6084254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084258">b</span><span class="op" id="6084259">.</span><span class="ident" id="6084260">timerOn</span>&nbsp;<span class="op" id="6084268">=</span>&nbsp;<span class="builtintype" id="6084270">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084276">}</span><br>
<span class="lineno"></span><span class="op" id="6084278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084281">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6084352">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6084410">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6084430">func</span>&nbsp;<span class="op" id="6084435">(</span><span class="ident" id="6084436">b</span>&nbsp;<span class="op" id="6084438">*</span><span class="ident" id="6084439">B</span><span class="op" id="6084440">)</span>&nbsp;<span class="ident" id="6084442">StopTimer</span><span class="op" id="6084451">(</span><span class="op" id="6084452">)</span>&nbsp;<span class="op" id="6084454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084457">if</span>&nbsp;<span class="ident" id="6084460">b</span><span class="op" id="6084461">.</span><span class="ident" id="6084462">timerOn</span>&nbsp;<span class="op" id="6084470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084474">b</span><span class="op" id="6084475">.</span><span class="ident" id="6084476">duration</span>&nbsp;<span class="op" id="6084485">+=</span>&nbsp;<span class="ident" id="6084488">time</span><span class="op" id="6084492">.</span><span class="ident" id="6084493">Now</span><span class="op" id="6084496">(</span><span class="op" id="6084497">)</span><span class="op" id="6084498">.</span><span class="ident" id="6084499">Sub</span><span class="op" id="6084502">(</span><span class="ident" id="6084503">b</span><span class="op" id="6084504">.</span><span class="ident" id="6084505">start</span><span class="op" id="6084510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084514">runtime</span><span class="op" id="6084521">.</span><span class="ident" id="6084522">ReadMemStats</span><span class="op" id="6084534">(</span><span class="op" id="6084535">&amp;</span><span class="ident" id="6084536">memStats</span><span class="op" id="6084544">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084548">b</span><span class="op" id="6084549">.</span><span class="ident" id="6084550">netAllocs</span>&nbsp;<span class="op" id="6084560">+=</span>&nbsp;<span class="ident" id="6084563">memStats</span><span class="op" id="6084571">.</span><span class="ident" id="6084572">Mallocs</span>&nbsp;<span class="op" id="6084580">-</span>&nbsp;<span class="ident" id="6084582">b</span><span class="op" id="6084583">.</span><span class="ident" id="6084584">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084598">b</span><span class="op" id="6084599">.</span><span class="ident" id="6084600">netBytes</span>&nbsp;<span class="op" id="6084609">+=</span>&nbsp;<span class="ident" id="6084612">memStats</span><span class="op" id="6084620">.</span><span class="ident" id="6084621">TotalAlloc</span>&nbsp;<span class="op" id="6084632">-</span>&nbsp;<span class="ident" id="6084634">b</span><span class="op" id="6084635">.</span><span class="ident" id="6084636">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084649">b</span><span class="op" id="6084650">.</span><span class="ident" id="6084651">timerOn</span>&nbsp;<span class="op" id="6084659">=</span>&nbsp;<span class="builtintype" id="6084661">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084668">}</span><br>
<span class="lineno"></span><span class="op" id="6084670">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6084673">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6084752">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6084804">func</span>&nbsp;<span class="op" id="6084809">(</span><span class="ident" id="6084810">b</span>&nbsp;<span class="op" id="6084812">*</span><span class="ident" id="6084813">B</span><span class="op" id="6084814">)</span>&nbsp;<span class="ident" id="6084816">ResetTimer</span><span class="op" id="6084826">(</span><span class="op" id="6084827">)</span>&nbsp;<span class="op" id="6084829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6084832">if</span>&nbsp;<span class="ident" id="6084835">b</span><span class="op" id="6084836">.</span><span class="ident" id="6084837">timerOn</span>&nbsp;<span class="op" id="6084845">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084849">runtime</span><span class="op" id="6084856">.</span><span class="ident" id="6084857">ReadMemStats</span><span class="op" id="6084869">(</span><span class="op" id="6084870">&amp;</span><span class="ident" id="6084871">memStats</span><span class="op" id="6084879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084883">b</span><span class="op" id="6084884">.</span><span class="ident" id="6084885">startAllocs</span>&nbsp;<span class="op" id="6084897">=</span>&nbsp;<span class="ident" id="6084899">memStats</span><span class="op" id="6084907">.</span><span class="ident" id="6084908">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084918">b</span><span class="op" id="6084919">.</span><span class="ident" id="6084920">startBytes</span>&nbsp;<span class="op" id="6084931">=</span>&nbsp;<span class="ident" id="6084933">memStats</span><span class="op" id="6084941">.</span><span class="ident" id="6084942">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084955">b</span><span class="op" id="6084956">.</span><span class="ident" id="6084957">start</span>&nbsp;<span class="op" id="6084963">=</span>&nbsp;<span class="ident" id="6084965">time</span><span class="op" id="6084969">.</span><span class="ident" id="6084970">Now</span><span class="op" id="6084973">(</span><span class="op" id="6084974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6084977">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084980">b</span><span class="op" id="6084981">.</span><span class="ident" id="6084982">duration</span>&nbsp;<span class="op" id="6084991">=</span>&nbsp;<span class="num" id="6084993">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084996">b</span><span class="op" id="6084997">.</span><span class="ident" id="6084998">netAllocs</span>&nbsp;<span class="op" id="6085008">=</span>&nbsp;<span class="num" id="6085010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085013">b</span><span class="op" id="6085014">.</span><span class="ident" id="6085015">netBytes</span>&nbsp;<span class="op" id="6085024">=</span>&nbsp;<span class="num" id="6085026">0</span><br>
<span class="lineno"></span><span class="op" id="6085028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6085031">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6085104">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6085168">func</span>&nbsp;<span class="op" id="6085173">(</span><span class="ident" id="6085174">b</span>&nbsp;<span class="op" id="6085176">*</span><span class="ident" id="6085177">B</span><span class="op" id="6085178">)</span>&nbsp;<span class="ident" id="6085180">SetBytes</span><span class="op" id="6085188">(</span><span class="ident" id="6085189">n</span>&nbsp;<span class="ident" id="6085191">int64</span><span class="op" id="6085196">)</span>&nbsp;<span class="op" id="6085198">{</span>&nbsp;<span class="ident" id="6085200">b</span><span class="op" id="6085201">.</span><span class="ident" id="6085202">bytes</span>&nbsp;<span class="op" id="6085208">=</span>&nbsp;<span class="ident" id="6085210">n</span>&nbsp;<span class="op" id="6085212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085215">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6085277">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6085348">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6085395">func</span>&nbsp;<span class="op" id="6085400">(</span><span class="ident" id="6085401">b</span>&nbsp;<span class="op" id="6085403">*</span><span class="ident" id="6085404">B</span><span class="op" id="6085405">)</span>&nbsp;<span class="ident" id="6085407">ReportAllocs</span><span class="op" id="6085419">(</span><span class="op" id="6085420">)</span>&nbsp;<span class="op" id="6085422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085425">b</span><span class="op" id="6085426">.</span><span class="ident" id="6085427">showAllocResult</span>&nbsp;<span class="op" id="6085443">=</span>&nbsp;<span class="builtintype" id="6085445">true</span><br>
<span class="lineno"></span><span class="op" id="6085450">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6085453">func</span>&nbsp;<span class="op" id="6085458">(</span><span class="ident" id="6085459">b</span>&nbsp;<span class="op" id="6085461">*</span><span class="ident" id="6085462">B</span><span class="op" id="6085463">)</span>&nbsp;<span class="ident" id="6085465">nsPerOp</span><span class="op" id="6085472">(</span><span class="op" id="6085473">)</span>&nbsp;<span class="ident" id="6085475">int64</span>&nbsp;<span class="op" id="6085481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085484">if</span>&nbsp;<span class="ident" id="6085487">b</span><span class="op" id="6085488">.</span><span class="ident" id="6085489">N</span>&nbsp;<span class="op" id="6085491">&lt;=</span>&nbsp;<span class="num" id="6085494">0</span>&nbsp;<span class="op" id="6085496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085500">return</span>&nbsp;<span class="num" id="6085507">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6085510">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085513">return</span>&nbsp;<span class="ident" id="6085520">b</span><span class="op" id="6085521">.</span><span class="ident" id="6085522">duration</span><span class="op" id="6085530">.</span><span class="ident" id="6085531">Nanoseconds</span><span class="op" id="6085542">(</span><span class="op" id="6085543">)</span>&nbsp;<span class="op" id="6085545">/</span>&nbsp;<span class="ident" id="6085547">int64</span><span class="op" id="6085552">(</span><span class="ident" id="6085553">b</span><span class="op" id="6085554">.</span><span class="ident" id="6085555">N</span><span class="op" id="6085556">)</span><br>
<span class="lineno"></span><span class="op" id="6085558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6085561">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6085633">func</span>&nbsp;<span class="op" id="6085638">(</span><span class="ident" id="6085639">b</span>&nbsp;<span class="op" id="6085641">*</span><span class="ident" id="6085642">B</span><span class="op" id="6085643">)</span>&nbsp;<span class="ident" id="6085645">runN</span><span class="op" id="6085649">(</span><span class="ident" id="6085650">n</span>&nbsp;<span class="builtintype" id="6085652">int</span><span class="op" id="6085655">)</span>&nbsp;<span class="op" id="6085657">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085660">benchmarkLock</span><span class="op" id="6085673">.</span><span class="ident" id="6085674">Lock</span><span class="op" id="6085678">(</span><span class="op" id="6085679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085682">defer</span>&nbsp;<span class="ident" id="6085688">benchmarkLock</span><span class="op" id="6085701">.</span><span class="ident" id="6085702">Unlock</span><span class="op" id="6085708">(</span><span class="op" id="6085709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085712">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085765">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085809">runtime</span><span class="op" id="6085816">.</span><span class="ident" id="6085817">GC</span><span class="op" id="6085819">(</span><span class="op" id="6085820">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085823">b</span><span class="op" id="6085824">.</span><span class="ident" id="6085825">N</span>&nbsp;<span class="op" id="6085827">=</span>&nbsp;<span class="ident" id="6085829">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085832">b</span><span class="op" id="6085833">.</span><span class="ident" id="6085834">parallelism</span>&nbsp;<span class="op" id="6085846">=</span>&nbsp;<span class="num" id="6085848">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085851">b</span><span class="op" id="6085852">.</span><span class="ident" id="6085853">ResetTimer</span><span class="op" id="6085863">(</span><span class="op" id="6085864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085867">b</span><span class="op" id="6085868">.</span><span class="ident" id="6085869">StartTimer</span><span class="op" id="6085879">(</span><span class="op" id="6085880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085883">b</span><span class="op" id="6085884">.</span><span class="ident" id="6085885">benchmark</span><span class="op" id="6085894">.</span><span class="ident" id="6085895">F</span><span class="op" id="6085896">(</span><span class="ident" id="6085897">b</span><span class="op" id="6085898">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085901">b</span><span class="op" id="6085902">.</span><span class="ident" id="6085903">StopTimer</span><span class="op" id="6085912">(</span><span class="op" id="6085913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085916">b</span><span class="op" id="6085917">.</span><span class="ident" id="6085918">previousN</span>&nbsp;<span class="op" id="6085928">=</span>&nbsp;<span class="ident" id="6085930">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085933">b</span><span class="op" id="6085934">.</span><span class="ident" id="6085935">previousDuration</span>&nbsp;<span class="op" id="6085952">=</span>&nbsp;<span class="ident" id="6085954">b</span><span class="op" id="6085955">.</span><span class="ident" id="6085956">duration</span><br>
<span class="lineno"></span><span class="op" id="6085965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6085968">func</span>&nbsp;<span class="ident" id="6085973">min</span><span class="op" id="6085976">(</span><span class="ident" id="6085977">x</span><span class="op" id="6085978">,</span>&nbsp;<span class="ident" id="6085980">y</span>&nbsp;<span class="builtintype" id="6085982">int</span><span class="op" id="6085985">)</span>&nbsp;<span class="builtintype" id="6085987">int</span>&nbsp;<span class="op" id="6085991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6085994">if</span>&nbsp;<span class="ident" id="6085997">x</span>&nbsp;<span class="op" id="6085999">&gt;</span>&nbsp;<span class="ident" id="6086001">y</span>&nbsp;<span class="op" id="6086003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086007">return</span>&nbsp;<span class="ident" id="6086014">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086020">return</span>&nbsp;<span class="ident" id="6086027">x</span><br>
<span class="lineno">135</span><span class="op" id="6086029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086032">func</span>&nbsp;<span class="ident" id="6086037">max</span><span class="op" id="6086040">(</span><span class="ident" id="6086041">x</span><span class="op" id="6086042">,</span>&nbsp;<span class="ident" id="6086044">y</span>&nbsp;<span class="builtintype" id="6086046">int</span><span class="op" id="6086049">)</span>&nbsp;<span class="builtintype" id="6086051">int</span>&nbsp;<span class="op" id="6086055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086058">if</span>&nbsp;<span class="ident" id="6086061">x</span>&nbsp;<span class="op" id="6086063">&lt;</span>&nbsp;<span class="ident" id="6086065">y</span>&nbsp;<span class="op" id="6086067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086071">return</span>&nbsp;<span class="ident" id="6086078">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086084">return</span>&nbsp;<span class="ident" id="6086091">x</span><br>
<span class="lineno"></span><span class="op" id="6086093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086096">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6086160">func</span>&nbsp;<span class="ident" id="6086165">roundDown10</span><span class="op" id="6086176">(</span><span class="ident" id="6086177">n</span>&nbsp;<span class="builtintype" id="6086179">int</span><span class="op" id="6086182">)</span>&nbsp;<span class="builtintype" id="6086184">int</span>&nbsp;<span class="op" id="6086188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086191">var</span>&nbsp;<span class="ident" id="6086195">tens</span>&nbsp;<span class="op" id="6086200">=</span>&nbsp;<span class="num" id="6086202">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086205">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086233">for</span>&nbsp;<span class="ident" id="6086237">n</span>&nbsp;<span class="op" id="6086239">&gt;=</span>&nbsp;<span class="num" id="6086242">10</span>&nbsp;<span class="op" id="6086245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086249">n</span>&nbsp;<span class="op" id="6086251">=</span>&nbsp;<span class="ident" id="6086253">n</span>&nbsp;<span class="op" id="6086255">/</span>&nbsp;<span class="num" id="6086257">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086262">tens</span><span class="op" id="6086266">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6086273">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086294">result</span>&nbsp;<span class="op" id="6086301">:=</span>&nbsp;<span class="num" id="6086304">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086307">for</span>&nbsp;<span class="ident" id="6086311">i</span>&nbsp;<span class="op" id="6086313">:=</span>&nbsp;<span class="num" id="6086316">0</span><span class="op" id="6086317">;</span>&nbsp;<span class="ident" id="6086319">i</span>&nbsp;<span class="op" id="6086321">&lt;</span>&nbsp;<span class="ident" id="6086323">tens</span><span class="op" id="6086327">;</span>&nbsp;<span class="ident" id="6086329">i</span><span class="op" id="6086330">++</span>&nbsp;<span class="op" id="6086333">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086337">result</span>&nbsp;<span class="op" id="6086344">*=</span>&nbsp;<span class="num" id="6086347">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086354">return</span>&nbsp;<span class="ident" id="6086361">result</span><br>
<span class="lineno"></span><span class="op" id="6086368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6086371">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6086440">func</span>&nbsp;<span class="ident" id="6086445">roundUp</span><span class="op" id="6086452">(</span><span class="ident" id="6086453">n</span>&nbsp;<span class="builtintype" id="6086455">int</span><span class="op" id="6086458">)</span>&nbsp;<span class="builtintype" id="6086460">int</span>&nbsp;<span class="op" id="6086464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6086467">base</span>&nbsp;<span class="op" id="6086472">:=</span>&nbsp;<span class="ident" id="6086475">roundDown10</span><span class="op" id="6086486">(</span><span class="ident" id="6086487">n</span><span class="op" id="6086488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086491">switch</span>&nbsp;<span class="op" id="6086498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086501">case</span>&nbsp;<span class="ident" id="6086506">n</span>&nbsp;<span class="op" id="6086508">&lt;=</span>&nbsp;<span class="ident" id="6086511">base</span><span class="op" id="6086515">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086519">return</span>&nbsp;<span class="ident" id="6086526">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086532">case</span>&nbsp;<span class="ident" id="6086537">n</span>&nbsp;<span class="op" id="6086539">&lt;=</span>&nbsp;<span class="op" id="6086542">(</span><span class="num" id="6086543">2</span>&nbsp;<span class="op" id="6086545">*</span>&nbsp;<span class="ident" id="6086547">base</span><span class="op" id="6086551">)</span><span class="op" id="6086552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086556">return</span>&nbsp;<span class="num" id="6086563">2</span>&nbsp;<span class="op" id="6086565">*</span>&nbsp;<span class="ident" id="6086567">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086573">case</span>&nbsp;<span class="ident" id="6086578">n</span>&nbsp;<span class="op" id="6086580">&lt;=</span>&nbsp;<span class="op" id="6086583">(</span><span class="num" id="6086584">3</span>&nbsp;<span class="op" id="6086586">*</span>&nbsp;<span class="ident" id="6086588">base</span><span class="op" id="6086592">)</span><span class="op" id="6086593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086597">return</span>&nbsp;<span class="num" id="6086604">3</span>&nbsp;<span class="op" id="6086606">*</span>&nbsp;<span class="ident" id="6086608">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086614">case</span>&nbsp;<span class="ident" id="6086619">n</span>&nbsp;<span class="op" id="6086621">&lt;=</span>&nbsp;<span class="op" id="6086624">(</span><span class="num" id="6086625">5</span>&nbsp;<span class="op" id="6086627">*</span>&nbsp;<span class="ident" id="6086629">base</span><span class="op" id="6086633">)</span><span class="op" id="6086634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086638">return</span>&nbsp;<span class="num" id="6086645">5</span>&nbsp;<span class="op" id="6086647">*</span>&nbsp;<span class="ident" id="6086649">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086655">default</span><span class="op" id="6086662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086666">return</span>&nbsp;<span class="num" id="6086673">10</span>&nbsp;<span class="op" id="6086676">*</span>&nbsp;<span class="ident" id="6086678">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086684">}</span><br>
<span class="lineno">175</span><span class="op" id="6086686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086689">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6086750">func</span>&nbsp;<span class="op" id="6086755">(</span><span class="ident" id="6086756">b</span>&nbsp;<span class="op" id="6086758">*</span><span class="ident" id="6086759">B</span><span class="op" id="6086760">)</span>&nbsp;<span class="ident" id="6086762">run</span><span class="op" id="6086765">(</span><span class="op" id="6086766">)</span>&nbsp;<span class="ident" id="6086768">BenchmarkResult</span>&nbsp;<span class="op" id="6086784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086787">go</span>&nbsp;<span class="ident" id="6086790">b</span><span class="op" id="6086791">.</span><span class="ident" id="6086792">launch</span><span class="op" id="6086798">(</span><span class="op" id="6086799">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6086802">&lt;-</span><span class="ident" id="6086804">b</span><span class="op" id="6086805">.</span><span class="ident" id="6086806">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6086814">return</span>&nbsp;<span class="ident" id="6086821">b</span><span class="op" id="6086822">.</span><span class="ident" id="6086823">result</span><br>
<span class="lineno"></span><span class="op" id="6086830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6086833">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6086911">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6086992">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6087037">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testing.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;100000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6087081">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6087143">func</span>&nbsp;<span class="op" id="6087148">(</span><span class="ident" id="6087149">b</span>&nbsp;<span class="op" id="6087151">*</span><span class="ident" id="6087152">B</span><span class="op" id="6087153">)</span>&nbsp;<span class="ident" id="6087155">launch</span><span class="op" id="6087161">(</span><span class="op" id="6087162">)</span>&nbsp;<span class="op" id="6087164">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087167">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087236">n</span>&nbsp;<span class="op" id="6087238">:=</span>&nbsp;<span class="num" id="6087241">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087245">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087299">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087335">defer</span>&nbsp;<span class="keyword" id="6087341">func</span><span class="op" id="6087345">(</span><span class="op" id="6087346">)</span>&nbsp;<span class="op" id="6087348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087352">b</span><span class="op" id="6087353">.</span><span class="ident" id="6087354">signal</span>&nbsp;<span class="op" id="6087361">&lt;-</span>&nbsp;<span class="ident" id="6087364">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087367">}</span><span class="op" id="6087368">(</span><span class="op" id="6087369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087373">b</span><span class="op" id="6087374">.</span><span class="ident" id="6087375">runN</span><span class="op" id="6087379">(</span><span class="ident" id="6087380">n</span><span class="op" id="6087381">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087384">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087449">d</span>&nbsp;<span class="op" id="6087451">:=</span>&nbsp;<span class="op" id="6087454">*</span><span class="ident" id="6087455">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087466">for</span>&nbsp;<span class="op" id="6087470">!</span><span class="ident" id="6087471">b</span><span class="op" id="6087472">.</span><span class="ident" id="6087473">failed</span>&nbsp;<span class="op" id="6087480">&amp;&amp;</span>&nbsp;<span class="ident" id="6087483">b</span><span class="op" id="6087484">.</span><span class="ident" id="6087485">duration</span>&nbsp;<span class="op" id="6087494">&lt;</span>&nbsp;<span class="ident" id="6087496">d</span>&nbsp;<span class="op" id="6087498">&amp;&amp;</span>&nbsp;<span class="ident" id="6087501">n</span>&nbsp;<span class="op" id="6087503">&lt;</span>&nbsp;<span class="num" id="6087505">1e9</span>&nbsp;<span class="op" id="6087509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087513">last</span>&nbsp;<span class="op" id="6087518">:=</span>&nbsp;<span class="ident" id="6087521">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087525">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6087559">if</span>&nbsp;<span class="ident" id="6087562">b</span><span class="op" id="6087563">.</span><span class="ident" id="6087564">nsPerOp</span><span class="op" id="6087571">(</span><span class="op" id="6087572">)</span>&nbsp;<span class="op" id="6087574">==</span>&nbsp;<span class="num" id="6087577">0</span>&nbsp;<span class="op" id="6087579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087584">n</span>&nbsp;<span class="op" id="6087586">=</span>&nbsp;<span class="num" id="6087588">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087594">}</span>&nbsp;<span class="keyword" id="6087596">else</span>&nbsp;<span class="op" id="6087601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087606">n</span>&nbsp;<span class="op" id="6087608">=</span>&nbsp;<span class="builtintype" id="6087610">int</span><span class="op" id="6087613">(</span><span class="ident" id="6087614">d</span><span class="op" id="6087615">.</span><span class="ident" id="6087616">Nanoseconds</span><span class="op" id="6087627">(</span><span class="op" id="6087628">)</span>&nbsp;<span class="op" id="6087630">/</span>&nbsp;<span class="ident" id="6087632">b</span><span class="op" id="6087633">.</span><span class="ident" id="6087634">nsPerOp</span><span class="op" id="6087641">(</span><span class="op" id="6087642">)</span><span class="op" id="6087643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087647">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087651">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087709">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087775">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087829">n</span>&nbsp;<span class="op" id="6087831">=</span>&nbsp;<span class="ident" id="6087833">max</span><span class="op" id="6087836">(</span><span class="ident" id="6087837">min</span><span class="op" id="6087840">(</span><span class="ident" id="6087841">n</span><span class="op" id="6087842">+</span><span class="ident" id="6087843">n</span><span class="op" id="6087844">/</span><span class="num" id="6087845">5</span><span class="op" id="6087846">,</span>&nbsp;<span class="num" id="6087848">100</span><span class="op" id="6087851">*</span><span class="ident" id="6087852">last</span><span class="op" id="6087856">)</span><span class="op" id="6087857">,</span>&nbsp;<span class="ident" id="6087859">last</span><span class="op" id="6087863">+</span><span class="num" id="6087864">1</span><span class="op" id="6087865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6087869">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087910">n</span>&nbsp;<span class="op" id="6087912">=</span>&nbsp;<span class="ident" id="6087914">roundUp</span><span class="op" id="6087921">(</span><span class="ident" id="6087922">n</span><span class="op" id="6087923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087927">b</span><span class="op" id="6087928">.</span><span class="ident" id="6087929">runN</span><span class="op" id="6087933">(</span><span class="ident" id="6087934">n</span><span class="op" id="6087935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6087938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6087941">b</span><span class="op" id="6087942">.</span><span class="ident" id="6087943">result</span>&nbsp;<span class="op" id="6087950">=</span>&nbsp;<span class="ident" id="6087952">BenchmarkResult</span><span class="op" id="6087967">{</span><span class="ident" id="6087968">b</span><span class="op" id="6087969">.</span><span class="ident" id="6087970">N</span><span class="op" id="6087971">,</span>&nbsp;<span class="ident" id="6087973">b</span><span class="op" id="6087974">.</span><span class="ident" id="6087975">duration</span><span class="op" id="6087983">,</span>&nbsp;<span class="ident" id="6087985">b</span><span class="op" id="6087986">.</span><span class="ident" id="6087987">bytes</span><span class="op" id="6087992">,</span>&nbsp;<span class="ident" id="6087994">b</span><span class="op" id="6087995">.</span><span class="ident" id="6087996">netAllocs</span><span class="op" id="6088005">,</span>&nbsp;<span class="ident" id="6088007">b</span><span class="op" id="6088008">.</span><span class="ident" id="6088009">netBytes</span><span class="op" id="6088017">}</span><br>
<span class="lineno"></span><span class="op" id="6088019">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6088022">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6088057">type</span>&nbsp;<span class="ident" id="6088062">BenchmarkResult</span>&nbsp;<span class="keyword" id="6088078">struct</span>&nbsp;<span class="op" id="6088085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088088">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6088098">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088112">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088142">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088152">time</span><span class="op" id="6088156">.</span><span class="ident" id="6088157">Duration</span>&nbsp;<span class="comment" id="6088166">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088192">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088202">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088216">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088254">MemAllocs</span>&nbsp;<span class="ident" id="6088264">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088278">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088322">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6088332">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6088346">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6088386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6088389">func</span>&nbsp;<span class="op" id="6088394">(</span><span class="ident" id="6088395">r</span>&nbsp;<span class="ident" id="6088397">BenchmarkResult</span><span class="op" id="6088412">)</span>&nbsp;<span class="ident" id="6088414">NsPerOp</span><span class="op" id="6088421">(</span><span class="op" id="6088422">)</span>&nbsp;<span class="ident" id="6088424">int64</span>&nbsp;<span class="op" id="6088430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088433">if</span>&nbsp;<span class="ident" id="6088436">r</span><span class="op" id="6088437">.</span><span class="ident" id="6088438">N</span>&nbsp;<span class="op" id="6088440">&lt;=</span>&nbsp;<span class="num" id="6088443">0</span>&nbsp;<span class="op" id="6088445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088449">return</span>&nbsp;<span class="num" id="6088456">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088462">return</span>&nbsp;<span class="ident" id="6088469">r</span><span class="op" id="6088470">.</span><span class="ident" id="6088471">T</span><span class="op" id="6088472">.</span><span class="ident" id="6088473">Nanoseconds</span><span class="op" id="6088484">(</span><span class="op" id="6088485">)</span>&nbsp;<span class="op" id="6088487">/</span>&nbsp;<span class="ident" id="6088489">int64</span><span class="op" id="6088494">(</span><span class="ident" id="6088495">r</span><span class="op" id="6088496">.</span><span class="ident" id="6088497">N</span><span class="op" id="6088498">)</span><br>
<span class="lineno">235</span><span class="op" id="6088500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6088503">func</span>&nbsp;<span class="op" id="6088508">(</span><span class="ident" id="6088509">r</span>&nbsp;<span class="ident" id="6088511">BenchmarkResult</span><span class="op" id="6088526">)</span>&nbsp;<span class="ident" id="6088528">mbPerSec</span><span class="op" id="6088536">(</span><span class="op" id="6088537">)</span>&nbsp;<span class="builtintype" id="6088539">float64</span>&nbsp;<span class="op" id="6088547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088550">if</span>&nbsp;<span class="ident" id="6088553">r</span><span class="op" id="6088554">.</span><span class="ident" id="6088555">Bytes</span>&nbsp;<span class="op" id="6088561">&lt;=</span>&nbsp;<span class="num" id="6088564">0</span>&nbsp;<span class="op" id="6088566">||</span>&nbsp;<span class="ident" id="6088569">r</span><span class="op" id="6088570">.</span><span class="ident" id="6088571">T</span>&nbsp;<span class="op" id="6088573">&lt;=</span>&nbsp;<span class="num" id="6088576">0</span>&nbsp;<span class="op" id="6088578">||</span>&nbsp;<span class="ident" id="6088581">r</span><span class="op" id="6088582">.</span><span class="ident" id="6088583">N</span>&nbsp;<span class="op" id="6088585">&lt;=</span>&nbsp;<span class="num" id="6088588">0</span>&nbsp;<span class="op" id="6088590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088594">return</span>&nbsp;<span class="num" id="6088601">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088607">return</span>&nbsp;<span class="op" id="6088614">(</span><span class="builtintype" id="6088615">float64</span><span class="op" id="6088622">(</span><span class="ident" id="6088623">r</span><span class="op" id="6088624">.</span><span class="ident" id="6088625">Bytes</span><span class="op" id="6088630">)</span>&nbsp;<span class="op" id="6088632">*</span>&nbsp;<span class="builtintype" id="6088634">float64</span><span class="op" id="6088641">(</span><span class="ident" id="6088642">r</span><span class="op" id="6088643">.</span><span class="ident" id="6088644">N</span><span class="op" id="6088645">)</span>&nbsp;<span class="op" id="6088647">/</span>&nbsp;<span class="num" id="6088649">1e6</span><span class="op" id="6088652">)</span>&nbsp;<span class="op" id="6088654">/</span>&nbsp;<span class="ident" id="6088656">r</span><span class="op" id="6088657">.</span><span class="ident" id="6088658">T</span><span class="op" id="6088659">.</span><span class="ident" id="6088660">Seconds</span><span class="op" id="6088667">(</span><span class="op" id="6088668">)</span><br>
<span class="lineno"></span><span class="op" id="6088670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6088673">func</span>&nbsp;<span class="op" id="6088678">(</span><span class="ident" id="6088679">r</span>&nbsp;<span class="ident" id="6088681">BenchmarkResult</span><span class="op" id="6088696">)</span>&nbsp;<span class="ident" id="6088698">AllocsPerOp</span><span class="op" id="6088709">(</span><span class="op" id="6088710">)</span>&nbsp;<span class="ident" id="6088712">int64</span>&nbsp;<span class="op" id="6088718">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088721">if</span>&nbsp;<span class="ident" id="6088724">r</span><span class="op" id="6088725">.</span><span class="ident" id="6088726">N</span>&nbsp;<span class="op" id="6088728">&lt;=</span>&nbsp;<span class="num" id="6088731">0</span>&nbsp;<span class="op" id="6088733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088737">return</span>&nbsp;<span class="num" id="6088744">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088750">return</span>&nbsp;<span class="ident" id="6088757">int64</span><span class="op" id="6088762">(</span><span class="ident" id="6088763">r</span><span class="op" id="6088764">.</span><span class="ident" id="6088765">MemAllocs</span><span class="op" id="6088774">)</span>&nbsp;<span class="op" id="6088776">/</span>&nbsp;<span class="ident" id="6088778">int64</span><span class="op" id="6088783">(</span><span class="ident" id="6088784">r</span><span class="op" id="6088785">.</span><span class="ident" id="6088786">N</span><span class="op" id="6088787">)</span><br>
<span class="lineno"></span><span class="op" id="6088789">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6088792">func</span>&nbsp;<span class="op" id="6088797">(</span><span class="ident" id="6088798">r</span>&nbsp;<span class="ident" id="6088800">BenchmarkResult</span><span class="op" id="6088815">)</span>&nbsp;<span class="ident" id="6088817">AllocedBytesPerOp</span><span class="op" id="6088834">(</span><span class="op" id="6088835">)</span>&nbsp;<span class="ident" id="6088837">int64</span>&nbsp;<span class="op" id="6088843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088846">if</span>&nbsp;<span class="ident" id="6088849">r</span><span class="op" id="6088850">.</span><span class="ident" id="6088851">N</span>&nbsp;<span class="op" id="6088853">&lt;=</span>&nbsp;<span class="num" id="6088856">0</span>&nbsp;<span class="op" id="6088858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088862">return</span>&nbsp;<span class="num" id="6088869">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6088872">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088875">return</span>&nbsp;<span class="ident" id="6088882">int64</span><span class="op" id="6088887">(</span><span class="ident" id="6088888">r</span><span class="op" id="6088889">.</span><span class="ident" id="6088890">MemBytes</span><span class="op" id="6088898">)</span>&nbsp;<span class="op" id="6088900">/</span>&nbsp;<span class="ident" id="6088902">int64</span><span class="op" id="6088907">(</span><span class="ident" id="6088908">r</span><span class="op" id="6088909">.</span><span class="ident" id="6088910">N</span><span class="op" id="6088911">)</span><br>
<span class="lineno"></span><span class="op" id="6088913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6088916">func</span>&nbsp;<span class="op" id="6088921">(</span><span class="ident" id="6088922">r</span>&nbsp;<span class="ident" id="6088924">BenchmarkResult</span><span class="op" id="6088939">)</span>&nbsp;<span class="ident" id="6088941">String</span><span class="op" id="6088947">(</span><span class="op" id="6088948">)</span>&nbsp;<span class="builtintype" id="6088950">string</span>&nbsp;<span class="op" id="6088957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088960">mbs</span>&nbsp;<span class="op" id="6088964">:=</span>&nbsp;<span class="ident" id="6088967">r</span><span class="op" id="6088968">.</span><span class="ident" id="6088969">mbPerSec</span><span class="op" id="6088977">(</span><span class="op" id="6088978">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6088981">mb</span>&nbsp;<span class="op" id="6088984">:=</span>&nbsp;<span class="string" id="6088987">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6088991">if</span>&nbsp;<span class="ident" id="6088994">mbs</span>&nbsp;<span class="op" id="6088998">!=</span>&nbsp;<span class="num" id="6089001">0</span>&nbsp;<span class="op" id="6089003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089007">mb</span>&nbsp;<span class="op" id="6089010">=</span>&nbsp;<span class="ident" id="6089012">fmt</span><span class="op" id="6089015">.</span><span class="ident" id="6089016">Sprintf</span><span class="op" id="6089023">(</span><span class="string" id="6089024">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6089038">,</span>&nbsp;<span class="ident" id="6089040">mbs</span><span class="op" id="6089043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089049">nsop</span>&nbsp;<span class="op" id="6089054">:=</span>&nbsp;<span class="ident" id="6089057">r</span><span class="op" id="6089058">.</span><span class="ident" id="6089059">NsPerOp</span><span class="op" id="6089066">(</span><span class="op" id="6089067">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089070">ns</span>&nbsp;<span class="op" id="6089073">:=</span>&nbsp;<span class="ident" id="6089076">fmt</span><span class="op" id="6089079">.</span><span class="ident" id="6089080">Sprintf</span><span class="op" id="6089087">(</span><span class="string" id="6089088">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6089100">,</span>&nbsp;<span class="ident" id="6089102">nsop</span><span class="op" id="6089106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089109">if</span>&nbsp;<span class="ident" id="6089112">r</span><span class="op" id="6089113">.</span><span class="ident" id="6089114">N</span>&nbsp;<span class="op" id="6089116">&gt;</span>&nbsp;<span class="num" id="6089118">0</span>&nbsp;<span class="op" id="6089120">&amp;&amp;</span>&nbsp;<span class="ident" id="6089123">nsop</span>&nbsp;<span class="op" id="6089128">&lt;</span>&nbsp;<span class="num" id="6089130">100</span>&nbsp;<span class="op" id="6089134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089138">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089185">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089246">if</span>&nbsp;<span class="ident" id="6089249">nsop</span>&nbsp;<span class="op" id="6089254">&lt;</span>&nbsp;<span class="num" id="6089256">10</span>&nbsp;<span class="op" id="6089259">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089264">ns</span>&nbsp;<span class="op" id="6089267">=</span>&nbsp;<span class="ident" id="6089269">fmt</span><span class="op" id="6089272">.</span><span class="ident" id="6089273">Sprintf</span><span class="op" id="6089280">(</span><span class="string" id="6089281">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6089295">,</span>&nbsp;<span class="builtintype" id="6089297">float64</span><span class="op" id="6089304">(</span><span class="ident" id="6089305">r</span><span class="op" id="6089306">.</span><span class="ident" id="6089307">T</span><span class="op" id="6089308">.</span><span class="ident" id="6089309">Nanoseconds</span><span class="op" id="6089320">(</span><span class="op" id="6089321">)</span><span class="op" id="6089322">)</span><span class="op" id="6089323">/</span><span class="builtintype" id="6089324">float64</span><span class="op" id="6089331">(</span><span class="ident" id="6089332">r</span><span class="op" id="6089333">.</span><span class="ident" id="6089334">N</span><span class="op" id="6089335">)</span><span class="op" id="6089336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089340">}</span>&nbsp;<span class="keyword" id="6089342">else</span>&nbsp;<span class="op" id="6089347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089352">ns</span>&nbsp;<span class="op" id="6089355">=</span>&nbsp;<span class="ident" id="6089357">fmt</span><span class="op" id="6089360">.</span><span class="ident" id="6089361">Sprintf</span><span class="op" id="6089368">(</span><span class="string" id="6089369">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6089383">,</span>&nbsp;<span class="builtintype" id="6089385">float64</span><span class="op" id="6089392">(</span><span class="ident" id="6089393">r</span><span class="op" id="6089394">.</span><span class="ident" id="6089395">T</span><span class="op" id="6089396">.</span><span class="ident" id="6089397">Nanoseconds</span><span class="op" id="6089408">(</span><span class="op" id="6089409">)</span><span class="op" id="6089410">)</span><span class="op" id="6089411">/</span><span class="builtintype" id="6089412">float64</span><span class="op" id="6089419">(</span><span class="ident" id="6089420">r</span><span class="op" id="6089421">.</span><span class="ident" id="6089422">N</span><span class="op" id="6089423">)</span><span class="op" id="6089424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089431">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089434">return</span>&nbsp;<span class="ident" id="6089441">fmt</span><span class="op" id="6089444">.</span><span class="ident" id="6089445">Sprintf</span><span class="op" id="6089452">(</span><span class="string" id="6089453">&#34;%8d\t%s%s&#34;</span><span class="op" id="6089464">,</span>&nbsp;<span class="ident" id="6089466">r</span><span class="op" id="6089467">.</span><span class="ident" id="6089468">N</span><span class="op" id="6089469">,</span>&nbsp;<span class="ident" id="6089471">ns</span><span class="op" id="6089473">,</span>&nbsp;<span class="ident" id="6089475">mb</span><span class="op" id="6089477">)</span><br>
<span class="lineno"></span><span class="op" id="6089479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6089482">func</span>&nbsp;<span class="op" id="6089487">(</span><span class="ident" id="6089488">r</span>&nbsp;<span class="ident" id="6089490">BenchmarkResult</span><span class="op" id="6089505">)</span>&nbsp;<span class="ident" id="6089507">MemString</span><span class="op" id="6089516">(</span><span class="op" id="6089517">)</span>&nbsp;<span class="builtintype" id="6089519">string</span>&nbsp;<span class="op" id="6089526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089529">return</span>&nbsp;<span class="ident" id="6089536">fmt</span><span class="op" id="6089539">.</span><span class="ident" id="6089540">Sprintf</span><span class="op" id="6089547">(</span><span class="string" id="6089548">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6089573">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089577">r</span><span class="op" id="6089578">.</span><span class="ident" id="6089579">AllocedBytesPerOp</span><span class="op" id="6089596">(</span><span class="op" id="6089597">)</span><span class="op" id="6089598">,</span>&nbsp;<span class="ident" id="6089600">r</span><span class="op" id="6089601">.</span><span class="ident" id="6089602">AllocsPerOp</span><span class="op" id="6089613">(</span><span class="op" id="6089614">)</span><span class="op" id="6089615">)</span><br>
<span class="lineno"></span><span class="op" id="6089617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6089620">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6089713">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6089742">func</span>&nbsp;<span class="ident" id="6089747">RunBenchmarks</span><span class="op" id="6089760">(</span><span class="ident" id="6089761">matchString</span>&nbsp;<span class="keyword" id="6089773">func</span><span class="op" id="6089777">(</span><span class="ident" id="6089778">pat</span><span class="op" id="6089781">,</span>&nbsp;<span class="ident" id="6089783">str</span>&nbsp;<span class="builtintype" id="6089787">string</span><span class="op" id="6089793">)</span>&nbsp;<span class="op" id="6089795">(</span><span class="builtintype" id="6089796">bool</span><span class="op" id="6089800">,</span>&nbsp;<span class="builtintype" id="6089802">error</span><span class="op" id="6089807">)</span><span class="op" id="6089808">,</span>&nbsp;<span class="ident" id="6089810">benchmarks</span>&nbsp;<span class="op" id="6089821">[</span><span class="op" id="6089822">]</span><span class="ident" id="6089823">InternalBenchmark</span><span class="op" id="6089840">)</span>&nbsp;<span class="op" id="6089842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6089845">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089897">if</span>&nbsp;<span class="builtinfunc" id="6089900">len</span><span class="op" id="6089903">(</span><span class="op" id="6089904">*</span><span class="ident" id="6089905">matchBenchmarks</span><span class="op" id="6089920">)</span>&nbsp;<span class="op" id="6089922">==</span>&nbsp;<span class="num" id="6089925">0</span>&nbsp;<span class="op" id="6089927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089931">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6089939">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6089942">for</span>&nbsp;<span class="ident" id="6089946">_</span><span class="op" id="6089947">,</span>&nbsp;<span class="ident" id="6089949">Benchmark</span>&nbsp;<span class="op" id="6089959">:=</span>&nbsp;<span class="keyword" id="6089962">range</span>&nbsp;<span class="ident" id="6089968">benchmarks</span>&nbsp;<span class="op" id="6089979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089983">matched</span><span class="op" id="6089990">,</span>&nbsp;<span class="ident" id="6089992">err</span>&nbsp;<span class="op" id="6089996">:=</span>&nbsp;<span class="ident" id="6089999">matchString</span><span class="op" id="6090010">(</span><span class="op" id="6090011">*</span><span class="ident" id="6090012">matchBenchmarks</span><span class="op" id="6090027">,</span>&nbsp;<span class="ident" id="6090029">Benchmark</span><span class="op" id="6090038">.</span><span class="ident" id="6090039">Name</span><span class="op" id="6090043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090047">if</span>&nbsp;<span class="ident" id="6090050">err</span>&nbsp;<span class="op" id="6090054">!=</span>&nbsp;<span class="builtintype" id="6090057">nil</span>&nbsp;<span class="op" id="6090061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090066">fmt</span><span class="op" id="6090069">.</span><span class="ident" id="6090070">Fprintf</span><span class="op" id="6090077">(</span><span class="ident" id="6090078">os</span><span class="op" id="6090080">.</span><span class="ident" id="6090081">Stderr</span><span class="op" id="6090087">,</span>&nbsp;<span class="string" id="6090089">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6090136">,</span>&nbsp;<span class="ident" id="6090138">err</span><span class="op" id="6090141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090146">os</span><span class="op" id="6090148">.</span><span class="ident" id="6090149">Exit</span><span class="op" id="6090153">(</span><span class="num" id="6090154">1</span><span class="op" id="6090155">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090163">if</span>&nbsp;<span class="op" id="6090166">!</span><span class="ident" id="6090167">matched</span>&nbsp;<span class="op" id="6090175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090180">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090195">for</span>&nbsp;<span class="ident" id="6090199">_</span><span class="op" id="6090200">,</span>&nbsp;<span class="ident" id="6090202">procs</span>&nbsp;<span class="op" id="6090208">:=</span>&nbsp;<span class="keyword" id="6090211">range</span>&nbsp;<span class="ident" id="6090217">cpuList</span>&nbsp;<span class="op" id="6090225">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090230">runtime</span><span class="op" id="6090237">.</span><span class="ident" id="6090238">GOMAXPROCS</span><span class="op" id="6090248">(</span><span class="ident" id="6090249">procs</span><span class="op" id="6090254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090259">b</span>&nbsp;<span class="op" id="6090261">:=</span>&nbsp;<span class="op" id="6090264">&amp;</span><span class="ident" id="6090265">B</span><span class="op" id="6090266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090272">common</span><span class="op" id="6090278">:</span>&nbsp;<span class="ident" id="6090280">common</span><span class="op" id="6090286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090293">signal</span><span class="op" id="6090299">:</span>&nbsp;<span class="builtinfunc" id="6090301">make</span><span class="op" id="6090305">(</span><span class="keyword" id="6090306">chan</span>&nbsp;<span class="keyword" id="6090311">interface</span><span class="op" id="6090320">{</span><span class="op" id="6090321">}</span><span class="op" id="6090322">)</span><span class="op" id="6090323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090329">}</span><span class="op" id="6090330">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090336">benchmark</span><span class="op" id="6090345">:</span>&nbsp;<span class="ident" id="6090347">Benchmark</span><span class="op" id="6090356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090366">benchName</span>&nbsp;<span class="op" id="6090376">:=</span>&nbsp;<span class="ident" id="6090379">Benchmark</span><span class="op" id="6090388">.</span><span class="ident" id="6090389">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090397">if</span>&nbsp;<span class="ident" id="6090400">procs</span>&nbsp;<span class="op" id="6090406">!=</span>&nbsp;<span class="num" id="6090409">1</span>&nbsp;<span class="op" id="6090411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090417">benchName</span>&nbsp;<span class="op" id="6090427">=</span>&nbsp;<span class="ident" id="6090429">fmt</span><span class="op" id="6090432">.</span><span class="ident" id="6090433">Sprintf</span><span class="op" id="6090440">(</span><span class="string" id="6090441">&#34;%s-%d&#34;</span><span class="op" id="6090448">,</span>&nbsp;<span class="ident" id="6090450">Benchmark</span><span class="op" id="6090459">.</span><span class="ident" id="6090460">Name</span><span class="op" id="6090464">,</span>&nbsp;<span class="ident" id="6090466">procs</span><span class="op" id="6090471">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090481">fmt</span><span class="op" id="6090484">.</span><span class="ident" id="6090485">Printf</span><span class="op" id="6090491">(</span><span class="string" id="6090492">&#34;%s\t&#34;</span><span class="op" id="6090498">,</span>&nbsp;<span class="ident" id="6090500">benchName</span><span class="op" id="6090509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090514">r</span>&nbsp;<span class="op" id="6090516">:=</span>&nbsp;<span class="ident" id="6090519">b</span><span class="op" id="6090520">.</span><span class="ident" id="6090521">run</span><span class="op" id="6090524">(</span><span class="op" id="6090525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090530">if</span>&nbsp;<span class="ident" id="6090533">b</span><span class="op" id="6090534">.</span><span class="ident" id="6090535">failed</span>&nbsp;<span class="op" id="6090542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090548">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090611">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090688">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090717">fmt</span><span class="op" id="6090720">.</span><span class="ident" id="6090721">Printf</span><span class="op" id="6090727">(</span><span class="string" id="6090728">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6090746">,</span>&nbsp;<span class="ident" id="6090748">benchName</span><span class="op" id="6090757">,</span>&nbsp;<span class="ident" id="6090759">b</span><span class="op" id="6090760">.</span><span class="ident" id="6090761">output</span><span class="op" id="6090767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090785">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090790">results</span>&nbsp;<span class="op" id="6090798">:=</span>&nbsp;<span class="ident" id="6090801">r</span><span class="op" id="6090802">.</span><span class="ident" id="6090803">String</span><span class="op" id="6090809">(</span><span class="op" id="6090810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6090815">if</span>&nbsp;<span class="op" id="6090818">*</span><span class="ident" id="6090819">benchmarkMemory</span>&nbsp;<span class="op" id="6090835">||</span>&nbsp;<span class="ident" id="6090838">b</span><span class="op" id="6090839">.</span><span class="ident" id="6090840">showAllocResult</span>&nbsp;<span class="op" id="6090856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090862">results</span>&nbsp;<span class="op" id="6090870">+=</span>&nbsp;<span class="string" id="6090873">&#34;\t&#34;</span>&nbsp;<span class="op" id="6090878">+</span>&nbsp;<span class="ident" id="6090880">r</span><span class="op" id="6090881">.</span><span class="ident" id="6090882">MemString</span><span class="op" id="6090891">(</span><span class="op" id="6090892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6090897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6090902">fmt</span><span class="op" id="6090905">.</span><span class="ident" id="6090906">Println</span><span class="op" id="6090913">(</span><span class="ident" id="6090914">results</span><span class="op" id="6090921">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090926">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091006">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091079">if</span>&nbsp;<span class="builtinfunc" id="6091082">len</span><span class="op" id="6091085">(</span><span class="ident" id="6091086">b</span><span class="op" id="6091087">.</span><span class="ident" id="6091088">output</span><span class="op" id="6091094">)</span>&nbsp;<span class="op" id="6091096">&gt;</span>&nbsp;<span class="num" id="6091098">0</span>&nbsp;<span class="op" id="6091100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091106">b</span><span class="op" id="6091107">.</span><span class="ident" id="6091108">trimOutput</span><span class="op" id="6091118">(</span><span class="op" id="6091119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091125">fmt</span><span class="op" id="6091128">.</span><span class="ident" id="6091129">Printf</span><span class="op" id="6091135">(</span><span class="string" id="6091136">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6091155">,</span>&nbsp;<span class="ident" id="6091157">benchName</span><span class="op" id="6091166">,</span>&nbsp;<span class="ident" id="6091168">b</span><span class="op" id="6091169">.</span><span class="ident" id="6091170">output</span><span class="op" id="6091176">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091186">if</span>&nbsp;<span class="ident" id="6091189">p</span>&nbsp;<span class="op" id="6091191">:=</span>&nbsp;<span class="ident" id="6091194">runtime</span><span class="op" id="6091201">.</span><span class="ident" id="6091202">GOMAXPROCS</span><span class="op" id="6091212">(</span><span class="op" id="6091213">-</span><span class="num" id="6091214">1</span><span class="op" id="6091215">)</span><span class="op" id="6091216">;</span>&nbsp;<span class="ident" id="6091218">p</span>&nbsp;<span class="op" id="6091220">!=</span>&nbsp;<span class="ident" id="6091223">procs</span>&nbsp;<span class="op" id="6091229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091235">fmt</span><span class="op" id="6091238">.</span><span class="ident" id="6091239">Fprintf</span><span class="op" id="6091246">(</span><span class="ident" id="6091247">os</span><span class="op" id="6091249">.</span><span class="ident" id="6091250">Stderr</span><span class="op" id="6091256">,</span>&nbsp;<span class="string" id="6091258">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6091299">,</span>&nbsp;<span class="ident" id="6091301">benchName</span><span class="op" id="6091310">,</span>&nbsp;<span class="ident" id="6091312">p</span><span class="op" id="6091313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091322">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091325">}</span><br>
<span class="lineno"></span><span class="op" id="6091327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6091330">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6091406">func</span>&nbsp;<span class="op" id="6091411">(</span><span class="ident" id="6091412">b</span>&nbsp;<span class="op" id="6091414">*</span><span class="ident" id="6091415">B</span><span class="op" id="6091416">)</span>&nbsp;<span class="ident" id="6091418">trimOutput</span><span class="op" id="6091428">(</span><span class="op" id="6091429">)</span>&nbsp;<span class="op" id="6091431">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091434">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091506">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6091586">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091670">const</span>&nbsp;<span class="ident" id="6091676">maxNewlines</span>&nbsp;<span class="op" id="6091688">=</span>&nbsp;<span class="num" id="6091690">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091694">for</span>&nbsp;<span class="ident" id="6091698">nlCount</span><span class="op" id="6091705">,</span>&nbsp;<span class="ident" id="6091707">j</span>&nbsp;<span class="op" id="6091709">:=</span>&nbsp;<span class="num" id="6091712">0</span><span class="op" id="6091713">,</span>&nbsp;<span class="num" id="6091715">0</span><span class="op" id="6091716">;</span>&nbsp;<span class="ident" id="6091718">j</span>&nbsp;<span class="op" id="6091720">&lt;</span>&nbsp;<span class="builtinfunc" id="6091722">len</span><span class="op" id="6091725">(</span><span class="ident" id="6091726">b</span><span class="op" id="6091727">.</span><span class="ident" id="6091728">output</span><span class="op" id="6091734">)</span><span class="op" id="6091735">;</span>&nbsp;<span class="ident" id="6091737">j</span><span class="op" id="6091738">++</span>&nbsp;<span class="op" id="6091741">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091745">if</span>&nbsp;<span class="ident" id="6091748">b</span><span class="op" id="6091749">.</span><span class="ident" id="6091750">output</span><span class="op" id="6091756">[</span><span class="ident" id="6091757">j</span><span class="op" id="6091758">]</span>&nbsp;<span class="op" id="6091760">==</span>&nbsp;<span class="string" id="6091763">&#39;\n&#39;</span>&nbsp;<span class="op" id="6091768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091773">nlCount</span><span class="op" id="6091780">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091786">if</span>&nbsp;<span class="ident" id="6091789">nlCount</span>&nbsp;<span class="op" id="6091797">&gt;=</span>&nbsp;<span class="ident" id="6091800">maxNewlines</span>&nbsp;<span class="op" id="6091812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091818">b</span><span class="op" id="6091819">.</span><span class="ident" id="6091820">output</span>&nbsp;<span class="op" id="6091827">=</span>&nbsp;<span class="builtinfunc" id="6091829">append</span><span class="op" id="6091835">(</span><span class="ident" id="6091836">b</span><span class="op" id="6091837">.</span><span class="ident" id="6091838">output</span><span class="op" id="6091844">[</span><span class="op" id="6091845">:</span><span class="ident" id="6091846">j</span><span class="op" id="6091847">]</span><span class="op" id="6091848">,</span>&nbsp;<span class="string" id="6091850">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6091880">...</span><span class="op" id="6091883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6091889">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6091905">}</span><br>
<span class="lineno"></span><span class="op" id="6091907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6091910">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6091974">type</span>&nbsp;<span class="ident" id="6091979">PB</span>&nbsp;<span class="keyword" id="6091982">struct</span>&nbsp;<span class="op" id="6091989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091992">globalN</span>&nbsp;<span class="op" id="6092000">*</span><span class="ident" id="6092001">uint64</span>&nbsp;<span class="comment" id="6092008">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092067">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6092075">uint64</span>&nbsp;&nbsp;<span class="comment" id="6092083">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092137">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6092145">uint64</span>&nbsp;&nbsp;<span class="comment" id="6092153">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092192">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092200">uint64</span>&nbsp;&nbsp;<span class="comment" id="6092208">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6092255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6092258">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6092320">func</span>&nbsp;<span class="op" id="6092325">(</span><span class="ident" id="6092326">pb</span>&nbsp;<span class="op" id="6092329">*</span><span class="ident" id="6092330">PB</span><span class="op" id="6092332">)</span>&nbsp;<span class="ident" id="6092334">Next</span><span class="op" id="6092338">(</span><span class="op" id="6092339">)</span>&nbsp;<span class="builtintype" id="6092341">bool</span>&nbsp;<span class="op" id="6092346">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092349">if</span>&nbsp;<span class="ident" id="6092352">pb</span><span class="op" id="6092354">.</span><span class="ident" id="6092355">cache</span>&nbsp;<span class="op" id="6092361">==</span>&nbsp;<span class="num" id="6092364">0</span>&nbsp;<span class="op" id="6092366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092370">n</span>&nbsp;<span class="op" id="6092372">:=</span>&nbsp;<span class="ident" id="6092375">atomic</span><span class="op" id="6092381">.</span><span class="ident" id="6092382">AddUint64</span><span class="op" id="6092391">(</span><span class="ident" id="6092392">pb</span><span class="op" id="6092394">.</span><span class="ident" id="6092395">globalN</span><span class="op" id="6092402">,</span>&nbsp;<span class="ident" id="6092404">pb</span><span class="op" id="6092406">.</span><span class="ident" id="6092407">grain</span><span class="op" id="6092412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092416">if</span>&nbsp;<span class="ident" id="6092419">n</span>&nbsp;<span class="op" id="6092421">&lt;=</span>&nbsp;<span class="ident" id="6092424">pb</span><span class="op" id="6092426">.</span><span class="ident" id="6092427">bN</span>&nbsp;<span class="op" id="6092430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092435">pb</span><span class="op" id="6092437">.</span><span class="ident" id="6092438">cache</span>&nbsp;<span class="op" id="6092444">=</span>&nbsp;<span class="ident" id="6092446">pb</span><span class="op" id="6092448">.</span><span class="ident" id="6092449">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092457">}</span>&nbsp;<span class="keyword" id="6092459">else</span>&nbsp;<span class="keyword" id="6092464">if</span>&nbsp;<span class="ident" id="6092467">n</span>&nbsp;<span class="op" id="6092469">&lt;</span>&nbsp;<span class="ident" id="6092471">pb</span><span class="op" id="6092473">.</span><span class="ident" id="6092474">bN</span><span class="op" id="6092476">+</span><span class="ident" id="6092477">pb</span><span class="op" id="6092479">.</span><span class="ident" id="6092480">grain</span>&nbsp;<span class="op" id="6092486">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092491">pb</span><span class="op" id="6092493">.</span><span class="ident" id="6092494">cache</span>&nbsp;<span class="op" id="6092500">=</span>&nbsp;<span class="ident" id="6092502">pb</span><span class="op" id="6092504">.</span><span class="ident" id="6092505">bN</span>&nbsp;<span class="op" id="6092508">+</span>&nbsp;<span class="ident" id="6092510">pb</span><span class="op" id="6092512">.</span><span class="ident" id="6092513">grain</span>&nbsp;<span class="op" id="6092519">-</span>&nbsp;<span class="ident" id="6092521">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092525">}</span>&nbsp;<span class="keyword" id="6092527">else</span>&nbsp;<span class="op" id="6092532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092537">return</span>&nbsp;<span class="builtintype" id="6092544">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6092555">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6092558">pb</span><span class="op" id="6092560">.</span><span class="ident" id="6092561">cache</span><span class="op" id="6092566">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6092570">return</span>&nbsp;<span class="builtintype" id="6092577">true</span><br>
<span class="lineno"></span><span class="op" id="6092582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6092585">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6092630">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6092707">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6092787">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6092856">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6092915">//</span><br>
<span class="lineno">385</span><span class="comment" id="6092918">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6092991">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6093062">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6093135">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6093171">func</span>&nbsp;<span class="op" id="6093176">(</span><span class="ident" id="6093177">b</span>&nbsp;<span class="op" id="6093179">*</span><span class="ident" id="6093180">B</span><span class="op" id="6093181">)</span>&nbsp;<span class="ident" id="6093183">RunParallel</span><span class="op" id="6093194">(</span><span class="ident" id="6093195">body</span>&nbsp;<span class="keyword" id="6093200">func</span><span class="op" id="6093204">(</span><span class="op" id="6093205">*</span><span class="ident" id="6093206">PB</span><span class="op" id="6093208">)</span><span class="op" id="6093209">)</span>&nbsp;<span class="op" id="6093211">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093214">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093282">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093351">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093379">grain</span>&nbsp;<span class="op" id="6093385">:=</span>&nbsp;<span class="ident" id="6093388">uint64</span><span class="op" id="6093394">(</span><span class="num" id="6093395">0</span><span class="op" id="6093396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093399">if</span>&nbsp;<span class="ident" id="6093402">b</span><span class="op" id="6093403">.</span><span class="ident" id="6093404">previousN</span>&nbsp;<span class="op" id="6093414">&gt;</span>&nbsp;<span class="num" id="6093416">0</span>&nbsp;<span class="op" id="6093418">&amp;&amp;</span>&nbsp;<span class="ident" id="6093421">b</span><span class="op" id="6093422">.</span><span class="ident" id="6093423">previousDuration</span>&nbsp;<span class="op" id="6093440">&gt;</span>&nbsp;<span class="num" id="6093442">0</span>&nbsp;<span class="op" id="6093444">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093448">grain</span>&nbsp;<span class="op" id="6093454">=</span>&nbsp;<span class="num" id="6093456">1e5</span>&nbsp;<span class="op" id="6093460">*</span>&nbsp;<span class="ident" id="6093462">uint64</span><span class="op" id="6093468">(</span><span class="ident" id="6093469">b</span><span class="op" id="6093470">.</span><span class="ident" id="6093471">previousN</span><span class="op" id="6093480">)</span>&nbsp;<span class="op" id="6093482">/</span>&nbsp;<span class="ident" id="6093484">uint64</span><span class="op" id="6093490">(</span><span class="ident" id="6093491">b</span><span class="op" id="6093492">.</span><span class="ident" id="6093493">previousDuration</span><span class="op" id="6093509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093515">if</span>&nbsp;<span class="ident" id="6093518">grain</span>&nbsp;<span class="op" id="6093524">&lt;</span>&nbsp;<span class="num" id="6093526">1</span>&nbsp;<span class="op" id="6093528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093532">grain</span>&nbsp;<span class="op" id="6093538">=</span>&nbsp;<span class="num" id="6093540">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093543">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093546">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6093616">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093671">if</span>&nbsp;<span class="ident" id="6093674">grain</span>&nbsp;<span class="op" id="6093680">&gt;</span>&nbsp;<span class="num" id="6093682">1e4</span>&nbsp;<span class="op" id="6093686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093690">grain</span>&nbsp;<span class="op" id="6093696">=</span>&nbsp;<span class="num" id="6093698">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093703">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093707">n</span>&nbsp;<span class="op" id="6093709">:=</span>&nbsp;<span class="ident" id="6093712">uint64</span><span class="op" id="6093718">(</span><span class="num" id="6093719">0</span><span class="op" id="6093720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093723">numProcs</span>&nbsp;<span class="op" id="6093732">:=</span>&nbsp;<span class="ident" id="6093735">b</span><span class="op" id="6093736">.</span><span class="ident" id="6093737">parallelism</span>&nbsp;<span class="op" id="6093749">*</span>&nbsp;<span class="ident" id="6093751">runtime</span><span class="op" id="6093758">.</span><span class="ident" id="6093759">GOMAXPROCS</span><span class="op" id="6093769">(</span><span class="num" id="6093770">0</span><span class="op" id="6093771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093774">var</span>&nbsp;<span class="ident" id="6093778">wg</span>&nbsp;<span class="ident" id="6093781">sync</span><span class="op" id="6093785">.</span><span class="ident" id="6093786">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093797">wg</span><span class="op" id="6093799">.</span><span class="ident" id="6093800">Add</span><span class="op" id="6093803">(</span><span class="ident" id="6093804">numProcs</span><span class="op" id="6093812">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093815">for</span>&nbsp;<span class="ident" id="6093819">p</span>&nbsp;<span class="op" id="6093821">:=</span>&nbsp;<span class="num" id="6093824">0</span><span class="op" id="6093825">;</span>&nbsp;<span class="ident" id="6093827">p</span>&nbsp;<span class="op" id="6093829">&lt;</span>&nbsp;<span class="ident" id="6093831">numProcs</span><span class="op" id="6093839">;</span>&nbsp;<span class="ident" id="6093841">p</span><span class="op" id="6093842">++</span>&nbsp;<span class="op" id="6093845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093849">go</span>&nbsp;<span class="keyword" id="6093852">func</span><span class="op" id="6093856">(</span><span class="op" id="6093857">)</span>&nbsp;<span class="op" id="6093859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093864">defer</span>&nbsp;<span class="ident" id="6093870">wg</span><span class="op" id="6093872">.</span><span class="ident" id="6093873">Done</span><span class="op" id="6093877">(</span><span class="op" id="6093878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093883">pb</span>&nbsp;<span class="op" id="6093886">:=</span>&nbsp;<span class="op" id="6093889">&amp;</span><span class="ident" id="6093890">PB</span><span class="op" id="6093892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093898">globalN</span><span class="op" id="6093905">:</span>&nbsp;<span class="op" id="6093907">&amp;</span><span class="ident" id="6093908">n</span><span class="op" id="6093909">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093915">grain</span><span class="op" id="6093920">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6093924">grain</span><span class="op" id="6093929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093935">bN</span><span class="op" id="6093937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093944">uint64</span><span class="op" id="6093950">(</span><span class="ident" id="6093951">b</span><span class="op" id="6093952">.</span><span class="ident" id="6093953">N</span><span class="op" id="6093954">)</span><span class="op" id="6093955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093965">body</span><span class="op" id="6093969">(</span><span class="ident" id="6093970">pb</span><span class="op" id="6093972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093976">}</span><span class="op" id="6093977">(</span><span class="op" id="6093978">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6093981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6093984">wg</span><span class="op" id="6093986">.</span><span class="ident" id="6093987">Wait</span><span class="op" id="6093991">(</span><span class="op" id="6093992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6093995">if</span>&nbsp;<span class="ident" id="6093998">n</span>&nbsp;<span class="op" id="6094000">&lt;=</span>&nbsp;<span class="ident" id="6094003">uint64</span><span class="op" id="6094009">(</span><span class="ident" id="6094010">b</span><span class="op" id="6094011">.</span><span class="ident" id="6094012">N</span><span class="op" id="6094013">)</span>&nbsp;<span class="op" id="6094015">&amp;&amp;</span>&nbsp;<span class="op" id="6094018">!</span><span class="ident" id="6094019">b</span><span class="op" id="6094020">.</span><span class="ident" id="6094021">Failed</span><span class="op" id="6094027">(</span><span class="op" id="6094028">)</span>&nbsp;<span class="op" id="6094030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094034">b</span><span class="op" id="6094035">.</span><span class="ident" id="6094036">Fatal</span><span class="op" id="6094041">(</span><span class="string" id="6094042">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6094095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094098">}</span><br>
<span class="lineno">425</span><span class="op" id="6094100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6094103">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6094188">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6094265">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6094320">func</span>&nbsp;<span class="op" id="6094325">(</span><span class="ident" id="6094326">b</span>&nbsp;<span class="op" id="6094328">*</span><span class="ident" id="6094329">B</span><span class="op" id="6094330">)</span>&nbsp;<span class="ident" id="6094332">SetParallelism</span><span class="op" id="6094346">(</span><span class="ident" id="6094347">p</span>&nbsp;<span class="builtintype" id="6094349">int</span><span class="op" id="6094352">)</span>&nbsp;<span class="op" id="6094354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094357">if</span>&nbsp;<span class="ident" id="6094360">p</span>&nbsp;<span class="op" id="6094362">&gt;=</span>&nbsp;<span class="num" id="6094365">1</span>&nbsp;<span class="op" id="6094367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094371">b</span><span class="op" id="6094372">.</span><span class="ident" id="6094373">parallelism</span>&nbsp;<span class="op" id="6094385">=</span>&nbsp;<span class="ident" id="6094387">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094390">}</span><br>
<span class="lineno"></span><span class="op" id="6094392">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6094395">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6094458">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6094518">func</span>&nbsp;<span class="ident" id="6094523">Benchmark</span><span class="op" id="6094532">(</span><span class="ident" id="6094533">f</span>&nbsp;<span class="keyword" id="6094535">func</span><span class="op" id="6094539">(</span><span class="ident" id="6094540">b</span>&nbsp;<span class="op" id="6094542">*</span><span class="ident" id="6094543">B</span><span class="op" id="6094544">)</span><span class="op" id="6094545">)</span>&nbsp;<span class="ident" id="6094547">BenchmarkResult</span>&nbsp;<span class="op" id="6094563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094566">b</span>&nbsp;<span class="op" id="6094568">:=</span>&nbsp;<span class="op" id="6094571">&amp;</span><span class="ident" id="6094572">B</span><span class="op" id="6094573">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094577">common</span><span class="op" id="6094583">:</span>&nbsp;<span class="ident" id="6094585">common</span><span class="op" id="6094591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094596">signal</span><span class="op" id="6094602">:</span>&nbsp;<span class="builtinfunc" id="6094604">make</span><span class="op" id="6094608">(</span><span class="keyword" id="6094609">chan</span>&nbsp;<span class="keyword" id="6094614">interface</span><span class="op" id="6094623">{</span><span class="op" id="6094624">}</span><span class="op" id="6094625">)</span><span class="op" id="6094626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094630">}</span><span class="op" id="6094631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6094635">benchmark</span><span class="op" id="6094644">:</span>&nbsp;<span class="ident" id="6094646">InternalBenchmark</span><span class="op" id="6094663">{</span><span class="string" id="6094664">&#34;&#34;</span><span class="op" id="6094666">,</span>&nbsp;<span class="ident" id="6094668">f</span><span class="op" id="6094669">}</span><span class="op" id="6094670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6094673">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6094676">return</span>&nbsp;<span class="ident" id="6094683">b</span><span class="op" id="6094684">.</span><span class="ident" id="6094685">run</span><span class="op" id="6094688">(</span><span class="op" id="6094689">)</span><br>
<span class="lineno"></span><span class="op" id="6094691">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
