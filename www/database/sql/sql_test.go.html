<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7916423">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7916478">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7916532">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7916583">package</span>&nbsp;<span class="ident" id="7916591">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7916596">import</span>&nbsp;<span class="op" id="7916603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916606">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916629">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916639">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916646">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916659">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916670">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916681">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916692">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916700">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7916711">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7916718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7916721">func</span>&nbsp;<span class="ident" id="7916726">init</span><span class="op" id="7916730">(</span><span class="op" id="7916731">)</span>&nbsp;<span class="op" id="7916733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916736">type</span>&nbsp;<span class="ident" id="7916741">dbConn</span>&nbsp;<span class="keyword" id="7916748">struct</span>&nbsp;<span class="op" id="7916755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916759">db</span>&nbsp;<span class="op" id="7916762">*</span><span class="ident" id="7916763"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916768">c</span>&nbsp;&nbsp;<span class="op" id="7916771">*</span><span class="ident" id="7916772"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916784">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916787">freedFrom</span>&nbsp;<span class="op" id="7916797">:=</span>&nbsp;<span class="builtinfunc" id="7916800">make</span><span class="op" id="7916804">(</span><span class="keyword" id="7916805">map</span><span class="op" id="7916808">[</span><span class="ident" id="7916809"><a href="/database/sql/sql_test.go.html#7916741">dbConn</a></span><span class="op" id="7916815">]</span><span class="builtintype" id="7916816">string</span><span class="op" id="7916822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916825"><a href="/database/sql/sql.go.html#5761967">putConnHook</a></span>&nbsp;<span class="op" id="7916837">=</span>&nbsp;<span class="keyword" id="7916839">func</span><span class="op" id="7916843">(</span><span class="ident" id="7916844">db</span>&nbsp;<span class="op" id="7916847">*</span><span class="ident" id="7916848"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7916850">,</span>&nbsp;<span class="ident" id="7916852">c</span>&nbsp;<span class="op" id="7916854">*</span><span class="ident" id="7916855"><a href="/database/sql/sql.go.html#5749298">driverConn</a></span><span class="op" id="7916865">)</span>&nbsp;<span class="op" id="7916867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916871">idx</span>&nbsp;<span class="op" id="7916875">:=</span>&nbsp;<span class="op" id="7916878">-</span><span class="num" id="7916879">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916883">for</span>&nbsp;<span class="ident" id="7916887">i</span><span class="op" id="7916888">,</span>&nbsp;<span class="ident" id="7916890">v</span>&nbsp;<span class="op" id="7916892">:=</span>&nbsp;<span class="keyword" id="7916895">range</span>&nbsp;<span class="ident" id="7916901"><a href="/database/sql/sql_test.go.html#7916844">db</a></span><span class="op" id="7916903">.</span><span class="ident" id="7916904">freeConn</span>&nbsp;<span class="op" id="7916913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916918">if</span>&nbsp;<span class="ident" id="7916921"><a href="/database/sql/sql_test.go.html#7916890">v</a></span>&nbsp;<span class="op" id="7916923">==</span>&nbsp;<span class="ident" id="7916926"><a href="/database/sql/sql_test.go.html#7916852">c</a></span>&nbsp;<span class="op" id="7916928">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7916934"><a href="/database/sql/sql_test.go.html#7916871">idx</a></span>&nbsp;<span class="op" id="7916938">=</span>&nbsp;<span class="ident" id="7916940"><a href="/database/sql/sql_test.go.html#7916887">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916946">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7916959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7916963">if</span>&nbsp;<span class="ident" id="7916966"><a href="/database/sql/sql_test.go.html#7916871">idx</a></span>&nbsp;<span class="op" id="7916970">&gt;=</span>&nbsp;<span class="num" id="7916973">0</span>&nbsp;<span class="op" id="7916975">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7916980">//&nbsp;print&nbsp;before&nbsp;panic,&nbsp;as&nbsp;panic&nbsp;may&nbsp;get&nbsp;lost&nbsp;due&nbsp;to&nbsp;conflicting&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917053">//&nbsp;(all&nbsp;goroutines&nbsp;asleep)&nbsp;elsewhere,&nbsp;since&nbsp;we&nbsp;might&nbsp;not&nbsp;unlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917120">//&nbsp;the&nbsp;mutex&nbsp;in&nbsp;freeConn&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7917154">println</span><span class="op" id="7917161">(</span><span class="string" id="7917162">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&nbsp;conflicts&nbsp;are:\nA)&nbsp;&#34;</span>&nbsp;<span class="op" id="7917205">+</span>&nbsp;<span class="ident" id="7917207"><a href="/database/sql/sql_test.go.html#7916787">freedFrom</a></span><span class="op" id="7917216">[</span><span class="ident" id="7917217"><a href="/database/sql/sql_test.go.html#7916741">dbConn</a></span><span class="op" id="7917223">{</span><span class="ident" id="7917224"><a href="/database/sql/sql_test.go.html#7916844">db</a></span><span class="op" id="7917226">,</span>&nbsp;<span class="ident" id="7917228"><a href="/database/sql/sql_test.go.html#7916852">c</a></span><span class="op" id="7917229">}</span><span class="op" id="7917230">]</span>&nbsp;<span class="op" id="7917232">+</span>&nbsp;<span class="string" id="7917234">&#34;\n\nand\nB)&nbsp;&#34;</span>&nbsp;<span class="op" id="7917249">+</span>&nbsp;<span class="ident" id="7917251"><a href="/database/sql/sql.go.html#5788422">stack</a></span><span class="op" id="7917256">(</span><span class="op" id="7917257">)</span><span class="op" id="7917258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7917263">panic</span><span class="op" id="7917268">(</span><span class="string" id="7917269">&#34;double&nbsp;free&nbsp;of&nbsp;conn.&#34;</span><span class="op" id="7917291">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917299"><a href="/database/sql/sql_test.go.html#7916787">freedFrom</a></span><span class="op" id="7917308">[</span><span class="ident" id="7917309"><a href="/database/sql/sql_test.go.html#7916741">dbConn</a></span><span class="op" id="7917315">{</span><span class="ident" id="7917316"><a href="/database/sql/sql_test.go.html#7916844">db</a></span><span class="op" id="7917318">,</span>&nbsp;<span class="ident" id="7917320"><a href="/database/sql/sql_test.go.html#7916852">c</a></span><span class="op" id="7917321">}</span><span class="op" id="7917322">]</span>&nbsp;<span class="op" id="7917324">=</span>&nbsp;<span class="ident" id="7917326"><a href="/database/sql/sql.go.html#5788422">stack</a></span><span class="op" id="7917331">(</span><span class="op" id="7917332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917335">}</span><br>
<span class="lineno"></span><span class="op" id="7917337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7917340">const</span>&nbsp;<span class="ident" id="7917346">fakeDBName</span>&nbsp;<span class="op" id="7917357">=</span>&nbsp;<span class="string" id="7917359">&#34;foo&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917366">var</span>&nbsp;<span class="ident" id="7917370">chrisBirthday</span>&nbsp;<span class="op" id="7917384">=</span>&nbsp;<span class="ident" id="7917386"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7917390">.</span><span class="ident" id="7917391">Unix</span><span class="op" id="7917395">(</span><span class="num" id="7917396">123456789</span><span class="op" id="7917405">,</span>&nbsp;<span class="num" id="7917407">0</span><span class="op" id="7917408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7917411">func</span>&nbsp;<span class="ident" id="7917416">newTestDB</span><span class="op" id="7917425">(</span><span class="ident" id="7917426">t</span>&nbsp;<span class="ident" id="7917428"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7917435">.</span><span class="ident" id="7917436">TB</span><span class="op" id="7917438">,</span>&nbsp;<span class="ident" id="7917440">name</span>&nbsp;<span class="builtintype" id="7917445">string</span><span class="op" id="7917451">)</span>&nbsp;<span class="op" id="7917453">*</span><span class="ident" id="7917454"><a href="/database/sql/sql.go.html#5748306">DB</a></span>&nbsp;<span class="op" id="7917457">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917460">db</span><span class="op" id="7917462">,</span>&nbsp;<span class="ident" id="7917464">err</span>&nbsp;<span class="op" id="7917468">:=</span>&nbsp;<span class="ident" id="7917471"><a href="/database/sql/sql.go.html#5755024">Open</a></span><span class="op" id="7917475">(</span><span class="string" id="7917476">&#34;test&#34;</span><span class="op" id="7917482">,</span>&nbsp;<span class="ident" id="7917484"><a href="/database/sql/sql_test.go.html#7917346">fakeDBName</a></span><span class="op" id="7917494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917497">if</span>&nbsp;<span class="ident" id="7917500"><a href="/database/sql/sql_test.go.html#7917464">err</a></span>&nbsp;<span class="op" id="7917504">!=</span>&nbsp;<span class="ident" id="7917507">nil</span>&nbsp;<span class="op" id="7917511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917515"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917516">.</span><span class="ident" id="7917517">Fatalf</span><span class="op" id="7917523">(</span><span class="string" id="7917524">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7917534">,</span>&nbsp;<span class="ident" id="7917536"><a href="/database/sql/sql_test.go.html#7917464">err</a></span><span class="op" id="7917539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917545">if</span>&nbsp;<span class="ident" id="7917548">_</span><span class="op" id="7917549">,</span>&nbsp;<span class="ident" id="7917551">err</span>&nbsp;<span class="op" id="7917555">:=</span>&nbsp;<span class="ident" id="7917558"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7917560">.</span><span class="ident" id="7917561">Exec</span><span class="op" id="7917565">(</span><span class="string" id="7917566">&#34;WIPE&#34;</span><span class="op" id="7917572">)</span><span class="op" id="7917573">;</span>&nbsp;<span class="ident" id="7917575"><a href="/database/sql/sql_test.go.html#7917551">err</a></span>&nbsp;<span class="op" id="7917579">!=</span>&nbsp;<span class="ident" id="7917582">nil</span>&nbsp;<span class="op" id="7917586">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917590"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917591">.</span><span class="ident" id="7917592">Fatalf</span><span class="op" id="7917598">(</span><span class="string" id="7917599">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7917614">,</span>&nbsp;<span class="ident" id="7917616"><a href="/database/sql/sql_test.go.html#7917551">err</a></span><span class="op" id="7917619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917625">if</span>&nbsp;<span class="ident" id="7917628"><a href="/database/sql/sql_test.go.html#7917440">name</a></span>&nbsp;<span class="op" id="7917633">==</span>&nbsp;<span class="string" id="7917636">&#34;people&#34;</span>&nbsp;<span class="op" id="7917645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917649"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7917653">(</span><span class="ident" id="7917654"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917655">,</span>&nbsp;<span class="ident" id="7917657"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7917659">,</span>&nbsp;<span class="string" id="7917661">&#34;CREATE|people|name=string,age=int32,photo=blob,dead=bool,bdate=datetime&#34;</span><span class="op" id="7917734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917738"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7917742">(</span><span class="ident" id="7917743"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917744">,</span>&nbsp;<span class="ident" id="7917746"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7917748">,</span>&nbsp;<span class="string" id="7917750">&#34;INSERT|people|name=Alice,age=?,photo=APHOTO&#34;</span><span class="op" id="7917795">,</span>&nbsp;<span class="num" id="7917797">1</span><span class="op" id="7917798">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917802"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7917806">(</span><span class="ident" id="7917807"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917808">,</span>&nbsp;<span class="ident" id="7917810"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7917812">,</span>&nbsp;<span class="string" id="7917814">&#34;INSERT|people|name=Bob,age=?,photo=BPHOTO&#34;</span><span class="op" id="7917857">,</span>&nbsp;<span class="num" id="7917859">2</span><span class="op" id="7917860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7917864"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7917868">(</span><span class="ident" id="7917869"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7917870">,</span>&nbsp;<span class="ident" id="7917872"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7917874">,</span>&nbsp;<span class="string" id="7917876">&#34;INSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7917929">,</span>&nbsp;<span class="num" id="7917931">3</span><span class="op" id="7917932">,</span>&nbsp;<span class="ident" id="7917934"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7917947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7917950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7917953">if</span>&nbsp;<span class="ident" id="7917956"><a href="/database/sql/sql_test.go.html#7917440">name</a></span>&nbsp;<span class="op" id="7917961">==</span>&nbsp;<span class="string" id="7917964">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7917977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7917981">//&nbsp;Magic&nbsp;table&nbsp;name&nbsp;and&nbsp;column,&nbsp;known&nbsp;by&nbsp;fakedb_test.go.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918040"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7918044">(</span><span class="ident" id="7918045"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7918046">,</span>&nbsp;<span class="ident" id="7918048"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7918050">,</span>&nbsp;<span class="string" id="7918052">&#34;CREATE|magicquery|op=string,millis=int32&#34;</span><span class="op" id="7918094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918098"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7918102">(</span><span class="ident" id="7918103"><a href="/database/sql/sql_test.go.html#7917426">t</a></span><span class="op" id="7918104">,</span>&nbsp;<span class="ident" id="7918106"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><span class="op" id="7918108">,</span>&nbsp;<span class="string" id="7918110">&#34;INSERT|magicquery|op=sleep,millis=10&#34;</span><span class="op" id="7918148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918154">return</span>&nbsp;<span class="ident" id="7918161"><a href="/database/sql/sql_test.go.html#7917460">db</a></span><br>
<span class="lineno"></span><span class="op" id="7918164">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7918167">func</span>&nbsp;<span class="ident" id="7918172">exec</span><span class="op" id="7918176">(</span><span class="ident" id="7918177">t</span>&nbsp;<span class="ident" id="7918179"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7918186">.</span><span class="ident" id="7918187">TB</span><span class="op" id="7918189">,</span>&nbsp;<span class="ident" id="7918191">db</span>&nbsp;<span class="op" id="7918194">*</span><span class="ident" id="7918195"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7918197">,</span>&nbsp;<span class="ident" id="7918199">query</span>&nbsp;<span class="builtintype" id="7918205">string</span><span class="op" id="7918211">,</span>&nbsp;<span class="ident" id="7918213">args</span>&nbsp;<span class="op" id="7918218">...</span><span class="keyword" id="7918221">interface</span><span class="op" id="7918230">{</span><span class="op" id="7918231">}</span><span class="op" id="7918232">)</span>&nbsp;<span class="op" id="7918234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918237">_</span><span class="op" id="7918238">,</span>&nbsp;<span class="ident" id="7918240">err</span>&nbsp;<span class="op" id="7918244">:=</span>&nbsp;<span class="ident" id="7918247"><a href="/database/sql/sql_test.go.html#7918191">db</a></span><span class="op" id="7918249">.</span><span class="ident" id="7918250">Exec</span><span class="op" id="7918254">(</span><span class="ident" id="7918255"><a href="/database/sql/sql_test.go.html#7918199">query</a></span><span class="op" id="7918260">,</span>&nbsp;<span class="ident" id="7918262"><a href="/database/sql/sql_test.go.html#7918213">args</a></span><span class="op" id="7918266">...</span><span class="op" id="7918269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918272">if</span>&nbsp;<span class="ident" id="7918275"><a href="/database/sql/sql_test.go.html#7918240">err</a></span>&nbsp;<span class="op" id="7918279">!=</span>&nbsp;<span class="ident" id="7918282">nil</span>&nbsp;<span class="op" id="7918286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918290"><a href="/database/sql/sql_test.go.html#7918177">t</a></span><span class="op" id="7918291">.</span><span class="ident" id="7918292">Fatalf</span><span class="op" id="7918298">(</span><span class="string" id="7918299">&#34;Exec&nbsp;of&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="7918315">,</span>&nbsp;<span class="ident" id="7918317"><a href="/database/sql/sql_test.go.html#7918199">query</a></span><span class="op" id="7918322">,</span>&nbsp;<span class="ident" id="7918324"><a href="/database/sql/sql_test.go.html#7918240">err</a></span><span class="op" id="7918327">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918330">}</span><br>
<span class="lineno"></span><span class="op" id="7918332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7918335">func</span>&nbsp;<span class="ident" id="7918340">closeDB</span><span class="op" id="7918347">(</span><span class="ident" id="7918348">t</span>&nbsp;<span class="ident" id="7918350"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7918357">.</span><span class="ident" id="7918358">TB</span><span class="op" id="7918360">,</span>&nbsp;<span class="ident" id="7918362">db</span>&nbsp;<span class="op" id="7918365">*</span><span class="ident" id="7918366"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7918368">)</span>&nbsp;<span class="op" id="7918370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918373">if</span>&nbsp;<span class="ident" id="7918376">e</span>&nbsp;<span class="op" id="7918378">:=</span>&nbsp;<span class="builtinfunc" id="7918381">recover</span><span class="op" id="7918388">(</span><span class="op" id="7918389">)</span><span class="op" id="7918390">;</span>&nbsp;<span class="ident" id="7918392"><a href="/database/sql/sql_test.go.html#7918376">e</a></span>&nbsp;<span class="op" id="7918394">!=</span>&nbsp;<span class="ident" id="7918397">nil</span>&nbsp;<span class="op" id="7918401">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918405"><a href="/database/sql/sql_test.go.html#7916639">fmt</a></span><span class="op" id="7918408">.</span><span class="ident" id="7918409">Printf</span><span class="op" id="7918415">(</span><span class="string" id="7918416">&#34;Panic:&nbsp;%v\n&#34;</span><span class="op" id="7918429">,</span>&nbsp;<span class="ident" id="7918431"><a href="/database/sql/sql_test.go.html#7918376">e</a></span><span class="op" id="7918432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7918436">panic</span><span class="op" id="7918441">(</span><span class="ident" id="7918442"><a href="/database/sql/sql_test.go.html#7918376">e</a></span><span class="op" id="7918443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918449">defer</span>&nbsp;<span class="ident" id="7918455"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7918475">(</span><span class="ident" id="7918476">nil</span><span class="op" id="7918479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918482"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7918502">(</span><span class="keyword" id="7918503">func</span><span class="op" id="7918507">(</span><span class="ident" id="7918508">_</span>&nbsp;<span class="op" id="7918510">*</span><span class="ident" id="7918511"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7918519">,</span>&nbsp;<span class="ident" id="7918521">err</span>&nbsp;<span class="builtintype" id="7918525">error</span><span class="op" id="7918530">)</span>&nbsp;<span class="op" id="7918532">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918536">if</span>&nbsp;<span class="ident" id="7918539"><a href="/database/sql/sql_test.go.html#7918521">err</a></span>&nbsp;<span class="op" id="7918543">!=</span>&nbsp;<span class="ident" id="7918546">nil</span>&nbsp;<span class="op" id="7918550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918555"><a href="/database/sql/sql_test.go.html#7918348">t</a></span><span class="op" id="7918556">.</span><span class="ident" id="7918557">Errorf</span><span class="op" id="7918563">(</span><span class="string" id="7918564">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7918592">,</span>&nbsp;<span class="ident" id="7918594"><a href="/database/sql/sql_test.go.html#7918521">err</a></span><span class="op" id="7918597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918604">}</span><span class="op" id="7918605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918608">for</span>&nbsp;<span class="ident" id="7918612">i</span><span class="op" id="7918613">,</span>&nbsp;<span class="ident" id="7918615">dc</span>&nbsp;<span class="op" id="7918618">:=</span>&nbsp;<span class="keyword" id="7918621">range</span>&nbsp;<span class="ident" id="7918627"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7918629">.</span><span class="ident" id="7918630">freeConn</span>&nbsp;<span class="op" id="7918639">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7918643">if</span>&nbsp;<span class="ident" id="7918646">n</span>&nbsp;<span class="op" id="7918648">:=</span>&nbsp;<span class="builtinfunc" id="7918651">len</span><span class="op" id="7918654">(</span><span class="ident" id="7918655"><a href="/database/sql/sql_test.go.html#7918615">dc</a></span><span class="op" id="7918657">.</span><span class="ident" id="7918658">openStmt</span><span class="op" id="7918666">)</span><span class="op" id="7918667">;</span>&nbsp;<span class="ident" id="7918669"><a href="/database/sql/sql_test.go.html#7918646">n</a></span>&nbsp;<span class="op" id="7918671">&gt;</span>&nbsp;<span class="num" id="7918673">0</span>&nbsp;<span class="op" id="7918675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918680">//&nbsp;Just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;This&nbsp;is&nbsp;legal&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918724">//&nbsp;general,&nbsp;but&nbsp;if&nbsp;we&nbsp;make&nbsp;the&nbsp;tests&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918773">//&nbsp;their&nbsp;statements&nbsp;first,&nbsp;then&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918822">//&nbsp;verify&nbsp;this&nbsp;is&nbsp;always&nbsp;zero&nbsp;here,&nbsp;and&nbsp;any</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7918869">//&nbsp;other&nbsp;value&nbsp;is&nbsp;a&nbsp;leak.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7918898"><a href="/database/sql/sql_test.go.html#7918348">t</a></span><span class="op" id="7918899">.</span><span class="ident" id="7918900">Errorf</span><span class="op" id="7918906">(</span><span class="string" id="7918907">&#34;while&nbsp;closing&nbsp;db,&nbsp;freeConn&nbsp;%d/%d&nbsp;had&nbsp;%d&nbsp;open&nbsp;stmts;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7918967">,</span>&nbsp;<span class="ident" id="7918969"><a href="/database/sql/sql_test.go.html#7918612">i</a></span><span class="op" id="7918970">,</span>&nbsp;<span class="builtinfunc" id="7918972">len</span><span class="op" id="7918975">(</span><span class="ident" id="7918976"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7918978">.</span><span class="ident" id="7918979">freeConn</span><span class="op" id="7918987">)</span><span class="op" id="7918988">,</span>&nbsp;<span class="ident" id="7918990"><a href="/database/sql/sql_test.go.html#7918646">n</a></span><span class="op" id="7918991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7918998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919001">err</span>&nbsp;<span class="op" id="7919005">:=</span>&nbsp;<span class="ident" id="7919008"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7919010">.</span><span class="ident" id="7919011">Close</span><span class="op" id="7919016">(</span><span class="op" id="7919017">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919020">if</span>&nbsp;<span class="ident" id="7919023"><a href="/database/sql/sql_test.go.html#7919001">err</a></span>&nbsp;<span class="op" id="7919027">!=</span>&nbsp;<span class="ident" id="7919030">nil</span>&nbsp;<span class="op" id="7919034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919038"><a href="/database/sql/sql_test.go.html#7918348">t</a></span><span class="op" id="7919039">.</span><span class="ident" id="7919040">Fatalf</span><span class="op" id="7919046">(</span><span class="string" id="7919047">&#34;error&nbsp;closing&nbsp;DB:&nbsp;%v&#34;</span><span class="op" id="7919069">,</span>&nbsp;<span class="ident" id="7919071"><a href="/database/sql/sql_test.go.html#7919001">err</a></span><span class="op" id="7919074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7919077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919080"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7919082">.</span><span class="ident" id="7919083">mu</span><span class="op" id="7919085">.</span><span class="ident" id="7919086">Lock</span><span class="op" id="7919090">(</span><span class="op" id="7919091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919094">count</span>&nbsp;<span class="op" id="7919100">:=</span>&nbsp;<span class="ident" id="7919103"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7919105">.</span><span class="ident" id="7919106">numOpen</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919115"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7919117">.</span><span class="ident" id="7919118">mu</span><span class="op" id="7919120">.</span><span class="ident" id="7919121">Unlock</span><span class="op" id="7919127">(</span><span class="op" id="7919128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919131">if</span>&nbsp;<span class="ident" id="7919134"><a href="/database/sql/sql_test.go.html#7919094">count</a></span>&nbsp;<span class="op" id="7919140">!=</span>&nbsp;<span class="num" id="7919143">0</span>&nbsp;<span class="op" id="7919145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919149"><a href="/database/sql/sql_test.go.html#7918348">t</a></span><span class="op" id="7919150">.</span><span class="ident" id="7919151">Fatalf</span><span class="op" id="7919157">(</span><span class="string" id="7919158">&#34;%d&nbsp;connections&nbsp;still&nbsp;open&nbsp;after&nbsp;closing&nbsp;DB&#34;</span><span class="op" id="7919202">,</span>&nbsp;<span class="ident" id="7919204"><a href="/database/sql/sql_test.go.html#7918362">db</a></span><span class="op" id="7919206">.</span><span class="ident" id="7919207">numOpen</span><span class="op" id="7919214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7919217">}</span><br>
<span class="lineno"></span><span class="op" id="7919219">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="7919222">//&nbsp;numPrepares&nbsp;assumes&nbsp;that&nbsp;db&nbsp;has&nbsp;exactly&nbsp;1&nbsp;idle&nbsp;conn&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="7919289">//&nbsp;its&nbsp;count&nbsp;of&nbsp;calls&nbsp;to&nbsp;Prepare</span><br>
<span class="lineno"></span><span class="keyword" id="7919322">func</span>&nbsp;<span class="ident" id="7919327">numPrepares</span><span class="op" id="7919338">(</span><span class="ident" id="7919339">t</span>&nbsp;<span class="op" id="7919341">*</span><span class="ident" id="7919342"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7919349">.</span><span class="ident" id="7919350">T</span><span class="op" id="7919351">,</span>&nbsp;<span class="ident" id="7919353">db</span>&nbsp;<span class="op" id="7919356">*</span><span class="ident" id="7919357"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7919359">)</span>&nbsp;<span class="builtintype" id="7919361">int</span>&nbsp;<span class="op" id="7919365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919368">if</span>&nbsp;<span class="ident" id="7919371">n</span>&nbsp;<span class="op" id="7919373">:=</span>&nbsp;<span class="builtinfunc" id="7919376">len</span><span class="op" id="7919379">(</span><span class="ident" id="7919380"><a href="/database/sql/sql_test.go.html#7919353">db</a></span><span class="op" id="7919382">.</span><span class="ident" id="7919383">freeConn</span><span class="op" id="7919391">)</span><span class="op" id="7919392">;</span>&nbsp;<span class="ident" id="7919394"><a href="/database/sql/sql_test.go.html#7919371">n</a></span>&nbsp;<span class="op" id="7919396">!=</span>&nbsp;<span class="num" id="7919399">1</span>&nbsp;<span class="op" id="7919401">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919405"><a href="/database/sql/sql_test.go.html#7919339">t</a></span><span class="op" id="7919406">.</span><span class="ident" id="7919407">Fatalf</span><span class="op" id="7919413">(</span><span class="string" id="7919414">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7919439">,</span>&nbsp;<span class="ident" id="7919441"><a href="/database/sql/sql_test.go.html#7919371">n</a></span><span class="op" id="7919442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7919445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919448">return</span>&nbsp;<span class="ident" id="7919455"><a href="/database/sql/sql_test.go.html#7919353">db</a></span><span class="op" id="7919457">.</span><span class="ident" id="7919458">freeConn</span><span class="op" id="7919466">[</span><span class="num" id="7919467">0</span><span class="op" id="7919468">]</span><span class="op" id="7919469">.</span><span class="ident" id="7919470">ci</span><span class="op" id="7919472">.</span><span class="op" id="7919473">(</span><span class="op" id="7919474">*</span><span class="ident" id="7919475"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7919483">)</span><span class="op" id="7919484">.</span><span class="ident" id="7919485">numPrepare</span><br>
<span class="lineno"></span><span class="op" id="7919496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7919499">func</span>&nbsp;<span class="op" id="7919504">(</span><span class="ident" id="7919505">db</span>&nbsp;<span class="op" id="7919508">*</span><span class="ident" id="7919509"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7919511">)</span>&nbsp;<span class="ident" id="7919513">numDeps</span><span class="op" id="7919520">(</span><span class="op" id="7919521">)</span>&nbsp;<span class="builtintype" id="7919523">int</span>&nbsp;<span class="op" id="7919527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919530"><a href="/database/sql/sql_test.go.html#7919505">db</a></span><span class="op" id="7919532">.</span><span class="ident" id="7919533">mu</span><span class="op" id="7919535">.</span><span class="ident" id="7919536">Lock</span><span class="op" id="7919540">(</span><span class="op" id="7919541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919544">defer</span>&nbsp;<span class="ident" id="7919550"><a href="/database/sql/sql_test.go.html#7919505">db</a></span><span class="op" id="7919552">.</span><span class="ident" id="7919553">mu</span><span class="op" id="7919555">.</span><span class="ident" id="7919556">Unlock</span><span class="op" id="7919562">(</span><span class="op" id="7919563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919566">return</span>&nbsp;<span class="builtinfunc" id="7919573">len</span><span class="op" id="7919576">(</span><span class="ident" id="7919577"><a href="/database/sql/sql_test.go.html#7919505">db</a></span><span class="op" id="7919579">.</span><span class="ident" id="7919580">dep</span><span class="op" id="7919583">)</span><br>
<span class="lineno"></span><span class="op" id="7919585">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="7919588">//&nbsp;Dependencies&nbsp;are&nbsp;closed&nbsp;via&nbsp;a&nbsp;goroutine,&nbsp;so&nbsp;this&nbsp;polls&nbsp;waiting&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7919658">//&nbsp;numDeps&nbsp;to&nbsp;fall&nbsp;to&nbsp;want,&nbsp;waiting&nbsp;up&nbsp;to&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="7919703">func</span>&nbsp;<span class="op" id="7919708">(</span><span class="ident" id="7919709">db</span>&nbsp;<span class="op" id="7919712">*</span><span class="ident" id="7919713"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7919715">)</span>&nbsp;<span class="ident" id="7919717">numDepsPollUntil</span><span class="op" id="7919733">(</span><span class="ident" id="7919734">want</span>&nbsp;<span class="builtintype" id="7919739">int</span><span class="op" id="7919742">,</span>&nbsp;<span class="ident" id="7919744">d</span>&nbsp;<span class="ident" id="7919746"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7919750">.</span><span class="ident" id="7919751">Duration</span><span class="op" id="7919759">)</span>&nbsp;<span class="builtintype" id="7919761">int</span>&nbsp;<span class="op" id="7919765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919768">deadline</span>&nbsp;<span class="op" id="7919777">:=</span>&nbsp;<span class="ident" id="7919780"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7919784">.</span><span class="ident" id="7919785">Now</span><span class="op" id="7919788">(</span><span class="op" id="7919789">)</span><span class="op" id="7919790">.</span><span class="ident" id="7919791">Add</span><span class="op" id="7919794">(</span><span class="ident" id="7919795"><a href="/database/sql/sql_test.go.html#7919744">d</a></span><span class="op" id="7919796">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919799">for</span>&nbsp;<span class="op" id="7919803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919807">n</span>&nbsp;<span class="op" id="7919809">:=</span>&nbsp;<span class="ident" id="7919812"><a href="/database/sql/sql_test.go.html#7919709">db</a></span><span class="op" id="7919814">.</span><span class="ident" id="7919815">numDeps</span><span class="op" id="7919822">(</span><span class="op" id="7919823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919827">if</span>&nbsp;<span class="ident" id="7919830"><a href="/database/sql/sql_test.go.html#7919807">n</a></span>&nbsp;<span class="op" id="7919832">&lt;=</span>&nbsp;<span class="ident" id="7919835"><a href="/database/sql/sql_test.go.html#7919734">want</a></span>&nbsp;<span class="op" id="7919840">||</span>&nbsp;<span class="ident" id="7919843"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7919847">.</span><span class="ident" id="7919848">Now</span><span class="op" id="7919851">(</span><span class="op" id="7919852">)</span><span class="op" id="7919853">.</span><span class="ident" id="7919854">After</span><span class="op" id="7919859">(</span><span class="ident" id="7919860"><a href="/database/sql/sql_test.go.html#7919768">deadline</a></span><span class="op" id="7919868">)</span>&nbsp;<span class="op" id="7919870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919875">return</span>&nbsp;<span class="ident" id="7919882"><a href="/database/sql/sql_test.go.html#7919807">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7919886">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919890"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7919894">.</span><span class="ident" id="7919895">Sleep</span><span class="op" id="7919900">(</span><span class="num" id="7919901">50</span>&nbsp;<span class="op" id="7919904">*</span>&nbsp;<span class="ident" id="7919906"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7919910">.</span><span class="ident" id="7919911">Millisecond</span><span class="op" id="7919922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7919925">}</span><br>
<span class="lineno"></span><span class="op" id="7919927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7919930">func</span>&nbsp;<span class="op" id="7919935">(</span><span class="ident" id="7919936">db</span>&nbsp;<span class="op" id="7919939">*</span><span class="ident" id="7919940"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7919942">)</span>&nbsp;<span class="ident" id="7919944">numFreeConns</span><span class="op" id="7919956">(</span><span class="op" id="7919957">)</span>&nbsp;<span class="builtintype" id="7919959">int</span>&nbsp;<span class="op" id="7919963">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7919966"><a href="/database/sql/sql_test.go.html#7919936">db</a></span><span class="op" id="7919968">.</span><span class="ident" id="7919969">mu</span><span class="op" id="7919971">.</span><span class="ident" id="7919972">Lock</span><span class="op" id="7919976">(</span><span class="op" id="7919977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7919980">defer</span>&nbsp;<span class="ident" id="7919986"><a href="/database/sql/sql_test.go.html#7919936">db</a></span><span class="op" id="7919988">.</span><span class="ident" id="7919989">mu</span><span class="op" id="7919991">.</span><span class="ident" id="7919992">Unlock</span><span class="op" id="7919998">(</span><span class="op" id="7919999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920002">return</span>&nbsp;<span class="builtinfunc" id="7920009">len</span><span class="op" id="7920012">(</span><span class="ident" id="7920013"><a href="/database/sql/sql_test.go.html#7919936">db</a></span><span class="op" id="7920015">.</span><span class="ident" id="7920016">freeConn</span><span class="op" id="7920024">)</span><br>
<span class="lineno"></span><span class="op" id="7920026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="7920029">func</span>&nbsp;<span class="op" id="7920034">(</span><span class="ident" id="7920035">db</span>&nbsp;<span class="op" id="7920038">*</span><span class="ident" id="7920039"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7920041">)</span>&nbsp;<span class="ident" id="7920043">dumpDeps</span><span class="op" id="7920051">(</span><span class="ident" id="7920052">t</span>&nbsp;<span class="op" id="7920054">*</span><span class="ident" id="7920055"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7920062">.</span><span class="ident" id="7920063">T</span><span class="op" id="7920064">)</span>&nbsp;<span class="op" id="7920066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920069">for</span>&nbsp;<span class="ident" id="7920073">fc</span>&nbsp;<span class="op" id="7920076">:=</span>&nbsp;<span class="keyword" id="7920079">range</span>&nbsp;<span class="ident" id="7920085"><a href="/database/sql/sql_test.go.html#7920035">db</a></span><span class="op" id="7920087">.</span><span class="ident" id="7920088">dep</span>&nbsp;<span class="op" id="7920092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920096"><a href="/database/sql/sql_test.go.html#7920035">db</a></span><span class="op" id="7920098">.</span><span class="ident" id="7920099">dumpDep</span><span class="op" id="7920106">(</span><span class="ident" id="7920107"><a href="/database/sql/sql_test.go.html#7920052">t</a></span><span class="op" id="7920108">,</span>&nbsp;<span class="num" id="7920110">0</span><span class="op" id="7920111">,</span>&nbsp;<span class="ident" id="7920113"><a href="/database/sql/sql_test.go.html#7920073">fc</a></span><span class="op" id="7920115">,</span>&nbsp;<span class="keyword" id="7920117">map</span><span class="op" id="7920120">[</span><span class="ident" id="7920121"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="7920132">]</span><span class="builtintype" id="7920133">bool</span><span class="op" id="7920137">{</span><span class="op" id="7920138">}</span><span class="op" id="7920139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920142">}</span><br>
<span class="lineno"></span><span class="op" id="7920144">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7920147">func</span>&nbsp;<span class="op" id="7920152">(</span><span class="ident" id="7920153">db</span>&nbsp;<span class="op" id="7920156">*</span><span class="ident" id="7920157"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7920159">)</span>&nbsp;<span class="ident" id="7920161">dumpDep</span><span class="op" id="7920168">(</span><span class="ident" id="7920169">t</span>&nbsp;<span class="op" id="7920171">*</span><span class="ident" id="7920172"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7920179">.</span><span class="ident" id="7920180">T</span><span class="op" id="7920181">,</span>&nbsp;<span class="ident" id="7920183">depth</span>&nbsp;<span class="builtintype" id="7920189">int</span><span class="op" id="7920192">,</span>&nbsp;<span class="ident" id="7920194">dep</span>&nbsp;<span class="ident" id="7920198"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="7920209">,</span>&nbsp;<span class="ident" id="7920211">seen</span>&nbsp;<span class="keyword" id="7920216">map</span><span class="op" id="7920219">[</span><span class="ident" id="7920220"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="7920231">]</span><span class="builtintype" id="7920232">bool</span><span class="op" id="7920236">)</span>&nbsp;<span class="op" id="7920238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920241"><a href="/database/sql/sql_test.go.html#7920211">seen</a></span><span class="op" id="7920245">[</span><span class="ident" id="7920246"><a href="/database/sql/sql_test.go.html#7920194">dep</a></span><span class="op" id="7920249">]</span>&nbsp;<span class="op" id="7920251">=</span>&nbsp;<span class="ident" id="7920253">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920259">indent</span>&nbsp;<span class="op" id="7920266">:=</span>&nbsp;<span class="ident" id="7920269"><a href="/database/sql/sql_test.go.html#7916681">strings</a></span><span class="op" id="7920276">.</span><span class="ident" id="7920277">Repeat</span><span class="op" id="7920283">(</span><span class="string" id="7920284">&#34;&nbsp;&nbsp;&#34;</span><span class="op" id="7920288">,</span>&nbsp;<span class="ident" id="7920290"><a href="/database/sql/sql_test.go.html#7920183">depth</a></span><span class="op" id="7920295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920298">ds</span>&nbsp;<span class="op" id="7920301">:=</span>&nbsp;<span class="ident" id="7920304"><a href="/database/sql/sql_test.go.html#7920153">db</a></span><span class="op" id="7920306">.</span><span class="ident" id="7920307">dep</span><span class="op" id="7920310">[</span><span class="ident" id="7920311"><a href="/database/sql/sql_test.go.html#7920194">dep</a></span><span class="op" id="7920314">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920317">for</span>&nbsp;<span class="ident" id="7920321">k</span>&nbsp;<span class="op" id="7920323">:=</span>&nbsp;<span class="keyword" id="7920326">range</span>&nbsp;<span class="ident" id="7920332"><a href="/database/sql/sql_test.go.html#7920298">ds</a></span>&nbsp;<span class="op" id="7920335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920339"><a href="/database/sql/sql_test.go.html#7920169">t</a></span><span class="op" id="7920340">.</span><span class="ident" id="7920341">Logf</span><span class="op" id="7920345">(</span><span class="string" id="7920346">&#34;%s%T&nbsp;(%p)&nbsp;waiting&nbsp;for&nbsp;-&gt;&nbsp;%T&nbsp;(%p)&#34;</span><span class="op" id="7920380">,</span>&nbsp;<span class="ident" id="7920382"><a href="/database/sql/sql_test.go.html#7920259">indent</a></span><span class="op" id="7920388">,</span>&nbsp;<span class="ident" id="7920390"><a href="/database/sql/sql_test.go.html#7920194">dep</a></span><span class="op" id="7920393">,</span>&nbsp;<span class="ident" id="7920395"><a href="/database/sql/sql_test.go.html#7920194">dep</a></span><span class="op" id="7920398">,</span>&nbsp;<span class="ident" id="7920400"><a href="/database/sql/sql_test.go.html#7920321">k</a></span><span class="op" id="7920401">,</span>&nbsp;<span class="ident" id="7920403"><a href="/database/sql/sql_test.go.html#7920321">k</a></span><span class="op" id="7920404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920408">if</span>&nbsp;<span class="ident" id="7920411">fc</span><span class="op" id="7920413">,</span>&nbsp;<span class="ident" id="7920415">ok</span>&nbsp;<span class="op" id="7920418">:=</span>&nbsp;<span class="ident" id="7920421"><a href="/database/sql/sql_test.go.html#7920321">k</a></span><span class="op" id="7920422">.</span><span class="op" id="7920423">(</span><span class="ident" id="7920424"><a href="/database/sql/sql.go.html#5752169">finalCloser</a></span><span class="op" id="7920435">)</span><span class="op" id="7920436">;</span>&nbsp;<span class="ident" id="7920438"><a href="/database/sql/sql_test.go.html#7920415">ok</a></span>&nbsp;<span class="op" id="7920441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920446">if</span>&nbsp;<span class="op" id="7920449">!</span><span class="ident" id="7920450"><a href="/database/sql/sql_test.go.html#7920211">seen</a></span><span class="op" id="7920454">[</span><span class="ident" id="7920455"><a href="/database/sql/sql_test.go.html#7920411">fc</a></span><span class="op" id="7920457">]</span>&nbsp;<span class="op" id="7920459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920465"><a href="/database/sql/sql_test.go.html#7920153">db</a></span><span class="op" id="7920467">.</span><span class="ident" id="7920468">dumpDep</span><span class="op" id="7920475">(</span><span class="ident" id="7920476"><a href="/database/sql/sql_test.go.html#7920169">t</a></span><span class="op" id="7920477">,</span>&nbsp;<span class="ident" id="7920479"><a href="/database/sql/sql_test.go.html#7920183">depth</a></span><span class="op" id="7920484">+</span><span class="num" id="7920485">1</span><span class="op" id="7920486">,</span>&nbsp;<span class="ident" id="7920488"><a href="/database/sql/sql_test.go.html#7920411">fc</a></span><span class="op" id="7920490">,</span>&nbsp;<span class="ident" id="7920492"><a href="/database/sql/sql_test.go.html#7920211">seen</a></span><span class="op" id="7920496">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920508">}</span><br>
<span class="lineno"></span><span class="op" id="7920510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7920513">func</span>&nbsp;<span class="ident" id="7920518">TestQuery</span><span class="op" id="7920527">(</span><span class="ident" id="7920528">t</span>&nbsp;<span class="op" id="7920530">*</span><span class="ident" id="7920531"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7920538">.</span><span class="ident" id="7920539">T</span><span class="op" id="7920540">)</span>&nbsp;<span class="op" id="7920542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920545">db</span>&nbsp;<span class="op" id="7920548">:=</span>&nbsp;<span class="ident" id="7920551"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7920560">(</span><span class="ident" id="7920561"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920562">,</span>&nbsp;<span class="string" id="7920564">&#34;people&#34;</span><span class="op" id="7920572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920575">defer</span>&nbsp;<span class="ident" id="7920581"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7920588">(</span><span class="ident" id="7920589"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920590">,</span>&nbsp;<span class="ident" id="7920592"><a href="/database/sql/sql_test.go.html#7920545">db</a></span><span class="op" id="7920594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920597">prepares0</span>&nbsp;<span class="op" id="7920607">:=</span>&nbsp;<span class="ident" id="7920610"><a href="/database/sql/sql_test.go.html#7919327">numPrepares</a></span><span class="op" id="7920621">(</span><span class="ident" id="7920622"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920623">,</span>&nbsp;<span class="ident" id="7920625"><a href="/database/sql/sql_test.go.html#7920545">db</a></span><span class="op" id="7920627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920630">rows</span><span class="op" id="7920634">,</span>&nbsp;<span class="ident" id="7920636">err</span>&nbsp;<span class="op" id="7920640">:=</span>&nbsp;<span class="ident" id="7920643"><a href="/database/sql/sql_test.go.html#7920545">db</a></span><span class="op" id="7920645">.</span><span class="ident" id="7920646">Query</span><span class="op" id="7920651">(</span><span class="string" id="7920652">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7920677">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920680">if</span>&nbsp;<span class="ident" id="7920683"><a href="/database/sql/sql_test.go.html#7920636">err</a></span>&nbsp;<span class="op" id="7920687">!=</span>&nbsp;<span class="ident" id="7920690">nil</span>&nbsp;<span class="op" id="7920694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920698"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920699">.</span><span class="ident" id="7920700">Fatalf</span><span class="op" id="7920706">(</span><span class="string" id="7920707">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7920718">,</span>&nbsp;<span class="ident" id="7920720"><a href="/database/sql/sql_test.go.html#7920636">err</a></span><span class="op" id="7920723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920729">type</span>&nbsp;<span class="ident" id="7920734">row</span>&nbsp;<span class="keyword" id="7920738">struct</span>&nbsp;<span class="op" id="7920745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920749">age</span>&nbsp;&nbsp;<span class="builtintype" id="7920754">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920760">name</span>&nbsp;<span class="builtintype" id="7920765">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920776">got</span>&nbsp;<span class="op" id="7920780">:=</span>&nbsp;<span class="op" id="7920783">[</span><span class="op" id="7920784">]</span><span class="ident" id="7920785"><a href="/database/sql/sql_test.go.html#7920734">row</a></span><span class="op" id="7920788">{</span><span class="op" id="7920789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920792">for</span>&nbsp;<span class="ident" id="7920796"><a href="/database/sql/sql_test.go.html#7920630">rows</a></span><span class="op" id="7920800">.</span><span class="ident" id="7920801">Next</span><span class="op" id="7920805">(</span><span class="op" id="7920806">)</span>&nbsp;<span class="op" id="7920808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920812">var</span>&nbsp;<span class="ident" id="7920816">r</span>&nbsp;<span class="ident" id="7920818"><a href="/database/sql/sql_test.go.html#7920734">row</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920824"><a href="/database/sql/sql_test.go.html#7920636">err</a></span>&nbsp;<span class="op" id="7920828">=</span>&nbsp;<span class="ident" id="7920830"><a href="/database/sql/sql_test.go.html#7920630">rows</a></span><span class="op" id="7920834">.</span><span class="ident" id="7920835">Scan</span><span class="op" id="7920839">(</span><span class="op" id="7920840">&amp;</span><span class="ident" id="7920841"><a href="/database/sql/sql_test.go.html#7920816">r</a></span><span class="op" id="7920842">.</span><span class="ident" id="7920843">age</span><span class="op" id="7920846">,</span>&nbsp;<span class="op" id="7920848">&amp;</span><span class="ident" id="7920849"><a href="/database/sql/sql_test.go.html#7920816">r</a></span><span class="op" id="7920850">.</span><span class="ident" id="7920851">name</span><span class="op" id="7920855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920859">if</span>&nbsp;<span class="ident" id="7920862"><a href="/database/sql/sql_test.go.html#7920636">err</a></span>&nbsp;<span class="op" id="7920866">!=</span>&nbsp;<span class="ident" id="7920869">nil</span>&nbsp;<span class="op" id="7920873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920878"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920879">.</span><span class="ident" id="7920880">Fatalf</span><span class="op" id="7920886">(</span><span class="string" id="7920887">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7920897">,</span>&nbsp;<span class="ident" id="7920899"><a href="/database/sql/sql_test.go.html#7920636">err</a></span><span class="op" id="7920902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920910"><a href="/database/sql/sql_test.go.html#7920776">got</a></span>&nbsp;<span class="op" id="7920914">=</span>&nbsp;<span class="builtinfunc" id="7920916">append</span><span class="op" id="7920922">(</span><span class="ident" id="7920923"><a href="/database/sql/sql_test.go.html#7920776">got</a></span><span class="op" id="7920926">,</span>&nbsp;<span class="ident" id="7920928"><a href="/database/sql/sql_test.go.html#7920816">r</a></span><span class="op" id="7920929">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920935"><a href="/database/sql/sql_test.go.html#7920636">err</a></span>&nbsp;<span class="op" id="7920939">=</span>&nbsp;<span class="ident" id="7920941"><a href="/database/sql/sql_test.go.html#7920630">rows</a></span><span class="op" id="7920945">.</span><span class="ident" id="7920946">Err</span><span class="op" id="7920949">(</span><span class="op" id="7920950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7920953">if</span>&nbsp;<span class="ident" id="7920956"><a href="/database/sql/sql_test.go.html#7920636">err</a></span>&nbsp;<span class="op" id="7920960">!=</span>&nbsp;<span class="ident" id="7920963">nil</span>&nbsp;<span class="op" id="7920967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7920971"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7920972">.</span><span class="ident" id="7920973">Fatalf</span><span class="op" id="7920979">(</span><span class="string" id="7920980">&#34;Err:&nbsp;%v&#34;</span><span class="op" id="7920989">,</span>&nbsp;<span class="ident" id="7920991"><a href="/database/sql/sql_test.go.html#7920636">err</a></span><span class="op" id="7920994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7920997">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921000">want</span>&nbsp;<span class="op" id="7921005">:=</span>&nbsp;<span class="op" id="7921008">[</span><span class="op" id="7921009">]</span><span class="ident" id="7921010"><a href="/database/sql/sql_test.go.html#7920734">row</a></span><span class="op" id="7921013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921017">{</span><span class="ident" id="7921018">age</span><span class="op" id="7921021">:</span>&nbsp;<span class="num" id="7921023">1</span><span class="op" id="7921024">,</span>&nbsp;<span class="ident" id="7921026">name</span><span class="op" id="7921030">:</span>&nbsp;<span class="string" id="7921032">&#34;Alice&#34;</span><span class="op" id="7921039">}</span><span class="op" id="7921040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921044">{</span><span class="ident" id="7921045">age</span><span class="op" id="7921048">:</span>&nbsp;<span class="num" id="7921050">2</span><span class="op" id="7921051">,</span>&nbsp;<span class="ident" id="7921053">name</span><span class="op" id="7921057">:</span>&nbsp;<span class="string" id="7921059">&#34;Bob&#34;</span><span class="op" id="7921064">}</span><span class="op" id="7921065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921069">{</span><span class="ident" id="7921070">age</span><span class="op" id="7921073">:</span>&nbsp;<span class="num" id="7921075">3</span><span class="op" id="7921076">,</span>&nbsp;<span class="ident" id="7921078">name</span><span class="op" id="7921082">:</span>&nbsp;<span class="string" id="7921084">&#34;Chris&#34;</span><span class="op" id="7921091">}</span><span class="op" id="7921092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921095">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921098">if</span>&nbsp;<span class="op" id="7921101">!</span><span class="ident" id="7921102"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7921109">.</span><span class="ident" id="7921110">DeepEqual</span><span class="op" id="7921119">(</span><span class="ident" id="7921120"><a href="/database/sql/sql_test.go.html#7920776">got</a></span><span class="op" id="7921123">,</span>&nbsp;<span class="ident" id="7921125"><a href="/database/sql/sql_test.go.html#7921000">want</a></span><span class="op" id="7921129">)</span>&nbsp;<span class="op" id="7921131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921135"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7921136">.</span><span class="ident" id="7921137">Errorf</span><span class="op" id="7921143">(</span><span class="string" id="7921144">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7921177">,</span>&nbsp;<span class="ident" id="7921179"><a href="/database/sql/sql_test.go.html#7920776">got</a></span><span class="op" id="7921182">,</span>&nbsp;<span class="ident" id="7921184"><a href="/database/sql/sql_test.go.html#7921000">want</a></span><span class="op" id="7921188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7921195">//&nbsp;And&nbsp;verify&nbsp;that&nbsp;the&nbsp;final&nbsp;rows.Next()&nbsp;call,&nbsp;which&nbsp;hit&nbsp;EOF,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7921258">//&nbsp;also&nbsp;closed&nbsp;the&nbsp;rows&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921295">if</span>&nbsp;<span class="ident" id="7921298">n</span>&nbsp;<span class="op" id="7921300">:=</span>&nbsp;<span class="ident" id="7921303"><a href="/database/sql/sql_test.go.html#7920545">db</a></span><span class="op" id="7921305">.</span><span class="ident" id="7921306">numFreeConns</span><span class="op" id="7921318">(</span><span class="op" id="7921319">)</span><span class="op" id="7921320">;</span>&nbsp;<span class="ident" id="7921322"><a href="/database/sql/sql_test.go.html#7921298">n</a></span>&nbsp;<span class="op" id="7921324">!=</span>&nbsp;<span class="num" id="7921327">1</span>&nbsp;<span class="op" id="7921329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921333"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7921334">.</span><span class="ident" id="7921335">Fatalf</span><span class="op" id="7921341">(</span><span class="string" id="7921342">&#34;free&nbsp;conns&nbsp;after&nbsp;query&nbsp;hitting&nbsp;EOF&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7921391">,</span>&nbsp;<span class="ident" id="7921393"><a href="/database/sql/sql_test.go.html#7921298">n</a></span><span class="op" id="7921394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921400">if</span>&nbsp;<span class="ident" id="7921403">prepares</span>&nbsp;<span class="op" id="7921412">:=</span>&nbsp;<span class="ident" id="7921415"><a href="/database/sql/sql_test.go.html#7919327">numPrepares</a></span><span class="op" id="7921426">(</span><span class="ident" id="7921427"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7921428">,</span>&nbsp;<span class="ident" id="7921430"><a href="/database/sql/sql_test.go.html#7920545">db</a></span><span class="op" id="7921432">)</span>&nbsp;<span class="op" id="7921434">-</span>&nbsp;<span class="ident" id="7921436"><a href="/database/sql/sql_test.go.html#7920597">prepares0</a></span><span class="op" id="7921445">;</span>&nbsp;<span class="ident" id="7921447"><a href="/database/sql/sql_test.go.html#7921403">prepares</a></span>&nbsp;<span class="op" id="7921456">!=</span>&nbsp;<span class="num" id="7921459">1</span>&nbsp;<span class="op" id="7921461">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921465"><a href="/database/sql/sql_test.go.html#7920528">t</a></span><span class="op" id="7921466">.</span><span class="ident" id="7921467">Errorf</span><span class="op" id="7921473">(</span><span class="string" id="7921474">&#34;executed&nbsp;%d&nbsp;Prepare&nbsp;statements;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7921514">,</span>&nbsp;<span class="ident" id="7921516"><a href="/database/sql/sql_test.go.html#7921403">prepares</a></span><span class="op" id="7921524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921527">}</span><br>
<span class="lineno"></span><span class="op" id="7921529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7921532">func</span>&nbsp;<span class="ident" id="7921537">TestByteOwnership</span><span class="op" id="7921554">(</span><span class="ident" id="7921555">t</span>&nbsp;<span class="op" id="7921557">*</span><span class="ident" id="7921558"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7921565">.</span><span class="ident" id="7921566">T</span><span class="op" id="7921567">)</span>&nbsp;<span class="op" id="7921569">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921572">db</span>&nbsp;<span class="op" id="7921575">:=</span>&nbsp;<span class="ident" id="7921578"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7921587">(</span><span class="ident" id="7921588"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7921589">,</span>&nbsp;<span class="string" id="7921591">&#34;people&#34;</span><span class="op" id="7921599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921602">defer</span>&nbsp;<span class="ident" id="7921608"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7921615">(</span><span class="ident" id="7921616"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7921617">,</span>&nbsp;<span class="ident" id="7921619"><a href="/database/sql/sql_test.go.html#7921572">db</a></span><span class="op" id="7921621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921624">rows</span><span class="op" id="7921628">,</span>&nbsp;<span class="ident" id="7921630">err</span>&nbsp;<span class="op" id="7921634">:=</span>&nbsp;<span class="ident" id="7921637"><a href="/database/sql/sql_test.go.html#7921572">db</a></span><span class="op" id="7921639">.</span><span class="ident" id="7921640">Query</span><span class="op" id="7921645">(</span><span class="string" id="7921646">&#34;SELECT|people|name,photo|&#34;</span><span class="op" id="7921673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921676">if</span>&nbsp;<span class="ident" id="7921679"><a href="/database/sql/sql_test.go.html#7921630">err</a></span>&nbsp;<span class="op" id="7921683">!=</span>&nbsp;<span class="ident" id="7921686">nil</span>&nbsp;<span class="op" id="7921690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921694"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7921695">.</span><span class="ident" id="7921696">Fatalf</span><span class="op" id="7921702">(</span><span class="string" id="7921703">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7921714">,</span>&nbsp;<span class="ident" id="7921716"><a href="/database/sql/sql_test.go.html#7921630">err</a></span><span class="op" id="7921719">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921725">type</span>&nbsp;<span class="ident" id="7921730">row</span>&nbsp;<span class="keyword" id="7921734">struct</span>&nbsp;<span class="op" id="7921741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921745">name</span>&nbsp;&nbsp;<span class="op" id="7921751">[</span><span class="op" id="7921752">]</span><span class="builtintype" id="7921753">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921760">photo</span>&nbsp;<span class="ident" id="7921766"><a href="/database/sql/sql.go.html#5744226">RawBytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921776">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921779">got</span>&nbsp;<span class="op" id="7921783">:=</span>&nbsp;<span class="op" id="7921786">[</span><span class="op" id="7921787">]</span><span class="ident" id="7921788"><a href="/database/sql/sql_test.go.html#7921730">row</a></span><span class="op" id="7921791">{</span><span class="op" id="7921792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921795">for</span>&nbsp;<span class="ident" id="7921799"><a href="/database/sql/sql_test.go.html#7921624">rows</a></span><span class="op" id="7921803">.</span><span class="ident" id="7921804">Next</span><span class="op" id="7921808">(</span><span class="op" id="7921809">)</span>&nbsp;<span class="op" id="7921811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921815">var</span>&nbsp;<span class="ident" id="7921819">r</span>&nbsp;<span class="ident" id="7921821"><a href="/database/sql/sql_test.go.html#7921730">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921827"><a href="/database/sql/sql_test.go.html#7921630">err</a></span>&nbsp;<span class="op" id="7921831">=</span>&nbsp;<span class="ident" id="7921833"><a href="/database/sql/sql_test.go.html#7921624">rows</a></span><span class="op" id="7921837">.</span><span class="ident" id="7921838">Scan</span><span class="op" id="7921842">(</span><span class="op" id="7921843">&amp;</span><span class="ident" id="7921844"><a href="/database/sql/sql_test.go.html#7921819">r</a></span><span class="op" id="7921845">.</span><span class="ident" id="7921846">name</span><span class="op" id="7921850">,</span>&nbsp;<span class="op" id="7921852">&amp;</span><span class="ident" id="7921853"><a href="/database/sql/sql_test.go.html#7921819">r</a></span><span class="op" id="7921854">.</span><span class="ident" id="7921855">photo</span><span class="op" id="7921860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921864">if</span>&nbsp;<span class="ident" id="7921867"><a href="/database/sql/sql_test.go.html#7921630">err</a></span>&nbsp;<span class="op" id="7921871">!=</span>&nbsp;<span class="ident" id="7921874">nil</span>&nbsp;<span class="op" id="7921878">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921883"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7921884">.</span><span class="ident" id="7921885">Fatalf</span><span class="op" id="7921891">(</span><span class="string" id="7921892">&#34;Scan:&nbsp;%v&#34;</span><span class="op" id="7921902">,</span>&nbsp;<span class="ident" id="7921904"><a href="/database/sql/sql_test.go.html#7921630">err</a></span><span class="op" id="7921907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921915"><a href="/database/sql/sql_test.go.html#7921779">got</a></span>&nbsp;<span class="op" id="7921919">=</span>&nbsp;<span class="builtinfunc" id="7921921">append</span><span class="op" id="7921927">(</span><span class="ident" id="7921928"><a href="/database/sql/sql_test.go.html#7921779">got</a></span><span class="op" id="7921931">,</span>&nbsp;<span class="ident" id="7921933"><a href="/database/sql/sql_test.go.html#7921819">r</a></span><span class="op" id="7921934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921940">corruptMemory</span>&nbsp;<span class="op" id="7921954">:=</span>&nbsp;<span class="op" id="7921957">[</span><span class="op" id="7921958">]</span><span class="builtintype" id="7921959">byte</span><span class="op" id="7921963">(</span><span class="string" id="7921964">&#34;\xffPHOTO&#34;</span><span class="op" id="7921975">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921978">want</span>&nbsp;<span class="op" id="7921983">:=</span>&nbsp;<span class="op" id="7921986">[</span><span class="op" id="7921987">]</span><span class="ident" id="7921988"><a href="/database/sql/sql_test.go.html#7921730">row</a></span><span class="op" id="7921991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7921995">{</span><span class="ident" id="7921996">name</span><span class="op" id="7922000">:</span>&nbsp;<span class="op" id="7922002">[</span><span class="op" id="7922003">]</span><span class="builtintype" id="7922004">byte</span><span class="op" id="7922008">(</span><span class="string" id="7922009">&#34;Alice&#34;</span><span class="op" id="7922016">)</span><span class="op" id="7922017">,</span>&nbsp;<span class="ident" id="7922019">photo</span><span class="op" id="7922024">:</span>&nbsp;<span class="ident" id="7922026"><a href="/database/sql/sql_test.go.html#7921940">corruptMemory</a></span><span class="op" id="7922039">}</span><span class="op" id="7922040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922044">{</span><span class="ident" id="7922045">name</span><span class="op" id="7922049">:</span>&nbsp;<span class="op" id="7922051">[</span><span class="op" id="7922052">]</span><span class="builtintype" id="7922053">byte</span><span class="op" id="7922057">(</span><span class="string" id="7922058">&#34;Bob&#34;</span><span class="op" id="7922063">)</span><span class="op" id="7922064">,</span>&nbsp;<span class="ident" id="7922066">photo</span><span class="op" id="7922071">:</span>&nbsp;<span class="ident" id="7922073"><a href="/database/sql/sql_test.go.html#7921940">corruptMemory</a></span><span class="op" id="7922086">}</span><span class="op" id="7922087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922091">{</span><span class="ident" id="7922092">name</span><span class="op" id="7922096">:</span>&nbsp;<span class="op" id="7922098">[</span><span class="op" id="7922099">]</span><span class="builtintype" id="7922100">byte</span><span class="op" id="7922104">(</span><span class="string" id="7922105">&#34;Chris&#34;</span><span class="op" id="7922112">)</span><span class="op" id="7922113">,</span>&nbsp;<span class="ident" id="7922115">photo</span><span class="op" id="7922120">:</span>&nbsp;<span class="ident" id="7922122"><a href="/database/sql/sql_test.go.html#7921940">corruptMemory</a></span><span class="op" id="7922135">}</span><span class="op" id="7922136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922139">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922142">if</span>&nbsp;<span class="op" id="7922145">!</span><span class="ident" id="7922146"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7922153">.</span><span class="ident" id="7922154">DeepEqual</span><span class="op" id="7922163">(</span><span class="ident" id="7922164"><a href="/database/sql/sql_test.go.html#7921779">got</a></span><span class="op" id="7922167">,</span>&nbsp;<span class="ident" id="7922169"><a href="/database/sql/sql_test.go.html#7921978">want</a></span><span class="op" id="7922173">)</span>&nbsp;<span class="op" id="7922175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922179"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7922180">.</span><span class="ident" id="7922181">Errorf</span><span class="op" id="7922187">(</span><span class="string" id="7922188">&#34;mismatch.\n&nbsp;got:&nbsp;%#v\nwant:&nbsp;%#v&#34;</span><span class="op" id="7922221">,</span>&nbsp;<span class="ident" id="7922223"><a href="/database/sql/sql_test.go.html#7921779">got</a></span><span class="op" id="7922226">,</span>&nbsp;<span class="ident" id="7922228"><a href="/database/sql/sql_test.go.html#7921978">want</a></span><span class="op" id="7922232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922239">var</span>&nbsp;<span class="ident" id="7922243">photo</span>&nbsp;<span class="ident" id="7922249"><a href="/database/sql/sql.go.html#5744226">RawBytes</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922259"><a href="/database/sql/sql_test.go.html#7921630">err</a></span>&nbsp;<span class="op" id="7922263">=</span>&nbsp;<span class="ident" id="7922265"><a href="/database/sql/sql_test.go.html#7921572">db</a></span><span class="op" id="7922267">.</span><span class="ident" id="7922268">QueryRow</span><span class="op" id="7922276">(</span><span class="string" id="7922277">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7922305">,</span>&nbsp;<span class="string" id="7922307">&#34;Alice&#34;</span><span class="op" id="7922314">)</span><span class="op" id="7922315">.</span><span class="ident" id="7922316">Scan</span><span class="op" id="7922320">(</span><span class="op" id="7922321">&amp;</span><span class="ident" id="7922322"><a href="/database/sql/sql_test.go.html#7922243">photo</a></span><span class="op" id="7922327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922330">if</span>&nbsp;<span class="ident" id="7922333"><a href="/database/sql/sql_test.go.html#7921630">err</a></span>&nbsp;<span class="op" id="7922337">==</span>&nbsp;<span class="ident" id="7922340">nil</span>&nbsp;<span class="op" id="7922344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922348"><a href="/database/sql/sql_test.go.html#7921555">t</a></span><span class="op" id="7922349">.</span><span class="ident" id="7922350">Error</span><span class="op" id="7922355">(</span><span class="string" id="7922356">&#34;want&nbsp;error&nbsp;scanning&nbsp;into&nbsp;RawBytes&nbsp;from&nbsp;QueryRow&#34;</span><span class="op" id="7922405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922408">}</span><br>
<span class="lineno"></span><span class="op" id="7922410">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="7922413">func</span>&nbsp;<span class="ident" id="7922418">TestRowsColumns</span><span class="op" id="7922433">(</span><span class="ident" id="7922434">t</span>&nbsp;<span class="op" id="7922436">*</span><span class="ident" id="7922437"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7922444">.</span><span class="ident" id="7922445">T</span><span class="op" id="7922446">)</span>&nbsp;<span class="op" id="7922448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922451">db</span>&nbsp;<span class="op" id="7922454">:=</span>&nbsp;<span class="ident" id="7922457"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7922466">(</span><span class="ident" id="7922467"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922468">,</span>&nbsp;<span class="string" id="7922470">&#34;people&#34;</span><span class="op" id="7922478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922481">defer</span>&nbsp;<span class="ident" id="7922487"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7922494">(</span><span class="ident" id="7922495"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922496">,</span>&nbsp;<span class="ident" id="7922498"><a href="/database/sql/sql_test.go.html#7922451">db</a></span><span class="op" id="7922500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922503">rows</span><span class="op" id="7922507">,</span>&nbsp;<span class="ident" id="7922509">err</span>&nbsp;<span class="op" id="7922513">:=</span>&nbsp;<span class="ident" id="7922516"><a href="/database/sql/sql_test.go.html#7922451">db</a></span><span class="op" id="7922518">.</span><span class="ident" id="7922519">Query</span><span class="op" id="7922524">(</span><span class="string" id="7922525">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7922550">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922553">if</span>&nbsp;<span class="ident" id="7922556"><a href="/database/sql/sql_test.go.html#7922509">err</a></span>&nbsp;<span class="op" id="7922560">!=</span>&nbsp;<span class="ident" id="7922563">nil</span>&nbsp;<span class="op" id="7922567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922571"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922572">.</span><span class="ident" id="7922573">Fatalf</span><span class="op" id="7922579">(</span><span class="string" id="7922580">&#34;Query:&nbsp;%v&#34;</span><span class="op" id="7922591">,</span>&nbsp;<span class="ident" id="7922593"><a href="/database/sql/sql_test.go.html#7922509">err</a></span><span class="op" id="7922596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922602">cols</span><span class="op" id="7922606">,</span>&nbsp;<span class="ident" id="7922608"><a href="/database/sql/sql_test.go.html#7922509">err</a></span>&nbsp;<span class="op" id="7922612">:=</span>&nbsp;<span class="ident" id="7922615"><a href="/database/sql/sql_test.go.html#7922503">rows</a></span><span class="op" id="7922619">.</span><span class="ident" id="7922620">Columns</span><span class="op" id="7922627">(</span><span class="op" id="7922628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922631">if</span>&nbsp;<span class="ident" id="7922634"><a href="/database/sql/sql_test.go.html#7922509">err</a></span>&nbsp;<span class="op" id="7922638">!=</span>&nbsp;<span class="ident" id="7922641">nil</span>&nbsp;<span class="op" id="7922645">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922649"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922650">.</span><span class="ident" id="7922651">Fatalf</span><span class="op" id="7922657">(</span><span class="string" id="7922658">&#34;Columns:&nbsp;%v&#34;</span><span class="op" id="7922671">,</span>&nbsp;<span class="ident" id="7922673"><a href="/database/sql/sql_test.go.html#7922509">err</a></span><span class="op" id="7922676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922682">want</span>&nbsp;<span class="op" id="7922687">:=</span>&nbsp;<span class="op" id="7922690">[</span><span class="op" id="7922691">]</span><span class="builtintype" id="7922692">string</span><span class="op" id="7922698">{</span><span class="string" id="7922699">&#34;age&#34;</span><span class="op" id="7922704">,</span>&nbsp;<span class="string" id="7922706">&#34;name&#34;</span><span class="op" id="7922712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922715">if</span>&nbsp;<span class="op" id="7922718">!</span><span class="ident" id="7922719"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7922726">.</span><span class="ident" id="7922727">DeepEqual</span><span class="op" id="7922736">(</span><span class="ident" id="7922737"><a href="/database/sql/sql_test.go.html#7922602">cols</a></span><span class="op" id="7922741">,</span>&nbsp;<span class="ident" id="7922743"><a href="/database/sql/sql_test.go.html#7922682">want</a></span><span class="op" id="7922747">)</span>&nbsp;<span class="op" id="7922749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922753"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922754">.</span><span class="ident" id="7922755">Errorf</span><span class="op" id="7922761">(</span><span class="string" id="7922762">&#34;got&nbsp;%#v;&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7922781">,</span>&nbsp;<span class="ident" id="7922783"><a href="/database/sql/sql_test.go.html#7922602">cols</a></span><span class="op" id="7922787">,</span>&nbsp;<span class="ident" id="7922789"><a href="/database/sql/sql_test.go.html#7922682">want</a></span><span class="op" id="7922793">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922799">if</span>&nbsp;<span class="ident" id="7922802">err</span>&nbsp;<span class="op" id="7922806">:=</span>&nbsp;<span class="ident" id="7922809"><a href="/database/sql/sql_test.go.html#7922503">rows</a></span><span class="op" id="7922813">.</span><span class="ident" id="7922814">Close</span><span class="op" id="7922819">(</span><span class="op" id="7922820">)</span><span class="op" id="7922821">;</span>&nbsp;<span class="ident" id="7922823"><a href="/database/sql/sql_test.go.html#7922802">err</a></span>&nbsp;<span class="op" id="7922827">!=</span>&nbsp;<span class="ident" id="7922830">nil</span>&nbsp;<span class="op" id="7922834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922838"><a href="/database/sql/sql_test.go.html#7922434">t</a></span><span class="op" id="7922839">.</span><span class="ident" id="7922840">Errorf</span><span class="op" id="7922846">(</span><span class="string" id="7922847">&#34;error&nbsp;closing&nbsp;rows:&nbsp;%s&#34;</span><span class="op" id="7922871">,</span>&nbsp;<span class="ident" id="7922873"><a href="/database/sql/sql_test.go.html#7922802">err</a></span><span class="op" id="7922876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922879">}</span><br>
<span class="lineno"></span><span class="op" id="7922881">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7922884">func</span>&nbsp;<span class="ident" id="7922889">TestQueryRow</span><span class="op" id="7922901">(</span><span class="ident" id="7922902">t</span>&nbsp;<span class="op" id="7922904">*</span><span class="ident" id="7922905"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7922912">.</span><span class="ident" id="7922913">T</span><span class="op" id="7922914">)</span>&nbsp;<span class="op" id="7922916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922919">db</span>&nbsp;<span class="op" id="7922922">:=</span>&nbsp;<span class="ident" id="7922925"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7922934">(</span><span class="ident" id="7922935"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7922936">,</span>&nbsp;<span class="string" id="7922938">&#34;people&#34;</span><span class="op" id="7922946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922949">defer</span>&nbsp;<span class="ident" id="7922955"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7922962">(</span><span class="ident" id="7922963"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7922964">,</span>&nbsp;<span class="ident" id="7922966"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7922968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922971">var</span>&nbsp;<span class="ident" id="7922975">name</span>&nbsp;<span class="builtintype" id="7922980">string</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922988">var</span>&nbsp;<span class="ident" id="7922992">age</span>&nbsp;<span class="builtintype" id="7922996">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923001">var</span>&nbsp;<span class="ident" id="7923005">birthday</span>&nbsp;<span class="ident" id="7923014"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7923018">.</span><span class="ident" id="7923019">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923026">err</span>&nbsp;<span class="op" id="7923030">:=</span>&nbsp;<span class="ident" id="7923033"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7923035">.</span><span class="ident" id="7923036">QueryRow</span><span class="op" id="7923044">(</span><span class="string" id="7923045">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7923075">,</span>&nbsp;<span class="num" id="7923077">3</span><span class="op" id="7923078">)</span><span class="op" id="7923079">.</span><span class="ident" id="7923080">Scan</span><span class="op" id="7923084">(</span><span class="op" id="7923085">&amp;</span><span class="ident" id="7923086"><a href="/database/sql/sql_test.go.html#7922992">age</a></span><span class="op" id="7923089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923092">if</span>&nbsp;<span class="ident" id="7923095"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923099">==</span>&nbsp;<span class="ident" id="7923102">nil</span>&nbsp;<span class="op" id="7923106">||</span>&nbsp;<span class="op" id="7923109">!</span><span class="ident" id="7923110"><a href="/database/sql/sql_test.go.html#7916681">strings</a></span><span class="op" id="7923117">.</span><span class="ident" id="7923118">Contains</span><span class="op" id="7923126">(</span><span class="ident" id="7923127"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7923130">.</span><span class="ident" id="7923131">Error</span><span class="op" id="7923136">(</span><span class="op" id="7923137">)</span><span class="op" id="7923138">,</span>&nbsp;<span class="string" id="7923140">&#34;expected&nbsp;2&nbsp;destination&nbsp;arguments&#34;</span><span class="op" id="7923174">)</span>&nbsp;<span class="op" id="7923176">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923180"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923181">.</span><span class="ident" id="7923182">Errorf</span><span class="op" id="7923188">(</span><span class="string" id="7923189">&#34;expected&nbsp;error&nbsp;from&nbsp;wrong&nbsp;number&nbsp;of&nbsp;arguments;&nbsp;actually&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7923254">,</span>&nbsp;<span class="ident" id="7923256"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7923259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923266"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923270">=</span>&nbsp;<span class="ident" id="7923272"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7923274">.</span><span class="ident" id="7923275">QueryRow</span><span class="op" id="7923283">(</span><span class="string" id="7923284">&#34;SELECT|people|bdate|age=?&#34;</span><span class="op" id="7923311">,</span>&nbsp;<span class="num" id="7923313">3</span><span class="op" id="7923314">)</span><span class="op" id="7923315">.</span><span class="ident" id="7923316">Scan</span><span class="op" id="7923320">(</span><span class="op" id="7923321">&amp;</span><span class="ident" id="7923322"><a href="/database/sql/sql_test.go.html#7923005">birthday</a></span><span class="op" id="7923330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923333">if</span>&nbsp;<span class="ident" id="7923336"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923340">!=</span>&nbsp;<span class="ident" id="7923343">nil</span>&nbsp;<span class="op" id="7923347">||</span>&nbsp;<span class="op" id="7923350">!</span><span class="ident" id="7923351"><a href="/database/sql/sql_test.go.html#7923005">birthday</a></span><span class="op" id="7923359">.</span><span class="ident" id="7923360">Equal</span><span class="op" id="7923365">(</span><span class="ident" id="7923366"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7923379">)</span>&nbsp;<span class="op" id="7923381">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923385"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923386">.</span><span class="ident" id="7923387">Errorf</span><span class="op" id="7923393">(</span><span class="string" id="7923394">&#34;chris&nbsp;birthday&nbsp;=&nbsp;%v,&nbsp;err&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7923434">,</span>&nbsp;<span class="ident" id="7923436"><a href="/database/sql/sql_test.go.html#7923005">birthday</a></span><span class="op" id="7923444">,</span>&nbsp;<span class="ident" id="7923446"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7923449">,</span>&nbsp;<span class="ident" id="7923451"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7923464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923471"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923475">=</span>&nbsp;<span class="ident" id="7923477"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7923479">.</span><span class="ident" id="7923480">QueryRow</span><span class="op" id="7923488">(</span><span class="string" id="7923489">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7923519">,</span>&nbsp;<span class="num" id="7923521">2</span><span class="op" id="7923522">)</span><span class="op" id="7923523">.</span><span class="ident" id="7923524">Scan</span><span class="op" id="7923528">(</span><span class="op" id="7923529">&amp;</span><span class="ident" id="7923530"><a href="/database/sql/sql_test.go.html#7922992">age</a></span><span class="op" id="7923533">,</span>&nbsp;<span class="op" id="7923535">&amp;</span><span class="ident" id="7923536"><a href="/database/sql/sql_test.go.html#7922975">name</a></span><span class="op" id="7923540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923543">if</span>&nbsp;<span class="ident" id="7923546"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923550">!=</span>&nbsp;<span class="ident" id="7923553">nil</span>&nbsp;<span class="op" id="7923557">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923561"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923562">.</span><span class="ident" id="7923563">Fatalf</span><span class="op" id="7923569">(</span><span class="string" id="7923570">&#34;age&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7923593">,</span>&nbsp;<span class="ident" id="7923595"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7923598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923604">if</span>&nbsp;<span class="ident" id="7923607"><a href="/database/sql/sql_test.go.html#7922975">name</a></span>&nbsp;<span class="op" id="7923612">!=</span>&nbsp;<span class="string" id="7923615">&#34;Bob&#34;</span>&nbsp;<span class="op" id="7923621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923625"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923626">.</span><span class="ident" id="7923627">Errorf</span><span class="op" id="7923633">(</span><span class="string" id="7923634">&#34;expected&nbsp;name&nbsp;Bob,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7923661">,</span>&nbsp;<span class="ident" id="7923663"><a href="/database/sql/sql_test.go.html#7922975">name</a></span><span class="op" id="7923667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923670">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923673">if</span>&nbsp;<span class="ident" id="7923676"><a href="/database/sql/sql_test.go.html#7922992">age</a></span>&nbsp;<span class="op" id="7923680">!=</span>&nbsp;<span class="num" id="7923683">2</span>&nbsp;<span class="op" id="7923685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923689"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923690">.</span><span class="ident" id="7923691">Errorf</span><span class="op" id="7923697">(</span><span class="string" id="7923698">&#34;expected&nbsp;age&nbsp;2,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7923722">,</span>&nbsp;<span class="ident" id="7923724"><a href="/database/sql/sql_test.go.html#7922992">age</a></span><span class="op" id="7923727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923734"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923738">=</span>&nbsp;<span class="ident" id="7923740"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7923742">.</span><span class="ident" id="7923743">QueryRow</span><span class="op" id="7923751">(</span><span class="string" id="7923752">&#34;SELECT|people|age,name|name=?&#34;</span><span class="op" id="7923783">,</span>&nbsp;<span class="string" id="7923785">&#34;Alice&#34;</span><span class="op" id="7923792">)</span><span class="op" id="7923793">.</span><span class="ident" id="7923794">Scan</span><span class="op" id="7923798">(</span><span class="op" id="7923799">&amp;</span><span class="ident" id="7923800"><a href="/database/sql/sql_test.go.html#7922992">age</a></span><span class="op" id="7923803">,</span>&nbsp;<span class="op" id="7923805">&amp;</span><span class="ident" id="7923806"><a href="/database/sql/sql_test.go.html#7922975">name</a></span><span class="op" id="7923810">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923813">if</span>&nbsp;<span class="ident" id="7923816"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7923820">!=</span>&nbsp;<span class="ident" id="7923823">nil</span>&nbsp;<span class="op" id="7923827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923831"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923832">.</span><span class="ident" id="7923833">Fatalf</span><span class="op" id="7923839">(</span><span class="string" id="7923840">&#34;name&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7923864">,</span>&nbsp;<span class="ident" id="7923866"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7923869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923875">if</span>&nbsp;<span class="ident" id="7923878"><a href="/database/sql/sql_test.go.html#7922975">name</a></span>&nbsp;<span class="op" id="7923883">!=</span>&nbsp;<span class="string" id="7923886">&#34;Alice&#34;</span>&nbsp;<span class="op" id="7923894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923898"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923899">.</span><span class="ident" id="7923900">Errorf</span><span class="op" id="7923906">(</span><span class="string" id="7923907">&#34;expected&nbsp;name&nbsp;Alice,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7923936">,</span>&nbsp;<span class="ident" id="7923938"><a href="/database/sql/sql_test.go.html#7922975">name</a></span><span class="op" id="7923942">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923948">if</span>&nbsp;<span class="ident" id="7923951"><a href="/database/sql/sql_test.go.html#7922992">age</a></span>&nbsp;<span class="op" id="7923955">!=</span>&nbsp;<span class="num" id="7923958">1</span>&nbsp;<span class="op" id="7923960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923964"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7923965">.</span><span class="ident" id="7923966">Errorf</span><span class="op" id="7923972">(</span><span class="string" id="7923973">&#34;expected&nbsp;age&nbsp;1,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7923997">,</span>&nbsp;<span class="ident" id="7923999"><a href="/database/sql/sql_test.go.html#7922992">age</a></span><span class="op" id="7924002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924009">var</span>&nbsp;<span class="ident" id="7924013">photo</span>&nbsp;<span class="op" id="7924019">[</span><span class="op" id="7924020">]</span><span class="builtintype" id="7924021">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924027"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7924031">=</span>&nbsp;<span class="ident" id="7924033"><a href="/database/sql/sql_test.go.html#7922919">db</a></span><span class="op" id="7924035">.</span><span class="ident" id="7924036">QueryRow</span><span class="op" id="7924044">(</span><span class="string" id="7924045">&#34;SELECT|people|photo|name=?&#34;</span><span class="op" id="7924073">,</span>&nbsp;<span class="string" id="7924075">&#34;Alice&#34;</span><span class="op" id="7924082">)</span><span class="op" id="7924083">.</span><span class="ident" id="7924084">Scan</span><span class="op" id="7924088">(</span><span class="op" id="7924089">&amp;</span><span class="ident" id="7924090"><a href="/database/sql/sql_test.go.html#7924013">photo</a></span><span class="op" id="7924095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924098">if</span>&nbsp;<span class="ident" id="7924101"><a href="/database/sql/sql_test.go.html#7923026">err</a></span>&nbsp;<span class="op" id="7924105">!=</span>&nbsp;<span class="ident" id="7924108">nil</span>&nbsp;<span class="op" id="7924112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924116"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7924117">.</span><span class="ident" id="7924118">Fatalf</span><span class="op" id="7924124">(</span><span class="string" id="7924125">&#34;photo&nbsp;QueryRow+Scan:&nbsp;%v&#34;</span><span class="op" id="7924150">,</span>&nbsp;<span class="ident" id="7924152"><a href="/database/sql/sql_test.go.html#7923026">err</a></span><span class="op" id="7924155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924158">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924161">want</span>&nbsp;<span class="op" id="7924166">:=</span>&nbsp;<span class="op" id="7924169">[</span><span class="op" id="7924170">]</span><span class="builtintype" id="7924171">byte</span><span class="op" id="7924175">(</span><span class="string" id="7924176">&#34;APHOTO&#34;</span><span class="op" id="7924184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924187">if</span>&nbsp;<span class="op" id="7924190">!</span><span class="ident" id="7924191"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7924198">.</span><span class="ident" id="7924199">DeepEqual</span><span class="op" id="7924208">(</span><span class="ident" id="7924209"><a href="/database/sql/sql_test.go.html#7924013">photo</a></span><span class="op" id="7924214">,</span>&nbsp;<span class="ident" id="7924216"><a href="/database/sql/sql_test.go.html#7924161">want</a></span><span class="op" id="7924220">)</span>&nbsp;<span class="op" id="7924222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924226"><a href="/database/sql/sql_test.go.html#7922902">t</a></span><span class="op" id="7924227">.</span><span class="ident" id="7924228">Errorf</span><span class="op" id="7924234">(</span><span class="string" id="7924235">&#34;photo&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7924256">,</span>&nbsp;<span class="ident" id="7924258"><a href="/database/sql/sql_test.go.html#7924013">photo</a></span><span class="op" id="7924263">,</span>&nbsp;<span class="ident" id="7924265"><a href="/database/sql/sql_test.go.html#7924161">want</a></span><span class="op" id="7924269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924272">}</span><br>
<span class="lineno"></span><span class="op" id="7924274">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7924277">func</span>&nbsp;<span class="ident" id="7924282">TestStatementErrorAfterClose</span><span class="op" id="7924310">(</span><span class="ident" id="7924311">t</span>&nbsp;<span class="op" id="7924313">*</span><span class="ident" id="7924314"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7924321">.</span><span class="ident" id="7924322">T</span><span class="op" id="7924323">)</span>&nbsp;<span class="op" id="7924325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924328">db</span>&nbsp;<span class="op" id="7924331">:=</span>&nbsp;<span class="ident" id="7924334"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7924343">(</span><span class="ident" id="7924344"><a href="/database/sql/sql_test.go.html#7924311">t</a></span><span class="op" id="7924345">,</span>&nbsp;<span class="string" id="7924347">&#34;people&#34;</span><span class="op" id="7924355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924358">defer</span>&nbsp;<span class="ident" id="7924364"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7924371">(</span><span class="ident" id="7924372"><a href="/database/sql/sql_test.go.html#7924311">t</a></span><span class="op" id="7924373">,</span>&nbsp;<span class="ident" id="7924375"><a href="/database/sql/sql_test.go.html#7924328">db</a></span><span class="op" id="7924377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924380">stmt</span><span class="op" id="7924384">,</span>&nbsp;<span class="ident" id="7924386">err</span>&nbsp;<span class="op" id="7924390">:=</span>&nbsp;<span class="ident" id="7924393"><a href="/database/sql/sql_test.go.html#7924328">db</a></span><span class="op" id="7924395">.</span><span class="ident" id="7924396">Prepare</span><span class="op" id="7924403">(</span><span class="string" id="7924404">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7924430">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924433">if</span>&nbsp;<span class="ident" id="7924436"><a href="/database/sql/sql_test.go.html#7924386">err</a></span>&nbsp;<span class="op" id="7924440">!=</span>&nbsp;<span class="ident" id="7924443">nil</span>&nbsp;<span class="op" id="7924447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924451"><a href="/database/sql/sql_test.go.html#7924311">t</a></span><span class="op" id="7924452">.</span><span class="ident" id="7924453">Fatalf</span><span class="op" id="7924459">(</span><span class="string" id="7924460">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7924473">,</span>&nbsp;<span class="ident" id="7924475"><a href="/database/sql/sql_test.go.html#7924386">err</a></span><span class="op" id="7924478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924484"><a href="/database/sql/sql_test.go.html#7924386">err</a></span>&nbsp;<span class="op" id="7924488">=</span>&nbsp;<span class="ident" id="7924490"><a href="/database/sql/sql_test.go.html#7924380">stmt</a></span><span class="op" id="7924494">.</span><span class="ident" id="7924495">Close</span><span class="op" id="7924500">(</span><span class="op" id="7924501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924504">if</span>&nbsp;<span class="ident" id="7924507"><a href="/database/sql/sql_test.go.html#7924386">err</a></span>&nbsp;<span class="op" id="7924511">!=</span>&nbsp;<span class="ident" id="7924514">nil</span>&nbsp;<span class="op" id="7924518">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924522"><a href="/database/sql/sql_test.go.html#7924311">t</a></span><span class="op" id="7924523">.</span><span class="ident" id="7924524">Fatalf</span><span class="op" id="7924530">(</span><span class="string" id="7924531">&#34;Close:&nbsp;%v&#34;</span><span class="op" id="7924542">,</span>&nbsp;<span class="ident" id="7924544"><a href="/database/sql/sql_test.go.html#7924386">err</a></span><span class="op" id="7924547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924553">var</span>&nbsp;<span class="ident" id="7924557">name</span>&nbsp;<span class="builtintype" id="7924562">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924570"><a href="/database/sql/sql_test.go.html#7924386">err</a></span>&nbsp;<span class="op" id="7924574">=</span>&nbsp;<span class="ident" id="7924576"><a href="/database/sql/sql_test.go.html#7924380">stmt</a></span><span class="op" id="7924580">.</span><span class="ident" id="7924581">QueryRow</span><span class="op" id="7924589">(</span><span class="string" id="7924590">&#34;foo&#34;</span><span class="op" id="7924595">)</span><span class="op" id="7924596">.</span><span class="ident" id="7924597">Scan</span><span class="op" id="7924601">(</span><span class="op" id="7924602">&amp;</span><span class="ident" id="7924603"><a href="/database/sql/sql_test.go.html#7924557">name</a></span><span class="op" id="7924607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924610">if</span>&nbsp;<span class="ident" id="7924613"><a href="/database/sql/sql_test.go.html#7924386">err</a></span>&nbsp;<span class="op" id="7924617">==</span>&nbsp;<span class="ident" id="7924620">nil</span>&nbsp;<span class="op" id="7924624">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924628"><a href="/database/sql/sql_test.go.html#7924311">t</a></span><span class="op" id="7924629">.</span><span class="ident" id="7924630">Errorf</span><span class="op" id="7924636">(</span><span class="string" id="7924637">&#34;expected&nbsp;error&nbsp;from&nbsp;QueryRow.Scan&nbsp;after&nbsp;Stmt.Close&#34;</span><span class="op" id="7924689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924692">}</span><br>
<span class="lineno"></span><span class="op" id="7924694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7924697">func</span>&nbsp;<span class="ident" id="7924702">TestStatementQueryRow</span><span class="op" id="7924723">(</span><span class="ident" id="7924724">t</span>&nbsp;<span class="op" id="7924726">*</span><span class="ident" id="7924727"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7924734">.</span><span class="ident" id="7924735">T</span><span class="op" id="7924736">)</span>&nbsp;<span class="op" id="7924738">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924741">db</span>&nbsp;<span class="op" id="7924744">:=</span>&nbsp;<span class="ident" id="7924747"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7924756">(</span><span class="ident" id="7924757"><a href="/database/sql/sql_test.go.html#7924724">t</a></span><span class="op" id="7924758">,</span>&nbsp;<span class="string" id="7924760">&#34;people&#34;</span><span class="op" id="7924768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924771">defer</span>&nbsp;<span class="ident" id="7924777"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7924784">(</span><span class="ident" id="7924785"><a href="/database/sql/sql_test.go.html#7924724">t</a></span><span class="op" id="7924786">,</span>&nbsp;<span class="ident" id="7924788"><a href="/database/sql/sql_test.go.html#7924741">db</a></span><span class="op" id="7924790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924793">stmt</span><span class="op" id="7924797">,</span>&nbsp;<span class="ident" id="7924799">err</span>&nbsp;<span class="op" id="7924803">:=</span>&nbsp;<span class="ident" id="7924806"><a href="/database/sql/sql_test.go.html#7924741">db</a></span><span class="op" id="7924808">.</span><span class="ident" id="7924809">Prepare</span><span class="op" id="7924816">(</span><span class="string" id="7924817">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7924843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924846">if</span>&nbsp;<span class="ident" id="7924849"><a href="/database/sql/sql_test.go.html#7924799">err</a></span>&nbsp;<span class="op" id="7924853">!=</span>&nbsp;<span class="ident" id="7924856">nil</span>&nbsp;<span class="op" id="7924860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924864"><a href="/database/sql/sql_test.go.html#7924724">t</a></span><span class="op" id="7924865">.</span><span class="ident" id="7924866">Fatalf</span><span class="op" id="7924872">(</span><span class="string" id="7924873">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7924886">,</span>&nbsp;<span class="ident" id="7924888"><a href="/database/sql/sql_test.go.html#7924799">err</a></span><span class="op" id="7924891">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924897">defer</span>&nbsp;<span class="ident" id="7924903"><a href="/database/sql/sql_test.go.html#7924793">stmt</a></span><span class="op" id="7924907">.</span><span class="ident" id="7924908">Close</span><span class="op" id="7924913">(</span><span class="op" id="7924914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924917">var</span>&nbsp;<span class="ident" id="7924921">age</span>&nbsp;<span class="builtintype" id="7924925">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7924930">for</span>&nbsp;<span class="ident" id="7924934">n</span><span class="op" id="7924935">,</span>&nbsp;<span class="ident" id="7924937">tt</span>&nbsp;<span class="op" id="7924940">:=</span>&nbsp;<span class="keyword" id="7924943">range</span>&nbsp;<span class="op" id="7924949">[</span><span class="op" id="7924950">]</span><span class="keyword" id="7924951">struct</span>&nbsp;<span class="op" id="7924958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924962">name</span>&nbsp;<span class="builtintype" id="7924967">string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7924976">want</span>&nbsp;<span class="builtintype" id="7924981">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924986">}</span><span class="op" id="7924987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7924991">{</span><span class="string" id="7924992">&#34;Alice&#34;</span><span class="op" id="7924999">,</span>&nbsp;<span class="num" id="7925001">1</span><span class="op" id="7925002">}</span><span class="op" id="7925003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925007">{</span><span class="string" id="7925008">&#34;Bob&#34;</span><span class="op" id="7925013">,</span>&nbsp;<span class="num" id="7925015">2</span><span class="op" id="7925016">}</span><span class="op" id="7925017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925021">{</span><span class="string" id="7925022">&#34;Chris&#34;</span><span class="op" id="7925029">,</span>&nbsp;<span class="num" id="7925031">3</span><span class="op" id="7925032">}</span><span class="op" id="7925033">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925036">}</span>&nbsp;<span class="op" id="7925038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925042">if</span>&nbsp;<span class="ident" id="7925045">err</span>&nbsp;<span class="op" id="7925049">:=</span>&nbsp;<span class="ident" id="7925052"><a href="/database/sql/sql_test.go.html#7924793">stmt</a></span><span class="op" id="7925056">.</span><span class="ident" id="7925057">QueryRow</span><span class="op" id="7925065">(</span><span class="ident" id="7925066"><a href="/database/sql/sql_test.go.html#7924937">tt</a></span><span class="op" id="7925068">.</span><span class="ident" id="7925069">name</span><span class="op" id="7925073">)</span><span class="op" id="7925074">.</span><span class="ident" id="7925075">Scan</span><span class="op" id="7925079">(</span><span class="op" id="7925080">&amp;</span><span class="ident" id="7925081"><a href="/database/sql/sql_test.go.html#7924921">age</a></span><span class="op" id="7925084">)</span><span class="op" id="7925085">;</span>&nbsp;<span class="ident" id="7925087"><a href="/database/sql/sql_test.go.html#7925045">err</a></span>&nbsp;<span class="op" id="7925091">!=</span>&nbsp;<span class="ident" id="7925094">nil</span>&nbsp;<span class="op" id="7925098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925103"><a href="/database/sql/sql_test.go.html#7924724">t</a></span><span class="op" id="7925104">.</span><span class="ident" id="7925105">Errorf</span><span class="op" id="7925111">(</span><span class="string" id="7925112">&#34;%d:&nbsp;on&nbsp;%q,&nbsp;QueryRow/Scan:&nbsp;%v&#34;</span><span class="op" id="7925142">,</span>&nbsp;<span class="ident" id="7925144"><a href="/database/sql/sql_test.go.html#7924934">n</a></span><span class="op" id="7925145">,</span>&nbsp;<span class="ident" id="7925147"><a href="/database/sql/sql_test.go.html#7924937">tt</a></span><span class="op" id="7925149">.</span><span class="ident" id="7925150">name</span><span class="op" id="7925154">,</span>&nbsp;<span class="ident" id="7925156"><a href="/database/sql/sql_test.go.html#7925045">err</a></span><span class="op" id="7925159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925163">}</span>&nbsp;<span class="keyword" id="7925165">else</span>&nbsp;<span class="keyword" id="7925170">if</span>&nbsp;<span class="ident" id="7925173"><a href="/database/sql/sql_test.go.html#7924921">age</a></span>&nbsp;<span class="op" id="7925177">!=</span>&nbsp;<span class="ident" id="7925180"><a href="/database/sql/sql_test.go.html#7924937">tt</a></span><span class="op" id="7925182">.</span><span class="ident" id="7925183">want</span>&nbsp;<span class="op" id="7925188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925193"><a href="/database/sql/sql_test.go.html#7924724">t</a></span><span class="op" id="7925194">.</span><span class="ident" id="7925195">Errorf</span><span class="op" id="7925201">(</span><span class="string" id="7925202">&#34;%d:&nbsp;age=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7925223">,</span>&nbsp;<span class="ident" id="7925225"><a href="/database/sql/sql_test.go.html#7924934">n</a></span><span class="op" id="7925226">,</span>&nbsp;<span class="ident" id="7925228"><a href="/database/sql/sql_test.go.html#7924921">age</a></span><span class="op" id="7925231">,</span>&nbsp;<span class="ident" id="7925233"><a href="/database/sql/sql_test.go.html#7924937">tt</a></span><span class="op" id="7925235">.</span><span class="ident" id="7925236">want</span><span class="op" id="7925240">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925247">}</span><br>
<span class="lineno"></span><span class="op" id="7925249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7925252">//&nbsp;golang.org/issue/3734</span><br>
<span class="lineno">360</span><span class="keyword" id="7925277">func</span>&nbsp;<span class="ident" id="7925282">TestStatementQueryRowConcurrent</span><span class="op" id="7925313">(</span><span class="ident" id="7925314">t</span>&nbsp;<span class="op" id="7925316">*</span><span class="ident" id="7925317"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7925324">.</span><span class="ident" id="7925325">T</span><span class="op" id="7925326">)</span>&nbsp;<span class="op" id="7925328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925331">db</span>&nbsp;<span class="op" id="7925334">:=</span>&nbsp;<span class="ident" id="7925337"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7925346">(</span><span class="ident" id="7925347"><a href="/database/sql/sql_test.go.html#7925314">t</a></span><span class="op" id="7925348">,</span>&nbsp;<span class="string" id="7925350">&#34;people&#34;</span><span class="op" id="7925358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925361">defer</span>&nbsp;<span class="ident" id="7925367"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7925374">(</span><span class="ident" id="7925375"><a href="/database/sql/sql_test.go.html#7925314">t</a></span><span class="op" id="7925376">,</span>&nbsp;<span class="ident" id="7925378"><a href="/database/sql/sql_test.go.html#7925331">db</a></span><span class="op" id="7925380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925383">stmt</span><span class="op" id="7925387">,</span>&nbsp;<span class="ident" id="7925389">err</span>&nbsp;<span class="op" id="7925393">:=</span>&nbsp;<span class="ident" id="7925396"><a href="/database/sql/sql_test.go.html#7925331">db</a></span><span class="op" id="7925398">.</span><span class="ident" id="7925399">Prepare</span><span class="op" id="7925406">(</span><span class="string" id="7925407">&#34;SELECT|people|age|name=?&#34;</span><span class="op" id="7925433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925436">if</span>&nbsp;<span class="ident" id="7925439"><a href="/database/sql/sql_test.go.html#7925389">err</a></span>&nbsp;<span class="op" id="7925443">!=</span>&nbsp;<span class="ident" id="7925446">nil</span>&nbsp;<span class="op" id="7925450">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925454"><a href="/database/sql/sql_test.go.html#7925314">t</a></span><span class="op" id="7925455">.</span><span class="ident" id="7925456">Fatalf</span><span class="op" id="7925462">(</span><span class="string" id="7925463">&#34;Prepare:&nbsp;%v&#34;</span><span class="op" id="7925476">,</span>&nbsp;<span class="ident" id="7925478"><a href="/database/sql/sql_test.go.html#7925389">err</a></span><span class="op" id="7925481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925487">defer</span>&nbsp;<span class="ident" id="7925493"><a href="/database/sql/sql_test.go.html#7925383">stmt</a></span><span class="op" id="7925497">.</span><span class="ident" id="7925498">Close</span><span class="op" id="7925503">(</span><span class="op" id="7925504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925508">const</span>&nbsp;<span class="ident" id="7925514">n</span>&nbsp;<span class="op" id="7925516">=</span>&nbsp;<span class="num" id="7925518">10</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925522">ch</span>&nbsp;<span class="op" id="7925525">:=</span>&nbsp;<span class="builtinfunc" id="7925528">make</span><span class="op" id="7925532">(</span><span class="keyword" id="7925533">chan</span>&nbsp;<span class="builtintype" id="7925538">error</span><span class="op" id="7925543">,</span>&nbsp;<span class="ident" id="7925545"><a href="/database/sql/sql_test.go.html#7925514">n</a></span><span class="op" id="7925546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925549">for</span>&nbsp;<span class="ident" id="7925553">i</span>&nbsp;<span class="op" id="7925555">:=</span>&nbsp;<span class="num" id="7925558">0</span><span class="op" id="7925559">;</span>&nbsp;<span class="ident" id="7925561"><a href="/database/sql/sql_test.go.html#7925553">i</a></span>&nbsp;<span class="op" id="7925563">&lt;</span>&nbsp;<span class="ident" id="7925565"><a href="/database/sql/sql_test.go.html#7925514">n</a></span><span class="op" id="7925566">;</span>&nbsp;<span class="ident" id="7925568"><a href="/database/sql/sql_test.go.html#7925553">i</a></span><span class="op" id="7925569">++</span>&nbsp;<span class="op" id="7925572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925576">go</span>&nbsp;<span class="keyword" id="7925579">func</span><span class="op" id="7925583">(</span><span class="op" id="7925584">)</span>&nbsp;<span class="op" id="7925586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925591">var</span>&nbsp;<span class="ident" id="7925595">age</span>&nbsp;<span class="builtintype" id="7925599">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925606">err</span>&nbsp;<span class="op" id="7925610">:=</span>&nbsp;<span class="ident" id="7925613"><a href="/database/sql/sql_test.go.html#7925383">stmt</a></span><span class="op" id="7925617">.</span><span class="ident" id="7925618">QueryRow</span><span class="op" id="7925626">(</span><span class="string" id="7925627">&#34;Alice&#34;</span><span class="op" id="7925634">)</span><span class="op" id="7925635">.</span><span class="ident" id="7925636">Scan</span><span class="op" id="7925640">(</span><span class="op" id="7925641">&amp;</span><span class="ident" id="7925642"><a href="/database/sql/sql_test.go.html#7925595">age</a></span><span class="op" id="7925645">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925650">if</span>&nbsp;<span class="ident" id="7925653"><a href="/database/sql/sql_test.go.html#7925606">err</a></span>&nbsp;<span class="op" id="7925657">==</span>&nbsp;<span class="ident" id="7925660">nil</span>&nbsp;<span class="op" id="7925664">&amp;&amp;</span>&nbsp;<span class="ident" id="7925667"><a href="/database/sql/sql_test.go.html#7925595">age</a></span>&nbsp;<span class="op" id="7925671">!=</span>&nbsp;<span class="num" id="7925674">1</span>&nbsp;<span class="op" id="7925676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925682"><a href="/database/sql/sql_test.go.html#7925606">err</a></span>&nbsp;<span class="op" id="7925686">=</span>&nbsp;<span class="ident" id="7925688"><a href="/database/sql/sql_test.go.html#7916639">fmt</a></span><span class="op" id="7925691">.</span><span class="ident" id="7925692">Errorf</span><span class="op" id="7925698">(</span><span class="string" id="7925699">&#34;unexpected&nbsp;age&nbsp;%d&#34;</span><span class="op" id="7925718">,</span>&nbsp;<span class="ident" id="7925720"><a href="/database/sql/sql_test.go.html#7925595">age</a></span><span class="op" id="7925723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925733"><a href="/database/sql/sql_test.go.html#7925522">ch</a></span>&nbsp;<span class="op" id="7925736">&lt;-</span>&nbsp;<span class="ident" id="7925739"><a href="/database/sql/sql_test.go.html#7925606">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925745">}</span><span class="op" id="7925746">(</span><span class="op" id="7925747">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925753">for</span>&nbsp;<span class="ident" id="7925757">i</span>&nbsp;<span class="op" id="7925759">:=</span>&nbsp;<span class="num" id="7925762">0</span><span class="op" id="7925763">;</span>&nbsp;<span class="ident" id="7925765"><a href="/database/sql/sql_test.go.html#7925757">i</a></span>&nbsp;<span class="op" id="7925767">&lt;</span>&nbsp;<span class="ident" id="7925769"><a href="/database/sql/sql_test.go.html#7925514">n</a></span><span class="op" id="7925770">;</span>&nbsp;<span class="ident" id="7925772"><a href="/database/sql/sql_test.go.html#7925757">i</a></span><span class="op" id="7925773">++</span>&nbsp;<span class="op" id="7925776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925780">if</span>&nbsp;<span class="ident" id="7925783">err</span>&nbsp;<span class="op" id="7925787">:=</span>&nbsp;<span class="op" id="7925790">&lt;-</span><span class="ident" id="7925792"><a href="/database/sql/sql_test.go.html#7925522">ch</a></span><span class="op" id="7925794">;</span>&nbsp;<span class="ident" id="7925796"><a href="/database/sql/sql_test.go.html#7925783">err</a></span>&nbsp;<span class="op" id="7925800">!=</span>&nbsp;<span class="ident" id="7925803">nil</span>&nbsp;<span class="op" id="7925807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925812"><a href="/database/sql/sql_test.go.html#7925314">t</a></span><span class="op" id="7925813">.</span><span class="ident" id="7925814">Error</span><span class="op" id="7925819">(</span><span class="ident" id="7925820"><a href="/database/sql/sql_test.go.html#7925783">err</a></span><span class="op" id="7925823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925827">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7925830">}</span><br>
<span class="lineno"></span><span class="op" id="7925832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7925835">//&nbsp;just&nbsp;a&nbsp;test&nbsp;of&nbsp;fakedb&nbsp;itself</span><br>
<span class="lineno"></span><span class="keyword" id="7925867">func</span>&nbsp;<span class="ident" id="7925872">TestBogusPreboundParameters</span><span class="op" id="7925899">(</span><span class="ident" id="7925900">t</span>&nbsp;<span class="op" id="7925902">*</span><span class="ident" id="7925903"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7925910">.</span><span class="ident" id="7925911">T</span><span class="op" id="7925912">)</span>&nbsp;<span class="op" id="7925914">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925917">db</span>&nbsp;<span class="op" id="7925920">:=</span>&nbsp;<span class="ident" id="7925923"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7925932">(</span><span class="ident" id="7925933"><a href="/database/sql/sql_test.go.html#7925900">t</a></span><span class="op" id="7925934">,</span>&nbsp;<span class="string" id="7925936">&#34;foo&#34;</span><span class="op" id="7925941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7925944">defer</span>&nbsp;<span class="ident" id="7925950"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7925957">(</span><span class="ident" id="7925958"><a href="/database/sql/sql_test.go.html#7925900">t</a></span><span class="op" id="7925959">,</span>&nbsp;<span class="ident" id="7925961"><a href="/database/sql/sql_test.go.html#7925917">db</a></span><span class="op" id="7925963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7925966"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7925970">(</span><span class="ident" id="7925971"><a href="/database/sql/sql_test.go.html#7925900">t</a></span><span class="op" id="7925972">,</span>&nbsp;<span class="ident" id="7925974"><a href="/database/sql/sql_test.go.html#7925917">db</a></span><span class="op" id="7925976">,</span>&nbsp;<span class="string" id="7925978">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7926021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926024">_</span><span class="op" id="7926025">,</span>&nbsp;<span class="ident" id="7926027">err</span>&nbsp;<span class="op" id="7926031">:=</span>&nbsp;<span class="ident" id="7926034"><a href="/database/sql/sql_test.go.html#7925917">db</a></span><span class="op" id="7926036">.</span><span class="ident" id="7926037">Prepare</span><span class="op" id="7926044">(</span><span class="string" id="7926045">&#34;INSERT|t1|name=?,age=bogusconversion&#34;</span><span class="op" id="7926083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926086">if</span>&nbsp;<span class="ident" id="7926089"><a href="/database/sql/sql_test.go.html#7926027">err</a></span>&nbsp;<span class="op" id="7926093">==</span>&nbsp;<span class="ident" id="7926096">nil</span>&nbsp;<span class="op" id="7926100">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926104"><a href="/database/sql/sql_test.go.html#7925900">t</a></span><span class="op" id="7926105">.</span><span class="ident" id="7926106">Fatalf</span><span class="op" id="7926112">(</span><span class="string" id="7926113">&#34;expected&nbsp;error&#34;</span><span class="op" id="7926129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926135">if</span>&nbsp;<span class="ident" id="7926138"><a href="/database/sql/sql_test.go.html#7926027">err</a></span><span class="op" id="7926141">.</span><span class="ident" id="7926142">Error</span><span class="op" id="7926147">(</span><span class="op" id="7926148">)</span>&nbsp;<span class="op" id="7926150">!=</span>&nbsp;<span class="string" id="7926153">`fakedb:&nbsp;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;&#34;bogusconversion&#34;`</span>&nbsp;<span class="op" id="7926214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926218"><a href="/database/sql/sql_test.go.html#7925900">t</a></span><span class="op" id="7926219">.</span><span class="ident" id="7926220">Errorf</span><span class="op" id="7926226">(</span><span class="string" id="7926227">&#34;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7926249">,</span>&nbsp;<span class="ident" id="7926251"><a href="/database/sql/sql_test.go.html#7926027">err</a></span><span class="op" id="7926254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926257">}</span><br>
<span class="lineno">400</span><span class="op" id="7926259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7926262">func</span>&nbsp;<span class="ident" id="7926267">TestExec</span><span class="op" id="7926275">(</span><span class="ident" id="7926276">t</span>&nbsp;<span class="op" id="7926278">*</span><span class="ident" id="7926279"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7926286">.</span><span class="ident" id="7926287">T</span><span class="op" id="7926288">)</span>&nbsp;<span class="op" id="7926290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926293">db</span>&nbsp;<span class="op" id="7926296">:=</span>&nbsp;<span class="ident" id="7926299"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7926308">(</span><span class="ident" id="7926309"><a href="/database/sql/sql_test.go.html#7926276">t</a></span><span class="op" id="7926310">,</span>&nbsp;<span class="string" id="7926312">&#34;foo&#34;</span><span class="op" id="7926317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926320">defer</span>&nbsp;<span class="ident" id="7926326"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7926333">(</span><span class="ident" id="7926334"><a href="/database/sql/sql_test.go.html#7926276">t</a></span><span class="op" id="7926335">,</span>&nbsp;<span class="ident" id="7926337"><a href="/database/sql/sql_test.go.html#7926293">db</a></span><span class="op" id="7926339">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926342"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7926346">(</span><span class="ident" id="7926347"><a href="/database/sql/sql_test.go.html#7926276">t</a></span><span class="op" id="7926348">,</span>&nbsp;<span class="ident" id="7926350"><a href="/database/sql/sql_test.go.html#7926293">db</a></span><span class="op" id="7926352">,</span>&nbsp;<span class="string" id="7926354">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7926397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926400">stmt</span><span class="op" id="7926404">,</span>&nbsp;<span class="ident" id="7926406">err</span>&nbsp;<span class="op" id="7926410">:=</span>&nbsp;<span class="ident" id="7926413"><a href="/database/sql/sql_test.go.html#7926293">db</a></span><span class="op" id="7926415">.</span><span class="ident" id="7926416">Prepare</span><span class="op" id="7926423">(</span><span class="string" id="7926424">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7926448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926451">if</span>&nbsp;<span class="ident" id="7926454"><a href="/database/sql/sql_test.go.html#7926406">err</a></span>&nbsp;<span class="op" id="7926458">!=</span>&nbsp;<span class="ident" id="7926461">nil</span>&nbsp;<span class="op" id="7926465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926469"><a href="/database/sql/sql_test.go.html#7926276">t</a></span><span class="op" id="7926470">.</span><span class="ident" id="7926471">Errorf</span><span class="op" id="7926477">(</span><span class="string" id="7926478">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7926498">,</span>&nbsp;<span class="ident" id="7926500"><a href="/database/sql/sql_test.go.html#7926400">stmt</a></span><span class="op" id="7926504">,</span>&nbsp;<span class="ident" id="7926506"><a href="/database/sql/sql_test.go.html#7926406">err</a></span><span class="op" id="7926509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926512">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926515">defer</span>&nbsp;<span class="ident" id="7926521"><a href="/database/sql/sql_test.go.html#7926400">stmt</a></span><span class="op" id="7926525">.</span><span class="ident" id="7926526">Close</span><span class="op" id="7926531">(</span><span class="op" id="7926532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7926536">type</span>&nbsp;<span class="ident" id="7926541">execTest</span>&nbsp;<span class="keyword" id="7926550">struct</span>&nbsp;<span class="op" id="7926557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926561">args</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7926569">[</span><span class="op" id="7926570">]</span><span class="keyword" id="7926571">interface</span><span class="op" id="7926580">{</span><span class="op" id="7926581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926585">wantErr</span>&nbsp;<span class="builtintype" id="7926593">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926604">execTests</span>&nbsp;<span class="op" id="7926614">:=</span>&nbsp;<span class="op" id="7926617">[</span><span class="op" id="7926618">]</span><span class="ident" id="7926619"><a href="/database/sql/sql_test.go.html#7926541">execTest</a></span><span class="op" id="7926627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7926631">//&nbsp;Okay:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926642">{</span><span class="op" id="7926643">[</span><span class="op" id="7926644">]</span><span class="keyword" id="7926645">interface</span><span class="op" id="7926654">{</span><span class="op" id="7926655">}</span><span class="op" id="7926656">{</span><span class="string" id="7926657">&#34;Brad&#34;</span><span class="op" id="7926663">,</span>&nbsp;<span class="num" id="7926665">31</span><span class="op" id="7926667">}</span><span class="op" id="7926668">,</span>&nbsp;<span class="string" id="7926670">&#34;&#34;</span><span class="op" id="7926672">}</span><span class="op" id="7926673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926677">{</span><span class="op" id="7926678">[</span><span class="op" id="7926679">]</span><span class="keyword" id="7926680">interface</span><span class="op" id="7926689">{</span><span class="op" id="7926690">}</span><span class="op" id="7926691">{</span><span class="string" id="7926692">&#34;Brad&#34;</span><span class="op" id="7926698">,</span>&nbsp;<span class="ident" id="7926700">int64</span><span class="op" id="7926705">(</span><span class="num" id="7926706">31</span><span class="op" id="7926708">)</span><span class="op" id="7926709">}</span><span class="op" id="7926710">,</span>&nbsp;<span class="string" id="7926712">&#34;&#34;</span><span class="op" id="7926714">}</span><span class="op" id="7926715">,</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926719">{</span><span class="op" id="7926720">[</span><span class="op" id="7926721">]</span><span class="keyword" id="7926722">interface</span><span class="op" id="7926731">{</span><span class="op" id="7926732">}</span><span class="op" id="7926733">{</span><span class="string" id="7926734">&#34;Bob&#34;</span><span class="op" id="7926739">,</span>&nbsp;<span class="string" id="7926741">&#34;32&#34;</span><span class="op" id="7926745">}</span><span class="op" id="7926746">,</span>&nbsp;<span class="string" id="7926748">&#34;&#34;</span><span class="op" id="7926750">}</span><span class="op" id="7926751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926755">{</span><span class="op" id="7926756">[</span><span class="op" id="7926757">]</span><span class="keyword" id="7926758">interface</span><span class="op" id="7926767">{</span><span class="op" id="7926768">}</span><span class="op" id="7926769">{</span><span class="num" id="7926770">7</span><span class="op" id="7926771">,</span>&nbsp;<span class="num" id="7926773">9</span><span class="op" id="7926774">}</span><span class="op" id="7926775">,</span>&nbsp;<span class="string" id="7926777">&#34;&#34;</span><span class="op" id="7926779">}</span><span class="op" id="7926780">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7926785">//&nbsp;Invalid&nbsp;conversions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926811">{</span><span class="op" id="7926812">[</span><span class="op" id="7926813">]</span><span class="keyword" id="7926814">interface</span><span class="op" id="7926823">{</span><span class="op" id="7926824">}</span><span class="op" id="7926825">{</span><span class="string" id="7926826">&#34;Brad&#34;</span><span class="op" id="7926832">,</span>&nbsp;<span class="ident" id="7926834">int64</span><span class="op" id="7926839">(</span><span class="num" id="7926840">0xFFFFFFFF</span><span class="op" id="7926850">)</span><span class="op" id="7926851">}</span><span class="op" id="7926852">,</span>&nbsp;<span class="string" id="7926854">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;4294967295&nbsp;overflows&nbsp;int32&#34;</span><span class="op" id="7926936">}</span><span class="op" id="7926937">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926941">{</span><span class="op" id="7926942">[</span><span class="op" id="7926943">]</span><span class="keyword" id="7926944">interface</span><span class="op" id="7926953">{</span><span class="op" id="7926954">}</span><span class="op" id="7926955">{</span><span class="string" id="7926956">&#34;Brad&#34;</span><span class="op" id="7926962">,</span>&nbsp;<span class="string" id="7926964">&#34;strconv&nbsp;fail&#34;</span><span class="op" id="7926978">}</span><span class="op" id="7926979">,</span>&nbsp;<span class="string" id="7926981">&#34;sql:&nbsp;converting&nbsp;argument&nbsp;#1&#39;s&nbsp;type:&nbsp;sql/driver:&nbsp;value&nbsp;\&#34;strconv&nbsp;fail\&#34;&nbsp;can&#39;t&nbsp;be&nbsp;converted&nbsp;to&nbsp;int32&#34;</span><span class="op" id="7927081">}</span><span class="op" id="7927082">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7927087">//&nbsp;Wrong&nbsp;number&nbsp;of&nbsp;args:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927114">{</span><span class="op" id="7927115">[</span><span class="op" id="7927116">]</span><span class="keyword" id="7927117">interface</span><span class="op" id="7927126">{</span><span class="op" id="7927127">}</span><span class="op" id="7927128">{</span><span class="op" id="7927129">}</span><span class="op" id="7927130">,</span>&nbsp;<span class="string" id="7927132">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;0&#34;</span><span class="op" id="7927166">}</span><span class="op" id="7927167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927171">{</span><span class="op" id="7927172">[</span><span class="op" id="7927173">]</span><span class="keyword" id="7927174">interface</span><span class="op" id="7927183">{</span><span class="op" id="7927184">}</span><span class="op" id="7927185">{</span><span class="num" id="7927186">1</span><span class="op" id="7927187">,</span>&nbsp;<span class="num" id="7927189">2</span><span class="op" id="7927190">,</span>&nbsp;<span class="num" id="7927192">3</span><span class="op" id="7927193">}</span><span class="op" id="7927194">,</span>&nbsp;<span class="string" id="7927196">&#34;sql:&nbsp;expected&nbsp;2&nbsp;arguments,&nbsp;got&nbsp;3&#34;</span><span class="op" id="7927230">}</span><span class="op" id="7927231">,</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927237">for</span>&nbsp;<span class="ident" id="7927241">n</span><span class="op" id="7927242">,</span>&nbsp;<span class="ident" id="7927244">et</span>&nbsp;<span class="op" id="7927247">:=</span>&nbsp;<span class="keyword" id="7927250">range</span>&nbsp;<span class="ident" id="7927256"><a href="/database/sql/sql_test.go.html#7926604">execTests</a></span>&nbsp;<span class="op" id="7927266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927270">_</span><span class="op" id="7927271">,</span>&nbsp;<span class="ident" id="7927273">err</span>&nbsp;<span class="op" id="7927277">:=</span>&nbsp;<span class="ident" id="7927280"><a href="/database/sql/sql_test.go.html#7926400">stmt</a></span><span class="op" id="7927284">.</span><span class="ident" id="7927285">Exec</span><span class="op" id="7927289">(</span><span class="ident" id="7927290"><a href="/database/sql/sql_test.go.html#7927244">et</a></span><span class="op" id="7927292">.</span><span class="ident" id="7927293">args</span><span class="op" id="7927297">...</span><span class="op" id="7927300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927304">errStr</span>&nbsp;<span class="op" id="7927311">:=</span>&nbsp;<span class="string" id="7927314">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927319">if</span>&nbsp;<span class="ident" id="7927322"><a href="/database/sql/sql_test.go.html#7927273">err</a></span>&nbsp;<span class="op" id="7927326">!=</span>&nbsp;<span class="ident" id="7927329">nil</span>&nbsp;<span class="op" id="7927333">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927338"><a href="/database/sql/sql_test.go.html#7927304">errStr</a></span>&nbsp;<span class="op" id="7927345">=</span>&nbsp;<span class="ident" id="7927347"><a href="/database/sql/sql_test.go.html#7927273">err</a></span><span class="op" id="7927350">.</span><span class="ident" id="7927351">Error</span><span class="op" id="7927356">(</span><span class="op" id="7927357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927365">if</span>&nbsp;<span class="ident" id="7927368"><a href="/database/sql/sql_test.go.html#7927304">errStr</a></span>&nbsp;<span class="op" id="7927375">!=</span>&nbsp;<span class="ident" id="7927378"><a href="/database/sql/sql_test.go.html#7927244">et</a></span><span class="op" id="7927380">.</span><span class="ident" id="7927381">wantErr</span>&nbsp;<span class="op" id="7927389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927394"><a href="/database/sql/sql_test.go.html#7926276">t</a></span><span class="op" id="7927395">.</span><span class="ident" id="7927396">Errorf</span><span class="op" id="7927402">(</span><span class="string" id="7927403">&#34;stmt.Execute&nbsp;#%d:&nbsp;for&nbsp;%v,&nbsp;got&nbsp;error&nbsp;%q,&nbsp;want&nbsp;error&nbsp;%q&#34;</span><span class="op" id="7927458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927464"><a href="/database/sql/sql_test.go.html#7927241">n</a></span><span class="op" id="7927465">,</span>&nbsp;<span class="ident" id="7927467"><a href="/database/sql/sql_test.go.html#7927244">et</a></span><span class="op" id="7927469">.</span><span class="ident" id="7927470">args</span><span class="op" id="7927474">,</span>&nbsp;<span class="ident" id="7927476"><a href="/database/sql/sql_test.go.html#7927304">errStr</a></span><span class="op" id="7927482">,</span>&nbsp;<span class="ident" id="7927484"><a href="/database/sql/sql_test.go.html#7927244">et</a></span><span class="op" id="7927486">.</span><span class="ident" id="7927487">wantErr</span><span class="op" id="7927494">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927501">}</span><br>
<span class="lineno"></span><span class="op" id="7927503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7927506">func</span>&nbsp;<span class="ident" id="7927511">TestTxPrepare</span><span class="op" id="7927524">(</span><span class="ident" id="7927525">t</span>&nbsp;<span class="op" id="7927527">*</span><span class="ident" id="7927528"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7927535">.</span><span class="ident" id="7927536">T</span><span class="op" id="7927537">)</span>&nbsp;<span class="op" id="7927539">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927542">db</span>&nbsp;<span class="op" id="7927545">:=</span>&nbsp;<span class="ident" id="7927548"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7927557">(</span><span class="ident" id="7927558"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927559">,</span>&nbsp;<span class="string" id="7927561">&#34;&#34;</span><span class="op" id="7927563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927566">defer</span>&nbsp;<span class="ident" id="7927572"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7927579">(</span><span class="ident" id="7927580"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927581">,</span>&nbsp;<span class="ident" id="7927583"><a href="/database/sql/sql_test.go.html#7927542">db</a></span><span class="op" id="7927585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927588"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7927592">(</span><span class="ident" id="7927593"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927594">,</span>&nbsp;<span class="ident" id="7927596"><a href="/database/sql/sql_test.go.html#7927542">db</a></span><span class="op" id="7927598">,</span>&nbsp;<span class="string" id="7927600">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7927643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927646">tx</span><span class="op" id="7927648">,</span>&nbsp;<span class="ident" id="7927650">err</span>&nbsp;<span class="op" id="7927654">:=</span>&nbsp;<span class="ident" id="7927657"><a href="/database/sql/sql_test.go.html#7927542">db</a></span><span class="op" id="7927659">.</span><span class="ident" id="7927660">Begin</span><span class="op" id="7927665">(</span><span class="op" id="7927666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927669">if</span>&nbsp;<span class="ident" id="7927672"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927676">!=</span>&nbsp;<span class="ident" id="7927679">nil</span>&nbsp;<span class="op" id="7927683">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927687"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927688">.</span><span class="ident" id="7927689">Fatalf</span><span class="op" id="7927695">(</span><span class="string" id="7927696">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7927708">,</span>&nbsp;<span class="ident" id="7927710"><a href="/database/sql/sql_test.go.html#7927650">err</a></span><span class="op" id="7927713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927719">stmt</span><span class="op" id="7927723">,</span>&nbsp;<span class="ident" id="7927725"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927729">:=</span>&nbsp;<span class="ident" id="7927732"><a href="/database/sql/sql_test.go.html#7927646">tx</a></span><span class="op" id="7927734">.</span><span class="ident" id="7927735">Prepare</span><span class="op" id="7927742">(</span><span class="string" id="7927743">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7927767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927770">if</span>&nbsp;<span class="ident" id="7927773"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927777">!=</span>&nbsp;<span class="ident" id="7927780">nil</span>&nbsp;<span class="op" id="7927784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927788"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927789">.</span><span class="ident" id="7927790">Fatalf</span><span class="op" id="7927796">(</span><span class="string" id="7927797">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7927817">,</span>&nbsp;<span class="ident" id="7927819"><a href="/database/sql/sql_test.go.html#7927719">stmt</a></span><span class="op" id="7927823">,</span>&nbsp;<span class="ident" id="7927825"><a href="/database/sql/sql_test.go.html#7927650">err</a></span><span class="op" id="7927828">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927834">defer</span>&nbsp;<span class="ident" id="7927840"><a href="/database/sql/sql_test.go.html#7927719">stmt</a></span><span class="op" id="7927844">.</span><span class="ident" id="7927845">Close</span><span class="op" id="7927850">(</span><span class="op" id="7927851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927854">_</span><span class="op" id="7927855">,</span>&nbsp;<span class="ident" id="7927857"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927861">=</span>&nbsp;<span class="ident" id="7927863"><a href="/database/sql/sql_test.go.html#7927719">stmt</a></span><span class="op" id="7927867">.</span><span class="ident" id="7927868">Exec</span><span class="op" id="7927872">(</span><span class="string" id="7927873">&#34;Bobby&#34;</span><span class="op" id="7927880">,</span>&nbsp;<span class="num" id="7927882">7</span><span class="op" id="7927883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927886">if</span>&nbsp;<span class="ident" id="7927889"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927893">!=</span>&nbsp;<span class="ident" id="7927896">nil</span>&nbsp;<span class="op" id="7927900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927904"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927905">.</span><span class="ident" id="7927906">Fatalf</span><span class="op" id="7927912">(</span><span class="string" id="7927913">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7927924">,</span>&nbsp;<span class="ident" id="7927926"><a href="/database/sql/sql_test.go.html#7927650">err</a></span><span class="op" id="7927929">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927935"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927939">=</span>&nbsp;<span class="ident" id="7927941"><a href="/database/sql/sql_test.go.html#7927646">tx</a></span><span class="op" id="7927943">.</span><span class="ident" id="7927944">Commit</span><span class="op" id="7927950">(</span><span class="op" id="7927951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927954">if</span>&nbsp;<span class="ident" id="7927957"><a href="/database/sql/sql_test.go.html#7927650">err</a></span>&nbsp;<span class="op" id="7927961">!=</span>&nbsp;<span class="ident" id="7927964">nil</span>&nbsp;<span class="op" id="7927968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927972"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7927973">.</span><span class="ident" id="7927974">Fatalf</span><span class="op" id="7927980">(</span><span class="string" id="7927981">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7927994">,</span>&nbsp;<span class="ident" id="7927996"><a href="/database/sql/sql_test.go.html#7927650">err</a></span><span class="op" id="7927999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928002">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928005">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928051">if</span>&nbsp;<span class="op" id="7928054">!</span><span class="ident" id="7928055"><a href="/database/sql/sql_test.go.html#7927719">stmt</a></span><span class="op" id="7928059">.</span><span class="ident" id="7928060">closed</span>&nbsp;<span class="op" id="7928067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928071"><a href="/database/sql/sql_test.go.html#7927525">t</a></span><span class="op" id="7928072">.</span><span class="ident" id="7928073">Fatal</span><span class="op" id="7928078">(</span><span class="string" id="7928079">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7928109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928112">}</span><br>
<span class="lineno"></span><span class="op" id="7928114">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="7928117">func</span>&nbsp;<span class="ident" id="7928122">TestTxStmt</span><span class="op" id="7928132">(</span><span class="ident" id="7928133">t</span>&nbsp;<span class="op" id="7928135">*</span><span class="ident" id="7928136"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7928143">.</span><span class="ident" id="7928144">T</span><span class="op" id="7928145">)</span>&nbsp;<span class="op" id="7928147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928150">db</span>&nbsp;<span class="op" id="7928153">:=</span>&nbsp;<span class="ident" id="7928156"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7928165">(</span><span class="ident" id="7928166"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928167">,</span>&nbsp;<span class="string" id="7928169">&#34;&#34;</span><span class="op" id="7928171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928174">defer</span>&nbsp;<span class="ident" id="7928180"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7928187">(</span><span class="ident" id="7928188"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928189">,</span>&nbsp;<span class="ident" id="7928191"><a href="/database/sql/sql_test.go.html#7928150">db</a></span><span class="op" id="7928193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928196"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7928200">(</span><span class="ident" id="7928201"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928202">,</span>&nbsp;<span class="ident" id="7928204"><a href="/database/sql/sql_test.go.html#7928150">db</a></span><span class="op" id="7928206">,</span>&nbsp;<span class="string" id="7928208">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7928251">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928254">stmt</span><span class="op" id="7928258">,</span>&nbsp;<span class="ident" id="7928260">err</span>&nbsp;<span class="op" id="7928264">:=</span>&nbsp;<span class="ident" id="7928267"><a href="/database/sql/sql_test.go.html#7928150">db</a></span><span class="op" id="7928269">.</span><span class="ident" id="7928270">Prepare</span><span class="op" id="7928277">(</span><span class="string" id="7928278">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7928302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928305">if</span>&nbsp;<span class="ident" id="7928308"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928312">!=</span>&nbsp;<span class="ident" id="7928315">nil</span>&nbsp;<span class="op" id="7928319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928323"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928324">.</span><span class="ident" id="7928325">Fatalf</span><span class="op" id="7928331">(</span><span class="string" id="7928332">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7928352">,</span>&nbsp;<span class="ident" id="7928354"><a href="/database/sql/sql_test.go.html#7928254">stmt</a></span><span class="op" id="7928358">,</span>&nbsp;<span class="ident" id="7928360"><a href="/database/sql/sql_test.go.html#7928260">err</a></span><span class="op" id="7928363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928369">defer</span>&nbsp;<span class="ident" id="7928375"><a href="/database/sql/sql_test.go.html#7928254">stmt</a></span><span class="op" id="7928379">.</span><span class="ident" id="7928380">Close</span><span class="op" id="7928385">(</span><span class="op" id="7928386">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928389">tx</span><span class="op" id="7928391">,</span>&nbsp;<span class="ident" id="7928393"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928397">:=</span>&nbsp;<span class="ident" id="7928400"><a href="/database/sql/sql_test.go.html#7928150">db</a></span><span class="op" id="7928402">.</span><span class="ident" id="7928403">Begin</span><span class="op" id="7928408">(</span><span class="op" id="7928409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928412">if</span>&nbsp;<span class="ident" id="7928415"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928419">!=</span>&nbsp;<span class="ident" id="7928422">nil</span>&nbsp;<span class="op" id="7928426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928430"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928431">.</span><span class="ident" id="7928432">Fatalf</span><span class="op" id="7928438">(</span><span class="string" id="7928439">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7928451">,</span>&nbsp;<span class="ident" id="7928453"><a href="/database/sql/sql_test.go.html#7928260">err</a></span><span class="op" id="7928456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928462">txs</span>&nbsp;<span class="op" id="7928466">:=</span>&nbsp;<span class="ident" id="7928469"><a href="/database/sql/sql_test.go.html#7928389">tx</a></span><span class="op" id="7928471">.</span><span class="ident" id="7928472">Stmt</span><span class="op" id="7928476">(</span><span class="ident" id="7928477"><a href="/database/sql/sql_test.go.html#7928254">stmt</a></span><span class="op" id="7928481">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928484">defer</span>&nbsp;<span class="ident" id="7928490"><a href="/database/sql/sql_test.go.html#7928462">txs</a></span><span class="op" id="7928493">.</span><span class="ident" id="7928494">Close</span><span class="op" id="7928499">(</span><span class="op" id="7928500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928503">_</span><span class="op" id="7928504">,</span>&nbsp;<span class="ident" id="7928506"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928510">=</span>&nbsp;<span class="ident" id="7928512"><a href="/database/sql/sql_test.go.html#7928462">txs</a></span><span class="op" id="7928515">.</span><span class="ident" id="7928516">Exec</span><span class="op" id="7928520">(</span><span class="string" id="7928521">&#34;Bobby&#34;</span><span class="op" id="7928528">,</span>&nbsp;<span class="num" id="7928530">7</span><span class="op" id="7928531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928534">if</span>&nbsp;<span class="ident" id="7928537"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928541">!=</span>&nbsp;<span class="ident" id="7928544">nil</span>&nbsp;<span class="op" id="7928548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928552"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928553">.</span><span class="ident" id="7928554">Fatalf</span><span class="op" id="7928560">(</span><span class="string" id="7928561">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7928572">,</span>&nbsp;<span class="ident" id="7928574"><a href="/database/sql/sql_test.go.html#7928260">err</a></span><span class="op" id="7928577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928580">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928583"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928587">=</span>&nbsp;<span class="ident" id="7928589"><a href="/database/sql/sql_test.go.html#7928389">tx</a></span><span class="op" id="7928591">.</span><span class="ident" id="7928592">Commit</span><span class="op" id="7928598">(</span><span class="op" id="7928599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928602">if</span>&nbsp;<span class="ident" id="7928605"><a href="/database/sql/sql_test.go.html#7928260">err</a></span>&nbsp;<span class="op" id="7928609">!=</span>&nbsp;<span class="ident" id="7928612">nil</span>&nbsp;<span class="op" id="7928616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928620"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928621">.</span><span class="ident" id="7928622">Fatalf</span><span class="op" id="7928628">(</span><span class="string" id="7928629">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7928642">,</span>&nbsp;<span class="ident" id="7928644"><a href="/database/sql/sql_test.go.html#7928260">err</a></span><span class="op" id="7928647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7928653">//&nbsp;Commit()&nbsp;should&nbsp;have&nbsp;closed&nbsp;the&nbsp;statement</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928699">if</span>&nbsp;<span class="op" id="7928702">!</span><span class="ident" id="7928703"><a href="/database/sql/sql_test.go.html#7928462">txs</a></span><span class="op" id="7928706">.</span><span class="ident" id="7928707">closed</span>&nbsp;<span class="op" id="7928714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928718"><a href="/database/sql/sql_test.go.html#7928133">t</a></span><span class="op" id="7928719">.</span><span class="ident" id="7928720">Fatal</span><span class="op" id="7928725">(</span><span class="string" id="7928726">&#34;Stmt&nbsp;not&nbsp;closed&nbsp;after&nbsp;Commit&#34;</span><span class="op" id="7928756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928759">}</span><br>
<span class="lineno"></span><span class="op" id="7928761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="comment" id="7928764">//&nbsp;Issue:&nbsp;http://golang.org/issue/2784</span><br>
<span class="lineno"></span><span class="comment" id="7928803">//&nbsp;This&nbsp;test&nbsp;didn&#39;t&nbsp;fail&nbsp;before&nbsp;because&nbsp;we&nbsp;got&nbsp;lucky&nbsp;with&nbsp;the&nbsp;fakedb&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="7928880">//&nbsp;It&nbsp;was&nbsp;failing,&nbsp;and&nbsp;now&nbsp;not,&nbsp;in&nbsp;github.com/bradfitz/go-sql-test</span><br>
<span class="lineno"></span><span class="keyword" id="7928947">func</span>&nbsp;<span class="ident" id="7928952">TestTxQuery</span><span class="op" id="7928963">(</span><span class="ident" id="7928964">t</span>&nbsp;<span class="op" id="7928966">*</span><span class="ident" id="7928967"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7928974">.</span><span class="ident" id="7928975">T</span><span class="op" id="7928976">)</span>&nbsp;<span class="op" id="7928978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928981">db</span>&nbsp;<span class="op" id="7928984">:=</span>&nbsp;<span class="ident" id="7928987"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7928996">(</span><span class="ident" id="7928997"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7928998">,</span>&nbsp;<span class="string" id="7929000">&#34;&#34;</span><span class="op" id="7929002">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929005">defer</span>&nbsp;<span class="ident" id="7929011"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7929018">(</span><span class="ident" id="7929019"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929020">,</span>&nbsp;<span class="ident" id="7929022"><a href="/database/sql/sql_test.go.html#7928981">db</a></span><span class="op" id="7929024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929027"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7929031">(</span><span class="ident" id="7929032"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929033">,</span>&nbsp;<span class="ident" id="7929035"><a href="/database/sql/sql_test.go.html#7928981">db</a></span><span class="op" id="7929037">,</span>&nbsp;<span class="string" id="7929039">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7929082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929085"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7929089">(</span><span class="ident" id="7929090"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929091">,</span>&nbsp;<span class="ident" id="7929093"><a href="/database/sql/sql_test.go.html#7928981">db</a></span><span class="op" id="7929095">,</span>&nbsp;<span class="string" id="7929097">&#34;INSERT|t1|name=Alice&#34;</span><span class="op" id="7929119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929123">tx</span><span class="op" id="7929125">,</span>&nbsp;<span class="ident" id="7929127">err</span>&nbsp;<span class="op" id="7929131">:=</span>&nbsp;<span class="ident" id="7929134"><a href="/database/sql/sql_test.go.html#7928981">db</a></span><span class="op" id="7929136">.</span><span class="ident" id="7929137">Begin</span><span class="op" id="7929142">(</span><span class="op" id="7929143">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929146">if</span>&nbsp;<span class="ident" id="7929149"><a href="/database/sql/sql_test.go.html#7929127">err</a></span>&nbsp;<span class="op" id="7929153">!=</span>&nbsp;<span class="ident" id="7929156">nil</span>&nbsp;<span class="op" id="7929160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929164"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929165">.</span><span class="ident" id="7929166">Fatal</span><span class="op" id="7929171">(</span><span class="ident" id="7929172"><a href="/database/sql/sql_test.go.html#7929127">err</a></span><span class="op" id="7929175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929181">defer</span>&nbsp;<span class="ident" id="7929187"><a href="/database/sql/sql_test.go.html#7929123">tx</a></span><span class="op" id="7929189">.</span><span class="ident" id="7929190">Rollback</span><span class="op" id="7929198">(</span><span class="op" id="7929199">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929203">r</span><span class="op" id="7929204">,</span>&nbsp;<span class="ident" id="7929206"><a href="/database/sql/sql_test.go.html#7929127">err</a></span>&nbsp;<span class="op" id="7929210">:=</span>&nbsp;<span class="ident" id="7929213"><a href="/database/sql/sql_test.go.html#7929123">tx</a></span><span class="op" id="7929215">.</span><span class="ident" id="7929216">Query</span><span class="op" id="7929221">(</span><span class="string" id="7929222">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7929239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929242">if</span>&nbsp;<span class="ident" id="7929245"><a href="/database/sql/sql_test.go.html#7929127">err</a></span>&nbsp;<span class="op" id="7929249">!=</span>&nbsp;<span class="ident" id="7929252">nil</span>&nbsp;<span class="op" id="7929256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929260"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929261">.</span><span class="ident" id="7929262">Fatal</span><span class="op" id="7929267">(</span><span class="ident" id="7929268"><a href="/database/sql/sql_test.go.html#7929127">err</a></span><span class="op" id="7929271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929277">defer</span>&nbsp;<span class="ident" id="7929283"><a href="/database/sql/sql_test.go.html#7929203">r</a></span><span class="op" id="7929284">.</span><span class="ident" id="7929285">Close</span><span class="op" id="7929290">(</span><span class="op" id="7929291">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929295">if</span>&nbsp;<span class="op" id="7929298">!</span><span class="ident" id="7929299"><a href="/database/sql/sql_test.go.html#7929203">r</a></span><span class="op" id="7929300">.</span><span class="ident" id="7929301">Next</span><span class="op" id="7929305">(</span><span class="op" id="7929306">)</span>&nbsp;<span class="op" id="7929308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929312">if</span>&nbsp;<span class="ident" id="7929315"><a href="/database/sql/sql_test.go.html#7929203">r</a></span><span class="op" id="7929316">.</span><span class="ident" id="7929317">Err</span><span class="op" id="7929320">(</span><span class="op" id="7929321">)</span>&nbsp;<span class="op" id="7929323">!=</span>&nbsp;<span class="ident" id="7929326">nil</span>&nbsp;<span class="op" id="7929330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929335"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929336">.</span><span class="ident" id="7929337">Fatal</span><span class="op" id="7929342">(</span><span class="ident" id="7929343"><a href="/database/sql/sql_test.go.html#7929203">r</a></span><span class="op" id="7929344">.</span><span class="ident" id="7929345">Err</span><span class="op" id="7929348">(</span><span class="op" id="7929349">)</span><span class="op" id="7929350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929354">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929358"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929359">.</span><span class="ident" id="7929360">Fatal</span><span class="op" id="7929365">(</span><span class="string" id="7929366">&#34;expected&nbsp;one&nbsp;row&#34;</span><span class="op" id="7929384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929391">var</span>&nbsp;<span class="ident" id="7929395">x</span>&nbsp;<span class="builtintype" id="7929397">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929405"><a href="/database/sql/sql_test.go.html#7929127">err</a></span>&nbsp;<span class="op" id="7929409">=</span>&nbsp;<span class="ident" id="7929411"><a href="/database/sql/sql_test.go.html#7929203">r</a></span><span class="op" id="7929412">.</span><span class="ident" id="7929413">Scan</span><span class="op" id="7929417">(</span><span class="op" id="7929418">&amp;</span><span class="ident" id="7929419"><a href="/database/sql/sql_test.go.html#7929395">x</a></span><span class="op" id="7929420">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929423">if</span>&nbsp;<span class="ident" id="7929426"><a href="/database/sql/sql_test.go.html#7929127">err</a></span>&nbsp;<span class="op" id="7929430">!=</span>&nbsp;<span class="ident" id="7929433">nil</span>&nbsp;<span class="op" id="7929437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929441"><a href="/database/sql/sql_test.go.html#7928964">t</a></span><span class="op" id="7929442">.</span><span class="ident" id="7929443">Fatal</span><span class="op" id="7929448">(</span><span class="ident" id="7929449"><a href="/database/sql/sql_test.go.html#7929127">err</a></span><span class="op" id="7929452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929455">}</span><br>
<span class="lineno"></span><span class="op" id="7929457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7929460">func</span>&nbsp;<span class="ident" id="7929465">TestTxQueryInvalid</span><span class="op" id="7929483">(</span><span class="ident" id="7929484">t</span>&nbsp;<span class="op" id="7929486">*</span><span class="ident" id="7929487"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7929494">.</span><span class="ident" id="7929495">T</span><span class="op" id="7929496">)</span>&nbsp;<span class="op" id="7929498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929501">db</span>&nbsp;<span class="op" id="7929504">:=</span>&nbsp;<span class="ident" id="7929507"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7929516">(</span><span class="ident" id="7929517"><a href="/database/sql/sql_test.go.html#7929484">t</a></span><span class="op" id="7929518">,</span>&nbsp;<span class="string" id="7929520">&#34;&#34;</span><span class="op" id="7929522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929525">defer</span>&nbsp;<span class="ident" id="7929531"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7929538">(</span><span class="ident" id="7929539"><a href="/database/sql/sql_test.go.html#7929484">t</a></span><span class="op" id="7929540">,</span>&nbsp;<span class="ident" id="7929542"><a href="/database/sql/sql_test.go.html#7929501">db</a></span><span class="op" id="7929544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929548">tx</span><span class="op" id="7929550">,</span>&nbsp;<span class="ident" id="7929552">err</span>&nbsp;<span class="op" id="7929556">:=</span>&nbsp;<span class="ident" id="7929559"><a href="/database/sql/sql_test.go.html#7929501">db</a></span><span class="op" id="7929561">.</span><span class="ident" id="7929562">Begin</span><span class="op" id="7929567">(</span><span class="op" id="7929568">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929571">if</span>&nbsp;<span class="ident" id="7929574"><a href="/database/sql/sql_test.go.html#7929552">err</a></span>&nbsp;<span class="op" id="7929578">!=</span>&nbsp;<span class="ident" id="7929581">nil</span>&nbsp;<span class="op" id="7929585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929589"><a href="/database/sql/sql_test.go.html#7929484">t</a></span><span class="op" id="7929590">.</span><span class="ident" id="7929591">Fatal</span><span class="op" id="7929596">(</span><span class="ident" id="7929597"><a href="/database/sql/sql_test.go.html#7929552">err</a></span><span class="op" id="7929600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929606">defer</span>&nbsp;<span class="ident" id="7929612"><a href="/database/sql/sql_test.go.html#7929548">tx</a></span><span class="op" id="7929614">.</span><span class="ident" id="7929615">Rollback</span><span class="op" id="7929623">(</span><span class="op" id="7929624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929628">_</span><span class="op" id="7929629">,</span>&nbsp;<span class="ident" id="7929631"><a href="/database/sql/sql_test.go.html#7929552">err</a></span>&nbsp;<span class="op" id="7929635">=</span>&nbsp;<span class="ident" id="7929637"><a href="/database/sql/sql_test.go.html#7929548">tx</a></span><span class="op" id="7929639">.</span><span class="ident" id="7929640">Query</span><span class="op" id="7929645">(</span><span class="string" id="7929646">&#34;SELECT|t1|name|&#34;</span><span class="op" id="7929663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929666">if</span>&nbsp;<span class="ident" id="7929669"><a href="/database/sql/sql_test.go.html#7929552">err</a></span>&nbsp;<span class="op" id="7929673">==</span>&nbsp;<span class="ident" id="7929676">nil</span>&nbsp;<span class="op" id="7929680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929684"><a href="/database/sql/sql_test.go.html#7929484">t</a></span><span class="op" id="7929685">.</span><span class="ident" id="7929686">Fatal</span><span class="op" id="7929691">(</span><span class="string" id="7929692">&#34;Error&nbsp;expected&#34;</span><span class="op" id="7929708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929711">}</span><br>
<span class="lineno"></span><span class="op" id="7929713">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7929716">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;4433,&nbsp;that&nbsp;retries&nbsp;in&nbsp;Begin&nbsp;happen&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="7929779">//&nbsp;conn.Begin()&nbsp;returns&nbsp;ErrBadConn</span><br>
<span class="lineno"></span><span class="keyword" id="7929814">func</span>&nbsp;<span class="ident" id="7929819">TestTxErrBadConn</span><span class="op" id="7929835">(</span><span class="ident" id="7929836">t</span>&nbsp;<span class="op" id="7929838">*</span><span class="ident" id="7929839"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7929846">.</span><span class="ident" id="7929847">T</span><span class="op" id="7929848">)</span>&nbsp;<span class="op" id="7929850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929853">db</span><span class="op" id="7929855">,</span>&nbsp;<span class="ident" id="7929857">err</span>&nbsp;<span class="op" id="7929861">:=</span>&nbsp;<span class="ident" id="7929864"><a href="/database/sql/sql.go.html#5755024">Open</a></span><span class="op" id="7929868">(</span><span class="string" id="7929869">&#34;test&#34;</span><span class="op" id="7929875">,</span>&nbsp;<span class="ident" id="7929877"><a href="/database/sql/sql_test.go.html#7917346">fakeDBName</a></span><span class="op" id="7929887">+</span><span class="string" id="7929888">&#34;;badConn&#34;</span><span class="op" id="7929898">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929901">if</span>&nbsp;<span class="ident" id="7929904"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7929908">!=</span>&nbsp;<span class="ident" id="7929911">nil</span>&nbsp;<span class="op" id="7929915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929919"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7929920">.</span><span class="ident" id="7929921">Fatalf</span><span class="op" id="7929927">(</span><span class="string" id="7929928">&#34;Open:&nbsp;%v&#34;</span><span class="op" id="7929938">,</span>&nbsp;<span class="ident" id="7929940"><a href="/database/sql/sql_test.go.html#7929857">err</a></span><span class="op" id="7929943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7929949">if</span>&nbsp;<span class="ident" id="7929952">_</span><span class="op" id="7929953">,</span>&nbsp;<span class="ident" id="7929955">err</span>&nbsp;<span class="op" id="7929959">:=</span>&nbsp;<span class="ident" id="7929962"><a href="/database/sql/sql_test.go.html#7929853">db</a></span><span class="op" id="7929964">.</span><span class="ident" id="7929965">Exec</span><span class="op" id="7929969">(</span><span class="string" id="7929970">&#34;WIPE&#34;</span><span class="op" id="7929976">)</span><span class="op" id="7929977">;</span>&nbsp;<span class="ident" id="7929979"><a href="/database/sql/sql_test.go.html#7929955">err</a></span>&nbsp;<span class="op" id="7929983">!=</span>&nbsp;<span class="ident" id="7929986">nil</span>&nbsp;<span class="op" id="7929990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929994"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7929995">.</span><span class="ident" id="7929996">Fatalf</span><span class="op" id="7930002">(</span><span class="string" id="7930003">&#34;exec&nbsp;wipe:&nbsp;%v&#34;</span><span class="op" id="7930018">,</span>&nbsp;<span class="ident" id="7930020"><a href="/database/sql/sql_test.go.html#7929955">err</a></span><span class="op" id="7930023">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930029">defer</span>&nbsp;<span class="ident" id="7930035"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7930042">(</span><span class="ident" id="7930043"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930044">,</span>&nbsp;<span class="ident" id="7930046"><a href="/database/sql/sql_test.go.html#7929853">db</a></span><span class="op" id="7930048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930051"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7930055">(</span><span class="ident" id="7930056"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930057">,</span>&nbsp;<span class="ident" id="7930059"><a href="/database/sql/sql_test.go.html#7929853">db</a></span><span class="op" id="7930061">,</span>&nbsp;<span class="string" id="7930063">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7930106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930109">stmt</span><span class="op" id="7930113">,</span>&nbsp;<span class="ident" id="7930115"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930119">:=</span>&nbsp;<span class="ident" id="7930122"><a href="/database/sql/sql_test.go.html#7929853">db</a></span><span class="op" id="7930124">.</span><span class="ident" id="7930125">Prepare</span><span class="op" id="7930132">(</span><span class="string" id="7930133">&#34;INSERT|t1|name=?,age=?&#34;</span><span class="op" id="7930157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930160">if</span>&nbsp;<span class="ident" id="7930163"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930167">!=</span>&nbsp;<span class="ident" id="7930170">nil</span>&nbsp;<span class="op" id="7930174">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930178"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930179">.</span><span class="ident" id="7930180">Fatalf</span><span class="op" id="7930186">(</span><span class="string" id="7930187">&#34;Stmt,&nbsp;err&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7930207">,</span>&nbsp;<span class="ident" id="7930209"><a href="/database/sql/sql_test.go.html#7930109">stmt</a></span><span class="op" id="7930213">,</span>&nbsp;<span class="ident" id="7930215"><a href="/database/sql/sql_test.go.html#7929857">err</a></span><span class="op" id="7930218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930224">defer</span>&nbsp;<span class="ident" id="7930230"><a href="/database/sql/sql_test.go.html#7930109">stmt</a></span><span class="op" id="7930234">.</span><span class="ident" id="7930235">Close</span><span class="op" id="7930240">(</span><span class="op" id="7930241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930244">tx</span><span class="op" id="7930246">,</span>&nbsp;<span class="ident" id="7930248"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930252">:=</span>&nbsp;<span class="ident" id="7930255"><a href="/database/sql/sql_test.go.html#7929853">db</a></span><span class="op" id="7930257">.</span><span class="ident" id="7930258">Begin</span><span class="op" id="7930263">(</span><span class="op" id="7930264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930267">if</span>&nbsp;<span class="ident" id="7930270"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930274">!=</span>&nbsp;<span class="ident" id="7930277">nil</span>&nbsp;<span class="op" id="7930281">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930285"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930286">.</span><span class="ident" id="7930287">Fatalf</span><span class="op" id="7930293">(</span><span class="string" id="7930294">&#34;Begin&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7930306">,</span>&nbsp;<span class="ident" id="7930308"><a href="/database/sql/sql_test.go.html#7929857">err</a></span><span class="op" id="7930311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930317">txs</span>&nbsp;<span class="op" id="7930321">:=</span>&nbsp;<span class="ident" id="7930324"><a href="/database/sql/sql_test.go.html#7930244">tx</a></span><span class="op" id="7930326">.</span><span class="ident" id="7930327">Stmt</span><span class="op" id="7930331">(</span><span class="ident" id="7930332"><a href="/database/sql/sql_test.go.html#7930109">stmt</a></span><span class="op" id="7930336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930339">defer</span>&nbsp;<span class="ident" id="7930345"><a href="/database/sql/sql_test.go.html#7930317">txs</a></span><span class="op" id="7930348">.</span><span class="ident" id="7930349">Close</span><span class="op" id="7930354">(</span><span class="op" id="7930355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930358">_</span><span class="op" id="7930359">,</span>&nbsp;<span class="ident" id="7930361"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930365">=</span>&nbsp;<span class="ident" id="7930367"><a href="/database/sql/sql_test.go.html#7930317">txs</a></span><span class="op" id="7930370">.</span><span class="ident" id="7930371">Exec</span><span class="op" id="7930375">(</span><span class="string" id="7930376">&#34;Bobby&#34;</span><span class="op" id="7930383">,</span>&nbsp;<span class="num" id="7930385">7</span><span class="op" id="7930386">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930389">if</span>&nbsp;<span class="ident" id="7930392"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930396">!=</span>&nbsp;<span class="ident" id="7930399">nil</span>&nbsp;<span class="op" id="7930403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930407"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930408">.</span><span class="ident" id="7930409">Fatalf</span><span class="op" id="7930415">(</span><span class="string" id="7930416">&#34;Exec&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7930427">,</span>&nbsp;<span class="ident" id="7930429"><a href="/database/sql/sql_test.go.html#7929857">err</a></span><span class="op" id="7930432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930438"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930442">=</span>&nbsp;<span class="ident" id="7930444"><a href="/database/sql/sql_test.go.html#7930244">tx</a></span><span class="op" id="7930446">.</span><span class="ident" id="7930447">Commit</span><span class="op" id="7930453">(</span><span class="op" id="7930454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930457">if</span>&nbsp;<span class="ident" id="7930460"><a href="/database/sql/sql_test.go.html#7929857">err</a></span>&nbsp;<span class="op" id="7930464">!=</span>&nbsp;<span class="ident" id="7930467">nil</span>&nbsp;<span class="op" id="7930471">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930475"><a href="/database/sql/sql_test.go.html#7929836">t</a></span><span class="op" id="7930476">.</span><span class="ident" id="7930477">Fatalf</span><span class="op" id="7930483">(</span><span class="string" id="7930484">&#34;Commit&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7930497">,</span>&nbsp;<span class="ident" id="7930499"><a href="/database/sql/sql_test.go.html#7929857">err</a></span><span class="op" id="7930502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930505">}</span><br>
<span class="lineno"></span><span class="op" id="7930507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7930510">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2542,&nbsp;that&nbsp;we&nbsp;release&nbsp;a&nbsp;lock&nbsp;when&nbsp;querying&nbsp;on</span><br>
<span class="lineno">585</span><span class="comment" id="7930579">//&nbsp;a&nbsp;closed&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="7930603">func</span>&nbsp;<span class="ident" id="7930608">TestIssue2542Deadlock</span><span class="op" id="7930629">(</span><span class="ident" id="7930630">t</span>&nbsp;<span class="op" id="7930632">*</span><span class="ident" id="7930633"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7930640">.</span><span class="ident" id="7930641">T</span><span class="op" id="7930642">)</span>&nbsp;<span class="op" id="7930644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930647">db</span>&nbsp;<span class="op" id="7930650">:=</span>&nbsp;<span class="ident" id="7930653"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7930662">(</span><span class="ident" id="7930663"><a href="/database/sql/sql_test.go.html#7930630">t</a></span><span class="op" id="7930664">,</span>&nbsp;<span class="string" id="7930666">&#34;people&#34;</span><span class="op" id="7930674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930677"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7930684">(</span><span class="ident" id="7930685"><a href="/database/sql/sql_test.go.html#7930630">t</a></span><span class="op" id="7930686">,</span>&nbsp;<span class="ident" id="7930688"><a href="/database/sql/sql_test.go.html#7930647">db</a></span><span class="op" id="7930690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930693">for</span>&nbsp;<span class="ident" id="7930697">i</span>&nbsp;<span class="op" id="7930699">:=</span>&nbsp;<span class="num" id="7930702">0</span><span class="op" id="7930703">;</span>&nbsp;<span class="ident" id="7930705"><a href="/database/sql/sql_test.go.html#7930697">i</a></span>&nbsp;<span class="op" id="7930707">&lt;</span>&nbsp;<span class="num" id="7930709">2</span><span class="op" id="7930710">;</span>&nbsp;<span class="ident" id="7930712"><a href="/database/sql/sql_test.go.html#7930697">i</a></span><span class="op" id="7930713">++</span>&nbsp;<span class="op" id="7930716">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930720">_</span><span class="op" id="7930721">,</span>&nbsp;<span class="ident" id="7930723">err</span>&nbsp;<span class="op" id="7930727">:=</span>&nbsp;<span class="ident" id="7930730"><a href="/database/sql/sql_test.go.html#7930647">db</a></span><span class="op" id="7930732">.</span><span class="ident" id="7930733">Query</span><span class="op" id="7930738">(</span><span class="string" id="7930739">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7930764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930768">if</span>&nbsp;<span class="ident" id="7930771"><a href="/database/sql/sql_test.go.html#7930723">err</a></span>&nbsp;<span class="op" id="7930775">==</span>&nbsp;<span class="ident" id="7930778">nil</span>&nbsp;<span class="op" id="7930782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930787"><a href="/database/sql/sql_test.go.html#7930630">t</a></span><span class="op" id="7930788">.</span><span class="ident" id="7930789">Fatalf</span><span class="op" id="7930795">(</span><span class="string" id="7930796">&#34;expected&nbsp;error&#34;</span><span class="op" id="7930812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7930819">}</span><br>
<span class="lineno">595</span><span class="op" id="7930821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7930824">//&nbsp;From&nbsp;golang.org/issue/3865</span><br>
<span class="lineno"></span><span class="keyword" id="7930854">func</span>&nbsp;<span class="ident" id="7930859">TestCloseStmtBeforeRows</span><span class="op" id="7930882">(</span><span class="ident" id="7930883">t</span>&nbsp;<span class="op" id="7930885">*</span><span class="ident" id="7930886"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7930893">.</span><span class="ident" id="7930894">T</span><span class="op" id="7930895">)</span>&nbsp;<span class="op" id="7930897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930900">db</span>&nbsp;<span class="op" id="7930903">:=</span>&nbsp;<span class="ident" id="7930906"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7930915">(</span><span class="ident" id="7930916"><a href="/database/sql/sql_test.go.html#7930883">t</a></span><span class="op" id="7930917">,</span>&nbsp;<span class="string" id="7930919">&#34;people&#34;</span><span class="op" id="7930927">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930930">defer</span>&nbsp;<span class="ident" id="7930936"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7930943">(</span><span class="ident" id="7930944"><a href="/database/sql/sql_test.go.html#7930883">t</a></span><span class="op" id="7930945">,</span>&nbsp;<span class="ident" id="7930947"><a href="/database/sql/sql_test.go.html#7930900">db</a></span><span class="op" id="7930949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7930953">s</span><span class="op" id="7930954">,</span>&nbsp;<span class="ident" id="7930956">err</span>&nbsp;<span class="op" id="7930960">:=</span>&nbsp;<span class="ident" id="7930963"><a href="/database/sql/sql_test.go.html#7930900">db</a></span><span class="op" id="7930965">.</span><span class="ident" id="7930966">Prepare</span><span class="op" id="7930973">(</span><span class="string" id="7930974">&#34;SELECT|people|name|&#34;</span><span class="op" id="7930995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7930998">if</span>&nbsp;<span class="ident" id="7931001"><a href="/database/sql/sql_test.go.html#7930956">err</a></span>&nbsp;<span class="op" id="7931005">!=</span>&nbsp;<span class="ident" id="7931008">nil</span>&nbsp;<span class="op" id="7931012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931016"><a href="/database/sql/sql_test.go.html#7930883">t</a></span><span class="op" id="7931017">.</span><span class="ident" id="7931018">Fatal</span><span class="op" id="7931023">(</span><span class="ident" id="7931024"><a href="/database/sql/sql_test.go.html#7930956">err</a></span><span class="op" id="7931027">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931034">r</span><span class="op" id="7931035">,</span>&nbsp;<span class="ident" id="7931037"><a href="/database/sql/sql_test.go.html#7930956">err</a></span>&nbsp;<span class="op" id="7931041">:=</span>&nbsp;<span class="ident" id="7931044"><a href="/database/sql/sql_test.go.html#7930953">s</a></span><span class="op" id="7931045">.</span><span class="ident" id="7931046">Query</span><span class="op" id="7931051">(</span><span class="op" id="7931052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931055">if</span>&nbsp;<span class="ident" id="7931058"><a href="/database/sql/sql_test.go.html#7930956">err</a></span>&nbsp;<span class="op" id="7931062">!=</span>&nbsp;<span class="ident" id="7931065">nil</span>&nbsp;<span class="op" id="7931069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931073"><a href="/database/sql/sql_test.go.html#7930953">s</a></span><span class="op" id="7931074">.</span><span class="ident" id="7931075">Close</span><span class="op" id="7931080">(</span><span class="op" id="7931081">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931085"><a href="/database/sql/sql_test.go.html#7930883">t</a></span><span class="op" id="7931086">.</span><span class="ident" id="7931087">Fatal</span><span class="op" id="7931092">(</span><span class="ident" id="7931093"><a href="/database/sql/sql_test.go.html#7930956">err</a></span><span class="op" id="7931096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931103"><a href="/database/sql/sql_test.go.html#7930956">err</a></span>&nbsp;<span class="op" id="7931107">=</span>&nbsp;<span class="ident" id="7931109"><a href="/database/sql/sql_test.go.html#7930953">s</a></span><span class="op" id="7931110">.</span><span class="ident" id="7931111">Close</span><span class="op" id="7931116">(</span><span class="op" id="7931117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931120">if</span>&nbsp;<span class="ident" id="7931123"><a href="/database/sql/sql_test.go.html#7930956">err</a></span>&nbsp;<span class="op" id="7931127">!=</span>&nbsp;<span class="ident" id="7931130">nil</span>&nbsp;<span class="op" id="7931134">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931138"><a href="/database/sql/sql_test.go.html#7930883">t</a></span><span class="op" id="7931139">.</span><span class="ident" id="7931140">Fatal</span><span class="op" id="7931145">(</span><span class="ident" id="7931146"><a href="/database/sql/sql_test.go.html#7930956">err</a></span><span class="op" id="7931149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931156"><a href="/database/sql/sql_test.go.html#7931034">r</a></span><span class="op" id="7931157">.</span><span class="ident" id="7931158">Close</span><span class="op" id="7931163">(</span><span class="op" id="7931164">)</span><br>
<span class="lineno"></span><span class="op" id="7931166">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span><span class="comment" id="7931169">//&nbsp;Tests&nbsp;fix&nbsp;for&nbsp;issue&nbsp;2788,&nbsp;that&nbsp;we&nbsp;bind&nbsp;nil&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7931234">//&nbsp;value&nbsp;in&nbsp;the&nbsp;column&nbsp;is&nbsp;sql&nbsp;null</span><br>
<span class="lineno"></span><span class="keyword" id="7931269">func</span>&nbsp;<span class="ident" id="7931274">TestNullByteSlice</span><span class="op" id="7931291">(</span><span class="ident" id="7931292">t</span>&nbsp;<span class="op" id="7931294">*</span><span class="ident" id="7931295"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7931302">.</span><span class="ident" id="7931303">T</span><span class="op" id="7931304">)</span>&nbsp;<span class="op" id="7931306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931309">db</span>&nbsp;<span class="op" id="7931312">:=</span>&nbsp;<span class="ident" id="7931315"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7931324">(</span><span class="ident" id="7931325"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931326">,</span>&nbsp;<span class="string" id="7931328">&#34;&#34;</span><span class="op" id="7931330">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931333">defer</span>&nbsp;<span class="ident" id="7931339"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7931346">(</span><span class="ident" id="7931347"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931348">,</span>&nbsp;<span class="ident" id="7931350"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931355"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7931359">(</span><span class="ident" id="7931360"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931361">,</span>&nbsp;<span class="ident" id="7931363"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931365">,</span>&nbsp;<span class="string" id="7931367">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7931402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931405"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7931409">(</span><span class="ident" id="7931410"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931411">,</span>&nbsp;<span class="ident" id="7931413"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931415">,</span>&nbsp;<span class="string" id="7931417">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7931440">,</span>&nbsp;<span class="ident" id="7931442">nil</span><span class="op" id="7931445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931449">var</span>&nbsp;<span class="ident" id="7931453">name</span>&nbsp;<span class="op" id="7931458">[</span><span class="op" id="7931459">]</span><span class="builtintype" id="7931460">byte</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931467">err</span>&nbsp;<span class="op" id="7931471">:=</span>&nbsp;<span class="ident" id="7931474"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931476">.</span><span class="ident" id="7931477">QueryRow</span><span class="op" id="7931485">(</span><span class="string" id="7931486">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7931506">,</span>&nbsp;<span class="num" id="7931508">10</span><span class="op" id="7931510">)</span><span class="op" id="7931511">.</span><span class="ident" id="7931512">Scan</span><span class="op" id="7931516">(</span><span class="op" id="7931517">&amp;</span><span class="ident" id="7931518"><a href="/database/sql/sql_test.go.html#7931453">name</a></span><span class="op" id="7931522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931525">if</span>&nbsp;<span class="ident" id="7931528"><a href="/database/sql/sql_test.go.html#7931467">err</a></span>&nbsp;<span class="op" id="7931532">!=</span>&nbsp;<span class="ident" id="7931535">nil</span>&nbsp;<span class="op" id="7931539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931543"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931544">.</span><span class="ident" id="7931545">Fatal</span><span class="op" id="7931550">(</span><span class="ident" id="7931551"><a href="/database/sql/sql_test.go.html#7931467">err</a></span><span class="op" id="7931554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931557">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931560">if</span>&nbsp;<span class="ident" id="7931563"><a href="/database/sql/sql_test.go.html#7931453">name</a></span>&nbsp;<span class="op" id="7931568">!=</span>&nbsp;<span class="ident" id="7931571">nil</span>&nbsp;<span class="op" id="7931575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931579"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931580">.</span><span class="ident" id="7931581">Fatalf</span><span class="op" id="7931587">(</span><span class="string" id="7931588">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;nil&nbsp;for&nbsp;null&nbsp;column&nbsp;value,&nbsp;got:&nbsp;%#v&#34;</span><span class="op" id="7931647">,</span>&nbsp;<span class="ident" id="7931649"><a href="/database/sql/sql_test.go.html#7931453">name</a></span><span class="op" id="7931653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931660"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7931664">(</span><span class="ident" id="7931665"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931666">,</span>&nbsp;<span class="ident" id="7931668"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931670">,</span>&nbsp;<span class="string" id="7931672">&#34;INSERT|t|id=11,name=?&#34;</span><span class="op" id="7931695">,</span>&nbsp;<span class="string" id="7931697">&#34;bob&#34;</span><span class="op" id="7931702">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931705"><a href="/database/sql/sql_test.go.html#7931467">err</a></span>&nbsp;<span class="op" id="7931709">=</span>&nbsp;<span class="ident" id="7931711"><a href="/database/sql/sql_test.go.html#7931309">db</a></span><span class="op" id="7931713">.</span><span class="ident" id="7931714">QueryRow</span><span class="op" id="7931722">(</span><span class="string" id="7931723">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7931743">,</span>&nbsp;<span class="num" id="7931745">11</span><span class="op" id="7931747">)</span><span class="op" id="7931748">.</span><span class="ident" id="7931749">Scan</span><span class="op" id="7931753">(</span><span class="op" id="7931754">&amp;</span><span class="ident" id="7931755"><a href="/database/sql/sql_test.go.html#7931453">name</a></span><span class="op" id="7931759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931762">if</span>&nbsp;<span class="ident" id="7931765"><a href="/database/sql/sql_test.go.html#7931467">err</a></span>&nbsp;<span class="op" id="7931769">!=</span>&nbsp;<span class="ident" id="7931772">nil</span>&nbsp;<span class="op" id="7931776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931780"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931781">.</span><span class="ident" id="7931782">Fatal</span><span class="op" id="7931787">(</span><span class="ident" id="7931788"><a href="/database/sql/sql_test.go.html#7931467">err</a></span><span class="op" id="7931791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931797">if</span>&nbsp;<span class="builtintype" id="7931800">string</span><span class="op" id="7931806">(</span><span class="ident" id="7931807"><a href="/database/sql/sql_test.go.html#7931453">name</a></span><span class="op" id="7931811">)</span>&nbsp;<span class="op" id="7931813">!=</span>&nbsp;<span class="string" id="7931816">&#34;bob&#34;</span>&nbsp;<span class="op" id="7931822">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931826"><a href="/database/sql/sql_test.go.html#7931292">t</a></span><span class="op" id="7931827">.</span><span class="ident" id="7931828">Fatalf</span><span class="op" id="7931834">(</span><span class="string" id="7931835">&#34;name&nbsp;[]byte&nbsp;should&nbsp;be&nbsp;bob,&nbsp;got:&nbsp;%q&#34;</span><span class="op" id="7931871">,</span>&nbsp;<span class="builtintype" id="7931873">string</span><span class="op" id="7931879">(</span><span class="ident" id="7931880"><a href="/database/sql/sql_test.go.html#7931453">name</a></span><span class="op" id="7931884">)</span><span class="op" id="7931885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931888">}</span><br>
<span class="lineno"></span><span class="op" id="7931890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7931893">func</span>&nbsp;<span class="ident" id="7931898">TestPointerParamsAndScans</span><span class="op" id="7931923">(</span><span class="ident" id="7931924">t</span>&nbsp;<span class="op" id="7931926">*</span><span class="ident" id="7931927"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7931934">.</span><span class="ident" id="7931935">T</span><span class="op" id="7931936">)</span>&nbsp;<span class="op" id="7931938">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931941">db</span>&nbsp;<span class="op" id="7931944">:=</span>&nbsp;<span class="ident" id="7931947"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7931956">(</span><span class="ident" id="7931957"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7931958">,</span>&nbsp;<span class="string" id="7931960">&#34;&#34;</span><span class="op" id="7931962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7931965">defer</span>&nbsp;<span class="ident" id="7931971"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7931978">(</span><span class="ident" id="7931979"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7931980">,</span>&nbsp;<span class="ident" id="7931982"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7931984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7931987"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7931991">(</span><span class="ident" id="7931992"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7931993">,</span>&nbsp;<span class="ident" id="7931995"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7931997">,</span>&nbsp;<span class="string" id="7931999">&#34;CREATE|t|id=int32,name=nullstring&#34;</span><span class="op" id="7932034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932038">bob</span>&nbsp;<span class="op" id="7932042">:=</span>&nbsp;<span class="string" id="7932045">&#34;bob&#34;</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932052">var</span>&nbsp;<span class="ident" id="7932056">name</span>&nbsp;<span class="op" id="7932061">*</span><span class="builtintype" id="7932062">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932071"><a href="/database/sql/sql_test.go.html#7932056">name</a></span>&nbsp;<span class="op" id="7932076">=</span>&nbsp;<span class="op" id="7932078">&amp;</span><span class="ident" id="7932079"><a href="/database/sql/sql_test.go.html#7932038">bob</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932084"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7932088">(</span><span class="ident" id="7932089"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932090">,</span>&nbsp;<span class="ident" id="7932092"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7932094">,</span>&nbsp;<span class="string" id="7932096">&#34;INSERT|t|id=10,name=?&#34;</span><span class="op" id="7932119">,</span>&nbsp;<span class="ident" id="7932121"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932128"><a href="/database/sql/sql_test.go.html#7932056">name</a></span>&nbsp;<span class="op" id="7932133">=</span>&nbsp;<span class="ident" id="7932135">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932140"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7932144">(</span><span class="ident" id="7932145"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932146">,</span>&nbsp;<span class="ident" id="7932148"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7932150">,</span>&nbsp;<span class="string" id="7932152">&#34;INSERT|t|id=20,name=?&#34;</span><span class="op" id="7932175">,</span>&nbsp;<span class="ident" id="7932177"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932185">err</span>&nbsp;<span class="op" id="7932189">:=</span>&nbsp;<span class="ident" id="7932192"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7932194">.</span><span class="ident" id="7932195">QueryRow</span><span class="op" id="7932203">(</span><span class="string" id="7932204">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7932224">,</span>&nbsp;<span class="num" id="7932226">10</span><span class="op" id="7932228">)</span><span class="op" id="7932229">.</span><span class="ident" id="7932230">Scan</span><span class="op" id="7932234">(</span><span class="op" id="7932235">&amp;</span><span class="ident" id="7932236"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932243">if</span>&nbsp;<span class="ident" id="7932246"><a href="/database/sql/sql_test.go.html#7932185">err</a></span>&nbsp;<span class="op" id="7932250">!=</span>&nbsp;<span class="ident" id="7932253">nil</span>&nbsp;<span class="op" id="7932257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932261"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932262">.</span><span class="ident" id="7932263">Fatalf</span><span class="op" id="7932269">(</span><span class="string" id="7932270">&#34;querying&nbsp;id&nbsp;10:&nbsp;%v&#34;</span><span class="op" id="7932290">,</span>&nbsp;<span class="ident" id="7932292"><a href="/database/sql/sql_test.go.html#7932185">err</a></span><span class="op" id="7932295">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932301">if</span>&nbsp;<span class="ident" id="7932304"><a href="/database/sql/sql_test.go.html#7932056">name</a></span>&nbsp;<span class="op" id="7932309">==</span>&nbsp;<span class="ident" id="7932312">nil</span>&nbsp;<span class="op" id="7932316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932320"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932321">.</span><span class="ident" id="7932322">Errorf</span><span class="op" id="7932328">(</span><span class="string" id="7932329">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;nil;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7932359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932362">}</span>&nbsp;<span class="keyword" id="7932364">else</span>&nbsp;<span class="keyword" id="7932369">if</span>&nbsp;<span class="op" id="7932372">*</span><span class="ident" id="7932373"><a href="/database/sql/sql_test.go.html#7932056">name</a></span>&nbsp;<span class="op" id="7932378">!=</span>&nbsp;<span class="string" id="7932381">&#34;bob&#34;</span>&nbsp;<span class="op" id="7932387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932391"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932392">.</span><span class="ident" id="7932393">Errorf</span><span class="op" id="7932399">(</span><span class="string" id="7932400">&#34;id&nbsp;10&#39;s&nbsp;name&nbsp;=&nbsp;%q;&nbsp;want&nbsp;bob&#34;</span><span class="op" id="7932429">,</span>&nbsp;<span class="op" id="7932431">*</span><span class="ident" id="7932432"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932436">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932443"><a href="/database/sql/sql_test.go.html#7932185">err</a></span>&nbsp;<span class="op" id="7932447">=</span>&nbsp;<span class="ident" id="7932449"><a href="/database/sql/sql_test.go.html#7931941">db</a></span><span class="op" id="7932451">.</span><span class="ident" id="7932452">QueryRow</span><span class="op" id="7932460">(</span><span class="string" id="7932461">&#34;SELECT|t|name|id=?&#34;</span><span class="op" id="7932481">,</span>&nbsp;<span class="num" id="7932483">20</span><span class="op" id="7932485">)</span><span class="op" id="7932486">.</span><span class="ident" id="7932487">Scan</span><span class="op" id="7932491">(</span><span class="op" id="7932492">&amp;</span><span class="ident" id="7932493"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932500">if</span>&nbsp;<span class="ident" id="7932503"><a href="/database/sql/sql_test.go.html#7932185">err</a></span>&nbsp;<span class="op" id="7932507">!=</span>&nbsp;<span class="ident" id="7932510">nil</span>&nbsp;<span class="op" id="7932514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932518"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932519">.</span><span class="ident" id="7932520">Fatalf</span><span class="op" id="7932526">(</span><span class="string" id="7932527">&#34;querying&nbsp;id&nbsp;20:&nbsp;%v&#34;</span><span class="op" id="7932547">,</span>&nbsp;<span class="ident" id="7932549"><a href="/database/sql/sql_test.go.html#7932185">err</a></span><span class="op" id="7932552">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932558">if</span>&nbsp;<span class="ident" id="7932561"><a href="/database/sql/sql_test.go.html#7932056">name</a></span>&nbsp;<span class="op" id="7932566">!=</span>&nbsp;<span class="ident" id="7932569">nil</span>&nbsp;<span class="op" id="7932573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932577"><a href="/database/sql/sql_test.go.html#7931924">t</a></span><span class="op" id="7932578">.</span><span class="ident" id="7932579">Errorf</span><span class="op" id="7932585">(</span><span class="string" id="7932586">&#34;id&nbsp;20&nbsp;=&nbsp;%q;&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7932608">,</span>&nbsp;<span class="op" id="7932610">*</span><span class="ident" id="7932611"><a href="/database/sql/sql_test.go.html#7932056">name</a></span><span class="op" id="7932615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932618">}</span><br>
<span class="lineno"></span><span class="op" id="7932620">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7932623">func</span>&nbsp;<span class="ident" id="7932628">TestQueryRowClosingStmt</span><span class="op" id="7932651">(</span><span class="ident" id="7932652">t</span>&nbsp;<span class="op" id="7932654">*</span><span class="ident" id="7932655"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7932662">.</span><span class="ident" id="7932663">T</span><span class="op" id="7932664">)</span>&nbsp;<span class="op" id="7932666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932669">db</span>&nbsp;<span class="op" id="7932672">:=</span>&nbsp;<span class="ident" id="7932675"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7932684">(</span><span class="ident" id="7932685"><a href="/database/sql/sql_test.go.html#7932652">t</a></span><span class="op" id="7932686">,</span>&nbsp;<span class="string" id="7932688">&#34;people&#34;</span><span class="op" id="7932696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932699">defer</span>&nbsp;<span class="ident" id="7932705"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7932712">(</span><span class="ident" id="7932713"><a href="/database/sql/sql_test.go.html#7932652">t</a></span><span class="op" id="7932714">,</span>&nbsp;<span class="ident" id="7932716"><a href="/database/sql/sql_test.go.html#7932669">db</a></span><span class="op" id="7932718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932721">var</span>&nbsp;<span class="ident" id="7932725">name</span>&nbsp;<span class="builtintype" id="7932730">string</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932738">var</span>&nbsp;<span class="ident" id="7932742">age</span>&nbsp;<span class="builtintype" id="7932746">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932751">err</span>&nbsp;<span class="op" id="7932755">:=</span>&nbsp;<span class="ident" id="7932758"><a href="/database/sql/sql_test.go.html#7932669">db</a></span><span class="op" id="7932760">.</span><span class="ident" id="7932761">QueryRow</span><span class="op" id="7932769">(</span><span class="string" id="7932770">&#34;SELECT|people|age,name|age=?&#34;</span><span class="op" id="7932800">,</span>&nbsp;<span class="num" id="7932802">3</span><span class="op" id="7932803">)</span><span class="op" id="7932804">.</span><span class="ident" id="7932805">Scan</span><span class="op" id="7932809">(</span><span class="op" id="7932810">&amp;</span><span class="ident" id="7932811"><a href="/database/sql/sql_test.go.html#7932742">age</a></span><span class="op" id="7932814">,</span>&nbsp;<span class="op" id="7932816">&amp;</span><span class="ident" id="7932817"><a href="/database/sql/sql_test.go.html#7932725">name</a></span><span class="op" id="7932821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932824">if</span>&nbsp;<span class="ident" id="7932827"><a href="/database/sql/sql_test.go.html#7932751">err</a></span>&nbsp;<span class="op" id="7932831">!=</span>&nbsp;<span class="ident" id="7932834">nil</span>&nbsp;<span class="op" id="7932838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932842"><a href="/database/sql/sql_test.go.html#7932652">t</a></span><span class="op" id="7932843">.</span><span class="ident" id="7932844">Fatal</span><span class="op" id="7932849">(</span><span class="ident" id="7932850"><a href="/database/sql/sql_test.go.html#7932751">err</a></span><span class="op" id="7932853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932856">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932859">if</span>&nbsp;<span class="builtinfunc" id="7932862">len</span><span class="op" id="7932865">(</span><span class="ident" id="7932866"><a href="/database/sql/sql_test.go.html#7932669">db</a></span><span class="op" id="7932868">.</span><span class="ident" id="7932869">freeConn</span><span class="op" id="7932877">)</span>&nbsp;<span class="op" id="7932879">!=</span>&nbsp;<span class="num" id="7932882">1</span>&nbsp;<span class="op" id="7932884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932888"><a href="/database/sql/sql_test.go.html#7932652">t</a></span><span class="op" id="7932889">.</span><span class="ident" id="7932890">Fatalf</span><span class="op" id="7932896">(</span><span class="string" id="7932897">&#34;expected&nbsp;1&nbsp;free&nbsp;conn&#34;</span><span class="op" id="7932919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7932925">fakeConn</span>&nbsp;<span class="op" id="7932934">:=</span>&nbsp;<span class="ident" id="7932937"><a href="/database/sql/sql_test.go.html#7932669">db</a></span><span class="op" id="7932939">.</span><span class="ident" id="7932940">freeConn</span><span class="op" id="7932948">[</span><span class="num" id="7932949">0</span><span class="op" id="7932950">]</span><span class="op" id="7932951">.</span><span class="ident" id="7932952">ci</span><span class="op" id="7932954">.</span><span class="op" id="7932955">(</span><span class="op" id="7932956">*</span><span class="ident" id="7932957"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7932965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7932968">if</span>&nbsp;<span class="ident" id="7932971">made</span><span class="op" id="7932975">,</span>&nbsp;<span class="ident" id="7932977">closed</span>&nbsp;<span class="op" id="7932984">:=</span>&nbsp;<span class="ident" id="7932987"><a href="/database/sql/sql_test.go.html#7932925">fakeConn</a></span><span class="op" id="7932995">.</span><span class="ident" id="7932996">stmtsMade</span><span class="op" id="7933005">,</span>&nbsp;<span class="ident" id="7933007"><a href="/database/sql/sql_test.go.html#7932925">fakeConn</a></span><span class="op" id="7933015">.</span><span class="ident" id="7933016">stmtsClosed</span><span class="op" id="7933027">;</span>&nbsp;<span class="ident" id="7933029"><a href="/database/sql/sql_test.go.html#7932971">made</a></span>&nbsp;<span class="op" id="7933034">!=</span>&nbsp;<span class="ident" id="7933037"><a href="/database/sql/sql_test.go.html#7932977">closed</a></span>&nbsp;<span class="op" id="7933044">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933048"><a href="/database/sql/sql_test.go.html#7932652">t</a></span><span class="op" id="7933049">.</span><span class="ident" id="7933050">Errorf</span><span class="op" id="7933056">(</span><span class="string" id="7933057">&#34;statement&nbsp;close&nbsp;mismatch:&nbsp;made&nbsp;%d,&nbsp;closed&nbsp;%d&#34;</span><span class="op" id="7933103">,</span>&nbsp;<span class="ident" id="7933105"><a href="/database/sql/sql_test.go.html#7932971">made</a></span><span class="op" id="7933109">,</span>&nbsp;<span class="ident" id="7933111"><a href="/database/sql/sql_test.go.html#7932977">closed</a></span><span class="op" id="7933117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933120">}</span><br>
<span class="lineno"></span><span class="op" id="7933122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7933125">//&nbsp;Test&nbsp;issue&nbsp;6651</span><br>
<span class="lineno">700</span><span class="keyword" id="7933144">func</span>&nbsp;<span class="ident" id="7933149">TestIssue6651</span><span class="op" id="7933162">(</span><span class="ident" id="7933163">t</span>&nbsp;<span class="op" id="7933165">*</span><span class="ident" id="7933166"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7933173">.</span><span class="ident" id="7933174">T</span><span class="op" id="7933175">)</span>&nbsp;<span class="op" id="7933177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933180">db</span>&nbsp;<span class="op" id="7933183">:=</span>&nbsp;<span class="ident" id="7933186"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7933195">(</span><span class="ident" id="7933196"><a href="/database/sql/sql_test.go.html#7933163">t</a></span><span class="op" id="7933197">,</span>&nbsp;<span class="string" id="7933199">&#34;people&#34;</span><span class="op" id="7933207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933210">defer</span>&nbsp;<span class="ident" id="7933216"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7933223">(</span><span class="ident" id="7933224"><a href="/database/sql/sql_test.go.html#7933163">t</a></span><span class="op" id="7933225">,</span>&nbsp;<span class="ident" id="7933227"><a href="/database/sql/sql_test.go.html#7933180">db</a></span><span class="op" id="7933229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933233">var</span>&nbsp;<span class="ident" id="7933237">v</span>&nbsp;<span class="builtintype" id="7933239">string</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933248">want</span>&nbsp;<span class="op" id="7933253">:=</span>&nbsp;<span class="string" id="7933256">&#34;error&nbsp;in&nbsp;rows.Next&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933278"><a href="/database/sql/fakedb_test.go.html#7913816">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7933297">=</span>&nbsp;<span class="keyword" id="7933299">func</span><span class="op" id="7933303">(</span><span class="ident" id="7933304">dest</span>&nbsp;<span class="op" id="7933309">[</span><span class="op" id="7933310">]</span><span class="ident" id="7933311"><a href="/database/sql/sql_test.go.html#7916606">driver</a></span><span class="op" id="7933317">.</span><span class="ident" id="7933318">Value</span><span class="op" id="7933323">)</span>&nbsp;<span class="builtintype" id="7933325">error</span>&nbsp;<span class="op" id="7933331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933335">return</span>&nbsp;<span class="ident" id="7933342"><a href="/database/sql/sql_test.go.html#7916639">fmt</a></span><span class="op" id="7933345">.</span><span class="ident" id="7933346">Errorf</span><span class="op" id="7933352">(</span><span class="ident" id="7933353"><a href="/database/sql/sql_test.go.html#7933248">want</a></span><span class="op" id="7933357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933360">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933363">defer</span>&nbsp;<span class="keyword" id="7933369">func</span><span class="op" id="7933373">(</span><span class="op" id="7933374">)</span>&nbsp;<span class="op" id="7933376">{</span>&nbsp;<span class="ident" id="7933378"><a href="/database/sql/fakedb_test.go.html#7913816">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7933397">=</span>&nbsp;<span class="ident" id="7933399">nil</span>&nbsp;<span class="op" id="7933403">}</span><span class="op" id="7933404">(</span><span class="op" id="7933405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933408">err</span>&nbsp;<span class="op" id="7933412">:=</span>&nbsp;<span class="ident" id="7933415"><a href="/database/sql/sql_test.go.html#7933180">db</a></span><span class="op" id="7933417">.</span><span class="ident" id="7933418">QueryRow</span><span class="op" id="7933426">(</span><span class="string" id="7933427">&#34;SELECT|people|name|&#34;</span><span class="op" id="7933448">)</span><span class="op" id="7933449">.</span><span class="ident" id="7933450">Scan</span><span class="op" id="7933454">(</span><span class="op" id="7933455">&amp;</span><span class="ident" id="7933456"><a href="/database/sql/sql_test.go.html#7933237">v</a></span><span class="op" id="7933457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933460">if</span>&nbsp;<span class="ident" id="7933463"><a href="/database/sql/sql_test.go.html#7933408">err</a></span>&nbsp;<span class="op" id="7933467">==</span>&nbsp;<span class="ident" id="7933470">nil</span>&nbsp;<span class="op" id="7933474">||</span>&nbsp;<span class="ident" id="7933477"><a href="/database/sql/sql_test.go.html#7933408">err</a></span><span class="op" id="7933480">.</span><span class="ident" id="7933481">Error</span><span class="op" id="7933486">(</span><span class="op" id="7933487">)</span>&nbsp;<span class="op" id="7933489">!=</span>&nbsp;<span class="ident" id="7933492"><a href="/database/sql/sql_test.go.html#7933248">want</a></span>&nbsp;<span class="op" id="7933497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933501"><a href="/database/sql/sql_test.go.html#7933163">t</a></span><span class="op" id="7933502">.</span><span class="ident" id="7933503">Errorf</span><span class="op" id="7933509">(</span><span class="string" id="7933510">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7933531">,</span>&nbsp;<span class="ident" id="7933533"><a href="/database/sql/sql_test.go.html#7933408">err</a></span><span class="op" id="7933536">,</span>&nbsp;<span class="ident" id="7933538"><a href="/database/sql/sql_test.go.html#7933248">want</a></span><span class="op" id="7933542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933545">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933548"><a href="/database/sql/fakedb_test.go.html#7913816">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7933567">=</span>&nbsp;<span class="ident" id="7933569">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933575"><a href="/database/sql/sql_test.go.html#7933248">want</a></span>&nbsp;<span class="op" id="7933580">=</span>&nbsp;<span class="string" id="7933582">&#34;error&nbsp;in&nbsp;rows.Close&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933605"><a href="/database/sql/sql.go.html#5785316">rowsCloseHook</a></span>&nbsp;<span class="op" id="7933619">=</span>&nbsp;<span class="keyword" id="7933621">func</span><span class="op" id="7933625">(</span><span class="ident" id="7933626">rows</span>&nbsp;<span class="op" id="7933631">*</span><span class="ident" id="7933632"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="7933636">,</span>&nbsp;<span class="ident" id="7933638">err</span>&nbsp;<span class="op" id="7933642">*</span><span class="builtintype" id="7933643">error</span><span class="op" id="7933648">)</span>&nbsp;<span class="op" id="7933650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933654">*</span><span class="ident" id="7933655"><a href="/database/sql/sql_test.go.html#7933638">err</a></span>&nbsp;<span class="op" id="7933659">=</span>&nbsp;<span class="ident" id="7933661"><a href="/database/sql/sql_test.go.html#7916639">fmt</a></span><span class="op" id="7933664">.</span><span class="ident" id="7933665">Errorf</span><span class="op" id="7933671">(</span><span class="ident" id="7933672"><a href="/database/sql/sql_test.go.html#7933248">want</a></span><span class="op" id="7933676">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933682">defer</span>&nbsp;<span class="keyword" id="7933688">func</span><span class="op" id="7933692">(</span><span class="op" id="7933693">)</span>&nbsp;<span class="op" id="7933695">{</span>&nbsp;<span class="ident" id="7933697"><a href="/database/sql/sql.go.html#5785316">rowsCloseHook</a></span>&nbsp;<span class="op" id="7933711">=</span>&nbsp;<span class="ident" id="7933713">nil</span>&nbsp;<span class="op" id="7933717">}</span><span class="op" id="7933718">(</span><span class="op" id="7933719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933722"><a href="/database/sql/sql_test.go.html#7933408">err</a></span>&nbsp;<span class="op" id="7933726">=</span>&nbsp;<span class="ident" id="7933728"><a href="/database/sql/sql_test.go.html#7933180">db</a></span><span class="op" id="7933730">.</span><span class="ident" id="7933731">QueryRow</span><span class="op" id="7933739">(</span><span class="string" id="7933740">&#34;SELECT|people|name|&#34;</span><span class="op" id="7933761">)</span><span class="op" id="7933762">.</span><span class="ident" id="7933763">Scan</span><span class="op" id="7933767">(</span><span class="op" id="7933768">&amp;</span><span class="ident" id="7933769"><a href="/database/sql/sql_test.go.html#7933237">v</a></span><span class="op" id="7933770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933773">if</span>&nbsp;<span class="ident" id="7933776"><a href="/database/sql/sql_test.go.html#7933408">err</a></span>&nbsp;<span class="op" id="7933780">==</span>&nbsp;<span class="ident" id="7933783">nil</span>&nbsp;<span class="op" id="7933787">||</span>&nbsp;<span class="ident" id="7933790"><a href="/database/sql/sql_test.go.html#7933408">err</a></span><span class="op" id="7933793">.</span><span class="ident" id="7933794">Error</span><span class="op" id="7933799">(</span><span class="op" id="7933800">)</span>&nbsp;<span class="op" id="7933802">!=</span>&nbsp;<span class="ident" id="7933805"><a href="/database/sql/sql_test.go.html#7933248">want</a></span>&nbsp;<span class="op" id="7933810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933814"><a href="/database/sql/sql_test.go.html#7933163">t</a></span><span class="op" id="7933815">.</span><span class="ident" id="7933816">Errorf</span><span class="op" id="7933822">(</span><span class="string" id="7933823">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7933844">,</span>&nbsp;<span class="ident" id="7933846"><a href="/database/sql/sql_test.go.html#7933408">err</a></span><span class="op" id="7933849">,</span>&nbsp;<span class="ident" id="7933851"><a href="/database/sql/sql_test.go.html#7933248">want</a></span><span class="op" id="7933855">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933858">}</span><br>
<span class="lineno"></span><span class="op" id="7933860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7933863">type</span>&nbsp;<span class="ident" id="7933868">nullTestRow</span>&nbsp;<span class="keyword" id="7933880">struct</span>&nbsp;<span class="op" id="7933887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933890">nullParam</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7933903">interface</span><span class="op" id="7933912">{</span><span class="op" id="7933913">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933916">notNullParam</span>&nbsp;<span class="keyword" id="7933929">interface</span><span class="op" id="7933938">{</span><span class="op" id="7933939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933942">scanNullVal</span>&nbsp;&nbsp;<span class="keyword" id="7933955">interface</span><span class="op" id="7933964">{</span><span class="op" id="7933965">}</span><br>
<span class="lineno"></span><span class="op" id="7933967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7933970">type</span>&nbsp;<span class="ident" id="7933975">nullTestSpec</span>&nbsp;<span class="keyword" id="7933988">struct</span>&nbsp;<span class="op" id="7933995">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933998">nullType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7934010">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934018">notNullType</span>&nbsp;<span class="builtintype" id="7934030">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934038">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7934050">[</span><span class="num" id="7934051">6</span><span class="op" id="7934052">]</span><span class="ident" id="7934053"><a href="/database/sql/sql_test.go.html#7933868">nullTestRow</a></span><br>
<span class="lineno"></span><span class="op" id="7934065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="7934068">func</span>&nbsp;<span class="ident" id="7934073">TestNullStringParam</span><span class="op" id="7934092">(</span><span class="ident" id="7934093">t</span>&nbsp;<span class="op" id="7934095">*</span><span class="ident" id="7934096"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7934103">.</span><span class="ident" id="7934104">T</span><span class="op" id="7934105">)</span>&nbsp;<span class="op" id="7934107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934110">spec</span>&nbsp;<span class="op" id="7934115">:=</span>&nbsp;<span class="ident" id="7934118"><a href="/database/sql/sql_test.go.html#7933975">nullTestSpec</a></span><span class="op" id="7934130">{</span><span class="string" id="7934131">&#34;nullstring&#34;</span><span class="op" id="7934143">,</span>&nbsp;<span class="string" id="7934145">&#34;string&#34;</span><span class="op" id="7934153">,</span>&nbsp;<span class="op" id="7934155">[</span><span class="num" id="7934156">6</span><span class="op" id="7934157">]</span><span class="ident" id="7934158"><a href="/database/sql/sql_test.go.html#7933868">nullTestRow</a></span><span class="op" id="7934169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934173">{</span><span class="ident" id="7934174"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934184">{</span><span class="string" id="7934185">&#34;aqua&#34;</span><span class="op" id="7934191">,</span>&nbsp;<span class="ident" id="7934193">true</span><span class="op" id="7934197">}</span><span class="op" id="7934198">,</span>&nbsp;<span class="string" id="7934200">&#34;&#34;</span><span class="op" id="7934202">,</span>&nbsp;<span class="ident" id="7934204"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934214">{</span><span class="string" id="7934215">&#34;aqua&#34;</span><span class="op" id="7934221">,</span>&nbsp;<span class="ident" id="7934223">true</span><span class="op" id="7934227">}</span><span class="op" id="7934228">}</span><span class="op" id="7934229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934233">{</span><span class="ident" id="7934234"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934244">{</span><span class="string" id="7934245">&#34;brown&#34;</span><span class="op" id="7934252">,</span>&nbsp;<span class="ident" id="7934254">false</span><span class="op" id="7934259">}</span><span class="op" id="7934260">,</span>&nbsp;<span class="string" id="7934262">&#34;&#34;</span><span class="op" id="7934264">,</span>&nbsp;<span class="ident" id="7934266"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934276">{</span><span class="string" id="7934277">&#34;&#34;</span><span class="op" id="7934279">,</span>&nbsp;<span class="ident" id="7934281">false</span><span class="op" id="7934286">}</span><span class="op" id="7934287">}</span><span class="op" id="7934288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934292">{</span><span class="string" id="7934293">&#34;chartreuse&#34;</span><span class="op" id="7934305">,</span>&nbsp;<span class="string" id="7934307">&#34;&#34;</span><span class="op" id="7934309">,</span>&nbsp;<span class="ident" id="7934311"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934321">{</span><span class="string" id="7934322">&#34;chartreuse&#34;</span><span class="op" id="7934334">,</span>&nbsp;<span class="ident" id="7934336">true</span><span class="op" id="7934340">}</span><span class="op" id="7934341">}</span><span class="op" id="7934342">,</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934346">{</span><span class="ident" id="7934347"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934357">{</span><span class="string" id="7934358">&#34;darkred&#34;</span><span class="op" id="7934367">,</span>&nbsp;<span class="ident" id="7934369">true</span><span class="op" id="7934373">}</span><span class="op" id="7934374">,</span>&nbsp;<span class="string" id="7934376">&#34;&#34;</span><span class="op" id="7934378">,</span>&nbsp;<span class="ident" id="7934380"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934390">{</span><span class="string" id="7934391">&#34;darkred&#34;</span><span class="op" id="7934400">,</span>&nbsp;<span class="ident" id="7934402">true</span><span class="op" id="7934406">}</span><span class="op" id="7934407">}</span><span class="op" id="7934408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934412">{</span><span class="ident" id="7934413"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934423">{</span><span class="string" id="7934424">&#34;eel&#34;</span><span class="op" id="7934429">,</span>&nbsp;<span class="ident" id="7934431">false</span><span class="op" id="7934436">}</span><span class="op" id="7934437">,</span>&nbsp;<span class="string" id="7934439">&#34;&#34;</span><span class="op" id="7934441">,</span>&nbsp;<span class="ident" id="7934443"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934453">{</span><span class="string" id="7934454">&#34;&#34;</span><span class="op" id="7934456">,</span>&nbsp;<span class="ident" id="7934458">false</span><span class="op" id="7934463">}</span><span class="op" id="7934464">}</span><span class="op" id="7934465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934469">{</span><span class="string" id="7934470">&#34;foo&#34;</span><span class="op" id="7934475">,</span>&nbsp;<span class="ident" id="7934477"><a href="/database/sql/sql.go.html#5744577">NullString</a></span><span class="op" id="7934487">{</span><span class="string" id="7934488">&#34;black&#34;</span><span class="op" id="7934495">,</span>&nbsp;<span class="ident" id="7934497">false</span><span class="op" id="7934502">}</span><span class="op" id="7934503">,</span>&nbsp;<span class="ident" id="7934505">nil</span><span class="op" id="7934508">}</span><span class="op" id="7934509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934512">}</span><span class="op" id="7934513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934516"><a href="/database/sql/sql_test.go.html#7935809">nullTestRun</a></span><span class="op" id="7934527">(</span><span class="ident" id="7934528"><a href="/database/sql/sql_test.go.html#7934093">t</a></span><span class="op" id="7934529">,</span>&nbsp;<span class="ident" id="7934531"><a href="/database/sql/sql_test.go.html#7934110">spec</a></span><span class="op" id="7934535">)</span><br>
<span class="lineno">750</span><span class="op" id="7934537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7934540">func</span>&nbsp;<span class="ident" id="7934545">TestNullInt64Param</span><span class="op" id="7934563">(</span><span class="ident" id="7934564">t</span>&nbsp;<span class="op" id="7934566">*</span><span class="ident" id="7934567"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7934574">.</span><span class="ident" id="7934575">T</span><span class="op" id="7934576">)</span>&nbsp;<span class="op" id="7934578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934581">spec</span>&nbsp;<span class="op" id="7934586">:=</span>&nbsp;<span class="ident" id="7934589"><a href="/database/sql/sql_test.go.html#7933975">nullTestSpec</a></span><span class="op" id="7934601">{</span><span class="string" id="7934602">&#34;nullint64&#34;</span><span class="op" id="7934613">,</span>&nbsp;<span class="string" id="7934615">&#34;int64&#34;</span><span class="op" id="7934622">,</span>&nbsp;<span class="op" id="7934624">[</span><span class="num" id="7934625">6</span><span class="op" id="7934626">]</span><span class="ident" id="7934627"><a href="/database/sql/sql_test.go.html#7933868">nullTestRow</a></span><span class="op" id="7934638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934642">{</span><span class="ident" id="7934643"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934652">{</span><span class="num" id="7934653">31</span><span class="op" id="7934655">,</span>&nbsp;<span class="ident" id="7934657">true</span><span class="op" id="7934661">}</span><span class="op" id="7934662">,</span>&nbsp;<span class="num" id="7934664">1</span><span class="op" id="7934665">,</span>&nbsp;<span class="ident" id="7934667"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934676">{</span><span class="num" id="7934677">31</span><span class="op" id="7934679">,</span>&nbsp;<span class="ident" id="7934681">true</span><span class="op" id="7934685">}</span><span class="op" id="7934686">}</span><span class="op" id="7934687">,</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934691">{</span><span class="ident" id="7934692"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934701">{</span><span class="op" id="7934702">-</span><span class="num" id="7934703">22</span><span class="op" id="7934705">,</span>&nbsp;<span class="ident" id="7934707">false</span><span class="op" id="7934712">}</span><span class="op" id="7934713">,</span>&nbsp;<span class="num" id="7934715">1</span><span class="op" id="7934716">,</span>&nbsp;<span class="ident" id="7934718"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934727">{</span><span class="num" id="7934728">0</span><span class="op" id="7934729">,</span>&nbsp;<span class="ident" id="7934731">false</span><span class="op" id="7934736">}</span><span class="op" id="7934737">}</span><span class="op" id="7934738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934742">{</span><span class="num" id="7934743">22</span><span class="op" id="7934745">,</span>&nbsp;<span class="num" id="7934747">1</span><span class="op" id="7934748">,</span>&nbsp;<span class="ident" id="7934750"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934759">{</span><span class="num" id="7934760">22</span><span class="op" id="7934762">,</span>&nbsp;<span class="ident" id="7934764">true</span><span class="op" id="7934768">}</span><span class="op" id="7934769">}</span><span class="op" id="7934770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934774">{</span><span class="ident" id="7934775"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934784">{</span><span class="num" id="7934785">33</span><span class="op" id="7934787">,</span>&nbsp;<span class="ident" id="7934789">true</span><span class="op" id="7934793">}</span><span class="op" id="7934794">,</span>&nbsp;<span class="num" id="7934796">1</span><span class="op" id="7934797">,</span>&nbsp;<span class="ident" id="7934799"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934808">{</span><span class="num" id="7934809">33</span><span class="op" id="7934811">,</span>&nbsp;<span class="ident" id="7934813">true</span><span class="op" id="7934817">}</span><span class="op" id="7934818">}</span><span class="op" id="7934819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934823">{</span><span class="ident" id="7934824"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934833">{</span><span class="num" id="7934834">222</span><span class="op" id="7934837">,</span>&nbsp;<span class="ident" id="7934839">false</span><span class="op" id="7934844">}</span><span class="op" id="7934845">,</span>&nbsp;<span class="num" id="7934847">1</span><span class="op" id="7934848">,</span>&nbsp;<span class="ident" id="7934850"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934859">{</span><span class="num" id="7934860">0</span><span class="op" id="7934861">,</span>&nbsp;<span class="ident" id="7934863">false</span><span class="op" id="7934868">}</span><span class="op" id="7934869">}</span><span class="op" id="7934870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934874">{</span><span class="num" id="7934875">0</span><span class="op" id="7934876">,</span>&nbsp;<span class="ident" id="7934878"><a href="/database/sql/sql.go.html#5745227">NullInt64</a></span><span class="op" id="7934887">{</span><span class="num" id="7934888">31</span><span class="op" id="7934890">,</span>&nbsp;<span class="ident" id="7934892">false</span><span class="op" id="7934897">}</span><span class="op" id="7934898">,</span>&nbsp;<span class="ident" id="7934900">nil</span><span class="op" id="7934903">}</span><span class="op" id="7934904">,</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934907">}</span><span class="op" id="7934908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934911"><a href="/database/sql/sql_test.go.html#7935809">nullTestRun</a></span><span class="op" id="7934922">(</span><span class="ident" id="7934923"><a href="/database/sql/sql_test.go.html#7934564">t</a></span><span class="op" id="7934924">,</span>&nbsp;<span class="ident" id="7934926"><a href="/database/sql/sql_test.go.html#7934581">spec</a></span><span class="op" id="7934930">)</span><br>
<span class="lineno"></span><span class="op" id="7934932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7934935">func</span>&nbsp;<span class="ident" id="7934940">TestNullFloat64Param</span><span class="op" id="7934960">(</span><span class="ident" id="7934961">t</span>&nbsp;<span class="op" id="7934963">*</span><span class="ident" id="7934964"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7934971">.</span><span class="ident" id="7934972">T</span><span class="op" id="7934973">)</span>&nbsp;<span class="op" id="7934975">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934978">spec</span>&nbsp;<span class="op" id="7934983">:=</span>&nbsp;<span class="ident" id="7934986"><a href="/database/sql/sql_test.go.html#7933975">nullTestSpec</a></span><span class="op" id="7934998">{</span><span class="string" id="7934999">&#34;nullfloat64&#34;</span><span class="op" id="7935012">,</span>&nbsp;<span class="string" id="7935014">&#34;float64&#34;</span><span class="op" id="7935023">,</span>&nbsp;<span class="op" id="7935025">[</span><span class="num" id="7935026">6</span><span class="op" id="7935027">]</span><span class="ident" id="7935028"><a href="/database/sql/sql_test.go.html#7933868">nullTestRow</a></span><span class="op" id="7935039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935043">{</span><span class="ident" id="7935044"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935055">{</span><span class="num" id="7935056">31.2</span><span class="op" id="7935060">,</span>&nbsp;<span class="ident" id="7935062">true</span><span class="op" id="7935066">}</span><span class="op" id="7935067">,</span>&nbsp;<span class="num" id="7935069">1</span><span class="op" id="7935070">,</span>&nbsp;<span class="ident" id="7935072"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935083">{</span><span class="num" id="7935084">31.2</span><span class="op" id="7935088">,</span>&nbsp;<span class="ident" id="7935090">true</span><span class="op" id="7935094">}</span><span class="op" id="7935095">}</span><span class="op" id="7935096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935100">{</span><span class="ident" id="7935101"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935112">{</span><span class="num" id="7935113">13.1</span><span class="op" id="7935117">,</span>&nbsp;<span class="ident" id="7935119">false</span><span class="op" id="7935124">}</span><span class="op" id="7935125">,</span>&nbsp;<span class="num" id="7935127">1</span><span class="op" id="7935128">,</span>&nbsp;<span class="ident" id="7935130"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935141">{</span><span class="num" id="7935142">0</span><span class="op" id="7935143">,</span>&nbsp;<span class="ident" id="7935145">false</span><span class="op" id="7935150">}</span><span class="op" id="7935151">}</span><span class="op" id="7935152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935156">{</span><span class="op" id="7935157">-</span><span class="num" id="7935158">22.9</span><span class="op" id="7935162">,</span>&nbsp;<span class="num" id="7935164">1</span><span class="op" id="7935165">,</span>&nbsp;<span class="ident" id="7935167"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935178">{</span><span class="op" id="7935179">-</span><span class="num" id="7935180">22.9</span><span class="op" id="7935184">,</span>&nbsp;<span class="ident" id="7935186">true</span><span class="op" id="7935190">}</span><span class="op" id="7935191">}</span><span class="op" id="7935192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935196">{</span><span class="ident" id="7935197"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935208">{</span><span class="num" id="7935209">33.81</span><span class="op" id="7935214">,</span>&nbsp;<span class="ident" id="7935216">true</span><span class="op" id="7935220">}</span><span class="op" id="7935221">,</span>&nbsp;<span class="num" id="7935223">1</span><span class="op" id="7935224">,</span>&nbsp;<span class="ident" id="7935226"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935237">{</span><span class="num" id="7935238">33.81</span><span class="op" id="7935243">,</span>&nbsp;<span class="ident" id="7935245">true</span><span class="op" id="7935249">}</span><span class="op" id="7935250">}</span><span class="op" id="7935251">,</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935255">{</span><span class="ident" id="7935256"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935267">{</span><span class="num" id="7935268">222</span><span class="op" id="7935271">,</span>&nbsp;<span class="ident" id="7935273">false</span><span class="op" id="7935278">}</span><span class="op" id="7935279">,</span>&nbsp;<span class="num" id="7935281">1</span><span class="op" id="7935282">,</span>&nbsp;<span class="ident" id="7935284"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935295">{</span><span class="num" id="7935296">0</span><span class="op" id="7935297">,</span>&nbsp;<span class="ident" id="7935299">false</span><span class="op" id="7935304">}</span><span class="op" id="7935305">}</span><span class="op" id="7935306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935310">{</span><span class="num" id="7935311">10</span><span class="op" id="7935313">,</span>&nbsp;<span class="ident" id="7935315"><a href="/database/sql/sql.go.html#5745863">NullFloat64</a></span><span class="op" id="7935326">{</span><span class="num" id="7935327">31.2</span><span class="op" id="7935331">,</span>&nbsp;<span class="ident" id="7935333">false</span><span class="op" id="7935338">}</span><span class="op" id="7935339">,</span>&nbsp;<span class="ident" id="7935341">nil</span><span class="op" id="7935344">}</span><span class="op" id="7935345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935348">}</span><span class="op" id="7935349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935352"><a href="/database/sql/sql_test.go.html#7935809">nullTestRun</a></span><span class="op" id="7935363">(</span><span class="ident" id="7935364"><a href="/database/sql/sql_test.go.html#7934961">t</a></span><span class="op" id="7935365">,</span>&nbsp;<span class="ident" id="7935367"><a href="/database/sql/sql_test.go.html#7934978">spec</a></span><span class="op" id="7935371">)</span><br>
<span class="lineno"></span><span class="op" id="7935373">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="keyword" id="7935376">func</span>&nbsp;<span class="ident" id="7935381">TestNullBoolParam</span><span class="op" id="7935398">(</span><span class="ident" id="7935399">t</span>&nbsp;<span class="op" id="7935401">*</span><span class="ident" id="7935402"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7935409">.</span><span class="ident" id="7935410">T</span><span class="op" id="7935411">)</span>&nbsp;<span class="op" id="7935413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935416">spec</span>&nbsp;<span class="op" id="7935421">:=</span>&nbsp;<span class="ident" id="7935424"><a href="/database/sql/sql_test.go.html#7933975">nullTestSpec</a></span><span class="op" id="7935436">{</span><span class="string" id="7935437">&#34;nullbool&#34;</span><span class="op" id="7935447">,</span>&nbsp;<span class="string" id="7935449">&#34;bool&#34;</span><span class="op" id="7935455">,</span>&nbsp;<span class="op" id="7935457">[</span><span class="num" id="7935458">6</span><span class="op" id="7935459">]</span><span class="ident" id="7935460"><a href="/database/sql/sql_test.go.html#7933868">nullTestRow</a></span><span class="op" id="7935471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935475">{</span><span class="ident" id="7935476"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935484">{</span><span class="ident" id="7935485">false</span><span class="op" id="7935490">,</span>&nbsp;<span class="ident" id="7935492">true</span><span class="op" id="7935496">}</span><span class="op" id="7935497">,</span>&nbsp;<span class="ident" id="7935499">true</span><span class="op" id="7935503">,</span>&nbsp;<span class="ident" id="7935505"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935513">{</span><span class="ident" id="7935514">false</span><span class="op" id="7935519">,</span>&nbsp;<span class="ident" id="7935521">true</span><span class="op" id="7935525">}</span><span class="op" id="7935526">}</span><span class="op" id="7935527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935531">{</span><span class="ident" id="7935532"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935540">{</span><span class="ident" id="7935541">true</span><span class="op" id="7935545">,</span>&nbsp;<span class="ident" id="7935547">false</span><span class="op" id="7935552">}</span><span class="op" id="7935553">,</span>&nbsp;<span class="ident" id="7935555">false</span><span class="op" id="7935560">,</span>&nbsp;<span class="ident" id="7935562"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935570">{</span><span class="ident" id="7935571">false</span><span class="op" id="7935576">,</span>&nbsp;<span class="ident" id="7935578">false</span><span class="op" id="7935583">}</span><span class="op" id="7935584">}</span><span class="op" id="7935585">,</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935589">{</span><span class="ident" id="7935590">true</span><span class="op" id="7935594">,</span>&nbsp;<span class="ident" id="7935596">true</span><span class="op" id="7935600">,</span>&nbsp;<span class="ident" id="7935602"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935610">{</span><span class="ident" id="7935611">true</span><span class="op" id="7935615">,</span>&nbsp;<span class="ident" id="7935617">true</span><span class="op" id="7935621">}</span><span class="op" id="7935622">}</span><span class="op" id="7935623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935627">{</span><span class="ident" id="7935628"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935636">{</span><span class="ident" id="7935637">true</span><span class="op" id="7935641">,</span>&nbsp;<span class="ident" id="7935643">true</span><span class="op" id="7935647">}</span><span class="op" id="7935648">,</span>&nbsp;<span class="ident" id="7935650">false</span><span class="op" id="7935655">,</span>&nbsp;<span class="ident" id="7935657"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935665">{</span><span class="ident" id="7935666">true</span><span class="op" id="7935670">,</span>&nbsp;<span class="ident" id="7935672">true</span><span class="op" id="7935676">}</span><span class="op" id="7935677">}</span><span class="op" id="7935678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935682">{</span><span class="ident" id="7935683"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935691">{</span><span class="ident" id="7935692">true</span><span class="op" id="7935696">,</span>&nbsp;<span class="ident" id="7935698">false</span><span class="op" id="7935703">}</span><span class="op" id="7935704">,</span>&nbsp;<span class="ident" id="7935706">true</span><span class="op" id="7935710">,</span>&nbsp;<span class="ident" id="7935712"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935720">{</span><span class="ident" id="7935721">false</span><span class="op" id="7935726">,</span>&nbsp;<span class="ident" id="7935728">false</span><span class="op" id="7935733">}</span><span class="op" id="7935734">}</span><span class="op" id="7935735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935739">{</span><span class="ident" id="7935740">true</span><span class="op" id="7935744">,</span>&nbsp;<span class="ident" id="7935746"><a href="/database/sql/sql.go.html#5746510">NullBool</a></span><span class="op" id="7935754">{</span><span class="ident" id="7935755">true</span><span class="op" id="7935759">,</span>&nbsp;<span class="ident" id="7935761">false</span><span class="op" id="7935766">}</span><span class="op" id="7935767">,</span>&nbsp;<span class="ident" id="7935769">nil</span><span class="op" id="7935772">}</span><span class="op" id="7935773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935776">}</span><span class="op" id="7935777">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935780"><a href="/database/sql/sql_test.go.html#7935809">nullTestRun</a></span><span class="op" id="7935791">(</span><span class="ident" id="7935792"><a href="/database/sql/sql_test.go.html#7935399">t</a></span><span class="op" id="7935793">,</span>&nbsp;<span class="ident" id="7935795"><a href="/database/sql/sql_test.go.html#7935416">spec</a></span><span class="op" id="7935799">)</span><br>
<span class="lineno"></span><span class="op" id="7935801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7935804">func</span>&nbsp;<span class="ident" id="7935809">nullTestRun</span><span class="op" id="7935820">(</span><span class="ident" id="7935821">t</span>&nbsp;<span class="op" id="7935823">*</span><span class="ident" id="7935824"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7935831">.</span><span class="ident" id="7935832">T</span><span class="op" id="7935833">,</span>&nbsp;<span class="ident" id="7935835">spec</span>&nbsp;<span class="ident" id="7935840"><a href="/database/sql/sql_test.go.html#7933975">nullTestSpec</a></span><span class="op" id="7935852">)</span>&nbsp;<span class="op" id="7935854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935857">db</span>&nbsp;<span class="op" id="7935860">:=</span>&nbsp;<span class="ident" id="7935863"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7935872">(</span><span class="ident" id="7935873"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7935874">,</span>&nbsp;<span class="string" id="7935876">&#34;&#34;</span><span class="op" id="7935878">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935881">defer</span>&nbsp;<span class="ident" id="7935887"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7935894">(</span><span class="ident" id="7935895"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7935896">,</span>&nbsp;<span class="ident" id="7935898"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7935900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935903"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7935907">(</span><span class="ident" id="7935908"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7935909">,</span>&nbsp;<span class="ident" id="7935911"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7935913">,</span>&nbsp;<span class="ident" id="7935915"><a href="/database/sql/sql_test.go.html#7916639">fmt</a></span><span class="op" id="7935918">.</span><span class="ident" id="7935919">Sprintf</span><span class="op" id="7935926">(</span><span class="string" id="7935927">&#34;CREATE|t|id=int32,name=string,nullf=%s,notnullf=%s&#34;</span><span class="op" id="7935979">,</span>&nbsp;<span class="ident" id="7935981"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7935985">.</span><span class="ident" id="7935986">nullType</span><span class="op" id="7935994">,</span>&nbsp;<span class="ident" id="7935996"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936000">.</span><span class="ident" id="7936001">notNullType</span><span class="op" id="7936012">)</span><span class="op" id="7936013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7936017">//&nbsp;Inserts&nbsp;with&nbsp;db.Exec:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936043"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7936047">(</span><span class="ident" id="7936048"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936049">,</span>&nbsp;<span class="ident" id="7936051"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7936053">,</span>&nbsp;<span class="string" id="7936055">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7936096">,</span>&nbsp;<span class="num" id="7936098">1</span><span class="op" id="7936099">,</span>&nbsp;<span class="string" id="7936101">&#34;alice&#34;</span><span class="op" id="7936108">,</span>&nbsp;<span class="ident" id="7936110"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936114">.</span><span class="ident" id="7936115">rows</span><span class="op" id="7936119">[</span><span class="num" id="7936120">0</span><span class="op" id="7936121">]</span><span class="op" id="7936122">.</span><span class="ident" id="7936123">nullParam</span><span class="op" id="7936132">,</span>&nbsp;<span class="ident" id="7936134"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936138">.</span><span class="ident" id="7936139">rows</span><span class="op" id="7936143">[</span><span class="num" id="7936144">0</span><span class="op" id="7936145">]</span><span class="op" id="7936146">.</span><span class="ident" id="7936147">notNullParam</span><span class="op" id="7936159">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936162"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7936166">(</span><span class="ident" id="7936167"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936168">,</span>&nbsp;<span class="ident" id="7936170"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7936172">,</span>&nbsp;<span class="string" id="7936174">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7936215">,</span>&nbsp;<span class="num" id="7936217">2</span><span class="op" id="7936218">,</span>&nbsp;<span class="string" id="7936220">&#34;bob&#34;</span><span class="op" id="7936225">,</span>&nbsp;<span class="ident" id="7936227"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936231">.</span><span class="ident" id="7936232">rows</span><span class="op" id="7936236">[</span><span class="num" id="7936237">1</span><span class="op" id="7936238">]</span><span class="op" id="7936239">.</span><span class="ident" id="7936240">nullParam</span><span class="op" id="7936249">,</span>&nbsp;<span class="ident" id="7936251"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936255">.</span><span class="ident" id="7936256">rows</span><span class="op" id="7936260">[</span><span class="num" id="7936261">1</span><span class="op" id="7936262">]</span><span class="op" id="7936263">.</span><span class="ident" id="7936264">notNullParam</span><span class="op" id="7936276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7936280">//&nbsp;Inserts&nbsp;with&nbsp;a&nbsp;prepared&nbsp;statement:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936319">stmt</span><span class="op" id="7936323">,</span>&nbsp;<span class="ident" id="7936325">err</span>&nbsp;<span class="op" id="7936329">:=</span>&nbsp;<span class="ident" id="7936332"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7936334">.</span><span class="ident" id="7936335">Prepare</span><span class="op" id="7936342">(</span><span class="string" id="7936343">&#34;INSERT|t|id=?,name=?,nullf=?,notnullf=?&#34;</span><span class="op" id="7936384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936387">if</span>&nbsp;<span class="ident" id="7936390"><a href="/database/sql/sql_test.go.html#7936325">err</a></span>&nbsp;<span class="op" id="7936394">!=</span>&nbsp;<span class="ident" id="7936397">nil</span>&nbsp;<span class="op" id="7936401">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936405"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936406">.</span><span class="ident" id="7936407">Fatalf</span><span class="op" id="7936413">(</span><span class="string" id="7936414">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7936427">,</span>&nbsp;<span class="ident" id="7936429"><a href="/database/sql/sql_test.go.html#7936325">err</a></span><span class="op" id="7936432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936438">defer</span>&nbsp;<span class="ident" id="7936444"><a href="/database/sql/sql_test.go.html#7936319">stmt</a></span><span class="op" id="7936448">.</span><span class="ident" id="7936449">Close</span><span class="op" id="7936454">(</span><span class="op" id="7936455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936458">if</span>&nbsp;<span class="ident" id="7936461">_</span><span class="op" id="7936462">,</span>&nbsp;<span class="ident" id="7936464">err</span>&nbsp;<span class="op" id="7936468">:=</span>&nbsp;<span class="ident" id="7936471"><a href="/database/sql/sql_test.go.html#7936319">stmt</a></span><span class="op" id="7936475">.</span><span class="ident" id="7936476">Exec</span><span class="op" id="7936480">(</span><span class="num" id="7936481">3</span><span class="op" id="7936482">,</span>&nbsp;<span class="string" id="7936484">&#34;chris&#34;</span><span class="op" id="7936491">,</span>&nbsp;<span class="ident" id="7936493"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936497">.</span><span class="ident" id="7936498">rows</span><span class="op" id="7936502">[</span><span class="num" id="7936503">2</span><span class="op" id="7936504">]</span><span class="op" id="7936505">.</span><span class="ident" id="7936506">nullParam</span><span class="op" id="7936515">,</span>&nbsp;<span class="ident" id="7936517"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936521">.</span><span class="ident" id="7936522">rows</span><span class="op" id="7936526">[</span><span class="num" id="7936527">2</span><span class="op" id="7936528">]</span><span class="op" id="7936529">.</span><span class="ident" id="7936530">notNullParam</span><span class="op" id="7936542">)</span><span class="op" id="7936543">;</span>&nbsp;<span class="ident" id="7936545"><a href="/database/sql/sql_test.go.html#7936464">err</a></span>&nbsp;<span class="op" id="7936549">!=</span>&nbsp;<span class="ident" id="7936552">nil</span>&nbsp;<span class="op" id="7936556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936560"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936561">.</span><span class="ident" id="7936562">Errorf</span><span class="op" id="7936568">(</span><span class="string" id="7936569">&#34;exec&nbsp;insert&nbsp;chris:&nbsp;%v&#34;</span><span class="op" id="7936592">,</span>&nbsp;<span class="ident" id="7936594"><a href="/database/sql/sql_test.go.html#7936464">err</a></span><span class="op" id="7936597">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936603">if</span>&nbsp;<span class="ident" id="7936606">_</span><span class="op" id="7936607">,</span>&nbsp;<span class="ident" id="7936609">err</span>&nbsp;<span class="op" id="7936613">:=</span>&nbsp;<span class="ident" id="7936616"><a href="/database/sql/sql_test.go.html#7936319">stmt</a></span><span class="op" id="7936620">.</span><span class="ident" id="7936621">Exec</span><span class="op" id="7936625">(</span><span class="num" id="7936626">4</span><span class="op" id="7936627">,</span>&nbsp;<span class="string" id="7936629">&#34;dave&#34;</span><span class="op" id="7936635">,</span>&nbsp;<span class="ident" id="7936637"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936641">.</span><span class="ident" id="7936642">rows</span><span class="op" id="7936646">[</span><span class="num" id="7936647">3</span><span class="op" id="7936648">]</span><span class="op" id="7936649">.</span><span class="ident" id="7936650">nullParam</span><span class="op" id="7936659">,</span>&nbsp;<span class="ident" id="7936661"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936665">.</span><span class="ident" id="7936666">rows</span><span class="op" id="7936670">[</span><span class="num" id="7936671">3</span><span class="op" id="7936672">]</span><span class="op" id="7936673">.</span><span class="ident" id="7936674">notNullParam</span><span class="op" id="7936686">)</span><span class="op" id="7936687">;</span>&nbsp;<span class="ident" id="7936689"><a href="/database/sql/sql_test.go.html#7936609">err</a></span>&nbsp;<span class="op" id="7936693">!=</span>&nbsp;<span class="ident" id="7936696">nil</span>&nbsp;<span class="op" id="7936700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936704"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936705">.</span><span class="ident" id="7936706">Errorf</span><span class="op" id="7936712">(</span><span class="string" id="7936713">&#34;exec&nbsp;insert&nbsp;dave:&nbsp;%v&#34;</span><span class="op" id="7936735">,</span>&nbsp;<span class="ident" id="7936737"><a href="/database/sql/sql_test.go.html#7936609">err</a></span><span class="op" id="7936740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936746">if</span>&nbsp;<span class="ident" id="7936749">_</span><span class="op" id="7936750">,</span>&nbsp;<span class="ident" id="7936752">err</span>&nbsp;<span class="op" id="7936756">:=</span>&nbsp;<span class="ident" id="7936759"><a href="/database/sql/sql_test.go.html#7936319">stmt</a></span><span class="op" id="7936763">.</span><span class="ident" id="7936764">Exec</span><span class="op" id="7936768">(</span><span class="num" id="7936769">5</span><span class="op" id="7936770">,</span>&nbsp;<span class="string" id="7936772">&#34;eleanor&#34;</span><span class="op" id="7936781">,</span>&nbsp;<span class="ident" id="7936783"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936787">.</span><span class="ident" id="7936788">rows</span><span class="op" id="7936792">[</span><span class="num" id="7936793">4</span><span class="op" id="7936794">]</span><span class="op" id="7936795">.</span><span class="ident" id="7936796">nullParam</span><span class="op" id="7936805">,</span>&nbsp;<span class="ident" id="7936807"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936811">.</span><span class="ident" id="7936812">rows</span><span class="op" id="7936816">[</span><span class="num" id="7936817">4</span><span class="op" id="7936818">]</span><span class="op" id="7936819">.</span><span class="ident" id="7936820">notNullParam</span><span class="op" id="7936832">)</span><span class="op" id="7936833">;</span>&nbsp;<span class="ident" id="7936835"><a href="/database/sql/sql_test.go.html#7936752">err</a></span>&nbsp;<span class="op" id="7936839">!=</span>&nbsp;<span class="ident" id="7936842">nil</span>&nbsp;<span class="op" id="7936846">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936850"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7936851">.</span><span class="ident" id="7936852">Errorf</span><span class="op" id="7936858">(</span><span class="string" id="7936859">&#34;exec&nbsp;insert&nbsp;eleanor:&nbsp;%v&#34;</span><span class="op" id="7936884">,</span>&nbsp;<span class="ident" id="7936886"><a href="/database/sql/sql_test.go.html#7936752">err</a></span><span class="op" id="7936889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7936896">//&nbsp;Can&#39;t&nbsp;put&nbsp;null&nbsp;val&nbsp;into&nbsp;non-null&nbsp;col</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936937">if</span>&nbsp;<span class="ident" id="7936940">_</span><span class="op" id="7936941">,</span>&nbsp;<span class="ident" id="7936943">err</span>&nbsp;<span class="op" id="7936947">:=</span>&nbsp;<span class="ident" id="7936950"><a href="/database/sql/sql_test.go.html#7936319">stmt</a></span><span class="op" id="7936954">.</span><span class="ident" id="7936955">Exec</span><span class="op" id="7936959">(</span><span class="num" id="7936960">6</span><span class="op" id="7936961">,</span>&nbsp;<span class="string" id="7936963">&#34;bob&#34;</span><span class="op" id="7936968">,</span>&nbsp;<span class="ident" id="7936970"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936974">.</span><span class="ident" id="7936975">rows</span><span class="op" id="7936979">[</span><span class="num" id="7936980">5</span><span class="op" id="7936981">]</span><span class="op" id="7936982">.</span><span class="ident" id="7936983">nullParam</span><span class="op" id="7936992">,</span>&nbsp;<span class="ident" id="7936994"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7936998">.</span><span class="ident" id="7936999">rows</span><span class="op" id="7937003">[</span><span class="num" id="7937004">5</span><span class="op" id="7937005">]</span><span class="op" id="7937006">.</span><span class="ident" id="7937007">notNullParam</span><span class="op" id="7937019">)</span><span class="op" id="7937020">;</span>&nbsp;<span class="ident" id="7937022"><a href="/database/sql/sql_test.go.html#7936943">err</a></span>&nbsp;<span class="op" id="7937026">==</span>&nbsp;<span class="ident" id="7937029">nil</span>&nbsp;<span class="op" id="7937033">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937037"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7937038">.</span><span class="ident" id="7937039">Errorf</span><span class="op" id="7937045">(</span><span class="string" id="7937046">&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;val&nbsp;with&nbsp;prepared&nbsp;statement&nbsp;Exec&#34;</span><span class="op" id="7937109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937116">_</span><span class="op" id="7937117">,</span>&nbsp;<span class="ident" id="7937119"><a href="/database/sql/sql_test.go.html#7936325">err</a></span>&nbsp;<span class="op" id="7937123">=</span>&nbsp;<span class="ident" id="7937125"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7937127">.</span><span class="ident" id="7937128">Exec</span><span class="op" id="7937132">(</span><span class="string" id="7937133">&#34;INSERT|t|id=?,name=?,nullf=?&#34;</span><span class="op" id="7937163">,</span>&nbsp;<span class="num" id="7937165">999</span><span class="op" id="7937168">,</span>&nbsp;<span class="ident" id="7937170">nil</span><span class="op" id="7937173">,</span>&nbsp;<span class="ident" id="7937175">nil</span><span class="op" id="7937178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937181">if</span>&nbsp;<span class="ident" id="7937184"><a href="/database/sql/sql_test.go.html#7936325">err</a></span>&nbsp;<span class="op" id="7937188">==</span>&nbsp;<span class="ident" id="7937191">nil</span>&nbsp;<span class="op" id="7937195">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937199">//&nbsp;TODO:&nbsp;this&nbsp;test&nbsp;fails,&nbsp;but&nbsp;it&#39;s&nbsp;just&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937249">//&nbsp;fakeConn&nbsp;implements&nbsp;the&nbsp;optional&nbsp;Execer&nbsp;interface,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937305">//&nbsp;so&nbsp;arguably&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;behavior.&nbsp;&nbsp;But</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937357">//&nbsp;maybe&nbsp;I&nbsp;should&nbsp;flesh&nbsp;out&nbsp;the&nbsp;fakeConn.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937405">//&nbsp;implementation&nbsp;so&nbsp;this&nbsp;properly&nbsp;fails.</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7937449">//&nbsp;t.Errorf(&#34;expected&nbsp;error&nbsp;inserting&nbsp;nil&nbsp;name&nbsp;with&nbsp;Exec&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937513">paramtype</span>&nbsp;<span class="op" id="7937523">:=</span>&nbsp;<span class="ident" id="7937526"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7937533">.</span><span class="ident" id="7937534">TypeOf</span><span class="op" id="7937540">(</span><span class="ident" id="7937541"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7937545">.</span><span class="ident" id="7937546">rows</span><span class="op" id="7937550">[</span><span class="num" id="7937551">0</span><span class="op" id="7937552">]</span><span class="op" id="7937553">.</span><span class="ident" id="7937554">nullParam</span><span class="op" id="7937563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937566">bindVal</span>&nbsp;<span class="op" id="7937574">:=</span>&nbsp;<span class="ident" id="7937577"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7937584">.</span><span class="ident" id="7937585">New</span><span class="op" id="7937588">(</span><span class="ident" id="7937589"><a href="/database/sql/sql_test.go.html#7937513">paramtype</a></span><span class="op" id="7937598">)</span><span class="op" id="7937599">.</span><span class="ident" id="7937600">Interface</span><span class="op" id="7937609">(</span><span class="op" id="7937610">)</span><br>
<span class="lineno">830</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937614">for</span>&nbsp;<span class="ident" id="7937618">i</span>&nbsp;<span class="op" id="7937620">:=</span>&nbsp;<span class="num" id="7937623">0</span><span class="op" id="7937624">;</span>&nbsp;<span class="ident" id="7937626"><a href="/database/sql/sql_test.go.html#7937618">i</a></span>&nbsp;<span class="op" id="7937628">&lt;</span>&nbsp;<span class="num" id="7937630">5</span><span class="op" id="7937631">;</span>&nbsp;<span class="ident" id="7937633"><a href="/database/sql/sql_test.go.html#7937618">i</a></span><span class="op" id="7937634">++</span>&nbsp;<span class="op" id="7937637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937641">id</span>&nbsp;<span class="op" id="7937644">:=</span>&nbsp;<span class="ident" id="7937647"><a href="/database/sql/sql_test.go.html#7937618">i</a></span>&nbsp;<span class="op" id="7937649">+</span>&nbsp;<span class="num" id="7937651">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937655">if</span>&nbsp;<span class="ident" id="7937658">err</span>&nbsp;<span class="op" id="7937662">:=</span>&nbsp;<span class="ident" id="7937665"><a href="/database/sql/sql_test.go.html#7935857">db</a></span><span class="op" id="7937667">.</span><span class="ident" id="7937668">QueryRow</span><span class="op" id="7937676">(</span><span class="string" id="7937677">&#34;SELECT|t|nullf|id=?&#34;</span><span class="op" id="7937698">,</span>&nbsp;<span class="ident" id="7937700"><a href="/database/sql/sql_test.go.html#7937641">id</a></span><span class="op" id="7937702">)</span><span class="op" id="7937703">.</span><span class="ident" id="7937704">Scan</span><span class="op" id="7937708">(</span><span class="ident" id="7937709"><a href="/database/sql/sql_test.go.html#7937566">bindVal</a></span><span class="op" id="7937716">)</span><span class="op" id="7937717">;</span>&nbsp;<span class="ident" id="7937719"><a href="/database/sql/sql_test.go.html#7937658">err</a></span>&nbsp;<span class="op" id="7937723">!=</span>&nbsp;<span class="ident" id="7937726">nil</span>&nbsp;<span class="op" id="7937730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937735"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7937736">.</span><span class="ident" id="7937737">Errorf</span><span class="op" id="7937743">(</span><span class="string" id="7937744">&#34;id=%d&nbsp;Scan:&nbsp;%v&#34;</span><span class="op" id="7937760">,</span>&nbsp;<span class="ident" id="7937762"><a href="/database/sql/sql_test.go.html#7937641">id</a></span><span class="op" id="7937764">,</span>&nbsp;<span class="ident" id="7937766"><a href="/database/sql/sql_test.go.html#7937658">err</a></span><span class="op" id="7937769">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937777">bindValDeref</span>&nbsp;<span class="op" id="7937790">:=</span>&nbsp;<span class="ident" id="7937793"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7937800">.</span><span class="ident" id="7937801">ValueOf</span><span class="op" id="7937808">(</span><span class="ident" id="7937809"><a href="/database/sql/sql_test.go.html#7937566">bindVal</a></span><span class="op" id="7937816">)</span><span class="op" id="7937817">.</span><span class="ident" id="7937818">Elem</span><span class="op" id="7937822">(</span><span class="op" id="7937823">)</span><span class="op" id="7937824">.</span><span class="ident" id="7937825">Interface</span><span class="op" id="7937834">(</span><span class="op" id="7937835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937839">if</span>&nbsp;<span class="op" id="7937842">!</span><span class="ident" id="7937843"><a href="/database/sql/sql_test.go.html#7916659">reflect</a></span><span class="op" id="7937850">.</span><span class="ident" id="7937851">DeepEqual</span><span class="op" id="7937860">(</span><span class="ident" id="7937861"><a href="/database/sql/sql_test.go.html#7937777">bindValDeref</a></span><span class="op" id="7937873">,</span>&nbsp;<span class="ident" id="7937875"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7937879">.</span><span class="ident" id="7937880">rows</span><span class="op" id="7937884">[</span><span class="ident" id="7937885"><a href="/database/sql/sql_test.go.html#7937618">i</a></span><span class="op" id="7937886">]</span><span class="op" id="7937887">.</span><span class="ident" id="7937888">scanNullVal</span><span class="op" id="7937899">)</span>&nbsp;<span class="op" id="7937901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937906"><a href="/database/sql/sql_test.go.html#7935821">t</a></span><span class="op" id="7937907">.</span><span class="ident" id="7937908">Errorf</span><span class="op" id="7937914">(</span><span class="string" id="7937915">&#34;id=%d&nbsp;got&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7937940">,</span>&nbsp;<span class="ident" id="7937942"><a href="/database/sql/sql_test.go.html#7937641">id</a></span><span class="op" id="7937944">,</span>&nbsp;<span class="ident" id="7937946"><a href="/database/sql/sql_test.go.html#7937777">bindValDeref</a></span><span class="op" id="7937958">,</span>&nbsp;<span class="ident" id="7937960"><a href="/database/sql/sql_test.go.html#7935835">spec</a></span><span class="op" id="7937964">.</span><span class="ident" id="7937965">rows</span><span class="op" id="7937969">[</span><span class="ident" id="7937970"><a href="/database/sql/sql_test.go.html#7937618">i</a></span><span class="op" id="7937971">]</span><span class="op" id="7937972">.</span><span class="ident" id="7937973">scanNullVal</span><span class="op" id="7937984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937988">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937991">}</span><br>
<span class="lineno"></span><span class="op" id="7937993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7937996">//&nbsp;golang.org/issue/4859</span><br>
<span class="lineno"></span><span class="keyword" id="7938021">func</span>&nbsp;<span class="ident" id="7938026">TestQueryRowNilScanDest</span><span class="op" id="7938049">(</span><span class="ident" id="7938050">t</span>&nbsp;<span class="op" id="7938052">*</span><span class="ident" id="7938053"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7938060">.</span><span class="ident" id="7938061">T</span><span class="op" id="7938062">)</span>&nbsp;<span class="op" id="7938064">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938067">db</span>&nbsp;<span class="op" id="7938070">:=</span>&nbsp;<span class="ident" id="7938073"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7938082">(</span><span class="ident" id="7938083"><a href="/database/sql/sql_test.go.html#7938050">t</a></span><span class="op" id="7938084">,</span>&nbsp;<span class="string" id="7938086">&#34;people&#34;</span><span class="op" id="7938094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938097">defer</span>&nbsp;<span class="ident" id="7938103"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7938110">(</span><span class="ident" id="7938111"><a href="/database/sql/sql_test.go.html#7938050">t</a></span><span class="op" id="7938112">,</span>&nbsp;<span class="ident" id="7938114"><a href="/database/sql/sql_test.go.html#7938067">db</a></span><span class="op" id="7938116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938119">var</span>&nbsp;<span class="ident" id="7938123">name</span>&nbsp;<span class="op" id="7938128">*</span><span class="builtintype" id="7938129">string</span>&nbsp;<span class="comment" id="7938136">//&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938152">err</span>&nbsp;<span class="op" id="7938156">:=</span>&nbsp;<span class="ident" id="7938159"><a href="/database/sql/sql_test.go.html#7938067">db</a></span><span class="op" id="7938161">.</span><span class="ident" id="7938162">QueryRow</span><span class="op" id="7938170">(</span><span class="string" id="7938171">&#34;SELECT|people|name|&#34;</span><span class="op" id="7938192">)</span><span class="op" id="7938193">.</span><span class="ident" id="7938194">Scan</span><span class="op" id="7938198">(</span><span class="ident" id="7938199"><a href="/database/sql/sql_test.go.html#7938123">name</a></span><span class="op" id="7938203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938206">want</span>&nbsp;<span class="op" id="7938211">:=</span>&nbsp;<span class="string" id="7938214">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;0:&nbsp;destination&nbsp;pointer&nbsp;is&nbsp;nil&#34;</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938279">if</span>&nbsp;<span class="ident" id="7938282"><a href="/database/sql/sql_test.go.html#7938152">err</a></span>&nbsp;<span class="op" id="7938286">==</span>&nbsp;<span class="ident" id="7938289">nil</span>&nbsp;<span class="op" id="7938293">||</span>&nbsp;<span class="ident" id="7938296"><a href="/database/sql/sql_test.go.html#7938152">err</a></span><span class="op" id="7938299">.</span><span class="ident" id="7938300">Error</span><span class="op" id="7938305">(</span><span class="op" id="7938306">)</span>&nbsp;<span class="op" id="7938308">!=</span>&nbsp;<span class="ident" id="7938311"><a href="/database/sql/sql_test.go.html#7938206">want</a></span>&nbsp;<span class="op" id="7938316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938320"><a href="/database/sql/sql_test.go.html#7938050">t</a></span><span class="op" id="7938321">.</span><span class="ident" id="7938322">Errorf</span><span class="op" id="7938328">(</span><span class="string" id="7938329">&#34;error&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7938350">,</span>&nbsp;<span class="ident" id="7938352"><a href="/database/sql/sql_test.go.html#7938152">err</a></span><span class="op" id="7938355">.</span><span class="ident" id="7938356">Error</span><span class="op" id="7938361">(</span><span class="op" id="7938362">)</span><span class="op" id="7938363">,</span>&nbsp;<span class="ident" id="7938365"><a href="/database/sql/sql_test.go.html#7938206">want</a></span><span class="op" id="7938369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938372">}</span><br>
<span class="lineno"></span><span class="op" id="7938374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">855</span><span class="keyword" id="7938377">func</span>&nbsp;<span class="ident" id="7938382">TestIssue4902</span><span class="op" id="7938395">(</span><span class="ident" id="7938396">t</span>&nbsp;<span class="op" id="7938398">*</span><span class="ident" id="7938399"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7938406">.</span><span class="ident" id="7938407">T</span><span class="op" id="7938408">)</span>&nbsp;<span class="op" id="7938410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938413">db</span>&nbsp;<span class="op" id="7938416">:=</span>&nbsp;<span class="ident" id="7938419"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7938428">(</span><span class="ident" id="7938429"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938430">,</span>&nbsp;<span class="string" id="7938432">&#34;people&#34;</span><span class="op" id="7938440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938443">defer</span>&nbsp;<span class="ident" id="7938449"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7938456">(</span><span class="ident" id="7938457"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938458">,</span>&nbsp;<span class="ident" id="7938460"><a href="/database/sql/sql_test.go.html#7938413">db</a></span><span class="op" id="7938462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938466">driver</span>&nbsp;<span class="op" id="7938473">:=</span>&nbsp;<span class="ident" id="7938476"><a href="/database/sql/sql_test.go.html#7938413">db</a></span><span class="op" id="7938478">.</span><span class="ident" id="7938479">driver</span><span class="op" id="7938485">.</span><span class="op" id="7938486">(</span><span class="op" id="7938487">*</span><span class="ident" id="7938488"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7938498">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938501">opens0</span>&nbsp;<span class="op" id="7938508">:=</span>&nbsp;<span class="ident" id="7938511"><a href="/database/sql/sql_test.go.html#7938466">driver</a></span><span class="op" id="7938517">.</span><span class="ident" id="7938518">openCount</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938530">var</span>&nbsp;<span class="ident" id="7938534">stmt</span>&nbsp;<span class="op" id="7938539">*</span><span class="ident" id="7938540"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938546">var</span>&nbsp;<span class="ident" id="7938550">err</span>&nbsp;<span class="builtintype" id="7938554">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938561">for</span>&nbsp;<span class="ident" id="7938565">i</span>&nbsp;<span class="op" id="7938567">:=</span>&nbsp;<span class="num" id="7938570">0</span><span class="op" id="7938571">;</span>&nbsp;<span class="ident" id="7938573"><a href="/database/sql/sql_test.go.html#7938565">i</a></span>&nbsp;<span class="op" id="7938575">&lt;</span>&nbsp;<span class="num" id="7938577">10</span><span class="op" id="7938579">;</span>&nbsp;<span class="ident" id="7938581"><a href="/database/sql/sql_test.go.html#7938565">i</a></span><span class="op" id="7938582">++</span>&nbsp;<span class="op" id="7938585">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938589"><a href="/database/sql/sql_test.go.html#7938534">stmt</a></span><span class="op" id="7938593">,</span>&nbsp;<span class="ident" id="7938595"><a href="/database/sql/sql_test.go.html#7938550">err</a></span>&nbsp;<span class="op" id="7938599">=</span>&nbsp;<span class="ident" id="7938601"><a href="/database/sql/sql_test.go.html#7938413">db</a></span><span class="op" id="7938603">.</span><span class="ident" id="7938604">Prepare</span><span class="op" id="7938611">(</span><span class="string" id="7938612">&#34;SELECT|people|name|&#34;</span><span class="op" id="7938633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938637">if</span>&nbsp;<span class="ident" id="7938640"><a href="/database/sql/sql_test.go.html#7938550">err</a></span>&nbsp;<span class="op" id="7938644">!=</span>&nbsp;<span class="ident" id="7938647">nil</span>&nbsp;<span class="op" id="7938651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938656"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938657">.</span><span class="ident" id="7938658">Fatal</span><span class="op" id="7938663">(</span><span class="ident" id="7938664"><a href="/database/sql/sql_test.go.html#7938550">err</a></span><span class="op" id="7938667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938675"><a href="/database/sql/sql_test.go.html#7938550">err</a></span>&nbsp;<span class="op" id="7938679">=</span>&nbsp;<span class="ident" id="7938681"><a href="/database/sql/sql_test.go.html#7938534">stmt</a></span><span class="op" id="7938685">.</span><span class="ident" id="7938686">Close</span><span class="op" id="7938691">(</span><span class="op" id="7938692">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938696">if</span>&nbsp;<span class="ident" id="7938699"><a href="/database/sql/sql_test.go.html#7938550">err</a></span>&nbsp;<span class="op" id="7938703">!=</span>&nbsp;<span class="ident" id="7938706">nil</span>&nbsp;<span class="op" id="7938710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938715"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938716">.</span><span class="ident" id="7938717">Fatal</span><span class="op" id="7938722">(</span><span class="ident" id="7938723"><a href="/database/sql/sql_test.go.html#7938550">err</a></span><span class="op" id="7938726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938737">opens</span>&nbsp;<span class="op" id="7938743">:=</span>&nbsp;<span class="ident" id="7938746"><a href="/database/sql/sql_test.go.html#7938466">driver</a></span><span class="op" id="7938752">.</span><span class="ident" id="7938753">openCount</span>&nbsp;<span class="op" id="7938763">-</span>&nbsp;<span class="ident" id="7938765"><a href="/database/sql/sql_test.go.html#7938501">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938773">if</span>&nbsp;<span class="ident" id="7938776"><a href="/database/sql/sql_test.go.html#7938737">opens</a></span>&nbsp;<span class="op" id="7938782">&gt;</span>&nbsp;<span class="num" id="7938784">1</span>&nbsp;<span class="op" id="7938786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938790"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938791">.</span><span class="ident" id="7938792">Errorf</span><span class="op" id="7938798">(</span><span class="string" id="7938799">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7938822">,</span>&nbsp;<span class="ident" id="7938824"><a href="/database/sql/sql_test.go.html#7938737">opens</a></span><span class="op" id="7938829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938833"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938834">.</span><span class="ident" id="7938835">Logf</span><span class="op" id="7938839">(</span><span class="string" id="7938840">&#34;db&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7938850">,</span>&nbsp;<span class="ident" id="7938852"><a href="/database/sql/sql_test.go.html#7938413">db</a></span><span class="op" id="7938854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938858"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938859">.</span><span class="ident" id="7938860">Logf</span><span class="op" id="7938864">(</span><span class="string" id="7938865">&#34;driver&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7938879">,</span>&nbsp;<span class="ident" id="7938881"><a href="/database/sql/sql_test.go.html#7938466">driver</a></span><span class="op" id="7938887">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938891"><a href="/database/sql/sql_test.go.html#7938396">t</a></span><span class="op" id="7938892">.</span><span class="ident" id="7938893">Logf</span><span class="op" id="7938897">(</span><span class="string" id="7938898">&#34;stmt&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7938910">,</span>&nbsp;<span class="ident" id="7938912"><a href="/database/sql/sql_test.go.html#7938534">stmt</a></span><span class="op" id="7938916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938919">}</span><br>
<span class="lineno"></span><span class="op" id="7938921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7938924">//&nbsp;Issue&nbsp;3857</span><br>
<span class="lineno">885</span><span class="comment" id="7938938">//&nbsp;This&nbsp;used&nbsp;to&nbsp;deadlock.</span><br>
<span class="lineno"></span><span class="keyword" id="7938964">func</span>&nbsp;<span class="ident" id="7938969">TestSimultaneousQueries</span><span class="op" id="7938992">(</span><span class="ident" id="7938993">t</span>&nbsp;<span class="op" id="7938995">*</span><span class="ident" id="7938996"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7939003">.</span><span class="ident" id="7939004">T</span><span class="op" id="7939005">)</span>&nbsp;<span class="op" id="7939007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939010">db</span>&nbsp;<span class="op" id="7939013">:=</span>&nbsp;<span class="ident" id="7939016"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7939025">(</span><span class="ident" id="7939026"><a href="/database/sql/sql_test.go.html#7938993">t</a></span><span class="op" id="7939027">,</span>&nbsp;<span class="string" id="7939029">&#34;people&#34;</span><span class="op" id="7939037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939040">defer</span>&nbsp;<span class="ident" id="7939046"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7939053">(</span><span class="ident" id="7939054"><a href="/database/sql/sql_test.go.html#7938993">t</a></span><span class="op" id="7939055">,</span>&nbsp;<span class="ident" id="7939057"><a href="/database/sql/sql_test.go.html#7939010">db</a></span><span class="op" id="7939059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939063">tx</span><span class="op" id="7939065">,</span>&nbsp;<span class="ident" id="7939067">err</span>&nbsp;<span class="op" id="7939071">:=</span>&nbsp;<span class="ident" id="7939074"><a href="/database/sql/sql_test.go.html#7939010">db</a></span><span class="op" id="7939076">.</span><span class="ident" id="7939077">Begin</span><span class="op" id="7939082">(</span><span class="op" id="7939083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939086">if</span>&nbsp;<span class="ident" id="7939089"><a href="/database/sql/sql_test.go.html#7939067">err</a></span>&nbsp;<span class="op" id="7939093">!=</span>&nbsp;<span class="ident" id="7939096">nil</span>&nbsp;<span class="op" id="7939100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939104"><a href="/database/sql/sql_test.go.html#7938993">t</a></span><span class="op" id="7939105">.</span><span class="ident" id="7939106">Fatal</span><span class="op" id="7939111">(</span><span class="ident" id="7939112"><a href="/database/sql/sql_test.go.html#7939067">err</a></span><span class="op" id="7939115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939121">defer</span>&nbsp;<span class="ident" id="7939127"><a href="/database/sql/sql_test.go.html#7939063">tx</a></span><span class="op" id="7939129">.</span><span class="ident" id="7939130">Rollback</span><span class="op" id="7939138">(</span><span class="op" id="7939139">)</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939143">r1</span><span class="op" id="7939145">,</span>&nbsp;<span class="ident" id="7939147"><a href="/database/sql/sql_test.go.html#7939067">err</a></span>&nbsp;<span class="op" id="7939151">:=</span>&nbsp;<span class="ident" id="7939154"><a href="/database/sql/sql_test.go.html#7939063">tx</a></span><span class="op" id="7939156">.</span><span class="ident" id="7939157">Query</span><span class="op" id="7939162">(</span><span class="string" id="7939163">&#34;SELECT|people|name|&#34;</span><span class="op" id="7939184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939187">if</span>&nbsp;<span class="ident" id="7939190"><a href="/database/sql/sql_test.go.html#7939067">err</a></span>&nbsp;<span class="op" id="7939194">!=</span>&nbsp;<span class="ident" id="7939197">nil</span>&nbsp;<span class="op" id="7939201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939205"><a href="/database/sql/sql_test.go.html#7938993">t</a></span><span class="op" id="7939206">.</span><span class="ident" id="7939207">Fatal</span><span class="op" id="7939212">(</span><span class="ident" id="7939213"><a href="/database/sql/sql_test.go.html#7939067">err</a></span><span class="op" id="7939216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939219">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939222">defer</span>&nbsp;<span class="ident" id="7939228"><a href="/database/sql/sql_test.go.html#7939143">r1</a></span><span class="op" id="7939230">.</span><span class="ident" id="7939231">Close</span><span class="op" id="7939236">(</span><span class="op" id="7939237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939241">r2</span><span class="op" id="7939243">,</span>&nbsp;<span class="ident" id="7939245"><a href="/database/sql/sql_test.go.html#7939067">err</a></span>&nbsp;<span class="op" id="7939249">:=</span>&nbsp;<span class="ident" id="7939252"><a href="/database/sql/sql_test.go.html#7939063">tx</a></span><span class="op" id="7939254">.</span><span class="ident" id="7939255">Query</span><span class="op" id="7939260">(</span><span class="string" id="7939261">&#34;SELECT|people|name|&#34;</span><span class="op" id="7939282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939285">if</span>&nbsp;<span class="ident" id="7939288"><a href="/database/sql/sql_test.go.html#7939067">err</a></span>&nbsp;<span class="op" id="7939292">!=</span>&nbsp;<span class="ident" id="7939295">nil</span>&nbsp;<span class="op" id="7939299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939303"><a href="/database/sql/sql_test.go.html#7938993">t</a></span><span class="op" id="7939304">.</span><span class="ident" id="7939305">Fatal</span><span class="op" id="7939310">(</span><span class="ident" id="7939311"><a href="/database/sql/sql_test.go.html#7939067">err</a></span><span class="op" id="7939314">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939320">defer</span>&nbsp;<span class="ident" id="7939326"><a href="/database/sql/sql_test.go.html#7939241">r2</a></span><span class="op" id="7939328">.</span><span class="ident" id="7939329">Close</span><span class="op" id="7939334">(</span><span class="op" id="7939335">)</span><br>
<span class="lineno"></span><span class="op" id="7939337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7939340">func</span>&nbsp;<span class="ident" id="7939345">TestMaxIdleConns</span><span class="op" id="7939361">(</span><span class="ident" id="7939362">t</span>&nbsp;<span class="op" id="7939364">*</span><span class="ident" id="7939365"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7939372">.</span><span class="ident" id="7939373">T</span><span class="op" id="7939374">)</span>&nbsp;<span class="op" id="7939376">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939379">db</span>&nbsp;<span class="op" id="7939382">:=</span>&nbsp;<span class="ident" id="7939385"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7939394">(</span><span class="ident" id="7939395"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939396">,</span>&nbsp;<span class="string" id="7939398">&#34;people&#34;</span><span class="op" id="7939406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939409">defer</span>&nbsp;<span class="ident" id="7939415"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7939422">(</span><span class="ident" id="7939423"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939424">,</span>&nbsp;<span class="ident" id="7939426"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939432">tx</span><span class="op" id="7939434">,</span>&nbsp;<span class="ident" id="7939436">err</span>&nbsp;<span class="op" id="7939440">:=</span>&nbsp;<span class="ident" id="7939443"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939445">.</span><span class="ident" id="7939446">Begin</span><span class="op" id="7939451">(</span><span class="op" id="7939452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939455">if</span>&nbsp;<span class="ident" id="7939458"><a href="/database/sql/sql_test.go.html#7939436">err</a></span>&nbsp;<span class="op" id="7939462">!=</span>&nbsp;<span class="ident" id="7939465">nil</span>&nbsp;<span class="op" id="7939469">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939473"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939474">.</span><span class="ident" id="7939475">Fatal</span><span class="op" id="7939480">(</span><span class="ident" id="7939481"><a href="/database/sql/sql_test.go.html#7939436">err</a></span><span class="op" id="7939484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939490"><a href="/database/sql/sql_test.go.html#7939432">tx</a></span><span class="op" id="7939492">.</span><span class="ident" id="7939493">Commit</span><span class="op" id="7939499">(</span><span class="op" id="7939500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939503">if</span>&nbsp;<span class="ident" id="7939506">got</span>&nbsp;<span class="op" id="7939510">:=</span>&nbsp;<span class="builtinfunc" id="7939513">len</span><span class="op" id="7939516">(</span><span class="ident" id="7939517"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939519">.</span><span class="ident" id="7939520">freeConn</span><span class="op" id="7939528">)</span><span class="op" id="7939529">;</span>&nbsp;<span class="ident" id="7939531"><a href="/database/sql/sql_test.go.html#7939506">got</a></span>&nbsp;<span class="op" id="7939535">!=</span>&nbsp;<span class="num" id="7939538">1</span>&nbsp;<span class="op" id="7939540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939544"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939545">.</span><span class="ident" id="7939546">Errorf</span><span class="op" id="7939552">(</span><span class="string" id="7939553">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7939577">,</span>&nbsp;<span class="ident" id="7939579"><a href="/database/sql/sql_test.go.html#7939506">got</a></span><span class="op" id="7939582">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939589"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939591">.</span><span class="ident" id="7939592">SetMaxIdleConns</span><span class="op" id="7939607">(</span><span class="num" id="7939608">0</span><span class="op" id="7939609">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939613">if</span>&nbsp;<span class="ident" id="7939616">got</span>&nbsp;<span class="op" id="7939620">:=</span>&nbsp;<span class="builtinfunc" id="7939623">len</span><span class="op" id="7939626">(</span><span class="ident" id="7939627"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939629">.</span><span class="ident" id="7939630">freeConn</span><span class="op" id="7939638">)</span><span class="op" id="7939639">;</span>&nbsp;<span class="ident" id="7939641"><a href="/database/sql/sql_test.go.html#7939616">got</a></span>&nbsp;<span class="op" id="7939645">!=</span>&nbsp;<span class="num" id="7939648">0</span>&nbsp;<span class="op" id="7939650">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939654"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939655">.</span><span class="ident" id="7939656">Errorf</span><span class="op" id="7939662">(</span><span class="string" id="7939663">&#34;freeConns&nbsp;after&nbsp;set&nbsp;to&nbsp;zero&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7939705">,</span>&nbsp;<span class="ident" id="7939707"><a href="/database/sql/sql_test.go.html#7939616">got</a></span><span class="op" id="7939710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939717"><a href="/database/sql/sql_test.go.html#7939432">tx</a></span><span class="op" id="7939719">,</span>&nbsp;<span class="ident" id="7939721"><a href="/database/sql/sql_test.go.html#7939436">err</a></span>&nbsp;<span class="op" id="7939725">=</span>&nbsp;<span class="ident" id="7939727"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939729">.</span><span class="ident" id="7939730">Begin</span><span class="op" id="7939735">(</span><span class="op" id="7939736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939739">if</span>&nbsp;<span class="ident" id="7939742"><a href="/database/sql/sql_test.go.html#7939436">err</a></span>&nbsp;<span class="op" id="7939746">!=</span>&nbsp;<span class="ident" id="7939749">nil</span>&nbsp;<span class="op" id="7939753">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939757"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939758">.</span><span class="ident" id="7939759">Fatal</span><span class="op" id="7939764">(</span><span class="ident" id="7939765"><a href="/database/sql/sql_test.go.html#7939436">err</a></span><span class="op" id="7939768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939774"><a href="/database/sql/sql_test.go.html#7939432">tx</a></span><span class="op" id="7939776">.</span><span class="ident" id="7939777">Commit</span><span class="op" id="7939783">(</span><span class="op" id="7939784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939787">if</span>&nbsp;<span class="ident" id="7939790">got</span>&nbsp;<span class="op" id="7939794">:=</span>&nbsp;<span class="builtinfunc" id="7939797">len</span><span class="op" id="7939800">(</span><span class="ident" id="7939801"><a href="/database/sql/sql_test.go.html#7939379">db</a></span><span class="op" id="7939803">.</span><span class="ident" id="7939804">freeConn</span><span class="op" id="7939812">)</span><span class="op" id="7939813">;</span>&nbsp;<span class="ident" id="7939815"><a href="/database/sql/sql_test.go.html#7939790">got</a></span>&nbsp;<span class="op" id="7939819">!=</span>&nbsp;<span class="num" id="7939822">0</span>&nbsp;<span class="op" id="7939824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939828"><a href="/database/sql/sql_test.go.html#7939362">t</a></span><span class="op" id="7939829">.</span><span class="ident" id="7939830">Errorf</span><span class="op" id="7939836">(</span><span class="string" id="7939837">&#34;freeConns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7939861">,</span>&nbsp;<span class="ident" id="7939863"><a href="/database/sql/sql_test.go.html#7939790">got</a></span><span class="op" id="7939866">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939869">}</span><br>
<span class="lineno"></span><span class="op" id="7939871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7939874">func</span>&nbsp;<span class="ident" id="7939879">TestMaxOpenConns</span><span class="op" id="7939895">(</span><span class="ident" id="7939896">t</span>&nbsp;<span class="op" id="7939898">*</span><span class="ident" id="7939899"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7939906">.</span><span class="ident" id="7939907">T</span><span class="op" id="7939908">)</span>&nbsp;<span class="op" id="7939910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939913">if</span>&nbsp;<span class="ident" id="7939916"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7939923">.</span><span class="ident" id="7939924">Short</span><span class="op" id="7939929">(</span><span class="op" id="7939930">)</span>&nbsp;<span class="op" id="7939932">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939936"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7939937">.</span><span class="ident" id="7939938">Skip</span><span class="op" id="7939942">(</span><span class="string" id="7939943">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7939967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939973">defer</span>&nbsp;<span class="ident" id="7939979"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7939999">(</span><span class="ident" id="7940000">nil</span><span class="op" id="7940003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940006"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7940026">(</span><span class="keyword" id="7940027">func</span><span class="op" id="7940031">(</span><span class="ident" id="7940032">_</span>&nbsp;<span class="op" id="7940034">*</span><span class="ident" id="7940035"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7940043">,</span>&nbsp;<span class="ident" id="7940045">err</span>&nbsp;<span class="builtintype" id="7940049">error</span><span class="op" id="7940054">)</span>&nbsp;<span class="op" id="7940056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940060">if</span>&nbsp;<span class="ident" id="7940063"><a href="/database/sql/sql_test.go.html#7940045">err</a></span>&nbsp;<span class="op" id="7940067">!=</span>&nbsp;<span class="ident" id="7940070">nil</span>&nbsp;<span class="op" id="7940074">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940079"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940080">.</span><span class="ident" id="7940081">Errorf</span><span class="op" id="7940087">(</span><span class="string" id="7940088">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7940116">,</span>&nbsp;<span class="ident" id="7940118"><a href="/database/sql/sql_test.go.html#7940045">err</a></span><span class="op" id="7940121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940128">}</span><span class="op" id="7940129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940133">db</span>&nbsp;<span class="op" id="7940136">:=</span>&nbsp;<span class="ident" id="7940139"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7940148">(</span><span class="ident" id="7940149"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940150">,</span>&nbsp;<span class="string" id="7940152">&#34;magicquery&#34;</span><span class="op" id="7940164">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940167">defer</span>&nbsp;<span class="ident" id="7940173"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7940180">(</span><span class="ident" id="7940181"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940182">,</span>&nbsp;<span class="ident" id="7940184"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940190">driver</span>&nbsp;<span class="op" id="7940197">:=</span>&nbsp;<span class="ident" id="7940200"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940202">.</span><span class="ident" id="7940203">driver</span><span class="op" id="7940209">.</span><span class="op" id="7940210">(</span><span class="op" id="7940211">*</span><span class="ident" id="7940212"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7940222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940226">//&nbsp;Force&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;0&nbsp;so&nbsp;we&nbsp;can&nbsp;get&nbsp;an&nbsp;accurate</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940298">//&nbsp;count&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940321"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940323">.</span><span class="ident" id="7940324">SetMaxIdleConns</span><span class="op" id="7940339">(</span><span class="num" id="7940340">0</span><span class="op" id="7940341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940345">if</span>&nbsp;<span class="ident" id="7940348">g</span><span class="op" id="7940349">,</span>&nbsp;<span class="ident" id="7940351">w</span>&nbsp;<span class="op" id="7940353">:=</span>&nbsp;<span class="ident" id="7940356"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940358">.</span><span class="ident" id="7940359">numFreeConns</span><span class="op" id="7940371">(</span><span class="op" id="7940372">)</span><span class="op" id="7940373">,</span>&nbsp;<span class="num" id="7940375">0</span><span class="op" id="7940376">;</span>&nbsp;<span class="ident" id="7940378"><a href="/database/sql/sql_test.go.html#7940348">g</a></span>&nbsp;<span class="op" id="7940380">!=</span>&nbsp;<span class="ident" id="7940383"><a href="/database/sql/sql_test.go.html#7940351">w</a></span>&nbsp;<span class="op" id="7940385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940389"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940390">.</span><span class="ident" id="7940391">Errorf</span><span class="op" id="7940397">(</span><span class="string" id="7940398">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7940424">,</span>&nbsp;<span class="ident" id="7940426"><a href="/database/sql/sql_test.go.html#7940348">g</a></span><span class="op" id="7940427">,</span>&nbsp;<span class="ident" id="7940429"><a href="/database/sql/sql_test.go.html#7940351">w</a></span><span class="op" id="7940430">)</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940437">if</span>&nbsp;<span class="ident" id="7940440">n</span>&nbsp;<span class="op" id="7940442">:=</span>&nbsp;<span class="ident" id="7940445"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940447">.</span><span class="ident" id="7940448">numDepsPollUntil</span><span class="op" id="7940464">(</span><span class="num" id="7940465">0</span><span class="op" id="7940466">,</span>&nbsp;<span class="ident" id="7940468"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7940472">.</span><span class="ident" id="7940473">Second</span><span class="op" id="7940479">)</span><span class="op" id="7940480">;</span>&nbsp;<span class="ident" id="7940482"><a href="/database/sql/sql_test.go.html#7940440">n</a></span>&nbsp;<span class="op" id="7940484">&gt;</span>&nbsp;<span class="num" id="7940486">0</span>&nbsp;<span class="op" id="7940488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940492"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940493">.</span><span class="ident" id="7940494">Errorf</span><span class="op" id="7940500">(</span><span class="string" id="7940501">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7940542">,</span>&nbsp;<span class="ident" id="7940544"><a href="/database/sql/sql_test.go.html#7940440">n</a></span><span class="op" id="7940545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940549"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940551">.</span><span class="ident" id="7940552">dumpDeps</span><span class="op" id="7940560">(</span><span class="ident" id="7940561"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940562">)</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940569"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7940575">.</span><span class="ident" id="7940576">mu</span><span class="op" id="7940578">.</span><span class="ident" id="7940579">Lock</span><span class="op" id="7940583">(</span><span class="op" id="7940584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940587">opens0</span>&nbsp;<span class="op" id="7940594">:=</span>&nbsp;<span class="ident" id="7940597"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7940603">.</span><span class="ident" id="7940604">openCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940615">closes0</span>&nbsp;<span class="op" id="7940623">:=</span>&nbsp;<span class="ident" id="7940626"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7940632">.</span><span class="ident" id="7940633">closeCount</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940645"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7940651">.</span><span class="ident" id="7940652">mu</span><span class="op" id="7940654">.</span><span class="ident" id="7940655">Unlock</span><span class="op" id="7940661">(</span><span class="op" id="7940662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940666"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940668">.</span><span class="ident" id="7940669">SetMaxIdleConns</span><span class="op" id="7940684">(</span><span class="num" id="7940685">10</span><span class="op" id="7940687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940690"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940692">.</span><span class="ident" id="7940693">SetMaxOpenConns</span><span class="op" id="7940708">(</span><span class="num" id="7940709">10</span><span class="op" id="7940711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940715">stmt</span><span class="op" id="7940719">,</span>&nbsp;<span class="ident" id="7940721">err</span>&nbsp;<span class="op" id="7940725">:=</span>&nbsp;<span class="ident" id="7940728"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7940730">.</span><span class="ident" id="7940731">Prepare</span><span class="op" id="7940738">(</span><span class="string" id="7940739">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7940775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940778">if</span>&nbsp;<span class="ident" id="7940781"><a href="/database/sql/sql_test.go.html#7940721">err</a></span>&nbsp;<span class="op" id="7940785">!=</span>&nbsp;<span class="ident" id="7940788">nil</span>&nbsp;<span class="op" id="7940792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940796"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7940797">.</span><span class="ident" id="7940798">Fatal</span><span class="op" id="7940803">(</span><span class="ident" id="7940804"><a href="/database/sql/sql_test.go.html#7940721">err</a></span><span class="op" id="7940807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940814">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940850">const</span>&nbsp;<span class="op" id="7940856">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940860">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7940872">=</span>&nbsp;<span class="num" id="7940874">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940879">sleepMillis</span>&nbsp;<span class="op" id="7940891">=</span>&nbsp;<span class="num" id="7940893">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940898">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7940910">=</span>&nbsp;<span class="num" id="7940912">2</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940918">var</span>&nbsp;<span class="ident" id="7940922">wg</span>&nbsp;<span class="ident" id="7940925"><a href="/database/sql/sql_test.go.html#7916692">sync</a></span><span class="op" id="7940929">.</span><span class="ident" id="7940930">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940941">for</span>&nbsp;<span class="ident" id="7940945">batch</span>&nbsp;<span class="op" id="7940951">:=</span>&nbsp;<span class="num" id="7940954">0</span><span class="op" id="7940955">;</span>&nbsp;<span class="ident" id="7940957"><a href="/database/sql/sql_test.go.html#7940945">batch</a></span>&nbsp;<span class="op" id="7940963">&lt;</span>&nbsp;<span class="ident" id="7940965"><a href="/database/sql/sql_test.go.html#7940898">nbatch</a></span><span class="op" id="7940971">;</span>&nbsp;<span class="ident" id="7940973"><a href="/database/sql/sql_test.go.html#7940945">batch</a></span><span class="op" id="7940978">++</span>&nbsp;<span class="op" id="7940981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940985">for</span>&nbsp;<span class="ident" id="7940989">i</span>&nbsp;<span class="op" id="7940991">:=</span>&nbsp;<span class="num" id="7940994">0</span><span class="op" id="7940995">;</span>&nbsp;<span class="ident" id="7940997"><a href="/database/sql/sql_test.go.html#7940989">i</a></span>&nbsp;<span class="op" id="7940999">&lt;</span>&nbsp;<span class="ident" id="7941001"><a href="/database/sql/sql_test.go.html#7940860">nquery</a></span><span class="op" id="7941007">;</span>&nbsp;<span class="ident" id="7941009"><a href="/database/sql/sql_test.go.html#7940989">i</a></span><span class="op" id="7941010">++</span>&nbsp;<span class="op" id="7941013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941018"><a href="/database/sql/sql_test.go.html#7940922">wg</a></span><span class="op" id="7941020">.</span><span class="ident" id="7941021">Add</span><span class="op" id="7941024">(</span><span class="num" id="7941025">1</span><span class="op" id="7941026">)</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941031">go</span>&nbsp;<span class="keyword" id="7941034">func</span><span class="op" id="7941038">(</span><span class="op" id="7941039">)</span>&nbsp;<span class="op" id="7941041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941047">defer</span>&nbsp;<span class="ident" id="7941053"><a href="/database/sql/sql_test.go.html#7940922">wg</a></span><span class="op" id="7941055">.</span><span class="ident" id="7941056">Done</span><span class="op" id="7941060">(</span><span class="op" id="7941061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941067">var</span>&nbsp;<span class="ident" id="7941071">op</span>&nbsp;<span class="builtintype" id="7941074">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941085">if</span>&nbsp;<span class="ident" id="7941088">err</span>&nbsp;<span class="op" id="7941092">:=</span>&nbsp;<span class="ident" id="7941095"><a href="/database/sql/sql_test.go.html#7940715">stmt</a></span><span class="op" id="7941099">.</span><span class="ident" id="7941100">QueryRow</span><span class="op" id="7941108">(</span><span class="string" id="7941109">&#34;sleep&#34;</span><span class="op" id="7941116">,</span>&nbsp;<span class="ident" id="7941118"><a href="/database/sql/sql_test.go.html#7940879">sleepMillis</a></span><span class="op" id="7941129">)</span><span class="op" id="7941130">.</span><span class="ident" id="7941131">Scan</span><span class="op" id="7941135">(</span><span class="op" id="7941136">&amp;</span><span class="ident" id="7941137"><a href="/database/sql/sql_test.go.html#7941071">op</a></span><span class="op" id="7941139">)</span><span class="op" id="7941140">;</span>&nbsp;<span class="ident" id="7941142"><a href="/database/sql/sql_test.go.html#7941088">err</a></span>&nbsp;<span class="op" id="7941146">!=</span>&nbsp;<span class="ident" id="7941149">nil</span>&nbsp;<span class="op" id="7941153">&amp;&amp;</span>&nbsp;<span class="ident" id="7941156"><a href="/database/sql/sql_test.go.html#7941088">err</a></span>&nbsp;<span class="op" id="7941160">!=</span>&nbsp;<span class="ident" id="7941163"><a href="/database/sql/sql.go.html#5747590">ErrNoRows</a></span>&nbsp;<span class="op" id="7941173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941180"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941181">.</span><span class="ident" id="7941182">Error</span><span class="op" id="7941187">(</span><span class="ident" id="7941188"><a href="/database/sql/sql_test.go.html#7941088">err</a></span><span class="op" id="7941191">)</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941202">}</span><span class="op" id="7941203">(</span><span class="op" id="7941204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7941212">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7941269">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7941326">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941347"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7941351">.</span><span class="ident" id="7941352">Sleep</span><span class="op" id="7941357">(</span><span class="num" id="7941358">2</span>&nbsp;<span class="op" id="7941360">*</span>&nbsp;<span class="ident" id="7941362"><a href="/database/sql/sql_test.go.html#7940879">sleepMillis</a></span>&nbsp;<span class="op" id="7941374">*</span>&nbsp;<span class="ident" id="7941376"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7941380">.</span><span class="ident" id="7941381">Millisecond</span><span class="op" id="7941392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941398"><a href="/database/sql/sql_test.go.html#7940922">wg</a></span><span class="op" id="7941400">.</span><span class="ident" id="7941401">Wait</span><span class="op" id="7941405">(</span><span class="op" id="7941406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941410">if</span>&nbsp;<span class="ident" id="7941413">g</span><span class="op" id="7941414">,</span>&nbsp;<span class="ident" id="7941416">w</span>&nbsp;<span class="op" id="7941418">:=</span>&nbsp;<span class="ident" id="7941421"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7941423">.</span><span class="ident" id="7941424">numFreeConns</span><span class="op" id="7941436">(</span><span class="op" id="7941437">)</span><span class="op" id="7941438">,</span>&nbsp;<span class="num" id="7941440">10</span><span class="op" id="7941442">;</span>&nbsp;<span class="ident" id="7941444"><a href="/database/sql/sql_test.go.html#7941413">g</a></span>&nbsp;<span class="op" id="7941446">!=</span>&nbsp;<span class="ident" id="7941449"><a href="/database/sql/sql_test.go.html#7941416">w</a></span>&nbsp;<span class="op" id="7941451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941455"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941456">.</span><span class="ident" id="7941457">Errorf</span><span class="op" id="7941463">(</span><span class="string" id="7941464">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7941490">,</span>&nbsp;<span class="ident" id="7941492"><a href="/database/sql/sql_test.go.html#7941413">g</a></span><span class="op" id="7941493">,</span>&nbsp;<span class="ident" id="7941495"><a href="/database/sql/sql_test.go.html#7941416">w</a></span><span class="op" id="7941496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941503">if</span>&nbsp;<span class="ident" id="7941506">n</span>&nbsp;<span class="op" id="7941508">:=</span>&nbsp;<span class="ident" id="7941511"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7941513">.</span><span class="ident" id="7941514">numDepsPollUntil</span><span class="op" id="7941530">(</span><span class="num" id="7941531">20</span><span class="op" id="7941533">,</span>&nbsp;<span class="ident" id="7941535"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7941539">.</span><span class="ident" id="7941540">Second</span><span class="op" id="7941546">)</span><span class="op" id="7941547">;</span>&nbsp;<span class="ident" id="7941549"><a href="/database/sql/sql_test.go.html#7941506">n</a></span>&nbsp;<span class="op" id="7941551">&gt;</span>&nbsp;<span class="num" id="7941553">20</span>&nbsp;<span class="op" id="7941556">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941560"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941561">.</span><span class="ident" id="7941562">Errorf</span><span class="op" id="7941568">(</span><span class="string" id="7941569">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;20&#34;</span><span class="op" id="7941614">,</span>&nbsp;<span class="ident" id="7941616"><a href="/database/sql/sql_test.go.html#7941506">n</a></span><span class="op" id="7941617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941621"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7941623">.</span><span class="ident" id="7941624">dumpDeps</span><span class="op" id="7941632">(</span><span class="ident" id="7941633"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941641"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7941647">.</span><span class="ident" id="7941648">mu</span><span class="op" id="7941650">.</span><span class="ident" id="7941651">Lock</span><span class="op" id="7941655">(</span><span class="op" id="7941656">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941659">opens</span>&nbsp;<span class="op" id="7941665">:=</span>&nbsp;<span class="ident" id="7941668"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7941674">.</span><span class="ident" id="7941675">openCount</span>&nbsp;<span class="op" id="7941685">-</span>&nbsp;<span class="ident" id="7941687"><a href="/database/sql/sql_test.go.html#7940587">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941695">closes</span>&nbsp;<span class="op" id="7941702">:=</span>&nbsp;<span class="ident" id="7941705"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7941711">.</span><span class="ident" id="7941712">closeCount</span>&nbsp;<span class="op" id="7941723">-</span>&nbsp;<span class="ident" id="7941725"><a href="/database/sql/sql_test.go.html#7940615">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941734"><a href="/database/sql/sql_test.go.html#7940190">driver</a></span><span class="op" id="7941740">.</span><span class="ident" id="7941741">mu</span><span class="op" id="7941743">.</span><span class="ident" id="7941744">Unlock</span><span class="op" id="7941750">(</span><span class="op" id="7941751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941755">if</span>&nbsp;<span class="ident" id="7941758"><a href="/database/sql/sql_test.go.html#7941659">opens</a></span>&nbsp;<span class="op" id="7941764">&gt;</span>&nbsp;<span class="num" id="7941766">10</span>&nbsp;<span class="op" id="7941769">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941773"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941774">.</span><span class="ident" id="7941775">Logf</span><span class="op" id="7941779">(</span><span class="string" id="7941780">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7941797">,</span>&nbsp;<span class="ident" id="7941799"><a href="/database/sql/sql_test.go.html#7941659">opens</a></span><span class="op" id="7941804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941808"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941809">.</span><span class="ident" id="7941810">Logf</span><span class="op" id="7941814">(</span><span class="string" id="7941815">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7941833">,</span>&nbsp;<span class="ident" id="7941835"><a href="/database/sql/sql_test.go.html#7941695">closes</a></span><span class="op" id="7941841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941845"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941846">.</span><span class="ident" id="7941847">Errorf</span><span class="op" id="7941853">(</span><span class="string" id="7941854">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7941894">,</span>&nbsp;<span class="ident" id="7941896"><a href="/database/sql/sql_test.go.html#7941659">opens</a></span><span class="op" id="7941901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941905"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7941907">.</span><span class="ident" id="7941908">dumpDeps</span><span class="op" id="7941916">(</span><span class="ident" id="7941917"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941921">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941925">if</span>&nbsp;<span class="ident" id="7941928">err</span>&nbsp;<span class="op" id="7941932">:=</span>&nbsp;<span class="ident" id="7941935"><a href="/database/sql/sql_test.go.html#7940715">stmt</a></span><span class="op" id="7941939">.</span><span class="ident" id="7941940">Close</span><span class="op" id="7941945">(</span><span class="op" id="7941946">)</span><span class="op" id="7941947">;</span>&nbsp;<span class="ident" id="7941949"><a href="/database/sql/sql_test.go.html#7941928">err</a></span>&nbsp;<span class="op" id="7941953">!=</span>&nbsp;<span class="ident" id="7941956">nil</span>&nbsp;<span class="op" id="7941960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941964"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7941965">.</span><span class="ident" id="7941966">Fatal</span><span class="op" id="7941971">(</span><span class="ident" id="7941972"><a href="/database/sql/sql_test.go.html#7941928">err</a></span><span class="op" id="7941975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941982">if</span>&nbsp;<span class="ident" id="7941985">g</span><span class="op" id="7941986">,</span>&nbsp;<span class="ident" id="7941988">w</span>&nbsp;<span class="op" id="7941990">:=</span>&nbsp;<span class="ident" id="7941993"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7941995">.</span><span class="ident" id="7941996">numFreeConns</span><span class="op" id="7942008">(</span><span class="op" id="7942009">)</span><span class="op" id="7942010">,</span>&nbsp;<span class="num" id="7942012">10</span><span class="op" id="7942014">;</span>&nbsp;<span class="ident" id="7942016"><a href="/database/sql/sql_test.go.html#7941985">g</a></span>&nbsp;<span class="op" id="7942018">!=</span>&nbsp;<span class="ident" id="7942021"><a href="/database/sql/sql_test.go.html#7941988">w</a></span>&nbsp;<span class="op" id="7942023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942027"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942028">.</span><span class="ident" id="7942029">Errorf</span><span class="op" id="7942035">(</span><span class="string" id="7942036">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7942062">,</span>&nbsp;<span class="ident" id="7942064"><a href="/database/sql/sql_test.go.html#7941985">g</a></span><span class="op" id="7942065">,</span>&nbsp;<span class="ident" id="7942067"><a href="/database/sql/sql_test.go.html#7941988">w</a></span><span class="op" id="7942068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942075">if</span>&nbsp;<span class="ident" id="7942078">n</span>&nbsp;<span class="op" id="7942080">:=</span>&nbsp;<span class="ident" id="7942083"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942085">.</span><span class="ident" id="7942086">numDepsPollUntil</span><span class="op" id="7942102">(</span><span class="num" id="7942103">10</span><span class="op" id="7942105">,</span>&nbsp;<span class="ident" id="7942107"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7942111">.</span><span class="ident" id="7942112">Second</span><span class="op" id="7942118">)</span><span class="op" id="7942119">;</span>&nbsp;<span class="ident" id="7942121"><a href="/database/sql/sql_test.go.html#7942078">n</a></span>&nbsp;<span class="op" id="7942123">&gt;</span>&nbsp;<span class="num" id="7942125">10</span>&nbsp;<span class="op" id="7942128">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942132"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942133">.</span><span class="ident" id="7942134">Errorf</span><span class="op" id="7942140">(</span><span class="string" id="7942141">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;10&#34;</span><span class="op" id="7942186">,</span>&nbsp;<span class="ident" id="7942188"><a href="/database/sql/sql_test.go.html#7942078">n</a></span><span class="op" id="7942189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942193"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942195">.</span><span class="ident" id="7942196">dumpDeps</span><span class="op" id="7942204">(</span><span class="ident" id="7942205"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942213"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942215">.</span><span class="ident" id="7942216">SetMaxOpenConns</span><span class="op" id="7942231">(</span><span class="num" id="7942232">5</span><span class="op" id="7942233">)</span><br>
<span class="lineno">1040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942237">if</span>&nbsp;<span class="ident" id="7942240">g</span><span class="op" id="7942241">,</span>&nbsp;<span class="ident" id="7942243">w</span>&nbsp;<span class="op" id="7942245">:=</span>&nbsp;<span class="ident" id="7942248"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942250">.</span><span class="ident" id="7942251">numFreeConns</span><span class="op" id="7942263">(</span><span class="op" id="7942264">)</span><span class="op" id="7942265">,</span>&nbsp;<span class="num" id="7942267">5</span><span class="op" id="7942268">;</span>&nbsp;<span class="ident" id="7942270"><a href="/database/sql/sql_test.go.html#7942240">g</a></span>&nbsp;<span class="op" id="7942272">!=</span>&nbsp;<span class="ident" id="7942275"><a href="/database/sql/sql_test.go.html#7942243">w</a></span>&nbsp;<span class="op" id="7942277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942281"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942282">.</span><span class="ident" id="7942283">Errorf</span><span class="op" id="7942289">(</span><span class="string" id="7942290">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7942316">,</span>&nbsp;<span class="ident" id="7942318"><a href="/database/sql/sql_test.go.html#7942240">g</a></span><span class="op" id="7942319">,</span>&nbsp;<span class="ident" id="7942321"><a href="/database/sql/sql_test.go.html#7942243">w</a></span><span class="op" id="7942322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942329">if</span>&nbsp;<span class="ident" id="7942332">n</span>&nbsp;<span class="op" id="7942334">:=</span>&nbsp;<span class="ident" id="7942337"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942339">.</span><span class="ident" id="7942340">numDepsPollUntil</span><span class="op" id="7942356">(</span><span class="num" id="7942357">5</span><span class="op" id="7942358">,</span>&nbsp;<span class="ident" id="7942360"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7942364">.</span><span class="ident" id="7942365">Second</span><span class="op" id="7942371">)</span><span class="op" id="7942372">;</span>&nbsp;<span class="ident" id="7942374"><a href="/database/sql/sql_test.go.html#7942332">n</a></span>&nbsp;<span class="op" id="7942376">&gt;</span>&nbsp;<span class="num" id="7942378">5</span>&nbsp;<span class="op" id="7942380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942384"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942385">.</span><span class="ident" id="7942386">Errorf</span><span class="op" id="7942392">(</span><span class="string" id="7942393">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7942434">,</span>&nbsp;<span class="ident" id="7942436"><a href="/database/sql/sql_test.go.html#7942332">n</a></span><span class="op" id="7942437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942441"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942443">.</span><span class="ident" id="7942444">dumpDeps</span><span class="op" id="7942452">(</span><span class="ident" id="7942453"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942461"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942463">.</span><span class="ident" id="7942464">SetMaxOpenConns</span><span class="op" id="7942479">(</span><span class="num" id="7942480">0</span><span class="op" id="7942481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942485">if</span>&nbsp;<span class="ident" id="7942488">g</span><span class="op" id="7942489">,</span>&nbsp;<span class="ident" id="7942491">w</span>&nbsp;<span class="op" id="7942493">:=</span>&nbsp;<span class="ident" id="7942496"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942498">.</span><span class="ident" id="7942499">numFreeConns</span><span class="op" id="7942511">(</span><span class="op" id="7942512">)</span><span class="op" id="7942513">,</span>&nbsp;<span class="num" id="7942515">5</span><span class="op" id="7942516">;</span>&nbsp;<span class="ident" id="7942518"><a href="/database/sql/sql_test.go.html#7942488">g</a></span>&nbsp;<span class="op" id="7942520">!=</span>&nbsp;<span class="ident" id="7942523"><a href="/database/sql/sql_test.go.html#7942491">w</a></span>&nbsp;<span class="op" id="7942525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942529"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942530">.</span><span class="ident" id="7942531">Errorf</span><span class="op" id="7942537">(</span><span class="string" id="7942538">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7942564">,</span>&nbsp;<span class="ident" id="7942566"><a href="/database/sql/sql_test.go.html#7942488">g</a></span><span class="op" id="7942567">,</span>&nbsp;<span class="ident" id="7942569"><a href="/database/sql/sql_test.go.html#7942491">w</a></span><span class="op" id="7942570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942573">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942577">if</span>&nbsp;<span class="ident" id="7942580">n</span>&nbsp;<span class="op" id="7942582">:=</span>&nbsp;<span class="ident" id="7942585"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942587">.</span><span class="ident" id="7942588">numDepsPollUntil</span><span class="op" id="7942604">(</span><span class="num" id="7942605">5</span><span class="op" id="7942606">,</span>&nbsp;<span class="ident" id="7942608"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7942612">.</span><span class="ident" id="7942613">Second</span><span class="op" id="7942619">)</span><span class="op" id="7942620">;</span>&nbsp;<span class="ident" id="7942622"><a href="/database/sql/sql_test.go.html#7942580">n</a></span>&nbsp;<span class="op" id="7942624">&gt;</span>&nbsp;<span class="num" id="7942626">5</span>&nbsp;<span class="op" id="7942628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942632"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942633">.</span><span class="ident" id="7942634">Errorf</span><span class="op" id="7942640">(</span><span class="string" id="7942641">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7942682">,</span>&nbsp;<span class="ident" id="7942684"><a href="/database/sql/sql_test.go.html#7942580">n</a></span><span class="op" id="7942685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942689"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942691">.</span><span class="ident" id="7942692">dumpDeps</span><span class="op" id="7942700">(</span><span class="ident" id="7942701"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942705">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942709"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942711">.</span><span class="ident" id="7942712">SetMaxIdleConns</span><span class="op" id="7942727">(</span><span class="num" id="7942728">0</span><span class="op" id="7942729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942733">if</span>&nbsp;<span class="ident" id="7942736">g</span><span class="op" id="7942737">,</span>&nbsp;<span class="ident" id="7942739">w</span>&nbsp;<span class="op" id="7942741">:=</span>&nbsp;<span class="ident" id="7942744"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942746">.</span><span class="ident" id="7942747">numFreeConns</span><span class="op" id="7942759">(</span><span class="op" id="7942760">)</span><span class="op" id="7942761">,</span>&nbsp;<span class="num" id="7942763">0</span><span class="op" id="7942764">;</span>&nbsp;<span class="ident" id="7942766"><a href="/database/sql/sql_test.go.html#7942736">g</a></span>&nbsp;<span class="op" id="7942768">!=</span>&nbsp;<span class="ident" id="7942771"><a href="/database/sql/sql_test.go.html#7942739">w</a></span>&nbsp;<span class="op" id="7942773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942777"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942778">.</span><span class="ident" id="7942779">Errorf</span><span class="op" id="7942785">(</span><span class="string" id="7942786">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7942812">,</span>&nbsp;<span class="ident" id="7942814"><a href="/database/sql/sql_test.go.html#7942736">g</a></span><span class="op" id="7942815">,</span>&nbsp;<span class="ident" id="7942817"><a href="/database/sql/sql_test.go.html#7942739">w</a></span><span class="op" id="7942818">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7942825">if</span>&nbsp;<span class="ident" id="7942828">n</span>&nbsp;<span class="op" id="7942830">:=</span>&nbsp;<span class="ident" id="7942833"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942835">.</span><span class="ident" id="7942836">numDepsPollUntil</span><span class="op" id="7942852">(</span><span class="num" id="7942853">0</span><span class="op" id="7942854">,</span>&nbsp;<span class="ident" id="7942856"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7942860">.</span><span class="ident" id="7942861">Second</span><span class="op" id="7942867">)</span><span class="op" id="7942868">;</span>&nbsp;<span class="ident" id="7942870"><a href="/database/sql/sql_test.go.html#7942828">n</a></span>&nbsp;<span class="op" id="7942872">&gt;</span>&nbsp;<span class="num" id="7942874">0</span>&nbsp;<span class="op" id="7942876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942880"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942881">.</span><span class="ident" id="7942882">Errorf</span><span class="op" id="7942888">(</span><span class="string" id="7942889">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7942930">,</span>&nbsp;<span class="ident" id="7942932"><a href="/database/sql/sql_test.go.html#7942828">n</a></span><span class="op" id="7942933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942937"><a href="/database/sql/sql_test.go.html#7940133">db</a></span><span class="op" id="7942939">.</span><span class="ident" id="7942940">dumpDeps</span><span class="op" id="7942948">(</span><span class="ident" id="7942949"><a href="/database/sql/sql_test.go.html#7939896">t</a></span><span class="op" id="7942950">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7942953">}</span><br>
<span class="lineno"></span><span class="op" id="7942955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7942958">func</span>&nbsp;<span class="ident" id="7942963">TestSingleOpenConn</span><span class="op" id="7942981">(</span><span class="ident" id="7942982">t</span>&nbsp;<span class="op" id="7942984">*</span><span class="ident" id="7942985"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7942992">.</span><span class="ident" id="7942993">T</span><span class="op" id="7942994">)</span>&nbsp;<span class="op" id="7942996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7942999">db</span>&nbsp;<span class="op" id="7943002">:=</span>&nbsp;<span class="ident" id="7943005"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7943014">(</span><span class="ident" id="7943015"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943016">,</span>&nbsp;<span class="string" id="7943018">&#34;people&#34;</span><span class="op" id="7943026">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943029">defer</span>&nbsp;<span class="ident" id="7943035"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7943042">(</span><span class="ident" id="7943043"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943044">,</span>&nbsp;<span class="ident" id="7943046"><a href="/database/sql/sql_test.go.html#7942999">db</a></span><span class="op" id="7943048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943052"><a href="/database/sql/sql_test.go.html#7942999">db</a></span><span class="op" id="7943054">.</span><span class="ident" id="7943055">SetMaxOpenConns</span><span class="op" id="7943070">(</span><span class="num" id="7943071">1</span><span class="op" id="7943072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943076">rows</span><span class="op" id="7943080">,</span>&nbsp;<span class="ident" id="7943082">err</span>&nbsp;<span class="op" id="7943086">:=</span>&nbsp;<span class="ident" id="7943089"><a href="/database/sql/sql_test.go.html#7942999">db</a></span><span class="op" id="7943091">.</span><span class="ident" id="7943092">Query</span><span class="op" id="7943097">(</span><span class="string" id="7943098">&#34;SELECT|people|name|&#34;</span><span class="op" id="7943119">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943122">if</span>&nbsp;<span class="ident" id="7943125"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943129">!=</span>&nbsp;<span class="ident" id="7943132">nil</span>&nbsp;<span class="op" id="7943136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943140"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943141">.</span><span class="ident" id="7943142">Fatal</span><span class="op" id="7943147">(</span><span class="ident" id="7943148"><a href="/database/sql/sql_test.go.html#7943082">err</a></span><span class="op" id="7943151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943157">if</span>&nbsp;<span class="ident" id="7943160"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943164">=</span>&nbsp;<span class="ident" id="7943166"><a href="/database/sql/sql_test.go.html#7943076">rows</a></span><span class="op" id="7943170">.</span><span class="ident" id="7943171">Close</span><span class="op" id="7943176">(</span><span class="op" id="7943177">)</span><span class="op" id="7943178">;</span>&nbsp;<span class="ident" id="7943180"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943184">!=</span>&nbsp;<span class="ident" id="7943187">nil</span>&nbsp;<span class="op" id="7943191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943195"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943196">.</span><span class="ident" id="7943197">Fatal</span><span class="op" id="7943202">(</span><span class="ident" id="7943203"><a href="/database/sql/sql_test.go.html#7943082">err</a></span><span class="op" id="7943206">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7943212">//&nbsp;shouldn&#39;t&nbsp;deadlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943235"><a href="/database/sql/sql_test.go.html#7943076">rows</a></span><span class="op" id="7943239">,</span>&nbsp;<span class="ident" id="7943241"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943245">=</span>&nbsp;<span class="ident" id="7943247"><a href="/database/sql/sql_test.go.html#7942999">db</a></span><span class="op" id="7943249">.</span><span class="ident" id="7943250">Query</span><span class="op" id="7943255">(</span><span class="string" id="7943256">&#34;SELECT|people|name|&#34;</span><span class="op" id="7943277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943280">if</span>&nbsp;<span class="ident" id="7943283"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943287">!=</span>&nbsp;<span class="ident" id="7943290">nil</span>&nbsp;<span class="op" id="7943294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943298"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943299">.</span><span class="ident" id="7943300">Fatal</span><span class="op" id="7943305">(</span><span class="ident" id="7943306"><a href="/database/sql/sql_test.go.html#7943082">err</a></span><span class="op" id="7943309">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943315">if</span>&nbsp;<span class="ident" id="7943318"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943322">=</span>&nbsp;<span class="ident" id="7943324"><a href="/database/sql/sql_test.go.html#7943076">rows</a></span><span class="op" id="7943328">.</span><span class="ident" id="7943329">Close</span><span class="op" id="7943334">(</span><span class="op" id="7943335">)</span><span class="op" id="7943336">;</span>&nbsp;<span class="ident" id="7943338"><a href="/database/sql/sql_test.go.html#7943082">err</a></span>&nbsp;<span class="op" id="7943342">!=</span>&nbsp;<span class="ident" id="7943345">nil</span>&nbsp;<span class="op" id="7943349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943353"><a href="/database/sql/sql_test.go.html#7942982">t</a></span><span class="op" id="7943354">.</span><span class="ident" id="7943355">Fatal</span><span class="op" id="7943360">(</span><span class="ident" id="7943361"><a href="/database/sql/sql_test.go.html#7943082">err</a></span><span class="op" id="7943364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943367">}</span><br>
<span class="lineno"></span><span class="op" id="7943369">}</span><br>
<span class="lineno">1095</span><br>
<span class="lineno"></span><span class="comment" id="7943372">//&nbsp;golang.org/issue/5323</span><br>
<span class="lineno"></span><span class="keyword" id="7943397">func</span>&nbsp;<span class="ident" id="7943402">TestStmtCloseDeps</span><span class="op" id="7943419">(</span><span class="ident" id="7943420">t</span>&nbsp;<span class="op" id="7943422">*</span><span class="ident" id="7943423"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7943430">.</span><span class="ident" id="7943431">T</span><span class="op" id="7943432">)</span>&nbsp;<span class="op" id="7943434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943437">if</span>&nbsp;<span class="ident" id="7943440"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7943447">.</span><span class="ident" id="7943448">Short</span><span class="op" id="7943453">(</span><span class="op" id="7943454">)</span>&nbsp;<span class="op" id="7943456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943460"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7943461">.</span><span class="ident" id="7943462">Skip</span><span class="op" id="7943466">(</span><span class="string" id="7943467">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7943491">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943497">defer</span>&nbsp;<span class="ident" id="7943503"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7943523">(</span><span class="ident" id="7943524">nil</span><span class="op" id="7943527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943530"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7943550">(</span><span class="keyword" id="7943551">func</span><span class="op" id="7943555">(</span><span class="ident" id="7943556">_</span>&nbsp;<span class="op" id="7943558">*</span><span class="ident" id="7943559"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7943567">,</span>&nbsp;<span class="ident" id="7943569">err</span>&nbsp;<span class="builtintype" id="7943573">error</span><span class="op" id="7943578">)</span>&nbsp;<span class="op" id="7943580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943584">if</span>&nbsp;<span class="ident" id="7943587"><a href="/database/sql/sql_test.go.html#7943569">err</a></span>&nbsp;<span class="op" id="7943591">!=</span>&nbsp;<span class="ident" id="7943594">nil</span>&nbsp;<span class="op" id="7943598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943603"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7943604">.</span><span class="ident" id="7943605">Errorf</span><span class="op" id="7943611">(</span><span class="string" id="7943612">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7943640">,</span>&nbsp;<span class="ident" id="7943642"><a href="/database/sql/sql_test.go.html#7943569">err</a></span><span class="op" id="7943645">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943652">}</span><span class="op" id="7943653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943657">db</span>&nbsp;<span class="op" id="7943660">:=</span>&nbsp;<span class="ident" id="7943663"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7943672">(</span><span class="ident" id="7943673"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7943674">,</span>&nbsp;<span class="string" id="7943676">&#34;magicquery&#34;</span><span class="op" id="7943688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943691">defer</span>&nbsp;<span class="ident" id="7943697"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7943704">(</span><span class="ident" id="7943705"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7943706">,</span>&nbsp;<span class="ident" id="7943708"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7943710">)</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943714">driver</span>&nbsp;<span class="op" id="7943721">:=</span>&nbsp;<span class="ident" id="7943724"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7943726">.</span><span class="ident" id="7943727">driver</span><span class="op" id="7943733">.</span><span class="op" id="7943734">(</span><span class="op" id="7943735">*</span><span class="ident" id="7943736"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7943746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943750"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7943756">.</span><span class="ident" id="7943757">mu</span><span class="op" id="7943759">.</span><span class="ident" id="7943760">Lock</span><span class="op" id="7943764">(</span><span class="op" id="7943765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943768">opens0</span>&nbsp;<span class="op" id="7943775">:=</span>&nbsp;<span class="ident" id="7943778"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7943784">.</span><span class="ident" id="7943785">openCount</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943796">closes0</span>&nbsp;<span class="op" id="7943804">:=</span>&nbsp;<span class="ident" id="7943807"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7943813">.</span><span class="ident" id="7943814">closeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943826"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7943832">.</span><span class="ident" id="7943833">mu</span><span class="op" id="7943835">.</span><span class="ident" id="7943836">Unlock</span><span class="op" id="7943842">(</span><span class="op" id="7943843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943846">openDelta0</span>&nbsp;<span class="op" id="7943857">:=</span>&nbsp;<span class="ident" id="7943860"><a href="/database/sql/sql_test.go.html#7943768">opens0</a></span>&nbsp;<span class="op" id="7943867">-</span>&nbsp;<span class="ident" id="7943869"><a href="/database/sql/sql_test.go.html#7943796">closes0</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943879">stmt</span><span class="op" id="7943883">,</span>&nbsp;<span class="ident" id="7943885">err</span>&nbsp;<span class="op" id="7943889">:=</span>&nbsp;<span class="ident" id="7943892"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7943894">.</span><span class="ident" id="7943895">Prepare</span><span class="op" id="7943902">(</span><span class="string" id="7943903">&#34;SELECT|magicquery|op|op=?,millis=?&#34;</span><span class="op" id="7943939">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7943942">if</span>&nbsp;<span class="ident" id="7943945"><a href="/database/sql/sql_test.go.html#7943885">err</a></span>&nbsp;<span class="op" id="7943949">!=</span>&nbsp;<span class="ident" id="7943952">nil</span>&nbsp;<span class="op" id="7943956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7943960"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7943961">.</span><span class="ident" id="7943962">Fatal</span><span class="op" id="7943967">(</span><span class="ident" id="7943968"><a href="/database/sql/sql_test.go.html#7943885">err</a></span><span class="op" id="7943971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7943974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7943978">//&nbsp;Start&nbsp;50&nbsp;parallel&nbsp;slow&nbsp;queries.</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944014">const</span>&nbsp;<span class="op" id="7944020">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944024">nquery</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944036">=</span>&nbsp;<span class="num" id="7944038">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944043">sleepMillis</span>&nbsp;<span class="op" id="7944055">=</span>&nbsp;<span class="num" id="7944057">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944062">nbatch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7944074">=</span>&nbsp;<span class="num" id="7944076">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944079">)</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944082">var</span>&nbsp;<span class="ident" id="7944086">wg</span>&nbsp;<span class="ident" id="7944089"><a href="/database/sql/sql_test.go.html#7916692">sync</a></span><span class="op" id="7944093">.</span><span class="ident" id="7944094">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944105">for</span>&nbsp;<span class="ident" id="7944109">batch</span>&nbsp;<span class="op" id="7944115">:=</span>&nbsp;<span class="num" id="7944118">0</span><span class="op" id="7944119">;</span>&nbsp;<span class="ident" id="7944121"><a href="/database/sql/sql_test.go.html#7944109">batch</a></span>&nbsp;<span class="op" id="7944127">&lt;</span>&nbsp;<span class="ident" id="7944129"><a href="/database/sql/sql_test.go.html#7944062">nbatch</a></span><span class="op" id="7944135">;</span>&nbsp;<span class="ident" id="7944137"><a href="/database/sql/sql_test.go.html#7944109">batch</a></span><span class="op" id="7944142">++</span>&nbsp;<span class="op" id="7944145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944149">for</span>&nbsp;<span class="ident" id="7944153">i</span>&nbsp;<span class="op" id="7944155">:=</span>&nbsp;<span class="num" id="7944158">0</span><span class="op" id="7944159">;</span>&nbsp;<span class="ident" id="7944161"><a href="/database/sql/sql_test.go.html#7944153">i</a></span>&nbsp;<span class="op" id="7944163">&lt;</span>&nbsp;<span class="ident" id="7944165"><a href="/database/sql/sql_test.go.html#7944024">nquery</a></span><span class="op" id="7944171">;</span>&nbsp;<span class="ident" id="7944173"><a href="/database/sql/sql_test.go.html#7944153">i</a></span><span class="op" id="7944174">++</span>&nbsp;<span class="op" id="7944177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944182"><a href="/database/sql/sql_test.go.html#7944086">wg</a></span><span class="op" id="7944184">.</span><span class="ident" id="7944185">Add</span><span class="op" id="7944188">(</span><span class="num" id="7944189">1</span><span class="op" id="7944190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944195">go</span>&nbsp;<span class="keyword" id="7944198">func</span><span class="op" id="7944202">(</span><span class="op" id="7944203">)</span>&nbsp;<span class="op" id="7944205">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944211">defer</span>&nbsp;<span class="ident" id="7944217"><a href="/database/sql/sql_test.go.html#7944086">wg</a></span><span class="op" id="7944219">.</span><span class="ident" id="7944220">Done</span><span class="op" id="7944224">(</span><span class="op" id="7944225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944231">var</span>&nbsp;<span class="ident" id="7944235">op</span>&nbsp;<span class="builtintype" id="7944238">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944249">if</span>&nbsp;<span class="ident" id="7944252">err</span>&nbsp;<span class="op" id="7944256">:=</span>&nbsp;<span class="ident" id="7944259"><a href="/database/sql/sql_test.go.html#7943879">stmt</a></span><span class="op" id="7944263">.</span><span class="ident" id="7944264">QueryRow</span><span class="op" id="7944272">(</span><span class="string" id="7944273">&#34;sleep&#34;</span><span class="op" id="7944280">,</span>&nbsp;<span class="ident" id="7944282"><a href="/database/sql/sql_test.go.html#7944043">sleepMillis</a></span><span class="op" id="7944293">)</span><span class="op" id="7944294">.</span><span class="ident" id="7944295">Scan</span><span class="op" id="7944299">(</span><span class="op" id="7944300">&amp;</span><span class="ident" id="7944301"><a href="/database/sql/sql_test.go.html#7944235">op</a></span><span class="op" id="7944303">)</span><span class="op" id="7944304">;</span>&nbsp;<span class="ident" id="7944306"><a href="/database/sql/sql_test.go.html#7944252">err</a></span>&nbsp;<span class="op" id="7944310">!=</span>&nbsp;<span class="ident" id="7944313">nil</span>&nbsp;<span class="op" id="7944317">&amp;&amp;</span>&nbsp;<span class="ident" id="7944320"><a href="/database/sql/sql_test.go.html#7944252">err</a></span>&nbsp;<span class="op" id="7944324">!=</span>&nbsp;<span class="ident" id="7944327"><a href="/database/sql/sql.go.html#5747590">ErrNoRows</a></span>&nbsp;<span class="op" id="7944337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944344"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7944345">.</span><span class="ident" id="7944346">Error</span><span class="op" id="7944351">(</span><span class="ident" id="7944352"><a href="/database/sql/sql_test.go.html#7944252">err</a></span><span class="op" id="7944355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944361">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944366">}</span><span class="op" id="7944367">(</span><span class="op" id="7944368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7944376">//&nbsp;Sleep&nbsp;for&nbsp;twice&nbsp;the&nbsp;expected&nbsp;length&nbsp;of&nbsp;time&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7944433">//&nbsp;batch&nbsp;of&nbsp;50&nbsp;queries&nbsp;above&nbsp;to&nbsp;finish&nbsp;before&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7944490">//&nbsp;the&nbsp;next&nbsp;round.</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944511"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7944515">.</span><span class="ident" id="7944516">Sleep</span><span class="op" id="7944521">(</span><span class="num" id="7944522">2</span>&nbsp;<span class="op" id="7944524">*</span>&nbsp;<span class="ident" id="7944526"><a href="/database/sql/sql_test.go.html#7944043">sleepMillis</a></span>&nbsp;<span class="op" id="7944538">*</span>&nbsp;<span class="ident" id="7944540"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7944544">.</span><span class="ident" id="7944545">Millisecond</span><span class="op" id="7944556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944562"><a href="/database/sql/sql_test.go.html#7944086">wg</a></span><span class="op" id="7944564">.</span><span class="ident" id="7944565">Wait</span><span class="op" id="7944569">(</span><span class="op" id="7944570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944574">if</span>&nbsp;<span class="ident" id="7944577">g</span><span class="op" id="7944578">,</span>&nbsp;<span class="ident" id="7944580">w</span>&nbsp;<span class="op" id="7944582">:=</span>&nbsp;<span class="ident" id="7944585"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7944587">.</span><span class="ident" id="7944588">numFreeConns</span><span class="op" id="7944600">(</span><span class="op" id="7944601">)</span><span class="op" id="7944602">,</span>&nbsp;<span class="num" id="7944604">2</span><span class="op" id="7944605">;</span>&nbsp;<span class="ident" id="7944607"><a href="/database/sql/sql_test.go.html#7944577">g</a></span>&nbsp;<span class="op" id="7944609">!=</span>&nbsp;<span class="ident" id="7944612"><a href="/database/sql/sql_test.go.html#7944580">w</a></span>&nbsp;<span class="op" id="7944614">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944618"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7944619">.</span><span class="ident" id="7944620">Errorf</span><span class="op" id="7944626">(</span><span class="string" id="7944627">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7944653">,</span>&nbsp;<span class="ident" id="7944655"><a href="/database/sql/sql_test.go.html#7944577">g</a></span><span class="op" id="7944656">,</span>&nbsp;<span class="ident" id="7944658"><a href="/database/sql/sql_test.go.html#7944580">w</a></span><span class="op" id="7944659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944666">if</span>&nbsp;<span class="ident" id="7944669">n</span>&nbsp;<span class="op" id="7944671">:=</span>&nbsp;<span class="ident" id="7944674"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7944676">.</span><span class="ident" id="7944677">numDepsPollUntil</span><span class="op" id="7944693">(</span><span class="num" id="7944694">4</span><span class="op" id="7944695">,</span>&nbsp;<span class="ident" id="7944697"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7944701">.</span><span class="ident" id="7944702">Second</span><span class="op" id="7944708">)</span><span class="op" id="7944709">;</span>&nbsp;<span class="ident" id="7944711"><a href="/database/sql/sql_test.go.html#7944669">n</a></span>&nbsp;<span class="op" id="7944713">&gt;</span>&nbsp;<span class="num" id="7944715">4</span>&nbsp;<span class="op" id="7944717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944721"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7944722">.</span><span class="ident" id="7944723">Errorf</span><span class="op" id="7944729">(</span><span class="string" id="7944730">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;4&#34;</span><span class="op" id="7944774">,</span>&nbsp;<span class="ident" id="7944776"><a href="/database/sql/sql_test.go.html#7944669">n</a></span><span class="op" id="7944777">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944781"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7944783">.</span><span class="ident" id="7944784">dumpDeps</span><span class="op" id="7944792">(</span><span class="ident" id="7944793"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7944794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7944797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944801"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944807">.</span><span class="ident" id="7944808">mu</span><span class="op" id="7944810">.</span><span class="ident" id="7944811">Lock</span><span class="op" id="7944815">(</span><span class="op" id="7944816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944819">opens</span>&nbsp;<span class="op" id="7944825">:=</span>&nbsp;<span class="ident" id="7944828"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944834">.</span><span class="ident" id="7944835">openCount</span>&nbsp;<span class="op" id="7944845">-</span>&nbsp;<span class="ident" id="7944847"><a href="/database/sql/sql_test.go.html#7943768">opens0</a></span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944855">closes</span>&nbsp;<span class="op" id="7944862">:=</span>&nbsp;<span class="ident" id="7944865"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944871">.</span><span class="ident" id="7944872">closeCount</span>&nbsp;<span class="op" id="7944883">-</span>&nbsp;<span class="ident" id="7944885"><a href="/database/sql/sql_test.go.html#7943796">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944894">openDelta</span>&nbsp;<span class="op" id="7944904">:=</span>&nbsp;<span class="op" id="7944907">(</span><span class="ident" id="7944908"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944914">.</span><span class="ident" id="7944915">openCount</span>&nbsp;<span class="op" id="7944925">-</span>&nbsp;<span class="ident" id="7944927"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944933">.</span><span class="ident" id="7944934">closeCount</span><span class="op" id="7944944">)</span>&nbsp;<span class="op" id="7944946">-</span>&nbsp;<span class="ident" id="7944948"><a href="/database/sql/sql_test.go.html#7943846">openDelta0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7944960"><a href="/database/sql/sql_test.go.html#7943714">driver</a></span><span class="op" id="7944966">.</span><span class="ident" id="7944967">mu</span><span class="op" id="7944969">.</span><span class="ident" id="7944970">Unlock</span><span class="op" id="7944976">(</span><span class="op" id="7944977">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7944981">if</span>&nbsp;<span class="ident" id="7944984"><a href="/database/sql/sql_test.go.html#7944894">openDelta</a></span>&nbsp;<span class="op" id="7944994">&gt;</span>&nbsp;<span class="num" id="7944996">2</span>&nbsp;<span class="op" id="7944998">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945002"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945003">.</span><span class="ident" id="7945004">Logf</span><span class="op" id="7945008">(</span><span class="string" id="7945009">&#34;open&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7945026">,</span>&nbsp;<span class="ident" id="7945028"><a href="/database/sql/sql_test.go.html#7944819">opens</a></span><span class="op" id="7945033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945037"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945038">.</span><span class="ident" id="7945039">Logf</span><span class="op" id="7945043">(</span><span class="string" id="7945044">&#34;close&nbsp;calls&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7945062">,</span>&nbsp;<span class="ident" id="7945064"><a href="/database/sql/sql_test.go.html#7944855">closes</a></span><span class="op" id="7945070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945074"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945075">.</span><span class="ident" id="7945076">Logf</span><span class="op" id="7945080">(</span><span class="string" id="7945081">&#34;open&nbsp;delta&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7945098">,</span>&nbsp;<span class="ident" id="7945100"><a href="/database/sql/sql_test.go.html#7944894">openDelta</a></span><span class="op" id="7945109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945113"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945114">.</span><span class="ident" id="7945115">Errorf</span><span class="op" id="7945121">(</span><span class="string" id="7945122">&#34;db&nbsp;connections&nbsp;opened&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7945161">,</span>&nbsp;<span class="ident" id="7945163"><a href="/database/sql/sql_test.go.html#7944894">openDelta</a></span><span class="op" id="7945172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945176"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945178">.</span><span class="ident" id="7945179">dumpDeps</span><span class="op" id="7945187">(</span><span class="ident" id="7945188"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945189">)</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945196">if</span>&nbsp;<span class="builtinfunc" id="7945199">len</span><span class="op" id="7945202">(</span><span class="ident" id="7945203"><a href="/database/sql/sql_test.go.html#7943879">stmt</a></span><span class="op" id="7945207">.</span><span class="ident" id="7945208">css</span><span class="op" id="7945211">)</span>&nbsp;<span class="op" id="7945213">&gt;</span>&nbsp;<span class="ident" id="7945215"><a href="/database/sql/sql_test.go.html#7944024">nquery</a></span>&nbsp;<span class="op" id="7945222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945226"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945227">.</span><span class="ident" id="7945228">Errorf</span><span class="op" id="7945234">(</span><span class="string" id="7945235">&#34;len(stmt.css)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7945267">,</span>&nbsp;<span class="builtinfunc" id="7945269">len</span><span class="op" id="7945272">(</span><span class="ident" id="7945273"><a href="/database/sql/sql_test.go.html#7943879">stmt</a></span><span class="op" id="7945277">.</span><span class="ident" id="7945278">css</span><span class="op" id="7945281">)</span><span class="op" id="7945282">,</span>&nbsp;<span class="ident" id="7945284"><a href="/database/sql/sql_test.go.html#7944024">nquery</a></span><span class="op" id="7945290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945293">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945297">if</span>&nbsp;<span class="ident" id="7945300">err</span>&nbsp;<span class="op" id="7945304">:=</span>&nbsp;<span class="ident" id="7945307"><a href="/database/sql/sql_test.go.html#7943879">stmt</a></span><span class="op" id="7945311">.</span><span class="ident" id="7945312">Close</span><span class="op" id="7945317">(</span><span class="op" id="7945318">)</span><span class="op" id="7945319">;</span>&nbsp;<span class="ident" id="7945321"><a href="/database/sql/sql_test.go.html#7945300">err</a></span>&nbsp;<span class="op" id="7945325">!=</span>&nbsp;<span class="ident" id="7945328">nil</span>&nbsp;<span class="op" id="7945332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945336"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945337">.</span><span class="ident" id="7945338">Fatal</span><span class="op" id="7945343">(</span><span class="ident" id="7945344"><a href="/database/sql/sql_test.go.html#7945300">err</a></span><span class="op" id="7945347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945354">if</span>&nbsp;<span class="ident" id="7945357">g</span><span class="op" id="7945358">,</span>&nbsp;<span class="ident" id="7945360">w</span>&nbsp;<span class="op" id="7945362">:=</span>&nbsp;<span class="ident" id="7945365"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945367">.</span><span class="ident" id="7945368">numFreeConns</span><span class="op" id="7945380">(</span><span class="op" id="7945381">)</span><span class="op" id="7945382">,</span>&nbsp;<span class="num" id="7945384">2</span><span class="op" id="7945385">;</span>&nbsp;<span class="ident" id="7945387"><a href="/database/sql/sql_test.go.html#7945357">g</a></span>&nbsp;<span class="op" id="7945389">!=</span>&nbsp;<span class="ident" id="7945392"><a href="/database/sql/sql_test.go.html#7945360">w</a></span>&nbsp;<span class="op" id="7945394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945398"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945399">.</span><span class="ident" id="7945400">Errorf</span><span class="op" id="7945406">(</span><span class="string" id="7945407">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7945433">,</span>&nbsp;<span class="ident" id="7945435"><a href="/database/sql/sql_test.go.html#7945357">g</a></span><span class="op" id="7945436">,</span>&nbsp;<span class="ident" id="7945438"><a href="/database/sql/sql_test.go.html#7945360">w</a></span><span class="op" id="7945439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945446">if</span>&nbsp;<span class="ident" id="7945449">n</span>&nbsp;<span class="op" id="7945451">:=</span>&nbsp;<span class="ident" id="7945454"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945456">.</span><span class="ident" id="7945457">numDepsPollUntil</span><span class="op" id="7945473">(</span><span class="num" id="7945474">2</span><span class="op" id="7945475">,</span>&nbsp;<span class="ident" id="7945477"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7945481">.</span><span class="ident" id="7945482">Second</span><span class="op" id="7945488">)</span><span class="op" id="7945489">;</span>&nbsp;<span class="ident" id="7945491"><a href="/database/sql/sql_test.go.html#7945449">n</a></span>&nbsp;<span class="op" id="7945493">&gt;</span>&nbsp;<span class="num" id="7945495">2</span>&nbsp;<span class="op" id="7945497">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945501"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945502">.</span><span class="ident" id="7945503">Errorf</span><span class="op" id="7945509">(</span><span class="string" id="7945510">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;&lt;=&nbsp;2&#34;</span><span class="op" id="7945554">,</span>&nbsp;<span class="ident" id="7945556"><a href="/database/sql/sql_test.go.html#7945449">n</a></span><span class="op" id="7945557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945561"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945563">.</span><span class="ident" id="7945564">dumpDeps</span><span class="op" id="7945572">(</span><span class="ident" id="7945573"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945581"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945583">.</span><span class="ident" id="7945584">SetMaxIdleConns</span><span class="op" id="7945599">(</span><span class="num" id="7945600">0</span><span class="op" id="7945601">)</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945605">if</span>&nbsp;<span class="ident" id="7945608">g</span><span class="op" id="7945609">,</span>&nbsp;<span class="ident" id="7945611">w</span>&nbsp;<span class="op" id="7945613">:=</span>&nbsp;<span class="ident" id="7945616"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945618">.</span><span class="ident" id="7945619">numFreeConns</span><span class="op" id="7945631">(</span><span class="op" id="7945632">)</span><span class="op" id="7945633">,</span>&nbsp;<span class="num" id="7945635">0</span><span class="op" id="7945636">;</span>&nbsp;<span class="ident" id="7945638"><a href="/database/sql/sql_test.go.html#7945608">g</a></span>&nbsp;<span class="op" id="7945640">!=</span>&nbsp;<span class="ident" id="7945643"><a href="/database/sql/sql_test.go.html#7945611">w</a></span>&nbsp;<span class="op" id="7945645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945649"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945650">.</span><span class="ident" id="7945651">Errorf</span><span class="op" id="7945657">(</span><span class="string" id="7945658">&#34;free&nbsp;conns&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7945684">,</span>&nbsp;<span class="ident" id="7945686"><a href="/database/sql/sql_test.go.html#7945608">g</a></span><span class="op" id="7945687">,</span>&nbsp;<span class="ident" id="7945689"><a href="/database/sql/sql_test.go.html#7945611">w</a></span><span class="op" id="7945690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945697">if</span>&nbsp;<span class="ident" id="7945700">n</span>&nbsp;<span class="op" id="7945702">:=</span>&nbsp;<span class="ident" id="7945705"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945707">.</span><span class="ident" id="7945708">numDepsPollUntil</span><span class="op" id="7945724">(</span><span class="num" id="7945725">0</span><span class="op" id="7945726">,</span>&nbsp;<span class="ident" id="7945728"><a href="/database/sql/sql_test.go.html#7916711">time</a></span><span class="op" id="7945732">.</span><span class="ident" id="7945733">Second</span><span class="op" id="7945739">)</span><span class="op" id="7945740">;</span>&nbsp;<span class="ident" id="7945742"><a href="/database/sql/sql_test.go.html#7945700">n</a></span>&nbsp;<span class="op" id="7945744">&gt;</span>&nbsp;<span class="num" id="7945746">0</span>&nbsp;<span class="op" id="7945748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945752"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945753">.</span><span class="ident" id="7945754">Errorf</span><span class="op" id="7945760">(</span><span class="string" id="7945761">&#34;number&nbsp;of&nbsp;dependencies&nbsp;=&nbsp;%d;&nbsp;expected&nbsp;0&#34;</span><span class="op" id="7945802">,</span>&nbsp;<span class="ident" id="7945804"><a href="/database/sql/sql_test.go.html#7945700">n</a></span><span class="op" id="7945805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945809"><a href="/database/sql/sql_test.go.html#7943657">db</a></span><span class="op" id="7945811">.</span><span class="ident" id="7945812">dumpDeps</span><span class="op" id="7945820">(</span><span class="ident" id="7945821"><a href="/database/sql/sql_test.go.html#7943420">t</a></span><span class="op" id="7945822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7945825">}</span><br>
<span class="lineno"></span><span class="op" id="7945827">}</span><br>
<span class="lineno">1200</span><br>
<span class="lineno"></span><span class="comment" id="7945830">//&nbsp;golang.org/issue/5046</span><br>
<span class="lineno"></span><span class="keyword" id="7945855">func</span>&nbsp;<span class="ident" id="7945860">TestCloseConnBeforeStmts</span><span class="op" id="7945884">(</span><span class="ident" id="7945885">t</span>&nbsp;<span class="op" id="7945887">*</span><span class="ident" id="7945888"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7945895">.</span><span class="ident" id="7945896">T</span><span class="op" id="7945897">)</span>&nbsp;<span class="op" id="7945899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945902">db</span>&nbsp;<span class="op" id="7945905">:=</span>&nbsp;<span class="ident" id="7945908"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7945917">(</span><span class="ident" id="7945918"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7945919">,</span>&nbsp;<span class="string" id="7945921">&#34;people&#34;</span><span class="op" id="7945929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945932">defer</span>&nbsp;<span class="ident" id="7945938"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7945945">(</span><span class="ident" id="7945946"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7945947">,</span>&nbsp;<span class="ident" id="7945949"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7945951">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7945955">defer</span>&nbsp;<span class="ident" id="7945961"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7945981">(</span><span class="ident" id="7945982">nil</span><span class="op" id="7945985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7945988"><a href="/database/sql/fakedb_test.go.html#7901697">setHookpostCloseConn</a></span><span class="op" id="7946008">(</span><span class="keyword" id="7946009">func</span><span class="op" id="7946013">(</span><span class="ident" id="7946014">_</span>&nbsp;<span class="op" id="7946016">*</span><span class="ident" id="7946017"><a href="/database/sql/fakedb_test.go.html#7897753">fakeConn</a></span><span class="op" id="7946025">,</span>&nbsp;<span class="ident" id="7946027">err</span>&nbsp;<span class="builtintype" id="7946031">error</span><span class="op" id="7946036">)</span>&nbsp;<span class="op" id="7946038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946042">if</span>&nbsp;<span class="ident" id="7946045"><a href="/database/sql/sql_test.go.html#7946027">err</a></span>&nbsp;<span class="op" id="7946049">!=</span>&nbsp;<span class="ident" id="7946052">nil</span>&nbsp;<span class="op" id="7946056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946061"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946062">.</span><span class="ident" id="7946063">Errorf</span><span class="op" id="7946069">(</span><span class="string" id="7946070">&#34;Error&nbsp;closing&nbsp;fakeConn:&nbsp;%v;&nbsp;from&nbsp;%s&#34;</span><span class="op" id="7946107">,</span>&nbsp;<span class="ident" id="7946109"><a href="/database/sql/sql_test.go.html#7946027">err</a></span><span class="op" id="7946112">,</span>&nbsp;<span class="ident" id="7946114"><a href="/database/sql/sql.go.html#5788422">stack</a></span><span class="op" id="7946119">(</span><span class="op" id="7946120">)</span><span class="op" id="7946121">)</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946126"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946128">.</span><span class="ident" id="7946129">dumpDeps</span><span class="op" id="7946137">(</span><span class="ident" id="7946138"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946144"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946145">.</span><span class="ident" id="7946146">Errorf</span><span class="op" id="7946152">(</span><span class="string" id="7946153">&#34;DB&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7946163">,</span>&nbsp;<span class="ident" id="7946165"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946174">}</span><span class="op" id="7946175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946179">stmt</span><span class="op" id="7946183">,</span>&nbsp;<span class="ident" id="7946185">err</span>&nbsp;<span class="op" id="7946189">:=</span>&nbsp;<span class="ident" id="7946192"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946194">.</span><span class="ident" id="7946195">Prepare</span><span class="op" id="7946202">(</span><span class="string" id="7946203">&#34;SELECT|people|name|&#34;</span><span class="op" id="7946224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946227">if</span>&nbsp;<span class="ident" id="7946230"><a href="/database/sql/sql_test.go.html#7946185">err</a></span>&nbsp;<span class="op" id="7946234">!=</span>&nbsp;<span class="ident" id="7946237">nil</span>&nbsp;<span class="op" id="7946241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946245"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946246">.</span><span class="ident" id="7946247">Fatal</span><span class="op" id="7946252">(</span><span class="ident" id="7946253"><a href="/database/sql/sql_test.go.html#7946185">err</a></span><span class="op" id="7946256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946263">if</span>&nbsp;<span class="builtinfunc" id="7946266">len</span><span class="op" id="7946269">(</span><span class="ident" id="7946270"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946272">.</span><span class="ident" id="7946273">freeConn</span><span class="op" id="7946281">)</span>&nbsp;<span class="op" id="7946283">!=</span>&nbsp;<span class="num" id="7946286">1</span>&nbsp;<span class="op" id="7946288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946292"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946293">.</span><span class="ident" id="7946294">Fatalf</span><span class="op" id="7946300">(</span><span class="string" id="7946301">&#34;expected&nbsp;1&nbsp;freeConn;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7946330">,</span>&nbsp;<span class="builtinfunc" id="7946332">len</span><span class="op" id="7946335">(</span><span class="ident" id="7946336"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946338">.</span><span class="ident" id="7946339">freeConn</span><span class="op" id="7946347">)</span><span class="op" id="7946348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946354">dc</span>&nbsp;<span class="op" id="7946357">:=</span>&nbsp;<span class="ident" id="7946360"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946362">.</span><span class="ident" id="7946363">freeConn</span><span class="op" id="7946371">[</span><span class="num" id="7946372">0</span><span class="op" id="7946373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946376">if</span>&nbsp;<span class="ident" id="7946379"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946381">.</span><span class="ident" id="7946382">closed</span>&nbsp;<span class="op" id="7946389">{</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946393"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946394">.</span><span class="ident" id="7946395">Errorf</span><span class="op" id="7946401">(</span><span class="string" id="7946402">&#34;conn&nbsp;shouldn&#39;t&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7946428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946435">if</span>&nbsp;<span class="ident" id="7946438">n</span>&nbsp;<span class="op" id="7946440">:=</span>&nbsp;<span class="builtinfunc" id="7946443">len</span><span class="op" id="7946446">(</span><span class="ident" id="7946447"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946449">.</span><span class="ident" id="7946450">openStmt</span><span class="op" id="7946458">)</span><span class="op" id="7946459">;</span>&nbsp;<span class="ident" id="7946461"><a href="/database/sql/sql_test.go.html#7946438">n</a></span>&nbsp;<span class="op" id="7946463">!=</span>&nbsp;<span class="num" id="7946466">1</span>&nbsp;<span class="op" id="7946468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946472"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946473">.</span><span class="ident" id="7946474">Errorf</span><span class="op" id="7946480">(</span><span class="string" id="7946481">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7946519">,</span>&nbsp;<span class="ident" id="7946521"><a href="/database/sql/sql_test.go.html#7946438">n</a></span><span class="op" id="7946522">)</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946528"><a href="/database/sql/sql_test.go.html#7946185">err</a></span>&nbsp;<span class="op" id="7946532">=</span>&nbsp;<span class="ident" id="7946534"><a href="/database/sql/sql_test.go.html#7945902">db</a></span><span class="op" id="7946536">.</span><span class="ident" id="7946537">Close</span><span class="op" id="7946542">(</span><span class="op" id="7946543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946546">if</span>&nbsp;<span class="ident" id="7946549"><a href="/database/sql/sql_test.go.html#7946185">err</a></span>&nbsp;<span class="op" id="7946553">!=</span>&nbsp;<span class="ident" id="7946556">nil</span>&nbsp;<span class="op" id="7946560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946564"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946565">.</span><span class="ident" id="7946566">Errorf</span><span class="op" id="7946572">(</span><span class="string" id="7946573">&#34;db&nbsp;Close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7946588">,</span>&nbsp;<span class="ident" id="7946590"><a href="/database/sql/sql_test.go.html#7946185">err</a></span><span class="op" id="7946593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946596">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946599">if</span>&nbsp;<span class="op" id="7946602">!</span><span class="ident" id="7946603"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946605">.</span><span class="ident" id="7946606">closed</span>&nbsp;<span class="op" id="7946613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946617"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946618">.</span><span class="ident" id="7946619">Errorf</span><span class="op" id="7946625">(</span><span class="string" id="7946626">&#34;after&nbsp;db.Close,&nbsp;driverConn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7946671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946677">if</span>&nbsp;<span class="ident" id="7946680">n</span>&nbsp;<span class="op" id="7946682">:=</span>&nbsp;<span class="builtinfunc" id="7946685">len</span><span class="op" id="7946688">(</span><span class="ident" id="7946689"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946691">.</span><span class="ident" id="7946692">openStmt</span><span class="op" id="7946700">)</span><span class="op" id="7946701">;</span>&nbsp;<span class="ident" id="7946703"><a href="/database/sql/sql_test.go.html#7946680">n</a></span>&nbsp;<span class="op" id="7946705">!=</span>&nbsp;<span class="num" id="7946708">0</span>&nbsp;<span class="op" id="7946710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946714"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946715">.</span><span class="ident" id="7946716">Errorf</span><span class="op" id="7946722">(</span><span class="string" id="7946723">&#34;driverConn&nbsp;num&nbsp;openStmt&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7946761">,</span>&nbsp;<span class="ident" id="7946763"><a href="/database/sql/sql_test.go.html#7946680">n</a></span><span class="op" id="7946764">)</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946771"><a href="/database/sql/sql_test.go.html#7946185">err</a></span>&nbsp;<span class="op" id="7946775">=</span>&nbsp;<span class="ident" id="7946777"><a href="/database/sql/sql_test.go.html#7946179">stmt</a></span><span class="op" id="7946781">.</span><span class="ident" id="7946782">Close</span><span class="op" id="7946787">(</span><span class="op" id="7946788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946791">if</span>&nbsp;<span class="ident" id="7946794"><a href="/database/sql/sql_test.go.html#7946185">err</a></span>&nbsp;<span class="op" id="7946798">!=</span>&nbsp;<span class="ident" id="7946801">nil</span>&nbsp;<span class="op" id="7946805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946809"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946810">.</span><span class="ident" id="7946811">Errorf</span><span class="op" id="7946817">(</span><span class="string" id="7946818">&#34;Stmt&nbsp;close&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7946835">,</span>&nbsp;<span class="ident" id="7946837"><a href="/database/sql/sql_test.go.html#7946185">err</a></span><span class="op" id="7946840">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946847">if</span>&nbsp;<span class="op" id="7946850">!</span><span class="ident" id="7946851"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946853">.</span><span class="ident" id="7946854">closed</span>&nbsp;<span class="op" id="7946861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946865"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946866">.</span><span class="ident" id="7946867">Errorf</span><span class="op" id="7946873">(</span><span class="string" id="7946874">&#34;conn&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="7946897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946900">}</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7946903">if</span>&nbsp;<span class="ident" id="7946906"><a href="/database/sql/sql_test.go.html#7946354">dc</a></span><span class="op" id="7946908">.</span><span class="ident" id="7946909">ci</span>&nbsp;<span class="op" id="7946912">!=</span>&nbsp;<span class="ident" id="7946915">nil</span>&nbsp;<span class="op" id="7946919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7946923"><a href="/database/sql/sql_test.go.html#7945885">t</a></span><span class="op" id="7946924">.</span><span class="ident" id="7946925">Errorf</span><span class="op" id="7946931">(</span><span class="string" id="7946932">&#34;after&nbsp;Stmt&nbsp;Close,&nbsp;driverConn&#39;s&nbsp;Conn&nbsp;interface&nbsp;should&nbsp;be&nbsp;nil&#34;</span><span class="op" id="7946993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7946996">}</span><br>
<span class="lineno"></span><span class="op" id="7946998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1255</span><span class="comment" id="7947001">//&nbsp;golang.org/issue/5283:&nbsp;don&#39;t&nbsp;release&nbsp;the&nbsp;Rows&#39;&nbsp;connection&nbsp;in&nbsp;Close</span><br>
<span class="lineno"></span><span class="comment" id="7947071">//&nbsp;before&nbsp;calling&nbsp;Stmt.Close.</span><br>
<span class="lineno"></span><span class="keyword" id="7947101">func</span>&nbsp;<span class="ident" id="7947106">TestRowsCloseOrder</span><span class="op" id="7947124">(</span><span class="ident" id="7947125">t</span>&nbsp;<span class="op" id="7947127">*</span><span class="ident" id="7947128"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7947135">.</span><span class="ident" id="7947136">T</span><span class="op" id="7947137">)</span>&nbsp;<span class="op" id="7947139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947142">db</span>&nbsp;<span class="op" id="7947145">:=</span>&nbsp;<span class="ident" id="7947148"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7947157">(</span><span class="ident" id="7947158"><a href="/database/sql/sql_test.go.html#7947125">t</a></span><span class="op" id="7947159">,</span>&nbsp;<span class="string" id="7947161">&#34;people&#34;</span><span class="op" id="7947169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947172">defer</span>&nbsp;<span class="ident" id="7947178"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7947185">(</span><span class="ident" id="7947186"><a href="/database/sql/sql_test.go.html#7947125">t</a></span><span class="op" id="7947187">,</span>&nbsp;<span class="ident" id="7947189"><a href="/database/sql/sql_test.go.html#7947142">db</a></span><span class="op" id="7947191">)</span><br>
<span class="lineno">1260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947195"><a href="/database/sql/sql_test.go.html#7947142">db</a></span><span class="op" id="7947197">.</span><span class="ident" id="7947198">SetMaxIdleConns</span><span class="op" id="7947213">(</span><span class="num" id="7947214">0</span><span class="op" id="7947215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947218"><a href="/database/sql/fakedb_test.go.html#7901994">setStrictFakeConnClose</a></span><span class="op" id="7947240">(</span><span class="ident" id="7947241"><a href="/database/sql/sql_test.go.html#7947125">t</a></span><span class="op" id="7947242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947245">defer</span>&nbsp;<span class="ident" id="7947251"><a href="/database/sql/fakedb_test.go.html#7901994">setStrictFakeConnClose</a></span><span class="op" id="7947273">(</span><span class="ident" id="7947274">nil</span><span class="op" id="7947277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947281">rows</span><span class="op" id="7947285">,</span>&nbsp;<span class="ident" id="7947287">err</span>&nbsp;<span class="op" id="7947291">:=</span>&nbsp;<span class="ident" id="7947294"><a href="/database/sql/sql_test.go.html#7947142">db</a></span><span class="op" id="7947296">.</span><span class="ident" id="7947297">Query</span><span class="op" id="7947302">(</span><span class="string" id="7947303">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7947328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947331">if</span>&nbsp;<span class="ident" id="7947334"><a href="/database/sql/sql_test.go.html#7947287">err</a></span>&nbsp;<span class="op" id="7947338">!=</span>&nbsp;<span class="ident" id="7947341">nil</span>&nbsp;<span class="op" id="7947345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947349"><a href="/database/sql/sql_test.go.html#7947125">t</a></span><span class="op" id="7947350">.</span><span class="ident" id="7947351">Fatal</span><span class="op" id="7947356">(</span><span class="ident" id="7947357"><a href="/database/sql/sql_test.go.html#7947287">err</a></span><span class="op" id="7947360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947366"><a href="/database/sql/sql_test.go.html#7947287">err</a></span>&nbsp;<span class="op" id="7947370">=</span>&nbsp;<span class="ident" id="7947372"><a href="/database/sql/sql_test.go.html#7947281">rows</a></span><span class="op" id="7947376">.</span><span class="ident" id="7947377">Close</span><span class="op" id="7947382">(</span><span class="op" id="7947383">)</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947386">if</span>&nbsp;<span class="ident" id="7947389"><a href="/database/sql/sql_test.go.html#7947287">err</a></span>&nbsp;<span class="op" id="7947393">!=</span>&nbsp;<span class="ident" id="7947396">nil</span>&nbsp;<span class="op" id="7947400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947404"><a href="/database/sql/sql_test.go.html#7947125">t</a></span><span class="op" id="7947405">.</span><span class="ident" id="7947406">Fatal</span><span class="op" id="7947411">(</span><span class="ident" id="7947412"><a href="/database/sql/sql_test.go.html#7947287">err</a></span><span class="op" id="7947415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947418">}</span><br>
<span class="lineno"></span><span class="op" id="7947420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1275</span><span class="keyword" id="7947423">func</span>&nbsp;<span class="ident" id="7947428">TestRowsImplicitClose</span><span class="op" id="7947449">(</span><span class="ident" id="7947450">t</span>&nbsp;<span class="op" id="7947452">*</span><span class="ident" id="7947453"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7947460">.</span><span class="ident" id="7947461">T</span><span class="op" id="7947462">)</span>&nbsp;<span class="op" id="7947464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947467">db</span>&nbsp;<span class="op" id="7947470">:=</span>&nbsp;<span class="ident" id="7947473"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7947482">(</span><span class="ident" id="7947483"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947484">,</span>&nbsp;<span class="string" id="7947486">&#34;people&#34;</span><span class="op" id="7947494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947497">defer</span>&nbsp;<span class="ident" id="7947503"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7947510">(</span><span class="ident" id="7947511"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947512">,</span>&nbsp;<span class="ident" id="7947514"><a href="/database/sql/sql_test.go.html#7947467">db</a></span><span class="op" id="7947516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947520">rows</span><span class="op" id="7947524">,</span>&nbsp;<span class="ident" id="7947526">err</span>&nbsp;<span class="op" id="7947530">:=</span>&nbsp;<span class="ident" id="7947533"><a href="/database/sql/sql_test.go.html#7947467">db</a></span><span class="op" id="7947535">.</span><span class="ident" id="7947536">Query</span><span class="op" id="7947541">(</span><span class="string" id="7947542">&#34;SELECT|people|age,name|&#34;</span><span class="op" id="7947567">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947570">if</span>&nbsp;<span class="ident" id="7947573"><a href="/database/sql/sql_test.go.html#7947526">err</a></span>&nbsp;<span class="op" id="7947577">!=</span>&nbsp;<span class="ident" id="7947580">nil</span>&nbsp;<span class="op" id="7947584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947588"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947589">.</span><span class="ident" id="7947590">Fatal</span><span class="op" id="7947595">(</span><span class="ident" id="7947596"><a href="/database/sql/sql_test.go.html#7947526">err</a></span><span class="op" id="7947599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947606">want</span><span class="op" id="7947610">,</span>&nbsp;<span class="ident" id="7947612">fail</span>&nbsp;<span class="op" id="7947617">:=</span>&nbsp;<span class="num" id="7947620">2</span><span class="op" id="7947621">,</span>&nbsp;<span class="ident" id="7947623"><a href="/database/sql/sql_test.go.html#7916629">errors</a></span><span class="op" id="7947629">.</span><span class="ident" id="7947630">New</span><span class="op" id="7947633">(</span><span class="string" id="7947634">&#34;fail&#34;</span><span class="op" id="7947640">)</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947643">r</span>&nbsp;<span class="op" id="7947645">:=</span>&nbsp;<span class="ident" id="7947648"><a href="/database/sql/sql_test.go.html#7947520">rows</a></span><span class="op" id="7947652">.</span><span class="ident" id="7947653">rowsi</span><span class="op" id="7947658">.</span><span class="op" id="7947659">(</span><span class="op" id="7947660">*</span><span class="ident" id="7947661"><a href="/database/sql/fakedb_test.go.html#7913208">rowsCursor</a></span><span class="op" id="7947671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947674"><a href="/database/sql/sql_test.go.html#7947643">r</a></span><span class="op" id="7947675">.</span><span class="ident" id="7947676">errPos</span><span class="op" id="7947682">,</span>&nbsp;<span class="ident" id="7947684"><a href="/database/sql/sql_test.go.html#7947643">r</a></span><span class="op" id="7947685">.</span><span class="ident" id="7947686">err</span>&nbsp;<span class="op" id="7947690">=</span>&nbsp;<span class="ident" id="7947692"><a href="/database/sql/sql_test.go.html#7947606">want</a></span><span class="op" id="7947696">,</span>&nbsp;<span class="ident" id="7947698"><a href="/database/sql/sql_test.go.html#7947612">fail</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947705">got</span>&nbsp;<span class="op" id="7947709">:=</span>&nbsp;<span class="num" id="7947712">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947715">for</span>&nbsp;<span class="ident" id="7947719"><a href="/database/sql/sql_test.go.html#7947520">rows</a></span><span class="op" id="7947723">.</span><span class="ident" id="7947724">Next</span><span class="op" id="7947728">(</span><span class="op" id="7947729">)</span>&nbsp;<span class="op" id="7947731">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947735"><a href="/database/sql/sql_test.go.html#7947705">got</a></span><span class="op" id="7947738">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947745">if</span>&nbsp;<span class="ident" id="7947748"><a href="/database/sql/sql_test.go.html#7947705">got</a></span>&nbsp;<span class="op" id="7947752">!=</span>&nbsp;<span class="ident" id="7947755"><a href="/database/sql/sql_test.go.html#7947606">want</a></span>&nbsp;<span class="op" id="7947760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947764"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947765">.</span><span class="ident" id="7947766">Errorf</span><span class="op" id="7947772">(</span><span class="string" id="7947773">&#34;got&nbsp;%d&nbsp;rows,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7947795">,</span>&nbsp;<span class="ident" id="7947797"><a href="/database/sql/sql_test.go.html#7947705">got</a></span><span class="op" id="7947800">,</span>&nbsp;<span class="ident" id="7947802"><a href="/database/sql/sql_test.go.html#7947606">want</a></span><span class="op" id="7947806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947809">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947812">if</span>&nbsp;<span class="ident" id="7947815">err</span>&nbsp;<span class="op" id="7947819">:=</span>&nbsp;<span class="ident" id="7947822"><a href="/database/sql/sql_test.go.html#7947520">rows</a></span><span class="op" id="7947826">.</span><span class="ident" id="7947827">Err</span><span class="op" id="7947830">(</span><span class="op" id="7947831">)</span><span class="op" id="7947832">;</span>&nbsp;<span class="ident" id="7947834"><a href="/database/sql/sql_test.go.html#7947815">err</a></span>&nbsp;<span class="op" id="7947838">!=</span>&nbsp;<span class="ident" id="7947841"><a href="/database/sql/sql_test.go.html#7947612">fail</a></span>&nbsp;<span class="op" id="7947846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947850"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947851">.</span><span class="ident" id="7947852">Errorf</span><span class="op" id="7947858">(</span><span class="string" id="7947859">&#34;got&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7947882">,</span>&nbsp;<span class="ident" id="7947884"><a href="/database/sql/sql_test.go.html#7947815">err</a></span><span class="op" id="7947887">,</span>&nbsp;<span class="ident" id="7947889"><a href="/database/sql/sql_test.go.html#7947612">fail</a></span><span class="op" id="7947893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7947899">if</span>&nbsp;<span class="op" id="7947902">!</span><span class="ident" id="7947903"><a href="/database/sql/sql_test.go.html#7947643">r</a></span><span class="op" id="7947904">.</span><span class="ident" id="7947905">closed</span>&nbsp;<span class="op" id="7947912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7947916"><a href="/database/sql/sql_test.go.html#7947450">t</a></span><span class="op" id="7947917">.</span><span class="ident" id="7947918">Errorf</span><span class="op" id="7947924">(</span><span class="string" id="7947925">&#34;r.closed&nbsp;is&nbsp;false,&nbsp;want&nbsp;true&#34;</span><span class="op" id="7947955">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7947958">}</span><br>
<span class="lineno"></span><span class="op" id="7947960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7947963">func</span>&nbsp;<span class="ident" id="7947968">TestStmtCloseOrder</span><span class="op" id="7947986">(</span><span class="ident" id="7947987">t</span>&nbsp;<span class="op" id="7947989">*</span><span class="ident" id="7947990"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7947997">.</span><span class="ident" id="7947998">T</span><span class="op" id="7947999">)</span>&nbsp;<span class="op" id="7948001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948004">db</span>&nbsp;<span class="op" id="7948007">:=</span>&nbsp;<span class="ident" id="7948010"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7948019">(</span><span class="ident" id="7948020"><a href="/database/sql/sql_test.go.html#7947987">t</a></span><span class="op" id="7948021">,</span>&nbsp;<span class="string" id="7948023">&#34;people&#34;</span><span class="op" id="7948031">)</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948034">defer</span>&nbsp;<span class="ident" id="7948040"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7948047">(</span><span class="ident" id="7948048"><a href="/database/sql/sql_test.go.html#7947987">t</a></span><span class="op" id="7948049">,</span>&nbsp;<span class="ident" id="7948051"><a href="/database/sql/sql_test.go.html#7948004">db</a></span><span class="op" id="7948053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948057"><a href="/database/sql/sql_test.go.html#7948004">db</a></span><span class="op" id="7948059">.</span><span class="ident" id="7948060">SetMaxIdleConns</span><span class="op" id="7948075">(</span><span class="num" id="7948076">0</span><span class="op" id="7948077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948080"><a href="/database/sql/fakedb_test.go.html#7901994">setStrictFakeConnClose</a></span><span class="op" id="7948102">(</span><span class="ident" id="7948103"><a href="/database/sql/sql_test.go.html#7947987">t</a></span><span class="op" id="7948104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948107">defer</span>&nbsp;<span class="ident" id="7948113"><a href="/database/sql/fakedb_test.go.html#7901994">setStrictFakeConnClose</a></span><span class="op" id="7948135">(</span><span class="ident" id="7948136">nil</span><span class="op" id="7948139">)</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948143">_</span><span class="op" id="7948144">,</span>&nbsp;<span class="ident" id="7948146">err</span>&nbsp;<span class="op" id="7948150">:=</span>&nbsp;<span class="ident" id="7948153"><a href="/database/sql/sql_test.go.html#7948004">db</a></span><span class="op" id="7948155">.</span><span class="ident" id="7948156">Query</span><span class="op" id="7948161">(</span><span class="string" id="7948162">&#34;SELECT|non_existent|name|&#34;</span><span class="op" id="7948189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948192">if</span>&nbsp;<span class="ident" id="7948195"><a href="/database/sql/sql_test.go.html#7948146">err</a></span>&nbsp;<span class="op" id="7948199">==</span>&nbsp;<span class="ident" id="7948202">nil</span>&nbsp;<span class="op" id="7948206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948210"><a href="/database/sql/sql_test.go.html#7947987">t</a></span><span class="op" id="7948211">.</span><span class="ident" id="7948212">Fatal</span><span class="op" id="7948217">(</span><span class="string" id="7948218">&#34;Quering&nbsp;non-existent&nbsp;table&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7948258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948261">}</span><br>
<span class="lineno">1315</span><span class="op" id="7948263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7948266">//&nbsp;golang.org/issue/5781</span><br>
<span class="lineno"></span><span class="keyword" id="7948291">func</span>&nbsp;<span class="ident" id="7948296">TestErrBadConnReconnect</span><span class="op" id="7948319">(</span><span class="ident" id="7948320">t</span>&nbsp;<span class="op" id="7948322">*</span><span class="ident" id="7948323"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7948330">.</span><span class="ident" id="7948331">T</span><span class="op" id="7948332">)</span>&nbsp;<span class="op" id="7948334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948337">db</span>&nbsp;<span class="op" id="7948340">:=</span>&nbsp;<span class="ident" id="7948343"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7948352">(</span><span class="ident" id="7948353"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948354">,</span>&nbsp;<span class="string" id="7948356">&#34;foo&#34;</span><span class="op" id="7948361">)</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948364">defer</span>&nbsp;<span class="ident" id="7948370"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7948377">(</span><span class="ident" id="7948378"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948379">,</span>&nbsp;<span class="ident" id="7948381"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7948383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948386"><a href="/database/sql/sql_test.go.html#7918172">exec</a></span><span class="op" id="7948390">(</span><span class="ident" id="7948391"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948392">,</span>&nbsp;<span class="ident" id="7948394"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7948396">,</span>&nbsp;<span class="string" id="7948398">&#34;CREATE|t1|name=string,age=int32,dead=bool&#34;</span><span class="op" id="7948441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948445">simulateBadConn</span>&nbsp;<span class="op" id="7948461">:=</span>&nbsp;<span class="keyword" id="7948464">func</span><span class="op" id="7948468">(</span><span class="ident" id="7948469">name</span>&nbsp;<span class="builtintype" id="7948474">string</span><span class="op" id="7948480">,</span>&nbsp;<span class="ident" id="7948482">hook</span>&nbsp;<span class="op" id="7948487">*</span><span class="keyword" id="7948488">func</span><span class="op" id="7948492">(</span><span class="op" id="7948493">)</span>&nbsp;<span class="builtintype" id="7948495">bool</span><span class="op" id="7948499">,</span>&nbsp;<span class="ident" id="7948501">op</span>&nbsp;<span class="keyword" id="7948504">func</span><span class="op" id="7948508">(</span><span class="op" id="7948509">)</span>&nbsp;<span class="builtintype" id="7948511">error</span><span class="op" id="7948516">)</span>&nbsp;<span class="op" id="7948518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948522">broken</span><span class="op" id="7948528">,</span>&nbsp;<span class="ident" id="7948530">retried</span>&nbsp;<span class="op" id="7948538">:=</span>&nbsp;<span class="ident" id="7948541">false</span><span class="op" id="7948546">,</span>&nbsp;<span class="ident" id="7948548">false</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948556">numOpen</span>&nbsp;<span class="op" id="7948564">:=</span>&nbsp;<span class="ident" id="7948567"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7948569">.</span><span class="ident" id="7948570">numOpen</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7948581">//&nbsp;simulate&nbsp;a&nbsp;broken&nbsp;connection&nbsp;on&nbsp;the&nbsp;first&nbsp;try</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948632">*</span><span class="ident" id="7948633"><a href="/database/sql/sql_test.go.html#7948482">hook</a></span>&nbsp;<span class="op" id="7948638">=</span>&nbsp;<span class="keyword" id="7948640">func</span><span class="op" id="7948644">(</span><span class="op" id="7948645">)</span>&nbsp;<span class="builtintype" id="7948647">bool</span>&nbsp;<span class="op" id="7948652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948657">if</span>&nbsp;<span class="op" id="7948660">!</span><span class="ident" id="7948661"><a href="/database/sql/sql_test.go.html#7948522">broken</a></span>&nbsp;<span class="op" id="7948668">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948674"><a href="/database/sql/sql_test.go.html#7948522">broken</a></span>&nbsp;<span class="op" id="7948681">=</span>&nbsp;<span class="ident" id="7948683">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948692">return</span>&nbsp;<span class="ident" id="7948699">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948712"><a href="/database/sql/sql_test.go.html#7948530">retried</a></span>&nbsp;<span class="op" id="7948720">=</span>&nbsp;<span class="ident" id="7948722">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948730">return</span>&nbsp;<span class="ident" id="7948737">false</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948750">if</span>&nbsp;<span class="ident" id="7948753">err</span>&nbsp;<span class="op" id="7948757">:=</span>&nbsp;<span class="ident" id="7948760"><a href="/database/sql/sql_test.go.html#7948501">op</a></span><span class="op" id="7948762">(</span><span class="op" id="7948763">)</span><span class="op" id="7948764">;</span>&nbsp;<span class="ident" id="7948766"><a href="/database/sql/sql_test.go.html#7948753">err</a></span>&nbsp;<span class="op" id="7948770">!=</span>&nbsp;<span class="ident" id="7948773">nil</span>&nbsp;<span class="op" id="7948777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948782"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948783">.</span><span class="ident" id="7948784">Errorf</span><span class="op" id="7948790">(</span><span class="ident" id="7948791"><a href="/database/sql/sql_test.go.html#7948469">name</a></span><span class="op" id="7948795">+</span><span class="string" id="7948796">&#34;:&nbsp;%v&#34;</span><span class="op" id="7948802">,</span>&nbsp;<span class="ident" id="7948804"><a href="/database/sql/sql_test.go.html#7948753">err</a></span><span class="op" id="7948807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948812">return</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948826">if</span>&nbsp;<span class="op" id="7948829">!</span><span class="ident" id="7948830"><a href="/database/sql/sql_test.go.html#7948522">broken</a></span>&nbsp;<span class="op" id="7948837">||</span>&nbsp;<span class="op" id="7948840">!</span><span class="ident" id="7948841"><a href="/database/sql/sql_test.go.html#7948530">retried</a></span>&nbsp;<span class="op" id="7948849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948854"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948855">.</span><span class="ident" id="7948856">Error</span><span class="op" id="7948861">(</span><span class="ident" id="7948862"><a href="/database/sql/sql_test.go.html#7948469">name</a></span>&nbsp;<span class="op" id="7948867">+</span>&nbsp;<span class="string" id="7948869">&#34;:&nbsp;Failed&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="7948909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948913">}</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7948917">*</span><span class="ident" id="7948918"><a href="/database/sql/sql_test.go.html#7948482">hook</a></span>&nbsp;<span class="op" id="7948923">=</span>&nbsp;<span class="ident" id="7948925">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7948932">if</span>&nbsp;<span class="ident" id="7948935"><a href="/database/sql/sql_test.go.html#7948556">numOpen</a></span>&nbsp;<span class="op" id="7948943">!=</span>&nbsp;<span class="ident" id="7948946"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7948948">.</span><span class="ident" id="7948949">numOpen</span>&nbsp;<span class="op" id="7948957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7948962"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7948963">.</span><span class="ident" id="7948964">Errorf</span><span class="op" id="7948970">(</span><span class="ident" id="7948971"><a href="/database/sql/sql_test.go.html#7948469">name</a></span><span class="op" id="7948975">+</span><span class="string" id="7948976">&#34;:&nbsp;leaked&nbsp;%d&nbsp;connection(s)!&#34;</span><span class="op" id="7949004">,</span>&nbsp;<span class="ident" id="7949006"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949008">.</span><span class="ident" id="7949009">numOpen</span><span class="op" id="7949016">-</span><span class="ident" id="7949017"><a href="/database/sql/sql_test.go.html#7948556">numOpen</a></span><span class="op" id="7949024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949029"><a href="/database/sql/sql_test.go.html#7948556">numOpen</a></span>&nbsp;<span class="op" id="7949037">=</span>&nbsp;<span class="ident" id="7949039"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949041">.</span><span class="ident" id="7949042">numOpen</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7949059">//&nbsp;db.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949071">dbExec</span>&nbsp;<span class="op" id="7949078">:=</span>&nbsp;<span class="keyword" id="7949081">func</span><span class="op" id="7949085">(</span><span class="op" id="7949086">)</span>&nbsp;<span class="builtintype" id="7949088">error</span>&nbsp;<span class="op" id="7949094">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949098">_</span><span class="op" id="7949099">,</span>&nbsp;<span class="ident" id="7949101">err</span>&nbsp;<span class="op" id="7949105">:=</span>&nbsp;<span class="ident" id="7949108"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949110">.</span><span class="ident" id="7949111">Exec</span><span class="op" id="7949115">(</span><span class="string" id="7949116">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7949147">,</span>&nbsp;<span class="string" id="7949149">&#34;Gordon&#34;</span><span class="op" id="7949157">,</span>&nbsp;<span class="num" id="7949159">3</span><span class="op" id="7949160">,</span>&nbsp;<span class="ident" id="7949162">true</span><span class="op" id="7949166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949170">return</span>&nbsp;<span class="ident" id="7949177"><a href="/database/sql/sql_test.go.html#7949101">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949185"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7949200">(</span><span class="string" id="7949201">&#34;db.Exec&nbsp;prepare&#34;</span><span class="op" id="7949218">,</span>&nbsp;<span class="op" id="7949220">&amp;</span><span class="ident" id="7949221"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7949239">,</span>&nbsp;<span class="ident" id="7949241"><a href="/database/sql/sql_test.go.html#7949071">dbExec</a></span><span class="op" id="7949247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949250"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7949265">(</span><span class="string" id="7949266">&#34;db.Exec&nbsp;exec&#34;</span><span class="op" id="7949280">,</span>&nbsp;<span class="op" id="7949282">&amp;</span><span class="ident" id="7949283"><a href="/database/sql/fakedb_test.go.html#7908921">hookExecBadConn</a></span><span class="op" id="7949298">,</span>&nbsp;<span class="ident" id="7949300"><a href="/database/sql/sql_test.go.html#7949071">dbExec</a></span><span class="op" id="7949306">)</span><br>
<span class="lineno">1360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7949310">//&nbsp;db.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949323">dbQuery</span>&nbsp;<span class="op" id="7949331">:=</span>&nbsp;<span class="keyword" id="7949334">func</span><span class="op" id="7949338">(</span><span class="op" id="7949339">)</span>&nbsp;<span class="builtintype" id="7949341">error</span>&nbsp;<span class="op" id="7949347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949351">rows</span><span class="op" id="7949355">,</span>&nbsp;<span class="ident" id="7949357">err</span>&nbsp;<span class="op" id="7949361">:=</span>&nbsp;<span class="ident" id="7949364"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949366">.</span><span class="ident" id="7949367">Query</span><span class="op" id="7949372">(</span><span class="string" id="7949373">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7949394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949398">if</span>&nbsp;<span class="ident" id="7949401"><a href="/database/sql/sql_test.go.html#7949357">err</a></span>&nbsp;<span class="op" id="7949405">==</span>&nbsp;<span class="ident" id="7949408">nil</span>&nbsp;<span class="op" id="7949412">{</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949417"><a href="/database/sql/sql_test.go.html#7949357">err</a></span>&nbsp;<span class="op" id="7949421">=</span>&nbsp;<span class="ident" id="7949423"><a href="/database/sql/sql_test.go.html#7949351">rows</a></span><span class="op" id="7949427">.</span><span class="ident" id="7949428">Close</span><span class="op" id="7949433">(</span><span class="op" id="7949434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949442">return</span>&nbsp;<span class="ident" id="7949449"><a href="/database/sql/sql_test.go.html#7949357">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949457"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7949472">(</span><span class="string" id="7949473">&#34;db.Query&nbsp;prepare&#34;</span><span class="op" id="7949491">,</span>&nbsp;<span class="op" id="7949493">&amp;</span><span class="ident" id="7949494"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7949512">,</span>&nbsp;<span class="ident" id="7949514"><a href="/database/sql/sql_test.go.html#7949323">dbQuery</a></span><span class="op" id="7949521">)</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949524"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7949539">(</span><span class="string" id="7949540">&#34;db.Query&nbsp;query&#34;</span><span class="op" id="7949556">,</span>&nbsp;<span class="op" id="7949558">&amp;</span><span class="ident" id="7949559"><a href="/database/sql/fakedb_test.go.html#7911033">hookQueryBadConn</a></span><span class="op" id="7949575">,</span>&nbsp;<span class="ident" id="7949577"><a href="/database/sql/sql_test.go.html#7949323">dbQuery</a></span><span class="op" id="7949584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7949588">//&nbsp;db.Prepare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949603"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7949618">(</span><span class="string" id="7949619">&#34;db.Prepare&#34;</span><span class="op" id="7949631">,</span>&nbsp;<span class="op" id="7949633">&amp;</span><span class="ident" id="7949634"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7949652">,</span>&nbsp;<span class="keyword" id="7949654">func</span><span class="op" id="7949658">(</span><span class="op" id="7949659">)</span>&nbsp;<span class="builtintype" id="7949661">error</span>&nbsp;<span class="op" id="7949667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949671">stmt</span><span class="op" id="7949675">,</span>&nbsp;<span class="ident" id="7949677">err</span>&nbsp;<span class="op" id="7949681">:=</span>&nbsp;<span class="ident" id="7949684"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949686">.</span><span class="ident" id="7949687">Prepare</span><span class="op" id="7949694">(</span><span class="string" id="7949695">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7949726">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949730">if</span>&nbsp;<span class="ident" id="7949733"><a href="/database/sql/sql_test.go.html#7949677">err</a></span>&nbsp;<span class="op" id="7949737">!=</span>&nbsp;<span class="ident" id="7949740">nil</span>&nbsp;<span class="op" id="7949744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949749">return</span>&nbsp;<span class="ident" id="7949756"><a href="/database/sql/sql_test.go.html#7949677">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949766"><a href="/database/sql/sql_test.go.html#7949671">stmt</a></span><span class="op" id="7949770">.</span><span class="ident" id="7949771">Close</span><span class="op" id="7949776">(</span><span class="op" id="7949777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7949781">return</span>&nbsp;<span class="ident" id="7949788">nil</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949793">}</span><span class="op" id="7949794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7949798">//&nbsp;Provide&nbsp;a&nbsp;way&nbsp;to&nbsp;force&nbsp;a&nbsp;re-prepare&nbsp;of&nbsp;a&nbsp;statement&nbsp;on&nbsp;next&nbsp;execution</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949871">forcePrepare</span>&nbsp;<span class="op" id="7949884">:=</span>&nbsp;<span class="keyword" id="7949887">func</span><span class="op" id="7949891">(</span><span class="ident" id="7949892">stmt</span>&nbsp;<span class="op" id="7949897">*</span><span class="ident" id="7949898"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><span class="op" id="7949902">)</span>&nbsp;<span class="op" id="7949904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949908"><a href="/database/sql/sql_test.go.html#7949892">stmt</a></span><span class="op" id="7949912">.</span><span class="ident" id="7949913">css</span>&nbsp;<span class="op" id="7949917">=</span>&nbsp;<span class="ident" id="7949919">nil</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7949924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7949928">//&nbsp;stmt.Exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7949942">stmt1</span><span class="op" id="7949947">,</span>&nbsp;<span class="ident" id="7949949">err</span>&nbsp;<span class="op" id="7949953">:=</span>&nbsp;<span class="ident" id="7949956"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7949958">.</span><span class="ident" id="7949959">Prepare</span><span class="op" id="7949966">(</span><span class="string" id="7949967">&#34;INSERT|t1|name=?,age=?,dead=?&#34;</span><span class="op" id="7949998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950001">if</span>&nbsp;<span class="ident" id="7950004"><a href="/database/sql/sql_test.go.html#7949949">err</a></span>&nbsp;<span class="op" id="7950008">!=</span>&nbsp;<span class="ident" id="7950011">nil</span>&nbsp;<span class="op" id="7950015">{</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950019"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7950020">.</span><span class="ident" id="7950021">Fatalf</span><span class="op" id="7950027">(</span><span class="string" id="7950028">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7950041">,</span>&nbsp;<span class="ident" id="7950043"><a href="/database/sql/sql_test.go.html#7949949">err</a></span><span class="op" id="7950046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950052">defer</span>&nbsp;<span class="ident" id="7950058"><a href="/database/sql/sql_test.go.html#7949942">stmt1</a></span><span class="op" id="7950063">.</span><span class="ident" id="7950064">Close</span><span class="op" id="7950069">(</span><span class="op" id="7950070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950073">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950118"><a href="/database/sql/sql_test.go.html#7949871">forcePrepare</a></span><span class="op" id="7950130">(</span><span class="ident" id="7950131"><a href="/database/sql/sql_test.go.html#7949942">stmt1</a></span><span class="op" id="7950136">)</span><br>
<span class="lineno">1395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950140">stmtExec</span>&nbsp;<span class="op" id="7950149">:=</span>&nbsp;<span class="keyword" id="7950152">func</span><span class="op" id="7950156">(</span><span class="op" id="7950157">)</span>&nbsp;<span class="builtintype" id="7950159">error</span>&nbsp;<span class="op" id="7950165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950169">_</span><span class="op" id="7950170">,</span>&nbsp;<span class="ident" id="7950172">err</span>&nbsp;<span class="op" id="7950176">:=</span>&nbsp;<span class="ident" id="7950179"><a href="/database/sql/sql_test.go.html#7949942">stmt1</a></span><span class="op" id="7950184">.</span><span class="ident" id="7950185">Exec</span><span class="op" id="7950189">(</span><span class="string" id="7950190">&#34;Gopher&#34;</span><span class="op" id="7950198">,</span>&nbsp;<span class="num" id="7950200">3</span><span class="op" id="7950201">,</span>&nbsp;<span class="ident" id="7950203">false</span><span class="op" id="7950208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950212">return</span>&nbsp;<span class="ident" id="7950219"><a href="/database/sql/sql_test.go.html#7950172">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950224">}</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950227"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7950242">(</span><span class="string" id="7950243">&#34;stmt.Exec&nbsp;prepare&#34;</span><span class="op" id="7950262">,</span>&nbsp;<span class="op" id="7950264">&amp;</span><span class="ident" id="7950265"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7950283">,</span>&nbsp;<span class="ident" id="7950285"><a href="/database/sql/sql_test.go.html#7950140">stmtExec</a></span><span class="op" id="7950293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950296"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7950311">(</span><span class="string" id="7950312">&#34;stmt.Exec&nbsp;exec&#34;</span><span class="op" id="7950328">,</span>&nbsp;<span class="op" id="7950330">&amp;</span><span class="ident" id="7950331"><a href="/database/sql/fakedb_test.go.html#7908921">hookExecBadConn</a></span><span class="op" id="7950346">,</span>&nbsp;<span class="ident" id="7950348"><a href="/database/sql/sql_test.go.html#7950140">stmtExec</a></span><span class="op" id="7950356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950360">//&nbsp;stmt.Query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950375">stmt2</span><span class="op" id="7950380">,</span>&nbsp;<span class="ident" id="7950382"><a href="/database/sql/sql_test.go.html#7949949">err</a></span>&nbsp;<span class="op" id="7950386">:=</span>&nbsp;<span class="ident" id="7950389"><a href="/database/sql/sql_test.go.html#7948337">db</a></span><span class="op" id="7950391">.</span><span class="ident" id="7950392">Prepare</span><span class="op" id="7950399">(</span><span class="string" id="7950400">&#34;SELECT|t1|age,name|&#34;</span><span class="op" id="7950421">)</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950424">if</span>&nbsp;<span class="ident" id="7950427"><a href="/database/sql/sql_test.go.html#7949949">err</a></span>&nbsp;<span class="op" id="7950431">!=</span>&nbsp;<span class="ident" id="7950434">nil</span>&nbsp;<span class="op" id="7950438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950442"><a href="/database/sql/sql_test.go.html#7948320">t</a></span><span class="op" id="7950443">.</span><span class="ident" id="7950444">Fatalf</span><span class="op" id="7950450">(</span><span class="string" id="7950451">&#34;prepare:&nbsp;%v&#34;</span><span class="op" id="7950464">,</span>&nbsp;<span class="ident" id="7950466"><a href="/database/sql/sql_test.go.html#7949949">err</a></span><span class="op" id="7950469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950475">defer</span>&nbsp;<span class="ident" id="7950481"><a href="/database/sql/sql_test.go.html#7950375">stmt2</a></span><span class="op" id="7950486">.</span><span class="ident" id="7950487">Close</span><span class="op" id="7950492">(</span><span class="op" id="7950493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950496">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;must&nbsp;prepare&nbsp;the&nbsp;stmt&nbsp;first</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950541"><a href="/database/sql/sql_test.go.html#7949871">forcePrepare</a></span><span class="op" id="7950553">(</span><span class="ident" id="7950554"><a href="/database/sql/sql_test.go.html#7950375">stmt2</a></span><span class="op" id="7950559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950563">stmtQuery</span>&nbsp;<span class="op" id="7950573">:=</span>&nbsp;<span class="keyword" id="7950576">func</span><span class="op" id="7950580">(</span><span class="op" id="7950581">)</span>&nbsp;<span class="builtintype" id="7950583">error</span>&nbsp;<span class="op" id="7950589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950593">rows</span><span class="op" id="7950597">,</span>&nbsp;<span class="ident" id="7950599">err</span>&nbsp;<span class="op" id="7950603">:=</span>&nbsp;<span class="ident" id="7950606"><a href="/database/sql/sql_test.go.html#7950375">stmt2</a></span><span class="op" id="7950611">.</span><span class="ident" id="7950612">Query</span><span class="op" id="7950617">(</span><span class="op" id="7950618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950622">if</span>&nbsp;<span class="ident" id="7950625"><a href="/database/sql/sql_test.go.html#7950599">err</a></span>&nbsp;<span class="op" id="7950629">==</span>&nbsp;<span class="ident" id="7950632">nil</span>&nbsp;<span class="op" id="7950636">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950641"><a href="/database/sql/sql_test.go.html#7950599">err</a></span>&nbsp;<span class="op" id="7950645">=</span>&nbsp;<span class="ident" id="7950647"><a href="/database/sql/sql_test.go.html#7950593">rows</a></span><span class="op" id="7950651">.</span><span class="ident" id="7950652">Close</span><span class="op" id="7950657">(</span><span class="op" id="7950658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950666">return</span>&nbsp;<span class="ident" id="7950673"><a href="/database/sql/sql_test.go.html#7950599">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950681"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7950696">(</span><span class="string" id="7950697">&#34;stmt.Query&nbsp;prepare&#34;</span><span class="op" id="7950717">,</span>&nbsp;<span class="op" id="7950719">&amp;</span><span class="ident" id="7950720"><a href="/database/sql/fakedb_test.go.html#7907392">hookPrepareBadConn</a></span><span class="op" id="7950738">,</span>&nbsp;<span class="ident" id="7950740"><a href="/database/sql/sql_test.go.html#7950563">stmtQuery</a></span><span class="op" id="7950749">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950752"><a href="/database/sql/sql_test.go.html#7948445">simulateBadConn</a></span><span class="op" id="7950767">(</span><span class="string" id="7950768">&#34;stmt.Query&nbsp;exec&#34;</span><span class="op" id="7950785">,</span>&nbsp;<span class="op" id="7950787">&amp;</span><span class="ident" id="7950788"><a href="/database/sql/fakedb_test.go.html#7911033">hookQueryBadConn</a></span><span class="op" id="7950804">,</span>&nbsp;<span class="ident" id="7950806"><a href="/database/sql/sql_test.go.html#7950563">stmtQuery</a></span><span class="op" id="7950815">)</span><br>
<span class="lineno"></span><span class="op" id="7950817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950820">type</span>&nbsp;<span class="ident" id="7950825">concurrentTest</span>&nbsp;<span class="keyword" id="7950840">interface</span>&nbsp;<span class="op" id="7950850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950853">init</span><span class="op" id="7950857">(</span><span class="ident" id="7950858">t</span>&nbsp;<span class="ident" id="7950860"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7950867">.</span><span class="ident" id="7950868">TB</span><span class="op" id="7950870">,</span>&nbsp;<span class="ident" id="7950872">db</span>&nbsp;<span class="op" id="7950875">*</span><span class="ident" id="7950876"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7950878">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950881">finish</span><span class="op" id="7950887">(</span><span class="ident" id="7950888">t</span>&nbsp;<span class="ident" id="7950890"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7950897">.</span><span class="ident" id="7950898">TB</span><span class="op" id="7950900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950903">test</span><span class="op" id="7950907">(</span><span class="ident" id="7950908">t</span>&nbsp;<span class="ident" id="7950910"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7950917">.</span><span class="ident" id="7950918">TB</span><span class="op" id="7950920">)</span>&nbsp;<span class="builtintype" id="7950922">error</span><br>
<span class="lineno"></span><span class="op" id="7950928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950931">type</span>&nbsp;<span class="ident" id="7950936">concurrentDBQueryTest</span>&nbsp;<span class="keyword" id="7950958">struct</span>&nbsp;<span class="op" id="7950965">{</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950968">db</span>&nbsp;<span class="op" id="7950971">*</span><span class="ident" id="7950972"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7950975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950978">func</span>&nbsp;<span class="op" id="7950983">(</span><span class="ident" id="7950984">c</span>&nbsp;<span class="op" id="7950986">*</span><span class="ident" id="7950987"><a href="/database/sql/sql_test.go.html#7950936">concurrentDBQueryTest</a></span><span class="op" id="7951008">)</span>&nbsp;<span class="ident" id="7951010">init</span><span class="op" id="7951014">(</span><span class="ident" id="7951015">t</span>&nbsp;<span class="ident" id="7951017"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951024">.</span><span class="ident" id="7951025">TB</span><span class="op" id="7951027">,</span>&nbsp;<span class="ident" id="7951029">db</span>&nbsp;<span class="op" id="7951032">*</span><span class="ident" id="7951033"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7951035">)</span>&nbsp;<span class="op" id="7951037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951040"><a href="/database/sql/sql_test.go.html#7950984">c</a></span><span class="op" id="7951041">.</span><span class="ident" id="7951042">db</span>&nbsp;<span class="op" id="7951045">=</span>&nbsp;<span class="ident" id="7951047"><a href="/database/sql/sql_test.go.html#7951029">db</a></span><br>
<span class="lineno">1435</span><span class="op" id="7951050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951053">func</span>&nbsp;<span class="op" id="7951058">(</span><span class="ident" id="7951059">c</span>&nbsp;<span class="op" id="7951061">*</span><span class="ident" id="7951062"><a href="/database/sql/sql_test.go.html#7950936">concurrentDBQueryTest</a></span><span class="op" id="7951083">)</span>&nbsp;<span class="ident" id="7951085">finish</span><span class="op" id="7951091">(</span><span class="ident" id="7951092">t</span>&nbsp;<span class="ident" id="7951094"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951101">.</span><span class="ident" id="7951102">TB</span><span class="op" id="7951104">)</span>&nbsp;<span class="op" id="7951106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951109"><a href="/database/sql/sql_test.go.html#7951059">c</a></span><span class="op" id="7951110">.</span><span class="ident" id="7951111">db</span>&nbsp;<span class="op" id="7951114">=</span>&nbsp;<span class="ident" id="7951116">nil</span><br>
<span class="lineno"></span><span class="op" id="7951120">}</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="keyword" id="7951123">func</span>&nbsp;<span class="op" id="7951128">(</span><span class="ident" id="7951129">c</span>&nbsp;<span class="op" id="7951131">*</span><span class="ident" id="7951132"><a href="/database/sql/sql_test.go.html#7950936">concurrentDBQueryTest</a></span><span class="op" id="7951153">)</span>&nbsp;<span class="ident" id="7951155">test</span><span class="op" id="7951159">(</span><span class="ident" id="7951160">t</span>&nbsp;<span class="ident" id="7951162"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951169">.</span><span class="ident" id="7951170">TB</span><span class="op" id="7951172">)</span>&nbsp;<span class="builtintype" id="7951174">error</span>&nbsp;<span class="op" id="7951180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951183">rows</span><span class="op" id="7951187">,</span>&nbsp;<span class="ident" id="7951189">err</span>&nbsp;<span class="op" id="7951193">:=</span>&nbsp;<span class="ident" id="7951196"><a href="/database/sql/sql_test.go.html#7951129">c</a></span><span class="op" id="7951197">.</span><span class="ident" id="7951198">db</span><span class="op" id="7951200">.</span><span class="ident" id="7951201">Query</span><span class="op" id="7951206">(</span><span class="string" id="7951207">&#34;SELECT|people|name|&#34;</span><span class="op" id="7951228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951231">if</span>&nbsp;<span class="ident" id="7951234"><a href="/database/sql/sql_test.go.html#7951189">err</a></span>&nbsp;<span class="op" id="7951238">!=</span>&nbsp;<span class="ident" id="7951241">nil</span>&nbsp;<span class="op" id="7951245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951249"><a href="/database/sql/sql_test.go.html#7951160">t</a></span><span class="op" id="7951250">.</span><span class="ident" id="7951251">Error</span><span class="op" id="7951256">(</span><span class="ident" id="7951257"><a href="/database/sql/sql_test.go.html#7951189">err</a></span><span class="op" id="7951260">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951264">return</span>&nbsp;<span class="ident" id="7951271"><a href="/database/sql/sql_test.go.html#7951189">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951279">var</span>&nbsp;<span class="ident" id="7951283">name</span>&nbsp;<span class="builtintype" id="7951288">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951296">for</span>&nbsp;<span class="ident" id="7951300"><a href="/database/sql/sql_test.go.html#7951183">rows</a></span><span class="op" id="7951304">.</span><span class="ident" id="7951305">Next</span><span class="op" id="7951309">(</span><span class="op" id="7951310">)</span>&nbsp;<span class="op" id="7951312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951316"><a href="/database/sql/sql_test.go.html#7951183">rows</a></span><span class="op" id="7951320">.</span><span class="ident" id="7951321">Scan</span><span class="op" id="7951325">(</span><span class="op" id="7951326">&amp;</span><span class="ident" id="7951327"><a href="/database/sql/sql_test.go.html#7951283">name</a></span><span class="op" id="7951331">)</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951337"><a href="/database/sql/sql_test.go.html#7951183">rows</a></span><span class="op" id="7951341">.</span><span class="ident" id="7951342">Close</span><span class="op" id="7951347">(</span><span class="op" id="7951348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951351">return</span>&nbsp;<span class="ident" id="7951358">nil</span><br>
<span class="lineno"></span><span class="op" id="7951362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1455</span><span class="keyword" id="7951365">type</span>&nbsp;<span class="ident" id="7951370">concurrentDBExecTest</span>&nbsp;<span class="keyword" id="7951391">struct</span>&nbsp;<span class="op" id="7951398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951401">db</span>&nbsp;<span class="op" id="7951404">*</span><span class="ident" id="7951405"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span><span class="op" id="7951408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951411">func</span>&nbsp;<span class="op" id="7951416">(</span><span class="ident" id="7951417">c</span>&nbsp;<span class="op" id="7951419">*</span><span class="ident" id="7951420"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7951440">)</span>&nbsp;<span class="ident" id="7951442">init</span><span class="op" id="7951446">(</span><span class="ident" id="7951447">t</span>&nbsp;<span class="ident" id="7951449"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951456">.</span><span class="ident" id="7951457">TB</span><span class="op" id="7951459">,</span>&nbsp;<span class="ident" id="7951461">db</span>&nbsp;<span class="op" id="7951464">*</span><span class="ident" id="7951465"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7951467">)</span>&nbsp;<span class="op" id="7951469">{</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951472"><a href="/database/sql/sql_test.go.html#7951417">c</a></span><span class="op" id="7951473">.</span><span class="ident" id="7951474">db</span>&nbsp;<span class="op" id="7951477">=</span>&nbsp;<span class="ident" id="7951479"><a href="/database/sql/sql_test.go.html#7951461">db</a></span><br>
<span class="lineno"></span><span class="op" id="7951482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951485">func</span>&nbsp;<span class="op" id="7951490">(</span><span class="ident" id="7951491">c</span>&nbsp;<span class="op" id="7951493">*</span><span class="ident" id="7951494"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7951514">)</span>&nbsp;<span class="ident" id="7951516">finish</span><span class="op" id="7951522">(</span><span class="ident" id="7951523">t</span>&nbsp;<span class="ident" id="7951525"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951532">.</span><span class="ident" id="7951533">TB</span><span class="op" id="7951535">)</span>&nbsp;<span class="op" id="7951537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951540"><a href="/database/sql/sql_test.go.html#7951491">c</a></span><span class="op" id="7951541">.</span><span class="ident" id="7951542">db</span>&nbsp;<span class="op" id="7951545">=</span>&nbsp;<span class="ident" id="7951547">nil</span><br>
<span class="lineno">1465</span><span class="op" id="7951551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7951554">func</span>&nbsp;<span class="op" id="7951559">(</span><span class="ident" id="7951560">c</span>&nbsp;<span class="op" id="7951562">*</span><span class="ident" id="7951563"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7951583">)</span>&nbsp;<span class="ident" id="7951585">test</span><span class="op" id="7951589">(</span><span class="ident" id="7951590">t</span>&nbsp;<span class="ident" id="7951592"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951599">.</span><span class="ident" id="7951600">TB</span><span class="op" id="7951602">)</span>&nbsp;<span class="builtintype" id="7951604">error</span>&nbsp;<span class="op" id="7951610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951613">_</span><span class="op" id="7951614">,</span>&nbsp;<span class="ident" id="7951616">err</span>&nbsp;<span class="op" id="7951620">:=</span>&nbsp;<span class="ident" id="7951623"><a href="/database/sql/sql_test.go.html#7951560">c</a></span><span class="op" id="7951624">.</span><span class="ident" id="7951625">db</span><span class="op" id="7951627">.</span><span class="ident" id="7951628">Exec</span><span class="op" id="7951632">(</span><span class="string" id="7951633">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7951686">,</span>&nbsp;<span class="num" id="7951688">3</span><span class="op" id="7951689">,</span>&nbsp;<span class="ident" id="7951691"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7951704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951707">if</span>&nbsp;<span class="ident" id="7951710"><a href="/database/sql/sql_test.go.html#7951616">err</a></span>&nbsp;<span class="op" id="7951714">!=</span>&nbsp;<span class="ident" id="7951717">nil</span>&nbsp;<span class="op" id="7951721">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951725"><a href="/database/sql/sql_test.go.html#7951590">t</a></span><span class="op" id="7951726">.</span><span class="ident" id="7951727">Error</span><span class="op" id="7951732">(</span><span class="ident" id="7951733"><a href="/database/sql/sql_test.go.html#7951616">err</a></span><span class="op" id="7951736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951740">return</span>&nbsp;<span class="ident" id="7951747"><a href="/database/sql/sql_test.go.html#7951616">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951755">return</span>&nbsp;<span class="ident" id="7951762">nil</span><br>
<span class="lineno"></span><span class="op" id="7951766">}</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span><span class="keyword" id="7951769">type</span>&nbsp;<span class="ident" id="7951774">concurrentStmtQueryTest</span>&nbsp;<span class="keyword" id="7951798">struct</span>&nbsp;<span class="op" id="7951805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951808">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7951813">*</span><span class="ident" id="7951814"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951818">stmt</span>&nbsp;<span class="op" id="7951823">*</span><span class="ident" id="7951824"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7951829">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span><span class="keyword" id="7951832">func</span>&nbsp;<span class="op" id="7951837">(</span><span class="ident" id="7951838">c</span>&nbsp;<span class="op" id="7951840">*</span><span class="ident" id="7951841"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7951864">)</span>&nbsp;<span class="ident" id="7951866">init</span><span class="op" id="7951870">(</span><span class="ident" id="7951871">t</span>&nbsp;<span class="ident" id="7951873"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7951880">.</span><span class="ident" id="7951881">TB</span><span class="op" id="7951883">,</span>&nbsp;<span class="ident" id="7951885">db</span>&nbsp;<span class="op" id="7951888">*</span><span class="ident" id="7951889"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7951891">)</span>&nbsp;<span class="op" id="7951893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951896"><a href="/database/sql/sql_test.go.html#7951838">c</a></span><span class="op" id="7951897">.</span><span class="ident" id="7951898">db</span>&nbsp;<span class="op" id="7951901">=</span>&nbsp;<span class="ident" id="7951903"><a href="/database/sql/sql_test.go.html#7951885">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951907">var</span>&nbsp;<span class="ident" id="7951911">err</span>&nbsp;<span class="builtintype" id="7951915">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951922"><a href="/database/sql/sql_test.go.html#7951838">c</a></span><span class="op" id="7951923">.</span><span class="ident" id="7951924">stmt</span><span class="op" id="7951928">,</span>&nbsp;<span class="ident" id="7951930"><a href="/database/sql/sql_test.go.html#7951911">err</a></span>&nbsp;<span class="op" id="7951934">=</span>&nbsp;<span class="ident" id="7951936"><a href="/database/sql/sql_test.go.html#7951885">db</a></span><span class="op" id="7951938">.</span><span class="ident" id="7951939">Prepare</span><span class="op" id="7951946">(</span><span class="string" id="7951947">&#34;SELECT|people|name|&#34;</span><span class="op" id="7951968">)</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951971">if</span>&nbsp;<span class="ident" id="7951974"><a href="/database/sql/sql_test.go.html#7951911">err</a></span>&nbsp;<span class="op" id="7951978">!=</span>&nbsp;<span class="ident" id="7951981">nil</span>&nbsp;<span class="op" id="7951985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951989"><a href="/database/sql/sql_test.go.html#7951871">t</a></span><span class="op" id="7951990">.</span><span class="ident" id="7951991">Fatal</span><span class="op" id="7951996">(</span><span class="ident" id="7951997"><a href="/database/sql/sql_test.go.html#7951911">err</a></span><span class="op" id="7952000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952003">}</span><br>
<span class="lineno"></span><span class="op" id="7952005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1490</span><span class="keyword" id="7952008">func</span>&nbsp;<span class="op" id="7952013">(</span><span class="ident" id="7952014">c</span>&nbsp;<span class="op" id="7952016">*</span><span class="ident" id="7952017"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7952040">)</span>&nbsp;<span class="ident" id="7952042">finish</span><span class="op" id="7952048">(</span><span class="ident" id="7952049">t</span>&nbsp;<span class="ident" id="7952051"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7952058">.</span><span class="ident" id="7952059">TB</span><span class="op" id="7952061">)</span>&nbsp;<span class="op" id="7952063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952066">if</span>&nbsp;<span class="ident" id="7952069"><a href="/database/sql/sql_test.go.html#7952014">c</a></span><span class="op" id="7952070">.</span><span class="ident" id="7952071">stmt</span>&nbsp;<span class="op" id="7952076">!=</span>&nbsp;<span class="ident" id="7952079">nil</span>&nbsp;<span class="op" id="7952083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952087"><a href="/database/sql/sql_test.go.html#7952014">c</a></span><span class="op" id="7952088">.</span><span class="ident" id="7952089">stmt</span><span class="op" id="7952093">.</span><span class="ident" id="7952094">Close</span><span class="op" id="7952099">(</span><span class="op" id="7952100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952104"><a href="/database/sql/sql_test.go.html#7952014">c</a></span><span class="op" id="7952105">.</span><span class="ident" id="7952106">stmt</span>&nbsp;<span class="op" id="7952111">=</span>&nbsp;<span class="ident" id="7952113">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952118">}</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952121"><a href="/database/sql/sql_test.go.html#7952014">c</a></span><span class="op" id="7952122">.</span><span class="ident" id="7952123">db</span>&nbsp;<span class="op" id="7952126">=</span>&nbsp;<span class="ident" id="7952128">nil</span><br>
<span class="lineno"></span><span class="op" id="7952132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7952135">func</span>&nbsp;<span class="op" id="7952140">(</span><span class="ident" id="7952141">c</span>&nbsp;<span class="op" id="7952143">*</span><span class="ident" id="7952144"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7952167">)</span>&nbsp;<span class="ident" id="7952169">test</span><span class="op" id="7952173">(</span><span class="ident" id="7952174">t</span>&nbsp;<span class="ident" id="7952176"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7952183">.</span><span class="ident" id="7952184">TB</span><span class="op" id="7952186">)</span>&nbsp;<span class="builtintype" id="7952188">error</span>&nbsp;<span class="op" id="7952194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952197">rows</span><span class="op" id="7952201">,</span>&nbsp;<span class="ident" id="7952203">err</span>&nbsp;<span class="op" id="7952207">:=</span>&nbsp;<span class="ident" id="7952210"><a href="/database/sql/sql_test.go.html#7952141">c</a></span><span class="op" id="7952211">.</span><span class="ident" id="7952212">stmt</span><span class="op" id="7952216">.</span><span class="ident" id="7952217">Query</span><span class="op" id="7952222">(</span><span class="op" id="7952223">)</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952226">if</span>&nbsp;<span class="ident" id="7952229"><a href="/database/sql/sql_test.go.html#7952203">err</a></span>&nbsp;<span class="op" id="7952233">!=</span>&nbsp;<span class="ident" id="7952236">nil</span>&nbsp;<span class="op" id="7952240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952244"><a href="/database/sql/sql_test.go.html#7952174">t</a></span><span class="op" id="7952245">.</span><span class="ident" id="7952246">Errorf</span><span class="op" id="7952252">(</span><span class="string" id="7952253">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7952274">,</span>&nbsp;<span class="ident" id="7952276"><a href="/database/sql/sql_test.go.html#7952203">err</a></span><span class="op" id="7952279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952283">return</span>&nbsp;<span class="ident" id="7952290"><a href="/database/sql/sql_test.go.html#7952203">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952299">var</span>&nbsp;<span class="ident" id="7952303">name</span>&nbsp;<span class="builtintype" id="7952308">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952316">for</span>&nbsp;<span class="ident" id="7952320"><a href="/database/sql/sql_test.go.html#7952197">rows</a></span><span class="op" id="7952324">.</span><span class="ident" id="7952325">Next</span><span class="op" id="7952329">(</span><span class="op" id="7952330">)</span>&nbsp;<span class="op" id="7952332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952336"><a href="/database/sql/sql_test.go.html#7952197">rows</a></span><span class="op" id="7952340">.</span><span class="ident" id="7952341">Scan</span><span class="op" id="7952345">(</span><span class="op" id="7952346">&amp;</span><span class="ident" id="7952347"><a href="/database/sql/sql_test.go.html#7952303">name</a></span><span class="op" id="7952351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952357"><a href="/database/sql/sql_test.go.html#7952197">rows</a></span><span class="op" id="7952361">.</span><span class="ident" id="7952362">Close</span><span class="op" id="7952367">(</span><span class="op" id="7952368">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952371">return</span>&nbsp;<span class="ident" id="7952378">nil</span><br>
<span class="lineno"></span><span class="op" id="7952382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7952385">type</span>&nbsp;<span class="ident" id="7952390">concurrentStmtExecTest</span>&nbsp;<span class="keyword" id="7952413">struct</span>&nbsp;<span class="op" id="7952420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952423">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7952428">*</span><span class="ident" id="7952429"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952433">stmt</span>&nbsp;<span class="op" id="7952438">*</span><span class="ident" id="7952439"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7952444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7952447">func</span>&nbsp;<span class="op" id="7952452">(</span><span class="ident" id="7952453">c</span>&nbsp;<span class="op" id="7952455">*</span><span class="ident" id="7952456"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7952478">)</span>&nbsp;<span class="ident" id="7952480">init</span><span class="op" id="7952484">(</span><span class="ident" id="7952485">t</span>&nbsp;<span class="ident" id="7952487"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7952494">.</span><span class="ident" id="7952495">TB</span><span class="op" id="7952497">,</span>&nbsp;<span class="ident" id="7952499">db</span>&nbsp;<span class="op" id="7952502">*</span><span class="ident" id="7952503"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7952505">)</span>&nbsp;<span class="op" id="7952507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952510"><a href="/database/sql/sql_test.go.html#7952453">c</a></span><span class="op" id="7952511">.</span><span class="ident" id="7952512">db</span>&nbsp;<span class="op" id="7952515">=</span>&nbsp;<span class="ident" id="7952517"><a href="/database/sql/sql_test.go.html#7952499">db</a></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952521">var</span>&nbsp;<span class="ident" id="7952525">err</span>&nbsp;<span class="builtintype" id="7952529">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952536"><a href="/database/sql/sql_test.go.html#7952453">c</a></span><span class="op" id="7952537">.</span><span class="ident" id="7952538">stmt</span><span class="op" id="7952542">,</span>&nbsp;<span class="ident" id="7952544"><a href="/database/sql/sql_test.go.html#7952525">err</a></span>&nbsp;<span class="op" id="7952548">=</span>&nbsp;<span class="ident" id="7952550"><a href="/database/sql/sql_test.go.html#7952499">db</a></span><span class="op" id="7952552">.</span><span class="ident" id="7952553">Prepare</span><span class="op" id="7952560">(</span><span class="string" id="7952561">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7952614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952617">if</span>&nbsp;<span class="ident" id="7952620"><a href="/database/sql/sql_test.go.html#7952525">err</a></span>&nbsp;<span class="op" id="7952624">!=</span>&nbsp;<span class="ident" id="7952627">nil</span>&nbsp;<span class="op" id="7952631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952635"><a href="/database/sql/sql_test.go.html#7952485">t</a></span><span class="op" id="7952636">.</span><span class="ident" id="7952637">Fatal</span><span class="op" id="7952642">(</span><span class="ident" id="7952643"><a href="/database/sql/sql_test.go.html#7952525">err</a></span><span class="op" id="7952646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952649">}</span><br>
<span class="lineno">1525</span><span class="op" id="7952651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7952654">func</span>&nbsp;<span class="op" id="7952659">(</span><span class="ident" id="7952660">c</span>&nbsp;<span class="op" id="7952662">*</span><span class="ident" id="7952663"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7952685">)</span>&nbsp;<span class="ident" id="7952687">finish</span><span class="op" id="7952693">(</span><span class="ident" id="7952694">t</span>&nbsp;<span class="ident" id="7952696"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7952703">.</span><span class="ident" id="7952704">TB</span><span class="op" id="7952706">)</span>&nbsp;<span class="op" id="7952708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952711">if</span>&nbsp;<span class="ident" id="7952714"><a href="/database/sql/sql_test.go.html#7952660">c</a></span><span class="op" id="7952715">.</span><span class="ident" id="7952716">stmt</span>&nbsp;<span class="op" id="7952721">!=</span>&nbsp;<span class="ident" id="7952724">nil</span>&nbsp;<span class="op" id="7952728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952732"><a href="/database/sql/sql_test.go.html#7952660">c</a></span><span class="op" id="7952733">.</span><span class="ident" id="7952734">stmt</span><span class="op" id="7952738">.</span><span class="ident" id="7952739">Close</span><span class="op" id="7952744">(</span><span class="op" id="7952745">)</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952749"><a href="/database/sql/sql_test.go.html#7952660">c</a></span><span class="op" id="7952750">.</span><span class="ident" id="7952751">stmt</span>&nbsp;<span class="op" id="7952756">=</span>&nbsp;<span class="ident" id="7952758">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952766"><a href="/database/sql/sql_test.go.html#7952660">c</a></span><span class="op" id="7952767">.</span><span class="ident" id="7952768">db</span>&nbsp;<span class="op" id="7952771">=</span>&nbsp;<span class="ident" id="7952773">nil</span><br>
<span class="lineno"></span><span class="op" id="7952777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1535</span><span class="keyword" id="7952780">func</span>&nbsp;<span class="op" id="7952785">(</span><span class="ident" id="7952786">c</span>&nbsp;<span class="op" id="7952788">*</span><span class="ident" id="7952789"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7952811">)</span>&nbsp;<span class="ident" id="7952813">test</span><span class="op" id="7952817">(</span><span class="ident" id="7952818">t</span>&nbsp;<span class="ident" id="7952820"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7952827">.</span><span class="ident" id="7952828">TB</span><span class="op" id="7952830">)</span>&nbsp;<span class="builtintype" id="7952832">error</span>&nbsp;<span class="op" id="7952838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952841">_</span><span class="op" id="7952842">,</span>&nbsp;<span class="ident" id="7952844">err</span>&nbsp;<span class="op" id="7952848">:=</span>&nbsp;<span class="ident" id="7952851"><a href="/database/sql/sql_test.go.html#7952786">c</a></span><span class="op" id="7952852">.</span><span class="ident" id="7952853">stmt</span><span class="op" id="7952857">.</span><span class="ident" id="7952858">Exec</span><span class="op" id="7952862">(</span><span class="num" id="7952863">3</span><span class="op" id="7952864">,</span>&nbsp;<span class="ident" id="7952866"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7952879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952882">if</span>&nbsp;<span class="ident" id="7952885"><a href="/database/sql/sql_test.go.html#7952844">err</a></span>&nbsp;<span class="op" id="7952889">!=</span>&nbsp;<span class="ident" id="7952892">nil</span>&nbsp;<span class="op" id="7952896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952900"><a href="/database/sql/sql_test.go.html#7952818">t</a></span><span class="op" id="7952901">.</span><span class="ident" id="7952902">Errorf</span><span class="op" id="7952908">(</span><span class="string" id="7952909">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7952929">,</span>&nbsp;<span class="ident" id="7952931"><a href="/database/sql/sql_test.go.html#7952844">err</a></span><span class="op" id="7952934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952938">return</span>&nbsp;<span class="ident" id="7952945"><a href="/database/sql/sql_test.go.html#7952844">err</a></span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7952953">return</span>&nbsp;<span class="ident" id="7952960">nil</span><br>
<span class="lineno"></span><span class="op" id="7952964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7952967">type</span>&nbsp;<span class="ident" id="7952972">concurrentTxQueryTest</span>&nbsp;<span class="keyword" id="7952994">struct</span>&nbsp;<span class="op" id="7953001">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953004">db</span>&nbsp;<span class="op" id="7953007">*</span><span class="ident" id="7953008"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953012">tx</span>&nbsp;<span class="op" id="7953015">*</span><span class="ident" id="7953016"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7953019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953022">func</span>&nbsp;<span class="op" id="7953027">(</span><span class="ident" id="7953028">c</span>&nbsp;<span class="op" id="7953030">*</span><span class="ident" id="7953031"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7953052">)</span>&nbsp;<span class="ident" id="7953054">init</span><span class="op" id="7953058">(</span><span class="ident" id="7953059">t</span>&nbsp;<span class="ident" id="7953061"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953068">.</span><span class="ident" id="7953069">TB</span><span class="op" id="7953071">,</span>&nbsp;<span class="ident" id="7953073">db</span>&nbsp;<span class="op" id="7953076">*</span><span class="ident" id="7953077"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7953079">)</span>&nbsp;<span class="op" id="7953081">{</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953084"><a href="/database/sql/sql_test.go.html#7953028">c</a></span><span class="op" id="7953085">.</span><span class="ident" id="7953086">db</span>&nbsp;<span class="op" id="7953089">=</span>&nbsp;<span class="ident" id="7953091"><a href="/database/sql/sql_test.go.html#7953073">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953095">var</span>&nbsp;<span class="ident" id="7953099">err</span>&nbsp;<span class="builtintype" id="7953103">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953110"><a href="/database/sql/sql_test.go.html#7953028">c</a></span><span class="op" id="7953111">.</span><span class="ident" id="7953112">tx</span><span class="op" id="7953114">,</span>&nbsp;<span class="ident" id="7953116"><a href="/database/sql/sql_test.go.html#7953099">err</a></span>&nbsp;<span class="op" id="7953120">=</span>&nbsp;<span class="ident" id="7953122"><a href="/database/sql/sql_test.go.html#7953028">c</a></span><span class="op" id="7953123">.</span><span class="ident" id="7953124">db</span><span class="op" id="7953126">.</span><span class="ident" id="7953127">Begin</span><span class="op" id="7953132">(</span><span class="op" id="7953133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953136">if</span>&nbsp;<span class="ident" id="7953139"><a href="/database/sql/sql_test.go.html#7953099">err</a></span>&nbsp;<span class="op" id="7953143">!=</span>&nbsp;<span class="ident" id="7953146">nil</span>&nbsp;<span class="op" id="7953150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953154"><a href="/database/sql/sql_test.go.html#7953059">t</a></span><span class="op" id="7953155">.</span><span class="ident" id="7953156">Fatal</span><span class="op" id="7953161">(</span><span class="ident" id="7953162"><a href="/database/sql/sql_test.go.html#7953099">err</a></span><span class="op" id="7953165">)</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953168">}</span><br>
<span class="lineno"></span><span class="op" id="7953170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953173">func</span>&nbsp;<span class="op" id="7953178">(</span><span class="ident" id="7953179">c</span>&nbsp;<span class="op" id="7953181">*</span><span class="ident" id="7953182"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7953203">)</span>&nbsp;<span class="ident" id="7953205">finish</span><span class="op" id="7953211">(</span><span class="ident" id="7953212">t</span>&nbsp;<span class="ident" id="7953214"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953221">.</span><span class="ident" id="7953222">TB</span><span class="op" id="7953224">)</span>&nbsp;<span class="op" id="7953226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953229">if</span>&nbsp;<span class="ident" id="7953232"><a href="/database/sql/sql_test.go.html#7953179">c</a></span><span class="op" id="7953233">.</span><span class="ident" id="7953234">tx</span>&nbsp;<span class="op" id="7953237">!=</span>&nbsp;<span class="ident" id="7953240">nil</span>&nbsp;<span class="op" id="7953244">{</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953248"><a href="/database/sql/sql_test.go.html#7953179">c</a></span><span class="op" id="7953249">.</span><span class="ident" id="7953250">tx</span><span class="op" id="7953252">.</span><span class="ident" id="7953253">Rollback</span><span class="op" id="7953261">(</span><span class="op" id="7953262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953266"><a href="/database/sql/sql_test.go.html#7953179">c</a></span><span class="op" id="7953267">.</span><span class="ident" id="7953268">tx</span>&nbsp;<span class="op" id="7953271">=</span>&nbsp;<span class="ident" id="7953273">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953281"><a href="/database/sql/sql_test.go.html#7953179">c</a></span><span class="op" id="7953282">.</span><span class="ident" id="7953283">db</span>&nbsp;<span class="op" id="7953286">=</span>&nbsp;<span class="ident" id="7953288">nil</span><br>
<span class="lineno"></span><span class="op" id="7953292">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="keyword" id="7953295">func</span>&nbsp;<span class="op" id="7953300">(</span><span class="ident" id="7953301">c</span>&nbsp;<span class="op" id="7953303">*</span><span class="ident" id="7953304"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7953325">)</span>&nbsp;<span class="ident" id="7953327">test</span><span class="op" id="7953331">(</span><span class="ident" id="7953332">t</span>&nbsp;<span class="ident" id="7953334"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953341">.</span><span class="ident" id="7953342">TB</span><span class="op" id="7953344">)</span>&nbsp;<span class="builtintype" id="7953346">error</span>&nbsp;<span class="op" id="7953352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953355">rows</span><span class="op" id="7953359">,</span>&nbsp;<span class="ident" id="7953361">err</span>&nbsp;<span class="op" id="7953365">:=</span>&nbsp;<span class="ident" id="7953368"><a href="/database/sql/sql_test.go.html#7953301">c</a></span><span class="op" id="7953369">.</span><span class="ident" id="7953370">db</span><span class="op" id="7953372">.</span><span class="ident" id="7953373">Query</span><span class="op" id="7953378">(</span><span class="string" id="7953379">&#34;SELECT|people|name|&#34;</span><span class="op" id="7953400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953403">if</span>&nbsp;<span class="ident" id="7953406"><a href="/database/sql/sql_test.go.html#7953361">err</a></span>&nbsp;<span class="op" id="7953410">!=</span>&nbsp;<span class="ident" id="7953413">nil</span>&nbsp;<span class="op" id="7953417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953421"><a href="/database/sql/sql_test.go.html#7953332">t</a></span><span class="op" id="7953422">.</span><span class="ident" id="7953423">Error</span><span class="op" id="7953428">(</span><span class="ident" id="7953429"><a href="/database/sql/sql_test.go.html#7953361">err</a></span><span class="op" id="7953432">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953436">return</span>&nbsp;<span class="ident" id="7953443"><a href="/database/sql/sql_test.go.html#7953361">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953451">var</span>&nbsp;<span class="ident" id="7953455">name</span>&nbsp;<span class="builtintype" id="7953460">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953468">for</span>&nbsp;<span class="ident" id="7953472"><a href="/database/sql/sql_test.go.html#7953355">rows</a></span><span class="op" id="7953476">.</span><span class="ident" id="7953477">Next</span><span class="op" id="7953481">(</span><span class="op" id="7953482">)</span>&nbsp;<span class="op" id="7953484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953488"><a href="/database/sql/sql_test.go.html#7953355">rows</a></span><span class="op" id="7953492">.</span><span class="ident" id="7953493">Scan</span><span class="op" id="7953497">(</span><span class="op" id="7953498">&amp;</span><span class="ident" id="7953499"><a href="/database/sql/sql_test.go.html#7953455">name</a></span><span class="op" id="7953503">)</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953509"><a href="/database/sql/sql_test.go.html#7953355">rows</a></span><span class="op" id="7953513">.</span><span class="ident" id="7953514">Close</span><span class="op" id="7953519">(</span><span class="op" id="7953520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953523">return</span>&nbsp;<span class="ident" id="7953530">nil</span><br>
<span class="lineno"></span><span class="op" id="7953534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1580</span><span class="keyword" id="7953537">type</span>&nbsp;<span class="ident" id="7953542">concurrentTxExecTest</span>&nbsp;<span class="keyword" id="7953563">struct</span>&nbsp;<span class="op" id="7953570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953573">db</span>&nbsp;<span class="op" id="7953576">*</span><span class="ident" id="7953577"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953581">tx</span>&nbsp;<span class="op" id="7953584">*</span><span class="ident" id="7953585"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno"></span><span class="op" id="7953588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1585</span><span class="keyword" id="7953591">func</span>&nbsp;<span class="op" id="7953596">(</span><span class="ident" id="7953597">c</span>&nbsp;<span class="op" id="7953599">*</span><span class="ident" id="7953600"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7953620">)</span>&nbsp;<span class="ident" id="7953622">init</span><span class="op" id="7953626">(</span><span class="ident" id="7953627">t</span>&nbsp;<span class="ident" id="7953629"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953636">.</span><span class="ident" id="7953637">TB</span><span class="op" id="7953639">,</span>&nbsp;<span class="ident" id="7953641">db</span>&nbsp;<span class="op" id="7953644">*</span><span class="ident" id="7953645"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7953647">)</span>&nbsp;<span class="op" id="7953649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953652"><a href="/database/sql/sql_test.go.html#7953597">c</a></span><span class="op" id="7953653">.</span><span class="ident" id="7953654">db</span>&nbsp;<span class="op" id="7953657">=</span>&nbsp;<span class="ident" id="7953659"><a href="/database/sql/sql_test.go.html#7953641">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953663">var</span>&nbsp;<span class="ident" id="7953667">err</span>&nbsp;<span class="builtintype" id="7953671">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953678"><a href="/database/sql/sql_test.go.html#7953597">c</a></span><span class="op" id="7953679">.</span><span class="ident" id="7953680">tx</span><span class="op" id="7953682">,</span>&nbsp;<span class="ident" id="7953684"><a href="/database/sql/sql_test.go.html#7953667">err</a></span>&nbsp;<span class="op" id="7953688">=</span>&nbsp;<span class="ident" id="7953690"><a href="/database/sql/sql_test.go.html#7953597">c</a></span><span class="op" id="7953691">.</span><span class="ident" id="7953692">db</span><span class="op" id="7953694">.</span><span class="ident" id="7953695">Begin</span><span class="op" id="7953700">(</span><span class="op" id="7953701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953704">if</span>&nbsp;<span class="ident" id="7953707"><a href="/database/sql/sql_test.go.html#7953667">err</a></span>&nbsp;<span class="op" id="7953711">!=</span>&nbsp;<span class="ident" id="7953714">nil</span>&nbsp;<span class="op" id="7953718">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953722"><a href="/database/sql/sql_test.go.html#7953627">t</a></span><span class="op" id="7953723">.</span><span class="ident" id="7953724">Fatal</span><span class="op" id="7953729">(</span><span class="ident" id="7953730"><a href="/database/sql/sql_test.go.html#7953667">err</a></span><span class="op" id="7953733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953736">}</span><br>
<span class="lineno"></span><span class="op" id="7953738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953741">func</span>&nbsp;<span class="op" id="7953746">(</span><span class="ident" id="7953747">c</span>&nbsp;<span class="op" id="7953749">*</span><span class="ident" id="7953750"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7953770">)</span>&nbsp;<span class="ident" id="7953772">finish</span><span class="op" id="7953778">(</span><span class="ident" id="7953779">t</span>&nbsp;<span class="ident" id="7953781"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953788">.</span><span class="ident" id="7953789">TB</span><span class="op" id="7953791">)</span>&nbsp;<span class="op" id="7953793">{</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7953796">if</span>&nbsp;<span class="ident" id="7953799"><a href="/database/sql/sql_test.go.html#7953747">c</a></span><span class="op" id="7953800">.</span><span class="ident" id="7953801">tx</span>&nbsp;<span class="op" id="7953804">!=</span>&nbsp;<span class="ident" id="7953807">nil</span>&nbsp;<span class="op" id="7953811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953815"><a href="/database/sql/sql_test.go.html#7953747">c</a></span><span class="op" id="7953816">.</span><span class="ident" id="7953817">tx</span><span class="op" id="7953819">.</span><span class="ident" id="7953820">Rollback</span><span class="op" id="7953828">(</span><span class="op" id="7953829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953833"><a href="/database/sql/sql_test.go.html#7953747">c</a></span><span class="op" id="7953834">.</span><span class="ident" id="7953835">tx</span>&nbsp;<span class="op" id="7953838">=</span>&nbsp;<span class="ident" id="7953840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7953845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953848"><a href="/database/sql/sql_test.go.html#7953747">c</a></span><span class="op" id="7953849">.</span><span class="ident" id="7953850">db</span>&nbsp;<span class="op" id="7953853">=</span>&nbsp;<span class="ident" id="7953855">nil</span><br>
<span class="lineno">1600</span><span class="op" id="7953859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7953862">func</span>&nbsp;<span class="op" id="7953867">(</span><span class="ident" id="7953868">c</span>&nbsp;<span class="op" id="7953870">*</span><span class="ident" id="7953871"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7953891">)</span>&nbsp;<span class="ident" id="7953893">test</span><span class="op" id="7953897">(</span><span class="ident" id="7953898">t</span>&nbsp;<span class="ident" id="7953900"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7953907">.</span><span class="ident" id="7953908">TB</span><span class="op" id="7953910">)</span>&nbsp;<span class="builtintype" id="7953912">error</span>&nbsp;<span class="op" id="7953918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7953921">_</span><span class="op" id="7953922">,</span>&nbsp;<span class="ident" id="7953924">err</span>&nbsp;<span class="op" id="7953928">:=</span>&nbsp;<span class="ident" id="7953931"><a href="/database/sql/sql_test.go.html#7953868">c</a></span><span class="op" id="7953932">.</span><span class="ident" id="7953933">tx</span><span class="op" id="7953935">.</span><span class="ident" id="7953936">Exec</span><span class="op" id="7953940">(</span><span class="string" id="7953941">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7953994">,</span>&nbsp;<span class="num" id="7953996">3</span><span class="op" id="7953997">,</span>&nbsp;<span class="ident" id="7953999"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7954012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954015">if</span>&nbsp;<span class="ident" id="7954018"><a href="/database/sql/sql_test.go.html#7953924">err</a></span>&nbsp;<span class="op" id="7954022">!=</span>&nbsp;<span class="ident" id="7954025">nil</span>&nbsp;<span class="op" id="7954029">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954033"><a href="/database/sql/sql_test.go.html#7953898">t</a></span><span class="op" id="7954034">.</span><span class="ident" id="7954035">Error</span><span class="op" id="7954040">(</span><span class="ident" id="7954041"><a href="/database/sql/sql_test.go.html#7953924">err</a></span><span class="op" id="7954044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954048">return</span>&nbsp;<span class="ident" id="7954055"><a href="/database/sql/sql_test.go.html#7953924">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954063">return</span>&nbsp;<span class="ident" id="7954070">nil</span><br>
<span class="lineno"></span><span class="op" id="7954074">}</span><br>
<span class="lineno">1610</span><br>
<span class="lineno"></span><span class="keyword" id="7954077">type</span>&nbsp;<span class="ident" id="7954082">concurrentTxStmtQueryTest</span>&nbsp;<span class="keyword" id="7954108">struct</span>&nbsp;<span class="op" id="7954115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954118">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7954123">*</span><span class="ident" id="7954124"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954128">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7954133">*</span><span class="ident" id="7954134"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954138">stmt</span>&nbsp;<span class="op" id="7954143">*</span><span class="ident" id="7954144"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno">1615</span><span class="op" id="7954149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954152">func</span>&nbsp;<span class="op" id="7954157">(</span><span class="ident" id="7954158">c</span>&nbsp;<span class="op" id="7954160">*</span><span class="ident" id="7954161"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7954186">)</span>&nbsp;<span class="ident" id="7954188">init</span><span class="op" id="7954192">(</span><span class="ident" id="7954193">t</span>&nbsp;<span class="ident" id="7954195"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7954202">.</span><span class="ident" id="7954203">TB</span><span class="op" id="7954205">,</span>&nbsp;<span class="ident" id="7954207">db</span>&nbsp;<span class="op" id="7954210">*</span><span class="ident" id="7954211"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7954213">)</span>&nbsp;<span class="op" id="7954215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954218"><a href="/database/sql/sql_test.go.html#7954158">c</a></span><span class="op" id="7954219">.</span><span class="ident" id="7954220">db</span>&nbsp;<span class="op" id="7954223">=</span>&nbsp;<span class="ident" id="7954225"><a href="/database/sql/sql_test.go.html#7954207">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954229">var</span>&nbsp;<span class="ident" id="7954233">err</span>&nbsp;<span class="builtintype" id="7954237">error</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954244"><a href="/database/sql/sql_test.go.html#7954158">c</a></span><span class="op" id="7954245">.</span><span class="ident" id="7954246">tx</span><span class="op" id="7954248">,</span>&nbsp;<span class="ident" id="7954250"><a href="/database/sql/sql_test.go.html#7954233">err</a></span>&nbsp;<span class="op" id="7954254">=</span>&nbsp;<span class="ident" id="7954256"><a href="/database/sql/sql_test.go.html#7954158">c</a></span><span class="op" id="7954257">.</span><span class="ident" id="7954258">db</span><span class="op" id="7954260">.</span><span class="ident" id="7954261">Begin</span><span class="op" id="7954266">(</span><span class="op" id="7954267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954270">if</span>&nbsp;<span class="ident" id="7954273"><a href="/database/sql/sql_test.go.html#7954233">err</a></span>&nbsp;<span class="op" id="7954277">!=</span>&nbsp;<span class="ident" id="7954280">nil</span>&nbsp;<span class="op" id="7954284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954288"><a href="/database/sql/sql_test.go.html#7954193">t</a></span><span class="op" id="7954289">.</span><span class="ident" id="7954290">Fatal</span><span class="op" id="7954295">(</span><span class="ident" id="7954296"><a href="/database/sql/sql_test.go.html#7954233">err</a></span><span class="op" id="7954299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954305"><a href="/database/sql/sql_test.go.html#7954158">c</a></span><span class="op" id="7954306">.</span><span class="ident" id="7954307">stmt</span><span class="op" id="7954311">,</span>&nbsp;<span class="ident" id="7954313"><a href="/database/sql/sql_test.go.html#7954233">err</a></span>&nbsp;<span class="op" id="7954317">=</span>&nbsp;<span class="ident" id="7954319"><a href="/database/sql/sql_test.go.html#7954158">c</a></span><span class="op" id="7954320">.</span><span class="ident" id="7954321">tx</span><span class="op" id="7954323">.</span><span class="ident" id="7954324">Prepare</span><span class="op" id="7954331">(</span><span class="string" id="7954332">&#34;SELECT|people|name|&#34;</span><span class="op" id="7954353">)</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954356">if</span>&nbsp;<span class="ident" id="7954359"><a href="/database/sql/sql_test.go.html#7954233">err</a></span>&nbsp;<span class="op" id="7954363">!=</span>&nbsp;<span class="ident" id="7954366">nil</span>&nbsp;<span class="op" id="7954370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954374"><a href="/database/sql/sql_test.go.html#7954193">t</a></span><span class="op" id="7954375">.</span><span class="ident" id="7954376">Fatal</span><span class="op" id="7954381">(</span><span class="ident" id="7954382"><a href="/database/sql/sql_test.go.html#7954233">err</a></span><span class="op" id="7954385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954388">}</span><br>
<span class="lineno"></span><span class="op" id="7954390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="keyword" id="7954393">func</span>&nbsp;<span class="op" id="7954398">(</span><span class="ident" id="7954399">c</span>&nbsp;<span class="op" id="7954401">*</span><span class="ident" id="7954402"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7954427">)</span>&nbsp;<span class="ident" id="7954429">finish</span><span class="op" id="7954435">(</span><span class="ident" id="7954436">t</span>&nbsp;<span class="ident" id="7954438"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7954445">.</span><span class="ident" id="7954446">TB</span><span class="op" id="7954448">)</span>&nbsp;<span class="op" id="7954450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954453">if</span>&nbsp;<span class="ident" id="7954456"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954457">.</span><span class="ident" id="7954458">stmt</span>&nbsp;<span class="op" id="7954463">!=</span>&nbsp;<span class="ident" id="7954466">nil</span>&nbsp;<span class="op" id="7954470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954474"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954475">.</span><span class="ident" id="7954476">stmt</span><span class="op" id="7954480">.</span><span class="ident" id="7954481">Close</span><span class="op" id="7954486">(</span><span class="op" id="7954487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954491"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954492">.</span><span class="ident" id="7954493">stmt</span>&nbsp;<span class="op" id="7954498">=</span>&nbsp;<span class="ident" id="7954500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954505">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954508">if</span>&nbsp;<span class="ident" id="7954511"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954512">.</span><span class="ident" id="7954513">tx</span>&nbsp;<span class="op" id="7954516">!=</span>&nbsp;<span class="ident" id="7954519">nil</span>&nbsp;<span class="op" id="7954523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954527"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954528">.</span><span class="ident" id="7954529">tx</span><span class="op" id="7954531">.</span><span class="ident" id="7954532">Rollback</span><span class="op" id="7954540">(</span><span class="op" id="7954541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954545"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954546">.</span><span class="ident" id="7954547">tx</span>&nbsp;<span class="op" id="7954550">=</span>&nbsp;<span class="ident" id="7954552">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954560"><a href="/database/sql/sql_test.go.html#7954399">c</a></span><span class="op" id="7954561">.</span><span class="ident" id="7954562">db</span>&nbsp;<span class="op" id="7954565">=</span>&nbsp;<span class="ident" id="7954567">nil</span><br>
<span class="lineno">1640</span><span class="op" id="7954571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954574">func</span>&nbsp;<span class="op" id="7954579">(</span><span class="ident" id="7954580">c</span>&nbsp;<span class="op" id="7954582">*</span><span class="ident" id="7954583"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7954608">)</span>&nbsp;<span class="ident" id="7954610">test</span><span class="op" id="7954614">(</span><span class="ident" id="7954615">t</span>&nbsp;<span class="ident" id="7954617"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7954624">.</span><span class="ident" id="7954625">TB</span><span class="op" id="7954627">)</span>&nbsp;<span class="builtintype" id="7954629">error</span>&nbsp;<span class="op" id="7954635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954638">rows</span><span class="op" id="7954642">,</span>&nbsp;<span class="ident" id="7954644">err</span>&nbsp;<span class="op" id="7954648">:=</span>&nbsp;<span class="ident" id="7954651"><a href="/database/sql/sql_test.go.html#7954580">c</a></span><span class="op" id="7954652">.</span><span class="ident" id="7954653">stmt</span><span class="op" id="7954657">.</span><span class="ident" id="7954658">Query</span><span class="op" id="7954663">(</span><span class="op" id="7954664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954667">if</span>&nbsp;<span class="ident" id="7954670"><a href="/database/sql/sql_test.go.html#7954644">err</a></span>&nbsp;<span class="op" id="7954674">!=</span>&nbsp;<span class="ident" id="7954677">nil</span>&nbsp;<span class="op" id="7954681">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954685"><a href="/database/sql/sql_test.go.html#7954615">t</a></span><span class="op" id="7954686">.</span><span class="ident" id="7954687">Errorf</span><span class="op" id="7954693">(</span><span class="string" id="7954694">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7954715">,</span>&nbsp;<span class="ident" id="7954717"><a href="/database/sql/sql_test.go.html#7954644">err</a></span><span class="op" id="7954720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954724">return</span>&nbsp;<span class="ident" id="7954731"><a href="/database/sql/sql_test.go.html#7954644">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954740">var</span>&nbsp;<span class="ident" id="7954744">name</span>&nbsp;<span class="builtintype" id="7954749">string</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954757">for</span>&nbsp;<span class="ident" id="7954761"><a href="/database/sql/sql_test.go.html#7954638">rows</a></span><span class="op" id="7954765">.</span><span class="ident" id="7954766">Next</span><span class="op" id="7954770">(</span><span class="op" id="7954771">)</span>&nbsp;<span class="op" id="7954773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954777"><a href="/database/sql/sql_test.go.html#7954638">rows</a></span><span class="op" id="7954781">.</span><span class="ident" id="7954782">Scan</span><span class="op" id="7954786">(</span><span class="op" id="7954787">&amp;</span><span class="ident" id="7954788"><a href="/database/sql/sql_test.go.html#7954744">name</a></span><span class="op" id="7954792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7954795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954798"><a href="/database/sql/sql_test.go.html#7954638">rows</a></span><span class="op" id="7954802">.</span><span class="ident" id="7954803">Close</span><span class="op" id="7954808">(</span><span class="op" id="7954809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954812">return</span>&nbsp;<span class="ident" id="7954819">nil</span><br>
<span class="lineno">1655</span><span class="op" id="7954823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954826">type</span>&nbsp;<span class="ident" id="7954831">concurrentTxStmtExecTest</span>&nbsp;<span class="keyword" id="7954856">struct</span>&nbsp;<span class="op" id="7954863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954866">db</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7954871">*</span><span class="ident" id="7954872"><a href="/database/sql/sql.go.html#5748306">DB</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954876">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7954881">*</span><span class="ident" id="7954882"><a href="/database/sql/sql.go.html#5770008">Tx</a></span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954886">stmt</span>&nbsp;<span class="op" id="7954891">*</span><span class="ident" id="7954892"><a href="/database/sql/sql.go.html#5775599">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="7954897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7954900">func</span>&nbsp;<span class="op" id="7954905">(</span><span class="ident" id="7954906">c</span>&nbsp;<span class="op" id="7954908">*</span><span class="ident" id="7954909"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7954933">)</span>&nbsp;<span class="ident" id="7954935">init</span><span class="op" id="7954939">(</span><span class="ident" id="7954940">t</span>&nbsp;<span class="ident" id="7954942"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7954949">.</span><span class="ident" id="7954950">TB</span><span class="op" id="7954952">,</span>&nbsp;<span class="ident" id="7954954">db</span>&nbsp;<span class="op" id="7954957">*</span><span class="ident" id="7954958"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7954960">)</span>&nbsp;<span class="op" id="7954962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954965"><a href="/database/sql/sql_test.go.html#7954906">c</a></span><span class="op" id="7954966">.</span><span class="ident" id="7954967">db</span>&nbsp;<span class="op" id="7954970">=</span>&nbsp;<span class="ident" id="7954972"><a href="/database/sql/sql_test.go.html#7954954">db</a></span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7954976">var</span>&nbsp;<span class="ident" id="7954980">err</span>&nbsp;<span class="builtintype" id="7954984">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7954991"><a href="/database/sql/sql_test.go.html#7954906">c</a></span><span class="op" id="7954992">.</span><span class="ident" id="7954993">tx</span><span class="op" id="7954995">,</span>&nbsp;<span class="ident" id="7954997"><a href="/database/sql/sql_test.go.html#7954980">err</a></span>&nbsp;<span class="op" id="7955001">=</span>&nbsp;<span class="ident" id="7955003"><a href="/database/sql/sql_test.go.html#7954906">c</a></span><span class="op" id="7955004">.</span><span class="ident" id="7955005">db</span><span class="op" id="7955007">.</span><span class="ident" id="7955008">Begin</span><span class="op" id="7955013">(</span><span class="op" id="7955014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955017">if</span>&nbsp;<span class="ident" id="7955020"><a href="/database/sql/sql_test.go.html#7954980">err</a></span>&nbsp;<span class="op" id="7955024">!=</span>&nbsp;<span class="ident" id="7955027">nil</span>&nbsp;<span class="op" id="7955031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955035"><a href="/database/sql/sql_test.go.html#7954940">t</a></span><span class="op" id="7955036">.</span><span class="ident" id="7955037">Fatal</span><span class="op" id="7955042">(</span><span class="ident" id="7955043"><a href="/database/sql/sql_test.go.html#7954980">err</a></span><span class="op" id="7955046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955049">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955052"><a href="/database/sql/sql_test.go.html#7954906">c</a></span><span class="op" id="7955053">.</span><span class="ident" id="7955054">stmt</span><span class="op" id="7955058">,</span>&nbsp;<span class="ident" id="7955060"><a href="/database/sql/sql_test.go.html#7954980">err</a></span>&nbsp;<span class="op" id="7955064">=</span>&nbsp;<span class="ident" id="7955066"><a href="/database/sql/sql_test.go.html#7954906">c</a></span><span class="op" id="7955067">.</span><span class="ident" id="7955068">tx</span><span class="op" id="7955070">.</span><span class="ident" id="7955071">Prepare</span><span class="op" id="7955078">(</span><span class="string" id="7955079">&#34;NOSERT|people|name=Chris,age=?,photo=CPHOTO,bdate=?&#34;</span><span class="op" id="7955132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955135">if</span>&nbsp;<span class="ident" id="7955138"><a href="/database/sql/sql_test.go.html#7954980">err</a></span>&nbsp;<span class="op" id="7955142">!=</span>&nbsp;<span class="ident" id="7955145">nil</span>&nbsp;<span class="op" id="7955149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955153"><a href="/database/sql/sql_test.go.html#7954940">t</a></span><span class="op" id="7955154">.</span><span class="ident" id="7955155">Fatal</span><span class="op" id="7955160">(</span><span class="ident" id="7955161"><a href="/database/sql/sql_test.go.html#7954980">err</a></span><span class="op" id="7955164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955167">}</span><br>
<span class="lineno"></span><span class="op" id="7955169">}</span><br>
<span class="lineno">1675</span><br>
<span class="lineno"></span><span class="keyword" id="7955172">func</span>&nbsp;<span class="op" id="7955177">(</span><span class="ident" id="7955178">c</span>&nbsp;<span class="op" id="7955180">*</span><span class="ident" id="7955181"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7955205">)</span>&nbsp;<span class="ident" id="7955207">finish</span><span class="op" id="7955213">(</span><span class="ident" id="7955214">t</span>&nbsp;<span class="ident" id="7955216"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7955223">.</span><span class="ident" id="7955224">TB</span><span class="op" id="7955226">)</span>&nbsp;<span class="op" id="7955228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955231">if</span>&nbsp;<span class="ident" id="7955234"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955235">.</span><span class="ident" id="7955236">stmt</span>&nbsp;<span class="op" id="7955241">!=</span>&nbsp;<span class="ident" id="7955244">nil</span>&nbsp;<span class="op" id="7955248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955252"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955253">.</span><span class="ident" id="7955254">stmt</span><span class="op" id="7955258">.</span><span class="ident" id="7955259">Close</span><span class="op" id="7955264">(</span><span class="op" id="7955265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955269"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955270">.</span><span class="ident" id="7955271">stmt</span>&nbsp;<span class="op" id="7955276">=</span>&nbsp;<span class="ident" id="7955278">nil</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955286">if</span>&nbsp;<span class="ident" id="7955289"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955290">.</span><span class="ident" id="7955291">tx</span>&nbsp;<span class="op" id="7955294">!=</span>&nbsp;<span class="ident" id="7955297">nil</span>&nbsp;<span class="op" id="7955301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955305"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955306">.</span><span class="ident" id="7955307">tx</span><span class="op" id="7955309">.</span><span class="ident" id="7955310">Rollback</span><span class="op" id="7955318">(</span><span class="op" id="7955319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955323"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955324">.</span><span class="ident" id="7955325">tx</span>&nbsp;<span class="op" id="7955328">=</span>&nbsp;<span class="ident" id="7955330">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955335">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955338"><a href="/database/sql/sql_test.go.html#7955178">c</a></span><span class="op" id="7955339">.</span><span class="ident" id="7955340">db</span>&nbsp;<span class="op" id="7955343">=</span>&nbsp;<span class="ident" id="7955345">nil</span><br>
<span class="lineno"></span><span class="op" id="7955349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955352">func</span>&nbsp;<span class="op" id="7955357">(</span><span class="ident" id="7955358">c</span>&nbsp;<span class="op" id="7955360">*</span><span class="ident" id="7955361"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7955385">)</span>&nbsp;<span class="ident" id="7955387">test</span><span class="op" id="7955391">(</span><span class="ident" id="7955392">t</span>&nbsp;<span class="ident" id="7955394"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7955401">.</span><span class="ident" id="7955402">TB</span><span class="op" id="7955404">)</span>&nbsp;<span class="builtintype" id="7955406">error</span>&nbsp;<span class="op" id="7955412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955415">_</span><span class="op" id="7955416">,</span>&nbsp;<span class="ident" id="7955418">err</span>&nbsp;<span class="op" id="7955422">:=</span>&nbsp;<span class="ident" id="7955425"><a href="/database/sql/sql_test.go.html#7955358">c</a></span><span class="op" id="7955426">.</span><span class="ident" id="7955427">stmt</span><span class="op" id="7955431">.</span><span class="ident" id="7955432">Exec</span><span class="op" id="7955436">(</span><span class="num" id="7955437">3</span><span class="op" id="7955438">,</span>&nbsp;<span class="ident" id="7955440"><a href="/database/sql/sql_test.go.html#7917370">chrisBirthday</a></span><span class="op" id="7955453">)</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955456">if</span>&nbsp;<span class="ident" id="7955459"><a href="/database/sql/sql_test.go.html#7955418">err</a></span>&nbsp;<span class="op" id="7955463">!=</span>&nbsp;<span class="ident" id="7955466">nil</span>&nbsp;<span class="op" id="7955470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955474"><a href="/database/sql/sql_test.go.html#7955392">t</a></span><span class="op" id="7955475">.</span><span class="ident" id="7955476">Errorf</span><span class="op" id="7955482">(</span><span class="string" id="7955483">&#34;error&nbsp;on&nbsp;exec:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7955503">,</span>&nbsp;<span class="ident" id="7955505"><a href="/database/sql/sql_test.go.html#7955418">err</a></span><span class="op" id="7955508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955512">return</span>&nbsp;<span class="ident" id="7955519"><a href="/database/sql/sql_test.go.html#7955418">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955527">return</span>&nbsp;<span class="ident" id="7955534">nil</span><br>
<span class="lineno">1695</span><span class="op" id="7955538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955541">type</span>&nbsp;<span class="ident" id="7955546">concurrentRandomTest</span>&nbsp;<span class="keyword" id="7955567">struct</span>&nbsp;<span class="op" id="7955574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955577">tests</span>&nbsp;<span class="op" id="7955583">[</span><span class="op" id="7955584">]</span><span class="ident" id="7955585"><a href="/database/sql/sql_test.go.html#7950825">concurrentTest</a></span><br>
<span class="lineno"></span><span class="op" id="7955600">}</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span><span class="keyword" id="7955603">func</span>&nbsp;<span class="op" id="7955608">(</span><span class="ident" id="7955609">c</span>&nbsp;<span class="op" id="7955611">*</span><span class="ident" id="7955612"><a href="/database/sql/sql_test.go.html#7955546">concurrentRandomTest</a></span><span class="op" id="7955632">)</span>&nbsp;<span class="ident" id="7955634">init</span><span class="op" id="7955638">(</span><span class="ident" id="7955639">t</span>&nbsp;<span class="ident" id="7955641"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7955648">.</span><span class="ident" id="7955649">TB</span><span class="op" id="7955651">,</span>&nbsp;<span class="ident" id="7955653">db</span>&nbsp;<span class="op" id="7955656">*</span><span class="ident" id="7955657"><a href="/database/sql/sql.go.html#5748306">DB</a></span><span class="op" id="7955659">)</span>&nbsp;<span class="op" id="7955661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955664"><a href="/database/sql/sql_test.go.html#7955609">c</a></span><span class="op" id="7955665">.</span><span class="ident" id="7955666">tests</span>&nbsp;<span class="op" id="7955672">=</span>&nbsp;<span class="op" id="7955674">[</span><span class="op" id="7955675">]</span><span class="ident" id="7955676"><a href="/database/sql/sql_test.go.html#7950825">concurrentTest</a></span><span class="op" id="7955690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955694">new</span><span class="op" id="7955697">(</span><span class="ident" id="7955698"><a href="/database/sql/sql_test.go.html#7950936">concurrentDBQueryTest</a></span><span class="op" id="7955719">)</span><span class="op" id="7955720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955724">new</span><span class="op" id="7955727">(</span><span class="ident" id="7955728"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7955748">)</span><span class="op" id="7955749">,</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955753">new</span><span class="op" id="7955756">(</span><span class="ident" id="7955757"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7955780">)</span><span class="op" id="7955781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955785">new</span><span class="op" id="7955788">(</span><span class="ident" id="7955789"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7955811">)</span><span class="op" id="7955812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955816">new</span><span class="op" id="7955819">(</span><span class="ident" id="7955820"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7955841">)</span><span class="op" id="7955842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955846">new</span><span class="op" id="7955849">(</span><span class="ident" id="7955850"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7955870">)</span><span class="op" id="7955871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955875">new</span><span class="op" id="7955878">(</span><span class="ident" id="7955879"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7955904">)</span><span class="op" id="7955905">,</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7955909">new</span><span class="op" id="7955912">(</span><span class="ident" id="7955913"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7955937">)</span><span class="op" id="7955938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7955944">for</span>&nbsp;<span class="ident" id="7955948">_</span><span class="op" id="7955949">,</span>&nbsp;<span class="ident" id="7955951">ct</span>&nbsp;<span class="op" id="7955954">:=</span>&nbsp;<span class="keyword" id="7955957">range</span>&nbsp;<span class="ident" id="7955963"><a href="/database/sql/sql_test.go.html#7955609">c</a></span><span class="op" id="7955964">.</span><span class="ident" id="7955965">tests</span>&nbsp;<span class="op" id="7955971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7955975"><a href="/database/sql/sql_test.go.html#7955951">ct</a></span><span class="op" id="7955977">.</span><span class="ident" id="7955978">init</span><span class="op" id="7955982">(</span><span class="ident" id="7955983"><a href="/database/sql/sql_test.go.html#7955639">t</a></span><span class="op" id="7955984">,</span>&nbsp;<span class="ident" id="7955986"><a href="/database/sql/sql_test.go.html#7955653">db</a></span><span class="op" id="7955988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7955991">}</span><br>
<span class="lineno">1715</span><span class="op" id="7955993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7955996">func</span>&nbsp;<span class="op" id="7956001">(</span><span class="ident" id="7956002">c</span>&nbsp;<span class="op" id="7956004">*</span><span class="ident" id="7956005"><a href="/database/sql/sql_test.go.html#7955546">concurrentRandomTest</a></span><span class="op" id="7956025">)</span>&nbsp;<span class="ident" id="7956027">finish</span><span class="op" id="7956033">(</span><span class="ident" id="7956034">t</span>&nbsp;<span class="ident" id="7956036"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956043">.</span><span class="ident" id="7956044">TB</span><span class="op" id="7956046">)</span>&nbsp;<span class="op" id="7956048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956051">for</span>&nbsp;<span class="ident" id="7956055">_</span><span class="op" id="7956056">,</span>&nbsp;<span class="ident" id="7956058">ct</span>&nbsp;<span class="op" id="7956061">:=</span>&nbsp;<span class="keyword" id="7956064">range</span>&nbsp;<span class="ident" id="7956070"><a href="/database/sql/sql_test.go.html#7956002">c</a></span><span class="op" id="7956071">.</span><span class="ident" id="7956072">tests</span>&nbsp;<span class="op" id="7956078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956082"><a href="/database/sql/sql_test.go.html#7956058">ct</a></span><span class="op" id="7956084">.</span><span class="ident" id="7956085">finish</span><span class="op" id="7956091">(</span><span class="ident" id="7956092"><a href="/database/sql/sql_test.go.html#7956034">t</a></span><span class="op" id="7956093">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956096">}</span><br>
<span class="lineno"></span><span class="op" id="7956098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956101">func</span>&nbsp;<span class="op" id="7956106">(</span><span class="ident" id="7956107">c</span>&nbsp;<span class="op" id="7956109">*</span><span class="ident" id="7956110"><a href="/database/sql/sql_test.go.html#7955546">concurrentRandomTest</a></span><span class="op" id="7956130">)</span>&nbsp;<span class="ident" id="7956132">test</span><span class="op" id="7956136">(</span><span class="ident" id="7956137">t</span>&nbsp;<span class="ident" id="7956139"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956146">.</span><span class="ident" id="7956147">TB</span><span class="op" id="7956149">)</span>&nbsp;<span class="builtintype" id="7956151">error</span>&nbsp;<span class="op" id="7956157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956160">ct</span>&nbsp;<span class="op" id="7956163">:=</span>&nbsp;<span class="ident" id="7956166"><a href="/database/sql/sql_test.go.html#7956107">c</a></span><span class="op" id="7956167">.</span><span class="ident" id="7956168">tests</span><span class="op" id="7956173">[</span><span class="ident" id="7956174"><a href="/database/sql/sql_test.go.html#7916646">rand</a></span><span class="op" id="7956178">.</span><span class="ident" id="7956179">Intn</span><span class="op" id="7956183">(</span><span class="builtinfunc" id="7956184">len</span><span class="op" id="7956187">(</span><span class="ident" id="7956188"><a href="/database/sql/sql_test.go.html#7956107">c</a></span><span class="op" id="7956189">.</span><span class="ident" id="7956190">tests</span><span class="op" id="7956195">)</span><span class="op" id="7956196">)</span><span class="op" id="7956197">]</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956200">return</span>&nbsp;<span class="ident" id="7956207"><a href="/database/sql/sql_test.go.html#7956160">ct</a></span><span class="op" id="7956209">.</span><span class="ident" id="7956210">test</span><span class="op" id="7956214">(</span><span class="ident" id="7956215"><a href="/database/sql/sql_test.go.html#7956137">t</a></span><span class="op" id="7956216">)</span><br>
<span class="lineno"></span><span class="op" id="7956218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956221">func</span>&nbsp;<span class="ident" id="7956226">doConcurrentTest</span><span class="op" id="7956242">(</span><span class="ident" id="7956243">t</span>&nbsp;<span class="ident" id="7956245"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956252">.</span><span class="ident" id="7956253">TB</span><span class="op" id="7956255">,</span>&nbsp;<span class="ident" id="7956257">ct</span>&nbsp;<span class="ident" id="7956260"><a href="/database/sql/sql_test.go.html#7950825">concurrentTest</a></span><span class="op" id="7956274">)</span>&nbsp;<span class="op" id="7956276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956279">maxProcs</span><span class="op" id="7956287">,</span>&nbsp;<span class="ident" id="7956289">numReqs</span>&nbsp;<span class="op" id="7956297">:=</span>&nbsp;<span class="num" id="7956300">1</span><span class="op" id="7956301">,</span>&nbsp;<span class="num" id="7956303">500</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956308">if</span>&nbsp;<span class="ident" id="7956311"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956318">.</span><span class="ident" id="7956319">Short</span><span class="op" id="7956324">(</span><span class="op" id="7956325">)</span>&nbsp;<span class="op" id="7956327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956331"><a href="/database/sql/sql_test.go.html#7956279">maxProcs</a></span><span class="op" id="7956339">,</span>&nbsp;<span class="ident" id="7956341"><a href="/database/sql/sql_test.go.html#7956289">numReqs</a></span>&nbsp;<span class="op" id="7956349">=</span>&nbsp;<span class="num" id="7956351">4</span><span class="op" id="7956352">,</span>&nbsp;<span class="num" id="7956354">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956361">defer</span>&nbsp;<span class="ident" id="7956367"><a href="/database/sql/sql_test.go.html#7916670">runtime</a></span><span class="op" id="7956374">.</span><span class="ident" id="7956375">GOMAXPROCS</span><span class="op" id="7956385">(</span><span class="ident" id="7956386"><a href="/database/sql/sql_test.go.html#7916670">runtime</a></span><span class="op" id="7956393">.</span><span class="ident" id="7956394">GOMAXPROCS</span><span class="op" id="7956404">(</span><span class="ident" id="7956405"><a href="/database/sql/sql_test.go.html#7956279">maxProcs</a></span><span class="op" id="7956413">)</span><span class="op" id="7956414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956418">db</span>&nbsp;<span class="op" id="7956421">:=</span>&nbsp;<span class="ident" id="7956424"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7956433">(</span><span class="ident" id="7956434"><a href="/database/sql/sql_test.go.html#7956243">t</a></span><span class="op" id="7956435">,</span>&nbsp;<span class="string" id="7956437">&#34;people&#34;</span><span class="op" id="7956445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956448">defer</span>&nbsp;<span class="ident" id="7956454"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7956461">(</span><span class="ident" id="7956462"><a href="/database/sql/sql_test.go.html#7956243">t</a></span><span class="op" id="7956463">,</span>&nbsp;<span class="ident" id="7956465"><a href="/database/sql/sql_test.go.html#7956418">db</a></span><span class="op" id="7956467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956471"><a href="/database/sql/sql_test.go.html#7956257">ct</a></span><span class="op" id="7956473">.</span><span class="ident" id="7956474">init</span><span class="op" id="7956478">(</span><span class="ident" id="7956479"><a href="/database/sql/sql_test.go.html#7956243">t</a></span><span class="op" id="7956480">,</span>&nbsp;<span class="ident" id="7956482"><a href="/database/sql/sql_test.go.html#7956418">db</a></span><span class="op" id="7956484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956487">defer</span>&nbsp;<span class="ident" id="7956493"><a href="/database/sql/sql_test.go.html#7956257">ct</a></span><span class="op" id="7956495">.</span><span class="ident" id="7956496">finish</span><span class="op" id="7956502">(</span><span class="ident" id="7956503"><a href="/database/sql/sql_test.go.html#7956243">t</a></span><span class="op" id="7956504">)</span><br>
<span class="lineno">1740</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956508">var</span>&nbsp;<span class="ident" id="7956512">wg</span>&nbsp;<span class="ident" id="7956515"><a href="/database/sql/sql_test.go.html#7916692">sync</a></span><span class="op" id="7956519">.</span><span class="ident" id="7956520">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956531"><a href="/database/sql/sql_test.go.html#7956512">wg</a></span><span class="op" id="7956533">.</span><span class="ident" id="7956534">Add</span><span class="op" id="7956537">(</span><span class="ident" id="7956538"><a href="/database/sql/sql_test.go.html#7956289">numReqs</a></span><span class="op" id="7956545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956549">reqs</span>&nbsp;<span class="op" id="7956554">:=</span>&nbsp;<span class="builtinfunc" id="7956557">make</span><span class="op" id="7956561">(</span><span class="keyword" id="7956562">chan</span>&nbsp;<span class="builtintype" id="7956567">bool</span><span class="op" id="7956571">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956574">defer</span>&nbsp;<span class="builtinfunc" id="7956580">close</span><span class="op" id="7956585">(</span><span class="ident" id="7956586"><a href="/database/sql/sql_test.go.html#7956549">reqs</a></span><span class="op" id="7956590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956594">for</span>&nbsp;<span class="ident" id="7956598">i</span>&nbsp;<span class="op" id="7956600">:=</span>&nbsp;<span class="num" id="7956603">0</span><span class="op" id="7956604">;</span>&nbsp;<span class="ident" id="7956606"><a href="/database/sql/sql_test.go.html#7956598">i</a></span>&nbsp;<span class="op" id="7956608">&lt;</span>&nbsp;<span class="ident" id="7956610"><a href="/database/sql/sql_test.go.html#7956279">maxProcs</a></span><span class="op" id="7956618">*</span><span class="num" id="7956619">2</span><span class="op" id="7956620">;</span>&nbsp;<span class="ident" id="7956622"><a href="/database/sql/sql_test.go.html#7956598">i</a></span><span class="op" id="7956623">++</span>&nbsp;<span class="op" id="7956626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956630">go</span>&nbsp;<span class="keyword" id="7956633">func</span><span class="op" id="7956637">(</span><span class="op" id="7956638">)</span>&nbsp;<span class="op" id="7956640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956645">for</span>&nbsp;<span class="keyword" id="7956649">range</span>&nbsp;<span class="ident" id="7956655"><a href="/database/sql/sql_test.go.html#7956549">reqs</a></span>&nbsp;<span class="op" id="7956660">{</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956666">err</span>&nbsp;<span class="op" id="7956670">:=</span>&nbsp;<span class="ident" id="7956673"><a href="/database/sql/sql_test.go.html#7956257">ct</a></span><span class="op" id="7956675">.</span><span class="ident" id="7956676">test</span><span class="op" id="7956680">(</span><span class="ident" id="7956681"><a href="/database/sql/sql_test.go.html#7956243">t</a></span><span class="op" id="7956682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956688">if</span>&nbsp;<span class="ident" id="7956691"><a href="/database/sql/sql_test.go.html#7956666">err</a></span>&nbsp;<span class="op" id="7956695">!=</span>&nbsp;<span class="ident" id="7956698">nil</span>&nbsp;<span class="op" id="7956702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956709"><a href="/database/sql/sql_test.go.html#7956512">wg</a></span><span class="op" id="7956711">.</span><span class="ident" id="7956712">Done</span><span class="op" id="7956716">(</span><span class="op" id="7956717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956724">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956737">}</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956743"><a href="/database/sql/sql_test.go.html#7956512">wg</a></span><span class="op" id="7956745">.</span><span class="ident" id="7956746">Done</span><span class="op" id="7956750">(</span><span class="op" id="7956751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956760">}</span><span class="op" id="7956761">(</span><span class="op" id="7956762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956769">for</span>&nbsp;<span class="ident" id="7956773">i</span>&nbsp;<span class="op" id="7956775">:=</span>&nbsp;<span class="num" id="7956778">0</span><span class="op" id="7956779">;</span>&nbsp;<span class="ident" id="7956781"><a href="/database/sql/sql_test.go.html#7956773">i</a></span>&nbsp;<span class="op" id="7956783">&lt;</span>&nbsp;<span class="ident" id="7956785"><a href="/database/sql/sql_test.go.html#7956289">numReqs</a></span><span class="op" id="7956792">;</span>&nbsp;<span class="ident" id="7956794"><a href="/database/sql/sql_test.go.html#7956773">i</a></span><span class="op" id="7956795">++</span>&nbsp;<span class="op" id="7956798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956802"><a href="/database/sql/sql_test.go.html#7956549">reqs</a></span>&nbsp;<span class="op" id="7956807">&lt;-</span>&nbsp;<span class="ident" id="7956810">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956820"><a href="/database/sql/sql_test.go.html#7956512">wg</a></span><span class="op" id="7956822">.</span><span class="ident" id="7956823">Wait</span><span class="op" id="7956827">(</span><span class="op" id="7956828">)</span><br>
<span class="lineno">1765</span><span class="op" id="7956830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7956833">func</span>&nbsp;<span class="ident" id="7956838">manyConcurrentQueries</span><span class="op" id="7956859">(</span><span class="ident" id="7956860">t</span>&nbsp;<span class="ident" id="7956862"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956869">.</span><span class="ident" id="7956870">TB</span><span class="op" id="7956872">)</span>&nbsp;<span class="op" id="7956874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956877">maxProcs</span><span class="op" id="7956885">,</span>&nbsp;<span class="ident" id="7956887">numReqs</span>&nbsp;<span class="op" id="7956895">:=</span>&nbsp;<span class="num" id="7956898">16</span><span class="op" id="7956900">,</span>&nbsp;<span class="num" id="7956902">500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956907">if</span>&nbsp;<span class="ident" id="7956910"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7956917">.</span><span class="ident" id="7956918">Short</span><span class="op" id="7956923">(</span><span class="op" id="7956924">)</span>&nbsp;<span class="op" id="7956926">{</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7956930"><a href="/database/sql/sql_test.go.html#7956877">maxProcs</a></span><span class="op" id="7956938">,</span>&nbsp;<span class="ident" id="7956940"><a href="/database/sql/sql_test.go.html#7956887">numReqs</a></span>&nbsp;<span class="op" id="7956948">=</span>&nbsp;<span class="num" id="7956950">4</span><span class="op" id="7956951">,</span>&nbsp;<span class="num" id="7956953">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7956957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7956960">defer</span>&nbsp;<span class="ident" id="7956966"><a href="/database/sql/sql_test.go.html#7916670">runtime</a></span><span class="op" id="7956973">.</span><span class="ident" id="7956974">GOMAXPROCS</span><span class="op" id="7956984">(</span><span class="ident" id="7956985"><a href="/database/sql/sql_test.go.html#7916670">runtime</a></span><span class="op" id="7956992">.</span><span class="ident" id="7956993">GOMAXPROCS</span><span class="op" id="7957003">(</span><span class="ident" id="7957004"><a href="/database/sql/sql_test.go.html#7956877">maxProcs</a></span><span class="op" id="7957012">)</span><span class="op" id="7957013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957017">db</span>&nbsp;<span class="op" id="7957020">:=</span>&nbsp;<span class="ident" id="7957023"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7957032">(</span><span class="ident" id="7957033"><a href="/database/sql/sql_test.go.html#7956860">t</a></span><span class="op" id="7957034">,</span>&nbsp;<span class="string" id="7957036">&#34;people&#34;</span><span class="op" id="7957044">)</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957047">defer</span>&nbsp;<span class="ident" id="7957053"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7957060">(</span><span class="ident" id="7957061"><a href="/database/sql/sql_test.go.html#7956860">t</a></span><span class="op" id="7957062">,</span>&nbsp;<span class="ident" id="7957064"><a href="/database/sql/sql_test.go.html#7957017">db</a></span><span class="op" id="7957066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957070">stmt</span><span class="op" id="7957074">,</span>&nbsp;<span class="ident" id="7957076">err</span>&nbsp;<span class="op" id="7957080">:=</span>&nbsp;<span class="ident" id="7957083"><a href="/database/sql/sql_test.go.html#7957017">db</a></span><span class="op" id="7957085">.</span><span class="ident" id="7957086">Prepare</span><span class="op" id="7957093">(</span><span class="string" id="7957094">&#34;SELECT|people|name|&#34;</span><span class="op" id="7957115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957118">if</span>&nbsp;<span class="ident" id="7957121"><a href="/database/sql/sql_test.go.html#7957076">err</a></span>&nbsp;<span class="op" id="7957125">!=</span>&nbsp;<span class="ident" id="7957128">nil</span>&nbsp;<span class="op" id="7957132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957136"><a href="/database/sql/sql_test.go.html#7956860">t</a></span><span class="op" id="7957137">.</span><span class="ident" id="7957138">Fatal</span><span class="op" id="7957143">(</span><span class="ident" id="7957144"><a href="/database/sql/sql_test.go.html#7957076">err</a></span><span class="op" id="7957147">)</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957153">defer</span>&nbsp;<span class="ident" id="7957159"><a href="/database/sql/sql_test.go.html#7957070">stmt</a></span><span class="op" id="7957163">.</span><span class="ident" id="7957164">Close</span><span class="op" id="7957169">(</span><span class="op" id="7957170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957174">var</span>&nbsp;<span class="ident" id="7957178">wg</span>&nbsp;<span class="ident" id="7957181"><a href="/database/sql/sql_test.go.html#7916692">sync</a></span><span class="op" id="7957185">.</span><span class="ident" id="7957186">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957197"><a href="/database/sql/sql_test.go.html#7957178">wg</a></span><span class="op" id="7957199">.</span><span class="ident" id="7957200">Add</span><span class="op" id="7957203">(</span><span class="ident" id="7957204"><a href="/database/sql/sql_test.go.html#7956887">numReqs</a></span><span class="op" id="7957211">)</span><br>
<span class="lineno">1785</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957215">reqs</span>&nbsp;<span class="op" id="7957220">:=</span>&nbsp;<span class="builtinfunc" id="7957223">make</span><span class="op" id="7957227">(</span><span class="keyword" id="7957228">chan</span>&nbsp;<span class="builtintype" id="7957233">bool</span><span class="op" id="7957237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957240">defer</span>&nbsp;<span class="builtinfunc" id="7957246">close</span><span class="op" id="7957251">(</span><span class="ident" id="7957252"><a href="/database/sql/sql_test.go.html#7957215">reqs</a></span><span class="op" id="7957256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957260">for</span>&nbsp;<span class="ident" id="7957264">i</span>&nbsp;<span class="op" id="7957266">:=</span>&nbsp;<span class="num" id="7957269">0</span><span class="op" id="7957270">;</span>&nbsp;<span class="ident" id="7957272"><a href="/database/sql/sql_test.go.html#7957264">i</a></span>&nbsp;<span class="op" id="7957274">&lt;</span>&nbsp;<span class="ident" id="7957276"><a href="/database/sql/sql_test.go.html#7956877">maxProcs</a></span><span class="op" id="7957284">*</span><span class="num" id="7957285">2</span><span class="op" id="7957286">;</span>&nbsp;<span class="ident" id="7957288"><a href="/database/sql/sql_test.go.html#7957264">i</a></span><span class="op" id="7957289">++</span>&nbsp;<span class="op" id="7957292">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957296">go</span>&nbsp;<span class="keyword" id="7957299">func</span><span class="op" id="7957303">(</span><span class="op" id="7957304">)</span>&nbsp;<span class="op" id="7957306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957311">for</span>&nbsp;<span class="keyword" id="7957315">range</span>&nbsp;<span class="ident" id="7957321"><a href="/database/sql/sql_test.go.html#7957215">reqs</a></span>&nbsp;<span class="op" id="7957326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957332">rows</span><span class="op" id="7957336">,</span>&nbsp;<span class="ident" id="7957338">err</span>&nbsp;<span class="op" id="7957342">:=</span>&nbsp;<span class="ident" id="7957345"><a href="/database/sql/sql_test.go.html#7957070">stmt</a></span><span class="op" id="7957349">.</span><span class="ident" id="7957350">Query</span><span class="op" id="7957355">(</span><span class="op" id="7957356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957362">if</span>&nbsp;<span class="ident" id="7957365"><a href="/database/sql/sql_test.go.html#7957338">err</a></span>&nbsp;<span class="op" id="7957369">!=</span>&nbsp;<span class="ident" id="7957372">nil</span>&nbsp;<span class="op" id="7957376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957383"><a href="/database/sql/sql_test.go.html#7956860">t</a></span><span class="op" id="7957384">.</span><span class="ident" id="7957385">Errorf</span><span class="op" id="7957391">(</span><span class="string" id="7957392">&#34;error&nbsp;on&nbsp;query:&nbsp;&nbsp;%v&#34;</span><span class="op" id="7957413">,</span>&nbsp;<span class="ident" id="7957415"><a href="/database/sql/sql_test.go.html#7957338">err</a></span><span class="op" id="7957418">)</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957425"><a href="/database/sql/sql_test.go.html#7957178">wg</a></span><span class="op" id="7957427">.</span><span class="ident" id="7957428">Done</span><span class="op" id="7957432">(</span><span class="op" id="7957433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957440">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957460">var</span>&nbsp;<span class="ident" id="7957464">name</span>&nbsp;<span class="builtintype" id="7957469">string</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957480">for</span>&nbsp;<span class="ident" id="7957484"><a href="/database/sql/sql_test.go.html#7957332">rows</a></span><span class="op" id="7957488">.</span><span class="ident" id="7957489">Next</span><span class="op" id="7957493">(</span><span class="op" id="7957494">)</span>&nbsp;<span class="op" id="7957496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957503"><a href="/database/sql/sql_test.go.html#7957332">rows</a></span><span class="op" id="7957507">.</span><span class="ident" id="7957508">Scan</span><span class="op" id="7957512">(</span><span class="op" id="7957513">&amp;</span><span class="ident" id="7957514"><a href="/database/sql/sql_test.go.html#7957464">name</a></span><span class="op" id="7957518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957530"><a href="/database/sql/sql_test.go.html#7957332">rows</a></span><span class="op" id="7957534">.</span><span class="ident" id="7957535">Close</span><span class="op" id="7957540">(</span><span class="op" id="7957541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957548"><a href="/database/sql/sql_test.go.html#7957178">wg</a></span><span class="op" id="7957550">.</span><span class="ident" id="7957551">Done</span><span class="op" id="7957555">(</span><span class="op" id="7957556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957565">}</span><span class="op" id="7957566">(</span><span class="op" id="7957567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957574">for</span>&nbsp;<span class="ident" id="7957578">i</span>&nbsp;<span class="op" id="7957580">:=</span>&nbsp;<span class="num" id="7957583">0</span><span class="op" id="7957584">;</span>&nbsp;<span class="ident" id="7957586"><a href="/database/sql/sql_test.go.html#7957578">i</a></span>&nbsp;<span class="op" id="7957588">&lt;</span>&nbsp;<span class="ident" id="7957590"><a href="/database/sql/sql_test.go.html#7956887">numReqs</a></span><span class="op" id="7957597">;</span>&nbsp;<span class="ident" id="7957599"><a href="/database/sql/sql_test.go.html#7957578">i</a></span><span class="op" id="7957600">++</span>&nbsp;<span class="op" id="7957603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957607"><a href="/database/sql/sql_test.go.html#7957215">reqs</a></span>&nbsp;<span class="op" id="7957612">&lt;-</span>&nbsp;<span class="ident" id="7957615">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957625"><a href="/database/sql/sql_test.go.html#7957178">wg</a></span><span class="op" id="7957627">.</span><span class="ident" id="7957628">Wait</span><span class="op" id="7957632">(</span><span class="op" id="7957633">)</span><br>
<span class="lineno">1815</span><span class="op" id="7957635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7957638">func</span>&nbsp;<span class="ident" id="7957643">TestIssue6081</span><span class="op" id="7957656">(</span><span class="ident" id="7957657">t</span>&nbsp;<span class="op" id="7957659">*</span><span class="ident" id="7957660"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7957667">.</span><span class="ident" id="7957668">T</span><span class="op" id="7957669">)</span>&nbsp;<span class="op" id="7957671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957674">db</span>&nbsp;<span class="op" id="7957677">:=</span>&nbsp;<span class="ident" id="7957680"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7957689">(</span><span class="ident" id="7957690"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7957691">,</span>&nbsp;<span class="string" id="7957693">&#34;people&#34;</span><span class="op" id="7957701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957704">defer</span>&nbsp;<span class="ident" id="7957710"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7957717">(</span><span class="ident" id="7957718"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7957719">,</span>&nbsp;<span class="ident" id="7957721"><a href="/database/sql/sql_test.go.html#7957674">db</a></span><span class="op" id="7957723">)</span><br>
<span class="lineno">1820</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957727">drv</span>&nbsp;<span class="op" id="7957731">:=</span>&nbsp;<span class="ident" id="7957734"><a href="/database/sql/sql_test.go.html#7957674">db</a></span><span class="op" id="7957736">.</span><span class="ident" id="7957737">driver</span><span class="op" id="7957743">.</span><span class="op" id="7957744">(</span><span class="op" id="7957745">*</span><span class="ident" id="7957746"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7957756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957759"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7957762">.</span><span class="ident" id="7957763">mu</span><span class="op" id="7957765">.</span><span class="ident" id="7957766">Lock</span><span class="op" id="7957770">(</span><span class="op" id="7957771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957774">opens0</span>&nbsp;<span class="op" id="7957781">:=</span>&nbsp;<span class="ident" id="7957784"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7957787">.</span><span class="ident" id="7957788">openCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957799">closes0</span>&nbsp;<span class="op" id="7957807">:=</span>&nbsp;<span class="ident" id="7957810"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7957813">.</span><span class="ident" id="7957814">closeCount</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957826"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7957829">.</span><span class="ident" id="7957830">mu</span><span class="op" id="7957832">.</span><span class="ident" id="7957833">Unlock</span><span class="op" id="7957839">(</span><span class="op" id="7957840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957844">stmt</span><span class="op" id="7957848">,</span>&nbsp;<span class="ident" id="7957850">err</span>&nbsp;<span class="op" id="7957854">:=</span>&nbsp;<span class="ident" id="7957857"><a href="/database/sql/sql_test.go.html#7957674">db</a></span><span class="op" id="7957859">.</span><span class="ident" id="7957860">Prepare</span><span class="op" id="7957867">(</span><span class="string" id="7957868">&#34;SELECT|people|name|&#34;</span><span class="op" id="7957889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7957892">if</span>&nbsp;<span class="ident" id="7957895"><a href="/database/sql/sql_test.go.html#7957850">err</a></span>&nbsp;<span class="op" id="7957899">!=</span>&nbsp;<span class="ident" id="7957902">nil</span>&nbsp;<span class="op" id="7957906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957910"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7957911">.</span><span class="ident" id="7957912">Fatal</span><span class="op" id="7957917">(</span><span class="ident" id="7957918"><a href="/database/sql/sql_test.go.html#7957850">err</a></span><span class="op" id="7957921">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7957927"><a href="/database/sql/sql.go.html#5785316">rowsCloseHook</a></span>&nbsp;<span class="op" id="7957941">=</span>&nbsp;<span class="keyword" id="7957943">func</span><span class="op" id="7957947">(</span><span class="ident" id="7957948">rows</span>&nbsp;<span class="op" id="7957953">*</span><span class="ident" id="7957954"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="7957958">,</span>&nbsp;<span class="ident" id="7957960">err</span>&nbsp;<span class="op" id="7957964">*</span><span class="builtintype" id="7957965">error</span><span class="op" id="7957970">)</span>&nbsp;<span class="op" id="7957972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7957976">*</span><span class="ident" id="7957977"><a href="/database/sql/sql_test.go.html#7957960">err</a></span>&nbsp;<span class="op" id="7957981">=</span>&nbsp;<span class="ident" id="7957983"><a href="/database/sql/sql_test.go.html#7916606">driver</a></span><span class="op" id="7957989">.</span><span class="ident" id="7957990">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958005">defer</span>&nbsp;<span class="keyword" id="7958011">func</span><span class="op" id="7958015">(</span><span class="op" id="7958016">)</span>&nbsp;<span class="op" id="7958018">{</span>&nbsp;<span class="ident" id="7958020"><a href="/database/sql/sql.go.html#5785316">rowsCloseHook</a></span>&nbsp;<span class="op" id="7958034">=</span>&nbsp;<span class="ident" id="7958036">nil</span>&nbsp;<span class="op" id="7958040">}</span><span class="op" id="7958041">(</span><span class="op" id="7958042">)</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958045">for</span>&nbsp;<span class="ident" id="7958049">i</span>&nbsp;<span class="op" id="7958051">:=</span>&nbsp;<span class="num" id="7958054">0</span><span class="op" id="7958055">;</span>&nbsp;<span class="ident" id="7958057"><a href="/database/sql/sql_test.go.html#7958049">i</a></span>&nbsp;<span class="op" id="7958059">&lt;</span>&nbsp;<span class="num" id="7958061">10</span><span class="op" id="7958063">;</span>&nbsp;<span class="ident" id="7958065"><a href="/database/sql/sql_test.go.html#7958049">i</a></span><span class="op" id="7958066">++</span>&nbsp;<span class="op" id="7958069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958073">rows</span><span class="op" id="7958077">,</span>&nbsp;<span class="ident" id="7958079">err</span>&nbsp;<span class="op" id="7958083">:=</span>&nbsp;<span class="ident" id="7958086"><a href="/database/sql/sql_test.go.html#7957844">stmt</a></span><span class="op" id="7958090">.</span><span class="ident" id="7958091">Query</span><span class="op" id="7958096">(</span><span class="op" id="7958097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958101">if</span>&nbsp;<span class="ident" id="7958104"><a href="/database/sql/sql_test.go.html#7958079">err</a></span>&nbsp;<span class="op" id="7958108">!=</span>&nbsp;<span class="ident" id="7958111">nil</span>&nbsp;<span class="op" id="7958115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958120"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7958121">.</span><span class="ident" id="7958122">Fatal</span><span class="op" id="7958127">(</span><span class="ident" id="7958128"><a href="/database/sql/sql_test.go.html#7958079">err</a></span><span class="op" id="7958131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958135">}</span><br>
<span class="lineno">1840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958139"><a href="/database/sql/sql_test.go.html#7958073">rows</a></span><span class="op" id="7958143">.</span><span class="ident" id="7958144">Close</span><span class="op" id="7958149">(</span><span class="op" id="7958150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958156">if</span>&nbsp;<span class="ident" id="7958159">n</span>&nbsp;<span class="op" id="7958161">:=</span>&nbsp;<span class="builtinfunc" id="7958164">len</span><span class="op" id="7958167">(</span><span class="ident" id="7958168"><a href="/database/sql/sql_test.go.html#7957844">stmt</a></span><span class="op" id="7958172">.</span><span class="ident" id="7958173">css</span><span class="op" id="7958176">)</span><span class="op" id="7958177">;</span>&nbsp;<span class="ident" id="7958179"><a href="/database/sql/sql_test.go.html#7958159">n</a></span>&nbsp;<span class="op" id="7958181">&gt;</span>&nbsp;<span class="num" id="7958183">1</span>&nbsp;<span class="op" id="7958185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958189"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7958190">.</span><span class="ident" id="7958191">Errorf</span><span class="op" id="7958197">(</span><span class="string" id="7958198">&#34;len(css&nbsp;slice)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&lt;=&nbsp;1&#34;</span><span class="op" id="7958230">,</span>&nbsp;<span class="ident" id="7958232"><a href="/database/sql/sql_test.go.html#7958159">n</a></span><span class="op" id="7958233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958236">}</span><br>
<span class="lineno">1845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958239"><a href="/database/sql/sql_test.go.html#7957844">stmt</a></span><span class="op" id="7958243">.</span><span class="ident" id="7958244">Close</span><span class="op" id="7958249">(</span><span class="op" id="7958250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958253">if</span>&nbsp;<span class="ident" id="7958256">n</span>&nbsp;<span class="op" id="7958258">:=</span>&nbsp;<span class="builtinfunc" id="7958261">len</span><span class="op" id="7958264">(</span><span class="ident" id="7958265"><a href="/database/sql/sql_test.go.html#7957844">stmt</a></span><span class="op" id="7958269">.</span><span class="ident" id="7958270">css</span><span class="op" id="7958273">)</span><span class="op" id="7958274">;</span>&nbsp;<span class="ident" id="7958276"><a href="/database/sql/sql_test.go.html#7958256">n</a></span>&nbsp;<span class="op" id="7958278">!=</span>&nbsp;<span class="num" id="7958281">0</span>&nbsp;<span class="op" id="7958283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958287"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7958288">.</span><span class="ident" id="7958289">Errorf</span><span class="op" id="7958295">(</span><span class="string" id="7958296">&#34;len(css&nbsp;slice)&nbsp;after&nbsp;Close&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7958337">,</span>&nbsp;<span class="ident" id="7958339"><a href="/database/sql/sql_test.go.html#7958256">n</a></span><span class="op" id="7958340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958347"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7958350">.</span><span class="ident" id="7958351">mu</span><span class="op" id="7958353">.</span><span class="ident" id="7958354">Lock</span><span class="op" id="7958358">(</span><span class="op" id="7958359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958362">opens</span>&nbsp;<span class="op" id="7958368">:=</span>&nbsp;<span class="ident" id="7958371"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7958374">.</span><span class="ident" id="7958375">openCount</span>&nbsp;<span class="op" id="7958385">-</span>&nbsp;<span class="ident" id="7958387"><a href="/database/sql/sql_test.go.html#7957774">opens0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958395">closes</span>&nbsp;<span class="op" id="7958402">:=</span>&nbsp;<span class="ident" id="7958405"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7958408">.</span><span class="ident" id="7958409">closeCount</span>&nbsp;<span class="op" id="7958420">-</span>&nbsp;<span class="ident" id="7958422"><a href="/database/sql/sql_test.go.html#7957799">closes0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958431"><a href="/database/sql/sql_test.go.html#7957727">drv</a></span><span class="op" id="7958434">.</span><span class="ident" id="7958435">mu</span><span class="op" id="7958437">.</span><span class="ident" id="7958438">Unlock</span><span class="op" id="7958444">(</span><span class="op" id="7958445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958448">if</span>&nbsp;<span class="ident" id="7958451"><a href="/database/sql/sql_test.go.html#7958362">opens</a></span>&nbsp;<span class="op" id="7958457">&lt;</span>&nbsp;<span class="num" id="7958459">9</span>&nbsp;<span class="op" id="7958461">{</span><br>
<span class="lineno">1855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958465"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7958466">.</span><span class="ident" id="7958467">Errorf</span><span class="op" id="7958473">(</span><span class="string" id="7958474">&#34;opens&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7958497">,</span>&nbsp;<span class="ident" id="7958499"><a href="/database/sql/sql_test.go.html#7958362">opens</a></span><span class="op" id="7958504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7958510">if</span>&nbsp;<span class="ident" id="7958513"><a href="/database/sql/sql_test.go.html#7958395">closes</a></span>&nbsp;<span class="op" id="7958520">&lt;</span>&nbsp;<span class="num" id="7958522">9</span>&nbsp;<span class="op" id="7958524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958528"><a href="/database/sql/sql_test.go.html#7957657">t</a></span><span class="op" id="7958529">.</span><span class="ident" id="7958530">Errorf</span><span class="op" id="7958536">(</span><span class="string" id="7958537">&#34;closes&nbsp;=&nbsp;%d;&nbsp;want&nbsp;&gt;=&nbsp;9&#34;</span><span class="op" id="7958561">,</span>&nbsp;<span class="ident" id="7958563"><a href="/database/sql/sql_test.go.html#7958395">closes</a></span><span class="op" id="7958569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7958572">}</span><br>
<span class="lineno">1860</span><span class="op" id="7958574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7958577">func</span>&nbsp;<span class="ident" id="7958582">TestConcurrency</span><span class="op" id="7958597">(</span><span class="ident" id="7958598">t</span>&nbsp;<span class="op" id="7958600">*</span><span class="ident" id="7958601"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7958608">.</span><span class="ident" id="7958609">T</span><span class="op" id="7958610">)</span>&nbsp;<span class="op" id="7958612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958615"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958631">(</span><span class="ident" id="7958632"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958633">,</span>&nbsp;<span class="builtinfunc" id="7958635">new</span><span class="op" id="7958638">(</span><span class="ident" id="7958639"><a href="/database/sql/sql_test.go.html#7950936">concurrentDBQueryTest</a></span><span class="op" id="7958660">)</span><span class="op" id="7958661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958664"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958680">(</span><span class="ident" id="7958681"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958682">,</span>&nbsp;<span class="builtinfunc" id="7958684">new</span><span class="op" id="7958687">(</span><span class="ident" id="7958688"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7958708">)</span><span class="op" id="7958709">)</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958712"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958728">(</span><span class="ident" id="7958729"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958730">,</span>&nbsp;<span class="builtinfunc" id="7958732">new</span><span class="op" id="7958735">(</span><span class="ident" id="7958736"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7958759">)</span><span class="op" id="7958760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958763"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958779">(</span><span class="ident" id="7958780"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958781">,</span>&nbsp;<span class="builtinfunc" id="7958783">new</span><span class="op" id="7958786">(</span><span class="ident" id="7958787"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7958809">)</span><span class="op" id="7958810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958813"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958829">(</span><span class="ident" id="7958830"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958831">,</span>&nbsp;<span class="builtinfunc" id="7958833">new</span><span class="op" id="7958836">(</span><span class="ident" id="7958837"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7958858">)</span><span class="op" id="7958859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958862"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958878">(</span><span class="ident" id="7958879"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958880">,</span>&nbsp;<span class="builtinfunc" id="7958882">new</span><span class="op" id="7958885">(</span><span class="ident" id="7958886"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7958906">)</span><span class="op" id="7958907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958910"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958926">(</span><span class="ident" id="7958927"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958928">,</span>&nbsp;<span class="builtinfunc" id="7958930">new</span><span class="op" id="7958933">(</span><span class="ident" id="7958934"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7958959">)</span><span class="op" id="7958960">)</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7958963"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7958979">(</span><span class="ident" id="7958980"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7958981">,</span>&nbsp;<span class="builtinfunc" id="7958983">new</span><span class="op" id="7958986">(</span><span class="ident" id="7958987"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7959011">)</span><span class="op" id="7959012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959015"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7959031">(</span><span class="ident" id="7959032"><a href="/database/sql/sql_test.go.html#7958598">t</a></span><span class="op" id="7959033">,</span>&nbsp;<span class="builtinfunc" id="7959035">new</span><span class="op" id="7959038">(</span><span class="ident" id="7959039"><a href="/database/sql/sql_test.go.html#7955546">concurrentRandomTest</a></span><span class="op" id="7959059">)</span><span class="op" id="7959060">)</span><br>
<span class="lineno"></span><span class="op" id="7959062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7959065">func</span>&nbsp;<span class="ident" id="7959070">TestConnectionLeak</span><span class="op" id="7959088">(</span><span class="ident" id="7959089">t</span>&nbsp;<span class="op" id="7959091">*</span><span class="ident" id="7959092"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7959099">.</span><span class="ident" id="7959100">T</span><span class="op" id="7959101">)</span>&nbsp;<span class="op" id="7959103">{</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959106">db</span>&nbsp;<span class="op" id="7959109">:=</span>&nbsp;<span class="ident" id="7959112"><a href="/database/sql/sql_test.go.html#7917416">newTestDB</a></span><span class="op" id="7959121">(</span><span class="ident" id="7959122"><a href="/database/sql/sql_test.go.html#7959089">t</a></span><span class="op" id="7959123">,</span>&nbsp;<span class="string" id="7959125">&#34;people&#34;</span><span class="op" id="7959133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959136">defer</span>&nbsp;<span class="ident" id="7959142"><a href="/database/sql/sql_test.go.html#7918340">closeDB</a></span><span class="op" id="7959149">(</span><span class="ident" id="7959150"><a href="/database/sql/sql_test.go.html#7959089">t</a></span><span class="op" id="7959151">,</span>&nbsp;<span class="ident" id="7959153"><a href="/database/sql/sql_test.go.html#7959106">db</a></span><span class="op" id="7959155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959158">//&nbsp;Start&nbsp;by&nbsp;opening&nbsp;defaultMaxIdleConns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959199">rows</span>&nbsp;<span class="op" id="7959204">:=</span>&nbsp;<span class="builtinfunc" id="7959207">make</span><span class="op" id="7959211">(</span><span class="op" id="7959212">[</span><span class="op" id="7959213">]</span><span class="op" id="7959214">*</span><span class="ident" id="7959215"><a href="/database/sql/sql.go.html#5782647">Rows</a></span><span class="op" id="7959219">,</span>&nbsp;<span class="ident" id="7959221"><a href="/database/sql/sql.go.html#5756451">defaultMaxIdleConns</a></span><span class="op" id="7959240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959243">//&nbsp;We&nbsp;need&nbsp;to&nbsp;SetMaxOpenConns&nbsp;&gt;&nbsp;MaxIdleConns,&nbsp;so&nbsp;the&nbsp;DB&nbsp;can&nbsp;open</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959309">//&nbsp;a&nbsp;new&nbsp;connection&nbsp;and&nbsp;we&nbsp;can&nbsp;fill&nbsp;the&nbsp;idle&nbsp;queue&nbsp;with&nbsp;the&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959379">//&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959396"><a href="/database/sql/sql_test.go.html#7959106">db</a></span><span class="op" id="7959398">.</span><span class="ident" id="7959399">SetMaxOpenConns</span><span class="op" id="7959414">(</span><span class="builtinfunc" id="7959415">len</span><span class="op" id="7959418">(</span><span class="ident" id="7959419"><a href="/database/sql/sql_test.go.html#7959199">rows</a></span><span class="op" id="7959423">)</span>&nbsp;<span class="op" id="7959425">+</span>&nbsp;<span class="num" id="7959427">1</span><span class="op" id="7959428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959431">for</span>&nbsp;<span class="ident" id="7959435">ii</span>&nbsp;<span class="op" id="7959438">:=</span>&nbsp;<span class="keyword" id="7959441">range</span>&nbsp;<span class="ident" id="7959447"><a href="/database/sql/sql_test.go.html#7959199">rows</a></span>&nbsp;<span class="op" id="7959452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959456">r</span><span class="op" id="7959457">,</span>&nbsp;<span class="ident" id="7959459">err</span>&nbsp;<span class="op" id="7959463">:=</span>&nbsp;<span class="ident" id="7959466"><a href="/database/sql/sql_test.go.html#7959106">db</a></span><span class="op" id="7959468">.</span><span class="ident" id="7959469">Query</span><span class="op" id="7959474">(</span><span class="string" id="7959475">&#34;SELECT|people|name|&#34;</span><span class="op" id="7959496">)</span><br>
<span class="lineno">1885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959500">if</span>&nbsp;<span class="ident" id="7959503"><a href="/database/sql/sql_test.go.html#7959459">err</a></span>&nbsp;<span class="op" id="7959507">!=</span>&nbsp;<span class="ident" id="7959510">nil</span>&nbsp;<span class="op" id="7959514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959519"><a href="/database/sql/sql_test.go.html#7959089">t</a></span><span class="op" id="7959520">.</span><span class="ident" id="7959521">Fatal</span><span class="op" id="7959526">(</span><span class="ident" id="7959527"><a href="/database/sql/sql_test.go.html#7959459">err</a></span><span class="op" id="7959530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959538"><a href="/database/sql/sql_test.go.html#7959456">r</a></span><span class="op" id="7959539">.</span><span class="ident" id="7959540">Next</span><span class="op" id="7959544">(</span><span class="op" id="7959545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959549">if</span>&nbsp;<span class="ident" id="7959552">err</span>&nbsp;<span class="op" id="7959556">:=</span>&nbsp;<span class="ident" id="7959559"><a href="/database/sql/sql_test.go.html#7959456">r</a></span><span class="op" id="7959560">.</span><span class="ident" id="7959561">Err</span><span class="op" id="7959564">(</span><span class="op" id="7959565">)</span><span class="op" id="7959566">;</span>&nbsp;<span class="ident" id="7959568"><a href="/database/sql/sql_test.go.html#7959552">err</a></span>&nbsp;<span class="op" id="7959572">!=</span>&nbsp;<span class="ident" id="7959575">nil</span>&nbsp;<span class="op" id="7959579">{</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959584"><a href="/database/sql/sql_test.go.html#7959089">t</a></span><span class="op" id="7959585">.</span><span class="ident" id="7959586">Fatal</span><span class="op" id="7959591">(</span><span class="ident" id="7959592"><a href="/database/sql/sql_test.go.html#7959552">err</a></span><span class="op" id="7959595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959603"><a href="/database/sql/sql_test.go.html#7959199">rows</a></span><span class="op" id="7959607">[</span><span class="ident" id="7959608"><a href="/database/sql/sql_test.go.html#7959435">ii</a></span><span class="op" id="7959610">]</span>&nbsp;<span class="op" id="7959612">=</span>&nbsp;<span class="ident" id="7959614"><a href="/database/sql/sql_test.go.html#7959456">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7959617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959620">//&nbsp;Now&nbsp;we&nbsp;have&nbsp;defaultMaxIdleConns&nbsp;busy&nbsp;connections.&nbsp;Open</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959679">//&nbsp;a&nbsp;new&nbsp;one,&nbsp;but&nbsp;wait&nbsp;until&nbsp;the&nbsp;busy&nbsp;connections&nbsp;are&nbsp;released</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7959743">//&nbsp;before&nbsp;returning&nbsp;control&nbsp;to&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959779">drv</span>&nbsp;<span class="op" id="7959783">:=</span>&nbsp;<span class="ident" id="7959786"><a href="/database/sql/sql_test.go.html#7959106">db</a></span><span class="op" id="7959788">.</span><span class="ident" id="7959789">driver</span><span class="op" id="7959795">.</span><span class="op" id="7959796">(</span><span class="op" id="7959797">*</span><span class="ident" id="7959798"><a href="/database/sql/fakedb_test.go.html#7896947">fakeDriver</a></span><span class="op" id="7959808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959811"><a href="/database/sql/sql_test.go.html#7959779">drv</a></span><span class="op" id="7959814">.</span><span class="ident" id="7959815">waitCh</span>&nbsp;<span class="op" id="7959822">=</span>&nbsp;<span class="builtinfunc" id="7959824">make</span><span class="op" id="7959828">(</span><span class="keyword" id="7959829">chan</span>&nbsp;<span class="keyword" id="7959834">struct</span><span class="op" id="7959840">{</span><span class="op" id="7959841">}</span><span class="op" id="7959842">,</span>&nbsp;<span class="num" id="7959844">1</span><span class="op" id="7959845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959848"><a href="/database/sql/sql_test.go.html#7959779">drv</a></span><span class="op" id="7959851">.</span><span class="ident" id="7959852">waitingCh</span>&nbsp;<span class="op" id="7959862">=</span>&nbsp;<span class="builtinfunc" id="7959864">make</span><span class="op" id="7959868">(</span><span class="keyword" id="7959869">chan</span>&nbsp;<span class="keyword" id="7959874">struct</span><span class="op" id="7959880">{</span><span class="op" id="7959881">}</span><span class="op" id="7959882">,</span>&nbsp;<span class="num" id="7959884">1</span><span class="op" id="7959885">)</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959888">var</span>&nbsp;<span class="ident" id="7959892">wg</span>&nbsp;<span class="ident" id="7959895"><a href="/database/sql/sql_test.go.html#7916692">sync</a></span><span class="op" id="7959899">.</span><span class="ident" id="7959900">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959911"><a href="/database/sql/sql_test.go.html#7959892">wg</a></span><span class="op" id="7959913">.</span><span class="ident" id="7959914">Add</span><span class="op" id="7959917">(</span><span class="num" id="7959918">1</span><span class="op" id="7959919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959922">go</span>&nbsp;<span class="keyword" id="7959925">func</span><span class="op" id="7959929">(</span><span class="op" id="7959930">)</span>&nbsp;<span class="op" id="7959932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959936">r</span><span class="op" id="7959937">,</span>&nbsp;<span class="ident" id="7959939">err</span>&nbsp;<span class="op" id="7959943">:=</span>&nbsp;<span class="ident" id="7959946"><a href="/database/sql/sql_test.go.html#7959106">db</a></span><span class="op" id="7959948">.</span><span class="ident" id="7959949">Query</span><span class="op" id="7959954">(</span><span class="string" id="7959955">&#34;SELECT|people|name|&#34;</span><span class="op" id="7959976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7959980">if</span>&nbsp;<span class="ident" id="7959983"><a href="/database/sql/sql_test.go.html#7959939">err</a></span>&nbsp;<span class="op" id="7959987">!=</span>&nbsp;<span class="ident" id="7959990">nil</span>&nbsp;<span class="op" id="7959994">{</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7959999"><a href="/database/sql/sql_test.go.html#7959089">t</a></span><span class="op" id="7960000">.</span><span class="ident" id="7960001">Fatal</span><span class="op" id="7960006">(</span><span class="ident" id="7960007"><a href="/database/sql/sql_test.go.html#7959939">err</a></span><span class="op" id="7960010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960018"><a href="/database/sql/sql_test.go.html#7959936">r</a></span><span class="op" id="7960019">.</span><span class="ident" id="7960020">Close</span><span class="op" id="7960025">(</span><span class="op" id="7960026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960030"><a href="/database/sql/sql_test.go.html#7959892">wg</a></span><span class="op" id="7960032">.</span><span class="ident" id="7960033">Done</span><span class="op" id="7960037">(</span><span class="op" id="7960038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960041">}</span><span class="op" id="7960042">(</span><span class="op" id="7960043">)</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960046">//&nbsp;Wait&nbsp;until&nbsp;the&nbsp;goroutine&nbsp;we&#39;ve&nbsp;just&nbsp;created&nbsp;has&nbsp;started&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960115">&lt;-</span><span class="ident" id="7960117"><a href="/database/sql/sql_test.go.html#7959779">drv</a></span><span class="op" id="7960120">.</span><span class="ident" id="7960121">waitingCh</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960132">//&nbsp;Now&nbsp;close&nbsp;the&nbsp;busy&nbsp;connections.&nbsp;This&nbsp;provides&nbsp;a&nbsp;connection&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960199">//&nbsp;the&nbsp;blocked&nbsp;goroutine&nbsp;and&nbsp;then&nbsp;fills&nbsp;up&nbsp;the&nbsp;idle&nbsp;queue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960259">for</span>&nbsp;<span class="ident" id="7960263">_</span><span class="op" id="7960264">,</span>&nbsp;<span class="ident" id="7960266">v</span>&nbsp;<span class="op" id="7960268">:=</span>&nbsp;<span class="keyword" id="7960271">range</span>&nbsp;<span class="ident" id="7960277"><a href="/database/sql/sql_test.go.html#7959199">rows</a></span>&nbsp;<span class="op" id="7960282">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960286"><a href="/database/sql/sql_test.go.html#7960266">v</a></span><span class="op" id="7960287">.</span><span class="ident" id="7960288">Close</span><span class="op" id="7960293">(</span><span class="op" id="7960294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960300">//&nbsp;At&nbsp;this&nbsp;point&nbsp;we&nbsp;give&nbsp;the&nbsp;new&nbsp;connection&nbsp;to&nbsp;DB.&nbsp;This&nbsp;connection&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960371">//&nbsp;now&nbsp;useless,&nbsp;since&nbsp;the&nbsp;idle&nbsp;queue&nbsp;is&nbsp;full&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960442">//&nbsp;requests.&nbsp;DB&nbsp;should&nbsp;deal&nbsp;with&nbsp;this&nbsp;situation&nbsp;without&nbsp;leaking&nbsp;the</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7960511">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960527"><a href="/database/sql/sql_test.go.html#7959779">drv</a></span><span class="op" id="7960530">.</span><span class="ident" id="7960531">waitCh</span>&nbsp;<span class="op" id="7960538">&lt;-</span>&nbsp;<span class="keyword" id="7960541">struct</span><span class="op" id="7960547">{</span><span class="op" id="7960548">}</span><span class="op" id="7960549">{</span><span class="op" id="7960550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960553"><a href="/database/sql/sql_test.go.html#7959892">wg</a></span><span class="op" id="7960555">.</span><span class="ident" id="7960556">Wait</span><span class="op" id="7960560">(</span><span class="op" id="7960561">)</span><br>
<span class="lineno"></span><span class="op" id="7960563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1925</span><span class="keyword" id="7960566">func</span>&nbsp;<span class="ident" id="7960571">BenchmarkConcurrentDBExec</span><span class="op" id="7960596">(</span><span class="ident" id="7960597">b</span>&nbsp;<span class="op" id="7960599">*</span><span class="ident" id="7960600"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7960607">.</span><span class="ident" id="7960608">B</span><span class="op" id="7960609">)</span>&nbsp;<span class="op" id="7960611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960614"><a href="/database/sql/sql_test.go.html#7960597">b</a></span><span class="op" id="7960615">.</span><span class="ident" id="7960616">ReportAllocs</span><span class="op" id="7960628">(</span><span class="op" id="7960629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960632">ct</span>&nbsp;<span class="op" id="7960635">:=</span>&nbsp;<span class="builtinfunc" id="7960638">new</span><span class="op" id="7960641">(</span><span class="ident" id="7960642"><a href="/database/sql/sql_test.go.html#7951370">concurrentDBExecTest</a></span><span class="op" id="7960662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960665">for</span>&nbsp;<span class="ident" id="7960669">i</span>&nbsp;<span class="op" id="7960671">:=</span>&nbsp;<span class="num" id="7960674">0</span><span class="op" id="7960675">;</span>&nbsp;<span class="ident" id="7960677"><a href="/database/sql/sql_test.go.html#7960669">i</a></span>&nbsp;<span class="op" id="7960679">&lt;</span>&nbsp;<span class="ident" id="7960681"><a href="/database/sql/sql_test.go.html#7960597">b</a></span><span class="op" id="7960682">.</span><span class="ident" id="7960683">N</span><span class="op" id="7960684">;</span>&nbsp;<span class="ident" id="7960686"><a href="/database/sql/sql_test.go.html#7960669">i</a></span><span class="op" id="7960687">++</span>&nbsp;<span class="op" id="7960690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960694"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7960710">(</span><span class="ident" id="7960711"><a href="/database/sql/sql_test.go.html#7960597">b</a></span><span class="op" id="7960712">,</span>&nbsp;<span class="ident" id="7960714"><a href="/database/sql/sql_test.go.html#7960632">ct</a></span><span class="op" id="7960716">)</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960719">}</span><br>
<span class="lineno"></span><span class="op" id="7960721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7960724">func</span>&nbsp;<span class="ident" id="7960729">BenchmarkConcurrentStmtQuery</span><span class="op" id="7960757">(</span><span class="ident" id="7960758">b</span>&nbsp;<span class="op" id="7960760">*</span><span class="ident" id="7960761"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7960768">.</span><span class="ident" id="7960769">B</span><span class="op" id="7960770">)</span>&nbsp;<span class="op" id="7960772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960775"><a href="/database/sql/sql_test.go.html#7960758">b</a></span><span class="op" id="7960776">.</span><span class="ident" id="7960777">ReportAllocs</span><span class="op" id="7960789">(</span><span class="op" id="7960790">)</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960793">ct</span>&nbsp;<span class="op" id="7960796">:=</span>&nbsp;<span class="builtinfunc" id="7960799">new</span><span class="op" id="7960802">(</span><span class="ident" id="7960803"><a href="/database/sql/sql_test.go.html#7951774">concurrentStmtQueryTest</a></span><span class="op" id="7960826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960829">for</span>&nbsp;<span class="ident" id="7960833">i</span>&nbsp;<span class="op" id="7960835">:=</span>&nbsp;<span class="num" id="7960838">0</span><span class="op" id="7960839">;</span>&nbsp;<span class="ident" id="7960841"><a href="/database/sql/sql_test.go.html#7960833">i</a></span>&nbsp;<span class="op" id="7960843">&lt;</span>&nbsp;<span class="ident" id="7960845"><a href="/database/sql/sql_test.go.html#7960758">b</a></span><span class="op" id="7960846">.</span><span class="ident" id="7960847">N</span><span class="op" id="7960848">;</span>&nbsp;<span class="ident" id="7960850"><a href="/database/sql/sql_test.go.html#7960833">i</a></span><span class="op" id="7960851">++</span>&nbsp;<span class="op" id="7960854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960858"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7960874">(</span><span class="ident" id="7960875"><a href="/database/sql/sql_test.go.html#7960758">b</a></span><span class="op" id="7960876">,</span>&nbsp;<span class="ident" id="7960878"><a href="/database/sql/sql_test.go.html#7960793">ct</a></span><span class="op" id="7960880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7960883">}</span><br>
<span class="lineno"></span><span class="op" id="7960885">}</span><br>
<span class="lineno">1940</span><br>
<span class="lineno"></span><span class="keyword" id="7960888">func</span>&nbsp;<span class="ident" id="7960893">BenchmarkConcurrentStmtExec</span><span class="op" id="7960920">(</span><span class="ident" id="7960921">b</span>&nbsp;<span class="op" id="7960923">*</span><span class="ident" id="7960924"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7960931">.</span><span class="ident" id="7960932">B</span><span class="op" id="7960933">)</span>&nbsp;<span class="op" id="7960935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960938"><a href="/database/sql/sql_test.go.html#7960921">b</a></span><span class="op" id="7960939">.</span><span class="ident" id="7960940">ReportAllocs</span><span class="op" id="7960952">(</span><span class="op" id="7960953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7960956">ct</span>&nbsp;<span class="op" id="7960959">:=</span>&nbsp;<span class="builtinfunc" id="7960962">new</span><span class="op" id="7960965">(</span><span class="ident" id="7960966"><a href="/database/sql/sql_test.go.html#7952390">concurrentStmtExecTest</a></span><span class="op" id="7960988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7960991">for</span>&nbsp;<span class="ident" id="7960995">i</span>&nbsp;<span class="op" id="7960997">:=</span>&nbsp;<span class="num" id="7961000">0</span><span class="op" id="7961001">;</span>&nbsp;<span class="ident" id="7961003"><a href="/database/sql/sql_test.go.html#7960995">i</a></span>&nbsp;<span class="op" id="7961005">&lt;</span>&nbsp;<span class="ident" id="7961007"><a href="/database/sql/sql_test.go.html#7960921">b</a></span><span class="op" id="7961008">.</span><span class="ident" id="7961009">N</span><span class="op" id="7961010">;</span>&nbsp;<span class="ident" id="7961012"><a href="/database/sql/sql_test.go.html#7960995">i</a></span><span class="op" id="7961013">++</span>&nbsp;<span class="op" id="7961016">{</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961020"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961036">(</span><span class="ident" id="7961037"><a href="/database/sql/sql_test.go.html#7960921">b</a></span><span class="op" id="7961038">,</span>&nbsp;<span class="ident" id="7961040"><a href="/database/sql/sql_test.go.html#7960956">ct</a></span><span class="op" id="7961042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961045">}</span><br>
<span class="lineno"></span><span class="op" id="7961047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7961050">func</span>&nbsp;<span class="ident" id="7961055">BenchmarkConcurrentTxQuery</span><span class="op" id="7961081">(</span><span class="ident" id="7961082">b</span>&nbsp;<span class="op" id="7961084">*</span><span class="ident" id="7961085"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7961092">.</span><span class="ident" id="7961093">B</span><span class="op" id="7961094">)</span>&nbsp;<span class="op" id="7961096">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961099"><a href="/database/sql/sql_test.go.html#7961082">b</a></span><span class="op" id="7961100">.</span><span class="ident" id="7961101">ReportAllocs</span><span class="op" id="7961113">(</span><span class="op" id="7961114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961117">ct</span>&nbsp;<span class="op" id="7961120">:=</span>&nbsp;<span class="builtinfunc" id="7961123">new</span><span class="op" id="7961126">(</span><span class="ident" id="7961127"><a href="/database/sql/sql_test.go.html#7952972">concurrentTxQueryTest</a></span><span class="op" id="7961148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7961151">for</span>&nbsp;<span class="ident" id="7961155">i</span>&nbsp;<span class="op" id="7961157">:=</span>&nbsp;<span class="num" id="7961160">0</span><span class="op" id="7961161">;</span>&nbsp;<span class="ident" id="7961163"><a href="/database/sql/sql_test.go.html#7961155">i</a></span>&nbsp;<span class="op" id="7961165">&lt;</span>&nbsp;<span class="ident" id="7961167"><a href="/database/sql/sql_test.go.html#7961082">b</a></span><span class="op" id="7961168">.</span><span class="ident" id="7961169">N</span><span class="op" id="7961170">;</span>&nbsp;<span class="ident" id="7961172"><a href="/database/sql/sql_test.go.html#7961155">i</a></span><span class="op" id="7961173">++</span>&nbsp;<span class="op" id="7961176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961180"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961196">(</span><span class="ident" id="7961197"><a href="/database/sql/sql_test.go.html#7961082">b</a></span><span class="op" id="7961198">,</span>&nbsp;<span class="ident" id="7961200"><a href="/database/sql/sql_test.go.html#7961117">ct</a></span><span class="op" id="7961202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961205">}</span><br>
<span class="lineno">1955</span><span class="op" id="7961207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7961210">func</span>&nbsp;<span class="ident" id="7961215">BenchmarkConcurrentTxExec</span><span class="op" id="7961240">(</span><span class="ident" id="7961241">b</span>&nbsp;<span class="op" id="7961243">*</span><span class="ident" id="7961244"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7961251">.</span><span class="ident" id="7961252">B</span><span class="op" id="7961253">)</span>&nbsp;<span class="op" id="7961255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961258"><a href="/database/sql/sql_test.go.html#7961241">b</a></span><span class="op" id="7961259">.</span><span class="ident" id="7961260">ReportAllocs</span><span class="op" id="7961272">(</span><span class="op" id="7961273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961276">ct</span>&nbsp;<span class="op" id="7961279">:=</span>&nbsp;<span class="builtinfunc" id="7961282">new</span><span class="op" id="7961285">(</span><span class="ident" id="7961286"><a href="/database/sql/sql_test.go.html#7953542">concurrentTxExecTest</a></span><span class="op" id="7961306">)</span><br>
<span class="lineno">1960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7961309">for</span>&nbsp;<span class="ident" id="7961313">i</span>&nbsp;<span class="op" id="7961315">:=</span>&nbsp;<span class="num" id="7961318">0</span><span class="op" id="7961319">;</span>&nbsp;<span class="ident" id="7961321"><a href="/database/sql/sql_test.go.html#7961313">i</a></span>&nbsp;<span class="op" id="7961323">&lt;</span>&nbsp;<span class="ident" id="7961325"><a href="/database/sql/sql_test.go.html#7961241">b</a></span><span class="op" id="7961326">.</span><span class="ident" id="7961327">N</span><span class="op" id="7961328">;</span>&nbsp;<span class="ident" id="7961330"><a href="/database/sql/sql_test.go.html#7961313">i</a></span><span class="op" id="7961331">++</span>&nbsp;<span class="op" id="7961334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961338"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961354">(</span><span class="ident" id="7961355"><a href="/database/sql/sql_test.go.html#7961241">b</a></span><span class="op" id="7961356">,</span>&nbsp;<span class="ident" id="7961358"><a href="/database/sql/sql_test.go.html#7961276">ct</a></span><span class="op" id="7961360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961363">}</span><br>
<span class="lineno"></span><span class="op" id="7961365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1965</span><span class="keyword" id="7961368">func</span>&nbsp;<span class="ident" id="7961373">BenchmarkConcurrentTxStmtQuery</span><span class="op" id="7961403">(</span><span class="ident" id="7961404">b</span>&nbsp;<span class="op" id="7961406">*</span><span class="ident" id="7961407"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7961414">.</span><span class="ident" id="7961415">B</span><span class="op" id="7961416">)</span>&nbsp;<span class="op" id="7961418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961421"><a href="/database/sql/sql_test.go.html#7961404">b</a></span><span class="op" id="7961422">.</span><span class="ident" id="7961423">ReportAllocs</span><span class="op" id="7961435">(</span><span class="op" id="7961436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961439">ct</span>&nbsp;<span class="op" id="7961442">:=</span>&nbsp;<span class="builtinfunc" id="7961445">new</span><span class="op" id="7961448">(</span><span class="ident" id="7961449"><a href="/database/sql/sql_test.go.html#7954082">concurrentTxStmtQueryTest</a></span><span class="op" id="7961474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7961477">for</span>&nbsp;<span class="ident" id="7961481">i</span>&nbsp;<span class="op" id="7961483">:=</span>&nbsp;<span class="num" id="7961486">0</span><span class="op" id="7961487">;</span>&nbsp;<span class="ident" id="7961489"><a href="/database/sql/sql_test.go.html#7961481">i</a></span>&nbsp;<span class="op" id="7961491">&lt;</span>&nbsp;<span class="ident" id="7961493"><a href="/database/sql/sql_test.go.html#7961404">b</a></span><span class="op" id="7961494">.</span><span class="ident" id="7961495">N</span><span class="op" id="7961496">;</span>&nbsp;<span class="ident" id="7961498"><a href="/database/sql/sql_test.go.html#7961481">i</a></span><span class="op" id="7961499">++</span>&nbsp;<span class="op" id="7961502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961506"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961522">(</span><span class="ident" id="7961523"><a href="/database/sql/sql_test.go.html#7961404">b</a></span><span class="op" id="7961524">,</span>&nbsp;<span class="ident" id="7961526"><a href="/database/sql/sql_test.go.html#7961439">ct</a></span><span class="op" id="7961528">)</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961531">}</span><br>
<span class="lineno"></span><span class="op" id="7961533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7961536">func</span>&nbsp;<span class="ident" id="7961541">BenchmarkConcurrentTxStmtExec</span><span class="op" id="7961570">(</span><span class="ident" id="7961571">b</span>&nbsp;<span class="op" id="7961573">*</span><span class="ident" id="7961574"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7961581">.</span><span class="ident" id="7961582">B</span><span class="op" id="7961583">)</span>&nbsp;<span class="op" id="7961585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961588"><a href="/database/sql/sql_test.go.html#7961571">b</a></span><span class="op" id="7961589">.</span><span class="ident" id="7961590">ReportAllocs</span><span class="op" id="7961602">(</span><span class="op" id="7961603">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961606">ct</span>&nbsp;<span class="op" id="7961609">:=</span>&nbsp;<span class="builtinfunc" id="7961612">new</span><span class="op" id="7961615">(</span><span class="ident" id="7961616"><a href="/database/sql/sql_test.go.html#7954831">concurrentTxStmtExecTest</a></span><span class="op" id="7961640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7961643">for</span>&nbsp;<span class="ident" id="7961647">i</span>&nbsp;<span class="op" id="7961649">:=</span>&nbsp;<span class="num" id="7961652">0</span><span class="op" id="7961653">;</span>&nbsp;<span class="ident" id="7961655"><a href="/database/sql/sql_test.go.html#7961647">i</a></span>&nbsp;<span class="op" id="7961657">&lt;</span>&nbsp;<span class="ident" id="7961659"><a href="/database/sql/sql_test.go.html#7961571">b</a></span><span class="op" id="7961660">.</span><span class="ident" id="7961661">N</span><span class="op" id="7961662">;</span>&nbsp;<span class="ident" id="7961664"><a href="/database/sql/sql_test.go.html#7961647">i</a></span><span class="op" id="7961665">++</span>&nbsp;<span class="op" id="7961668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961672"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961688">(</span><span class="ident" id="7961689"><a href="/database/sql/sql_test.go.html#7961571">b</a></span><span class="op" id="7961690">,</span>&nbsp;<span class="ident" id="7961692"><a href="/database/sql/sql_test.go.html#7961606">ct</a></span><span class="op" id="7961694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961697">}</span><br>
<span class="lineno"></span><span class="op" id="7961699">}</span><br>
<span class="lineno">1980</span><br>
<span class="lineno"></span><span class="keyword" id="7961702">func</span>&nbsp;<span class="ident" id="7961707">BenchmarkConcurrentRandom</span><span class="op" id="7961732">(</span><span class="ident" id="7961733">b</span>&nbsp;<span class="op" id="7961735">*</span><span class="ident" id="7961736"><a href="/database/sql/sql_test.go.html#7916700">testing</a></span><span class="op" id="7961743">.</span><span class="ident" id="7961744">B</span><span class="op" id="7961745">)</span>&nbsp;<span class="op" id="7961747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961750"><a href="/database/sql/sql_test.go.html#7961733">b</a></span><span class="op" id="7961751">.</span><span class="ident" id="7961752">ReportAllocs</span><span class="op" id="7961764">(</span><span class="op" id="7961765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961768">ct</span>&nbsp;<span class="op" id="7961771">:=</span>&nbsp;<span class="builtinfunc" id="7961774">new</span><span class="op" id="7961777">(</span><span class="ident" id="7961778"><a href="/database/sql/sql_test.go.html#7955546">concurrentRandomTest</a></span><span class="op" id="7961798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7961801">for</span>&nbsp;<span class="ident" id="7961805">i</span>&nbsp;<span class="op" id="7961807">:=</span>&nbsp;<span class="num" id="7961810">0</span><span class="op" id="7961811">;</span>&nbsp;<span class="ident" id="7961813"><a href="/database/sql/sql_test.go.html#7961805">i</a></span>&nbsp;<span class="op" id="7961815">&lt;</span>&nbsp;<span class="ident" id="7961817"><a href="/database/sql/sql_test.go.html#7961733">b</a></span><span class="op" id="7961818">.</span><span class="ident" id="7961819">N</span><span class="op" id="7961820">;</span>&nbsp;<span class="ident" id="7961822"><a href="/database/sql/sql_test.go.html#7961805">i</a></span><span class="op" id="7961823">++</span>&nbsp;<span class="op" id="7961826">{</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7961830"><a href="/database/sql/sql_test.go.html#7956226">doConcurrentTest</a></span><span class="op" id="7961846">(</span><span class="ident" id="7961847"><a href="/database/sql/sql_test.go.html#7961733">b</a></span><span class="op" id="7961848">,</span>&nbsp;<span class="ident" id="7961850"><a href="/database/sql/sql_test.go.html#7961768">ct</a></span><span class="op" id="7961852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7961855">}</span><br>
<span class="lineno"></span><span class="op" id="7961857">}</span>
</div>
</body>
</html>
