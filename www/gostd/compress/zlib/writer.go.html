<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4818299">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4818354">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4818408">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4818459">package</span>&nbsp;<span class="ident" id="4818467">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4818473">import</span>&nbsp;<span class="op" id="4818480">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4818483">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4818501">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4818508">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4818516">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4818532">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4818537">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4818540">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4818620">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4818686">const</span>&nbsp;<span class="op" id="4818692">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818695">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4818714">=</span>&nbsp;<span class="ident" id="4818716">flate</span><span class="op" id="4818721">.</span><span class="ident" id="4818722">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818737">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4818756">=</span>&nbsp;<span class="ident" id="4818758">flate</span><span class="op" id="4818763">.</span><span class="ident" id="4818764">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818775">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4818794">=</span>&nbsp;<span class="ident" id="4818796">flate</span><span class="op" id="4818801">.</span><span class="ident" id="4818802">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4818819">DefaultCompression</span>&nbsp;<span class="op" id="4818838">=</span>&nbsp;<span class="ident" id="4818840">flate</span><span class="op" id="4818845">.</span><span class="ident" id="4818846">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4818865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4818868">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="4818931">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="4818993">type</span>&nbsp;<span class="ident" id="4818998">Writer</span>&nbsp;<span class="keyword" id="4819005">struct</span>&nbsp;<span class="op" id="4819012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819015">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819027">io</span><span class="op" id="4819029">.</span><span class="ident" id="4819030">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819038">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4819050">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819055">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4819067">[</span><span class="op" id="4819068">]</span><span class="builtintype" id="4819069">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819075">compressor</span>&nbsp;&nbsp;<span class="op" id="4819087">*</span><span class="ident" id="4819088">flate</span><span class="op" id="4819093">.</span><span class="ident" id="4819094">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819102">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819114">hash</span><span class="op" id="4819118">.</span><span class="ident" id="4819119">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819127">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4819139">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819146">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4819158">[</span><span class="num" id="4819159">4</span><span class="op" id="4819160">]</span><span class="builtintype" id="4819161">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819167">wroteHeader</span>&nbsp;<span class="builtintype" id="4819179">bool</span><br>
<span class="lineno">35</span><span class="op" id="4819184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819187">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4819222">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4819288">//</span><br>
<span class="lineno">40</span><span class="comment" id="4819291">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4819372">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4819427">func</span>&nbsp;<span class="ident" id="4819432">NewWriter</span><span class="op" id="4819441">(</span><span class="ident" id="4819442">w</span>&nbsp;<span class="ident" id="4819444">io</span><span class="op" id="4819446">.</span><span class="ident" id="4819447">Writer</span><span class="op" id="4819453">)</span>&nbsp;<span class="op" id="4819455">*</span><span class="ident" id="4819456">Writer</span>&nbsp;<span class="op" id="4819463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4819466">z</span><span class="op" id="4819467">,</span>&nbsp;<span class="ident" id="4819469">_</span>&nbsp;<span class="op" id="4819471">:=</span>&nbsp;<span class="ident" id="4819474">NewWriterLevelDict</span><span class="op" id="4819492">(</span><span class="ident" id="4819493">w</span><span class="op" id="4819494">,</span>&nbsp;<span class="ident" id="4819496">DefaultCompression</span><span class="op" id="4819514">,</span>&nbsp;<span class="builtintype" id="4819516">nil</span><span class="op" id="4819519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4819522">return</span>&nbsp;<span class="ident" id="4819529">z</span><br>
<span class="lineno">45</span><span class="op" id="4819531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819534">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4819614">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4819649">//</span><br>
<span class="lineno">50</span><span class="comment" id="4819652">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4819726">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4819802">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4819849">func</span>&nbsp;<span class="ident" id="4819854">NewWriterLevel</span><span class="op" id="4819868">(</span><span class="ident" id="4819869">w</span>&nbsp;<span class="ident" id="4819871">io</span><span class="op" id="4819873">.</span><span class="ident" id="4819874">Writer</span><span class="op" id="4819880">,</span>&nbsp;<span class="ident" id="4819882">level</span>&nbsp;<span class="builtintype" id="4819888">int</span><span class="op" id="4819891">)</span>&nbsp;<span class="op" id="4819893">(</span><span class="op" id="4819894">*</span><span class="ident" id="4819895">Writer</span><span class="op" id="4819901">,</span>&nbsp;<span class="builtintype" id="4819903">error</span><span class="op" id="4819908">)</span>&nbsp;<span class="op" id="4819910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4819913">return</span>&nbsp;<span class="ident" id="4819920">NewWriterLevelDict</span><span class="op" id="4819938">(</span><span class="ident" id="4819939">w</span><span class="op" id="4819940">,</span>&nbsp;<span class="ident" id="4819942">level</span><span class="op" id="4819947">,</span>&nbsp;<span class="builtintype" id="4819949">nil</span><span class="op" id="4819952">)</span><br>
<span class="lineno">55</span><span class="op" id="4819954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819957">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4820032">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="4820050">//</span><br>
<span class="lineno">60</span><span class="comment" id="4820053">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="4820133">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4820158">func</span>&nbsp;<span class="ident" id="4820163">NewWriterLevelDict</span><span class="op" id="4820181">(</span><span class="ident" id="4820182">w</span>&nbsp;<span class="ident" id="4820184">io</span><span class="op" id="4820186">.</span><span class="ident" id="4820187">Writer</span><span class="op" id="4820193">,</span>&nbsp;<span class="ident" id="4820195">level</span>&nbsp;<span class="builtintype" id="4820201">int</span><span class="op" id="4820204">,</span>&nbsp;<span class="ident" id="4820206">dict</span>&nbsp;<span class="op" id="4820211">[</span><span class="op" id="4820212">]</span><span class="builtintype" id="4820213">byte</span><span class="op" id="4820217">)</span>&nbsp;<span class="op" id="4820219">(</span><span class="op" id="4820220">*</span><span class="ident" id="4820221">Writer</span><span class="op" id="4820227">,</span>&nbsp;<span class="builtintype" id="4820229">error</span><span class="op" id="4820234">)</span>&nbsp;<span class="op" id="4820236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820239">if</span>&nbsp;<span class="ident" id="4820242">level</span>&nbsp;<span class="op" id="4820248">&lt;</span>&nbsp;<span class="ident" id="4820250">DefaultCompression</span>&nbsp;<span class="op" id="4820269">||</span>&nbsp;<span class="ident" id="4820272">level</span>&nbsp;<span class="op" id="4820278">&gt;</span>&nbsp;<span class="ident" id="4820280">BestCompression</span>&nbsp;<span class="op" id="4820296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820300">return</span>&nbsp;<span class="builtintype" id="4820307">nil</span><span class="op" id="4820310">,</span>&nbsp;<span class="ident" id="4820312">fmt</span><span class="op" id="4820315">.</span><span class="ident" id="4820316">Errorf</span><span class="op" id="4820322">(</span><span class="string" id="4820323">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4820360">,</span>&nbsp;<span class="ident" id="4820362">level</span><span class="op" id="4820367">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820373">return</span>&nbsp;<span class="op" id="4820380">&amp;</span><span class="ident" id="4820381">Writer</span><span class="op" id="4820387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820391">w</span><span class="op" id="4820392">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820398">w</span><span class="op" id="4820399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820403">level</span><span class="op" id="4820408">:</span>&nbsp;<span class="ident" id="4820410">level</span><span class="op" id="4820415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820419">dict</span><span class="op" id="4820423">:</span>&nbsp;&nbsp;<span class="ident" id="4820426">dict</span><span class="op" id="4820430">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820433">}</span><span class="op" id="4820434">,</span>&nbsp;<span class="builtintype" id="4820436">nil</span><br>
<span class="lineno"></span><span class="op" id="4820440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820443">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4820519">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="4820599">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4820608">func</span>&nbsp;<span class="op" id="4820613">(</span><span class="ident" id="4820614">z</span>&nbsp;<span class="op" id="4820616">*</span><span class="ident" id="4820617">Writer</span><span class="op" id="4820623">)</span>&nbsp;<span class="ident" id="4820625">Reset</span><span class="op" id="4820630">(</span><span class="ident" id="4820631">w</span>&nbsp;<span class="ident" id="4820633">io</span><span class="op" id="4820635">.</span><span class="ident" id="4820636">Writer</span><span class="op" id="4820642">)</span>&nbsp;<span class="op" id="4820644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820647">z</span><span class="op" id="4820648">.</span><span class="ident" id="4820649">w</span>&nbsp;<span class="op" id="4820651">=</span>&nbsp;<span class="ident" id="4820653">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820656">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820695">if</span>&nbsp;<span class="ident" id="4820698">z</span><span class="op" id="4820699">.</span><span class="ident" id="4820700">compressor</span>&nbsp;<span class="op" id="4820711">!=</span>&nbsp;<span class="builtintype" id="4820714">nil</span>&nbsp;<span class="op" id="4820718">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820722">z</span><span class="op" id="4820723">.</span><span class="ident" id="4820724">compressor</span><span class="op" id="4820734">.</span><span class="ident" id="4820735">Reset</span><span class="op" id="4820740">(</span><span class="ident" id="4820741">w</span><span class="op" id="4820742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4820748">if</span>&nbsp;<span class="ident" id="4820751">z</span><span class="op" id="4820752">.</span><span class="ident" id="4820753">digest</span>&nbsp;<span class="op" id="4820760">!=</span>&nbsp;<span class="builtintype" id="4820763">nil</span>&nbsp;<span class="op" id="4820767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820771">z</span><span class="op" id="4820772">.</span><span class="ident" id="4820773">digest</span><span class="op" id="4820779">.</span><span class="ident" id="4820780">Reset</span><span class="op" id="4820785">(</span><span class="op" id="4820786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4820789">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820792">z</span><span class="op" id="4820793">.</span><span class="ident" id="4820794">err</span>&nbsp;<span class="op" id="4820798">=</span>&nbsp;<span class="builtintype" id="4820800">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820805">z</span><span class="op" id="4820806">.</span><span class="ident" id="4820807">scratch</span>&nbsp;<span class="op" id="4820815">=</span>&nbsp;<span class="op" id="4820817">[</span><span class="num" id="4820818">4</span><span class="op" id="4820819">]</span><span class="builtintype" id="4820820">byte</span><span class="op" id="4820824">{</span><span class="op" id="4820825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820828">z</span><span class="op" id="4820829">.</span><span class="ident" id="4820830">wroteHeader</span>&nbsp;<span class="op" id="4820842">=</span>&nbsp;<span class="builtintype" id="4820844">false</span><br>
<span class="lineno"></span><span class="op" id="4820850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4820853">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="4820892">func</span>&nbsp;<span class="op" id="4820897">(</span><span class="ident" id="4820898">z</span>&nbsp;<span class="op" id="4820900">*</span><span class="ident" id="4820901">Writer</span><span class="op" id="4820907">)</span>&nbsp;<span class="ident" id="4820909">writeHeader</span><span class="op" id="4820920">(</span><span class="op" id="4820921">)</span>&nbsp;<span class="op" id="4820923">(</span><span class="ident" id="4820924">err</span>&nbsp;<span class="builtintype" id="4820928">error</span><span class="op" id="4820933">)</span>&nbsp;<span class="op" id="4820935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4820938">z</span><span class="op" id="4820939">.</span><span class="ident" id="4820940">wroteHeader</span>&nbsp;<span class="op" id="4820952">=</span>&nbsp;<span class="builtintype" id="4820954">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4820960">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821020">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821125">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821204">z</span><span class="op" id="4821205">.</span><span class="ident" id="4821206">scratch</span><span class="op" id="4821213">[</span><span class="num" id="4821214">0</span><span class="op" id="4821215">]</span>&nbsp;<span class="op" id="4821217">=</span>&nbsp;<span class="num" id="4821219">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821225">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821303">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821345">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821403">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821458">switch</span>&nbsp;<span class="ident" id="4821465">z</span><span class="op" id="4821466">.</span><span class="ident" id="4821467">level</span>&nbsp;<span class="op" id="4821473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821476">case</span>&nbsp;<span class="num" id="4821481">0</span><span class="op" id="4821482">,</span>&nbsp;<span class="num" id="4821484">1</span><span class="op" id="4821485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821489">z</span><span class="op" id="4821490">.</span><span class="ident" id="4821491">scratch</span><span class="op" id="4821498">[</span><span class="num" id="4821499">1</span><span class="op" id="4821500">]</span>&nbsp;<span class="op" id="4821502">=</span>&nbsp;<span class="num" id="4821504">0</span>&nbsp;<span class="op" id="4821506">&lt;&lt;</span>&nbsp;<span class="num" id="4821509">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821512">case</span>&nbsp;<span class="num" id="4821517">2</span><span class="op" id="4821518">,</span>&nbsp;<span class="num" id="4821520">3</span><span class="op" id="4821521">,</span>&nbsp;<span class="num" id="4821523">4</span><span class="op" id="4821524">,</span>&nbsp;<span class="num" id="4821526">5</span><span class="op" id="4821527">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821531">z</span><span class="op" id="4821532">.</span><span class="ident" id="4821533">scratch</span><span class="op" id="4821540">[</span><span class="num" id="4821541">1</span><span class="op" id="4821542">]</span>&nbsp;<span class="op" id="4821544">=</span>&nbsp;<span class="num" id="4821546">1</span>&nbsp;<span class="op" id="4821548">&lt;&lt;</span>&nbsp;<span class="num" id="4821551">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821554">case</span>&nbsp;<span class="num" id="4821559">6</span><span class="op" id="4821560">,</span>&nbsp;<span class="op" id="4821562">-</span><span class="num" id="4821563">1</span><span class="op" id="4821564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821568">z</span><span class="op" id="4821569">.</span><span class="ident" id="4821570">scratch</span><span class="op" id="4821577">[</span><span class="num" id="4821578">1</span><span class="op" id="4821579">]</span>&nbsp;<span class="op" id="4821581">=</span>&nbsp;<span class="num" id="4821583">2</span>&nbsp;<span class="op" id="4821585">&lt;&lt;</span>&nbsp;<span class="num" id="4821588">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821591">case</span>&nbsp;<span class="num" id="4821596">7</span><span class="op" id="4821597">,</span>&nbsp;<span class="num" id="4821599">8</span><span class="op" id="4821600">,</span>&nbsp;<span class="num" id="4821602">9</span><span class="op" id="4821603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821607">z</span><span class="op" id="4821608">.</span><span class="ident" id="4821609">scratch</span><span class="op" id="4821616">[</span><span class="num" id="4821617">1</span><span class="op" id="4821618">]</span>&nbsp;<span class="op" id="4821620">=</span>&nbsp;<span class="num" id="4821622">3</span>&nbsp;<span class="op" id="4821624">&lt;&lt;</span>&nbsp;<span class="num" id="4821627">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821630">default</span><span class="op" id="4821637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4821641">panic</span><span class="op" id="4821646">(</span><span class="string" id="4821647">&#34;unreachable&#34;</span><span class="op" id="4821660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821666">if</span>&nbsp;<span class="ident" id="4821669">z</span><span class="op" id="4821670">.</span><span class="ident" id="4821671">dict</span>&nbsp;<span class="op" id="4821676">!=</span>&nbsp;<span class="builtintype" id="4821679">nil</span>&nbsp;<span class="op" id="4821683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821687">z</span><span class="op" id="4821688">.</span><span class="ident" id="4821689">scratch</span><span class="op" id="4821696">[</span><span class="num" id="4821697">1</span><span class="op" id="4821698">]</span>&nbsp;<span class="op" id="4821700">|=</span>&nbsp;<span class="num" id="4821703">1</span>&nbsp;<span class="op" id="4821705">&lt;&lt;</span>&nbsp;<span class="num" id="4821708">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821714">z</span><span class="op" id="4821715">.</span><span class="ident" id="4821716">scratch</span><span class="op" id="4821723">[</span><span class="num" id="4821724">1</span><span class="op" id="4821725">]</span>&nbsp;<span class="op" id="4821727">+=</span>&nbsp;<span class="builtintype" id="4821730">uint8</span><span class="op" id="4821735">(</span><span class="num" id="4821736">31</span>&nbsp;<span class="op" id="4821739">-</span>&nbsp;<span class="op" id="4821741">(</span><span class="builtintype" id="4821742">uint16</span><span class="op" id="4821748">(</span><span class="ident" id="4821749">z</span><span class="op" id="4821750">.</span><span class="ident" id="4821751">scratch</span><span class="op" id="4821758">[</span><span class="num" id="4821759">0</span><span class="op" id="4821760">]</span><span class="op" id="4821761">)</span><span class="op" id="4821762">&lt;&lt;</span><span class="num" id="4821764">8</span><span class="op" id="4821765">+</span><span class="builtintype" id="4821766">uint16</span><span class="op" id="4821772">(</span><span class="ident" id="4821773">z</span><span class="op" id="4821774">.</span><span class="ident" id="4821775">scratch</span><span class="op" id="4821782">[</span><span class="num" id="4821783">1</span><span class="op" id="4821784">]</span><span class="op" id="4821785">)</span><span class="op" id="4821786">)</span><span class="op" id="4821787">%</span><span class="num" id="4821788">31</span><span class="op" id="4821790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821793">if</span>&nbsp;<span class="ident" id="4821796">_</span><span class="op" id="4821797">,</span>&nbsp;<span class="ident" id="4821799">err</span>&nbsp;<span class="op" id="4821803">=</span>&nbsp;<span class="ident" id="4821805">z</span><span class="op" id="4821806">.</span><span class="ident" id="4821807">w</span><span class="op" id="4821808">.</span><span class="ident" id="4821809">Write</span><span class="op" id="4821814">(</span><span class="ident" id="4821815">z</span><span class="op" id="4821816">.</span><span class="ident" id="4821817">scratch</span><span class="op" id="4821824">[</span><span class="num" id="4821825">0</span><span class="op" id="4821826">:</span><span class="num" id="4821827">2</span><span class="op" id="4821828">]</span><span class="op" id="4821829">)</span><span class="op" id="4821830">;</span>&nbsp;<span class="ident" id="4821832">err</span>&nbsp;<span class="op" id="4821836">!=</span>&nbsp;<span class="builtintype" id="4821839">nil</span>&nbsp;<span class="op" id="4821843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821847">return</span>&nbsp;<span class="ident" id="4821854">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4821859">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4821862">if</span>&nbsp;<span class="ident" id="4821865">z</span><span class="op" id="4821866">.</span><span class="ident" id="4821867">dict</span>&nbsp;<span class="op" id="4821872">!=</span>&nbsp;<span class="builtintype" id="4821875">nil</span>&nbsp;<span class="op" id="4821879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4821883">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821953">checksum</span>&nbsp;<span class="op" id="4821962">:=</span>&nbsp;<span class="ident" id="4821965">adler32</span><span class="op" id="4821972">.</span><span class="ident" id="4821973">Checksum</span><span class="op" id="4821981">(</span><span class="ident" id="4821982">z</span><span class="op" id="4821983">.</span><span class="ident" id="4821984">dict</span><span class="op" id="4821988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4821992">z</span><span class="op" id="4821993">.</span><span class="ident" id="4821994">scratch</span><span class="op" id="4822001">[</span><span class="num" id="4822002">0</span><span class="op" id="4822003">]</span>&nbsp;<span class="op" id="4822005">=</span>&nbsp;<span class="builtintype" id="4822007">uint8</span><span class="op" id="4822012">(</span><span class="ident" id="4822013">checksum</span>&nbsp;<span class="op" id="4822022">&gt;&gt;</span>&nbsp;<span class="num" id="4822025">24</span><span class="op" id="4822027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822031">z</span><span class="op" id="4822032">.</span><span class="ident" id="4822033">scratch</span><span class="op" id="4822040">[</span><span class="num" id="4822041">1</span><span class="op" id="4822042">]</span>&nbsp;<span class="op" id="4822044">=</span>&nbsp;<span class="builtintype" id="4822046">uint8</span><span class="op" id="4822051">(</span><span class="ident" id="4822052">checksum</span>&nbsp;<span class="op" id="4822061">&gt;&gt;</span>&nbsp;<span class="num" id="4822064">16</span><span class="op" id="4822066">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822070">z</span><span class="op" id="4822071">.</span><span class="ident" id="4822072">scratch</span><span class="op" id="4822079">[</span><span class="num" id="4822080">2</span><span class="op" id="4822081">]</span>&nbsp;<span class="op" id="4822083">=</span>&nbsp;<span class="builtintype" id="4822085">uint8</span><span class="op" id="4822090">(</span><span class="ident" id="4822091">checksum</span>&nbsp;<span class="op" id="4822100">&gt;&gt;</span>&nbsp;<span class="num" id="4822103">8</span><span class="op" id="4822104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822108">z</span><span class="op" id="4822109">.</span><span class="ident" id="4822110">scratch</span><span class="op" id="4822117">[</span><span class="num" id="4822118">3</span><span class="op" id="4822119">]</span>&nbsp;<span class="op" id="4822121">=</span>&nbsp;<span class="builtintype" id="4822123">uint8</span><span class="op" id="4822128">(</span><span class="ident" id="4822129">checksum</span>&nbsp;<span class="op" id="4822138">&gt;&gt;</span>&nbsp;<span class="num" id="4822141">0</span><span class="op" id="4822142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822146">if</span>&nbsp;<span class="ident" id="4822149">_</span><span class="op" id="4822150">,</span>&nbsp;<span class="ident" id="4822152">err</span>&nbsp;<span class="op" id="4822156">=</span>&nbsp;<span class="ident" id="4822158">z</span><span class="op" id="4822159">.</span><span class="ident" id="4822160">w</span><span class="op" id="4822161">.</span><span class="ident" id="4822162">Write</span><span class="op" id="4822167">(</span><span class="ident" id="4822168">z</span><span class="op" id="4822169">.</span><span class="ident" id="4822170">scratch</span><span class="op" id="4822177">[</span><span class="num" id="4822178">0</span><span class="op" id="4822179">:</span><span class="num" id="4822180">4</span><span class="op" id="4822181">]</span><span class="op" id="4822182">)</span><span class="op" id="4822183">;</span>&nbsp;<span class="ident" id="4822185">err</span>&nbsp;<span class="op" id="4822189">!=</span>&nbsp;<span class="builtintype" id="4822192">nil</span>&nbsp;<span class="op" id="4822196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822201">return</span>&nbsp;<span class="ident" id="4822208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822214">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822220">if</span>&nbsp;<span class="ident" id="4822223">z</span><span class="op" id="4822224">.</span><span class="ident" id="4822225">compressor</span>&nbsp;<span class="op" id="4822236">==</span>&nbsp;<span class="builtintype" id="4822239">nil</span>&nbsp;<span class="op" id="4822243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822247">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4822306">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822331">z</span><span class="op" id="4822332">.</span><span class="ident" id="4822333">compressor</span><span class="op" id="4822343">,</span>&nbsp;<span class="ident" id="4822345">err</span>&nbsp;<span class="op" id="4822349">=</span>&nbsp;<span class="ident" id="4822351">flate</span><span class="op" id="4822356">.</span><span class="ident" id="4822357">NewWriterDict</span><span class="op" id="4822370">(</span><span class="ident" id="4822371">z</span><span class="op" id="4822372">.</span><span class="ident" id="4822373">w</span><span class="op" id="4822374">,</span>&nbsp;<span class="ident" id="4822376">z</span><span class="op" id="4822377">.</span><span class="ident" id="4822378">level</span><span class="op" id="4822383">,</span>&nbsp;<span class="ident" id="4822385">z</span><span class="op" id="4822386">.</span><span class="ident" id="4822387">dict</span><span class="op" id="4822391">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822395">if</span>&nbsp;<span class="ident" id="4822398">err</span>&nbsp;<span class="op" id="4822402">!=</span>&nbsp;<span class="builtintype" id="4822405">nil</span>&nbsp;<span class="op" id="4822409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822414">return</span>&nbsp;<span class="ident" id="4822421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822431">z</span><span class="op" id="4822432">.</span><span class="ident" id="4822433">digest</span>&nbsp;<span class="op" id="4822440">=</span>&nbsp;<span class="ident" id="4822442">adler32</span><span class="op" id="4822449">.</span><span class="ident" id="4822450">New</span><span class="op" id="4822453">(</span><span class="op" id="4822454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822457">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822460">return</span>&nbsp;<span class="builtintype" id="4822467">nil</span><br>
<span class="lineno"></span><span class="op" id="4822471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4822474">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4822546">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="4822624">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="4822647">func</span>&nbsp;<span class="op" id="4822652">(</span><span class="ident" id="4822653">z</span>&nbsp;<span class="op" id="4822655">*</span><span class="ident" id="4822656">Writer</span><span class="op" id="4822662">)</span>&nbsp;<span class="ident" id="4822664">Write</span><span class="op" id="4822669">(</span><span class="ident" id="4822670">p</span>&nbsp;<span class="op" id="4822672">[</span><span class="op" id="4822673">]</span><span class="builtintype" id="4822674">byte</span><span class="op" id="4822678">)</span>&nbsp;<span class="op" id="4822680">(</span><span class="ident" id="4822681">n</span>&nbsp;<span class="builtintype" id="4822683">int</span><span class="op" id="4822686">,</span>&nbsp;<span class="ident" id="4822688">err</span>&nbsp;<span class="builtintype" id="4822692">error</span><span class="op" id="4822697">)</span>&nbsp;<span class="op" id="4822699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822702">if</span>&nbsp;<span class="op" id="4822705">!</span><span class="ident" id="4822706">z</span><span class="op" id="4822707">.</span><span class="ident" id="4822708">wroteHeader</span>&nbsp;<span class="op" id="4822720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822724">z</span><span class="op" id="4822725">.</span><span class="ident" id="4822726">err</span>&nbsp;<span class="op" id="4822730">=</span>&nbsp;<span class="ident" id="4822732">z</span><span class="op" id="4822733">.</span><span class="ident" id="4822734">writeHeader</span><span class="op" id="4822745">(</span><span class="op" id="4822746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822749">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822752">if</span>&nbsp;<span class="ident" id="4822755">z</span><span class="op" id="4822756">.</span><span class="ident" id="4822757">err</span>&nbsp;<span class="op" id="4822761">!=</span>&nbsp;<span class="builtintype" id="4822764">nil</span>&nbsp;<span class="op" id="4822768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822772">return</span>&nbsp;<span class="num" id="4822779">0</span><span class="op" id="4822780">,</span>&nbsp;<span class="ident" id="4822782">z</span><span class="op" id="4822783">.</span><span class="ident" id="4822784">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822792">if</span>&nbsp;<span class="builtinfunc" id="4822795">len</span><span class="op" id="4822798">(</span><span class="ident" id="4822799">p</span><span class="op" id="4822800">)</span>&nbsp;<span class="op" id="4822802">==</span>&nbsp;<span class="num" id="4822805">0</span>&nbsp;<span class="op" id="4822807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822811">return</span>&nbsp;<span class="num" id="4822818">0</span><span class="op" id="4822819">,</span>&nbsp;<span class="builtintype" id="4822821">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822829">n</span><span class="op" id="4822830">,</span>&nbsp;<span class="ident" id="4822832">err</span>&nbsp;<span class="op" id="4822836">=</span>&nbsp;<span class="ident" id="4822838">z</span><span class="op" id="4822839">.</span><span class="ident" id="4822840">compressor</span><span class="op" id="4822850">.</span><span class="ident" id="4822851">Write</span><span class="op" id="4822856">(</span><span class="ident" id="4822857">p</span><span class="op" id="4822858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822861">if</span>&nbsp;<span class="ident" id="4822864">err</span>&nbsp;<span class="op" id="4822868">!=</span>&nbsp;<span class="builtintype" id="4822871">nil</span>&nbsp;<span class="op" id="4822875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822879">z</span><span class="op" id="4822880">.</span><span class="ident" id="4822881">err</span>&nbsp;<span class="op" id="4822885">=</span>&nbsp;<span class="ident" id="4822887">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822893">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4822901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4822904">z</span><span class="op" id="4822905">.</span><span class="ident" id="4822906">digest</span><span class="op" id="4822912">.</span><span class="ident" id="4822913">Write</span><span class="op" id="4822918">(</span><span class="ident" id="4822919">p</span><span class="op" id="4822920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4822923">return</span><br>
<span class="lineno"></span><span class="op" id="4822930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4822933">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4822990">func</span>&nbsp;<span class="op" id="4822995">(</span><span class="ident" id="4822996">z</span>&nbsp;<span class="op" id="4822998">*</span><span class="ident" id="4822999">Writer</span><span class="op" id="4823005">)</span>&nbsp;<span class="ident" id="4823007">Flush</span><span class="op" id="4823012">(</span><span class="op" id="4823013">)</span>&nbsp;<span class="builtintype" id="4823015">error</span>&nbsp;<span class="op" id="4823021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823024">if</span>&nbsp;<span class="op" id="4823027">!</span><span class="ident" id="4823028">z</span><span class="op" id="4823029">.</span><span class="ident" id="4823030">wroteHeader</span>&nbsp;<span class="op" id="4823042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823046">z</span><span class="op" id="4823047">.</span><span class="ident" id="4823048">err</span>&nbsp;<span class="op" id="4823052">=</span>&nbsp;<span class="ident" id="4823054">z</span><span class="op" id="4823055">.</span><span class="ident" id="4823056">writeHeader</span><span class="op" id="4823067">(</span><span class="op" id="4823068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823071">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823074">if</span>&nbsp;<span class="ident" id="4823077">z</span><span class="op" id="4823078">.</span><span class="ident" id="4823079">err</span>&nbsp;<span class="op" id="4823083">!=</span>&nbsp;<span class="builtintype" id="4823086">nil</span>&nbsp;<span class="op" id="4823090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823094">return</span>&nbsp;<span class="ident" id="4823101">z</span><span class="op" id="4823102">.</span><span class="ident" id="4823103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823111">z</span><span class="op" id="4823112">.</span><span class="ident" id="4823113">err</span>&nbsp;<span class="op" id="4823117">=</span>&nbsp;<span class="ident" id="4823119">z</span><span class="op" id="4823120">.</span><span class="ident" id="4823121">compressor</span><span class="op" id="4823131">.</span><span class="ident" id="4823132">Flush</span><span class="op" id="4823137">(</span><span class="op" id="4823138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823141">return</span>&nbsp;<span class="ident" id="4823148">z</span><span class="op" id="4823149">.</span><span class="ident" id="4823150">err</span><br>
<span class="lineno">175</span><span class="op" id="4823154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4823157">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4823231">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4823290">func</span>&nbsp;<span class="op" id="4823295">(</span><span class="ident" id="4823296">z</span>&nbsp;<span class="op" id="4823298">*</span><span class="ident" id="4823299">Writer</span><span class="op" id="4823305">)</span>&nbsp;<span class="ident" id="4823307">Close</span><span class="op" id="4823312">(</span><span class="op" id="4823313">)</span>&nbsp;<span class="builtintype" id="4823315">error</span>&nbsp;<span class="op" id="4823321">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823324">if</span>&nbsp;<span class="op" id="4823327">!</span><span class="ident" id="4823328">z</span><span class="op" id="4823329">.</span><span class="ident" id="4823330">wroteHeader</span>&nbsp;<span class="op" id="4823342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823346">z</span><span class="op" id="4823347">.</span><span class="ident" id="4823348">err</span>&nbsp;<span class="op" id="4823352">=</span>&nbsp;<span class="ident" id="4823354">z</span><span class="op" id="4823355">.</span><span class="ident" id="4823356">writeHeader</span><span class="op" id="4823367">(</span><span class="op" id="4823368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823374">if</span>&nbsp;<span class="ident" id="4823377">z</span><span class="op" id="4823378">.</span><span class="ident" id="4823379">err</span>&nbsp;<span class="op" id="4823383">!=</span>&nbsp;<span class="builtintype" id="4823386">nil</span>&nbsp;<span class="op" id="4823390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823394">return</span>&nbsp;<span class="ident" id="4823401">z</span><span class="op" id="4823402">.</span><span class="ident" id="4823403">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823411">z</span><span class="op" id="4823412">.</span><span class="ident" id="4823413">err</span>&nbsp;<span class="op" id="4823417">=</span>&nbsp;<span class="ident" id="4823419">z</span><span class="op" id="4823420">.</span><span class="ident" id="4823421">compressor</span><span class="op" id="4823431">.</span><span class="ident" id="4823432">Close</span><span class="op" id="4823437">(</span><span class="op" id="4823438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823441">if</span>&nbsp;<span class="ident" id="4823444">z</span><span class="op" id="4823445">.</span><span class="ident" id="4823446">err</span>&nbsp;<span class="op" id="4823450">!=</span>&nbsp;<span class="builtintype" id="4823453">nil</span>&nbsp;<span class="op" id="4823457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823461">return</span>&nbsp;<span class="ident" id="4823468">z</span><span class="op" id="4823469">.</span><span class="ident" id="4823470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4823475">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823478">checksum</span>&nbsp;<span class="op" id="4823487">:=</span>&nbsp;<span class="ident" id="4823490">z</span><span class="op" id="4823491">.</span><span class="ident" id="4823492">digest</span><span class="op" id="4823498">.</span><span class="ident" id="4823499">Sum32</span><span class="op" id="4823504">(</span><span class="op" id="4823505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4823508">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823567">z</span><span class="op" id="4823568">.</span><span class="ident" id="4823569">scratch</span><span class="op" id="4823576">[</span><span class="num" id="4823577">0</span><span class="op" id="4823578">]</span>&nbsp;<span class="op" id="4823580">=</span>&nbsp;<span class="builtintype" id="4823582">uint8</span><span class="op" id="4823587">(</span><span class="ident" id="4823588">checksum</span>&nbsp;<span class="op" id="4823597">&gt;&gt;</span>&nbsp;<span class="num" id="4823600">24</span><span class="op" id="4823602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823605">z</span><span class="op" id="4823606">.</span><span class="ident" id="4823607">scratch</span><span class="op" id="4823614">[</span><span class="num" id="4823615">1</span><span class="op" id="4823616">]</span>&nbsp;<span class="op" id="4823618">=</span>&nbsp;<span class="builtintype" id="4823620">uint8</span><span class="op" id="4823625">(</span><span class="ident" id="4823626">checksum</span>&nbsp;<span class="op" id="4823635">&gt;&gt;</span>&nbsp;<span class="num" id="4823638">16</span><span class="op" id="4823640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823643">z</span><span class="op" id="4823644">.</span><span class="ident" id="4823645">scratch</span><span class="op" id="4823652">[</span><span class="num" id="4823653">2</span><span class="op" id="4823654">]</span>&nbsp;<span class="op" id="4823656">=</span>&nbsp;<span class="builtintype" id="4823658">uint8</span><span class="op" id="4823663">(</span><span class="ident" id="4823664">checksum</span>&nbsp;<span class="op" id="4823673">&gt;&gt;</span>&nbsp;<span class="num" id="4823676">8</span><span class="op" id="4823677">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823680">z</span><span class="op" id="4823681">.</span><span class="ident" id="4823682">scratch</span><span class="op" id="4823689">[</span><span class="num" id="4823690">3</span><span class="op" id="4823691">]</span>&nbsp;<span class="op" id="4823693">=</span>&nbsp;<span class="builtintype" id="4823695">uint8</span><span class="op" id="4823700">(</span><span class="ident" id="4823701">checksum</span>&nbsp;<span class="op" id="4823710">&gt;&gt;</span>&nbsp;<span class="num" id="4823713">0</span><span class="op" id="4823714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4823717">_</span><span class="op" id="4823718">,</span>&nbsp;<span class="ident" id="4823720">z</span><span class="op" id="4823721">.</span><span class="ident" id="4823722">err</span>&nbsp;<span class="op" id="4823726">=</span>&nbsp;<span class="ident" id="4823728">z</span><span class="op" id="4823729">.</span><span class="ident" id="4823730">w</span><span class="op" id="4823731">.</span><span class="ident" id="4823732">Write</span><span class="op" id="4823737">(</span><span class="ident" id="4823738">z</span><span class="op" id="4823739">.</span><span class="ident" id="4823740">scratch</span><span class="op" id="4823747">[</span><span class="num" id="4823748">0</span><span class="op" id="4823749">:</span><span class="num" id="4823750">4</span><span class="op" id="4823751">]</span><span class="op" id="4823752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4823755">return</span>&nbsp;<span class="ident" id="4823762">z</span><span class="op" id="4823763">.</span><span class="ident" id="4823764">err</span><br>
<span class="lineno"></span><span class="op" id="4823768">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
