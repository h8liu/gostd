<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html" class="current">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5002316">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5002371">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5002425">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5002476">package</span>&nbsp;<span class="ident" id="5002484">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5002489">import</span>&nbsp;<span class="op" id="5002496">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5002499">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5002511">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5002518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5002521">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5002601">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5002622">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="5002694">func</span>&nbsp;<span class="ident" id="5002699">exportFilter</span><span class="op" id="5002711">(</span><span class="ident" id="5002712">name</span>&nbsp;<span class="builtintype" id="5002717">string</span><span class="op" id="5002723">)</span>&nbsp;<span class="builtintype" id="5002725">bool</span>&nbsp;<span class="op" id="5002730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002733">return</span>&nbsp;<span class="ident" id="5002740">IsExported</span><span class="op" id="5002750">(</span><span class="ident" id="5002751">name</span><span class="op" id="5002755">)</span><br>
<span class="lineno"></span><span class="op" id="5002757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5002760">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5002829">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5002909">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="5002987">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5003063">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="5003115">//</span><br>
<span class="lineno"></span><span class="comment" id="5003118">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5003182">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5003213">//</span><br>
<span class="lineno"></span><span class="keyword" id="5003216">func</span>&nbsp;<span class="ident" id="5003221">FileExports</span><span class="op" id="5003232">(</span><span class="ident" id="5003233">src</span>&nbsp;<span class="op" id="5003237">*</span><span class="ident" id="5003238">File</span><span class="op" id="5003242">)</span>&nbsp;<span class="builtintype" id="5003244">bool</span>&nbsp;<span class="op" id="5003249">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003252">return</span>&nbsp;<span class="ident" id="5003259">filterFile</span><span class="op" id="5003269">(</span><span class="ident" id="5003270">src</span><span class="op" id="5003273">,</span>&nbsp;<span class="ident" id="5003275">exportFilter</span><span class="op" id="5003287">,</span>&nbsp;<span class="builtintype" id="5003289">true</span><span class="op" id="5003293">)</span><br>
<span class="lineno"></span><span class="op" id="5003295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003298">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5003366">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="5003440">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5003501">//</span><br>
<span class="lineno"></span><span class="comment" id="5003504">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="5003571">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5003602">//</span><br>
<span class="lineno">40</span><span class="keyword" id="5003605">func</span>&nbsp;<span class="ident" id="5003610">PackageExports</span><span class="op" id="5003624">(</span><span class="ident" id="5003625">pkg</span>&nbsp;<span class="op" id="5003629">*</span><span class="ident" id="5003630">Package</span><span class="op" id="5003637">)</span>&nbsp;<span class="builtintype" id="5003639">bool</span>&nbsp;<span class="op" id="5003644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003647">return</span>&nbsp;<span class="ident" id="5003654">filterPackage</span><span class="op" id="5003667">(</span><span class="ident" id="5003668">pkg</span><span class="op" id="5003671">,</span>&nbsp;<span class="ident" id="5003673">exportFilter</span><span class="op" id="5003685">,</span>&nbsp;<span class="builtintype" id="5003687">true</span><span class="op" id="5003691">)</span><br>
<span class="lineno"></span><span class="op" id="5003693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003696">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="5003776">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5003798">type</span>&nbsp;<span class="ident" id="5003803">Filter</span>&nbsp;<span class="keyword" id="5003810">func</span><span class="op" id="5003814">(</span><span class="builtintype" id="5003815">string</span><span class="op" id="5003821">)</span>&nbsp;<span class="builtintype" id="5003823">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5003829">func</span>&nbsp;<span class="ident" id="5003834">filterIdentList</span><span class="op" id="5003849">(</span><span class="ident" id="5003850">list</span>&nbsp;<span class="op" id="5003855">[</span><span class="op" id="5003856">]</span><span class="op" id="5003857">*</span><span class="ident" id="5003858">Ident</span><span class="op" id="5003863">,</span>&nbsp;<span class="ident" id="5003865">f</span>&nbsp;<span class="ident" id="5003867">Filter</span><span class="op" id="5003873">)</span>&nbsp;<span class="op" id="5003875">[</span><span class="op" id="5003876">]</span><span class="op" id="5003877">*</span><span class="ident" id="5003878">Ident</span>&nbsp;<span class="op" id="5003884">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003887">j</span>&nbsp;<span class="op" id="5003889">:=</span>&nbsp;<span class="num" id="5003892">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003895">for</span>&nbsp;<span class="ident" id="5003899">_</span><span class="op" id="5003900">,</span>&nbsp;<span class="ident" id="5003902">x</span>&nbsp;<span class="op" id="5003904">:=</span>&nbsp;<span class="keyword" id="5003907">range</span>&nbsp;<span class="ident" id="5003913">list</span>&nbsp;<span class="op" id="5003918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003922">if</span>&nbsp;<span class="ident" id="5003925">f</span><span class="op" id="5003926">(</span><span class="ident" id="5003927">x</span><span class="op" id="5003928">.</span><span class="ident" id="5003929">Name</span><span class="op" id="5003933">)</span>&nbsp;<span class="op" id="5003935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003940">list</span><span class="op" id="5003944">[</span><span class="ident" id="5003945">j</span><span class="op" id="5003946">]</span>&nbsp;<span class="op" id="5003948">=</span>&nbsp;<span class="ident" id="5003950">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003955">j</span><span class="op" id="5003956">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003967">return</span>&nbsp;<span class="ident" id="5003974">list</span><span class="op" id="5003978">[</span><span class="num" id="5003979">0</span><span class="op" id="5003980">:</span><span class="ident" id="5003981">j</span><span class="op" id="5003982">]</span><br>
<span class="lineno"></span><span class="op" id="5003984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5003987">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5004053">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="5004120">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5004159">//</span><br>
<span class="lineno"></span><span class="keyword" id="5004162">func</span>&nbsp;<span class="ident" id="5004167">fieldName</span><span class="op" id="5004176">(</span><span class="ident" id="5004177">x</span>&nbsp;<span class="ident" id="5004179">Expr</span><span class="op" id="5004183">)</span>&nbsp;<span class="op" id="5004185">*</span><span class="ident" id="5004186">Ident</span>&nbsp;<span class="op" id="5004192">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004195">switch</span>&nbsp;<span class="ident" id="5004202">t</span>&nbsp;<span class="op" id="5004204">:=</span>&nbsp;<span class="ident" id="5004207">x</span><span class="op" id="5004208">.</span><span class="op" id="5004209">(</span><span class="keyword" id="5004210">type</span><span class="op" id="5004214">)</span>&nbsp;<span class="op" id="5004216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004219">case</span>&nbsp;<span class="op" id="5004224">*</span><span class="ident" id="5004225">Ident</span><span class="op" id="5004230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004234">return</span>&nbsp;<span class="ident" id="5004241">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004244">case</span>&nbsp;<span class="op" id="5004249">*</span><span class="ident" id="5004250">SelectorExpr</span><span class="op" id="5004262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004266">if</span>&nbsp;<span class="ident" id="5004269">_</span><span class="op" id="5004270">,</span>&nbsp;<span class="ident" id="5004272">ok</span>&nbsp;<span class="op" id="5004275">:=</span>&nbsp;<span class="ident" id="5004278">t</span><span class="op" id="5004279">.</span><span class="ident" id="5004280">X</span><span class="op" id="5004281">.</span><span class="op" id="5004282">(</span><span class="op" id="5004283">*</span><span class="ident" id="5004284">Ident</span><span class="op" id="5004289">)</span><span class="op" id="5004290">;</span>&nbsp;<span class="ident" id="5004292">ok</span>&nbsp;<span class="op" id="5004295">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004300">return</span>&nbsp;<span class="ident" id="5004307">t</span><span class="op" id="5004308">.</span><span class="ident" id="5004309">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004318">case</span>&nbsp;<span class="op" id="5004323">*</span><span class="ident" id="5004324">StarExpr</span><span class="op" id="5004332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004336">return</span>&nbsp;<span class="ident" id="5004343">fieldName</span><span class="op" id="5004352">(</span><span class="ident" id="5004353">t</span><span class="op" id="5004354">.</span><span class="ident" id="5004355">X</span><span class="op" id="5004356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004359">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004362">return</span>&nbsp;<span class="builtintype" id="5004369">nil</span><br>
<span class="lineno"></span><span class="op" id="5004373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5004376">func</span>&nbsp;<span class="ident" id="5004381">filterFieldList</span><span class="op" id="5004396">(</span><span class="ident" id="5004397">fields</span>&nbsp;<span class="op" id="5004404">*</span><span class="ident" id="5004405">FieldList</span><span class="op" id="5004414">,</span>&nbsp;<span class="ident" id="5004416">filter</span>&nbsp;<span class="ident" id="5004423">Filter</span><span class="op" id="5004429">,</span>&nbsp;<span class="ident" id="5004431">export</span>&nbsp;<span class="builtintype" id="5004438">bool</span><span class="op" id="5004442">)</span>&nbsp;<span class="op" id="5004444">(</span><span class="ident" id="5004445">removedFields</span>&nbsp;<span class="builtintype" id="5004459">bool</span><span class="op" id="5004463">)</span>&nbsp;<span class="op" id="5004465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004468">if</span>&nbsp;<span class="ident" id="5004471">fields</span>&nbsp;<span class="op" id="5004478">==</span>&nbsp;<span class="builtintype" id="5004481">nil</span>&nbsp;<span class="op" id="5004485">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004489">return</span>&nbsp;<span class="builtintype" id="5004496">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004506">list</span>&nbsp;<span class="op" id="5004511">:=</span>&nbsp;<span class="ident" id="5004514">fields</span><span class="op" id="5004520">.</span><span class="ident" id="5004521">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004527">j</span>&nbsp;<span class="op" id="5004529">:=</span>&nbsp;<span class="num" id="5004532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004535">for</span>&nbsp;<span class="ident" id="5004539">_</span><span class="op" id="5004540">,</span>&nbsp;<span class="ident" id="5004542">f</span>&nbsp;<span class="op" id="5004544">:=</span>&nbsp;<span class="keyword" id="5004547">range</span>&nbsp;<span class="ident" id="5004553">list</span>&nbsp;<span class="op" id="5004558">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004562">keepField</span>&nbsp;<span class="op" id="5004572">:=</span>&nbsp;<span class="builtintype" id="5004575">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004583">if</span>&nbsp;<span class="builtinfunc" id="5004586">len</span><span class="op" id="5004589">(</span><span class="ident" id="5004590">f</span><span class="op" id="5004591">.</span><span class="ident" id="5004592">Names</span><span class="op" id="5004597">)</span>&nbsp;<span class="op" id="5004599">==</span>&nbsp;<span class="num" id="5004602">0</span>&nbsp;<span class="op" id="5004604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5004609">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004631">name</span>&nbsp;<span class="op" id="5004636">:=</span>&nbsp;<span class="ident" id="5004639">fieldName</span><span class="op" id="5004648">(</span><span class="ident" id="5004649">f</span><span class="op" id="5004650">.</span><span class="ident" id="5004651">Type</span><span class="op" id="5004655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004660">keepField</span>&nbsp;<span class="op" id="5004670">=</span>&nbsp;<span class="ident" id="5004672">name</span>&nbsp;<span class="op" id="5004677">!=</span>&nbsp;<span class="builtintype" id="5004680">nil</span>&nbsp;<span class="op" id="5004684">&amp;&amp;</span>&nbsp;<span class="ident" id="5004687">filter</span><span class="op" id="5004693">(</span><span class="ident" id="5004694">name</span><span class="op" id="5004698">.</span><span class="ident" id="5004699">Name</span><span class="op" id="5004703">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004707">}</span>&nbsp;<span class="keyword" id="5004709">else</span>&nbsp;<span class="op" id="5004714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004719">n</span>&nbsp;<span class="op" id="5004721">:=</span>&nbsp;<span class="builtinfunc" id="5004724">len</span><span class="op" id="5004727">(</span><span class="ident" id="5004728">f</span><span class="op" id="5004729">.</span><span class="ident" id="5004730">Names</span><span class="op" id="5004735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004740">f</span><span class="op" id="5004741">.</span><span class="ident" id="5004742">Names</span>&nbsp;<span class="op" id="5004748">=</span>&nbsp;<span class="ident" id="5004750">filterIdentList</span><span class="op" id="5004765">(</span><span class="ident" id="5004766">f</span><span class="op" id="5004767">.</span><span class="ident" id="5004768">Names</span><span class="op" id="5004773">,</span>&nbsp;<span class="ident" id="5004775">filter</span><span class="op" id="5004781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004786">if</span>&nbsp;<span class="builtinfunc" id="5004789">len</span><span class="op" id="5004792">(</span><span class="ident" id="5004793">f</span><span class="op" id="5004794">.</span><span class="ident" id="5004795">Names</span><span class="op" id="5004800">)</span>&nbsp;<span class="op" id="5004802">&lt;</span>&nbsp;<span class="ident" id="5004804">n</span>&nbsp;<span class="op" id="5004806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004812">removedFields</span>&nbsp;<span class="op" id="5004826">=</span>&nbsp;<span class="builtintype" id="5004828">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004841">keepField</span>&nbsp;<span class="op" id="5004851">=</span>&nbsp;<span class="builtinfunc" id="5004853">len</span><span class="op" id="5004856">(</span><span class="ident" id="5004857">f</span><span class="op" id="5004858">.</span><span class="ident" id="5004859">Names</span><span class="op" id="5004864">)</span>&nbsp;<span class="op" id="5004866">&gt;</span>&nbsp;<span class="num" id="5004868">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004876">if</span>&nbsp;<span class="ident" id="5004879">keepField</span>&nbsp;<span class="op" id="5004889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004894">if</span>&nbsp;<span class="ident" id="5004897">export</span>&nbsp;<span class="op" id="5004904">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004910">filterType</span><span class="op" id="5004920">(</span><span class="ident" id="5004921">f</span><span class="op" id="5004922">.</span><span class="ident" id="5004923">Type</span><span class="op" id="5004927">,</span>&nbsp;<span class="ident" id="5004929">filter</span><span class="op" id="5004935">,</span>&nbsp;<span class="ident" id="5004937">export</span><span class="op" id="5004943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004953">list</span><span class="op" id="5004957">[</span><span class="ident" id="5004958">j</span><span class="op" id="5004959">]</span>&nbsp;<span class="op" id="5004961">=</span>&nbsp;<span class="ident" id="5004963">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004968">j</span><span class="op" id="5004969">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004974">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004980">if</span>&nbsp;<span class="ident" id="5004983">j</span>&nbsp;<span class="op" id="5004985">&lt;</span>&nbsp;<span class="builtinfunc" id="5004987">len</span><span class="op" id="5004990">(</span><span class="ident" id="5004991">list</span><span class="op" id="5004995">)</span>&nbsp;<span class="op" id="5004997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005001">removedFields</span>&nbsp;<span class="op" id="5005015">=</span>&nbsp;<span class="builtintype" id="5005017">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005026">fields</span><span class="op" id="5005032">.</span><span class="ident" id="5005033">List</span>&nbsp;<span class="op" id="5005038">=</span>&nbsp;<span class="ident" id="5005040">list</span><span class="op" id="5005044">[</span><span class="num" id="5005045">0</span><span class="op" id="5005046">:</span><span class="ident" id="5005047">j</span><span class="op" id="5005048">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005051">return</span><br>
<span class="lineno"></span><span class="op" id="5005058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5005061">func</span>&nbsp;<span class="ident" id="5005066">filterParamList</span><span class="op" id="5005081">(</span><span class="ident" id="5005082">fields</span>&nbsp;<span class="op" id="5005089">*</span><span class="ident" id="5005090">FieldList</span><span class="op" id="5005099">,</span>&nbsp;<span class="ident" id="5005101">filter</span>&nbsp;<span class="ident" id="5005108">Filter</span><span class="op" id="5005114">,</span>&nbsp;<span class="ident" id="5005116">export</span>&nbsp;<span class="builtintype" id="5005123">bool</span><span class="op" id="5005127">)</span>&nbsp;<span class="builtintype" id="5005129">bool</span>&nbsp;<span class="op" id="5005134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005137">if</span>&nbsp;<span class="ident" id="5005140">fields</span>&nbsp;<span class="op" id="5005147">==</span>&nbsp;<span class="builtintype" id="5005150">nil</span>&nbsp;<span class="op" id="5005154">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005158">return</span>&nbsp;<span class="builtintype" id="5005165">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005175">var</span>&nbsp;<span class="ident" id="5005179">b</span>&nbsp;<span class="builtintype" id="5005181">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005187">for</span>&nbsp;<span class="ident" id="5005191">_</span><span class="op" id="5005192">,</span>&nbsp;<span class="ident" id="5005194">f</span>&nbsp;<span class="op" id="5005196">:=</span>&nbsp;<span class="keyword" id="5005199">range</span>&nbsp;<span class="ident" id="5005205">fields</span><span class="op" id="5005211">.</span><span class="ident" id="5005212">List</span>&nbsp;<span class="op" id="5005217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005221">if</span>&nbsp;<span class="ident" id="5005224">filterType</span><span class="op" id="5005234">(</span><span class="ident" id="5005235">f</span><span class="op" id="5005236">.</span><span class="ident" id="5005237">Type</span><span class="op" id="5005241">,</span>&nbsp;<span class="ident" id="5005243">filter</span><span class="op" id="5005249">,</span>&nbsp;<span class="ident" id="5005251">export</span><span class="op" id="5005257">)</span>&nbsp;<span class="op" id="5005259">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005264">b</span>&nbsp;<span class="op" id="5005266">=</span>&nbsp;<span class="builtintype" id="5005268">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005281">return</span>&nbsp;<span class="ident" id="5005288">b</span><br>
<span class="lineno"></span><span class="op" id="5005290">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="5005293">func</span>&nbsp;<span class="ident" id="5005298">filterType</span><span class="op" id="5005308">(</span><span class="ident" id="5005309">typ</span>&nbsp;<span class="ident" id="5005313">Expr</span><span class="op" id="5005317">,</span>&nbsp;<span class="ident" id="5005319">f</span>&nbsp;<span class="ident" id="5005321">Filter</span><span class="op" id="5005327">,</span>&nbsp;<span class="ident" id="5005329">export</span>&nbsp;<span class="builtintype" id="5005336">bool</span><span class="op" id="5005340">)</span>&nbsp;<span class="builtintype" id="5005342">bool</span>&nbsp;<span class="op" id="5005347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005350">switch</span>&nbsp;<span class="ident" id="5005357">t</span>&nbsp;<span class="op" id="5005359">:=</span>&nbsp;<span class="ident" id="5005362">typ</span><span class="op" id="5005365">.</span><span class="op" id="5005366">(</span><span class="keyword" id="5005367">type</span><span class="op" id="5005371">)</span>&nbsp;<span class="op" id="5005373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005376">case</span>&nbsp;<span class="op" id="5005381">*</span><span class="ident" id="5005382">Ident</span><span class="op" id="5005387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005391">return</span>&nbsp;<span class="ident" id="5005398">f</span><span class="op" id="5005399">(</span><span class="ident" id="5005400">t</span><span class="op" id="5005401">.</span><span class="ident" id="5005402">Name</span><span class="op" id="5005406">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005409">case</span>&nbsp;<span class="op" id="5005414">*</span><span class="ident" id="5005415">ParenExpr</span><span class="op" id="5005424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005428">return</span>&nbsp;<span class="ident" id="5005435">filterType</span><span class="op" id="5005445">(</span><span class="ident" id="5005446">t</span><span class="op" id="5005447">.</span><span class="ident" id="5005448">X</span><span class="op" id="5005449">,</span>&nbsp;<span class="ident" id="5005451">f</span><span class="op" id="5005452">,</span>&nbsp;<span class="ident" id="5005454">export</span><span class="op" id="5005460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005463">case</span>&nbsp;<span class="op" id="5005468">*</span><span class="ident" id="5005469">ArrayType</span><span class="op" id="5005478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005482">return</span>&nbsp;<span class="ident" id="5005489">filterType</span><span class="op" id="5005499">(</span><span class="ident" id="5005500">t</span><span class="op" id="5005501">.</span><span class="ident" id="5005502">Elt</span><span class="op" id="5005505">,</span>&nbsp;<span class="ident" id="5005507">f</span><span class="op" id="5005508">,</span>&nbsp;<span class="ident" id="5005510">export</span><span class="op" id="5005516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005519">case</span>&nbsp;<span class="op" id="5005524">*</span><span class="ident" id="5005525">StructType</span><span class="op" id="5005535">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005539">if</span>&nbsp;<span class="ident" id="5005542">filterFieldList</span><span class="op" id="5005557">(</span><span class="ident" id="5005558">t</span><span class="op" id="5005559">.</span><span class="ident" id="5005560">Fields</span><span class="op" id="5005566">,</span>&nbsp;<span class="ident" id="5005568">f</span><span class="op" id="5005569">,</span>&nbsp;<span class="ident" id="5005571">export</span><span class="op" id="5005577">)</span>&nbsp;<span class="op" id="5005579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005584">t</span><span class="op" id="5005585">.</span><span class="ident" id="5005586">Incomplete</span>&nbsp;<span class="op" id="5005597">=</span>&nbsp;<span class="builtintype" id="5005599">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005610">return</span>&nbsp;<span class="builtinfunc" id="5005617">len</span><span class="op" id="5005620">(</span><span class="ident" id="5005621">t</span><span class="op" id="5005622">.</span><span class="ident" id="5005623">Fields</span><span class="op" id="5005629">.</span><span class="ident" id="5005630">List</span><span class="op" id="5005634">)</span>&nbsp;<span class="op" id="5005636">&gt;</span>&nbsp;<span class="num" id="5005638">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005641">case</span>&nbsp;<span class="op" id="5005646">*</span><span class="ident" id="5005647">FuncType</span><span class="op" id="5005655">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005659">b1</span>&nbsp;<span class="op" id="5005662">:=</span>&nbsp;<span class="ident" id="5005665">filterParamList</span><span class="op" id="5005680">(</span><span class="ident" id="5005681">t</span><span class="op" id="5005682">.</span><span class="ident" id="5005683">Params</span><span class="op" id="5005689">,</span>&nbsp;<span class="ident" id="5005691">f</span><span class="op" id="5005692">,</span>&nbsp;<span class="ident" id="5005694">export</span><span class="op" id="5005700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005704">b2</span>&nbsp;<span class="op" id="5005707">:=</span>&nbsp;<span class="ident" id="5005710">filterParamList</span><span class="op" id="5005725">(</span><span class="ident" id="5005726">t</span><span class="op" id="5005727">.</span><span class="ident" id="5005728">Results</span><span class="op" id="5005735">,</span>&nbsp;<span class="ident" id="5005737">f</span><span class="op" id="5005738">,</span>&nbsp;<span class="ident" id="5005740">export</span><span class="op" id="5005746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005750">return</span>&nbsp;<span class="ident" id="5005757">b1</span>&nbsp;<span class="op" id="5005760">||</span>&nbsp;<span class="ident" id="5005763">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005767">case</span>&nbsp;<span class="op" id="5005772">*</span><span class="ident" id="5005773">InterfaceType</span><span class="op" id="5005786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005790">if</span>&nbsp;<span class="ident" id="5005793">filterFieldList</span><span class="op" id="5005808">(</span><span class="ident" id="5005809">t</span><span class="op" id="5005810">.</span><span class="ident" id="5005811">Methods</span><span class="op" id="5005818">,</span>&nbsp;<span class="ident" id="5005820">f</span><span class="op" id="5005821">,</span>&nbsp;<span class="ident" id="5005823">export</span><span class="op" id="5005829">)</span>&nbsp;<span class="op" id="5005831">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005836">t</span><span class="op" id="5005837">.</span><span class="ident" id="5005838">Incomplete</span>&nbsp;<span class="op" id="5005849">=</span>&nbsp;<span class="builtintype" id="5005851">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005862">return</span>&nbsp;<span class="builtinfunc" id="5005869">len</span><span class="op" id="5005872">(</span><span class="ident" id="5005873">t</span><span class="op" id="5005874">.</span><span class="ident" id="5005875">Methods</span><span class="op" id="5005882">.</span><span class="ident" id="5005883">List</span><span class="op" id="5005887">)</span>&nbsp;<span class="op" id="5005889">&gt;</span>&nbsp;<span class="num" id="5005891">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005894">case</span>&nbsp;<span class="op" id="5005899">*</span><span class="ident" id="5005900">MapType</span><span class="op" id="5005907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005911">b1</span>&nbsp;<span class="op" id="5005914">:=</span>&nbsp;<span class="ident" id="5005917">filterType</span><span class="op" id="5005927">(</span><span class="ident" id="5005928">t</span><span class="op" id="5005929">.</span><span class="ident" id="5005930">Key</span><span class="op" id="5005933">,</span>&nbsp;<span class="ident" id="5005935">f</span><span class="op" id="5005936">,</span>&nbsp;<span class="ident" id="5005938">export</span><span class="op" id="5005944">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005948">b2</span>&nbsp;<span class="op" id="5005951">:=</span>&nbsp;<span class="ident" id="5005954">filterType</span><span class="op" id="5005964">(</span><span class="ident" id="5005965">t</span><span class="op" id="5005966">.</span><span class="ident" id="5005967">Value</span><span class="op" id="5005972">,</span>&nbsp;<span class="ident" id="5005974">f</span><span class="op" id="5005975">,</span>&nbsp;<span class="ident" id="5005977">export</span><span class="op" id="5005983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005987">return</span>&nbsp;<span class="ident" id="5005994">b1</span>&nbsp;<span class="op" id="5005997">||</span>&nbsp;<span class="ident" id="5006000">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006004">case</span>&nbsp;<span class="op" id="5006009">*</span><span class="ident" id="5006010">ChanType</span><span class="op" id="5006018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006022">return</span>&nbsp;<span class="ident" id="5006029">filterType</span><span class="op" id="5006039">(</span><span class="ident" id="5006040">t</span><span class="op" id="5006041">.</span><span class="ident" id="5006042">Value</span><span class="op" id="5006047">,</span>&nbsp;<span class="ident" id="5006049">f</span><span class="op" id="5006050">,</span>&nbsp;<span class="ident" id="5006052">export</span><span class="op" id="5006058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006061">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006064">return</span>&nbsp;<span class="builtintype" id="5006071">false</span><br>
<span class="lineno"></span><span class="op" id="5006077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006080">func</span>&nbsp;<span class="ident" id="5006085">filterSpec</span><span class="op" id="5006095">(</span><span class="ident" id="5006096">spec</span>&nbsp;<span class="ident" id="5006101">Spec</span><span class="op" id="5006105">,</span>&nbsp;<span class="ident" id="5006107">f</span>&nbsp;<span class="ident" id="5006109">Filter</span><span class="op" id="5006115">,</span>&nbsp;<span class="ident" id="5006117">export</span>&nbsp;<span class="builtintype" id="5006124">bool</span><span class="op" id="5006128">)</span>&nbsp;<span class="builtintype" id="5006130">bool</span>&nbsp;<span class="op" id="5006135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006138">switch</span>&nbsp;<span class="ident" id="5006145">s</span>&nbsp;<span class="op" id="5006147">:=</span>&nbsp;<span class="ident" id="5006150">spec</span><span class="op" id="5006154">.</span><span class="op" id="5006155">(</span><span class="keyword" id="5006156">type</span><span class="op" id="5006160">)</span>&nbsp;<span class="op" id="5006162">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006165">case</span>&nbsp;<span class="op" id="5006170">*</span><span class="ident" id="5006171">ValueSpec</span><span class="op" id="5006180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006184">s</span><span class="op" id="5006185">.</span><span class="ident" id="5006186">Names</span>&nbsp;<span class="op" id="5006192">=</span>&nbsp;<span class="ident" id="5006194">filterIdentList</span><span class="op" id="5006209">(</span><span class="ident" id="5006210">s</span><span class="op" id="5006211">.</span><span class="ident" id="5006212">Names</span><span class="op" id="5006217">,</span>&nbsp;<span class="ident" id="5006219">f</span><span class="op" id="5006220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006224">if</span>&nbsp;<span class="builtinfunc" id="5006227">len</span><span class="op" id="5006230">(</span><span class="ident" id="5006231">s</span><span class="op" id="5006232">.</span><span class="ident" id="5006233">Names</span><span class="op" id="5006238">)</span>&nbsp;<span class="op" id="5006240">&gt;</span>&nbsp;<span class="num" id="5006242">0</span>&nbsp;<span class="op" id="5006244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006249">if</span>&nbsp;<span class="ident" id="5006252">export</span>&nbsp;<span class="op" id="5006259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006265">filterType</span><span class="op" id="5006275">(</span><span class="ident" id="5006276">s</span><span class="op" id="5006277">.</span><span class="ident" id="5006278">Type</span><span class="op" id="5006282">,</span>&nbsp;<span class="ident" id="5006284">f</span><span class="op" id="5006285">,</span>&nbsp;<span class="ident" id="5006287">export</span><span class="op" id="5006293">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006303">return</span>&nbsp;<span class="builtintype" id="5006310">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006320">case</span>&nbsp;<span class="op" id="5006325">*</span><span class="ident" id="5006326">TypeSpec</span><span class="op" id="5006334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006338">if</span>&nbsp;<span class="ident" id="5006341">f</span><span class="op" id="5006342">(</span><span class="ident" id="5006343">s</span><span class="op" id="5006344">.</span><span class="ident" id="5006345">Name</span><span class="op" id="5006349">.</span><span class="ident" id="5006350">Name</span><span class="op" id="5006354">)</span>&nbsp;<span class="op" id="5006356">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006361">if</span>&nbsp;<span class="ident" id="5006364">export</span>&nbsp;<span class="op" id="5006371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006377">filterType</span><span class="op" id="5006387">(</span><span class="ident" id="5006388">s</span><span class="op" id="5006389">.</span><span class="ident" id="5006390">Type</span><span class="op" id="5006394">,</span>&nbsp;<span class="ident" id="5006396">f</span><span class="op" id="5006397">,</span>&nbsp;<span class="ident" id="5006399">export</span><span class="op" id="5006405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006415">return</span>&nbsp;<span class="builtintype" id="5006422">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006429">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006433">if</span>&nbsp;<span class="op" id="5006436">!</span><span class="ident" id="5006437">export</span>&nbsp;<span class="op" id="5006444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006449">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006497">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006544">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006555">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5006601">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006629">return</span>&nbsp;<span class="ident" id="5006636">filterType</span><span class="op" id="5006646">(</span><span class="ident" id="5006647">s</span><span class="op" id="5006648">.</span><span class="ident" id="5006649">Type</span><span class="op" id="5006653">,</span>&nbsp;<span class="ident" id="5006655">f</span><span class="op" id="5006656">,</span>&nbsp;<span class="ident" id="5006658">export</span><span class="op" id="5006664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006674">return</span>&nbsp;<span class="builtintype" id="5006681">false</span><br>
<span class="lineno">185</span><span class="op" id="5006687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006690">func</span>&nbsp;<span class="ident" id="5006695">filterSpecList</span><span class="op" id="5006709">(</span><span class="ident" id="5006710">list</span>&nbsp;<span class="op" id="5006715">[</span><span class="op" id="5006716">]</span><span class="ident" id="5006717">Spec</span><span class="op" id="5006721">,</span>&nbsp;<span class="ident" id="5006723">f</span>&nbsp;<span class="ident" id="5006725">Filter</span><span class="op" id="5006731">,</span>&nbsp;<span class="ident" id="5006733">export</span>&nbsp;<span class="builtintype" id="5006740">bool</span><span class="op" id="5006744">)</span>&nbsp;<span class="op" id="5006746">[</span><span class="op" id="5006747">]</span><span class="ident" id="5006748">Spec</span>&nbsp;<span class="op" id="5006753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006756">j</span>&nbsp;<span class="op" id="5006758">:=</span>&nbsp;<span class="num" id="5006761">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006764">for</span>&nbsp;<span class="ident" id="5006768">_</span><span class="op" id="5006769">,</span>&nbsp;<span class="ident" id="5006771">s</span>&nbsp;<span class="op" id="5006773">:=</span>&nbsp;<span class="keyword" id="5006776">range</span>&nbsp;<span class="ident" id="5006782">list</span>&nbsp;<span class="op" id="5006787">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006791">if</span>&nbsp;<span class="ident" id="5006794">filterSpec</span><span class="op" id="5006804">(</span><span class="ident" id="5006805">s</span><span class="op" id="5006806">,</span>&nbsp;<span class="ident" id="5006808">f</span><span class="op" id="5006809">,</span>&nbsp;<span class="ident" id="5006811">export</span><span class="op" id="5006817">)</span>&nbsp;<span class="op" id="5006819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006824">list</span><span class="op" id="5006828">[</span><span class="ident" id="5006829">j</span><span class="op" id="5006830">]</span>&nbsp;<span class="op" id="5006832">=</span>&nbsp;<span class="ident" id="5006834">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006839">j</span><span class="op" id="5006840">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006848">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006851">return</span>&nbsp;<span class="ident" id="5006858">list</span><span class="op" id="5006862">[</span><span class="num" id="5006863">0</span><span class="op" id="5006864">:</span><span class="ident" id="5006865">j</span><span class="op" id="5006866">]</span><br>
<span class="lineno"></span><span class="op" id="5006868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5006871">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5006941">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="5007010">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="5007077">//</span><br>
<span class="lineno"></span><span class="comment" id="5007080">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5007150">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5007192">//</span><br>
<span class="lineno">205</span><span class="keyword" id="5007195">func</span>&nbsp;<span class="ident" id="5007200">FilterDecl</span><span class="op" id="5007210">(</span><span class="ident" id="5007211">decl</span>&nbsp;<span class="ident" id="5007216">Decl</span><span class="op" id="5007220">,</span>&nbsp;<span class="ident" id="5007222">f</span>&nbsp;<span class="ident" id="5007224">Filter</span><span class="op" id="5007230">)</span>&nbsp;<span class="builtintype" id="5007232">bool</span>&nbsp;<span class="op" id="5007237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007240">return</span>&nbsp;<span class="ident" id="5007247">filterDecl</span><span class="op" id="5007257">(</span><span class="ident" id="5007258">decl</span><span class="op" id="5007262">,</span>&nbsp;<span class="ident" id="5007264">f</span><span class="op" id="5007265">,</span>&nbsp;<span class="builtintype" id="5007267">false</span><span class="op" id="5007272">)</span><br>
<span class="lineno"></span><span class="op" id="5007274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007277">func</span>&nbsp;<span class="ident" id="5007282">filterDecl</span><span class="op" id="5007292">(</span><span class="ident" id="5007293">decl</span>&nbsp;<span class="ident" id="5007298">Decl</span><span class="op" id="5007302">,</span>&nbsp;<span class="ident" id="5007304">f</span>&nbsp;<span class="ident" id="5007306">Filter</span><span class="op" id="5007312">,</span>&nbsp;<span class="ident" id="5007314">export</span>&nbsp;<span class="builtintype" id="5007321">bool</span><span class="op" id="5007325">)</span>&nbsp;<span class="builtintype" id="5007327">bool</span>&nbsp;<span class="op" id="5007332">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007335">switch</span>&nbsp;<span class="ident" id="5007342">d</span>&nbsp;<span class="op" id="5007344">:=</span>&nbsp;<span class="ident" id="5007347">decl</span><span class="op" id="5007351">.</span><span class="op" id="5007352">(</span><span class="keyword" id="5007353">type</span><span class="op" id="5007357">)</span>&nbsp;<span class="op" id="5007359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007362">case</span>&nbsp;<span class="op" id="5007367">*</span><span class="ident" id="5007368">GenDecl</span><span class="op" id="5007375">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007379">d</span><span class="op" id="5007380">.</span><span class="ident" id="5007381">Specs</span>&nbsp;<span class="op" id="5007387">=</span>&nbsp;<span class="ident" id="5007389">filterSpecList</span><span class="op" id="5007403">(</span><span class="ident" id="5007404">d</span><span class="op" id="5007405">.</span><span class="ident" id="5007406">Specs</span><span class="op" id="5007411">,</span>&nbsp;<span class="ident" id="5007413">f</span><span class="op" id="5007414">,</span>&nbsp;<span class="ident" id="5007416">export</span><span class="op" id="5007422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007426">return</span>&nbsp;<span class="builtinfunc" id="5007433">len</span><span class="op" id="5007436">(</span><span class="ident" id="5007437">d</span><span class="op" id="5007438">.</span><span class="ident" id="5007439">Specs</span><span class="op" id="5007444">)</span>&nbsp;<span class="op" id="5007446">&gt;</span>&nbsp;<span class="num" id="5007448">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007451">case</span>&nbsp;<span class="op" id="5007456">*</span><span class="ident" id="5007457">FuncDecl</span><span class="op" id="5007465">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007469">return</span>&nbsp;<span class="ident" id="5007476">f</span><span class="op" id="5007477">(</span><span class="ident" id="5007478">d</span><span class="op" id="5007479">.</span><span class="ident" id="5007480">Name</span><span class="op" id="5007484">.</span><span class="ident" id="5007485">Name</span><span class="op" id="5007489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007495">return</span>&nbsp;<span class="builtintype" id="5007502">false</span><br>
<span class="lineno"></span><span class="op" id="5007508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="5007511">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="5007578">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5007643">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5007711">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="5007781">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="5007848">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="5007867">//</span><br>
<span class="lineno"></span><span class="comment" id="5007870">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="5007937">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5007990">//</span><br>
<span class="lineno">230</span><span class="keyword" id="5007993">func</span>&nbsp;<span class="ident" id="5007998">FilterFile</span><span class="op" id="5008008">(</span><span class="ident" id="5008009">src</span>&nbsp;<span class="op" id="5008013">*</span><span class="ident" id="5008014">File</span><span class="op" id="5008018">,</span>&nbsp;<span class="ident" id="5008020">f</span>&nbsp;<span class="ident" id="5008022">Filter</span><span class="op" id="5008028">)</span>&nbsp;<span class="builtintype" id="5008030">bool</span>&nbsp;<span class="op" id="5008035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008038">return</span>&nbsp;<span class="ident" id="5008045">filterFile</span><span class="op" id="5008055">(</span><span class="ident" id="5008056">src</span><span class="op" id="5008059">,</span>&nbsp;<span class="ident" id="5008061">f</span><span class="op" id="5008062">,</span>&nbsp;<span class="builtintype" id="5008064">false</span><span class="op" id="5008069">)</span><br>
<span class="lineno"></span><span class="op" id="5008071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5008074">func</span>&nbsp;<span class="ident" id="5008079">filterFile</span><span class="op" id="5008089">(</span><span class="ident" id="5008090">src</span>&nbsp;<span class="op" id="5008094">*</span><span class="ident" id="5008095">File</span><span class="op" id="5008099">,</span>&nbsp;<span class="ident" id="5008101">f</span>&nbsp;<span class="ident" id="5008103">Filter</span><span class="op" id="5008109">,</span>&nbsp;<span class="ident" id="5008111">export</span>&nbsp;<span class="builtintype" id="5008118">bool</span><span class="op" id="5008122">)</span>&nbsp;<span class="builtintype" id="5008124">bool</span>&nbsp;<span class="op" id="5008129">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008132">j</span>&nbsp;<span class="op" id="5008134">:=</span>&nbsp;<span class="num" id="5008137">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008140">for</span>&nbsp;<span class="ident" id="5008144">_</span><span class="op" id="5008145">,</span>&nbsp;<span class="ident" id="5008147">d</span>&nbsp;<span class="op" id="5008149">:=</span>&nbsp;<span class="keyword" id="5008152">range</span>&nbsp;<span class="ident" id="5008158">src</span><span class="op" id="5008161">.</span><span class="ident" id="5008162">Decls</span>&nbsp;<span class="op" id="5008168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008172">if</span>&nbsp;<span class="ident" id="5008175">filterDecl</span><span class="op" id="5008185">(</span><span class="ident" id="5008186">d</span><span class="op" id="5008187">,</span>&nbsp;<span class="ident" id="5008189">f</span><span class="op" id="5008190">,</span>&nbsp;<span class="ident" id="5008192">export</span><span class="op" id="5008198">)</span>&nbsp;<span class="op" id="5008200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008205">src</span><span class="op" id="5008208">.</span><span class="ident" id="5008209">Decls</span><span class="op" id="5008214">[</span><span class="ident" id="5008215">j</span><span class="op" id="5008216">]</span>&nbsp;<span class="op" id="5008218">=</span>&nbsp;<span class="ident" id="5008220">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008225">j</span><span class="op" id="5008226">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008237">src</span><span class="op" id="5008240">.</span><span class="ident" id="5008241">Decls</span>&nbsp;<span class="op" id="5008247">=</span>&nbsp;<span class="ident" id="5008249">src</span><span class="op" id="5008252">.</span><span class="ident" id="5008253">Decls</span><span class="op" id="5008258">[</span><span class="num" id="5008259">0</span><span class="op" id="5008260">:</span><span class="ident" id="5008261">j</span><span class="op" id="5008262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008265">return</span>&nbsp;<span class="ident" id="5008272">j</span>&nbsp;<span class="op" id="5008274">&gt;</span>&nbsp;<span class="num" id="5008276">0</span><br>
<span class="lineno"></span><span class="op" id="5008278">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="5008281">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="5008350">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5008419">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="5008487">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="5008557">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5008627">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="5008699">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="5008708">//</span><br>
<span class="lineno"></span><span class="comment" id="5008711">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="5008781">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="5008834">//</span><br>
<span class="lineno"></span><span class="keyword" id="5008837">func</span>&nbsp;<span class="ident" id="5008842">FilterPackage</span><span class="op" id="5008855">(</span><span class="ident" id="5008856">pkg</span>&nbsp;<span class="op" id="5008860">*</span><span class="ident" id="5008861">Package</span><span class="op" id="5008868">,</span>&nbsp;<span class="ident" id="5008870">f</span>&nbsp;<span class="ident" id="5008872">Filter</span><span class="op" id="5008878">)</span>&nbsp;<span class="builtintype" id="5008880">bool</span>&nbsp;<span class="op" id="5008885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008888">return</span>&nbsp;<span class="ident" id="5008895">filterPackage</span><span class="op" id="5008908">(</span><span class="ident" id="5008909">pkg</span><span class="op" id="5008912">,</span>&nbsp;<span class="ident" id="5008914">f</span><span class="op" id="5008915">,</span>&nbsp;<span class="builtintype" id="5008917">false</span><span class="op" id="5008922">)</span><br>
<span class="lineno"></span><span class="op" id="5008924">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="5008927">func</span>&nbsp;<span class="ident" id="5008932">filterPackage</span><span class="op" id="5008945">(</span><span class="ident" id="5008946">pkg</span>&nbsp;<span class="op" id="5008950">*</span><span class="ident" id="5008951">Package</span><span class="op" id="5008958">,</span>&nbsp;<span class="ident" id="5008960">f</span>&nbsp;<span class="ident" id="5008962">Filter</span><span class="op" id="5008968">,</span>&nbsp;<span class="ident" id="5008970">export</span>&nbsp;<span class="builtintype" id="5008977">bool</span><span class="op" id="5008981">)</span>&nbsp;<span class="builtintype" id="5008983">bool</span>&nbsp;<span class="op" id="5008988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008991">hasDecls</span>&nbsp;<span class="op" id="5009000">:=</span>&nbsp;<span class="builtintype" id="5009003">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009010">for</span>&nbsp;<span class="ident" id="5009014">_</span><span class="op" id="5009015">,</span>&nbsp;<span class="ident" id="5009017">src</span>&nbsp;<span class="op" id="5009021">:=</span>&nbsp;<span class="keyword" id="5009024">range</span>&nbsp;<span class="ident" id="5009030">pkg</span><span class="op" id="5009033">.</span><span class="ident" id="5009034">Files</span>&nbsp;<span class="op" id="5009040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009044">if</span>&nbsp;<span class="ident" id="5009047">filterFile</span><span class="op" id="5009057">(</span><span class="ident" id="5009058">src</span><span class="op" id="5009061">,</span>&nbsp;<span class="ident" id="5009063">f</span><span class="op" id="5009064">,</span>&nbsp;<span class="ident" id="5009066">export</span><span class="op" id="5009072">)</span>&nbsp;<span class="op" id="5009074">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009079">hasDecls</span>&nbsp;<span class="op" id="5009088">=</span>&nbsp;<span class="builtintype" id="5009090">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009103">return</span>&nbsp;<span class="ident" id="5009110">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="5009119">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="5009122">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5009202">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009231">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="5009297">type</span>&nbsp;<span class="ident" id="5009302">MergeMode</span>&nbsp;<span class="builtintype" id="5009312">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5009318">const</span>&nbsp;<span class="op" id="5009324">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009327">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009385">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="5009406">MergeMode</span>&nbsp;<span class="op" id="5009416">=</span>&nbsp;<span class="num" id="5009418">1</span>&nbsp;<span class="op" id="5009420">&lt;&lt;</span>&nbsp;<span class="ident" id="5009423">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009429">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009490">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009537">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009565">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009621">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="5009644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009647">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5009713">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5009780">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="5009824">//</span><br>
<span class="lineno"></span><span class="keyword" id="5009827">func</span>&nbsp;<span class="ident" id="5009832">nameOf</span><span class="op" id="5009838">(</span><span class="ident" id="5009839">f</span>&nbsp;<span class="op" id="5009841">*</span><span class="ident" id="5009842">FuncDecl</span><span class="op" id="5009850">)</span>&nbsp;<span class="builtintype" id="5009852">string</span>&nbsp;<span class="op" id="5009859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009862">if</span>&nbsp;<span class="ident" id="5009865">r</span>&nbsp;<span class="op" id="5009867">:=</span>&nbsp;<span class="ident" id="5009870">f</span><span class="op" id="5009871">.</span><span class="ident" id="5009872">Recv</span><span class="op" id="5009876">;</span>&nbsp;<span class="ident" id="5009878">r</span>&nbsp;<span class="op" id="5009880">!=</span>&nbsp;<span class="builtintype" id="5009883">nil</span>&nbsp;<span class="op" id="5009887">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5009890">len</span><span class="op" id="5009893">(</span><span class="ident" id="5009894">r</span><span class="op" id="5009895">.</span><span class="ident" id="5009896">List</span><span class="op" id="5009900">)</span>&nbsp;<span class="op" id="5009902">==</span>&nbsp;<span class="num" id="5009905">1</span>&nbsp;<span class="op" id="5009907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009911">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009958">t</span>&nbsp;<span class="op" id="5009960">:=</span>&nbsp;<span class="ident" id="5009963">r</span><span class="op" id="5009964">.</span><span class="ident" id="5009965">List</span><span class="op" id="5009969">[</span><span class="num" id="5009970">0</span><span class="op" id="5009971">]</span><span class="op" id="5009972">.</span><span class="ident" id="5009973">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5009980">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010020">if</span>&nbsp;<span class="ident" id="5010023">p</span><span class="op" id="5010024">,</span>&nbsp;<span class="ident" id="5010026">_</span>&nbsp;<span class="op" id="5010028">:=</span>&nbsp;<span class="ident" id="5010031">t</span><span class="op" id="5010032">.</span><span class="op" id="5010033">(</span><span class="op" id="5010034">*</span><span class="ident" id="5010035">StarExpr</span><span class="op" id="5010043">)</span><span class="op" id="5010044">;</span>&nbsp;<span class="ident" id="5010046">p</span>&nbsp;<span class="op" id="5010048">!=</span>&nbsp;<span class="builtintype" id="5010051">nil</span>&nbsp;<span class="op" id="5010055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010060">t</span>&nbsp;<span class="op" id="5010062">=</span>&nbsp;<span class="ident" id="5010064">p</span><span class="op" id="5010065">.</span><span class="ident" id="5010066">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5010070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010074">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010117">if</span>&nbsp;<span class="ident" id="5010120">p</span><span class="op" id="5010121">,</span>&nbsp;<span class="ident" id="5010123">_</span>&nbsp;<span class="op" id="5010125">:=</span>&nbsp;<span class="ident" id="5010128">t</span><span class="op" id="5010129">.</span><span class="op" id="5010130">(</span><span class="op" id="5010131">*</span><span class="ident" id="5010132">Ident</span><span class="op" id="5010137">)</span><span class="op" id="5010138">;</span>&nbsp;<span class="ident" id="5010140">p</span>&nbsp;<span class="op" id="5010142">!=</span>&nbsp;<span class="builtintype" id="5010145">nil</span>&nbsp;<span class="op" id="5010149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010154">return</span>&nbsp;<span class="ident" id="5010161">p</span><span class="op" id="5010162">.</span><span class="ident" id="5010163">Name</span>&nbsp;<span class="op" id="5010168">+</span>&nbsp;<span class="string" id="5010170">&#34;.&#34;</span>&nbsp;<span class="op" id="5010174">+</span>&nbsp;<span class="ident" id="5010176">f</span><span class="op" id="5010177">.</span><span class="ident" id="5010178">Name</span><span class="op" id="5010182">.</span><span class="ident" id="5010183">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5010190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010194">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5010234">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010237">return</span>&nbsp;<span class="ident" id="5010244">f</span><span class="op" id="5010245">.</span><span class="ident" id="5010246">Name</span><span class="op" id="5010250">.</span><span class="ident" id="5010251">Name</span><br>
<span class="lineno"></span><span class="op" id="5010256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5010259">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5010330">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="5010405">//</span><br>
<span class="lineno"></span><span class="keyword" id="5010408">var</span>&nbsp;<span class="ident" id="5010412">separator</span>&nbsp;<span class="op" id="5010422">=</span>&nbsp;<span class="op" id="5010424">&amp;</span><span class="ident" id="5010425">Comment</span><span class="op" id="5010432">{</span><span class="ident" id="5010433">token</span><span class="op" id="5010438">.</span><span class="ident" id="5010439">NoPos</span><span class="op" id="5010444">,</span>&nbsp;<span class="string" id="5010446">&#34;//&#34;</span><span class="op" id="5010450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5010453">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5010520">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="5010594">//</span><br>
<span class="lineno"></span><span class="keyword" id="5010597">func</span>&nbsp;<span class="ident" id="5010602">MergePackageFiles</span><span class="op" id="5010619">(</span><span class="ident" id="5010620">pkg</span>&nbsp;<span class="op" id="5010624">*</span><span class="ident" id="5010625">Package</span><span class="op" id="5010632">,</span>&nbsp;<span class="ident" id="5010634">mode</span>&nbsp;<span class="ident" id="5010639">MergeMode</span><span class="op" id="5010648">)</span>&nbsp;<span class="op" id="5010650">*</span><span class="ident" id="5010651">File</span>&nbsp;<span class="op" id="5010656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010659">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010730">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010801">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010865">ndocs</span>&nbsp;<span class="op" id="5010871">:=</span>&nbsp;<span class="num" id="5010874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010877">ncomments</span>&nbsp;<span class="op" id="5010887">:=</span>&nbsp;<span class="num" id="5010890">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010893">ndecls</span>&nbsp;<span class="op" id="5010900">:=</span>&nbsp;<span class="num" id="5010903">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010906">filenames</span>&nbsp;<span class="op" id="5010916">:=</span>&nbsp;<span class="builtinfunc" id="5010919">make</span><span class="op" id="5010923">(</span><span class="op" id="5010924">[</span><span class="op" id="5010925">]</span><span class="builtintype" id="5010926">string</span><span class="op" id="5010932">,</span>&nbsp;<span class="builtinfunc" id="5010934">len</span><span class="op" id="5010937">(</span><span class="ident" id="5010938">pkg</span><span class="op" id="5010941">.</span><span class="ident" id="5010942">Files</span><span class="op" id="5010947">)</span><span class="op" id="5010948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010951">i</span>&nbsp;<span class="op" id="5010953">:=</span>&nbsp;<span class="num" id="5010956">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010959">for</span>&nbsp;<span class="ident" id="5010963">filename</span><span class="op" id="5010971">,</span>&nbsp;<span class="ident" id="5010973">f</span>&nbsp;<span class="op" id="5010975">:=</span>&nbsp;<span class="keyword" id="5010978">range</span>&nbsp;<span class="ident" id="5010984">pkg</span><span class="op" id="5010987">.</span><span class="ident" id="5010988">Files</span>&nbsp;<span class="op" id="5010994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010998">filenames</span><span class="op" id="5011007">[</span><span class="ident" id="5011008">i</span><span class="op" id="5011009">]</span>&nbsp;<span class="op" id="5011011">=</span>&nbsp;<span class="ident" id="5011013">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011024">i</span><span class="op" id="5011025">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011030">if</span>&nbsp;<span class="ident" id="5011033">f</span><span class="op" id="5011034">.</span><span class="ident" id="5011035">Doc</span>&nbsp;<span class="op" id="5011039">!=</span>&nbsp;<span class="builtintype" id="5011042">nil</span>&nbsp;<span class="op" id="5011046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011051">ndocs</span>&nbsp;<span class="op" id="5011057">+=</span>&nbsp;<span class="builtinfunc" id="5011060">len</span><span class="op" id="5011063">(</span><span class="ident" id="5011064">f</span><span class="op" id="5011065">.</span><span class="ident" id="5011066">Doc</span><span class="op" id="5011069">.</span><span class="ident" id="5011070">List</span><span class="op" id="5011074">)</span>&nbsp;<span class="op" id="5011076">+</span>&nbsp;<span class="num" id="5011078">1</span>&nbsp;<span class="comment" id="5011080">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011106">ncomments</span>&nbsp;<span class="op" id="5011116">+=</span>&nbsp;<span class="builtinfunc" id="5011119">len</span><span class="op" id="5011122">(</span><span class="ident" id="5011123">f</span><span class="op" id="5011124">.</span><span class="ident" id="5011125">Comments</span><span class="op" id="5011133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011137">ndecls</span>&nbsp;<span class="op" id="5011144">+=</span>&nbsp;<span class="builtinfunc" id="5011147">len</span><span class="op" id="5011150">(</span><span class="ident" id="5011151">f</span><span class="op" id="5011152">.</span><span class="ident" id="5011153">Decls</span><span class="op" id="5011158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011164">sort</span><span class="op" id="5011168">.</span><span class="ident" id="5011169">Strings</span><span class="op" id="5011176">(</span><span class="ident" id="5011177">filenames</span><span class="op" id="5011186">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011190">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011256">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011323">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011390">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011456">var</span>&nbsp;<span class="ident" id="5011460">doc</span>&nbsp;<span class="op" id="5011464">*</span><span class="ident" id="5011465">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011479">var</span>&nbsp;<span class="ident" id="5011483">pos</span>&nbsp;<span class="ident" id="5011487">token</span><span class="op" id="5011492">.</span><span class="ident" id="5011493">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011498">if</span>&nbsp;<span class="ident" id="5011501">ndocs</span>&nbsp;<span class="op" id="5011507">&gt;</span>&nbsp;<span class="num" id="5011509">0</span>&nbsp;<span class="op" id="5011511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011515">list</span>&nbsp;<span class="op" id="5011520">:=</span>&nbsp;<span class="builtinfunc" id="5011523">make</span><span class="op" id="5011527">(</span><span class="op" id="5011528">[</span><span class="op" id="5011529">]</span><span class="op" id="5011530">*</span><span class="ident" id="5011531">Comment</span><span class="op" id="5011538">,</span>&nbsp;<span class="ident" id="5011540">ndocs</span><span class="op" id="5011545">-</span><span class="num" id="5011546">1</span><span class="op" id="5011547">)</span>&nbsp;<span class="comment" id="5011549">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011590">i</span>&nbsp;<span class="op" id="5011592">:=</span>&nbsp;<span class="num" id="5011595">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011599">for</span>&nbsp;<span class="ident" id="5011603">_</span><span class="op" id="5011604">,</span>&nbsp;<span class="ident" id="5011606">filename</span>&nbsp;<span class="op" id="5011615">:=</span>&nbsp;<span class="keyword" id="5011618">range</span>&nbsp;<span class="ident" id="5011624">filenames</span>&nbsp;<span class="op" id="5011634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011639">f</span>&nbsp;<span class="op" id="5011641">:=</span>&nbsp;<span class="ident" id="5011644">pkg</span><span class="op" id="5011647">.</span><span class="ident" id="5011648">Files</span><span class="op" id="5011653">[</span><span class="ident" id="5011654">filename</span><span class="op" id="5011662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011667">if</span>&nbsp;<span class="ident" id="5011670">f</span><span class="op" id="5011671">.</span><span class="ident" id="5011672">Doc</span>&nbsp;<span class="op" id="5011676">!=</span>&nbsp;<span class="builtintype" id="5011679">nil</span>&nbsp;<span class="op" id="5011683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011689">if</span>&nbsp;<span class="ident" id="5011692">i</span>&nbsp;<span class="op" id="5011694">&gt;</span>&nbsp;<span class="num" id="5011696">0</span>&nbsp;<span class="op" id="5011698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011705">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011749">list</span><span class="op" id="5011753">[</span><span class="ident" id="5011754">i</span><span class="op" id="5011755">]</span>&nbsp;<span class="op" id="5011757">=</span>&nbsp;<span class="ident" id="5011759">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011774">i</span><span class="op" id="5011775">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011788">for</span>&nbsp;<span class="ident" id="5011792">_</span><span class="op" id="5011793">,</span>&nbsp;<span class="ident" id="5011795">c</span>&nbsp;<span class="op" id="5011797">:=</span>&nbsp;<span class="keyword" id="5011800">range</span>&nbsp;<span class="ident" id="5011806">f</span><span class="op" id="5011807">.</span><span class="ident" id="5011808">Doc</span><span class="op" id="5011811">.</span><span class="ident" id="5011812">List</span>&nbsp;<span class="op" id="5011817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011824">list</span><span class="op" id="5011828">[</span><span class="ident" id="5011829">i</span><span class="op" id="5011830">]</span>&nbsp;<span class="op" id="5011832">=</span>&nbsp;<span class="ident" id="5011834">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011841">i</span><span class="op" id="5011842">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011855">if</span>&nbsp;<span class="ident" id="5011858">f</span><span class="op" id="5011859">.</span><span class="ident" id="5011860">Package</span>&nbsp;<span class="op" id="5011868">&gt;</span>&nbsp;<span class="ident" id="5011870">pos</span>&nbsp;<span class="op" id="5011874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011881">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011933">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011987">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012002">pos</span>&nbsp;<span class="op" id="5012006">=</span>&nbsp;<span class="ident" id="5012008">f</span><span class="op" id="5012009">.</span><span class="ident" id="5012010">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012031">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012035">doc</span>&nbsp;<span class="op" id="5012039">=</span>&nbsp;<span class="op" id="5012041">&amp;</span><span class="ident" id="5012042">CommentGroup</span><span class="op" id="5012054">{</span><span class="ident" id="5012055">list</span><span class="op" id="5012059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5012062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012066">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012115">var</span>&nbsp;<span class="ident" id="5012119">decls</span>&nbsp;<span class="op" id="5012125">[</span><span class="op" id="5012126">]</span><span class="ident" id="5012127">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012133">if</span>&nbsp;<span class="ident" id="5012136">ndecls</span>&nbsp;<span class="op" id="5012143">&gt;</span>&nbsp;<span class="num" id="5012145">0</span>&nbsp;<span class="op" id="5012147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012151">decls</span>&nbsp;<span class="op" id="5012157">=</span>&nbsp;<span class="builtinfunc" id="5012159">make</span><span class="op" id="5012163">(</span><span class="op" id="5012164">[</span><span class="op" id="5012165">]</span><span class="ident" id="5012166">Decl</span><span class="op" id="5012170">,</span>&nbsp;<span class="ident" id="5012172">ndecls</span><span class="op" id="5012178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012182">funcs</span>&nbsp;<span class="op" id="5012188">:=</span>&nbsp;<span class="builtinfunc" id="5012191">make</span><span class="op" id="5012195">(</span><span class="keyword" id="5012196">map</span><span class="op" id="5012199">[</span><span class="builtintype" id="5012200">string</span><span class="op" id="5012206">]</span><span class="builtintype" id="5012207">int</span><span class="op" id="5012210">)</span>&nbsp;<span class="comment" id="5012212">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012249">i</span>&nbsp;<span class="op" id="5012251">:=</span>&nbsp;<span class="num" id="5012254">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012279">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012298">n</span>&nbsp;<span class="op" id="5012300">:=</span>&nbsp;<span class="num" id="5012303">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012328">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012360">for</span>&nbsp;<span class="ident" id="5012364">_</span><span class="op" id="5012365">,</span>&nbsp;<span class="ident" id="5012367">filename</span>&nbsp;<span class="op" id="5012376">:=</span>&nbsp;<span class="keyword" id="5012379">range</span>&nbsp;<span class="ident" id="5012385">filenames</span>&nbsp;<span class="op" id="5012395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012400">f</span>&nbsp;<span class="op" id="5012402">:=</span>&nbsp;<span class="ident" id="5012405">pkg</span><span class="op" id="5012408">.</span><span class="ident" id="5012409">Files</span><span class="op" id="5012414">[</span><span class="ident" id="5012415">filename</span><span class="op" id="5012423">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012428">for</span>&nbsp;<span class="ident" id="5012432">_</span><span class="op" id="5012433">,</span>&nbsp;<span class="ident" id="5012435">d</span>&nbsp;<span class="op" id="5012437">:=</span>&nbsp;<span class="keyword" id="5012440">range</span>&nbsp;<span class="ident" id="5012446">f</span><span class="op" id="5012447">.</span><span class="ident" id="5012448">Decls</span>&nbsp;<span class="op" id="5012454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012460">if</span>&nbsp;<span class="ident" id="5012463">mode</span><span class="op" id="5012467">&amp;</span><span class="ident" id="5012468">FilterFuncDuplicates</span>&nbsp;<span class="op" id="5012489">!=</span>&nbsp;<span class="num" id="5012492">0</span>&nbsp;<span class="op" id="5012494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012501">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012552">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012602">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012650">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012700">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012753">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012761">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012811">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012862">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012915">if</span>&nbsp;<span class="ident" id="5012918">f</span><span class="op" id="5012919">,</span>&nbsp;<span class="ident" id="5012921">isFun</span>&nbsp;<span class="op" id="5012927">:=</span>&nbsp;<span class="ident" id="5012930">d</span><span class="op" id="5012931">.</span><span class="op" id="5012932">(</span><span class="op" id="5012933">*</span><span class="ident" id="5012934">FuncDecl</span><span class="op" id="5012942">)</span><span class="op" id="5012943">;</span>&nbsp;<span class="ident" id="5012945">isFun</span>&nbsp;<span class="op" id="5012951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012959">name</span>&nbsp;<span class="op" id="5012964">:=</span>&nbsp;<span class="ident" id="5012967">nameOf</span><span class="op" id="5012973">(</span><span class="ident" id="5012974">f</span><span class="op" id="5012975">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012983">if</span>&nbsp;<span class="ident" id="5012986">j</span><span class="op" id="5012987">,</span>&nbsp;<span class="ident" id="5012989">exists</span>&nbsp;<span class="op" id="5012996">:=</span>&nbsp;<span class="ident" id="5012999">funcs</span><span class="op" id="5013004">[</span><span class="ident" id="5013005">name</span><span class="op" id="5013009">]</span><span class="op" id="5013010">;</span>&nbsp;<span class="ident" id="5013012">exists</span>&nbsp;<span class="op" id="5013019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013028">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013064">if</span>&nbsp;<span class="ident" id="5013067">decls</span><span class="op" id="5013072">[</span><span class="ident" id="5013073">j</span><span class="op" id="5013074">]</span>&nbsp;<span class="op" id="5013076">!=</span>&nbsp;<span class="builtintype" id="5013079">nil</span>&nbsp;<span class="op" id="5013083">&amp;&amp;</span>&nbsp;<span class="ident" id="5013086">decls</span><span class="op" id="5013091">[</span><span class="ident" id="5013092">j</span><span class="op" id="5013093">]</span><span class="op" id="5013094">.</span><span class="op" id="5013095">(</span><span class="op" id="5013096">*</span><span class="ident" id="5013097">FuncDecl</span><span class="op" id="5013105">)</span><span class="op" id="5013106">.</span><span class="ident" id="5013107">Doc</span>&nbsp;<span class="op" id="5013111">==</span>&nbsp;<span class="builtintype" id="5013114">nil</span>&nbsp;<span class="op" id="5013118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013128">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013182">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013225">decls</span><span class="op" id="5013230">[</span><span class="ident" id="5013231">j</span><span class="op" id="5013232">]</span>&nbsp;<span class="op" id="5013234">=</span>&nbsp;<span class="builtintype" id="5013236">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013247">}</span>&nbsp;<span class="keyword" id="5013249">else</span>&nbsp;<span class="op" id="5013254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013264">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013302">d</span>&nbsp;<span class="op" id="5013304">=</span>&nbsp;<span class="builtintype" id="5013306">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013317">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013326">n</span><span class="op" id="5013327">++</span>&nbsp;<span class="comment" id="5013330">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013357">}</span>&nbsp;<span class="keyword" id="5013359">else</span>&nbsp;<span class="op" id="5013364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013373">funcs</span><span class="op" id="5013378">[</span><span class="ident" id="5013379">name</span><span class="op" id="5013383">]</span>&nbsp;<span class="op" id="5013385">=</span>&nbsp;<span class="ident" id="5013387">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013402">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013414">decls</span><span class="op" id="5013419">[</span><span class="ident" id="5013420">i</span><span class="op" id="5013421">]</span>&nbsp;<span class="op" id="5013423">=</span>&nbsp;<span class="ident" id="5013425">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013431">i</span><span class="op" id="5013432">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013442">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013447">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013510">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013577">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013644">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013709">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013742">if</span>&nbsp;<span class="ident" id="5013745">n</span>&nbsp;<span class="op" id="5013747">&gt;</span>&nbsp;<span class="num" id="5013749">0</span>&nbsp;<span class="op" id="5013751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013756">i</span>&nbsp;<span class="op" id="5013758">=</span>&nbsp;<span class="num" id="5013760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013765">for</span>&nbsp;<span class="ident" id="5013769">_</span><span class="op" id="5013770">,</span>&nbsp;<span class="ident" id="5013772">d</span>&nbsp;<span class="op" id="5013774">:=</span>&nbsp;<span class="keyword" id="5013777">range</span>&nbsp;<span class="ident" id="5013783">decls</span>&nbsp;<span class="op" id="5013789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013795">if</span>&nbsp;<span class="ident" id="5013798">d</span>&nbsp;<span class="op" id="5013800">!=</span>&nbsp;<span class="builtintype" id="5013803">nil</span>&nbsp;<span class="op" id="5013807">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013814">decls</span><span class="op" id="5013819">[</span><span class="ident" id="5013820">i</span><span class="op" id="5013821">]</span>&nbsp;<span class="op" id="5013823">=</span>&nbsp;<span class="ident" id="5013825">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013832">i</span><span class="op" id="5013833">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013850">decls</span>&nbsp;<span class="op" id="5013856">=</span>&nbsp;<span class="ident" id="5013858">decls</span><span class="op" id="5013863">[</span><span class="num" id="5013864">0</span><span class="op" id="5013865">:</span><span class="ident" id="5013866">i</span><span class="op" id="5013867">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013878">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013927">var</span>&nbsp;<span class="ident" id="5013931">imports</span>&nbsp;<span class="op" id="5013939">[</span><span class="op" id="5013940">]</span><span class="op" id="5013941">*</span><span class="ident" id="5013942">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013954">if</span>&nbsp;<span class="ident" id="5013957">mode</span><span class="op" id="5013961">&amp;</span><span class="ident" id="5013962">FilterImportDuplicates</span>&nbsp;<span class="op" id="5013985">!=</span>&nbsp;<span class="num" id="5013988">0</span>&nbsp;<span class="op" id="5013990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013994">seen</span>&nbsp;<span class="op" id="5013999">:=</span>&nbsp;<span class="builtinfunc" id="5014002">make</span><span class="op" id="5014006">(</span><span class="keyword" id="5014007">map</span><span class="op" id="5014010">[</span><span class="builtintype" id="5014011">string</span><span class="op" id="5014017">]</span><span class="builtintype" id="5014018">bool</span><span class="op" id="5014022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014026">for</span>&nbsp;<span class="ident" id="5014030">_</span><span class="op" id="5014031">,</span>&nbsp;<span class="ident" id="5014033">filename</span>&nbsp;<span class="op" id="5014042">:=</span>&nbsp;<span class="keyword" id="5014045">range</span>&nbsp;<span class="ident" id="5014051">filenames</span>&nbsp;<span class="op" id="5014061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014066">f</span>&nbsp;<span class="op" id="5014068">:=</span>&nbsp;<span class="ident" id="5014071">pkg</span><span class="op" id="5014074">.</span><span class="ident" id="5014075">Files</span><span class="op" id="5014080">[</span><span class="ident" id="5014081">filename</span><span class="op" id="5014089">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014094">for</span>&nbsp;<span class="ident" id="5014098">_</span><span class="op" id="5014099">,</span>&nbsp;<span class="ident" id="5014101">imp</span>&nbsp;<span class="op" id="5014105">:=</span>&nbsp;<span class="keyword" id="5014108">range</span>&nbsp;<span class="ident" id="5014114">f</span><span class="op" id="5014115">.</span><span class="ident" id="5014116">Imports</span>&nbsp;<span class="op" id="5014124">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014130">if</span>&nbsp;<span class="ident" id="5014133">path</span>&nbsp;<span class="op" id="5014138">:=</span>&nbsp;<span class="ident" id="5014141">imp</span><span class="op" id="5014144">.</span><span class="ident" id="5014145">Path</span><span class="op" id="5014149">.</span><span class="ident" id="5014150">Value</span><span class="op" id="5014155">;</span>&nbsp;<span class="op" id="5014157">!</span><span class="ident" id="5014158">seen</span><span class="op" id="5014162">[</span><span class="ident" id="5014163">path</span><span class="op" id="5014167">]</span>&nbsp;<span class="op" id="5014169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014176">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014221">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014277">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014335">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014364">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014417">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014472">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014502">imports</span>&nbsp;<span class="op" id="5014510">=</span>&nbsp;<span class="builtinfunc" id="5014512">append</span><span class="op" id="5014518">(</span><span class="ident" id="5014519">imports</span><span class="op" id="5014526">,</span>&nbsp;<span class="ident" id="5014528">imp</span><span class="op" id="5014531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014538">seen</span><span class="op" id="5014542">[</span><span class="ident" id="5014543">path</span><span class="op" id="5014547">]</span>&nbsp;<span class="op" id="5014549">=</span>&nbsp;<span class="builtintype" id="5014551">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014572">}</span>&nbsp;<span class="keyword" id="5014574">else</span>&nbsp;<span class="op" id="5014579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014583">for</span>&nbsp;<span class="ident" id="5014587">_</span><span class="op" id="5014588">,</span>&nbsp;<span class="ident" id="5014590">f</span>&nbsp;<span class="op" id="5014592">:=</span>&nbsp;<span class="keyword" id="5014595">range</span>&nbsp;<span class="ident" id="5014601">pkg</span><span class="op" id="5014604">.</span><span class="ident" id="5014605">Files</span>&nbsp;<span class="op" id="5014611">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014616">imports</span>&nbsp;<span class="op" id="5014624">=</span>&nbsp;<span class="builtinfunc" id="5014626">append</span><span class="op" id="5014632">(</span><span class="ident" id="5014633">imports</span><span class="op" id="5014640">,</span>&nbsp;<span class="ident" id="5014642">f</span><span class="op" id="5014643">.</span><span class="ident" id="5014644">Imports</span><span class="op" id="5014651">...</span><span class="op" id="5014654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014665">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014710">var</span>&nbsp;<span class="ident" id="5014714">comments</span>&nbsp;<span class="op" id="5014723">[</span><span class="op" id="5014724">]</span><span class="op" id="5014725">*</span><span class="ident" id="5014726">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014740">if</span>&nbsp;<span class="ident" id="5014743">mode</span><span class="op" id="5014747">&amp;</span><span class="ident" id="5014748">FilterUnassociatedComments</span>&nbsp;<span class="op" id="5014775">==</span>&nbsp;<span class="num" id="5014778">0</span>&nbsp;<span class="op" id="5014780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014784">comments</span>&nbsp;<span class="op" id="5014793">=</span>&nbsp;<span class="builtinfunc" id="5014795">make</span><span class="op" id="5014799">(</span><span class="op" id="5014800">[</span><span class="op" id="5014801">]</span><span class="op" id="5014802">*</span><span class="ident" id="5014803">CommentGroup</span><span class="op" id="5014815">,</span>&nbsp;<span class="ident" id="5014817">ncomments</span><span class="op" id="5014826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014830">i</span>&nbsp;<span class="op" id="5014832">:=</span>&nbsp;<span class="num" id="5014835">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014839">for</span>&nbsp;<span class="ident" id="5014843">_</span><span class="op" id="5014844">,</span>&nbsp;<span class="ident" id="5014846">f</span>&nbsp;<span class="op" id="5014848">:=</span>&nbsp;<span class="keyword" id="5014851">range</span>&nbsp;<span class="ident" id="5014857">pkg</span><span class="op" id="5014860">.</span><span class="ident" id="5014861">Files</span>&nbsp;<span class="op" id="5014867">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014872">i</span>&nbsp;<span class="op" id="5014874">+=</span>&nbsp;<span class="builtinfunc" id="5014877">copy</span><span class="op" id="5014881">(</span><span class="ident" id="5014882">comments</span><span class="op" id="5014890">[</span><span class="ident" id="5014891">i</span><span class="op" id="5014892">:</span><span class="op" id="5014893">]</span><span class="op" id="5014894">,</span>&nbsp;<span class="ident" id="5014896">f</span><span class="op" id="5014897">.</span><span class="ident" id="5014898">Comments</span><span class="op" id="5014906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5014913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5014917">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5014971">return</span>&nbsp;<span class="op" id="5014978">&amp;</span><span class="ident" id="5014979">File</span><span class="op" id="5014983">{</span><span class="ident" id="5014984">doc</span><span class="op" id="5014987">,</span>&nbsp;<span class="ident" id="5014989">pos</span><span class="op" id="5014992">,</span>&nbsp;<span class="ident" id="5014994">NewIdent</span><span class="op" id="5015002">(</span><span class="ident" id="5015003">pkg</span><span class="op" id="5015006">.</span><span class="ident" id="5015007">Name</span><span class="op" id="5015011">)</span><span class="op" id="5015012">,</span>&nbsp;<span class="ident" id="5015014">decls</span><span class="op" id="5015019">,</span>&nbsp;<span class="ident" id="5015021">pkg</span><span class="op" id="5015024">.</span><span class="ident" id="5015025">Scope</span><span class="op" id="5015030">,</span>&nbsp;<span class="ident" id="5015032">imports</span><span class="op" id="5015039">,</span>&nbsp;<span class="builtintype" id="5015041">nil</span><span class="op" id="5015044">,</span>&nbsp;<span class="ident" id="5015046">comments</span><span class="op" id="5015054">}</span><br>
<span class="lineno"></span><span class="op" id="5015056">}</span>
</div>
</body>
</html>
