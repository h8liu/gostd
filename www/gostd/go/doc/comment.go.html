<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html" class="current">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5447797">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5447852">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5447906">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5447957">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448018">package</span>&nbsp;<span class="ident" id="5448026">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448031">import</span>&nbsp;<span class="op" id="5448038">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448041">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448047">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448057">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448068">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="5448084">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448103">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5448114">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5448129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5448132">var</span>&nbsp;<span class="op" id="5448136">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448139">ldquo</span>&nbsp;<span class="op" id="5448145">=</span>&nbsp;<span class="op" id="5448147">[</span><span class="op" id="5448148">]</span><span class="builtintype" id="5448149">byte</span><span class="op" id="5448153">(</span><span class="string" id="5448154">&#34;&amp;ldquo;&#34;</span><span class="op" id="5448163">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448166">rdquo</span>&nbsp;<span class="op" id="5448172">=</span>&nbsp;<span class="op" id="5448174">[</span><span class="op" id="5448175">]</span><span class="builtintype" id="5448176">byte</span><span class="op" id="5448180">(</span><span class="string" id="5448181">&#34;&amp;rdquo;&#34;</span><span class="op" id="5448190">)</span><br>
<span class="lineno"></span><span class="op" id="5448192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5448195">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="5448244">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="5448294">func</span>&nbsp;<span class="ident" id="5448299">commentEscape</span><span class="op" id="5448312">(</span><span class="ident" id="5448313">w</span>&nbsp;<span class="ident" id="5448315">io</span><span class="op" id="5448317">.</span><span class="ident" id="5448318">Writer</span><span class="op" id="5448324">,</span>&nbsp;<span class="ident" id="5448326">text</span>&nbsp;<span class="builtintype" id="5448331">string</span><span class="op" id="5448337">,</span>&nbsp;<span class="ident" id="5448339">nice</span>&nbsp;<span class="builtintype" id="5448344">bool</span><span class="op" id="5448348">)</span>&nbsp;<span class="op" id="5448350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448353">last</span>&nbsp;<span class="op" id="5448358">:=</span>&nbsp;<span class="num" id="5448361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448364">if</span>&nbsp;<span class="ident" id="5448367">nice</span>&nbsp;<span class="op" id="5448372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448376">for</span>&nbsp;<span class="ident" id="5448380">i</span>&nbsp;<span class="op" id="5448382">:=</span>&nbsp;<span class="num" id="5448385">0</span><span class="op" id="5448386">;</span>&nbsp;<span class="ident" id="5448388">i</span>&nbsp;<span class="op" id="5448390">&lt;</span>&nbsp;<span class="builtinfunc" id="5448392">len</span><span class="op" id="5448395">(</span><span class="ident" id="5448396">text</span><span class="op" id="5448400">)</span><span class="op" id="5448401">-</span><span class="num" id="5448402">1</span><span class="op" id="5448403">;</span>&nbsp;<span class="ident" id="5448405">i</span><span class="op" id="5448406">++</span>&nbsp;<span class="op" id="5448409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448414">ch</span>&nbsp;<span class="op" id="5448417">:=</span>&nbsp;<span class="ident" id="5448420">text</span><span class="op" id="5448424">[</span><span class="ident" id="5448425">i</span><span class="op" id="5448426">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448431">if</span>&nbsp;<span class="ident" id="5448434">ch</span>&nbsp;<span class="op" id="5448437">==</span>&nbsp;<span class="ident" id="5448440">text</span><span class="op" id="5448444">[</span><span class="ident" id="5448445">i</span><span class="op" id="5448446">+</span><span class="num" id="5448447">1</span><span class="op" id="5448448">]</span>&nbsp;<span class="op" id="5448450">&amp;&amp;</span>&nbsp;<span class="op" id="5448453">(</span><span class="ident" id="5448454">ch</span>&nbsp;<span class="op" id="5448457">==</span>&nbsp;<span class="string" id="5448460">&#39;`&#39;</span>&nbsp;<span class="op" id="5448464">||</span>&nbsp;<span class="ident" id="5448467">ch</span>&nbsp;<span class="op" id="5448470">==</span>&nbsp;<span class="string" id="5448473">&#39;\&#39;&#39;</span><span class="op" id="5448477">)</span>&nbsp;<span class="op" id="5448479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448485">template</span><span class="op" id="5448493">.</span><span class="ident" id="5448494">HTMLEscape</span><span class="op" id="5448504">(</span><span class="ident" id="5448505">w</span><span class="op" id="5448506">,</span>&nbsp;<span class="op" id="5448508">[</span><span class="op" id="5448509">]</span><span class="builtintype" id="5448510">byte</span><span class="op" id="5448514">(</span><span class="ident" id="5448515">text</span><span class="op" id="5448519">[</span><span class="ident" id="5448520">last</span><span class="op" id="5448524">:</span><span class="ident" id="5448525">i</span><span class="op" id="5448526">]</span><span class="op" id="5448527">)</span><span class="op" id="5448528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448534">last</span>&nbsp;<span class="op" id="5448539">=</span>&nbsp;<span class="ident" id="5448541">i</span>&nbsp;<span class="op" id="5448543">+</span>&nbsp;<span class="num" id="5448545">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448551">switch</span>&nbsp;<span class="ident" id="5448558">ch</span>&nbsp;<span class="op" id="5448561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448567">case</span>&nbsp;<span class="string" id="5448572">&#39;`&#39;</span><span class="op" id="5448575">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448582">w</span><span class="op" id="5448583">.</span><span class="ident" id="5448584">Write</span><span class="op" id="5448589">(</span><span class="ident" id="5448590">ldquo</span><span class="op" id="5448595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5448601">case</span>&nbsp;<span class="string" id="5448606">&#39;\&#39;&#39;</span><span class="op" id="5448610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448617">w</span><span class="op" id="5448618">.</span><span class="ident" id="5448619">Write</span><span class="op" id="5448624">(</span><span class="ident" id="5448625">rdquo</span><span class="op" id="5448630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448642">i</span><span class="op" id="5448643">++</span>&nbsp;<span class="comment" id="5448646">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5448682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448685">template</span><span class="op" id="5448693">.</span><span class="ident" id="5448694">HTMLEscape</span><span class="op" id="5448704">(</span><span class="ident" id="5448705">w</span><span class="op" id="5448706">,</span>&nbsp;<span class="op" id="5448708">[</span><span class="op" id="5448709">]</span><span class="builtintype" id="5448710">byte</span><span class="op" id="5448714">(</span><span class="ident" id="5448715">text</span><span class="op" id="5448719">[</span><span class="ident" id="5448720">last</span><span class="op" id="5448724">:</span><span class="op" id="5448725">]</span><span class="op" id="5448726">)</span><span class="op" id="5448727">)</span><br>
<span class="lineno"></span><span class="op" id="5448729">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5448732">const</span>&nbsp;<span class="op" id="5448738">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448741">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448771">identRx</span>&nbsp;<span class="op" id="5448779">=</span>&nbsp;<span class="string" id="5448781">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5448802">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448822">protocol</span>&nbsp;<span class="op" id="5448831">=</span>&nbsp;<span class="string" id="5448833">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448897">hostPart</span>&nbsp;<span class="op" id="5448906">=</span>&nbsp;<span class="string" id="5448908">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5448928">filePart</span>&nbsp;<span class="op" id="5448937">=</span>&nbsp;<span class="string" id="5448939">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="5448967">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449030">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449039">=</span>&nbsp;<span class="string" id="5449041">`(`</span>&nbsp;<span class="op" id="5449045">+</span>&nbsp;<span class="ident" id="5449047">protocol</span>&nbsp;<span class="op" id="5449056">+</span>&nbsp;<span class="string" id="5449058">`)://`</span>&nbsp;<span class="op" id="5449065">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5449069">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449082">hostPart</span>&nbsp;<span class="op" id="5449091">+</span>&nbsp;<span class="string" id="5449093">`([.:]`</span>&nbsp;<span class="op" id="5449101">+</span>&nbsp;<span class="ident" id="5449103">hostPart</span>&nbsp;<span class="op" id="5449112">+</span>&nbsp;<span class="string" id="5449114">`)*/?`</span>&nbsp;<span class="op" id="5449121">+</span>&nbsp;<span class="comment" id="5449123">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449151">filePart</span>&nbsp;<span class="op" id="5449160">+</span>&nbsp;<span class="string" id="5449162">`([:.,]`</span>&nbsp;<span class="op" id="5449171">+</span>&nbsp;<span class="ident" id="5449173">filePart</span>&nbsp;<span class="op" id="5449182">+</span>&nbsp;<span class="string" id="5449184">`)*`</span><br>
<span class="lineno"></span><span class="op" id="5449189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5449192">var</span>&nbsp;<span class="ident" id="5449196">matchRx</span>&nbsp;<span class="op" id="5449204">=</span>&nbsp;<span class="ident" id="5449206">regexp</span><span class="op" id="5449212">.</span><span class="ident" id="5449213">MustCompile</span><span class="op" id="5449224">(</span><span class="string" id="5449225">`(`</span>&nbsp;<span class="op" id="5449229">+</span>&nbsp;<span class="ident" id="5449231">urlRx</span>&nbsp;<span class="op" id="5449237">+</span>&nbsp;<span class="string" id="5449239">`)|(`</span>&nbsp;<span class="op" id="5449245">+</span>&nbsp;<span class="ident" id="5449247">identRx</span>&nbsp;<span class="op" id="5449255">+</span>&nbsp;<span class="string" id="5449257">`)`</span><span class="op" id="5449260">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5449263">var</span>&nbsp;<span class="op" id="5449267">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449270">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449282">=</span>&nbsp;<span class="op" id="5449284">[</span><span class="op" id="5449285">]</span><span class="builtintype" id="5449286">byte</span><span class="op" id="5449290">(</span><span class="string" id="5449291">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="5449302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449305">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449317">=</span>&nbsp;<span class="op" id="5449319">[</span><span class="op" id="5449320">]</span><span class="builtintype" id="5449321">byte</span><span class="op" id="5449325">(</span><span class="string" id="5449326">`&#34;&gt;`</span><span class="op" id="5449330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449333">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5449345">=</span>&nbsp;<span class="op" id="5449347">[</span><span class="op" id="5449348">]</span><span class="builtintype" id="5449349">byte</span><span class="op" id="5449353">(</span><span class="string" id="5449354">&#34;&lt;/a&gt;&#34;</span><span class="op" id="5449360">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449363">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449375">=</span>&nbsp;<span class="op" id="5449377">[</span><span class="op" id="5449378">]</span><span class="builtintype" id="5449379">byte</span><span class="op" id="5449383">(</span><span class="string" id="5449384">&#34;&lt;i&gt;&#34;</span><span class="op" id="5449389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449392">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5449404">=</span>&nbsp;<span class="op" id="5449406">[</span><span class="op" id="5449407">]</span><span class="builtintype" id="5449408">byte</span><span class="op" id="5449412">(</span><span class="string" id="5449413">&#34;&lt;/i&gt;&#34;</span><span class="op" id="5449419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449422">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449434">=</span>&nbsp;<span class="op" id="5449436">[</span><span class="op" id="5449437">]</span><span class="builtintype" id="5449438">byte</span><span class="op" id="5449442">(</span><span class="string" id="5449443">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="5449450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449453">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5449465">=</span>&nbsp;<span class="op" id="5449467">[</span><span class="op" id="5449468">]</span><span class="builtintype" id="5449469">byte</span><span class="op" id="5449473">(</span><span class="string" id="5449474">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="5449482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449485">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449497">=</span>&nbsp;<span class="op" id="5449499">[</span><span class="op" id="5449500">]</span><span class="builtintype" id="5449501">byte</span><span class="op" id="5449505">(</span><span class="string" id="5449506">&#34;&lt;pre&gt;&#34;</span><span class="op" id="5449513">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449516">html_endpre</span>&nbsp;<span class="op" id="5449528">=</span>&nbsp;<span class="op" id="5449530">[</span><span class="op" id="5449531">]</span><span class="builtintype" id="5449532">byte</span><span class="op" id="5449536">(</span><span class="string" id="5449537">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="5449547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449550">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449562">=</span>&nbsp;<span class="op" id="5449564">[</span><span class="op" id="5449565">]</span><span class="builtintype" id="5449566">byte</span><span class="op" id="5449570">(</span><span class="string" id="5449571">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="5449581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449584">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449596">=</span>&nbsp;<span class="op" id="5449598">[</span><span class="op" id="5449599">]</span><span class="builtintype" id="5449600">byte</span><span class="op" id="5449604">(</span><span class="string" id="5449605">`&#34;&gt;`</span><span class="op" id="5449609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449612">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5449624">=</span>&nbsp;<span class="op" id="5449626">[</span><span class="op" id="5449627">]</span><span class="builtintype" id="5449628">byte</span><span class="op" id="5449632">(</span><span class="string" id="5449633">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="5449642">)</span><br>
<span class="lineno"></span><span class="op" id="5449644">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="5449647">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="5449749">func</span>&nbsp;<span class="ident" id="5449754">pairedParensPrefixLen</span><span class="op" id="5449775">(</span><span class="ident" id="5449776">s</span>&nbsp;<span class="builtintype" id="5449778">string</span><span class="op" id="5449784">)</span>&nbsp;<span class="builtintype" id="5449786">int</span>&nbsp;<span class="op" id="5449790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449793">parens</span>&nbsp;<span class="op" id="5449800">:=</span>&nbsp;<span class="num" id="5449803">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449806">l</span>&nbsp;<span class="op" id="5449808">:=</span>&nbsp;<span class="builtinfunc" id="5449811">len</span><span class="op" id="5449814">(</span><span class="ident" id="5449815">s</span><span class="op" id="5449816">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449819">for</span>&nbsp;<span class="ident" id="5449823">i</span><span class="op" id="5449824">,</span>&nbsp;<span class="ident" id="5449826">ch</span>&nbsp;<span class="op" id="5449829">:=</span>&nbsp;<span class="keyword" id="5449832">range</span>&nbsp;<span class="ident" id="5449838">s</span>&nbsp;<span class="op" id="5449840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449844">switch</span>&nbsp;<span class="ident" id="5449851">ch</span>&nbsp;<span class="op" id="5449854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449858">case</span>&nbsp;<span class="string" id="5449863">&#39;(&#39;</span><span class="op" id="5449866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449871">if</span>&nbsp;<span class="ident" id="5449874">parens</span>&nbsp;<span class="op" id="5449881">==</span>&nbsp;<span class="num" id="5449884">0</span>&nbsp;<span class="op" id="5449886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449892">l</span>&nbsp;<span class="op" id="5449894">=</span>&nbsp;<span class="ident" id="5449896">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449906">parens</span><span class="op" id="5449912">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449917">case</span>&nbsp;<span class="string" id="5449922">&#39;)&#39;</span><span class="op" id="5449925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449930">parens</span><span class="op" id="5449936">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5449942">if</span>&nbsp;<span class="ident" id="5449945">parens</span>&nbsp;<span class="op" id="5449952">==</span>&nbsp;<span class="num" id="5449955">0</span>&nbsp;<span class="op" id="5449957">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5449963">l</span>&nbsp;<span class="op" id="5449965">=</span>&nbsp;<span class="builtinfunc" id="5449967">len</span><span class="op" id="5449970">(</span><span class="ident" id="5449971">s</span><span class="op" id="5449972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5449977">}</span>&nbsp;<span class="keyword" id="5449979">else</span>&nbsp;<span class="keyword" id="5449984">if</span>&nbsp;<span class="ident" id="5449987">parens</span>&nbsp;<span class="op" id="5449994">&lt;</span>&nbsp;<span class="num" id="5449996">0</span>&nbsp;<span class="op" id="5449998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450004">return</span>&nbsp;<span class="ident" id="5450011">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450020">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450026">return</span>&nbsp;<span class="ident" id="5450033">l</span><br>
<span class="lineno"></span><span class="op" id="5450035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450038">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="5450118">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="5450198">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5450275">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5450355">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="5450434">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="5450513">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="5450593">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="5450618">func</span>&nbsp;<span class="ident" id="5450623">emphasize</span><span class="op" id="5450632">(</span><span class="ident" id="5450633">w</span>&nbsp;<span class="ident" id="5450635">io</span><span class="op" id="5450637">.</span><span class="ident" id="5450638">Writer</span><span class="op" id="5450644">,</span>&nbsp;<span class="ident" id="5450646">line</span>&nbsp;<span class="builtintype" id="5450651">string</span><span class="op" id="5450657">,</span>&nbsp;<span class="ident" id="5450659">words</span>&nbsp;<span class="keyword" id="5450665">map</span><span class="op" id="5450668">[</span><span class="builtintype" id="5450669">string</span><span class="op" id="5450675">]</span><span class="builtintype" id="5450676">string</span><span class="op" id="5450682">,</span>&nbsp;<span class="ident" id="5450684">nice</span>&nbsp;<span class="builtintype" id="5450689">bool</span><span class="op" id="5450693">)</span>&nbsp;<span class="op" id="5450695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450698">for</span>&nbsp;<span class="op" id="5450702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450706">m</span>&nbsp;<span class="op" id="5450708">:=</span>&nbsp;<span class="ident" id="5450711">matchRx</span><span class="op" id="5450718">.</span><span class="ident" id="5450719">FindStringSubmatchIndex</span><span class="op" id="5450742">(</span><span class="ident" id="5450743">line</span><span class="op" id="5450747">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450751">if</span>&nbsp;<span class="ident" id="5450754">m</span>&nbsp;<span class="op" id="5450756">==</span>&nbsp;<span class="builtintype" id="5450759">nil</span>&nbsp;<span class="op" id="5450763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450768">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5450776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450780">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450854">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450883">commentEscape</span><span class="op" id="5450896">(</span><span class="ident" id="5450897">w</span><span class="op" id="5450898">,</span>&nbsp;<span class="ident" id="5450900">line</span><span class="op" id="5450904">[</span><span class="num" id="5450905">0</span><span class="op" id="5450906">:</span><span class="ident" id="5450907">m</span><span class="op" id="5450908">[</span><span class="num" id="5450909">0</span><span class="op" id="5450910">]</span><span class="op" id="5450911">]</span><span class="op" id="5450912">,</span>&nbsp;<span class="ident" id="5450914">nice</span><span class="op" id="5450918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5450923">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450954">match</span>&nbsp;<span class="op" id="5450960">:=</span>&nbsp;<span class="ident" id="5450963">line</span><span class="op" id="5450967">[</span><span class="ident" id="5450968">m</span><span class="op" id="5450969">[</span><span class="num" id="5450970">0</span><span class="op" id="5450971">]</span><span class="op" id="5450972">:</span><span class="ident" id="5450973">m</span><span class="op" id="5450974">[</span><span class="num" id="5450975">1</span><span class="op" id="5450976">]</span><span class="op" id="5450977">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450981">if</span>&nbsp;<span class="ident" id="5450984">n</span>&nbsp;<span class="op" id="5450986">:=</span>&nbsp;<span class="ident" id="5450989">pairedParensPrefixLen</span><span class="op" id="5451010">(</span><span class="ident" id="5451011">match</span><span class="op" id="5451016">)</span><span class="op" id="5451017">;</span>&nbsp;<span class="ident" id="5451019">n</span>&nbsp;<span class="op" id="5451021">&lt;</span>&nbsp;<span class="builtinfunc" id="5451023">len</span><span class="op" id="5451026">(</span><span class="ident" id="5451027">match</span><span class="op" id="5451032">)</span>&nbsp;<span class="op" id="5451034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451039">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451089">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451149">m</span>&nbsp;<span class="op" id="5451151">=</span>&nbsp;<span class="ident" id="5451153">matchRx</span><span class="op" id="5451160">.</span><span class="ident" id="5451161">FindStringSubmatchIndex</span><span class="op" id="5451184">(</span><span class="ident" id="5451185">line</span><span class="op" id="5451189">[</span><span class="op" id="5451190">:</span><span class="ident" id="5451191">m</span><span class="op" id="5451192">[</span><span class="num" id="5451193">0</span><span class="op" id="5451194">]</span><span class="op" id="5451195">+</span><span class="ident" id="5451196">n</span><span class="op" id="5451197">]</span><span class="op" id="5451198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451203">match</span>&nbsp;<span class="op" id="5451209">=</span>&nbsp;<span class="ident" id="5451211">match</span><span class="op" id="5451216">[</span><span class="op" id="5451217">:</span><span class="ident" id="5451218">n</span><span class="op" id="5451219">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451228">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451247">url</span>&nbsp;<span class="op" id="5451251">:=</span>&nbsp;<span class="string" id="5451254">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451259">italics</span>&nbsp;<span class="op" id="5451267">:=</span>&nbsp;<span class="builtintype" id="5451270">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451278">if</span>&nbsp;<span class="ident" id="5451281">words</span>&nbsp;<span class="op" id="5451287">!=</span>&nbsp;<span class="builtintype" id="5451290">nil</span>&nbsp;<span class="op" id="5451294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451299">url</span><span class="op" id="5451302">,</span>&nbsp;<span class="ident" id="5451304">italics</span>&nbsp;<span class="op" id="5451312">=</span>&nbsp;<span class="ident" id="5451314">words</span><span class="op" id="5451319">[</span><span class="ident" id="5451320">match</span><span class="op" id="5451325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451333">if</span>&nbsp;<span class="ident" id="5451336">m</span><span class="op" id="5451337">[</span><span class="num" id="5451338">2</span><span class="op" id="5451339">]</span>&nbsp;<span class="op" id="5451341">&gt;=</span>&nbsp;<span class="num" id="5451344">0</span>&nbsp;<span class="op" id="5451346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451351">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451431">if</span>&nbsp;<span class="op" id="5451434">!</span><span class="ident" id="5451435">italics</span>&nbsp;<span class="op" id="5451443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451449">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451508">url</span>&nbsp;<span class="op" id="5451512">=</span>&nbsp;<span class="ident" id="5451514">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451528">italics</span>&nbsp;<span class="op" id="5451536">=</span>&nbsp;<span class="builtintype" id="5451538">false</span>&nbsp;<span class="comment" id="5451544">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451575">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451592">if</span>&nbsp;<span class="builtinfunc" id="5451595">len</span><span class="op" id="5451598">(</span><span class="ident" id="5451599">url</span><span class="op" id="5451602">)</span>&nbsp;<span class="op" id="5451604">&gt;</span>&nbsp;<span class="num" id="5451606">0</span>&nbsp;<span class="op" id="5451608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451613">w</span><span class="op" id="5451614">.</span><span class="ident" id="5451615">Write</span><span class="op" id="5451620">(</span><span class="ident" id="5451621">html_a</span><span class="op" id="5451627">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451632">template</span><span class="op" id="5451640">.</span><span class="ident" id="5451641">HTMLEscape</span><span class="op" id="5451651">(</span><span class="ident" id="5451652">w</span><span class="op" id="5451653">,</span>&nbsp;<span class="op" id="5451655">[</span><span class="op" id="5451656">]</span><span class="builtintype" id="5451657">byte</span><span class="op" id="5451661">(</span><span class="ident" id="5451662">url</span><span class="op" id="5451665">)</span><span class="op" id="5451666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451671">w</span><span class="op" id="5451672">.</span><span class="ident" id="5451673">Write</span><span class="op" id="5451678">(</span><span class="ident" id="5451679">html_aq</span><span class="op" id="5451686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451694">if</span>&nbsp;<span class="ident" id="5451697">italics</span>&nbsp;<span class="op" id="5451705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451710">w</span><span class="op" id="5451711">.</span><span class="ident" id="5451712">Write</span><span class="op" id="5451717">(</span><span class="ident" id="5451718">html_i</span><span class="op" id="5451724">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451732">commentEscape</span><span class="op" id="5451745">(</span><span class="ident" id="5451746">w</span><span class="op" id="5451747">,</span>&nbsp;<span class="ident" id="5451749">match</span><span class="op" id="5451754">,</span>&nbsp;<span class="ident" id="5451756">nice</span><span class="op" id="5451760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451764">if</span>&nbsp;<span class="ident" id="5451767">italics</span>&nbsp;<span class="op" id="5451775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451780">w</span><span class="op" id="5451781">.</span><span class="ident" id="5451782">Write</span><span class="op" id="5451787">(</span><span class="ident" id="5451788">html_endi</span><span class="op" id="5451797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451801">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451805">if</span>&nbsp;<span class="builtinfunc" id="5451808">len</span><span class="op" id="5451811">(</span><span class="ident" id="5451812">url</span><span class="op" id="5451815">)</span>&nbsp;<span class="op" id="5451817">&gt;</span>&nbsp;<span class="num" id="5451819">0</span>&nbsp;<span class="op" id="5451821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451826">w</span><span class="op" id="5451827">.</span><span class="ident" id="5451828">Write</span><span class="op" id="5451833">(</span><span class="ident" id="5451834">html_enda</span><span class="op" id="5451843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451852">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451865">line</span>&nbsp;<span class="op" id="5451870">=</span>&nbsp;<span class="ident" id="5451872">line</span><span class="op" id="5451876">[</span><span class="ident" id="5451877">m</span><span class="op" id="5451878">[</span><span class="num" id="5451879">1</span><span class="op" id="5451880">]</span><span class="op" id="5451881">:</span><span class="op" id="5451882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451888">commentEscape</span><span class="op" id="5451901">(</span><span class="ident" id="5451902">w</span><span class="op" id="5451903">,</span>&nbsp;<span class="ident" id="5451905">line</span><span class="op" id="5451909">,</span>&nbsp;<span class="ident" id="5451911">nice</span><span class="op" id="5451915">)</span><br>
<span class="lineno"></span><span class="op" id="5451917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="5451920">func</span>&nbsp;<span class="ident" id="5451925">indentLen</span><span class="op" id="5451934">(</span><span class="ident" id="5451935">s</span>&nbsp;<span class="builtintype" id="5451937">string</span><span class="op" id="5451943">)</span>&nbsp;<span class="builtintype" id="5451945">int</span>&nbsp;<span class="op" id="5451949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451952">i</span>&nbsp;<span class="op" id="5451954">:=</span>&nbsp;<span class="num" id="5451957">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451960">for</span>&nbsp;<span class="ident" id="5451964">i</span>&nbsp;<span class="op" id="5451966">&lt;</span>&nbsp;<span class="builtinfunc" id="5451968">len</span><span class="op" id="5451971">(</span><span class="ident" id="5451972">s</span><span class="op" id="5451973">)</span>&nbsp;<span class="op" id="5451975">&amp;&amp;</span>&nbsp;<span class="op" id="5451978">(</span><span class="ident" id="5451979">s</span><span class="op" id="5451980">[</span><span class="ident" id="5451981">i</span><span class="op" id="5451982">]</span>&nbsp;<span class="op" id="5451984">==</span>&nbsp;<span class="string" id="5451987">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5451991">||</span>&nbsp;<span class="ident" id="5451994">s</span><span class="op" id="5451995">[</span><span class="ident" id="5451996">i</span><span class="op" id="5451997">]</span>&nbsp;<span class="op" id="5451999">==</span>&nbsp;<span class="string" id="5452002">&#39;\t&#39;</span><span class="op" id="5452006">)</span>&nbsp;<span class="op" id="5452008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452012">i</span><span class="op" id="5452013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452017">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452020">return</span>&nbsp;<span class="ident" id="5452027">i</span><br>
<span class="lineno"></span><span class="op" id="5452029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5452032">func</span>&nbsp;<span class="ident" id="5452037">isBlank</span><span class="op" id="5452044">(</span><span class="ident" id="5452045">s</span>&nbsp;<span class="builtintype" id="5452047">string</span><span class="op" id="5452053">)</span>&nbsp;<span class="builtintype" id="5452055">bool</span>&nbsp;<span class="op" id="5452060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452063">return</span>&nbsp;<span class="builtinfunc" id="5452070">len</span><span class="op" id="5452073">(</span><span class="ident" id="5452074">s</span><span class="op" id="5452075">)</span>&nbsp;<span class="op" id="5452077">==</span>&nbsp;<span class="num" id="5452080">0</span>&nbsp;<span class="op" id="5452082">||</span>&nbsp;<span class="op" id="5452085">(</span><span class="builtinfunc" id="5452086">len</span><span class="op" id="5452089">(</span><span class="ident" id="5452090">s</span><span class="op" id="5452091">)</span>&nbsp;<span class="op" id="5452093">==</span>&nbsp;<span class="num" id="5452096">1</span>&nbsp;<span class="op" id="5452098">&amp;&amp;</span>&nbsp;<span class="ident" id="5452101">s</span><span class="op" id="5452102">[</span><span class="num" id="5452103">0</span><span class="op" id="5452104">]</span>&nbsp;<span class="op" id="5452106">==</span>&nbsp;<span class="string" id="5452109">&#39;\n&#39;</span><span class="op" id="5452113">)</span><br>
<span class="lineno">175</span><span class="op" id="5452115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5452118">func</span>&nbsp;<span class="ident" id="5452123">commonPrefix</span><span class="op" id="5452135">(</span><span class="ident" id="5452136">a</span><span class="op" id="5452137">,</span>&nbsp;<span class="ident" id="5452139">b</span>&nbsp;<span class="builtintype" id="5452141">string</span><span class="op" id="5452147">)</span>&nbsp;<span class="builtintype" id="5452149">string</span>&nbsp;<span class="op" id="5452156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452159">i</span>&nbsp;<span class="op" id="5452161">:=</span>&nbsp;<span class="num" id="5452164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452167">for</span>&nbsp;<span class="ident" id="5452171">i</span>&nbsp;<span class="op" id="5452173">&lt;</span>&nbsp;<span class="builtinfunc" id="5452175">len</span><span class="op" id="5452178">(</span><span class="ident" id="5452179">a</span><span class="op" id="5452180">)</span>&nbsp;<span class="op" id="5452182">&amp;&amp;</span>&nbsp;<span class="ident" id="5452185">i</span>&nbsp;<span class="op" id="5452187">&lt;</span>&nbsp;<span class="builtinfunc" id="5452189">len</span><span class="op" id="5452192">(</span><span class="ident" id="5452193">b</span><span class="op" id="5452194">)</span>&nbsp;<span class="op" id="5452196">&amp;&amp;</span>&nbsp;<span class="ident" id="5452199">a</span><span class="op" id="5452200">[</span><span class="ident" id="5452201">i</span><span class="op" id="5452202">]</span>&nbsp;<span class="op" id="5452204">==</span>&nbsp;<span class="ident" id="5452207">b</span><span class="op" id="5452208">[</span><span class="ident" id="5452209">i</span><span class="op" id="5452210">]</span>&nbsp;<span class="op" id="5452212">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452216">i</span><span class="op" id="5452217">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452224">return</span>&nbsp;<span class="ident" id="5452231">a</span><span class="op" id="5452232">[</span><span class="num" id="5452233">0</span><span class="op" id="5452234">:</span><span class="ident" id="5452235">i</span><span class="op" id="5452236">]</span><br>
<span class="lineno"></span><span class="op" id="5452238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5452241">func</span>&nbsp;<span class="ident" id="5452246">unindent</span><span class="op" id="5452254">(</span><span class="ident" id="5452255">block</span>&nbsp;<span class="op" id="5452261">[</span><span class="op" id="5452262">]</span><span class="builtintype" id="5452263">string</span><span class="op" id="5452269">)</span>&nbsp;<span class="op" id="5452271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452274">if</span>&nbsp;<span class="builtinfunc" id="5452277">len</span><span class="op" id="5452280">(</span><span class="ident" id="5452281">block</span><span class="op" id="5452286">)</span>&nbsp;<span class="op" id="5452288">==</span>&nbsp;<span class="num" id="5452291">0</span>&nbsp;<span class="op" id="5452293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452297">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452309">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452349">prefix</span>&nbsp;<span class="op" id="5452356">:=</span>&nbsp;<span class="ident" id="5452359">block</span><span class="op" id="5452364">[</span><span class="num" id="5452365">0</span><span class="op" id="5452366">]</span><span class="op" id="5452367">[</span><span class="num" id="5452368">0</span><span class="op" id="5452369">:</span><span class="ident" id="5452370">indentLen</span><span class="op" id="5452379">(</span><span class="ident" id="5452380">block</span><span class="op" id="5452385">[</span><span class="num" id="5452386">0</span><span class="op" id="5452387">]</span><span class="op" id="5452388">)</span><span class="op" id="5452389">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452392">for</span>&nbsp;<span class="ident" id="5452396">_</span><span class="op" id="5452397">,</span>&nbsp;<span class="ident" id="5452399">line</span>&nbsp;<span class="op" id="5452404">:=</span>&nbsp;<span class="keyword" id="5452407">range</span>&nbsp;<span class="ident" id="5452413">block</span>&nbsp;<span class="op" id="5452419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452423">if</span>&nbsp;<span class="op" id="5452426">!</span><span class="ident" id="5452427">isBlank</span><span class="op" id="5452434">(</span><span class="ident" id="5452435">line</span><span class="op" id="5452439">)</span>&nbsp;<span class="op" id="5452441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452446">prefix</span>&nbsp;<span class="op" id="5452453">=</span>&nbsp;<span class="ident" id="5452455">commonPrefix</span><span class="op" id="5452467">(</span><span class="ident" id="5452468">prefix</span><span class="op" id="5452474">,</span>&nbsp;<span class="ident" id="5452476">line</span><span class="op" id="5452480">[</span><span class="num" id="5452481">0</span><span class="op" id="5452482">:</span><span class="ident" id="5452483">indentLen</span><span class="op" id="5452492">(</span><span class="ident" id="5452493">line</span><span class="op" id="5452497">)</span><span class="op" id="5452498">]</span><span class="op" id="5452499">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452509">n</span>&nbsp;<span class="op" id="5452511">:=</span>&nbsp;<span class="builtinfunc" id="5452514">len</span><span class="op" id="5452517">(</span><span class="ident" id="5452518">prefix</span><span class="op" id="5452524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452528">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452539">for</span>&nbsp;<span class="ident" id="5452543">i</span><span class="op" id="5452544">,</span>&nbsp;<span class="ident" id="5452546">line</span>&nbsp;<span class="op" id="5452551">:=</span>&nbsp;<span class="keyword" id="5452554">range</span>&nbsp;<span class="ident" id="5452560">block</span>&nbsp;<span class="op" id="5452566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452570">if</span>&nbsp;<span class="op" id="5452573">!</span><span class="ident" id="5452574">isBlank</span><span class="op" id="5452581">(</span><span class="ident" id="5452582">line</span><span class="op" id="5452586">)</span>&nbsp;<span class="op" id="5452588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452593">block</span><span class="op" id="5452598">[</span><span class="ident" id="5452599">i</span><span class="op" id="5452600">]</span>&nbsp;<span class="op" id="5452602">=</span>&nbsp;<span class="ident" id="5452604">line</span><span class="op" id="5452608">[</span><span class="ident" id="5452609">n</span><span class="op" id="5452610">:</span><span class="op" id="5452611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452618">}</span><br>
<span class="lineno">205</span><span class="op" id="5452620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5452623">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="5452694">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5452736">func</span>&nbsp;<span class="ident" id="5452741">heading</span><span class="op" id="5452748">(</span><span class="ident" id="5452749">line</span>&nbsp;<span class="builtintype" id="5452754">string</span><span class="op" id="5452760">)</span>&nbsp;<span class="builtintype" id="5452762">string</span>&nbsp;<span class="op" id="5452769">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452772">line</span>&nbsp;<span class="op" id="5452777">=</span>&nbsp;<span class="ident" id="5452779">strings</span><span class="op" id="5452786">.</span><span class="ident" id="5452787">TrimSpace</span><span class="op" id="5452796">(</span><span class="ident" id="5452797">line</span><span class="op" id="5452801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452804">if</span>&nbsp;<span class="builtinfunc" id="5452807">len</span><span class="op" id="5452810">(</span><span class="ident" id="5452811">line</span><span class="op" id="5452815">)</span>&nbsp;<span class="op" id="5452817">==</span>&nbsp;<span class="num" id="5452820">0</span>&nbsp;<span class="op" id="5452822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452826">return</span>&nbsp;<span class="string" id="5452833">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452841">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452891">r</span><span class="op" id="5452892">,</span>&nbsp;<span class="ident" id="5452894">_</span>&nbsp;<span class="op" id="5452896">:=</span>&nbsp;<span class="ident" id="5452899">utf8</span><span class="op" id="5452903">.</span><span class="ident" id="5452904">DecodeRuneInString</span><span class="op" id="5452922">(</span><span class="ident" id="5452923">line</span><span class="op" id="5452927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452930">if</span>&nbsp;<span class="op" id="5452933">!</span><span class="ident" id="5452934">unicode</span><span class="op" id="5452941">.</span><span class="ident" id="5452942">IsLetter</span><span class="op" id="5452950">(</span><span class="ident" id="5452951">r</span><span class="op" id="5452952">)</span>&nbsp;<span class="op" id="5452954">||</span>&nbsp;<span class="op" id="5452957">!</span><span class="ident" id="5452958">unicode</span><span class="op" id="5452965">.</span><span class="ident" id="5452966">IsUpper</span><span class="op" id="5452973">(</span><span class="ident" id="5452974">r</span><span class="op" id="5452975">)</span>&nbsp;<span class="op" id="5452977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452981">return</span>&nbsp;<span class="string" id="5452988">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452992">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5452996">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453034">r</span><span class="op" id="5453035">,</span>&nbsp;<span class="ident" id="5453037">_</span>&nbsp;<span class="op" id="5453039">=</span>&nbsp;<span class="ident" id="5453041">utf8</span><span class="op" id="5453045">.</span><span class="ident" id="5453046">DecodeLastRuneInString</span><span class="op" id="5453068">(</span><span class="ident" id="5453069">line</span><span class="op" id="5453073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453076">if</span>&nbsp;<span class="op" id="5453079">!</span><span class="ident" id="5453080">unicode</span><span class="op" id="5453087">.</span><span class="ident" id="5453088">IsLetter</span><span class="op" id="5453096">(</span><span class="ident" id="5453097">r</span><span class="op" id="5453098">)</span>&nbsp;<span class="op" id="5453100">&amp;&amp;</span>&nbsp;<span class="op" id="5453103">!</span><span class="ident" id="5453104">unicode</span><span class="op" id="5453111">.</span><span class="ident" id="5453112">IsDigit</span><span class="op" id="5453119">(</span><span class="ident" id="5453120">r</span><span class="op" id="5453121">)</span>&nbsp;<span class="op" id="5453123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453127">return</span>&nbsp;<span class="string" id="5453134">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453142">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453184">if</span>&nbsp;<span class="ident" id="5453187">strings</span><span class="op" id="5453194">.</span><span class="ident" id="5453195">IndexAny</span><span class="op" id="5453203">(</span><span class="ident" id="5453204">line</span><span class="op" id="5453208">,</span>&nbsp;<span class="string" id="5453210">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="5453245">)</span>&nbsp;<span class="op" id="5453247">&gt;=</span>&nbsp;<span class="num" id="5453250">0</span>&nbsp;<span class="op" id="5453252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453256">return</span>&nbsp;<span class="string" id="5453263">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453271">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453310">for</span>&nbsp;<span class="ident" id="5453314">b</span>&nbsp;<span class="op" id="5453316">:=</span>&nbsp;<span class="ident" id="5453319">line</span><span class="op" id="5453323">;</span>&nbsp;<span class="op" id="5453325">;</span>&nbsp;<span class="op" id="5453327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453331">i</span>&nbsp;<span class="op" id="5453333">:=</span>&nbsp;<span class="ident" id="5453336">strings</span><span class="op" id="5453343">.</span><span class="ident" id="5453344">IndexRune</span><span class="op" id="5453353">(</span><span class="ident" id="5453354">b</span><span class="op" id="5453355">,</span>&nbsp;<span class="string" id="5453357">&#39;\&#39;&#39;</span><span class="op" id="5453361">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453365">if</span>&nbsp;<span class="ident" id="5453368">i</span>&nbsp;<span class="op" id="5453370">&lt;</span>&nbsp;<span class="num" id="5453372">0</span>&nbsp;<span class="op" id="5453374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453379">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453391">if</span>&nbsp;<span class="ident" id="5453394">i</span><span class="op" id="5453395">+</span><span class="num" id="5453396">1</span>&nbsp;<span class="op" id="5453398">&gt;=</span>&nbsp;<span class="builtinfunc" id="5453401">len</span><span class="op" id="5453404">(</span><span class="ident" id="5453405">b</span><span class="op" id="5453406">)</span>&nbsp;<span class="op" id="5453408">||</span>&nbsp;<span class="ident" id="5453411">b</span><span class="op" id="5453412">[</span><span class="ident" id="5453413">i</span><span class="op" id="5453414">+</span><span class="num" id="5453415">1</span><span class="op" id="5453416">]</span>&nbsp;<span class="op" id="5453418">!=</span>&nbsp;<span class="string" id="5453421">&#39;s&#39;</span>&nbsp;<span class="op" id="5453425">||</span>&nbsp;<span class="op" id="5453428">(</span><span class="ident" id="5453429">i</span><span class="op" id="5453430">+</span><span class="num" id="5453431">2</span>&nbsp;<span class="op" id="5453433">&lt;</span>&nbsp;<span class="builtinfunc" id="5453435">len</span><span class="op" id="5453438">(</span><span class="ident" id="5453439">b</span><span class="op" id="5453440">)</span>&nbsp;<span class="op" id="5453442">&amp;&amp;</span>&nbsp;<span class="ident" id="5453445">b</span><span class="op" id="5453446">[</span><span class="ident" id="5453447">i</span><span class="op" id="5453448">+</span><span class="num" id="5453449">2</span><span class="op" id="5453450">]</span>&nbsp;<span class="op" id="5453452">!=</span>&nbsp;<span class="string" id="5453455">&#39;&nbsp;&#39;</span><span class="op" id="5453458">)</span>&nbsp;<span class="op" id="5453460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453465">return</span>&nbsp;<span class="string" id="5453472">&#34;&#34;</span>&nbsp;<span class="comment" id="5453475">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453505">b</span>&nbsp;<span class="op" id="5453507">=</span>&nbsp;<span class="ident" id="5453509">b</span><span class="op" id="5453510">[</span><span class="ident" id="5453511">i</span><span class="op" id="5453512">+</span><span class="num" id="5453513">2</span><span class="op" id="5453514">:</span><span class="op" id="5453515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453522">return</span>&nbsp;<span class="ident" id="5453529">line</span><br>
<span class="lineno">245</span><span class="op" id="5453534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5453537">type</span>&nbsp;<span class="ident" id="5453542">op</span>&nbsp;<span class="builtintype" id="5453545">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5453550">const</span>&nbsp;<span class="op" id="5453556">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453559">opPara</span>&nbsp;<span class="ident" id="5453566">op</span>&nbsp;<span class="op" id="5453569">=</span>&nbsp;<span class="ident" id="5453571">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453577">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453585">opPre</span><br>
<span class="lineno"></span><span class="op" id="5453591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5453594">type</span>&nbsp;<span class="ident" id="5453599">block</span>&nbsp;<span class="keyword" id="5453605">struct</span>&nbsp;<span class="op" id="5453612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453615">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453621">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453625">lines</span>&nbsp;<span class="op" id="5453631">[</span><span class="op" id="5453632">]</span><span class="builtintype" id="5453633">string</span><br>
<span class="lineno"></span><span class="op" id="5453640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5453643">var</span>&nbsp;<span class="ident" id="5453647">nonAlphaNumRx</span>&nbsp;<span class="op" id="5453661">=</span>&nbsp;<span class="ident" id="5453663">regexp</span><span class="op" id="5453669">.</span><span class="ident" id="5453670">MustCompile</span><span class="op" id="5453681">(</span><span class="string" id="5453682">`[^a-zA-Z0-9]`</span><span class="op" id="5453696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5453699">func</span>&nbsp;<span class="ident" id="5453704">anchorID</span><span class="op" id="5453712">(</span><span class="ident" id="5453713">line</span>&nbsp;<span class="builtintype" id="5453718">string</span><span class="op" id="5453724">)</span>&nbsp;<span class="builtintype" id="5453726">string</span>&nbsp;<span class="op" id="5453733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453736">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453816">return</span>&nbsp;<span class="string" id="5453823">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="5453830">+</span>&nbsp;<span class="ident" id="5453832">nonAlphaNumRx</span><span class="op" id="5453845">.</span><span class="ident" id="5453846">ReplaceAllString</span><span class="op" id="5453862">(</span><span class="ident" id="5453863">line</span><span class="op" id="5453867">,</span>&nbsp;<span class="string" id="5453869">&#34;_&#34;</span><span class="op" id="5453872">)</span><br>
<span class="lineno">265</span><span class="op" id="5453874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453877">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="5453928">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="5453970">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="5454030">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="5454082">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5454132">//</span><br>
<span class="lineno"></span><span class="comment" id="5454135">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5454196">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="5454267">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="5454336">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="5454397">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="5454427">//</span><br>
<span class="lineno"></span><span class="comment" id="5454430">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="5454491">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="5454533">//</span><br>
<span class="lineno"></span><span class="comment" id="5454536">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="5454614">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="5454692">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="5454761">//</span><br>
<span class="lineno"></span><span class="comment" id="5454764">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="5454848">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="5454935">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5454951">func</span>&nbsp;<span class="ident" id="5454956">ToHTML</span><span class="op" id="5454962">(</span><span class="ident" id="5454963">w</span>&nbsp;<span class="ident" id="5454965">io</span><span class="op" id="5454967">.</span><span class="ident" id="5454968">Writer</span><span class="op" id="5454974">,</span>&nbsp;<span class="ident" id="5454976">text</span>&nbsp;<span class="builtintype" id="5454981">string</span><span class="op" id="5454987">,</span>&nbsp;<span class="ident" id="5454989">words</span>&nbsp;<span class="keyword" id="5454995">map</span><span class="op" id="5454998">[</span><span class="builtintype" id="5454999">string</span><span class="op" id="5455005">]</span><span class="builtintype" id="5455006">string</span><span class="op" id="5455012">)</span>&nbsp;<span class="op" id="5455014">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455017">for</span>&nbsp;<span class="ident" id="5455021">_</span><span class="op" id="5455022">,</span>&nbsp;<span class="ident" id="5455024">b</span>&nbsp;<span class="op" id="5455026">:=</span>&nbsp;<span class="keyword" id="5455029">range</span>&nbsp;<span class="ident" id="5455035">blocks</span><span class="op" id="5455041">(</span><span class="ident" id="5455042">text</span><span class="op" id="5455046">)</span>&nbsp;<span class="op" id="5455048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455052">switch</span>&nbsp;<span class="ident" id="5455059">b</span><span class="op" id="5455060">.</span><span class="ident" id="5455061">op</span>&nbsp;<span class="op" id="5455064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455068">case</span>&nbsp;<span class="ident" id="5455073">opPara</span><span class="op" id="5455079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455084">w</span><span class="op" id="5455085">.</span><span class="ident" id="5455086">Write</span><span class="op" id="5455091">(</span><span class="ident" id="5455092">html_p</span><span class="op" id="5455098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455103">for</span>&nbsp;<span class="ident" id="5455107">_</span><span class="op" id="5455108">,</span>&nbsp;<span class="ident" id="5455110">line</span>&nbsp;<span class="op" id="5455115">:=</span>&nbsp;<span class="keyword" id="5455118">range</span>&nbsp;<span class="ident" id="5455124">b</span><span class="op" id="5455125">.</span><span class="ident" id="5455126">lines</span>&nbsp;<span class="op" id="5455132">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455138">emphasize</span><span class="op" id="5455147">(</span><span class="ident" id="5455148">w</span><span class="op" id="5455149">,</span>&nbsp;<span class="ident" id="5455151">line</span><span class="op" id="5455155">,</span>&nbsp;<span class="ident" id="5455157">words</span><span class="op" id="5455162">,</span>&nbsp;<span class="builtintype" id="5455164">true</span><span class="op" id="5455168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455178">w</span><span class="op" id="5455179">.</span><span class="ident" id="5455180">Write</span><span class="op" id="5455185">(</span><span class="ident" id="5455186">html_endp</span><span class="op" id="5455195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455199">case</span>&nbsp;<span class="ident" id="5455204">opHead</span><span class="op" id="5455210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455215">w</span><span class="op" id="5455216">.</span><span class="ident" id="5455217">Write</span><span class="op" id="5455222">(</span><span class="ident" id="5455223">html_h</span><span class="op" id="5455229">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455234">id</span>&nbsp;<span class="op" id="5455237">:=</span>&nbsp;<span class="string" id="5455240">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455246">for</span>&nbsp;<span class="ident" id="5455250">_</span><span class="op" id="5455251">,</span>&nbsp;<span class="ident" id="5455253">line</span>&nbsp;<span class="op" id="5455258">:=</span>&nbsp;<span class="keyword" id="5455261">range</span>&nbsp;<span class="ident" id="5455267">b</span><span class="op" id="5455268">.</span><span class="ident" id="5455269">lines</span>&nbsp;<span class="op" id="5455275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455281">if</span>&nbsp;<span class="ident" id="5455284">id</span>&nbsp;<span class="op" id="5455287">==</span>&nbsp;<span class="string" id="5455290">&#34;&#34;</span>&nbsp;<span class="op" id="5455293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455300">id</span>&nbsp;<span class="op" id="5455303">=</span>&nbsp;<span class="ident" id="5455305">anchorID</span><span class="op" id="5455313">(</span><span class="ident" id="5455314">line</span><span class="op" id="5455318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455325">w</span><span class="op" id="5455326">.</span><span class="ident" id="5455327">Write</span><span class="op" id="5455332">(</span><span class="op" id="5455333">[</span><span class="op" id="5455334">]</span><span class="builtintype" id="5455335">byte</span><span class="op" id="5455339">(</span><span class="ident" id="5455340">id</span><span class="op" id="5455342">)</span><span class="op" id="5455343">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455350">w</span><span class="op" id="5455351">.</span><span class="ident" id="5455352">Write</span><span class="op" id="5455357">(</span><span class="ident" id="5455358">html_hq</span><span class="op" id="5455365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455377">commentEscape</span><span class="op" id="5455390">(</span><span class="ident" id="5455391">w</span><span class="op" id="5455392">,</span>&nbsp;<span class="ident" id="5455394">line</span><span class="op" id="5455398">,</span>&nbsp;<span class="builtintype" id="5455400">true</span><span class="op" id="5455404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455414">if</span>&nbsp;<span class="ident" id="5455417">id</span>&nbsp;<span class="op" id="5455420">==</span>&nbsp;<span class="string" id="5455423">&#34;&#34;</span>&nbsp;<span class="op" id="5455426">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455432">w</span><span class="op" id="5455433">.</span><span class="ident" id="5455434">Write</span><span class="op" id="5455439">(</span><span class="ident" id="5455440">html_hq</span><span class="op" id="5455447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455457">w</span><span class="op" id="5455458">.</span><span class="ident" id="5455459">Write</span><span class="op" id="5455464">(</span><span class="ident" id="5455465">html_endh</span><span class="op" id="5455474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455478">case</span>&nbsp;<span class="ident" id="5455483">opPre</span><span class="op" id="5455488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455493">w</span><span class="op" id="5455494">.</span><span class="ident" id="5455495">Write</span><span class="op" id="5455500">(</span><span class="ident" id="5455501">html_pre</span><span class="op" id="5455509">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455514">for</span>&nbsp;<span class="ident" id="5455518">_</span><span class="op" id="5455519">,</span>&nbsp;<span class="ident" id="5455521">line</span>&nbsp;<span class="op" id="5455526">:=</span>&nbsp;<span class="keyword" id="5455529">range</span>&nbsp;<span class="ident" id="5455535">b</span><span class="op" id="5455536">.</span><span class="ident" id="5455537">lines</span>&nbsp;<span class="op" id="5455543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455549">emphasize</span><span class="op" id="5455558">(</span><span class="ident" id="5455559">w</span><span class="op" id="5455560">,</span>&nbsp;<span class="ident" id="5455562">line</span><span class="op" id="5455566">,</span>&nbsp;<span class="builtintype" id="5455568">nil</span><span class="op" id="5455571">,</span>&nbsp;<span class="builtintype" id="5455573">false</span><span class="op" id="5455578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455588">w</span><span class="op" id="5455589">.</span><span class="ident" id="5455590">Write</span><span class="op" id="5455595">(</span><span class="ident" id="5455596">html_endpre</span><span class="op" id="5455607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455611">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455614">}</span><br>
<span class="lineno"></span><span class="op" id="5455616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5455619">func</span>&nbsp;<span class="ident" id="5455624">blocks</span><span class="op" id="5455630">(</span><span class="ident" id="5455631">text</span>&nbsp;<span class="builtintype" id="5455636">string</span><span class="op" id="5455642">)</span>&nbsp;<span class="op" id="5455644">[</span><span class="op" id="5455645">]</span><span class="ident" id="5455646">block</span>&nbsp;<span class="op" id="5455652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455655">var</span>&nbsp;<span class="op" id="5455659">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455663">out</span>&nbsp;&nbsp;<span class="op" id="5455668">[</span><span class="op" id="5455669">]</span><span class="ident" id="5455670">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455678">para</span>&nbsp;<span class="op" id="5455683">[</span><span class="op" id="5455684">]</span><span class="builtintype" id="5455685">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455695">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5455710">=</span>&nbsp;<span class="builtintype" id="5455712">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455720">lastWasHeading</span>&nbsp;<span class="op" id="5455735">=</span>&nbsp;<span class="builtintype" id="5455737">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455744">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5455748">close</span>&nbsp;<span class="op" id="5455754">:=</span>&nbsp;<span class="keyword" id="5455757">func</span><span class="op" id="5455761">(</span><span class="op" id="5455762">)</span>&nbsp;<span class="op" id="5455764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455768">if</span>&nbsp;<span class="ident" id="5455771">para</span>&nbsp;<span class="op" id="5455776">!=</span>&nbsp;<span class="builtintype" id="5455779">nil</span>&nbsp;<span class="op" id="5455783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455788">out</span>&nbsp;<span class="op" id="5455792">=</span>&nbsp;<span class="builtinfunc" id="5455794">append</span><span class="op" id="5455800">(</span><span class="ident" id="5455801">out</span><span class="op" id="5455804">,</span>&nbsp;<span class="ident" id="5455806">block</span><span class="op" id="5455811">{</span><span class="ident" id="5455812">opPara</span><span class="op" id="5455818">,</span>&nbsp;<span class="ident" id="5455820">para</span><span class="op" id="5455824">}</span><span class="op" id="5455825">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455830">para</span>&nbsp;<span class="op" id="5455835">=</span>&nbsp;<span class="builtintype" id="5455837">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455850">lines</span>&nbsp;<span class="op" id="5455856">:=</span>&nbsp;<span class="ident" id="5455859">strings</span><span class="op" id="5455866">.</span><span class="ident" id="5455867">SplitAfter</span><span class="op" id="5455877">(</span><span class="ident" id="5455878">text</span><span class="op" id="5455882">,</span>&nbsp;<span class="string" id="5455884">&#34;\n&#34;</span><span class="op" id="5455888">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455891">unindent</span><span class="op" id="5455899">(</span><span class="ident" id="5455900">lines</span><span class="op" id="5455905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455908">for</span>&nbsp;<span class="ident" id="5455912">i</span>&nbsp;<span class="op" id="5455914">:=</span>&nbsp;<span class="num" id="5455917">0</span><span class="op" id="5455918">;</span>&nbsp;<span class="ident" id="5455920">i</span>&nbsp;<span class="op" id="5455922">&lt;</span>&nbsp;<span class="builtinfunc" id="5455924">len</span><span class="op" id="5455927">(</span><span class="ident" id="5455928">lines</span><span class="op" id="5455933">)</span><span class="op" id="5455934">;</span>&nbsp;<span class="op" id="5455936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455940">line</span>&nbsp;<span class="op" id="5455945">:=</span>&nbsp;<span class="ident" id="5455948">lines</span><span class="op" id="5455953">[</span><span class="ident" id="5455954">i</span><span class="op" id="5455955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455959">if</span>&nbsp;<span class="ident" id="5455962">isBlank</span><span class="op" id="5455969">(</span><span class="ident" id="5455970">line</span><span class="op" id="5455974">)</span>&nbsp;<span class="op" id="5455976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455981">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5456003">close</span><span class="op" id="5456008">(</span><span class="op" id="5456009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456014">i</span><span class="op" id="5456015">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456021">lastWasBlank</span>&nbsp;<span class="op" id="5456034">=</span>&nbsp;<span class="builtintype" id="5456036">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456044">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456055">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456059">if</span>&nbsp;<span class="ident" id="5456062">indentLen</span><span class="op" id="5456071">(</span><span class="ident" id="5456072">line</span><span class="op" id="5456076">)</span>&nbsp;<span class="op" id="5456078">&gt;</span>&nbsp;<span class="num" id="5456080">0</span>&nbsp;<span class="op" id="5456082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456087">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5456109">close</span><span class="op" id="5456114">(</span><span class="op" id="5456115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456121">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456157">j</span>&nbsp;<span class="op" id="5456159">:=</span>&nbsp;<span class="ident" id="5456162">i</span>&nbsp;<span class="op" id="5456164">+</span>&nbsp;<span class="num" id="5456166">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456171">for</span>&nbsp;<span class="ident" id="5456175">j</span>&nbsp;<span class="op" id="5456177">&lt;</span>&nbsp;<span class="builtinfunc" id="5456179">len</span><span class="op" id="5456182">(</span><span class="ident" id="5456183">lines</span><span class="op" id="5456188">)</span>&nbsp;<span class="op" id="5456190">&amp;&amp;</span>&nbsp;<span class="op" id="5456193">(</span><span class="ident" id="5456194">isBlank</span><span class="op" id="5456201">(</span><span class="ident" id="5456202">lines</span><span class="op" id="5456207">[</span><span class="ident" id="5456208">j</span><span class="op" id="5456209">]</span><span class="op" id="5456210">)</span>&nbsp;<span class="op" id="5456212">||</span>&nbsp;<span class="ident" id="5456215">indentLen</span><span class="op" id="5456224">(</span><span class="ident" id="5456225">lines</span><span class="op" id="5456230">[</span><span class="ident" id="5456231">j</span><span class="op" id="5456232">]</span><span class="op" id="5456233">)</span>&nbsp;<span class="op" id="5456235">&gt;</span>&nbsp;<span class="num" id="5456237">0</span><span class="op" id="5456238">)</span>&nbsp;<span class="op" id="5456240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456246">j</span><span class="op" id="5456247">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456258">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456293">for</span>&nbsp;<span class="ident" id="5456297">j</span>&nbsp;<span class="op" id="5456299">&gt;</span>&nbsp;<span class="ident" id="5456301">i</span>&nbsp;<span class="op" id="5456303">&amp;&amp;</span>&nbsp;<span class="ident" id="5456306">isBlank</span><span class="op" id="5456313">(</span><span class="ident" id="5456314">lines</span><span class="op" id="5456319">[</span><span class="ident" id="5456320">j</span><span class="op" id="5456321">-</span><span class="num" id="5456322">1</span><span class="op" id="5456323">]</span><span class="op" id="5456324">)</span>&nbsp;<span class="op" id="5456326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456332">j</span><span class="op" id="5456333">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456344">pre</span>&nbsp;<span class="op" id="5456348">:=</span>&nbsp;<span class="ident" id="5456351">lines</span><span class="op" id="5456356">[</span><span class="ident" id="5456357">i</span><span class="op" id="5456358">:</span><span class="ident" id="5456359">j</span><span class="op" id="5456360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456365">i</span>&nbsp;<span class="op" id="5456367">=</span>&nbsp;<span class="ident" id="5456369">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456375">unindent</span><span class="op" id="5456383">(</span><span class="ident" id="5456384">pre</span><span class="op" id="5456387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456393">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456430">out</span>&nbsp;<span class="op" id="5456434">=</span>&nbsp;<span class="builtinfunc" id="5456436">append</span><span class="op" id="5456442">(</span><span class="ident" id="5456443">out</span><span class="op" id="5456446">,</span>&nbsp;<span class="ident" id="5456448">block</span><span class="op" id="5456453">{</span><span class="ident" id="5456454">opPre</span><span class="op" id="5456459">,</span>&nbsp;<span class="ident" id="5456461">pre</span><span class="op" id="5456464">}</span><span class="op" id="5456465">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456470">lastWasHeading</span>&nbsp;<span class="op" id="5456485">=</span>&nbsp;<span class="builtintype" id="5456487">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456496">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456512">if</span>&nbsp;<span class="ident" id="5456515">lastWasBlank</span>&nbsp;<span class="op" id="5456528">&amp;&amp;</span>&nbsp;<span class="op" id="5456531">!</span><span class="ident" id="5456532">lastWasHeading</span>&nbsp;<span class="op" id="5456547">&amp;&amp;</span>&nbsp;<span class="ident" id="5456550">i</span><span class="op" id="5456551">+</span><span class="num" id="5456552">2</span>&nbsp;<span class="op" id="5456554">&lt;</span>&nbsp;<span class="builtinfunc" id="5456556">len</span><span class="op" id="5456559">(</span><span class="ident" id="5456560">lines</span><span class="op" id="5456565">)</span>&nbsp;<span class="op" id="5456567">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456573">isBlank</span><span class="op" id="5456580">(</span><span class="ident" id="5456581">lines</span><span class="op" id="5456586">[</span><span class="ident" id="5456587">i</span><span class="op" id="5456588">+</span><span class="num" id="5456589">1</span><span class="op" id="5456590">]</span><span class="op" id="5456591">)</span>&nbsp;<span class="op" id="5456593">&amp;&amp;</span>&nbsp;<span class="op" id="5456596">!</span><span class="ident" id="5456597">isBlank</span><span class="op" id="5456604">(</span><span class="ident" id="5456605">lines</span><span class="op" id="5456610">[</span><span class="ident" id="5456611">i</span><span class="op" id="5456612">+</span><span class="num" id="5456613">2</span><span class="op" id="5456614">]</span><span class="op" id="5456615">)</span>&nbsp;<span class="op" id="5456617">&amp;&amp;</span>&nbsp;<span class="ident" id="5456620">indentLen</span><span class="op" id="5456629">(</span><span class="ident" id="5456630">lines</span><span class="op" id="5456635">[</span><span class="ident" id="5456636">i</span><span class="op" id="5456637">+</span><span class="num" id="5456638">2</span><span class="op" id="5456639">]</span><span class="op" id="5456640">)</span>&nbsp;<span class="op" id="5456642">==</span>&nbsp;<span class="num" id="5456645">0</span>&nbsp;<span class="op" id="5456647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456652">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456711">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456767">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456793">if</span>&nbsp;<span class="ident" id="5456796">head</span>&nbsp;<span class="op" id="5456801">:=</span>&nbsp;<span class="ident" id="5456804">heading</span><span class="op" id="5456811">(</span><span class="ident" id="5456812">line</span><span class="op" id="5456816">)</span><span class="op" id="5456817">;</span>&nbsp;<span class="ident" id="5456819">head</span>&nbsp;<span class="op" id="5456824">!=</span>&nbsp;<span class="string" id="5456827">&#34;&#34;</span>&nbsp;<span class="op" id="5456830">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5456836">close</span><span class="op" id="5456841">(</span><span class="op" id="5456842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456848">out</span>&nbsp;<span class="op" id="5456852">=</span>&nbsp;<span class="builtinfunc" id="5456854">append</span><span class="op" id="5456860">(</span><span class="ident" id="5456861">out</span><span class="op" id="5456864">,</span>&nbsp;<span class="ident" id="5456866">block</span><span class="op" id="5456871">{</span><span class="ident" id="5456872">opHead</span><span class="op" id="5456878">,</span>&nbsp;<span class="op" id="5456880">[</span><span class="op" id="5456881">]</span><span class="builtintype" id="5456882">string</span><span class="op" id="5456888">{</span><span class="ident" id="5456889">head</span><span class="op" id="5456893">}</span><span class="op" id="5456894">}</span><span class="op" id="5456895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456901">i</span>&nbsp;<span class="op" id="5456903">+=</span>&nbsp;<span class="num" id="5456906">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456912">lastWasHeading</span>&nbsp;<span class="op" id="5456927">=</span>&nbsp;<span class="builtintype" id="5456929">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456938">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456959">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456979">lastWasBlank</span>&nbsp;<span class="op" id="5456992">=</span>&nbsp;<span class="builtintype" id="5456994">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457002">lastWasHeading</span>&nbsp;<span class="op" id="5457017">=</span>&nbsp;<span class="builtintype" id="5457019">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457027">para</span>&nbsp;<span class="op" id="5457032">=</span>&nbsp;<span class="builtinfunc" id="5457034">append</span><span class="op" id="5457040">(</span><span class="ident" id="5457041">para</span><span class="op" id="5457045">,</span>&nbsp;<span class="ident" id="5457047">lines</span><span class="op" id="5457052">[</span><span class="ident" id="5457053">i</span><span class="op" id="5457054">]</span><span class="op" id="5457055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457059">i</span><span class="op" id="5457060">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5457067">close</span><span class="op" id="5457072">(</span><span class="op" id="5457073">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457077">return</span>&nbsp;<span class="ident" id="5457084">out</span><br>
<span class="lineno"></span><span class="op" id="5457088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5457091">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="5457159">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="5457228">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="5457302">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="5457377">func</span>&nbsp;<span class="ident" id="5457382">ToText</span><span class="op" id="5457388">(</span><span class="ident" id="5457389">w</span>&nbsp;<span class="ident" id="5457391">io</span><span class="op" id="5457393">.</span><span class="ident" id="5457394">Writer</span><span class="op" id="5457400">,</span>&nbsp;<span class="ident" id="5457402">text</span>&nbsp;<span class="builtintype" id="5457407">string</span><span class="op" id="5457413">,</span>&nbsp;<span class="ident" id="5457415">indent</span><span class="op" id="5457421">,</span>&nbsp;<span class="ident" id="5457423">preIndent</span>&nbsp;<span class="builtintype" id="5457433">string</span><span class="op" id="5457439">,</span>&nbsp;<span class="ident" id="5457441">width</span>&nbsp;<span class="builtintype" id="5457447">int</span><span class="op" id="5457450">)</span>&nbsp;<span class="op" id="5457452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457455">l</span>&nbsp;<span class="op" id="5457457">:=</span>&nbsp;<span class="ident" id="5457460">lineWrapper</span><span class="op" id="5457471">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457475">out</span><span class="op" id="5457478">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457483">w</span><span class="op" id="5457484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457488">width</span><span class="op" id="5457493">:</span>&nbsp;&nbsp;<span class="ident" id="5457496">width</span><span class="op" id="5457501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457505">indent</span><span class="op" id="5457511">:</span>&nbsp;<span class="ident" id="5457513">indent</span><span class="op" id="5457519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457525">for</span>&nbsp;<span class="ident" id="5457529">_</span><span class="op" id="5457530">,</span>&nbsp;<span class="ident" id="5457532">b</span>&nbsp;<span class="op" id="5457534">:=</span>&nbsp;<span class="keyword" id="5457537">range</span>&nbsp;<span class="ident" id="5457543">blocks</span><span class="op" id="5457549">(</span><span class="ident" id="5457550">text</span><span class="op" id="5457554">)</span>&nbsp;<span class="op" id="5457556">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457560">switch</span>&nbsp;<span class="ident" id="5457567">b</span><span class="op" id="5457568">.</span><span class="ident" id="5457569">op</span>&nbsp;<span class="op" id="5457572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457576">case</span>&nbsp;<span class="ident" id="5457581">opPara</span><span class="op" id="5457587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457592">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457643">for</span>&nbsp;<span class="ident" id="5457647">_</span><span class="op" id="5457648">,</span>&nbsp;<span class="ident" id="5457650">line</span>&nbsp;<span class="op" id="5457655">:=</span>&nbsp;<span class="keyword" id="5457658">range</span>&nbsp;<span class="ident" id="5457664">b</span><span class="op" id="5457665">.</span><span class="ident" id="5457666">lines</span>&nbsp;<span class="op" id="5457672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457678">l</span><span class="op" id="5457679">.</span><span class="ident" id="5457680">write</span><span class="op" id="5457685">(</span><span class="ident" id="5457686">line</span><span class="op" id="5457690">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457700">l</span><span class="op" id="5457701">.</span><span class="ident" id="5457702">flush</span><span class="op" id="5457707">(</span><span class="op" id="5457708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457712">case</span>&nbsp;<span class="ident" id="5457717">opHead</span><span class="op" id="5457723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457728">w</span><span class="op" id="5457729">.</span><span class="ident" id="5457730">Write</span><span class="op" id="5457735">(</span><span class="ident" id="5457736">nl</span><span class="op" id="5457738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457743">for</span>&nbsp;<span class="ident" id="5457747">_</span><span class="op" id="5457748">,</span>&nbsp;<span class="ident" id="5457750">line</span>&nbsp;<span class="op" id="5457755">:=</span>&nbsp;<span class="keyword" id="5457758">range</span>&nbsp;<span class="ident" id="5457764">b</span><span class="op" id="5457765">.</span><span class="ident" id="5457766">lines</span>&nbsp;<span class="op" id="5457772">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457778">l</span><span class="op" id="5457779">.</span><span class="ident" id="5457780">write</span><span class="op" id="5457785">(</span><span class="ident" id="5457786">line</span>&nbsp;<span class="op" id="5457791">+</span>&nbsp;<span class="string" id="5457793">&#34;\n&#34;</span><span class="op" id="5457797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457807">l</span><span class="op" id="5457808">.</span><span class="ident" id="5457809">flush</span><span class="op" id="5457814">(</span><span class="op" id="5457815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457819">case</span>&nbsp;<span class="ident" id="5457824">opPre</span><span class="op" id="5457829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457834">w</span><span class="op" id="5457835">.</span><span class="ident" id="5457836">Write</span><span class="op" id="5457841">(</span><span class="ident" id="5457842">nl</span><span class="op" id="5457844">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457849">for</span>&nbsp;<span class="ident" id="5457853">_</span><span class="op" id="5457854">,</span>&nbsp;<span class="ident" id="5457856">line</span>&nbsp;<span class="op" id="5457861">:=</span>&nbsp;<span class="keyword" id="5457864">range</span>&nbsp;<span class="ident" id="5457870">b</span><span class="op" id="5457871">.</span><span class="ident" id="5457872">lines</span>&nbsp;<span class="op" id="5457878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457884">if</span>&nbsp;<span class="ident" id="5457887">isBlank</span><span class="op" id="5457894">(</span><span class="ident" id="5457895">line</span><span class="op" id="5457899">)</span>&nbsp;<span class="op" id="5457901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457908">w</span><span class="op" id="5457909">.</span><span class="ident" id="5457910">Write</span><span class="op" id="5457915">(</span><span class="op" id="5457916">[</span><span class="op" id="5457917">]</span><span class="builtintype" id="5457918">byte</span><span class="op" id="5457922">(</span><span class="string" id="5457923">&#34;\n&#34;</span><span class="op" id="5457927">)</span><span class="op" id="5457928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457934">}</span>&nbsp;<span class="keyword" id="5457936">else</span>&nbsp;<span class="op" id="5457941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457948">w</span><span class="op" id="5457949">.</span><span class="ident" id="5457950">Write</span><span class="op" id="5457955">(</span><span class="op" id="5457956">[</span><span class="op" id="5457957">]</span><span class="builtintype" id="5457958">byte</span><span class="op" id="5457962">(</span><span class="ident" id="5457963">preIndent</span><span class="op" id="5457972">)</span><span class="op" id="5457973">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457980">w</span><span class="op" id="5457981">.</span><span class="ident" id="5457982">Write</span><span class="op" id="5457987">(</span><span class="op" id="5457988">[</span><span class="op" id="5457989">]</span><span class="builtintype" id="5457990">byte</span><span class="op" id="5457994">(</span><span class="ident" id="5457995">line</span><span class="op" id="5457999">)</span><span class="op" id="5458000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458018">}</span><br>
<span class="lineno">435</span><span class="op" id="5458020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458023">type</span>&nbsp;<span class="ident" id="5458028">lineWrapper</span>&nbsp;<span class="keyword" id="5458040">struct</span>&nbsp;<span class="op" id="5458047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458050">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458060">io</span><span class="op" id="5458062">.</span><span class="ident" id="5458063">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458071">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5458081">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458087">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5458097">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458102">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5458112">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458120">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5458130">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458135">pendSpace</span>&nbsp;<span class="builtintype" id="5458145">int</span><br>
<span class="lineno"></span><span class="op" id="5458149">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="5458152">var</span>&nbsp;<span class="ident" id="5458156">nl</span>&nbsp;<span class="op" id="5458159">=</span>&nbsp;<span class="op" id="5458161">[</span><span class="op" id="5458162">]</span><span class="builtintype" id="5458163">byte</span><span class="op" id="5458167">(</span><span class="string" id="5458168">&#34;\n&#34;</span><span class="op" id="5458172">)</span><br>
<span class="lineno"></span><span class="keyword" id="5458174">var</span>&nbsp;<span class="ident" id="5458178">space</span>&nbsp;<span class="op" id="5458184">=</span>&nbsp;<span class="op" id="5458186">[</span><span class="op" id="5458187">]</span><span class="builtintype" id="5458188">byte</span><span class="op" id="5458192">(</span><span class="string" id="5458193">&#34;&nbsp;&#34;</span><span class="op" id="5458196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458199">func</span>&nbsp;<span class="op" id="5458204">(</span><span class="ident" id="5458205">l</span>&nbsp;<span class="op" id="5458207">*</span><span class="ident" id="5458208">lineWrapper</span><span class="op" id="5458219">)</span>&nbsp;<span class="ident" id="5458221">write</span><span class="op" id="5458226">(</span><span class="ident" id="5458227">text</span>&nbsp;<span class="builtintype" id="5458232">string</span><span class="op" id="5458238">)</span>&nbsp;<span class="op" id="5458240">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458243">if</span>&nbsp;<span class="ident" id="5458246">l</span><span class="op" id="5458247">.</span><span class="ident" id="5458248">n</span>&nbsp;<span class="op" id="5458250">==</span>&nbsp;<span class="num" id="5458253">0</span>&nbsp;<span class="op" id="5458255">&amp;&amp;</span>&nbsp;<span class="ident" id="5458258">l</span><span class="op" id="5458259">.</span><span class="ident" id="5458260">printed</span>&nbsp;<span class="op" id="5458268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458272">l</span><span class="op" id="5458273">.</span><span class="ident" id="5458274">out</span><span class="op" id="5458277">.</span><span class="ident" id="5458278">Write</span><span class="op" id="5458283">(</span><span class="ident" id="5458284">nl</span><span class="op" id="5458286">)</span>&nbsp;<span class="comment" id="5458288">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458327">l</span><span class="op" id="5458328">.</span><span class="ident" id="5458329">printed</span>&nbsp;<span class="op" id="5458337">=</span>&nbsp;<span class="builtintype" id="5458339">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458346">for</span>&nbsp;<span class="ident" id="5458350">_</span><span class="op" id="5458351">,</span>&nbsp;<span class="ident" id="5458353">f</span>&nbsp;<span class="op" id="5458355">:=</span>&nbsp;<span class="keyword" id="5458358">range</span>&nbsp;<span class="ident" id="5458364">strings</span><span class="op" id="5458371">.</span><span class="ident" id="5458372">Fields</span><span class="op" id="5458378">(</span><span class="ident" id="5458379">text</span><span class="op" id="5458383">)</span>&nbsp;<span class="op" id="5458385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458389">w</span>&nbsp;<span class="op" id="5458391">:=</span>&nbsp;<span class="ident" id="5458394">utf8</span><span class="op" id="5458398">.</span><span class="ident" id="5458399">RuneCountInString</span><span class="op" id="5458416">(</span><span class="ident" id="5458417">f</span><span class="op" id="5458418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458422">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458452">if</span>&nbsp;<span class="ident" id="5458455">l</span><span class="op" id="5458456">.</span><span class="ident" id="5458457">n</span>&nbsp;<span class="op" id="5458459">&gt;</span>&nbsp;<span class="num" id="5458461">0</span>&nbsp;<span class="op" id="5458463">&amp;&amp;</span>&nbsp;<span class="ident" id="5458466">l</span><span class="op" id="5458467">.</span><span class="ident" id="5458468">n</span><span class="op" id="5458469">+</span><span class="ident" id="5458470">l</span><span class="op" id="5458471">.</span><span class="ident" id="5458472">pendSpace</span><span class="op" id="5458481">+</span><span class="ident" id="5458482">w</span>&nbsp;<span class="op" id="5458484">&gt;</span>&nbsp;<span class="ident" id="5458486">l</span><span class="op" id="5458487">.</span><span class="ident" id="5458488">width</span>&nbsp;<span class="op" id="5458494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458499">l</span><span class="op" id="5458500">.</span><span class="ident" id="5458501">out</span><span class="op" id="5458504">.</span><span class="ident" id="5458505">Write</span><span class="op" id="5458510">(</span><span class="ident" id="5458511">nl</span><span class="op" id="5458513">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458518">l</span><span class="op" id="5458519">.</span><span class="ident" id="5458520">n</span>&nbsp;<span class="op" id="5458522">=</span>&nbsp;<span class="num" id="5458524">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458529">l</span><span class="op" id="5458530">.</span><span class="ident" id="5458531">pendSpace</span>&nbsp;<span class="op" id="5458541">=</span>&nbsp;<span class="num" id="5458543">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458551">if</span>&nbsp;<span class="ident" id="5458554">l</span><span class="op" id="5458555">.</span><span class="ident" id="5458556">n</span>&nbsp;<span class="op" id="5458558">==</span>&nbsp;<span class="num" id="5458561">0</span>&nbsp;<span class="op" id="5458563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458568">l</span><span class="op" id="5458569">.</span><span class="ident" id="5458570">out</span><span class="op" id="5458573">.</span><span class="ident" id="5458574">Write</span><span class="op" id="5458579">(</span><span class="op" id="5458580">[</span><span class="op" id="5458581">]</span><span class="builtintype" id="5458582">byte</span><span class="op" id="5458586">(</span><span class="ident" id="5458587">l</span><span class="op" id="5458588">.</span><span class="ident" id="5458589">indent</span><span class="op" id="5458595">)</span><span class="op" id="5458596">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458604">l</span><span class="op" id="5458605">.</span><span class="ident" id="5458606">out</span><span class="op" id="5458609">.</span><span class="ident" id="5458610">Write</span><span class="op" id="5458615">(</span><span class="ident" id="5458616">space</span><span class="op" id="5458621">[</span><span class="op" id="5458622">:</span><span class="ident" id="5458623">l</span><span class="op" id="5458624">.</span><span class="ident" id="5458625">pendSpace</span><span class="op" id="5458634">]</span><span class="op" id="5458635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458639">l</span><span class="op" id="5458640">.</span><span class="ident" id="5458641">out</span><span class="op" id="5458644">.</span><span class="ident" id="5458645">Write</span><span class="op" id="5458650">(</span><span class="op" id="5458651">[</span><span class="op" id="5458652">]</span><span class="builtintype" id="5458653">byte</span><span class="op" id="5458657">(</span><span class="ident" id="5458658">f</span><span class="op" id="5458659">)</span><span class="op" id="5458660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458664">l</span><span class="op" id="5458665">.</span><span class="ident" id="5458666">n</span>&nbsp;<span class="op" id="5458668">+=</span>&nbsp;<span class="ident" id="5458671">l</span><span class="op" id="5458672">.</span><span class="ident" id="5458673">pendSpace</span>&nbsp;<span class="op" id="5458683">+</span>&nbsp;<span class="ident" id="5458685">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458689">l</span><span class="op" id="5458690">.</span><span class="ident" id="5458691">pendSpace</span>&nbsp;<span class="op" id="5458701">=</span>&nbsp;<span class="num" id="5458703">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458706">}</span><br>
<span class="lineno"></span><span class="op" id="5458708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5458711">func</span>&nbsp;<span class="op" id="5458716">(</span><span class="ident" id="5458717">l</span>&nbsp;<span class="op" id="5458719">*</span><span class="ident" id="5458720">lineWrapper</span><span class="op" id="5458731">)</span>&nbsp;<span class="ident" id="5458733">flush</span><span class="op" id="5458738">(</span><span class="op" id="5458739">)</span>&nbsp;<span class="op" id="5458741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458744">if</span>&nbsp;<span class="ident" id="5458747">l</span><span class="op" id="5458748">.</span><span class="ident" id="5458749">n</span>&nbsp;<span class="op" id="5458751">==</span>&nbsp;<span class="num" id="5458754">0</span>&nbsp;<span class="op" id="5458756">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458760">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458771">l</span><span class="op" id="5458772">.</span><span class="ident" id="5458773">out</span><span class="op" id="5458776">.</span><span class="ident" id="5458777">Write</span><span class="op" id="5458782">(</span><span class="ident" id="5458783">nl</span><span class="op" id="5458785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458788">l</span><span class="op" id="5458789">.</span><span class="ident" id="5458790">pendSpace</span>&nbsp;<span class="op" id="5458800">=</span>&nbsp;<span class="num" id="5458802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458805">l</span><span class="op" id="5458806">.</span><span class="ident" id="5458807">n</span>&nbsp;<span class="op" id="5458809">=</span>&nbsp;<span class="num" id="5458811">0</span><br>
<span class="lineno">480</span><span class="op" id="5458813">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
