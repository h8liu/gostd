<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html" class="current">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5852309">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5852364">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5852418">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5852469">package</span>&nbsp;<span class="ident" id="5852477">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5852485">import</span>&nbsp;<span class="string" id="5852492">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852498">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="5852550">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5852587">func</span>&nbsp;<span class="ident" id="5852592">TruncateWriter</span><span class="op" id="5852606">(</span><span class="ident" id="5852607">w</span>&nbsp;<span class="ident" id="5852609">io</span><span class="op" id="5852611">.</span><span class="ident" id="5852612">Writer</span><span class="op" id="5852618">,</span>&nbsp;<span class="ident" id="5852620">n</span>&nbsp;<span class="ident" id="5852622">int64</span><span class="op" id="5852627">)</span>&nbsp;<span class="ident" id="5852629">io</span><span class="op" id="5852631">.</span><span class="ident" id="5852632">Writer</span>&nbsp;<span class="op" id="5852639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852642">return</span>&nbsp;<span class="op" id="5852649">&amp;</span><span class="ident" id="5852650">truncateWriter</span><span class="op" id="5852664">{</span><span class="ident" id="5852665">w</span><span class="op" id="5852666">,</span>&nbsp;<span class="ident" id="5852668">n</span><span class="op" id="5852669">}</span><br>
<span class="lineno"></span><span class="op" id="5852671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5852674">type</span>&nbsp;<span class="ident" id="5852679">truncateWriter</span>&nbsp;<span class="keyword" id="5852694">struct</span>&nbsp;<span class="op" id="5852701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852704">w</span>&nbsp;<span class="ident" id="5852706">io</span><span class="op" id="5852708">.</span><span class="ident" id="5852709">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852717">n</span>&nbsp;<span class="ident" id="5852719">int64</span><br>
<span class="lineno"></span><span class="op" id="5852725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5852728">func</span>&nbsp;<span class="op" id="5852733">(</span><span class="ident" id="5852734">t</span>&nbsp;<span class="op" id="5852736">*</span><span class="ident" id="5852737">truncateWriter</span><span class="op" id="5852751">)</span>&nbsp;<span class="ident" id="5852753">Write</span><span class="op" id="5852758">(</span><span class="ident" id="5852759">p</span>&nbsp;<span class="op" id="5852761">[</span><span class="op" id="5852762">]</span><span class="builtintype" id="5852763">byte</span><span class="op" id="5852767">)</span>&nbsp;<span class="op" id="5852769">(</span><span class="ident" id="5852770">n</span>&nbsp;<span class="builtintype" id="5852772">int</span><span class="op" id="5852775">,</span>&nbsp;<span class="ident" id="5852777">err</span>&nbsp;<span class="builtintype" id="5852781">error</span><span class="op" id="5852786">)</span>&nbsp;<span class="op" id="5852788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852791">if</span>&nbsp;<span class="ident" id="5852794">t</span><span class="op" id="5852795">.</span><span class="ident" id="5852796">n</span>&nbsp;<span class="op" id="5852798">&lt;=</span>&nbsp;<span class="num" id="5852801">0</span>&nbsp;<span class="op" id="5852803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852807">return</span>&nbsp;<span class="builtinfunc" id="5852814">len</span><span class="op" id="5852817">(</span><span class="ident" id="5852818">p</span><span class="op" id="5852819">)</span><span class="op" id="5852820">,</span>&nbsp;<span class="ident" id="5852822">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5852830">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852845">n</span>&nbsp;<span class="op" id="5852847">=</span>&nbsp;<span class="builtinfunc" id="5852849">len</span><span class="op" id="5852852">(</span><span class="ident" id="5852853">p</span><span class="op" id="5852854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852857">if</span>&nbsp;<span class="ident" id="5852860">int64</span><span class="op" id="5852865">(</span><span class="ident" id="5852866">n</span><span class="op" id="5852867">)</span>&nbsp;<span class="op" id="5852869">&gt;</span>&nbsp;<span class="ident" id="5852871">t</span><span class="op" id="5852872">.</span><span class="ident" id="5852873">n</span>&nbsp;<span class="op" id="5852875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852879">n</span>&nbsp;<span class="op" id="5852881">=</span>&nbsp;<span class="builtintype" id="5852883">int</span><span class="op" id="5852886">(</span><span class="ident" id="5852887">t</span><span class="op" id="5852888">.</span><span class="ident" id="5852889">n</span><span class="op" id="5852890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852896">n</span><span class="op" id="5852897">,</span>&nbsp;<span class="ident" id="5852899">err</span>&nbsp;<span class="op" id="5852903">=</span>&nbsp;<span class="ident" id="5852905">t</span><span class="op" id="5852906">.</span><span class="ident" id="5852907">w</span><span class="op" id="5852908">.</span><span class="ident" id="5852909">Write</span><span class="op" id="5852914">(</span><span class="ident" id="5852915">p</span><span class="op" id="5852916">[</span><span class="num" id="5852917">0</span><span class="op" id="5852918">:</span><span class="ident" id="5852919">n</span><span class="op" id="5852920">]</span><span class="op" id="5852921">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852924">t</span><span class="op" id="5852925">.</span><span class="ident" id="5852926">n</span>&nbsp;<span class="op" id="5852928">-=</span>&nbsp;<span class="ident" id="5852931">int64</span><span class="op" id="5852936">(</span><span class="ident" id="5852937">n</span><span class="op" id="5852938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852941">if</span>&nbsp;<span class="ident" id="5852944">err</span>&nbsp;<span class="op" id="5852948">==</span>&nbsp;<span class="ident" id="5852951">nil</span>&nbsp;<span class="op" id="5852955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852959">n</span>&nbsp;<span class="op" id="5852961">=</span>&nbsp;<span class="builtinfunc" id="5852963">len</span><span class="op" id="5852966">(</span><span class="ident" id="5852967">p</span><span class="op" id="5852968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5852971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852974">return</span><br>
<span class="lineno">35</span><span class="op" id="5852981">}</span>
</div>
</body>
</html>
