<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6391443">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6391498">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6391552">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6391603">package</span>&nbsp;<span class="ident" id="6391611">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6391616">import</span>&nbsp;<span class="op" id="6391623">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391626">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391635">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391641">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391652">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6391663">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6391678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6391681">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6391731">//</span><br>
<span class="lineno"></span><span class="comment" id="6391734">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6391803">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6391879">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6391959">//</span><br>
<span class="lineno"></span><span class="comment" id="6391962">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6391995">//</span><br>
<span class="lineno"></span><span class="comment" id="6391998">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6392074">type</span>&nbsp;<span class="ident" id="6392079">Writer</span>&nbsp;<span class="keyword" id="6392086">struct</span>&nbsp;<span class="op" id="6392093">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392096">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6392104">rune</span>&nbsp;<span class="comment" id="6392109">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392155">UseCRLF</span>&nbsp;<span class="builtintype" id="6392163">bool</span>&nbsp;<span class="comment" id="6392168">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392212">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6392220">*</span><span class="ident" id="6392221">bufio</span><span class="op" id="6392226">.</span><span class="ident" id="6392227">Writer</span><br>
<span class="lineno"></span><span class="op" id="6392234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6392237">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6392289">func</span>&nbsp;<span class="ident" id="6392294">NewWriter</span><span class="op" id="6392303">(</span><span class="ident" id="6392304">w</span>&nbsp;<span class="ident" id="6392306">io</span><span class="op" id="6392308">.</span><span class="ident" id="6392309">Writer</span><span class="op" id="6392315">)</span>&nbsp;<span class="op" id="6392317">*</span><span class="ident" id="6392318">Writer</span>&nbsp;<span class="op" id="6392325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392328">return</span>&nbsp;<span class="op" id="6392335">&amp;</span><span class="ident" id="6392336">Writer</span><span class="op" id="6392342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392346">Comma</span><span class="op" id="6392351">:</span>&nbsp;<span class="string" id="6392353">&#39;,&#39;</span><span class="op" id="6392356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392360">w</span><span class="op" id="6392361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6392367">bufio</span><span class="op" id="6392372">.</span><span class="ident" id="6392373">NewWriter</span><span class="op" id="6392382">(</span><span class="ident" id="6392383">w</span><span class="op" id="6392384">)</span><span class="op" id="6392385">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392388">}</span><br>
<span class="lineno"></span><span class="op" id="6392390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392393">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6392469">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6392537">func</span>&nbsp;<span class="op" id="6392542">(</span><span class="ident" id="6392543">w</span>&nbsp;<span class="op" id="6392545">*</span><span class="ident" id="6392546">Writer</span><span class="op" id="6392552">)</span>&nbsp;<span class="ident" id="6392554">Write</span><span class="op" id="6392559">(</span><span class="ident" id="6392560">record</span>&nbsp;<span class="op" id="6392567">[</span><span class="op" id="6392568">]</span><span class="builtintype" id="6392569">string</span><span class="op" id="6392575">)</span>&nbsp;<span class="op" id="6392577">(</span><span class="ident" id="6392578">err</span>&nbsp;<span class="builtintype" id="6392582">error</span><span class="op" id="6392587">)</span>&nbsp;<span class="op" id="6392589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392592">for</span>&nbsp;<span class="ident" id="6392596">n</span><span class="op" id="6392597">,</span>&nbsp;<span class="ident" id="6392599">field</span>&nbsp;<span class="op" id="6392605">:=</span>&nbsp;<span class="keyword" id="6392608">range</span>&nbsp;<span class="ident" id="6392614">record</span>&nbsp;<span class="op" id="6392621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392625">if</span>&nbsp;<span class="ident" id="6392628">n</span>&nbsp;<span class="op" id="6392630">&gt;</span>&nbsp;<span class="num" id="6392632">0</span>&nbsp;<span class="op" id="6392634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392639">if</span>&nbsp;<span class="ident" id="6392642">_</span><span class="op" id="6392643">,</span>&nbsp;<span class="ident" id="6392645">err</span>&nbsp;<span class="op" id="6392649">=</span>&nbsp;<span class="ident" id="6392651">w</span><span class="op" id="6392652">.</span><span class="ident" id="6392653">w</span><span class="op" id="6392654">.</span><span class="ident" id="6392655">WriteRune</span><span class="op" id="6392664">(</span><span class="ident" id="6392665">w</span><span class="op" id="6392666">.</span><span class="ident" id="6392667">Comma</span><span class="op" id="6392672">)</span><span class="op" id="6392673">;</span>&nbsp;<span class="ident" id="6392675">err</span>&nbsp;<span class="op" id="6392679">!=</span>&nbsp;<span class="ident" id="6392682">nil</span>&nbsp;<span class="op" id="6392686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392692">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392711">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392766">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392823">if</span>&nbsp;<span class="op" id="6392826">!</span><span class="ident" id="6392827">w</span><span class="op" id="6392828">.</span><span class="ident" id="6392829">fieldNeedsQuotes</span><span class="op" id="6392845">(</span><span class="ident" id="6392846">field</span><span class="op" id="6392851">)</span>&nbsp;<span class="op" id="6392853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392858">if</span>&nbsp;<span class="ident" id="6392861">_</span><span class="op" id="6392862">,</span>&nbsp;<span class="ident" id="6392864">err</span>&nbsp;<span class="op" id="6392868">=</span>&nbsp;<span class="ident" id="6392870">w</span><span class="op" id="6392871">.</span><span class="ident" id="6392872">w</span><span class="op" id="6392873">.</span><span class="ident" id="6392874">WriteString</span><span class="op" id="6392885">(</span><span class="ident" id="6392886">field</span><span class="op" id="6392891">)</span><span class="op" id="6392892">;</span>&nbsp;<span class="ident" id="6392894">err</span>&nbsp;<span class="op" id="6392898">!=</span>&nbsp;<span class="ident" id="6392901">nil</span>&nbsp;<span class="op" id="6392905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392911">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392926">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392941">if</span>&nbsp;<span class="ident" id="6392944">err</span>&nbsp;<span class="op" id="6392948">=</span>&nbsp;<span class="ident" id="6392950">w</span><span class="op" id="6392951">.</span><span class="ident" id="6392952">w</span><span class="op" id="6392953">.</span><span class="ident" id="6392954">WriteByte</span><span class="op" id="6392963">(</span><span class="string" id="6392964">&#39;&#34;&#39;</span><span class="op" id="6392967">)</span><span class="op" id="6392968">;</span>&nbsp;<span class="ident" id="6392970">err</span>&nbsp;<span class="op" id="6392974">!=</span>&nbsp;<span class="ident" id="6392977">nil</span>&nbsp;<span class="op" id="6392981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392986">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393000">for</span>&nbsp;<span class="ident" id="6393004">_</span><span class="op" id="6393005">,</span>&nbsp;<span class="ident" id="6393007">r1</span>&nbsp;<span class="op" id="6393010">:=</span>&nbsp;<span class="keyword" id="6393013">range</span>&nbsp;<span class="ident" id="6393019">field</span>&nbsp;<span class="op" id="6393025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393030">switch</span>&nbsp;<span class="ident" id="6393037">r1</span>&nbsp;<span class="op" id="6393040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393045">case</span>&nbsp;<span class="string" id="6393050">&#39;&#34;&#39;</span><span class="op" id="6393053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393059">_</span><span class="op" id="6393060">,</span>&nbsp;<span class="ident" id="6393062">err</span>&nbsp;<span class="op" id="6393066">=</span>&nbsp;<span class="ident" id="6393068">w</span><span class="op" id="6393069">.</span><span class="ident" id="6393070">w</span><span class="op" id="6393071">.</span><span class="ident" id="6393072">WriteString</span><span class="op" id="6393083">(</span><span class="string" id="6393084">`&#34;&#34;`</span><span class="op" id="6393088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393093">case</span>&nbsp;<span class="string" id="6393098">&#39;\r&#39;</span><span class="op" id="6393102">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393108">if</span>&nbsp;<span class="op" id="6393111">!</span><span class="ident" id="6393112">w</span><span class="op" id="6393113">.</span><span class="ident" id="6393114">UseCRLF</span>&nbsp;<span class="op" id="6393122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393129">err</span>&nbsp;<span class="op" id="6393133">=</span>&nbsp;<span class="ident" id="6393135">w</span><span class="op" id="6393136">.</span><span class="ident" id="6393137">w</span><span class="op" id="6393138">.</span><span class="ident" id="6393139">WriteByte</span><span class="op" id="6393148">(</span><span class="string" id="6393149">&#39;\r&#39;</span><span class="op" id="6393153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393164">case</span>&nbsp;<span class="string" id="6393169">&#39;\n&#39;</span><span class="op" id="6393173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393179">if</span>&nbsp;<span class="ident" id="6393182">w</span><span class="op" id="6393183">.</span><span class="ident" id="6393184">UseCRLF</span>&nbsp;<span class="op" id="6393192">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393199">_</span><span class="op" id="6393200">,</span>&nbsp;<span class="ident" id="6393202">err</span>&nbsp;<span class="op" id="6393206">=</span>&nbsp;<span class="ident" id="6393208">w</span><span class="op" id="6393209">.</span><span class="ident" id="6393210">w</span><span class="op" id="6393211">.</span><span class="ident" id="6393212">WriteString</span><span class="op" id="6393223">(</span><span class="string" id="6393224">&#34;\r\n&#34;</span><span class="op" id="6393230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393236">}</span>&nbsp;<span class="keyword" id="6393238">else</span>&nbsp;<span class="op" id="6393243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393250">err</span>&nbsp;<span class="op" id="6393254">=</span>&nbsp;<span class="ident" id="6393256">w</span><span class="op" id="6393257">.</span><span class="ident" id="6393258">w</span><span class="op" id="6393259">.</span><span class="ident" id="6393260">WriteByte</span><span class="op" id="6393269">(</span><span class="string" id="6393270">&#39;\n&#39;</span><span class="op" id="6393274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393285">default</span><span class="op" id="6393292">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393298">_</span><span class="op" id="6393299">,</span>&nbsp;<span class="ident" id="6393301">err</span>&nbsp;<span class="op" id="6393305">=</span>&nbsp;<span class="ident" id="6393307">w</span><span class="op" id="6393308">.</span><span class="ident" id="6393309">w</span><span class="op" id="6393310">.</span><span class="ident" id="6393311">WriteRune</span><span class="op" id="6393320">(</span><span class="ident" id="6393321">r1</span><span class="op" id="6393323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393333">if</span>&nbsp;<span class="ident" id="6393336">err</span>&nbsp;<span class="op" id="6393340">!=</span>&nbsp;<span class="ident" id="6393343">nil</span>&nbsp;<span class="op" id="6393347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393353">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393363">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393372">if</span>&nbsp;<span class="ident" id="6393375">err</span>&nbsp;<span class="op" id="6393379">=</span>&nbsp;<span class="ident" id="6393381">w</span><span class="op" id="6393382">.</span><span class="ident" id="6393383">w</span><span class="op" id="6393384">.</span><span class="ident" id="6393385">WriteByte</span><span class="op" id="6393394">(</span><span class="string" id="6393395">&#39;&#34;&#39;</span><span class="op" id="6393398">)</span><span class="op" id="6393399">;</span>&nbsp;<span class="ident" id="6393401">err</span>&nbsp;<span class="op" id="6393405">!=</span>&nbsp;<span class="ident" id="6393408">nil</span>&nbsp;<span class="op" id="6393412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393417">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393426">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393432">if</span>&nbsp;<span class="ident" id="6393435">w</span><span class="op" id="6393436">.</span><span class="ident" id="6393437">UseCRLF</span>&nbsp;<span class="op" id="6393445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393449">_</span><span class="op" id="6393450">,</span>&nbsp;<span class="ident" id="6393452">err</span>&nbsp;<span class="op" id="6393456">=</span>&nbsp;<span class="ident" id="6393458">w</span><span class="op" id="6393459">.</span><span class="ident" id="6393460">w</span><span class="op" id="6393461">.</span><span class="ident" id="6393462">WriteString</span><span class="op" id="6393473">(</span><span class="string" id="6393474">&#34;\r\n&#34;</span><span class="op" id="6393480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393483">}</span>&nbsp;<span class="keyword" id="6393485">else</span>&nbsp;<span class="op" id="6393490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393494">err</span>&nbsp;<span class="op" id="6393498">=</span>&nbsp;<span class="ident" id="6393500">w</span><span class="op" id="6393501">.</span><span class="ident" id="6393502">w</span><span class="op" id="6393503">.</span><span class="ident" id="6393504">WriteByte</span><span class="op" id="6393513">(</span><span class="string" id="6393514">&#39;\n&#39;</span><span class="op" id="6393518">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393524">return</span><br>
<span class="lineno"></span><span class="op" id="6393531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393534">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6393597">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6393660">func</span>&nbsp;<span class="op" id="6393665">(</span><span class="ident" id="6393666">w</span>&nbsp;<span class="op" id="6393668">*</span><span class="ident" id="6393669">Writer</span><span class="op" id="6393675">)</span>&nbsp;<span class="ident" id="6393677">Flush</span><span class="op" id="6393682">(</span><span class="op" id="6393683">)</span>&nbsp;<span class="op" id="6393685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393688">w</span><span class="op" id="6393689">.</span><span class="ident" id="6393690">w</span><span class="op" id="6393691">.</span><span class="ident" id="6393692">Flush</span><span class="op" id="6393697">(</span><span class="op" id="6393698">)</span><br>
<span class="lineno"></span><span class="op" id="6393700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6393703">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6393782">func</span>&nbsp;<span class="op" id="6393787">(</span><span class="ident" id="6393788">w</span>&nbsp;<span class="op" id="6393790">*</span><span class="ident" id="6393791">Writer</span><span class="op" id="6393797">)</span>&nbsp;<span class="ident" id="6393799">Error</span><span class="op" id="6393804">(</span><span class="op" id="6393805">)</span>&nbsp;<span class="builtintype" id="6393807">error</span>&nbsp;<span class="op" id="6393813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393816">_</span><span class="op" id="6393817">,</span>&nbsp;<span class="ident" id="6393819">err</span>&nbsp;<span class="op" id="6393823">:=</span>&nbsp;<span class="ident" id="6393826">w</span><span class="op" id="6393827">.</span><span class="ident" id="6393828">w</span><span class="op" id="6393829">.</span><span class="ident" id="6393830">Write</span><span class="op" id="6393835">(</span><span class="ident" id="6393836">nil</span><span class="op" id="6393839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393842">return</span>&nbsp;<span class="ident" id="6393849">err</span><br>
<span class="lineno"></span><span class="op" id="6393853">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6393856">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6393935">func</span>&nbsp;<span class="op" id="6393940">(</span><span class="ident" id="6393941">w</span>&nbsp;<span class="op" id="6393943">*</span><span class="ident" id="6393944">Writer</span><span class="op" id="6393950">)</span>&nbsp;<span class="ident" id="6393952">WriteAll</span><span class="op" id="6393960">(</span><span class="ident" id="6393961">records</span>&nbsp;<span class="op" id="6393969">[</span><span class="op" id="6393970">]</span><span class="op" id="6393971">[</span><span class="op" id="6393972">]</span><span class="builtintype" id="6393973">string</span><span class="op" id="6393979">)</span>&nbsp;<span class="op" id="6393981">(</span><span class="ident" id="6393982">err</span>&nbsp;<span class="builtintype" id="6393986">error</span><span class="op" id="6393991">)</span>&nbsp;<span class="op" id="6393993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393996">for</span>&nbsp;<span class="ident" id="6394000">_</span><span class="op" id="6394001">,</span>&nbsp;<span class="ident" id="6394003">record</span>&nbsp;<span class="op" id="6394010">:=</span>&nbsp;<span class="keyword" id="6394013">range</span>&nbsp;<span class="ident" id="6394019">records</span>&nbsp;<span class="op" id="6394027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394031">err</span>&nbsp;<span class="op" id="6394035">=</span>&nbsp;<span class="ident" id="6394037">w</span><span class="op" id="6394038">.</span><span class="ident" id="6394039">Write</span><span class="op" id="6394044">(</span><span class="ident" id="6394045">record</span><span class="op" id="6394051">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394055">if</span>&nbsp;<span class="ident" id="6394058">err</span>&nbsp;<span class="op" id="6394062">!=</span>&nbsp;<span class="ident" id="6394065">nil</span>&nbsp;<span class="op" id="6394069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394074">return</span>&nbsp;<span class="ident" id="6394081">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394093">return</span>&nbsp;<span class="ident" id="6394100">w</span><span class="op" id="6394101">.</span><span class="ident" id="6394102">w</span><span class="op" id="6394103">.</span><span class="ident" id="6394104">Flush</span><span class="op" id="6394109">(</span><span class="op" id="6394110">)</span><br>
<span class="lineno">115</span><span class="op" id="6394112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394115">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6394189">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6394249">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6394312">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6394385">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6394461">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6394534">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6394606">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6394675">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6394730">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6394805">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6394845">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6394900">func</span>&nbsp;<span class="op" id="6394905">(</span><span class="ident" id="6394906">w</span>&nbsp;<span class="op" id="6394908">*</span><span class="ident" id="6394909">Writer</span><span class="op" id="6394915">)</span>&nbsp;<span class="ident" id="6394917">fieldNeedsQuotes</span><span class="op" id="6394933">(</span><span class="ident" id="6394934">field</span>&nbsp;<span class="builtintype" id="6394940">string</span><span class="op" id="6394946">)</span>&nbsp;<span class="builtintype" id="6394948">bool</span>&nbsp;<span class="op" id="6394953">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394956">if</span>&nbsp;<span class="ident" id="6394959">field</span>&nbsp;<span class="op" id="6394965">==</span>&nbsp;<span class="string" id="6394968">&#34;&#34;</span>&nbsp;<span class="op" id="6394971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394975">return</span>&nbsp;<span class="builtintype" id="6394982">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394992">if</span>&nbsp;<span class="ident" id="6394995">field</span>&nbsp;<span class="op" id="6395001">==</span>&nbsp;<span class="string" id="6395004">`\.`</span>&nbsp;<span class="op" id="6395009">||</span>&nbsp;<span class="ident" id="6395012">strings</span><span class="op" id="6395019">.</span><span class="ident" id="6395020">IndexRune</span><span class="op" id="6395029">(</span><span class="ident" id="6395030">field</span><span class="op" id="6395035">,</span>&nbsp;<span class="ident" id="6395037">w</span><span class="op" id="6395038">.</span><span class="ident" id="6395039">Comma</span><span class="op" id="6395044">)</span>&nbsp;<span class="op" id="6395046">&gt;=</span>&nbsp;<span class="num" id="6395049">0</span>&nbsp;<span class="op" id="6395051">||</span>&nbsp;<span class="ident" id="6395054">strings</span><span class="op" id="6395061">.</span><span class="ident" id="6395062">IndexAny</span><span class="op" id="6395070">(</span><span class="ident" id="6395071">field</span><span class="op" id="6395076">,</span>&nbsp;<span class="string" id="6395078">&#34;\&#34;\r\n&#34;</span><span class="op" id="6395086">)</span>&nbsp;<span class="op" id="6395088">&gt;=</span>&nbsp;<span class="num" id="6395091">0</span>&nbsp;<span class="op" id="6395093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395097">return</span>&nbsp;<span class="builtintype" id="6395104">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395114">r1</span><span class="op" id="6395116">,</span>&nbsp;<span class="ident" id="6395118">_</span>&nbsp;<span class="op" id="6395120">:=</span>&nbsp;<span class="ident" id="6395123">utf8</span><span class="op" id="6395127">.</span><span class="ident" id="6395128">DecodeRuneInString</span><span class="op" id="6395146">(</span><span class="ident" id="6395147">field</span><span class="op" id="6395152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395155">return</span>&nbsp;<span class="ident" id="6395162">unicode</span><span class="op" id="6395169">.</span><span class="ident" id="6395170">IsSpace</span><span class="op" id="6395177">(</span><span class="ident" id="6395178">r1</span><span class="op" id="6395180">)</span><br>
<span class="lineno"></span><span class="op" id="6395182">}</span>
</div>
</body>
</html>
