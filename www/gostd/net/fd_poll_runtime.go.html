<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4045446">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4045501">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4045555">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4045606">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;windows&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045679">package</span>&nbsp;<span class="ident" id="4045687">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045692">import</span>&nbsp;<span class="op" id="4045699">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4045702">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4045710">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4045721">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4045728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4045731">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="4045809">func</span>&nbsp;<span class="ident" id="4045814">runtimeNano</span><span class="op" id="4045825">(</span><span class="op" id="4045826">)</span>&nbsp;<span class="ident" id="4045828">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045835">func</span>&nbsp;<span class="ident" id="4045840">runtime_pollServerInit</span><span class="op" id="4045862">(</span><span class="op" id="4045863">)</span><br>
<span class="lineno"></span><span class="keyword" id="4045865">func</span>&nbsp;<span class="ident" id="4045870">runtime_pollOpen</span><span class="op" id="4045886">(</span><span class="ident" id="4045887">fd</span>&nbsp;<span class="builtintype" id="4045890">uintptr</span><span class="op" id="4045897">)</span>&nbsp;<span class="op" id="4045899">(</span><span class="builtintype" id="4045900">uintptr</span><span class="op" id="4045907">,</span>&nbsp;<span class="builtintype" id="4045909">int</span><span class="op" id="4045912">)</span><br>
<span class="lineno">20</span><span class="keyword" id="4045914">func</span>&nbsp;<span class="ident" id="4045919">runtime_pollClose</span><span class="op" id="4045936">(</span><span class="ident" id="4045937">ctx</span>&nbsp;<span class="builtintype" id="4045941">uintptr</span><span class="op" id="4045948">)</span><br>
<span class="lineno"></span><span class="keyword" id="4045950">func</span>&nbsp;<span class="ident" id="4045955">runtime_pollWait</span><span class="op" id="4045971">(</span><span class="ident" id="4045972">ctx</span>&nbsp;<span class="builtintype" id="4045976">uintptr</span><span class="op" id="4045983">,</span>&nbsp;<span class="ident" id="4045985">mode</span>&nbsp;<span class="builtintype" id="4045990">int</span><span class="op" id="4045993">)</span>&nbsp;<span class="builtintype" id="4045995">int</span><br>
<span class="lineno"></span><span class="keyword" id="4045999">func</span>&nbsp;<span class="ident" id="4046004">runtime_pollWaitCanceled</span><span class="op" id="4046028">(</span><span class="ident" id="4046029">ctx</span>&nbsp;<span class="builtintype" id="4046033">uintptr</span><span class="op" id="4046040">,</span>&nbsp;<span class="ident" id="4046042">mode</span>&nbsp;<span class="builtintype" id="4046047">int</span><span class="op" id="4046050">)</span>&nbsp;<span class="builtintype" id="4046052">int</span><br>
<span class="lineno"></span><span class="keyword" id="4046056">func</span>&nbsp;<span class="ident" id="4046061">runtime_pollReset</span><span class="op" id="4046078">(</span><span class="ident" id="4046079">ctx</span>&nbsp;<span class="builtintype" id="4046083">uintptr</span><span class="op" id="4046090">,</span>&nbsp;<span class="ident" id="4046092">mode</span>&nbsp;<span class="builtintype" id="4046097">int</span><span class="op" id="4046100">)</span>&nbsp;<span class="builtintype" id="4046102">int</span><br>
<span class="lineno"></span><span class="keyword" id="4046106">func</span>&nbsp;<span class="ident" id="4046111">runtime_pollSetDeadline</span><span class="op" id="4046134">(</span><span class="ident" id="4046135">ctx</span>&nbsp;<span class="builtintype" id="4046139">uintptr</span><span class="op" id="4046146">,</span>&nbsp;<span class="ident" id="4046148">d</span>&nbsp;<span class="ident" id="4046150">int64</span><span class="op" id="4046155">,</span>&nbsp;<span class="ident" id="4046157">mode</span>&nbsp;<span class="builtintype" id="4046162">int</span><span class="op" id="4046165">)</span><br>
<span class="lineno">25</span><span class="keyword" id="4046167">func</span>&nbsp;<span class="ident" id="4046172">runtime_pollUnblock</span><span class="op" id="4046191">(</span><span class="ident" id="4046192">ctx</span>&nbsp;<span class="builtintype" id="4046196">uintptr</span><span class="op" id="4046203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046206">type</span>&nbsp;<span class="ident" id="4046211">pollDesc</span>&nbsp;<span class="keyword" id="4046220">struct</span>&nbsp;<span class="op" id="4046227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046230">runtimeCtx</span>&nbsp;<span class="builtintype" id="4046241">uintptr</span><br>
<span class="lineno"></span><span class="op" id="4046249">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="4046252">var</span>&nbsp;<span class="ident" id="4046256">serverInit</span>&nbsp;<span class="ident" id="4046267">sync</span><span class="op" id="4046271">.</span><span class="ident" id="4046272">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046278">func</span>&nbsp;<span class="op" id="4046283">(</span><span class="ident" id="4046284">pd</span>&nbsp;<span class="op" id="4046287">*</span><span class="ident" id="4046288">pollDesc</span><span class="op" id="4046296">)</span>&nbsp;<span class="ident" id="4046298">Init</span><span class="op" id="4046302">(</span><span class="ident" id="4046303">fd</span>&nbsp;<span class="op" id="4046306">*</span><span class="ident" id="4046307">netFD</span><span class="op" id="4046312">)</span>&nbsp;<span class="builtintype" id="4046314">error</span>&nbsp;<span class="op" id="4046320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046323">serverInit</span><span class="op" id="4046333">.</span><span class="ident" id="4046334">Do</span><span class="op" id="4046336">(</span><span class="ident" id="4046337">runtime_pollServerInit</span><span class="op" id="4046359">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046362">ctx</span><span class="op" id="4046365">,</span>&nbsp;<span class="ident" id="4046367">errno</span>&nbsp;<span class="op" id="4046373">:=</span>&nbsp;<span class="ident" id="4046376">runtime_pollOpen</span><span class="op" id="4046392">(</span><span class="builtintype" id="4046393">uintptr</span><span class="op" id="4046400">(</span><span class="ident" id="4046401">fd</span><span class="op" id="4046403">.</span><span class="ident" id="4046404">sysfd</span><span class="op" id="4046409">)</span><span class="op" id="4046410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046413">if</span>&nbsp;<span class="ident" id="4046416">errno</span>&nbsp;<span class="op" id="4046422">!=</span>&nbsp;<span class="num" id="4046425">0</span>&nbsp;<span class="op" id="4046427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046431">return</span>&nbsp;<span class="ident" id="4046438">syscall</span><span class="op" id="4046445">.</span><span class="ident" id="4046446">Errno</span><span class="op" id="4046451">(</span><span class="ident" id="4046452">errno</span><span class="op" id="4046457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046463">pd</span><span class="op" id="4046465">.</span><span class="ident" id="4046466">runtimeCtx</span>&nbsp;<span class="op" id="4046477">=</span>&nbsp;<span class="ident" id="4046479">ctx</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046484">return</span>&nbsp;<span class="ident" id="4046491">nil</span><br>
<span class="lineno"></span><span class="op" id="4046495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046498">func</span>&nbsp;<span class="op" id="4046503">(</span><span class="ident" id="4046504">pd</span>&nbsp;<span class="op" id="4046507">*</span><span class="ident" id="4046508">pollDesc</span><span class="op" id="4046516">)</span>&nbsp;<span class="ident" id="4046518">Close</span><span class="op" id="4046523">(</span><span class="op" id="4046524">)</span>&nbsp;<span class="op" id="4046526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046529">if</span>&nbsp;<span class="ident" id="4046532">pd</span><span class="op" id="4046534">.</span><span class="ident" id="4046535">runtimeCtx</span>&nbsp;<span class="op" id="4046546">==</span>&nbsp;<span class="num" id="4046549">0</span>&nbsp;<span class="op" id="4046551">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046566">runtime_pollClose</span><span class="op" id="4046583">(</span><span class="ident" id="4046584">pd</span><span class="op" id="4046586">.</span><span class="ident" id="4046587">runtimeCtx</span><span class="op" id="4046597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046600">pd</span><span class="op" id="4046602">.</span><span class="ident" id="4046603">runtimeCtx</span>&nbsp;<span class="op" id="4046614">=</span>&nbsp;<span class="num" id="4046616">0</span><br>
<span class="lineno"></span><span class="op" id="4046618">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4046621">func</span>&nbsp;<span class="op" id="4046626">(</span><span class="ident" id="4046627">pd</span>&nbsp;<span class="op" id="4046630">*</span><span class="ident" id="4046631">pollDesc</span><span class="op" id="4046639">)</span>&nbsp;<span class="ident" id="4046641">Lock</span><span class="op" id="4046645">(</span><span class="op" id="4046646">)</span>&nbsp;<span class="op" id="4046648">{</span><br>
<span class="lineno"></span><span class="op" id="4046650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046653">func</span>&nbsp;<span class="op" id="4046658">(</span><span class="ident" id="4046659">pd</span>&nbsp;<span class="op" id="4046662">*</span><span class="ident" id="4046663">pollDesc</span><span class="op" id="4046671">)</span>&nbsp;<span class="ident" id="4046673">Unlock</span><span class="op" id="4046679">(</span><span class="op" id="4046680">)</span>&nbsp;<span class="op" id="4046682">{</span><br>
<span class="lineno">55</span><span class="op" id="4046684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4046687">func</span>&nbsp;<span class="op" id="4046692">(</span><span class="ident" id="4046693">pd</span>&nbsp;<span class="op" id="4046696">*</span><span class="ident" id="4046697">pollDesc</span><span class="op" id="4046705">)</span>&nbsp;<span class="ident" id="4046707">Wakeup</span><span class="op" id="4046713">(</span><span class="op" id="4046714">)</span>&nbsp;<span class="op" id="4046716">{</span><br>
<span class="lineno"></span><span class="op" id="4046718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4046721">//&nbsp;Evict&nbsp;evicts&nbsp;fd&nbsp;from&nbsp;the&nbsp;pending&nbsp;list,&nbsp;unblocking&nbsp;any&nbsp;I/O&nbsp;running&nbsp;on&nbsp;fd.</span><br>
<span class="lineno"></span><span class="comment" id="4046797">//&nbsp;Return&nbsp;value&nbsp;is&nbsp;whether&nbsp;the&nbsp;pollServer&nbsp;should&nbsp;be&nbsp;woken&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4046859">func</span>&nbsp;<span class="op" id="4046864">(</span><span class="ident" id="4046865">pd</span>&nbsp;<span class="op" id="4046868">*</span><span class="ident" id="4046869">pollDesc</span><span class="op" id="4046877">)</span>&nbsp;<span class="ident" id="4046879">Evict</span><span class="op" id="4046884">(</span><span class="op" id="4046885">)</span>&nbsp;<span class="builtintype" id="4046887">bool</span>&nbsp;<span class="op" id="4046892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046895">if</span>&nbsp;<span class="ident" id="4046898">pd</span><span class="op" id="4046900">.</span><span class="ident" id="4046901">runtimeCtx</span>&nbsp;<span class="op" id="4046912">==</span>&nbsp;<span class="num" id="4046915">0</span>&nbsp;<span class="op" id="4046917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046921">return</span>&nbsp;<span class="builtintype" id="4046928">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046938">runtime_pollUnblock</span><span class="op" id="4046957">(</span><span class="ident" id="4046958">pd</span><span class="op" id="4046960">.</span><span class="ident" id="4046961">runtimeCtx</span><span class="op" id="4046971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046974">return</span>&nbsp;<span class="builtintype" id="4046981">false</span><br>
<span class="lineno"></span><span class="op" id="4046987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4046990">func</span>&nbsp;<span class="op" id="4046995">(</span><span class="ident" id="4046996">pd</span>&nbsp;<span class="op" id="4046999">*</span><span class="ident" id="4047000">pollDesc</span><span class="op" id="4047008">)</span>&nbsp;<span class="ident" id="4047010">Prepare</span><span class="op" id="4047017">(</span><span class="ident" id="4047018">mode</span>&nbsp;<span class="builtintype" id="4047023">int</span><span class="op" id="4047026">)</span>&nbsp;<span class="builtintype" id="4047028">error</span>&nbsp;<span class="op" id="4047034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047037">res</span>&nbsp;<span class="op" id="4047041">:=</span>&nbsp;<span class="ident" id="4047044">runtime_pollReset</span><span class="op" id="4047061">(</span><span class="ident" id="4047062">pd</span><span class="op" id="4047064">.</span><span class="ident" id="4047065">runtimeCtx</span><span class="op" id="4047075">,</span>&nbsp;<span class="ident" id="4047077">mode</span><span class="op" id="4047081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047084">return</span>&nbsp;<span class="ident" id="4047091">convertErr</span><span class="op" id="4047101">(</span><span class="ident" id="4047102">res</span><span class="op" id="4047105">)</span><br>
<span class="lineno"></span><span class="op" id="4047107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="4047110">func</span>&nbsp;<span class="op" id="4047115">(</span><span class="ident" id="4047116">pd</span>&nbsp;<span class="op" id="4047119">*</span><span class="ident" id="4047120">pollDesc</span><span class="op" id="4047128">)</span>&nbsp;<span class="ident" id="4047130">PrepareRead</span><span class="op" id="4047141">(</span><span class="op" id="4047142">)</span>&nbsp;<span class="builtintype" id="4047144">error</span>&nbsp;<span class="op" id="4047150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047153">return</span>&nbsp;<span class="ident" id="4047160">pd</span><span class="op" id="4047162">.</span><span class="ident" id="4047163">Prepare</span><span class="op" id="4047170">(</span><span class="string" id="4047171">&#39;r&#39;</span><span class="op" id="4047174">)</span><br>
<span class="lineno"></span><span class="op" id="4047176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047179">func</span>&nbsp;<span class="op" id="4047184">(</span><span class="ident" id="4047185">pd</span>&nbsp;<span class="op" id="4047188">*</span><span class="ident" id="4047189">pollDesc</span><span class="op" id="4047197">)</span>&nbsp;<span class="ident" id="4047199">PrepareWrite</span><span class="op" id="4047211">(</span><span class="op" id="4047212">)</span>&nbsp;<span class="builtintype" id="4047214">error</span>&nbsp;<span class="op" id="4047220">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047223">return</span>&nbsp;<span class="ident" id="4047230">pd</span><span class="op" id="4047232">.</span><span class="ident" id="4047233">Prepare</span><span class="op" id="4047240">(</span><span class="string" id="4047241">&#39;w&#39;</span><span class="op" id="4047244">)</span><br>
<span class="lineno"></span><span class="op" id="4047246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047249">func</span>&nbsp;<span class="op" id="4047254">(</span><span class="ident" id="4047255">pd</span>&nbsp;<span class="op" id="4047258">*</span><span class="ident" id="4047259">pollDesc</span><span class="op" id="4047267">)</span>&nbsp;<span class="ident" id="4047269">Wait</span><span class="op" id="4047273">(</span><span class="ident" id="4047274">mode</span>&nbsp;<span class="builtintype" id="4047279">int</span><span class="op" id="4047282">)</span>&nbsp;<span class="builtintype" id="4047284">error</span>&nbsp;<span class="op" id="4047290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047293">res</span>&nbsp;<span class="op" id="4047297">:=</span>&nbsp;<span class="ident" id="4047300">runtime_pollWait</span><span class="op" id="4047316">(</span><span class="ident" id="4047317">pd</span><span class="op" id="4047319">.</span><span class="ident" id="4047320">runtimeCtx</span><span class="op" id="4047330">,</span>&nbsp;<span class="ident" id="4047332">mode</span><span class="op" id="4047336">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047339">return</span>&nbsp;<span class="ident" id="4047346">convertErr</span><span class="op" id="4047356">(</span><span class="ident" id="4047357">res</span><span class="op" id="4047360">)</span><br>
<span class="lineno"></span><span class="op" id="4047362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047365">func</span>&nbsp;<span class="op" id="4047370">(</span><span class="ident" id="4047371">pd</span>&nbsp;<span class="op" id="4047374">*</span><span class="ident" id="4047375">pollDesc</span><span class="op" id="4047383">)</span>&nbsp;<span class="ident" id="4047385">WaitRead</span><span class="op" id="4047393">(</span><span class="op" id="4047394">)</span>&nbsp;<span class="builtintype" id="4047396">error</span>&nbsp;<span class="op" id="4047402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047405">return</span>&nbsp;<span class="ident" id="4047412">pd</span><span class="op" id="4047414">.</span><span class="ident" id="4047415">Wait</span><span class="op" id="4047419">(</span><span class="string" id="4047420">&#39;r&#39;</span><span class="op" id="4047423">)</span><br>
<span class="lineno">90</span><span class="op" id="4047425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047428">func</span>&nbsp;<span class="op" id="4047433">(</span><span class="ident" id="4047434">pd</span>&nbsp;<span class="op" id="4047437">*</span><span class="ident" id="4047438">pollDesc</span><span class="op" id="4047446">)</span>&nbsp;<span class="ident" id="4047448">WaitWrite</span><span class="op" id="4047457">(</span><span class="op" id="4047458">)</span>&nbsp;<span class="builtintype" id="4047460">error</span>&nbsp;<span class="op" id="4047466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047469">return</span>&nbsp;<span class="ident" id="4047476">pd</span><span class="op" id="4047478">.</span><span class="ident" id="4047479">Wait</span><span class="op" id="4047483">(</span><span class="string" id="4047484">&#39;w&#39;</span><span class="op" id="4047487">)</span><br>
<span class="lineno"></span><span class="op" id="4047489">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="4047492">func</span>&nbsp;<span class="op" id="4047497">(</span><span class="ident" id="4047498">pd</span>&nbsp;<span class="op" id="4047501">*</span><span class="ident" id="4047502">pollDesc</span><span class="op" id="4047510">)</span>&nbsp;<span class="ident" id="4047512">WaitCanceled</span><span class="op" id="4047524">(</span><span class="ident" id="4047525">mode</span>&nbsp;<span class="builtintype" id="4047530">int</span><span class="op" id="4047533">)</span>&nbsp;<span class="op" id="4047535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047538">runtime_pollWaitCanceled</span><span class="op" id="4047562">(</span><span class="ident" id="4047563">pd</span><span class="op" id="4047565">.</span><span class="ident" id="4047566">runtimeCtx</span><span class="op" id="4047576">,</span>&nbsp;<span class="ident" id="4047578">mode</span><span class="op" id="4047582">)</span><br>
<span class="lineno"></span><span class="op" id="4047584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4047587">func</span>&nbsp;<span class="op" id="4047592">(</span><span class="ident" id="4047593">pd</span>&nbsp;<span class="op" id="4047596">*</span><span class="ident" id="4047597">pollDesc</span><span class="op" id="4047605">)</span>&nbsp;<span class="ident" id="4047607">WaitCanceledRead</span><span class="op" id="4047623">(</span><span class="op" id="4047624">)</span>&nbsp;<span class="op" id="4047626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047629">pd</span><span class="op" id="4047631">.</span><span class="ident" id="4047632">WaitCanceled</span><span class="op" id="4047644">(</span><span class="string" id="4047645">&#39;r&#39;</span><span class="op" id="4047648">)</span><br>
<span class="lineno"></span><span class="op" id="4047650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047653">func</span>&nbsp;<span class="op" id="4047658">(</span><span class="ident" id="4047659">pd</span>&nbsp;<span class="op" id="4047662">*</span><span class="ident" id="4047663">pollDesc</span><span class="op" id="4047671">)</span>&nbsp;<span class="ident" id="4047673">WaitCanceledWrite</span><span class="op" id="4047690">(</span><span class="op" id="4047691">)</span>&nbsp;<span class="op" id="4047693">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4047696">pd</span><span class="op" id="4047698">.</span><span class="ident" id="4047699">WaitCanceled</span><span class="op" id="4047711">(</span><span class="string" id="4047712">&#39;w&#39;</span><span class="op" id="4047715">)</span><br>
<span class="lineno"></span><span class="op" id="4047717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4047720">func</span>&nbsp;<span class="ident" id="4047725">convertErr</span><span class="op" id="4047735">(</span><span class="ident" id="4047736">res</span>&nbsp;<span class="builtintype" id="4047740">int</span><span class="op" id="4047743">)</span>&nbsp;<span class="builtintype" id="4047745">error</span>&nbsp;<span class="op" id="4047751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047754">switch</span>&nbsp;<span class="ident" id="4047761">res</span>&nbsp;<span class="op" id="4047765">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047768">case</span>&nbsp;<span class="num" id="4047773">0</span><span class="op" id="4047774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047778">return</span>&nbsp;<span class="ident" id="4047785">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047790">case</span>&nbsp;<span class="num" id="4047795">1</span><span class="op" id="4047796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047800">return</span>&nbsp;<span class="ident" id="4047807">errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047819">case</span>&nbsp;<span class="num" id="4047824">2</span><span class="op" id="4047825">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047829">return</span>&nbsp;<span class="ident" id="4047836">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4047848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4047851">println</span><span class="op" id="4047858">(</span><span class="string" id="4047859">&#34;unreachable:&nbsp;&#34;</span><span class="op" id="4047874">,</span>&nbsp;<span class="ident" id="4047876">res</span><span class="op" id="4047879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4047882">panic</span><span class="op" id="4047887">(</span><span class="string" id="4047888">&#34;unreachable&#34;</span><span class="op" id="4047901">)</span><br>
<span class="lineno"></span><span class="op" id="4047903">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4047906">func</span>&nbsp;<span class="op" id="4047911">(</span><span class="ident" id="4047912">fd</span>&nbsp;<span class="op" id="4047915">*</span><span class="ident" id="4047916">netFD</span><span class="op" id="4047921">)</span>&nbsp;<span class="ident" id="4047923">setDeadline</span><span class="op" id="4047934">(</span><span class="ident" id="4047935">t</span>&nbsp;<span class="ident" id="4047937">time</span><span class="op" id="4047941">.</span><span class="ident" id="4047942">Time</span><span class="op" id="4047946">)</span>&nbsp;<span class="builtintype" id="4047948">error</span>&nbsp;<span class="op" id="4047954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4047957">return</span>&nbsp;<span class="ident" id="4047964">setDeadlineImpl</span><span class="op" id="4047979">(</span><span class="ident" id="4047980">fd</span><span class="op" id="4047982">,</span>&nbsp;<span class="ident" id="4047984">t</span><span class="op" id="4047985">,</span>&nbsp;<span class="string" id="4047987">&#39;r&#39;</span><span class="op" id="4047990">+</span><span class="string" id="4047991">&#39;w&#39;</span><span class="op" id="4047994">)</span><br>
<span class="lineno"></span><span class="op" id="4047996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4047999">func</span>&nbsp;<span class="op" id="4048004">(</span><span class="ident" id="4048005">fd</span>&nbsp;<span class="op" id="4048008">*</span><span class="ident" id="4048009">netFD</span><span class="op" id="4048014">)</span>&nbsp;<span class="ident" id="4048016">setReadDeadline</span><span class="op" id="4048031">(</span><span class="ident" id="4048032">t</span>&nbsp;<span class="ident" id="4048034">time</span><span class="op" id="4048038">.</span><span class="ident" id="4048039">Time</span><span class="op" id="4048043">)</span>&nbsp;<span class="builtintype" id="4048045">error</span>&nbsp;<span class="op" id="4048051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048054">return</span>&nbsp;<span class="ident" id="4048061">setDeadlineImpl</span><span class="op" id="4048076">(</span><span class="ident" id="4048077">fd</span><span class="op" id="4048079">,</span>&nbsp;<span class="ident" id="4048081">t</span><span class="op" id="4048082">,</span>&nbsp;<span class="string" id="4048084">&#39;r&#39;</span><span class="op" id="4048087">)</span><br>
<span class="lineno"></span><span class="op" id="4048089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4048092">func</span>&nbsp;<span class="op" id="4048097">(</span><span class="ident" id="4048098">fd</span>&nbsp;<span class="op" id="4048101">*</span><span class="ident" id="4048102">netFD</span><span class="op" id="4048107">)</span>&nbsp;<span class="ident" id="4048109">setWriteDeadline</span><span class="op" id="4048125">(</span><span class="ident" id="4048126">t</span>&nbsp;<span class="ident" id="4048128">time</span><span class="op" id="4048132">.</span><span class="ident" id="4048133">Time</span><span class="op" id="4048137">)</span>&nbsp;<span class="builtintype" id="4048139">error</span>&nbsp;<span class="op" id="4048145">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048148">return</span>&nbsp;<span class="ident" id="4048155">setDeadlineImpl</span><span class="op" id="4048170">(</span><span class="ident" id="4048171">fd</span><span class="op" id="4048173">,</span>&nbsp;<span class="ident" id="4048175">t</span><span class="op" id="4048176">,</span>&nbsp;<span class="string" id="4048178">&#39;w&#39;</span><span class="op" id="4048181">)</span><br>
<span class="lineno"></span><span class="op" id="4048183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4048186">func</span>&nbsp;<span class="ident" id="4048191">setDeadlineImpl</span><span class="op" id="4048206">(</span><span class="ident" id="4048207">fd</span>&nbsp;<span class="op" id="4048210">*</span><span class="ident" id="4048211">netFD</span><span class="op" id="4048216">,</span>&nbsp;<span class="ident" id="4048218">t</span>&nbsp;<span class="ident" id="4048220">time</span><span class="op" id="4048224">.</span><span class="ident" id="4048225">Time</span><span class="op" id="4048229">,</span>&nbsp;<span class="ident" id="4048231">mode</span>&nbsp;<span class="builtintype" id="4048236">int</span><span class="op" id="4048239">)</span>&nbsp;<span class="builtintype" id="4048241">error</span>&nbsp;<span class="op" id="4048247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048250">d</span>&nbsp;<span class="op" id="4048252">:=</span>&nbsp;<span class="ident" id="4048255">runtimeNano</span><span class="op" id="4048266">(</span><span class="op" id="4048267">)</span>&nbsp;<span class="op" id="4048269">+</span>&nbsp;<span class="ident" id="4048271">int64</span><span class="op" id="4048276">(</span><span class="ident" id="4048277">t</span><span class="op" id="4048278">.</span><span class="ident" id="4048279">Sub</span><span class="op" id="4048282">(</span><span class="ident" id="4048283">time</span><span class="op" id="4048287">.</span><span class="ident" id="4048288">Now</span><span class="op" id="4048291">(</span><span class="op" id="4048292">)</span><span class="op" id="4048293">)</span><span class="op" id="4048294">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048297">if</span>&nbsp;<span class="ident" id="4048300">t</span><span class="op" id="4048301">.</span><span class="ident" id="4048302">IsZero</span><span class="op" id="4048308">(</span><span class="op" id="4048309">)</span>&nbsp;<span class="op" id="4048311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048315">d</span>&nbsp;<span class="op" id="4048317">=</span>&nbsp;<span class="num" id="4048319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048325">if</span>&nbsp;<span class="ident" id="4048328">err</span>&nbsp;<span class="op" id="4048332">:=</span>&nbsp;<span class="ident" id="4048335">fd</span><span class="op" id="4048337">.</span><span class="ident" id="4048338">incref</span><span class="op" id="4048344">(</span><span class="op" id="4048345">)</span><span class="op" id="4048346">;</span>&nbsp;<span class="ident" id="4048348">err</span>&nbsp;<span class="op" id="4048352">!=</span>&nbsp;<span class="ident" id="4048355">nil</span>&nbsp;<span class="op" id="4048359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048363">return</span>&nbsp;<span class="ident" id="4048370">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4048375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048378">runtime_pollSetDeadline</span><span class="op" id="4048401">(</span><span class="ident" id="4048402">fd</span><span class="op" id="4048404">.</span><span class="ident" id="4048405">pd</span><span class="op" id="4048407">.</span><span class="ident" id="4048408">runtimeCtx</span><span class="op" id="4048418">,</span>&nbsp;<span class="ident" id="4048420">d</span><span class="op" id="4048421">,</span>&nbsp;<span class="ident" id="4048423">mode</span><span class="op" id="4048427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4048430">fd</span><span class="op" id="4048432">.</span><span class="ident" id="4048433">decref</span><span class="op" id="4048439">(</span><span class="op" id="4048440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4048443">return</span>&nbsp;<span class="ident" id="4048450">nil</span><br>
<span class="lineno"></span><span class="op" id="4048454">}</span>
</div>
</body>
</html>
