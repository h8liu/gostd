<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html" class="current">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4976212">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4976267">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4976321">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4976372">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4976452">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4976481">package</span>&nbsp;<span class="ident" id="4976489">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976495">import</span>&nbsp;<span class="op" id="4976502">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976505">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976514">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976532">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976542">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976550">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976564">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4976570">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4976577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976580">const</span>&nbsp;<span class="op" id="4976586">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976589">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4976601">=</span>&nbsp;<span class="num" id="4976603">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976609">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4976621">=</span>&nbsp;<span class="num" id="4976623">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976629">gzipDeflate</span>&nbsp;<span class="op" id="4976641">=</span>&nbsp;<span class="num" id="4976643">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976646">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4976658">=</span>&nbsp;<span class="num" id="4976660">1</span>&nbsp;<span class="op" id="4976662">&lt;&lt;</span>&nbsp;<span class="num" id="4976665">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976668">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4976680">=</span>&nbsp;<span class="num" id="4976682">1</span>&nbsp;<span class="op" id="4976684">&lt;&lt;</span>&nbsp;<span class="num" id="4976687">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976690">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4976702">=</span>&nbsp;<span class="num" id="4976704">1</span>&nbsp;<span class="op" id="4976706">&lt;&lt;</span>&nbsp;<span class="num" id="4976709">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976712">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4976724">=</span>&nbsp;<span class="num" id="4976726">1</span>&nbsp;<span class="op" id="4976728">&lt;&lt;</span>&nbsp;<span class="num" id="4976731">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976734">flagComment</span>&nbsp;<span class="op" id="4976746">=</span>&nbsp;<span class="num" id="4976748">1</span>&nbsp;<span class="op" id="4976750">&lt;&lt;</span>&nbsp;<span class="num" id="4976753">4</span><br>
<span class="lineno"></span><span class="op" id="4976755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4976758">func</span>&nbsp;<span class="ident" id="4976763">makeReader</span><span class="op" id="4976773">(</span><span class="ident" id="4976774">r</span>&nbsp;<span class="ident" id="4976776">io</span><span class="op" id="4976778">.</span><span class="ident" id="4976779">Reader</span><span class="op" id="4976785">)</span>&nbsp;<span class="ident" id="4976787">flate</span><span class="op" id="4976792">.</span><span class="ident" id="4976793">Reader</span>&nbsp;<span class="op" id="4976800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976803">if</span>&nbsp;<span class="ident" id="4976806">rr</span><span class="op" id="4976808">,</span>&nbsp;<span class="ident" id="4976810">ok</span>&nbsp;<span class="op" id="4976813">:=</span>&nbsp;<span class="ident" id="4976816">r</span><span class="op" id="4976817">.</span><span class="op" id="4976818">(</span><span class="ident" id="4976819">flate</span><span class="op" id="4976824">.</span><span class="ident" id="4976825">Reader</span><span class="op" id="4976831">)</span><span class="op" id="4976832">;</span>&nbsp;<span class="ident" id="4976834">ok</span>&nbsp;<span class="op" id="4976837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976841">return</span>&nbsp;<span class="ident" id="4976848">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4976852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4976855">return</span>&nbsp;<span class="ident" id="4976862">bufio</span><span class="op" id="4976867">.</span><span class="ident" id="4976868">NewReader</span><span class="op" id="4976877">(</span><span class="ident" id="4976878">r</span><span class="op" id="4976879">)</span><br>
<span class="lineno">35</span><span class="op" id="4976881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4976884">var</span>&nbsp;<span class="op" id="4976888">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4976891">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4976972">ErrChecksum</span>&nbsp;<span class="op" id="4976984">=</span>&nbsp;<span class="ident" id="4976986">errors</span><span class="op" id="4976992">.</span><span class="ident" id="4976993">New</span><span class="op" id="4976996">(</span><span class="string" id="4976997">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4977021">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4977024">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977101">ErrHeader</span>&nbsp;<span class="op" id="4977111">=</span>&nbsp;<span class="ident" id="4977113">errors</span><span class="op" id="4977119">.</span><span class="ident" id="4977120">New</span><span class="op" id="4977123">(</span><span class="string" id="4977124">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4977146">)</span><br>
<span class="lineno"></span><span class="op" id="4977148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4977151">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4977227">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4977301">type</span>&nbsp;<span class="ident" id="4977306">Header</span>&nbsp;<span class="keyword" id="4977313">struct</span>&nbsp;<span class="op" id="4977320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977323">Comment</span>&nbsp;<span class="builtintype" id="4977331">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4977341">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977353">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4977361">[</span><span class="op" id="4977362">]</span><span class="builtintype" id="4977363">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4977371">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977388">ModTime</span>&nbsp;<span class="ident" id="4977396">time</span><span class="op" id="4977400">.</span><span class="ident" id="4977401">Time</span>&nbsp;<span class="comment" id="4977406">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977428">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4977436">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4977446">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977460">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4977468">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4977478">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4977503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4977506">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4977563">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4977620">//</span><br>
<span class="lineno"></span><span class="comment" id="4977623">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4977688">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4977740">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4977802">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4977861">//</span><br>
<span class="lineno"></span><span class="comment" id="4977864">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4977932">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4977982">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4978041">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4978109">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4978172">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4978204">type</span>&nbsp;<span class="ident" id="4978209">Reader</span>&nbsp;<span class="keyword" id="4978216">struct</span>&nbsp;<span class="op" id="4978223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978226">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978234">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4978247">flate</span><span class="op" id="4978252">.</span><span class="ident" id="4978253">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978261">decompressor</span>&nbsp;<span class="ident" id="4978274">io</span><span class="op" id="4978276">.</span><span class="ident" id="4978277">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978289">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4978302">hash</span><span class="op" id="4978306">.</span><span class="ident" id="4978307">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978315">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978328">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978336">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978349">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978355">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4978368">[</span><span class="num" id="4978369">512</span><span class="op" id="4978372">]</span><span class="builtintype" id="4978373">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978379">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978392">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978399">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4978412">bool</span><br>
<span class="lineno"></span><span class="op" id="4978417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4978420">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4978480">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4978527">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4978589">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4978665">func</span>&nbsp;<span class="ident" id="4978670">NewReader</span><span class="op" id="4978679">(</span><span class="ident" id="4978680">r</span>&nbsp;<span class="ident" id="4978682">io</span><span class="op" id="4978684">.</span><span class="ident" id="4978685">Reader</span><span class="op" id="4978691">)</span>&nbsp;<span class="op" id="4978693">(</span><span class="op" id="4978694">*</span><span class="ident" id="4978695">Reader</span><span class="op" id="4978701">,</span>&nbsp;<span class="builtintype" id="4978703">error</span><span class="op" id="4978708">)</span>&nbsp;<span class="op" id="4978710">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978713">z</span>&nbsp;<span class="op" id="4978715">:=</span>&nbsp;<span class="builtinfunc" id="4978718">new</span><span class="op" id="4978721">(</span><span class="ident" id="4978722">Reader</span><span class="op" id="4978728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978731">z</span><span class="op" id="4978732">.</span><span class="ident" id="4978733">r</span>&nbsp;<span class="op" id="4978735">=</span>&nbsp;<span class="ident" id="4978737">makeReader</span><span class="op" id="4978747">(</span><span class="ident" id="4978748">r</span><span class="op" id="4978749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978752">z</span><span class="op" id="4978753">.</span><span class="ident" id="4978754">multistream</span>&nbsp;<span class="op" id="4978766">=</span>&nbsp;<span class="builtintype" id="4978768">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978774">z</span><span class="op" id="4978775">.</span><span class="ident" id="4978776">digest</span>&nbsp;<span class="op" id="4978783">=</span>&nbsp;<span class="ident" id="4978785">crc32</span><span class="op" id="4978790">.</span><span class="ident" id="4978791">NewIEEE</span><span class="op" id="4978798">(</span><span class="op" id="4978799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978802">if</span>&nbsp;<span class="ident" id="4978805">err</span>&nbsp;<span class="op" id="4978809">:=</span>&nbsp;<span class="ident" id="4978812">z</span><span class="op" id="4978813">.</span><span class="ident" id="4978814">readHeader</span><span class="op" id="4978824">(</span><span class="builtintype" id="4978825">true</span><span class="op" id="4978829">)</span><span class="op" id="4978830">;</span>&nbsp;<span class="ident" id="4978832">err</span>&nbsp;<span class="op" id="4978836">!=</span>&nbsp;<span class="ident" id="4978839">nil</span>&nbsp;<span class="op" id="4978843">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978847">return</span>&nbsp;<span class="ident" id="4978854">nil</span><span class="op" id="4978857">,</span>&nbsp;<span class="ident" id="4978859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4978864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4978867">return</span>&nbsp;<span class="ident" id="4978874">z</span><span class="op" id="4978875">,</span>&nbsp;<span class="ident" id="4978877">nil</span><br>
<span class="lineno"></span><span class="op" id="4978881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4978884">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4978954">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4979030">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4979097">func</span>&nbsp;<span class="op" id="4979102">(</span><span class="ident" id="4979103">z</span>&nbsp;<span class="op" id="4979105">*</span><span class="ident" id="4979106">Reader</span><span class="op" id="4979112">)</span>&nbsp;<span class="ident" id="4979114">Reset</span><span class="op" id="4979119">(</span><span class="ident" id="4979120">r</span>&nbsp;<span class="ident" id="4979122">io</span><span class="op" id="4979124">.</span><span class="ident" id="4979125">Reader</span><span class="op" id="4979131">)</span>&nbsp;<span class="builtintype" id="4979133">error</span>&nbsp;<span class="op" id="4979139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979142">z</span><span class="op" id="4979143">.</span><span class="ident" id="4979144">r</span>&nbsp;<span class="op" id="4979146">=</span>&nbsp;<span class="ident" id="4979148">makeReader</span><span class="op" id="4979158">(</span><span class="ident" id="4979159">r</span><span class="op" id="4979160">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979163">if</span>&nbsp;<span class="ident" id="4979166">z</span><span class="op" id="4979167">.</span><span class="ident" id="4979168">digest</span>&nbsp;<span class="op" id="4979175">==</span>&nbsp;<span class="ident" id="4979178">nil</span>&nbsp;<span class="op" id="4979182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979186">z</span><span class="op" id="4979187">.</span><span class="ident" id="4979188">digest</span>&nbsp;<span class="op" id="4979195">=</span>&nbsp;<span class="ident" id="4979197">crc32</span><span class="op" id="4979202">.</span><span class="ident" id="4979203">NewIEEE</span><span class="op" id="4979210">(</span><span class="op" id="4979211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979214">}</span>&nbsp;<span class="keyword" id="4979216">else</span>&nbsp;<span class="op" id="4979221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979225">z</span><span class="op" id="4979226">.</span><span class="ident" id="4979227">digest</span><span class="op" id="4979233">.</span><span class="ident" id="4979234">Reset</span><span class="op" id="4979239">(</span><span class="op" id="4979240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979243">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979246">z</span><span class="op" id="4979247">.</span><span class="ident" id="4979248">size</span>&nbsp;<span class="op" id="4979253">=</span>&nbsp;<span class="num" id="4979255">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979258">z</span><span class="op" id="4979259">.</span><span class="ident" id="4979260">err</span>&nbsp;<span class="op" id="4979264">=</span>&nbsp;<span class="ident" id="4979266">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979271">z</span><span class="op" id="4979272">.</span><span class="ident" id="4979273">multistream</span>&nbsp;<span class="op" id="4979285">=</span>&nbsp;<span class="builtintype" id="4979287">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979293">return</span>&nbsp;<span class="ident" id="4979300">z</span><span class="op" id="4979301">.</span><span class="ident" id="4979302">readHeader</span><span class="op" id="4979312">(</span><span class="builtintype" id="4979313">true</span><span class="op" id="4979317">)</span><br>
<span class="lineno"></span><span class="op" id="4979319">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4979322">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4979393">//</span><br>
<span class="lineno"></span><span class="comment" id="4979396">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4979471">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4979541">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4979619">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4979697">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4979761">//</span><br>
<span class="lineno"></span><span class="comment" id="4979764">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4979841">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4979917">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4979983">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4980052">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4980127">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4980185">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4980264">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4980326">func</span>&nbsp;<span class="op" id="4980331">(</span><span class="ident" id="4980332">z</span>&nbsp;<span class="op" id="4980334">*</span><span class="ident" id="4980335">Reader</span><span class="op" id="4980341">)</span>&nbsp;<span class="ident" id="4980343">Multistream</span><span class="op" id="4980354">(</span><span class="ident" id="4980355">ok</span>&nbsp;<span class="builtintype" id="4980358">bool</span><span class="op" id="4980362">)</span>&nbsp;<span class="op" id="4980364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980367">z</span><span class="op" id="4980368">.</span><span class="ident" id="4980369">multistream</span>&nbsp;<span class="op" id="4980381">=</span>&nbsp;<span class="ident" id="4980383">ok</span><br>
<span class="lineno"></span><span class="op" id="4980386">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4980389">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4980450">func</span>&nbsp;<span class="ident" id="4980455">get4</span><span class="op" id="4980459">(</span><span class="ident" id="4980460">p</span>&nbsp;<span class="op" id="4980462">[</span><span class="op" id="4980463">]</span><span class="builtintype" id="4980464">byte</span><span class="op" id="4980468">)</span>&nbsp;<span class="builtintype" id="4980470">uint32</span>&nbsp;<span class="op" id="4980477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980480">return</span>&nbsp;<span class="builtintype" id="4980487">uint32</span><span class="op" id="4980493">(</span><span class="ident" id="4980494">p</span><span class="op" id="4980495">[</span><span class="num" id="4980496">0</span><span class="op" id="4980497">]</span><span class="op" id="4980498">)</span>&nbsp;<span class="op" id="4980500">|</span>&nbsp;<span class="builtintype" id="4980502">uint32</span><span class="op" id="4980508">(</span><span class="ident" id="4980509">p</span><span class="op" id="4980510">[</span><span class="num" id="4980511">1</span><span class="op" id="4980512">]</span><span class="op" id="4980513">)</span><span class="op" id="4980514">&lt;&lt;</span><span class="num" id="4980516">8</span>&nbsp;<span class="op" id="4980518">|</span>&nbsp;<span class="builtintype" id="4980520">uint32</span><span class="op" id="4980526">(</span><span class="ident" id="4980527">p</span><span class="op" id="4980528">[</span><span class="num" id="4980529">2</span><span class="op" id="4980530">]</span><span class="op" id="4980531">)</span><span class="op" id="4980532">&lt;&lt;</span><span class="num" id="4980534">16</span>&nbsp;<span class="op" id="4980537">|</span>&nbsp;<span class="builtintype" id="4980539">uint32</span><span class="op" id="4980545">(</span><span class="ident" id="4980546">p</span><span class="op" id="4980547">[</span><span class="num" id="4980548">3</span><span class="op" id="4980549">]</span><span class="op" id="4980550">)</span><span class="op" id="4980551">&lt;&lt;</span><span class="num" id="4980553">24</span><br>
<span class="lineno"></span><span class="op" id="4980556">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4980559">func</span>&nbsp;<span class="op" id="4980564">(</span><span class="ident" id="4980565">z</span>&nbsp;<span class="op" id="4980567">*</span><span class="ident" id="4980568">Reader</span><span class="op" id="4980574">)</span>&nbsp;<span class="ident" id="4980576">readString</span><span class="op" id="4980586">(</span><span class="op" id="4980587">)</span>&nbsp;<span class="op" id="4980589">(</span><span class="builtintype" id="4980590">string</span><span class="op" id="4980596">,</span>&nbsp;<span class="builtintype" id="4980598">error</span><span class="op" id="4980603">)</span>&nbsp;<span class="op" id="4980605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980608">var</span>&nbsp;<span class="ident" id="4980612">err</span>&nbsp;<span class="builtintype" id="4980616">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980623">needconv</span>&nbsp;<span class="op" id="4980632">:=</span>&nbsp;<span class="builtintype" id="4980635">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980642">for</span>&nbsp;<span class="ident" id="4980646">i</span>&nbsp;<span class="op" id="4980648">:=</span>&nbsp;<span class="num" id="4980651">0</span><span class="op" id="4980652">;</span>&nbsp;<span class="op" id="4980654">;</span>&nbsp;<span class="ident" id="4980656">i</span><span class="op" id="4980657">++</span>&nbsp;<span class="op" id="4980660">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980664">if</span>&nbsp;<span class="ident" id="4980667">i</span>&nbsp;<span class="op" id="4980669">&gt;=</span>&nbsp;<span class="builtinfunc" id="4980672">len</span><span class="op" id="4980675">(</span><span class="ident" id="4980676">z</span><span class="op" id="4980677">.</span><span class="ident" id="4980678">buf</span><span class="op" id="4980681">)</span>&nbsp;<span class="op" id="4980683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980688">return</span>&nbsp;<span class="string" id="4980695">&#34;&#34;</span><span class="op" id="4980697">,</span>&nbsp;<span class="ident" id="4980699">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980715">z</span><span class="op" id="4980716">.</span><span class="ident" id="4980717">buf</span><span class="op" id="4980720">[</span><span class="ident" id="4980721">i</span><span class="op" id="4980722">]</span><span class="op" id="4980723">,</span>&nbsp;<span class="ident" id="4980725">err</span>&nbsp;<span class="op" id="4980729">=</span>&nbsp;<span class="ident" id="4980731">z</span><span class="op" id="4980732">.</span><span class="ident" id="4980733">r</span><span class="op" id="4980734">.</span><span class="ident" id="4980735">ReadByte</span><span class="op" id="4980743">(</span><span class="op" id="4980744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980748">if</span>&nbsp;<span class="ident" id="4980751">err</span>&nbsp;<span class="op" id="4980755">!=</span>&nbsp;<span class="ident" id="4980758">nil</span>&nbsp;<span class="op" id="4980762">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980767">return</span>&nbsp;<span class="string" id="4980774">&#34;&#34;</span><span class="op" id="4980776">,</span>&nbsp;<span class="ident" id="4980778">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980788">if</span>&nbsp;<span class="ident" id="4980791">z</span><span class="op" id="4980792">.</span><span class="ident" id="4980793">buf</span><span class="op" id="4980796">[</span><span class="ident" id="4980797">i</span><span class="op" id="4980798">]</span>&nbsp;<span class="op" id="4980800">&gt;</span>&nbsp;<span class="num" id="4980802">0x7f</span>&nbsp;<span class="op" id="4980807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980812">needconv</span>&nbsp;<span class="op" id="4980821">=</span>&nbsp;<span class="builtintype" id="4980823">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980830">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980834">if</span>&nbsp;<span class="ident" id="4980837">z</span><span class="op" id="4980838">.</span><span class="ident" id="4980839">buf</span><span class="op" id="4980842">[</span><span class="ident" id="4980843">i</span><span class="op" id="4980844">]</span>&nbsp;<span class="op" id="4980846">==</span>&nbsp;<span class="num" id="4980849">0</span>&nbsp;<span class="op" id="4980851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4980856">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980942">if</span>&nbsp;<span class="ident" id="4980945">needconv</span>&nbsp;<span class="op" id="4980954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980960">s</span>&nbsp;<span class="op" id="4980962">:=</span>&nbsp;<span class="builtinfunc" id="4980965">make</span><span class="op" id="4980969">(</span><span class="op" id="4980970">[</span><span class="op" id="4980971">]</span><span class="builtintype" id="4980972">rune</span><span class="op" id="4980976">,</span>&nbsp;<span class="num" id="4980978">0</span><span class="op" id="4980979">,</span>&nbsp;<span class="ident" id="4980981">i</span><span class="op" id="4980982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980988">for</span>&nbsp;<span class="ident" id="4980992">_</span><span class="op" id="4980993">,</span>&nbsp;<span class="ident" id="4980995">v</span>&nbsp;<span class="op" id="4980997">:=</span>&nbsp;<span class="keyword" id="4981000">range</span>&nbsp;<span class="ident" id="4981006">z</span><span class="op" id="4981007">.</span><span class="ident" id="4981008">buf</span><span class="op" id="4981011">[</span><span class="num" id="4981012">0</span><span class="op" id="4981013">:</span><span class="ident" id="4981014">i</span><span class="op" id="4981015">]</span>&nbsp;<span class="op" id="4981017">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981024">s</span>&nbsp;<span class="op" id="4981026">=</span>&nbsp;<span class="builtinfunc" id="4981028">append</span><span class="op" id="4981034">(</span><span class="ident" id="4981035">s</span><span class="op" id="4981036">,</span>&nbsp;<span class="builtintype" id="4981038">rune</span><span class="op" id="4981042">(</span><span class="ident" id="4981043">v</span><span class="op" id="4981044">)</span><span class="op" id="4981045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981057">return</span>&nbsp;<span class="builtintype" id="4981064">string</span><span class="op" id="4981070">(</span><span class="ident" id="4981071">s</span><span class="op" id="4981072">)</span><span class="op" id="4981073">,</span>&nbsp;<span class="ident" id="4981075">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981087">return</span>&nbsp;<span class="builtintype" id="4981094">string</span><span class="op" id="4981100">(</span><span class="ident" id="4981101">z</span><span class="op" id="4981102">.</span><span class="ident" id="4981103">buf</span><span class="op" id="4981106">[</span><span class="num" id="4981107">0</span><span class="op" id="4981108">:</span><span class="ident" id="4981109">i</span><span class="op" id="4981110">]</span><span class="op" id="4981111">)</span><span class="op" id="4981112">,</span>&nbsp;<span class="ident" id="4981114">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981123">}</span><br>
<span class="lineno"></span><span class="op" id="4981125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4981128">func</span>&nbsp;<span class="op" id="4981133">(</span><span class="ident" id="4981134">z</span>&nbsp;<span class="op" id="4981136">*</span><span class="ident" id="4981137">Reader</span><span class="op" id="4981143">)</span>&nbsp;<span class="ident" id="4981145">read2</span><span class="op" id="4981150">(</span><span class="op" id="4981151">)</span>&nbsp;<span class="op" id="4981153">(</span><span class="builtintype" id="4981154">uint32</span><span class="op" id="4981160">,</span>&nbsp;<span class="builtintype" id="4981162">error</span><span class="op" id="4981167">)</span>&nbsp;<span class="op" id="4981169">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981172">_</span><span class="op" id="4981173">,</span>&nbsp;<span class="ident" id="4981175">err</span>&nbsp;<span class="op" id="4981179">:=</span>&nbsp;<span class="ident" id="4981182">io</span><span class="op" id="4981184">.</span><span class="ident" id="4981185">ReadFull</span><span class="op" id="4981193">(</span><span class="ident" id="4981194">z</span><span class="op" id="4981195">.</span><span class="ident" id="4981196">r</span><span class="op" id="4981197">,</span>&nbsp;<span class="ident" id="4981199">z</span><span class="op" id="4981200">.</span><span class="ident" id="4981201">buf</span><span class="op" id="4981204">[</span><span class="num" id="4981205">0</span><span class="op" id="4981206">:</span><span class="num" id="4981207">2</span><span class="op" id="4981208">]</span><span class="op" id="4981209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981212">if</span>&nbsp;<span class="ident" id="4981215">err</span>&nbsp;<span class="op" id="4981219">!=</span>&nbsp;<span class="ident" id="4981222">nil</span>&nbsp;<span class="op" id="4981226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981230">return</span>&nbsp;<span class="num" id="4981237">0</span><span class="op" id="4981238">,</span>&nbsp;<span class="ident" id="4981240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981248">return</span>&nbsp;<span class="builtintype" id="4981255">uint32</span><span class="op" id="4981261">(</span><span class="ident" id="4981262">z</span><span class="op" id="4981263">.</span><span class="ident" id="4981264">buf</span><span class="op" id="4981267">[</span><span class="num" id="4981268">0</span><span class="op" id="4981269">]</span><span class="op" id="4981270">)</span>&nbsp;<span class="op" id="4981272">|</span>&nbsp;<span class="builtintype" id="4981274">uint32</span><span class="op" id="4981280">(</span><span class="ident" id="4981281">z</span><span class="op" id="4981282">.</span><span class="ident" id="4981283">buf</span><span class="op" id="4981286">[</span><span class="num" id="4981287">1</span><span class="op" id="4981288">]</span><span class="op" id="4981289">)</span><span class="op" id="4981290">&lt;&lt;</span><span class="num" id="4981292">8</span><span class="op" id="4981293">,</span>&nbsp;<span class="ident" id="4981295">nil</span><br>
<span class="lineno">170</span><span class="op" id="4981299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4981302">func</span>&nbsp;<span class="op" id="4981307">(</span><span class="ident" id="4981308">z</span>&nbsp;<span class="op" id="4981310">*</span><span class="ident" id="4981311">Reader</span><span class="op" id="4981317">)</span>&nbsp;<span class="ident" id="4981319">readHeader</span><span class="op" id="4981329">(</span><span class="ident" id="4981330">save</span>&nbsp;<span class="builtintype" id="4981335">bool</span><span class="op" id="4981339">)</span>&nbsp;<span class="builtintype" id="4981341">error</span>&nbsp;<span class="op" id="4981347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981350">_</span><span class="op" id="4981351">,</span>&nbsp;<span class="ident" id="4981353">err</span>&nbsp;<span class="op" id="4981357">:=</span>&nbsp;<span class="ident" id="4981360">io</span><span class="op" id="4981362">.</span><span class="ident" id="4981363">ReadFull</span><span class="op" id="4981371">(</span><span class="ident" id="4981372">z</span><span class="op" id="4981373">.</span><span class="ident" id="4981374">r</span><span class="op" id="4981375">,</span>&nbsp;<span class="ident" id="4981377">z</span><span class="op" id="4981378">.</span><span class="ident" id="4981379">buf</span><span class="op" id="4981382">[</span><span class="num" id="4981383">0</span><span class="op" id="4981384">:</span><span class="num" id="4981385">10</span><span class="op" id="4981387">]</span><span class="op" id="4981388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981391">if</span>&nbsp;<span class="ident" id="4981394">err</span>&nbsp;<span class="op" id="4981398">!=</span>&nbsp;<span class="ident" id="4981401">nil</span>&nbsp;<span class="op" id="4981405">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981409">return</span>&nbsp;<span class="ident" id="4981416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981424">if</span>&nbsp;<span class="ident" id="4981427">z</span><span class="op" id="4981428">.</span><span class="ident" id="4981429">buf</span><span class="op" id="4981432">[</span><span class="num" id="4981433">0</span><span class="op" id="4981434">]</span>&nbsp;<span class="op" id="4981436">!=</span>&nbsp;<span class="ident" id="4981439">gzipID1</span>&nbsp;<span class="op" id="4981447">||</span>&nbsp;<span class="ident" id="4981450">z</span><span class="op" id="4981451">.</span><span class="ident" id="4981452">buf</span><span class="op" id="4981455">[</span><span class="num" id="4981456">1</span><span class="op" id="4981457">]</span>&nbsp;<span class="op" id="4981459">!=</span>&nbsp;<span class="ident" id="4981462">gzipID2</span>&nbsp;<span class="op" id="4981470">||</span>&nbsp;<span class="ident" id="4981473">z</span><span class="op" id="4981474">.</span><span class="ident" id="4981475">buf</span><span class="op" id="4981478">[</span><span class="num" id="4981479">2</span><span class="op" id="4981480">]</span>&nbsp;<span class="op" id="4981482">!=</span>&nbsp;<span class="ident" id="4981485">gzipDeflate</span>&nbsp;<span class="op" id="4981497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981501">return</span>&nbsp;<span class="ident" id="4981508">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981519">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981522">z</span><span class="op" id="4981523">.</span><span class="ident" id="4981524">flg</span>&nbsp;<span class="op" id="4981528">=</span>&nbsp;<span class="ident" id="4981530">z</span><span class="op" id="4981531">.</span><span class="ident" id="4981532">buf</span><span class="op" id="4981535">[</span><span class="num" id="4981536">3</span><span class="op" id="4981537">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981540">if</span>&nbsp;<span class="ident" id="4981543">save</span>&nbsp;<span class="op" id="4981548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981552">z</span><span class="op" id="4981553">.</span><span class="ident" id="4981554">ModTime</span>&nbsp;<span class="op" id="4981562">=</span>&nbsp;<span class="ident" id="4981564">time</span><span class="op" id="4981568">.</span><span class="ident" id="4981569">Unix</span><span class="op" id="4981573">(</span><span class="ident" id="4981574">int64</span><span class="op" id="4981579">(</span><span class="ident" id="4981580">get4</span><span class="op" id="4981584">(</span><span class="ident" id="4981585">z</span><span class="op" id="4981586">.</span><span class="ident" id="4981587">buf</span><span class="op" id="4981590">[</span><span class="num" id="4981591">4</span><span class="op" id="4981592">:</span><span class="num" id="4981593">8</span><span class="op" id="4981594">]</span><span class="op" id="4981595">)</span><span class="op" id="4981596">)</span><span class="op" id="4981597">,</span>&nbsp;<span class="num" id="4981599">0</span><span class="op" id="4981600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981604">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981634">z</span><span class="op" id="4981635">.</span><span class="ident" id="4981636">OS</span>&nbsp;<span class="op" id="4981639">=</span>&nbsp;<span class="ident" id="4981641">z</span><span class="op" id="4981642">.</span><span class="ident" id="4981643">buf</span><span class="op" id="4981646">[</span><span class="num" id="4981647">9</span><span class="op" id="4981648">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981654">z</span><span class="op" id="4981655">.</span><span class="ident" id="4981656">digest</span><span class="op" id="4981662">.</span><span class="ident" id="4981663">Reset</span><span class="op" id="4981668">(</span><span class="op" id="4981669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981672">z</span><span class="op" id="4981673">.</span><span class="ident" id="4981674">digest</span><span class="op" id="4981680">.</span><span class="ident" id="4981681">Write</span><span class="op" id="4981686">(</span><span class="ident" id="4981687">z</span><span class="op" id="4981688">.</span><span class="ident" id="4981689">buf</span><span class="op" id="4981692">[</span><span class="num" id="4981693">0</span><span class="op" id="4981694">:</span><span class="num" id="4981695">10</span><span class="op" id="4981697">]</span><span class="op" id="4981698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981702">if</span>&nbsp;<span class="ident" id="4981705">z</span><span class="op" id="4981706">.</span><span class="ident" id="4981707">flg</span><span class="op" id="4981710">&amp;</span><span class="ident" id="4981711">flagExtra</span>&nbsp;<span class="op" id="4981721">!=</span>&nbsp;<span class="num" id="4981724">0</span>&nbsp;<span class="op" id="4981726">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981730">n</span><span class="op" id="4981731">,</span>&nbsp;<span class="ident" id="4981733">err</span>&nbsp;<span class="op" id="4981737">:=</span>&nbsp;<span class="ident" id="4981740">z</span><span class="op" id="4981741">.</span><span class="ident" id="4981742">read2</span><span class="op" id="4981747">(</span><span class="op" id="4981748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981752">if</span>&nbsp;<span class="ident" id="4981755">err</span>&nbsp;<span class="op" id="4981759">!=</span>&nbsp;<span class="ident" id="4981762">nil</span>&nbsp;<span class="op" id="4981766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981771">return</span>&nbsp;<span class="ident" id="4981778">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981788">data</span>&nbsp;<span class="op" id="4981793">:=</span>&nbsp;<span class="builtinfunc" id="4981796">make</span><span class="op" id="4981800">(</span><span class="op" id="4981801">[</span><span class="op" id="4981802">]</span><span class="builtintype" id="4981803">byte</span><span class="op" id="4981807">,</span>&nbsp;<span class="ident" id="4981809">n</span><span class="op" id="4981810">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981814">if</span>&nbsp;<span class="ident" id="4981817">_</span><span class="op" id="4981818">,</span>&nbsp;<span class="ident" id="4981820">err</span>&nbsp;<span class="op" id="4981824">=</span>&nbsp;<span class="ident" id="4981826">io</span><span class="op" id="4981828">.</span><span class="ident" id="4981829">ReadFull</span><span class="op" id="4981837">(</span><span class="ident" id="4981838">z</span><span class="op" id="4981839">.</span><span class="ident" id="4981840">r</span><span class="op" id="4981841">,</span>&nbsp;<span class="ident" id="4981843">data</span><span class="op" id="4981847">)</span><span class="op" id="4981848">;</span>&nbsp;<span class="ident" id="4981850">err</span>&nbsp;<span class="op" id="4981854">!=</span>&nbsp;<span class="ident" id="4981857">nil</span>&nbsp;<span class="op" id="4981861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981866">return</span>&nbsp;<span class="ident" id="4981873">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981883">if</span>&nbsp;<span class="ident" id="4981886">save</span>&nbsp;<span class="op" id="4981891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981896">z</span><span class="op" id="4981897">.</span><span class="ident" id="4981898">Extra</span>&nbsp;<span class="op" id="4981904">=</span>&nbsp;<span class="ident" id="4981906">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981920">var</span>&nbsp;<span class="ident" id="4981924">s</span>&nbsp;<span class="builtintype" id="4981926">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981934">if</span>&nbsp;<span class="ident" id="4981937">z</span><span class="op" id="4981938">.</span><span class="ident" id="4981939">flg</span><span class="op" id="4981942">&amp;</span><span class="ident" id="4981943">flagName</span>&nbsp;<span class="op" id="4981952">!=</span>&nbsp;<span class="num" id="4981955">0</span>&nbsp;<span class="op" id="4981957">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981961">if</span>&nbsp;<span class="ident" id="4981964">s</span><span class="op" id="4981965">,</span>&nbsp;<span class="ident" id="4981967">err</span>&nbsp;<span class="op" id="4981971">=</span>&nbsp;<span class="ident" id="4981973">z</span><span class="op" id="4981974">.</span><span class="ident" id="4981975">readString</span><span class="op" id="4981985">(</span><span class="op" id="4981986">)</span><span class="op" id="4981987">;</span>&nbsp;<span class="ident" id="4981989">err</span>&nbsp;<span class="op" id="4981993">!=</span>&nbsp;<span class="ident" id="4981996">nil</span>&nbsp;<span class="op" id="4982000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982005">return</span>&nbsp;<span class="ident" id="4982012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982022">if</span>&nbsp;<span class="ident" id="4982025">save</span>&nbsp;<span class="op" id="4982030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982035">z</span><span class="op" id="4982036">.</span><span class="ident" id="4982037">Name</span>&nbsp;<span class="op" id="4982042">=</span>&nbsp;<span class="ident" id="4982044">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982055">if</span>&nbsp;<span class="ident" id="4982058">z</span><span class="op" id="4982059">.</span><span class="ident" id="4982060">flg</span><span class="op" id="4982063">&amp;</span><span class="ident" id="4982064">flagComment</span>&nbsp;<span class="op" id="4982076">!=</span>&nbsp;<span class="num" id="4982079">0</span>&nbsp;<span class="op" id="4982081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982085">if</span>&nbsp;<span class="ident" id="4982088">s</span><span class="op" id="4982089">,</span>&nbsp;<span class="ident" id="4982091">err</span>&nbsp;<span class="op" id="4982095">=</span>&nbsp;<span class="ident" id="4982097">z</span><span class="op" id="4982098">.</span><span class="ident" id="4982099">readString</span><span class="op" id="4982109">(</span><span class="op" id="4982110">)</span><span class="op" id="4982111">;</span>&nbsp;<span class="ident" id="4982113">err</span>&nbsp;<span class="op" id="4982117">!=</span>&nbsp;<span class="ident" id="4982120">nil</span>&nbsp;<span class="op" id="4982124">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982129">return</span>&nbsp;<span class="ident" id="4982136">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982146">if</span>&nbsp;<span class="ident" id="4982149">save</span>&nbsp;<span class="op" id="4982154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982159">z</span><span class="op" id="4982160">.</span><span class="ident" id="4982161">Comment</span>&nbsp;<span class="op" id="4982169">=</span>&nbsp;<span class="ident" id="4982171">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982175">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982182">if</span>&nbsp;<span class="ident" id="4982185">z</span><span class="op" id="4982186">.</span><span class="ident" id="4982187">flg</span><span class="op" id="4982190">&amp;</span><span class="ident" id="4982191">flagHdrCrc</span>&nbsp;<span class="op" id="4982202">!=</span>&nbsp;<span class="num" id="4982205">0</span>&nbsp;<span class="op" id="4982207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982211">n</span><span class="op" id="4982212">,</span>&nbsp;<span class="ident" id="4982214">err</span>&nbsp;<span class="op" id="4982218">:=</span>&nbsp;<span class="ident" id="4982221">z</span><span class="op" id="4982222">.</span><span class="ident" id="4982223">read2</span><span class="op" id="4982228">(</span><span class="op" id="4982229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982233">if</span>&nbsp;<span class="ident" id="4982236">err</span>&nbsp;<span class="op" id="4982240">!=</span>&nbsp;<span class="ident" id="4982243">nil</span>&nbsp;<span class="op" id="4982247">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982252">return</span>&nbsp;<span class="ident" id="4982259">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982269">sum</span>&nbsp;<span class="op" id="4982273">:=</span>&nbsp;<span class="ident" id="4982276">z</span><span class="op" id="4982277">.</span><span class="ident" id="4982278">digest</span><span class="op" id="4982284">.</span><span class="ident" id="4982285">Sum32</span><span class="op" id="4982290">(</span><span class="op" id="4982291">)</span>&nbsp;<span class="op" id="4982293">&amp;</span>&nbsp;<span class="num" id="4982295">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982304">if</span>&nbsp;<span class="ident" id="4982307">n</span>&nbsp;<span class="op" id="4982309">!=</span>&nbsp;<span class="ident" id="4982312">sum</span>&nbsp;<span class="op" id="4982316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982321">return</span>&nbsp;<span class="ident" id="4982328">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982347">z</span><span class="op" id="4982348">.</span><span class="ident" id="4982349">digest</span><span class="op" id="4982355">.</span><span class="ident" id="4982356">Reset</span><span class="op" id="4982361">(</span><span class="op" id="4982362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982365">if</span>&nbsp;<span class="ident" id="4982368">z</span><span class="op" id="4982369">.</span><span class="ident" id="4982370">decompressor</span>&nbsp;<span class="op" id="4982383">==</span>&nbsp;<span class="ident" id="4982386">nil</span>&nbsp;<span class="op" id="4982390">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982394">z</span><span class="op" id="4982395">.</span><span class="ident" id="4982396">decompressor</span>&nbsp;<span class="op" id="4982409">=</span>&nbsp;<span class="ident" id="4982411">flate</span><span class="op" id="4982416">.</span><span class="ident" id="4982417">NewReader</span><span class="op" id="4982426">(</span><span class="ident" id="4982427">z</span><span class="op" id="4982428">.</span><span class="ident" id="4982429">r</span><span class="op" id="4982430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982433">}</span>&nbsp;<span class="keyword" id="4982435">else</span>&nbsp;<span class="op" id="4982440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982444">z</span><span class="op" id="4982445">.</span><span class="ident" id="4982446">decompressor</span><span class="op" id="4982458">.</span><span class="op" id="4982459">(</span><span class="ident" id="4982460">flate</span><span class="op" id="4982465">.</span><span class="ident" id="4982466">Resetter</span><span class="op" id="4982474">)</span><span class="op" id="4982475">.</span><span class="ident" id="4982476">Reset</span><span class="op" id="4982481">(</span><span class="ident" id="4982482">z</span><span class="op" id="4982483">.</span><span class="ident" id="4982484">r</span><span class="op" id="4982485">,</span>&nbsp;<span class="ident" id="4982487">nil</span><span class="op" id="4982490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982496">return</span>&nbsp;<span class="ident" id="4982503">nil</span><br>
<span class="lineno">240</span><span class="op" id="4982507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4982510">func</span>&nbsp;<span class="op" id="4982515">(</span><span class="ident" id="4982516">z</span>&nbsp;<span class="op" id="4982518">*</span><span class="ident" id="4982519">Reader</span><span class="op" id="4982525">)</span>&nbsp;<span class="ident" id="4982527">Read</span><span class="op" id="4982531">(</span><span class="ident" id="4982532">p</span>&nbsp;<span class="op" id="4982534">[</span><span class="op" id="4982535">]</span><span class="builtintype" id="4982536">byte</span><span class="op" id="4982540">)</span>&nbsp;<span class="op" id="4982542">(</span><span class="ident" id="4982543">n</span>&nbsp;<span class="builtintype" id="4982545">int</span><span class="op" id="4982548">,</span>&nbsp;<span class="ident" id="4982550">err</span>&nbsp;<span class="builtintype" id="4982554">error</span><span class="op" id="4982559">)</span>&nbsp;<span class="op" id="4982561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982564">if</span>&nbsp;<span class="ident" id="4982567">z</span><span class="op" id="4982568">.</span><span class="ident" id="4982569">err</span>&nbsp;<span class="op" id="4982573">!=</span>&nbsp;<span class="ident" id="4982576">nil</span>&nbsp;<span class="op" id="4982580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982584">return</span>&nbsp;<span class="num" id="4982591">0</span><span class="op" id="4982592">,</span>&nbsp;<span class="ident" id="4982594">z</span><span class="op" id="4982595">.</span><span class="ident" id="4982596">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982604">if</span>&nbsp;<span class="builtinfunc" id="4982607">len</span><span class="op" id="4982610">(</span><span class="ident" id="4982611">p</span><span class="op" id="4982612">)</span>&nbsp;<span class="op" id="4982614">==</span>&nbsp;<span class="num" id="4982617">0</span>&nbsp;<span class="op" id="4982619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982623">return</span>&nbsp;<span class="num" id="4982630">0</span><span class="op" id="4982631">,</span>&nbsp;<span class="ident" id="4982633">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982642">n</span><span class="op" id="4982643">,</span>&nbsp;<span class="ident" id="4982645">err</span>&nbsp;<span class="op" id="4982649">=</span>&nbsp;<span class="ident" id="4982651">z</span><span class="op" id="4982652">.</span><span class="ident" id="4982653">decompressor</span><span class="op" id="4982665">.</span><span class="ident" id="4982666">Read</span><span class="op" id="4982670">(</span><span class="ident" id="4982671">p</span><span class="op" id="4982672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982675">z</span><span class="op" id="4982676">.</span><span class="ident" id="4982677">digest</span><span class="op" id="4982683">.</span><span class="ident" id="4982684">Write</span><span class="op" id="4982689">(</span><span class="ident" id="4982690">p</span><span class="op" id="4982691">[</span><span class="num" id="4982692">0</span><span class="op" id="4982693">:</span><span class="ident" id="4982694">n</span><span class="op" id="4982695">]</span><span class="op" id="4982696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982699">z</span><span class="op" id="4982700">.</span><span class="ident" id="4982701">size</span>&nbsp;<span class="op" id="4982706">+=</span>&nbsp;<span class="builtintype" id="4982709">uint32</span><span class="op" id="4982715">(</span><span class="ident" id="4982716">n</span><span class="op" id="4982717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982720">if</span>&nbsp;<span class="ident" id="4982723">n</span>&nbsp;<span class="op" id="4982725">!=</span>&nbsp;<span class="num" id="4982728">0</span>&nbsp;<span class="op" id="4982730">||</span>&nbsp;<span class="ident" id="4982733">err</span>&nbsp;<span class="op" id="4982737">!=</span>&nbsp;<span class="ident" id="4982740">io</span><span class="op" id="4982742">.</span><span class="ident" id="4982743">EOF</span>&nbsp;<span class="op" id="4982747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982751">z</span><span class="op" id="4982752">.</span><span class="ident" id="4982753">err</span>&nbsp;<span class="op" id="4982757">=</span>&nbsp;<span class="ident" id="4982759">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982765">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4982777">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982819">if</span>&nbsp;<span class="ident" id="4982822">_</span><span class="op" id="4982823">,</span>&nbsp;<span class="ident" id="4982825">err</span>&nbsp;<span class="op" id="4982829">:=</span>&nbsp;<span class="ident" id="4982832">io</span><span class="op" id="4982834">.</span><span class="ident" id="4982835">ReadFull</span><span class="op" id="4982843">(</span><span class="ident" id="4982844">z</span><span class="op" id="4982845">.</span><span class="ident" id="4982846">r</span><span class="op" id="4982847">,</span>&nbsp;<span class="ident" id="4982849">z</span><span class="op" id="4982850">.</span><span class="ident" id="4982851">buf</span><span class="op" id="4982854">[</span><span class="num" id="4982855">0</span><span class="op" id="4982856">:</span><span class="num" id="4982857">8</span><span class="op" id="4982858">]</span><span class="op" id="4982859">)</span><span class="op" id="4982860">;</span>&nbsp;<span class="ident" id="4982862">err</span>&nbsp;<span class="op" id="4982866">!=</span>&nbsp;<span class="ident" id="4982869">nil</span>&nbsp;<span class="op" id="4982873">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982877">z</span><span class="op" id="4982878">.</span><span class="ident" id="4982879">err</span>&nbsp;<span class="op" id="4982883">=</span>&nbsp;<span class="ident" id="4982885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982891">return</span>&nbsp;<span class="num" id="4982898">0</span><span class="op" id="4982899">,</span>&nbsp;<span class="ident" id="4982901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982909">crc32</span><span class="op" id="4982914">,</span>&nbsp;<span class="ident" id="4982916">isize</span>&nbsp;<span class="op" id="4982922">:=</span>&nbsp;<span class="ident" id="4982925">get4</span><span class="op" id="4982929">(</span><span class="ident" id="4982930">z</span><span class="op" id="4982931">.</span><span class="ident" id="4982932">buf</span><span class="op" id="4982935">[</span><span class="num" id="4982936">0</span><span class="op" id="4982937">:</span><span class="num" id="4982938">4</span><span class="op" id="4982939">]</span><span class="op" id="4982940">)</span><span class="op" id="4982941">,</span>&nbsp;<span class="ident" id="4982943">get4</span><span class="op" id="4982947">(</span><span class="ident" id="4982948">z</span><span class="op" id="4982949">.</span><span class="ident" id="4982950">buf</span><span class="op" id="4982953">[</span><span class="num" id="4982954">4</span><span class="op" id="4982955">:</span><span class="num" id="4982956">8</span><span class="op" id="4982957">]</span><span class="op" id="4982958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982961">sum</span>&nbsp;<span class="op" id="4982965">:=</span>&nbsp;<span class="ident" id="4982968">z</span><span class="op" id="4982969">.</span><span class="ident" id="4982970">digest</span><span class="op" id="4982976">.</span><span class="ident" id="4982977">Sum32</span><span class="op" id="4982982">(</span><span class="op" id="4982983">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982986">if</span>&nbsp;<span class="ident" id="4982989">sum</span>&nbsp;<span class="op" id="4982993">!=</span>&nbsp;<span class="ident" id="4982996">crc32</span>&nbsp;<span class="op" id="4983002">||</span>&nbsp;<span class="ident" id="4983005">isize</span>&nbsp;<span class="op" id="4983011">!=</span>&nbsp;<span class="ident" id="4983014">z</span><span class="op" id="4983015">.</span><span class="ident" id="4983016">size</span>&nbsp;<span class="op" id="4983021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983025">z</span><span class="op" id="4983026">.</span><span class="ident" id="4983027">err</span>&nbsp;<span class="op" id="4983031">=</span>&nbsp;<span class="ident" id="4983033">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983047">return</span>&nbsp;<span class="num" id="4983054">0</span><span class="op" id="4983055">,</span>&nbsp;<span class="ident" id="4983057">z</span><span class="op" id="4983058">.</span><span class="ident" id="4983059">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983068">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983102">if</span>&nbsp;<span class="op" id="4983105">!</span><span class="ident" id="4983106">z</span><span class="op" id="4983107">.</span><span class="ident" id="4983108">multistream</span>&nbsp;<span class="op" id="4983120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983124">return</span>&nbsp;<span class="num" id="4983131">0</span><span class="op" id="4983132">,</span>&nbsp;<span class="ident" id="4983134">io</span><span class="op" id="4983136">.</span><span class="ident" id="4983137">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983146">if</span>&nbsp;<span class="ident" id="4983149">err</span>&nbsp;<span class="op" id="4983153">=</span>&nbsp;<span class="ident" id="4983155">z</span><span class="op" id="4983156">.</span><span class="ident" id="4983157">readHeader</span><span class="op" id="4983167">(</span><span class="builtintype" id="4983168">false</span><span class="op" id="4983173">)</span><span class="op" id="4983174">;</span>&nbsp;<span class="ident" id="4983176">err</span>&nbsp;<span class="op" id="4983180">!=</span>&nbsp;<span class="ident" id="4983183">nil</span>&nbsp;<span class="op" id="4983187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983191">z</span><span class="op" id="4983192">.</span><span class="ident" id="4983193">err</span>&nbsp;<span class="op" id="4983197">=</span>&nbsp;<span class="ident" id="4983199">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983205">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4983217">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983251">z</span><span class="op" id="4983252">.</span><span class="ident" id="4983253">digest</span><span class="op" id="4983259">.</span><span class="ident" id="4983260">Reset</span><span class="op" id="4983265">(</span><span class="op" id="4983266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983269">z</span><span class="op" id="4983270">.</span><span class="ident" id="4983271">size</span>&nbsp;<span class="op" id="4983276">=</span>&nbsp;<span class="num" id="4983278">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983281">return</span>&nbsp;<span class="ident" id="4983288">z</span><span class="op" id="4983289">.</span><span class="ident" id="4983290">Read</span><span class="op" id="4983294">(</span><span class="ident" id="4983295">p</span><span class="op" id="4983296">)</span><br>
<span class="lineno"></span><span class="op" id="4983298">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4983301">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4983373">func</span>&nbsp;<span class="op" id="4983378">(</span><span class="ident" id="4983379">z</span>&nbsp;<span class="op" id="4983381">*</span><span class="ident" id="4983382">Reader</span><span class="op" id="4983388">)</span>&nbsp;<span class="ident" id="4983390">Close</span><span class="op" id="4983395">(</span><span class="op" id="4983396">)</span>&nbsp;<span class="builtintype" id="4983398">error</span>&nbsp;<span class="op" id="4983404">{</span>&nbsp;<span class="keyword" id="4983406">return</span>&nbsp;<span class="ident" id="4983413">z</span><span class="op" id="4983414">.</span><span class="ident" id="4983415">decompressor</span><span class="op" id="4983427">.</span><span class="ident" id="4983428">Close</span><span class="op" id="4983433">(</span><span class="op" id="4983434">)</span>&nbsp;<span class="op" id="4983436">}</span>
</div>
</body>
</html>
