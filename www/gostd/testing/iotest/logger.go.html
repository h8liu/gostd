<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5165697">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5165752">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5165806">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5165857">package</span>&nbsp;<span class="ident" id="5165865">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5165873">import</span>&nbsp;<span class="op" id="5165880">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5165883">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5165889">&#34;log&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5165895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5165898">type</span>&nbsp;<span class="ident" id="5165903">writeLogger</span>&nbsp;<span class="keyword" id="5165915">struct</span>&nbsp;<span class="op" id="5165922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165925">prefix</span>&nbsp;<span class="builtintype" id="5165932">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5165940">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5165947">io</span><span class="op" id="5165949">.</span><span class="ident" id="5165950">Writer</span><br>
<span class="lineno">15</span><span class="op" id="5165957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5165960">func</span>&nbsp;<span class="op" id="5165965">(</span><span class="ident" id="5165966">l</span>&nbsp;<span class="op" id="5165968">*</span><span class="ident" id="5165969">writeLogger</span><span class="op" id="5165980">)</span>&nbsp;<span class="ident" id="5165982">Write</span><span class="op" id="5165987">(</span><span class="ident" id="5165988">p</span>&nbsp;<span class="op" id="5165990">[</span><span class="op" id="5165991">]</span><span class="builtintype" id="5165992">byte</span><span class="op" id="5165996">)</span>&nbsp;<span class="op" id="5165998">(</span><span class="ident" id="5165999">n</span>&nbsp;<span class="builtintype" id="5166001">int</span><span class="op" id="5166004">,</span>&nbsp;<span class="ident" id="5166006">err</span>&nbsp;<span class="builtintype" id="5166010">error</span><span class="op" id="5166015">)</span>&nbsp;<span class="op" id="5166017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166020">n</span><span class="op" id="5166021">,</span>&nbsp;<span class="ident" id="5166023">err</span>&nbsp;<span class="op" id="5166027">=</span>&nbsp;<span class="ident" id="5166029">l</span><span class="op" id="5166030">.</span><span class="ident" id="5166031">w</span><span class="op" id="5166032">.</span><span class="ident" id="5166033">Write</span><span class="op" id="5166038">(</span><span class="ident" id="5166039">p</span><span class="op" id="5166040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166043">if</span>&nbsp;<span class="ident" id="5166046">err</span>&nbsp;<span class="op" id="5166050">!=</span>&nbsp;<span class="ident" id="5166053">nil</span>&nbsp;<span class="op" id="5166057">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166061">log</span><span class="op" id="5166064">.</span><span class="ident" id="5166065">Printf</span><span class="op" id="5166071">(</span><span class="string" id="5166072">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5166083">,</span>&nbsp;<span class="ident" id="5166085">l</span><span class="op" id="5166086">.</span><span class="ident" id="5166087">prefix</span><span class="op" id="5166093">,</span>&nbsp;<span class="ident" id="5166095">p</span><span class="op" id="5166096">[</span><span class="num" id="5166097">0</span><span class="op" id="5166098">:</span><span class="ident" id="5166099">n</span><span class="op" id="5166100">]</span><span class="op" id="5166101">,</span>&nbsp;<span class="ident" id="5166103">err</span><span class="op" id="5166106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166109">}</span>&nbsp;<span class="keyword" id="5166111">else</span>&nbsp;<span class="op" id="5166116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166120">log</span><span class="op" id="5166123">.</span><span class="ident" id="5166124">Printf</span><span class="op" id="5166130">(</span><span class="string" id="5166131">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5166138">,</span>&nbsp;<span class="ident" id="5166140">l</span><span class="op" id="5166141">.</span><span class="ident" id="5166142">prefix</span><span class="op" id="5166148">,</span>&nbsp;<span class="ident" id="5166150">p</span><span class="op" id="5166151">[</span><span class="num" id="5166152">0</span><span class="op" id="5166153">:</span><span class="ident" id="5166154">n</span><span class="op" id="5166155">]</span><span class="op" id="5166156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166162">return</span><br>
<span class="lineno">25</span><span class="op" id="5166169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5166172">//&nbsp;NewWriteLogger&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;behaves&nbsp;like&nbsp;w&nbsp;except</span><br>
<span class="lineno"></span><span class="comment" id="5166234">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Printf)&nbsp;each&nbsp;write&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5166299">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno">30</span><span class="keyword" id="5166356">func</span>&nbsp;<span class="ident" id="5166361">NewWriteLogger</span><span class="op" id="5166375">(</span><span class="ident" id="5166376">prefix</span>&nbsp;<span class="builtintype" id="5166383">string</span><span class="op" id="5166389">,</span>&nbsp;<span class="ident" id="5166391">w</span>&nbsp;<span class="ident" id="5166393">io</span><span class="op" id="5166395">.</span><span class="ident" id="5166396">Writer</span><span class="op" id="5166402">)</span>&nbsp;<span class="ident" id="5166404">io</span><span class="op" id="5166406">.</span><span class="ident" id="5166407">Writer</span>&nbsp;<span class="op" id="5166414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166417">return</span>&nbsp;<span class="op" id="5166424">&amp;</span><span class="ident" id="5166425">writeLogger</span><span class="op" id="5166436">{</span><span class="ident" id="5166437">prefix</span><span class="op" id="5166443">,</span>&nbsp;<span class="ident" id="5166445">w</span><span class="op" id="5166446">}</span><br>
<span class="lineno"></span><span class="op" id="5166448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5166451">type</span>&nbsp;<span class="ident" id="5166456">readLogger</span>&nbsp;<span class="keyword" id="5166467">struct</span>&nbsp;<span class="op" id="5166474">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166477">prefix</span>&nbsp;<span class="builtintype" id="5166484">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166492">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5166499">io</span><span class="op" id="5166501">.</span><span class="ident" id="5166502">Reader</span><br>
<span class="lineno"></span><span class="op" id="5166509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5166512">func</span>&nbsp;<span class="op" id="5166517">(</span><span class="ident" id="5166518">l</span>&nbsp;<span class="op" id="5166520">*</span><span class="ident" id="5166521">readLogger</span><span class="op" id="5166531">)</span>&nbsp;<span class="ident" id="5166533">Read</span><span class="op" id="5166537">(</span><span class="ident" id="5166538">p</span>&nbsp;<span class="op" id="5166540">[</span><span class="op" id="5166541">]</span><span class="builtintype" id="5166542">byte</span><span class="op" id="5166546">)</span>&nbsp;<span class="op" id="5166548">(</span><span class="ident" id="5166549">n</span>&nbsp;<span class="builtintype" id="5166551">int</span><span class="op" id="5166554">,</span>&nbsp;<span class="ident" id="5166556">err</span>&nbsp;<span class="builtintype" id="5166560">error</span><span class="op" id="5166565">)</span>&nbsp;<span class="op" id="5166567">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166570">n</span><span class="op" id="5166571">,</span>&nbsp;<span class="ident" id="5166573">err</span>&nbsp;<span class="op" id="5166577">=</span>&nbsp;<span class="ident" id="5166579">l</span><span class="op" id="5166580">.</span><span class="ident" id="5166581">r</span><span class="op" id="5166582">.</span><span class="ident" id="5166583">Read</span><span class="op" id="5166587">(</span><span class="ident" id="5166588">p</span><span class="op" id="5166589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166592">if</span>&nbsp;<span class="ident" id="5166595">err</span>&nbsp;<span class="op" id="5166599">!=</span>&nbsp;<span class="ident" id="5166602">nil</span>&nbsp;<span class="op" id="5166606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166610">log</span><span class="op" id="5166613">.</span><span class="ident" id="5166614">Printf</span><span class="op" id="5166620">(</span><span class="string" id="5166621">&#34;%s&nbsp;%x:&nbsp;%v&#34;</span><span class="op" id="5166632">,</span>&nbsp;<span class="ident" id="5166634">l</span><span class="op" id="5166635">.</span><span class="ident" id="5166636">prefix</span><span class="op" id="5166642">,</span>&nbsp;<span class="ident" id="5166644">p</span><span class="op" id="5166645">[</span><span class="num" id="5166646">0</span><span class="op" id="5166647">:</span><span class="ident" id="5166648">n</span><span class="op" id="5166649">]</span><span class="op" id="5166650">,</span>&nbsp;<span class="ident" id="5166652">err</span><span class="op" id="5166655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166658">}</span>&nbsp;<span class="keyword" id="5166660">else</span>&nbsp;<span class="op" id="5166665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5166669">log</span><span class="op" id="5166672">.</span><span class="ident" id="5166673">Printf</span><span class="op" id="5166679">(</span><span class="string" id="5166680">&#34;%s&nbsp;%x&#34;</span><span class="op" id="5166687">,</span>&nbsp;<span class="ident" id="5166689">l</span><span class="op" id="5166690">.</span><span class="ident" id="5166691">prefix</span><span class="op" id="5166697">,</span>&nbsp;<span class="ident" id="5166699">p</span><span class="op" id="5166700">[</span><span class="num" id="5166701">0</span><span class="op" id="5166702">:</span><span class="ident" id="5166703">n</span><span class="op" id="5166704">]</span><span class="op" id="5166705">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5166708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166711">return</span><br>
<span class="lineno"></span><span class="op" id="5166718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5166721">//&nbsp;NewReadLogger&nbsp;returns&nbsp;a&nbsp;reader&nbsp;that&nbsp;behaves&nbsp;like&nbsp;r&nbsp;except</span><br>
<span class="lineno">50</span><span class="comment" id="5166782">//&nbsp;that&nbsp;it&nbsp;logs&nbsp;(using&nbsp;log.Print)&nbsp;each&nbsp;read&nbsp;to&nbsp;standard&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="5166845">//&nbsp;printing&nbsp;the&nbsp;prefix&nbsp;and&nbsp;the&nbsp;hexadecimal&nbsp;data&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="5166902">func</span>&nbsp;<span class="ident" id="5166907">NewReadLogger</span><span class="op" id="5166920">(</span><span class="ident" id="5166921">prefix</span>&nbsp;<span class="builtintype" id="5166928">string</span><span class="op" id="5166934">,</span>&nbsp;<span class="ident" id="5166936">r</span>&nbsp;<span class="ident" id="5166938">io</span><span class="op" id="5166940">.</span><span class="ident" id="5166941">Reader</span><span class="op" id="5166947">)</span>&nbsp;<span class="ident" id="5166949">io</span><span class="op" id="5166951">.</span><span class="ident" id="5166952">Reader</span>&nbsp;<span class="op" id="5166959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5166962">return</span>&nbsp;<span class="op" id="5166969">&amp;</span><span class="ident" id="5166970">readLogger</span><span class="op" id="5166980">{</span><span class="ident" id="5166981">prefix</span><span class="op" id="5166987">,</span>&nbsp;<span class="ident" id="5166989">r</span><span class="op" id="5166990">}</span><br>
<span class="lineno"></span><span class="op" id="5166992">}</span>
</div>
</body>
</html>
