<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7016885">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7016940">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7016994">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7017045">package</span>&nbsp;<span class="ident" id="7017053">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017059">import</span>&nbsp;<span class="op" id="7017066">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017069">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017078">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017085">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017094">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017109">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017122">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017135">&#34;math/rand&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017148">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7017154">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7017164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7017167">//&nbsp;zigzag&nbsp;maps&nbsp;from&nbsp;the&nbsp;natural&nbsp;ordering&nbsp;to&nbsp;the&nbsp;zig-zag&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno">20</span><span class="comment" id="7017246">//&nbsp;zigzag[0*8&nbsp;+&nbsp;3]&nbsp;is&nbsp;the&nbsp;zig-zag&nbsp;sequence&nbsp;number&nbsp;of&nbsp;the&nbsp;element&nbsp;in&nbsp;the&nbsp;fourth</span><br>
<span class="lineno"></span><span class="comment" id="7017325">//&nbsp;column&nbsp;and&nbsp;first&nbsp;row.</span><br>
<span class="lineno"></span><span class="keyword" id="7017350">var</span>&nbsp;<span class="ident" id="7017354">zigzag</span>&nbsp;<span class="op" id="7017361">=</span>&nbsp;<span class="op" id="7017363">[</span><span class="ident" id="7017364">blockSize</span><span class="op" id="7017373">]</span><span class="builtintype" id="7017374">int</span><span class="op" id="7017377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017380">0</span><span class="op" id="7017381">,</span>&nbsp;<span class="num" id="7017383">1</span><span class="op" id="7017384">,</span>&nbsp;<span class="num" id="7017386">5</span><span class="op" id="7017387">,</span>&nbsp;<span class="num" id="7017389">6</span><span class="op" id="7017390">,</span>&nbsp;<span class="num" id="7017392">14</span><span class="op" id="7017394">,</span>&nbsp;<span class="num" id="7017396">15</span><span class="op" id="7017398">,</span>&nbsp;<span class="num" id="7017400">27</span><span class="op" id="7017402">,</span>&nbsp;<span class="num" id="7017404">28</span><span class="op" id="7017406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017409">2</span><span class="op" id="7017410">,</span>&nbsp;<span class="num" id="7017412">4</span><span class="op" id="7017413">,</span>&nbsp;<span class="num" id="7017415">7</span><span class="op" id="7017416">,</span>&nbsp;<span class="num" id="7017418">13</span><span class="op" id="7017420">,</span>&nbsp;<span class="num" id="7017422">16</span><span class="op" id="7017424">,</span>&nbsp;<span class="num" id="7017426">26</span><span class="op" id="7017428">,</span>&nbsp;<span class="num" id="7017430">29</span><span class="op" id="7017432">,</span>&nbsp;<span class="num" id="7017434">42</span><span class="op" id="7017436">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017439">3</span><span class="op" id="7017440">,</span>&nbsp;<span class="num" id="7017442">8</span><span class="op" id="7017443">,</span>&nbsp;<span class="num" id="7017445">12</span><span class="op" id="7017447">,</span>&nbsp;<span class="num" id="7017449">17</span><span class="op" id="7017451">,</span>&nbsp;<span class="num" id="7017453">25</span><span class="op" id="7017455">,</span>&nbsp;<span class="num" id="7017457">30</span><span class="op" id="7017459">,</span>&nbsp;<span class="num" id="7017461">41</span><span class="op" id="7017463">,</span>&nbsp;<span class="num" id="7017465">43</span><span class="op" id="7017467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017470">9</span><span class="op" id="7017471">,</span>&nbsp;<span class="num" id="7017473">11</span><span class="op" id="7017475">,</span>&nbsp;<span class="num" id="7017477">18</span><span class="op" id="7017479">,</span>&nbsp;<span class="num" id="7017481">24</span><span class="op" id="7017483">,</span>&nbsp;<span class="num" id="7017485">31</span><span class="op" id="7017487">,</span>&nbsp;<span class="num" id="7017489">40</span><span class="op" id="7017491">,</span>&nbsp;<span class="num" id="7017493">44</span><span class="op" id="7017495">,</span>&nbsp;<span class="num" id="7017497">53</span><span class="op" id="7017499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017502">10</span><span class="op" id="7017504">,</span>&nbsp;<span class="num" id="7017506">19</span><span class="op" id="7017508">,</span>&nbsp;<span class="num" id="7017510">23</span><span class="op" id="7017512">,</span>&nbsp;<span class="num" id="7017514">32</span><span class="op" id="7017516">,</span>&nbsp;<span class="num" id="7017518">39</span><span class="op" id="7017520">,</span>&nbsp;<span class="num" id="7017522">45</span><span class="op" id="7017524">,</span>&nbsp;<span class="num" id="7017526">52</span><span class="op" id="7017528">,</span>&nbsp;<span class="num" id="7017530">54</span><span class="op" id="7017532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017535">20</span><span class="op" id="7017537">,</span>&nbsp;<span class="num" id="7017539">22</span><span class="op" id="7017541">,</span>&nbsp;<span class="num" id="7017543">33</span><span class="op" id="7017545">,</span>&nbsp;<span class="num" id="7017547">38</span><span class="op" id="7017549">,</span>&nbsp;<span class="num" id="7017551">46</span><span class="op" id="7017553">,</span>&nbsp;<span class="num" id="7017555">51</span><span class="op" id="7017557">,</span>&nbsp;<span class="num" id="7017559">55</span><span class="op" id="7017561">,</span>&nbsp;<span class="num" id="7017563">60</span><span class="op" id="7017565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017568">21</span><span class="op" id="7017570">,</span>&nbsp;<span class="num" id="7017572">34</span><span class="op" id="7017574">,</span>&nbsp;<span class="num" id="7017576">37</span><span class="op" id="7017578">,</span>&nbsp;<span class="num" id="7017580">47</span><span class="op" id="7017582">,</span>&nbsp;<span class="num" id="7017584">50</span><span class="op" id="7017586">,</span>&nbsp;<span class="num" id="7017588">56</span><span class="op" id="7017590">,</span>&nbsp;<span class="num" id="7017592">59</span><span class="op" id="7017594">,</span>&nbsp;<span class="num" id="7017596">61</span><span class="op" id="7017598">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7017601">35</span><span class="op" id="7017603">,</span>&nbsp;<span class="num" id="7017605">36</span><span class="op" id="7017607">,</span>&nbsp;<span class="num" id="7017609">48</span><span class="op" id="7017611">,</span>&nbsp;<span class="num" id="7017613">49</span><span class="op" id="7017615">,</span>&nbsp;<span class="num" id="7017617">57</span><span class="op" id="7017619">,</span>&nbsp;<span class="num" id="7017621">58</span><span class="op" id="7017623">,</span>&nbsp;<span class="num" id="7017625">62</span><span class="op" id="7017627">,</span>&nbsp;<span class="num" id="7017629">63</span><span class="op" id="7017631">,</span><br>
<span class="lineno"></span><span class="op" id="7017633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7017636">func</span>&nbsp;<span class="ident" id="7017641">TestZigUnzig</span><span class="op" id="7017653">(</span><span class="ident" id="7017654">t</span>&nbsp;<span class="op" id="7017656">*</span><span class="ident" id="7017657">testing</span><span class="op" id="7017664">.</span><span class="ident" id="7017665">T</span><span class="op" id="7017666">)</span>&nbsp;<span class="op" id="7017668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017671">for</span>&nbsp;<span class="ident" id="7017675">i</span>&nbsp;<span class="op" id="7017677">:=</span>&nbsp;<span class="num" id="7017680">0</span><span class="op" id="7017681">;</span>&nbsp;<span class="ident" id="7017683">i</span>&nbsp;<span class="op" id="7017685">&lt;</span>&nbsp;<span class="ident" id="7017687">blockSize</span><span class="op" id="7017696">;</span>&nbsp;<span class="ident" id="7017698">i</span><span class="op" id="7017699">++</span>&nbsp;<span class="op" id="7017702">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017706">if</span>&nbsp;<span class="ident" id="7017709">unzig</span><span class="op" id="7017714">[</span><span class="ident" id="7017715">zigzag</span><span class="op" id="7017721">[</span><span class="ident" id="7017722">i</span><span class="op" id="7017723">]</span><span class="op" id="7017724">]</span>&nbsp;<span class="op" id="7017726">!=</span>&nbsp;<span class="ident" id="7017729">i</span>&nbsp;<span class="op" id="7017731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017736">t</span><span class="op" id="7017737">.</span><span class="ident" id="7017738">Errorf</span><span class="op" id="7017744">(</span><span class="string" id="7017745">&#34;unzig[zigzag[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7017770">,</span>&nbsp;<span class="ident" id="7017772">i</span><span class="op" id="7017773">,</span>&nbsp;<span class="ident" id="7017775">unzig</span><span class="op" id="7017780">[</span><span class="ident" id="7017781">zigzag</span><span class="op" id="7017787">[</span><span class="ident" id="7017788">i</span><span class="op" id="7017789">]</span><span class="op" id="7017790">]</span><span class="op" id="7017791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7017799">if</span>&nbsp;<span class="ident" id="7017802">zigzag</span><span class="op" id="7017808">[</span><span class="ident" id="7017809">unzig</span><span class="op" id="7017814">[</span><span class="ident" id="7017815">i</span><span class="op" id="7017816">]</span><span class="op" id="7017817">]</span>&nbsp;<span class="op" id="7017819">!=</span>&nbsp;<span class="ident" id="7017822">i</span>&nbsp;<span class="op" id="7017824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7017829">t</span><span class="op" id="7017830">.</span><span class="ident" id="7017831">Errorf</span><span class="op" id="7017837">(</span><span class="string" id="7017838">&#34;zigzag[unzig[%d]]&nbsp;==&nbsp;%d&#34;</span><span class="op" id="7017863">,</span>&nbsp;<span class="ident" id="7017865">i</span><span class="op" id="7017866">,</span>&nbsp;<span class="ident" id="7017868">zigzag</span><span class="op" id="7017874">[</span><span class="ident" id="7017875">unzig</span><span class="op" id="7017880">[</span><span class="ident" id="7017881">i</span><span class="op" id="7017882">]</span><span class="op" id="7017883">]</span><span class="op" id="7017884">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7017891">}</span><br>
<span class="lineno"></span><span class="op" id="7017893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7017896">//&nbsp;unscaledQuantInNaturalOrder&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in</span><br>
<span class="lineno">45</span><span class="comment" id="7017967">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;K.1.</span><br>
<span class="lineno"></span><span class="keyword" id="7018028">var</span>&nbsp;<span class="ident" id="7018032">unscaledQuantInNaturalOrder</span>&nbsp;<span class="op" id="7018060">=</span>&nbsp;<span class="op" id="7018062">[</span><span class="ident" id="7018063">nQuantIndex</span><span class="op" id="7018074">]</span><span class="op" id="7018075">[</span><span class="ident" id="7018076">blockSize</span><span class="op" id="7018085">]</span><span class="builtintype" id="7018086">byte</span><span class="op" id="7018090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018093">//&nbsp;Luminance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018112">16</span><span class="op" id="7018114">,</span>&nbsp;<span class="num" id="7018116">11</span><span class="op" id="7018118">,</span>&nbsp;<span class="num" id="7018120">10</span><span class="op" id="7018122">,</span>&nbsp;<span class="num" id="7018124">16</span><span class="op" id="7018126">,</span>&nbsp;<span class="num" id="7018128">24</span><span class="op" id="7018130">,</span>&nbsp;<span class="num" id="7018132">40</span><span class="op" id="7018134">,</span>&nbsp;<span class="num" id="7018136">51</span><span class="op" id="7018138">,</span>&nbsp;<span class="num" id="7018140">61</span><span class="op" id="7018142">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018146">12</span><span class="op" id="7018148">,</span>&nbsp;<span class="num" id="7018150">12</span><span class="op" id="7018152">,</span>&nbsp;<span class="num" id="7018154">14</span><span class="op" id="7018156">,</span>&nbsp;<span class="num" id="7018158">19</span><span class="op" id="7018160">,</span>&nbsp;<span class="num" id="7018162">26</span><span class="op" id="7018164">,</span>&nbsp;<span class="num" id="7018166">58</span><span class="op" id="7018168">,</span>&nbsp;<span class="num" id="7018170">60</span><span class="op" id="7018172">,</span>&nbsp;<span class="num" id="7018174">55</span><span class="op" id="7018176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018180">14</span><span class="op" id="7018182">,</span>&nbsp;<span class="num" id="7018184">13</span><span class="op" id="7018186">,</span>&nbsp;<span class="num" id="7018188">16</span><span class="op" id="7018190">,</span>&nbsp;<span class="num" id="7018192">24</span><span class="op" id="7018194">,</span>&nbsp;<span class="num" id="7018196">40</span><span class="op" id="7018198">,</span>&nbsp;<span class="num" id="7018200">57</span><span class="op" id="7018202">,</span>&nbsp;<span class="num" id="7018204">69</span><span class="op" id="7018206">,</span>&nbsp;<span class="num" id="7018208">56</span><span class="op" id="7018210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018214">14</span><span class="op" id="7018216">,</span>&nbsp;<span class="num" id="7018218">17</span><span class="op" id="7018220">,</span>&nbsp;<span class="num" id="7018222">22</span><span class="op" id="7018224">,</span>&nbsp;<span class="num" id="7018226">29</span><span class="op" id="7018228">,</span>&nbsp;<span class="num" id="7018230">51</span><span class="op" id="7018232">,</span>&nbsp;<span class="num" id="7018234">87</span><span class="op" id="7018236">,</span>&nbsp;<span class="num" id="7018238">80</span><span class="op" id="7018240">,</span>&nbsp;<span class="num" id="7018242">62</span><span class="op" id="7018244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018248">18</span><span class="op" id="7018250">,</span>&nbsp;<span class="num" id="7018252">22</span><span class="op" id="7018254">,</span>&nbsp;<span class="num" id="7018256">37</span><span class="op" id="7018258">,</span>&nbsp;<span class="num" id="7018260">56</span><span class="op" id="7018262">,</span>&nbsp;<span class="num" id="7018264">68</span><span class="op" id="7018266">,</span>&nbsp;<span class="num" id="7018268">109</span><span class="op" id="7018271">,</span>&nbsp;<span class="num" id="7018273">103</span><span class="op" id="7018276">,</span>&nbsp;<span class="num" id="7018278">77</span><span class="op" id="7018280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018284">24</span><span class="op" id="7018286">,</span>&nbsp;<span class="num" id="7018288">35</span><span class="op" id="7018290">,</span>&nbsp;<span class="num" id="7018292">55</span><span class="op" id="7018294">,</span>&nbsp;<span class="num" id="7018296">64</span><span class="op" id="7018298">,</span>&nbsp;<span class="num" id="7018300">81</span><span class="op" id="7018302">,</span>&nbsp;<span class="num" id="7018304">104</span><span class="op" id="7018307">,</span>&nbsp;<span class="num" id="7018309">113</span><span class="op" id="7018312">,</span>&nbsp;<span class="num" id="7018314">92</span><span class="op" id="7018316">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018320">49</span><span class="op" id="7018322">,</span>&nbsp;<span class="num" id="7018324">64</span><span class="op" id="7018326">,</span>&nbsp;<span class="num" id="7018328">78</span><span class="op" id="7018330">,</span>&nbsp;<span class="num" id="7018332">87</span><span class="op" id="7018334">,</span>&nbsp;<span class="num" id="7018336">103</span><span class="op" id="7018339">,</span>&nbsp;<span class="num" id="7018341">121</span><span class="op" id="7018344">,</span>&nbsp;<span class="num" id="7018346">120</span><span class="op" id="7018349">,</span>&nbsp;<span class="num" id="7018351">101</span><span class="op" id="7018354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018358">72</span><span class="op" id="7018360">,</span>&nbsp;<span class="num" id="7018362">92</span><span class="op" id="7018364">,</span>&nbsp;<span class="num" id="7018366">95</span><span class="op" id="7018368">,</span>&nbsp;<span class="num" id="7018370">98</span><span class="op" id="7018372">,</span>&nbsp;<span class="num" id="7018374">112</span><span class="op" id="7018377">,</span>&nbsp;<span class="num" id="7018379">100</span><span class="op" id="7018382">,</span>&nbsp;<span class="num" id="7018384">103</span><span class="op" id="7018387">,</span>&nbsp;<span class="num" id="7018389">99</span><span class="op" id="7018391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018394">}</span><span class="op" id="7018395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7018398">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018415">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018419">17</span><span class="op" id="7018421">,</span>&nbsp;<span class="num" id="7018423">18</span><span class="op" id="7018425">,</span>&nbsp;<span class="num" id="7018427">24</span><span class="op" id="7018429">,</span>&nbsp;<span class="num" id="7018431">47</span><span class="op" id="7018433">,</span>&nbsp;<span class="num" id="7018435">99</span><span class="op" id="7018437">,</span>&nbsp;<span class="num" id="7018439">99</span><span class="op" id="7018441">,</span>&nbsp;<span class="num" id="7018443">99</span><span class="op" id="7018445">,</span>&nbsp;<span class="num" id="7018447">99</span><span class="op" id="7018449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018453">18</span><span class="op" id="7018455">,</span>&nbsp;<span class="num" id="7018457">21</span><span class="op" id="7018459">,</span>&nbsp;<span class="num" id="7018461">26</span><span class="op" id="7018463">,</span>&nbsp;<span class="num" id="7018465">66</span><span class="op" id="7018467">,</span>&nbsp;<span class="num" id="7018469">99</span><span class="op" id="7018471">,</span>&nbsp;<span class="num" id="7018473">99</span><span class="op" id="7018475">,</span>&nbsp;<span class="num" id="7018477">99</span><span class="op" id="7018479">,</span>&nbsp;<span class="num" id="7018481">99</span><span class="op" id="7018483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018487">24</span><span class="op" id="7018489">,</span>&nbsp;<span class="num" id="7018491">26</span><span class="op" id="7018493">,</span>&nbsp;<span class="num" id="7018495">56</span><span class="op" id="7018497">,</span>&nbsp;<span class="num" id="7018499">99</span><span class="op" id="7018501">,</span>&nbsp;<span class="num" id="7018503">99</span><span class="op" id="7018505">,</span>&nbsp;<span class="num" id="7018507">99</span><span class="op" id="7018509">,</span>&nbsp;<span class="num" id="7018511">99</span><span class="op" id="7018513">,</span>&nbsp;<span class="num" id="7018515">99</span><span class="op" id="7018517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018521">47</span><span class="op" id="7018523">,</span>&nbsp;<span class="num" id="7018525">66</span><span class="op" id="7018527">,</span>&nbsp;<span class="num" id="7018529">99</span><span class="op" id="7018531">,</span>&nbsp;<span class="num" id="7018533">99</span><span class="op" id="7018535">,</span>&nbsp;<span class="num" id="7018537">99</span><span class="op" id="7018539">,</span>&nbsp;<span class="num" id="7018541">99</span><span class="op" id="7018543">,</span>&nbsp;<span class="num" id="7018545">99</span><span class="op" id="7018547">,</span>&nbsp;<span class="num" id="7018549">99</span><span class="op" id="7018551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018555">99</span><span class="op" id="7018557">,</span>&nbsp;<span class="num" id="7018559">99</span><span class="op" id="7018561">,</span>&nbsp;<span class="num" id="7018563">99</span><span class="op" id="7018565">,</span>&nbsp;<span class="num" id="7018567">99</span><span class="op" id="7018569">,</span>&nbsp;<span class="num" id="7018571">99</span><span class="op" id="7018573">,</span>&nbsp;<span class="num" id="7018575">99</span><span class="op" id="7018577">,</span>&nbsp;<span class="num" id="7018579">99</span><span class="op" id="7018581">,</span>&nbsp;<span class="num" id="7018583">99</span><span class="op" id="7018585">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018589">99</span><span class="op" id="7018591">,</span>&nbsp;<span class="num" id="7018593">99</span><span class="op" id="7018595">,</span>&nbsp;<span class="num" id="7018597">99</span><span class="op" id="7018599">,</span>&nbsp;<span class="num" id="7018601">99</span><span class="op" id="7018603">,</span>&nbsp;<span class="num" id="7018605">99</span><span class="op" id="7018607">,</span>&nbsp;<span class="num" id="7018609">99</span><span class="op" id="7018611">,</span>&nbsp;<span class="num" id="7018613">99</span><span class="op" id="7018615">,</span>&nbsp;<span class="num" id="7018617">99</span><span class="op" id="7018619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018623">99</span><span class="op" id="7018625">,</span>&nbsp;<span class="num" id="7018627">99</span><span class="op" id="7018629">,</span>&nbsp;<span class="num" id="7018631">99</span><span class="op" id="7018633">,</span>&nbsp;<span class="num" id="7018635">99</span><span class="op" id="7018637">,</span>&nbsp;<span class="num" id="7018639">99</span><span class="op" id="7018641">,</span>&nbsp;<span class="num" id="7018643">99</span><span class="op" id="7018645">,</span>&nbsp;<span class="num" id="7018647">99</span><span class="op" id="7018649">,</span>&nbsp;<span class="num" id="7018651">99</span><span class="op" id="7018653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7018657">99</span><span class="op" id="7018659">,</span>&nbsp;<span class="num" id="7018661">99</span><span class="op" id="7018663">,</span>&nbsp;<span class="num" id="7018665">99</span><span class="op" id="7018667">,</span>&nbsp;<span class="num" id="7018669">99</span><span class="op" id="7018671">,</span>&nbsp;<span class="num" id="7018673">99</span><span class="op" id="7018675">,</span>&nbsp;<span class="num" id="7018677">99</span><span class="op" id="7018679">,</span>&nbsp;<span class="num" id="7018681">99</span><span class="op" id="7018683">,</span>&nbsp;<span class="num" id="7018685">99</span><span class="op" id="7018687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7018690">}</span><span class="op" id="7018691">,</span><br>
<span class="lineno"></span><span class="op" id="7018693">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7018696">func</span>&nbsp;<span class="ident" id="7018701">TestUnscaledQuant</span><span class="op" id="7018718">(</span><span class="ident" id="7018719">t</span>&nbsp;<span class="op" id="7018721">*</span><span class="ident" id="7018722">testing</span><span class="op" id="7018729">.</span><span class="ident" id="7018730">T</span><span class="op" id="7018731">)</span>&nbsp;<span class="op" id="7018733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018736">bad</span>&nbsp;<span class="op" id="7018740">:=</span>&nbsp;<span class="builtintype" id="7018743">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018750">for</span>&nbsp;<span class="ident" id="7018754">i</span>&nbsp;<span class="op" id="7018756">:=</span>&nbsp;<span class="ident" id="7018759">quantIndex</span><span class="op" id="7018769">(</span><span class="num" id="7018770">0</span><span class="op" id="7018771">)</span><span class="op" id="7018772">;</span>&nbsp;<span class="ident" id="7018774">i</span>&nbsp;<span class="op" id="7018776">&lt;</span>&nbsp;<span class="ident" id="7018778">nQuantIndex</span><span class="op" id="7018789">;</span>&nbsp;<span class="ident" id="7018791">i</span><span class="op" id="7018792">++</span>&nbsp;<span class="op" id="7018795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018799">for</span>&nbsp;<span class="ident" id="7018803">zig</span>&nbsp;<span class="op" id="7018807">:=</span>&nbsp;<span class="num" id="7018810">0</span><span class="op" id="7018811">;</span>&nbsp;<span class="ident" id="7018813">zig</span>&nbsp;<span class="op" id="7018817">&lt;</span>&nbsp;<span class="ident" id="7018819">blockSize</span><span class="op" id="7018828">;</span>&nbsp;<span class="ident" id="7018830">zig</span><span class="op" id="7018833">++</span>&nbsp;<span class="op" id="7018836">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018841">got</span>&nbsp;<span class="op" id="7018845">:=</span>&nbsp;<span class="ident" id="7018848">unscaledQuant</span><span class="op" id="7018861">[</span><span class="ident" id="7018862">i</span><span class="op" id="7018863">]</span><span class="op" id="7018864">[</span><span class="ident" id="7018865">zig</span><span class="op" id="7018868">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018873">want</span>&nbsp;<span class="op" id="7018878">:=</span>&nbsp;<span class="ident" id="7018881">unscaledQuantInNaturalOrder</span><span class="op" id="7018908">[</span><span class="ident" id="7018909">i</span><span class="op" id="7018910">]</span><span class="op" id="7018911">[</span><span class="ident" id="7018912">unzig</span><span class="op" id="7018917">[</span><span class="ident" id="7018918">zig</span><span class="op" id="7018921">]</span><span class="op" id="7018922">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7018927">if</span>&nbsp;<span class="ident" id="7018930">got</span>&nbsp;<span class="op" id="7018934">!=</span>&nbsp;<span class="ident" id="7018937">want</span>&nbsp;<span class="op" id="7018942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7018948">t</span><span class="op" id="7018949">.</span><span class="ident" id="7018950">Errorf</span><span class="op" id="7018956">(</span><span class="string" id="7018957">&#34;i=%d,&nbsp;zig=%d:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7018988">,</span>&nbsp;<span class="ident" id="7018990">i</span><span class="op" id="7018991">,</span>&nbsp;<span class="ident" id="7018993">zig</span><span class="op" id="7018996">,</span>&nbsp;<span class="ident" id="7018998">got</span><span class="op" id="7019001">,</span>&nbsp;<span class="ident" id="7019003">want</span><span class="op" id="7019007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019013">bad</span>&nbsp;<span class="op" id="7019017">=</span>&nbsp;<span class="builtintype" id="7019019">true</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019037">if</span>&nbsp;<span class="ident" id="7019040">bad</span>&nbsp;<span class="op" id="7019044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019048">names</span>&nbsp;<span class="op" id="7019054">:=</span>&nbsp;<span class="op" id="7019057">[</span><span class="ident" id="7019058">nQuantIndex</span><span class="op" id="7019069">]</span><span class="builtintype" id="7019070">string</span><span class="op" id="7019076">{</span><span class="string" id="7019077">&#34;Luminance&#34;</span><span class="op" id="7019088">,</span>&nbsp;<span class="string" id="7019090">&#34;Chrominance&#34;</span><span class="op" id="7019103">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019107">buf</span>&nbsp;<span class="op" id="7019111">:=</span>&nbsp;<span class="op" id="7019114">&amp;</span><span class="ident" id="7019115">bytes</span><span class="op" id="7019120">.</span><span class="ident" id="7019121">Buffer</span><span class="op" id="7019127">{</span><span class="op" id="7019128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019132">for</span>&nbsp;<span class="ident" id="7019136">i</span><span class="op" id="7019137">,</span>&nbsp;<span class="ident" id="7019139">name</span>&nbsp;<span class="op" id="7019144">:=</span>&nbsp;<span class="keyword" id="7019147">range</span>&nbsp;<span class="ident" id="7019153">names</span>&nbsp;<span class="op" id="7019159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019164">fmt</span><span class="op" id="7019167">.</span><span class="ident" id="7019168">Fprintf</span><span class="op" id="7019175">(</span><span class="ident" id="7019176">buf</span><span class="op" id="7019179">,</span>&nbsp;<span class="string" id="7019181">&#34;//&nbsp;%s.\n{\n&#34;</span><span class="op" id="7019194">,</span>&nbsp;<span class="ident" id="7019196">name</span><span class="op" id="7019200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019205">for</span>&nbsp;<span class="ident" id="7019209">zig</span>&nbsp;<span class="op" id="7019213">:=</span>&nbsp;<span class="num" id="7019216">0</span><span class="op" id="7019217">;</span>&nbsp;<span class="ident" id="7019219">zig</span>&nbsp;<span class="op" id="7019223">&lt;</span>&nbsp;<span class="ident" id="7019225">blockSize</span><span class="op" id="7019234">;</span>&nbsp;<span class="ident" id="7019236">zig</span><span class="op" id="7019239">++</span>&nbsp;<span class="op" id="7019242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019248">fmt</span><span class="op" id="7019251">.</span><span class="ident" id="7019252">Fprintf</span><span class="op" id="7019259">(</span><span class="ident" id="7019260">buf</span><span class="op" id="7019263">,</span>&nbsp;<span class="string" id="7019265">&#34;%d,&nbsp;&#34;</span><span class="op" id="7019271">,</span>&nbsp;<span class="ident" id="7019273">unscaledQuantInNaturalOrder</span><span class="op" id="7019300">[</span><span class="ident" id="7019301">i</span><span class="op" id="7019302">]</span><span class="op" id="7019303">[</span><span class="ident" id="7019304">unzig</span><span class="op" id="7019309">[</span><span class="ident" id="7019310">zig</span><span class="op" id="7019313">]</span><span class="op" id="7019314">]</span><span class="op" id="7019315">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019321">if</span>&nbsp;<span class="ident" id="7019324">zig</span><span class="op" id="7019327">%</span><span class="num" id="7019328">8</span>&nbsp;<span class="op" id="7019330">==</span>&nbsp;<span class="num" id="7019333">7</span>&nbsp;<span class="op" id="7019335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019342">buf</span><span class="op" id="7019345">.</span><span class="ident" id="7019346">WriteString</span><span class="op" id="7019357">(</span><span class="string" id="7019358">&#34;\n&#34;</span><span class="op" id="7019362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019378">buf</span><span class="op" id="7019381">.</span><span class="ident" id="7019382">WriteString</span><span class="op" id="7019393">(</span><span class="string" id="7019394">&#34;},\n&#34;</span><span class="op" id="7019400">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019408">t</span><span class="op" id="7019409">.</span><span class="ident" id="7019410">Logf</span><span class="op" id="7019414">(</span><span class="string" id="7019415">&#34;expected&nbsp;unscaledQuant&nbsp;values:\n%s&#34;</span><span class="op" id="7019451">,</span>&nbsp;<span class="ident" id="7019453">buf</span><span class="op" id="7019456">.</span><span class="ident" id="7019457">String</span><span class="op" id="7019463">(</span><span class="op" id="7019464">)</span><span class="op" id="7019465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019468">}</span><br>
<span class="lineno"></span><span class="op" id="7019470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7019473">var</span>&nbsp;<span class="ident" id="7019477">testCase</span>&nbsp;<span class="op" id="7019486">=</span>&nbsp;<span class="op" id="7019488">[</span><span class="op" id="7019489">]</span><span class="keyword" id="7019490">struct</span>&nbsp;<span class="op" id="7019497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019500">filename</span>&nbsp;&nbsp;<span class="builtintype" id="7019510">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019518">quality</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7019528">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019533">tolerance</span>&nbsp;<span class="ident" id="7019543">int64</span><br>
<span class="lineno"></span><span class="op" id="7019549">}</span><span class="op" id="7019550">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019553">{</span><span class="string" id="7019554">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019581">,</span>&nbsp;<span class="num" id="7019583">1</span><span class="op" id="7019584">,</span>&nbsp;<span class="num" id="7019586">24</span>&nbsp;<span class="op" id="7019589">&lt;&lt;</span>&nbsp;<span class="num" id="7019592">8</span><span class="op" id="7019593">}</span><span class="op" id="7019594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019597">{</span><span class="string" id="7019598">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019625">,</span>&nbsp;<span class="num" id="7019627">20</span><span class="op" id="7019629">,</span>&nbsp;<span class="num" id="7019631">12</span>&nbsp;<span class="op" id="7019634">&lt;&lt;</span>&nbsp;<span class="num" id="7019637">8</span><span class="op" id="7019638">}</span><span class="op" id="7019639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019642">{</span><span class="string" id="7019643">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019670">,</span>&nbsp;<span class="num" id="7019672">60</span><span class="op" id="7019674">,</span>&nbsp;<span class="num" id="7019676">8</span>&nbsp;<span class="op" id="7019678">&lt;&lt;</span>&nbsp;<span class="num" id="7019681">8</span><span class="op" id="7019682">}</span><span class="op" id="7019683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019686">{</span><span class="string" id="7019687">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019714">,</span>&nbsp;<span class="num" id="7019716">80</span><span class="op" id="7019718">,</span>&nbsp;<span class="num" id="7019720">6</span>&nbsp;<span class="op" id="7019722">&lt;&lt;</span>&nbsp;<span class="num" id="7019725">8</span><span class="op" id="7019726">}</span><span class="op" id="7019727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019730">{</span><span class="string" id="7019731">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019758">,</span>&nbsp;<span class="num" id="7019760">90</span><span class="op" id="7019762">,</span>&nbsp;<span class="num" id="7019764">4</span>&nbsp;<span class="op" id="7019766">&lt;&lt;</span>&nbsp;<span class="num" id="7019769">8</span><span class="op" id="7019770">}</span><span class="op" id="7019771">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019774">{</span><span class="string" id="7019775">&#34;../testdata/video-001.png&#34;</span><span class="op" id="7019802">,</span>&nbsp;<span class="num" id="7019804">100</span><span class="op" id="7019807">,</span>&nbsp;<span class="num" id="7019809">2</span>&nbsp;<span class="op" id="7019811">&lt;&lt;</span>&nbsp;<span class="num" id="7019814">8</span><span class="op" id="7019815">}</span><span class="op" id="7019816">,</span><br>
<span class="lineno"></span><span class="op" id="7019818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7019821">func</span>&nbsp;<span class="ident" id="7019826">delta</span><span class="op" id="7019831">(</span><span class="ident" id="7019832">u0</span><span class="op" id="7019834">,</span>&nbsp;<span class="ident" id="7019836">u1</span>&nbsp;<span class="builtintype" id="7019839">uint32</span><span class="op" id="7019845">)</span>&nbsp;<span class="ident" id="7019847">int64</span>&nbsp;<span class="op" id="7019853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019856">d</span>&nbsp;<span class="op" id="7019858">:=</span>&nbsp;<span class="ident" id="7019861">int64</span><span class="op" id="7019866">(</span><span class="ident" id="7019867">u0</span><span class="op" id="7019869">)</span>&nbsp;<span class="op" id="7019871">-</span>&nbsp;<span class="ident" id="7019873">int64</span><span class="op" id="7019878">(</span><span class="ident" id="7019879">u1</span><span class="op" id="7019881">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019884">if</span>&nbsp;<span class="ident" id="7019887">d</span>&nbsp;<span class="op" id="7019889">&lt;</span>&nbsp;<span class="num" id="7019891">0</span>&nbsp;<span class="op" id="7019893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019897">return</span>&nbsp;<span class="op" id="7019904">-</span><span class="ident" id="7019905">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7019908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7019911">return</span>&nbsp;<span class="ident" id="7019918">d</span><br>
<span class="lineno"></span><span class="op" id="7019920">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="7019923">func</span>&nbsp;<span class="ident" id="7019928">readPng</span><span class="op" id="7019935">(</span><span class="ident" id="7019936">filename</span>&nbsp;<span class="builtintype" id="7019945">string</span><span class="op" id="7019951">)</span>&nbsp;<span class="op" id="7019953">(</span><span class="ident" id="7019954">image</span><span class="op" id="7019959">.</span><span class="ident" id="7019960">Image</span><span class="op" id="7019965">,</span>&nbsp;<span class="builtintype" id="7019967">error</span><span class="op" id="7019972">)</span>&nbsp;<span class="op" id="7019974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7019977">f</span><span class="op" id="7019978">,</span>&nbsp;<span class="ident" id="7019980">err</span>&nbsp;<span class="op" id="7019984">:=</span>&nbsp;<span class="ident" id="7019987">os</span><span class="op" id="7019989">.</span><span class="ident" id="7019990">Open</span><span class="op" id="7019994">(</span><span class="ident" id="7019995">filename</span><span class="op" id="7020003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020006">if</span>&nbsp;<span class="ident" id="7020009">err</span>&nbsp;<span class="op" id="7020013">!=</span>&nbsp;<span class="ident" id="7020016">nil</span>&nbsp;<span class="op" id="7020020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020024">return</span>&nbsp;<span class="ident" id="7020031">nil</span><span class="op" id="7020034">,</span>&nbsp;<span class="ident" id="7020036">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020044">defer</span>&nbsp;<span class="ident" id="7020050">f</span><span class="op" id="7020051">.</span><span class="ident" id="7020052">Close</span><span class="op" id="7020057">(</span><span class="op" id="7020058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020061">return</span>&nbsp;<span class="ident" id="7020068">png</span><span class="op" id="7020071">.</span><span class="ident" id="7020072">Decode</span><span class="op" id="7020078">(</span><span class="ident" id="7020079">f</span><span class="op" id="7020080">)</span><br>
<span class="lineno"></span><span class="op" id="7020082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7020085">func</span>&nbsp;<span class="ident" id="7020090">TestWriter</span><span class="op" id="7020100">(</span><span class="ident" id="7020101">t</span>&nbsp;<span class="op" id="7020103">*</span><span class="ident" id="7020104">testing</span><span class="op" id="7020111">.</span><span class="ident" id="7020112">T</span><span class="op" id="7020113">)</span>&nbsp;<span class="op" id="7020115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020118">for</span>&nbsp;<span class="ident" id="7020122">_</span><span class="op" id="7020123">,</span>&nbsp;<span class="ident" id="7020125">tc</span>&nbsp;<span class="op" id="7020128">:=</span>&nbsp;<span class="keyword" id="7020131">range</span>&nbsp;<span class="ident" id="7020137">testCase</span>&nbsp;<span class="op" id="7020146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020150">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020171">m0</span><span class="op" id="7020173">,</span>&nbsp;<span class="ident" id="7020175">err</span>&nbsp;<span class="op" id="7020179">:=</span>&nbsp;<span class="ident" id="7020182">readPng</span><span class="op" id="7020189">(</span><span class="ident" id="7020190">tc</span><span class="op" id="7020192">.</span><span class="ident" id="7020193">filename</span><span class="op" id="7020201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020205">if</span>&nbsp;<span class="ident" id="7020208">err</span>&nbsp;<span class="op" id="7020212">!=</span>&nbsp;<span class="ident" id="7020215">nil</span>&nbsp;<span class="op" id="7020219">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020224">t</span><span class="op" id="7020225">.</span><span class="ident" id="7020226">Error</span><span class="op" id="7020231">(</span><span class="ident" id="7020232">tc</span><span class="op" id="7020234">.</span><span class="ident" id="7020235">filename</span><span class="op" id="7020243">,</span>&nbsp;<span class="ident" id="7020245">err</span><span class="op" id="7020248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020253">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020268">//&nbsp;Encode&nbsp;that&nbsp;image&nbsp;as&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020300">var</span>&nbsp;<span class="ident" id="7020304">buf</span>&nbsp;<span class="ident" id="7020308">bytes</span><span class="op" id="7020313">.</span><span class="ident" id="7020314">Buffer</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020323">err</span>&nbsp;<span class="op" id="7020327">=</span>&nbsp;<span class="ident" id="7020329">Encode</span><span class="op" id="7020335">(</span><span class="op" id="7020336">&amp;</span><span class="ident" id="7020337">buf</span><span class="op" id="7020340">,</span>&nbsp;<span class="ident" id="7020342">m0</span><span class="op" id="7020344">,</span>&nbsp;<span class="op" id="7020346">&amp;</span><span class="ident" id="7020347">Options</span><span class="op" id="7020354">{</span><span class="ident" id="7020355">Quality</span><span class="op" id="7020362">:</span>&nbsp;<span class="ident" id="7020364">tc</span><span class="op" id="7020366">.</span><span class="ident" id="7020367">quality</span><span class="op" id="7020374">}</span><span class="op" id="7020375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020379">if</span>&nbsp;<span class="ident" id="7020382">err</span>&nbsp;<span class="op" id="7020386">!=</span>&nbsp;<span class="ident" id="7020389">nil</span>&nbsp;<span class="op" id="7020393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020398">t</span><span class="op" id="7020399">.</span><span class="ident" id="7020400">Error</span><span class="op" id="7020405">(</span><span class="ident" id="7020406">tc</span><span class="op" id="7020408">.</span><span class="ident" id="7020409">filename</span><span class="op" id="7020417">,</span>&nbsp;<span class="ident" id="7020419">err</span><span class="op" id="7020422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020427">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020438">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020442">//&nbsp;Decode&nbsp;that&nbsp;JPEG.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020465">m1</span><span class="op" id="7020467">,</span>&nbsp;<span class="ident" id="7020469">err</span>&nbsp;<span class="op" id="7020473">:=</span>&nbsp;<span class="ident" id="7020476">Decode</span><span class="op" id="7020482">(</span><span class="op" id="7020483">&amp;</span><span class="ident" id="7020484">buf</span><span class="op" id="7020487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020491">if</span>&nbsp;<span class="ident" id="7020494">err</span>&nbsp;<span class="op" id="7020498">!=</span>&nbsp;<span class="ident" id="7020501">nil</span>&nbsp;<span class="op" id="7020505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020510">t</span><span class="op" id="7020511">.</span><span class="ident" id="7020512">Error</span><span class="op" id="7020517">(</span><span class="ident" id="7020518">tc</span><span class="op" id="7020520">.</span><span class="ident" id="7020521">filename</span><span class="op" id="7020529">,</span>&nbsp;<span class="ident" id="7020531">err</span><span class="op" id="7020534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020539">continue</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020554">if</span>&nbsp;<span class="ident" id="7020557">m0</span><span class="op" id="7020559">.</span><span class="ident" id="7020560">Bounds</span><span class="op" id="7020566">(</span><span class="op" id="7020567">)</span>&nbsp;<span class="op" id="7020569">!=</span>&nbsp;<span class="ident" id="7020572">m1</span><span class="op" id="7020574">.</span><span class="ident" id="7020575">Bounds</span><span class="op" id="7020581">(</span><span class="op" id="7020582">)</span>&nbsp;<span class="op" id="7020584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020589">t</span><span class="op" id="7020590">.</span><span class="ident" id="7020591">Errorf</span><span class="op" id="7020597">(</span><span class="string" id="7020598">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7020628">,</span>&nbsp;<span class="ident" id="7020630">tc</span><span class="op" id="7020632">.</span><span class="ident" id="7020633">filename</span><span class="op" id="7020641">,</span>&nbsp;<span class="ident" id="7020643">m0</span><span class="op" id="7020645">.</span><span class="ident" id="7020646">Bounds</span><span class="op" id="7020652">(</span><span class="op" id="7020653">)</span><span class="op" id="7020654">,</span>&nbsp;<span class="ident" id="7020656">m1</span><span class="op" id="7020658">.</span><span class="ident" id="7020659">Bounds</span><span class="op" id="7020665">(</span><span class="op" id="7020666">)</span><span class="op" id="7020667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020672">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020683">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7020687">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020742">if</span>&nbsp;<span class="ident" id="7020745">averageDelta</span><span class="op" id="7020757">(</span><span class="ident" id="7020758">m0</span><span class="op" id="7020760">,</span>&nbsp;<span class="ident" id="7020762">m1</span><span class="op" id="7020764">)</span>&nbsp;<span class="op" id="7020766">&gt;</span>&nbsp;<span class="ident" id="7020768">tc</span><span class="op" id="7020770">.</span><span class="ident" id="7020771">tolerance</span>&nbsp;<span class="op" id="7020781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7020786">t</span><span class="op" id="7020787">.</span><span class="ident" id="7020788">Errorf</span><span class="op" id="7020794">(</span><span class="string" id="7020795">&#34;%s,&nbsp;quality=%d:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high&#34;</span><span class="op" id="7020838">,</span>&nbsp;<span class="ident" id="7020840">tc</span><span class="op" id="7020842">.</span><span class="ident" id="7020843">filename</span><span class="op" id="7020851">,</span>&nbsp;<span class="ident" id="7020853">tc</span><span class="op" id="7020855">.</span><span class="ident" id="7020856">quality</span><span class="op" id="7020863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7020868">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020879">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7020882">}</span><br>
<span class="lineno"></span><span class="op" id="7020884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7020887">//&nbsp;TestWriteGrayscale&nbsp;tests&nbsp;that&nbsp;a&nbsp;grayscale&nbsp;images&nbsp;survives&nbsp;a&nbsp;round-trip</span><br>
<span class="lineno"></span><span class="comment" id="7020961">//&nbsp;through&nbsp;encode/decode&nbsp;cycle.</span><br>
<span class="lineno">165</span><span class="keyword" id="7020993">func</span>&nbsp;<span class="ident" id="7020998">TestWriteGrayscale</span><span class="op" id="7021016">(</span><span class="ident" id="7021017">t</span>&nbsp;<span class="op" id="7021019">*</span><span class="ident" id="7021020">testing</span><span class="op" id="7021027">.</span><span class="ident" id="7021028">T</span><span class="op" id="7021029">)</span>&nbsp;<span class="op" id="7021031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021034">m0</span>&nbsp;<span class="op" id="7021037">:=</span>&nbsp;<span class="ident" id="7021040">image</span><span class="op" id="7021045">.</span><span class="ident" id="7021046">NewGray</span><span class="op" id="7021053">(</span><span class="ident" id="7021054">image</span><span class="op" id="7021059">.</span><span class="ident" id="7021060">Rect</span><span class="op" id="7021064">(</span><span class="num" id="7021065">0</span><span class="op" id="7021066">,</span>&nbsp;<span class="num" id="7021068">0</span><span class="op" id="7021069">,</span>&nbsp;<span class="num" id="7021071">32</span><span class="op" id="7021073">,</span>&nbsp;<span class="num" id="7021075">32</span><span class="op" id="7021077">)</span><span class="op" id="7021078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021081">for</span>&nbsp;<span class="ident" id="7021085">i</span>&nbsp;<span class="op" id="7021087">:=</span>&nbsp;<span class="keyword" id="7021090">range</span>&nbsp;<span class="ident" id="7021096">m0</span><span class="op" id="7021098">.</span><span class="ident" id="7021099">Pix</span>&nbsp;<span class="op" id="7021103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021107">m0</span><span class="op" id="7021109">.</span><span class="ident" id="7021110">Pix</span><span class="op" id="7021113">[</span><span class="ident" id="7021114">i</span><span class="op" id="7021115">]</span>&nbsp;<span class="op" id="7021117">=</span>&nbsp;<span class="builtintype" id="7021119">uint8</span><span class="op" id="7021124">(</span><span class="ident" id="7021125">i</span><span class="op" id="7021126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021129">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021132">var</span>&nbsp;<span class="ident" id="7021136">buf</span>&nbsp;<span class="ident" id="7021140">bytes</span><span class="op" id="7021145">.</span><span class="ident" id="7021146">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021154">if</span>&nbsp;<span class="ident" id="7021157">err</span>&nbsp;<span class="op" id="7021161">:=</span>&nbsp;<span class="ident" id="7021164">Encode</span><span class="op" id="7021170">(</span><span class="op" id="7021171">&amp;</span><span class="ident" id="7021172">buf</span><span class="op" id="7021175">,</span>&nbsp;<span class="ident" id="7021177">m0</span><span class="op" id="7021179">,</span>&nbsp;<span class="ident" id="7021181">nil</span><span class="op" id="7021184">)</span><span class="op" id="7021185">;</span>&nbsp;<span class="ident" id="7021187">err</span>&nbsp;<span class="op" id="7021191">!=</span>&nbsp;<span class="ident" id="7021194">nil</span>&nbsp;<span class="op" id="7021198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021202">t</span><span class="op" id="7021203">.</span><span class="ident" id="7021204">Fatal</span><span class="op" id="7021209">(</span><span class="ident" id="7021210">err</span><span class="op" id="7021213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021219">m1</span><span class="op" id="7021221">,</span>&nbsp;<span class="ident" id="7021223">err</span>&nbsp;<span class="op" id="7021227">:=</span>&nbsp;<span class="ident" id="7021230">Decode</span><span class="op" id="7021236">(</span><span class="op" id="7021237">&amp;</span><span class="ident" id="7021238">buf</span><span class="op" id="7021241">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021244">if</span>&nbsp;<span class="ident" id="7021247">err</span>&nbsp;<span class="op" id="7021251">!=</span>&nbsp;<span class="ident" id="7021254">nil</span>&nbsp;<span class="op" id="7021258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021262">t</span><span class="op" id="7021263">.</span><span class="ident" id="7021264">Fatal</span><span class="op" id="7021269">(</span><span class="ident" id="7021270">err</span><span class="op" id="7021273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021279">if</span>&nbsp;<span class="ident" id="7021282">m0</span><span class="op" id="7021284">.</span><span class="ident" id="7021285">Bounds</span><span class="op" id="7021291">(</span><span class="op" id="7021292">)</span>&nbsp;<span class="op" id="7021294">!=</span>&nbsp;<span class="ident" id="7021297">m1</span><span class="op" id="7021299">.</span><span class="ident" id="7021300">Bounds</span><span class="op" id="7021306">(</span><span class="op" id="7021307">)</span>&nbsp;<span class="op" id="7021309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021313">t</span><span class="op" id="7021314">.</span><span class="ident" id="7021315">Fatalf</span><span class="op" id="7021321">(</span><span class="string" id="7021322">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="7021348">,</span>&nbsp;<span class="ident" id="7021350">m0</span><span class="op" id="7021352">.</span><span class="ident" id="7021353">Bounds</span><span class="op" id="7021359">(</span><span class="op" id="7021360">)</span><span class="op" id="7021361">,</span>&nbsp;<span class="ident" id="7021363">m1</span><span class="op" id="7021365">.</span><span class="ident" id="7021366">Bounds</span><span class="op" id="7021372">(</span><span class="op" id="7021373">)</span><span class="op" id="7021374">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021380">if</span>&nbsp;<span class="ident" id="7021383">_</span><span class="op" id="7021384">,</span>&nbsp;<span class="ident" id="7021386">ok</span>&nbsp;<span class="op" id="7021389">:=</span>&nbsp;<span class="ident" id="7021392">m1</span><span class="op" id="7021394">.</span><span class="op" id="7021395">(</span><span class="op" id="7021396">*</span><span class="ident" id="7021397">image</span><span class="op" id="7021402">.</span><span class="ident" id="7021403">Gray</span><span class="op" id="7021407">)</span><span class="op" id="7021408">;</span>&nbsp;<span class="op" id="7021410">!</span><span class="ident" id="7021411">ok</span>&nbsp;<span class="op" id="7021414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021418">t</span><span class="op" id="7021419">.</span><span class="ident" id="7021420">Errorf</span><span class="op" id="7021426">(</span><span class="string" id="7021427">&#34;got&nbsp;%T,&nbsp;want&nbsp;*image.Gray&#34;</span><span class="op" id="7021453">,</span>&nbsp;<span class="ident" id="7021455">m1</span><span class="op" id="7021457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7021463">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021517">want</span>&nbsp;<span class="op" id="7021522">:=</span>&nbsp;<span class="ident" id="7021525">int64</span><span class="op" id="7021530">(</span><span class="num" id="7021531">2</span>&nbsp;<span class="op" id="7021533">&lt;&lt;</span>&nbsp;<span class="num" id="7021536">8</span><span class="op" id="7021537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021540">if</span>&nbsp;<span class="ident" id="7021543">got</span>&nbsp;<span class="op" id="7021547">:=</span>&nbsp;<span class="ident" id="7021550">averageDelta</span><span class="op" id="7021562">(</span><span class="ident" id="7021563">m0</span><span class="op" id="7021565">,</span>&nbsp;<span class="ident" id="7021567">m1</span><span class="op" id="7021569">)</span><span class="op" id="7021570">;</span>&nbsp;<span class="ident" id="7021572">got</span>&nbsp;<span class="op" id="7021576">&gt;</span>&nbsp;<span class="ident" id="7021578">want</span>&nbsp;<span class="op" id="7021583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021587">t</span><span class="op" id="7021588">.</span><span class="ident" id="7021589">Errorf</span><span class="op" id="7021595">(</span><span class="string" id="7021596">&#34;average&nbsp;delta&nbsp;too&nbsp;high;&nbsp;got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&#34;</span><span class="op" id="7021640">,</span>&nbsp;<span class="ident" id="7021642">got</span><span class="op" id="7021645">,</span>&nbsp;<span class="ident" id="7021647">want</span><span class="op" id="7021651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7021654">}</span><br>
<span class="lineno"></span><span class="op" id="7021656">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7021659">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="7021735">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="7021760">func</span>&nbsp;<span class="ident" id="7021765">averageDelta</span><span class="op" id="7021777">(</span><span class="ident" id="7021778">m0</span><span class="op" id="7021780">,</span>&nbsp;<span class="ident" id="7021782">m1</span>&nbsp;<span class="ident" id="7021785">image</span><span class="op" id="7021790">.</span><span class="ident" id="7021791">Image</span><span class="op" id="7021796">)</span>&nbsp;<span class="ident" id="7021798">int64</span>&nbsp;<span class="op" id="7021804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021807">b</span>&nbsp;<span class="op" id="7021809">:=</span>&nbsp;<span class="ident" id="7021812">m0</span><span class="op" id="7021814">.</span><span class="ident" id="7021815">Bounds</span><span class="op" id="7021821">(</span><span class="op" id="7021822">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021825">var</span>&nbsp;<span class="ident" id="7021829">sum</span><span class="op" id="7021832">,</span>&nbsp;<span class="ident" id="7021834">n</span>&nbsp;<span class="ident" id="7021836">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021843">for</span>&nbsp;<span class="ident" id="7021847">y</span>&nbsp;<span class="op" id="7021849">:=</span>&nbsp;<span class="ident" id="7021852">b</span><span class="op" id="7021853">.</span><span class="ident" id="7021854">Min</span><span class="op" id="7021857">.</span><span class="ident" id="7021858">Y</span><span class="op" id="7021859">;</span>&nbsp;<span class="ident" id="7021861">y</span>&nbsp;<span class="op" id="7021863">&lt;</span>&nbsp;<span class="ident" id="7021865">b</span><span class="op" id="7021866">.</span><span class="ident" id="7021867">Max</span><span class="op" id="7021870">.</span><span class="ident" id="7021871">Y</span><span class="op" id="7021872">;</span>&nbsp;<span class="ident" id="7021874">y</span><span class="op" id="7021875">++</span>&nbsp;<span class="op" id="7021878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7021882">for</span>&nbsp;<span class="ident" id="7021886">x</span>&nbsp;<span class="op" id="7021888">:=</span>&nbsp;<span class="ident" id="7021891">b</span><span class="op" id="7021892">.</span><span class="ident" id="7021893">Min</span><span class="op" id="7021896">.</span><span class="ident" id="7021897">X</span><span class="op" id="7021898">;</span>&nbsp;<span class="ident" id="7021900">x</span>&nbsp;<span class="op" id="7021902">&lt;</span>&nbsp;<span class="ident" id="7021904">b</span><span class="op" id="7021905">.</span><span class="ident" id="7021906">Max</span><span class="op" id="7021909">.</span><span class="ident" id="7021910">X</span><span class="op" id="7021911">;</span>&nbsp;<span class="ident" id="7021913">x</span><span class="op" id="7021914">++</span>&nbsp;<span class="op" id="7021917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021922">c0</span>&nbsp;<span class="op" id="7021925">:=</span>&nbsp;<span class="ident" id="7021928">m0</span><span class="op" id="7021930">.</span><span class="ident" id="7021931">At</span><span class="op" id="7021933">(</span><span class="ident" id="7021934">x</span><span class="op" id="7021935">,</span>&nbsp;<span class="ident" id="7021937">y</span><span class="op" id="7021938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021943">c1</span>&nbsp;<span class="op" id="7021946">:=</span>&nbsp;<span class="ident" id="7021949">m1</span><span class="op" id="7021951">.</span><span class="ident" id="7021952">At</span><span class="op" id="7021954">(</span><span class="ident" id="7021955">x</span><span class="op" id="7021956">,</span>&nbsp;<span class="ident" id="7021958">y</span><span class="op" id="7021959">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021964">r0</span><span class="op" id="7021966">,</span>&nbsp;<span class="ident" id="7021968">g0</span><span class="op" id="7021970">,</span>&nbsp;<span class="ident" id="7021972">b0</span><span class="op" id="7021974">,</span>&nbsp;<span class="ident" id="7021976">_</span>&nbsp;<span class="op" id="7021978">:=</span>&nbsp;<span class="ident" id="7021981">c0</span><span class="op" id="7021983">.</span><span class="ident" id="7021984">RGBA</span><span class="op" id="7021988">(</span><span class="op" id="7021989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7021994">r1</span><span class="op" id="7021996">,</span>&nbsp;<span class="ident" id="7021998">g1</span><span class="op" id="7022000">,</span>&nbsp;<span class="ident" id="7022002">b1</span><span class="op" id="7022004">,</span>&nbsp;<span class="ident" id="7022006">_</span>&nbsp;<span class="op" id="7022008">:=</span>&nbsp;<span class="ident" id="7022011">c1</span><span class="op" id="7022013">.</span><span class="ident" id="7022014">RGBA</span><span class="op" id="7022018">(</span><span class="op" id="7022019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022024">sum</span>&nbsp;<span class="op" id="7022028">+=</span>&nbsp;<span class="ident" id="7022031">delta</span><span class="op" id="7022036">(</span><span class="ident" id="7022037">r0</span><span class="op" id="7022039">,</span>&nbsp;<span class="ident" id="7022041">r1</span><span class="op" id="7022043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022048">sum</span>&nbsp;<span class="op" id="7022052">+=</span>&nbsp;<span class="ident" id="7022055">delta</span><span class="op" id="7022060">(</span><span class="ident" id="7022061">g0</span><span class="op" id="7022063">,</span>&nbsp;<span class="ident" id="7022065">g1</span><span class="op" id="7022067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022072">sum</span>&nbsp;<span class="op" id="7022076">+=</span>&nbsp;<span class="ident" id="7022079">delta</span><span class="op" id="7022084">(</span><span class="ident" id="7022085">b0</span><span class="op" id="7022087">,</span>&nbsp;<span class="ident" id="7022089">b1</span><span class="op" id="7022091">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022096">n</span>&nbsp;<span class="op" id="7022098">+=</span>&nbsp;<span class="num" id="7022101">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022111">return</span>&nbsp;<span class="ident" id="7022118">sum</span>&nbsp;<span class="op" id="7022122">/</span>&nbsp;<span class="ident" id="7022124">n</span><br>
<span class="lineno"></span><span class="op" id="7022126">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="7022129">func</span>&nbsp;<span class="ident" id="7022134">BenchmarkEncode</span><span class="op" id="7022149">(</span><span class="ident" id="7022150">b</span>&nbsp;<span class="op" id="7022152">*</span><span class="ident" id="7022153">testing</span><span class="op" id="7022160">.</span><span class="ident" id="7022161">B</span><span class="op" id="7022162">)</span>&nbsp;<span class="op" id="7022164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022167">b</span><span class="op" id="7022168">.</span><span class="ident" id="7022169">StopTimer</span><span class="op" id="7022178">(</span><span class="op" id="7022179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022182">img</span>&nbsp;<span class="op" id="7022186">:=</span>&nbsp;<span class="ident" id="7022189">image</span><span class="op" id="7022194">.</span><span class="ident" id="7022195">NewRGBA</span><span class="op" id="7022202">(</span><span class="ident" id="7022203">image</span><span class="op" id="7022208">.</span><span class="ident" id="7022209">Rect</span><span class="op" id="7022213">(</span><span class="num" id="7022214">0</span><span class="op" id="7022215">,</span>&nbsp;<span class="num" id="7022217">0</span><span class="op" id="7022218">,</span>&nbsp;<span class="num" id="7022220">640</span><span class="op" id="7022223">,</span>&nbsp;<span class="num" id="7022225">480</span><span class="op" id="7022228">)</span><span class="op" id="7022229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022232">bo</span>&nbsp;<span class="op" id="7022235">:=</span>&nbsp;<span class="ident" id="7022238">img</span><span class="op" id="7022241">.</span><span class="ident" id="7022242">Bounds</span><span class="op" id="7022248">(</span><span class="op" id="7022249">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022252">rnd</span>&nbsp;<span class="op" id="7022256">:=</span>&nbsp;<span class="ident" id="7022259">rand</span><span class="op" id="7022263">.</span><span class="ident" id="7022264">New</span><span class="op" id="7022267">(</span><span class="ident" id="7022268">rand</span><span class="op" id="7022272">.</span><span class="ident" id="7022273">NewSource</span><span class="op" id="7022282">(</span><span class="num" id="7022283">123</span><span class="op" id="7022286">)</span><span class="op" id="7022287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022290">for</span>&nbsp;<span class="ident" id="7022294">y</span>&nbsp;<span class="op" id="7022296">:=</span>&nbsp;<span class="ident" id="7022299">bo</span><span class="op" id="7022301">.</span><span class="ident" id="7022302">Min</span><span class="op" id="7022305">.</span><span class="ident" id="7022306">Y</span><span class="op" id="7022307">;</span>&nbsp;<span class="ident" id="7022309">y</span>&nbsp;<span class="op" id="7022311">&lt;</span>&nbsp;<span class="ident" id="7022313">bo</span><span class="op" id="7022315">.</span><span class="ident" id="7022316">Max</span><span class="op" id="7022319">.</span><span class="ident" id="7022320">Y</span><span class="op" id="7022321">;</span>&nbsp;<span class="ident" id="7022323">y</span><span class="op" id="7022324">++</span>&nbsp;<span class="op" id="7022327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022331">for</span>&nbsp;<span class="ident" id="7022335">x</span>&nbsp;<span class="op" id="7022337">:=</span>&nbsp;<span class="ident" id="7022340">bo</span><span class="op" id="7022342">.</span><span class="ident" id="7022343">Min</span><span class="op" id="7022346">.</span><span class="ident" id="7022347">X</span><span class="op" id="7022348">;</span>&nbsp;<span class="ident" id="7022350">x</span>&nbsp;<span class="op" id="7022352">&lt;</span>&nbsp;<span class="ident" id="7022354">bo</span><span class="op" id="7022356">.</span><span class="ident" id="7022357">Max</span><span class="op" id="7022360">.</span><span class="ident" id="7022361">X</span><span class="op" id="7022362">;</span>&nbsp;<span class="ident" id="7022364">x</span><span class="op" id="7022365">++</span>&nbsp;<span class="op" id="7022368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022373">img</span><span class="op" id="7022376">.</span><span class="ident" id="7022377">SetRGBA</span><span class="op" id="7022384">(</span><span class="ident" id="7022385">x</span><span class="op" id="7022386">,</span>&nbsp;<span class="ident" id="7022388">y</span><span class="op" id="7022389">,</span>&nbsp;<span class="ident" id="7022391">color</span><span class="op" id="7022396">.</span><span class="ident" id="7022397">RGBA</span><span class="op" id="7022401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7022407">uint8</span><span class="op" id="7022412">(</span><span class="ident" id="7022413">rnd</span><span class="op" id="7022416">.</span><span class="ident" id="7022417">Intn</span><span class="op" id="7022421">(</span><span class="num" id="7022422">256</span><span class="op" id="7022425">)</span><span class="op" id="7022426">)</span><span class="op" id="7022427">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7022433">uint8</span><span class="op" id="7022438">(</span><span class="ident" id="7022439">rnd</span><span class="op" id="7022442">.</span><span class="ident" id="7022443">Intn</span><span class="op" id="7022447">(</span><span class="num" id="7022448">256</span><span class="op" id="7022451">)</span><span class="op" id="7022452">)</span><span class="op" id="7022453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7022459">uint8</span><span class="op" id="7022464">(</span><span class="ident" id="7022465">rnd</span><span class="op" id="7022468">.</span><span class="ident" id="7022469">Intn</span><span class="op" id="7022473">(</span><span class="num" id="7022474">256</span><span class="op" id="7022477">)</span><span class="op" id="7022478">)</span><span class="op" id="7022479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7022485">255</span><span class="op" id="7022488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022493">}</span><span class="op" id="7022494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022498">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022504">b</span><span class="op" id="7022505">.</span><span class="ident" id="7022506">SetBytes</span><span class="op" id="7022514">(</span><span class="num" id="7022515">640</span>&nbsp;<span class="op" id="7022519">*</span>&nbsp;<span class="num" id="7022521">480</span>&nbsp;<span class="op" id="7022525">*</span>&nbsp;<span class="num" id="7022527">4</span><span class="op" id="7022528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022531">b</span><span class="op" id="7022532">.</span><span class="ident" id="7022533">StartTimer</span><span class="op" id="7022543">(</span><span class="op" id="7022544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022547">options</span>&nbsp;<span class="op" id="7022555">:=</span>&nbsp;<span class="op" id="7022558">&amp;</span><span class="ident" id="7022559">Options</span><span class="op" id="7022566">{</span><span class="ident" id="7022567">Quality</span><span class="op" id="7022574">:</span>&nbsp;<span class="num" id="7022576">90</span><span class="op" id="7022578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7022581">for</span>&nbsp;<span class="ident" id="7022585">i</span>&nbsp;<span class="op" id="7022587">:=</span>&nbsp;<span class="num" id="7022590">0</span><span class="op" id="7022591">;</span>&nbsp;<span class="ident" id="7022593">i</span>&nbsp;<span class="op" id="7022595">&lt;</span>&nbsp;<span class="ident" id="7022597">b</span><span class="op" id="7022598">.</span><span class="ident" id="7022599">N</span><span class="op" id="7022600">;</span>&nbsp;<span class="ident" id="7022602">i</span><span class="op" id="7022603">++</span>&nbsp;<span class="op" id="7022606">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7022610">Encode</span><span class="op" id="7022616">(</span><span class="ident" id="7022617">ioutil</span><span class="op" id="7022623">.</span><span class="ident" id="7022624">Discard</span><span class="op" id="7022631">,</span>&nbsp;<span class="ident" id="7022633">img</span><span class="op" id="7022636">,</span>&nbsp;<span class="ident" id="7022638">options</span><span class="op" id="7022645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7022648">}</span><br>
<span class="lineno"></span><span class="op" id="7022650">}</span>
</div>
</body>
</html>
