<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html" class="current">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2578644">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2578699">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2578753">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2578804">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578869">package</span>&nbsp;<span class="ident" id="2578877">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2578886">import</span>&nbsp;<span class="op" id="2578893">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2578896">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2578907">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2578915">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2578924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2578927">var</span>&nbsp;<span class="op" id="2578931">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2578934">Stdin</span>&nbsp;&nbsp;<span class="op" id="2578941">=</span>&nbsp;<span class="num" id="2578943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2578946">Stdout</span>&nbsp;<span class="op" id="2578953">=</span>&nbsp;<span class="num" id="2578955">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2578958">Stderr</span>&nbsp;<span class="op" id="2578965">=</span>&nbsp;<span class="num" id="2578967">2</span><br>
<span class="lineno"></span><span class="op" id="2578969">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2578972">const</span>&nbsp;<span class="op" id="2578978">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2578981">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2578996">=</span>&nbsp;<span class="ident" id="2578998">runtime</span><span class="op" id="2579005">.</span><span class="ident" id="2579006">GOOS</span>&nbsp;<span class="op" id="2579011">==</span>&nbsp;<span class="string" id="2579014">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2579023">&amp;&amp;</span>&nbsp;<span class="ident" id="2579026">sizeofPtr</span>&nbsp;<span class="op" id="2579036">==</span>&nbsp;<span class="num" id="2579039">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579042">dragonfly64Bit</span>&nbsp;<span class="op" id="2579057">=</span>&nbsp;<span class="ident" id="2579059">runtime</span><span class="op" id="2579066">.</span><span class="ident" id="2579067">GOOS</span>&nbsp;<span class="op" id="2579072">==</span>&nbsp;<span class="string" id="2579075">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2579087">&amp;&amp;</span>&nbsp;<span class="ident" id="2579090">sizeofPtr</span>&nbsp;<span class="op" id="2579100">==</span>&nbsp;<span class="num" id="2579103">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579106">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2579121">=</span>&nbsp;<span class="ident" id="2579123">runtime</span><span class="op" id="2579130">.</span><span class="ident" id="2579131">GOOS</span>&nbsp;<span class="op" id="2579136">==</span>&nbsp;<span class="string" id="2579139">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2579148">&amp;&amp;</span>&nbsp;<span class="ident" id="2579151">sizeofPtr</span>&nbsp;<span class="op" id="2579161">==</span>&nbsp;<span class="num" id="2579164">4</span><br>
<span class="lineno">25</span><span class="op" id="2579166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2579169">func</span>&nbsp;<span class="ident" id="2579174">Syscall</span><span class="op" id="2579181">(</span><span class="ident" id="2579182">trap</span><span class="op" id="2579186">,</span>&nbsp;<span class="ident" id="2579188">a1</span><span class="op" id="2579190">,</span>&nbsp;<span class="ident" id="2579192">a2</span><span class="op" id="2579194">,</span>&nbsp;<span class="ident" id="2579196">a3</span>&nbsp;<span class="builtintype" id="2579199">uintptr</span><span class="op" id="2579206">)</span>&nbsp;<span class="op" id="2579208">(</span><span class="ident" id="2579209">r1</span><span class="op" id="2579211">,</span>&nbsp;<span class="ident" id="2579213">r2</span>&nbsp;<span class="builtintype" id="2579216">uintptr</span><span class="op" id="2579223">,</span>&nbsp;<span class="ident" id="2579225">err</span>&nbsp;<span class="ident" id="2579229">Errno</span><span class="op" id="2579234">)</span><br>
<span class="lineno"></span><span class="keyword" id="2579236">func</span>&nbsp;<span class="ident" id="2579241">Syscall6</span><span class="op" id="2579249">(</span><span class="ident" id="2579250">trap</span><span class="op" id="2579254">,</span>&nbsp;<span class="ident" id="2579256">a1</span><span class="op" id="2579258">,</span>&nbsp;<span class="ident" id="2579260">a2</span><span class="op" id="2579262">,</span>&nbsp;<span class="ident" id="2579264">a3</span><span class="op" id="2579266">,</span>&nbsp;<span class="ident" id="2579268">a4</span><span class="op" id="2579270">,</span>&nbsp;<span class="ident" id="2579272">a5</span><span class="op" id="2579274">,</span>&nbsp;<span class="ident" id="2579276">a6</span>&nbsp;<span class="builtintype" id="2579279">uintptr</span><span class="op" id="2579286">)</span>&nbsp;<span class="op" id="2579288">(</span><span class="ident" id="2579289">r1</span><span class="op" id="2579291">,</span>&nbsp;<span class="ident" id="2579293">r2</span>&nbsp;<span class="builtintype" id="2579296">uintptr</span><span class="op" id="2579303">,</span>&nbsp;<span class="ident" id="2579305">err</span>&nbsp;<span class="ident" id="2579309">Errno</span><span class="op" id="2579314">)</span><br>
<span class="lineno"></span><span class="keyword" id="2579316">func</span>&nbsp;<span class="ident" id="2579321">RawSyscall</span><span class="op" id="2579331">(</span><span class="ident" id="2579332">trap</span><span class="op" id="2579336">,</span>&nbsp;<span class="ident" id="2579338">a1</span><span class="op" id="2579340">,</span>&nbsp;<span class="ident" id="2579342">a2</span><span class="op" id="2579344">,</span>&nbsp;<span class="ident" id="2579346">a3</span>&nbsp;<span class="builtintype" id="2579349">uintptr</span><span class="op" id="2579356">)</span>&nbsp;<span class="op" id="2579358">(</span><span class="ident" id="2579359">r1</span><span class="op" id="2579361">,</span>&nbsp;<span class="ident" id="2579363">r2</span>&nbsp;<span class="builtintype" id="2579366">uintptr</span><span class="op" id="2579373">,</span>&nbsp;<span class="ident" id="2579375">err</span>&nbsp;<span class="ident" id="2579379">Errno</span><span class="op" id="2579384">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2579386">func</span>&nbsp;<span class="ident" id="2579391">RawSyscall6</span><span class="op" id="2579402">(</span><span class="ident" id="2579403">trap</span><span class="op" id="2579407">,</span>&nbsp;<span class="ident" id="2579409">a1</span><span class="op" id="2579411">,</span>&nbsp;<span class="ident" id="2579413">a2</span><span class="op" id="2579415">,</span>&nbsp;<span class="ident" id="2579417">a3</span><span class="op" id="2579419">,</span>&nbsp;<span class="ident" id="2579421">a4</span><span class="op" id="2579423">,</span>&nbsp;<span class="ident" id="2579425">a5</span><span class="op" id="2579427">,</span>&nbsp;<span class="ident" id="2579429">a6</span>&nbsp;<span class="builtintype" id="2579432">uintptr</span><span class="op" id="2579439">)</span>&nbsp;<span class="op" id="2579441">(</span><span class="ident" id="2579442">r1</span><span class="op" id="2579444">,</span>&nbsp;<span class="ident" id="2579446">r2</span>&nbsp;<span class="builtintype" id="2579449">uintptr</span><span class="op" id="2579456">,</span>&nbsp;<span class="ident" id="2579458">err</span>&nbsp;<span class="ident" id="2579462">Errno</span><span class="op" id="2579467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2579470">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2579542">type</span>&nbsp;<span class="ident" id="2579547">mmapper</span>&nbsp;<span class="keyword" id="2579555">struct</span>&nbsp;<span class="op" id="2579562">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579565">sync</span><span class="op" id="2579569">.</span><span class="ident" id="2579570">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579577">active</span>&nbsp;<span class="keyword" id="2579584">map</span><span class="op" id="2579587">[</span><span class="op" id="2579588">*</span><span class="builtintype" id="2579589">byte</span><span class="op" id="2579593">]</span><span class="op" id="2579594">[</span><span class="op" id="2579595">]</span><span class="builtintype" id="2579596">byte</span>&nbsp;<span class="comment" id="2579601">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579650">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2579657">func</span><span class="op" id="2579661">(</span><span class="ident" id="2579662">addr</span><span class="op" id="2579666">,</span>&nbsp;<span class="ident" id="2579668">length</span>&nbsp;<span class="builtintype" id="2579675">uintptr</span><span class="op" id="2579682">,</span>&nbsp;<span class="ident" id="2579684">prot</span><span class="op" id="2579688">,</span>&nbsp;<span class="ident" id="2579690">flags</span><span class="op" id="2579695">,</span>&nbsp;<span class="ident" id="2579697">fd</span>&nbsp;<span class="builtintype" id="2579700">int</span><span class="op" id="2579703">,</span>&nbsp;<span class="ident" id="2579705">offset</span>&nbsp;<span class="builtintype" id="2579712">int64</span><span class="op" id="2579717">)</span>&nbsp;<span class="op" id="2579719">(</span><span class="builtintype" id="2579720">uintptr</span><span class="op" id="2579727">,</span>&nbsp;<span class="builtintype" id="2579729">error</span><span class="op" id="2579734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579737">munmap</span>&nbsp;<span class="keyword" id="2579744">func</span><span class="op" id="2579748">(</span><span class="ident" id="2579749">addr</span>&nbsp;<span class="builtintype" id="2579754">uintptr</span><span class="op" id="2579761">,</span>&nbsp;<span class="ident" id="2579763">length</span>&nbsp;<span class="builtintype" id="2579770">uintptr</span><span class="op" id="2579777">)</span>&nbsp;<span class="builtintype" id="2579779">error</span><br>
<span class="lineno"></span><span class="op" id="2579785">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2579788">func</span>&nbsp;<span class="op" id="2579793">(</span><span class="ident" id="2579794">m</span>&nbsp;<span class="op" id="2579796">*</span><span class="ident" id="2579797">mmapper</span><span class="op" id="2579804">)</span>&nbsp;<span class="ident" id="2579806">Mmap</span><span class="op" id="2579810">(</span><span class="ident" id="2579811">fd</span>&nbsp;<span class="builtintype" id="2579814">int</span><span class="op" id="2579817">,</span>&nbsp;<span class="ident" id="2579819">offset</span>&nbsp;<span class="builtintype" id="2579826">int64</span><span class="op" id="2579831">,</span>&nbsp;<span class="ident" id="2579833">length</span>&nbsp;<span class="builtintype" id="2579840">int</span><span class="op" id="2579843">,</span>&nbsp;<span class="ident" id="2579845">prot</span>&nbsp;<span class="builtintype" id="2579850">int</span><span class="op" id="2579853">,</span>&nbsp;<span class="ident" id="2579855">flags</span>&nbsp;<span class="builtintype" id="2579861">int</span><span class="op" id="2579864">)</span>&nbsp;<span class="op" id="2579866">(</span><span class="ident" id="2579867">data</span>&nbsp;<span class="op" id="2579872">[</span><span class="op" id="2579873">]</span><span class="builtintype" id="2579874">byte</span><span class="op" id="2579878">,</span>&nbsp;<span class="ident" id="2579880">err</span>&nbsp;<span class="builtintype" id="2579884">error</span><span class="op" id="2579889">)</span>&nbsp;<span class="op" id="2579891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2579894">if</span>&nbsp;<span class="ident" id="2579897">length</span>&nbsp;<span class="op" id="2579904">&lt;=</span>&nbsp;<span class="num" id="2579907">0</span>&nbsp;<span class="op" id="2579909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2579913">return</span>&nbsp;<span class="builtintype" id="2579920">nil</span><span class="op" id="2579923">,</span>&nbsp;<span class="ident" id="2579925">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2579933">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2579937">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2579967">addr</span><span class="op" id="2579971">,</span>&nbsp;<span class="ident" id="2579973">errno</span>&nbsp;<span class="op" id="2579979">:=</span>&nbsp;<span class="ident" id="2579982">m</span><span class="op" id="2579983">.</span><span class="ident" id="2579984">mmap</span><span class="op" id="2579988">(</span><span class="num" id="2579989">0</span><span class="op" id="2579990">,</span>&nbsp;<span class="builtintype" id="2579992">uintptr</span><span class="op" id="2579999">(</span><span class="ident" id="2580000">length</span><span class="op" id="2580006">)</span><span class="op" id="2580007">,</span>&nbsp;<span class="ident" id="2580009">prot</span><span class="op" id="2580013">,</span>&nbsp;<span class="ident" id="2580015">flags</span><span class="op" id="2580020">,</span>&nbsp;<span class="ident" id="2580022">fd</span><span class="op" id="2580024">,</span>&nbsp;<span class="ident" id="2580026">offset</span><span class="op" id="2580032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580035">if</span>&nbsp;<span class="ident" id="2580038">errno</span>&nbsp;<span class="op" id="2580044">!=</span>&nbsp;<span class="builtintype" id="2580047">nil</span>&nbsp;<span class="op" id="2580051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580055">return</span>&nbsp;<span class="builtintype" id="2580062">nil</span><span class="op" id="2580065">,</span>&nbsp;<span class="ident" id="2580067">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2580074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2580078">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580102">var</span>&nbsp;<span class="ident" id="2580106">sl</span>&nbsp;<span class="op" id="2580109">=</span>&nbsp;<span class="keyword" id="2580111">struct</span>&nbsp;<span class="op" id="2580118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580122">addr</span>&nbsp;<span class="builtintype" id="2580127">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2580137">len</span>&nbsp;&nbsp;<span class="builtintype" id="2580142">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2580148">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2580153">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2580158">}</span><span class="op" id="2580159">{</span><span class="ident" id="2580160">addr</span><span class="op" id="2580164">,</span>&nbsp;<span class="ident" id="2580166">length</span><span class="op" id="2580172">,</span>&nbsp;<span class="ident" id="2580174">length</span><span class="op" id="2580180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2580184">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580225">b</span>&nbsp;<span class="op" id="2580227">:=</span>&nbsp;<span class="op" id="2580230">*</span><span class="op" id="2580231">(</span><span class="op" id="2580232">*</span><span class="op" id="2580233">[</span><span class="op" id="2580234">]</span><span class="builtintype" id="2580235">byte</span><span class="op" id="2580239">)</span><span class="op" id="2580240">(</span><span class="ident" id="2580241">unsafe</span><span class="op" id="2580247">.</span><span class="ident" id="2580248">Pointer</span><span class="op" id="2580255">(</span><span class="op" id="2580256">&amp;</span><span class="ident" id="2580257">sl</span><span class="op" id="2580259">)</span><span class="op" id="2580260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2580264">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580305">p</span>&nbsp;<span class="op" id="2580307">:=</span>&nbsp;<span class="op" id="2580310">&amp;</span><span class="ident" id="2580311">b</span><span class="op" id="2580312">[</span><span class="builtinfunc" id="2580313">cap</span><span class="op" id="2580316">(</span><span class="ident" id="2580317">b</span><span class="op" id="2580318">)</span><span class="op" id="2580319">-</span><span class="num" id="2580320">1</span><span class="op" id="2580321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580324">m</span><span class="op" id="2580325">.</span><span class="ident" id="2580326">Lock</span><span class="op" id="2580330">(</span><span class="op" id="2580331">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580334">defer</span>&nbsp;<span class="ident" id="2580340">m</span><span class="op" id="2580341">.</span><span class="ident" id="2580342">Unlock</span><span class="op" id="2580348">(</span><span class="op" id="2580349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580352">m</span><span class="op" id="2580353">.</span><span class="ident" id="2580354">active</span><span class="op" id="2580360">[</span><span class="ident" id="2580361">p</span><span class="op" id="2580362">]</span>&nbsp;<span class="op" id="2580364">=</span>&nbsp;<span class="ident" id="2580366">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580369">return</span>&nbsp;<span class="ident" id="2580376">b</span><span class="op" id="2580377">,</span>&nbsp;<span class="builtintype" id="2580379">nil</span><br>
<span class="lineno"></span><span class="op" id="2580383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2580386">func</span>&nbsp;<span class="op" id="2580391">(</span><span class="ident" id="2580392">m</span>&nbsp;<span class="op" id="2580394">*</span><span class="ident" id="2580395">mmapper</span><span class="op" id="2580402">)</span>&nbsp;<span class="ident" id="2580404">Munmap</span><span class="op" id="2580410">(</span><span class="ident" id="2580411">data</span>&nbsp;<span class="op" id="2580416">[</span><span class="op" id="2580417">]</span><span class="builtintype" id="2580418">byte</span><span class="op" id="2580422">)</span>&nbsp;<span class="op" id="2580424">(</span><span class="ident" id="2580425">err</span>&nbsp;<span class="builtintype" id="2580429">error</span><span class="op" id="2580434">)</span>&nbsp;<span class="op" id="2580436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580439">if</span>&nbsp;<span class="builtinfunc" id="2580442">len</span><span class="op" id="2580445">(</span><span class="ident" id="2580446">data</span><span class="op" id="2580450">)</span>&nbsp;<span class="op" id="2580452">==</span>&nbsp;<span class="num" id="2580455">0</span>&nbsp;<span class="op" id="2580457">||</span>&nbsp;<span class="builtinfunc" id="2580460">len</span><span class="op" id="2580463">(</span><span class="ident" id="2580464">data</span><span class="op" id="2580468">)</span>&nbsp;<span class="op" id="2580470">!=</span>&nbsp;<span class="builtinfunc" id="2580473">cap</span><span class="op" id="2580476">(</span><span class="ident" id="2580477">data</span><span class="op" id="2580481">)</span>&nbsp;<span class="op" id="2580483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580487">return</span>&nbsp;<span class="ident" id="2580494">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2580502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2580506">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580540">p</span>&nbsp;<span class="op" id="2580542">:=</span>&nbsp;<span class="op" id="2580545">&amp;</span><span class="ident" id="2580546">data</span><span class="op" id="2580550">[</span><span class="builtinfunc" id="2580551">cap</span><span class="op" id="2580554">(</span><span class="ident" id="2580555">data</span><span class="op" id="2580559">)</span><span class="op" id="2580560">-</span><span class="num" id="2580561">1</span><span class="op" id="2580562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580565">m</span><span class="op" id="2580566">.</span><span class="ident" id="2580567">Lock</span><span class="op" id="2580571">(</span><span class="op" id="2580572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580575">defer</span>&nbsp;<span class="ident" id="2580581">m</span><span class="op" id="2580582">.</span><span class="ident" id="2580583">Unlock</span><span class="op" id="2580589">(</span><span class="op" id="2580590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2580593">b</span>&nbsp;<span class="op" id="2580595">:=</span>&nbsp;<span class="ident" id="2580598">m</span><span class="op" id="2580599">.</span><span class="ident" id="2580600">active</span><span class="op" id="2580606">[</span><span class="ident" id="2580607">p</span><span class="op" id="2580608">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580611">if</span>&nbsp;<span class="ident" id="2580614">b</span>&nbsp;<span class="op" id="2580616">==</span>&nbsp;<span class="builtintype" id="2580619">nil</span>&nbsp;<span class="op" id="2580623">||</span>&nbsp;<span class="op" id="2580626">&amp;</span><span class="ident" id="2580627">b</span><span class="op" id="2580628">[</span><span class="num" id="2580629">0</span><span class="op" id="2580630">]</span>&nbsp;<span class="op" id="2580632">!=</span>&nbsp;<span class="op" id="2580635">&amp;</span><span class="ident" id="2580636">data</span><span class="op" id="2580640">[</span><span class="num" id="2580641">0</span><span class="op" id="2580642">]</span>&nbsp;<span class="op" id="2580644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580648">return</span>&nbsp;<span class="ident" id="2580655">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2580663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2580667">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580702">if</span>&nbsp;<span class="ident" id="2580705">errno</span>&nbsp;<span class="op" id="2580711">:=</span>&nbsp;<span class="ident" id="2580714">m</span><span class="op" id="2580715">.</span><span class="ident" id="2580716">munmap</span><span class="op" id="2580722">(</span><span class="builtintype" id="2580723">uintptr</span><span class="op" id="2580730">(</span><span class="ident" id="2580731">unsafe</span><span class="op" id="2580737">.</span><span class="ident" id="2580738">Pointer</span><span class="op" id="2580745">(</span><span class="op" id="2580746">&amp;</span><span class="ident" id="2580747">b</span><span class="op" id="2580748">[</span><span class="num" id="2580749">0</span><span class="op" id="2580750">]</span><span class="op" id="2580751">)</span><span class="op" id="2580752">)</span><span class="op" id="2580753">,</span>&nbsp;<span class="builtintype" id="2580755">uintptr</span><span class="op" id="2580762">(</span><span class="builtinfunc" id="2580763">len</span><span class="op" id="2580766">(</span><span class="ident" id="2580767">b</span><span class="op" id="2580768">)</span><span class="op" id="2580769">)</span><span class="op" id="2580770">)</span><span class="op" id="2580771">;</span>&nbsp;<span class="ident" id="2580773">errno</span>&nbsp;<span class="op" id="2580779">!=</span>&nbsp;<span class="builtintype" id="2580782">nil</span>&nbsp;<span class="op" id="2580786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580790">return</span>&nbsp;<span class="ident" id="2580797">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2580804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2580807">delete</span><span class="op" id="2580813">(</span><span class="ident" id="2580814">m</span><span class="op" id="2580815">.</span><span class="ident" id="2580816">active</span><span class="op" id="2580822">,</span>&nbsp;<span class="ident" id="2580824">p</span><span class="op" id="2580825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2580828">return</span>&nbsp;<span class="builtintype" id="2580835">nil</span><br>
<span class="lineno">90</span><span class="op" id="2580839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2580842">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2580907">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2580978">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2581045">//&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2581058">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2581077">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2581093">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="2581098">type</span>&nbsp;<span class="ident" id="2581103">Errno</span>&nbsp;<span class="builtintype" id="2581109">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2581118">func</span>&nbsp;<span class="op" id="2581123">(</span><span class="ident" id="2581124">e</span>&nbsp;<span class="ident" id="2581126">Errno</span><span class="op" id="2581131">)</span>&nbsp;<span class="ident" id="2581133">Error</span><span class="op" id="2581138">(</span><span class="op" id="2581139">)</span>&nbsp;<span class="builtintype" id="2581141">string</span>&nbsp;<span class="op" id="2581148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581151">if</span>&nbsp;<span class="num" id="2581154">0</span>&nbsp;<span class="op" id="2581156">&lt;=</span>&nbsp;<span class="builtintype" id="2581159">int</span><span class="op" id="2581162">(</span><span class="ident" id="2581163">e</span><span class="op" id="2581164">)</span>&nbsp;<span class="op" id="2581166">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2581169">int</span><span class="op" id="2581172">(</span><span class="ident" id="2581173">e</span><span class="op" id="2581174">)</span>&nbsp;<span class="op" id="2581176">&lt;</span>&nbsp;<span class="builtinfunc" id="2581178">len</span><span class="op" id="2581181">(</span><span class="ident" id="2581182">errors</span><span class="op" id="2581188">)</span>&nbsp;<span class="op" id="2581190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2581194">s</span>&nbsp;<span class="op" id="2581196">:=</span>&nbsp;<span class="ident" id="2581199">errors</span><span class="op" id="2581205">[</span><span class="ident" id="2581206">e</span><span class="op" id="2581207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581211">if</span>&nbsp;<span class="ident" id="2581214">s</span>&nbsp;<span class="op" id="2581216">!=</span>&nbsp;<span class="string" id="2581219">&#34;&#34;</span>&nbsp;<span class="op" id="2581222">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581227">return</span>&nbsp;<span class="ident" id="2581234">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2581238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2581241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581244">return</span>&nbsp;<span class="string" id="2581251">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2581260">+</span>&nbsp;<span class="ident" id="2581262">itoa</span><span class="op" id="2581266">(</span><span class="builtintype" id="2581267">int</span><span class="op" id="2581270">(</span><span class="ident" id="2581271">e</span><span class="op" id="2581272">)</span><span class="op" id="2581273">)</span><br>
<span class="lineno"></span><span class="op" id="2581275">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2581278">func</span>&nbsp;<span class="op" id="2581283">(</span><span class="ident" id="2581284">e</span>&nbsp;<span class="ident" id="2581286">Errno</span><span class="op" id="2581291">)</span>&nbsp;<span class="ident" id="2581293">Temporary</span><span class="op" id="2581302">(</span><span class="op" id="2581303">)</span>&nbsp;<span class="builtintype" id="2581305">bool</span>&nbsp;<span class="op" id="2581310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581313">return</span>&nbsp;<span class="ident" id="2581320">e</span>&nbsp;<span class="op" id="2581322">==</span>&nbsp;<span class="ident" id="2581325">EINTR</span>&nbsp;<span class="op" id="2581331">||</span>&nbsp;<span class="ident" id="2581334">e</span>&nbsp;<span class="op" id="2581336">==</span>&nbsp;<span class="ident" id="2581339">EMFILE</span>&nbsp;<span class="op" id="2581346">||</span>&nbsp;<span class="ident" id="2581349">e</span>&nbsp;<span class="op" id="2581351">==</span>&nbsp;<span class="ident" id="2581354">ECONNRESET</span>&nbsp;<span class="op" id="2581365">||</span>&nbsp;<span class="ident" id="2581368">e</span>&nbsp;<span class="op" id="2581370">==</span>&nbsp;<span class="ident" id="2581373">ECONNABORTED</span>&nbsp;<span class="op" id="2581386">||</span>&nbsp;<span class="ident" id="2581389">e</span><span class="op" id="2581390">.</span><span class="ident" id="2581391">Timeout</span><span class="op" id="2581398">(</span><span class="op" id="2581399">)</span><br>
<span class="lineno"></span><span class="op" id="2581401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2581404">func</span>&nbsp;<span class="op" id="2581409">(</span><span class="ident" id="2581410">e</span>&nbsp;<span class="ident" id="2581412">Errno</span><span class="op" id="2581417">)</span>&nbsp;<span class="ident" id="2581419">Timeout</span><span class="op" id="2581426">(</span><span class="op" id="2581427">)</span>&nbsp;<span class="builtintype" id="2581429">bool</span>&nbsp;<span class="op" id="2581434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581437">return</span>&nbsp;<span class="ident" id="2581444">e</span>&nbsp;<span class="op" id="2581446">==</span>&nbsp;<span class="ident" id="2581449">EAGAIN</span>&nbsp;<span class="op" id="2581456">||</span>&nbsp;<span class="ident" id="2581459">e</span>&nbsp;<span class="op" id="2581461">==</span>&nbsp;<span class="ident" id="2581464">EWOULDBLOCK</span>&nbsp;<span class="op" id="2581476">||</span>&nbsp;<span class="ident" id="2581479">e</span>&nbsp;<span class="op" id="2581481">==</span>&nbsp;<span class="ident" id="2581484">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2581494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2581497">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2581550">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2581592">type</span>&nbsp;<span class="ident" id="2581597">Signal</span>&nbsp;<span class="builtintype" id="2581604">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2581609">func</span>&nbsp;<span class="op" id="2581614">(</span><span class="ident" id="2581615">s</span>&nbsp;<span class="ident" id="2581617">Signal</span><span class="op" id="2581623">)</span>&nbsp;<span class="ident" id="2581625">Signal</span><span class="op" id="2581631">(</span><span class="op" id="2581632">)</span>&nbsp;<span class="op" id="2581634">{</span><span class="op" id="2581635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2581638">func</span>&nbsp;<span class="op" id="2581643">(</span><span class="ident" id="2581644">s</span>&nbsp;<span class="ident" id="2581646">Signal</span><span class="op" id="2581652">)</span>&nbsp;<span class="ident" id="2581654">String</span><span class="op" id="2581660">(</span><span class="op" id="2581661">)</span>&nbsp;<span class="builtintype" id="2581663">string</span>&nbsp;<span class="op" id="2581670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581673">if</span>&nbsp;<span class="num" id="2581676">0</span>&nbsp;<span class="op" id="2581678">&lt;=</span>&nbsp;<span class="ident" id="2581681">s</span>&nbsp;<span class="op" id="2581683">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2581686">int</span><span class="op" id="2581689">(</span><span class="ident" id="2581690">s</span><span class="op" id="2581691">)</span>&nbsp;<span class="op" id="2581693">&lt;</span>&nbsp;<span class="builtinfunc" id="2581695">len</span><span class="op" id="2581698">(</span><span class="ident" id="2581699">signals</span><span class="op" id="2581706">)</span>&nbsp;<span class="op" id="2581708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2581712">str</span>&nbsp;<span class="op" id="2581716">:=</span>&nbsp;<span class="ident" id="2581719">signals</span><span class="op" id="2581726">[</span><span class="ident" id="2581727">s</span><span class="op" id="2581728">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581732">if</span>&nbsp;<span class="ident" id="2581735">str</span>&nbsp;<span class="op" id="2581739">!=</span>&nbsp;<span class="string" id="2581742">&#34;&#34;</span>&nbsp;<span class="op" id="2581745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581750">return</span>&nbsp;<span class="ident" id="2581757">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2581763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2581766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581769">return</span>&nbsp;<span class="string" id="2581776">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2581786">+</span>&nbsp;<span class="ident" id="2581788">itoa</span><span class="op" id="2581792">(</span><span class="builtintype" id="2581793">int</span><span class="op" id="2581796">(</span><span class="ident" id="2581797">s</span><span class="op" id="2581798">)</span><span class="op" id="2581799">)</span><br>
<span class="lineno"></span><span class="op" id="2581801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2581804">func</span>&nbsp;<span class="ident" id="2581809">Read</span><span class="op" id="2581813">(</span><span class="ident" id="2581814">fd</span>&nbsp;<span class="builtintype" id="2581817">int</span><span class="op" id="2581820">,</span>&nbsp;<span class="ident" id="2581822">p</span>&nbsp;<span class="op" id="2581824">[</span><span class="op" id="2581825">]</span><span class="builtintype" id="2581826">byte</span><span class="op" id="2581830">)</span>&nbsp;<span class="op" id="2581832">(</span><span class="ident" id="2581833">n</span>&nbsp;<span class="builtintype" id="2581835">int</span><span class="op" id="2581838">,</span>&nbsp;<span class="ident" id="2581840">err</span>&nbsp;<span class="builtintype" id="2581844">error</span><span class="op" id="2581849">)</span>&nbsp;<span class="op" id="2581851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2581854">n</span><span class="op" id="2581855">,</span>&nbsp;<span class="ident" id="2581857">err</span>&nbsp;<span class="op" id="2581861">=</span>&nbsp;<span class="ident" id="2581863">read</span><span class="op" id="2581867">(</span><span class="ident" id="2581868">fd</span><span class="op" id="2581870">,</span>&nbsp;<span class="ident" id="2581872">p</span><span class="op" id="2581873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581876">if</span>&nbsp;<span class="ident" id="2581879">raceenabled</span>&nbsp;<span class="op" id="2581891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581895">if</span>&nbsp;<span class="ident" id="2581898">n</span>&nbsp;<span class="op" id="2581900">&gt;</span>&nbsp;<span class="num" id="2581902">0</span>&nbsp;<span class="op" id="2581904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2581909">raceWriteRange</span><span class="op" id="2581923">(</span><span class="ident" id="2581924">unsafe</span><span class="op" id="2581930">.</span><span class="ident" id="2581931">Pointer</span><span class="op" id="2581938">(</span><span class="op" id="2581939">&amp;</span><span class="ident" id="2581940">p</span><span class="op" id="2581941">[</span><span class="num" id="2581942">0</span><span class="op" id="2581943">]</span><span class="op" id="2581944">)</span><span class="op" id="2581945">,</span>&nbsp;<span class="ident" id="2581947">n</span><span class="op" id="2581948">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2581952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2581956">if</span>&nbsp;<span class="ident" id="2581959">err</span>&nbsp;<span class="op" id="2581963">==</span>&nbsp;<span class="builtintype" id="2581966">nil</span>&nbsp;<span class="op" id="2581970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2581975">raceAcquire</span><span class="op" id="2581986">(</span><span class="ident" id="2581987">unsafe</span><span class="op" id="2581993">.</span><span class="ident" id="2581994">Pointer</span><span class="op" id="2582001">(</span><span class="op" id="2582002">&amp;</span><span class="ident" id="2582003">ioSync</span><span class="op" id="2582009">)</span><span class="op" id="2582010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2582014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2582017">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582020">return</span><br>
<span class="lineno"></span><span class="op" id="2582027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582030">func</span>&nbsp;<span class="ident" id="2582035">Write</span><span class="op" id="2582040">(</span><span class="ident" id="2582041">fd</span>&nbsp;<span class="builtintype" id="2582044">int</span><span class="op" id="2582047">,</span>&nbsp;<span class="ident" id="2582049">p</span>&nbsp;<span class="op" id="2582051">[</span><span class="op" id="2582052">]</span><span class="builtintype" id="2582053">byte</span><span class="op" id="2582057">)</span>&nbsp;<span class="op" id="2582059">(</span><span class="ident" id="2582060">n</span>&nbsp;<span class="builtintype" id="2582062">int</span><span class="op" id="2582065">,</span>&nbsp;<span class="ident" id="2582067">err</span>&nbsp;<span class="builtintype" id="2582071">error</span><span class="op" id="2582076">)</span>&nbsp;<span class="op" id="2582078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582081">if</span>&nbsp;<span class="ident" id="2582084">raceenabled</span>&nbsp;<span class="op" id="2582096">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582100">raceReleaseMerge</span><span class="op" id="2582116">(</span><span class="ident" id="2582117">unsafe</span><span class="op" id="2582123">.</span><span class="ident" id="2582124">Pointer</span><span class="op" id="2582131">(</span><span class="op" id="2582132">&amp;</span><span class="ident" id="2582133">ioSync</span><span class="op" id="2582139">)</span><span class="op" id="2582140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2582143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582146">n</span><span class="op" id="2582147">,</span>&nbsp;<span class="ident" id="2582149">err</span>&nbsp;<span class="op" id="2582153">=</span>&nbsp;<span class="ident" id="2582155">write</span><span class="op" id="2582160">(</span><span class="ident" id="2582161">fd</span><span class="op" id="2582163">,</span>&nbsp;<span class="ident" id="2582165">p</span><span class="op" id="2582166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582169">if</span>&nbsp;<span class="ident" id="2582172">raceenabled</span>&nbsp;<span class="op" id="2582184">&amp;&amp;</span>&nbsp;<span class="ident" id="2582187">n</span>&nbsp;<span class="op" id="2582189">&gt;</span>&nbsp;<span class="num" id="2582191">0</span>&nbsp;<span class="op" id="2582193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582197">raceReadRange</span><span class="op" id="2582210">(</span><span class="ident" id="2582211">unsafe</span><span class="op" id="2582217">.</span><span class="ident" id="2582218">Pointer</span><span class="op" id="2582225">(</span><span class="op" id="2582226">&amp;</span><span class="ident" id="2582227">p</span><span class="op" id="2582228">[</span><span class="num" id="2582229">0</span><span class="op" id="2582230">]</span><span class="op" id="2582231">)</span><span class="op" id="2582232">,</span>&nbsp;<span class="ident" id="2582234">n</span><span class="op" id="2582235">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2582238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582241">return</span><br>
<span class="lineno"></span><span class="op" id="2582248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2582251">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2582302">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2582354">var</span>&nbsp;<span class="ident" id="2582358">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2582376">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582382">type</span>&nbsp;<span class="ident" id="2582387">Sockaddr</span>&nbsp;<span class="keyword" id="2582396">interface</span>&nbsp;<span class="op" id="2582406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582409">sockaddr</span><span class="op" id="2582417">(</span><span class="op" id="2582418">)</span>&nbsp;<span class="op" id="2582420">(</span><span class="ident" id="2582421">ptr</span>&nbsp;<span class="ident" id="2582425">unsafe</span><span class="op" id="2582431">.</span><span class="ident" id="2582432">Pointer</span><span class="op" id="2582439">,</span>&nbsp;<span class="builtinfunc" id="2582441">len</span>&nbsp;<span class="ident" id="2582445">_Socklen</span><span class="op" id="2582453">,</span>&nbsp;<span class="ident" id="2582455">err</span>&nbsp;<span class="builtintype" id="2582459">error</span><span class="op" id="2582464">)</span>&nbsp;<span class="comment" id="2582466">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2582509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582512">type</span>&nbsp;<span class="ident" id="2582517">SockaddrInet4</span>&nbsp;<span class="keyword" id="2582531">struct</span>&nbsp;<span class="op" id="2582538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582541">Port</span>&nbsp;<span class="builtintype" id="2582546">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582551">Addr</span>&nbsp;<span class="op" id="2582556">[</span><span class="num" id="2582557">4</span><span class="op" id="2582558">]</span><span class="builtintype" id="2582559">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582565">raw</span>&nbsp;&nbsp;<span class="ident" id="2582570">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2582587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582590">type</span>&nbsp;<span class="ident" id="2582595">SockaddrInet6</span>&nbsp;<span class="keyword" id="2582609">struct</span>&nbsp;<span class="op" id="2582616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582619">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2582626">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582631">ZoneId</span>&nbsp;<span class="builtintype" id="2582638">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582646">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2582653">[</span><span class="num" id="2582654">16</span><span class="op" id="2582656">]</span><span class="builtintype" id="2582657">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582663">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582670">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2582687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2582690">type</span>&nbsp;<span class="ident" id="2582695">SockaddrUnix</span>&nbsp;<span class="keyword" id="2582708">struct</span>&nbsp;<span class="op" id="2582715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582718">Name</span>&nbsp;<span class="builtintype" id="2582723">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582731">raw</span>&nbsp;&nbsp;<span class="ident" id="2582736">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2582752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2582755">func</span>&nbsp;<span class="ident" id="2582760">Bind</span><span class="op" id="2582764">(</span><span class="ident" id="2582765">fd</span>&nbsp;<span class="builtintype" id="2582768">int</span><span class="op" id="2582771">,</span>&nbsp;<span class="ident" id="2582773">sa</span>&nbsp;<span class="ident" id="2582776">Sockaddr</span><span class="op" id="2582784">)</span>&nbsp;<span class="op" id="2582786">(</span><span class="ident" id="2582787">err</span>&nbsp;<span class="builtintype" id="2582791">error</span><span class="op" id="2582796">)</span>&nbsp;<span class="op" id="2582798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582801">ptr</span><span class="op" id="2582804">,</span>&nbsp;<span class="ident" id="2582806">n</span><span class="op" id="2582807">,</span>&nbsp;<span class="ident" id="2582809">err</span>&nbsp;<span class="op" id="2582813">:=</span>&nbsp;<span class="ident" id="2582816">sa</span><span class="op" id="2582818">.</span><span class="ident" id="2582819">sockaddr</span><span class="op" id="2582827">(</span><span class="op" id="2582828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582831">if</span>&nbsp;<span class="ident" id="2582834">err</span>&nbsp;<span class="op" id="2582838">!=</span>&nbsp;<span class="builtintype" id="2582841">nil</span>&nbsp;<span class="op" id="2582845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582849">return</span>&nbsp;<span class="ident" id="2582856">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2582861">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582864">return</span>&nbsp;<span class="ident" id="2582871">bind</span><span class="op" id="2582875">(</span><span class="ident" id="2582876">fd</span><span class="op" id="2582878">,</span>&nbsp;<span class="ident" id="2582880">ptr</span><span class="op" id="2582883">,</span>&nbsp;<span class="ident" id="2582885">n</span><span class="op" id="2582886">)</span><br>
<span class="lineno"></span><span class="op" id="2582888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2582891">func</span>&nbsp;<span class="ident" id="2582896">Connect</span><span class="op" id="2582903">(</span><span class="ident" id="2582904">fd</span>&nbsp;<span class="builtintype" id="2582907">int</span><span class="op" id="2582910">,</span>&nbsp;<span class="ident" id="2582912">sa</span>&nbsp;<span class="ident" id="2582915">Sockaddr</span><span class="op" id="2582923">)</span>&nbsp;<span class="op" id="2582925">(</span><span class="ident" id="2582926">err</span>&nbsp;<span class="builtintype" id="2582930">error</span><span class="op" id="2582935">)</span>&nbsp;<span class="op" id="2582937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2582940">ptr</span><span class="op" id="2582943">,</span>&nbsp;<span class="ident" id="2582945">n</span><span class="op" id="2582946">,</span>&nbsp;<span class="ident" id="2582948">err</span>&nbsp;<span class="op" id="2582952">:=</span>&nbsp;<span class="ident" id="2582955">sa</span><span class="op" id="2582957">.</span><span class="ident" id="2582958">sockaddr</span><span class="op" id="2582966">(</span><span class="op" id="2582967">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582970">if</span>&nbsp;<span class="ident" id="2582973">err</span>&nbsp;<span class="op" id="2582977">!=</span>&nbsp;<span class="builtintype" id="2582980">nil</span>&nbsp;<span class="op" id="2582984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2582988">return</span>&nbsp;<span class="ident" id="2582995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2583000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583003">return</span>&nbsp;<span class="ident" id="2583010">connect</span><span class="op" id="2583017">(</span><span class="ident" id="2583018">fd</span><span class="op" id="2583020">,</span>&nbsp;<span class="ident" id="2583022">ptr</span><span class="op" id="2583025">,</span>&nbsp;<span class="ident" id="2583027">n</span><span class="op" id="2583028">)</span><br>
<span class="lineno"></span><span class="op" id="2583030">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2583033">func</span>&nbsp;<span class="ident" id="2583038">Getpeername</span><span class="op" id="2583049">(</span><span class="ident" id="2583050">fd</span>&nbsp;<span class="builtintype" id="2583053">int</span><span class="op" id="2583056">)</span>&nbsp;<span class="op" id="2583058">(</span><span class="ident" id="2583059">sa</span>&nbsp;<span class="ident" id="2583062">Sockaddr</span><span class="op" id="2583070">,</span>&nbsp;<span class="ident" id="2583072">err</span>&nbsp;<span class="builtintype" id="2583076">error</span><span class="op" id="2583081">)</span>&nbsp;<span class="op" id="2583083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583086">var</span>&nbsp;<span class="ident" id="2583090">rsa</span>&nbsp;<span class="ident" id="2583094">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583110">var</span>&nbsp;<span class="builtinfunc" id="2583114">len</span>&nbsp;<span class="ident" id="2583118">_Socklen</span>&nbsp;<span class="op" id="2583127">=</span>&nbsp;<span class="ident" id="2583129">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583148">if</span>&nbsp;<span class="ident" id="2583151">err</span>&nbsp;<span class="op" id="2583155">=</span>&nbsp;<span class="ident" id="2583157">getpeername</span><span class="op" id="2583168">(</span><span class="ident" id="2583169">fd</span><span class="op" id="2583171">,</span>&nbsp;<span class="op" id="2583173">&amp;</span><span class="ident" id="2583174">rsa</span><span class="op" id="2583177">,</span>&nbsp;<span class="op" id="2583179">&amp;</span><span class="builtinfunc" id="2583180">len</span><span class="op" id="2583183">)</span><span class="op" id="2583184">;</span>&nbsp;<span class="ident" id="2583186">err</span>&nbsp;<span class="op" id="2583190">!=</span>&nbsp;<span class="builtintype" id="2583193">nil</span>&nbsp;<span class="op" id="2583197">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583201">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2583209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583212">return</span>&nbsp;<span class="ident" id="2583219">anyToSockaddr</span><span class="op" id="2583232">(</span><span class="op" id="2583233">&amp;</span><span class="ident" id="2583234">rsa</span><span class="op" id="2583237">)</span><br>
<span class="lineno"></span><span class="op" id="2583239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2583242">func</span>&nbsp;<span class="ident" id="2583247">GetsockoptInt</span><span class="op" id="2583260">(</span><span class="ident" id="2583261">fd</span><span class="op" id="2583263">,</span>&nbsp;<span class="ident" id="2583265">level</span><span class="op" id="2583270">,</span>&nbsp;<span class="ident" id="2583272">opt</span>&nbsp;<span class="builtintype" id="2583276">int</span><span class="op" id="2583279">)</span>&nbsp;<span class="op" id="2583281">(</span><span class="ident" id="2583282">value</span>&nbsp;<span class="builtintype" id="2583288">int</span><span class="op" id="2583291">,</span>&nbsp;<span class="ident" id="2583293">err</span>&nbsp;<span class="builtintype" id="2583297">error</span><span class="op" id="2583302">)</span>&nbsp;<span class="op" id="2583304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583307">var</span>&nbsp;<span class="ident" id="2583311">n</span>&nbsp;<span class="builtintype" id="2583313">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2583320">vallen</span>&nbsp;<span class="op" id="2583327">:=</span>&nbsp;<span class="ident" id="2583330">_Socklen</span><span class="op" id="2583338">(</span><span class="num" id="2583339">4</span><span class="op" id="2583340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2583343">err</span>&nbsp;<span class="op" id="2583347">=</span>&nbsp;<span class="ident" id="2583349">getsockopt</span><span class="op" id="2583359">(</span><span class="ident" id="2583360">fd</span><span class="op" id="2583362">,</span>&nbsp;<span class="ident" id="2583364">level</span><span class="op" id="2583369">,</span>&nbsp;<span class="ident" id="2583371">opt</span><span class="op" id="2583374">,</span>&nbsp;<span class="ident" id="2583376">unsafe</span><span class="op" id="2583382">.</span><span class="ident" id="2583383">Pointer</span><span class="op" id="2583390">(</span><span class="op" id="2583391">&amp;</span><span class="ident" id="2583392">n</span><span class="op" id="2583393">)</span><span class="op" id="2583394">,</span>&nbsp;<span class="op" id="2583396">&amp;</span><span class="ident" id="2583397">vallen</span><span class="op" id="2583403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583406">return</span>&nbsp;<span class="builtintype" id="2583413">int</span><span class="op" id="2583416">(</span><span class="ident" id="2583417">n</span><span class="op" id="2583418">)</span><span class="op" id="2583419">,</span>&nbsp;<span class="ident" id="2583421">err</span><br>
<span class="lineno">215</span><span class="op" id="2583425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2583428">func</span>&nbsp;<span class="ident" id="2583433">Recvfrom</span><span class="op" id="2583441">(</span><span class="ident" id="2583442">fd</span>&nbsp;<span class="builtintype" id="2583445">int</span><span class="op" id="2583448">,</span>&nbsp;<span class="ident" id="2583450">p</span>&nbsp;<span class="op" id="2583452">[</span><span class="op" id="2583453">]</span><span class="builtintype" id="2583454">byte</span><span class="op" id="2583458">,</span>&nbsp;<span class="ident" id="2583460">flags</span>&nbsp;<span class="builtintype" id="2583466">int</span><span class="op" id="2583469">)</span>&nbsp;<span class="op" id="2583471">(</span><span class="ident" id="2583472">n</span>&nbsp;<span class="builtintype" id="2583474">int</span><span class="op" id="2583477">,</span>&nbsp;<span class="ident" id="2583479">from</span>&nbsp;<span class="ident" id="2583484">Sockaddr</span><span class="op" id="2583492">,</span>&nbsp;<span class="ident" id="2583494">err</span>&nbsp;<span class="builtintype" id="2583498">error</span><span class="op" id="2583503">)</span>&nbsp;<span class="op" id="2583505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583508">var</span>&nbsp;<span class="ident" id="2583512">rsa</span>&nbsp;<span class="ident" id="2583516">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583532">var</span>&nbsp;<span class="builtinfunc" id="2583536">len</span>&nbsp;<span class="ident" id="2583540">_Socklen</span>&nbsp;<span class="op" id="2583549">=</span>&nbsp;<span class="ident" id="2583551">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583570">if</span>&nbsp;<span class="ident" id="2583573">n</span><span class="op" id="2583574">,</span>&nbsp;<span class="ident" id="2583576">err</span>&nbsp;<span class="op" id="2583580">=</span>&nbsp;<span class="ident" id="2583582">recvfrom</span><span class="op" id="2583590">(</span><span class="ident" id="2583591">fd</span><span class="op" id="2583593">,</span>&nbsp;<span class="ident" id="2583595">p</span><span class="op" id="2583596">,</span>&nbsp;<span class="ident" id="2583598">flags</span><span class="op" id="2583603">,</span>&nbsp;<span class="op" id="2583605">&amp;</span><span class="ident" id="2583606">rsa</span><span class="op" id="2583609">,</span>&nbsp;<span class="op" id="2583611">&amp;</span><span class="builtinfunc" id="2583612">len</span><span class="op" id="2583615">)</span><span class="op" id="2583616">;</span>&nbsp;<span class="ident" id="2583618">err</span>&nbsp;<span class="op" id="2583622">!=</span>&nbsp;<span class="builtintype" id="2583625">nil</span>&nbsp;<span class="op" id="2583629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583633">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2583641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583644">if</span>&nbsp;<span class="ident" id="2583647">rsa</span><span class="op" id="2583650">.</span><span class="ident" id="2583651">Addr</span><span class="op" id="2583655">.</span><span class="ident" id="2583656">Family</span>&nbsp;<span class="op" id="2583663">!=</span>&nbsp;<span class="ident" id="2583666">AF_UNSPEC</span>&nbsp;<span class="op" id="2583676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2583680">from</span><span class="op" id="2583684">,</span>&nbsp;<span class="ident" id="2583686">err</span>&nbsp;<span class="op" id="2583690">=</span>&nbsp;<span class="ident" id="2583692">anyToSockaddr</span><span class="op" id="2583705">(</span><span class="op" id="2583706">&amp;</span><span class="ident" id="2583707">rsa</span><span class="op" id="2583710">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2583713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583716">return</span><br>
<span class="lineno"></span><span class="op" id="2583723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2583726">func</span>&nbsp;<span class="ident" id="2583731">Sendto</span><span class="op" id="2583737">(</span><span class="ident" id="2583738">fd</span>&nbsp;<span class="builtintype" id="2583741">int</span><span class="op" id="2583744">,</span>&nbsp;<span class="ident" id="2583746">p</span>&nbsp;<span class="op" id="2583748">[</span><span class="op" id="2583749">]</span><span class="builtintype" id="2583750">byte</span><span class="op" id="2583754">,</span>&nbsp;<span class="ident" id="2583756">flags</span>&nbsp;<span class="builtintype" id="2583762">int</span><span class="op" id="2583765">,</span>&nbsp;<span class="ident" id="2583767">to</span>&nbsp;<span class="ident" id="2583770">Sockaddr</span><span class="op" id="2583778">)</span>&nbsp;<span class="op" id="2583780">(</span><span class="ident" id="2583781">err</span>&nbsp;<span class="builtintype" id="2583785">error</span><span class="op" id="2583790">)</span>&nbsp;<span class="op" id="2583792">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2583795">ptr</span><span class="op" id="2583798">,</span>&nbsp;<span class="ident" id="2583800">n</span><span class="op" id="2583801">,</span>&nbsp;<span class="ident" id="2583803">err</span>&nbsp;<span class="op" id="2583807">:=</span>&nbsp;<span class="ident" id="2583810">to</span><span class="op" id="2583812">.</span><span class="ident" id="2583813">sockaddr</span><span class="op" id="2583821">(</span><span class="op" id="2583822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583825">if</span>&nbsp;<span class="ident" id="2583828">err</span>&nbsp;<span class="op" id="2583832">!=</span>&nbsp;<span class="builtintype" id="2583835">nil</span>&nbsp;<span class="op" id="2583839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583843">return</span>&nbsp;<span class="ident" id="2583850">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2583855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583858">return</span>&nbsp;<span class="ident" id="2583865">sendto</span><span class="op" id="2583871">(</span><span class="ident" id="2583872">fd</span><span class="op" id="2583874">,</span>&nbsp;<span class="ident" id="2583876">p</span><span class="op" id="2583877">,</span>&nbsp;<span class="ident" id="2583879">flags</span><span class="op" id="2583884">,</span>&nbsp;<span class="ident" id="2583886">ptr</span><span class="op" id="2583889">,</span>&nbsp;<span class="ident" id="2583891">n</span><span class="op" id="2583892">)</span><br>
<span class="lineno">235</span><span class="op" id="2583894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2583897">func</span>&nbsp;<span class="ident" id="2583902">SetsockoptByte</span><span class="op" id="2583916">(</span><span class="ident" id="2583917">fd</span><span class="op" id="2583919">,</span>&nbsp;<span class="ident" id="2583921">level</span><span class="op" id="2583926">,</span>&nbsp;<span class="ident" id="2583928">opt</span>&nbsp;<span class="builtintype" id="2583932">int</span><span class="op" id="2583935">,</span>&nbsp;<span class="ident" id="2583937">value</span>&nbsp;<span class="builtintype" id="2583943">byte</span><span class="op" id="2583947">)</span>&nbsp;<span class="op" id="2583949">(</span><span class="ident" id="2583950">err</span>&nbsp;<span class="builtintype" id="2583954">error</span><span class="op" id="2583959">)</span>&nbsp;<span class="op" id="2583961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2583964">return</span>&nbsp;<span class="ident" id="2583971">setsockopt</span><span class="op" id="2583981">(</span><span class="ident" id="2583982">fd</span><span class="op" id="2583984">,</span>&nbsp;<span class="ident" id="2583986">level</span><span class="op" id="2583991">,</span>&nbsp;<span class="ident" id="2583993">opt</span><span class="op" id="2583996">,</span>&nbsp;<span class="ident" id="2583998">unsafe</span><span class="op" id="2584004">.</span><span class="ident" id="2584005">Pointer</span><span class="op" id="2584012">(</span><span class="op" id="2584013">&amp;</span><span class="ident" id="2584014">value</span><span class="op" id="2584019">)</span><span class="op" id="2584020">,</span>&nbsp;<span class="num" id="2584022">1</span><span class="op" id="2584023">)</span><br>
<span class="lineno"></span><span class="op" id="2584025">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2584028">func</span>&nbsp;<span class="ident" id="2584033">SetsockoptInt</span><span class="op" id="2584046">(</span><span class="ident" id="2584047">fd</span><span class="op" id="2584049">,</span>&nbsp;<span class="ident" id="2584051">level</span><span class="op" id="2584056">,</span>&nbsp;<span class="ident" id="2584058">opt</span>&nbsp;<span class="builtintype" id="2584062">int</span><span class="op" id="2584065">,</span>&nbsp;<span class="ident" id="2584067">value</span>&nbsp;<span class="builtintype" id="2584073">int</span><span class="op" id="2584076">)</span>&nbsp;<span class="op" id="2584078">(</span><span class="ident" id="2584079">err</span>&nbsp;<span class="builtintype" id="2584083">error</span><span class="op" id="2584088">)</span>&nbsp;<span class="op" id="2584090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584093">var</span>&nbsp;<span class="ident" id="2584097">n</span>&nbsp;<span class="op" id="2584099">=</span>&nbsp;<span class="builtintype" id="2584101">int32</span><span class="op" id="2584106">(</span><span class="ident" id="2584107">value</span><span class="op" id="2584112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584115">return</span>&nbsp;<span class="ident" id="2584122">setsockopt</span><span class="op" id="2584132">(</span><span class="ident" id="2584133">fd</span><span class="op" id="2584135">,</span>&nbsp;<span class="ident" id="2584137">level</span><span class="op" id="2584142">,</span>&nbsp;<span class="ident" id="2584144">opt</span><span class="op" id="2584147">,</span>&nbsp;<span class="ident" id="2584149">unsafe</span><span class="op" id="2584155">.</span><span class="ident" id="2584156">Pointer</span><span class="op" id="2584163">(</span><span class="op" id="2584164">&amp;</span><span class="ident" id="2584165">n</span><span class="op" id="2584166">)</span><span class="op" id="2584167">,</span>&nbsp;<span class="num" id="2584169">4</span><span class="op" id="2584170">)</span><br>
<span class="lineno"></span><span class="op" id="2584172">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2584175">func</span>&nbsp;<span class="ident" id="2584180">SetsockoptInet4Addr</span><span class="op" id="2584199">(</span><span class="ident" id="2584200">fd</span><span class="op" id="2584202">,</span>&nbsp;<span class="ident" id="2584204">level</span><span class="op" id="2584209">,</span>&nbsp;<span class="ident" id="2584211">opt</span>&nbsp;<span class="builtintype" id="2584215">int</span><span class="op" id="2584218">,</span>&nbsp;<span class="ident" id="2584220">value</span>&nbsp;<span class="op" id="2584226">[</span><span class="num" id="2584227">4</span><span class="op" id="2584228">]</span><span class="builtintype" id="2584229">byte</span><span class="op" id="2584233">)</span>&nbsp;<span class="op" id="2584235">(</span><span class="ident" id="2584236">err</span>&nbsp;<span class="builtintype" id="2584240">error</span><span class="op" id="2584245">)</span>&nbsp;<span class="op" id="2584247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584250">return</span>&nbsp;<span class="ident" id="2584257">setsockopt</span><span class="op" id="2584267">(</span><span class="ident" id="2584268">fd</span><span class="op" id="2584270">,</span>&nbsp;<span class="ident" id="2584272">level</span><span class="op" id="2584277">,</span>&nbsp;<span class="ident" id="2584279">opt</span><span class="op" id="2584282">,</span>&nbsp;<span class="ident" id="2584284">unsafe</span><span class="op" id="2584290">.</span><span class="ident" id="2584291">Pointer</span><span class="op" id="2584298">(</span><span class="op" id="2584299">&amp;</span><span class="ident" id="2584300">value</span><span class="op" id="2584305">[</span><span class="num" id="2584306">0</span><span class="op" id="2584307">]</span><span class="op" id="2584308">)</span><span class="op" id="2584309">,</span>&nbsp;<span class="num" id="2584311">4</span><span class="op" id="2584312">)</span><br>
<span class="lineno"></span><span class="op" id="2584314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2584317">func</span>&nbsp;<span class="ident" id="2584322">SetsockoptIPMreq</span><span class="op" id="2584338">(</span><span class="ident" id="2584339">fd</span><span class="op" id="2584341">,</span>&nbsp;<span class="ident" id="2584343">level</span><span class="op" id="2584348">,</span>&nbsp;<span class="ident" id="2584350">opt</span>&nbsp;<span class="builtintype" id="2584354">int</span><span class="op" id="2584357">,</span>&nbsp;<span class="ident" id="2584359">mreq</span>&nbsp;<span class="op" id="2584364">*</span><span class="ident" id="2584365">IPMreq</span><span class="op" id="2584371">)</span>&nbsp;<span class="op" id="2584373">(</span><span class="ident" id="2584374">err</span>&nbsp;<span class="builtintype" id="2584378">error</span><span class="op" id="2584383">)</span>&nbsp;<span class="op" id="2584385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584388">return</span>&nbsp;<span class="ident" id="2584395">setsockopt</span><span class="op" id="2584405">(</span><span class="ident" id="2584406">fd</span><span class="op" id="2584408">,</span>&nbsp;<span class="ident" id="2584410">level</span><span class="op" id="2584415">,</span>&nbsp;<span class="ident" id="2584417">opt</span><span class="op" id="2584420">,</span>&nbsp;<span class="ident" id="2584422">unsafe</span><span class="op" id="2584428">.</span><span class="ident" id="2584429">Pointer</span><span class="op" id="2584436">(</span><span class="ident" id="2584437">mreq</span><span class="op" id="2584441">)</span><span class="op" id="2584442">,</span>&nbsp;<span class="ident" id="2584444">SizeofIPMreq</span><span class="op" id="2584456">)</span><br>
<span class="lineno"></span><span class="op" id="2584458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2584461">func</span>&nbsp;<span class="ident" id="2584466">SetsockoptIPv6Mreq</span><span class="op" id="2584484">(</span><span class="ident" id="2584485">fd</span><span class="op" id="2584487">,</span>&nbsp;<span class="ident" id="2584489">level</span><span class="op" id="2584494">,</span>&nbsp;<span class="ident" id="2584496">opt</span>&nbsp;<span class="builtintype" id="2584500">int</span><span class="op" id="2584503">,</span>&nbsp;<span class="ident" id="2584505">mreq</span>&nbsp;<span class="op" id="2584510">*</span><span class="ident" id="2584511">IPv6Mreq</span><span class="op" id="2584519">)</span>&nbsp;<span class="op" id="2584521">(</span><span class="ident" id="2584522">err</span>&nbsp;<span class="builtintype" id="2584526">error</span><span class="op" id="2584531">)</span>&nbsp;<span class="op" id="2584533">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584536">return</span>&nbsp;<span class="ident" id="2584543">setsockopt</span><span class="op" id="2584553">(</span><span class="ident" id="2584554">fd</span><span class="op" id="2584556">,</span>&nbsp;<span class="ident" id="2584558">level</span><span class="op" id="2584563">,</span>&nbsp;<span class="ident" id="2584565">opt</span><span class="op" id="2584568">,</span>&nbsp;<span class="ident" id="2584570">unsafe</span><span class="op" id="2584576">.</span><span class="ident" id="2584577">Pointer</span><span class="op" id="2584584">(</span><span class="ident" id="2584585">mreq</span><span class="op" id="2584589">)</span><span class="op" id="2584590">,</span>&nbsp;<span class="ident" id="2584592">SizeofIPv6Mreq</span><span class="op" id="2584606">)</span><br>
<span class="lineno"></span><span class="op" id="2584608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2584611">func</span>&nbsp;<span class="ident" id="2584616">SetsockoptICMPv6Filter</span><span class="op" id="2584638">(</span><span class="ident" id="2584639">fd</span><span class="op" id="2584641">,</span>&nbsp;<span class="ident" id="2584643">level</span><span class="op" id="2584648">,</span>&nbsp;<span class="ident" id="2584650">opt</span>&nbsp;<span class="builtintype" id="2584654">int</span><span class="op" id="2584657">,</span>&nbsp;<span class="ident" id="2584659">filter</span>&nbsp;<span class="op" id="2584666">*</span><span class="ident" id="2584667">ICMPv6Filter</span><span class="op" id="2584679">)</span>&nbsp;<span class="builtintype" id="2584681">error</span>&nbsp;<span class="op" id="2584687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584690">return</span>&nbsp;<span class="ident" id="2584697">setsockopt</span><span class="op" id="2584707">(</span><span class="ident" id="2584708">fd</span><span class="op" id="2584710">,</span>&nbsp;<span class="ident" id="2584712">level</span><span class="op" id="2584717">,</span>&nbsp;<span class="ident" id="2584719">opt</span><span class="op" id="2584722">,</span>&nbsp;<span class="ident" id="2584724">unsafe</span><span class="op" id="2584730">.</span><span class="ident" id="2584731">Pointer</span><span class="op" id="2584738">(</span><span class="ident" id="2584739">filter</span><span class="op" id="2584745">)</span><span class="op" id="2584746">,</span>&nbsp;<span class="ident" id="2584748">SizeofICMPv6Filter</span><span class="op" id="2584766">)</span><br>
<span class="lineno">260</span><span class="op" id="2584768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2584771">func</span>&nbsp;<span class="ident" id="2584776">SetsockoptLinger</span><span class="op" id="2584792">(</span><span class="ident" id="2584793">fd</span><span class="op" id="2584795">,</span>&nbsp;<span class="ident" id="2584797">level</span><span class="op" id="2584802">,</span>&nbsp;<span class="ident" id="2584804">opt</span>&nbsp;<span class="builtintype" id="2584808">int</span><span class="op" id="2584811">,</span>&nbsp;<span class="ident" id="2584813">l</span>&nbsp;<span class="op" id="2584815">*</span><span class="ident" id="2584816">Linger</span><span class="op" id="2584822">)</span>&nbsp;<span class="op" id="2584824">(</span><span class="ident" id="2584825">err</span>&nbsp;<span class="builtintype" id="2584829">error</span><span class="op" id="2584834">)</span>&nbsp;<span class="op" id="2584836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584839">return</span>&nbsp;<span class="ident" id="2584846">setsockopt</span><span class="op" id="2584856">(</span><span class="ident" id="2584857">fd</span><span class="op" id="2584859">,</span>&nbsp;<span class="ident" id="2584861">level</span><span class="op" id="2584866">,</span>&nbsp;<span class="ident" id="2584868">opt</span><span class="op" id="2584871">,</span>&nbsp;<span class="ident" id="2584873">unsafe</span><span class="op" id="2584879">.</span><span class="ident" id="2584880">Pointer</span><span class="op" id="2584887">(</span><span class="ident" id="2584888">l</span><span class="op" id="2584889">)</span><span class="op" id="2584890">,</span>&nbsp;<span class="ident" id="2584892">SizeofLinger</span><span class="op" id="2584904">)</span><br>
<span class="lineno"></span><span class="op" id="2584906">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2584909">func</span>&nbsp;<span class="ident" id="2584914">SetsockoptString</span><span class="op" id="2584930">(</span><span class="ident" id="2584931">fd</span><span class="op" id="2584933">,</span>&nbsp;<span class="ident" id="2584935">level</span><span class="op" id="2584940">,</span>&nbsp;<span class="ident" id="2584942">opt</span>&nbsp;<span class="builtintype" id="2584946">int</span><span class="op" id="2584949">,</span>&nbsp;<span class="ident" id="2584951">s</span>&nbsp;<span class="builtintype" id="2584953">string</span><span class="op" id="2584959">)</span>&nbsp;<span class="op" id="2584961">(</span><span class="ident" id="2584962">err</span>&nbsp;<span class="builtintype" id="2584966">error</span><span class="op" id="2584971">)</span>&nbsp;<span class="op" id="2584973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2584976">return</span>&nbsp;<span class="ident" id="2584983">setsockopt</span><span class="op" id="2584993">(</span><span class="ident" id="2584994">fd</span><span class="op" id="2584996">,</span>&nbsp;<span class="ident" id="2584998">level</span><span class="op" id="2585003">,</span>&nbsp;<span class="ident" id="2585005">opt</span><span class="op" id="2585008">,</span>&nbsp;<span class="ident" id="2585010">unsafe</span><span class="op" id="2585016">.</span><span class="ident" id="2585017">Pointer</span><span class="op" id="2585024">(</span><span class="op" id="2585025">&amp;</span><span class="op" id="2585026">[</span><span class="op" id="2585027">]</span><span class="builtintype" id="2585028">byte</span><span class="op" id="2585032">(</span><span class="ident" id="2585033">s</span><span class="op" id="2585034">)</span><span class="op" id="2585035">[</span><span class="num" id="2585036">0</span><span class="op" id="2585037">]</span><span class="op" id="2585038">)</span><span class="op" id="2585039">,</span>&nbsp;<span class="builtintype" id="2585041">uintptr</span><span class="op" id="2585048">(</span><span class="builtinfunc" id="2585049">len</span><span class="op" id="2585052">(</span><span class="ident" id="2585053">s</span><span class="op" id="2585054">)</span><span class="op" id="2585055">)</span><span class="op" id="2585056">)</span><br>
<span class="lineno"></span><span class="op" id="2585058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2585061">func</span>&nbsp;<span class="ident" id="2585066">SetsockoptTimeval</span><span class="op" id="2585083">(</span><span class="ident" id="2585084">fd</span><span class="op" id="2585086">,</span>&nbsp;<span class="ident" id="2585088">level</span><span class="op" id="2585093">,</span>&nbsp;<span class="ident" id="2585095">opt</span>&nbsp;<span class="builtintype" id="2585099">int</span><span class="op" id="2585102">,</span>&nbsp;<span class="ident" id="2585104">tv</span>&nbsp;<span class="op" id="2585107">*</span><span class="ident" id="2585108">Timeval</span><span class="op" id="2585115">)</span>&nbsp;<span class="op" id="2585117">(</span><span class="ident" id="2585118">err</span>&nbsp;<span class="builtintype" id="2585122">error</span><span class="op" id="2585127">)</span>&nbsp;<span class="op" id="2585129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585132">return</span>&nbsp;<span class="ident" id="2585139">setsockopt</span><span class="op" id="2585149">(</span><span class="ident" id="2585150">fd</span><span class="op" id="2585152">,</span>&nbsp;<span class="ident" id="2585154">level</span><span class="op" id="2585159">,</span>&nbsp;<span class="ident" id="2585161">opt</span><span class="op" id="2585164">,</span>&nbsp;<span class="ident" id="2585166">unsafe</span><span class="op" id="2585172">.</span><span class="ident" id="2585173">Pointer</span><span class="op" id="2585180">(</span><span class="ident" id="2585181">tv</span><span class="op" id="2585183">)</span><span class="op" id="2585184">,</span>&nbsp;<span class="ident" id="2585186">unsafe</span><span class="op" id="2585192">.</span><span class="ident" id="2585193">Sizeof</span><span class="op" id="2585199">(</span><span class="op" id="2585200">*</span><span class="ident" id="2585201">tv</span><span class="op" id="2585203">)</span><span class="op" id="2585204">)</span><br>
<span class="lineno"></span><span class="op" id="2585206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2585209">func</span>&nbsp;<span class="ident" id="2585214">Socket</span><span class="op" id="2585220">(</span><span class="ident" id="2585221">domain</span><span class="op" id="2585227">,</span>&nbsp;<span class="ident" id="2585229">typ</span><span class="op" id="2585232">,</span>&nbsp;<span class="ident" id="2585234">proto</span>&nbsp;<span class="builtintype" id="2585240">int</span><span class="op" id="2585243">)</span>&nbsp;<span class="op" id="2585245">(</span><span class="ident" id="2585246">fd</span>&nbsp;<span class="builtintype" id="2585249">int</span><span class="op" id="2585252">,</span>&nbsp;<span class="ident" id="2585254">err</span>&nbsp;<span class="builtintype" id="2585258">error</span><span class="op" id="2585263">)</span>&nbsp;<span class="op" id="2585265">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585268">if</span>&nbsp;<span class="ident" id="2585271">domain</span>&nbsp;<span class="op" id="2585278">==</span>&nbsp;<span class="ident" id="2585281">AF_INET6</span>&nbsp;<span class="op" id="2585290">&amp;&amp;</span>&nbsp;<span class="ident" id="2585293">SocketDisableIPv6</span>&nbsp;<span class="op" id="2585311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585315">return</span>&nbsp;<span class="op" id="2585322">-</span><span class="num" id="2585323">1</span><span class="op" id="2585324">,</span>&nbsp;<span class="ident" id="2585326">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2585340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2585343">fd</span><span class="op" id="2585345">,</span>&nbsp;<span class="ident" id="2585347">err</span>&nbsp;<span class="op" id="2585351">=</span>&nbsp;<span class="ident" id="2585353">socket</span><span class="op" id="2585359">(</span><span class="ident" id="2585360">domain</span><span class="op" id="2585366">,</span>&nbsp;<span class="ident" id="2585368">typ</span><span class="op" id="2585371">,</span>&nbsp;<span class="ident" id="2585373">proto</span><span class="op" id="2585378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585381">return</span><br>
<span class="lineno">280</span><span class="op" id="2585388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2585391">func</span>&nbsp;<span class="ident" id="2585396">Socketpair</span><span class="op" id="2585406">(</span><span class="ident" id="2585407">domain</span><span class="op" id="2585413">,</span>&nbsp;<span class="ident" id="2585415">typ</span><span class="op" id="2585418">,</span>&nbsp;<span class="ident" id="2585420">proto</span>&nbsp;<span class="builtintype" id="2585426">int</span><span class="op" id="2585429">)</span>&nbsp;<span class="op" id="2585431">(</span><span class="ident" id="2585432">fd</span>&nbsp;<span class="op" id="2585435">[</span><span class="num" id="2585436">2</span><span class="op" id="2585437">]</span><span class="builtintype" id="2585438">int</span><span class="op" id="2585441">,</span>&nbsp;<span class="ident" id="2585443">err</span>&nbsp;<span class="builtintype" id="2585447">error</span><span class="op" id="2585452">)</span>&nbsp;<span class="op" id="2585454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585457">var</span>&nbsp;<span class="ident" id="2585461">fdx</span>&nbsp;<span class="op" id="2585465">[</span><span class="num" id="2585466">2</span><span class="op" id="2585467">]</span><span class="builtintype" id="2585468">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2585475">err</span>&nbsp;<span class="op" id="2585479">=</span>&nbsp;<span class="ident" id="2585481">socketpair</span><span class="op" id="2585491">(</span><span class="ident" id="2585492">domain</span><span class="op" id="2585498">,</span>&nbsp;<span class="ident" id="2585500">typ</span><span class="op" id="2585503">,</span>&nbsp;<span class="ident" id="2585505">proto</span><span class="op" id="2585510">,</span>&nbsp;<span class="op" id="2585512">&amp;</span><span class="ident" id="2585513">fdx</span><span class="op" id="2585516">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585519">if</span>&nbsp;<span class="ident" id="2585522">err</span>&nbsp;<span class="op" id="2585526">==</span>&nbsp;<span class="builtintype" id="2585529">nil</span>&nbsp;<span class="op" id="2585533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2585537">fd</span><span class="op" id="2585539">[</span><span class="num" id="2585540">0</span><span class="op" id="2585541">]</span>&nbsp;<span class="op" id="2585543">=</span>&nbsp;<span class="builtintype" id="2585545">int</span><span class="op" id="2585548">(</span><span class="ident" id="2585549">fdx</span><span class="op" id="2585552">[</span><span class="num" id="2585553">0</span><span class="op" id="2585554">]</span><span class="op" id="2585555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2585559">fd</span><span class="op" id="2585561">[</span><span class="num" id="2585562">1</span><span class="op" id="2585563">]</span>&nbsp;<span class="op" id="2585565">=</span>&nbsp;<span class="builtintype" id="2585567">int</span><span class="op" id="2585570">(</span><span class="ident" id="2585571">fdx</span><span class="op" id="2585574">[</span><span class="num" id="2585575">1</span><span class="op" id="2585576">]</span><span class="op" id="2585577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2585580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585583">return</span><br>
<span class="lineno">290</span><span class="op" id="2585590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2585593">func</span>&nbsp;<span class="ident" id="2585598">Sendfile</span><span class="op" id="2585606">(</span><span class="ident" id="2585607">outfd</span>&nbsp;<span class="builtintype" id="2585613">int</span><span class="op" id="2585616">,</span>&nbsp;<span class="ident" id="2585618">infd</span>&nbsp;<span class="builtintype" id="2585623">int</span><span class="op" id="2585626">,</span>&nbsp;<span class="ident" id="2585628">offset</span>&nbsp;<span class="op" id="2585635">*</span><span class="builtintype" id="2585636">int64</span><span class="op" id="2585641">,</span>&nbsp;<span class="ident" id="2585643">count</span>&nbsp;<span class="builtintype" id="2585649">int</span><span class="op" id="2585652">)</span>&nbsp;<span class="op" id="2585654">(</span><span class="ident" id="2585655">written</span>&nbsp;<span class="builtintype" id="2585663">int</span><span class="op" id="2585666">,</span>&nbsp;<span class="ident" id="2585668">err</span>&nbsp;<span class="builtintype" id="2585672">error</span><span class="op" id="2585677">)</span>&nbsp;<span class="op" id="2585679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585682">if</span>&nbsp;<span class="ident" id="2585685">raceenabled</span>&nbsp;<span class="op" id="2585697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2585701">raceReleaseMerge</span><span class="op" id="2585717">(</span><span class="ident" id="2585718">unsafe</span><span class="op" id="2585724">.</span><span class="ident" id="2585725">Pointer</span><span class="op" id="2585732">(</span><span class="op" id="2585733">&amp;</span><span class="ident" id="2585734">ioSync</span><span class="op" id="2585740">)</span><span class="op" id="2585741">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2585744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2585747">return</span>&nbsp;<span class="ident" id="2585754">sendfile</span><span class="op" id="2585762">(</span><span class="ident" id="2585763">outfd</span><span class="op" id="2585768">,</span>&nbsp;<span class="ident" id="2585770">infd</span><span class="op" id="2585774">,</span>&nbsp;<span class="ident" id="2585776">offset</span><span class="op" id="2585782">,</span>&nbsp;<span class="ident" id="2585784">count</span><span class="op" id="2585789">)</span><br>
<span class="lineno"></span><span class="op" id="2585791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2585794">var</span>&nbsp;<span class="ident" id="2585798">ioSync</span>&nbsp;<span class="builtintype" id="2585805">int64</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
