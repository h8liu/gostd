<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4991734">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4991789">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4991843">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4991894">package</span>&nbsp;<span class="ident" id="4991902">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4991907">import</span>&nbsp;<span class="op" id="4991914">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991917">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991926">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991942">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991952">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991958">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991965">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991972">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4991984">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4991991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4991994">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4992057">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4992099">type</span>&nbsp;<span class="ident" id="4992104">ServerError</span>&nbsp;<span class="builtintype" id="4992116">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992124">func</span>&nbsp;<span class="op" id="4992129">(</span><span class="ident" id="4992130">e</span>&nbsp;<span class="ident" id="4992132"><a href="/net/rpc/client.go.html#4992104">ServerError</a></span><span class="op" id="4992143">)</span>&nbsp;<span class="ident" id="4992145">Error</span><span class="op" id="4992150">(</span><span class="op" id="4992151">)</span>&nbsp;<span class="builtintype" id="4992153">string</span>&nbsp;<span class="op" id="4992160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4992163">return</span>&nbsp;<span class="builtintype" id="4992170">string</span><span class="op" id="4992176">(</span><span class="ident" id="4992177"><a href="/net/rpc/client.go.html#4992130">e</a></span><span class="op" id="4992178">)</span><br>
<span class="lineno"></span><span class="op" id="4992180">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4992183">var</span>&nbsp;<span class="ident" id="4992187">ErrShutdown</span>&nbsp;<span class="op" id="4992199">=</span>&nbsp;<span class="ident" id="4992201"><a href="/net/rpc/client.go.html#4991942">errors</a></span><span class="op" id="4992207">.</span><span class="ident" id="4992208">New</span><span class="op" id="4992211">(</span><span class="string" id="4992212">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="4992237">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4992240">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="4992274">type</span>&nbsp;<span class="ident" id="4992279">Call</span>&nbsp;<span class="keyword" id="4992284">struct</span>&nbsp;<span class="op" id="4992291">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992294">ServiceMethod</span>&nbsp;<span class="builtintype" id="4992308">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992320">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992368">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992382">interface</span><span class="op" id="4992391">{</span><span class="op" id="4992392">}</span>&nbsp;<span class="comment" id="4992394">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992438">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992452">interface</span><span class="op" id="4992461">{</span><span class="op" id="4992462">}</span>&nbsp;<span class="comment" id="4992464">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992507">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4992521">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992533">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992573">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992587">chan</span>&nbsp;<span class="op" id="4992592">*</span><span class="ident" id="4992593"><a href="/net/rpc/client.go.html#4992279">Call</a></span>&nbsp;&nbsp;<span class="comment" id="4992599">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="4992633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4992636">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="4992672">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4992726">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="4992779">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="4992818">type</span>&nbsp;<span class="ident" id="4992823">Client</span>&nbsp;<span class="keyword" id="4992830">struct</span>&nbsp;<span class="op" id="4992837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992840">codec</span>&nbsp;<span class="ident" id="4992846"><a href="/net/rpc/client.go.html#4993562">ClientCodec</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992860">reqMutex</span>&nbsp;<span class="ident" id="4992869"><a href="/net/rpc/client.go.html#4991984">sync</a></span><span class="op" id="4992873">.</span><span class="ident" id="4992874">Mutex</span>&nbsp;<span class="comment" id="4992880">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992903">request</span>&nbsp;&nbsp;<span class="ident" id="4992912"><a href="/net/rpc/server.go.html#5007827">Request</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992922">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992931"><a href="/net/rpc/client.go.html#4991984">sync</a></span><span class="op" id="4992935">.</span><span class="ident" id="4992936">Mutex</span>&nbsp;<span class="comment" id="4992942">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992965">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992974">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4992982">pending</span>&nbsp;&nbsp;<span class="keyword" id="4992991">map</span><span class="op" id="4992994">[</span><span class="ident" id="4992995">uint64</span><span class="op" id="4993001">]</span><span class="op" id="4993002">*</span><span class="ident" id="4993003"><a href="/net/rpc/client.go.html#4992279">Call</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993009">closing</span>&nbsp;&nbsp;<span class="builtintype" id="4993018">bool</span>&nbsp;<span class="comment" id="4993023">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993049">shutdown</span>&nbsp;<span class="builtintype" id="4993058">bool</span>&nbsp;<span class="comment" id="4993063">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="4993093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993096">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="4993152">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="4993219">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4993289">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4993351">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4993420">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="4993477">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4993543">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4993557">type</span>&nbsp;<span class="ident" id="4993562">ClientCodec</span>&nbsp;<span class="keyword" id="4993574">interface</span>&nbsp;<span class="op" id="4993584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4993587">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993660">WriteRequest</span><span class="op" id="4993672">(</span><span class="op" id="4993673">*</span><span class="ident" id="4993674"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="4993681">,</span>&nbsp;<span class="keyword" id="4993683">interface</span><span class="op" id="4993692">{</span><span class="op" id="4993693">}</span><span class="op" id="4993694">)</span>&nbsp;<span class="builtintype" id="4993696">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993703">ReadResponseHeader</span><span class="op" id="4993721">(</span><span class="op" id="4993722">*</span><span class="ident" id="4993723"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="4993731">)</span>&nbsp;<span class="builtintype" id="4993733">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993740">ReadResponseBody</span><span class="op" id="4993756">(</span><span class="keyword" id="4993757">interface</span><span class="op" id="4993766">{</span><span class="op" id="4993767">}</span><span class="op" id="4993768">)</span>&nbsp;<span class="builtintype" id="4993770">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993778">Close</span><span class="op" id="4993783">(</span><span class="op" id="4993784">)</span>&nbsp;<span class="builtintype" id="4993786">error</span><br>
<span class="lineno"></span><span class="op" id="4993792">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4993795">func</span>&nbsp;<span class="op" id="4993800">(</span><span class="ident" id="4993801">client</span>&nbsp;<span class="op" id="4993808">*</span><span class="ident" id="4993809"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4993815">)</span>&nbsp;<span class="ident" id="4993817">send</span><span class="op" id="4993821">(</span><span class="ident" id="4993822">call</span>&nbsp;<span class="op" id="4993827">*</span><span class="ident" id="4993828"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4993832">)</span>&nbsp;<span class="op" id="4993834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993837"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4993843">.</span><span class="ident" id="4993844">reqMutex</span><span class="op" id="4993852">.</span><span class="ident" id="4993853">Lock</span><span class="op" id="4993857">(</span><span class="op" id="4993858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993861">defer</span>&nbsp;<span class="ident" id="4993867"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4993873">.</span><span class="ident" id="4993874">reqMutex</span><span class="op" id="4993882">.</span><span class="ident" id="4993883">Unlock</span><span class="op" id="4993889">(</span><span class="op" id="4993890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4993894">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993918"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4993924">.</span><span class="ident" id="4993925">mutex</span><span class="op" id="4993930">.</span><span class="ident" id="4993931">Lock</span><span class="op" id="4993935">(</span><span class="op" id="4993936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4993939">if</span>&nbsp;<span class="ident" id="4993942"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4993948">.</span><span class="ident" id="4993949">shutdown</span>&nbsp;<span class="op" id="4993958">||</span>&nbsp;<span class="ident" id="4993961"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4993967">.</span><span class="ident" id="4993968">closing</span>&nbsp;<span class="op" id="4993976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4993980"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4993984">.</span><span class="ident" id="4993985">Error</span>&nbsp;<span class="op" id="4993991">=</span>&nbsp;<span class="ident" id="4993993"><a href="/net/rpc/client.go.html#4992187">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994007"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994013">.</span><span class="ident" id="4994014">mutex</span><span class="op" id="4994019">.</span><span class="ident" id="4994020">Unlock</span><span class="op" id="4994026">(</span><span class="op" id="4994027">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994031"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4994035">.</span><span class="ident" id="4994036">done</span><span class="op" id="4994040">(</span><span class="op" id="4994041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994045">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994056">seq</span>&nbsp;<span class="op" id="4994060">:=</span>&nbsp;<span class="ident" id="4994063"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994069">.</span><span class="ident" id="4994070">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994075"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994081">.</span><span class="ident" id="4994082">seq</span><span class="op" id="4994085">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994089"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994095">.</span><span class="ident" id="4994096">pending</span><span class="op" id="4994103">[</span><span class="ident" id="4994104"><a href="/net/rpc/client.go.html#4994056">seq</a></span><span class="op" id="4994107">]</span>&nbsp;<span class="op" id="4994109">=</span>&nbsp;<span class="ident" id="4994111"><a href="/net/rpc/client.go.html#4993822">call</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994117"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994123">.</span><span class="ident" id="4994124">mutex</span><span class="op" id="4994129">.</span><span class="ident" id="4994130">Unlock</span><span class="op" id="4994136">(</span><span class="op" id="4994137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4994141">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994174"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994180">.</span><span class="ident" id="4994181">request</span><span class="op" id="4994188">.</span><span class="ident" id="4994189">Seq</span>&nbsp;<span class="op" id="4994193">=</span>&nbsp;<span class="ident" id="4994195"><a href="/net/rpc/client.go.html#4994056">seq</a></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994200"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994206">.</span><span class="ident" id="4994207">request</span><span class="op" id="4994214">.</span><span class="ident" id="4994215">ServiceMethod</span>&nbsp;<span class="op" id="4994229">=</span>&nbsp;<span class="ident" id="4994231"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4994235">.</span><span class="ident" id="4994236">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994251">err</span>&nbsp;<span class="op" id="4994255">:=</span>&nbsp;<span class="ident" id="4994258"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994264">.</span><span class="ident" id="4994265">codec</span><span class="op" id="4994270">.</span><span class="ident" id="4994271">WriteRequest</span><span class="op" id="4994283">(</span><span class="op" id="4994284">&amp;</span><span class="ident" id="4994285"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994291">.</span><span class="ident" id="4994292">request</span><span class="op" id="4994299">,</span>&nbsp;<span class="ident" id="4994301"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4994305">.</span><span class="ident" id="4994306">Args</span><span class="op" id="4994310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994313">if</span>&nbsp;<span class="ident" id="4994316"><a href="/net/rpc/client.go.html#4994251">err</a></span>&nbsp;<span class="op" id="4994320">!=</span>&nbsp;<span class="ident" id="4994323">nil</span>&nbsp;<span class="op" id="4994327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994331"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994337">.</span><span class="ident" id="4994338">mutex</span><span class="op" id="4994343">.</span><span class="ident" id="4994344">Lock</span><span class="op" id="4994348">(</span><span class="op" id="4994349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994353"><a href="/net/rpc/client.go.html#4993822">call</a></span>&nbsp;<span class="op" id="4994358">=</span>&nbsp;<span class="ident" id="4994360"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994366">.</span><span class="ident" id="4994367">pending</span><span class="op" id="4994374">[</span><span class="ident" id="4994375"><a href="/net/rpc/client.go.html#4994056">seq</a></span><span class="op" id="4994378">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4994382">delete</span><span class="op" id="4994388">(</span><span class="ident" id="4994389"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994395">.</span><span class="ident" id="4994396">pending</span><span class="op" id="4994403">,</span>&nbsp;<span class="ident" id="4994405"><a href="/net/rpc/client.go.html#4994056">seq</a></span><span class="op" id="4994408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994412"><a href="/net/rpc/client.go.html#4993801">client</a></span><span class="op" id="4994418">.</span><span class="ident" id="4994419">mutex</span><span class="op" id="4994424">.</span><span class="ident" id="4994425">Unlock</span><span class="op" id="4994431">(</span><span class="op" id="4994432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994436">if</span>&nbsp;<span class="ident" id="4994439"><a href="/net/rpc/client.go.html#4993822">call</a></span>&nbsp;<span class="op" id="4994444">!=</span>&nbsp;<span class="ident" id="4994447">nil</span>&nbsp;<span class="op" id="4994451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994456"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4994460">.</span><span class="ident" id="4994461">Error</span>&nbsp;<span class="op" id="4994467">=</span>&nbsp;<span class="ident" id="4994469"><a href="/net/rpc/client.go.html#4994251">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994476"><a href="/net/rpc/client.go.html#4993822">call</a></span><span class="op" id="4994480">.</span><span class="ident" id="4994481">done</span><span class="op" id="4994485">(</span><span class="op" id="4994486">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994493">}</span><br>
<span class="lineno"></span><span class="op" id="4994495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4994498">func</span>&nbsp;<span class="op" id="4994503">(</span><span class="ident" id="4994504">client</span>&nbsp;<span class="op" id="4994511">*</span><span class="ident" id="4994512"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4994518">)</span>&nbsp;<span class="ident" id="4994520">input</span><span class="op" id="4994525">(</span><span class="op" id="4994526">)</span>&nbsp;<span class="op" id="4994528">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994531">var</span>&nbsp;<span class="ident" id="4994535">err</span>&nbsp;<span class="builtintype" id="4994539">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994546">var</span>&nbsp;<span class="ident" id="4994550">response</span>&nbsp;<span class="ident" id="4994559"><a href="/net/rpc/server.go.html#5008185">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994569">for</span>&nbsp;<span class="ident" id="4994573"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4994577">==</span>&nbsp;<span class="ident" id="4994580">nil</span>&nbsp;<span class="op" id="4994584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994588"><a href="/net/rpc/client.go.html#4994550">response</a></span>&nbsp;<span class="op" id="4994597">=</span>&nbsp;<span class="ident" id="4994599"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="4994607">{</span><span class="op" id="4994608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994612"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4994616">=</span>&nbsp;<span class="ident" id="4994618"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4994624">.</span><span class="ident" id="4994625">codec</span><span class="op" id="4994630">.</span><span class="ident" id="4994631">ReadResponseHeader</span><span class="op" id="4994649">(</span><span class="op" id="4994650">&amp;</span><span class="ident" id="4994651"><a href="/net/rpc/client.go.html#4994550">response</a></span><span class="op" id="4994659">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994663">if</span>&nbsp;<span class="ident" id="4994666"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4994670">!=</span>&nbsp;<span class="ident" id="4994673">nil</span>&nbsp;<span class="op" id="4994677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994682">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4994690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994694">seq</span>&nbsp;<span class="op" id="4994698">:=</span>&nbsp;<span class="ident" id="4994701"><a href="/net/rpc/client.go.html#4994550">response</a></span><span class="op" id="4994709">.</span><span class="ident" id="4994710">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994716"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4994722">.</span><span class="ident" id="4994723">mutex</span><span class="op" id="4994728">.</span><span class="ident" id="4994729">Lock</span><span class="op" id="4994733">(</span><span class="op" id="4994734">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994738">call</span>&nbsp;<span class="op" id="4994743">:=</span>&nbsp;<span class="ident" id="4994746"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4994752">.</span><span class="ident" id="4994753">pending</span><span class="op" id="4994760">[</span><span class="ident" id="4994761"><a href="/net/rpc/client.go.html#4994694">seq</a></span><span class="op" id="4994764">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4994768">delete</span><span class="op" id="4994774">(</span><span class="ident" id="4994775"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4994781">.</span><span class="ident" id="4994782">pending</span><span class="op" id="4994789">,</span>&nbsp;<span class="ident" id="4994791"><a href="/net/rpc/client.go.html#4994694">seq</a></span><span class="op" id="4994794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4994798"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4994804">.</span><span class="ident" id="4994805">mutex</span><span class="op" id="4994810">.</span><span class="ident" id="4994811">Unlock</span><span class="op" id="4994817">(</span><span class="op" id="4994818">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994823">switch</span>&nbsp;<span class="op" id="4994830">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4994834">case</span>&nbsp;<span class="ident" id="4994839"><a href="/net/rpc/client.go.html#4994738">call</a></span>&nbsp;<span class="op" id="4994844">==</span>&nbsp;<span class="ident" id="4994847">nil</span><span class="op" id="4994850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4994855">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4994912">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4994970">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995026">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995084">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995144"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995148">=</span>&nbsp;<span class="ident" id="4995150"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995156">.</span><span class="ident" id="4995157">codec</span><span class="op" id="4995162">.</span><span class="ident" id="4995163">ReadResponseBody</span><span class="op" id="4995179">(</span><span class="ident" id="4995180">nil</span><span class="op" id="4995183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995188">if</span>&nbsp;<span class="ident" id="4995191"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995195">!=</span>&nbsp;<span class="ident" id="4995198">nil</span>&nbsp;<span class="op" id="4995202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995208"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995212">=</span>&nbsp;<span class="ident" id="4995214"><a href="/net/rpc/client.go.html#4991942">errors</a></span><span class="op" id="4995220">.</span><span class="ident" id="4995221">New</span><span class="op" id="4995224">(</span><span class="string" id="4995225">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4995248">+</span>&nbsp;<span class="ident" id="4995250"><a href="/net/rpc/client.go.html#4994535">err</a></span><span class="op" id="4995253">.</span><span class="ident" id="4995254">Error</span><span class="op" id="4995259">(</span><span class="op" id="4995260">)</span><span class="op" id="4995261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995266">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995270">case</span>&nbsp;<span class="ident" id="4995275"><a href="/net/rpc/client.go.html#4994550">response</a></span><span class="op" id="4995283">.</span><span class="ident" id="4995284">Error</span>&nbsp;<span class="op" id="4995290">!=</span>&nbsp;<span class="string" id="4995293">&#34;&#34;</span><span class="op" id="4995295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995300">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995361">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995421">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995450"><a href="/net/rpc/client.go.html#4994738">call</a></span><span class="op" id="4995454">.</span><span class="ident" id="4995455">Error</span>&nbsp;<span class="op" id="4995461">=</span>&nbsp;<span class="ident" id="4995463"><a href="/net/rpc/client.go.html#4992104">ServerError</a></span><span class="op" id="4995474">(</span><span class="ident" id="4995475"><a href="/net/rpc/client.go.html#4994550">response</a></span><span class="op" id="4995483">.</span><span class="ident" id="4995484">Error</span><span class="op" id="4995489">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995494"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995498">=</span>&nbsp;<span class="ident" id="4995500"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995506">.</span><span class="ident" id="4995507">codec</span><span class="op" id="4995512">.</span><span class="ident" id="4995513">ReadResponseBody</span><span class="op" id="4995529">(</span><span class="ident" id="4995530">nil</span><span class="op" id="4995533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995538">if</span>&nbsp;<span class="ident" id="4995541"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995545">!=</span>&nbsp;<span class="ident" id="4995548">nil</span>&nbsp;<span class="op" id="4995552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995558"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995562">=</span>&nbsp;<span class="ident" id="4995564"><a href="/net/rpc/client.go.html#4991942">errors</a></span><span class="op" id="4995570">.</span><span class="ident" id="4995571">New</span><span class="op" id="4995574">(</span><span class="string" id="4995575">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4995598">+</span>&nbsp;<span class="ident" id="4995600"><a href="/net/rpc/client.go.html#4994535">err</a></span><span class="op" id="4995603">.</span><span class="ident" id="4995604">Error</span><span class="op" id="4995609">(</span><span class="op" id="4995610">)</span><span class="op" id="4995611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995621"><a href="/net/rpc/client.go.html#4994738">call</a></span><span class="op" id="4995625">.</span><span class="ident" id="4995626">done</span><span class="op" id="4995630">(</span><span class="op" id="4995631">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995635">default</span><span class="op" id="4995642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995647"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995651">=</span>&nbsp;<span class="ident" id="4995653"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995659">.</span><span class="ident" id="4995660">codec</span><span class="op" id="4995665">.</span><span class="ident" id="4995666">ReadResponseBody</span><span class="op" id="4995682">(</span><span class="ident" id="4995683"><a href="/net/rpc/client.go.html#4994738">call</a></span><span class="op" id="4995687">.</span><span class="ident" id="4995688">Reply</span><span class="op" id="4995693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995698">if</span>&nbsp;<span class="ident" id="4995701"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995705">!=</span>&nbsp;<span class="ident" id="4995708">nil</span>&nbsp;<span class="op" id="4995712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995718"><a href="/net/rpc/client.go.html#4994738">call</a></span><span class="op" id="4995722">.</span><span class="ident" id="4995723">Error</span>&nbsp;<span class="op" id="4995729">=</span>&nbsp;<span class="ident" id="4995731"><a href="/net/rpc/client.go.html#4991942">errors</a></span><span class="op" id="4995737">.</span><span class="ident" id="4995738">New</span><span class="op" id="4995741">(</span><span class="string" id="4995742">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="4995758">+</span>&nbsp;<span class="ident" id="4995760"><a href="/net/rpc/client.go.html#4994535">err</a></span><span class="op" id="4995763">.</span><span class="ident" id="4995764">Error</span><span class="op" id="4995769">(</span><span class="op" id="4995770">)</span><span class="op" id="4995771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995776">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995781"><a href="/net/rpc/client.go.html#4994738">call</a></span><span class="op" id="4995785">.</span><span class="ident" id="4995786">done</span><span class="op" id="4995790">(</span><span class="op" id="4995791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4995801">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995830"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995836">.</span><span class="ident" id="4995837">reqMutex</span><span class="op" id="4995845">.</span><span class="ident" id="4995846">Lock</span><span class="op" id="4995850">(</span><span class="op" id="4995851">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995854"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995860">.</span><span class="ident" id="4995861">mutex</span><span class="op" id="4995866">.</span><span class="ident" id="4995867">Lock</span><span class="op" id="4995871">(</span><span class="op" id="4995872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995875"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995881">.</span><span class="ident" id="4995882">shutdown</span>&nbsp;<span class="op" id="4995891">=</span>&nbsp;<span class="ident" id="4995893">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995899">closing</span>&nbsp;<span class="op" id="4995907">:=</span>&nbsp;<span class="ident" id="4995910"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4995916">.</span><span class="ident" id="4995917">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995926">if</span>&nbsp;<span class="ident" id="4995929"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995933">==</span>&nbsp;<span class="ident" id="4995936"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4995938">.</span><span class="ident" id="4995939">EOF</span>&nbsp;<span class="op" id="4995943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4995947">if</span>&nbsp;<span class="ident" id="4995950"><a href="/net/rpc/client.go.html#4995899">closing</a></span>&nbsp;<span class="op" id="4995958">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995963"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995967">=</span>&nbsp;<span class="ident" id="4995969"><a href="/net/rpc/client.go.html#4992187">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4995983">}</span>&nbsp;<span class="keyword" id="4995985">else</span>&nbsp;<span class="op" id="4995990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4995995"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4995999">=</span>&nbsp;<span class="ident" id="4996001"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4996003">.</span><span class="ident" id="4996004">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996026">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996029">for</span>&nbsp;<span class="ident" id="4996033">_</span><span class="op" id="4996034">,</span>&nbsp;<span class="ident" id="4996036">call</span>&nbsp;<span class="op" id="4996041">:=</span>&nbsp;<span class="keyword" id="4996044">range</span>&nbsp;<span class="ident" id="4996050"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4996056">.</span><span class="ident" id="4996057">pending</span>&nbsp;<span class="op" id="4996065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996069"><a href="/net/rpc/client.go.html#4996036">call</a></span><span class="op" id="4996073">.</span><span class="ident" id="4996074">Error</span>&nbsp;<span class="op" id="4996080">=</span>&nbsp;<span class="ident" id="4996082"><a href="/net/rpc/client.go.html#4994535">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996088"><a href="/net/rpc/client.go.html#4996036">call</a></span><span class="op" id="4996092">.</span><span class="ident" id="4996093">done</span><span class="op" id="4996097">(</span><span class="op" id="4996098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996104"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4996110">.</span><span class="ident" id="4996111">mutex</span><span class="op" id="4996116">.</span><span class="ident" id="4996117">Unlock</span><span class="op" id="4996123">(</span><span class="op" id="4996124">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996127"><a href="/net/rpc/client.go.html#4994504">client</a></span><span class="op" id="4996133">.</span><span class="ident" id="4996134">reqMutex</span><span class="op" id="4996142">.</span><span class="ident" id="4996143">Unlock</span><span class="op" id="4996149">(</span><span class="op" id="4996150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996153">if</span>&nbsp;<span class="ident" id="4996156"><a href="/net/rpc/debug.go.html#5001451">debugLog</a></span>&nbsp;<span class="op" id="4996165">&amp;&amp;</span>&nbsp;<span class="ident" id="4996168"><a href="/net/rpc/client.go.html#4994535">err</a></span>&nbsp;<span class="op" id="4996172">!=</span>&nbsp;<span class="ident" id="4996175"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4996177">.</span><span class="ident" id="4996178">EOF</span>&nbsp;<span class="op" id="4996182">&amp;&amp;</span>&nbsp;<span class="op" id="4996185">!</span><span class="ident" id="4996186"><a href="/net/rpc/client.go.html#4995899">closing</a></span>&nbsp;<span class="op" id="4996194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996198"><a href="/net/rpc/client.go.html#4991958">log</a></span><span class="op" id="4996201">.</span><span class="ident" id="4996202">Println</span><span class="op" id="4996209">(</span><span class="string" id="4996210">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="4996239">,</span>&nbsp;<span class="ident" id="4996241"><a href="/net/rpc/client.go.html#4994535">err</a></span><span class="op" id="4996244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996247">}</span><br>
<span class="lineno"></span><span class="op" id="4996249">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4996252">func</span>&nbsp;<span class="op" id="4996257">(</span><span class="ident" id="4996258">call</span>&nbsp;<span class="op" id="4996263">*</span><span class="ident" id="4996264"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4996268">)</span>&nbsp;<span class="ident" id="4996270">done</span><span class="op" id="4996274">(</span><span class="op" id="4996275">)</span>&nbsp;<span class="op" id="4996277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996280">select</span>&nbsp;<span class="op" id="4996287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996290">case</span>&nbsp;<span class="ident" id="4996295"><a href="/net/rpc/client.go.html#4996258">call</a></span><span class="op" id="4996299">.</span><span class="ident" id="4996300">Done</span>&nbsp;<span class="op" id="4996305">&lt;-</span>&nbsp;<span class="ident" id="4996308"><a href="/net/rpc/client.go.html#4996258">call</a></span><span class="op" id="4996312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996316">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996323">default</span><span class="op" id="4996330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996334">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4996411">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996479">if</span>&nbsp;<span class="ident" id="4996482"><a href="/net/rpc/debug.go.html#5001451">debugLog</a></span>&nbsp;<span class="op" id="4996491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996496"><a href="/net/rpc/client.go.html#4991958">log</a></span><span class="op" id="4996499">.</span><span class="ident" id="4996500">Println</span><span class="op" id="4996507">(</span><span class="string" id="4996508">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="4996575">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4996582">}</span><br>
<span class="lineno"></span><span class="op" id="4996584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4996587">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="4996647">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4996702">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="4996761">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="4996807">func</span>&nbsp;<span class="ident" id="4996812">NewClient</span><span class="op" id="4996821">(</span><span class="ident" id="4996822">conn</span>&nbsp;<span class="ident" id="4996827"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4996829">.</span><span class="ident" id="4996830">ReadWriteCloser</span><span class="op" id="4996845">)</span>&nbsp;<span class="op" id="4996847">*</span><span class="ident" id="4996848"><a href="/net/rpc/client.go.html#4992823">Client</a></span>&nbsp;<span class="op" id="4996855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996858">encBuf</span>&nbsp;<span class="op" id="4996865">:=</span>&nbsp;<span class="ident" id="4996868"><a href="/net/rpc/client.go.html#4991917">bufio</a></span><span class="op" id="4996873">.</span><span class="ident" id="4996874">NewWriter</span><span class="op" id="4996883">(</span><span class="ident" id="4996884"><a href="/net/rpc/client.go.html#4996822">conn</a></span><span class="op" id="4996888">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4996891">client</span>&nbsp;<span class="op" id="4996898">:=</span>&nbsp;<span class="op" id="4996901">&amp;</span><span class="ident" id="4996902"><a href="/net/rpc/client.go.html#4997299">gobClientCodec</a></span><span class="op" id="4996916">{</span><span class="ident" id="4996917"><a href="/net/rpc/client.go.html#4996822">conn</a></span><span class="op" id="4996921">,</span>&nbsp;<span class="ident" id="4996923"><a href="/net/rpc/client.go.html#4991926">gob</a></span><span class="op" id="4996926">.</span><span class="ident" id="4996927">NewDecoder</span><span class="op" id="4996937">(</span><span class="ident" id="4996938"><a href="/net/rpc/client.go.html#4996822">conn</a></span><span class="op" id="4996942">)</span><span class="op" id="4996943">,</span>&nbsp;<span class="ident" id="4996945"><a href="/net/rpc/client.go.html#4991926">gob</a></span><span class="op" id="4996948">.</span><span class="ident" id="4996949">NewEncoder</span><span class="op" id="4996959">(</span><span class="ident" id="4996960"><a href="/net/rpc/client.go.html#4996858">encBuf</a></span><span class="op" id="4996966">)</span><span class="op" id="4996967">,</span>&nbsp;<span class="ident" id="4996969"><a href="/net/rpc/client.go.html#4996858">encBuf</a></span><span class="op" id="4996975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4996978">return</span>&nbsp;<span class="ident" id="4996985"><a href="/net/rpc/client.go.html#4997133">NewClientWithCodec</a></span><span class="op" id="4997003">(</span><span class="ident" id="4997004"><a href="/net/rpc/client.go.html#4996891">client</a></span><span class="op" id="4997010">)</span><br>
<span class="lineno"></span><span class="op" id="4997012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4997015">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="4997078">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4997128">func</span>&nbsp;<span class="ident" id="4997133">NewClientWithCodec</span><span class="op" id="4997151">(</span><span class="ident" id="4997152">codec</span>&nbsp;<span class="ident" id="4997158"><a href="/net/rpc/client.go.html#4993562">ClientCodec</a></span><span class="op" id="4997169">)</span>&nbsp;<span class="op" id="4997171">*</span><span class="ident" id="4997172"><a href="/net/rpc/client.go.html#4992823">Client</a></span>&nbsp;<span class="op" id="4997179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997182">client</span>&nbsp;<span class="op" id="4997189">:=</span>&nbsp;<span class="op" id="4997192">&amp;</span><span class="ident" id="4997193"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4997199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997203">codec</span><span class="op" id="4997208">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4997212"><a href="/net/rpc/client.go.html#4997152">codec</a></span><span class="op" id="4997217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997221">pending</span><span class="op" id="4997228">:</span>&nbsp;<span class="builtinfunc" id="4997230">make</span><span class="op" id="4997234">(</span><span class="keyword" id="4997235">map</span><span class="op" id="4997238">[</span><span class="ident" id="4997239">uint64</span><span class="op" id="4997245">]</span><span class="op" id="4997246">*</span><span class="ident" id="4997247"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4997251">)</span><span class="op" id="4997252">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997258">go</span>&nbsp;<span class="ident" id="4997261"><a href="/net/rpc/client.go.html#4997182">client</a></span><span class="op" id="4997267">.</span><span class="ident" id="4997268">input</span><span class="op" id="4997273">(</span><span class="op" id="4997274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997277">return</span>&nbsp;<span class="ident" id="4997284"><a href="/net/rpc/client.go.html#4997182">client</a></span><br>
<span class="lineno"></span><span class="op" id="4997291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4997294">type</span>&nbsp;<span class="ident" id="4997299">gobClientCodec</span>&nbsp;<span class="keyword" id="4997314">struct</span>&nbsp;<span class="op" id="4997321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997324">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997331"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4997333">.</span><span class="ident" id="4997334">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997351">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4997358">*</span><span class="ident" id="4997359"><a href="/net/rpc/client.go.html#4991926">gob</a></span><span class="op" id="4997362">.</span><span class="ident" id="4997363">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997372">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4997379">*</span><span class="ident" id="4997380"><a href="/net/rpc/client.go.html#4991926">gob</a></span><span class="op" id="4997383">.</span><span class="ident" id="4997384">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4997393">encBuf</span>&nbsp;<span class="op" id="4997400">*</span><span class="ident" id="4997401"><a href="/net/rpc/client.go.html#4991917">bufio</a></span><span class="op" id="4997406">.</span><span class="ident" id="4997407">Writer</span><br>
<span class="lineno">210</span><span class="op" id="4997414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997417">func</span>&nbsp;<span class="op" id="4997422">(</span><span class="ident" id="4997423">c</span>&nbsp;<span class="op" id="4997425">*</span><span class="ident" id="4997426"><a href="/net/rpc/client.go.html#4997299">gobClientCodec</a></span><span class="op" id="4997440">)</span>&nbsp;<span class="ident" id="4997442">WriteRequest</span><span class="op" id="4997454">(</span><span class="ident" id="4997455">r</span>&nbsp;<span class="op" id="4997457">*</span><span class="ident" id="4997458"><a href="/net/rpc/server.go.html#5007827">Request</a></span><span class="op" id="4997465">,</span>&nbsp;<span class="ident" id="4997467">body</span>&nbsp;<span class="keyword" id="4997472">interface</span><span class="op" id="4997481">{</span><span class="op" id="4997482">}</span><span class="op" id="4997483">)</span>&nbsp;<span class="op" id="4997485">(</span><span class="ident" id="4997486">err</span>&nbsp;<span class="builtintype" id="4997490">error</span><span class="op" id="4997495">)</span>&nbsp;<span class="op" id="4997497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997500">if</span>&nbsp;<span class="ident" id="4997503"><a href="/net/rpc/client.go.html#4997486">err</a></span>&nbsp;<span class="op" id="4997507">=</span>&nbsp;<span class="ident" id="4997509"><a href="/net/rpc/client.go.html#4997423">c</a></span><span class="op" id="4997510">.</span><span class="ident" id="4997511">enc</span><span class="op" id="4997514">.</span><span class="ident" id="4997515">Encode</span><span class="op" id="4997521">(</span><span class="ident" id="4997522"><a href="/net/rpc/client.go.html#4997455">r</a></span><span class="op" id="4997523">)</span><span class="op" id="4997524">;</span>&nbsp;<span class="ident" id="4997526"><a href="/net/rpc/client.go.html#4997486">err</a></span>&nbsp;<span class="op" id="4997530">!=</span>&nbsp;<span class="ident" id="4997533">nil</span>&nbsp;<span class="op" id="4997537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997541">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997552">if</span>&nbsp;<span class="ident" id="4997555"><a href="/net/rpc/client.go.html#4997486">err</a></span>&nbsp;<span class="op" id="4997559">=</span>&nbsp;<span class="ident" id="4997561"><a href="/net/rpc/client.go.html#4997423">c</a></span><span class="op" id="4997562">.</span><span class="ident" id="4997563">enc</span><span class="op" id="4997566">.</span><span class="ident" id="4997567">Encode</span><span class="op" id="4997573">(</span><span class="ident" id="4997574"><a href="/net/rpc/client.go.html#4997467">body</a></span><span class="op" id="4997578">)</span><span class="op" id="4997579">;</span>&nbsp;<span class="ident" id="4997581"><a href="/net/rpc/client.go.html#4997486">err</a></span>&nbsp;<span class="op" id="4997585">!=</span>&nbsp;<span class="ident" id="4997588">nil</span>&nbsp;<span class="op" id="4997592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4997604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997607">return</span>&nbsp;<span class="ident" id="4997614"><a href="/net/rpc/client.go.html#4997423">c</a></span><span class="op" id="4997615">.</span><span class="ident" id="4997616">encBuf</span><span class="op" id="4997622">.</span><span class="ident" id="4997623">Flush</span><span class="op" id="4997628">(</span><span class="op" id="4997629">)</span><br>
<span class="lineno">220</span><span class="op" id="4997631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997634">func</span>&nbsp;<span class="op" id="4997639">(</span><span class="ident" id="4997640">c</span>&nbsp;<span class="op" id="4997642">*</span><span class="ident" id="4997643"><a href="/net/rpc/client.go.html#4997299">gobClientCodec</a></span><span class="op" id="4997657">)</span>&nbsp;<span class="ident" id="4997659">ReadResponseHeader</span><span class="op" id="4997677">(</span><span class="ident" id="4997678">r</span>&nbsp;<span class="op" id="4997680">*</span><span class="ident" id="4997681"><a href="/net/rpc/server.go.html#5008185">Response</a></span><span class="op" id="4997689">)</span>&nbsp;<span class="builtintype" id="4997691">error</span>&nbsp;<span class="op" id="4997697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997700">return</span>&nbsp;<span class="ident" id="4997707"><a href="/net/rpc/client.go.html#4997640">c</a></span><span class="op" id="4997708">.</span><span class="ident" id="4997709">dec</span><span class="op" id="4997712">.</span><span class="ident" id="4997713">Decode</span><span class="op" id="4997719">(</span><span class="ident" id="4997720"><a href="/net/rpc/client.go.html#4997678">r</a></span><span class="op" id="4997721">)</span><br>
<span class="lineno"></span><span class="op" id="4997723">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4997726">func</span>&nbsp;<span class="op" id="4997731">(</span><span class="ident" id="4997732">c</span>&nbsp;<span class="op" id="4997734">*</span><span class="ident" id="4997735"><a href="/net/rpc/client.go.html#4997299">gobClientCodec</a></span><span class="op" id="4997749">)</span>&nbsp;<span class="ident" id="4997751">ReadResponseBody</span><span class="op" id="4997767">(</span><span class="ident" id="4997768">body</span>&nbsp;<span class="keyword" id="4997773">interface</span><span class="op" id="4997782">{</span><span class="op" id="4997783">}</span><span class="op" id="4997784">)</span>&nbsp;<span class="builtintype" id="4997786">error</span>&nbsp;<span class="op" id="4997792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997795">return</span>&nbsp;<span class="ident" id="4997802"><a href="/net/rpc/client.go.html#4997732">c</a></span><span class="op" id="4997803">.</span><span class="ident" id="4997804">dec</span><span class="op" id="4997807">.</span><span class="ident" id="4997808">Decode</span><span class="op" id="4997814">(</span><span class="ident" id="4997815"><a href="/net/rpc/client.go.html#4997768">body</a></span><span class="op" id="4997819">)</span><br>
<span class="lineno"></span><span class="op" id="4997821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4997824">func</span>&nbsp;<span class="op" id="4997829">(</span><span class="ident" id="4997830">c</span>&nbsp;<span class="op" id="4997832">*</span><span class="ident" id="4997833"><a href="/net/rpc/client.go.html#4997299">gobClientCodec</a></span><span class="op" id="4997847">)</span>&nbsp;<span class="ident" id="4997849">Close</span><span class="op" id="4997854">(</span><span class="op" id="4997855">)</span>&nbsp;<span class="builtintype" id="4997857">error</span>&nbsp;<span class="op" id="4997863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4997866">return</span>&nbsp;<span class="ident" id="4997873"><a href="/net/rpc/client.go.html#4997830">c</a></span><span class="op" id="4997874">.</span><span class="ident" id="4997875">rwc</span><span class="op" id="4997878">.</span><span class="ident" id="4997879">Close</span><span class="op" id="4997884">(</span><span class="op" id="4997885">)</span><br>
<span class="lineno"></span><span class="op" id="4997887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4997890">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="4997966">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4998009">func</span>&nbsp;<span class="ident" id="4998014">DialHTTP</span><span class="op" id="4998022">(</span><span class="ident" id="4998023">network</span><span class="op" id="4998030">,</span>&nbsp;<span class="ident" id="4998032">address</span>&nbsp;<span class="builtintype" id="4998040">string</span><span class="op" id="4998046">)</span>&nbsp;<span class="op" id="4998048">(</span><span class="op" id="4998049">*</span><span class="ident" id="4998050"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4998056">,</span>&nbsp;<span class="builtintype" id="4998058">error</span><span class="op" id="4998063">)</span>&nbsp;<span class="op" id="4998065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998068">return</span>&nbsp;<span class="ident" id="4998075"><a href="/net/rpc/client.go.html#4998223">DialHTTPPath</a></span><span class="op" id="4998087">(</span><span class="ident" id="4998088"><a href="/net/rpc/client.go.html#4998023">network</a></span><span class="op" id="4998095">,</span>&nbsp;<span class="ident" id="4998097"><a href="/net/rpc/client.go.html#4998032">address</a></span><span class="op" id="4998104">,</span>&nbsp;<span class="ident" id="4998106"><a href="/net/rpc/server.go.html#5006988">DefaultRPCPath</a></span><span class="op" id="4998120">)</span><br>
<span class="lineno"></span><span class="op" id="4998122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="4998125">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4998172">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4998218">func</span>&nbsp;<span class="ident" id="4998223">DialHTTPPath</span><span class="op" id="4998235">(</span><span class="ident" id="4998236">network</span><span class="op" id="4998243">,</span>&nbsp;<span class="ident" id="4998245">address</span><span class="op" id="4998252">,</span>&nbsp;<span class="ident" id="4998254">path</span>&nbsp;<span class="builtintype" id="4998259">string</span><span class="op" id="4998265">)</span>&nbsp;<span class="op" id="4998267">(</span><span class="op" id="4998268">*</span><span class="ident" id="4998269"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4998275">,</span>&nbsp;<span class="builtintype" id="4998277">error</span><span class="op" id="4998282">)</span>&nbsp;<span class="op" id="4998284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998287">var</span>&nbsp;<span class="ident" id="4998291">err</span>&nbsp;<span class="builtintype" id="4998295">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998302">conn</span><span class="op" id="4998306">,</span>&nbsp;<span class="ident" id="4998308"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998312">:=</span>&nbsp;<span class="ident" id="4998315"><a href="/net/rpc/client.go.html#4991965">net</a></span><span class="op" id="4998318">.</span><span class="ident" id="4998319">Dial</span><span class="op" id="4998323">(</span><span class="ident" id="4998324"><a href="/net/rpc/client.go.html#4998236">network</a></span><span class="op" id="4998331">,</span>&nbsp;<span class="ident" id="4998333"><a href="/net/rpc/client.go.html#4998245">address</a></span><span class="op" id="4998340">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998343">if</span>&nbsp;<span class="ident" id="4998346"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998350">!=</span>&nbsp;<span class="ident" id="4998353">nil</span>&nbsp;<span class="op" id="4998357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998361">return</span>&nbsp;<span class="ident" id="4998368">nil</span><span class="op" id="4998371">,</span>&nbsp;<span class="ident" id="4998373"><a href="/net/rpc/client.go.html#4998291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4998378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998381"><a href="/net/rpc/client.go.html#4991952">io</a></span><span class="op" id="4998383">.</span><span class="ident" id="4998384">WriteString</span><span class="op" id="4998395">(</span><span class="ident" id="4998396"><a href="/net/rpc/client.go.html#4998302">conn</a></span><span class="op" id="4998400">,</span>&nbsp;<span class="string" id="4998402">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="4998412">+</span><span class="ident" id="4998413"><a href="/net/rpc/client.go.html#4998254">path</a></span><span class="op" id="4998417">+</span><span class="string" id="4998418">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="4998433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998437">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4998474">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998512">resp</span><span class="op" id="4998516">,</span>&nbsp;<span class="ident" id="4998518"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998522">:=</span>&nbsp;<span class="ident" id="4998525"><a href="/net/rpc/client.go.html#4991972">http</a></span><span class="op" id="4998529">.</span><span class="ident" id="4998530">ReadResponse</span><span class="op" id="4998542">(</span><span class="ident" id="4998543"><a href="/net/rpc/client.go.html#4991917">bufio</a></span><span class="op" id="4998548">.</span><span class="ident" id="4998549">NewReader</span><span class="op" id="4998558">(</span><span class="ident" id="4998559"><a href="/net/rpc/client.go.html#4998302">conn</a></span><span class="op" id="4998563">)</span><span class="op" id="4998564">,</span>&nbsp;<span class="op" id="4998566">&amp;</span><span class="ident" id="4998567"><a href="/net/rpc/client.go.html#4991972">http</a></span><span class="op" id="4998571">.</span><span class="ident" id="4998572">Request</span><span class="op" id="4998579">{</span><span class="ident" id="4998580">Method</span><span class="op" id="4998586">:</span>&nbsp;<span class="string" id="4998588">&#34;CONNECT&#34;</span><span class="op" id="4998597">}</span><span class="op" id="4998598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998601">if</span>&nbsp;<span class="ident" id="4998604"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998608">==</span>&nbsp;<span class="ident" id="4998611">nil</span>&nbsp;<span class="op" id="4998615">&amp;&amp;</span>&nbsp;<span class="ident" id="4998618"><a href="/net/rpc/client.go.html#4998512">resp</a></span><span class="op" id="4998622">.</span><span class="ident" id="4998623">Status</span>&nbsp;<span class="op" id="4998630">==</span>&nbsp;<span class="ident" id="4998633"><a href="/net/rpc/server.go.html#5023073">connected</a></span>&nbsp;<span class="op" id="4998643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998647">return</span>&nbsp;<span class="ident" id="4998654"><a href="/net/rpc/client.go.html#4996812">NewClient</a></span><span class="op" id="4998663">(</span><span class="ident" id="4998664"><a href="/net/rpc/client.go.html#4998302">conn</a></span><span class="op" id="4998668">)</span><span class="op" id="4998669">,</span>&nbsp;<span class="ident" id="4998671">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4998676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998679">if</span>&nbsp;<span class="ident" id="4998682"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998686">==</span>&nbsp;<span class="ident" id="4998689">nil</span>&nbsp;<span class="op" id="4998693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998697"><a href="/net/rpc/client.go.html#4998291">err</a></span>&nbsp;<span class="op" id="4998701">=</span>&nbsp;<span class="ident" id="4998703"><a href="/net/rpc/client.go.html#4991942">errors</a></span><span class="op" id="4998709">.</span><span class="ident" id="4998710">New</span><span class="op" id="4998713">(</span><span class="string" id="4998714">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4998743">+</span>&nbsp;<span class="ident" id="4998745"><a href="/net/rpc/client.go.html#4998512">resp</a></span><span class="op" id="4998749">.</span><span class="ident" id="4998750">Status</span><span class="op" id="4998756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4998759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998762"><a href="/net/rpc/client.go.html#4998302">conn</a></span><span class="op" id="4998766">.</span><span class="ident" id="4998767">Close</span><span class="op" id="4998772">(</span><span class="op" id="4998773">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4998776">return</span>&nbsp;<span class="ident" id="4998783">nil</span><span class="op" id="4998786">,</span>&nbsp;<span class="op" id="4998788">&amp;</span><span class="ident" id="4998789"><a href="/net/rpc/client.go.html#4991965">net</a></span><span class="op" id="4998792">.</span><span class="ident" id="4998793">OpError</span><span class="op" id="4998800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998804">Op</span><span class="op" id="4998806">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4998810">&#34;dial-http&#34;</span><span class="op" id="4998821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998825">Net</span><span class="op" id="4998828">:</span>&nbsp;&nbsp;<span class="ident" id="4998831"><a href="/net/rpc/client.go.html#4998236">network</a></span>&nbsp;<span class="op" id="4998839">+</span>&nbsp;<span class="string" id="4998841">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4998845">+</span>&nbsp;<span class="ident" id="4998847"><a href="/net/rpc/client.go.html#4998245">address</a></span><span class="op" id="4998854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998858">Addr</span><span class="op" id="4998862">:</span>&nbsp;<span class="ident" id="4998864">nil</span><span class="op" id="4998867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4998871">Err</span><span class="op" id="4998874">:</span>&nbsp;&nbsp;<span class="ident" id="4998877"><a href="/net/rpc/client.go.html#4998291">err</a></span><span class="op" id="4998880">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4998883">}</span><br>
<span class="lineno"></span><span class="op" id="4998885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4998888">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4998956">func</span>&nbsp;<span class="ident" id="4998961">Dial</span><span class="op" id="4998965">(</span><span class="ident" id="4998966">network</span><span class="op" id="4998973">,</span>&nbsp;<span class="ident" id="4998975">address</span>&nbsp;<span class="builtintype" id="4998983">string</span><span class="op" id="4998989">)</span>&nbsp;<span class="op" id="4998991">(</span><span class="op" id="4998992">*</span><span class="ident" id="4998993"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4998999">,</span>&nbsp;<span class="builtintype" id="4999001">error</span><span class="op" id="4999006">)</span>&nbsp;<span class="op" id="4999008">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999011">conn</span><span class="op" id="4999015">,</span>&nbsp;<span class="ident" id="4999017">err</span>&nbsp;<span class="op" id="4999021">:=</span>&nbsp;<span class="ident" id="4999024"><a href="/net/rpc/client.go.html#4991965">net</a></span><span class="op" id="4999027">.</span><span class="ident" id="4999028">Dial</span><span class="op" id="4999032">(</span><span class="ident" id="4999033"><a href="/net/rpc/client.go.html#4998966">network</a></span><span class="op" id="4999040">,</span>&nbsp;<span class="ident" id="4999042"><a href="/net/rpc/client.go.html#4998975">address</a></span><span class="op" id="4999049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999052">if</span>&nbsp;<span class="ident" id="4999055"><a href="/net/rpc/client.go.html#4999017">err</a></span>&nbsp;<span class="op" id="4999059">!=</span>&nbsp;<span class="ident" id="4999062">nil</span>&nbsp;<span class="op" id="4999066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999070">return</span>&nbsp;<span class="ident" id="4999077">nil</span><span class="op" id="4999080">,</span>&nbsp;<span class="ident" id="4999082"><a href="/net/rpc/client.go.html#4999017">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999090">return</span>&nbsp;<span class="ident" id="4999097"><a href="/net/rpc/client.go.html#4996812">NewClient</a></span><span class="op" id="4999106">(</span><span class="ident" id="4999107"><a href="/net/rpc/client.go.html#4999011">conn</a></span><span class="op" id="4999111">)</span><span class="op" id="4999112">,</span>&nbsp;<span class="ident" id="4999114">nil</span><br>
<span class="lineno">275</span><span class="op" id="4999118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999121">func</span>&nbsp;<span class="op" id="4999126">(</span><span class="ident" id="4999127">client</span>&nbsp;<span class="op" id="4999134">*</span><span class="ident" id="4999135"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4999141">)</span>&nbsp;<span class="ident" id="4999143">Close</span><span class="op" id="4999148">(</span><span class="op" id="4999149">)</span>&nbsp;<span class="builtintype" id="4999151">error</span>&nbsp;<span class="op" id="4999157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999160"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999166">.</span><span class="ident" id="4999167">mutex</span><span class="op" id="4999172">.</span><span class="ident" id="4999173">Lock</span><span class="op" id="4999177">(</span><span class="op" id="4999178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999181">if</span>&nbsp;<span class="ident" id="4999184"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999190">.</span><span class="ident" id="4999191">closing</span>&nbsp;<span class="op" id="4999199">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999203"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999209">.</span><span class="ident" id="4999210">mutex</span><span class="op" id="4999215">.</span><span class="ident" id="4999216">Unlock</span><span class="op" id="4999222">(</span><span class="op" id="4999223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999227">return</span>&nbsp;<span class="ident" id="4999234"><a href="/net/rpc/client.go.html#4992187">ErrShutdown</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999250"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999256">.</span><span class="ident" id="4999257">closing</span>&nbsp;<span class="op" id="4999265">=</span>&nbsp;<span class="ident" id="4999267">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999273"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999279">.</span><span class="ident" id="4999280">mutex</span><span class="op" id="4999285">.</span><span class="ident" id="4999286">Unlock</span><span class="op" id="4999292">(</span><span class="op" id="4999293">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999296">return</span>&nbsp;<span class="ident" id="4999303"><a href="/net/rpc/client.go.html#4999127">client</a></span><span class="op" id="4999309">.</span><span class="ident" id="4999310">codec</span><span class="op" id="4999315">.</span><span class="ident" id="4999316">Close</span><span class="op" id="4999321">(</span><span class="op" id="4999322">)</span><br>
<span class="lineno"></span><span class="op" id="4999324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4999327">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="4999414">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="4999502">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="4999576">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="4999644">func</span>&nbsp;<span class="op" id="4999649">(</span><span class="ident" id="4999650">client</span>&nbsp;<span class="op" id="4999657">*</span><span class="ident" id="4999658"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="4999664">)</span>&nbsp;<span class="ident" id="4999666">Go</span><span class="op" id="4999668">(</span><span class="ident" id="4999669">serviceMethod</span>&nbsp;<span class="builtintype" id="4999683">string</span><span class="op" id="4999689">,</span>&nbsp;<span class="ident" id="4999691">args</span>&nbsp;<span class="keyword" id="4999696">interface</span><span class="op" id="4999705">{</span><span class="op" id="4999706">}</span><span class="op" id="4999707">,</span>&nbsp;<span class="ident" id="4999709">reply</span>&nbsp;<span class="keyword" id="4999715">interface</span><span class="op" id="4999724">{</span><span class="op" id="4999725">}</span><span class="op" id="4999726">,</span>&nbsp;<span class="ident" id="4999728">done</span>&nbsp;<span class="keyword" id="4999733">chan</span>&nbsp;<span class="op" id="4999738">*</span><span class="ident" id="4999739"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4999743">)</span>&nbsp;<span class="op" id="4999745">*</span><span class="ident" id="4999746"><a href="/net/rpc/client.go.html#4992279">Call</a></span>&nbsp;<span class="op" id="4999751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999754">call</span>&nbsp;<span class="op" id="4999759">:=</span>&nbsp;<span class="builtinfunc" id="4999762">new</span><span class="op" id="4999765">(</span><span class="ident" id="4999766"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4999770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999773"><a href="/net/rpc/client.go.html#4999754">call</a></span><span class="op" id="4999777">.</span><span class="ident" id="4999778">ServiceMethod</span>&nbsp;<span class="op" id="4999792">=</span>&nbsp;<span class="ident" id="4999794"><a href="/net/rpc/client.go.html#4999669">serviceMethod</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999809"><a href="/net/rpc/client.go.html#4999754">call</a></span><span class="op" id="4999813">.</span><span class="ident" id="4999814">Args</span>&nbsp;<span class="op" id="4999819">=</span>&nbsp;<span class="ident" id="4999821"><a href="/net/rpc/client.go.html#4999691">args</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999827"><a href="/net/rpc/client.go.html#4999754">call</a></span><span class="op" id="4999831">.</span><span class="ident" id="4999832">Reply</span>&nbsp;<span class="op" id="4999838">=</span>&nbsp;<span class="ident" id="4999840"><a href="/net/rpc/client.go.html#4999709">reply</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4999847">if</span>&nbsp;<span class="ident" id="4999850"><a href="/net/rpc/client.go.html#4999728">done</a></span>&nbsp;<span class="op" id="4999855">==</span>&nbsp;<span class="ident" id="4999858">nil</span>&nbsp;<span class="op" id="4999862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4999866"><a href="/net/rpc/client.go.html#4999728">done</a></span>&nbsp;<span class="op" id="4999871">=</span>&nbsp;<span class="builtinfunc" id="4999873">make</span><span class="op" id="4999877">(</span><span class="keyword" id="4999878">chan</span>&nbsp;<span class="op" id="4999883">*</span><span class="ident" id="4999884"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="4999888">,</span>&nbsp;<span class="num" id="4999890">10</span><span class="op" id="4999892">)</span>&nbsp;<span class="comment" id="4999894">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4999908">}</span>&nbsp;<span class="keyword" id="4999910">else</span>&nbsp;<span class="op" id="4999915">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4999919">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4999975">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000034">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5000093">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000150">if</span>&nbsp;<span class="builtinfunc" id="5000153">cap</span><span class="op" id="5000156">(</span><span class="ident" id="5000157"><a href="/net/rpc/client.go.html#4999728">done</a></span><span class="op" id="5000161">)</span>&nbsp;<span class="op" id="5000163">==</span>&nbsp;<span class="num" id="5000166">0</span>&nbsp;<span class="op" id="5000168">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000173"><a href="/net/rpc/client.go.html#4991958">log</a></span><span class="op" id="5000176">.</span><span class="ident" id="5000177">Panic</span><span class="op" id="5000182">(</span><span class="string" id="5000183">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5000216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5000223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000226"><a href="/net/rpc/client.go.html#4999754">call</a></span><span class="op" id="5000230">.</span><span class="ident" id="5000231">Done</span>&nbsp;<span class="op" id="5000236">=</span>&nbsp;<span class="ident" id="5000238"><a href="/net/rpc/client.go.html#4999728">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000244"><a href="/net/rpc/client.go.html#4999650">client</a></span><span class="op" id="5000250">.</span><span class="ident" id="5000251">send</span><span class="op" id="5000255">(</span><span class="ident" id="5000256"><a href="/net/rpc/client.go.html#4999754">call</a></span><span class="op" id="5000260">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000263">return</span>&nbsp;<span class="ident" id="5000270"><a href="/net/rpc/client.go.html#4999754">call</a></span><br>
<span class="lineno"></span><span class="op" id="5000275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5000278">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5000370">func</span>&nbsp;<span class="op" id="5000375">(</span><span class="ident" id="5000376">client</span>&nbsp;<span class="op" id="5000383">*</span><span class="ident" id="5000384"><a href="/net/rpc/client.go.html#4992823">Client</a></span><span class="op" id="5000390">)</span>&nbsp;<span class="ident" id="5000392">Call</span><span class="op" id="5000396">(</span><span class="ident" id="5000397">serviceMethod</span>&nbsp;<span class="builtintype" id="5000411">string</span><span class="op" id="5000417">,</span>&nbsp;<span class="ident" id="5000419">args</span>&nbsp;<span class="keyword" id="5000424">interface</span><span class="op" id="5000433">{</span><span class="op" id="5000434">}</span><span class="op" id="5000435">,</span>&nbsp;<span class="ident" id="5000437">reply</span>&nbsp;<span class="keyword" id="5000443">interface</span><span class="op" id="5000452">{</span><span class="op" id="5000453">}</span><span class="op" id="5000454">)</span>&nbsp;<span class="builtintype" id="5000456">error</span>&nbsp;<span class="op" id="5000462">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5000465">call</span>&nbsp;<span class="op" id="5000470">:=</span>&nbsp;<span class="op" id="5000473">&lt;-</span><span class="ident" id="5000475"><a href="/net/rpc/client.go.html#5000376">client</a></span><span class="op" id="5000481">.</span><span class="ident" id="5000482">Go</span><span class="op" id="5000484">(</span><span class="ident" id="5000485"><a href="/net/rpc/client.go.html#5000397">serviceMethod</a></span><span class="op" id="5000498">,</span>&nbsp;<span class="ident" id="5000500"><a href="/net/rpc/client.go.html#5000419">args</a></span><span class="op" id="5000504">,</span>&nbsp;<span class="ident" id="5000506"><a href="/net/rpc/client.go.html#5000437">reply</a></span><span class="op" id="5000511">,</span>&nbsp;<span class="builtinfunc" id="5000513">make</span><span class="op" id="5000517">(</span><span class="keyword" id="5000518">chan</span>&nbsp;<span class="op" id="5000523">*</span><span class="ident" id="5000524"><a href="/net/rpc/client.go.html#4992279">Call</a></span><span class="op" id="5000528">,</span>&nbsp;<span class="num" id="5000530">1</span><span class="op" id="5000531">)</span><span class="op" id="5000532">)</span><span class="op" id="5000533">.</span><span class="ident" id="5000534">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5000540">return</span>&nbsp;<span class="ident" id="5000547"><a href="/net/rpc/client.go.html#5000465">call</a></span><span class="op" id="5000551">.</span><span class="ident" id="5000552">Error</span><br>
<span class="lineno"></span><span class="op" id="5000558">}</span>
</div>
</body>
</html>
