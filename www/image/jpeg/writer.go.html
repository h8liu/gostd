<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6319787">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6319842">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6319896">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6319947">package</span>&nbsp;<span class="ident" id="6319955">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6319961">import</span>&nbsp;<span class="op" id="6319968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6319971">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6319980">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6319990">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6319999">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6320014">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6320019">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6320022">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="6320066">func</span>&nbsp;<span class="ident" id="6320071">min</span><span class="op" id="6320074">(</span><span class="ident" id="6320075">x</span><span class="op" id="6320076">,</span>&nbsp;<span class="ident" id="6320078">y</span>&nbsp;<span class="builtintype" id="6320080">int</span><span class="op" id="6320083">)</span>&nbsp;<span class="builtintype" id="6320085">int</span>&nbsp;<span class="op" id="6320089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320092">if</span>&nbsp;<span class="ident" id="6320095">x</span>&nbsp;<span class="op" id="6320097">&lt;</span>&nbsp;<span class="ident" id="6320099">y</span>&nbsp;<span class="op" id="6320101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320105">return</span>&nbsp;<span class="ident" id="6320112">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320115">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320118">return</span>&nbsp;<span class="ident" id="6320125">y</span><br>
<span class="lineno"></span><span class="op" id="6320127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6320130">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="6320209">func</span>&nbsp;<span class="ident" id="6320214">div</span><span class="op" id="6320217">(</span><span class="ident" id="6320218">a</span><span class="op" id="6320219">,</span>&nbsp;<span class="ident" id="6320221">b</span>&nbsp;<span class="builtintype" id="6320223">int32</span><span class="op" id="6320228">)</span>&nbsp;<span class="builtintype" id="6320230">int32</span>&nbsp;<span class="op" id="6320236">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320239">if</span>&nbsp;<span class="ident" id="6320242">a</span>&nbsp;<span class="op" id="6320244">&gt;=</span>&nbsp;<span class="num" id="6320247">0</span>&nbsp;<span class="op" id="6320249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320253">return</span>&nbsp;<span class="op" id="6320260">(</span><span class="ident" id="6320261">a</span>&nbsp;<span class="op" id="6320263">+</span>&nbsp;<span class="op" id="6320265">(</span><span class="ident" id="6320266">b</span>&nbsp;<span class="op" id="6320268">&gt;&gt;</span>&nbsp;<span class="num" id="6320271">1</span><span class="op" id="6320272">)</span><span class="op" id="6320273">)</span>&nbsp;<span class="op" id="6320275">/</span>&nbsp;<span class="ident" id="6320277">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6320280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6320283">return</span>&nbsp;<span class="op" id="6320290">-</span><span class="op" id="6320291">(</span><span class="op" id="6320292">(</span><span class="op" id="6320293">-</span><span class="ident" id="6320294">a</span>&nbsp;<span class="op" id="6320296">+</span>&nbsp;<span class="op" id="6320298">(</span><span class="ident" id="6320299">b</span>&nbsp;<span class="op" id="6320301">&gt;&gt;</span>&nbsp;<span class="num" id="6320304">1</span><span class="op" id="6320305">)</span><span class="op" id="6320306">)</span>&nbsp;<span class="op" id="6320308">/</span>&nbsp;<span class="ident" id="6320310">b</span><span class="op" id="6320311">)</span><br>
<span class="lineno"></span><span class="op" id="6320313">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6320316">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="6320381">var</span>&nbsp;<span class="ident" id="6320385">bitCount</span>&nbsp;<span class="op" id="6320394">=</span>&nbsp;<span class="op" id="6320396">[</span><span class="num" id="6320397">256</span><span class="op" id="6320400">]</span><span class="builtintype" id="6320401">byte</span><span class="op" id="6320405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320408">0</span><span class="op" id="6320409">,</span>&nbsp;<span class="num" id="6320411">1</span><span class="op" id="6320412">,</span>&nbsp;<span class="num" id="6320414">2</span><span class="op" id="6320415">,</span>&nbsp;<span class="num" id="6320417">2</span><span class="op" id="6320418">,</span>&nbsp;<span class="num" id="6320420">3</span><span class="op" id="6320421">,</span>&nbsp;<span class="num" id="6320423">3</span><span class="op" id="6320424">,</span>&nbsp;<span class="num" id="6320426">3</span><span class="op" id="6320427">,</span>&nbsp;<span class="num" id="6320429">3</span><span class="op" id="6320430">,</span>&nbsp;<span class="num" id="6320432">4</span><span class="op" id="6320433">,</span>&nbsp;<span class="num" id="6320435">4</span><span class="op" id="6320436">,</span>&nbsp;<span class="num" id="6320438">4</span><span class="op" id="6320439">,</span>&nbsp;<span class="num" id="6320441">4</span><span class="op" id="6320442">,</span>&nbsp;<span class="num" id="6320444">4</span><span class="op" id="6320445">,</span>&nbsp;<span class="num" id="6320447">4</span><span class="op" id="6320448">,</span>&nbsp;<span class="num" id="6320450">4</span><span class="op" id="6320451">,</span>&nbsp;<span class="num" id="6320453">4</span><span class="op" id="6320454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320457">5</span><span class="op" id="6320458">,</span>&nbsp;<span class="num" id="6320460">5</span><span class="op" id="6320461">,</span>&nbsp;<span class="num" id="6320463">5</span><span class="op" id="6320464">,</span>&nbsp;<span class="num" id="6320466">5</span><span class="op" id="6320467">,</span>&nbsp;<span class="num" id="6320469">5</span><span class="op" id="6320470">,</span>&nbsp;<span class="num" id="6320472">5</span><span class="op" id="6320473">,</span>&nbsp;<span class="num" id="6320475">5</span><span class="op" id="6320476">,</span>&nbsp;<span class="num" id="6320478">5</span><span class="op" id="6320479">,</span>&nbsp;<span class="num" id="6320481">5</span><span class="op" id="6320482">,</span>&nbsp;<span class="num" id="6320484">5</span><span class="op" id="6320485">,</span>&nbsp;<span class="num" id="6320487">5</span><span class="op" id="6320488">,</span>&nbsp;<span class="num" id="6320490">5</span><span class="op" id="6320491">,</span>&nbsp;<span class="num" id="6320493">5</span><span class="op" id="6320494">,</span>&nbsp;<span class="num" id="6320496">5</span><span class="op" id="6320497">,</span>&nbsp;<span class="num" id="6320499">5</span><span class="op" id="6320500">,</span>&nbsp;<span class="num" id="6320502">5</span><span class="op" id="6320503">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320506">6</span><span class="op" id="6320507">,</span>&nbsp;<span class="num" id="6320509">6</span><span class="op" id="6320510">,</span>&nbsp;<span class="num" id="6320512">6</span><span class="op" id="6320513">,</span>&nbsp;<span class="num" id="6320515">6</span><span class="op" id="6320516">,</span>&nbsp;<span class="num" id="6320518">6</span><span class="op" id="6320519">,</span>&nbsp;<span class="num" id="6320521">6</span><span class="op" id="6320522">,</span>&nbsp;<span class="num" id="6320524">6</span><span class="op" id="6320525">,</span>&nbsp;<span class="num" id="6320527">6</span><span class="op" id="6320528">,</span>&nbsp;<span class="num" id="6320530">6</span><span class="op" id="6320531">,</span>&nbsp;<span class="num" id="6320533">6</span><span class="op" id="6320534">,</span>&nbsp;<span class="num" id="6320536">6</span><span class="op" id="6320537">,</span>&nbsp;<span class="num" id="6320539">6</span><span class="op" id="6320540">,</span>&nbsp;<span class="num" id="6320542">6</span><span class="op" id="6320543">,</span>&nbsp;<span class="num" id="6320545">6</span><span class="op" id="6320546">,</span>&nbsp;<span class="num" id="6320548">6</span><span class="op" id="6320549">,</span>&nbsp;<span class="num" id="6320551">6</span><span class="op" id="6320552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320555">6</span><span class="op" id="6320556">,</span>&nbsp;<span class="num" id="6320558">6</span><span class="op" id="6320559">,</span>&nbsp;<span class="num" id="6320561">6</span><span class="op" id="6320562">,</span>&nbsp;<span class="num" id="6320564">6</span><span class="op" id="6320565">,</span>&nbsp;<span class="num" id="6320567">6</span><span class="op" id="6320568">,</span>&nbsp;<span class="num" id="6320570">6</span><span class="op" id="6320571">,</span>&nbsp;<span class="num" id="6320573">6</span><span class="op" id="6320574">,</span>&nbsp;<span class="num" id="6320576">6</span><span class="op" id="6320577">,</span>&nbsp;<span class="num" id="6320579">6</span><span class="op" id="6320580">,</span>&nbsp;<span class="num" id="6320582">6</span><span class="op" id="6320583">,</span>&nbsp;<span class="num" id="6320585">6</span><span class="op" id="6320586">,</span>&nbsp;<span class="num" id="6320588">6</span><span class="op" id="6320589">,</span>&nbsp;<span class="num" id="6320591">6</span><span class="op" id="6320592">,</span>&nbsp;<span class="num" id="6320594">6</span><span class="op" id="6320595">,</span>&nbsp;<span class="num" id="6320597">6</span><span class="op" id="6320598">,</span>&nbsp;<span class="num" id="6320600">6</span><span class="op" id="6320601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320604">7</span><span class="op" id="6320605">,</span>&nbsp;<span class="num" id="6320607">7</span><span class="op" id="6320608">,</span>&nbsp;<span class="num" id="6320610">7</span><span class="op" id="6320611">,</span>&nbsp;<span class="num" id="6320613">7</span><span class="op" id="6320614">,</span>&nbsp;<span class="num" id="6320616">7</span><span class="op" id="6320617">,</span>&nbsp;<span class="num" id="6320619">7</span><span class="op" id="6320620">,</span>&nbsp;<span class="num" id="6320622">7</span><span class="op" id="6320623">,</span>&nbsp;<span class="num" id="6320625">7</span><span class="op" id="6320626">,</span>&nbsp;<span class="num" id="6320628">7</span><span class="op" id="6320629">,</span>&nbsp;<span class="num" id="6320631">7</span><span class="op" id="6320632">,</span>&nbsp;<span class="num" id="6320634">7</span><span class="op" id="6320635">,</span>&nbsp;<span class="num" id="6320637">7</span><span class="op" id="6320638">,</span>&nbsp;<span class="num" id="6320640">7</span><span class="op" id="6320641">,</span>&nbsp;<span class="num" id="6320643">7</span><span class="op" id="6320644">,</span>&nbsp;<span class="num" id="6320646">7</span><span class="op" id="6320647">,</span>&nbsp;<span class="num" id="6320649">7</span><span class="op" id="6320650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320653">7</span><span class="op" id="6320654">,</span>&nbsp;<span class="num" id="6320656">7</span><span class="op" id="6320657">,</span>&nbsp;<span class="num" id="6320659">7</span><span class="op" id="6320660">,</span>&nbsp;<span class="num" id="6320662">7</span><span class="op" id="6320663">,</span>&nbsp;<span class="num" id="6320665">7</span><span class="op" id="6320666">,</span>&nbsp;<span class="num" id="6320668">7</span><span class="op" id="6320669">,</span>&nbsp;<span class="num" id="6320671">7</span><span class="op" id="6320672">,</span>&nbsp;<span class="num" id="6320674">7</span><span class="op" id="6320675">,</span>&nbsp;<span class="num" id="6320677">7</span><span class="op" id="6320678">,</span>&nbsp;<span class="num" id="6320680">7</span><span class="op" id="6320681">,</span>&nbsp;<span class="num" id="6320683">7</span><span class="op" id="6320684">,</span>&nbsp;<span class="num" id="6320686">7</span><span class="op" id="6320687">,</span>&nbsp;<span class="num" id="6320689">7</span><span class="op" id="6320690">,</span>&nbsp;<span class="num" id="6320692">7</span><span class="op" id="6320693">,</span>&nbsp;<span class="num" id="6320695">7</span><span class="op" id="6320696">,</span>&nbsp;<span class="num" id="6320698">7</span><span class="op" id="6320699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320702">7</span><span class="op" id="6320703">,</span>&nbsp;<span class="num" id="6320705">7</span><span class="op" id="6320706">,</span>&nbsp;<span class="num" id="6320708">7</span><span class="op" id="6320709">,</span>&nbsp;<span class="num" id="6320711">7</span><span class="op" id="6320712">,</span>&nbsp;<span class="num" id="6320714">7</span><span class="op" id="6320715">,</span>&nbsp;<span class="num" id="6320717">7</span><span class="op" id="6320718">,</span>&nbsp;<span class="num" id="6320720">7</span><span class="op" id="6320721">,</span>&nbsp;<span class="num" id="6320723">7</span><span class="op" id="6320724">,</span>&nbsp;<span class="num" id="6320726">7</span><span class="op" id="6320727">,</span>&nbsp;<span class="num" id="6320729">7</span><span class="op" id="6320730">,</span>&nbsp;<span class="num" id="6320732">7</span><span class="op" id="6320733">,</span>&nbsp;<span class="num" id="6320735">7</span><span class="op" id="6320736">,</span>&nbsp;<span class="num" id="6320738">7</span><span class="op" id="6320739">,</span>&nbsp;<span class="num" id="6320741">7</span><span class="op" id="6320742">,</span>&nbsp;<span class="num" id="6320744">7</span><span class="op" id="6320745">,</span>&nbsp;<span class="num" id="6320747">7</span><span class="op" id="6320748">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320751">7</span><span class="op" id="6320752">,</span>&nbsp;<span class="num" id="6320754">7</span><span class="op" id="6320755">,</span>&nbsp;<span class="num" id="6320757">7</span><span class="op" id="6320758">,</span>&nbsp;<span class="num" id="6320760">7</span><span class="op" id="6320761">,</span>&nbsp;<span class="num" id="6320763">7</span><span class="op" id="6320764">,</span>&nbsp;<span class="num" id="6320766">7</span><span class="op" id="6320767">,</span>&nbsp;<span class="num" id="6320769">7</span><span class="op" id="6320770">,</span>&nbsp;<span class="num" id="6320772">7</span><span class="op" id="6320773">,</span>&nbsp;<span class="num" id="6320775">7</span><span class="op" id="6320776">,</span>&nbsp;<span class="num" id="6320778">7</span><span class="op" id="6320779">,</span>&nbsp;<span class="num" id="6320781">7</span><span class="op" id="6320782">,</span>&nbsp;<span class="num" id="6320784">7</span><span class="op" id="6320785">,</span>&nbsp;<span class="num" id="6320787">7</span><span class="op" id="6320788">,</span>&nbsp;<span class="num" id="6320790">7</span><span class="op" id="6320791">,</span>&nbsp;<span class="num" id="6320793">7</span><span class="op" id="6320794">,</span>&nbsp;<span class="num" id="6320796">7</span><span class="op" id="6320797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320800">8</span><span class="op" id="6320801">,</span>&nbsp;<span class="num" id="6320803">8</span><span class="op" id="6320804">,</span>&nbsp;<span class="num" id="6320806">8</span><span class="op" id="6320807">,</span>&nbsp;<span class="num" id="6320809">8</span><span class="op" id="6320810">,</span>&nbsp;<span class="num" id="6320812">8</span><span class="op" id="6320813">,</span>&nbsp;<span class="num" id="6320815">8</span><span class="op" id="6320816">,</span>&nbsp;<span class="num" id="6320818">8</span><span class="op" id="6320819">,</span>&nbsp;<span class="num" id="6320821">8</span><span class="op" id="6320822">,</span>&nbsp;<span class="num" id="6320824">8</span><span class="op" id="6320825">,</span>&nbsp;<span class="num" id="6320827">8</span><span class="op" id="6320828">,</span>&nbsp;<span class="num" id="6320830">8</span><span class="op" id="6320831">,</span>&nbsp;<span class="num" id="6320833">8</span><span class="op" id="6320834">,</span>&nbsp;<span class="num" id="6320836">8</span><span class="op" id="6320837">,</span>&nbsp;<span class="num" id="6320839">8</span><span class="op" id="6320840">,</span>&nbsp;<span class="num" id="6320842">8</span><span class="op" id="6320843">,</span>&nbsp;<span class="num" id="6320845">8</span><span class="op" id="6320846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320849">8</span><span class="op" id="6320850">,</span>&nbsp;<span class="num" id="6320852">8</span><span class="op" id="6320853">,</span>&nbsp;<span class="num" id="6320855">8</span><span class="op" id="6320856">,</span>&nbsp;<span class="num" id="6320858">8</span><span class="op" id="6320859">,</span>&nbsp;<span class="num" id="6320861">8</span><span class="op" id="6320862">,</span>&nbsp;<span class="num" id="6320864">8</span><span class="op" id="6320865">,</span>&nbsp;<span class="num" id="6320867">8</span><span class="op" id="6320868">,</span>&nbsp;<span class="num" id="6320870">8</span><span class="op" id="6320871">,</span>&nbsp;<span class="num" id="6320873">8</span><span class="op" id="6320874">,</span>&nbsp;<span class="num" id="6320876">8</span><span class="op" id="6320877">,</span>&nbsp;<span class="num" id="6320879">8</span><span class="op" id="6320880">,</span>&nbsp;<span class="num" id="6320882">8</span><span class="op" id="6320883">,</span>&nbsp;<span class="num" id="6320885">8</span><span class="op" id="6320886">,</span>&nbsp;<span class="num" id="6320888">8</span><span class="op" id="6320889">,</span>&nbsp;<span class="num" id="6320891">8</span><span class="op" id="6320892">,</span>&nbsp;<span class="num" id="6320894">8</span><span class="op" id="6320895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320898">8</span><span class="op" id="6320899">,</span>&nbsp;<span class="num" id="6320901">8</span><span class="op" id="6320902">,</span>&nbsp;<span class="num" id="6320904">8</span><span class="op" id="6320905">,</span>&nbsp;<span class="num" id="6320907">8</span><span class="op" id="6320908">,</span>&nbsp;<span class="num" id="6320910">8</span><span class="op" id="6320911">,</span>&nbsp;<span class="num" id="6320913">8</span><span class="op" id="6320914">,</span>&nbsp;<span class="num" id="6320916">8</span><span class="op" id="6320917">,</span>&nbsp;<span class="num" id="6320919">8</span><span class="op" id="6320920">,</span>&nbsp;<span class="num" id="6320922">8</span><span class="op" id="6320923">,</span>&nbsp;<span class="num" id="6320925">8</span><span class="op" id="6320926">,</span>&nbsp;<span class="num" id="6320928">8</span><span class="op" id="6320929">,</span>&nbsp;<span class="num" id="6320931">8</span><span class="op" id="6320932">,</span>&nbsp;<span class="num" id="6320934">8</span><span class="op" id="6320935">,</span>&nbsp;<span class="num" id="6320937">8</span><span class="op" id="6320938">,</span>&nbsp;<span class="num" id="6320940">8</span><span class="op" id="6320941">,</span>&nbsp;<span class="num" id="6320943">8</span><span class="op" id="6320944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320947">8</span><span class="op" id="6320948">,</span>&nbsp;<span class="num" id="6320950">8</span><span class="op" id="6320951">,</span>&nbsp;<span class="num" id="6320953">8</span><span class="op" id="6320954">,</span>&nbsp;<span class="num" id="6320956">8</span><span class="op" id="6320957">,</span>&nbsp;<span class="num" id="6320959">8</span><span class="op" id="6320960">,</span>&nbsp;<span class="num" id="6320962">8</span><span class="op" id="6320963">,</span>&nbsp;<span class="num" id="6320965">8</span><span class="op" id="6320966">,</span>&nbsp;<span class="num" id="6320968">8</span><span class="op" id="6320969">,</span>&nbsp;<span class="num" id="6320971">8</span><span class="op" id="6320972">,</span>&nbsp;<span class="num" id="6320974">8</span><span class="op" id="6320975">,</span>&nbsp;<span class="num" id="6320977">8</span><span class="op" id="6320978">,</span>&nbsp;<span class="num" id="6320980">8</span><span class="op" id="6320981">,</span>&nbsp;<span class="num" id="6320983">8</span><span class="op" id="6320984">,</span>&nbsp;<span class="num" id="6320986">8</span><span class="op" id="6320987">,</span>&nbsp;<span class="num" id="6320989">8</span><span class="op" id="6320990">,</span>&nbsp;<span class="num" id="6320992">8</span><span class="op" id="6320993">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6320996">8</span><span class="op" id="6320997">,</span>&nbsp;<span class="num" id="6320999">8</span><span class="op" id="6321000">,</span>&nbsp;<span class="num" id="6321002">8</span><span class="op" id="6321003">,</span>&nbsp;<span class="num" id="6321005">8</span><span class="op" id="6321006">,</span>&nbsp;<span class="num" id="6321008">8</span><span class="op" id="6321009">,</span>&nbsp;<span class="num" id="6321011">8</span><span class="op" id="6321012">,</span>&nbsp;<span class="num" id="6321014">8</span><span class="op" id="6321015">,</span>&nbsp;<span class="num" id="6321017">8</span><span class="op" id="6321018">,</span>&nbsp;<span class="num" id="6321020">8</span><span class="op" id="6321021">,</span>&nbsp;<span class="num" id="6321023">8</span><span class="op" id="6321024">,</span>&nbsp;<span class="num" id="6321026">8</span><span class="op" id="6321027">,</span>&nbsp;<span class="num" id="6321029">8</span><span class="op" id="6321030">,</span>&nbsp;<span class="num" id="6321032">8</span><span class="op" id="6321033">,</span>&nbsp;<span class="num" id="6321035">8</span><span class="op" id="6321036">,</span>&nbsp;<span class="num" id="6321038">8</span><span class="op" id="6321039">,</span>&nbsp;<span class="num" id="6321041">8</span><span class="op" id="6321042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321045">8</span><span class="op" id="6321046">,</span>&nbsp;<span class="num" id="6321048">8</span><span class="op" id="6321049">,</span>&nbsp;<span class="num" id="6321051">8</span><span class="op" id="6321052">,</span>&nbsp;<span class="num" id="6321054">8</span><span class="op" id="6321055">,</span>&nbsp;<span class="num" id="6321057">8</span><span class="op" id="6321058">,</span>&nbsp;<span class="num" id="6321060">8</span><span class="op" id="6321061">,</span>&nbsp;<span class="num" id="6321063">8</span><span class="op" id="6321064">,</span>&nbsp;<span class="num" id="6321066">8</span><span class="op" id="6321067">,</span>&nbsp;<span class="num" id="6321069">8</span><span class="op" id="6321070">,</span>&nbsp;<span class="num" id="6321072">8</span><span class="op" id="6321073">,</span>&nbsp;<span class="num" id="6321075">8</span><span class="op" id="6321076">,</span>&nbsp;<span class="num" id="6321078">8</span><span class="op" id="6321079">,</span>&nbsp;<span class="num" id="6321081">8</span><span class="op" id="6321082">,</span>&nbsp;<span class="num" id="6321084">8</span><span class="op" id="6321085">,</span>&nbsp;<span class="num" id="6321087">8</span><span class="op" id="6321088">,</span>&nbsp;<span class="num" id="6321090">8</span><span class="op" id="6321091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321094">8</span><span class="op" id="6321095">,</span>&nbsp;<span class="num" id="6321097">8</span><span class="op" id="6321098">,</span>&nbsp;<span class="num" id="6321100">8</span><span class="op" id="6321101">,</span>&nbsp;<span class="num" id="6321103">8</span><span class="op" id="6321104">,</span>&nbsp;<span class="num" id="6321106">8</span><span class="op" id="6321107">,</span>&nbsp;<span class="num" id="6321109">8</span><span class="op" id="6321110">,</span>&nbsp;<span class="num" id="6321112">8</span><span class="op" id="6321113">,</span>&nbsp;<span class="num" id="6321115">8</span><span class="op" id="6321116">,</span>&nbsp;<span class="num" id="6321118">8</span><span class="op" id="6321119">,</span>&nbsp;<span class="num" id="6321121">8</span><span class="op" id="6321122">,</span>&nbsp;<span class="num" id="6321124">8</span><span class="op" id="6321125">,</span>&nbsp;<span class="num" id="6321127">8</span><span class="op" id="6321128">,</span>&nbsp;<span class="num" id="6321130">8</span><span class="op" id="6321131">,</span>&nbsp;<span class="num" id="6321133">8</span><span class="op" id="6321134">,</span>&nbsp;<span class="num" id="6321136">8</span><span class="op" id="6321137">,</span>&nbsp;<span class="num" id="6321139">8</span><span class="op" id="6321140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321143">8</span><span class="op" id="6321144">,</span>&nbsp;<span class="num" id="6321146">8</span><span class="op" id="6321147">,</span>&nbsp;<span class="num" id="6321149">8</span><span class="op" id="6321150">,</span>&nbsp;<span class="num" id="6321152">8</span><span class="op" id="6321153">,</span>&nbsp;<span class="num" id="6321155">8</span><span class="op" id="6321156">,</span>&nbsp;<span class="num" id="6321158">8</span><span class="op" id="6321159">,</span>&nbsp;<span class="num" id="6321161">8</span><span class="op" id="6321162">,</span>&nbsp;<span class="num" id="6321164">8</span><span class="op" id="6321165">,</span>&nbsp;<span class="num" id="6321167">8</span><span class="op" id="6321168">,</span>&nbsp;<span class="num" id="6321170">8</span><span class="op" id="6321171">,</span>&nbsp;<span class="num" id="6321173">8</span><span class="op" id="6321174">,</span>&nbsp;<span class="num" id="6321176">8</span><span class="op" id="6321177">,</span>&nbsp;<span class="num" id="6321179">8</span><span class="op" id="6321180">,</span>&nbsp;<span class="num" id="6321182">8</span><span class="op" id="6321183">,</span>&nbsp;<span class="num" id="6321185">8</span><span class="op" id="6321186">,</span>&nbsp;<span class="num" id="6321188">8</span><span class="op" id="6321189">,</span><br>
<span class="lineno"></span><span class="op" id="6321191">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6321194">type</span>&nbsp;<span class="ident" id="6321199">quantIndex</span>&nbsp;<span class="builtintype" id="6321210">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6321215">const</span>&nbsp;<span class="op" id="6321221">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321224">quantIndexLuminance</span>&nbsp;<span class="ident" id="6321244">quantIndex</span>&nbsp;<span class="op" id="6321255">=</span>&nbsp;<span class="ident" id="6321257">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321263">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321286">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="6321298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6321301">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="6321378">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6321454">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6321530">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6321548">var</span>&nbsp;<span class="ident" id="6321552">unscaledQuant</span>&nbsp;<span class="op" id="6321566">=</span>&nbsp;<span class="op" id="6321568">[</span><span class="ident" id="6321569">nQuantIndex</span><span class="op" id="6321580">]</span><span class="op" id="6321581">[</span><span class="ident" id="6321582">blockSize</span><span class="op" id="6321591">]</span><span class="builtintype" id="6321592">byte</span><span class="op" id="6321596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6321599">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321618">16</span><span class="op" id="6321620">,</span>&nbsp;<span class="num" id="6321622">11</span><span class="op" id="6321624">,</span>&nbsp;<span class="num" id="6321626">12</span><span class="op" id="6321628">,</span>&nbsp;<span class="num" id="6321630">14</span><span class="op" id="6321632">,</span>&nbsp;<span class="num" id="6321634">12</span><span class="op" id="6321636">,</span>&nbsp;<span class="num" id="6321638">10</span><span class="op" id="6321640">,</span>&nbsp;<span class="num" id="6321642">16</span><span class="op" id="6321644">,</span>&nbsp;<span class="num" id="6321646">14</span><span class="op" id="6321648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321652">13</span><span class="op" id="6321654">,</span>&nbsp;<span class="num" id="6321656">14</span><span class="op" id="6321658">,</span>&nbsp;<span class="num" id="6321660">18</span><span class="op" id="6321662">,</span>&nbsp;<span class="num" id="6321664">17</span><span class="op" id="6321666">,</span>&nbsp;<span class="num" id="6321668">16</span><span class="op" id="6321670">,</span>&nbsp;<span class="num" id="6321672">19</span><span class="op" id="6321674">,</span>&nbsp;<span class="num" id="6321676">24</span><span class="op" id="6321678">,</span>&nbsp;<span class="num" id="6321680">40</span><span class="op" id="6321682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321686">26</span><span class="op" id="6321688">,</span>&nbsp;<span class="num" id="6321690">24</span><span class="op" id="6321692">,</span>&nbsp;<span class="num" id="6321694">22</span><span class="op" id="6321696">,</span>&nbsp;<span class="num" id="6321698">22</span><span class="op" id="6321700">,</span>&nbsp;<span class="num" id="6321702">24</span><span class="op" id="6321704">,</span>&nbsp;<span class="num" id="6321706">49</span><span class="op" id="6321708">,</span>&nbsp;<span class="num" id="6321710">35</span><span class="op" id="6321712">,</span>&nbsp;<span class="num" id="6321714">37</span><span class="op" id="6321716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321720">29</span><span class="op" id="6321722">,</span>&nbsp;<span class="num" id="6321724">40</span><span class="op" id="6321726">,</span>&nbsp;<span class="num" id="6321728">58</span><span class="op" id="6321730">,</span>&nbsp;<span class="num" id="6321732">51</span><span class="op" id="6321734">,</span>&nbsp;<span class="num" id="6321736">61</span><span class="op" id="6321738">,</span>&nbsp;<span class="num" id="6321740">60</span><span class="op" id="6321742">,</span>&nbsp;<span class="num" id="6321744">57</span><span class="op" id="6321746">,</span>&nbsp;<span class="num" id="6321748">51</span><span class="op" id="6321750">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321754">56</span><span class="op" id="6321756">,</span>&nbsp;<span class="num" id="6321758">55</span><span class="op" id="6321760">,</span>&nbsp;<span class="num" id="6321762">64</span><span class="op" id="6321764">,</span>&nbsp;<span class="num" id="6321766">72</span><span class="op" id="6321768">,</span>&nbsp;<span class="num" id="6321770">92</span><span class="op" id="6321772">,</span>&nbsp;<span class="num" id="6321774">78</span><span class="op" id="6321776">,</span>&nbsp;<span class="num" id="6321778">64</span><span class="op" id="6321780">,</span>&nbsp;<span class="num" id="6321782">68</span><span class="op" id="6321784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321788">87</span><span class="op" id="6321790">,</span>&nbsp;<span class="num" id="6321792">69</span><span class="op" id="6321794">,</span>&nbsp;<span class="num" id="6321796">55</span><span class="op" id="6321798">,</span>&nbsp;<span class="num" id="6321800">56</span><span class="op" id="6321802">,</span>&nbsp;<span class="num" id="6321804">80</span><span class="op" id="6321806">,</span>&nbsp;<span class="num" id="6321808">109</span><span class="op" id="6321811">,</span>&nbsp;<span class="num" id="6321813">81</span><span class="op" id="6321815">,</span>&nbsp;<span class="num" id="6321817">87</span><span class="op" id="6321819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321823">95</span><span class="op" id="6321825">,</span>&nbsp;<span class="num" id="6321827">98</span><span class="op" id="6321829">,</span>&nbsp;<span class="num" id="6321831">103</span><span class="op" id="6321834">,</span>&nbsp;<span class="num" id="6321836">104</span><span class="op" id="6321839">,</span>&nbsp;<span class="num" id="6321841">103</span><span class="op" id="6321844">,</span>&nbsp;<span class="num" id="6321846">62</span><span class="op" id="6321848">,</span>&nbsp;<span class="num" id="6321850">77</span><span class="op" id="6321852">,</span>&nbsp;<span class="num" id="6321854">113</span><span class="op" id="6321857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321861">121</span><span class="op" id="6321864">,</span>&nbsp;<span class="num" id="6321866">112</span><span class="op" id="6321869">,</span>&nbsp;<span class="num" id="6321871">100</span><span class="op" id="6321874">,</span>&nbsp;<span class="num" id="6321876">120</span><span class="op" id="6321879">,</span>&nbsp;<span class="num" id="6321881">92</span><span class="op" id="6321883">,</span>&nbsp;<span class="num" id="6321885">101</span><span class="op" id="6321888">,</span>&nbsp;<span class="num" id="6321890">103</span><span class="op" id="6321893">,</span>&nbsp;<span class="num" id="6321895">99</span><span class="op" id="6321897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321900">}</span><span class="op" id="6321901">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6321904">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6321921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321925">17</span><span class="op" id="6321927">,</span>&nbsp;<span class="num" id="6321929">18</span><span class="op" id="6321931">,</span>&nbsp;<span class="num" id="6321933">18</span><span class="op" id="6321935">,</span>&nbsp;<span class="num" id="6321937">24</span><span class="op" id="6321939">,</span>&nbsp;<span class="num" id="6321941">21</span><span class="op" id="6321943">,</span>&nbsp;<span class="num" id="6321945">24</span><span class="op" id="6321947">,</span>&nbsp;<span class="num" id="6321949">47</span><span class="op" id="6321951">,</span>&nbsp;<span class="num" id="6321953">26</span><span class="op" id="6321955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321959">26</span><span class="op" id="6321961">,</span>&nbsp;<span class="num" id="6321963">47</span><span class="op" id="6321965">,</span>&nbsp;<span class="num" id="6321967">99</span><span class="op" id="6321969">,</span>&nbsp;<span class="num" id="6321971">66</span><span class="op" id="6321973">,</span>&nbsp;<span class="num" id="6321975">56</span><span class="op" id="6321977">,</span>&nbsp;<span class="num" id="6321979">66</span><span class="op" id="6321981">,</span>&nbsp;<span class="num" id="6321983">99</span><span class="op" id="6321985">,</span>&nbsp;<span class="num" id="6321987">99</span><span class="op" id="6321989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6321993">99</span><span class="op" id="6321995">,</span>&nbsp;<span class="num" id="6321997">99</span><span class="op" id="6321999">,</span>&nbsp;<span class="num" id="6322001">99</span><span class="op" id="6322003">,</span>&nbsp;<span class="num" id="6322005">99</span><span class="op" id="6322007">,</span>&nbsp;<span class="num" id="6322009">99</span><span class="op" id="6322011">,</span>&nbsp;<span class="num" id="6322013">99</span><span class="op" id="6322015">,</span>&nbsp;<span class="num" id="6322017">99</span><span class="op" id="6322019">,</span>&nbsp;<span class="num" id="6322021">99</span><span class="op" id="6322023">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322027">99</span><span class="op" id="6322029">,</span>&nbsp;<span class="num" id="6322031">99</span><span class="op" id="6322033">,</span>&nbsp;<span class="num" id="6322035">99</span><span class="op" id="6322037">,</span>&nbsp;<span class="num" id="6322039">99</span><span class="op" id="6322041">,</span>&nbsp;<span class="num" id="6322043">99</span><span class="op" id="6322045">,</span>&nbsp;<span class="num" id="6322047">99</span><span class="op" id="6322049">,</span>&nbsp;<span class="num" id="6322051">99</span><span class="op" id="6322053">,</span>&nbsp;<span class="num" id="6322055">99</span><span class="op" id="6322057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322061">99</span><span class="op" id="6322063">,</span>&nbsp;<span class="num" id="6322065">99</span><span class="op" id="6322067">,</span>&nbsp;<span class="num" id="6322069">99</span><span class="op" id="6322071">,</span>&nbsp;<span class="num" id="6322073">99</span><span class="op" id="6322075">,</span>&nbsp;<span class="num" id="6322077">99</span><span class="op" id="6322079">,</span>&nbsp;<span class="num" id="6322081">99</span><span class="op" id="6322083">,</span>&nbsp;<span class="num" id="6322085">99</span><span class="op" id="6322087">,</span>&nbsp;<span class="num" id="6322089">99</span><span class="op" id="6322091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322095">99</span><span class="op" id="6322097">,</span>&nbsp;<span class="num" id="6322099">99</span><span class="op" id="6322101">,</span>&nbsp;<span class="num" id="6322103">99</span><span class="op" id="6322105">,</span>&nbsp;<span class="num" id="6322107">99</span><span class="op" id="6322109">,</span>&nbsp;<span class="num" id="6322111">99</span><span class="op" id="6322113">,</span>&nbsp;<span class="num" id="6322115">99</span><span class="op" id="6322117">,</span>&nbsp;<span class="num" id="6322119">99</span><span class="op" id="6322121">,</span>&nbsp;<span class="num" id="6322123">99</span><span class="op" id="6322125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322129">99</span><span class="op" id="6322131">,</span>&nbsp;<span class="num" id="6322133">99</span><span class="op" id="6322135">,</span>&nbsp;<span class="num" id="6322137">99</span><span class="op" id="6322139">,</span>&nbsp;<span class="num" id="6322141">99</span><span class="op" id="6322143">,</span>&nbsp;<span class="num" id="6322145">99</span><span class="op" id="6322147">,</span>&nbsp;<span class="num" id="6322149">99</span><span class="op" id="6322151">,</span>&nbsp;<span class="num" id="6322153">99</span><span class="op" id="6322155">,</span>&nbsp;<span class="num" id="6322157">99</span><span class="op" id="6322159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322163">99</span><span class="op" id="6322165">,</span>&nbsp;<span class="num" id="6322167">99</span><span class="op" id="6322169">,</span>&nbsp;<span class="num" id="6322171">99</span><span class="op" id="6322173">,</span>&nbsp;<span class="num" id="6322175">99</span><span class="op" id="6322177">,</span>&nbsp;<span class="num" id="6322179">99</span><span class="op" id="6322181">,</span>&nbsp;<span class="num" id="6322183">99</span><span class="op" id="6322185">,</span>&nbsp;<span class="num" id="6322187">99</span><span class="op" id="6322189">,</span>&nbsp;<span class="num" id="6322191">99</span><span class="op" id="6322193">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322196">}</span><span class="op" id="6322197">,</span><br>
<span class="lineno"></span><span class="op" id="6322199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322202">type</span>&nbsp;<span class="ident" id="6322207">huffIndex</span>&nbsp;<span class="builtintype" id="6322217">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6322222">const</span>&nbsp;<span class="op" id="6322228">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322231">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="6322252">huffIndex</span>&nbsp;<span class="op" id="6322262">=</span>&nbsp;<span class="ident" id="6322264">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322270">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322292">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322316">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322340">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="6322351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322354">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="6322399">type</span>&nbsp;<span class="ident" id="6322404">huffmanSpec</span>&nbsp;<span class="keyword" id="6322416">struct</span>&nbsp;<span class="op" id="6322423">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322426">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322480">count</span>&nbsp;<span class="op" id="6322486">[</span><span class="num" id="6322487">16</span><span class="op" id="6322489">]</span><span class="builtintype" id="6322490">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322496">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322552">value</span>&nbsp;<span class="op" id="6322558">[</span><span class="op" id="6322559">]</span><span class="builtintype" id="6322560">byte</span><br>
<span class="lineno"></span><span class="op" id="6322565">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6322568">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="6322626">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6322689">var</span>&nbsp;<span class="ident" id="6322693">theHuffmanSpec</span>&nbsp;<span class="op" id="6322708">=</span>&nbsp;<span class="op" id="6322710">[</span><span class="ident" id="6322711">nHuffIndex</span><span class="op" id="6322721">]</span><span class="ident" id="6322722">huffmanSpec</span><span class="op" id="6322733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322736">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322758">[</span><span class="num" id="6322759">16</span><span class="op" id="6322761">]</span><span class="builtintype" id="6322762">byte</span><span class="op" id="6322766">{</span><span class="num" id="6322767">0</span><span class="op" id="6322768">,</span>&nbsp;<span class="num" id="6322770">1</span><span class="op" id="6322771">,</span>&nbsp;<span class="num" id="6322773">5</span><span class="op" id="6322774">,</span>&nbsp;<span class="num" id="6322776">1</span><span class="op" id="6322777">,</span>&nbsp;<span class="num" id="6322779">1</span><span class="op" id="6322780">,</span>&nbsp;<span class="num" id="6322782">1</span><span class="op" id="6322783">,</span>&nbsp;<span class="num" id="6322785">1</span><span class="op" id="6322786">,</span>&nbsp;<span class="num" id="6322788">1</span><span class="op" id="6322789">,</span>&nbsp;<span class="num" id="6322791">1</span><span class="op" id="6322792">,</span>&nbsp;<span class="num" id="6322794">0</span><span class="op" id="6322795">,</span>&nbsp;<span class="num" id="6322797">0</span><span class="op" id="6322798">,</span>&nbsp;<span class="num" id="6322800">0</span><span class="op" id="6322801">,</span>&nbsp;<span class="num" id="6322803">0</span><span class="op" id="6322804">,</span>&nbsp;<span class="num" id="6322806">0</span><span class="op" id="6322807">,</span>&nbsp;<span class="num" id="6322809">0</span><span class="op" id="6322810">,</span>&nbsp;<span class="num" id="6322812">0</span><span class="op" id="6322813">}</span><span class="op" id="6322814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322818">[</span><span class="op" id="6322819">]</span><span class="builtintype" id="6322820">byte</span><span class="op" id="6322824">{</span><span class="num" id="6322825">0</span><span class="op" id="6322826">,</span>&nbsp;<span class="num" id="6322828">1</span><span class="op" id="6322829">,</span>&nbsp;<span class="num" id="6322831">2</span><span class="op" id="6322832">,</span>&nbsp;<span class="num" id="6322834">3</span><span class="op" id="6322835">,</span>&nbsp;<span class="num" id="6322837">4</span><span class="op" id="6322838">,</span>&nbsp;<span class="num" id="6322840">5</span><span class="op" id="6322841">,</span>&nbsp;<span class="num" id="6322843">6</span><span class="op" id="6322844">,</span>&nbsp;<span class="num" id="6322846">7</span><span class="op" id="6322847">,</span>&nbsp;<span class="num" id="6322849">8</span><span class="op" id="6322850">,</span>&nbsp;<span class="num" id="6322852">9</span><span class="op" id="6322853">,</span>&nbsp;<span class="num" id="6322855">10</span><span class="op" id="6322857">,</span>&nbsp;<span class="num" id="6322859">11</span><span class="op" id="6322861">}</span><span class="op" id="6322862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322865">}</span><span class="op" id="6322866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322869">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322891">[</span><span class="num" id="6322892">16</span><span class="op" id="6322894">]</span><span class="builtintype" id="6322895">byte</span><span class="op" id="6322899">{</span><span class="num" id="6322900">0</span><span class="op" id="6322901">,</span>&nbsp;<span class="num" id="6322903">2</span><span class="op" id="6322904">,</span>&nbsp;<span class="num" id="6322906">1</span><span class="op" id="6322907">,</span>&nbsp;<span class="num" id="6322909">3</span><span class="op" id="6322910">,</span>&nbsp;<span class="num" id="6322912">3</span><span class="op" id="6322913">,</span>&nbsp;<span class="num" id="6322915">2</span><span class="op" id="6322916">,</span>&nbsp;<span class="num" id="6322918">4</span><span class="op" id="6322919">,</span>&nbsp;<span class="num" id="6322921">3</span><span class="op" id="6322922">,</span>&nbsp;<span class="num" id="6322924">5</span><span class="op" id="6322925">,</span>&nbsp;<span class="num" id="6322927">5</span><span class="op" id="6322928">,</span>&nbsp;<span class="num" id="6322930">4</span><span class="op" id="6322931">,</span>&nbsp;<span class="num" id="6322933">4</span><span class="op" id="6322934">,</span>&nbsp;<span class="num" id="6322936">0</span><span class="op" id="6322937">,</span>&nbsp;<span class="num" id="6322939">0</span><span class="op" id="6322940">,</span>&nbsp;<span class="num" id="6322942">1</span><span class="op" id="6322943">,</span>&nbsp;<span class="num" id="6322945">125</span><span class="op" id="6322948">}</span><span class="op" id="6322949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322953">[</span><span class="op" id="6322954">]</span><span class="builtintype" id="6322955">byte</span><span class="op" id="6322959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6322964">0x01</span><span class="op" id="6322968">,</span>&nbsp;<span class="num" id="6322970">0x02</span><span class="op" id="6322974">,</span>&nbsp;<span class="num" id="6322976">0x03</span><span class="op" id="6322980">,</span>&nbsp;<span class="num" id="6322982">0x00</span><span class="op" id="6322986">,</span>&nbsp;<span class="num" id="6322988">0x04</span><span class="op" id="6322992">,</span>&nbsp;<span class="num" id="6322994">0x11</span><span class="op" id="6322998">,</span>&nbsp;<span class="num" id="6323000">0x05</span><span class="op" id="6323004">,</span>&nbsp;<span class="num" id="6323006">0x12</span><span class="op" id="6323010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323015">0x21</span><span class="op" id="6323019">,</span>&nbsp;<span class="num" id="6323021">0x31</span><span class="op" id="6323025">,</span>&nbsp;<span class="num" id="6323027">0x41</span><span class="op" id="6323031">,</span>&nbsp;<span class="num" id="6323033">0x06</span><span class="op" id="6323037">,</span>&nbsp;<span class="num" id="6323039">0x13</span><span class="op" id="6323043">,</span>&nbsp;<span class="num" id="6323045">0x51</span><span class="op" id="6323049">,</span>&nbsp;<span class="num" id="6323051">0x61</span><span class="op" id="6323055">,</span>&nbsp;<span class="num" id="6323057">0x07</span><span class="op" id="6323061">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323066">0x22</span><span class="op" id="6323070">,</span>&nbsp;<span class="num" id="6323072">0x71</span><span class="op" id="6323076">,</span>&nbsp;<span class="num" id="6323078">0x14</span><span class="op" id="6323082">,</span>&nbsp;<span class="num" id="6323084">0x32</span><span class="op" id="6323088">,</span>&nbsp;<span class="num" id="6323090">0x81</span><span class="op" id="6323094">,</span>&nbsp;<span class="num" id="6323096">0x91</span><span class="op" id="6323100">,</span>&nbsp;<span class="num" id="6323102">0xa1</span><span class="op" id="6323106">,</span>&nbsp;<span class="num" id="6323108">0x08</span><span class="op" id="6323112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323117">0x23</span><span class="op" id="6323121">,</span>&nbsp;<span class="num" id="6323123">0x42</span><span class="op" id="6323127">,</span>&nbsp;<span class="num" id="6323129">0xb1</span><span class="op" id="6323133">,</span>&nbsp;<span class="num" id="6323135">0xc1</span><span class="op" id="6323139">,</span>&nbsp;<span class="num" id="6323141">0x15</span><span class="op" id="6323145">,</span>&nbsp;<span class="num" id="6323147">0x52</span><span class="op" id="6323151">,</span>&nbsp;<span class="num" id="6323153">0xd1</span><span class="op" id="6323157">,</span>&nbsp;<span class="num" id="6323159">0xf0</span><span class="op" id="6323163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323168">0x24</span><span class="op" id="6323172">,</span>&nbsp;<span class="num" id="6323174">0x33</span><span class="op" id="6323178">,</span>&nbsp;<span class="num" id="6323180">0x62</span><span class="op" id="6323184">,</span>&nbsp;<span class="num" id="6323186">0x72</span><span class="op" id="6323190">,</span>&nbsp;<span class="num" id="6323192">0x82</span><span class="op" id="6323196">,</span>&nbsp;<span class="num" id="6323198">0x09</span><span class="op" id="6323202">,</span>&nbsp;<span class="num" id="6323204">0x0a</span><span class="op" id="6323208">,</span>&nbsp;<span class="num" id="6323210">0x16</span><span class="op" id="6323214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323219">0x17</span><span class="op" id="6323223">,</span>&nbsp;<span class="num" id="6323225">0x18</span><span class="op" id="6323229">,</span>&nbsp;<span class="num" id="6323231">0x19</span><span class="op" id="6323235">,</span>&nbsp;<span class="num" id="6323237">0x1a</span><span class="op" id="6323241">,</span>&nbsp;<span class="num" id="6323243">0x25</span><span class="op" id="6323247">,</span>&nbsp;<span class="num" id="6323249">0x26</span><span class="op" id="6323253">,</span>&nbsp;<span class="num" id="6323255">0x27</span><span class="op" id="6323259">,</span>&nbsp;<span class="num" id="6323261">0x28</span><span class="op" id="6323265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323270">0x29</span><span class="op" id="6323274">,</span>&nbsp;<span class="num" id="6323276">0x2a</span><span class="op" id="6323280">,</span>&nbsp;<span class="num" id="6323282">0x34</span><span class="op" id="6323286">,</span>&nbsp;<span class="num" id="6323288">0x35</span><span class="op" id="6323292">,</span>&nbsp;<span class="num" id="6323294">0x36</span><span class="op" id="6323298">,</span>&nbsp;<span class="num" id="6323300">0x37</span><span class="op" id="6323304">,</span>&nbsp;<span class="num" id="6323306">0x38</span><span class="op" id="6323310">,</span>&nbsp;<span class="num" id="6323312">0x39</span><span class="op" id="6323316">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323321">0x3a</span><span class="op" id="6323325">,</span>&nbsp;<span class="num" id="6323327">0x43</span><span class="op" id="6323331">,</span>&nbsp;<span class="num" id="6323333">0x44</span><span class="op" id="6323337">,</span>&nbsp;<span class="num" id="6323339">0x45</span><span class="op" id="6323343">,</span>&nbsp;<span class="num" id="6323345">0x46</span><span class="op" id="6323349">,</span>&nbsp;<span class="num" id="6323351">0x47</span><span class="op" id="6323355">,</span>&nbsp;<span class="num" id="6323357">0x48</span><span class="op" id="6323361">,</span>&nbsp;<span class="num" id="6323363">0x49</span><span class="op" id="6323367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323372">0x4a</span><span class="op" id="6323376">,</span>&nbsp;<span class="num" id="6323378">0x53</span><span class="op" id="6323382">,</span>&nbsp;<span class="num" id="6323384">0x54</span><span class="op" id="6323388">,</span>&nbsp;<span class="num" id="6323390">0x55</span><span class="op" id="6323394">,</span>&nbsp;<span class="num" id="6323396">0x56</span><span class="op" id="6323400">,</span>&nbsp;<span class="num" id="6323402">0x57</span><span class="op" id="6323406">,</span>&nbsp;<span class="num" id="6323408">0x58</span><span class="op" id="6323412">,</span>&nbsp;<span class="num" id="6323414">0x59</span><span class="op" id="6323418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323423">0x5a</span><span class="op" id="6323427">,</span>&nbsp;<span class="num" id="6323429">0x63</span><span class="op" id="6323433">,</span>&nbsp;<span class="num" id="6323435">0x64</span><span class="op" id="6323439">,</span>&nbsp;<span class="num" id="6323441">0x65</span><span class="op" id="6323445">,</span>&nbsp;<span class="num" id="6323447">0x66</span><span class="op" id="6323451">,</span>&nbsp;<span class="num" id="6323453">0x67</span><span class="op" id="6323457">,</span>&nbsp;<span class="num" id="6323459">0x68</span><span class="op" id="6323463">,</span>&nbsp;<span class="num" id="6323465">0x69</span><span class="op" id="6323469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323474">0x6a</span><span class="op" id="6323478">,</span>&nbsp;<span class="num" id="6323480">0x73</span><span class="op" id="6323484">,</span>&nbsp;<span class="num" id="6323486">0x74</span><span class="op" id="6323490">,</span>&nbsp;<span class="num" id="6323492">0x75</span><span class="op" id="6323496">,</span>&nbsp;<span class="num" id="6323498">0x76</span><span class="op" id="6323502">,</span>&nbsp;<span class="num" id="6323504">0x77</span><span class="op" id="6323508">,</span>&nbsp;<span class="num" id="6323510">0x78</span><span class="op" id="6323514">,</span>&nbsp;<span class="num" id="6323516">0x79</span><span class="op" id="6323520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323525">0x7a</span><span class="op" id="6323529">,</span>&nbsp;<span class="num" id="6323531">0x83</span><span class="op" id="6323535">,</span>&nbsp;<span class="num" id="6323537">0x84</span><span class="op" id="6323541">,</span>&nbsp;<span class="num" id="6323543">0x85</span><span class="op" id="6323547">,</span>&nbsp;<span class="num" id="6323549">0x86</span><span class="op" id="6323553">,</span>&nbsp;<span class="num" id="6323555">0x87</span><span class="op" id="6323559">,</span>&nbsp;<span class="num" id="6323561">0x88</span><span class="op" id="6323565">,</span>&nbsp;<span class="num" id="6323567">0x89</span><span class="op" id="6323571">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323576">0x8a</span><span class="op" id="6323580">,</span>&nbsp;<span class="num" id="6323582">0x92</span><span class="op" id="6323586">,</span>&nbsp;<span class="num" id="6323588">0x93</span><span class="op" id="6323592">,</span>&nbsp;<span class="num" id="6323594">0x94</span><span class="op" id="6323598">,</span>&nbsp;<span class="num" id="6323600">0x95</span><span class="op" id="6323604">,</span>&nbsp;<span class="num" id="6323606">0x96</span><span class="op" id="6323610">,</span>&nbsp;<span class="num" id="6323612">0x97</span><span class="op" id="6323616">,</span>&nbsp;<span class="num" id="6323618">0x98</span><span class="op" id="6323622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323627">0x99</span><span class="op" id="6323631">,</span>&nbsp;<span class="num" id="6323633">0x9a</span><span class="op" id="6323637">,</span>&nbsp;<span class="num" id="6323639">0xa2</span><span class="op" id="6323643">,</span>&nbsp;<span class="num" id="6323645">0xa3</span><span class="op" id="6323649">,</span>&nbsp;<span class="num" id="6323651">0xa4</span><span class="op" id="6323655">,</span>&nbsp;<span class="num" id="6323657">0xa5</span><span class="op" id="6323661">,</span>&nbsp;<span class="num" id="6323663">0xa6</span><span class="op" id="6323667">,</span>&nbsp;<span class="num" id="6323669">0xa7</span><span class="op" id="6323673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323678">0xa8</span><span class="op" id="6323682">,</span>&nbsp;<span class="num" id="6323684">0xa9</span><span class="op" id="6323688">,</span>&nbsp;<span class="num" id="6323690">0xaa</span><span class="op" id="6323694">,</span>&nbsp;<span class="num" id="6323696">0xb2</span><span class="op" id="6323700">,</span>&nbsp;<span class="num" id="6323702">0xb3</span><span class="op" id="6323706">,</span>&nbsp;<span class="num" id="6323708">0xb4</span><span class="op" id="6323712">,</span>&nbsp;<span class="num" id="6323714">0xb5</span><span class="op" id="6323718">,</span>&nbsp;<span class="num" id="6323720">0xb6</span><span class="op" id="6323724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323729">0xb7</span><span class="op" id="6323733">,</span>&nbsp;<span class="num" id="6323735">0xb8</span><span class="op" id="6323739">,</span>&nbsp;<span class="num" id="6323741">0xb9</span><span class="op" id="6323745">,</span>&nbsp;<span class="num" id="6323747">0xba</span><span class="op" id="6323751">,</span>&nbsp;<span class="num" id="6323753">0xc2</span><span class="op" id="6323757">,</span>&nbsp;<span class="num" id="6323759">0xc3</span><span class="op" id="6323763">,</span>&nbsp;<span class="num" id="6323765">0xc4</span><span class="op" id="6323769">,</span>&nbsp;<span class="num" id="6323771">0xc5</span><span class="op" id="6323775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323780">0xc6</span><span class="op" id="6323784">,</span>&nbsp;<span class="num" id="6323786">0xc7</span><span class="op" id="6323790">,</span>&nbsp;<span class="num" id="6323792">0xc8</span><span class="op" id="6323796">,</span>&nbsp;<span class="num" id="6323798">0xc9</span><span class="op" id="6323802">,</span>&nbsp;<span class="num" id="6323804">0xca</span><span class="op" id="6323808">,</span>&nbsp;<span class="num" id="6323810">0xd2</span><span class="op" id="6323814">,</span>&nbsp;<span class="num" id="6323816">0xd3</span><span class="op" id="6323820">,</span>&nbsp;<span class="num" id="6323822">0xd4</span><span class="op" id="6323826">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323831">0xd5</span><span class="op" id="6323835">,</span>&nbsp;<span class="num" id="6323837">0xd6</span><span class="op" id="6323841">,</span>&nbsp;<span class="num" id="6323843">0xd7</span><span class="op" id="6323847">,</span>&nbsp;<span class="num" id="6323849">0xd8</span><span class="op" id="6323853">,</span>&nbsp;<span class="num" id="6323855">0xd9</span><span class="op" id="6323859">,</span>&nbsp;<span class="num" id="6323861">0xda</span><span class="op" id="6323865">,</span>&nbsp;<span class="num" id="6323867">0xe1</span><span class="op" id="6323871">,</span>&nbsp;<span class="num" id="6323873">0xe2</span><span class="op" id="6323877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323882">0xe3</span><span class="op" id="6323886">,</span>&nbsp;<span class="num" id="6323888">0xe4</span><span class="op" id="6323892">,</span>&nbsp;<span class="num" id="6323894">0xe5</span><span class="op" id="6323898">,</span>&nbsp;<span class="num" id="6323900">0xe6</span><span class="op" id="6323904">,</span>&nbsp;<span class="num" id="6323906">0xe7</span><span class="op" id="6323910">,</span>&nbsp;<span class="num" id="6323912">0xe8</span><span class="op" id="6323916">,</span>&nbsp;<span class="num" id="6323918">0xe9</span><span class="op" id="6323922">,</span>&nbsp;<span class="num" id="6323924">0xea</span><span class="op" id="6323928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323933">0xf1</span><span class="op" id="6323937">,</span>&nbsp;<span class="num" id="6323939">0xf2</span><span class="op" id="6323943">,</span>&nbsp;<span class="num" id="6323945">0xf3</span><span class="op" id="6323949">,</span>&nbsp;<span class="num" id="6323951">0xf4</span><span class="op" id="6323955">,</span>&nbsp;<span class="num" id="6323957">0xf5</span><span class="op" id="6323961">,</span>&nbsp;<span class="num" id="6323963">0xf6</span><span class="op" id="6323967">,</span>&nbsp;<span class="num" id="6323969">0xf7</span><span class="op" id="6323973">,</span>&nbsp;<span class="num" id="6323975">0xf8</span><span class="op" id="6323979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6323984">0xf9</span><span class="op" id="6323988">,</span>&nbsp;<span class="num" id="6323990">0xfa</span><span class="op" id="6323994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323998">}</span><span class="op" id="6323999">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324002">}</span><span class="op" id="6324003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324006">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324030">[</span><span class="num" id="6324031">16</span><span class="op" id="6324033">]</span><span class="builtintype" id="6324034">byte</span><span class="op" id="6324038">{</span><span class="num" id="6324039">0</span><span class="op" id="6324040">,</span>&nbsp;<span class="num" id="6324042">3</span><span class="op" id="6324043">,</span>&nbsp;<span class="num" id="6324045">1</span><span class="op" id="6324046">,</span>&nbsp;<span class="num" id="6324048">1</span><span class="op" id="6324049">,</span>&nbsp;<span class="num" id="6324051">1</span><span class="op" id="6324052">,</span>&nbsp;<span class="num" id="6324054">1</span><span class="op" id="6324055">,</span>&nbsp;<span class="num" id="6324057">1</span><span class="op" id="6324058">,</span>&nbsp;<span class="num" id="6324060">1</span><span class="op" id="6324061">,</span>&nbsp;<span class="num" id="6324063">1</span><span class="op" id="6324064">,</span>&nbsp;<span class="num" id="6324066">1</span><span class="op" id="6324067">,</span>&nbsp;<span class="num" id="6324069">1</span><span class="op" id="6324070">,</span>&nbsp;<span class="num" id="6324072">0</span><span class="op" id="6324073">,</span>&nbsp;<span class="num" id="6324075">0</span><span class="op" id="6324076">,</span>&nbsp;<span class="num" id="6324078">0</span><span class="op" id="6324079">,</span>&nbsp;<span class="num" id="6324081">0</span><span class="op" id="6324082">,</span>&nbsp;<span class="num" id="6324084">0</span><span class="op" id="6324085">}</span><span class="op" id="6324086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324090">[</span><span class="op" id="6324091">]</span><span class="builtintype" id="6324092">byte</span><span class="op" id="6324096">{</span><span class="num" id="6324097">0</span><span class="op" id="6324098">,</span>&nbsp;<span class="num" id="6324100">1</span><span class="op" id="6324101">,</span>&nbsp;<span class="num" id="6324103">2</span><span class="op" id="6324104">,</span>&nbsp;<span class="num" id="6324106">3</span><span class="op" id="6324107">,</span>&nbsp;<span class="num" id="6324109">4</span><span class="op" id="6324110">,</span>&nbsp;<span class="num" id="6324112">5</span><span class="op" id="6324113">,</span>&nbsp;<span class="num" id="6324115">6</span><span class="op" id="6324116">,</span>&nbsp;<span class="num" id="6324118">7</span><span class="op" id="6324119">,</span>&nbsp;<span class="num" id="6324121">8</span><span class="op" id="6324122">,</span>&nbsp;<span class="num" id="6324124">9</span><span class="op" id="6324125">,</span>&nbsp;<span class="num" id="6324127">10</span><span class="op" id="6324129">,</span>&nbsp;<span class="num" id="6324131">11</span><span class="op" id="6324133">}</span><span class="op" id="6324134">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324137">}</span><span class="op" id="6324138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324141">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324165">[</span><span class="num" id="6324166">16</span><span class="op" id="6324168">]</span><span class="builtintype" id="6324169">byte</span><span class="op" id="6324173">{</span><span class="num" id="6324174">0</span><span class="op" id="6324175">,</span>&nbsp;<span class="num" id="6324177">2</span><span class="op" id="6324178">,</span>&nbsp;<span class="num" id="6324180">1</span><span class="op" id="6324181">,</span>&nbsp;<span class="num" id="6324183">2</span><span class="op" id="6324184">,</span>&nbsp;<span class="num" id="6324186">4</span><span class="op" id="6324187">,</span>&nbsp;<span class="num" id="6324189">4</span><span class="op" id="6324190">,</span>&nbsp;<span class="num" id="6324192">3</span><span class="op" id="6324193">,</span>&nbsp;<span class="num" id="6324195">4</span><span class="op" id="6324196">,</span>&nbsp;<span class="num" id="6324198">7</span><span class="op" id="6324199">,</span>&nbsp;<span class="num" id="6324201">5</span><span class="op" id="6324202">,</span>&nbsp;<span class="num" id="6324204">4</span><span class="op" id="6324205">,</span>&nbsp;<span class="num" id="6324207">4</span><span class="op" id="6324208">,</span>&nbsp;<span class="num" id="6324210">0</span><span class="op" id="6324211">,</span>&nbsp;<span class="num" id="6324213">1</span><span class="op" id="6324214">,</span>&nbsp;<span class="num" id="6324216">2</span><span class="op" id="6324217">,</span>&nbsp;<span class="num" id="6324219">119</span><span class="op" id="6324222">}</span><span class="op" id="6324223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324227">[</span><span class="op" id="6324228">]</span><span class="builtintype" id="6324229">byte</span><span class="op" id="6324233">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324238">0x00</span><span class="op" id="6324242">,</span>&nbsp;<span class="num" id="6324244">0x01</span><span class="op" id="6324248">,</span>&nbsp;<span class="num" id="6324250">0x02</span><span class="op" id="6324254">,</span>&nbsp;<span class="num" id="6324256">0x03</span><span class="op" id="6324260">,</span>&nbsp;<span class="num" id="6324262">0x11</span><span class="op" id="6324266">,</span>&nbsp;<span class="num" id="6324268">0x04</span><span class="op" id="6324272">,</span>&nbsp;<span class="num" id="6324274">0x05</span><span class="op" id="6324278">,</span>&nbsp;<span class="num" id="6324280">0x21</span><span class="op" id="6324284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324289">0x31</span><span class="op" id="6324293">,</span>&nbsp;<span class="num" id="6324295">0x06</span><span class="op" id="6324299">,</span>&nbsp;<span class="num" id="6324301">0x12</span><span class="op" id="6324305">,</span>&nbsp;<span class="num" id="6324307">0x41</span><span class="op" id="6324311">,</span>&nbsp;<span class="num" id="6324313">0x51</span><span class="op" id="6324317">,</span>&nbsp;<span class="num" id="6324319">0x07</span><span class="op" id="6324323">,</span>&nbsp;<span class="num" id="6324325">0x61</span><span class="op" id="6324329">,</span>&nbsp;<span class="num" id="6324331">0x71</span><span class="op" id="6324335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324340">0x13</span><span class="op" id="6324344">,</span>&nbsp;<span class="num" id="6324346">0x22</span><span class="op" id="6324350">,</span>&nbsp;<span class="num" id="6324352">0x32</span><span class="op" id="6324356">,</span>&nbsp;<span class="num" id="6324358">0x81</span><span class="op" id="6324362">,</span>&nbsp;<span class="num" id="6324364">0x08</span><span class="op" id="6324368">,</span>&nbsp;<span class="num" id="6324370">0x14</span><span class="op" id="6324374">,</span>&nbsp;<span class="num" id="6324376">0x42</span><span class="op" id="6324380">,</span>&nbsp;<span class="num" id="6324382">0x91</span><span class="op" id="6324386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324391">0xa1</span><span class="op" id="6324395">,</span>&nbsp;<span class="num" id="6324397">0xb1</span><span class="op" id="6324401">,</span>&nbsp;<span class="num" id="6324403">0xc1</span><span class="op" id="6324407">,</span>&nbsp;<span class="num" id="6324409">0x09</span><span class="op" id="6324413">,</span>&nbsp;<span class="num" id="6324415">0x23</span><span class="op" id="6324419">,</span>&nbsp;<span class="num" id="6324421">0x33</span><span class="op" id="6324425">,</span>&nbsp;<span class="num" id="6324427">0x52</span><span class="op" id="6324431">,</span>&nbsp;<span class="num" id="6324433">0xf0</span><span class="op" id="6324437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324442">0x15</span><span class="op" id="6324446">,</span>&nbsp;<span class="num" id="6324448">0x62</span><span class="op" id="6324452">,</span>&nbsp;<span class="num" id="6324454">0x72</span><span class="op" id="6324458">,</span>&nbsp;<span class="num" id="6324460">0xd1</span><span class="op" id="6324464">,</span>&nbsp;<span class="num" id="6324466">0x0a</span><span class="op" id="6324470">,</span>&nbsp;<span class="num" id="6324472">0x16</span><span class="op" id="6324476">,</span>&nbsp;<span class="num" id="6324478">0x24</span><span class="op" id="6324482">,</span>&nbsp;<span class="num" id="6324484">0x34</span><span class="op" id="6324488">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324493">0xe1</span><span class="op" id="6324497">,</span>&nbsp;<span class="num" id="6324499">0x25</span><span class="op" id="6324503">,</span>&nbsp;<span class="num" id="6324505">0xf1</span><span class="op" id="6324509">,</span>&nbsp;<span class="num" id="6324511">0x17</span><span class="op" id="6324515">,</span>&nbsp;<span class="num" id="6324517">0x18</span><span class="op" id="6324521">,</span>&nbsp;<span class="num" id="6324523">0x19</span><span class="op" id="6324527">,</span>&nbsp;<span class="num" id="6324529">0x1a</span><span class="op" id="6324533">,</span>&nbsp;<span class="num" id="6324535">0x26</span><span class="op" id="6324539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324544">0x27</span><span class="op" id="6324548">,</span>&nbsp;<span class="num" id="6324550">0x28</span><span class="op" id="6324554">,</span>&nbsp;<span class="num" id="6324556">0x29</span><span class="op" id="6324560">,</span>&nbsp;<span class="num" id="6324562">0x2a</span><span class="op" id="6324566">,</span>&nbsp;<span class="num" id="6324568">0x35</span><span class="op" id="6324572">,</span>&nbsp;<span class="num" id="6324574">0x36</span><span class="op" id="6324578">,</span>&nbsp;<span class="num" id="6324580">0x37</span><span class="op" id="6324584">,</span>&nbsp;<span class="num" id="6324586">0x38</span><span class="op" id="6324590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324595">0x39</span><span class="op" id="6324599">,</span>&nbsp;<span class="num" id="6324601">0x3a</span><span class="op" id="6324605">,</span>&nbsp;<span class="num" id="6324607">0x43</span><span class="op" id="6324611">,</span>&nbsp;<span class="num" id="6324613">0x44</span><span class="op" id="6324617">,</span>&nbsp;<span class="num" id="6324619">0x45</span><span class="op" id="6324623">,</span>&nbsp;<span class="num" id="6324625">0x46</span><span class="op" id="6324629">,</span>&nbsp;<span class="num" id="6324631">0x47</span><span class="op" id="6324635">,</span>&nbsp;<span class="num" id="6324637">0x48</span><span class="op" id="6324641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324646">0x49</span><span class="op" id="6324650">,</span>&nbsp;<span class="num" id="6324652">0x4a</span><span class="op" id="6324656">,</span>&nbsp;<span class="num" id="6324658">0x53</span><span class="op" id="6324662">,</span>&nbsp;<span class="num" id="6324664">0x54</span><span class="op" id="6324668">,</span>&nbsp;<span class="num" id="6324670">0x55</span><span class="op" id="6324674">,</span>&nbsp;<span class="num" id="6324676">0x56</span><span class="op" id="6324680">,</span>&nbsp;<span class="num" id="6324682">0x57</span><span class="op" id="6324686">,</span>&nbsp;<span class="num" id="6324688">0x58</span><span class="op" id="6324692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324697">0x59</span><span class="op" id="6324701">,</span>&nbsp;<span class="num" id="6324703">0x5a</span><span class="op" id="6324707">,</span>&nbsp;<span class="num" id="6324709">0x63</span><span class="op" id="6324713">,</span>&nbsp;<span class="num" id="6324715">0x64</span><span class="op" id="6324719">,</span>&nbsp;<span class="num" id="6324721">0x65</span><span class="op" id="6324725">,</span>&nbsp;<span class="num" id="6324727">0x66</span><span class="op" id="6324731">,</span>&nbsp;<span class="num" id="6324733">0x67</span><span class="op" id="6324737">,</span>&nbsp;<span class="num" id="6324739">0x68</span><span class="op" id="6324743">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324748">0x69</span><span class="op" id="6324752">,</span>&nbsp;<span class="num" id="6324754">0x6a</span><span class="op" id="6324758">,</span>&nbsp;<span class="num" id="6324760">0x73</span><span class="op" id="6324764">,</span>&nbsp;<span class="num" id="6324766">0x74</span><span class="op" id="6324770">,</span>&nbsp;<span class="num" id="6324772">0x75</span><span class="op" id="6324776">,</span>&nbsp;<span class="num" id="6324778">0x76</span><span class="op" id="6324782">,</span>&nbsp;<span class="num" id="6324784">0x77</span><span class="op" id="6324788">,</span>&nbsp;<span class="num" id="6324790">0x78</span><span class="op" id="6324794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324799">0x79</span><span class="op" id="6324803">,</span>&nbsp;<span class="num" id="6324805">0x7a</span><span class="op" id="6324809">,</span>&nbsp;<span class="num" id="6324811">0x82</span><span class="op" id="6324815">,</span>&nbsp;<span class="num" id="6324817">0x83</span><span class="op" id="6324821">,</span>&nbsp;<span class="num" id="6324823">0x84</span><span class="op" id="6324827">,</span>&nbsp;<span class="num" id="6324829">0x85</span><span class="op" id="6324833">,</span>&nbsp;<span class="num" id="6324835">0x86</span><span class="op" id="6324839">,</span>&nbsp;<span class="num" id="6324841">0x87</span><span class="op" id="6324845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324850">0x88</span><span class="op" id="6324854">,</span>&nbsp;<span class="num" id="6324856">0x89</span><span class="op" id="6324860">,</span>&nbsp;<span class="num" id="6324862">0x8a</span><span class="op" id="6324866">,</span>&nbsp;<span class="num" id="6324868">0x92</span><span class="op" id="6324872">,</span>&nbsp;<span class="num" id="6324874">0x93</span><span class="op" id="6324878">,</span>&nbsp;<span class="num" id="6324880">0x94</span><span class="op" id="6324884">,</span>&nbsp;<span class="num" id="6324886">0x95</span><span class="op" id="6324890">,</span>&nbsp;<span class="num" id="6324892">0x96</span><span class="op" id="6324896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324901">0x97</span><span class="op" id="6324905">,</span>&nbsp;<span class="num" id="6324907">0x98</span><span class="op" id="6324911">,</span>&nbsp;<span class="num" id="6324913">0x99</span><span class="op" id="6324917">,</span>&nbsp;<span class="num" id="6324919">0x9a</span><span class="op" id="6324923">,</span>&nbsp;<span class="num" id="6324925">0xa2</span><span class="op" id="6324929">,</span>&nbsp;<span class="num" id="6324931">0xa3</span><span class="op" id="6324935">,</span>&nbsp;<span class="num" id="6324937">0xa4</span><span class="op" id="6324941">,</span>&nbsp;<span class="num" id="6324943">0xa5</span><span class="op" id="6324947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6324952">0xa6</span><span class="op" id="6324956">,</span>&nbsp;<span class="num" id="6324958">0xa7</span><span class="op" id="6324962">,</span>&nbsp;<span class="num" id="6324964">0xa8</span><span class="op" id="6324968">,</span>&nbsp;<span class="num" id="6324970">0xa9</span><span class="op" id="6324974">,</span>&nbsp;<span class="num" id="6324976">0xaa</span><span class="op" id="6324980">,</span>&nbsp;<span class="num" id="6324982">0xb2</span><span class="op" id="6324986">,</span>&nbsp;<span class="num" id="6324988">0xb3</span><span class="op" id="6324992">,</span>&nbsp;<span class="num" id="6324994">0xb4</span><span class="op" id="6324998">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325003">0xb5</span><span class="op" id="6325007">,</span>&nbsp;<span class="num" id="6325009">0xb6</span><span class="op" id="6325013">,</span>&nbsp;<span class="num" id="6325015">0xb7</span><span class="op" id="6325019">,</span>&nbsp;<span class="num" id="6325021">0xb8</span><span class="op" id="6325025">,</span>&nbsp;<span class="num" id="6325027">0xb9</span><span class="op" id="6325031">,</span>&nbsp;<span class="num" id="6325033">0xba</span><span class="op" id="6325037">,</span>&nbsp;<span class="num" id="6325039">0xc2</span><span class="op" id="6325043">,</span>&nbsp;<span class="num" id="6325045">0xc3</span><span class="op" id="6325049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325054">0xc4</span><span class="op" id="6325058">,</span>&nbsp;<span class="num" id="6325060">0xc5</span><span class="op" id="6325064">,</span>&nbsp;<span class="num" id="6325066">0xc6</span><span class="op" id="6325070">,</span>&nbsp;<span class="num" id="6325072">0xc7</span><span class="op" id="6325076">,</span>&nbsp;<span class="num" id="6325078">0xc8</span><span class="op" id="6325082">,</span>&nbsp;<span class="num" id="6325084">0xc9</span><span class="op" id="6325088">,</span>&nbsp;<span class="num" id="6325090">0xca</span><span class="op" id="6325094">,</span>&nbsp;<span class="num" id="6325096">0xd2</span><span class="op" id="6325100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325105">0xd3</span><span class="op" id="6325109">,</span>&nbsp;<span class="num" id="6325111">0xd4</span><span class="op" id="6325115">,</span>&nbsp;<span class="num" id="6325117">0xd5</span><span class="op" id="6325121">,</span>&nbsp;<span class="num" id="6325123">0xd6</span><span class="op" id="6325127">,</span>&nbsp;<span class="num" id="6325129">0xd7</span><span class="op" id="6325133">,</span>&nbsp;<span class="num" id="6325135">0xd8</span><span class="op" id="6325139">,</span>&nbsp;<span class="num" id="6325141">0xd9</span><span class="op" id="6325145">,</span>&nbsp;<span class="num" id="6325147">0xda</span><span class="op" id="6325151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325156">0xe2</span><span class="op" id="6325160">,</span>&nbsp;<span class="num" id="6325162">0xe3</span><span class="op" id="6325166">,</span>&nbsp;<span class="num" id="6325168">0xe4</span><span class="op" id="6325172">,</span>&nbsp;<span class="num" id="6325174">0xe5</span><span class="op" id="6325178">,</span>&nbsp;<span class="num" id="6325180">0xe6</span><span class="op" id="6325184">,</span>&nbsp;<span class="num" id="6325186">0xe7</span><span class="op" id="6325190">,</span>&nbsp;<span class="num" id="6325192">0xe8</span><span class="op" id="6325196">,</span>&nbsp;<span class="num" id="6325198">0xe9</span><span class="op" id="6325202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325207">0xea</span><span class="op" id="6325211">,</span>&nbsp;<span class="num" id="6325213">0xf2</span><span class="op" id="6325217">,</span>&nbsp;<span class="num" id="6325219">0xf3</span><span class="op" id="6325223">,</span>&nbsp;<span class="num" id="6325225">0xf4</span><span class="op" id="6325229">,</span>&nbsp;<span class="num" id="6325231">0xf5</span><span class="op" id="6325235">,</span>&nbsp;<span class="num" id="6325237">0xf6</span><span class="op" id="6325241">,</span>&nbsp;<span class="num" id="6325243">0xf7</span><span class="op" id="6325247">,</span>&nbsp;<span class="num" id="6325249">0xf8</span><span class="op" id="6325253">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6325258">0xf9</span><span class="op" id="6325262">,</span>&nbsp;<span class="num" id="6325264">0xfa</span><span class="op" id="6325268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325272">}</span><span class="op" id="6325273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325276">}</span><span class="op" id="6325277">,</span><br>
<span class="lineno"></span><span class="op" id="6325279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6325282">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="6325357">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6325434">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="6325512">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6325553">type</span>&nbsp;<span class="ident" id="6325558">huffmanLUT</span>&nbsp;<span class="op" id="6325569">[</span><span class="op" id="6325570">]</span><span class="builtintype" id="6325571">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6325579">func</span>&nbsp;<span class="op" id="6325584">(</span><span class="ident" id="6325585">h</span>&nbsp;<span class="op" id="6325587">*</span><span class="ident" id="6325588">huffmanLUT</span><span class="op" id="6325598">)</span>&nbsp;<span class="ident" id="6325600">init</span><span class="op" id="6325604">(</span><span class="ident" id="6325605">s</span>&nbsp;<span class="ident" id="6325607">huffmanSpec</span><span class="op" id="6325618">)</span>&nbsp;<span class="op" id="6325620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325623">maxValue</span>&nbsp;<span class="op" id="6325632">:=</span>&nbsp;<span class="num" id="6325635">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325638">for</span>&nbsp;<span class="ident" id="6325642">_</span><span class="op" id="6325643">,</span>&nbsp;<span class="ident" id="6325645">v</span>&nbsp;<span class="op" id="6325647">:=</span>&nbsp;<span class="keyword" id="6325650">range</span>&nbsp;<span class="ident" id="6325656">s</span><span class="op" id="6325657">.</span><span class="ident" id="6325658">value</span>&nbsp;<span class="op" id="6325664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325668">if</span>&nbsp;<span class="builtintype" id="6325671">int</span><span class="op" id="6325674">(</span><span class="ident" id="6325675">v</span><span class="op" id="6325676">)</span>&nbsp;<span class="op" id="6325678">&gt;</span>&nbsp;<span class="ident" id="6325680">maxValue</span>&nbsp;<span class="op" id="6325689">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325694">maxValue</span>&nbsp;<span class="op" id="6325703">=</span>&nbsp;<span class="builtintype" id="6325705">int</span><span class="op" id="6325708">(</span><span class="ident" id="6325709">v</span><span class="op" id="6325710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325720">*</span><span class="ident" id="6325721">h</span>&nbsp;<span class="op" id="6325723">=</span>&nbsp;<span class="builtinfunc" id="6325725">make</span><span class="op" id="6325729">(</span><span class="op" id="6325730">[</span><span class="op" id="6325731">]</span><span class="builtintype" id="6325732">uint32</span><span class="op" id="6325738">,</span>&nbsp;<span class="ident" id="6325740">maxValue</span><span class="op" id="6325748">+</span><span class="num" id="6325749">1</span><span class="op" id="6325750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325753">code</span><span class="op" id="6325757">,</span>&nbsp;<span class="ident" id="6325759">k</span>&nbsp;<span class="op" id="6325761">:=</span>&nbsp;<span class="builtintype" id="6325764">uint32</span><span class="op" id="6325770">(</span><span class="num" id="6325771">0</span><span class="op" id="6325772">)</span><span class="op" id="6325773">,</span>&nbsp;<span class="num" id="6325775">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325778">for</span>&nbsp;<span class="ident" id="6325782">i</span>&nbsp;<span class="op" id="6325784">:=</span>&nbsp;<span class="num" id="6325787">0</span><span class="op" id="6325788">;</span>&nbsp;<span class="ident" id="6325790">i</span>&nbsp;<span class="op" id="6325792">&lt;</span>&nbsp;<span class="builtinfunc" id="6325794">len</span><span class="op" id="6325797">(</span><span class="ident" id="6325798">s</span><span class="op" id="6325799">.</span><span class="ident" id="6325800">count</span><span class="op" id="6325805">)</span><span class="op" id="6325806">;</span>&nbsp;<span class="ident" id="6325808">i</span><span class="op" id="6325809">++</span>&nbsp;<span class="op" id="6325812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325816">nBits</span>&nbsp;<span class="op" id="6325822">:=</span>&nbsp;<span class="builtintype" id="6325825">uint32</span><span class="op" id="6325831">(</span><span class="ident" id="6325832">i</span><span class="op" id="6325833">+</span><span class="num" id="6325834">1</span><span class="op" id="6325835">)</span>&nbsp;<span class="op" id="6325837">&lt;&lt;</span>&nbsp;<span class="num" id="6325840">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325845">for</span>&nbsp;<span class="ident" id="6325849">j</span>&nbsp;<span class="op" id="6325851">:=</span>&nbsp;<span class="builtintype" id="6325854">uint8</span><span class="op" id="6325859">(</span><span class="num" id="6325860">0</span><span class="op" id="6325861">)</span><span class="op" id="6325862">;</span>&nbsp;<span class="ident" id="6325864">j</span>&nbsp;<span class="op" id="6325866">&lt;</span>&nbsp;<span class="ident" id="6325868">s</span><span class="op" id="6325869">.</span><span class="ident" id="6325870">count</span><span class="op" id="6325875">[</span><span class="ident" id="6325876">i</span><span class="op" id="6325877">]</span><span class="op" id="6325878">;</span>&nbsp;<span class="ident" id="6325880">j</span><span class="op" id="6325881">++</span>&nbsp;<span class="op" id="6325884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325889">(</span><span class="op" id="6325890">*</span><span class="ident" id="6325891">h</span><span class="op" id="6325892">)</span><span class="op" id="6325893">[</span><span class="ident" id="6325894">s</span><span class="op" id="6325895">.</span><span class="ident" id="6325896">value</span><span class="op" id="6325901">[</span><span class="ident" id="6325902">k</span><span class="op" id="6325903">]</span><span class="op" id="6325904">]</span>&nbsp;<span class="op" id="6325906">=</span>&nbsp;<span class="ident" id="6325908">nBits</span>&nbsp;<span class="op" id="6325914">|</span>&nbsp;<span class="ident" id="6325916">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325924">code</span><span class="op" id="6325928">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325934">k</span><span class="op" id="6325935">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325944">code</span>&nbsp;<span class="op" id="6325949">&lt;&lt;=</span>&nbsp;<span class="num" id="6325953">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325956">}</span><br>
<span class="lineno"></span><span class="op" id="6325958">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6325961">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="6326026">var</span>&nbsp;<span class="ident" id="6326030">theHuffmanLUT</span>&nbsp;<span class="op" id="6326044">[</span><span class="num" id="6326045">4</span><span class="op" id="6326046">]</span><span class="ident" id="6326047">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6326059">func</span>&nbsp;<span class="ident" id="6326064">init</span><span class="op" id="6326068">(</span><span class="op" id="6326069">)</span>&nbsp;<span class="op" id="6326071">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326074">for</span>&nbsp;<span class="ident" id="6326078">i</span><span class="op" id="6326079">,</span>&nbsp;<span class="ident" id="6326081">s</span>&nbsp;<span class="op" id="6326083">:=</span>&nbsp;<span class="keyword" id="6326086">range</span>&nbsp;<span class="ident" id="6326092">theHuffmanSpec</span>&nbsp;<span class="op" id="6326107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326111">theHuffmanLUT</span><span class="op" id="6326124">[</span><span class="ident" id="6326125">i</span><span class="op" id="6326126">]</span><span class="op" id="6326127">.</span><span class="ident" id="6326128">init</span><span class="op" id="6326132">(</span><span class="ident" id="6326133">s</span><span class="op" id="6326134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326137">}</span><br>
<span class="lineno"></span><span class="op" id="6326139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="6326142">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6326174">type</span>&nbsp;<span class="ident" id="6326179">writer</span>&nbsp;<span class="keyword" id="6326186">interface</span>&nbsp;<span class="op" id="6326196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326199">Flush</span><span class="op" id="6326204">(</span><span class="op" id="6326205">)</span>&nbsp;<span class="builtintype" id="6326207">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326214">io</span><span class="op" id="6326216">.</span><span class="ident" id="6326217">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326225">io</span><span class="op" id="6326227">.</span><span class="ident" id="6326228">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="6326239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6326242">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6326290">type</span>&nbsp;<span class="ident" id="6326295">encoder</span>&nbsp;<span class="keyword" id="6326303">struct</span>&nbsp;<span class="op" id="6326310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326313">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326388">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326459">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6326463">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326471">err</span>&nbsp;<span class="builtintype" id="6326475">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326482">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326511">buf</span>&nbsp;<span class="op" id="6326515">[</span><span class="num" id="6326516">16</span><span class="op" id="6326518">]</span><span class="builtintype" id="6326519">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326525">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326580">bits</span><span class="op" id="6326584">,</span>&nbsp;<span class="ident" id="6326586">nBits</span>&nbsp;<span class="builtintype" id="6326592">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326600">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326663">quant</span>&nbsp;<span class="op" id="6326669">[</span><span class="ident" id="6326670">nQuantIndex</span><span class="op" id="6326681">]</span><span class="op" id="6326682">[</span><span class="ident" id="6326683">blockSize</span><span class="op" id="6326692">]</span><span class="builtintype" id="6326693">byte</span><br>
<span class="lineno"></span><span class="op" id="6326698">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="6326701">func</span>&nbsp;<span class="op" id="6326706">(</span><span class="ident" id="6326707">e</span>&nbsp;<span class="op" id="6326709">*</span><span class="ident" id="6326710">encoder</span><span class="op" id="6326717">)</span>&nbsp;<span class="ident" id="6326719">flush</span><span class="op" id="6326724">(</span><span class="op" id="6326725">)</span>&nbsp;<span class="op" id="6326727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326730">if</span>&nbsp;<span class="ident" id="6326733">e</span><span class="op" id="6326734">.</span><span class="ident" id="6326735">err</span>&nbsp;<span class="op" id="6326739">!=</span>&nbsp;<span class="ident" id="6326742">nil</span>&nbsp;<span class="op" id="6326746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326750">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326758">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326761">e</span><span class="op" id="6326762">.</span><span class="ident" id="6326763">err</span>&nbsp;<span class="op" id="6326767">=</span>&nbsp;<span class="ident" id="6326769">e</span><span class="op" id="6326770">.</span><span class="ident" id="6326771">w</span><span class="op" id="6326772">.</span><span class="ident" id="6326773">Flush</span><span class="op" id="6326778">(</span><span class="op" id="6326779">)</span><br>
<span class="lineno"></span><span class="op" id="6326781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6326784">func</span>&nbsp;<span class="op" id="6326789">(</span><span class="ident" id="6326790">e</span>&nbsp;<span class="op" id="6326792">*</span><span class="ident" id="6326793">encoder</span><span class="op" id="6326800">)</span>&nbsp;<span class="ident" id="6326802">write</span><span class="op" id="6326807">(</span><span class="ident" id="6326808">p</span>&nbsp;<span class="op" id="6326810">[</span><span class="op" id="6326811">]</span><span class="builtintype" id="6326812">byte</span><span class="op" id="6326816">)</span>&nbsp;<span class="op" id="6326818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326821">if</span>&nbsp;<span class="ident" id="6326824">e</span><span class="op" id="6326825">.</span><span class="ident" id="6326826">err</span>&nbsp;<span class="op" id="6326830">!=</span>&nbsp;<span class="ident" id="6326833">nil</span>&nbsp;<span class="op" id="6326837">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326841">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326852">_</span><span class="op" id="6326853">,</span>&nbsp;<span class="ident" id="6326855">e</span><span class="op" id="6326856">.</span><span class="ident" id="6326857">err</span>&nbsp;<span class="op" id="6326861">=</span>&nbsp;<span class="ident" id="6326863">e</span><span class="op" id="6326864">.</span><span class="ident" id="6326865">w</span><span class="op" id="6326866">.</span><span class="ident" id="6326867">Write</span><span class="op" id="6326872">(</span><span class="ident" id="6326873">p</span><span class="op" id="6326874">)</span><br>
<span class="lineno"></span><span class="op" id="6326876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="6326879">func</span>&nbsp;<span class="op" id="6326884">(</span><span class="ident" id="6326885">e</span>&nbsp;<span class="op" id="6326887">*</span><span class="ident" id="6326888">encoder</span><span class="op" id="6326895">)</span>&nbsp;<span class="ident" id="6326897">writeByte</span><span class="op" id="6326906">(</span><span class="ident" id="6326907">b</span>&nbsp;<span class="builtintype" id="6326909">byte</span><span class="op" id="6326913">)</span>&nbsp;<span class="op" id="6326915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326918">if</span>&nbsp;<span class="ident" id="6326921">e</span><span class="op" id="6326922">.</span><span class="ident" id="6326923">err</span>&nbsp;<span class="op" id="6326927">!=</span>&nbsp;<span class="ident" id="6326930">nil</span>&nbsp;<span class="op" id="6326934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326938">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326949">e</span><span class="op" id="6326950">.</span><span class="ident" id="6326951">err</span>&nbsp;<span class="op" id="6326955">=</span>&nbsp;<span class="ident" id="6326957">e</span><span class="op" id="6326958">.</span><span class="ident" id="6326959">w</span><span class="op" id="6326960">.</span><span class="ident" id="6326961">WriteByte</span><span class="op" id="6326970">(</span><span class="ident" id="6326971">b</span><span class="op" id="6326972">)</span><br>
<span class="lineno">250</span><span class="op" id="6326974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6326977">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6327051">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="6327106">func</span>&nbsp;<span class="op" id="6327111">(</span><span class="ident" id="6327112">e</span>&nbsp;<span class="op" id="6327114">*</span><span class="ident" id="6327115">encoder</span><span class="op" id="6327122">)</span>&nbsp;<span class="ident" id="6327124">emit</span><span class="op" id="6327128">(</span><span class="ident" id="6327129">bits</span><span class="op" id="6327133">,</span>&nbsp;<span class="ident" id="6327135">nBits</span>&nbsp;<span class="builtintype" id="6327141">uint32</span><span class="op" id="6327147">)</span>&nbsp;<span class="op" id="6327149">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327152">nBits</span>&nbsp;<span class="op" id="6327158">+=</span>&nbsp;<span class="ident" id="6327161">e</span><span class="op" id="6327162">.</span><span class="ident" id="6327163">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327170">bits</span>&nbsp;<span class="op" id="6327175">&lt;&lt;=</span>&nbsp;<span class="num" id="6327179">32</span>&nbsp;<span class="op" id="6327182">-</span>&nbsp;<span class="ident" id="6327184">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327191">bits</span>&nbsp;<span class="op" id="6327196">|=</span>&nbsp;<span class="ident" id="6327199">e</span><span class="op" id="6327200">.</span><span class="ident" id="6327201">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327207">for</span>&nbsp;<span class="ident" id="6327211">nBits</span>&nbsp;<span class="op" id="6327217">&gt;=</span>&nbsp;<span class="num" id="6327220">8</span>&nbsp;<span class="op" id="6327222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327226">b</span>&nbsp;<span class="op" id="6327228">:=</span>&nbsp;<span class="builtintype" id="6327231">uint8</span><span class="op" id="6327236">(</span><span class="ident" id="6327237">bits</span>&nbsp;<span class="op" id="6327242">&gt;&gt;</span>&nbsp;<span class="num" id="6327245">24</span><span class="op" id="6327247">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327251">e</span><span class="op" id="6327252">.</span><span class="ident" id="6327253">writeByte</span><span class="op" id="6327262">(</span><span class="ident" id="6327263">b</span><span class="op" id="6327264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327268">if</span>&nbsp;<span class="ident" id="6327271">b</span>&nbsp;<span class="op" id="6327273">==</span>&nbsp;<span class="num" id="6327276">0xff</span>&nbsp;<span class="op" id="6327281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327286">e</span><span class="op" id="6327287">.</span><span class="ident" id="6327288">writeByte</span><span class="op" id="6327297">(</span><span class="num" id="6327298">0x00</span><span class="op" id="6327302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327310">bits</span>&nbsp;<span class="op" id="6327315">&lt;&lt;=</span>&nbsp;<span class="num" id="6327319">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327323">nBits</span>&nbsp;<span class="op" id="6327329">-=</span>&nbsp;<span class="num" id="6327332">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327338">e</span><span class="op" id="6327339">.</span><span class="ident" id="6327340">bits</span><span class="op" id="6327344">,</span>&nbsp;<span class="ident" id="6327346">e</span><span class="op" id="6327347">.</span><span class="ident" id="6327348">nBits</span>&nbsp;<span class="op" id="6327354">=</span>&nbsp;<span class="ident" id="6327356">bits</span><span class="op" id="6327360">,</span>&nbsp;<span class="ident" id="6327362">nBits</span><br>
<span class="lineno"></span><span class="op" id="6327368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6327371">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6327437">func</span>&nbsp;<span class="op" id="6327442">(</span><span class="ident" id="6327443">e</span>&nbsp;<span class="op" id="6327445">*</span><span class="ident" id="6327446">encoder</span><span class="op" id="6327453">)</span>&nbsp;<span class="ident" id="6327455">emitHuff</span><span class="op" id="6327463">(</span><span class="ident" id="6327464">h</span>&nbsp;<span class="ident" id="6327466">huffIndex</span><span class="op" id="6327475">,</span>&nbsp;<span class="ident" id="6327477">value</span>&nbsp;<span class="builtintype" id="6327483">int32</span><span class="op" id="6327488">)</span>&nbsp;<span class="op" id="6327490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327493">x</span>&nbsp;<span class="op" id="6327495">:=</span>&nbsp;<span class="ident" id="6327498">theHuffmanLUT</span><span class="op" id="6327511">[</span><span class="ident" id="6327512">h</span><span class="op" id="6327513">]</span><span class="op" id="6327514">[</span><span class="ident" id="6327515">value</span><span class="op" id="6327520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327523">e</span><span class="op" id="6327524">.</span><span class="ident" id="6327525">emit</span><span class="op" id="6327529">(</span><span class="ident" id="6327530">x</span><span class="op" id="6327531">&amp;</span><span class="op" id="6327532">(</span><span class="num" id="6327533">1</span><span class="op" id="6327534">&lt;&lt;</span><span class="num" id="6327536">24</span><span class="op" id="6327538">-</span><span class="num" id="6327539">1</span><span class="op" id="6327540">)</span><span class="op" id="6327541">,</span>&nbsp;<span class="ident" id="6327543">x</span><span class="op" id="6327544">&gt;&gt;</span><span class="num" id="6327546">24</span><span class="op" id="6327548">)</span><br>
<span class="lineno"></span><span class="op" id="6327550">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6327553">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6327632">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6327652">func</span>&nbsp;<span class="op" id="6327657">(</span><span class="ident" id="6327658">e</span>&nbsp;<span class="op" id="6327660">*</span><span class="ident" id="6327661">encoder</span><span class="op" id="6327668">)</span>&nbsp;<span class="ident" id="6327670">emitHuffRLE</span><span class="op" id="6327681">(</span><span class="ident" id="6327682">h</span>&nbsp;<span class="ident" id="6327684">huffIndex</span><span class="op" id="6327693">,</span>&nbsp;<span class="ident" id="6327695">runLength</span><span class="op" id="6327704">,</span>&nbsp;<span class="ident" id="6327706">value</span>&nbsp;<span class="builtintype" id="6327712">int32</span><span class="op" id="6327717">)</span>&nbsp;<span class="op" id="6327719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327722">a</span><span class="op" id="6327723">,</span>&nbsp;<span class="ident" id="6327725">b</span>&nbsp;<span class="op" id="6327727">:=</span>&nbsp;<span class="ident" id="6327730">value</span><span class="op" id="6327735">,</span>&nbsp;<span class="ident" id="6327737">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327744">if</span>&nbsp;<span class="ident" id="6327747">a</span>&nbsp;<span class="op" id="6327749">&lt;</span>&nbsp;<span class="num" id="6327751">0</span>&nbsp;<span class="op" id="6327753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327757">a</span><span class="op" id="6327758">,</span>&nbsp;<span class="ident" id="6327760">b</span>&nbsp;<span class="op" id="6327762">=</span>&nbsp;<span class="op" id="6327764">-</span><span class="ident" id="6327765">value</span><span class="op" id="6327770">,</span>&nbsp;<span class="ident" id="6327772">value</span><span class="op" id="6327777">-</span><span class="num" id="6327778">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327784">var</span>&nbsp;<span class="ident" id="6327788">nBits</span>&nbsp;<span class="builtintype" id="6327794">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327802">if</span>&nbsp;<span class="ident" id="6327805">a</span>&nbsp;<span class="op" id="6327807">&lt;</span>&nbsp;<span class="num" id="6327809">0x100</span>&nbsp;<span class="op" id="6327815">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327819">nBits</span>&nbsp;<span class="op" id="6327825">=</span>&nbsp;<span class="builtintype" id="6327827">uint32</span><span class="op" id="6327833">(</span><span class="ident" id="6327834">bitCount</span><span class="op" id="6327842">[</span><span class="ident" id="6327843">a</span><span class="op" id="6327844">]</span><span class="op" id="6327845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327848">}</span>&nbsp;<span class="keyword" id="6327850">else</span>&nbsp;<span class="op" id="6327855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327859">nBits</span>&nbsp;<span class="op" id="6327865">=</span>&nbsp;<span class="num" id="6327867">8</span>&nbsp;<span class="op" id="6327869">+</span>&nbsp;<span class="builtintype" id="6327871">uint32</span><span class="op" id="6327877">(</span><span class="ident" id="6327878">bitCount</span><span class="op" id="6327886">[</span><span class="ident" id="6327887">a</span><span class="op" id="6327888">&gt;&gt;</span><span class="num" id="6327890">8</span><span class="op" id="6327891">]</span><span class="op" id="6327892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327898">e</span><span class="op" id="6327899">.</span><span class="ident" id="6327900">emitHuff</span><span class="op" id="6327908">(</span><span class="ident" id="6327909">h</span><span class="op" id="6327910">,</span>&nbsp;<span class="ident" id="6327912">runLength</span><span class="op" id="6327921">&lt;&lt;</span><span class="num" id="6327923">4</span><span class="op" id="6327924">|</span><span class="builtintype" id="6327925">int32</span><span class="op" id="6327930">(</span><span class="ident" id="6327931">nBits</span><span class="op" id="6327936">)</span><span class="op" id="6327937">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327940">if</span>&nbsp;<span class="ident" id="6327943">nBits</span>&nbsp;<span class="op" id="6327949">&gt;</span>&nbsp;<span class="num" id="6327951">0</span>&nbsp;<span class="op" id="6327953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327957">e</span><span class="op" id="6327958">.</span><span class="ident" id="6327959">emit</span><span class="op" id="6327963">(</span><span class="builtintype" id="6327964">uint32</span><span class="op" id="6327970">(</span><span class="ident" id="6327971">b</span><span class="op" id="6327972">)</span><span class="op" id="6327973">&amp;</span><span class="op" id="6327974">(</span><span class="num" id="6327975">1</span><span class="op" id="6327976">&lt;&lt;</span><span class="ident" id="6327978">nBits</span><span class="op" id="6327983">-</span><span class="num" id="6327984">1</span><span class="op" id="6327985">)</span><span class="op" id="6327986">,</span>&nbsp;<span class="ident" id="6327988">nBits</span><span class="op" id="6327993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327996">}</span><br>
<span class="lineno"></span><span class="op" id="6327998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="6328001">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6328076">func</span>&nbsp;<span class="op" id="6328081">(</span><span class="ident" id="6328082">e</span>&nbsp;<span class="op" id="6328084">*</span><span class="ident" id="6328085">encoder</span><span class="op" id="6328092">)</span>&nbsp;<span class="ident" id="6328094">writeMarkerHeader</span><span class="op" id="6328111">(</span><span class="ident" id="6328112">marker</span>&nbsp;<span class="builtintype" id="6328119">uint8</span><span class="op" id="6328124">,</span>&nbsp;<span class="ident" id="6328126">markerlen</span>&nbsp;<span class="builtintype" id="6328136">int</span><span class="op" id="6328139">)</span>&nbsp;<span class="op" id="6328141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328144">e</span><span class="op" id="6328145">.</span><span class="ident" id="6328146">buf</span><span class="op" id="6328149">[</span><span class="num" id="6328150">0</span><span class="op" id="6328151">]</span>&nbsp;<span class="op" id="6328153">=</span>&nbsp;<span class="num" id="6328155">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328161">e</span><span class="op" id="6328162">.</span><span class="ident" id="6328163">buf</span><span class="op" id="6328166">[</span><span class="num" id="6328167">1</span><span class="op" id="6328168">]</span>&nbsp;<span class="op" id="6328170">=</span>&nbsp;<span class="ident" id="6328172">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328180">e</span><span class="op" id="6328181">.</span><span class="ident" id="6328182">buf</span><span class="op" id="6328185">[</span><span class="num" id="6328186">2</span><span class="op" id="6328187">]</span>&nbsp;<span class="op" id="6328189">=</span>&nbsp;<span class="builtintype" id="6328191">uint8</span><span class="op" id="6328196">(</span><span class="ident" id="6328197">markerlen</span>&nbsp;<span class="op" id="6328207">&gt;&gt;</span>&nbsp;<span class="num" id="6328210">8</span><span class="op" id="6328211">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328214">e</span><span class="op" id="6328215">.</span><span class="ident" id="6328216">buf</span><span class="op" id="6328219">[</span><span class="num" id="6328220">3</span><span class="op" id="6328221">]</span>&nbsp;<span class="op" id="6328223">=</span>&nbsp;<span class="builtintype" id="6328225">uint8</span><span class="op" id="6328230">(</span><span class="ident" id="6328231">markerlen</span>&nbsp;<span class="op" id="6328241">&amp;</span>&nbsp;<span class="num" id="6328243">0xff</span><span class="op" id="6328247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328250">e</span><span class="op" id="6328251">.</span><span class="ident" id="6328252">write</span><span class="op" id="6328257">(</span><span class="ident" id="6328258">e</span><span class="op" id="6328259">.</span><span class="ident" id="6328260">buf</span><span class="op" id="6328263">[</span><span class="op" id="6328264">:</span><span class="num" id="6328265">4</span><span class="op" id="6328266">]</span><span class="op" id="6328267">)</span><br>
<span class="lineno"></span><span class="op" id="6328269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6328272">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="6328329">func</span>&nbsp;<span class="op" id="6328334">(</span><span class="ident" id="6328335">e</span>&nbsp;<span class="op" id="6328337">*</span><span class="ident" id="6328338">encoder</span><span class="op" id="6328345">)</span>&nbsp;<span class="ident" id="6328347">writeDQT</span><span class="op" id="6328355">(</span><span class="op" id="6328356">)</span>&nbsp;<span class="op" id="6328358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328361">const</span>&nbsp;<span class="ident" id="6328367">markerlen</span>&nbsp;<span class="op" id="6328377">=</span>&nbsp;<span class="num" id="6328379">2</span>&nbsp;<span class="op" id="6328381">+</span>&nbsp;<span class="builtintype" id="6328383">int</span><span class="op" id="6328386">(</span><span class="ident" id="6328387">nQuantIndex</span><span class="op" id="6328398">)</span><span class="op" id="6328399">*</span><span class="op" id="6328400">(</span><span class="num" id="6328401">1</span><span class="op" id="6328402">+</span><span class="ident" id="6328403">blockSize</span><span class="op" id="6328412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328415">e</span><span class="op" id="6328416">.</span><span class="ident" id="6328417">writeMarkerHeader</span><span class="op" id="6328434">(</span><span class="ident" id="6328435">dqtMarker</span><span class="op" id="6328444">,</span>&nbsp;<span class="ident" id="6328446">markerlen</span><span class="op" id="6328455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328458">for</span>&nbsp;<span class="ident" id="6328462">i</span>&nbsp;<span class="op" id="6328464">:=</span>&nbsp;<span class="keyword" id="6328467">range</span>&nbsp;<span class="ident" id="6328473">e</span><span class="op" id="6328474">.</span><span class="ident" id="6328475">quant</span>&nbsp;<span class="op" id="6328481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328485">e</span><span class="op" id="6328486">.</span><span class="ident" id="6328487">writeByte</span><span class="op" id="6328496">(</span><span class="builtintype" id="6328497">uint8</span><span class="op" id="6328502">(</span><span class="ident" id="6328503">i</span><span class="op" id="6328504">)</span><span class="op" id="6328505">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328509">e</span><span class="op" id="6328510">.</span><span class="ident" id="6328511">write</span><span class="op" id="6328516">(</span><span class="ident" id="6328517">e</span><span class="op" id="6328518">.</span><span class="ident" id="6328519">quant</span><span class="op" id="6328524">[</span><span class="ident" id="6328525">i</span><span class="op" id="6328526">]</span><span class="op" id="6328527">[</span><span class="op" id="6328528">:</span><span class="op" id="6328529">]</span><span class="op" id="6328530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328533">}</span><br>
<span class="lineno"></span><span class="op" id="6328535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6328538">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="6328596">func</span>&nbsp;<span class="op" id="6328601">(</span><span class="ident" id="6328602">e</span>&nbsp;<span class="op" id="6328604">*</span><span class="ident" id="6328605">encoder</span><span class="op" id="6328612">)</span>&nbsp;<span class="ident" id="6328614">writeSOF0</span><span class="op" id="6328623">(</span><span class="ident" id="6328624">size</span>&nbsp;<span class="ident" id="6328629">image</span><span class="op" id="6328634">.</span><span class="ident" id="6328635">Point</span><span class="op" id="6328640">,</span>&nbsp;<span class="ident" id="6328642">nComponent</span>&nbsp;<span class="builtintype" id="6328653">int</span><span class="op" id="6328656">)</span>&nbsp;<span class="op" id="6328658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328661">markerlen</span>&nbsp;<span class="op" id="6328671">:=</span>&nbsp;<span class="num" id="6328674">8</span>&nbsp;<span class="op" id="6328676">+</span>&nbsp;<span class="num" id="6328678">3</span><span class="op" id="6328679">*</span><span class="ident" id="6328680">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328692">e</span><span class="op" id="6328693">.</span><span class="ident" id="6328694">writeMarkerHeader</span><span class="op" id="6328711">(</span><span class="ident" id="6328712">sof0Marker</span><span class="op" id="6328722">,</span>&nbsp;<span class="ident" id="6328724">markerlen</span><span class="op" id="6328733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328736">e</span><span class="op" id="6328737">.</span><span class="ident" id="6328738">buf</span><span class="op" id="6328741">[</span><span class="num" id="6328742">0</span><span class="op" id="6328743">]</span>&nbsp;<span class="op" id="6328745">=</span>&nbsp;<span class="num" id="6328747">8</span>&nbsp;<span class="comment" id="6328749">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328766">e</span><span class="op" id="6328767">.</span><span class="ident" id="6328768">buf</span><span class="op" id="6328771">[</span><span class="num" id="6328772">1</span><span class="op" id="6328773">]</span>&nbsp;<span class="op" id="6328775">=</span>&nbsp;<span class="builtintype" id="6328777">uint8</span><span class="op" id="6328782">(</span><span class="ident" id="6328783">size</span><span class="op" id="6328787">.</span><span class="ident" id="6328788">Y</span>&nbsp;<span class="op" id="6328790">&gt;&gt;</span>&nbsp;<span class="num" id="6328793">8</span><span class="op" id="6328794">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328797">e</span><span class="op" id="6328798">.</span><span class="ident" id="6328799">buf</span><span class="op" id="6328802">[</span><span class="num" id="6328803">2</span><span class="op" id="6328804">]</span>&nbsp;<span class="op" id="6328806">=</span>&nbsp;<span class="builtintype" id="6328808">uint8</span><span class="op" id="6328813">(</span><span class="ident" id="6328814">size</span><span class="op" id="6328818">.</span><span class="ident" id="6328819">Y</span>&nbsp;<span class="op" id="6328821">&amp;</span>&nbsp;<span class="num" id="6328823">0xff</span><span class="op" id="6328827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328830">e</span><span class="op" id="6328831">.</span><span class="ident" id="6328832">buf</span><span class="op" id="6328835">[</span><span class="num" id="6328836">3</span><span class="op" id="6328837">]</span>&nbsp;<span class="op" id="6328839">=</span>&nbsp;<span class="builtintype" id="6328841">uint8</span><span class="op" id="6328846">(</span><span class="ident" id="6328847">size</span><span class="op" id="6328851">.</span><span class="ident" id="6328852">X</span>&nbsp;<span class="op" id="6328854">&gt;&gt;</span>&nbsp;<span class="num" id="6328857">8</span><span class="op" id="6328858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328861">e</span><span class="op" id="6328862">.</span><span class="ident" id="6328863">buf</span><span class="op" id="6328866">[</span><span class="num" id="6328867">4</span><span class="op" id="6328868">]</span>&nbsp;<span class="op" id="6328870">=</span>&nbsp;<span class="builtintype" id="6328872">uint8</span><span class="op" id="6328877">(</span><span class="ident" id="6328878">size</span><span class="op" id="6328882">.</span><span class="ident" id="6328883">X</span>&nbsp;<span class="op" id="6328885">&amp;</span>&nbsp;<span class="num" id="6328887">0xff</span><span class="op" id="6328891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328894">e</span><span class="op" id="6328895">.</span><span class="ident" id="6328896">buf</span><span class="op" id="6328899">[</span><span class="num" id="6328900">5</span><span class="op" id="6328901">]</span>&nbsp;<span class="op" id="6328903">=</span>&nbsp;<span class="builtintype" id="6328905">uint8</span><span class="op" id="6328910">(</span><span class="ident" id="6328911">nComponent</span><span class="op" id="6328921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328924">if</span>&nbsp;<span class="ident" id="6328927">nComponent</span>&nbsp;<span class="op" id="6328938">==</span>&nbsp;<span class="num" id="6328941">1</span>&nbsp;<span class="op" id="6328943">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328947">e</span><span class="op" id="6328948">.</span><span class="ident" id="6328949">buf</span><span class="op" id="6328952">[</span><span class="num" id="6328953">6</span><span class="op" id="6328954">]</span>&nbsp;<span class="op" id="6328956">=</span>&nbsp;<span class="num" id="6328958">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328962">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329003">e</span><span class="op" id="6329004">.</span><span class="ident" id="6329005">buf</span><span class="op" id="6329008">[</span><span class="num" id="6329009">7</span><span class="op" id="6329010">]</span>&nbsp;<span class="op" id="6329012">=</span>&nbsp;<span class="num" id="6329014">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329021">e</span><span class="op" id="6329022">.</span><span class="ident" id="6329023">buf</span><span class="op" id="6329026">[</span><span class="num" id="6329027">8</span><span class="op" id="6329028">]</span>&nbsp;<span class="op" id="6329030">=</span>&nbsp;<span class="num" id="6329032">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329038">}</span>&nbsp;<span class="keyword" id="6329040">else</span>&nbsp;<span class="op" id="6329045">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329049">for</span>&nbsp;<span class="ident" id="6329053">i</span>&nbsp;<span class="op" id="6329055">:=</span>&nbsp;<span class="num" id="6329058">0</span><span class="op" id="6329059">;</span>&nbsp;<span class="ident" id="6329061">i</span>&nbsp;<span class="op" id="6329063">&lt;</span>&nbsp;<span class="ident" id="6329065">nComponent</span><span class="op" id="6329075">;</span>&nbsp;<span class="ident" id="6329077">i</span><span class="op" id="6329078">++</span>&nbsp;<span class="op" id="6329081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329086">e</span><span class="op" id="6329087">.</span><span class="ident" id="6329088">buf</span><span class="op" id="6329091">[</span><span class="num" id="6329092">3</span><span class="op" id="6329093">*</span><span class="ident" id="6329094">i</span><span class="op" id="6329095">+</span><span class="num" id="6329096">6</span><span class="op" id="6329097">]</span>&nbsp;<span class="op" id="6329099">=</span>&nbsp;<span class="builtintype" id="6329101">uint8</span><span class="op" id="6329106">(</span><span class="ident" id="6329107">i</span>&nbsp;<span class="op" id="6329109">+</span>&nbsp;<span class="num" id="6329111">1</span><span class="op" id="6329112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329117">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329156">e</span><span class="op" id="6329157">.</span><span class="ident" id="6329158">buf</span><span class="op" id="6329161">[</span><span class="num" id="6329162">3</span><span class="op" id="6329163">*</span><span class="ident" id="6329164">i</span><span class="op" id="6329165">+</span><span class="num" id="6329166">7</span><span class="op" id="6329167">]</span>&nbsp;<span class="op" id="6329169">=</span>&nbsp;<span class="string" id="6329171">&#34;\x22\x11\x11&#34;</span><span class="op" id="6329185">[</span><span class="ident" id="6329186">i</span><span class="op" id="6329187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329192">e</span><span class="op" id="6329193">.</span><span class="ident" id="6329194">buf</span><span class="op" id="6329197">[</span><span class="num" id="6329198">3</span><span class="op" id="6329199">*</span><span class="ident" id="6329200">i</span><span class="op" id="6329201">+</span><span class="num" id="6329202">8</span><span class="op" id="6329203">]</span>&nbsp;<span class="op" id="6329205">=</span>&nbsp;<span class="string" id="6329207">&#34;\x00\x01\x01&#34;</span><span class="op" id="6329221">[</span><span class="ident" id="6329222">i</span><span class="op" id="6329223">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329233">e</span><span class="op" id="6329234">.</span><span class="ident" id="6329235">write</span><span class="op" id="6329240">(</span><span class="ident" id="6329241">e</span><span class="op" id="6329242">.</span><span class="ident" id="6329243">buf</span><span class="op" id="6329246">[</span><span class="op" id="6329247">:</span><span class="num" id="6329248">3</span><span class="op" id="6329249">*</span><span class="op" id="6329250">(</span><span class="ident" id="6329251">nComponent</span><span class="op" id="6329261">-</span><span class="num" id="6329262">1</span><span class="op" id="6329263">)</span><span class="op" id="6329264">+</span><span class="num" id="6329265">9</span><span class="op" id="6329266">]</span><span class="op" id="6329267">)</span><br>
<span class="lineno"></span><span class="op" id="6329269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6329272">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="6329324">func</span>&nbsp;<span class="op" id="6329329">(</span><span class="ident" id="6329330">e</span>&nbsp;<span class="op" id="6329332">*</span><span class="ident" id="6329333">encoder</span><span class="op" id="6329340">)</span>&nbsp;<span class="ident" id="6329342">writeDHT</span><span class="op" id="6329350">(</span><span class="ident" id="6329351">nComponent</span>&nbsp;<span class="builtintype" id="6329362">int</span><span class="op" id="6329365">)</span>&nbsp;<span class="op" id="6329367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329370">markerlen</span>&nbsp;<span class="op" id="6329380">:=</span>&nbsp;<span class="num" id="6329383">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329386">specs</span>&nbsp;<span class="op" id="6329392">:=</span>&nbsp;<span class="ident" id="6329395">theHuffmanSpec</span><span class="op" id="6329409">[</span><span class="op" id="6329410">:</span><span class="op" id="6329411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329414">if</span>&nbsp;<span class="ident" id="6329417">nComponent</span>&nbsp;<span class="op" id="6329428">==</span>&nbsp;<span class="num" id="6329431">1</span>&nbsp;<span class="op" id="6329433">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329437">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329471">specs</span>&nbsp;<span class="op" id="6329477">=</span>&nbsp;<span class="ident" id="6329479">specs</span><span class="op" id="6329484">[</span><span class="op" id="6329485">:</span><span class="num" id="6329486">2</span><span class="op" id="6329487">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329493">for</span>&nbsp;<span class="ident" id="6329497">_</span><span class="op" id="6329498">,</span>&nbsp;<span class="ident" id="6329500">s</span>&nbsp;<span class="op" id="6329502">:=</span>&nbsp;<span class="keyword" id="6329505">range</span>&nbsp;<span class="ident" id="6329511">specs</span>&nbsp;<span class="op" id="6329517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329521">markerlen</span>&nbsp;<span class="op" id="6329531">+=</span>&nbsp;<span class="num" id="6329534">1</span>&nbsp;<span class="op" id="6329536">+</span>&nbsp;<span class="num" id="6329538">16</span>&nbsp;<span class="op" id="6329541">+</span>&nbsp;<span class="builtinfunc" id="6329543">len</span><span class="op" id="6329546">(</span><span class="ident" id="6329547">s</span><span class="op" id="6329548">.</span><span class="ident" id="6329549">value</span><span class="op" id="6329554">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329560">e</span><span class="op" id="6329561">.</span><span class="ident" id="6329562">writeMarkerHeader</span><span class="op" id="6329579">(</span><span class="ident" id="6329580">dhtMarker</span><span class="op" id="6329589">,</span>&nbsp;<span class="ident" id="6329591">markerlen</span><span class="op" id="6329600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329603">for</span>&nbsp;<span class="ident" id="6329607">i</span><span class="op" id="6329608">,</span>&nbsp;<span class="ident" id="6329610">s</span>&nbsp;<span class="op" id="6329612">:=</span>&nbsp;<span class="keyword" id="6329615">range</span>&nbsp;<span class="ident" id="6329621">specs</span>&nbsp;<span class="op" id="6329627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329631">e</span><span class="op" id="6329632">.</span><span class="ident" id="6329633">writeByte</span><span class="op" id="6329642">(</span><span class="string" id="6329643">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="6329661">[</span><span class="ident" id="6329662">i</span><span class="op" id="6329663">]</span><span class="op" id="6329664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329668">e</span><span class="op" id="6329669">.</span><span class="ident" id="6329670">write</span><span class="op" id="6329675">(</span><span class="ident" id="6329676">s</span><span class="op" id="6329677">.</span><span class="ident" id="6329678">count</span><span class="op" id="6329683">[</span><span class="op" id="6329684">:</span><span class="op" id="6329685">]</span><span class="op" id="6329686">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329690">e</span><span class="op" id="6329691">.</span><span class="ident" id="6329692">write</span><span class="op" id="6329697">(</span><span class="ident" id="6329698">s</span><span class="op" id="6329699">.</span><span class="ident" id="6329700">value</span><span class="op" id="6329705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329708">}</span><br>
<span class="lineno"></span><span class="op" id="6329710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6329713">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="6329792">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6329871">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6329903">func</span>&nbsp;<span class="op" id="6329908">(</span><span class="ident" id="6329909">e</span>&nbsp;<span class="op" id="6329911">*</span><span class="ident" id="6329912">encoder</span><span class="op" id="6329919">)</span>&nbsp;<span class="ident" id="6329921">writeBlock</span><span class="op" id="6329931">(</span><span class="ident" id="6329932">b</span>&nbsp;<span class="op" id="6329934">*</span><span class="ident" id="6329935">block</span><span class="op" id="6329940">,</span>&nbsp;<span class="ident" id="6329942">q</span>&nbsp;<span class="ident" id="6329944">quantIndex</span><span class="op" id="6329954">,</span>&nbsp;<span class="ident" id="6329956">prevDC</span>&nbsp;<span class="builtintype" id="6329963">int32</span><span class="op" id="6329968">)</span>&nbsp;<span class="builtintype" id="6329970">int32</span>&nbsp;<span class="op" id="6329976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329979">fdct</span><span class="op" id="6329983">(</span><span class="ident" id="6329984">b</span><span class="op" id="6329985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329988">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330011">dc</span>&nbsp;<span class="op" id="6330014">:=</span>&nbsp;<span class="ident" id="6330017">div</span><span class="op" id="6330020">(</span><span class="ident" id="6330021">b</span><span class="op" id="6330022">[</span><span class="num" id="6330023">0</span><span class="op" id="6330024">]</span><span class="op" id="6330025">,</span>&nbsp;<span class="num" id="6330027">8</span><span class="op" id="6330028">*</span><span class="builtintype" id="6330029">int32</span><span class="op" id="6330034">(</span><span class="ident" id="6330035">e</span><span class="op" id="6330036">.</span><span class="ident" id="6330037">quant</span><span class="op" id="6330042">[</span><span class="ident" id="6330043">q</span><span class="op" id="6330044">]</span><span class="op" id="6330045">[</span><span class="num" id="6330046">0</span><span class="op" id="6330047">]</span><span class="op" id="6330048">)</span><span class="op" id="6330049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330052">e</span><span class="op" id="6330053">.</span><span class="ident" id="6330054">emitHuffRLE</span><span class="op" id="6330065">(</span><span class="ident" id="6330066">huffIndex</span><span class="op" id="6330075">(</span><span class="num" id="6330076">2</span><span class="op" id="6330077">*</span><span class="ident" id="6330078">q</span><span class="op" id="6330079">+</span><span class="num" id="6330080">0</span><span class="op" id="6330081">)</span><span class="op" id="6330082">,</span>&nbsp;<span class="num" id="6330084">0</span><span class="op" id="6330085">,</span>&nbsp;<span class="ident" id="6330087">dc</span><span class="op" id="6330089">-</span><span class="ident" id="6330090">prevDC</span><span class="op" id="6330096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330099">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330127">h</span><span class="op" id="6330128">,</span>&nbsp;<span class="ident" id="6330130">runLength</span>&nbsp;<span class="op" id="6330140">:=</span>&nbsp;<span class="ident" id="6330143">huffIndex</span><span class="op" id="6330152">(</span><span class="num" id="6330153">2</span><span class="op" id="6330154">*</span><span class="ident" id="6330155">q</span><span class="op" id="6330156">+</span><span class="num" id="6330157">1</span><span class="op" id="6330158">)</span><span class="op" id="6330159">,</span>&nbsp;<span class="builtintype" id="6330161">int32</span><span class="op" id="6330166">(</span><span class="num" id="6330167">0</span><span class="op" id="6330168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330171">for</span>&nbsp;<span class="ident" id="6330175">zig</span>&nbsp;<span class="op" id="6330179">:=</span>&nbsp;<span class="num" id="6330182">1</span><span class="op" id="6330183">;</span>&nbsp;<span class="ident" id="6330185">zig</span>&nbsp;<span class="op" id="6330189">&lt;</span>&nbsp;<span class="ident" id="6330191">blockSize</span><span class="op" id="6330200">;</span>&nbsp;<span class="ident" id="6330202">zig</span><span class="op" id="6330205">++</span>&nbsp;<span class="op" id="6330208">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330212">ac</span>&nbsp;<span class="op" id="6330215">:=</span>&nbsp;<span class="ident" id="6330218">div</span><span class="op" id="6330221">(</span><span class="ident" id="6330222">b</span><span class="op" id="6330223">[</span><span class="ident" id="6330224">unzig</span><span class="op" id="6330229">[</span><span class="ident" id="6330230">zig</span><span class="op" id="6330233">]</span><span class="op" id="6330234">]</span><span class="op" id="6330235">,</span>&nbsp;<span class="num" id="6330237">8</span><span class="op" id="6330238">*</span><span class="builtintype" id="6330239">int32</span><span class="op" id="6330244">(</span><span class="ident" id="6330245">e</span><span class="op" id="6330246">.</span><span class="ident" id="6330247">quant</span><span class="op" id="6330252">[</span><span class="ident" id="6330253">q</span><span class="op" id="6330254">]</span><span class="op" id="6330255">[</span><span class="ident" id="6330256">zig</span><span class="op" id="6330259">]</span><span class="op" id="6330260">)</span><span class="op" id="6330261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330265">if</span>&nbsp;<span class="ident" id="6330268">ac</span>&nbsp;<span class="op" id="6330271">==</span>&nbsp;<span class="num" id="6330274">0</span>&nbsp;<span class="op" id="6330276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330281">runLength</span><span class="op" id="6330290">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330295">}</span>&nbsp;<span class="keyword" id="6330297">else</span>&nbsp;<span class="op" id="6330302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330307">for</span>&nbsp;<span class="ident" id="6330311">runLength</span>&nbsp;<span class="op" id="6330321">&gt;</span>&nbsp;<span class="num" id="6330323">15</span>&nbsp;<span class="op" id="6330326">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330332">e</span><span class="op" id="6330333">.</span><span class="ident" id="6330334">emitHuff</span><span class="op" id="6330342">(</span><span class="ident" id="6330343">h</span><span class="op" id="6330344">,</span>&nbsp;<span class="num" id="6330346">0xf0</span><span class="op" id="6330350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330356">runLength</span>&nbsp;<span class="op" id="6330366">-=</span>&nbsp;<span class="num" id="6330369">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330380">e</span><span class="op" id="6330381">.</span><span class="ident" id="6330382">emitHuffRLE</span><span class="op" id="6330393">(</span><span class="ident" id="6330394">h</span><span class="op" id="6330395">,</span>&nbsp;<span class="ident" id="6330397">runLength</span><span class="op" id="6330406">,</span>&nbsp;<span class="ident" id="6330408">ac</span><span class="op" id="6330410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330415">runLength</span>&nbsp;<span class="op" id="6330425">=</span>&nbsp;<span class="num" id="6330427">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330437">if</span>&nbsp;<span class="ident" id="6330440">runLength</span>&nbsp;<span class="op" id="6330450">&gt;</span>&nbsp;<span class="num" id="6330452">0</span>&nbsp;<span class="op" id="6330454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330458">e</span><span class="op" id="6330459">.</span><span class="ident" id="6330460">emitHuff</span><span class="op" id="6330468">(</span><span class="ident" id="6330469">h</span><span class="op" id="6330470">,</span>&nbsp;<span class="num" id="6330472">0x00</span><span class="op" id="6330476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330479">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330482">return</span>&nbsp;<span class="ident" id="6330489">dc</span><br>
<span class="lineno"></span><span class="op" id="6330492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6330495">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6330569">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="6330586">func</span>&nbsp;<span class="ident" id="6330591">toYCbCr</span><span class="op" id="6330598">(</span><span class="ident" id="6330599">m</span>&nbsp;<span class="ident" id="6330601">image</span><span class="op" id="6330606">.</span><span class="ident" id="6330607">Image</span><span class="op" id="6330612">,</span>&nbsp;<span class="ident" id="6330614">p</span>&nbsp;<span class="ident" id="6330616">image</span><span class="op" id="6330621">.</span><span class="ident" id="6330622">Point</span><span class="op" id="6330627">,</span>&nbsp;<span class="ident" id="6330629">yBlock</span><span class="op" id="6330635">,</span>&nbsp;<span class="ident" id="6330637">cbBlock</span><span class="op" id="6330644">,</span>&nbsp;<span class="ident" id="6330646">crBlock</span>&nbsp;<span class="op" id="6330654">*</span><span class="ident" id="6330655">block</span><span class="op" id="6330660">)</span>&nbsp;<span class="op" id="6330662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330665">b</span>&nbsp;<span class="op" id="6330667">:=</span>&nbsp;<span class="ident" id="6330670">m</span><span class="op" id="6330671">.</span><span class="ident" id="6330672">Bounds</span><span class="op" id="6330678">(</span><span class="op" id="6330679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330682">xmax</span>&nbsp;<span class="op" id="6330687">:=</span>&nbsp;<span class="ident" id="6330690">b</span><span class="op" id="6330691">.</span><span class="ident" id="6330692">Max</span><span class="op" id="6330695">.</span><span class="ident" id="6330696">X</span>&nbsp;<span class="op" id="6330698">-</span>&nbsp;<span class="num" id="6330700">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330703">ymax</span>&nbsp;<span class="op" id="6330708">:=</span>&nbsp;<span class="ident" id="6330711">b</span><span class="op" id="6330712">.</span><span class="ident" id="6330713">Max</span><span class="op" id="6330716">.</span><span class="ident" id="6330717">Y</span>&nbsp;<span class="op" id="6330719">-</span>&nbsp;<span class="num" id="6330721">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330724">for</span>&nbsp;<span class="ident" id="6330728">j</span>&nbsp;<span class="op" id="6330730">:=</span>&nbsp;<span class="num" id="6330733">0</span><span class="op" id="6330734">;</span>&nbsp;<span class="ident" id="6330736">j</span>&nbsp;<span class="op" id="6330738">&lt;</span>&nbsp;<span class="num" id="6330740">8</span><span class="op" id="6330741">;</span>&nbsp;<span class="ident" id="6330743">j</span><span class="op" id="6330744">++</span>&nbsp;<span class="op" id="6330747">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330751">for</span>&nbsp;<span class="ident" id="6330755">i</span>&nbsp;<span class="op" id="6330757">:=</span>&nbsp;<span class="num" id="6330760">0</span><span class="op" id="6330761">;</span>&nbsp;<span class="ident" id="6330763">i</span>&nbsp;<span class="op" id="6330765">&lt;</span>&nbsp;<span class="num" id="6330767">8</span><span class="op" id="6330768">;</span>&nbsp;<span class="ident" id="6330770">i</span><span class="op" id="6330771">++</span>&nbsp;<span class="op" id="6330774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330779">r</span><span class="op" id="6330780">,</span>&nbsp;<span class="ident" id="6330782">g</span><span class="op" id="6330783">,</span>&nbsp;<span class="ident" id="6330785">b</span><span class="op" id="6330786">,</span>&nbsp;<span class="ident" id="6330788">_</span>&nbsp;<span class="op" id="6330790">:=</span>&nbsp;<span class="ident" id="6330793">m</span><span class="op" id="6330794">.</span><span class="ident" id="6330795">At</span><span class="op" id="6330797">(</span><span class="ident" id="6330798">min</span><span class="op" id="6330801">(</span><span class="ident" id="6330802">p</span><span class="op" id="6330803">.</span><span class="ident" id="6330804">X</span><span class="op" id="6330805">+</span><span class="ident" id="6330806">i</span><span class="op" id="6330807">,</span>&nbsp;<span class="ident" id="6330809">xmax</span><span class="op" id="6330813">)</span><span class="op" id="6330814">,</span>&nbsp;<span class="ident" id="6330816">min</span><span class="op" id="6330819">(</span><span class="ident" id="6330820">p</span><span class="op" id="6330821">.</span><span class="ident" id="6330822">Y</span><span class="op" id="6330823">+</span><span class="ident" id="6330824">j</span><span class="op" id="6330825">,</span>&nbsp;<span class="ident" id="6330827">ymax</span><span class="op" id="6330831">)</span><span class="op" id="6330832">)</span><span class="op" id="6330833">.</span><span class="ident" id="6330834">RGBA</span><span class="op" id="6330838">(</span><span class="op" id="6330839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330844">yy</span><span class="op" id="6330846">,</span>&nbsp;<span class="ident" id="6330848">cb</span><span class="op" id="6330850">,</span>&nbsp;<span class="ident" id="6330852">cr</span>&nbsp;<span class="op" id="6330855">:=</span>&nbsp;<span class="ident" id="6330858">color</span><span class="op" id="6330863">.</span><span class="ident" id="6330864">RGBToYCbCr</span><span class="op" id="6330874">(</span><span class="builtintype" id="6330875">uint8</span><span class="op" id="6330880">(</span><span class="ident" id="6330881">r</span><span class="op" id="6330882">&gt;&gt;</span><span class="num" id="6330884">8</span><span class="op" id="6330885">)</span><span class="op" id="6330886">,</span>&nbsp;<span class="builtintype" id="6330888">uint8</span><span class="op" id="6330893">(</span><span class="ident" id="6330894">g</span><span class="op" id="6330895">&gt;&gt;</span><span class="num" id="6330897">8</span><span class="op" id="6330898">)</span><span class="op" id="6330899">,</span>&nbsp;<span class="builtintype" id="6330901">uint8</span><span class="op" id="6330906">(</span><span class="ident" id="6330907">b</span><span class="op" id="6330908">&gt;&gt;</span><span class="num" id="6330910">8</span><span class="op" id="6330911">)</span><span class="op" id="6330912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330917">yBlock</span><span class="op" id="6330923">[</span><span class="num" id="6330924">8</span><span class="op" id="6330925">*</span><span class="ident" id="6330926">j</span><span class="op" id="6330927">+</span><span class="ident" id="6330928">i</span><span class="op" id="6330929">]</span>&nbsp;<span class="op" id="6330931">=</span>&nbsp;<span class="builtintype" id="6330933">int32</span><span class="op" id="6330938">(</span><span class="ident" id="6330939">yy</span><span class="op" id="6330941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330946">cbBlock</span><span class="op" id="6330953">[</span><span class="num" id="6330954">8</span><span class="op" id="6330955">*</span><span class="ident" id="6330956">j</span><span class="op" id="6330957">+</span><span class="ident" id="6330958">i</span><span class="op" id="6330959">]</span>&nbsp;<span class="op" id="6330961">=</span>&nbsp;<span class="builtintype" id="6330963">int32</span><span class="op" id="6330968">(</span><span class="ident" id="6330969">cb</span><span class="op" id="6330971">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330976">crBlock</span><span class="op" id="6330983">[</span><span class="num" id="6330984">8</span><span class="op" id="6330985">*</span><span class="ident" id="6330986">j</span><span class="op" id="6330987">+</span><span class="ident" id="6330988">i</span><span class="op" id="6330989">]</span>&nbsp;<span class="op" id="6330991">=</span>&nbsp;<span class="builtintype" id="6330993">int32</span><span class="op" id="6330998">(</span><span class="ident" id="6330999">cr</span><span class="op" id="6331001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331008">}</span><br>
<span class="lineno"></span><span class="op" id="6331010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6331013">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="6331089">func</span>&nbsp;<span class="ident" id="6331094">grayToY</span><span class="op" id="6331101">(</span><span class="ident" id="6331102">m</span>&nbsp;<span class="op" id="6331104">*</span><span class="ident" id="6331105">image</span><span class="op" id="6331110">.</span><span class="ident" id="6331111">Gray</span><span class="op" id="6331115">,</span>&nbsp;<span class="ident" id="6331117">p</span>&nbsp;<span class="ident" id="6331119">image</span><span class="op" id="6331124">.</span><span class="ident" id="6331125">Point</span><span class="op" id="6331130">,</span>&nbsp;<span class="ident" id="6331132">yBlock</span>&nbsp;<span class="op" id="6331139">*</span><span class="ident" id="6331140">block</span><span class="op" id="6331145">)</span>&nbsp;<span class="op" id="6331147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331150">b</span>&nbsp;<span class="op" id="6331152">:=</span>&nbsp;<span class="ident" id="6331155">m</span><span class="op" id="6331156">.</span><span class="ident" id="6331157">Bounds</span><span class="op" id="6331163">(</span><span class="op" id="6331164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331167">xmax</span>&nbsp;<span class="op" id="6331172">:=</span>&nbsp;<span class="ident" id="6331175">b</span><span class="op" id="6331176">.</span><span class="ident" id="6331177">Max</span><span class="op" id="6331180">.</span><span class="ident" id="6331181">X</span>&nbsp;<span class="op" id="6331183">-</span>&nbsp;<span class="num" id="6331185">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331188">ymax</span>&nbsp;<span class="op" id="6331193">:=</span>&nbsp;<span class="ident" id="6331196">b</span><span class="op" id="6331197">.</span><span class="ident" id="6331198">Max</span><span class="op" id="6331201">.</span><span class="ident" id="6331202">Y</span>&nbsp;<span class="op" id="6331204">-</span>&nbsp;<span class="num" id="6331206">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331209">pix</span>&nbsp;<span class="op" id="6331213">:=</span>&nbsp;<span class="ident" id="6331216">m</span><span class="op" id="6331217">.</span><span class="ident" id="6331218">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331223">for</span>&nbsp;<span class="ident" id="6331227">j</span>&nbsp;<span class="op" id="6331229">:=</span>&nbsp;<span class="num" id="6331232">0</span><span class="op" id="6331233">;</span>&nbsp;<span class="ident" id="6331235">j</span>&nbsp;<span class="op" id="6331237">&lt;</span>&nbsp;<span class="num" id="6331239">8</span><span class="op" id="6331240">;</span>&nbsp;<span class="ident" id="6331242">j</span><span class="op" id="6331243">++</span>&nbsp;<span class="op" id="6331246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331250">for</span>&nbsp;<span class="ident" id="6331254">i</span>&nbsp;<span class="op" id="6331256">:=</span>&nbsp;<span class="num" id="6331259">0</span><span class="op" id="6331260">;</span>&nbsp;<span class="ident" id="6331262">i</span>&nbsp;<span class="op" id="6331264">&lt;</span>&nbsp;<span class="num" id="6331266">8</span><span class="op" id="6331267">;</span>&nbsp;<span class="ident" id="6331269">i</span><span class="op" id="6331270">++</span>&nbsp;<span class="op" id="6331273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331278">idx</span>&nbsp;<span class="op" id="6331282">:=</span>&nbsp;<span class="ident" id="6331285">m</span><span class="op" id="6331286">.</span><span class="ident" id="6331287">PixOffset</span><span class="op" id="6331296">(</span><span class="ident" id="6331297">min</span><span class="op" id="6331300">(</span><span class="ident" id="6331301">p</span><span class="op" id="6331302">.</span><span class="ident" id="6331303">X</span><span class="op" id="6331304">+</span><span class="ident" id="6331305">i</span><span class="op" id="6331306">,</span>&nbsp;<span class="ident" id="6331308">xmax</span><span class="op" id="6331312">)</span><span class="op" id="6331313">,</span>&nbsp;<span class="ident" id="6331315">min</span><span class="op" id="6331318">(</span><span class="ident" id="6331319">p</span><span class="op" id="6331320">.</span><span class="ident" id="6331321">Y</span><span class="op" id="6331322">+</span><span class="ident" id="6331323">j</span><span class="op" id="6331324">,</span>&nbsp;<span class="ident" id="6331326">ymax</span><span class="op" id="6331330">)</span><span class="op" id="6331331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331336">yBlock</span><span class="op" id="6331342">[</span><span class="num" id="6331343">8</span><span class="op" id="6331344">*</span><span class="ident" id="6331345">j</span><span class="op" id="6331346">+</span><span class="ident" id="6331347">i</span><span class="op" id="6331348">]</span>&nbsp;<span class="op" id="6331350">=</span>&nbsp;<span class="builtintype" id="6331352">int32</span><span class="op" id="6331357">(</span><span class="ident" id="6331358">pix</span><span class="op" id="6331361">[</span><span class="ident" id="6331362">idx</span><span class="op" id="6331365">]</span><span class="op" id="6331366">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331373">}</span><br>
<span class="lineno"></span><span class="op" id="6331375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6331378">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="6331452">func</span>&nbsp;<span class="ident" id="6331457">rgbaToYCbCr</span><span class="op" id="6331468">(</span><span class="ident" id="6331469">m</span>&nbsp;<span class="op" id="6331471">*</span><span class="ident" id="6331472">image</span><span class="op" id="6331477">.</span><span class="ident" id="6331478">RGBA</span><span class="op" id="6331482">,</span>&nbsp;<span class="ident" id="6331484">p</span>&nbsp;<span class="ident" id="6331486">image</span><span class="op" id="6331491">.</span><span class="ident" id="6331492">Point</span><span class="op" id="6331497">,</span>&nbsp;<span class="ident" id="6331499">yBlock</span><span class="op" id="6331505">,</span>&nbsp;<span class="ident" id="6331507">cbBlock</span><span class="op" id="6331514">,</span>&nbsp;<span class="ident" id="6331516">crBlock</span>&nbsp;<span class="op" id="6331524">*</span><span class="ident" id="6331525">block</span><span class="op" id="6331530">)</span>&nbsp;<span class="op" id="6331532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331535">b</span>&nbsp;<span class="op" id="6331537">:=</span>&nbsp;<span class="ident" id="6331540">m</span><span class="op" id="6331541">.</span><span class="ident" id="6331542">Bounds</span><span class="op" id="6331548">(</span><span class="op" id="6331549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331552">xmax</span>&nbsp;<span class="op" id="6331557">:=</span>&nbsp;<span class="ident" id="6331560">b</span><span class="op" id="6331561">.</span><span class="ident" id="6331562">Max</span><span class="op" id="6331565">.</span><span class="ident" id="6331566">X</span>&nbsp;<span class="op" id="6331568">-</span>&nbsp;<span class="num" id="6331570">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331573">ymax</span>&nbsp;<span class="op" id="6331578">:=</span>&nbsp;<span class="ident" id="6331581">b</span><span class="op" id="6331582">.</span><span class="ident" id="6331583">Max</span><span class="op" id="6331586">.</span><span class="ident" id="6331587">Y</span>&nbsp;<span class="op" id="6331589">-</span>&nbsp;<span class="num" id="6331591">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331594">for</span>&nbsp;<span class="ident" id="6331598">j</span>&nbsp;<span class="op" id="6331600">:=</span>&nbsp;<span class="num" id="6331603">0</span><span class="op" id="6331604">;</span>&nbsp;<span class="ident" id="6331606">j</span>&nbsp;<span class="op" id="6331608">&lt;</span>&nbsp;<span class="num" id="6331610">8</span><span class="op" id="6331611">;</span>&nbsp;<span class="ident" id="6331613">j</span><span class="op" id="6331614">++</span>&nbsp;<span class="op" id="6331617">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331621">sj</span>&nbsp;<span class="op" id="6331624">:=</span>&nbsp;<span class="ident" id="6331627">p</span><span class="op" id="6331628">.</span><span class="ident" id="6331629">Y</span>&nbsp;<span class="op" id="6331631">+</span>&nbsp;<span class="ident" id="6331633">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331637">if</span>&nbsp;<span class="ident" id="6331640">sj</span>&nbsp;<span class="op" id="6331643">&gt;</span>&nbsp;<span class="ident" id="6331645">ymax</span>&nbsp;<span class="op" id="6331650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331655">sj</span>&nbsp;<span class="op" id="6331658">=</span>&nbsp;<span class="ident" id="6331660">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331671">offset</span>&nbsp;<span class="op" id="6331678">:=</span>&nbsp;<span class="op" id="6331681">(</span><span class="ident" id="6331682">sj</span><span class="op" id="6331684">-</span><span class="ident" id="6331685">b</span><span class="op" id="6331686">.</span><span class="ident" id="6331687">Min</span><span class="op" id="6331690">.</span><span class="ident" id="6331691">Y</span><span class="op" id="6331692">)</span><span class="op" id="6331693">*</span><span class="ident" id="6331694">m</span><span class="op" id="6331695">.</span><span class="ident" id="6331696">Stride</span>&nbsp;<span class="op" id="6331703">-</span>&nbsp;<span class="ident" id="6331705">b</span><span class="op" id="6331706">.</span><span class="ident" id="6331707">Min</span><span class="op" id="6331710">.</span><span class="ident" id="6331711">X</span><span class="op" id="6331712">*</span><span class="num" id="6331713">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331717">for</span>&nbsp;<span class="ident" id="6331721">i</span>&nbsp;<span class="op" id="6331723">:=</span>&nbsp;<span class="num" id="6331726">0</span><span class="op" id="6331727">;</span>&nbsp;<span class="ident" id="6331729">i</span>&nbsp;<span class="op" id="6331731">&lt;</span>&nbsp;<span class="num" id="6331733">8</span><span class="op" id="6331734">;</span>&nbsp;<span class="ident" id="6331736">i</span><span class="op" id="6331737">++</span>&nbsp;<span class="op" id="6331740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331745">sx</span>&nbsp;<span class="op" id="6331748">:=</span>&nbsp;<span class="ident" id="6331751">p</span><span class="op" id="6331752">.</span><span class="ident" id="6331753">X</span>&nbsp;<span class="op" id="6331755">+</span>&nbsp;<span class="ident" id="6331757">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331762">if</span>&nbsp;<span class="ident" id="6331765">sx</span>&nbsp;<span class="op" id="6331768">&gt;</span>&nbsp;<span class="ident" id="6331770">xmax</span>&nbsp;<span class="op" id="6331775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331781">sx</span>&nbsp;<span class="op" id="6331784">=</span>&nbsp;<span class="ident" id="6331786">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331794">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331799">pix</span>&nbsp;<span class="op" id="6331803">:=</span>&nbsp;<span class="ident" id="6331806">m</span><span class="op" id="6331807">.</span><span class="ident" id="6331808">Pix</span><span class="op" id="6331811">[</span><span class="ident" id="6331812">offset</span><span class="op" id="6331818">+</span><span class="ident" id="6331819">sx</span><span class="op" id="6331821">*</span><span class="num" id="6331822">4</span><span class="op" id="6331823">:</span><span class="op" id="6331824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331829">yy</span><span class="op" id="6331831">,</span>&nbsp;<span class="ident" id="6331833">cb</span><span class="op" id="6331835">,</span>&nbsp;<span class="ident" id="6331837">cr</span>&nbsp;<span class="op" id="6331840">:=</span>&nbsp;<span class="ident" id="6331843">color</span><span class="op" id="6331848">.</span><span class="ident" id="6331849">RGBToYCbCr</span><span class="op" id="6331859">(</span><span class="ident" id="6331860">pix</span><span class="op" id="6331863">[</span><span class="num" id="6331864">0</span><span class="op" id="6331865">]</span><span class="op" id="6331866">,</span>&nbsp;<span class="ident" id="6331868">pix</span><span class="op" id="6331871">[</span><span class="num" id="6331872">1</span><span class="op" id="6331873">]</span><span class="op" id="6331874">,</span>&nbsp;<span class="ident" id="6331876">pix</span><span class="op" id="6331879">[</span><span class="num" id="6331880">2</span><span class="op" id="6331881">]</span><span class="op" id="6331882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331887">yBlock</span><span class="op" id="6331893">[</span><span class="num" id="6331894">8</span><span class="op" id="6331895">*</span><span class="ident" id="6331896">j</span><span class="op" id="6331897">+</span><span class="ident" id="6331898">i</span><span class="op" id="6331899">]</span>&nbsp;<span class="op" id="6331901">=</span>&nbsp;<span class="builtintype" id="6331903">int32</span><span class="op" id="6331908">(</span><span class="ident" id="6331909">yy</span><span class="op" id="6331911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331916">cbBlock</span><span class="op" id="6331923">[</span><span class="num" id="6331924">8</span><span class="op" id="6331925">*</span><span class="ident" id="6331926">j</span><span class="op" id="6331927">+</span><span class="ident" id="6331928">i</span><span class="op" id="6331929">]</span>&nbsp;<span class="op" id="6331931">=</span>&nbsp;<span class="builtintype" id="6331933">int32</span><span class="op" id="6331938">(</span><span class="ident" id="6331939">cb</span><span class="op" id="6331941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331946">crBlock</span><span class="op" id="6331953">[</span><span class="num" id="6331954">8</span><span class="op" id="6331955">*</span><span class="ident" id="6331956">j</span><span class="op" id="6331957">+</span><span class="ident" id="6331958">i</span><span class="op" id="6331959">]</span>&nbsp;<span class="op" id="6331961">=</span>&nbsp;<span class="builtintype" id="6331963">int32</span><span class="op" id="6331968">(</span><span class="ident" id="6331969">cr</span><span class="op" id="6331971">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331978">}</span><br>
<span class="lineno"></span><span class="op" id="6331980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6331983">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="6332059">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6332073">func</span>&nbsp;<span class="ident" id="6332078">scale</span><span class="op" id="6332083">(</span><span class="ident" id="6332084">dst</span>&nbsp;<span class="op" id="6332088">*</span><span class="ident" id="6332089">block</span><span class="op" id="6332094">,</span>&nbsp;<span class="ident" id="6332096">src</span>&nbsp;<span class="op" id="6332100">*</span><span class="op" id="6332101">[</span><span class="num" id="6332102">4</span><span class="op" id="6332103">]</span><span class="ident" id="6332104">block</span><span class="op" id="6332109">)</span>&nbsp;<span class="op" id="6332111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332114">for</span>&nbsp;<span class="ident" id="6332118">i</span>&nbsp;<span class="op" id="6332120">:=</span>&nbsp;<span class="num" id="6332123">0</span><span class="op" id="6332124">;</span>&nbsp;<span class="ident" id="6332126">i</span>&nbsp;<span class="op" id="6332128">&lt;</span>&nbsp;<span class="num" id="6332130">4</span><span class="op" id="6332131">;</span>&nbsp;<span class="ident" id="6332133">i</span><span class="op" id="6332134">++</span>&nbsp;<span class="op" id="6332137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332141">dstOff</span>&nbsp;<span class="op" id="6332148">:=</span>&nbsp;<span class="op" id="6332151">(</span><span class="ident" id="6332152">i</span><span class="op" id="6332153">&amp;</span><span class="num" id="6332154">2</span><span class="op" id="6332155">)</span><span class="op" id="6332156">&lt;&lt;</span><span class="num" id="6332158">4</span>&nbsp;<span class="op" id="6332160">|</span>&nbsp;<span class="op" id="6332162">(</span><span class="ident" id="6332163">i</span><span class="op" id="6332164">&amp;</span><span class="num" id="6332165">1</span><span class="op" id="6332166">)</span><span class="op" id="6332167">&lt;&lt;</span><span class="num" id="6332169">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332173">for</span>&nbsp;<span class="ident" id="6332177">y</span>&nbsp;<span class="op" id="6332179">:=</span>&nbsp;<span class="num" id="6332182">0</span><span class="op" id="6332183">;</span>&nbsp;<span class="ident" id="6332185">y</span>&nbsp;<span class="op" id="6332187">&lt;</span>&nbsp;<span class="num" id="6332189">4</span><span class="op" id="6332190">;</span>&nbsp;<span class="ident" id="6332192">y</span><span class="op" id="6332193">++</span>&nbsp;<span class="op" id="6332196">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332201">for</span>&nbsp;<span class="ident" id="6332205">x</span>&nbsp;<span class="op" id="6332207">:=</span>&nbsp;<span class="num" id="6332210">0</span><span class="op" id="6332211">;</span>&nbsp;<span class="ident" id="6332213">x</span>&nbsp;<span class="op" id="6332215">&lt;</span>&nbsp;<span class="num" id="6332217">4</span><span class="op" id="6332218">;</span>&nbsp;<span class="ident" id="6332220">x</span><span class="op" id="6332221">++</span>&nbsp;<span class="op" id="6332224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332230">j</span>&nbsp;<span class="op" id="6332232">:=</span>&nbsp;<span class="num" id="6332235">16</span><span class="op" id="6332237">*</span><span class="ident" id="6332238">y</span>&nbsp;<span class="op" id="6332240">+</span>&nbsp;<span class="num" id="6332242">2</span><span class="op" id="6332243">*</span><span class="ident" id="6332244">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332250">sum</span>&nbsp;<span class="op" id="6332254">:=</span>&nbsp;<span class="ident" id="6332257">src</span><span class="op" id="6332260">[</span><span class="ident" id="6332261">i</span><span class="op" id="6332262">]</span><span class="op" id="6332263">[</span><span class="ident" id="6332264">j</span><span class="op" id="6332265">]</span>&nbsp;<span class="op" id="6332267">+</span>&nbsp;<span class="ident" id="6332269">src</span><span class="op" id="6332272">[</span><span class="ident" id="6332273">i</span><span class="op" id="6332274">]</span><span class="op" id="6332275">[</span><span class="ident" id="6332276">j</span><span class="op" id="6332277">+</span><span class="num" id="6332278">1</span><span class="op" id="6332279">]</span>&nbsp;<span class="op" id="6332281">+</span>&nbsp;<span class="ident" id="6332283">src</span><span class="op" id="6332286">[</span><span class="ident" id="6332287">i</span><span class="op" id="6332288">]</span><span class="op" id="6332289">[</span><span class="ident" id="6332290">j</span><span class="op" id="6332291">+</span><span class="num" id="6332292">8</span><span class="op" id="6332293">]</span>&nbsp;<span class="op" id="6332295">+</span>&nbsp;<span class="ident" id="6332297">src</span><span class="op" id="6332300">[</span><span class="ident" id="6332301">i</span><span class="op" id="6332302">]</span><span class="op" id="6332303">[</span><span class="ident" id="6332304">j</span><span class="op" id="6332305">+</span><span class="num" id="6332306">9</span><span class="op" id="6332307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332313">dst</span><span class="op" id="6332316">[</span><span class="num" id="6332317">8</span><span class="op" id="6332318">*</span><span class="ident" id="6332319">y</span><span class="op" id="6332320">+</span><span class="ident" id="6332321">x</span><span class="op" id="6332322">+</span><span class="ident" id="6332323">dstOff</span><span class="op" id="6332329">]</span>&nbsp;<span class="op" id="6332331">=</span>&nbsp;<span class="op" id="6332333">(</span><span class="ident" id="6332334">sum</span>&nbsp;<span class="op" id="6332338">+</span>&nbsp;<span class="num" id="6332340">2</span><span class="op" id="6332341">)</span>&nbsp;<span class="op" id="6332343">&gt;&gt;</span>&nbsp;<span class="num" id="6332346">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332351">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332358">}</span><br>
<span class="lineno"></span><span class="op" id="6332360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6332363">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="6332427">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6332462">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6332500">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6332560">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6332631">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="6332706">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6332749">var</span>&nbsp;<span class="ident" id="6332753">sosHeaderY</span>&nbsp;<span class="op" id="6332764">=</span>&nbsp;<span class="op" id="6332766">[</span><span class="op" id="6332767">]</span><span class="builtintype" id="6332768">byte</span><span class="op" id="6332772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6332775">0xff</span><span class="op" id="6332779">,</span>&nbsp;<span class="num" id="6332781">0xda</span><span class="op" id="6332785">,</span>&nbsp;<span class="num" id="6332787">0x00</span><span class="op" id="6332791">,</span>&nbsp;<span class="num" id="6332793">0x08</span><span class="op" id="6332797">,</span>&nbsp;<span class="num" id="6332799">0x01</span><span class="op" id="6332803">,</span>&nbsp;<span class="num" id="6332805">0x01</span><span class="op" id="6332809">,</span>&nbsp;<span class="num" id="6332811">0x00</span><span class="op" id="6332815">,</span>&nbsp;<span class="num" id="6332817">0x00</span><span class="op" id="6332821">,</span>&nbsp;<span class="num" id="6332823">0x3f</span><span class="op" id="6332827">,</span>&nbsp;<span class="num" id="6332829">0x00</span><span class="op" id="6332833">,</span><br>
<span class="lineno"></span><span class="op" id="6332835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6332838">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="6332907">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6332942">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6332980">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6333040">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="6333100">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6333160">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6333231">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="6333306">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6333349">var</span>&nbsp;<span class="ident" id="6333353">sosHeaderYCbCr</span>&nbsp;<span class="op" id="6333368">=</span>&nbsp;<span class="op" id="6333370">[</span><span class="op" id="6333371">]</span><span class="builtintype" id="6333372">byte</span><span class="op" id="6333376">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6333379">0xff</span><span class="op" id="6333383">,</span>&nbsp;<span class="num" id="6333385">0xda</span><span class="op" id="6333389">,</span>&nbsp;<span class="num" id="6333391">0x00</span><span class="op" id="6333395">,</span>&nbsp;<span class="num" id="6333397">0x0c</span><span class="op" id="6333401">,</span>&nbsp;<span class="num" id="6333403">0x03</span><span class="op" id="6333407">,</span>&nbsp;<span class="num" id="6333409">0x01</span><span class="op" id="6333413">,</span>&nbsp;<span class="num" id="6333415">0x00</span><span class="op" id="6333419">,</span>&nbsp;<span class="num" id="6333421">0x02</span><span class="op" id="6333425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6333428">0x11</span><span class="op" id="6333432">,</span>&nbsp;<span class="num" id="6333434">0x03</span><span class="op" id="6333438">,</span>&nbsp;<span class="num" id="6333440">0x11</span><span class="op" id="6333444">,</span>&nbsp;<span class="num" id="6333446">0x00</span><span class="op" id="6333450">,</span>&nbsp;<span class="num" id="6333452">0x3f</span><span class="op" id="6333456">,</span>&nbsp;<span class="num" id="6333458">0x00</span><span class="op" id="6333462">,</span><br>
<span class="lineno"></span><span class="op" id="6333464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6333467">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="6333510">func</span>&nbsp;<span class="op" id="6333515">(</span><span class="ident" id="6333516">e</span>&nbsp;<span class="op" id="6333518">*</span><span class="ident" id="6333519">encoder</span><span class="op" id="6333526">)</span>&nbsp;<span class="ident" id="6333528">writeSOS</span><span class="op" id="6333536">(</span><span class="ident" id="6333537">m</span>&nbsp;<span class="ident" id="6333539">image</span><span class="op" id="6333544">.</span><span class="ident" id="6333545">Image</span><span class="op" id="6333550">)</span>&nbsp;<span class="op" id="6333552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333555">switch</span>&nbsp;<span class="ident" id="6333562">m</span><span class="op" id="6333563">.</span><span class="op" id="6333564">(</span><span class="keyword" id="6333565">type</span><span class="op" id="6333569">)</span>&nbsp;<span class="op" id="6333571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333574">case</span>&nbsp;<span class="op" id="6333579">*</span><span class="ident" id="6333580">image</span><span class="op" id="6333585">.</span><span class="ident" id="6333586">Gray</span><span class="op" id="6333590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333594">e</span><span class="op" id="6333595">.</span><span class="ident" id="6333596">write</span><span class="op" id="6333601">(</span><span class="ident" id="6333602">sosHeaderY</span><span class="op" id="6333612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333615">default</span><span class="op" id="6333622">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333626">e</span><span class="op" id="6333627">.</span><span class="ident" id="6333628">write</span><span class="op" id="6333633">(</span><span class="ident" id="6333634">sosHeaderYCbCr</span><span class="op" id="6333648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333654">var</span>&nbsp;<span class="op" id="6333658">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6333662">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6333709">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333761">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333768">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333776">cb</span><span class="op" id="6333778">,</span>&nbsp;<span class="ident" id="6333780">cr</span>&nbsp;<span class="op" id="6333783">[</span><span class="num" id="6333784">4</span><span class="op" id="6333785">]</span><span class="ident" id="6333786">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6333794">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333832">prevDCY</span><span class="op" id="6333839">,</span>&nbsp;<span class="ident" id="6333841">prevDCCb</span><span class="op" id="6333849">,</span>&nbsp;<span class="ident" id="6333851">prevDCCr</span>&nbsp;<span class="builtintype" id="6333860">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333867">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333870">bounds</span>&nbsp;<span class="op" id="6333877">:=</span>&nbsp;<span class="ident" id="6333880">m</span><span class="op" id="6333881">.</span><span class="ident" id="6333882">Bounds</span><span class="op" id="6333888">(</span><span class="op" id="6333889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333892">switch</span>&nbsp;<span class="ident" id="6333899">m</span>&nbsp;<span class="op" id="6333901">:=</span>&nbsp;<span class="ident" id="6333904">m</span><span class="op" id="6333905">.</span><span class="op" id="6333906">(</span><span class="keyword" id="6333907">type</span><span class="op" id="6333911">)</span>&nbsp;<span class="op" id="6333913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6333916">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333978">case</span>&nbsp;<span class="op" id="6333983">*</span><span class="ident" id="6333984">image</span><span class="op" id="6333989">.</span><span class="ident" id="6333990">Gray</span><span class="op" id="6333994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333998">for</span>&nbsp;<span class="ident" id="6334002">y</span>&nbsp;<span class="op" id="6334004">:=</span>&nbsp;<span class="ident" id="6334007">bounds</span><span class="op" id="6334013">.</span><span class="ident" id="6334014">Min</span><span class="op" id="6334017">.</span><span class="ident" id="6334018">Y</span><span class="op" id="6334019">;</span>&nbsp;<span class="ident" id="6334021">y</span>&nbsp;<span class="op" id="6334023">&lt;</span>&nbsp;<span class="ident" id="6334025">bounds</span><span class="op" id="6334031">.</span><span class="ident" id="6334032">Max</span><span class="op" id="6334035">.</span><span class="ident" id="6334036">Y</span><span class="op" id="6334037">;</span>&nbsp;<span class="ident" id="6334039">y</span>&nbsp;<span class="op" id="6334041">+=</span>&nbsp;<span class="num" id="6334044">8</span>&nbsp;<span class="op" id="6334046">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334051">for</span>&nbsp;<span class="ident" id="6334055">x</span>&nbsp;<span class="op" id="6334057">:=</span>&nbsp;<span class="ident" id="6334060">bounds</span><span class="op" id="6334066">.</span><span class="ident" id="6334067">Min</span><span class="op" id="6334070">.</span><span class="ident" id="6334071">X</span><span class="op" id="6334072">;</span>&nbsp;<span class="ident" id="6334074">x</span>&nbsp;<span class="op" id="6334076">&lt;</span>&nbsp;<span class="ident" id="6334078">bounds</span><span class="op" id="6334084">.</span><span class="ident" id="6334085">Max</span><span class="op" id="6334088">.</span><span class="ident" id="6334089">X</span><span class="op" id="6334090">;</span>&nbsp;<span class="ident" id="6334092">x</span>&nbsp;<span class="op" id="6334094">+=</span>&nbsp;<span class="num" id="6334097">8</span>&nbsp;<span class="op" id="6334099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334105">p</span>&nbsp;<span class="op" id="6334107">:=</span>&nbsp;<span class="ident" id="6334110">image</span><span class="op" id="6334115">.</span><span class="ident" id="6334116">Pt</span><span class="op" id="6334118">(</span><span class="ident" id="6334119">x</span><span class="op" id="6334120">,</span>&nbsp;<span class="ident" id="6334122">y</span><span class="op" id="6334123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334129">grayToY</span><span class="op" id="6334136">(</span><span class="ident" id="6334137">m</span><span class="op" id="6334138">,</span>&nbsp;<span class="ident" id="6334140">p</span><span class="op" id="6334141">,</span>&nbsp;<span class="op" id="6334143">&amp;</span><span class="ident" id="6334144">b</span><span class="op" id="6334145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334151">prevDCY</span>&nbsp;<span class="op" id="6334159">=</span>&nbsp;<span class="ident" id="6334161">e</span><span class="op" id="6334162">.</span><span class="ident" id="6334163">writeBlock</span><span class="op" id="6334173">(</span><span class="op" id="6334174">&amp;</span><span class="ident" id="6334175">b</span><span class="op" id="6334176">,</span>&nbsp;<span class="num" id="6334178">0</span><span class="op" id="6334179">,</span>&nbsp;<span class="ident" id="6334181">prevDCY</span><span class="op" id="6334188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334193">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334200">default</span><span class="op" id="6334207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334211">rgba</span><span class="op" id="6334215">,</span>&nbsp;<span class="ident" id="6334217">_</span>&nbsp;<span class="op" id="6334219">:=</span>&nbsp;<span class="ident" id="6334222">m</span><span class="op" id="6334223">.</span><span class="op" id="6334224">(</span><span class="op" id="6334225">*</span><span class="ident" id="6334226">image</span><span class="op" id="6334231">.</span><span class="ident" id="6334232">RGBA</span><span class="op" id="6334236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334240">for</span>&nbsp;<span class="ident" id="6334244">y</span>&nbsp;<span class="op" id="6334246">:=</span>&nbsp;<span class="ident" id="6334249">bounds</span><span class="op" id="6334255">.</span><span class="ident" id="6334256">Min</span><span class="op" id="6334259">.</span><span class="ident" id="6334260">Y</span><span class="op" id="6334261">;</span>&nbsp;<span class="ident" id="6334263">y</span>&nbsp;<span class="op" id="6334265">&lt;</span>&nbsp;<span class="ident" id="6334267">bounds</span><span class="op" id="6334273">.</span><span class="ident" id="6334274">Max</span><span class="op" id="6334277">.</span><span class="ident" id="6334278">Y</span><span class="op" id="6334279">;</span>&nbsp;<span class="ident" id="6334281">y</span>&nbsp;<span class="op" id="6334283">+=</span>&nbsp;<span class="num" id="6334286">16</span>&nbsp;<span class="op" id="6334289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334294">for</span>&nbsp;<span class="ident" id="6334298">x</span>&nbsp;<span class="op" id="6334300">:=</span>&nbsp;<span class="ident" id="6334303">bounds</span><span class="op" id="6334309">.</span><span class="ident" id="6334310">Min</span><span class="op" id="6334313">.</span><span class="ident" id="6334314">X</span><span class="op" id="6334315">;</span>&nbsp;<span class="ident" id="6334317">x</span>&nbsp;<span class="op" id="6334319">&lt;</span>&nbsp;<span class="ident" id="6334321">bounds</span><span class="op" id="6334327">.</span><span class="ident" id="6334328">Max</span><span class="op" id="6334331">.</span><span class="ident" id="6334332">X</span><span class="op" id="6334333">;</span>&nbsp;<span class="ident" id="6334335">x</span>&nbsp;<span class="op" id="6334337">+=</span>&nbsp;<span class="num" id="6334340">16</span>&nbsp;<span class="op" id="6334343">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334349">for</span>&nbsp;<span class="ident" id="6334353">i</span>&nbsp;<span class="op" id="6334355">:=</span>&nbsp;<span class="num" id="6334358">0</span><span class="op" id="6334359">;</span>&nbsp;<span class="ident" id="6334361">i</span>&nbsp;<span class="op" id="6334363">&lt;</span>&nbsp;<span class="num" id="6334365">4</span><span class="op" id="6334366">;</span>&nbsp;<span class="ident" id="6334368">i</span><span class="op" id="6334369">++</span>&nbsp;<span class="op" id="6334372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334379">xOff</span>&nbsp;<span class="op" id="6334384">:=</span>&nbsp;<span class="op" id="6334387">(</span><span class="ident" id="6334388">i</span>&nbsp;<span class="op" id="6334390">&amp;</span>&nbsp;<span class="num" id="6334392">1</span><span class="op" id="6334393">)</span>&nbsp;<span class="op" id="6334395">*</span>&nbsp;<span class="num" id="6334397">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334404">yOff</span>&nbsp;<span class="op" id="6334409">:=</span>&nbsp;<span class="op" id="6334412">(</span><span class="ident" id="6334413">i</span>&nbsp;<span class="op" id="6334415">&amp;</span>&nbsp;<span class="num" id="6334417">2</span><span class="op" id="6334418">)</span>&nbsp;<span class="op" id="6334420">*</span>&nbsp;<span class="num" id="6334422">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334429">p</span>&nbsp;<span class="op" id="6334431">:=</span>&nbsp;<span class="ident" id="6334434">image</span><span class="op" id="6334439">.</span><span class="ident" id="6334440">Pt</span><span class="op" id="6334442">(</span><span class="ident" id="6334443">x</span><span class="op" id="6334444">+</span><span class="ident" id="6334445">xOff</span><span class="op" id="6334449">,</span>&nbsp;<span class="ident" id="6334451">y</span><span class="op" id="6334452">+</span><span class="ident" id="6334453">yOff</span><span class="op" id="6334457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334464">if</span>&nbsp;<span class="ident" id="6334467">rgba</span>&nbsp;<span class="op" id="6334472">!=</span>&nbsp;<span class="ident" id="6334475">nil</span>&nbsp;<span class="op" id="6334479">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334487">rgbaToYCbCr</span><span class="op" id="6334498">(</span><span class="ident" id="6334499">rgba</span><span class="op" id="6334503">,</span>&nbsp;<span class="ident" id="6334505">p</span><span class="op" id="6334506">,</span>&nbsp;<span class="op" id="6334508">&amp;</span><span class="ident" id="6334509">b</span><span class="op" id="6334510">,</span>&nbsp;<span class="op" id="6334512">&amp;</span><span class="ident" id="6334513">cb</span><span class="op" id="6334515">[</span><span class="ident" id="6334516">i</span><span class="op" id="6334517">]</span><span class="op" id="6334518">,</span>&nbsp;<span class="op" id="6334520">&amp;</span><span class="ident" id="6334521">cr</span><span class="op" id="6334523">[</span><span class="ident" id="6334524">i</span><span class="op" id="6334525">]</span><span class="op" id="6334526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334533">}</span>&nbsp;<span class="keyword" id="6334535">else</span>&nbsp;<span class="op" id="6334540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334548">toYCbCr</span><span class="op" id="6334555">(</span><span class="ident" id="6334556">m</span><span class="op" id="6334557">,</span>&nbsp;<span class="ident" id="6334559">p</span><span class="op" id="6334560">,</span>&nbsp;<span class="op" id="6334562">&amp;</span><span class="ident" id="6334563">b</span><span class="op" id="6334564">,</span>&nbsp;<span class="op" id="6334566">&amp;</span><span class="ident" id="6334567">cb</span><span class="op" id="6334569">[</span><span class="ident" id="6334570">i</span><span class="op" id="6334571">]</span><span class="op" id="6334572">,</span>&nbsp;<span class="op" id="6334574">&amp;</span><span class="ident" id="6334575">cr</span><span class="op" id="6334577">[</span><span class="ident" id="6334578">i</span><span class="op" id="6334579">]</span><span class="op" id="6334580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334594">prevDCY</span>&nbsp;<span class="op" id="6334602">=</span>&nbsp;<span class="ident" id="6334604">e</span><span class="op" id="6334605">.</span><span class="ident" id="6334606">writeBlock</span><span class="op" id="6334616">(</span><span class="op" id="6334617">&amp;</span><span class="ident" id="6334618">b</span><span class="op" id="6334619">,</span>&nbsp;<span class="num" id="6334621">0</span><span class="op" id="6334622">,</span>&nbsp;<span class="ident" id="6334624">prevDCY</span><span class="op" id="6334631">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334643">scale</span><span class="op" id="6334648">(</span><span class="op" id="6334649">&amp;</span><span class="ident" id="6334650">b</span><span class="op" id="6334651">,</span>&nbsp;<span class="op" id="6334653">&amp;</span><span class="ident" id="6334654">cb</span><span class="op" id="6334656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334662">prevDCCb</span>&nbsp;<span class="op" id="6334671">=</span>&nbsp;<span class="ident" id="6334673">e</span><span class="op" id="6334674">.</span><span class="ident" id="6334675">writeBlock</span><span class="op" id="6334685">(</span><span class="op" id="6334686">&amp;</span><span class="ident" id="6334687">b</span><span class="op" id="6334688">,</span>&nbsp;<span class="num" id="6334690">1</span><span class="op" id="6334691">,</span>&nbsp;<span class="ident" id="6334693">prevDCCb</span><span class="op" id="6334701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334707">scale</span><span class="op" id="6334712">(</span><span class="op" id="6334713">&amp;</span><span class="ident" id="6334714">b</span><span class="op" id="6334715">,</span>&nbsp;<span class="op" id="6334717">&amp;</span><span class="ident" id="6334718">cr</span><span class="op" id="6334720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334726">prevDCCr</span>&nbsp;<span class="op" id="6334735">=</span>&nbsp;<span class="ident" id="6334737">e</span><span class="op" id="6334738">.</span><span class="ident" id="6334739">writeBlock</span><span class="op" id="6334749">(</span><span class="op" id="6334750">&amp;</span><span class="ident" id="6334751">b</span><span class="op" id="6334752">,</span>&nbsp;<span class="num" id="6334754">1</span><span class="op" id="6334755">,</span>&nbsp;<span class="ident" id="6334757">prevDCCr</span><span class="op" id="6334765">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334780">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334812">e</span><span class="op" id="6334813">.</span><span class="ident" id="6334814">emit</span><span class="op" id="6334818">(</span><span class="num" id="6334819">0x7f</span><span class="op" id="6334823">,</span>&nbsp;<span class="num" id="6334825">7</span><span class="op" id="6334826">)</span><br>
<span class="lineno">535</span><span class="op" id="6334828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334831">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6334892">const</span>&nbsp;<span class="ident" id="6334898">DefaultQuality</span>&nbsp;<span class="op" id="6334913">=</span>&nbsp;<span class="num" id="6334915">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="6334919">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="6334959">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="6335020">type</span>&nbsp;<span class="ident" id="6335025">Options</span>&nbsp;<span class="keyword" id="6335033">struct</span>&nbsp;<span class="op" id="6335040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335043">Quality</span>&nbsp;<span class="builtintype" id="6335051">int</span><br>
<span class="lineno"></span><span class="op" id="6335055">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6335058">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6335137">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="6335206">func</span>&nbsp;<span class="ident" id="6335211">Encode</span><span class="op" id="6335217">(</span><span class="ident" id="6335218">w</span>&nbsp;<span class="ident" id="6335220">io</span><span class="op" id="6335222">.</span><span class="ident" id="6335223">Writer</span><span class="op" id="6335229">,</span>&nbsp;<span class="ident" id="6335231">m</span>&nbsp;<span class="ident" id="6335233">image</span><span class="op" id="6335238">.</span><span class="ident" id="6335239">Image</span><span class="op" id="6335244">,</span>&nbsp;<span class="ident" id="6335246">o</span>&nbsp;<span class="op" id="6335248">*</span><span class="ident" id="6335249">Options</span><span class="op" id="6335256">)</span>&nbsp;<span class="builtintype" id="6335258">error</span>&nbsp;<span class="op" id="6335264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335267">b</span>&nbsp;<span class="op" id="6335269">:=</span>&nbsp;<span class="ident" id="6335272">m</span><span class="op" id="6335273">.</span><span class="ident" id="6335274">Bounds</span><span class="op" id="6335280">(</span><span class="op" id="6335281">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335284">if</span>&nbsp;<span class="ident" id="6335287">b</span><span class="op" id="6335288">.</span><span class="ident" id="6335289">Dx</span><span class="op" id="6335291">(</span><span class="op" id="6335292">)</span>&nbsp;<span class="op" id="6335294">&gt;=</span>&nbsp;<span class="num" id="6335297">1</span><span class="op" id="6335298">&lt;&lt;</span><span class="num" id="6335300">16</span>&nbsp;<span class="op" id="6335303">||</span>&nbsp;<span class="ident" id="6335306">b</span><span class="op" id="6335307">.</span><span class="ident" id="6335308">Dy</span><span class="op" id="6335310">(</span><span class="op" id="6335311">)</span>&nbsp;<span class="op" id="6335313">&gt;=</span>&nbsp;<span class="num" id="6335316">1</span><span class="op" id="6335317">&lt;&lt;</span><span class="num" id="6335319">16</span>&nbsp;<span class="op" id="6335322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335326">return</span>&nbsp;<span class="ident" id="6335333">errors</span><span class="op" id="6335339">.</span><span class="ident" id="6335340">New</span><span class="op" id="6335343">(</span><span class="string" id="6335344">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6335380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335386">var</span>&nbsp;<span class="ident" id="6335390">e</span>&nbsp;<span class="ident" id="6335392">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335401">if</span>&nbsp;<span class="ident" id="6335404">ww</span><span class="op" id="6335406">,</span>&nbsp;<span class="ident" id="6335408">ok</span>&nbsp;<span class="op" id="6335411">:=</span>&nbsp;<span class="ident" id="6335414">w</span><span class="op" id="6335415">.</span><span class="op" id="6335416">(</span><span class="ident" id="6335417">writer</span><span class="op" id="6335423">)</span><span class="op" id="6335424">;</span>&nbsp;<span class="ident" id="6335426">ok</span>&nbsp;<span class="op" id="6335429">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335433">e</span><span class="op" id="6335434">.</span><span class="ident" id="6335435">w</span>&nbsp;<span class="op" id="6335437">=</span>&nbsp;<span class="ident" id="6335439">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335443">}</span>&nbsp;<span class="keyword" id="6335445">else</span>&nbsp;<span class="op" id="6335450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335454">e</span><span class="op" id="6335455">.</span><span class="ident" id="6335456">w</span>&nbsp;<span class="op" id="6335458">=</span>&nbsp;<span class="ident" id="6335460">bufio</span><span class="op" id="6335465">.</span><span class="ident" id="6335466">NewWriter</span><span class="op" id="6335475">(</span><span class="ident" id="6335476">w</span><span class="op" id="6335477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6335483">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335513">quality</span>&nbsp;<span class="op" id="6335521">:=</span>&nbsp;<span class="ident" id="6335524">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335540">if</span>&nbsp;<span class="ident" id="6335543">o</span>&nbsp;<span class="op" id="6335545">!=</span>&nbsp;<span class="ident" id="6335548">nil</span>&nbsp;<span class="op" id="6335552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335556">quality</span>&nbsp;<span class="op" id="6335564">=</span>&nbsp;<span class="ident" id="6335566">o</span><span class="op" id="6335567">.</span><span class="ident" id="6335568">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335578">if</span>&nbsp;<span class="ident" id="6335581">quality</span>&nbsp;<span class="op" id="6335589">&lt;</span>&nbsp;<span class="num" id="6335591">1</span>&nbsp;<span class="op" id="6335593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335598">quality</span>&nbsp;<span class="op" id="6335606">=</span>&nbsp;<span class="num" id="6335608">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335612">}</span>&nbsp;<span class="keyword" id="6335614">else</span>&nbsp;<span class="keyword" id="6335619">if</span>&nbsp;<span class="ident" id="6335622">quality</span>&nbsp;<span class="op" id="6335630">&gt;</span>&nbsp;<span class="num" id="6335632">100</span>&nbsp;<span class="op" id="6335636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335641">quality</span>&nbsp;<span class="op" id="6335649">=</span>&nbsp;<span class="num" id="6335651">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6335663">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335718">var</span>&nbsp;<span class="ident" id="6335722">scale</span>&nbsp;<span class="builtintype" id="6335728">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335733">if</span>&nbsp;<span class="ident" id="6335736">quality</span>&nbsp;<span class="op" id="6335744">&lt;</span>&nbsp;<span class="num" id="6335746">50</span>&nbsp;<span class="op" id="6335749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335753">scale</span>&nbsp;<span class="op" id="6335759">=</span>&nbsp;<span class="num" id="6335761">5000</span>&nbsp;<span class="op" id="6335766">/</span>&nbsp;<span class="ident" id="6335768">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335777">}</span>&nbsp;<span class="keyword" id="6335779">else</span>&nbsp;<span class="op" id="6335784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335788">scale</span>&nbsp;<span class="op" id="6335794">=</span>&nbsp;<span class="num" id="6335796">200</span>&nbsp;<span class="op" id="6335800">-</span>&nbsp;<span class="ident" id="6335802">quality</span><span class="op" id="6335809">*</span><span class="num" id="6335810">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6335816">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335856">for</span>&nbsp;<span class="ident" id="6335860">i</span>&nbsp;<span class="op" id="6335862">:=</span>&nbsp;<span class="keyword" id="6335865">range</span>&nbsp;<span class="ident" id="6335871">e</span><span class="op" id="6335872">.</span><span class="ident" id="6335873">quant</span>&nbsp;<span class="op" id="6335879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335883">for</span>&nbsp;<span class="ident" id="6335887">j</span>&nbsp;<span class="op" id="6335889">:=</span>&nbsp;<span class="keyword" id="6335892">range</span>&nbsp;<span class="ident" id="6335898">e</span><span class="op" id="6335899">.</span><span class="ident" id="6335900">quant</span><span class="op" id="6335905">[</span><span class="ident" id="6335906">i</span><span class="op" id="6335907">]</span>&nbsp;<span class="op" id="6335909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335914">x</span>&nbsp;<span class="op" id="6335916">:=</span>&nbsp;<span class="builtintype" id="6335919">int</span><span class="op" id="6335922">(</span><span class="ident" id="6335923">unscaledQuant</span><span class="op" id="6335936">[</span><span class="ident" id="6335937">i</span><span class="op" id="6335938">]</span><span class="op" id="6335939">[</span><span class="ident" id="6335940">j</span><span class="op" id="6335941">]</span><span class="op" id="6335942">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335947">x</span>&nbsp;<span class="op" id="6335949">=</span>&nbsp;<span class="op" id="6335951">(</span><span class="ident" id="6335952">x</span><span class="op" id="6335953">*</span><span class="ident" id="6335954">scale</span>&nbsp;<span class="op" id="6335960">+</span>&nbsp;<span class="num" id="6335962">50</span><span class="op" id="6335964">)</span>&nbsp;<span class="op" id="6335966">/</span>&nbsp;<span class="num" id="6335968">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335975">if</span>&nbsp;<span class="ident" id="6335978">x</span>&nbsp;<span class="op" id="6335980">&lt;</span>&nbsp;<span class="num" id="6335982">1</span>&nbsp;<span class="op" id="6335984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335990">x</span>&nbsp;<span class="op" id="6335992">=</span>&nbsp;<span class="num" id="6335994">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335999">}</span>&nbsp;<span class="keyword" id="6336001">else</span>&nbsp;<span class="keyword" id="6336006">if</span>&nbsp;<span class="ident" id="6336009">x</span>&nbsp;<span class="op" id="6336011">&gt;</span>&nbsp;<span class="num" id="6336013">255</span>&nbsp;<span class="op" id="6336017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336023">x</span>&nbsp;<span class="op" id="6336025">=</span>&nbsp;<span class="num" id="6336027">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336039">e</span><span class="op" id="6336040">.</span><span class="ident" id="6336041">quant</span><span class="op" id="6336046">[</span><span class="ident" id="6336047">i</span><span class="op" id="6336048">]</span><span class="op" id="6336049">[</span><span class="ident" id="6336050">j</span><span class="op" id="6336051">]</span>&nbsp;<span class="op" id="6336053">=</span>&nbsp;<span class="builtintype" id="6336055">uint8</span><span class="op" id="6336060">(</span><span class="ident" id="6336061">x</span><span class="op" id="6336062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336072">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336132">nComponent</span>&nbsp;<span class="op" id="6336143">:=</span>&nbsp;<span class="num" id="6336146">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336149">switch</span>&nbsp;<span class="ident" id="6336156">m</span><span class="op" id="6336157">.</span><span class="op" id="6336158">(</span><span class="keyword" id="6336159">type</span><span class="op" id="6336163">)</span>&nbsp;<span class="op" id="6336165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336168">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336230">case</span>&nbsp;<span class="op" id="6336235">*</span><span class="ident" id="6336236">image</span><span class="op" id="6336241">.</span><span class="ident" id="6336242">Gray</span><span class="op" id="6336246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336250">nComponent</span>&nbsp;<span class="op" id="6336261">=</span>&nbsp;<span class="num" id="6336263">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336269">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336306">e</span><span class="op" id="6336307">.</span><span class="ident" id="6336308">buf</span><span class="op" id="6336311">[</span><span class="num" id="6336312">0</span><span class="op" id="6336313">]</span>&nbsp;<span class="op" id="6336315">=</span>&nbsp;<span class="num" id="6336317">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336323">e</span><span class="op" id="6336324">.</span><span class="ident" id="6336325">buf</span><span class="op" id="6336328">[</span><span class="num" id="6336329">1</span><span class="op" id="6336330">]</span>&nbsp;<span class="op" id="6336332">=</span>&nbsp;<span class="num" id="6336334">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336340">e</span><span class="op" id="6336341">.</span><span class="ident" id="6336342">write</span><span class="op" id="6336347">(</span><span class="ident" id="6336348">e</span><span class="op" id="6336349">.</span><span class="ident" id="6336350">buf</span><span class="op" id="6336353">[</span><span class="op" id="6336354">:</span><span class="num" id="6336355">2</span><span class="op" id="6336356">]</span><span class="op" id="6336357">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336360">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336395">e</span><span class="op" id="6336396">.</span><span class="ident" id="6336397">writeDQT</span><span class="op" id="6336405">(</span><span class="op" id="6336406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336409">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336441">e</span><span class="op" id="6336442">.</span><span class="ident" id="6336443">writeSOF0</span><span class="op" id="6336452">(</span><span class="ident" id="6336453">b</span><span class="op" id="6336454">.</span><span class="ident" id="6336455">Size</span><span class="op" id="6336459">(</span><span class="op" id="6336460">)</span><span class="op" id="6336461">,</span>&nbsp;<span class="ident" id="6336463">nComponent</span><span class="op" id="6336473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336476">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336506">e</span><span class="op" id="6336507">.</span><span class="ident" id="6336508">writeDHT</span><span class="op" id="6336516">(</span><span class="ident" id="6336517">nComponent</span><span class="op" id="6336527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336530">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336556">e</span><span class="op" id="6336557">.</span><span class="ident" id="6336558">writeSOS</span><span class="op" id="6336566">(</span><span class="ident" id="6336567">m</span><span class="op" id="6336568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336571">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336606">e</span><span class="op" id="6336607">.</span><span class="ident" id="6336608">buf</span><span class="op" id="6336611">[</span><span class="num" id="6336612">0</span><span class="op" id="6336613">]</span>&nbsp;<span class="op" id="6336615">=</span>&nbsp;<span class="num" id="6336617">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336623">e</span><span class="op" id="6336624">.</span><span class="ident" id="6336625">buf</span><span class="op" id="6336628">[</span><span class="num" id="6336629">1</span><span class="op" id="6336630">]</span>&nbsp;<span class="op" id="6336632">=</span>&nbsp;<span class="num" id="6336634">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336640">e</span><span class="op" id="6336641">.</span><span class="ident" id="6336642">write</span><span class="op" id="6336647">(</span><span class="ident" id="6336648">e</span><span class="op" id="6336649">.</span><span class="ident" id="6336650">buf</span><span class="op" id="6336653">[</span><span class="op" id="6336654">:</span><span class="num" id="6336655">2</span><span class="op" id="6336656">]</span><span class="op" id="6336657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336660">e</span><span class="op" id="6336661">.</span><span class="ident" id="6336662">flush</span><span class="op" id="6336667">(</span><span class="op" id="6336668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336671">return</span>&nbsp;<span class="ident" id="6336678">e</span><span class="op" id="6336679">.</span><span class="ident" id="6336680">err</span><br>
<span class="lineno"></span><span class="op" id="6336684">}</span>
</div>
</body>
</html>
