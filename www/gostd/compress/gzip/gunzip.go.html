<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html" class="current">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4193460">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4193515">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4193569">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4193620">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4193700">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4193729">package</span>&nbsp;<span class="ident" id="4193737">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4193743">import</span>&nbsp;<span class="op" id="4193750">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193753">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193762">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193780">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193790">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193798">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193812">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4193818">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4193825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4193828">const</span>&nbsp;<span class="op" id="4193834">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193837">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4193849">=</span>&nbsp;<span class="num" id="4193851">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193857">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4193869">=</span>&nbsp;<span class="num" id="4193871">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193877">gzipDeflate</span>&nbsp;<span class="op" id="4193889">=</span>&nbsp;<span class="num" id="4193891">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193894">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4193906">=</span>&nbsp;<span class="num" id="4193908">1</span>&nbsp;<span class="op" id="4193910">&lt;&lt;</span>&nbsp;<span class="num" id="4193913">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193916">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4193928">=</span>&nbsp;<span class="num" id="4193930">1</span>&nbsp;<span class="op" id="4193932">&lt;&lt;</span>&nbsp;<span class="num" id="4193935">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193938">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4193950">=</span>&nbsp;<span class="num" id="4193952">1</span>&nbsp;<span class="op" id="4193954">&lt;&lt;</span>&nbsp;<span class="num" id="4193957">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193960">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4193972">=</span>&nbsp;<span class="num" id="4193974">1</span>&nbsp;<span class="op" id="4193976">&lt;&lt;</span>&nbsp;<span class="num" id="4193979">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4193982">flagComment</span>&nbsp;<span class="op" id="4193994">=</span>&nbsp;<span class="num" id="4193996">1</span>&nbsp;<span class="op" id="4193998">&lt;&lt;</span>&nbsp;<span class="num" id="4194001">4</span><br>
<span class="lineno"></span><span class="op" id="4194003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4194006">func</span>&nbsp;<span class="ident" id="4194011">makeReader</span><span class="op" id="4194021">(</span><span class="ident" id="4194022">r</span>&nbsp;<span class="ident" id="4194024">io</span><span class="op" id="4194026">.</span><span class="ident" id="4194027">Reader</span><span class="op" id="4194033">)</span>&nbsp;<span class="ident" id="4194035">flate</span><span class="op" id="4194040">.</span><span class="ident" id="4194041">Reader</span>&nbsp;<span class="op" id="4194048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4194051">if</span>&nbsp;<span class="ident" id="4194054">rr</span><span class="op" id="4194056">,</span>&nbsp;<span class="ident" id="4194058">ok</span>&nbsp;<span class="op" id="4194061">:=</span>&nbsp;<span class="ident" id="4194064">r</span><span class="op" id="4194065">.</span><span class="op" id="4194066">(</span><span class="ident" id="4194067">flate</span><span class="op" id="4194072">.</span><span class="ident" id="4194073">Reader</span><span class="op" id="4194079">)</span><span class="op" id="4194080">;</span>&nbsp;<span class="ident" id="4194082">ok</span>&nbsp;<span class="op" id="4194085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4194089">return</span>&nbsp;<span class="ident" id="4194096">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4194100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4194103">return</span>&nbsp;<span class="ident" id="4194110">bufio</span><span class="op" id="4194115">.</span><span class="ident" id="4194116">NewReader</span><span class="op" id="4194125">(</span><span class="ident" id="4194126">r</span><span class="op" id="4194127">)</span><br>
<span class="lineno">35</span><span class="op" id="4194129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4194132">var</span>&nbsp;<span class="op" id="4194136">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194139">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194220">ErrChecksum</span>&nbsp;<span class="op" id="4194232">=</span>&nbsp;<span class="ident" id="4194234">errors</span><span class="op" id="4194240">.</span><span class="ident" id="4194241">New</span><span class="op" id="4194244">(</span><span class="string" id="4194245">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4194269">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194272">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194349">ErrHeader</span>&nbsp;<span class="op" id="4194359">=</span>&nbsp;<span class="ident" id="4194361">errors</span><span class="op" id="4194367">.</span><span class="ident" id="4194368">New</span><span class="op" id="4194371">(</span><span class="string" id="4194372">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4194394">)</span><br>
<span class="lineno"></span><span class="op" id="4194396">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4194399">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4194475">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4194549">type</span>&nbsp;<span class="ident" id="4194554">Header</span>&nbsp;<span class="keyword" id="4194561">struct</span>&nbsp;<span class="op" id="4194568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194571">Comment</span>&nbsp;<span class="builtintype" id="4194579">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194589">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194601">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4194609">[</span><span class="op" id="4194610">]</span><span class="builtintype" id="4194611">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194619">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194636">ModTime</span>&nbsp;<span class="ident" id="4194644">time</span><span class="op" id="4194648">.</span><span class="ident" id="4194649">Time</span>&nbsp;<span class="comment" id="4194654">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194676">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4194684">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194694">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4194708">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4194716">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4194726">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4194751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4194754">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4194811">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4194868">//</span><br>
<span class="lineno"></span><span class="comment" id="4194871">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4194936">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4194988">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4195050">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4195109">//</span><br>
<span class="lineno"></span><span class="comment" id="4195112">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4195180">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4195230">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4195289">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4195357">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4195420">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4195452">type</span>&nbsp;<span class="ident" id="4195457">Reader</span>&nbsp;<span class="keyword" id="4195464">struct</span>&nbsp;<span class="op" id="4195471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195474">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195482">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195495">flate</span><span class="op" id="4195500">.</span><span class="ident" id="4195501">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195509">decompressor</span>&nbsp;<span class="ident" id="4195522">io</span><span class="op" id="4195524">.</span><span class="ident" id="4195525">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195537">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195550">hash</span><span class="op" id="4195554">.</span><span class="ident" id="4195555">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195563">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4195576">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195584">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4195597">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195603">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4195616">[</span><span class="num" id="4195617">512</span><span class="op" id="4195620">]</span><span class="builtintype" id="4195621">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195627">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4195640">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195647">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4195660">bool</span><br>
<span class="lineno"></span><span class="op" id="4195665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4195668">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4195728">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4195775">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4195837">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4195913">func</span>&nbsp;<span class="ident" id="4195918">NewReader</span><span class="op" id="4195927">(</span><span class="ident" id="4195928">r</span>&nbsp;<span class="ident" id="4195930">io</span><span class="op" id="4195932">.</span><span class="ident" id="4195933">Reader</span><span class="op" id="4195939">)</span>&nbsp;<span class="op" id="4195941">(</span><span class="op" id="4195942">*</span><span class="ident" id="4195943">Reader</span><span class="op" id="4195949">,</span>&nbsp;<span class="builtintype" id="4195951">error</span><span class="op" id="4195956">)</span>&nbsp;<span class="op" id="4195958">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195961">z</span>&nbsp;<span class="op" id="4195963">:=</span>&nbsp;<span class="builtinfunc" id="4195966">new</span><span class="op" id="4195969">(</span><span class="ident" id="4195970">Reader</span><span class="op" id="4195976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4195979">z</span><span class="op" id="4195980">.</span><span class="ident" id="4195981">r</span>&nbsp;<span class="op" id="4195983">=</span>&nbsp;<span class="ident" id="4195985">makeReader</span><span class="op" id="4195995">(</span><span class="ident" id="4195996">r</span><span class="op" id="4195997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196000">z</span><span class="op" id="4196001">.</span><span class="ident" id="4196002">multistream</span>&nbsp;<span class="op" id="4196014">=</span>&nbsp;<span class="builtintype" id="4196016">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196022">z</span><span class="op" id="4196023">.</span><span class="ident" id="4196024">digest</span>&nbsp;<span class="op" id="4196031">=</span>&nbsp;<span class="ident" id="4196033">crc32</span><span class="op" id="4196038">.</span><span class="ident" id="4196039">NewIEEE</span><span class="op" id="4196046">(</span><span class="op" id="4196047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4196050">if</span>&nbsp;<span class="ident" id="4196053">err</span>&nbsp;<span class="op" id="4196057">:=</span>&nbsp;<span class="ident" id="4196060">z</span><span class="op" id="4196061">.</span><span class="ident" id="4196062">readHeader</span><span class="op" id="4196072">(</span><span class="builtintype" id="4196073">true</span><span class="op" id="4196077">)</span><span class="op" id="4196078">;</span>&nbsp;<span class="ident" id="4196080">err</span>&nbsp;<span class="op" id="4196084">!=</span>&nbsp;<span class="builtintype" id="4196087">nil</span>&nbsp;<span class="op" id="4196091">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4196095">return</span>&nbsp;<span class="builtintype" id="4196102">nil</span><span class="op" id="4196105">,</span>&nbsp;<span class="ident" id="4196107">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4196112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4196115">return</span>&nbsp;<span class="ident" id="4196122">z</span><span class="op" id="4196123">,</span>&nbsp;<span class="builtintype" id="4196125">nil</span><br>
<span class="lineno"></span><span class="op" id="4196129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4196132">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4196202">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4196278">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4196345">func</span>&nbsp;<span class="op" id="4196350">(</span><span class="ident" id="4196351">z</span>&nbsp;<span class="op" id="4196353">*</span><span class="ident" id="4196354">Reader</span><span class="op" id="4196360">)</span>&nbsp;<span class="ident" id="4196362">Reset</span><span class="op" id="4196367">(</span><span class="ident" id="4196368">r</span>&nbsp;<span class="ident" id="4196370">io</span><span class="op" id="4196372">.</span><span class="ident" id="4196373">Reader</span><span class="op" id="4196379">)</span>&nbsp;<span class="builtintype" id="4196381">error</span>&nbsp;<span class="op" id="4196387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196390">z</span><span class="op" id="4196391">.</span><span class="ident" id="4196392">r</span>&nbsp;<span class="op" id="4196394">=</span>&nbsp;<span class="ident" id="4196396">makeReader</span><span class="op" id="4196406">(</span><span class="ident" id="4196407">r</span><span class="op" id="4196408">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4196411">if</span>&nbsp;<span class="ident" id="4196414">z</span><span class="op" id="4196415">.</span><span class="ident" id="4196416">digest</span>&nbsp;<span class="op" id="4196423">==</span>&nbsp;<span class="builtintype" id="4196426">nil</span>&nbsp;<span class="op" id="4196430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196434">z</span><span class="op" id="4196435">.</span><span class="ident" id="4196436">digest</span>&nbsp;<span class="op" id="4196443">=</span>&nbsp;<span class="ident" id="4196445">crc32</span><span class="op" id="4196450">.</span><span class="ident" id="4196451">NewIEEE</span><span class="op" id="4196458">(</span><span class="op" id="4196459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4196462">}</span>&nbsp;<span class="keyword" id="4196464">else</span>&nbsp;<span class="op" id="4196469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196473">z</span><span class="op" id="4196474">.</span><span class="ident" id="4196475">digest</span><span class="op" id="4196481">.</span><span class="ident" id="4196482">Reset</span><span class="op" id="4196487">(</span><span class="op" id="4196488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4196491">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196494">z</span><span class="op" id="4196495">.</span><span class="ident" id="4196496">size</span>&nbsp;<span class="op" id="4196501">=</span>&nbsp;<span class="num" id="4196503">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196506">z</span><span class="op" id="4196507">.</span><span class="ident" id="4196508">err</span>&nbsp;<span class="op" id="4196512">=</span>&nbsp;<span class="builtintype" id="4196514">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4196519">z</span><span class="op" id="4196520">.</span><span class="ident" id="4196521">multistream</span>&nbsp;<span class="op" id="4196533">=</span>&nbsp;<span class="builtintype" id="4196535">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4196541">return</span>&nbsp;<span class="ident" id="4196548">z</span><span class="op" id="4196549">.</span><span class="ident" id="4196550">readHeader</span><span class="op" id="4196560">(</span><span class="builtintype" id="4196561">true</span><span class="op" id="4196565">)</span><br>
<span class="lineno"></span><span class="op" id="4196567">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4196570">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4196641">//</span><br>
<span class="lineno"></span><span class="comment" id="4196644">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4196719">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4196789">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4196867">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4196945">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4197009">//</span><br>
<span class="lineno"></span><span class="comment" id="4197012">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4197089">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4197165">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4197231">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4197300">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4197375">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4197433">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4197512">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4197574">func</span>&nbsp;<span class="op" id="4197579">(</span><span class="ident" id="4197580">z</span>&nbsp;<span class="op" id="4197582">*</span><span class="ident" id="4197583">Reader</span><span class="op" id="4197589">)</span>&nbsp;<span class="ident" id="4197591">Multistream</span><span class="op" id="4197602">(</span><span class="ident" id="4197603">ok</span>&nbsp;<span class="builtintype" id="4197606">bool</span><span class="op" id="4197610">)</span>&nbsp;<span class="op" id="4197612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4197615">z</span><span class="op" id="4197616">.</span><span class="ident" id="4197617">multistream</span>&nbsp;<span class="op" id="4197629">=</span>&nbsp;<span class="ident" id="4197631">ok</span><br>
<span class="lineno"></span><span class="op" id="4197634">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4197637">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4197698">func</span>&nbsp;<span class="ident" id="4197703">get4</span><span class="op" id="4197707">(</span><span class="ident" id="4197708">p</span>&nbsp;<span class="op" id="4197710">[</span><span class="op" id="4197711">]</span><span class="builtintype" id="4197712">byte</span><span class="op" id="4197716">)</span>&nbsp;<span class="builtintype" id="4197718">uint32</span>&nbsp;<span class="op" id="4197725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197728">return</span>&nbsp;<span class="builtintype" id="4197735">uint32</span><span class="op" id="4197741">(</span><span class="ident" id="4197742">p</span><span class="op" id="4197743">[</span><span class="num" id="4197744">0</span><span class="op" id="4197745">]</span><span class="op" id="4197746">)</span>&nbsp;<span class="op" id="4197748">|</span>&nbsp;<span class="builtintype" id="4197750">uint32</span><span class="op" id="4197756">(</span><span class="ident" id="4197757">p</span><span class="op" id="4197758">[</span><span class="num" id="4197759">1</span><span class="op" id="4197760">]</span><span class="op" id="4197761">)</span><span class="op" id="4197762">&lt;&lt;</span><span class="num" id="4197764">8</span>&nbsp;<span class="op" id="4197766">|</span>&nbsp;<span class="builtintype" id="4197768">uint32</span><span class="op" id="4197774">(</span><span class="ident" id="4197775">p</span><span class="op" id="4197776">[</span><span class="num" id="4197777">2</span><span class="op" id="4197778">]</span><span class="op" id="4197779">)</span><span class="op" id="4197780">&lt;&lt;</span><span class="num" id="4197782">16</span>&nbsp;<span class="op" id="4197785">|</span>&nbsp;<span class="builtintype" id="4197787">uint32</span><span class="op" id="4197793">(</span><span class="ident" id="4197794">p</span><span class="op" id="4197795">[</span><span class="num" id="4197796">3</span><span class="op" id="4197797">]</span><span class="op" id="4197798">)</span><span class="op" id="4197799">&lt;&lt;</span><span class="num" id="4197801">24</span><br>
<span class="lineno"></span><span class="op" id="4197804">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4197807">func</span>&nbsp;<span class="op" id="4197812">(</span><span class="ident" id="4197813">z</span>&nbsp;<span class="op" id="4197815">*</span><span class="ident" id="4197816">Reader</span><span class="op" id="4197822">)</span>&nbsp;<span class="ident" id="4197824">readString</span><span class="op" id="4197834">(</span><span class="op" id="4197835">)</span>&nbsp;<span class="op" id="4197837">(</span><span class="builtintype" id="4197838">string</span><span class="op" id="4197844">,</span>&nbsp;<span class="builtintype" id="4197846">error</span><span class="op" id="4197851">)</span>&nbsp;<span class="op" id="4197853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197856">var</span>&nbsp;<span class="ident" id="4197860">err</span>&nbsp;<span class="builtintype" id="4197864">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4197871">needconv</span>&nbsp;<span class="op" id="4197880">:=</span>&nbsp;<span class="builtintype" id="4197883">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197890">for</span>&nbsp;<span class="ident" id="4197894">i</span>&nbsp;<span class="op" id="4197896">:=</span>&nbsp;<span class="num" id="4197899">0</span><span class="op" id="4197900">;</span>&nbsp;<span class="op" id="4197902">;</span>&nbsp;<span class="ident" id="4197904">i</span><span class="op" id="4197905">++</span>&nbsp;<span class="op" id="4197908">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197912">if</span>&nbsp;<span class="ident" id="4197915">i</span>&nbsp;<span class="op" id="4197917">&gt;=</span>&nbsp;<span class="builtinfunc" id="4197920">len</span><span class="op" id="4197923">(</span><span class="ident" id="4197924">z</span><span class="op" id="4197925">.</span><span class="ident" id="4197926">buf</span><span class="op" id="4197929">)</span>&nbsp;<span class="op" id="4197931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197936">return</span>&nbsp;<span class="string" id="4197943">&#34;&#34;</span><span class="op" id="4197945">,</span>&nbsp;<span class="ident" id="4197947">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4197959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4197963">z</span><span class="op" id="4197964">.</span><span class="ident" id="4197965">buf</span><span class="op" id="4197968">[</span><span class="ident" id="4197969">i</span><span class="op" id="4197970">]</span><span class="op" id="4197971">,</span>&nbsp;<span class="ident" id="4197973">err</span>&nbsp;<span class="op" id="4197977">=</span>&nbsp;<span class="ident" id="4197979">z</span><span class="op" id="4197980">.</span><span class="ident" id="4197981">r</span><span class="op" id="4197982">.</span><span class="ident" id="4197983">ReadByte</span><span class="op" id="4197991">(</span><span class="op" id="4197992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4197996">if</span>&nbsp;<span class="ident" id="4197999">err</span>&nbsp;<span class="op" id="4198003">!=</span>&nbsp;<span class="builtintype" id="4198006">nil</span>&nbsp;<span class="op" id="4198010">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198015">return</span>&nbsp;<span class="string" id="4198022">&#34;&#34;</span><span class="op" id="4198024">,</span>&nbsp;<span class="ident" id="4198026">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198036">if</span>&nbsp;<span class="ident" id="4198039">z</span><span class="op" id="4198040">.</span><span class="ident" id="4198041">buf</span><span class="op" id="4198044">[</span><span class="ident" id="4198045">i</span><span class="op" id="4198046">]</span>&nbsp;<span class="op" id="4198048">&gt;</span>&nbsp;<span class="num" id="4198050">0x7f</span>&nbsp;<span class="op" id="4198055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198060">needconv</span>&nbsp;<span class="op" id="4198069">=</span>&nbsp;<span class="builtintype" id="4198071">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198078">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198082">if</span>&nbsp;<span class="ident" id="4198085">z</span><span class="op" id="4198086">.</span><span class="ident" id="4198087">buf</span><span class="op" id="4198090">[</span><span class="ident" id="4198091">i</span><span class="op" id="4198092">]</span>&nbsp;<span class="op" id="4198094">==</span>&nbsp;<span class="num" id="4198097">0</span>&nbsp;<span class="op" id="4198099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4198104">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198190">if</span>&nbsp;<span class="ident" id="4198193">needconv</span>&nbsp;<span class="op" id="4198202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198208">s</span>&nbsp;<span class="op" id="4198210">:=</span>&nbsp;<span class="builtinfunc" id="4198213">make</span><span class="op" id="4198217">(</span><span class="op" id="4198218">[</span><span class="op" id="4198219">]</span><span class="builtintype" id="4198220">rune</span><span class="op" id="4198224">,</span>&nbsp;<span class="num" id="4198226">0</span><span class="op" id="4198227">,</span>&nbsp;<span class="ident" id="4198229">i</span><span class="op" id="4198230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198236">for</span>&nbsp;<span class="ident" id="4198240">_</span><span class="op" id="4198241">,</span>&nbsp;<span class="ident" id="4198243">v</span>&nbsp;<span class="op" id="4198245">:=</span>&nbsp;<span class="keyword" id="4198248">range</span>&nbsp;<span class="ident" id="4198254">z</span><span class="op" id="4198255">.</span><span class="ident" id="4198256">buf</span><span class="op" id="4198259">[</span><span class="num" id="4198260">0</span><span class="op" id="4198261">:</span><span class="ident" id="4198262">i</span><span class="op" id="4198263">]</span>&nbsp;<span class="op" id="4198265">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198272">s</span>&nbsp;<span class="op" id="4198274">=</span>&nbsp;<span class="builtinfunc" id="4198276">append</span><span class="op" id="4198282">(</span><span class="ident" id="4198283">s</span><span class="op" id="4198284">,</span>&nbsp;<span class="builtintype" id="4198286">rune</span><span class="op" id="4198290">(</span><span class="ident" id="4198291">v</span><span class="op" id="4198292">)</span><span class="op" id="4198293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198305">return</span>&nbsp;<span class="builtintype" id="4198312">string</span><span class="op" id="4198318">(</span><span class="ident" id="4198319">s</span><span class="op" id="4198320">)</span><span class="op" id="4198321">,</span>&nbsp;<span class="builtintype" id="4198323">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198335">return</span>&nbsp;<span class="builtintype" id="4198342">string</span><span class="op" id="4198348">(</span><span class="ident" id="4198349">z</span><span class="op" id="4198350">.</span><span class="ident" id="4198351">buf</span><span class="op" id="4198354">[</span><span class="num" id="4198355">0</span><span class="op" id="4198356">:</span><span class="ident" id="4198357">i</span><span class="op" id="4198358">]</span><span class="op" id="4198359">)</span><span class="op" id="4198360">,</span>&nbsp;<span class="builtintype" id="4198362">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198371">}</span><br>
<span class="lineno"></span><span class="op" id="4198373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4198376">func</span>&nbsp;<span class="op" id="4198381">(</span><span class="ident" id="4198382">z</span>&nbsp;<span class="op" id="4198384">*</span><span class="ident" id="4198385">Reader</span><span class="op" id="4198391">)</span>&nbsp;<span class="ident" id="4198393">read2</span><span class="op" id="4198398">(</span><span class="op" id="4198399">)</span>&nbsp;<span class="op" id="4198401">(</span><span class="builtintype" id="4198402">uint32</span><span class="op" id="4198408">,</span>&nbsp;<span class="builtintype" id="4198410">error</span><span class="op" id="4198415">)</span>&nbsp;<span class="op" id="4198417">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198420">_</span><span class="op" id="4198421">,</span>&nbsp;<span class="ident" id="4198423">err</span>&nbsp;<span class="op" id="4198427">:=</span>&nbsp;<span class="ident" id="4198430">io</span><span class="op" id="4198432">.</span><span class="ident" id="4198433">ReadFull</span><span class="op" id="4198441">(</span><span class="ident" id="4198442">z</span><span class="op" id="4198443">.</span><span class="ident" id="4198444">r</span><span class="op" id="4198445">,</span>&nbsp;<span class="ident" id="4198447">z</span><span class="op" id="4198448">.</span><span class="ident" id="4198449">buf</span><span class="op" id="4198452">[</span><span class="num" id="4198453">0</span><span class="op" id="4198454">:</span><span class="num" id="4198455">2</span><span class="op" id="4198456">]</span><span class="op" id="4198457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198460">if</span>&nbsp;<span class="ident" id="4198463">err</span>&nbsp;<span class="op" id="4198467">!=</span>&nbsp;<span class="builtintype" id="4198470">nil</span>&nbsp;<span class="op" id="4198474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198478">return</span>&nbsp;<span class="num" id="4198485">0</span><span class="op" id="4198486">,</span>&nbsp;<span class="ident" id="4198488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198496">return</span>&nbsp;<span class="builtintype" id="4198503">uint32</span><span class="op" id="4198509">(</span><span class="ident" id="4198510">z</span><span class="op" id="4198511">.</span><span class="ident" id="4198512">buf</span><span class="op" id="4198515">[</span><span class="num" id="4198516">0</span><span class="op" id="4198517">]</span><span class="op" id="4198518">)</span>&nbsp;<span class="op" id="4198520">|</span>&nbsp;<span class="builtintype" id="4198522">uint32</span><span class="op" id="4198528">(</span><span class="ident" id="4198529">z</span><span class="op" id="4198530">.</span><span class="ident" id="4198531">buf</span><span class="op" id="4198534">[</span><span class="num" id="4198535">1</span><span class="op" id="4198536">]</span><span class="op" id="4198537">)</span><span class="op" id="4198538">&lt;&lt;</span><span class="num" id="4198540">8</span><span class="op" id="4198541">,</span>&nbsp;<span class="builtintype" id="4198543">nil</span><br>
<span class="lineno">170</span><span class="op" id="4198547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4198550">func</span>&nbsp;<span class="op" id="4198555">(</span><span class="ident" id="4198556">z</span>&nbsp;<span class="op" id="4198558">*</span><span class="ident" id="4198559">Reader</span><span class="op" id="4198565">)</span>&nbsp;<span class="ident" id="4198567">readHeader</span><span class="op" id="4198577">(</span><span class="ident" id="4198578">save</span>&nbsp;<span class="builtintype" id="4198583">bool</span><span class="op" id="4198587">)</span>&nbsp;<span class="builtintype" id="4198589">error</span>&nbsp;<span class="op" id="4198595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198598">_</span><span class="op" id="4198599">,</span>&nbsp;<span class="ident" id="4198601">err</span>&nbsp;<span class="op" id="4198605">:=</span>&nbsp;<span class="ident" id="4198608">io</span><span class="op" id="4198610">.</span><span class="ident" id="4198611">ReadFull</span><span class="op" id="4198619">(</span><span class="ident" id="4198620">z</span><span class="op" id="4198621">.</span><span class="ident" id="4198622">r</span><span class="op" id="4198623">,</span>&nbsp;<span class="ident" id="4198625">z</span><span class="op" id="4198626">.</span><span class="ident" id="4198627">buf</span><span class="op" id="4198630">[</span><span class="num" id="4198631">0</span><span class="op" id="4198632">:</span><span class="num" id="4198633">10</span><span class="op" id="4198635">]</span><span class="op" id="4198636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198639">if</span>&nbsp;<span class="ident" id="4198642">err</span>&nbsp;<span class="op" id="4198646">!=</span>&nbsp;<span class="builtintype" id="4198649">nil</span>&nbsp;<span class="op" id="4198653">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198657">return</span>&nbsp;<span class="ident" id="4198664">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198672">if</span>&nbsp;<span class="ident" id="4198675">z</span><span class="op" id="4198676">.</span><span class="ident" id="4198677">buf</span><span class="op" id="4198680">[</span><span class="num" id="4198681">0</span><span class="op" id="4198682">]</span>&nbsp;<span class="op" id="4198684">!=</span>&nbsp;<span class="ident" id="4198687">gzipID1</span>&nbsp;<span class="op" id="4198695">||</span>&nbsp;<span class="ident" id="4198698">z</span><span class="op" id="4198699">.</span><span class="ident" id="4198700">buf</span><span class="op" id="4198703">[</span><span class="num" id="4198704">1</span><span class="op" id="4198705">]</span>&nbsp;<span class="op" id="4198707">!=</span>&nbsp;<span class="ident" id="4198710">gzipID2</span>&nbsp;<span class="op" id="4198718">||</span>&nbsp;<span class="ident" id="4198721">z</span><span class="op" id="4198722">.</span><span class="ident" id="4198723">buf</span><span class="op" id="4198726">[</span><span class="num" id="4198727">2</span><span class="op" id="4198728">]</span>&nbsp;<span class="op" id="4198730">!=</span>&nbsp;<span class="ident" id="4198733">gzipDeflate</span>&nbsp;<span class="op" id="4198745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198749">return</span>&nbsp;<span class="ident" id="4198756">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198767">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198770">z</span><span class="op" id="4198771">.</span><span class="ident" id="4198772">flg</span>&nbsp;<span class="op" id="4198776">=</span>&nbsp;<span class="ident" id="4198778">z</span><span class="op" id="4198779">.</span><span class="ident" id="4198780">buf</span><span class="op" id="4198783">[</span><span class="num" id="4198784">3</span><span class="op" id="4198785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198788">if</span>&nbsp;<span class="ident" id="4198791">save</span>&nbsp;<span class="op" id="4198796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198800">z</span><span class="op" id="4198801">.</span><span class="ident" id="4198802">ModTime</span>&nbsp;<span class="op" id="4198810">=</span>&nbsp;<span class="ident" id="4198812">time</span><span class="op" id="4198816">.</span><span class="ident" id="4198817">Unix</span><span class="op" id="4198821">(</span><span class="ident" id="4198822">int64</span><span class="op" id="4198827">(</span><span class="ident" id="4198828">get4</span><span class="op" id="4198832">(</span><span class="ident" id="4198833">z</span><span class="op" id="4198834">.</span><span class="ident" id="4198835">buf</span><span class="op" id="4198838">[</span><span class="num" id="4198839">4</span><span class="op" id="4198840">:</span><span class="num" id="4198841">8</span><span class="op" id="4198842">]</span><span class="op" id="4198843">)</span><span class="op" id="4198844">)</span><span class="op" id="4198845">,</span>&nbsp;<span class="num" id="4198847">0</span><span class="op" id="4198848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4198852">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198882">z</span><span class="op" id="4198883">.</span><span class="ident" id="4198884">OS</span>&nbsp;<span class="op" id="4198887">=</span>&nbsp;<span class="ident" id="4198889">z</span><span class="op" id="4198890">.</span><span class="ident" id="4198891">buf</span><span class="op" id="4198894">[</span><span class="num" id="4198895">9</span><span class="op" id="4198896">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4198899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198902">z</span><span class="op" id="4198903">.</span><span class="ident" id="4198904">digest</span><span class="op" id="4198910">.</span><span class="ident" id="4198911">Reset</span><span class="op" id="4198916">(</span><span class="op" id="4198917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198920">z</span><span class="op" id="4198921">.</span><span class="ident" id="4198922">digest</span><span class="op" id="4198928">.</span><span class="ident" id="4198929">Write</span><span class="op" id="4198934">(</span><span class="ident" id="4198935">z</span><span class="op" id="4198936">.</span><span class="ident" id="4198937">buf</span><span class="op" id="4198940">[</span><span class="num" id="4198941">0</span><span class="op" id="4198942">:</span><span class="num" id="4198943">10</span><span class="op" id="4198945">]</span><span class="op" id="4198946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4198950">if</span>&nbsp;<span class="ident" id="4198953">z</span><span class="op" id="4198954">.</span><span class="ident" id="4198955">flg</span><span class="op" id="4198958">&amp;</span><span class="ident" id="4198959">flagExtra</span>&nbsp;<span class="op" id="4198969">!=</span>&nbsp;<span class="num" id="4198972">0</span>&nbsp;<span class="op" id="4198974">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4198978">n</span><span class="op" id="4198979">,</span>&nbsp;<span class="ident" id="4198981">err</span>&nbsp;<span class="op" id="4198985">:=</span>&nbsp;<span class="ident" id="4198988">z</span><span class="op" id="4198989">.</span><span class="ident" id="4198990">read2</span><span class="op" id="4198995">(</span><span class="op" id="4198996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199000">if</span>&nbsp;<span class="ident" id="4199003">err</span>&nbsp;<span class="op" id="4199007">!=</span>&nbsp;<span class="builtintype" id="4199010">nil</span>&nbsp;<span class="op" id="4199014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199019">return</span>&nbsp;<span class="ident" id="4199026">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199036">data</span>&nbsp;<span class="op" id="4199041">:=</span>&nbsp;<span class="builtinfunc" id="4199044">make</span><span class="op" id="4199048">(</span><span class="op" id="4199049">[</span><span class="op" id="4199050">]</span><span class="builtintype" id="4199051">byte</span><span class="op" id="4199055">,</span>&nbsp;<span class="ident" id="4199057">n</span><span class="op" id="4199058">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199062">if</span>&nbsp;<span class="ident" id="4199065">_</span><span class="op" id="4199066">,</span>&nbsp;<span class="ident" id="4199068">err</span>&nbsp;<span class="op" id="4199072">=</span>&nbsp;<span class="ident" id="4199074">io</span><span class="op" id="4199076">.</span><span class="ident" id="4199077">ReadFull</span><span class="op" id="4199085">(</span><span class="ident" id="4199086">z</span><span class="op" id="4199087">.</span><span class="ident" id="4199088">r</span><span class="op" id="4199089">,</span>&nbsp;<span class="ident" id="4199091">data</span><span class="op" id="4199095">)</span><span class="op" id="4199096">;</span>&nbsp;<span class="ident" id="4199098">err</span>&nbsp;<span class="op" id="4199102">!=</span>&nbsp;<span class="builtintype" id="4199105">nil</span>&nbsp;<span class="op" id="4199109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199114">return</span>&nbsp;<span class="ident" id="4199121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199131">if</span>&nbsp;<span class="ident" id="4199134">save</span>&nbsp;<span class="op" id="4199139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199144">z</span><span class="op" id="4199145">.</span><span class="ident" id="4199146">Extra</span>&nbsp;<span class="op" id="4199152">=</span>&nbsp;<span class="ident" id="4199154">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199168">var</span>&nbsp;<span class="ident" id="4199172">s</span>&nbsp;<span class="builtintype" id="4199174">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199182">if</span>&nbsp;<span class="ident" id="4199185">z</span><span class="op" id="4199186">.</span><span class="ident" id="4199187">flg</span><span class="op" id="4199190">&amp;</span><span class="ident" id="4199191">flagName</span>&nbsp;<span class="op" id="4199200">!=</span>&nbsp;<span class="num" id="4199203">0</span>&nbsp;<span class="op" id="4199205">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199209">if</span>&nbsp;<span class="ident" id="4199212">s</span><span class="op" id="4199213">,</span>&nbsp;<span class="ident" id="4199215">err</span>&nbsp;<span class="op" id="4199219">=</span>&nbsp;<span class="ident" id="4199221">z</span><span class="op" id="4199222">.</span><span class="ident" id="4199223">readString</span><span class="op" id="4199233">(</span><span class="op" id="4199234">)</span><span class="op" id="4199235">;</span>&nbsp;<span class="ident" id="4199237">err</span>&nbsp;<span class="op" id="4199241">!=</span>&nbsp;<span class="builtintype" id="4199244">nil</span>&nbsp;<span class="op" id="4199248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199253">return</span>&nbsp;<span class="ident" id="4199260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199270">if</span>&nbsp;<span class="ident" id="4199273">save</span>&nbsp;<span class="op" id="4199278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199283">z</span><span class="op" id="4199284">.</span><span class="ident" id="4199285">Name</span>&nbsp;<span class="op" id="4199290">=</span>&nbsp;<span class="ident" id="4199292">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199303">if</span>&nbsp;<span class="ident" id="4199306">z</span><span class="op" id="4199307">.</span><span class="ident" id="4199308">flg</span><span class="op" id="4199311">&amp;</span><span class="ident" id="4199312">flagComment</span>&nbsp;<span class="op" id="4199324">!=</span>&nbsp;<span class="num" id="4199327">0</span>&nbsp;<span class="op" id="4199329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199333">if</span>&nbsp;<span class="ident" id="4199336">s</span><span class="op" id="4199337">,</span>&nbsp;<span class="ident" id="4199339">err</span>&nbsp;<span class="op" id="4199343">=</span>&nbsp;<span class="ident" id="4199345">z</span><span class="op" id="4199346">.</span><span class="ident" id="4199347">readString</span><span class="op" id="4199357">(</span><span class="op" id="4199358">)</span><span class="op" id="4199359">;</span>&nbsp;<span class="ident" id="4199361">err</span>&nbsp;<span class="op" id="4199365">!=</span>&nbsp;<span class="builtintype" id="4199368">nil</span>&nbsp;<span class="op" id="4199372">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199377">return</span>&nbsp;<span class="ident" id="4199384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199394">if</span>&nbsp;<span class="ident" id="4199397">save</span>&nbsp;<span class="op" id="4199402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199407">z</span><span class="op" id="4199408">.</span><span class="ident" id="4199409">Comment</span>&nbsp;<span class="op" id="4199417">=</span>&nbsp;<span class="ident" id="4199419">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199423">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199430">if</span>&nbsp;<span class="ident" id="4199433">z</span><span class="op" id="4199434">.</span><span class="ident" id="4199435">flg</span><span class="op" id="4199438">&amp;</span><span class="ident" id="4199439">flagHdrCrc</span>&nbsp;<span class="op" id="4199450">!=</span>&nbsp;<span class="num" id="4199453">0</span>&nbsp;<span class="op" id="4199455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199459">n</span><span class="op" id="4199460">,</span>&nbsp;<span class="ident" id="4199462">err</span>&nbsp;<span class="op" id="4199466">:=</span>&nbsp;<span class="ident" id="4199469">z</span><span class="op" id="4199470">.</span><span class="ident" id="4199471">read2</span><span class="op" id="4199476">(</span><span class="op" id="4199477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199481">if</span>&nbsp;<span class="ident" id="4199484">err</span>&nbsp;<span class="op" id="4199488">!=</span>&nbsp;<span class="builtintype" id="4199491">nil</span>&nbsp;<span class="op" id="4199495">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199500">return</span>&nbsp;<span class="ident" id="4199507">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199517">sum</span>&nbsp;<span class="op" id="4199521">:=</span>&nbsp;<span class="ident" id="4199524">z</span><span class="op" id="4199525">.</span><span class="ident" id="4199526">digest</span><span class="op" id="4199532">.</span><span class="ident" id="4199533">Sum32</span><span class="op" id="4199538">(</span><span class="op" id="4199539">)</span>&nbsp;<span class="op" id="4199541">&amp;</span>&nbsp;<span class="num" id="4199543">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199552">if</span>&nbsp;<span class="ident" id="4199555">n</span>&nbsp;<span class="op" id="4199557">!=</span>&nbsp;<span class="ident" id="4199560">sum</span>&nbsp;<span class="op" id="4199564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199569">return</span>&nbsp;<span class="ident" id="4199576">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199595">z</span><span class="op" id="4199596">.</span><span class="ident" id="4199597">digest</span><span class="op" id="4199603">.</span><span class="ident" id="4199604">Reset</span><span class="op" id="4199609">(</span><span class="op" id="4199610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199613">if</span>&nbsp;<span class="ident" id="4199616">z</span><span class="op" id="4199617">.</span><span class="ident" id="4199618">decompressor</span>&nbsp;<span class="op" id="4199631">==</span>&nbsp;<span class="builtintype" id="4199634">nil</span>&nbsp;<span class="op" id="4199638">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199642">z</span><span class="op" id="4199643">.</span><span class="ident" id="4199644">decompressor</span>&nbsp;<span class="op" id="4199657">=</span>&nbsp;<span class="ident" id="4199659">flate</span><span class="op" id="4199664">.</span><span class="ident" id="4199665">NewReader</span><span class="op" id="4199674">(</span><span class="ident" id="4199675">z</span><span class="op" id="4199676">.</span><span class="ident" id="4199677">r</span><span class="op" id="4199678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199681">}</span>&nbsp;<span class="keyword" id="4199683">else</span>&nbsp;<span class="op" id="4199688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199692">z</span><span class="op" id="4199693">.</span><span class="ident" id="4199694">decompressor</span><span class="op" id="4199706">.</span><span class="op" id="4199707">(</span><span class="ident" id="4199708">flate</span><span class="op" id="4199713">.</span><span class="ident" id="4199714">Resetter</span><span class="op" id="4199722">)</span><span class="op" id="4199723">.</span><span class="ident" id="4199724">Reset</span><span class="op" id="4199729">(</span><span class="ident" id="4199730">z</span><span class="op" id="4199731">.</span><span class="ident" id="4199732">r</span><span class="op" id="4199733">,</span>&nbsp;<span class="builtintype" id="4199735">nil</span><span class="op" id="4199738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199744">return</span>&nbsp;<span class="builtintype" id="4199751">nil</span><br>
<span class="lineno">240</span><span class="op" id="4199755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4199758">func</span>&nbsp;<span class="op" id="4199763">(</span><span class="ident" id="4199764">z</span>&nbsp;<span class="op" id="4199766">*</span><span class="ident" id="4199767">Reader</span><span class="op" id="4199773">)</span>&nbsp;<span class="ident" id="4199775">Read</span><span class="op" id="4199779">(</span><span class="ident" id="4199780">p</span>&nbsp;<span class="op" id="4199782">[</span><span class="op" id="4199783">]</span><span class="builtintype" id="4199784">byte</span><span class="op" id="4199788">)</span>&nbsp;<span class="op" id="4199790">(</span><span class="ident" id="4199791">n</span>&nbsp;<span class="builtintype" id="4199793">int</span><span class="op" id="4199796">,</span>&nbsp;<span class="ident" id="4199798">err</span>&nbsp;<span class="builtintype" id="4199802">error</span><span class="op" id="4199807">)</span>&nbsp;<span class="op" id="4199809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199812">if</span>&nbsp;<span class="ident" id="4199815">z</span><span class="op" id="4199816">.</span><span class="ident" id="4199817">err</span>&nbsp;<span class="op" id="4199821">!=</span>&nbsp;<span class="builtintype" id="4199824">nil</span>&nbsp;<span class="op" id="4199828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199832">return</span>&nbsp;<span class="num" id="4199839">0</span><span class="op" id="4199840">,</span>&nbsp;<span class="ident" id="4199842">z</span><span class="op" id="4199843">.</span><span class="ident" id="4199844">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199852">if</span>&nbsp;<span class="builtinfunc" id="4199855">len</span><span class="op" id="4199858">(</span><span class="ident" id="4199859">p</span><span class="op" id="4199860">)</span>&nbsp;<span class="op" id="4199862">==</span>&nbsp;<span class="num" id="4199865">0</span>&nbsp;<span class="op" id="4199867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199871">return</span>&nbsp;<span class="num" id="4199878">0</span><span class="op" id="4199879">,</span>&nbsp;<span class="builtintype" id="4199881">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4199886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199890">n</span><span class="op" id="4199891">,</span>&nbsp;<span class="ident" id="4199893">err</span>&nbsp;<span class="op" id="4199897">=</span>&nbsp;<span class="ident" id="4199899">z</span><span class="op" id="4199900">.</span><span class="ident" id="4199901">decompressor</span><span class="op" id="4199913">.</span><span class="ident" id="4199914">Read</span><span class="op" id="4199918">(</span><span class="ident" id="4199919">p</span><span class="op" id="4199920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199923">z</span><span class="op" id="4199924">.</span><span class="ident" id="4199925">digest</span><span class="op" id="4199931">.</span><span class="ident" id="4199932">Write</span><span class="op" id="4199937">(</span><span class="ident" id="4199938">p</span><span class="op" id="4199939">[</span><span class="num" id="4199940">0</span><span class="op" id="4199941">:</span><span class="ident" id="4199942">n</span><span class="op" id="4199943">]</span><span class="op" id="4199944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199947">z</span><span class="op" id="4199948">.</span><span class="ident" id="4199949">size</span>&nbsp;<span class="op" id="4199954">+=</span>&nbsp;<span class="builtintype" id="4199957">uint32</span><span class="op" id="4199963">(</span><span class="ident" id="4199964">n</span><span class="op" id="4199965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4199968">if</span>&nbsp;<span class="ident" id="4199971">n</span>&nbsp;<span class="op" id="4199973">!=</span>&nbsp;<span class="num" id="4199976">0</span>&nbsp;<span class="op" id="4199978">||</span>&nbsp;<span class="ident" id="4199981">err</span>&nbsp;<span class="op" id="4199985">!=</span>&nbsp;<span class="ident" id="4199988">io</span><span class="op" id="4199990">.</span><span class="ident" id="4199991">EOF</span>&nbsp;<span class="op" id="4199995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4199999">z</span><span class="op" id="4200000">.</span><span class="ident" id="4200001">err</span>&nbsp;<span class="op" id="4200005">=</span>&nbsp;<span class="ident" id="4200007">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200013">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4200025">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200067">if</span>&nbsp;<span class="ident" id="4200070">_</span><span class="op" id="4200071">,</span>&nbsp;<span class="ident" id="4200073">err</span>&nbsp;<span class="op" id="4200077">:=</span>&nbsp;<span class="ident" id="4200080">io</span><span class="op" id="4200082">.</span><span class="ident" id="4200083">ReadFull</span><span class="op" id="4200091">(</span><span class="ident" id="4200092">z</span><span class="op" id="4200093">.</span><span class="ident" id="4200094">r</span><span class="op" id="4200095">,</span>&nbsp;<span class="ident" id="4200097">z</span><span class="op" id="4200098">.</span><span class="ident" id="4200099">buf</span><span class="op" id="4200102">[</span><span class="num" id="4200103">0</span><span class="op" id="4200104">:</span><span class="num" id="4200105">8</span><span class="op" id="4200106">]</span><span class="op" id="4200107">)</span><span class="op" id="4200108">;</span>&nbsp;<span class="ident" id="4200110">err</span>&nbsp;<span class="op" id="4200114">!=</span>&nbsp;<span class="builtintype" id="4200117">nil</span>&nbsp;<span class="op" id="4200121">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200125">z</span><span class="op" id="4200126">.</span><span class="ident" id="4200127">err</span>&nbsp;<span class="op" id="4200131">=</span>&nbsp;<span class="ident" id="4200133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200139">return</span>&nbsp;<span class="num" id="4200146">0</span><span class="op" id="4200147">,</span>&nbsp;<span class="ident" id="4200149">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200157">crc32</span><span class="op" id="4200162">,</span>&nbsp;<span class="ident" id="4200164">isize</span>&nbsp;<span class="op" id="4200170">:=</span>&nbsp;<span class="ident" id="4200173">get4</span><span class="op" id="4200177">(</span><span class="ident" id="4200178">z</span><span class="op" id="4200179">.</span><span class="ident" id="4200180">buf</span><span class="op" id="4200183">[</span><span class="num" id="4200184">0</span><span class="op" id="4200185">:</span><span class="num" id="4200186">4</span><span class="op" id="4200187">]</span><span class="op" id="4200188">)</span><span class="op" id="4200189">,</span>&nbsp;<span class="ident" id="4200191">get4</span><span class="op" id="4200195">(</span><span class="ident" id="4200196">z</span><span class="op" id="4200197">.</span><span class="ident" id="4200198">buf</span><span class="op" id="4200201">[</span><span class="num" id="4200202">4</span><span class="op" id="4200203">:</span><span class="num" id="4200204">8</span><span class="op" id="4200205">]</span><span class="op" id="4200206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200209">sum</span>&nbsp;<span class="op" id="4200213">:=</span>&nbsp;<span class="ident" id="4200216">z</span><span class="op" id="4200217">.</span><span class="ident" id="4200218">digest</span><span class="op" id="4200224">.</span><span class="ident" id="4200225">Sum32</span><span class="op" id="4200230">(</span><span class="op" id="4200231">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200234">if</span>&nbsp;<span class="ident" id="4200237">sum</span>&nbsp;<span class="op" id="4200241">!=</span>&nbsp;<span class="ident" id="4200244">crc32</span>&nbsp;<span class="op" id="4200250">||</span>&nbsp;<span class="ident" id="4200253">isize</span>&nbsp;<span class="op" id="4200259">!=</span>&nbsp;<span class="ident" id="4200262">z</span><span class="op" id="4200263">.</span><span class="ident" id="4200264">size</span>&nbsp;<span class="op" id="4200269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200273">z</span><span class="op" id="4200274">.</span><span class="ident" id="4200275">err</span>&nbsp;<span class="op" id="4200279">=</span>&nbsp;<span class="ident" id="4200281">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200295">return</span>&nbsp;<span class="num" id="4200302">0</span><span class="op" id="4200303">,</span>&nbsp;<span class="ident" id="4200305">z</span><span class="op" id="4200306">.</span><span class="ident" id="4200307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4200316">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200350">if</span>&nbsp;<span class="op" id="4200353">!</span><span class="ident" id="4200354">z</span><span class="op" id="4200355">.</span><span class="ident" id="4200356">multistream</span>&nbsp;<span class="op" id="4200368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200372">return</span>&nbsp;<span class="num" id="4200379">0</span><span class="op" id="4200380">,</span>&nbsp;<span class="ident" id="4200382">io</span><span class="op" id="4200384">.</span><span class="ident" id="4200385">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200394">if</span>&nbsp;<span class="ident" id="4200397">err</span>&nbsp;<span class="op" id="4200401">=</span>&nbsp;<span class="ident" id="4200403">z</span><span class="op" id="4200404">.</span><span class="ident" id="4200405">readHeader</span><span class="op" id="4200415">(</span><span class="builtintype" id="4200416">false</span><span class="op" id="4200421">)</span><span class="op" id="4200422">;</span>&nbsp;<span class="ident" id="4200424">err</span>&nbsp;<span class="op" id="4200428">!=</span>&nbsp;<span class="builtintype" id="4200431">nil</span>&nbsp;<span class="op" id="4200435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200439">z</span><span class="op" id="4200440">.</span><span class="ident" id="4200441">err</span>&nbsp;<span class="op" id="4200445">=</span>&nbsp;<span class="ident" id="4200447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200453">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4200461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4200465">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200499">z</span><span class="op" id="4200500">.</span><span class="ident" id="4200501">digest</span><span class="op" id="4200507">.</span><span class="ident" id="4200508">Reset</span><span class="op" id="4200513">(</span><span class="op" id="4200514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4200517">z</span><span class="op" id="4200518">.</span><span class="ident" id="4200519">size</span>&nbsp;<span class="op" id="4200524">=</span>&nbsp;<span class="num" id="4200526">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4200529">return</span>&nbsp;<span class="ident" id="4200536">z</span><span class="op" id="4200537">.</span><span class="ident" id="4200538">Read</span><span class="op" id="4200542">(</span><span class="ident" id="4200543">p</span><span class="op" id="4200544">)</span><br>
<span class="lineno"></span><span class="op" id="4200546">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4200549">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4200621">func</span>&nbsp;<span class="op" id="4200626">(</span><span class="ident" id="4200627">z</span>&nbsp;<span class="op" id="4200629">*</span><span class="ident" id="4200630">Reader</span><span class="op" id="4200636">)</span>&nbsp;<span class="ident" id="4200638">Close</span><span class="op" id="4200643">(</span><span class="op" id="4200644">)</span>&nbsp;<span class="builtintype" id="4200646">error</span>&nbsp;<span class="op" id="4200652">{</span>&nbsp;<span class="keyword" id="4200654">return</span>&nbsp;<span class="ident" id="4200661">z</span><span class="op" id="4200662">.</span><span class="ident" id="4200663">decompressor</span><span class="op" id="4200675">.</span><span class="ident" id="4200676">Close</span><span class="op" id="4200681">(</span><span class="op" id="4200682">)</span>&nbsp;<span class="op" id="4200684">}</span>
</div>
</body>
</html>
