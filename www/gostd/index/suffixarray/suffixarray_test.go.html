<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7058539">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7058594">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7058648">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7058699">package</span>&nbsp;<span class="ident" id="7058707">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7058720">import</span>&nbsp;<span class="op" id="7058727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058730">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058739">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058752">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058762">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058770">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058781">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7058791">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7058794">type</span>&nbsp;<span class="ident" id="7058799">testCase</span>&nbsp;<span class="keyword" id="7058808">struct</span>&nbsp;<span class="op" id="7058815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7058818">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7058827">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7058836">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7058858">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7058867">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7058876">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7058896">patterns</span>&nbsp;<span class="op" id="7058905">[</span><span class="op" id="7058906">]</span><span class="builtintype" id="7058907">string</span>&nbsp;<span class="comment" id="7058914">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="7058936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7058939">var</span>&nbsp;<span class="ident" id="7058943">testCases</span>&nbsp;<span class="op" id="7058953">=</span>&nbsp;<span class="op" id="7058955">[</span><span class="op" id="7058956">]</span><span class="ident" id="7058957">testCase</span><span class="op" id="7058965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7058968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058972">&#34;empty&nbsp;string&#34;</span><span class="op" id="7058986">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7058990">&#34;&#34;</span><span class="op" id="7058992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7058996">[</span><span class="op" id="7058997">]</span><span class="builtintype" id="7058998">string</span><span class="op" id="7059004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059009">&#34;&#34;</span><span class="op" id="7059011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059016">&#34;foo&#34;</span><span class="op" id="7059021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059026">&#34;(foo)&#34;</span><span class="op" id="7059033">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059038">&#34;.*&#34;</span><span class="op" id="7059042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059047">&#34;a*&#34;</span><span class="op" id="7059051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059055">}</span><span class="op" id="7059056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059059">}</span><span class="op" id="7059060">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059068">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="7059077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059081">&#34;aaaaaaaaaa&#34;</span><span class="op" id="7059093">,</span>&nbsp;<span class="comment" id="7059095">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059107">[</span><span class="op" id="7059108">]</span><span class="builtintype" id="7059109">string</span><span class="op" id="7059115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059120">&#34;&#34;</span><span class="op" id="7059122">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059127">&#34;a&#34;</span><span class="op" id="7059130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059135">&#34;aa&#34;</span><span class="op" id="7059139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059144">&#34;aaa&#34;</span><span class="op" id="7059149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059154">&#34;aaaa&#34;</span><span class="op" id="7059160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059165">&#34;aaaaa&#34;</span><span class="op" id="7059172">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059177">&#34;aaaaaa&#34;</span><span class="op" id="7059185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059190">&#34;aaaaaaa&#34;</span><span class="op" id="7059199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059204">&#34;aaaaaaaa&#34;</span><span class="op" id="7059214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059219">&#34;aaaaaaaaa&#34;</span><span class="op" id="7059230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059235">&#34;aaaaaaaaaa&#34;</span><span class="op" id="7059247">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059252">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="7059265">,</span>&nbsp;<span class="comment" id="7059267">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059280">&#34;.&#34;</span><span class="op" id="7059283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059288">&#34;.*&#34;</span><span class="op" id="7059292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059297">&#34;a+&#34;</span><span class="op" id="7059301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059306">&#34;aa+&#34;</span><span class="op" id="7059311">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059316">&#34;aaaa[b]?&#34;</span><span class="op" id="7059326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059331">&#34;aaa*&#34;</span><span class="op" id="7059337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059341">}</span><span class="op" id="7059342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059345">}</span><span class="op" id="7059346">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059354">&#34;abc&#34;</span><span class="op" id="7059359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059363">&#34;abc&#34;</span><span class="op" id="7059368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059372">[</span><span class="op" id="7059373">]</span><span class="builtintype" id="7059374">string</span><span class="op" id="7059380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059385">&#34;a&#34;</span><span class="op" id="7059388">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059393">&#34;b&#34;</span><span class="op" id="7059396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059401">&#34;c&#34;</span><span class="op" id="7059404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059409">&#34;ab&#34;</span><span class="op" id="7059413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059418">&#34;bc&#34;</span><span class="op" id="7059422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059427">&#34;abc&#34;</span><span class="op" id="7059432">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059437">&#34;a.c&#34;</span><span class="op" id="7059442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059447">&#34;a(b|c)&#34;</span><span class="op" id="7059455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059460">&#34;abc?&#34;</span><span class="op" id="7059466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059470">}</span><span class="op" id="7059471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059474">}</span><span class="op" id="7059475">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059483">&#34;barbara*3&#34;</span><span class="op" id="7059494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059498">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="7059521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059525">[</span><span class="op" id="7059526">]</span><span class="builtintype" id="7059527">string</span><span class="op" id="7059533">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059538">&#34;a&#34;</span><span class="op" id="7059541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059546">&#34;bar&#34;</span><span class="op" id="7059551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059556">&#34;rab&#34;</span><span class="op" id="7059561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059566">&#34;arab&#34;</span><span class="op" id="7059572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059577">&#34;barbar&#34;</span><span class="op" id="7059585">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059590">&#34;bara?bar&#34;</span><span class="op" id="7059600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059604">}</span><span class="op" id="7059605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059608">}</span><span class="op" id="7059609">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059613">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059617">&#34;typing&nbsp;drill&#34;</span><span class="op" id="7059631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059635">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="7059706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059710">[</span><span class="op" id="7059711">]</span><span class="builtintype" id="7059712">string</span><span class="op" id="7059718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059723">&#34;Now&#34;</span><span class="op" id="7059728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059733">&#34;the&nbsp;time&#34;</span><span class="op" id="7059743">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059748">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="7059765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059770">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="7059828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059833">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="7059849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059853">}</span><span class="op" id="7059854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059857">}</span><span class="op" id="7059858">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059866">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="7059884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7059888">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="7059933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059937">[</span><span class="op" id="7059938">]</span><span class="builtintype" id="7059939">string</span><span class="op" id="7059945">{</span><span class="op" id="7059946">}</span><span class="op" id="7059947">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7059950">}</span><span class="op" id="7059951">,</span><br>
<span class="lineno"></span><span class="op" id="7059953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7059956">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="7060025">func</span>&nbsp;<span class="ident" id="7060030">find</span><span class="op" id="7060034">(</span><span class="ident" id="7060035">src</span><span class="op" id="7060038">,</span>&nbsp;<span class="ident" id="7060040">s</span>&nbsp;<span class="builtintype" id="7060042">string</span><span class="op" id="7060048">,</span>&nbsp;<span class="ident" id="7060050">n</span>&nbsp;<span class="builtintype" id="7060052">int</span><span class="op" id="7060055">)</span>&nbsp;<span class="op" id="7060057">[</span><span class="op" id="7060058">]</span><span class="builtintype" id="7060059">int</span>&nbsp;<span class="op" id="7060063">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060066">var</span>&nbsp;<span class="ident" id="7060070">res</span>&nbsp;<span class="op" id="7060074">[</span><span class="op" id="7060075">]</span><span class="builtintype" id="7060076">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060081">if</span>&nbsp;<span class="ident" id="7060084">s</span>&nbsp;<span class="op" id="7060086">!=</span>&nbsp;<span class="string" id="7060089">&#34;&#34;</span>&nbsp;<span class="op" id="7060092">&amp;&amp;</span>&nbsp;<span class="ident" id="7060095">n</span>&nbsp;<span class="op" id="7060097">!=</span>&nbsp;<span class="num" id="7060100">0</span>&nbsp;<span class="op" id="7060102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060106">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060150">for</span>&nbsp;<span class="ident" id="7060154">i</span>&nbsp;<span class="op" id="7060156">:=</span>&nbsp;<span class="op" id="7060159">-</span><span class="num" id="7060160">1</span><span class="op" id="7060161">;</span>&nbsp;<span class="ident" id="7060163">n</span>&nbsp;<span class="op" id="7060165">&lt;</span>&nbsp;<span class="num" id="7060167">0</span>&nbsp;<span class="op" id="7060169">||</span>&nbsp;<span class="builtinfunc" id="7060172">len</span><span class="op" id="7060175">(</span><span class="ident" id="7060176">res</span><span class="op" id="7060179">)</span>&nbsp;<span class="op" id="7060181">&lt;</span>&nbsp;<span class="ident" id="7060183">n</span><span class="op" id="7060184">;</span>&nbsp;<span class="op" id="7060186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060191">j</span>&nbsp;<span class="op" id="7060193">:=</span>&nbsp;<span class="ident" id="7060196">strings</span><span class="op" id="7060203">.</span><span class="ident" id="7060204">Index</span><span class="op" id="7060209">(</span><span class="ident" id="7060210">src</span><span class="op" id="7060213">[</span><span class="ident" id="7060214">i</span><span class="op" id="7060215">+</span><span class="num" id="7060216">1</span><span class="op" id="7060217">:</span><span class="op" id="7060218">]</span><span class="op" id="7060219">,</span>&nbsp;<span class="ident" id="7060221">s</span><span class="op" id="7060222">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060227">if</span>&nbsp;<span class="ident" id="7060230">j</span>&nbsp;<span class="op" id="7060232">&lt;</span>&nbsp;<span class="num" id="7060234">0</span>&nbsp;<span class="op" id="7060236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060242">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7060251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060256">i</span>&nbsp;<span class="op" id="7060258">+=</span>&nbsp;<span class="ident" id="7060261">j</span>&nbsp;<span class="op" id="7060263">+</span>&nbsp;<span class="num" id="7060265">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060270">res</span>&nbsp;<span class="op" id="7060274">=</span>&nbsp;<span class="builtinfunc" id="7060276">append</span><span class="op" id="7060282">(</span><span class="ident" id="7060283">res</span><span class="op" id="7060286">,</span>&nbsp;<span class="ident" id="7060288">i</span><span class="op" id="7060289">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7060293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7060296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060299">return</span>&nbsp;<span class="ident" id="7060306">res</span><br>
<span class="lineno"></span><span class="op" id="7060310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7060313">func</span>&nbsp;<span class="ident" id="7060318">testLookup</span><span class="op" id="7060328">(</span><span class="ident" id="7060329">t</span>&nbsp;<span class="op" id="7060331">*</span><span class="ident" id="7060332">testing</span><span class="op" id="7060339">.</span><span class="ident" id="7060340">T</span><span class="op" id="7060341">,</span>&nbsp;<span class="ident" id="7060343">tc</span>&nbsp;<span class="op" id="7060346">*</span><span class="ident" id="7060347">testCase</span><span class="op" id="7060355">,</span>&nbsp;<span class="ident" id="7060357">x</span>&nbsp;<span class="op" id="7060359">*</span><span class="ident" id="7060360">Index</span><span class="op" id="7060365">,</span>&nbsp;<span class="ident" id="7060367">s</span>&nbsp;<span class="builtintype" id="7060369">string</span><span class="op" id="7060375">,</span>&nbsp;<span class="ident" id="7060377">n</span>&nbsp;<span class="builtintype" id="7060379">int</span><span class="op" id="7060382">)</span>&nbsp;<span class="op" id="7060384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060387">res</span>&nbsp;<span class="op" id="7060391">:=</span>&nbsp;<span class="ident" id="7060394">x</span><span class="op" id="7060395">.</span><span class="ident" id="7060396">Lookup</span><span class="op" id="7060402">(</span><span class="op" id="7060403">[</span><span class="op" id="7060404">]</span><span class="builtintype" id="7060405">byte</span><span class="op" id="7060409">(</span><span class="ident" id="7060410">s</span><span class="op" id="7060411">)</span><span class="op" id="7060412">,</span>&nbsp;<span class="ident" id="7060414">n</span><span class="op" id="7060415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060418">exp</span>&nbsp;<span class="op" id="7060422">:=</span>&nbsp;<span class="ident" id="7060425">find</span><span class="op" id="7060429">(</span><span class="ident" id="7060430">tc</span><span class="op" id="7060432">.</span><span class="ident" id="7060433">source</span><span class="op" id="7060439">,</span>&nbsp;<span class="ident" id="7060441">s</span><span class="op" id="7060442">,</span>&nbsp;<span class="ident" id="7060444">n</span><span class="op" id="7060445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060449">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7060482">if</span>&nbsp;<span class="builtinfunc" id="7060485">len</span><span class="op" id="7060488">(</span><span class="ident" id="7060489">res</span><span class="op" id="7060492">)</span>&nbsp;<span class="op" id="7060494">!=</span>&nbsp;<span class="builtinfunc" id="7060497">len</span><span class="op" id="7060500">(</span><span class="ident" id="7060501">exp</span><span class="op" id="7060504">)</span>&nbsp;<span class="op" id="7060506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060510">t</span><span class="op" id="7060511">.</span><span class="ident" id="7060512">Errorf</span><span class="op" id="7060518">(</span><span class="string" id="7060519">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7060577">,</span>&nbsp;<span class="ident" id="7060579">tc</span><span class="op" id="7060581">.</span><span class="ident" id="7060582">name</span><span class="op" id="7060586">,</span>&nbsp;<span class="ident" id="7060588">s</span><span class="op" id="7060589">,</span>&nbsp;<span class="ident" id="7060591">n</span><span class="op" id="7060592">,</span>&nbsp;<span class="builtinfunc" id="7060594">len</span><span class="op" id="7060597">(</span><span class="ident" id="7060598">exp</span><span class="op" id="7060601">)</span><span class="op" id="7060602">,</span>&nbsp;<span class="builtinfunc" id="7060604">len</span><span class="op" id="7060607">(</span><span class="ident" id="7060608">res</span><span class="op" id="7060611">)</span><span class="op" id="7060612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7060615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060619">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060695">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060771">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060847">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7060912">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7060994">sort</span><span class="op" id="7060998">.</span><span class="ident" id="7060999">Ints</span><span class="op" id="7061003">(</span><span class="ident" id="7061004">res</span><span class="op" id="7061007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061010">for</span>&nbsp;<span class="ident" id="7061014">i</span><span class="op" id="7061015">,</span>&nbsp;<span class="ident" id="7061017">r</span>&nbsp;<span class="op" id="7061019">:=</span>&nbsp;<span class="keyword" id="7061022">range</span>&nbsp;<span class="ident" id="7061028">res</span>&nbsp;<span class="op" id="7061032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061036">if</span>&nbsp;<span class="ident" id="7061039">r</span>&nbsp;<span class="op" id="7061041">&lt;</span>&nbsp;<span class="num" id="7061043">0</span>&nbsp;<span class="op" id="7061045">||</span>&nbsp;<span class="builtinfunc" id="7061048">len</span><span class="op" id="7061051">(</span><span class="ident" id="7061052">tc</span><span class="op" id="7061054">.</span><span class="ident" id="7061055">source</span><span class="op" id="7061061">)</span>&nbsp;<span class="op" id="7061063">&lt;=</span>&nbsp;<span class="ident" id="7061066">r</span>&nbsp;<span class="op" id="7061068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061073">t</span><span class="op" id="7061074">.</span><span class="ident" id="7061075">Errorf</span><span class="op" id="7061081">(</span><span class="string" id="7061082">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="7061153">,</span>&nbsp;<span class="ident" id="7061155">tc</span><span class="op" id="7061157">.</span><span class="ident" id="7061158">name</span><span class="op" id="7061162">,</span>&nbsp;<span class="ident" id="7061164">s</span><span class="op" id="7061165">,</span>&nbsp;<span class="ident" id="7061167">i</span><span class="op" id="7061168">,</span>&nbsp;<span class="ident" id="7061170">n</span><span class="op" id="7061171">,</span>&nbsp;<span class="ident" id="7061173">r</span><span class="op" id="7061174">,</span>&nbsp;<span class="builtinfunc" id="7061176">len</span><span class="op" id="7061179">(</span><span class="ident" id="7061180">tc</span><span class="op" id="7061182">.</span><span class="ident" id="7061183">source</span><span class="op" id="7061189">)</span><span class="op" id="7061190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061194">}</span>&nbsp;<span class="keyword" id="7061196">else</span>&nbsp;<span class="keyword" id="7061201">if</span>&nbsp;<span class="op" id="7061204">!</span><span class="ident" id="7061205">strings</span><span class="op" id="7061212">.</span><span class="ident" id="7061213">HasPrefix</span><span class="op" id="7061222">(</span><span class="ident" id="7061223">tc</span><span class="op" id="7061225">.</span><span class="ident" id="7061226">source</span><span class="op" id="7061232">[</span><span class="ident" id="7061233">r</span><span class="op" id="7061234">:</span><span class="op" id="7061235">]</span><span class="op" id="7061236">,</span>&nbsp;<span class="ident" id="7061238">s</span><span class="op" id="7061239">)</span>&nbsp;<span class="op" id="7061241">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061246">t</span><span class="op" id="7061247">.</span><span class="ident" id="7061248">Errorf</span><span class="op" id="7061254">(</span><span class="string" id="7061255">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="7061317">,</span>&nbsp;<span class="ident" id="7061319">tc</span><span class="op" id="7061321">.</span><span class="ident" id="7061322">name</span><span class="op" id="7061326">,</span>&nbsp;<span class="ident" id="7061328">s</span><span class="op" id="7061329">,</span>&nbsp;<span class="ident" id="7061331">i</span><span class="op" id="7061332">,</span>&nbsp;<span class="ident" id="7061334">n</span><span class="op" id="7061335">,</span>&nbsp;<span class="ident" id="7061337">r</span><span class="op" id="7061338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061346">if</span>&nbsp;<span class="ident" id="7061349">i</span>&nbsp;<span class="op" id="7061351">&gt;</span>&nbsp;<span class="num" id="7061353">0</span>&nbsp;<span class="op" id="7061355">&amp;&amp;</span>&nbsp;<span class="ident" id="7061358">res</span><span class="op" id="7061361">[</span><span class="ident" id="7061362">i</span><span class="op" id="7061363">-</span><span class="num" id="7061364">1</span><span class="op" id="7061365">]</span>&nbsp;<span class="op" id="7061367">==</span>&nbsp;<span class="ident" id="7061370">r</span>&nbsp;<span class="op" id="7061372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061377">t</span><span class="op" id="7061378">.</span><span class="ident" id="7061379">Errorf</span><span class="op" id="7061385">(</span><span class="string" id="7061386">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="7061452">,</span>&nbsp;<span class="ident" id="7061454">tc</span><span class="op" id="7061456">.</span><span class="ident" id="7061457">name</span><span class="op" id="7061461">,</span>&nbsp;<span class="ident" id="7061463">s</span><span class="op" id="7061464">,</span>&nbsp;<span class="ident" id="7061466">i</span><span class="op" id="7061467">,</span>&nbsp;<span class="ident" id="7061469">n</span><span class="op" id="7061470">,</span>&nbsp;<span class="ident" id="7061472">r</span><span class="op" id="7061473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061477">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061484">if</span>&nbsp;<span class="ident" id="7061487">n</span>&nbsp;<span class="op" id="7061489">&lt;</span>&nbsp;<span class="num" id="7061491">0</span>&nbsp;<span class="op" id="7061493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7061497">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061558">for</span>&nbsp;<span class="ident" id="7061562">i</span><span class="op" id="7061563">,</span>&nbsp;<span class="ident" id="7061565">r</span>&nbsp;<span class="op" id="7061567">:=</span>&nbsp;<span class="keyword" id="7061570">range</span>&nbsp;<span class="ident" id="7061576">res</span>&nbsp;<span class="op" id="7061580">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061585">e</span>&nbsp;<span class="op" id="7061587">:=</span>&nbsp;<span class="ident" id="7061590">exp</span><span class="op" id="7061593">[</span><span class="ident" id="7061594">i</span><span class="op" id="7061595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061600">if</span>&nbsp;<span class="ident" id="7061603">r</span>&nbsp;<span class="op" id="7061605">!=</span>&nbsp;<span class="ident" id="7061608">e</span>&nbsp;<span class="op" id="7061610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061616">t</span><span class="op" id="7061617">.</span><span class="ident" id="7061618">Errorf</span><span class="op" id="7061624">(</span><span class="string" id="7061625">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7061683">,</span>&nbsp;<span class="ident" id="7061685">tc</span><span class="op" id="7061687">.</span><span class="ident" id="7061688">name</span><span class="op" id="7061692">,</span>&nbsp;<span class="ident" id="7061694">s</span><span class="op" id="7061695">,</span>&nbsp;<span class="ident" id="7061697">i</span><span class="op" id="7061698">,</span>&nbsp;<span class="ident" id="7061700">e</span><span class="op" id="7061701">,</span>&nbsp;<span class="ident" id="7061703">r</span><span class="op" id="7061704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061713">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7061716">}</span><br>
<span class="lineno"></span><span class="op" id="7061718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7061721">func</span>&nbsp;<span class="ident" id="7061726">testFindAllIndex</span><span class="op" id="7061742">(</span><span class="ident" id="7061743">t</span>&nbsp;<span class="op" id="7061745">*</span><span class="ident" id="7061746">testing</span><span class="op" id="7061753">.</span><span class="ident" id="7061754">T</span><span class="op" id="7061755">,</span>&nbsp;<span class="ident" id="7061757">tc</span>&nbsp;<span class="op" id="7061760">*</span><span class="ident" id="7061761">testCase</span><span class="op" id="7061769">,</span>&nbsp;<span class="ident" id="7061771">x</span>&nbsp;<span class="op" id="7061773">*</span><span class="ident" id="7061774">Index</span><span class="op" id="7061779">,</span>&nbsp;<span class="ident" id="7061781">rx</span>&nbsp;<span class="op" id="7061784">*</span><span class="ident" id="7061785">regexp</span><span class="op" id="7061791">.</span><span class="ident" id="7061792">Regexp</span><span class="op" id="7061798">,</span>&nbsp;<span class="ident" id="7061800">n</span>&nbsp;<span class="builtintype" id="7061802">int</span><span class="op" id="7061805">)</span>&nbsp;<span class="op" id="7061807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061810">res</span>&nbsp;<span class="op" id="7061814">:=</span>&nbsp;<span class="ident" id="7061817">x</span><span class="op" id="7061818">.</span><span class="ident" id="7061819">FindAllIndex</span><span class="op" id="7061831">(</span><span class="ident" id="7061832">rx</span><span class="op" id="7061834">,</span>&nbsp;<span class="ident" id="7061836">n</span><span class="op" id="7061837">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061840">exp</span>&nbsp;<span class="op" id="7061844">:=</span>&nbsp;<span class="ident" id="7061847">rx</span><span class="op" id="7061849">.</span><span class="ident" id="7061850">FindAllStringIndex</span><span class="op" id="7061868">(</span><span class="ident" id="7061869">tc</span><span class="op" id="7061871">.</span><span class="ident" id="7061872">source</span><span class="op" id="7061878">,</span>&nbsp;<span class="ident" id="7061880">n</span><span class="op" id="7061881">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7061885">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7061918">if</span>&nbsp;<span class="builtinfunc" id="7061921">len</span><span class="op" id="7061924">(</span><span class="ident" id="7061925">res</span><span class="op" id="7061928">)</span>&nbsp;<span class="op" id="7061930">!=</span>&nbsp;<span class="builtinfunc" id="7061933">len</span><span class="op" id="7061936">(</span><span class="ident" id="7061937">exp</span><span class="op" id="7061940">)</span>&nbsp;<span class="op" id="7061942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7061946">t</span><span class="op" id="7061947">.</span><span class="ident" id="7061948">Errorf</span><span class="op" id="7061954">(</span><span class="string" id="7061955">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7062019">,</span>&nbsp;<span class="ident" id="7062021">tc</span><span class="op" id="7062023">.</span><span class="ident" id="7062024">name</span><span class="op" id="7062028">,</span>&nbsp;<span class="ident" id="7062030">rx</span><span class="op" id="7062032">,</span>&nbsp;<span class="ident" id="7062034">n</span><span class="op" id="7062035">,</span>&nbsp;<span class="builtinfunc" id="7062037">len</span><span class="op" id="7062040">(</span><span class="ident" id="7062041">exp</span><span class="op" id="7062044">)</span><span class="op" id="7062045">,</span>&nbsp;<span class="builtinfunc" id="7062047">len</span><span class="op" id="7062050">(</span><span class="ident" id="7062051">res</span><span class="op" id="7062054">)</span><span class="op" id="7062055">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7062058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062062">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062138">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062216">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062294">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062359">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7062438">for</span>&nbsp;<span class="ident" id="7062442">i</span><span class="op" id="7062443">,</span>&nbsp;<span class="ident" id="7062445">r</span>&nbsp;<span class="op" id="7062447">:=</span>&nbsp;<span class="keyword" id="7062450">range</span>&nbsp;<span class="ident" id="7062456">res</span>&nbsp;<span class="op" id="7062460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7062464">if</span>&nbsp;<span class="ident" id="7062467">r</span><span class="op" id="7062468">[</span><span class="num" id="7062469">0</span><span class="op" id="7062470">]</span>&nbsp;<span class="op" id="7062472">&lt;</span>&nbsp;<span class="num" id="7062474">0</span>&nbsp;<span class="op" id="7062476">||</span>&nbsp;<span class="ident" id="7062479">r</span><span class="op" id="7062480">[</span><span class="num" id="7062481">0</span><span class="op" id="7062482">]</span>&nbsp;<span class="op" id="7062484">&gt;</span>&nbsp;<span class="ident" id="7062486">r</span><span class="op" id="7062487">[</span><span class="num" id="7062488">1</span><span class="op" id="7062489">]</span>&nbsp;<span class="op" id="7062491">||</span>&nbsp;<span class="builtinfunc" id="7062494">len</span><span class="op" id="7062497">(</span><span class="ident" id="7062498">tc</span><span class="op" id="7062500">.</span><span class="ident" id="7062501">source</span><span class="op" id="7062507">)</span>&nbsp;<span class="op" id="7062509">&lt;</span>&nbsp;<span class="ident" id="7062511">r</span><span class="op" id="7062512">[</span><span class="num" id="7062513">1</span><span class="op" id="7062514">]</span>&nbsp;<span class="op" id="7062516">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7062521">t</span><span class="op" id="7062522">.</span><span class="ident" id="7062523">Errorf</span><span class="op" id="7062529">(</span><span class="string" id="7062530">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="7062601">,</span>&nbsp;<span class="ident" id="7062603">tc</span><span class="op" id="7062605">.</span><span class="ident" id="7062606">name</span><span class="op" id="7062610">,</span>&nbsp;<span class="ident" id="7062612">rx</span><span class="op" id="7062614">,</span>&nbsp;<span class="ident" id="7062616">i</span><span class="op" id="7062617">,</span>&nbsp;<span class="ident" id="7062619">n</span><span class="op" id="7062620">,</span>&nbsp;<span class="ident" id="7062622">r</span><span class="op" id="7062623">[</span><span class="num" id="7062624">0</span><span class="op" id="7062625">]</span><span class="op" id="7062626">,</span>&nbsp;<span class="ident" id="7062628">r</span><span class="op" id="7062629">[</span><span class="num" id="7062630">1</span><span class="op" id="7062631">]</span><span class="op" id="7062632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7062636">}</span>&nbsp;<span class="keyword" id="7062638">else</span>&nbsp;<span class="keyword" id="7062643">if</span>&nbsp;<span class="op" id="7062646">!</span><span class="ident" id="7062647">rx</span><span class="op" id="7062649">.</span><span class="ident" id="7062650">MatchString</span><span class="op" id="7062661">(</span><span class="ident" id="7062662">tc</span><span class="op" id="7062664">.</span><span class="ident" id="7062665">source</span><span class="op" id="7062671">[</span><span class="ident" id="7062672">r</span><span class="op" id="7062673">[</span><span class="num" id="7062674">0</span><span class="op" id="7062675">]</span><span class="op" id="7062676">:</span><span class="ident" id="7062677">r</span><span class="op" id="7062678">[</span><span class="num" id="7062679">1</span><span class="op" id="7062680">]</span><span class="op" id="7062681">]</span><span class="op" id="7062682">)</span>&nbsp;<span class="op" id="7062684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7062689">t</span><span class="op" id="7062690">.</span><span class="ident" id="7062691">Errorf</span><span class="op" id="7062697">(</span><span class="string" id="7062698">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="7062766">,</span>&nbsp;<span class="ident" id="7062768">tc</span><span class="op" id="7062770">.</span><span class="ident" id="7062771">name</span><span class="op" id="7062775">,</span>&nbsp;<span class="ident" id="7062777">rx</span><span class="op" id="7062779">,</span>&nbsp;<span class="ident" id="7062781">i</span><span class="op" id="7062782">,</span>&nbsp;<span class="ident" id="7062784">n</span><span class="op" id="7062785">,</span>&nbsp;<span class="ident" id="7062787">r</span><span class="op" id="7062788">[</span><span class="num" id="7062789">0</span><span class="op" id="7062790">]</span><span class="op" id="7062791">,</span>&nbsp;<span class="ident" id="7062793">r</span><span class="op" id="7062794">[</span><span class="num" id="7062795">1</span><span class="op" id="7062796">]</span><span class="op" id="7062797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7062801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7062804">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7062808">if</span>&nbsp;<span class="ident" id="7062811">n</span>&nbsp;<span class="op" id="7062813">&lt;</span>&nbsp;<span class="num" id="7062815">0</span>&nbsp;<span class="op" id="7062817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7062821">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7062882">for</span>&nbsp;<span class="ident" id="7062886">i</span><span class="op" id="7062887">,</span>&nbsp;<span class="ident" id="7062889">r</span>&nbsp;<span class="op" id="7062891">:=</span>&nbsp;<span class="keyword" id="7062894">range</span>&nbsp;<span class="ident" id="7062900">res</span>&nbsp;<span class="op" id="7062904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7062909">e</span>&nbsp;<span class="op" id="7062911">:=</span>&nbsp;<span class="ident" id="7062914">exp</span><span class="op" id="7062917">[</span><span class="ident" id="7062918">i</span><span class="op" id="7062919">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7062924">if</span>&nbsp;<span class="ident" id="7062927">r</span><span class="op" id="7062928">[</span><span class="num" id="7062929">0</span><span class="op" id="7062930">]</span>&nbsp;<span class="op" id="7062932">!=</span>&nbsp;<span class="ident" id="7062935">e</span><span class="op" id="7062936">[</span><span class="num" id="7062937">0</span><span class="op" id="7062938">]</span>&nbsp;<span class="op" id="7062940">||</span>&nbsp;<span class="ident" id="7062943">r</span><span class="op" id="7062944">[</span><span class="num" id="7062945">1</span><span class="op" id="7062946">]</span>&nbsp;<span class="op" id="7062948">!=</span>&nbsp;<span class="ident" id="7062951">e</span><span class="op" id="7062952">[</span><span class="num" id="7062953">1</span><span class="op" id="7062954">]</span>&nbsp;<span class="op" id="7062956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7062962">t</span><span class="op" id="7062963">.</span><span class="ident" id="7062964">Errorf</span><span class="op" id="7062970">(</span><span class="string" id="7062971">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="7063047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7063054">tc</span><span class="op" id="7063056">.</span><span class="ident" id="7063057">name</span><span class="op" id="7063061">,</span>&nbsp;<span class="ident" id="7063063">rx</span><span class="op" id="7063065">,</span>&nbsp;<span class="ident" id="7063067">i</span><span class="op" id="7063068">,</span>&nbsp;<span class="ident" id="7063070">e</span><span class="op" id="7063071">[</span><span class="num" id="7063072">0</span><span class="op" id="7063073">]</span><span class="op" id="7063074">,</span>&nbsp;<span class="ident" id="7063076">e</span><span class="op" id="7063077">[</span><span class="num" id="7063078">1</span><span class="op" id="7063079">]</span><span class="op" id="7063080">,</span>&nbsp;<span class="ident" id="7063082">r</span><span class="op" id="7063083">[</span><span class="num" id="7063084">0</span><span class="op" id="7063085">]</span><span class="op" id="7063086">,</span>&nbsp;<span class="ident" id="7063088">r</span><span class="op" id="7063089">[</span><span class="num" id="7063090">1</span><span class="op" id="7063091">]</span><span class="op" id="7063092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063101">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063104">}</span><br>
<span class="lineno"></span><span class="op" id="7063106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7063109">func</span>&nbsp;<span class="ident" id="7063114">testLookups</span><span class="op" id="7063125">(</span><span class="ident" id="7063126">t</span>&nbsp;<span class="op" id="7063128">*</span><span class="ident" id="7063129">testing</span><span class="op" id="7063136">.</span><span class="ident" id="7063137">T</span><span class="op" id="7063138">,</span>&nbsp;<span class="ident" id="7063140">tc</span>&nbsp;<span class="op" id="7063143">*</span><span class="ident" id="7063144">testCase</span><span class="op" id="7063152">,</span>&nbsp;<span class="ident" id="7063154">x</span>&nbsp;<span class="op" id="7063156">*</span><span class="ident" id="7063157">Index</span><span class="op" id="7063162">,</span>&nbsp;<span class="ident" id="7063164">n</span>&nbsp;<span class="builtintype" id="7063166">int</span><span class="op" id="7063169">)</span>&nbsp;<span class="op" id="7063171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063174">for</span>&nbsp;<span class="ident" id="7063178">_</span><span class="op" id="7063179">,</span>&nbsp;<span class="ident" id="7063181">pat</span>&nbsp;<span class="op" id="7063185">:=</span>&nbsp;<span class="keyword" id="7063188">range</span>&nbsp;<span class="ident" id="7063194">tc</span><span class="op" id="7063196">.</span><span class="ident" id="7063197">patterns</span>&nbsp;<span class="op" id="7063206">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7063210">testLookup</span><span class="op" id="7063220">(</span><span class="ident" id="7063221">t</span><span class="op" id="7063222">,</span>&nbsp;<span class="ident" id="7063224">tc</span><span class="op" id="7063226">,</span>&nbsp;<span class="ident" id="7063228">x</span><span class="op" id="7063229">,</span>&nbsp;<span class="ident" id="7063231">pat</span><span class="op" id="7063234">,</span>&nbsp;<span class="ident" id="7063236">n</span><span class="op" id="7063237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063241">if</span>&nbsp;<span class="ident" id="7063244">rx</span><span class="op" id="7063246">,</span>&nbsp;<span class="ident" id="7063248">err</span>&nbsp;<span class="op" id="7063252">:=</span>&nbsp;<span class="ident" id="7063255">regexp</span><span class="op" id="7063261">.</span><span class="ident" id="7063262">Compile</span><span class="op" id="7063269">(</span><span class="ident" id="7063270">pat</span><span class="op" id="7063273">)</span><span class="op" id="7063274">;</span>&nbsp;<span class="ident" id="7063276">err</span>&nbsp;<span class="op" id="7063280">==</span>&nbsp;<span class="ident" id="7063283">nil</span>&nbsp;<span class="op" id="7063287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7063292">testFindAllIndex</span><span class="op" id="7063308">(</span><span class="ident" id="7063309">t</span><span class="op" id="7063310">,</span>&nbsp;<span class="ident" id="7063312">tc</span><span class="op" id="7063314">,</span>&nbsp;<span class="ident" id="7063316">x</span><span class="op" id="7063317">,</span>&nbsp;<span class="ident" id="7063319">rx</span><span class="op" id="7063321">,</span>&nbsp;<span class="ident" id="7063323">n</span><span class="op" id="7063324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063331">}</span><br>
<span class="lineno">205</span><span class="op" id="7063333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7063336">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="7063380">type</span>&nbsp;<span class="ident" id="7063385">index</span>&nbsp;<span class="ident" id="7063391">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="7063398">func</span>&nbsp;<span class="op" id="7063403">(</span><span class="ident" id="7063404">x</span>&nbsp;<span class="op" id="7063406">*</span><span class="ident" id="7063407">index</span><span class="op" id="7063412">)</span>&nbsp;<span class="ident" id="7063414">Len</span><span class="op" id="7063417">(</span><span class="op" id="7063418">)</span>&nbsp;<span class="builtintype" id="7063420">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063434">{</span>&nbsp;<span class="keyword" id="7063436">return</span>&nbsp;<span class="builtinfunc" id="7063443">len</span><span class="op" id="7063446">(</span><span class="ident" id="7063447">x</span><span class="op" id="7063448">.</span><span class="ident" id="7063449">sa</span><span class="op" id="7063451">)</span>&nbsp;<span class="op" id="7063453">}</span><br>
<span class="lineno"></span><span class="keyword" id="7063455">func</span>&nbsp;<span class="op" id="7063460">(</span><span class="ident" id="7063461">x</span>&nbsp;<span class="op" id="7063463">*</span><span class="ident" id="7063464">index</span><span class="op" id="7063469">)</span>&nbsp;<span class="ident" id="7063471">Less</span><span class="op" id="7063475">(</span><span class="ident" id="7063476">i</span><span class="op" id="7063477">,</span>&nbsp;<span class="ident" id="7063479">j</span>&nbsp;<span class="builtintype" id="7063481">int</span><span class="op" id="7063484">)</span>&nbsp;<span class="builtintype" id="7063486">bool</span>&nbsp;<span class="op" id="7063491">{</span>&nbsp;<span class="keyword" id="7063493">return</span>&nbsp;<span class="ident" id="7063500">bytes</span><span class="op" id="7063505">.</span><span class="ident" id="7063506">Compare</span><span class="op" id="7063513">(</span><span class="ident" id="7063514">x</span><span class="op" id="7063515">.</span><span class="ident" id="7063516">at</span><span class="op" id="7063518">(</span><span class="ident" id="7063519">i</span><span class="op" id="7063520">)</span><span class="op" id="7063521">,</span>&nbsp;<span class="ident" id="7063523">x</span><span class="op" id="7063524">.</span><span class="ident" id="7063525">at</span><span class="op" id="7063527">(</span><span class="ident" id="7063528">j</span><span class="op" id="7063529">)</span><span class="op" id="7063530">)</span>&nbsp;<span class="op" id="7063532">&lt;</span>&nbsp;<span class="num" id="7063534">0</span>&nbsp;<span class="op" id="7063536">}</span><br>
<span class="lineno"></span><span class="keyword" id="7063538">func</span>&nbsp;<span class="op" id="7063543">(</span><span class="ident" id="7063544">x</span>&nbsp;<span class="op" id="7063546">*</span><span class="ident" id="7063547">index</span><span class="op" id="7063552">)</span>&nbsp;<span class="ident" id="7063554">Swap</span><span class="op" id="7063558">(</span><span class="ident" id="7063559">i</span><span class="op" id="7063560">,</span>&nbsp;<span class="ident" id="7063562">j</span>&nbsp;<span class="builtintype" id="7063564">int</span><span class="op" id="7063567">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063574">{</span>&nbsp;<span class="ident" id="7063576">x</span><span class="op" id="7063577">.</span><span class="ident" id="7063578">sa</span><span class="op" id="7063580">[</span><span class="ident" id="7063581">i</span><span class="op" id="7063582">]</span><span class="op" id="7063583">,</span>&nbsp;<span class="ident" id="7063585">x</span><span class="op" id="7063586">.</span><span class="ident" id="7063587">sa</span><span class="op" id="7063589">[</span><span class="ident" id="7063590">j</span><span class="op" id="7063591">]</span>&nbsp;<span class="op" id="7063593">=</span>&nbsp;<span class="ident" id="7063595">x</span><span class="op" id="7063596">.</span><span class="ident" id="7063597">sa</span><span class="op" id="7063599">[</span><span class="ident" id="7063600">j</span><span class="op" id="7063601">]</span><span class="op" id="7063602">,</span>&nbsp;<span class="ident" id="7063604">x</span><span class="op" id="7063605">.</span><span class="ident" id="7063606">sa</span><span class="op" id="7063608">[</span><span class="ident" id="7063609">i</span><span class="op" id="7063610">]</span>&nbsp;<span class="op" id="7063612">}</span><br>
<span class="lineno"></span><span class="keyword" id="7063614">func</span>&nbsp;<span class="op" id="7063619">(</span><span class="ident" id="7063620">a</span>&nbsp;<span class="op" id="7063622">*</span><span class="ident" id="7063623">index</span><span class="op" id="7063628">)</span>&nbsp;<span class="ident" id="7063630">at</span><span class="op" id="7063632">(</span><span class="ident" id="7063633">i</span>&nbsp;<span class="builtintype" id="7063635">int</span><span class="op" id="7063638">)</span>&nbsp;<span class="op" id="7063640">[</span><span class="op" id="7063641">]</span><span class="builtintype" id="7063642">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7063650">{</span>&nbsp;<span class="keyword" id="7063652">return</span>&nbsp;<span class="ident" id="7063659">a</span><span class="op" id="7063660">.</span><span class="ident" id="7063661">data</span><span class="op" id="7063665">[</span><span class="ident" id="7063666">a</span><span class="op" id="7063667">.</span><span class="ident" id="7063668">sa</span><span class="op" id="7063670">[</span><span class="ident" id="7063671">i</span><span class="op" id="7063672">]</span><span class="op" id="7063673">:</span><span class="op" id="7063674">]</span>&nbsp;<span class="op" id="7063676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7063679">func</span>&nbsp;<span class="ident" id="7063684">testConstruction</span><span class="op" id="7063700">(</span><span class="ident" id="7063701">t</span>&nbsp;<span class="op" id="7063703">*</span><span class="ident" id="7063704">testing</span><span class="op" id="7063711">.</span><span class="ident" id="7063712">T</span><span class="op" id="7063713">,</span>&nbsp;<span class="ident" id="7063715">tc</span>&nbsp;<span class="op" id="7063718">*</span><span class="ident" id="7063719">testCase</span><span class="op" id="7063727">,</span>&nbsp;<span class="ident" id="7063729">x</span>&nbsp;<span class="op" id="7063731">*</span><span class="ident" id="7063732">Index</span><span class="op" id="7063737">)</span>&nbsp;<span class="op" id="7063739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063742">if</span>&nbsp;<span class="op" id="7063745">!</span><span class="ident" id="7063746">sort</span><span class="op" id="7063750">.</span><span class="ident" id="7063751">IsSorted</span><span class="op" id="7063759">(</span><span class="op" id="7063760">(</span><span class="op" id="7063761">*</span><span class="ident" id="7063762">index</span><span class="op" id="7063767">)</span><span class="op" id="7063768">(</span><span class="ident" id="7063769">x</span><span class="op" id="7063770">)</span><span class="op" id="7063771">)</span>&nbsp;<span class="op" id="7063773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7063777">t</span><span class="op" id="7063778">.</span><span class="ident" id="7063779">Errorf</span><span class="op" id="7063785">(</span><span class="string" id="7063786">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="7063814">,</span>&nbsp;<span class="ident" id="7063816">tc</span><span class="op" id="7063818">.</span><span class="ident" id="7063819">name</span><span class="op" id="7063823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063826">}</span><br>
<span class="lineno"></span><span class="op" id="7063828">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7063831">func</span>&nbsp;<span class="ident" id="7063836">equal</span><span class="op" id="7063841">(</span><span class="ident" id="7063842">x</span><span class="op" id="7063843">,</span>&nbsp;<span class="ident" id="7063845">y</span>&nbsp;<span class="op" id="7063847">*</span><span class="ident" id="7063848">Index</span><span class="op" id="7063853">)</span>&nbsp;<span class="builtintype" id="7063855">bool</span>&nbsp;<span class="op" id="7063860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063863">if</span>&nbsp;<span class="op" id="7063866">!</span><span class="ident" id="7063867">bytes</span><span class="op" id="7063872">.</span><span class="ident" id="7063873">Equal</span><span class="op" id="7063878">(</span><span class="ident" id="7063879">x</span><span class="op" id="7063880">.</span><span class="ident" id="7063881">data</span><span class="op" id="7063885">,</span>&nbsp;<span class="ident" id="7063887">y</span><span class="op" id="7063888">.</span><span class="ident" id="7063889">data</span><span class="op" id="7063893">)</span>&nbsp;<span class="op" id="7063895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063899">return</span>&nbsp;<span class="builtintype" id="7063906">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063913">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063916">for</span>&nbsp;<span class="ident" id="7063920">i</span><span class="op" id="7063921">,</span>&nbsp;<span class="ident" id="7063923">j</span>&nbsp;<span class="op" id="7063925">:=</span>&nbsp;<span class="keyword" id="7063928">range</span>&nbsp;<span class="ident" id="7063934">x</span><span class="op" id="7063935">.</span><span class="ident" id="7063936">sa</span>&nbsp;<span class="op" id="7063939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063943">if</span>&nbsp;<span class="ident" id="7063946">j</span>&nbsp;<span class="op" id="7063948">!=</span>&nbsp;<span class="ident" id="7063951">y</span><span class="op" id="7063952">.</span><span class="ident" id="7063953">sa</span><span class="op" id="7063955">[</span><span class="ident" id="7063956">i</span><span class="op" id="7063957">]</span>&nbsp;<span class="op" id="7063959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063964">return</span>&nbsp;<span class="builtintype" id="7063971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7063982">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7063985">return</span>&nbsp;<span class="builtintype" id="7063992">true</span><br>
<span class="lineno"></span><span class="op" id="7063997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7064000">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="7064037">func</span>&nbsp;<span class="ident" id="7064042">testSaveRestore</span><span class="op" id="7064057">(</span><span class="ident" id="7064058">t</span>&nbsp;<span class="op" id="7064060">*</span><span class="ident" id="7064061">testing</span><span class="op" id="7064068">.</span><span class="ident" id="7064069">T</span><span class="op" id="7064070">,</span>&nbsp;<span class="ident" id="7064072">tc</span>&nbsp;<span class="op" id="7064075">*</span><span class="ident" id="7064076">testCase</span><span class="op" id="7064084">,</span>&nbsp;<span class="ident" id="7064086">x</span>&nbsp;<span class="op" id="7064088">*</span><span class="ident" id="7064089">Index</span><span class="op" id="7064094">)</span>&nbsp;<span class="builtintype" id="7064096">int</span>&nbsp;<span class="op" id="7064100">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064103">var</span>&nbsp;<span class="ident" id="7064107">buf</span>&nbsp;<span class="ident" id="7064111">bytes</span><span class="op" id="7064116">.</span><span class="ident" id="7064117">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064125">if</span>&nbsp;<span class="ident" id="7064128">err</span>&nbsp;<span class="op" id="7064132">:=</span>&nbsp;<span class="ident" id="7064135">x</span><span class="op" id="7064136">.</span><span class="ident" id="7064137">Write</span><span class="op" id="7064142">(</span><span class="op" id="7064143">&amp;</span><span class="ident" id="7064144">buf</span><span class="op" id="7064147">)</span><span class="op" id="7064148">;</span>&nbsp;<span class="ident" id="7064150">err</span>&nbsp;<span class="op" id="7064154">!=</span>&nbsp;<span class="ident" id="7064157">nil</span>&nbsp;<span class="op" id="7064161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064165">t</span><span class="op" id="7064166">.</span><span class="ident" id="7064167">Errorf</span><span class="op" id="7064173">(</span><span class="string" id="7064174">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="7064204">,</span>&nbsp;<span class="ident" id="7064206">tc</span><span class="op" id="7064208">.</span><span class="ident" id="7064209">name</span><span class="op" id="7064213">,</span>&nbsp;<span class="ident" id="7064215">err</span><span class="op" id="7064218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7064221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064224">size</span>&nbsp;<span class="op" id="7064229">:=</span>&nbsp;<span class="ident" id="7064232">buf</span><span class="op" id="7064235">.</span><span class="ident" id="7064236">Len</span><span class="op" id="7064239">(</span><span class="op" id="7064240">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064243">var</span>&nbsp;<span class="ident" id="7064247">y</span>&nbsp;<span class="ident" id="7064249">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064256">if</span>&nbsp;<span class="ident" id="7064259">err</span>&nbsp;<span class="op" id="7064263">:=</span>&nbsp;<span class="ident" id="7064266">y</span><span class="op" id="7064267">.</span><span class="ident" id="7064268">Read</span><span class="op" id="7064272">(</span><span class="op" id="7064273">&amp;</span><span class="ident" id="7064274">buf</span><span class="op" id="7064277">)</span><span class="op" id="7064278">;</span>&nbsp;<span class="ident" id="7064280">err</span>&nbsp;<span class="op" id="7064284">!=</span>&nbsp;<span class="ident" id="7064287">nil</span>&nbsp;<span class="op" id="7064291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064295">t</span><span class="op" id="7064296">.</span><span class="ident" id="7064297">Errorf</span><span class="op" id="7064303">(</span><span class="string" id="7064304">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="7064334">,</span>&nbsp;<span class="ident" id="7064336">tc</span><span class="op" id="7064338">.</span><span class="ident" id="7064339">name</span><span class="op" id="7064343">,</span>&nbsp;<span class="ident" id="7064345">err</span><span class="op" id="7064348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7064351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064354">if</span>&nbsp;<span class="op" id="7064357">!</span><span class="ident" id="7064358">equal</span><span class="op" id="7064363">(</span><span class="ident" id="7064364">x</span><span class="op" id="7064365">,</span>&nbsp;<span class="op" id="7064367">&amp;</span><span class="ident" id="7064368">y</span><span class="op" id="7064369">)</span>&nbsp;<span class="op" id="7064371">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064375">t</span><span class="op" id="7064376">.</span><span class="ident" id="7064377">Errorf</span><span class="op" id="7064383">(</span><span class="string" id="7064384">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="7064429">,</span>&nbsp;<span class="ident" id="7064431">tc</span><span class="op" id="7064433">.</span><span class="ident" id="7064434">name</span><span class="op" id="7064438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7064441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064444">return</span>&nbsp;<span class="ident" id="7064451">size</span><br>
<span class="lineno"></span><span class="op" id="7064456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7064459">func</span>&nbsp;<span class="ident" id="7064464">TestIndex</span><span class="op" id="7064473">(</span><span class="ident" id="7064474">t</span>&nbsp;<span class="op" id="7064476">*</span><span class="ident" id="7064477">testing</span><span class="op" id="7064484">.</span><span class="ident" id="7064485">T</span><span class="op" id="7064486">)</span>&nbsp;<span class="op" id="7064488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7064491">for</span>&nbsp;<span class="ident" id="7064495">_</span><span class="op" id="7064496">,</span>&nbsp;<span class="ident" id="7064498">tc</span>&nbsp;<span class="op" id="7064501">:=</span>&nbsp;<span class="keyword" id="7064504">range</span>&nbsp;<span class="ident" id="7064510">testCases</span>&nbsp;<span class="op" id="7064520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064524">x</span>&nbsp;<span class="op" id="7064526">:=</span>&nbsp;<span class="ident" id="7064529">New</span><span class="op" id="7064532">(</span><span class="op" id="7064533">[</span><span class="op" id="7064534">]</span><span class="builtintype" id="7064535">byte</span><span class="op" id="7064539">(</span><span class="ident" id="7064540">tc</span><span class="op" id="7064542">.</span><span class="ident" id="7064543">source</span><span class="op" id="7064549">)</span><span class="op" id="7064550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064554">testConstruction</span><span class="op" id="7064570">(</span><span class="ident" id="7064571">t</span><span class="op" id="7064572">,</span>&nbsp;<span class="op" id="7064574">&amp;</span><span class="ident" id="7064575">tc</span><span class="op" id="7064577">,</span>&nbsp;<span class="ident" id="7064579">x</span><span class="op" id="7064580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064584">testSaveRestore</span><span class="op" id="7064599">(</span><span class="ident" id="7064600">t</span><span class="op" id="7064601">,</span>&nbsp;<span class="op" id="7064603">&amp;</span><span class="ident" id="7064604">tc</span><span class="op" id="7064606">,</span>&nbsp;<span class="ident" id="7064608">x</span><span class="op" id="7064609">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064613">testLookups</span><span class="op" id="7064624">(</span><span class="ident" id="7064625">t</span><span class="op" id="7064626">,</span>&nbsp;<span class="op" id="7064628">&amp;</span><span class="ident" id="7064629">tc</span><span class="op" id="7064631">,</span>&nbsp;<span class="ident" id="7064633">x</span><span class="op" id="7064634">,</span>&nbsp;<span class="num" id="7064636">0</span><span class="op" id="7064637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064641">testLookups</span><span class="op" id="7064652">(</span><span class="ident" id="7064653">t</span><span class="op" id="7064654">,</span>&nbsp;<span class="op" id="7064656">&amp;</span><span class="ident" id="7064657">tc</span><span class="op" id="7064659">,</span>&nbsp;<span class="ident" id="7064661">x</span><span class="op" id="7064662">,</span>&nbsp;<span class="num" id="7064664">1</span><span class="op" id="7064665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064669">testLookups</span><span class="op" id="7064680">(</span><span class="ident" id="7064681">t</span><span class="op" id="7064682">,</span>&nbsp;<span class="op" id="7064684">&amp;</span><span class="ident" id="7064685">tc</span><span class="op" id="7064687">,</span>&nbsp;<span class="ident" id="7064689">x</span><span class="op" id="7064690">,</span>&nbsp;<span class="num" id="7064692">10</span><span class="op" id="7064694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064698">testLookups</span><span class="op" id="7064709">(</span><span class="ident" id="7064710">t</span><span class="op" id="7064711">,</span>&nbsp;<span class="op" id="7064713">&amp;</span><span class="ident" id="7064714">tc</span><span class="op" id="7064716">,</span>&nbsp;<span class="ident" id="7064718">x</span><span class="op" id="7064719">,</span>&nbsp;<span class="num" id="7064721">2e9</span><span class="op" id="7064724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7064728">testLookups</span><span class="op" id="7064739">(</span><span class="ident" id="7064740">t</span><span class="op" id="7064741">,</span>&nbsp;<span class="op" id="7064743">&amp;</span><span class="ident" id="7064744">tc</span><span class="op" id="7064746">,</span>&nbsp;<span class="ident" id="7064748">x</span><span class="op" id="7064749">,</span>&nbsp;<span class="op" id="7064751">-</span><span class="num" id="7064752">1</span><span class="op" id="7064753">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7064756">}</span><br>
<span class="lineno"></span><span class="op" id="7064758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7064761">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="7064840">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="7064914">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="7064976">func</span>&nbsp;<span class="ident" id="7064981">benchmarkNew</span><span class="op" id="7064993">(</span><span class="ident" id="7064994">b</span>&nbsp;<span class="op" id="7064996">*</span><span class="ident" id="7064997">testing</span><span class="op" id="7065004">.</span><span class="ident" id="7065005">B</span><span class="op" id="7065006">,</span>&nbsp;<span class="ident" id="7065008">random</span>&nbsp;<span class="builtintype" id="7065015">bool</span><span class="op" id="7065019">)</span>&nbsp;<span class="op" id="7065021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065024">b</span><span class="op" id="7065025">.</span><span class="ident" id="7065026">StopTimer</span><span class="op" id="7065035">(</span><span class="op" id="7065036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065039">data</span>&nbsp;<span class="op" id="7065044">:=</span>&nbsp;<span class="builtinfunc" id="7065047">make</span><span class="op" id="7065051">(</span><span class="op" id="7065052">[</span><span class="op" id="7065053">]</span><span class="builtintype" id="7065054">byte</span><span class="op" id="7065058">,</span>&nbsp;<span class="num" id="7065060">1e6</span><span class="op" id="7065063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065066">if</span>&nbsp;<span class="ident" id="7065069">random</span>&nbsp;<span class="op" id="7065076">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065080">for</span>&nbsp;<span class="ident" id="7065084">i</span>&nbsp;<span class="op" id="7065086">:=</span>&nbsp;<span class="keyword" id="7065089">range</span>&nbsp;<span class="ident" id="7065095">data</span>&nbsp;<span class="op" id="7065100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065105">data</span><span class="op" id="7065109">[</span><span class="ident" id="7065110">i</span><span class="op" id="7065111">]</span>&nbsp;<span class="op" id="7065113">=</span>&nbsp;<span class="builtintype" id="7065115">byte</span><span class="op" id="7065119">(</span><span class="ident" id="7065120">rand</span><span class="op" id="7065124">.</span><span class="ident" id="7065125">Intn</span><span class="op" id="7065129">(</span><span class="num" id="7065130">256</span><span class="op" id="7065133">)</span><span class="op" id="7065134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7065138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7065141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065144">b</span><span class="op" id="7065145">.</span><span class="ident" id="7065146">StartTimer</span><span class="op" id="7065156">(</span><span class="op" id="7065157">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065160">for</span>&nbsp;<span class="ident" id="7065164">i</span>&nbsp;<span class="op" id="7065166">:=</span>&nbsp;<span class="num" id="7065169">0</span><span class="op" id="7065170">;</span>&nbsp;<span class="ident" id="7065172">i</span>&nbsp;<span class="op" id="7065174">&lt;</span>&nbsp;<span class="ident" id="7065176">b</span><span class="op" id="7065177">.</span><span class="ident" id="7065178">N</span><span class="op" id="7065179">;</span>&nbsp;<span class="ident" id="7065181">i</span><span class="op" id="7065182">++</span>&nbsp;<span class="op" id="7065185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065189">New</span><span class="op" id="7065192">(</span><span class="ident" id="7065193">data</span><span class="op" id="7065197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7065200">}</span><br>
<span class="lineno"></span><span class="op" id="7065202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7065205">func</span>&nbsp;<span class="ident" id="7065210">BenchmarkNewIndexRandom</span><span class="op" id="7065233">(</span><span class="ident" id="7065234">b</span>&nbsp;<span class="op" id="7065236">*</span><span class="ident" id="7065237">testing</span><span class="op" id="7065244">.</span><span class="ident" id="7065245">B</span><span class="op" id="7065246">)</span>&nbsp;<span class="op" id="7065248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065251">benchmarkNew</span><span class="op" id="7065263">(</span><span class="ident" id="7065264">b</span><span class="op" id="7065265">,</span>&nbsp;<span class="builtintype" id="7065267">true</span><span class="op" id="7065271">)</span><br>
<span class="lineno"></span><span class="op" id="7065273">}</span><br>
<span class="lineno"></span><span class="keyword" id="7065275">func</span>&nbsp;<span class="ident" id="7065280">BenchmarkNewIndexRepeat</span><span class="op" id="7065303">(</span><span class="ident" id="7065304">b</span>&nbsp;<span class="op" id="7065306">*</span><span class="ident" id="7065307">testing</span><span class="op" id="7065314">.</span><span class="ident" id="7065315">B</span><span class="op" id="7065316">)</span>&nbsp;<span class="op" id="7065318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065321">benchmarkNew</span><span class="op" id="7065333">(</span><span class="ident" id="7065334">b</span><span class="op" id="7065335">,</span>&nbsp;<span class="builtintype" id="7065337">false</span><span class="op" id="7065342">)</span><br>
<span class="lineno">285</span><span class="op" id="7065344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7065347">func</span>&nbsp;<span class="ident" id="7065352">BenchmarkSaveRestore</span><span class="op" id="7065372">(</span><span class="ident" id="7065373">b</span>&nbsp;<span class="op" id="7065375">*</span><span class="ident" id="7065376">testing</span><span class="op" id="7065383">.</span><span class="ident" id="7065384">B</span><span class="op" id="7065385">)</span>&nbsp;<span class="op" id="7065387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065390">b</span><span class="op" id="7065391">.</span><span class="ident" id="7065392">StopTimer</span><span class="op" id="7065401">(</span><span class="op" id="7065402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065405">r</span>&nbsp;<span class="op" id="7065407">:=</span>&nbsp;<span class="ident" id="7065410">rand</span><span class="op" id="7065414">.</span><span class="ident" id="7065415">New</span><span class="op" id="7065418">(</span><span class="ident" id="7065419">rand</span><span class="op" id="7065423">.</span><span class="ident" id="7065424">NewSource</span><span class="op" id="7065433">(</span><span class="num" id="7065434">0x5a77a1</span><span class="op" id="7065442">)</span><span class="op" id="7065443">)</span>&nbsp;<span class="comment" id="7065445">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065480">data</span>&nbsp;<span class="op" id="7065485">:=</span>&nbsp;<span class="builtinfunc" id="7065488">make</span><span class="op" id="7065492">(</span><span class="op" id="7065493">[</span><span class="op" id="7065494">]</span><span class="builtintype" id="7065495">byte</span><span class="op" id="7065499">,</span>&nbsp;<span class="num" id="7065501">1</span><span class="op" id="7065502">&lt;&lt;</span><span class="num" id="7065504">20</span><span class="op" id="7065506">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7065520">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065545">for</span>&nbsp;<span class="ident" id="7065549">i</span>&nbsp;<span class="op" id="7065551">:=</span>&nbsp;<span class="keyword" id="7065554">range</span>&nbsp;<span class="ident" id="7065560">data</span>&nbsp;<span class="op" id="7065565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065569">data</span><span class="op" id="7065573">[</span><span class="ident" id="7065574">i</span><span class="op" id="7065575">]</span>&nbsp;<span class="op" id="7065577">=</span>&nbsp;<span class="builtintype" id="7065579">byte</span><span class="op" id="7065583">(</span><span class="ident" id="7065584">r</span><span class="op" id="7065585">.</span><span class="ident" id="7065586">Intn</span><span class="op" id="7065590">(</span><span class="num" id="7065591">256</span><span class="op" id="7065594">)</span><span class="op" id="7065595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7065598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065601">x</span>&nbsp;<span class="op" id="7065603">:=</span>&nbsp;<span class="ident" id="7065606">New</span><span class="op" id="7065609">(</span><span class="ident" id="7065610">data</span><span class="op" id="7065614">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065617">size</span>&nbsp;<span class="op" id="7065622">:=</span>&nbsp;<span class="ident" id="7065625">testSaveRestore</span><span class="op" id="7065640">(</span><span class="ident" id="7065641">nil</span><span class="op" id="7065644">,</span>&nbsp;<span class="ident" id="7065646">nil</span><span class="op" id="7065649">,</span>&nbsp;<span class="ident" id="7065651">x</span><span class="op" id="7065652">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7065660">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065683">buf</span>&nbsp;<span class="op" id="7065687">:=</span>&nbsp;<span class="ident" id="7065690">bytes</span><span class="op" id="7065695">.</span><span class="ident" id="7065696">NewBuffer</span><span class="op" id="7065705">(</span><span class="builtinfunc" id="7065706">make</span><span class="op" id="7065710">(</span><span class="op" id="7065711">[</span><span class="op" id="7065712">]</span><span class="builtintype" id="7065713">byte</span><span class="op" id="7065717">,</span>&nbsp;<span class="ident" id="7065719">size</span><span class="op" id="7065723">)</span><span class="op" id="7065724">)</span>&nbsp;<span class="comment" id="7065726">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065744">b</span><span class="op" id="7065745">.</span><span class="ident" id="7065746">SetBytes</span><span class="op" id="7065754">(</span><span class="ident" id="7065755">int64</span><span class="op" id="7065760">(</span><span class="ident" id="7065761">size</span><span class="op" id="7065765">)</span><span class="op" id="7065766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065769">b</span><span class="op" id="7065770">.</span><span class="ident" id="7065771">StartTimer</span><span class="op" id="7065781">(</span><span class="op" id="7065782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065785">for</span>&nbsp;<span class="ident" id="7065789">i</span>&nbsp;<span class="op" id="7065791">:=</span>&nbsp;<span class="num" id="7065794">0</span><span class="op" id="7065795">;</span>&nbsp;<span class="ident" id="7065797">i</span>&nbsp;<span class="op" id="7065799">&lt;</span>&nbsp;<span class="ident" id="7065801">b</span><span class="op" id="7065802">.</span><span class="ident" id="7065803">N</span><span class="op" id="7065804">;</span>&nbsp;<span class="ident" id="7065806">i</span><span class="op" id="7065807">++</span>&nbsp;<span class="op" id="7065810">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065814">x</span><span class="op" id="7065815">.</span><span class="ident" id="7065816">Write</span><span class="op" id="7065821">(</span><span class="ident" id="7065822">buf</span><span class="op" id="7065825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7065829">var</span>&nbsp;<span class="ident" id="7065833">y</span>&nbsp;<span class="ident" id="7065835">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7065843">y</span><span class="op" id="7065844">.</span><span class="ident" id="7065845">Read</span><span class="op" id="7065849">(</span><span class="ident" id="7065850">buf</span><span class="op" id="7065853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7065856">}</span><br>
<span class="lineno"></span><span class="op" id="7065858">}</span>
</div>
</body>
</html>
