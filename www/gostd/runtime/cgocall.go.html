<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html" class="current">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1441168">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1441224">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1441278">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1441329">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1441363">//</span><br>
<span class="lineno"></span><span class="comment" id="1441366">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1441437">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1441502">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1441543">//</span><br>
<span class="lineno"></span><span class="comment" id="1441546">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1441606">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1441671">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1441730">//</span><br>
<span class="lineno">15</span><span class="comment" id="1441733">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1441802">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1441872">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1441928">//</span><br>
<span class="lineno"></span><span class="comment" id="1441931">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1441994">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1442063">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1442101">//</span><br>
<span class="lineno"></span><span class="comment" id="1442104">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1442173">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1442237">//</span><br>
<span class="lineno"></span><span class="comment" id="1442240">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1442317">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1442390">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1442420">//</span><br>
<span class="lineno">30</span><span class="comment" id="1442423">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1442497">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1442568">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1442614">//</span><br>
<span class="lineno"></span><span class="comment" id="1442617">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1442693">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1442771">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1442838">//</span><br>
<span class="lineno"></span><span class="comment" id="1442841">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1442909">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1442983">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1443054">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1443124">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1443189">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1443255">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1443326">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1443361">//</span><br>
<span class="lineno"></span><span class="comment" id="1443364">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1443431">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1443501">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1443575">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1443633">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1443668">//</span><br>
<span class="lineno"></span><span class="comment" id="1443671">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1443735">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1443799">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1443849">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1443919">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1443989">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1444064">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1444134">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1444184">//</span><br>
<span class="lineno"></span><span class="comment" id="1444187">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1444254">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1444333">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1444401">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1444480">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1444557">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1444627">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1444704">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1444759">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1444834">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1444911">//</span><br>
<span class="lineno"></span><span class="comment" id="1444914">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1444980">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1445056">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1445124">//</span><br>
<span class="lineno"></span><span class="comment" id="1445127">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1445196">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1445270">package</span>&nbsp;<span class="ident" id="1445278">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1445287">import</span>&nbsp;<span class="string" id="1445294">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1445304">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1445326">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1445339">func</span>&nbsp;<span class="ident" id="1445344">cgocall</span><span class="op" id="1445351">(</span><span class="ident" id="1445352">fn</span><span class="op" id="1445354">,</span>&nbsp;<span class="ident" id="1445356">arg</span>&nbsp;<span class="ident" id="1445360">unsafe</span><span class="op" id="1445366">.</span><span class="ident" id="1445367">Pointer</span><span class="op" id="1445374">)</span>&nbsp;<span class="op" id="1445376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445379">cgocall_errno</span><span class="op" id="1445392">(</span><span class="ident" id="1445393">fn</span><span class="op" id="1445395">,</span>&nbsp;<span class="ident" id="1445397">arg</span><span class="op" id="1445400">)</span><br>
<span class="lineno"></span><span class="op" id="1445402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1445405">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1445418">func</span>&nbsp;<span class="ident" id="1445423">cgocall_errno</span><span class="op" id="1445436">(</span><span class="ident" id="1445437">fn</span><span class="op" id="1445439">,</span>&nbsp;<span class="ident" id="1445441">arg</span>&nbsp;<span class="ident" id="1445445">unsafe</span><span class="op" id="1445451">.</span><span class="ident" id="1445452">Pointer</span><span class="op" id="1445459">)</span>&nbsp;<span class="builtintype" id="1445461">int32</span>&nbsp;<span class="op" id="1445467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1445470">if</span>&nbsp;<span class="op" id="1445473">!</span><span class="ident" id="1445474">iscgo</span>&nbsp;<span class="op" id="1445480">&amp;&amp;</span>&nbsp;<span class="ident" id="1445483">GOOS</span>&nbsp;<span class="op" id="1445488">!=</span>&nbsp;<span class="string" id="1445491">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1445501">&amp;&amp;</span>&nbsp;<span class="ident" id="1445504">GOOS</span>&nbsp;<span class="op" id="1445509">!=</span>&nbsp;<span class="string" id="1445512">&#34;windows&#34;</span>&nbsp;<span class="op" id="1445522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445526">gothrow</span><span class="op" id="1445533">(</span><span class="string" id="1445534">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1445555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1445558">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1445562">if</span>&nbsp;<span class="ident" id="1445565">fn</span>&nbsp;<span class="op" id="1445568">==</span>&nbsp;<span class="builtintype" id="1445571">nil</span>&nbsp;<span class="op" id="1445575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445579">gothrow</span><span class="op" id="1445586">(</span><span class="string" id="1445587">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1445600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1445603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1445607">if</span>&nbsp;<span class="ident" id="1445610">raceenabled</span>&nbsp;<span class="op" id="1445622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445626">racereleasemerge</span><span class="op" id="1445642">(</span><span class="ident" id="1445643">unsafe</span><span class="op" id="1445649">.</span><span class="ident" id="1445650">Pointer</span><span class="op" id="1445657">(</span><span class="op" id="1445658">&amp;</span><span class="ident" id="1445659">racecgosync</span><span class="op" id="1445670">)</span><span class="op" id="1445671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1445674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1445678">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1445762">if</span>&nbsp;<span class="ident" id="1445765">needextram</span>&nbsp;<span class="op" id="1445776">==</span>&nbsp;<span class="num" id="1445779">1</span>&nbsp;<span class="op" id="1445781">&amp;&amp;</span>&nbsp;<span class="ident" id="1445784">cas</span><span class="op" id="1445787">(</span><span class="op" id="1445788">&amp;</span><span class="ident" id="1445789">needextram</span><span class="op" id="1445799">,</span>&nbsp;<span class="num" id="1445801">1</span><span class="op" id="1445802">,</span>&nbsp;<span class="num" id="1445804">0</span><span class="op" id="1445805">)</span>&nbsp;<span class="op" id="1445807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445811">onM</span><span class="op" id="1445814">(</span><span class="ident" id="1445815">newextram</span><span class="op" id="1445824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1445827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1445831">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445964">lockOSThread</span><span class="op" id="1445976">(</span><span class="op" id="1445977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445980">mp</span>&nbsp;<span class="op" id="1445983">:=</span>&nbsp;<span class="ident" id="1445986">getg</span><span class="op" id="1445990">(</span><span class="op" id="1445991">)</span><span class="op" id="1445992">.</span><span class="ident" id="1445993">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1445996">mp</span><span class="op" id="1445998">.</span><span class="ident" id="1445999">ncgocall</span><span class="op" id="1446007">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446011">mp</span><span class="op" id="1446013">.</span><span class="ident" id="1446014">ncgo</span><span class="op" id="1446018">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1446022">defer</span>&nbsp;<span class="ident" id="1446028">endcgo</span><span class="op" id="1446034">(</span><span class="ident" id="1446035">mp</span><span class="op" id="1446037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1446041">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446399">entersyscall</span><span class="op" id="1446411">(</span><span class="op" id="1446412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446415">errno</span>&nbsp;<span class="op" id="1446421">:=</span>&nbsp;<span class="ident" id="1446424">asmcgocall_errno</span><span class="op" id="1446440">(</span><span class="ident" id="1446441">fn</span><span class="op" id="1446443">,</span>&nbsp;<span class="ident" id="1446445">arg</span><span class="op" id="1446448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446451">exitsyscall</span><span class="op" id="1446462">(</span><span class="op" id="1446463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1446467">return</span>&nbsp;<span class="ident" id="1446474">errno</span><br>
<span class="lineno">135</span><span class="op" id="1446480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1446483">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1446496">func</span>&nbsp;<span class="ident" id="1446501">endcgo</span><span class="op" id="1446507">(</span><span class="ident" id="1446508">mp</span>&nbsp;<span class="op" id="1446511">*</span><span class="ident" id="1446512">m</span><span class="op" id="1446513">)</span>&nbsp;<span class="op" id="1446515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446518">mp</span><span class="op" id="1446520">.</span><span class="ident" id="1446521">ncgo</span><span class="op" id="1446525">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1446529">if</span>&nbsp;<span class="ident" id="1446532">mp</span><span class="op" id="1446534">.</span><span class="ident" id="1446535">ncgo</span>&nbsp;<span class="op" id="1446540">==</span>&nbsp;<span class="num" id="1446543">0</span>&nbsp;<span class="op" id="1446545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1446549">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1446605">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1446661">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446710">mp</span><span class="op" id="1446712">.</span><span class="ident" id="1446713">cgomal</span>&nbsp;<span class="op" id="1446720">=</span>&nbsp;<span class="builtintype" id="1446722">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1446727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1446731">if</span>&nbsp;<span class="ident" id="1446734">raceenabled</span>&nbsp;<span class="op" id="1446746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446750">raceacquire</span><span class="op" id="1446761">(</span><span class="ident" id="1446762">unsafe</span><span class="op" id="1446768">.</span><span class="ident" id="1446769">Pointer</span><span class="op" id="1446776">(</span><span class="op" id="1446777">&amp;</span><span class="ident" id="1446778">racecgosync</span><span class="op" id="1446789">)</span><span class="op" id="1446790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1446793">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1446797">unlockOSThread</span><span class="op" id="1446811">(</span><span class="op" id="1446812">)</span>&nbsp;<span class="comment" id="1446814">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1446832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1446835">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1446870">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1446925">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1446997">var</span>&nbsp;<span class="ident" id="1447001">cgoMalloc</span><span class="op" id="1447010">,</span>&nbsp;<span class="ident" id="1447012">cgoFree</span>&nbsp;<span class="ident" id="1447020">unsafe</span><span class="op" id="1447026">.</span><span class="ident" id="1447027">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1447036">func</span>&nbsp;<span class="ident" id="1447041">cmalloc</span><span class="op" id="1447048">(</span><span class="ident" id="1447049">n</span>&nbsp;<span class="builtintype" id="1447051">uintptr</span><span class="op" id="1447058">)</span>&nbsp;<span class="ident" id="1447060">unsafe</span><span class="op" id="1447066">.</span><span class="ident" id="1447067">Pointer</span>&nbsp;<span class="op" id="1447075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1447078">var</span>&nbsp;<span class="ident" id="1447082">args</span>&nbsp;<span class="keyword" id="1447087">struct</span>&nbsp;<span class="op" id="1447094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447098">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1447102">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447111">ret</span>&nbsp;<span class="ident" id="1447115">unsafe</span><span class="op" id="1447121">.</span><span class="ident" id="1447122">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1447131">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447134">args</span><span class="op" id="1447138">.</span><span class="ident" id="1447139">n</span>&nbsp;<span class="op" id="1447141">=</span>&nbsp;<span class="ident" id="1447143">uint64</span><span class="op" id="1447149">(</span><span class="ident" id="1447150">n</span><span class="op" id="1447151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447154">cgocall</span><span class="op" id="1447161">(</span><span class="ident" id="1447162">cgoMalloc</span><span class="op" id="1447171">,</span>&nbsp;<span class="ident" id="1447173">unsafe</span><span class="op" id="1447179">.</span><span class="ident" id="1447180">Pointer</span><span class="op" id="1447187">(</span><span class="op" id="1447188">&amp;</span><span class="ident" id="1447189">args</span><span class="op" id="1447193">)</span><span class="op" id="1447194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1447197">if</span>&nbsp;<span class="ident" id="1447200">args</span><span class="op" id="1447204">.</span><span class="ident" id="1447205">ret</span>&nbsp;<span class="op" id="1447209">==</span>&nbsp;<span class="builtintype" id="1447212">nil</span>&nbsp;<span class="op" id="1447216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447220">gothrow</span><span class="op" id="1447227">(</span><span class="string" id="1447228">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1447245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1447248">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1447251">return</span>&nbsp;<span class="ident" id="1447258">args</span><span class="op" id="1447262">.</span><span class="ident" id="1447263">ret</span><br>
<span class="lineno"></span><span class="op" id="1447267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1447270">func</span>&nbsp;<span class="ident" id="1447275">cfree</span><span class="op" id="1447280">(</span><span class="ident" id="1447281">p</span>&nbsp;<span class="ident" id="1447283">unsafe</span><span class="op" id="1447289">.</span><span class="ident" id="1447290">Pointer</span><span class="op" id="1447297">)</span>&nbsp;<span class="op" id="1447299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447302">cgocall</span><span class="op" id="1447309">(</span><span class="ident" id="1447310">cgoFree</span><span class="op" id="1447317">,</span>&nbsp;<span class="ident" id="1447319">p</span><span class="op" id="1447320">)</span><br>
<span class="lineno">175</span><span class="op" id="1447322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1447325">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1447352">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1447365">func</span>&nbsp;<span class="ident" id="1447370">cgocallbackg</span><span class="op" id="1447382">(</span><span class="op" id="1447383">)</span>&nbsp;<span class="op" id="1447385">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447388">gp</span>&nbsp;<span class="op" id="1447391">:=</span>&nbsp;<span class="ident" id="1447394">getg</span><span class="op" id="1447398">(</span><span class="op" id="1447399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1447402">if</span>&nbsp;<span class="ident" id="1447405">gp</span>&nbsp;<span class="op" id="1447408">!=</span>&nbsp;<span class="ident" id="1447411">gp</span><span class="op" id="1447413">.</span><span class="ident" id="1447414">m</span><span class="op" id="1447415">.</span><span class="ident" id="1447416">curg</span>&nbsp;<span class="op" id="1447421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1447425">println</span><span class="op" id="1447432">(</span><span class="string" id="1447433">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1447464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447468">exit</span><span class="op" id="1447472">(</span><span class="num" id="1447473">2</span><span class="op" id="1447474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1447477">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1447481">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1447552">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1447624">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1447695">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447750">savedsp</span>&nbsp;<span class="op" id="1447758">:=</span>&nbsp;<span class="ident" id="1447761">unsafe</span><span class="op" id="1447767">.</span><span class="ident" id="1447768">Pointer</span><span class="op" id="1447775">(</span><span class="ident" id="1447776">gp</span><span class="op" id="1447778">.</span><span class="ident" id="1447779">syscallsp</span><span class="op" id="1447788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447791">savedpc</span>&nbsp;<span class="op" id="1447799">:=</span>&nbsp;<span class="ident" id="1447802">gp</span><span class="op" id="1447804">.</span><span class="ident" id="1447805">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447816">exitsyscall</span><span class="op" id="1447827">(</span><span class="op" id="1447828">)</span>&nbsp;<span class="comment" id="1447830">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447857">cgocallbackg1</span><span class="op" id="1447870">(</span><span class="op" id="1447871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1447874">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447901">reentersyscall</span><span class="op" id="1447915">(</span><span class="ident" id="1447916">savedpc</span><span class="op" id="1447923">,</span>&nbsp;<span class="ident" id="1447925">savedsp</span><span class="op" id="1447932">)</span><br>
<span class="lineno"></span><span class="op" id="1447934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1447937">func</span>&nbsp;<span class="ident" id="1447942">cgocallbackg1</span><span class="op" id="1447955">(</span><span class="op" id="1447956">)</span>&nbsp;<span class="op" id="1447958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447961">gp</span>&nbsp;<span class="op" id="1447964">:=</span>&nbsp;<span class="ident" id="1447967">getg</span><span class="op" id="1447971">(</span><span class="op" id="1447972">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1447975">if</span>&nbsp;<span class="ident" id="1447978">gp</span><span class="op" id="1447980">.</span><span class="ident" id="1447981">m</span><span class="op" id="1447982">.</span><span class="ident" id="1447983">needextram</span>&nbsp;<span class="op" id="1447994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1447998">gp</span><span class="op" id="1448000">.</span><span class="ident" id="1448001">m</span><span class="op" id="1448002">.</span><span class="ident" id="1448003">needextram</span>&nbsp;<span class="op" id="1448014">=</span>&nbsp;<span class="builtintype" id="1448016">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448024">onM</span><span class="op" id="1448027">(</span><span class="ident" id="1448028">newextram</span><span class="op" id="1448037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1448040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448044">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448091">restore</span>&nbsp;<span class="op" id="1448099">:=</span>&nbsp;<span class="builtintype" id="1448102">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448108">defer</span>&nbsp;<span class="ident" id="1448114">unwindm</span><span class="op" id="1448121">(</span><span class="op" id="1448122">&amp;</span><span class="ident" id="1448123">restore</span><span class="op" id="1448130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448134">if</span>&nbsp;<span class="ident" id="1448137">raceenabled</span>&nbsp;<span class="op" id="1448149">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448153">raceacquire</span><span class="op" id="1448164">(</span><span class="ident" id="1448165">unsafe</span><span class="op" id="1448171">.</span><span class="ident" id="1448172">Pointer</span><span class="op" id="1448179">(</span><span class="op" id="1448180">&amp;</span><span class="ident" id="1448181">racecgosync</span><span class="op" id="1448192">)</span><span class="op" id="1448193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1448196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448200">type</span>&nbsp;<span class="ident" id="1448205">args</span>&nbsp;<span class="keyword" id="1448210">struct</span>&nbsp;<span class="op" id="1448217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448221">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1448229">*</span><span class="ident" id="1448230">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448240">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448248">unsafe</span><span class="op" id="1448254">.</span><span class="ident" id="1448255">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448265">argsize</span>&nbsp;<span class="builtintype" id="1448273">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1448282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448285">var</span>&nbsp;<span class="ident" id="1448289">cb</span>&nbsp;<span class="op" id="1448292">*</span><span class="ident" id="1448293">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448300">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448365">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448416">sp</span>&nbsp;<span class="op" id="1448419">:=</span>&nbsp;<span class="ident" id="1448422">gp</span><span class="op" id="1448424">.</span><span class="ident" id="1448425">m</span><span class="op" id="1448426">.</span><span class="ident" id="1448427">g0</span><span class="op" id="1448429">.</span><span class="ident" id="1448430">sched</span><span class="op" id="1448435">.</span><span class="ident" id="1448436">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448440">switch</span>&nbsp;<span class="ident" id="1448447">GOARCH</span>&nbsp;<span class="op" id="1448454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448457">default</span><span class="op" id="1448464">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448468">gothrow</span><span class="op" id="1448475">(</span><span class="string" id="1448476">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1448515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448518">case</span>&nbsp;<span class="string" id="1448523">&#34;arm&#34;</span><span class="op" id="1448528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448532">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448601">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448676">cb</span>&nbsp;<span class="op" id="1448679">=</span>&nbsp;<span class="op" id="1448681">(</span><span class="op" id="1448682">*</span><span class="ident" id="1448683">args</span><span class="op" id="1448687">)</span><span class="op" id="1448688">(</span><span class="ident" id="1448689">unsafe</span><span class="op" id="1448695">.</span><span class="ident" id="1448696">Pointer</span><span class="op" id="1448703">(</span><span class="ident" id="1448704">sp</span>&nbsp;<span class="op" id="1448707">+</span>&nbsp;<span class="num" id="1448709">4</span><span class="op" id="1448710">*</span><span class="ident" id="1448711">ptrSize</span><span class="op" id="1448718">)</span><span class="op" id="1448719">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448722">case</span>&nbsp;<span class="string" id="1448727">&#34;amd64&#34;</span><span class="op" id="1448734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448738">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448794">cb</span>&nbsp;<span class="op" id="1448797">=</span>&nbsp;<span class="op" id="1448799">(</span><span class="op" id="1448800">*</span><span class="ident" id="1448801">args</span><span class="op" id="1448805">)</span><span class="op" id="1448806">(</span><span class="ident" id="1448807">unsafe</span><span class="op" id="1448813">.</span><span class="ident" id="1448814">Pointer</span><span class="op" id="1448821">(</span><span class="ident" id="1448822">sp</span>&nbsp;<span class="op" id="1448825">+</span>&nbsp;<span class="num" id="1448827">2</span><span class="op" id="1448828">*</span><span class="ident" id="1448829">ptrSize</span><span class="op" id="1448836">)</span><span class="op" id="1448837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1448840">case</span>&nbsp;<span class="string" id="1448845">&#34;386&#34;</span><span class="op" id="1448850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448854">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448911">cb</span>&nbsp;<span class="op" id="1448914">=</span>&nbsp;<span class="op" id="1448916">(</span><span class="op" id="1448917">*</span><span class="ident" id="1448918">args</span><span class="op" id="1448922">)</span><span class="op" id="1448923">(</span><span class="ident" id="1448924">unsafe</span><span class="op" id="1448930">.</span><span class="ident" id="1448931">Pointer</span><span class="op" id="1448938">(</span><span class="ident" id="1448939">sp</span>&nbsp;<span class="op" id="1448942">+</span>&nbsp;<span class="num" id="1448944">4</span><span class="op" id="1448945">*</span><span class="ident" id="1448946">ptrSize</span><span class="op" id="1448953">)</span><span class="op" id="1448954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1448957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1448961">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1448982">reflectcall</span><span class="op" id="1448993">(</span><span class="ident" id="1448994">unsafe</span><span class="op" id="1449000">.</span><span class="ident" id="1449001">Pointer</span><span class="op" id="1449008">(</span><span class="ident" id="1449009">cb</span><span class="op" id="1449011">.</span><span class="ident" id="1449012">fn</span><span class="op" id="1449014">)</span><span class="op" id="1449015">,</span>&nbsp;<span class="ident" id="1449017">unsafe</span><span class="op" id="1449023">.</span><span class="ident" id="1449024">Pointer</span><span class="op" id="1449031">(</span><span class="ident" id="1449032">cb</span><span class="op" id="1449034">.</span><span class="ident" id="1449035">arg</span><span class="op" id="1449038">)</span><span class="op" id="1449039">,</span>&nbsp;<span class="builtintype" id="1449041">uint32</span><span class="op" id="1449047">(</span><span class="ident" id="1449048">cb</span><span class="op" id="1449050">.</span><span class="ident" id="1449051">argsize</span><span class="op" id="1449058">)</span><span class="op" id="1449059">,</span>&nbsp;<span class="num" id="1449061">0</span><span class="op" id="1449062">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449066">if</span>&nbsp;<span class="ident" id="1449069">raceenabled</span>&nbsp;<span class="op" id="1449081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449085">racereleasemerge</span><span class="op" id="1449101">(</span><span class="ident" id="1449102">unsafe</span><span class="op" id="1449108">.</span><span class="ident" id="1449109">Pointer</span><span class="op" id="1449116">(</span><span class="op" id="1449117">&amp;</span><span class="ident" id="1449118">racecgosync</span><span class="op" id="1449129">)</span><span class="op" id="1449130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449137">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449172">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449215">restore</span>&nbsp;<span class="op" id="1449223">=</span>&nbsp;<span class="builtintype" id="1449225">false</span><br>
<span class="lineno"></span><span class="op" id="1449231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1449234">func</span>&nbsp;<span class="ident" id="1449239">unwindm</span><span class="op" id="1449246">(</span><span class="ident" id="1449247">restore</span>&nbsp;<span class="op" id="1449255">*</span><span class="builtintype" id="1449256">bool</span><span class="op" id="1449260">)</span>&nbsp;<span class="op" id="1449262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449265">if</span>&nbsp;<span class="op" id="1449268">!</span><span class="op" id="1449269">*</span><span class="ident" id="1449270">restore</span>&nbsp;<span class="op" id="1449278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449282">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449293">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1449336">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449390">mp</span>&nbsp;<span class="op" id="1449393">:=</span>&nbsp;<span class="ident" id="1449396">acquirem</span><span class="op" id="1449404">(</span><span class="op" id="1449405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449408">sched</span>&nbsp;<span class="op" id="1449414">:=</span>&nbsp;<span class="op" id="1449417">&amp;</span><span class="ident" id="1449418">mp</span><span class="op" id="1449420">.</span><span class="ident" id="1449421">g0</span><span class="op" id="1449423">.</span><span class="ident" id="1449424">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449431">switch</span>&nbsp;<span class="ident" id="1449438">GOARCH</span>&nbsp;<span class="op" id="1449445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449448">default</span><span class="op" id="1449455">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449459">gothrow</span><span class="op" id="1449466">(</span><span class="string" id="1449467">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1449492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449495">case</span>&nbsp;<span class="string" id="1449500">&#34;386&#34;</span><span class="op" id="1449505">,</span>&nbsp;<span class="string" id="1449507">&#34;amd64&#34;</span><span class="op" id="1449514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449518">sched</span><span class="op" id="1449523">.</span><span class="ident" id="1449524">sp</span>&nbsp;<span class="op" id="1449527">=</span>&nbsp;<span class="op" id="1449529">*</span><span class="op" id="1449530">(</span><span class="op" id="1449531">*</span><span class="builtintype" id="1449532">uintptr</span><span class="op" id="1449539">)</span><span class="op" id="1449540">(</span><span class="ident" id="1449541">unsafe</span><span class="op" id="1449547">.</span><span class="ident" id="1449548">Pointer</span><span class="op" id="1449555">(</span><span class="ident" id="1449556">sched</span><span class="op" id="1449561">.</span><span class="ident" id="1449562">sp</span><span class="op" id="1449564">)</span><span class="op" id="1449565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1449568">case</span>&nbsp;<span class="string" id="1449573">&#34;arm&#34;</span><span class="op" id="1449578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449582">sched</span><span class="op" id="1449587">.</span><span class="ident" id="1449588">sp</span>&nbsp;<span class="op" id="1449591">=</span>&nbsp;<span class="op" id="1449593">*</span><span class="op" id="1449594">(</span><span class="op" id="1449595">*</span><span class="builtintype" id="1449596">uintptr</span><span class="op" id="1449603">)</span><span class="op" id="1449604">(</span><span class="ident" id="1449605">unsafe</span><span class="op" id="1449611">.</span><span class="ident" id="1449612">Pointer</span><span class="op" id="1449619">(</span><span class="ident" id="1449620">sched</span><span class="op" id="1449625">.</span><span class="ident" id="1449626">sp</span>&nbsp;<span class="op" id="1449629">+</span>&nbsp;<span class="num" id="1449631">4</span><span class="op" id="1449632">)</span><span class="op" id="1449633">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1449636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449639">releasem</span><span class="op" id="1449647">(</span><span class="ident" id="1449648">mp</span><span class="op" id="1449650">)</span><br>
<span class="lineno"></span><span class="op" id="1449652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1449655">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1449679">func</span>&nbsp;<span class="ident" id="1449684">badcgocallback</span><span class="op" id="1449698">(</span><span class="op" id="1449699">)</span>&nbsp;<span class="op" id="1449701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449704">gothrow</span><span class="op" id="1449711">(</span><span class="string" id="1449712">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1449745">)</span><br>
<span class="lineno"></span><span class="op" id="1449747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1449750">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1449787">func</span>&nbsp;<span class="ident" id="1449792">cgounimpl</span><span class="op" id="1449801">(</span><span class="op" id="1449802">)</span>&nbsp;<span class="op" id="1449804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1449807">gothrow</span><span class="op" id="1449814">(</span><span class="string" id="1449815">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1449836">)</span><br>
<span class="lineno"></span><span class="op" id="1449838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1449841">var</span>&nbsp;<span class="ident" id="1449845">racecgosync</span>&nbsp;<span class="ident" id="1449857">uint64</span>&nbsp;<span class="comment" id="1449864">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
