<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5537730">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5537785">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5537839">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5537890">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5537967">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5537997">//</span><br>
<span class="lineno"></span><span class="comment" id="5538000">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5538016">//</span><br>
<span class="lineno">10</span><span class="comment" id="5538019">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5538052">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5538086">//</span><br>
<span class="lineno"></span><span class="comment" id="5538089">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5538115">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5538200">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5538291">//</span><br>
<span class="lineno"></span><span class="keyword" id="5538294">package</span>&nbsp;<span class="ident" id="5538302">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5538315">import</span>&nbsp;<span class="op" id="5538322">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538325">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538334">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538353">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538359">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5538369">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5538376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538379">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5538441">type</span>&nbsp;<span class="ident" id="5538446">Index</span>&nbsp;<span class="keyword" id="5538452">struct</span>&nbsp;<span class="op" id="5538459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538462">data</span>&nbsp;<span class="op" id="5538467">[</span><span class="op" id="5538468">]</span><span class="builtintype" id="5538469">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538475">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5538480">[</span><span class="op" id="5538481">]</span><span class="builtintype" id="5538482">int</span>&nbsp;<span class="comment" id="5538486">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5538533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538536">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5538573">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5538630">func</span>&nbsp;<span class="ident" id="5538635">New</span><span class="op" id="5538638">(</span><span class="ident" id="5538639">data</span>&nbsp;<span class="op" id="5538644">[</span><span class="op" id="5538645">]</span><span class="builtintype" id="5538646">byte</span><span class="op" id="5538650">)</span>&nbsp;<span class="op" id="5538652">*</span><span class="ident" id="5538653">Index</span>&nbsp;<span class="op" id="5538659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538662">return</span>&nbsp;<span class="op" id="5538669">&amp;</span><span class="ident" id="5538670">Index</span><span class="op" id="5538675">{</span><span class="ident" id="5538676">data</span><span class="op" id="5538680">,</span>&nbsp;<span class="ident" id="5538682">qsufsort</span><span class="op" id="5538690">(</span><span class="ident" id="5538691">data</span><span class="op" id="5538695">)</span><span class="op" id="5538696">}</span><br>
<span class="lineno"></span><span class="op" id="5538698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5538701">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5538765">func</span>&nbsp;<span class="ident" id="5538770">writeInt</span><span class="op" id="5538778">(</span><span class="ident" id="5538779">w</span>&nbsp;<span class="ident" id="5538781">io</span><span class="op" id="5538783">.</span><span class="ident" id="5538784">Writer</span><span class="op" id="5538790">,</span>&nbsp;<span class="ident" id="5538792">buf</span>&nbsp;<span class="op" id="5538796">[</span><span class="op" id="5538797">]</span><span class="builtintype" id="5538798">byte</span><span class="op" id="5538802">,</span>&nbsp;<span class="ident" id="5538804">x</span>&nbsp;<span class="builtintype" id="5538806">int</span><span class="op" id="5538809">)</span>&nbsp;<span class="builtintype" id="5538811">error</span>&nbsp;<span class="op" id="5538817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538820">binary</span><span class="op" id="5538826">.</span><span class="ident" id="5538827">PutVarint</span><span class="op" id="5538836">(</span><span class="ident" id="5538837">buf</span><span class="op" id="5538840">,</span>&nbsp;<span class="ident" id="5538842">int64</span><span class="op" id="5538847">(</span><span class="ident" id="5538848">x</span><span class="op" id="5538849">)</span><span class="op" id="5538850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5538853">_</span><span class="op" id="5538854">,</span>&nbsp;<span class="ident" id="5538856">err</span>&nbsp;<span class="op" id="5538860">:=</span>&nbsp;<span class="ident" id="5538863">w</span><span class="op" id="5538864">.</span><span class="ident" id="5538865">Write</span><span class="op" id="5538870">(</span><span class="ident" id="5538871">buf</span><span class="op" id="5538874">[</span><span class="num" id="5538875">0</span><span class="op" id="5538876">:</span><span class="ident" id="5538877">binary</span><span class="op" id="5538883">.</span><span class="ident" id="5538884">MaxVarintLen64</span><span class="op" id="5538898">]</span><span class="op" id="5538899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5538902">return</span>&nbsp;<span class="ident" id="5538909">err</span><br>
<span class="lineno"></span><span class="op" id="5538913">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5538916">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5538993">func</span>&nbsp;<span class="ident" id="5538998">readInt</span><span class="op" id="5539005">(</span><span class="ident" id="5539006">r</span>&nbsp;<span class="ident" id="5539008">io</span><span class="op" id="5539010">.</span><span class="ident" id="5539011">Reader</span><span class="op" id="5539017">,</span>&nbsp;<span class="ident" id="5539019">buf</span>&nbsp;<span class="op" id="5539023">[</span><span class="op" id="5539024">]</span><span class="builtintype" id="5539025">byte</span><span class="op" id="5539029">)</span>&nbsp;<span class="op" id="5539031">(</span><span class="builtintype" id="5539032">int</span><span class="op" id="5539035">,</span>&nbsp;<span class="builtintype" id="5539037">error</span><span class="op" id="5539042">)</span>&nbsp;<span class="op" id="5539044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539047">_</span><span class="op" id="5539048">,</span>&nbsp;<span class="ident" id="5539050">err</span>&nbsp;<span class="op" id="5539054">:=</span>&nbsp;<span class="ident" id="5539057">io</span><span class="op" id="5539059">.</span><span class="ident" id="5539060">ReadFull</span><span class="op" id="5539068">(</span><span class="ident" id="5539069">r</span><span class="op" id="5539070">,</span>&nbsp;<span class="ident" id="5539072">buf</span><span class="op" id="5539075">[</span><span class="num" id="5539076">0</span><span class="op" id="5539077">:</span><span class="ident" id="5539078">binary</span><span class="op" id="5539084">.</span><span class="ident" id="5539085">MaxVarintLen64</span><span class="op" id="5539099">]</span><span class="op" id="5539100">)</span>&nbsp;<span class="comment" id="5539102">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539132">x</span><span class="op" id="5539133">,</span>&nbsp;<span class="ident" id="5539135">_</span>&nbsp;<span class="op" id="5539137">:=</span>&nbsp;<span class="ident" id="5539140">binary</span><span class="op" id="5539146">.</span><span class="ident" id="5539147">Varint</span><span class="op" id="5539153">(</span><span class="ident" id="5539154">buf</span><span class="op" id="5539157">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539160">return</span>&nbsp;<span class="builtintype" id="5539167">int</span><span class="op" id="5539170">(</span><span class="ident" id="5539171">x</span><span class="op" id="5539172">)</span><span class="op" id="5539173">,</span>&nbsp;<span class="ident" id="5539175">err</span><br>
<span class="lineno"></span><span class="op" id="5539179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5539182">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5539232">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5539268">func</span>&nbsp;<span class="ident" id="5539273">writeSlice</span><span class="op" id="5539283">(</span><span class="ident" id="5539284">w</span>&nbsp;<span class="ident" id="5539286">io</span><span class="op" id="5539288">.</span><span class="ident" id="5539289">Writer</span><span class="op" id="5539295">,</span>&nbsp;<span class="ident" id="5539297">buf</span>&nbsp;<span class="op" id="5539301">[</span><span class="op" id="5539302">]</span><span class="builtintype" id="5539303">byte</span><span class="op" id="5539307">,</span>&nbsp;<span class="ident" id="5539309">data</span>&nbsp;<span class="op" id="5539314">[</span><span class="op" id="5539315">]</span><span class="builtintype" id="5539316">int</span><span class="op" id="5539319">)</span>&nbsp;<span class="op" id="5539321">(</span><span class="ident" id="5539322">n</span>&nbsp;<span class="builtintype" id="5539324">int</span><span class="op" id="5539327">,</span>&nbsp;<span class="ident" id="5539329">err</span>&nbsp;<span class="builtintype" id="5539333">error</span><span class="op" id="5539338">)</span>&nbsp;<span class="op" id="5539340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539343">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539387">p</span>&nbsp;<span class="op" id="5539389">:=</span>&nbsp;<span class="ident" id="5539392">binary</span><span class="op" id="5539398">.</span><span class="ident" id="5539399">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539415">for</span>&nbsp;<span class="op" id="5539419">;</span>&nbsp;<span class="ident" id="5539421">n</span>&nbsp;<span class="op" id="5539423">&lt;</span>&nbsp;<span class="builtinfunc" id="5539425">len</span><span class="op" id="5539428">(</span><span class="ident" id="5539429">data</span><span class="op" id="5539433">)</span>&nbsp;<span class="op" id="5539435">&amp;&amp;</span>&nbsp;<span class="ident" id="5539438">p</span><span class="op" id="5539439">+</span><span class="ident" id="5539440">binary</span><span class="op" id="5539446">.</span><span class="ident" id="5539447">MaxVarintLen64</span>&nbsp;<span class="op" id="5539462">&lt;=</span>&nbsp;<span class="builtinfunc" id="5539465">len</span><span class="op" id="5539468">(</span><span class="ident" id="5539469">buf</span><span class="op" id="5539472">)</span><span class="op" id="5539473">;</span>&nbsp;<span class="ident" id="5539475">n</span><span class="op" id="5539476">++</span>&nbsp;<span class="op" id="5539479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539483">p</span>&nbsp;<span class="op" id="5539485">+=</span>&nbsp;<span class="ident" id="5539488">binary</span><span class="op" id="5539494">.</span><span class="ident" id="5539495">PutUvarint</span><span class="op" id="5539505">(</span><span class="ident" id="5539506">buf</span><span class="op" id="5539509">[</span><span class="ident" id="5539510">p</span><span class="op" id="5539511">:</span><span class="op" id="5539512">]</span><span class="op" id="5539513">,</span>&nbsp;<span class="ident" id="5539515">uint64</span><span class="op" id="5539521">(</span><span class="ident" id="5539522">data</span><span class="op" id="5539526">[</span><span class="ident" id="5539527">n</span><span class="op" id="5539528">]</span><span class="op" id="5539529">)</span><span class="op" id="5539530">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539537">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539560">binary</span><span class="op" id="5539566">.</span><span class="ident" id="5539567">PutVarint</span><span class="op" id="5539576">(</span><span class="ident" id="5539577">buf</span><span class="op" id="5539580">,</span>&nbsp;<span class="ident" id="5539582">int64</span><span class="op" id="5539587">(</span><span class="ident" id="5539588">p</span><span class="op" id="5539589">)</span><span class="op" id="5539590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539594">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539611">_</span><span class="op" id="5539612">,</span>&nbsp;<span class="ident" id="5539614">err</span>&nbsp;<span class="op" id="5539618">=</span>&nbsp;<span class="ident" id="5539620">w</span><span class="op" id="5539621">.</span><span class="ident" id="5539622">Write</span><span class="op" id="5539627">(</span><span class="ident" id="5539628">buf</span><span class="op" id="5539631">[</span><span class="num" id="5539632">0</span><span class="op" id="5539633">:</span><span class="ident" id="5539634">p</span><span class="op" id="5539635">]</span><span class="op" id="5539636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539639">return</span><br>
<span class="lineno"></span><span class="op" id="5539646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5539649">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5539699">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5539734">func</span>&nbsp;<span class="ident" id="5539739">readSlice</span><span class="op" id="5539748">(</span><span class="ident" id="5539749">r</span>&nbsp;<span class="ident" id="5539751">io</span><span class="op" id="5539753">.</span><span class="ident" id="5539754">Reader</span><span class="op" id="5539760">,</span>&nbsp;<span class="ident" id="5539762">buf</span>&nbsp;<span class="op" id="5539766">[</span><span class="op" id="5539767">]</span><span class="builtintype" id="5539768">byte</span><span class="op" id="5539772">,</span>&nbsp;<span class="ident" id="5539774">data</span>&nbsp;<span class="op" id="5539779">[</span><span class="op" id="5539780">]</span><span class="builtintype" id="5539781">int</span><span class="op" id="5539784">)</span>&nbsp;<span class="op" id="5539786">(</span><span class="ident" id="5539787">n</span>&nbsp;<span class="builtintype" id="5539789">int</span><span class="op" id="5539792">,</span>&nbsp;<span class="ident" id="5539794">err</span>&nbsp;<span class="builtintype" id="5539798">error</span><span class="op" id="5539803">)</span>&nbsp;<span class="op" id="5539805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539808">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539829">var</span>&nbsp;<span class="ident" id="5539833">size</span>&nbsp;<span class="builtintype" id="5539838">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5539843">size</span><span class="op" id="5539847">,</span>&nbsp;<span class="ident" id="5539849">err</span>&nbsp;<span class="op" id="5539853">=</span>&nbsp;<span class="ident" id="5539855">readInt</span><span class="op" id="5539862">(</span><span class="ident" id="5539863">r</span><span class="op" id="5539864">,</span>&nbsp;<span class="ident" id="5539866">buf</span><span class="op" id="5539869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539872">if</span>&nbsp;<span class="ident" id="5539875">err</span>&nbsp;<span class="op" id="5539879">!=</span>&nbsp;<span class="ident" id="5539882">nil</span>&nbsp;<span class="op" id="5539886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539890">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5539898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5539902">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5539931">if</span>&nbsp;<span class="ident" id="5539934">_</span><span class="op" id="5539935">,</span>&nbsp;<span class="ident" id="5539937">err</span>&nbsp;<span class="op" id="5539941">=</span>&nbsp;<span class="ident" id="5539943">io</span><span class="op" id="5539945">.</span><span class="ident" id="5539946">ReadFull</span><span class="op" id="5539954">(</span><span class="ident" id="5539955">r</span><span class="op" id="5539956">,</span>&nbsp;<span class="ident" id="5539958">buf</span><span class="op" id="5539961">[</span><span class="ident" id="5539962">binary</span><span class="op" id="5539968">.</span><span class="ident" id="5539969">MaxVarintLen64</span><span class="op" id="5539983">:</span><span class="ident" id="5539984">size</span><span class="op" id="5539988">]</span><span class="op" id="5539989">)</span><span class="op" id="5539990">;</span>&nbsp;<span class="ident" id="5539992">err</span>&nbsp;<span class="op" id="5539996">!=</span>&nbsp;<span class="ident" id="5539999">nil</span>&nbsp;<span class="op" id="5540003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540007">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540019">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540065">for</span>&nbsp;<span class="ident" id="5540069">p</span>&nbsp;<span class="op" id="5540071">:=</span>&nbsp;<span class="ident" id="5540074">binary</span><span class="op" id="5540080">.</span><span class="ident" id="5540081">MaxVarintLen64</span><span class="op" id="5540095">;</span>&nbsp;<span class="ident" id="5540097">p</span>&nbsp;<span class="op" id="5540099">&lt;</span>&nbsp;<span class="ident" id="5540101">size</span><span class="op" id="5540105">;</span>&nbsp;<span class="ident" id="5540107">n</span><span class="op" id="5540108">++</span>&nbsp;<span class="op" id="5540111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540115">x</span><span class="op" id="5540116">,</span>&nbsp;<span class="ident" id="5540118">w</span>&nbsp;<span class="op" id="5540120">:=</span>&nbsp;<span class="ident" id="5540123">binary</span><span class="op" id="5540129">.</span><span class="ident" id="5540130">Uvarint</span><span class="op" id="5540137">(</span><span class="ident" id="5540138">buf</span><span class="op" id="5540141">[</span><span class="ident" id="5540142">p</span><span class="op" id="5540143">:</span><span class="op" id="5540144">]</span><span class="op" id="5540145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540149">data</span><span class="op" id="5540153">[</span><span class="ident" id="5540154">n</span><span class="op" id="5540155">]</span>&nbsp;<span class="op" id="5540157">=</span>&nbsp;<span class="builtintype" id="5540159">int</span><span class="op" id="5540162">(</span><span class="ident" id="5540163">x</span><span class="op" id="5540164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540168">p</span>&nbsp;<span class="op" id="5540170">+=</span>&nbsp;<span class="ident" id="5540173">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540180">return</span><br>
<span class="lineno"></span><span class="op" id="5540187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5540190">const</span>&nbsp;<span class="ident" id="5540196">bufSize</span>&nbsp;<span class="op" id="5540204">=</span>&nbsp;<span class="num" id="5540206">16</span>&nbsp;<span class="op" id="5540209">&lt;&lt;</span>&nbsp;<span class="num" id="5540212">10</span>&nbsp;<span class="comment" id="5540215">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5540255">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5540313">func</span>&nbsp;<span class="op" id="5540318">(</span><span class="ident" id="5540319">x</span>&nbsp;<span class="op" id="5540321">*</span><span class="ident" id="5540322">Index</span><span class="op" id="5540327">)</span>&nbsp;<span class="ident" id="5540329">Read</span><span class="op" id="5540333">(</span><span class="ident" id="5540334">r</span>&nbsp;<span class="ident" id="5540336">io</span><span class="op" id="5540338">.</span><span class="ident" id="5540339">Reader</span><span class="op" id="5540345">)</span>&nbsp;<span class="builtintype" id="5540347">error</span>&nbsp;<span class="op" id="5540353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540356">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540381">buf</span>&nbsp;<span class="op" id="5540385">:=</span>&nbsp;<span class="builtinfunc" id="5540388">make</span><span class="op" id="5540392">(</span><span class="op" id="5540393">[</span><span class="op" id="5540394">]</span><span class="builtintype" id="5540395">byte</span><span class="op" id="5540399">,</span>&nbsp;<span class="ident" id="5540401">bufSize</span><span class="op" id="5540408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540412">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540428">n</span><span class="op" id="5540429">,</span>&nbsp;<span class="ident" id="5540431">err</span>&nbsp;<span class="op" id="5540435">:=</span>&nbsp;<span class="ident" id="5540438">readInt</span><span class="op" id="5540445">(</span><span class="ident" id="5540446">r</span><span class="op" id="5540447">,</span>&nbsp;<span class="ident" id="5540449">buf</span><span class="op" id="5540452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540455">if</span>&nbsp;<span class="ident" id="5540458">err</span>&nbsp;<span class="op" id="5540462">!=</span>&nbsp;<span class="ident" id="5540465">nil</span>&nbsp;<span class="op" id="5540469">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540473">return</span>&nbsp;<span class="ident" id="5540480">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540489">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540508">if</span>&nbsp;<span class="num" id="5540511">2</span><span class="op" id="5540512">*</span><span class="ident" id="5540513">n</span>&nbsp;<span class="op" id="5540515">&lt;</span>&nbsp;<span class="builtinfunc" id="5540517">cap</span><span class="op" id="5540520">(</span><span class="ident" id="5540521">x</span><span class="op" id="5540522">.</span><span class="ident" id="5540523">data</span><span class="op" id="5540527">)</span>&nbsp;<span class="op" id="5540529">||</span>&nbsp;<span class="builtinfunc" id="5540532">cap</span><span class="op" id="5540535">(</span><span class="ident" id="5540536">x</span><span class="op" id="5540537">.</span><span class="ident" id="5540538">data</span><span class="op" id="5540542">)</span>&nbsp;<span class="op" id="5540544">&lt;</span>&nbsp;<span class="ident" id="5540546">n</span>&nbsp;<span class="op" id="5540548">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540552">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540606">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540648">x</span><span class="op" id="5540649">.</span><span class="ident" id="5540650">data</span>&nbsp;<span class="op" id="5540655">=</span>&nbsp;<span class="builtinfunc" id="5540657">make</span><span class="op" id="5540661">(</span><span class="op" id="5540662">[</span><span class="op" id="5540663">]</span><span class="builtintype" id="5540664">byte</span><span class="op" id="5540668">,</span>&nbsp;<span class="ident" id="5540670">n</span><span class="op" id="5540671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540675">x</span><span class="op" id="5540676">.</span><span class="ident" id="5540677">sa</span>&nbsp;<span class="op" id="5540680">=</span>&nbsp;<span class="builtinfunc" id="5540682">make</span><span class="op" id="5540686">(</span><span class="op" id="5540687">[</span><span class="op" id="5540688">]</span><span class="builtintype" id="5540689">int</span><span class="op" id="5540692">,</span>&nbsp;<span class="ident" id="5540694">n</span><span class="op" id="5540695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540698">}</span>&nbsp;<span class="keyword" id="5540700">else</span>&nbsp;<span class="op" id="5540705">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540709">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540738">x</span><span class="op" id="5540739">.</span><span class="ident" id="5540740">data</span>&nbsp;<span class="op" id="5540745">=</span>&nbsp;<span class="ident" id="5540747">x</span><span class="op" id="5540748">.</span><span class="ident" id="5540749">data</span><span class="op" id="5540753">[</span><span class="num" id="5540754">0</span><span class="op" id="5540755">:</span><span class="ident" id="5540756">n</span><span class="op" id="5540757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540761">x</span><span class="op" id="5540762">.</span><span class="ident" id="5540763">sa</span>&nbsp;<span class="op" id="5540766">=</span>&nbsp;<span class="ident" id="5540768">x</span><span class="op" id="5540769">.</span><span class="ident" id="5540770">sa</span><span class="op" id="5540772">[</span><span class="num" id="5540773">0</span><span class="op" id="5540774">:</span><span class="ident" id="5540775">n</span><span class="op" id="5540776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540783">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540797">if</span>&nbsp;<span class="ident" id="5540800">_</span><span class="op" id="5540801">,</span>&nbsp;<span class="ident" id="5540803">err</span>&nbsp;<span class="op" id="5540807">:=</span>&nbsp;<span class="ident" id="5540810">io</span><span class="op" id="5540812">.</span><span class="ident" id="5540813">ReadFull</span><span class="op" id="5540821">(</span><span class="ident" id="5540822">r</span><span class="op" id="5540823">,</span>&nbsp;<span class="ident" id="5540825">x</span><span class="op" id="5540826">.</span><span class="ident" id="5540827">data</span><span class="op" id="5540831">)</span><span class="op" id="5540832">;</span>&nbsp;<span class="ident" id="5540834">err</span>&nbsp;<span class="op" id="5540838">!=</span>&nbsp;<span class="ident" id="5540841">nil</span>&nbsp;<span class="op" id="5540845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540849">return</span>&nbsp;<span class="ident" id="5540856">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5540865">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540880">for</span>&nbsp;<span class="ident" id="5540884">sa</span>&nbsp;<span class="op" id="5540887">:=</span>&nbsp;<span class="ident" id="5540890">x</span><span class="op" id="5540891">.</span><span class="ident" id="5540892">sa</span><span class="op" id="5540894">;</span>&nbsp;<span class="builtinfunc" id="5540896">len</span><span class="op" id="5540899">(</span><span class="ident" id="5540900">sa</span><span class="op" id="5540902">)</span>&nbsp;<span class="op" id="5540904">&gt;</span>&nbsp;<span class="num" id="5540906">0</span><span class="op" id="5540907">;</span>&nbsp;<span class="op" id="5540909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540913">n</span><span class="op" id="5540914">,</span>&nbsp;<span class="ident" id="5540916">err</span>&nbsp;<span class="op" id="5540920">:=</span>&nbsp;<span class="ident" id="5540923">readSlice</span><span class="op" id="5540932">(</span><span class="ident" id="5540933">r</span><span class="op" id="5540934">,</span>&nbsp;<span class="ident" id="5540936">buf</span><span class="op" id="5540939">,</span>&nbsp;<span class="ident" id="5540941">sa</span><span class="op" id="5540943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540947">if</span>&nbsp;<span class="ident" id="5540950">err</span>&nbsp;<span class="op" id="5540954">!=</span>&nbsp;<span class="ident" id="5540957">nil</span>&nbsp;<span class="op" id="5540961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540966">return</span>&nbsp;<span class="ident" id="5540973">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5540983">sa</span>&nbsp;<span class="op" id="5540986">=</span>&nbsp;<span class="ident" id="5540988">sa</span><span class="op" id="5540990">[</span><span class="ident" id="5540991">n</span><span class="op" id="5540992">:</span><span class="op" id="5540993">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5540996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5540999">return</span>&nbsp;<span class="ident" id="5541006">nil</span><br>
<span class="lineno"></span><span class="op" id="5541010">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5541013">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5541047">func</span>&nbsp;<span class="op" id="5541052">(</span><span class="ident" id="5541053">x</span>&nbsp;<span class="op" id="5541055">*</span><span class="ident" id="5541056">Index</span><span class="op" id="5541061">)</span>&nbsp;<span class="ident" id="5541063">Write</span><span class="op" id="5541068">(</span><span class="ident" id="5541069">w</span>&nbsp;<span class="ident" id="5541071">io</span><span class="op" id="5541073">.</span><span class="ident" id="5541074">Writer</span><span class="op" id="5541080">)</span>&nbsp;<span class="builtintype" id="5541082">error</span>&nbsp;<span class="op" id="5541088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541091">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541117">buf</span>&nbsp;<span class="op" id="5541121">:=</span>&nbsp;<span class="builtinfunc" id="5541124">make</span><span class="op" id="5541128">(</span><span class="op" id="5541129">[</span><span class="op" id="5541130">]</span><span class="builtintype" id="5541131">byte</span><span class="op" id="5541135">,</span>&nbsp;<span class="ident" id="5541137">bufSize</span><span class="op" id="5541144">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541148">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541165">if</span>&nbsp;<span class="ident" id="5541168">err</span>&nbsp;<span class="op" id="5541172">:=</span>&nbsp;<span class="ident" id="5541175">writeInt</span><span class="op" id="5541183">(</span><span class="ident" id="5541184">w</span><span class="op" id="5541185">,</span>&nbsp;<span class="ident" id="5541187">buf</span><span class="op" id="5541190">,</span>&nbsp;<span class="builtinfunc" id="5541192">len</span><span class="op" id="5541195">(</span><span class="ident" id="5541196">x</span><span class="op" id="5541197">.</span><span class="ident" id="5541198">data</span><span class="op" id="5541202">)</span><span class="op" id="5541203">)</span><span class="op" id="5541204">;</span>&nbsp;<span class="ident" id="5541206">err</span>&nbsp;<span class="op" id="5541210">!=</span>&nbsp;<span class="ident" id="5541213">nil</span>&nbsp;<span class="op" id="5541217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541221">return</span>&nbsp;<span class="ident" id="5541228">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541233">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541237">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541252">if</span>&nbsp;<span class="ident" id="5541255">_</span><span class="op" id="5541256">,</span>&nbsp;<span class="ident" id="5541258">err</span>&nbsp;<span class="op" id="5541262">:=</span>&nbsp;<span class="ident" id="5541265">w</span><span class="op" id="5541266">.</span><span class="ident" id="5541267">Write</span><span class="op" id="5541272">(</span><span class="ident" id="5541273">x</span><span class="op" id="5541274">.</span><span class="ident" id="5541275">data</span><span class="op" id="5541279">)</span><span class="op" id="5541280">;</span>&nbsp;<span class="ident" id="5541282">err</span>&nbsp;<span class="op" id="5541286">!=</span>&nbsp;<span class="ident" id="5541289">nil</span>&nbsp;<span class="op" id="5541293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541297">return</span>&nbsp;<span class="ident" id="5541304">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541309">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541313">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541329">for</span>&nbsp;<span class="ident" id="5541333">sa</span>&nbsp;<span class="op" id="5541336">:=</span>&nbsp;<span class="ident" id="5541339">x</span><span class="op" id="5541340">.</span><span class="ident" id="5541341">sa</span><span class="op" id="5541343">;</span>&nbsp;<span class="builtinfunc" id="5541345">len</span><span class="op" id="5541348">(</span><span class="ident" id="5541349">sa</span><span class="op" id="5541351">)</span>&nbsp;<span class="op" id="5541353">&gt;</span>&nbsp;<span class="num" id="5541355">0</span><span class="op" id="5541356">;</span>&nbsp;<span class="op" id="5541358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541362">n</span><span class="op" id="5541363">,</span>&nbsp;<span class="ident" id="5541365">err</span>&nbsp;<span class="op" id="5541369">:=</span>&nbsp;<span class="ident" id="5541372">writeSlice</span><span class="op" id="5541382">(</span><span class="ident" id="5541383">w</span><span class="op" id="5541384">,</span>&nbsp;<span class="ident" id="5541386">buf</span><span class="op" id="5541389">,</span>&nbsp;<span class="ident" id="5541391">sa</span><span class="op" id="5541393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541397">if</span>&nbsp;<span class="ident" id="5541400">err</span>&nbsp;<span class="op" id="5541404">!=</span>&nbsp;<span class="ident" id="5541407">nil</span>&nbsp;<span class="op" id="5541411">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541416">return</span>&nbsp;<span class="ident" id="5541423">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541433">sa</span>&nbsp;<span class="op" id="5541436">=</span>&nbsp;<span class="ident" id="5541438">sa</span><span class="op" id="5541440">[</span><span class="ident" id="5541441">n</span><span class="op" id="5541442">:</span><span class="op" id="5541443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5541446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541449">return</span>&nbsp;<span class="ident" id="5541456">nil</span><br>
<span class="lineno">160</span><span class="op" id="5541460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541463">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5541523">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5541551">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5541554">func</span>&nbsp;<span class="op" id="5541559">(</span><span class="ident" id="5541560">x</span>&nbsp;<span class="op" id="5541562">*</span><span class="ident" id="5541563">Index</span><span class="op" id="5541568">)</span>&nbsp;<span class="ident" id="5541570">Bytes</span><span class="op" id="5541575">(</span><span class="op" id="5541576">)</span>&nbsp;<span class="op" id="5541578">[</span><span class="op" id="5541579">]</span><span class="builtintype" id="5541580">byte</span>&nbsp;<span class="op" id="5541585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541588">return</span>&nbsp;<span class="ident" id="5541595">x</span><span class="op" id="5541596">.</span><span class="ident" id="5541597">data</span><br>
<span class="lineno"></span><span class="op" id="5541602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5541605">func</span>&nbsp;<span class="op" id="5541610">(</span><span class="ident" id="5541611">x</span>&nbsp;<span class="op" id="5541613">*</span><span class="ident" id="5541614">Index</span><span class="op" id="5541619">)</span>&nbsp;<span class="ident" id="5541621">at</span><span class="op" id="5541623">(</span><span class="ident" id="5541624">i</span>&nbsp;<span class="builtintype" id="5541626">int</span><span class="op" id="5541629">)</span>&nbsp;<span class="op" id="5541631">[</span><span class="op" id="5541632">]</span><span class="builtintype" id="5541633">byte</span>&nbsp;<span class="op" id="5541638">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5541641">return</span>&nbsp;<span class="ident" id="5541648">x</span><span class="op" id="5541649">.</span><span class="ident" id="5541650">data</span><span class="op" id="5541654">[</span><span class="ident" id="5541655">x</span><span class="op" id="5541656">.</span><span class="ident" id="5541657">sa</span><span class="op" id="5541659">[</span><span class="ident" id="5541660">i</span><span class="op" id="5541661">]</span><span class="op" id="5541662">:</span><span class="op" id="5541663">]</span><br>
<span class="lineno"></span><span class="op" id="5541665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5541668">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5541736">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5541772">func</span>&nbsp;<span class="op" id="5541777">(</span><span class="ident" id="5541778">x</span>&nbsp;<span class="op" id="5541780">*</span><span class="ident" id="5541781">Index</span><span class="op" id="5541786">)</span>&nbsp;<span class="ident" id="5541788">lookupAll</span><span class="op" id="5541797">(</span><span class="ident" id="5541798">s</span>&nbsp;<span class="op" id="5541800">[</span><span class="op" id="5541801">]</span><span class="builtintype" id="5541802">byte</span><span class="op" id="5541806">)</span>&nbsp;<span class="op" id="5541808">[</span><span class="op" id="5541809">]</span><span class="builtintype" id="5541810">int</span>&nbsp;<span class="op" id="5541814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541817">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5541860">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5541913">i</span>&nbsp;<span class="op" id="5541915">:=</span>&nbsp;<span class="ident" id="5541918">sort</span><span class="op" id="5541922">.</span><span class="ident" id="5541923">Search</span><span class="op" id="5541929">(</span><span class="builtinfunc" id="5541930">len</span><span class="op" id="5541933">(</span><span class="ident" id="5541934">x</span><span class="op" id="5541935">.</span><span class="ident" id="5541936">sa</span><span class="op" id="5541938">)</span><span class="op" id="5541939">,</span>&nbsp;<span class="keyword" id="5541941">func</span><span class="op" id="5541945">(</span><span class="ident" id="5541946">i</span>&nbsp;<span class="builtintype" id="5541948">int</span><span class="op" id="5541951">)</span>&nbsp;<span class="builtintype" id="5541953">bool</span>&nbsp;<span class="op" id="5541958">{</span>&nbsp;<span class="keyword" id="5541960">return</span>&nbsp;<span class="ident" id="5541967">bytes</span><span class="op" id="5541972">.</span><span class="ident" id="5541973">Compare</span><span class="op" id="5541980">(</span><span class="ident" id="5541981">x</span><span class="op" id="5541982">.</span><span class="ident" id="5541983">at</span><span class="op" id="5541985">(</span><span class="ident" id="5541986">i</span><span class="op" id="5541987">)</span><span class="op" id="5541988">,</span>&nbsp;<span class="ident" id="5541990">s</span><span class="op" id="5541991">)</span>&nbsp;<span class="op" id="5541993">&gt;=</span>&nbsp;<span class="num" id="5541996">0</span>&nbsp;<span class="op" id="5541998">}</span><span class="op" id="5541999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5542002">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542069">j</span>&nbsp;<span class="op" id="5542071">:=</span>&nbsp;<span class="ident" id="5542074">i</span>&nbsp;<span class="op" id="5542076">+</span>&nbsp;<span class="ident" id="5542078">sort</span><span class="op" id="5542082">.</span><span class="ident" id="5542083">Search</span><span class="op" id="5542089">(</span><span class="builtinfunc" id="5542090">len</span><span class="op" id="5542093">(</span><span class="ident" id="5542094">x</span><span class="op" id="5542095">.</span><span class="ident" id="5542096">sa</span><span class="op" id="5542098">)</span><span class="op" id="5542099">-</span><span class="ident" id="5542100">i</span><span class="op" id="5542101">,</span>&nbsp;<span class="keyword" id="5542103">func</span><span class="op" id="5542107">(</span><span class="ident" id="5542108">j</span>&nbsp;<span class="builtintype" id="5542110">int</span><span class="op" id="5542113">)</span>&nbsp;<span class="builtintype" id="5542115">bool</span>&nbsp;<span class="op" id="5542120">{</span>&nbsp;<span class="keyword" id="5542122">return</span>&nbsp;<span class="op" id="5542129">!</span><span class="ident" id="5542130">bytes</span><span class="op" id="5542135">.</span><span class="ident" id="5542136">HasPrefix</span><span class="op" id="5542145">(</span><span class="ident" id="5542146">x</span><span class="op" id="5542147">.</span><span class="ident" id="5542148">at</span><span class="op" id="5542150">(</span><span class="ident" id="5542151">j</span><span class="op" id="5542152">+</span><span class="ident" id="5542153">i</span><span class="op" id="5542154">)</span><span class="op" id="5542155">,</span>&nbsp;<span class="ident" id="5542157">s</span><span class="op" id="5542158">)</span>&nbsp;<span class="op" id="5542160">}</span><span class="op" id="5542161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542164">return</span>&nbsp;<span class="ident" id="5542171">x</span><span class="op" id="5542172">.</span><span class="ident" id="5542173">sa</span><span class="op" id="5542175">[</span><span class="ident" id="5542176">i</span><span class="op" id="5542177">:</span><span class="ident" id="5542178">j</span><span class="op" id="5542179">]</span><br>
<span class="lineno"></span><span class="op" id="5542181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5542184">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5542264">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5542335">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5542398">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5542462">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5542491">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5542494">func</span>&nbsp;<span class="op" id="5542499">(</span><span class="ident" id="5542500">x</span>&nbsp;<span class="op" id="5542502">*</span><span class="ident" id="5542503">Index</span><span class="op" id="5542508">)</span>&nbsp;<span class="ident" id="5542510">Lookup</span><span class="op" id="5542516">(</span><span class="ident" id="5542517">s</span>&nbsp;<span class="op" id="5542519">[</span><span class="op" id="5542520">]</span><span class="builtintype" id="5542521">byte</span><span class="op" id="5542525">,</span>&nbsp;<span class="ident" id="5542527">n</span>&nbsp;<span class="builtintype" id="5542529">int</span><span class="op" id="5542532">)</span>&nbsp;<span class="op" id="5542534">(</span><span class="ident" id="5542535">result</span>&nbsp;<span class="op" id="5542542">[</span><span class="op" id="5542543">]</span><span class="builtintype" id="5542544">int</span><span class="op" id="5542547">)</span>&nbsp;<span class="op" id="5542549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542552">if</span>&nbsp;<span class="builtinfunc" id="5542555">len</span><span class="op" id="5542558">(</span><span class="ident" id="5542559">s</span><span class="op" id="5542560">)</span>&nbsp;<span class="op" id="5542562">&gt;</span>&nbsp;<span class="num" id="5542564">0</span>&nbsp;<span class="op" id="5542566">&amp;&amp;</span>&nbsp;<span class="ident" id="5542569">n</span>&nbsp;<span class="op" id="5542571">!=</span>&nbsp;<span class="num" id="5542574">0</span>&nbsp;<span class="op" id="5542576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542580">matches</span>&nbsp;<span class="op" id="5542588">:=</span>&nbsp;<span class="ident" id="5542591">x</span><span class="op" id="5542592">.</span><span class="ident" id="5542593">lookupAll</span><span class="op" id="5542602">(</span><span class="ident" id="5542603">s</span><span class="op" id="5542604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542608">if</span>&nbsp;<span class="ident" id="5542611">n</span>&nbsp;<span class="op" id="5542613">&lt;</span>&nbsp;<span class="num" id="5542615">0</span>&nbsp;<span class="op" id="5542617">||</span>&nbsp;<span class="builtinfunc" id="5542620">len</span><span class="op" id="5542623">(</span><span class="ident" id="5542624">matches</span><span class="op" id="5542631">)</span>&nbsp;<span class="op" id="5542633">&lt;</span>&nbsp;<span class="ident" id="5542635">n</span>&nbsp;<span class="op" id="5542637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542642">n</span>&nbsp;<span class="op" id="5542644">=</span>&nbsp;<span class="builtinfunc" id="5542646">len</span><span class="op" id="5542649">(</span><span class="ident" id="5542650">matches</span><span class="op" id="5542657">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5542665">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542693">if</span>&nbsp;<span class="ident" id="5542696">n</span>&nbsp;<span class="op" id="5542698">&gt;</span>&nbsp;<span class="num" id="5542700">0</span>&nbsp;<span class="op" id="5542702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5542707">result</span>&nbsp;<span class="op" id="5542714">=</span>&nbsp;<span class="builtinfunc" id="5542716">make</span><span class="op" id="5542720">(</span><span class="op" id="5542721">[</span><span class="op" id="5542722">]</span><span class="builtintype" id="5542723">int</span><span class="op" id="5542726">,</span>&nbsp;<span class="ident" id="5542728">n</span><span class="op" id="5542729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5542734">copy</span><span class="op" id="5542738">(</span><span class="ident" id="5542739">result</span><span class="op" id="5542745">,</span>&nbsp;<span class="ident" id="5542747">matches</span><span class="op" id="5542754">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5542761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5542764">return</span><br>
<span class="lineno"></span><span class="op" id="5542771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5542774">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5542846">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5542917">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5542987">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5543057">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5543131">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5543148">//</span><br>
<span class="lineno"></span><span class="keyword" id="5543151">func</span>&nbsp;<span class="op" id="5543156">(</span><span class="ident" id="5543157">x</span>&nbsp;<span class="op" id="5543159">*</span><span class="ident" id="5543160">Index</span><span class="op" id="5543165">)</span>&nbsp;<span class="ident" id="5543167">FindAllIndex</span><span class="op" id="5543179">(</span><span class="ident" id="5543180">r</span>&nbsp;<span class="op" id="5543182">*</span><span class="ident" id="5543183">regexp</span><span class="op" id="5543189">.</span><span class="ident" id="5543190">Regexp</span><span class="op" id="5543196">,</span>&nbsp;<span class="ident" id="5543198">n</span>&nbsp;<span class="builtintype" id="5543200">int</span><span class="op" id="5543203">)</span>&nbsp;<span class="op" id="5543205">(</span><span class="ident" id="5543206">result</span>&nbsp;<span class="op" id="5543213">[</span><span class="op" id="5543214">]</span><span class="op" id="5543215">[</span><span class="op" id="5543216">]</span><span class="builtintype" id="5543217">int</span><span class="op" id="5543220">)</span>&nbsp;<span class="op" id="5543222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543225">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543286">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543322">prefix</span><span class="op" id="5543328">,</span>&nbsp;<span class="ident" id="5543330">complete</span>&nbsp;<span class="op" id="5543339">:=</span>&nbsp;<span class="ident" id="5543342">r</span><span class="op" id="5543343">.</span><span class="ident" id="5543344">LiteralPrefix</span><span class="op" id="5543357">(</span><span class="op" id="5543358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5543361">lit</span>&nbsp;<span class="op" id="5543365">:=</span>&nbsp;<span class="op" id="5543368">[</span><span class="op" id="5543369">]</span><span class="builtintype" id="5543370">byte</span><span class="op" id="5543374">(</span><span class="ident" id="5543375">prefix</span><span class="op" id="5543381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543385">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543428">if</span>&nbsp;<span class="ident" id="5543431">prefix</span>&nbsp;<span class="op" id="5543438">==</span>&nbsp;<span class="string" id="5543441">&#34;&#34;</span>&nbsp;<span class="op" id="5543444">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543448">return</span>&nbsp;<span class="ident" id="5543455">r</span><span class="op" id="5543456">.</span><span class="ident" id="5543457">FindAllIndex</span><span class="op" id="5543469">(</span><span class="ident" id="5543470">x</span><span class="op" id="5543471">.</span><span class="ident" id="5543472">data</span><span class="op" id="5543476">,</span>&nbsp;<span class="ident" id="5543478">n</span><span class="op" id="5543479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5543482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543486">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543545">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543573">if</span>&nbsp;<span class="ident" id="5543576">complete</span>&nbsp;<span class="op" id="5543585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543589">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543657">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543727">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543792">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543863">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5543932">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5543960">for</span>&nbsp;<span class="ident" id="5543964">n1</span>&nbsp;<span class="op" id="5543967">:=</span>&nbsp;<span class="ident" id="5543970">n</span><span class="op" id="5543971">;</span>&nbsp;<span class="op" id="5543973">;</span>&nbsp;<span class="ident" id="5543975">n1</span>&nbsp;<span class="op" id="5543978">+=</span>&nbsp;<span class="num" id="5543981">2</span>&nbsp;<span class="op" id="5543983">*</span>&nbsp;<span class="op" id="5543985">(</span><span class="ident" id="5543986">n</span>&nbsp;<span class="op" id="5543988">-</span>&nbsp;<span class="builtinfunc" id="5543990">len</span><span class="op" id="5543993">(</span><span class="ident" id="5543994">result</span><span class="op" id="5544000">)</span><span class="op" id="5544001">)</span>&nbsp;<span class="comment" id="5544003">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5544021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544026">indices</span>&nbsp;<span class="op" id="5544034">:=</span>&nbsp;<span class="ident" id="5544037">x</span><span class="op" id="5544038">.</span><span class="ident" id="5544039">Lookup</span><span class="op" id="5544045">(</span><span class="ident" id="5544046">lit</span><span class="op" id="5544049">,</span>&nbsp;<span class="ident" id="5544051">n1</span><span class="op" id="5544053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544058">if</span>&nbsp;<span class="builtinfunc" id="5544061">len</span><span class="op" id="5544064">(</span><span class="ident" id="5544065">indices</span><span class="op" id="5544072">)</span>&nbsp;<span class="op" id="5544074">==</span>&nbsp;<span class="num" id="5544077">0</span>&nbsp;<span class="op" id="5544079">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544085">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544100">sort</span><span class="op" id="5544104">.</span><span class="ident" id="5544105">Ints</span><span class="op" id="5544109">(</span><span class="ident" id="5544110">indices</span><span class="op" id="5544117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544122">pairs</span>&nbsp;<span class="op" id="5544128">:=</span>&nbsp;<span class="builtinfunc" id="5544131">make</span><span class="op" id="5544135">(</span><span class="op" id="5544136">[</span><span class="op" id="5544137">]</span><span class="builtintype" id="5544138">int</span><span class="op" id="5544141">,</span>&nbsp;<span class="num" id="5544143">2</span><span class="op" id="5544144">*</span><span class="builtinfunc" id="5544145">len</span><span class="op" id="5544148">(</span><span class="ident" id="5544149">indices</span><span class="op" id="5544156">)</span><span class="op" id="5544157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544162">result</span>&nbsp;<span class="op" id="5544169">=</span>&nbsp;<span class="builtinfunc" id="5544171">make</span><span class="op" id="5544175">(</span><span class="op" id="5544176">[</span><span class="op" id="5544177">]</span><span class="op" id="5544178">[</span><span class="op" id="5544179">]</span><span class="builtintype" id="5544180">int</span><span class="op" id="5544183">,</span>&nbsp;<span class="builtinfunc" id="5544185">len</span><span class="op" id="5544188">(</span><span class="ident" id="5544189">indices</span><span class="op" id="5544196">)</span><span class="op" id="5544197">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544202">count</span>&nbsp;<span class="op" id="5544208">:=</span>&nbsp;<span class="num" id="5544211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544216">prev</span>&nbsp;<span class="op" id="5544221">:=</span>&nbsp;<span class="num" id="5544224">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544229">for</span>&nbsp;<span class="ident" id="5544233">_</span><span class="op" id="5544234">,</span>&nbsp;<span class="ident" id="5544236">i</span>&nbsp;<span class="op" id="5544238">:=</span>&nbsp;<span class="keyword" id="5544241">range</span>&nbsp;<span class="ident" id="5544247">indices</span>&nbsp;<span class="op" id="5544255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544261">if</span>&nbsp;<span class="ident" id="5544264">count</span>&nbsp;<span class="op" id="5544270">==</span>&nbsp;<span class="ident" id="5544273">n</span>&nbsp;<span class="op" id="5544275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544282">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544298">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544351">if</span>&nbsp;<span class="ident" id="5544354">prev</span>&nbsp;<span class="op" id="5544359">&lt;=</span>&nbsp;<span class="ident" id="5544362">i</span>&nbsp;<span class="op" id="5544364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544371">j</span>&nbsp;<span class="op" id="5544373">:=</span>&nbsp;<span class="num" id="5544376">2</span>&nbsp;<span class="op" id="5544378">*</span>&nbsp;<span class="ident" id="5544380">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544391">pairs</span><span class="op" id="5544396">[</span><span class="ident" id="5544397">j</span><span class="op" id="5544398">+</span><span class="num" id="5544399">0</span><span class="op" id="5544400">]</span>&nbsp;<span class="op" id="5544402">=</span>&nbsp;<span class="ident" id="5544404">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544411">pairs</span><span class="op" id="5544416">[</span><span class="ident" id="5544417">j</span><span class="op" id="5544418">+</span><span class="num" id="5544419">1</span><span class="op" id="5544420">]</span>&nbsp;<span class="op" id="5544422">=</span>&nbsp;<span class="ident" id="5544424">i</span>&nbsp;<span class="op" id="5544426">+</span>&nbsp;<span class="builtinfunc" id="5544428">len</span><span class="op" id="5544431">(</span><span class="ident" id="5544432">lit</span><span class="op" id="5544435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544442">result</span><span class="op" id="5544448">[</span><span class="ident" id="5544449">count</span><span class="op" id="5544454">]</span>&nbsp;<span class="op" id="5544456">=</span>&nbsp;<span class="ident" id="5544458">pairs</span><span class="op" id="5544463">[</span><span class="ident" id="5544464">j</span>&nbsp;<span class="op" id="5544466">:</span>&nbsp;<span class="ident" id="5544468">j</span><span class="op" id="5544469">+</span><span class="num" id="5544470">2</span><span class="op" id="5544471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544478">count</span><span class="op" id="5544483">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544491">prev</span>&nbsp;<span class="op" id="5544496">=</span>&nbsp;<span class="ident" id="5544498">i</span>&nbsp;<span class="op" id="5544500">+</span>&nbsp;<span class="builtinfunc" id="5544502">len</span><span class="op" id="5544505">(</span><span class="ident" id="5544506">lit</span><span class="op" id="5544509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544515">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544525">result</span>&nbsp;<span class="op" id="5544532">=</span>&nbsp;<span class="ident" id="5544534">result</span><span class="op" id="5544540">[</span><span class="num" id="5544541">0</span><span class="op" id="5544542">:</span><span class="ident" id="5544543">count</span><span class="op" id="5544548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544553">if</span>&nbsp;<span class="builtinfunc" id="5544556">len</span><span class="op" id="5544559">(</span><span class="ident" id="5544560">result</span><span class="op" id="5544566">)</span>&nbsp;<span class="op" id="5544568">&gt;=</span>&nbsp;<span class="ident" id="5544571">n</span>&nbsp;<span class="op" id="5544573">||</span>&nbsp;<span class="builtinfunc" id="5544576">len</span><span class="op" id="5544579">(</span><span class="ident" id="5544580">indices</span><span class="op" id="5544587">)</span>&nbsp;<span class="op" id="5544589">!=</span>&nbsp;<span class="ident" id="5544592">n1</span>&nbsp;<span class="op" id="5544595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544601">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544660">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544694">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544711">if</span>&nbsp;<span class="builtinfunc" id="5544714">len</span><span class="op" id="5544717">(</span><span class="ident" id="5544718">result</span><span class="op" id="5544724">)</span>&nbsp;<span class="op" id="5544726">==</span>&nbsp;<span class="num" id="5544729">0</span>&nbsp;<span class="op" id="5544731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544736">result</span>&nbsp;<span class="op" id="5544743">=</span>&nbsp;<span class="ident" id="5544745">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5544755">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5544763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544767">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544831">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544899">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5544932">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5544999">r</span>&nbsp;<span class="op" id="5545001">=</span>&nbsp;<span class="ident" id="5545003">regexp</span><span class="op" id="5545009">.</span><span class="ident" id="5545010">MustCompile</span><span class="op" id="5545021">(</span><span class="string" id="5545022">&#34;^&#34;</span>&nbsp;<span class="op" id="5545026">+</span>&nbsp;<span class="ident" id="5545028">r</span><span class="op" id="5545029">.</span><span class="ident" id="5545030">String</span><span class="op" id="5545036">(</span><span class="op" id="5545037">)</span><span class="op" id="5545038">)</span>&nbsp;<span class="comment" id="5545040">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545073">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545137">for</span>&nbsp;<span class="ident" id="5545141">n1</span>&nbsp;<span class="op" id="5545144">:=</span>&nbsp;<span class="ident" id="5545147">n</span><span class="op" id="5545148">;</span>&nbsp;<span class="op" id="5545150">;</span>&nbsp;<span class="ident" id="5545152">n1</span>&nbsp;<span class="op" id="5545155">+=</span>&nbsp;<span class="num" id="5545158">2</span>&nbsp;<span class="op" id="5545160">*</span>&nbsp;<span class="op" id="5545162">(</span><span class="ident" id="5545163">n</span>&nbsp;<span class="op" id="5545165">-</span>&nbsp;<span class="builtinfunc" id="5545167">len</span><span class="op" id="5545170">(</span><span class="ident" id="5545171">result</span><span class="op" id="5545177">)</span><span class="op" id="5545178">)</span>&nbsp;<span class="comment" id="5545180">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5545198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545202">indices</span>&nbsp;<span class="op" id="5545210">:=</span>&nbsp;<span class="ident" id="5545213">x</span><span class="op" id="5545214">.</span><span class="ident" id="5545215">Lookup</span><span class="op" id="5545221">(</span><span class="ident" id="5545222">lit</span><span class="op" id="5545225">,</span>&nbsp;<span class="ident" id="5545227">n1</span><span class="op" id="5545229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545233">if</span>&nbsp;<span class="builtinfunc" id="5545236">len</span><span class="op" id="5545239">(</span><span class="ident" id="5545240">indices</span><span class="op" id="5545247">)</span>&nbsp;<span class="op" id="5545249">==</span>&nbsp;<span class="num" id="5545252">0</span>&nbsp;<span class="op" id="5545254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545259">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545272">sort</span><span class="op" id="5545276">.</span><span class="ident" id="5545277">Ints</span><span class="op" id="5545281">(</span><span class="ident" id="5545282">indices</span><span class="op" id="5545289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545293">result</span>&nbsp;<span class="op" id="5545300">=</span>&nbsp;<span class="ident" id="5545302">result</span><span class="op" id="5545308">[</span><span class="num" id="5545309">0</span><span class="op" id="5545310">:</span><span class="num" id="5545311">0</span><span class="op" id="5545312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545316">prev</span>&nbsp;<span class="op" id="5545321">:=</span>&nbsp;<span class="num" id="5545324">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545328">for</span>&nbsp;<span class="ident" id="5545332">_</span><span class="op" id="5545333">,</span>&nbsp;<span class="ident" id="5545335">i</span>&nbsp;<span class="op" id="5545337">:=</span>&nbsp;<span class="keyword" id="5545340">range</span>&nbsp;<span class="ident" id="5545346">indices</span>&nbsp;<span class="op" id="5545354">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545359">if</span>&nbsp;<span class="builtinfunc" id="5545362">len</span><span class="op" id="5545365">(</span><span class="ident" id="5545366">result</span><span class="op" id="5545372">)</span>&nbsp;<span class="op" id="5545374">==</span>&nbsp;<span class="ident" id="5545377">n</span>&nbsp;<span class="op" id="5545379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545385">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545399">m</span>&nbsp;<span class="op" id="5545401">:=</span>&nbsp;<span class="ident" id="5545404">r</span><span class="op" id="5545405">.</span><span class="ident" id="5545406">FindIndex</span><span class="op" id="5545415">(</span><span class="ident" id="5545416">x</span><span class="op" id="5545417">.</span><span class="ident" id="5545418">data</span><span class="op" id="5545422">[</span><span class="ident" id="5545423">i</span><span class="op" id="5545424">:</span><span class="op" id="5545425">]</span><span class="op" id="5545426">)</span>&nbsp;<span class="comment" id="5545428">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545469">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545521">if</span>&nbsp;<span class="ident" id="5545524">m</span>&nbsp;<span class="op" id="5545526">!=</span>&nbsp;<span class="ident" id="5545529">nil</span>&nbsp;<span class="op" id="5545533">&amp;&amp;</span>&nbsp;<span class="ident" id="5545536">prev</span>&nbsp;<span class="op" id="5545541">&lt;=</span>&nbsp;<span class="ident" id="5545544">i</span>&nbsp;<span class="op" id="5545546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545552">m</span><span class="op" id="5545553">[</span><span class="num" id="5545554">0</span><span class="op" id="5545555">]</span>&nbsp;<span class="op" id="5545557">=</span>&nbsp;<span class="ident" id="5545559">i</span>&nbsp;<span class="comment" id="5545561">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545578">m</span><span class="op" id="5545579">[</span><span class="num" id="5545580">1</span><span class="op" id="5545581">]</span>&nbsp;<span class="op" id="5545583">+=</span>&nbsp;<span class="ident" id="5545586">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545592">result</span>&nbsp;<span class="op" id="5545599">=</span>&nbsp;<span class="builtinfunc" id="5545601">append</span><span class="op" id="5545607">(</span><span class="ident" id="5545608">result</span><span class="op" id="5545614">,</span>&nbsp;<span class="ident" id="5545616">m</span><span class="op" id="5545617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545623">prev</span>&nbsp;<span class="op" id="5545628">=</span>&nbsp;<span class="ident" id="5545630">m</span><span class="op" id="5545631">[</span><span class="num" id="5545632">1</span><span class="op" id="5545633">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545646">if</span>&nbsp;<span class="builtinfunc" id="5545649">len</span><span class="op" id="5545652">(</span><span class="ident" id="5545653">result</span><span class="op" id="5545659">)</span>&nbsp;<span class="op" id="5545661">&gt;=</span>&nbsp;<span class="ident" id="5545664">n</span>&nbsp;<span class="op" id="5545666">||</span>&nbsp;<span class="builtinfunc" id="5545669">len</span><span class="op" id="5545672">(</span><span class="ident" id="5545673">indices</span><span class="op" id="5545680">)</span>&nbsp;<span class="op" id="5545682">!=</span>&nbsp;<span class="ident" id="5545685">n1</span>&nbsp;<span class="op" id="5545688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545693">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5545751">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545784">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545798">if</span>&nbsp;<span class="builtinfunc" id="5545801">len</span><span class="op" id="5545804">(</span><span class="ident" id="5545805">result</span><span class="op" id="5545811">)</span>&nbsp;<span class="op" id="5545813">==</span>&nbsp;<span class="num" id="5545816">0</span>&nbsp;<span class="op" id="5545818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5545822">result</span>&nbsp;<span class="op" id="5545829">=</span>&nbsp;<span class="ident" id="5545831">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5545836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5545839">return</span><br>
<span class="lineno"></span><span class="op" id="5545846">}</span>
</div>
</body>
</html>
