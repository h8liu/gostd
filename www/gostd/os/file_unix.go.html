<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2483240">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2483295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2483349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2483400">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2483470">package</span>&nbsp;<span class="ident" id="2483478">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2483482">import</span>&nbsp;<span class="op" id="2483489">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483492">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483503">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2483518">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2483528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2483531">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2483575">type</span>&nbsp;<span class="ident" id="2483580">File</span>&nbsp;<span class="keyword" id="2483585">struct</span>&nbsp;<span class="op" id="2483592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2483595">*</span><span class="ident" id="2483596">file</span><br>
<span class="lineno"></span><span class="op" id="2483601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2483604">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2483649">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2483713">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2483773">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2483812">type</span>&nbsp;<span class="ident" id="2483817">file</span>&nbsp;<span class="keyword" id="2483822">struct</span>&nbsp;<span class="op" id="2483829">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483832">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2483840">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483845">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2483853">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483861">dirinfo</span>&nbsp;<span class="op" id="2483869">*</span><span class="ident" id="2483870">dirInfo</span>&nbsp;<span class="comment" id="2483878">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2483914">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2483922">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2483931">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2483971">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2483974">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2484048">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2484136">func</span>&nbsp;<span class="op" id="2484141">(</span><span class="ident" id="2484142">f</span>&nbsp;<span class="op" id="2484144">*</span><span class="ident" id="2484145">File</span><span class="op" id="2484149">)</span>&nbsp;<span class="ident" id="2484151">Fd</span><span class="op" id="2484153">(</span><span class="op" id="2484154">)</span>&nbsp;<span class="builtintype" id="2484156">uintptr</span>&nbsp;<span class="op" id="2484164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484167">if</span>&nbsp;<span class="ident" id="2484170">f</span>&nbsp;<span class="op" id="2484172">==</span>&nbsp;<span class="ident" id="2484175">nil</span>&nbsp;<span class="op" id="2484179">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484183">return</span>&nbsp;<span class="op" id="2484190">^</span><span class="op" id="2484191">(</span><span class="builtintype" id="2484192">uintptr</span><span class="op" id="2484199">(</span><span class="num" id="2484200">0</span><span class="op" id="2484201">)</span><span class="op" id="2484202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484208">return</span>&nbsp;<span class="builtintype" id="2484215">uintptr</span><span class="op" id="2484222">(</span><span class="ident" id="2484223">f</span><span class="op" id="2484224">.</span><span class="ident" id="2484225">fd</span><span class="op" id="2484227">)</span><br>
<span class="lineno"></span><span class="op" id="2484229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2484232">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2484303">func</span>&nbsp;<span class="ident" id="2484308">NewFile</span><span class="op" id="2484315">(</span><span class="ident" id="2484316">fd</span>&nbsp;<span class="builtintype" id="2484319">uintptr</span><span class="op" id="2484326">,</span>&nbsp;<span class="ident" id="2484328">name</span>&nbsp;<span class="builtintype" id="2484333">string</span><span class="op" id="2484339">)</span>&nbsp;<span class="op" id="2484341">*</span><span class="ident" id="2484342">File</span>&nbsp;<span class="op" id="2484347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484350">fdi</span>&nbsp;<span class="op" id="2484354">:=</span>&nbsp;<span class="builtintype" id="2484357">int</span><span class="op" id="2484360">(</span><span class="ident" id="2484361">fd</span><span class="op" id="2484363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484366">if</span>&nbsp;<span class="ident" id="2484369">fdi</span>&nbsp;<span class="op" id="2484373">&lt;</span>&nbsp;<span class="num" id="2484375">0</span>&nbsp;<span class="op" id="2484377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484381">return</span>&nbsp;<span class="ident" id="2484388">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484396">f</span>&nbsp;<span class="op" id="2484398">:=</span>&nbsp;<span class="op" id="2484401">&amp;</span><span class="ident" id="2484402">File</span><span class="op" id="2484406">{</span><span class="op" id="2484407">&amp;</span><span class="ident" id="2484408">file</span><span class="op" id="2484412">{</span><span class="ident" id="2484413">fd</span><span class="op" id="2484415">:</span>&nbsp;<span class="ident" id="2484417">fdi</span><span class="op" id="2484420">,</span>&nbsp;<span class="ident" id="2484422">name</span><span class="op" id="2484426">:</span>&nbsp;<span class="ident" id="2484428">name</span><span class="op" id="2484432">}</span><span class="op" id="2484433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484436">runtime</span><span class="op" id="2484443">.</span><span class="ident" id="2484444">SetFinalizer</span><span class="op" id="2484456">(</span><span class="ident" id="2484457">f</span><span class="op" id="2484458">.</span><span class="ident" id="2484459">file</span><span class="op" id="2484463">,</span>&nbsp;<span class="op" id="2484465">(</span><span class="op" id="2484466">*</span><span class="ident" id="2484467">file</span><span class="op" id="2484471">)</span><span class="op" id="2484472">.</span><span class="builtinfunc" id="2484473">close</span><span class="op" id="2484478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484481">return</span>&nbsp;<span class="ident" id="2484488">f</span><br>
<span class="lineno"></span><span class="op" id="2484490">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2484493">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2484552">type</span>&nbsp;<span class="ident" id="2484557">dirInfo</span>&nbsp;<span class="keyword" id="2484565">struct</span>&nbsp;<span class="op" id="2484572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484575">buf</span>&nbsp;&nbsp;<span class="op" id="2484580">[</span><span class="op" id="2484581">]</span><span class="builtintype" id="2484582">byte</span>&nbsp;<span class="comment" id="2484587">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484616">nbuf</span>&nbsp;<span class="builtintype" id="2484621">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2484628">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484679">bufp</span>&nbsp;<span class="builtintype" id="2484684">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2484691">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2484726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2484729">func</span>&nbsp;<span class="ident" id="2484734">epipecheck</span><span class="op" id="2484744">(</span><span class="ident" id="2484745">file</span>&nbsp;<span class="op" id="2484750">*</span><span class="ident" id="2484751">File</span><span class="op" id="2484755">,</span>&nbsp;<span class="ident" id="2484757">e</span>&nbsp;<span class="builtintype" id="2484759">error</span><span class="op" id="2484764">)</span>&nbsp;<span class="op" id="2484766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484769">if</span>&nbsp;<span class="ident" id="2484772">e</span>&nbsp;<span class="op" id="2484774">==</span>&nbsp;<span class="ident" id="2484777">syscall</span><span class="op" id="2484784">.</span><span class="ident" id="2484785">EPIPE</span>&nbsp;<span class="op" id="2484791">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2484795">if</span>&nbsp;<span class="ident" id="2484798">atomic</span><span class="op" id="2484804">.</span><span class="ident" id="2484805">AddInt32</span><span class="op" id="2484813">(</span><span class="op" id="2484814">&amp;</span><span class="ident" id="2484815">file</span><span class="op" id="2484819">.</span><span class="ident" id="2484820">nepipe</span><span class="op" id="2484826">,</span>&nbsp;<span class="num" id="2484828">1</span><span class="op" id="2484829">)</span>&nbsp;<span class="op" id="2484831">&gt;=</span>&nbsp;<span class="num" id="2484834">10</span>&nbsp;<span class="op" id="2484837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484842">sigpipe</span><span class="op" id="2484849">(</span><span class="op" id="2484850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484857">}</span>&nbsp;<span class="keyword" id="2484859">else</span>&nbsp;<span class="op" id="2484864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2484868">atomic</span><span class="op" id="2484874">.</span><span class="ident" id="2484875">StoreInt32</span><span class="op" id="2484885">(</span><span class="op" id="2484886">&amp;</span><span class="ident" id="2484887">file</span><span class="op" id="2484891">.</span><span class="ident" id="2484892">nepipe</span><span class="op" id="2484898">,</span>&nbsp;<span class="num" id="2484900">0</span><span class="op" id="2484901">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2484904">}</span><br>
<span class="lineno"></span><span class="op" id="2484906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2484909">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2484975">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2485038">const</span>&nbsp;<span class="ident" id="2485044">DevNull</span>&nbsp;<span class="op" id="2485052">=</span>&nbsp;<span class="string" id="2485054">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2485067">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2485134">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2485201">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2485273">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2485326">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2485382">func</span>&nbsp;<span class="ident" id="2485387">OpenFile</span><span class="op" id="2485395">(</span><span class="ident" id="2485396">name</span>&nbsp;<span class="builtintype" id="2485401">string</span><span class="op" id="2485407">,</span>&nbsp;<span class="ident" id="2485409">flag</span>&nbsp;<span class="builtintype" id="2485414">int</span><span class="op" id="2485417">,</span>&nbsp;<span class="ident" id="2485419">perm</span>&nbsp;<span class="ident" id="2485424">FileMode</span><span class="op" id="2485432">)</span>&nbsp;<span class="op" id="2485434">(</span><span class="ident" id="2485435">file</span>&nbsp;<span class="op" id="2485440">*</span><span class="ident" id="2485441">File</span><span class="op" id="2485445">,</span>&nbsp;<span class="ident" id="2485447">err</span>&nbsp;<span class="builtintype" id="2485451">error</span><span class="op" id="2485456">)</span>&nbsp;<span class="op" id="2485458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485461">r</span><span class="op" id="2485462">,</span>&nbsp;<span class="ident" id="2485464">e</span>&nbsp;<span class="op" id="2485466">:=</span>&nbsp;<span class="ident" id="2485469">syscall</span><span class="op" id="2485476">.</span><span class="ident" id="2485477">Open</span><span class="op" id="2485481">(</span><span class="ident" id="2485482">name</span><span class="op" id="2485486">,</span>&nbsp;<span class="ident" id="2485488">flag</span><span class="op" id="2485492">|</span><span class="ident" id="2485493">syscall</span><span class="op" id="2485500">.</span><span class="ident" id="2485501">O_CLOEXEC</span><span class="op" id="2485510">,</span>&nbsp;<span class="ident" id="2485512">syscallMode</span><span class="op" id="2485523">(</span><span class="ident" id="2485524">perm</span><span class="op" id="2485528">)</span><span class="op" id="2485529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485532">if</span>&nbsp;<span class="ident" id="2485535">e</span>&nbsp;<span class="op" id="2485537">!=</span>&nbsp;<span class="ident" id="2485540">nil</span>&nbsp;<span class="op" id="2485544">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485548">return</span>&nbsp;<span class="ident" id="2485555">nil</span><span class="op" id="2485558">,</span>&nbsp;<span class="op" id="2485560">&amp;</span><span class="ident" id="2485561">PathError</span><span class="op" id="2485570">{</span><span class="string" id="2485571">&#34;open&#34;</span><span class="op" id="2485577">,</span>&nbsp;<span class="ident" id="2485579">name</span><span class="op" id="2485583">,</span>&nbsp;<span class="ident" id="2485585">e</span><span class="op" id="2485586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2485593">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2485646">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485702">if</span>&nbsp;<span class="op" id="2485705">!</span><span class="ident" id="2485706">supportsCloseOnExec</span>&nbsp;<span class="op" id="2485726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2485730">syscall</span><span class="op" id="2485737">.</span><span class="ident" id="2485738">CloseOnExec</span><span class="op" id="2485749">(</span><span class="ident" id="2485750">r</span><span class="op" id="2485751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485758">return</span>&nbsp;<span class="ident" id="2485765">NewFile</span><span class="op" id="2485772">(</span><span class="builtintype" id="2485773">uintptr</span><span class="op" id="2485780">(</span><span class="ident" id="2485781">r</span><span class="op" id="2485782">)</span><span class="op" id="2485783">,</span>&nbsp;<span class="ident" id="2485785">name</span><span class="op" id="2485789">)</span><span class="op" id="2485790">,</span>&nbsp;<span class="ident" id="2485792">nil</span><br>
<span class="lineno">90</span><span class="op" id="2485796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2485799">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2485856">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2485888">func</span>&nbsp;<span class="op" id="2485893">(</span><span class="ident" id="2485894">f</span>&nbsp;<span class="op" id="2485896">*</span><span class="ident" id="2485897">File</span><span class="op" id="2485901">)</span>&nbsp;<span class="ident" id="2485903">Close</span><span class="op" id="2485908">(</span><span class="op" id="2485909">)</span>&nbsp;<span class="builtintype" id="2485911">error</span>&nbsp;<span class="op" id="2485917">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485920">if</span>&nbsp;<span class="ident" id="2485923">f</span>&nbsp;<span class="op" id="2485925">==</span>&nbsp;<span class="ident" id="2485928">nil</span>&nbsp;<span class="op" id="2485932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485936">return</span>&nbsp;<span class="ident" id="2485943">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2485955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2485958">return</span>&nbsp;<span class="ident" id="2485965">f</span><span class="op" id="2485966">.</span><span class="ident" id="2485967">file</span><span class="op" id="2485971">.</span><span class="builtinfunc" id="2485972">close</span><span class="op" id="2485977">(</span><span class="op" id="2485978">)</span><br>
<span class="lineno"></span><span class="op" id="2485980">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2485983">func</span>&nbsp;<span class="op" id="2485988">(</span><span class="ident" id="2485989">file</span>&nbsp;<span class="op" id="2485994">*</span><span class="ident" id="2485995">file</span><span class="op" id="2485999">)</span>&nbsp;<span class="builtinfunc" id="2486001">close</span><span class="op" id="2486006">(</span><span class="op" id="2486007">)</span>&nbsp;<span class="builtintype" id="2486009">error</span>&nbsp;<span class="op" id="2486015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486018">if</span>&nbsp;<span class="ident" id="2486021">file</span>&nbsp;<span class="op" id="2486026">==</span>&nbsp;<span class="ident" id="2486029">nil</span>&nbsp;<span class="op" id="2486033">||</span>&nbsp;<span class="ident" id="2486036">file</span><span class="op" id="2486040">.</span><span class="ident" id="2486041">fd</span>&nbsp;<span class="op" id="2486044">&lt;</span>&nbsp;<span class="num" id="2486046">0</span>&nbsp;<span class="op" id="2486048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486052">return</span>&nbsp;<span class="ident" id="2486059">syscall</span><span class="op" id="2486066">.</span><span class="ident" id="2486067">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2486075">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486078">var</span>&nbsp;<span class="ident" id="2486082">err</span>&nbsp;<span class="builtintype" id="2486086">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486093">if</span>&nbsp;<span class="ident" id="2486096">e</span>&nbsp;<span class="op" id="2486098">:=</span>&nbsp;<span class="ident" id="2486101">syscall</span><span class="op" id="2486108">.</span><span class="ident" id="2486109">Close</span><span class="op" id="2486114">(</span><span class="ident" id="2486115">file</span><span class="op" id="2486119">.</span><span class="ident" id="2486120">fd</span><span class="op" id="2486122">)</span><span class="op" id="2486123">;</span>&nbsp;<span class="ident" id="2486125">e</span>&nbsp;<span class="op" id="2486127">!=</span>&nbsp;<span class="ident" id="2486130">nil</span>&nbsp;<span class="op" id="2486134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2486138">err</span>&nbsp;<span class="op" id="2486142">=</span>&nbsp;<span class="op" id="2486144">&amp;</span><span class="ident" id="2486145">PathError</span><span class="op" id="2486154">{</span><span class="string" id="2486155">&#34;close&#34;</span><span class="op" id="2486162">,</span>&nbsp;<span class="ident" id="2486164">file</span><span class="op" id="2486168">.</span><span class="ident" id="2486169">name</span><span class="op" id="2486173">,</span>&nbsp;<span class="ident" id="2486175">e</span><span class="op" id="2486176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2486179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2486182">file</span><span class="op" id="2486186">.</span><span class="ident" id="2486187">fd</span>&nbsp;<span class="op" id="2486190">=</span>&nbsp;<span class="op" id="2486192">-</span><span class="num" id="2486193">1</span>&nbsp;<span class="comment" id="2486195">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2486228">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2486264">runtime</span><span class="op" id="2486271">.</span><span class="ident" id="2486272">SetFinalizer</span><span class="op" id="2486284">(</span><span class="ident" id="2486285">file</span><span class="op" id="2486289">,</span>&nbsp;<span class="ident" id="2486291">nil</span><span class="op" id="2486294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486297">return</span>&nbsp;<span class="ident" id="2486304">err</span><br>
<span class="lineno"></span><span class="op" id="2486308">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2486311">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2486367">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2486423">func</span>&nbsp;<span class="op" id="2486428">(</span><span class="ident" id="2486429">f</span>&nbsp;<span class="op" id="2486431">*</span><span class="ident" id="2486432">File</span><span class="op" id="2486436">)</span>&nbsp;<span class="ident" id="2486438">Stat</span><span class="op" id="2486442">(</span><span class="op" id="2486443">)</span>&nbsp;<span class="op" id="2486445">(</span><span class="ident" id="2486446">fi</span>&nbsp;<span class="ident" id="2486449">FileInfo</span><span class="op" id="2486457">,</span>&nbsp;<span class="ident" id="2486459">err</span>&nbsp;<span class="builtintype" id="2486463">error</span><span class="op" id="2486468">)</span>&nbsp;<span class="op" id="2486470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486473">if</span>&nbsp;<span class="ident" id="2486476">f</span>&nbsp;<span class="op" id="2486478">==</span>&nbsp;<span class="ident" id="2486481">nil</span>&nbsp;<span class="op" id="2486485">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486489">return</span>&nbsp;<span class="ident" id="2486496">nil</span><span class="op" id="2486499">,</span>&nbsp;<span class="ident" id="2486501">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2486513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486516">var</span>&nbsp;<span class="ident" id="2486520">stat</span>&nbsp;<span class="ident" id="2486525">syscall</span><span class="op" id="2486532">.</span><span class="ident" id="2486533">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2486541">err</span>&nbsp;<span class="op" id="2486545">=</span>&nbsp;<span class="ident" id="2486547">syscall</span><span class="op" id="2486554">.</span><span class="ident" id="2486555">Fstat</span><span class="op" id="2486560">(</span><span class="ident" id="2486561">f</span><span class="op" id="2486562">.</span><span class="ident" id="2486563">fd</span><span class="op" id="2486565">,</span>&nbsp;<span class="op" id="2486567">&amp;</span><span class="ident" id="2486568">stat</span><span class="op" id="2486572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486575">if</span>&nbsp;<span class="ident" id="2486578">err</span>&nbsp;<span class="op" id="2486582">!=</span>&nbsp;<span class="ident" id="2486585">nil</span>&nbsp;<span class="op" id="2486589">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486593">return</span>&nbsp;<span class="ident" id="2486600">nil</span><span class="op" id="2486603">,</span>&nbsp;<span class="op" id="2486605">&amp;</span><span class="ident" id="2486606">PathError</span><span class="op" id="2486615">{</span><span class="string" id="2486616">&#34;stat&#34;</span><span class="op" id="2486622">,</span>&nbsp;<span class="ident" id="2486624">f</span><span class="op" id="2486625">.</span><span class="ident" id="2486626">name</span><span class="op" id="2486630">,</span>&nbsp;<span class="ident" id="2486632">err</span><span class="op" id="2486635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2486638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486641">return</span>&nbsp;<span class="ident" id="2486648">fileInfoFromStat</span><span class="op" id="2486664">(</span><span class="op" id="2486665">&amp;</span><span class="ident" id="2486666">stat</span><span class="op" id="2486670">,</span>&nbsp;<span class="ident" id="2486672">f</span><span class="op" id="2486673">.</span><span class="ident" id="2486674">name</span><span class="op" id="2486678">)</span><span class="op" id="2486679">,</span>&nbsp;<span class="ident" id="2486681">nil</span><br>
<span class="lineno"></span><span class="op" id="2486685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2486688">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2486742">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2486798">func</span>&nbsp;<span class="ident" id="2486803">Stat</span><span class="op" id="2486807">(</span><span class="ident" id="2486808">name</span>&nbsp;<span class="builtintype" id="2486813">string</span><span class="op" id="2486819">)</span>&nbsp;<span class="op" id="2486821">(</span><span class="ident" id="2486822">fi</span>&nbsp;<span class="ident" id="2486825">FileInfo</span><span class="op" id="2486833">,</span>&nbsp;<span class="ident" id="2486835">err</span>&nbsp;<span class="builtintype" id="2486839">error</span><span class="op" id="2486844">)</span>&nbsp;<span class="op" id="2486846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486849">var</span>&nbsp;<span class="ident" id="2486853">stat</span>&nbsp;<span class="ident" id="2486858">syscall</span><span class="op" id="2486865">.</span><span class="ident" id="2486866">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2486874">err</span>&nbsp;<span class="op" id="2486878">=</span>&nbsp;<span class="ident" id="2486880">syscall</span><span class="op" id="2486887">.</span><span class="ident" id="2486888">Stat</span><span class="op" id="2486892">(</span><span class="ident" id="2486893">name</span><span class="op" id="2486897">,</span>&nbsp;<span class="op" id="2486899">&amp;</span><span class="ident" id="2486900">stat</span><span class="op" id="2486904">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486907">if</span>&nbsp;<span class="ident" id="2486910">err</span>&nbsp;<span class="op" id="2486914">!=</span>&nbsp;<span class="ident" id="2486917">nil</span>&nbsp;<span class="op" id="2486921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486925">return</span>&nbsp;<span class="ident" id="2486932">nil</span><span class="op" id="2486935">,</span>&nbsp;<span class="op" id="2486937">&amp;</span><span class="ident" id="2486938">PathError</span><span class="op" id="2486947">{</span><span class="string" id="2486948">&#34;stat&#34;</span><span class="op" id="2486954">,</span>&nbsp;<span class="ident" id="2486956">name</span><span class="op" id="2486960">,</span>&nbsp;<span class="ident" id="2486962">err</span><span class="op" id="2486965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2486968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2486971">return</span>&nbsp;<span class="ident" id="2486978">fileInfoFromStat</span><span class="op" id="2486994">(</span><span class="op" id="2486995">&amp;</span><span class="ident" id="2486996">stat</span><span class="op" id="2487000">,</span>&nbsp;<span class="ident" id="2487002">name</span><span class="op" id="2487006">)</span><span class="op" id="2487007">,</span>&nbsp;<span class="ident" id="2487009">nil</span><br>
<span class="lineno"></span><span class="op" id="2487013">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2487016">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2487071">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2487128">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2487204">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2487260">func</span>&nbsp;<span class="ident" id="2487265">Lstat</span><span class="op" id="2487270">(</span><span class="ident" id="2487271">name</span>&nbsp;<span class="builtintype" id="2487276">string</span><span class="op" id="2487282">)</span>&nbsp;<span class="op" id="2487284">(</span><span class="ident" id="2487285">fi</span>&nbsp;<span class="ident" id="2487288">FileInfo</span><span class="op" id="2487296">,</span>&nbsp;<span class="ident" id="2487298">err</span>&nbsp;<span class="builtintype" id="2487302">error</span><span class="op" id="2487307">)</span>&nbsp;<span class="op" id="2487309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487312">var</span>&nbsp;<span class="ident" id="2487316">stat</span>&nbsp;<span class="ident" id="2487321">syscall</span><span class="op" id="2487328">.</span><span class="ident" id="2487329">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487337">err</span>&nbsp;<span class="op" id="2487341">=</span>&nbsp;<span class="ident" id="2487343">syscall</span><span class="op" id="2487350">.</span><span class="ident" id="2487351">Lstat</span><span class="op" id="2487356">(</span><span class="ident" id="2487357">name</span><span class="op" id="2487361">,</span>&nbsp;<span class="op" id="2487363">&amp;</span><span class="ident" id="2487364">stat</span><span class="op" id="2487368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487371">if</span>&nbsp;<span class="ident" id="2487374">err</span>&nbsp;<span class="op" id="2487378">!=</span>&nbsp;<span class="ident" id="2487381">nil</span>&nbsp;<span class="op" id="2487385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487389">return</span>&nbsp;<span class="ident" id="2487396">nil</span><span class="op" id="2487399">,</span>&nbsp;<span class="op" id="2487401">&amp;</span><span class="ident" id="2487402">PathError</span><span class="op" id="2487411">{</span><span class="string" id="2487412">&#34;lstat&#34;</span><span class="op" id="2487419">,</span>&nbsp;<span class="ident" id="2487421">name</span><span class="op" id="2487425">,</span>&nbsp;<span class="ident" id="2487427">err</span><span class="op" id="2487430">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2487433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487436">return</span>&nbsp;<span class="ident" id="2487443">fileInfoFromStat</span><span class="op" id="2487459">(</span><span class="op" id="2487460">&amp;</span><span class="ident" id="2487461">stat</span><span class="op" id="2487465">,</span>&nbsp;<span class="ident" id="2487467">name</span><span class="op" id="2487471">)</span><span class="op" id="2487472">,</span>&nbsp;<span class="ident" id="2487474">nil</span><br>
<span class="lineno"></span><span class="op" id="2487478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2487481">func</span>&nbsp;<span class="op" id="2487486">(</span><span class="ident" id="2487487">f</span>&nbsp;<span class="op" id="2487489">*</span><span class="ident" id="2487490">File</span><span class="op" id="2487494">)</span>&nbsp;<span class="ident" id="2487496">readdir</span><span class="op" id="2487503">(</span><span class="ident" id="2487504">n</span>&nbsp;<span class="builtintype" id="2487506">int</span><span class="op" id="2487509">)</span>&nbsp;<span class="op" id="2487511">(</span><span class="ident" id="2487512">fi</span>&nbsp;<span class="op" id="2487515">[</span><span class="op" id="2487516">]</span><span class="ident" id="2487517">FileInfo</span><span class="op" id="2487525">,</span>&nbsp;<span class="ident" id="2487527">err</span>&nbsp;<span class="builtintype" id="2487531">error</span><span class="op" id="2487536">)</span>&nbsp;<span class="op" id="2487538">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487541">dirname</span>&nbsp;<span class="op" id="2487549">:=</span>&nbsp;<span class="ident" id="2487552">f</span><span class="op" id="2487553">.</span><span class="ident" id="2487554">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487560">if</span>&nbsp;<span class="ident" id="2487563">dirname</span>&nbsp;<span class="op" id="2487571">==</span>&nbsp;<span class="string" id="2487574">&#34;&#34;</span>&nbsp;<span class="op" id="2487577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487581">dirname</span>&nbsp;<span class="op" id="2487589">=</span>&nbsp;<span class="string" id="2487591">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2487596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487599">names</span><span class="op" id="2487604">,</span>&nbsp;<span class="ident" id="2487606">err</span>&nbsp;<span class="op" id="2487610">:=</span>&nbsp;<span class="ident" id="2487613">f</span><span class="op" id="2487614">.</span><span class="ident" id="2487615">Readdirnames</span><span class="op" id="2487627">(</span><span class="ident" id="2487628">n</span><span class="op" id="2487629">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487632">fi</span>&nbsp;<span class="op" id="2487635">=</span>&nbsp;<span class="builtinfunc" id="2487637">make</span><span class="op" id="2487641">(</span><span class="op" id="2487642">[</span><span class="op" id="2487643">]</span><span class="ident" id="2487644">FileInfo</span><span class="op" id="2487652">,</span>&nbsp;<span class="num" id="2487654">0</span><span class="op" id="2487655">,</span>&nbsp;<span class="builtinfunc" id="2487657">len</span><span class="op" id="2487660">(</span><span class="ident" id="2487661">names</span><span class="op" id="2487666">)</span><span class="op" id="2487667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487670">for</span>&nbsp;<span class="ident" id="2487674">_</span><span class="op" id="2487675">,</span>&nbsp;<span class="ident" id="2487677">filename</span>&nbsp;<span class="op" id="2487686">:=</span>&nbsp;<span class="keyword" id="2487689">range</span>&nbsp;<span class="ident" id="2487695">names</span>&nbsp;<span class="op" id="2487701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487705">fip</span><span class="op" id="2487708">,</span>&nbsp;<span class="ident" id="2487710">lerr</span>&nbsp;<span class="op" id="2487715">:=</span>&nbsp;<span class="ident" id="2487718">lstat</span><span class="op" id="2487723">(</span><span class="ident" id="2487724">dirname</span>&nbsp;<span class="op" id="2487732">+</span>&nbsp;<span class="string" id="2487734">&#34;/&#34;</span>&nbsp;<span class="op" id="2487738">+</span>&nbsp;<span class="ident" id="2487740">filename</span><span class="op" id="2487748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487752">if</span>&nbsp;<span class="ident" id="2487755">IsNotExist</span><span class="op" id="2487765">(</span><span class="ident" id="2487766">lerr</span><span class="op" id="2487770">)</span>&nbsp;<span class="op" id="2487772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2487777">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2487824">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487867">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2487878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487882">if</span>&nbsp;<span class="ident" id="2487885">lerr</span>&nbsp;<span class="op" id="2487890">!=</span>&nbsp;<span class="ident" id="2487893">nil</span>&nbsp;<span class="op" id="2487897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487902">return</span>&nbsp;<span class="ident" id="2487909">fi</span><span class="op" id="2487911">,</span>&nbsp;<span class="ident" id="2487913">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2487920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2487924">fi</span>&nbsp;<span class="op" id="2487927">=</span>&nbsp;<span class="builtinfunc" id="2487929">append</span><span class="op" id="2487935">(</span><span class="ident" id="2487936">fi</span><span class="op" id="2487938">,</span>&nbsp;<span class="ident" id="2487940">fip</span><span class="op" id="2487943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2487946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2487949">return</span>&nbsp;<span class="ident" id="2487956">fi</span><span class="op" id="2487958">,</span>&nbsp;<span class="ident" id="2487960">err</span><br>
<span class="lineno"></span><span class="op" id="2487964">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2487967">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2488025">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2488079">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2488133">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2488151">const</span>&nbsp;<span class="op" id="2488157">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2488160">needsMaxRW</span>&nbsp;<span class="op" id="2488171">=</span>&nbsp;<span class="ident" id="2488173">runtime</span><span class="op" id="2488180">.</span><span class="ident" id="2488181">GOOS</span>&nbsp;<span class="op" id="2488186">==</span>&nbsp;<span class="string" id="2488189">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2488198">||</span>&nbsp;<span class="ident" id="2488201">runtime</span><span class="op" id="2488208">.</span><span class="ident" id="2488209">GOOS</span>&nbsp;<span class="op" id="2488214">==</span>&nbsp;<span class="string" id="2488217">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2488228">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2488239">=</span>&nbsp;<span class="num" id="2488241">1</span>&nbsp;<span class="op" id="2488243">&lt;&lt;</span>&nbsp;<span class="num" id="2488246">30</span><br>
<span class="lineno"></span><span class="op" id="2488249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2488252">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2488300">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2488361">func</span>&nbsp;<span class="op" id="2488366">(</span><span class="ident" id="2488367">f</span>&nbsp;<span class="op" id="2488369">*</span><span class="ident" id="2488370">File</span><span class="op" id="2488374">)</span>&nbsp;<span class="ident" id="2488376">read</span><span class="op" id="2488380">(</span><span class="ident" id="2488381">b</span>&nbsp;<span class="op" id="2488383">[</span><span class="op" id="2488384">]</span><span class="builtintype" id="2488385">byte</span><span class="op" id="2488389">)</span>&nbsp;<span class="op" id="2488391">(</span><span class="ident" id="2488392">n</span>&nbsp;<span class="builtintype" id="2488394">int</span><span class="op" id="2488397">,</span>&nbsp;<span class="ident" id="2488399">err</span>&nbsp;<span class="builtintype" id="2488403">error</span><span class="op" id="2488408">)</span>&nbsp;<span class="op" id="2488410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2488413">if</span>&nbsp;<span class="ident" id="2488416">needsMaxRW</span>&nbsp;<span class="op" id="2488427">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2488430">len</span><span class="op" id="2488433">(</span><span class="ident" id="2488434">b</span><span class="op" id="2488435">)</span>&nbsp;<span class="op" id="2488437">&gt;</span>&nbsp;<span class="ident" id="2488439">maxRW</span>&nbsp;<span class="op" id="2488445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2488449">b</span>&nbsp;<span class="op" id="2488451">=</span>&nbsp;<span class="ident" id="2488453">b</span><span class="op" id="2488454">[</span><span class="op" id="2488455">:</span><span class="ident" id="2488456">maxRW</span><span class="op" id="2488461">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2488464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2488467">return</span>&nbsp;<span class="ident" id="2488474">fixCount</span><span class="op" id="2488482">(</span><span class="ident" id="2488483">syscall</span><span class="op" id="2488490">.</span><span class="ident" id="2488491">Read</span><span class="op" id="2488495">(</span><span class="ident" id="2488496">f</span><span class="op" id="2488497">.</span><span class="ident" id="2488498">fd</span><span class="op" id="2488500">,</span>&nbsp;<span class="ident" id="2488502">b</span><span class="op" id="2488503">)</span><span class="op" id="2488504">)</span><br>
<span class="lineno"></span><span class="op" id="2488506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2488509">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2488580">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2488642">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2488698">func</span>&nbsp;<span class="op" id="2488703">(</span><span class="ident" id="2488704">f</span>&nbsp;<span class="op" id="2488706">*</span><span class="ident" id="2488707">File</span><span class="op" id="2488711">)</span>&nbsp;<span class="ident" id="2488713">pread</span><span class="op" id="2488718">(</span><span class="ident" id="2488719">b</span>&nbsp;<span class="op" id="2488721">[</span><span class="op" id="2488722">]</span><span class="builtintype" id="2488723">byte</span><span class="op" id="2488727">,</span>&nbsp;<span class="ident" id="2488729">off</span>&nbsp;<span class="ident" id="2488733">int64</span><span class="op" id="2488738">)</span>&nbsp;<span class="op" id="2488740">(</span><span class="ident" id="2488741">n</span>&nbsp;<span class="builtintype" id="2488743">int</span><span class="op" id="2488746">,</span>&nbsp;<span class="ident" id="2488748">err</span>&nbsp;<span class="builtintype" id="2488752">error</span><span class="op" id="2488757">)</span>&nbsp;<span class="op" id="2488759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2488762">if</span>&nbsp;<span class="ident" id="2488765">needsMaxRW</span>&nbsp;<span class="op" id="2488776">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2488779">len</span><span class="op" id="2488782">(</span><span class="ident" id="2488783">b</span><span class="op" id="2488784">)</span>&nbsp;<span class="op" id="2488786">&gt;</span>&nbsp;<span class="ident" id="2488788">maxRW</span>&nbsp;<span class="op" id="2488794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2488798">b</span>&nbsp;<span class="op" id="2488800">=</span>&nbsp;<span class="ident" id="2488802">b</span><span class="op" id="2488803">[</span><span class="op" id="2488804">:</span><span class="ident" id="2488805">maxRW</span><span class="op" id="2488810">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2488813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2488816">return</span>&nbsp;<span class="ident" id="2488823">fixCount</span><span class="op" id="2488831">(</span><span class="ident" id="2488832">syscall</span><span class="op" id="2488839">.</span><span class="ident" id="2488840">Pread</span><span class="op" id="2488845">(</span><span class="ident" id="2488846">f</span><span class="op" id="2488847">.</span><span class="ident" id="2488848">fd</span><span class="op" id="2488850">,</span>&nbsp;<span class="ident" id="2488852">b</span><span class="op" id="2488853">,</span>&nbsp;<span class="ident" id="2488855">off</span><span class="op" id="2488858">)</span><span class="op" id="2488859">)</span><br>
<span class="lineno"></span><span class="op" id="2488861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2488864">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2488906">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2488970">func</span>&nbsp;<span class="op" id="2488975">(</span><span class="ident" id="2488976">f</span>&nbsp;<span class="op" id="2488978">*</span><span class="ident" id="2488979">File</span><span class="op" id="2488983">)</span>&nbsp;<span class="ident" id="2488985">write</span><span class="op" id="2488990">(</span><span class="ident" id="2488991">b</span>&nbsp;<span class="op" id="2488993">[</span><span class="op" id="2488994">]</span><span class="builtintype" id="2488995">byte</span><span class="op" id="2488999">)</span>&nbsp;<span class="op" id="2489001">(</span><span class="ident" id="2489002">n</span>&nbsp;<span class="builtintype" id="2489004">int</span><span class="op" id="2489007">,</span>&nbsp;<span class="ident" id="2489009">err</span>&nbsp;<span class="builtintype" id="2489013">error</span><span class="op" id="2489018">)</span>&nbsp;<span class="op" id="2489020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489023">for</span>&nbsp;<span class="op" id="2489027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489031">bcap</span>&nbsp;<span class="op" id="2489036">:=</span>&nbsp;<span class="ident" id="2489039">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489043">if</span>&nbsp;<span class="ident" id="2489046">needsMaxRW</span>&nbsp;<span class="op" id="2489057">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2489060">len</span><span class="op" id="2489063">(</span><span class="ident" id="2489064">bcap</span><span class="op" id="2489068">)</span>&nbsp;<span class="op" id="2489070">&gt;</span>&nbsp;<span class="ident" id="2489072">maxRW</span>&nbsp;<span class="op" id="2489078">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489083">bcap</span>&nbsp;<span class="op" id="2489088">=</span>&nbsp;<span class="ident" id="2489090">bcap</span><span class="op" id="2489094">[</span><span class="op" id="2489095">:</span><span class="ident" id="2489096">maxRW</span><span class="op" id="2489101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489109">m</span><span class="op" id="2489110">,</span>&nbsp;<span class="ident" id="2489112">err</span>&nbsp;<span class="op" id="2489116">:=</span>&nbsp;<span class="ident" id="2489119">fixCount</span><span class="op" id="2489127">(</span><span class="ident" id="2489128">syscall</span><span class="op" id="2489135">.</span><span class="ident" id="2489136">Write</span><span class="op" id="2489141">(</span><span class="ident" id="2489142">f</span><span class="op" id="2489143">.</span><span class="ident" id="2489144">fd</span><span class="op" id="2489146">,</span>&nbsp;<span class="ident" id="2489148">bcap</span><span class="op" id="2489152">)</span><span class="op" id="2489153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489157">n</span>&nbsp;<span class="op" id="2489159">+=</span>&nbsp;<span class="ident" id="2489162">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489167">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489229">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2489289">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489355">if</span>&nbsp;<span class="num" id="2489358">0</span>&nbsp;<span class="op" id="2489360">&lt;</span>&nbsp;<span class="ident" id="2489362">m</span>&nbsp;<span class="op" id="2489364">&amp;&amp;</span>&nbsp;<span class="ident" id="2489367">m</span>&nbsp;<span class="op" id="2489369">&lt;</span>&nbsp;<span class="builtinfunc" id="2489371">len</span><span class="op" id="2489374">(</span><span class="ident" id="2489375">bcap</span><span class="op" id="2489379">)</span>&nbsp;<span class="op" id="2489381">||</span>&nbsp;<span class="ident" id="2489384">err</span>&nbsp;<span class="op" id="2489388">==</span>&nbsp;<span class="ident" id="2489391">syscall</span><span class="op" id="2489398">.</span><span class="ident" id="2489399">EINTR</span>&nbsp;<span class="op" id="2489405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489410">b</span>&nbsp;<span class="op" id="2489412">=</span>&nbsp;<span class="ident" id="2489414">b</span><span class="op" id="2489415">[</span><span class="ident" id="2489416">m</span><span class="op" id="2489417">:</span><span class="op" id="2489418">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489423">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489439">if</span>&nbsp;<span class="ident" id="2489442">needsMaxRW</span>&nbsp;<span class="op" id="2489453">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2489456">len</span><span class="op" id="2489459">(</span><span class="ident" id="2489460">bcap</span><span class="op" id="2489464">)</span>&nbsp;<span class="op" id="2489466">!=</span>&nbsp;<span class="builtinfunc" id="2489469">len</span><span class="op" id="2489472">(</span><span class="ident" id="2489473">b</span><span class="op" id="2489474">)</span>&nbsp;<span class="op" id="2489476">&amp;&amp;</span>&nbsp;<span class="ident" id="2489479">err</span>&nbsp;<span class="op" id="2489483">==</span>&nbsp;<span class="ident" id="2489486">nil</span>&nbsp;<span class="op" id="2489490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489495">b</span>&nbsp;<span class="op" id="2489497">=</span>&nbsp;<span class="ident" id="2489499">b</span><span class="op" id="2489500">[</span><span class="ident" id="2489501">m</span><span class="op" id="2489502">:</span><span class="op" id="2489503">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489508">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489524">return</span>&nbsp;<span class="ident" id="2489531">n</span><span class="op" id="2489532">,</span>&nbsp;<span class="ident" id="2489534">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489539">}</span><br>
<span class="lineno">230</span><span class="op" id="2489541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489544">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2489615">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2489679">func</span>&nbsp;<span class="op" id="2489684">(</span><span class="ident" id="2489685">f</span>&nbsp;<span class="op" id="2489687">*</span><span class="ident" id="2489688">File</span><span class="op" id="2489692">)</span>&nbsp;<span class="ident" id="2489694">pwrite</span><span class="op" id="2489700">(</span><span class="ident" id="2489701">b</span>&nbsp;<span class="op" id="2489703">[</span><span class="op" id="2489704">]</span><span class="builtintype" id="2489705">byte</span><span class="op" id="2489709">,</span>&nbsp;<span class="ident" id="2489711">off</span>&nbsp;<span class="ident" id="2489715">int64</span><span class="op" id="2489720">)</span>&nbsp;<span class="op" id="2489722">(</span><span class="ident" id="2489723">n</span>&nbsp;<span class="builtintype" id="2489725">int</span><span class="op" id="2489728">,</span>&nbsp;<span class="ident" id="2489730">err</span>&nbsp;<span class="builtintype" id="2489734">error</span><span class="op" id="2489739">)</span>&nbsp;<span class="op" id="2489741">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489744">if</span>&nbsp;<span class="ident" id="2489747">needsMaxRW</span>&nbsp;<span class="op" id="2489758">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2489761">len</span><span class="op" id="2489764">(</span><span class="ident" id="2489765">b</span><span class="op" id="2489766">)</span>&nbsp;<span class="op" id="2489768">&gt;</span>&nbsp;<span class="ident" id="2489770">maxRW</span>&nbsp;<span class="op" id="2489776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489780">b</span>&nbsp;<span class="op" id="2489782">=</span>&nbsp;<span class="ident" id="2489784">b</span><span class="op" id="2489785">[</span><span class="op" id="2489786">:</span><span class="ident" id="2489787">maxRW</span><span class="op" id="2489792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489798">return</span>&nbsp;<span class="ident" id="2489805">fixCount</span><span class="op" id="2489813">(</span><span class="ident" id="2489814">syscall</span><span class="op" id="2489821">.</span><span class="ident" id="2489822">Pwrite</span><span class="op" id="2489828">(</span><span class="ident" id="2489829">f</span><span class="op" id="2489830">.</span><span class="ident" id="2489831">fd</span><span class="op" id="2489833">,</span>&nbsp;<span class="ident" id="2489835">b</span><span class="op" id="2489836">,</span>&nbsp;<span class="ident" id="2489838">off</span><span class="op" id="2489841">)</span><span class="op" id="2489842">)</span><br>
<span class="lineno"></span><span class="op" id="2489844">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2489847">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2489929">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2490005">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2490073">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2490124">func</span>&nbsp;<span class="op" id="2490129">(</span><span class="ident" id="2490130">f</span>&nbsp;<span class="op" id="2490132">*</span><span class="ident" id="2490133">File</span><span class="op" id="2490137">)</span>&nbsp;<span class="ident" id="2490139">seek</span><span class="op" id="2490143">(</span><span class="ident" id="2490144">offset</span>&nbsp;<span class="ident" id="2490151">int64</span><span class="op" id="2490156">,</span>&nbsp;<span class="ident" id="2490158">whence</span>&nbsp;<span class="builtintype" id="2490165">int</span><span class="op" id="2490168">)</span>&nbsp;<span class="op" id="2490170">(</span><span class="ident" id="2490171">ret</span>&nbsp;<span class="ident" id="2490175">int64</span><span class="op" id="2490180">,</span>&nbsp;<span class="ident" id="2490182">err</span>&nbsp;<span class="builtintype" id="2490186">error</span><span class="op" id="2490191">)</span>&nbsp;<span class="op" id="2490193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490196">return</span>&nbsp;<span class="ident" id="2490203">syscall</span><span class="op" id="2490210">.</span><span class="ident" id="2490211">Seek</span><span class="op" id="2490215">(</span><span class="ident" id="2490216">f</span><span class="op" id="2490217">.</span><span class="ident" id="2490218">fd</span><span class="op" id="2490220">,</span>&nbsp;<span class="ident" id="2490222">offset</span><span class="op" id="2490228">,</span>&nbsp;<span class="ident" id="2490230">whence</span><span class="op" id="2490236">)</span><br>
<span class="lineno"></span><span class="op" id="2490238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2490241">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2490289">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2490366">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2490422">func</span>&nbsp;<span class="ident" id="2490427">Truncate</span><span class="op" id="2490435">(</span><span class="ident" id="2490436">name</span>&nbsp;<span class="builtintype" id="2490441">string</span><span class="op" id="2490447">,</span>&nbsp;<span class="ident" id="2490449">size</span>&nbsp;<span class="ident" id="2490454">int64</span><span class="op" id="2490459">)</span>&nbsp;<span class="builtintype" id="2490461">error</span>&nbsp;<span class="op" id="2490467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490470">if</span>&nbsp;<span class="ident" id="2490473">e</span>&nbsp;<span class="op" id="2490475">:=</span>&nbsp;<span class="ident" id="2490478">syscall</span><span class="op" id="2490485">.</span><span class="ident" id="2490486">Truncate</span><span class="op" id="2490494">(</span><span class="ident" id="2490495">name</span><span class="op" id="2490499">,</span>&nbsp;<span class="ident" id="2490501">size</span><span class="op" id="2490505">)</span><span class="op" id="2490506">;</span>&nbsp;<span class="ident" id="2490508">e</span>&nbsp;<span class="op" id="2490510">!=</span>&nbsp;<span class="ident" id="2490513">nil</span>&nbsp;<span class="op" id="2490517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490521">return</span>&nbsp;<span class="op" id="2490528">&amp;</span><span class="ident" id="2490529">PathError</span><span class="op" id="2490538">{</span><span class="string" id="2490539">&#34;truncate&#34;</span><span class="op" id="2490549">,</span>&nbsp;<span class="ident" id="2490551">name</span><span class="op" id="2490555">,</span>&nbsp;<span class="ident" id="2490557">e</span><span class="op" id="2490558">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490564">return</span>&nbsp;<span class="ident" id="2490571">nil</span><br>
<span class="lineno"></span><span class="op" id="2490575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2490578">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2490625">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2490681">func</span>&nbsp;<span class="ident" id="2490686">Remove</span><span class="op" id="2490692">(</span><span class="ident" id="2490693">name</span>&nbsp;<span class="builtintype" id="2490698">string</span><span class="op" id="2490704">)</span>&nbsp;<span class="builtintype" id="2490706">error</span>&nbsp;<span class="op" id="2490712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490715">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490759">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490800">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490844">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490881">e</span>&nbsp;<span class="op" id="2490883">:=</span>&nbsp;<span class="ident" id="2490886">syscall</span><span class="op" id="2490893">.</span><span class="ident" id="2490894">Unlink</span><span class="op" id="2490900">(</span><span class="ident" id="2490901">name</span><span class="op" id="2490905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490908">if</span>&nbsp;<span class="ident" id="2490911">e</span>&nbsp;<span class="op" id="2490913">==</span>&nbsp;<span class="ident" id="2490916">nil</span>&nbsp;<span class="op" id="2490920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490924">return</span>&nbsp;<span class="ident" id="2490931">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490936">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490939">e1</span>&nbsp;<span class="op" id="2490942">:=</span>&nbsp;<span class="ident" id="2490945">syscall</span><span class="op" id="2490952">.</span><span class="ident" id="2490953">Rmdir</span><span class="op" id="2490958">(</span><span class="ident" id="2490959">name</span><span class="op" id="2490963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490966">if</span>&nbsp;<span class="ident" id="2490969">e1</span>&nbsp;<span class="op" id="2490972">==</span>&nbsp;<span class="ident" id="2490975">nil</span>&nbsp;<span class="op" id="2490979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490983">return</span>&nbsp;<span class="ident" id="2490990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490999">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491050">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491099">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491148">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491197">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491251">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491302">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491357">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491406">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491437">if</span>&nbsp;<span class="ident" id="2491440">e1</span>&nbsp;<span class="op" id="2491443">!=</span>&nbsp;<span class="ident" id="2491446">syscall</span><span class="op" id="2491453">.</span><span class="ident" id="2491454">ENOTDIR</span>&nbsp;<span class="op" id="2491462">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491466">e</span>&nbsp;<span class="op" id="2491468">=</span>&nbsp;<span class="ident" id="2491470">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2491474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491477">return</span>&nbsp;<span class="op" id="2491484">&amp;</span><span class="ident" id="2491485">PathError</span><span class="op" id="2491494">{</span><span class="string" id="2491495">&#34;remove&#34;</span><span class="op" id="2491503">,</span>&nbsp;<span class="ident" id="2491505">name</span><span class="op" id="2491509">,</span>&nbsp;<span class="ident" id="2491511">e</span><span class="op" id="2491512">}</span><br>
<span class="lineno"></span><span class="op" id="2491514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2491517">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2491600">func</span>&nbsp;<span class="ident" id="2491605">basename</span><span class="op" id="2491613">(</span><span class="ident" id="2491614">name</span>&nbsp;<span class="builtintype" id="2491619">string</span><span class="op" id="2491625">)</span>&nbsp;<span class="builtintype" id="2491627">string</span>&nbsp;<span class="op" id="2491634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491637">i</span>&nbsp;<span class="op" id="2491639">:=</span>&nbsp;<span class="builtinfunc" id="2491642">len</span><span class="op" id="2491645">(</span><span class="ident" id="2491646">name</span><span class="op" id="2491650">)</span>&nbsp;<span class="op" id="2491652">-</span>&nbsp;<span class="num" id="2491654">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491657">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491685">for</span>&nbsp;<span class="op" id="2491689">;</span>&nbsp;<span class="ident" id="2491691">i</span>&nbsp;<span class="op" id="2491693">&gt;</span>&nbsp;<span class="num" id="2491695">0</span>&nbsp;<span class="op" id="2491697">&amp;&amp;</span>&nbsp;<span class="ident" id="2491700">name</span><span class="op" id="2491704">[</span><span class="ident" id="2491705">i</span><span class="op" id="2491706">]</span>&nbsp;<span class="op" id="2491708">==</span>&nbsp;<span class="string" id="2491711">&#39;/&#39;</span><span class="op" id="2491714">;</span>&nbsp;<span class="ident" id="2491716">i</span><span class="op" id="2491717">--</span>&nbsp;<span class="op" id="2491720">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491724">name</span>&nbsp;<span class="op" id="2491729">=</span>&nbsp;<span class="ident" id="2491731">name</span><span class="op" id="2491735">[</span><span class="op" id="2491736">:</span><span class="ident" id="2491737">i</span><span class="op" id="2491738">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2491741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491744">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491778">for</span>&nbsp;<span class="ident" id="2491782">i</span><span class="op" id="2491783">--</span><span class="op" id="2491785">;</span>&nbsp;<span class="ident" id="2491787">i</span>&nbsp;<span class="op" id="2491789">&gt;=</span>&nbsp;<span class="num" id="2491792">0</span><span class="op" id="2491793">;</span>&nbsp;<span class="ident" id="2491795">i</span><span class="op" id="2491796">--</span>&nbsp;<span class="op" id="2491799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491803">if</span>&nbsp;<span class="ident" id="2491806">name</span><span class="op" id="2491810">[</span><span class="ident" id="2491811">i</span><span class="op" id="2491812">]</span>&nbsp;<span class="op" id="2491814">==</span>&nbsp;<span class="string" id="2491817">&#39;/&#39;</span>&nbsp;<span class="op" id="2491821">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491826">name</span>&nbsp;<span class="op" id="2491831">=</span>&nbsp;<span class="ident" id="2491833">name</span><span class="op" id="2491837">[</span><span class="ident" id="2491838">i</span><span class="op" id="2491839">+</span><span class="num" id="2491840">1</span><span class="op" id="2491841">:</span><span class="op" id="2491842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491847">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2491855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2491858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491862">return</span>&nbsp;<span class="ident" id="2491869">name</span><br>
<span class="lineno"></span><span class="op" id="2491874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2491877">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2491946">func</span>&nbsp;<span class="ident" id="2491951">TempDir</span><span class="op" id="2491958">(</span><span class="op" id="2491959">)</span>&nbsp;<span class="builtintype" id="2491961">string</span>&nbsp;<span class="op" id="2491968">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491971">dir</span>&nbsp;<span class="op" id="2491975">:=</span>&nbsp;<span class="ident" id="2491978">Getenv</span><span class="op" id="2491984">(</span><span class="string" id="2491985">&#34;TMPDIR&#34;</span><span class="op" id="2491993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491996">if</span>&nbsp;<span class="ident" id="2491999">dir</span>&nbsp;<span class="op" id="2492003">==</span>&nbsp;<span class="string" id="2492006">&#34;&#34;</span>&nbsp;<span class="op" id="2492009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492013">if</span>&nbsp;<span class="ident" id="2492016">runtime</span><span class="op" id="2492023">.</span><span class="ident" id="2492024">GOOS</span>&nbsp;<span class="op" id="2492029">==</span>&nbsp;<span class="string" id="2492032">&#34;android&#34;</span>&nbsp;<span class="op" id="2492042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492047">dir</span>&nbsp;<span class="op" id="2492051">=</span>&nbsp;<span class="string" id="2492053">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2492073">}</span>&nbsp;<span class="keyword" id="2492075">else</span>&nbsp;<span class="op" id="2492080">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492085">dir</span>&nbsp;<span class="op" id="2492089">=</span>&nbsp;<span class="string" id="2492091">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2492100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2492103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492106">return</span>&nbsp;<span class="ident" id="2492113">dir</span><br>
<span class="lineno"></span><span class="op" id="2492117">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2492120">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2492180">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2492236">func</span>&nbsp;<span class="ident" id="2492241">Link</span><span class="op" id="2492245">(</span><span class="ident" id="2492246">oldname</span><span class="op" id="2492253">,</span>&nbsp;<span class="ident" id="2492255">newname</span>&nbsp;<span class="builtintype" id="2492263">string</span><span class="op" id="2492269">)</span>&nbsp;<span class="builtintype" id="2492271">error</span>&nbsp;<span class="op" id="2492277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492280">e</span>&nbsp;<span class="op" id="2492282">:=</span>&nbsp;<span class="ident" id="2492285">syscall</span><span class="op" id="2492292">.</span><span class="ident" id="2492293">Link</span><span class="op" id="2492297">(</span><span class="ident" id="2492298">oldname</span><span class="op" id="2492305">,</span>&nbsp;<span class="ident" id="2492307">newname</span><span class="op" id="2492314">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492317">if</span>&nbsp;<span class="ident" id="2492320">e</span>&nbsp;<span class="op" id="2492322">!=</span>&nbsp;<span class="ident" id="2492325">nil</span>&nbsp;<span class="op" id="2492329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492333">return</span>&nbsp;<span class="op" id="2492340">&amp;</span><span class="ident" id="2492341">LinkError</span><span class="op" id="2492350">{</span><span class="string" id="2492351">&#34;link&#34;</span><span class="op" id="2492357">,</span>&nbsp;<span class="ident" id="2492359">oldname</span><span class="op" id="2492366">,</span>&nbsp;<span class="ident" id="2492368">newname</span><span class="op" id="2492375">,</span>&nbsp;<span class="ident" id="2492377">e</span><span class="op" id="2492378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2492381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492384">return</span>&nbsp;<span class="ident" id="2492391">nil</span><br>
<span class="lineno"></span><span class="op" id="2492395">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2492398">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2492456">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2492512">func</span>&nbsp;<span class="ident" id="2492517">Symlink</span><span class="op" id="2492524">(</span><span class="ident" id="2492525">oldname</span><span class="op" id="2492532">,</span>&nbsp;<span class="ident" id="2492534">newname</span>&nbsp;<span class="builtintype" id="2492542">string</span><span class="op" id="2492548">)</span>&nbsp;<span class="builtintype" id="2492550">error</span>&nbsp;<span class="op" id="2492556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492559">e</span>&nbsp;<span class="op" id="2492561">:=</span>&nbsp;<span class="ident" id="2492564">syscall</span><span class="op" id="2492571">.</span><span class="ident" id="2492572">Symlink</span><span class="op" id="2492579">(</span><span class="ident" id="2492580">oldname</span><span class="op" id="2492587">,</span>&nbsp;<span class="ident" id="2492589">newname</span><span class="op" id="2492596">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492599">if</span>&nbsp;<span class="ident" id="2492602">e</span>&nbsp;<span class="op" id="2492604">!=</span>&nbsp;<span class="ident" id="2492607">nil</span>&nbsp;<span class="op" id="2492611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492615">return</span>&nbsp;<span class="op" id="2492622">&amp;</span><span class="ident" id="2492623">LinkError</span><span class="op" id="2492632">{</span><span class="string" id="2492633">&#34;symlink&#34;</span><span class="op" id="2492642">,</span>&nbsp;<span class="ident" id="2492644">oldname</span><span class="op" id="2492651">,</span>&nbsp;<span class="ident" id="2492653">newname</span><span class="op" id="2492660">,</span>&nbsp;<span class="ident" id="2492662">e</span><span class="op" id="2492663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2492666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2492669">return</span>&nbsp;<span class="ident" id="2492676">nil</span><br>
<span class="lineno"></span><span class="op" id="2492680">}</span>
</div>
</body>
</html>
