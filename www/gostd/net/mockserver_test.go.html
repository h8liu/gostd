<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html" class="current">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7578479">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7578534">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7578588">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7578639">package</span>&nbsp;<span class="ident" id="7578647">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578652">import</span>&nbsp;<span class="string" id="7578659">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578667">type</span>&nbsp;<span class="ident" id="7578672">streamListener</span>&nbsp;<span class="keyword" id="7578687">struct</span>&nbsp;<span class="op" id="7578694">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578697">net</span><span class="op" id="7578700">,</span>&nbsp;<span class="ident" id="7578702">addr</span>&nbsp;<span class="builtintype" id="7578707">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578715">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7578725">Listener</span><br>
<span class="lineno"></span><span class="op" id="7578734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578737">type</span>&nbsp;<span class="ident" id="7578742">dualStackServer</span>&nbsp;<span class="keyword" id="7578758">struct</span>&nbsp;<span class="op" id="7578765">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578768">lnmu</span>&nbsp;<span class="ident" id="7578773">sync</span><span class="op" id="7578777">.</span><span class="ident" id="7578778">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578787">lns</span>&nbsp;&nbsp;<span class="op" id="7578792">[</span><span class="op" id="7578793">]</span><span class="ident" id="7578794">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578810">port</span>&nbsp;<span class="builtintype" id="7578815">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578824">cmu</span>&nbsp;<span class="ident" id="7578828">sync</span><span class="op" id="7578832">.</span><span class="ident" id="7578833">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578842">cs</span>&nbsp;&nbsp;<span class="op" id="7578846">[</span><span class="op" id="7578847">]</span><span class="ident" id="7578848">Conn</span>&nbsp;<span class="comment" id="7578853">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="7578905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578908">func</span>&nbsp;<span class="op" id="7578913">(</span><span class="ident" id="7578914">dss</span>&nbsp;<span class="op" id="7578918">*</span><span class="ident" id="7578919">dualStackServer</span><span class="op" id="7578934">)</span>&nbsp;<span class="ident" id="7578936">buildup</span><span class="op" id="7578943">(</span><span class="ident" id="7578944">server</span>&nbsp;<span class="keyword" id="7578951">func</span><span class="op" id="7578955">(</span><span class="op" id="7578956">*</span><span class="ident" id="7578957">dualStackServer</span><span class="op" id="7578972">,</span>&nbsp;<span class="ident" id="7578974">Listener</span><span class="op" id="7578982">)</span><span class="op" id="7578983">)</span>&nbsp;<span class="builtintype" id="7578985">error</span>&nbsp;<span class="op" id="7578991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578994">for</span>&nbsp;<span class="ident" id="7578998">i</span>&nbsp;<span class="op" id="7579000">:=</span>&nbsp;<span class="keyword" id="7579003">range</span>&nbsp;<span class="ident" id="7579009">dss</span><span class="op" id="7579012">.</span><span class="ident" id="7579013">lns</span>&nbsp;<span class="op" id="7579017">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579021">go</span>&nbsp;<span class="ident" id="7579024">server</span><span class="op" id="7579030">(</span><span class="ident" id="7579031">dss</span><span class="op" id="7579034">,</span>&nbsp;<span class="ident" id="7579036">dss</span><span class="op" id="7579039">.</span><span class="ident" id="7579040">lns</span><span class="op" id="7579043">[</span><span class="ident" id="7579044">i</span><span class="op" id="7579045">]</span><span class="op" id="7579046">.</span><span class="ident" id="7579047">ln</span><span class="op" id="7579049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579055">return</span>&nbsp;<span class="ident" id="7579062">nil</span><br>
<span class="lineno"></span><span class="op" id="7579066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7579069">func</span>&nbsp;<span class="op" id="7579074">(</span><span class="ident" id="7579075">dss</span>&nbsp;<span class="op" id="7579079">*</span><span class="ident" id="7579080">dualStackServer</span><span class="op" id="7579095">)</span>&nbsp;<span class="ident" id="7579097">putConn</span><span class="op" id="7579104">(</span><span class="ident" id="7579105">c</span>&nbsp;<span class="ident" id="7579107">Conn</span><span class="op" id="7579111">)</span>&nbsp;<span class="builtintype" id="7579113">error</span>&nbsp;<span class="op" id="7579119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579122">dss</span><span class="op" id="7579125">.</span><span class="ident" id="7579126">cmu</span><span class="op" id="7579129">.</span><span class="ident" id="7579130">Lock</span><span class="op" id="7579134">(</span><span class="op" id="7579135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579138">dss</span><span class="op" id="7579141">.</span><span class="ident" id="7579142">cs</span>&nbsp;<span class="op" id="7579145">=</span>&nbsp;<span class="builtinfunc" id="7579147">append</span><span class="op" id="7579153">(</span><span class="ident" id="7579154">dss</span><span class="op" id="7579157">.</span><span class="ident" id="7579158">cs</span><span class="op" id="7579160">,</span>&nbsp;<span class="ident" id="7579162">c</span><span class="op" id="7579163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579166">dss</span><span class="op" id="7579169">.</span><span class="ident" id="7579170">cmu</span><span class="op" id="7579173">.</span><span class="ident" id="7579174">Unlock</span><span class="op" id="7579180">(</span><span class="op" id="7579181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579184">return</span>&nbsp;<span class="ident" id="7579191">nil</span><br>
<span class="lineno">35</span><span class="op" id="7579195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7579198">func</span>&nbsp;<span class="op" id="7579203">(</span><span class="ident" id="7579204">dss</span>&nbsp;<span class="op" id="7579208">*</span><span class="ident" id="7579209">dualStackServer</span><span class="op" id="7579224">)</span>&nbsp;<span class="ident" id="7579226">teardownNetwork</span><span class="op" id="7579241">(</span><span class="ident" id="7579242">net</span>&nbsp;<span class="builtintype" id="7579246">string</span><span class="op" id="7579252">)</span>&nbsp;<span class="builtintype" id="7579254">error</span>&nbsp;<span class="op" id="7579260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579263">dss</span><span class="op" id="7579266">.</span><span class="ident" id="7579267">lnmu</span><span class="op" id="7579271">.</span><span class="ident" id="7579272">Lock</span><span class="op" id="7579276">(</span><span class="op" id="7579277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579280">for</span>&nbsp;<span class="ident" id="7579284">i</span>&nbsp;<span class="op" id="7579286">:=</span>&nbsp;<span class="keyword" id="7579289">range</span>&nbsp;<span class="ident" id="7579295">dss</span><span class="op" id="7579298">.</span><span class="ident" id="7579299">lns</span>&nbsp;<span class="op" id="7579303">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579307">if</span>&nbsp;<span class="ident" id="7579310">net</span>&nbsp;<span class="op" id="7579314">==</span>&nbsp;<span class="ident" id="7579317">dss</span><span class="op" id="7579320">.</span><span class="ident" id="7579321">lns</span><span class="op" id="7579324">[</span><span class="ident" id="7579325">i</span><span class="op" id="7579326">]</span><span class="op" id="7579327">.</span><span class="ident" id="7579328">net</span>&nbsp;<span class="op" id="7579332">&amp;&amp;</span>&nbsp;<span class="ident" id="7579335">dss</span><span class="op" id="7579338">.</span><span class="ident" id="7579339">lns</span><span class="op" id="7579342">[</span><span class="ident" id="7579343">i</span><span class="op" id="7579344">]</span><span class="op" id="7579345">.</span><span class="ident" id="7579346">ln</span>&nbsp;<span class="op" id="7579349">!=</span>&nbsp;<span class="ident" id="7579352">nil</span>&nbsp;<span class="op" id="7579356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579361">dss</span><span class="op" id="7579364">.</span><span class="ident" id="7579365">lns</span><span class="op" id="7579368">[</span><span class="ident" id="7579369">i</span><span class="op" id="7579370">]</span><span class="op" id="7579371">.</span><span class="ident" id="7579372">ln</span><span class="op" id="7579374">.</span><span class="ident" id="7579375">Close</span><span class="op" id="7579380">(</span><span class="op" id="7579381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579386">dss</span><span class="op" id="7579389">.</span><span class="ident" id="7579390">lns</span><span class="op" id="7579393">[</span><span class="ident" id="7579394">i</span><span class="op" id="7579395">]</span><span class="op" id="7579396">.</span><span class="ident" id="7579397">ln</span>&nbsp;<span class="op" id="7579400">=</span>&nbsp;<span class="ident" id="7579402">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579411">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579414">dss</span><span class="op" id="7579417">.</span><span class="ident" id="7579418">lnmu</span><span class="op" id="7579422">.</span><span class="ident" id="7579423">Unlock</span><span class="op" id="7579429">(</span><span class="op" id="7579430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579433">return</span>&nbsp;<span class="ident" id="7579440">nil</span><br>
<span class="lineno"></span><span class="op" id="7579444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7579447">func</span>&nbsp;<span class="op" id="7579452">(</span><span class="ident" id="7579453">dss</span>&nbsp;<span class="op" id="7579457">*</span><span class="ident" id="7579458">dualStackServer</span><span class="op" id="7579473">)</span>&nbsp;<span class="ident" id="7579475">teardown</span><span class="op" id="7579483">(</span><span class="op" id="7579484">)</span>&nbsp;<span class="builtintype" id="7579486">error</span>&nbsp;<span class="op" id="7579492">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579495">dss</span><span class="op" id="7579498">.</span><span class="ident" id="7579499">lnmu</span><span class="op" id="7579503">.</span><span class="ident" id="7579504">Lock</span><span class="op" id="7579508">(</span><span class="op" id="7579509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579512">for</span>&nbsp;<span class="ident" id="7579516">i</span>&nbsp;<span class="op" id="7579518">:=</span>&nbsp;<span class="keyword" id="7579521">range</span>&nbsp;<span class="ident" id="7579527">dss</span><span class="op" id="7579530">.</span><span class="ident" id="7579531">lns</span>&nbsp;<span class="op" id="7579535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579539">if</span>&nbsp;<span class="ident" id="7579542">dss</span><span class="op" id="7579545">.</span><span class="ident" id="7579546">lns</span><span class="op" id="7579549">[</span><span class="ident" id="7579550">i</span><span class="op" id="7579551">]</span><span class="op" id="7579552">.</span><span class="ident" id="7579553">ln</span>&nbsp;<span class="op" id="7579556">!=</span>&nbsp;<span class="ident" id="7579559">nil</span>&nbsp;<span class="op" id="7579563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579568">dss</span><span class="op" id="7579571">.</span><span class="ident" id="7579572">lns</span><span class="op" id="7579575">[</span><span class="ident" id="7579576">i</span><span class="op" id="7579577">]</span><span class="op" id="7579578">.</span><span class="ident" id="7579579">ln</span><span class="op" id="7579581">.</span><span class="ident" id="7579582">Close</span><span class="op" id="7579587">(</span><span class="op" id="7579588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579592">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579598">dss</span><span class="op" id="7579601">.</span><span class="ident" id="7579602">lnmu</span><span class="op" id="7579606">.</span><span class="ident" id="7579607">Unlock</span><span class="op" id="7579613">(</span><span class="op" id="7579614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579617">dss</span><span class="op" id="7579620">.</span><span class="ident" id="7579621">cmu</span><span class="op" id="7579624">.</span><span class="ident" id="7579625">Lock</span><span class="op" id="7579629">(</span><span class="op" id="7579630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579633">for</span>&nbsp;<span class="ident" id="7579637">_</span><span class="op" id="7579638">,</span>&nbsp;<span class="ident" id="7579640">c</span>&nbsp;<span class="op" id="7579642">:=</span>&nbsp;<span class="keyword" id="7579645">range</span>&nbsp;<span class="ident" id="7579651">dss</span><span class="op" id="7579654">.</span><span class="ident" id="7579655">cs</span>&nbsp;<span class="op" id="7579658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579662">c</span><span class="op" id="7579663">.</span><span class="ident" id="7579664">Close</span><span class="op" id="7579669">(</span><span class="op" id="7579670">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579676">dss</span><span class="op" id="7579679">.</span><span class="ident" id="7579680">cmu</span><span class="op" id="7579683">.</span><span class="ident" id="7579684">Unlock</span><span class="op" id="7579690">(</span><span class="op" id="7579691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579694">return</span>&nbsp;<span class="ident" id="7579701">nil</span><br>
<span class="lineno"></span><span class="op" id="7579705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7579708">func</span>&nbsp;<span class="ident" id="7579713">newDualStackServer</span><span class="op" id="7579731">(</span><span class="ident" id="7579732">lns</span>&nbsp;<span class="op" id="7579736">[</span><span class="op" id="7579737">]</span><span class="ident" id="7579738">streamListener</span><span class="op" id="7579752">)</span>&nbsp;<span class="op" id="7579754">(</span><span class="op" id="7579755">*</span><span class="ident" id="7579756">dualStackServer</span><span class="op" id="7579771">,</span>&nbsp;<span class="builtintype" id="7579773">error</span><span class="op" id="7579778">)</span>&nbsp;<span class="op" id="7579780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579783">dss</span>&nbsp;<span class="op" id="7579787">:=</span>&nbsp;<span class="op" id="7579790">&amp;</span><span class="ident" id="7579791">dualStackServer</span><span class="op" id="7579806">{</span><span class="ident" id="7579807">lns</span><span class="op" id="7579810">:</span>&nbsp;<span class="ident" id="7579812">lns</span><span class="op" id="7579815">,</span>&nbsp;<span class="ident" id="7579817">port</span><span class="op" id="7579821">:</span>&nbsp;<span class="string" id="7579823">&#34;0&#34;</span><span class="op" id="7579826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579829">for</span>&nbsp;<span class="ident" id="7579833">i</span>&nbsp;<span class="op" id="7579835">:=</span>&nbsp;<span class="keyword" id="7579838">range</span>&nbsp;<span class="ident" id="7579844">dss</span><span class="op" id="7579847">.</span><span class="ident" id="7579848">lns</span>&nbsp;<span class="op" id="7579852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579856">ln</span><span class="op" id="7579858">,</span>&nbsp;<span class="ident" id="7579860">err</span>&nbsp;<span class="op" id="7579864">:=</span>&nbsp;<span class="ident" id="7579867">Listen</span><span class="op" id="7579873">(</span><span class="ident" id="7579874">dss</span><span class="op" id="7579877">.</span><span class="ident" id="7579878">lns</span><span class="op" id="7579881">[</span><span class="ident" id="7579882">i</span><span class="op" id="7579883">]</span><span class="op" id="7579884">.</span><span class="ident" id="7579885">net</span><span class="op" id="7579888">,</span>&nbsp;<span class="ident" id="7579890">dss</span><span class="op" id="7579893">.</span><span class="ident" id="7579894">lns</span><span class="op" id="7579897">[</span><span class="ident" id="7579898">i</span><span class="op" id="7579899">]</span><span class="op" id="7579900">.</span><span class="ident" id="7579901">addr</span><span class="op" id="7579905">+</span><span class="string" id="7579906">&#34;:&#34;</span><span class="op" id="7579909">+</span><span class="ident" id="7579910">dss</span><span class="op" id="7579913">.</span><span class="ident" id="7579914">port</span><span class="op" id="7579918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579922">if</span>&nbsp;<span class="ident" id="7579925">err</span>&nbsp;<span class="op" id="7579929">!=</span>&nbsp;<span class="ident" id="7579932">nil</span>&nbsp;<span class="op" id="7579936">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579941">dss</span><span class="op" id="7579944">.</span><span class="ident" id="7579945">teardown</span><span class="op" id="7579953">(</span><span class="op" id="7579954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579959">return</span>&nbsp;<span class="ident" id="7579966">nil</span><span class="op" id="7579969">,</span>&nbsp;<span class="ident" id="7579971">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579981">dss</span><span class="op" id="7579984">.</span><span class="ident" id="7579985">lns</span><span class="op" id="7579988">[</span><span class="ident" id="7579989">i</span><span class="op" id="7579990">]</span><span class="op" id="7579991">.</span><span class="ident" id="7579992">ln</span>&nbsp;<span class="op" id="7579995">=</span>&nbsp;<span class="ident" id="7579997">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580002">if</span>&nbsp;<span class="ident" id="7580005">dss</span><span class="op" id="7580008">.</span><span class="ident" id="7580009">port</span>&nbsp;<span class="op" id="7580014">==</span>&nbsp;<span class="string" id="7580017">&#34;0&#34;</span>&nbsp;<span class="op" id="7580021">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580026">if</span>&nbsp;<span class="ident" id="7580029">_</span><span class="op" id="7580030">,</span>&nbsp;<span class="ident" id="7580032">dss</span><span class="op" id="7580035">.</span><span class="ident" id="7580036">port</span><span class="op" id="7580040">,</span>&nbsp;<span class="ident" id="7580042">err</span>&nbsp;<span class="op" id="7580046">=</span>&nbsp;<span class="ident" id="7580048">SplitHostPort</span><span class="op" id="7580061">(</span><span class="ident" id="7580062">ln</span><span class="op" id="7580064">.</span><span class="ident" id="7580065">Addr</span><span class="op" id="7580069">(</span><span class="op" id="7580070">)</span><span class="op" id="7580071">.</span><span class="ident" id="7580072">String</span><span class="op" id="7580078">(</span><span class="op" id="7580079">)</span><span class="op" id="7580080">)</span><span class="op" id="7580081">;</span>&nbsp;<span class="ident" id="7580083">err</span>&nbsp;<span class="op" id="7580087">!=</span>&nbsp;<span class="ident" id="7580090">nil</span>&nbsp;<span class="op" id="7580094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580100">dss</span><span class="op" id="7580103">.</span><span class="ident" id="7580104">teardown</span><span class="op" id="7580112">(</span><span class="op" id="7580113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580119">return</span>&nbsp;<span class="ident" id="7580126">nil</span><span class="op" id="7580129">,</span>&nbsp;<span class="ident" id="7580131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580142">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580148">return</span>&nbsp;<span class="ident" id="7580155">dss</span><span class="op" id="7580158">,</span>&nbsp;<span class="ident" id="7580160">nil</span><br>
<span class="lineno"></span><span class="op" id="7580164">}</span>
</div>
</body>
</html>
