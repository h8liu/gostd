<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1974741">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1974796">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1974850">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1974901">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1974979">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1975064">package</span>&nbsp;<span class="ident" id="1975072">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1975078">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1975135">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1975190">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1975266">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1975306">const</span>&nbsp;<span class="op" id="1975312">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975315">RuneError</span>&nbsp;<span class="op" id="1975325">=</span>&nbsp;<span class="string" id="1975327">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975340">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975396">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1975406">=</span>&nbsp;<span class="num" id="1975408">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975421">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975499">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1975509">=</span>&nbsp;<span class="string" id="1975511">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1975524">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975562">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1975572">=</span>&nbsp;<span class="num" id="1975574">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1975587">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1975652">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1975655">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1975718">const</span>&nbsp;<span class="op" id="1975724">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975727">surrogateMin</span>&nbsp;<span class="op" id="1975740">=</span>&nbsp;<span class="num" id="1975742">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975750">surrogateMax</span>&nbsp;<span class="op" id="1975763">=</span>&nbsp;<span class="num" id="1975765">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1975772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1975775">const</span>&nbsp;<span class="op" id="1975781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975784">t1</span>&nbsp;<span class="op" id="1975787">=</span>&nbsp;<span class="num" id="1975789">0x00</span>&nbsp;<span class="comment" id="1975794">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975808">tx</span>&nbsp;<span class="op" id="1975811">=</span>&nbsp;<span class="num" id="1975813">0x80</span>&nbsp;<span class="comment" id="1975818">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975832">t2</span>&nbsp;<span class="op" id="1975835">=</span>&nbsp;<span class="num" id="1975837">0xC0</span>&nbsp;<span class="comment" id="1975842">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975856">t3</span>&nbsp;<span class="op" id="1975859">=</span>&nbsp;<span class="num" id="1975861">0xE0</span>&nbsp;<span class="comment" id="1975866">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975880">t4</span>&nbsp;<span class="op" id="1975883">=</span>&nbsp;<span class="num" id="1975885">0xF0</span>&nbsp;<span class="comment" id="1975890">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975904">t5</span>&nbsp;<span class="op" id="1975907">=</span>&nbsp;<span class="num" id="1975909">0xF8</span>&nbsp;<span class="comment" id="1975914">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975929">maskx</span>&nbsp;<span class="op" id="1975935">=</span>&nbsp;<span class="num" id="1975937">0x3F</span>&nbsp;<span class="comment" id="1975942">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975956">mask2</span>&nbsp;<span class="op" id="1975962">=</span>&nbsp;<span class="num" id="1975964">0x1F</span>&nbsp;<span class="comment" id="1975969">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1975983">mask3</span>&nbsp;<span class="op" id="1975989">=</span>&nbsp;<span class="num" id="1975991">0x0F</span>&nbsp;<span class="comment" id="1975996">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976010">mask4</span>&nbsp;<span class="op" id="1976016">=</span>&nbsp;<span class="num" id="1976018">0x07</span>&nbsp;<span class="comment" id="1976023">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976038">rune1Max</span>&nbsp;<span class="op" id="1976047">=</span>&nbsp;<span class="num" id="1976049">1</span><span class="op" id="1976050">&lt;&lt;</span><span class="num" id="1976052">7</span>&nbsp;<span class="op" id="1976054">-</span>&nbsp;<span class="num" id="1976056">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976059">rune2Max</span>&nbsp;<span class="op" id="1976068">=</span>&nbsp;<span class="num" id="1976070">1</span><span class="op" id="1976071">&lt;&lt;</span><span class="num" id="1976073">11</span>&nbsp;<span class="op" id="1976076">-</span>&nbsp;<span class="num" id="1976078">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976081">rune3Max</span>&nbsp;<span class="op" id="1976090">=</span>&nbsp;<span class="num" id="1976092">1</span><span class="op" id="1976093">&lt;&lt;</span><span class="num" id="1976095">16</span>&nbsp;<span class="op" id="1976098">-</span>&nbsp;<span class="num" id="1976100">1</span><br>
<span class="lineno"></span><span class="op" id="1976102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1976105">func</span>&nbsp;<span class="ident" id="1976110">decodeRuneInternal</span><span class="op" id="1976128">(</span><span class="ident" id="1976129">p</span>&nbsp;<span class="op" id="1976131">[</span><span class="op" id="1976132">]</span><span class="builtintype" id="1976133">byte</span><span class="op" id="1976137">)</span>&nbsp;<span class="op" id="1976139">(</span><span class="ident" id="1976140">r</span>&nbsp;<span class="builtintype" id="1976142">rune</span><span class="op" id="1976146">,</span>&nbsp;<span class="ident" id="1976148">size</span>&nbsp;<span class="builtintype" id="1976153">int</span><span class="op" id="1976156">,</span>&nbsp;<span class="ident" id="1976158">short</span>&nbsp;<span class="builtintype" id="1976164">bool</span><span class="op" id="1976168">)</span>&nbsp;<span class="op" id="1976170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976173">n</span>&nbsp;<span class="op" id="1976175">:=</span>&nbsp;<span class="builtinfunc" id="1976178">len</span><span class="op" id="1976181">(</span><span class="ident" id="1976182">p</span><span class="op" id="1976183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976186">if</span>&nbsp;<span class="ident" id="1976189">n</span>&nbsp;<span class="op" id="1976191">&lt;</span>&nbsp;<span class="num" id="1976193">1</span>&nbsp;<span class="op" id="1976195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976199">return</span>&nbsp;<span class="ident" id="1976206">RuneError</span><span class="op" id="1976215">,</span>&nbsp;<span class="num" id="1976217">0</span><span class="op" id="1976218">,</span>&nbsp;<span class="builtintype" id="1976220">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976226">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976229">c0</span>&nbsp;<span class="op" id="1976232">:=</span>&nbsp;<span class="ident" id="1976235">p</span><span class="op" id="1976236">[</span><span class="num" id="1976237">0</span><span class="op" id="1976238">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976242">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976270">if</span>&nbsp;<span class="ident" id="1976273">c0</span>&nbsp;<span class="op" id="1976276">&lt;</span>&nbsp;<span class="ident" id="1976278">tx</span>&nbsp;<span class="op" id="1976281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976285">return</span>&nbsp;<span class="builtintype" id="1976292">rune</span><span class="op" id="1976296">(</span><span class="ident" id="1976297">c0</span><span class="op" id="1976299">)</span><span class="op" id="1976300">,</span>&nbsp;<span class="num" id="1976302">1</span><span class="op" id="1976303">,</span>&nbsp;<span class="builtintype" id="1976305">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976316">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976350">if</span>&nbsp;<span class="ident" id="1976353">c0</span>&nbsp;<span class="op" id="1976356">&lt;</span>&nbsp;<span class="ident" id="1976358">t2</span>&nbsp;<span class="op" id="1976361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976365">return</span>&nbsp;<span class="ident" id="1976372">RuneError</span><span class="op" id="1976381">,</span>&nbsp;<span class="num" id="1976383">1</span><span class="op" id="1976384">,</span>&nbsp;<span class="builtintype" id="1976386">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976397">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976430">if</span>&nbsp;<span class="ident" id="1976433">n</span>&nbsp;<span class="op" id="1976435">&lt;</span>&nbsp;<span class="num" id="1976437">2</span>&nbsp;<span class="op" id="1976439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976443">return</span>&nbsp;<span class="ident" id="1976450">RuneError</span><span class="op" id="1976459">,</span>&nbsp;<span class="num" id="1976461">1</span><span class="op" id="1976462">,</span>&nbsp;<span class="builtintype" id="1976464">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976473">c1</span>&nbsp;<span class="op" id="1976476">:=</span>&nbsp;<span class="ident" id="1976479">p</span><span class="op" id="1976480">[</span><span class="num" id="1976481">1</span><span class="op" id="1976482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976485">if</span>&nbsp;<span class="ident" id="1976488">c1</span>&nbsp;<span class="op" id="1976491">&lt;</span>&nbsp;<span class="ident" id="1976493">tx</span>&nbsp;<span class="op" id="1976496">||</span>&nbsp;<span class="ident" id="1976499">t2</span>&nbsp;<span class="op" id="1976502">&lt;=</span>&nbsp;<span class="ident" id="1976505">c1</span>&nbsp;<span class="op" id="1976508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976512">return</span>&nbsp;<span class="ident" id="1976519">RuneError</span><span class="op" id="1976528">,</span>&nbsp;<span class="num" id="1976530">1</span><span class="op" id="1976531">,</span>&nbsp;<span class="builtintype" id="1976533">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976540">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976544">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976573">if</span>&nbsp;<span class="ident" id="1976576">c0</span>&nbsp;<span class="op" id="1976579">&lt;</span>&nbsp;<span class="ident" id="1976581">t3</span>&nbsp;<span class="op" id="1976584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976588">r</span>&nbsp;<span class="op" id="1976590">=</span>&nbsp;<span class="builtintype" id="1976592">rune</span><span class="op" id="1976596">(</span><span class="ident" id="1976597">c0</span><span class="op" id="1976599">&amp;</span><span class="ident" id="1976600">mask2</span><span class="op" id="1976605">)</span><span class="op" id="1976606">&lt;&lt;</span><span class="num" id="1976608">6</span>&nbsp;<span class="op" id="1976610">|</span>&nbsp;<span class="builtintype" id="1976612">rune</span><span class="op" id="1976616">(</span><span class="ident" id="1976617">c1</span><span class="op" id="1976619">&amp;</span><span class="ident" id="1976620">maskx</span><span class="op" id="1976625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976629">if</span>&nbsp;<span class="ident" id="1976632">r</span>&nbsp;<span class="op" id="1976634">&lt;=</span>&nbsp;<span class="ident" id="1976637">rune1Max</span>&nbsp;<span class="op" id="1976646">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976651">return</span>&nbsp;<span class="ident" id="1976658">RuneError</span><span class="op" id="1976667">,</span>&nbsp;<span class="num" id="1976669">1</span><span class="op" id="1976670">,</span>&nbsp;<span class="builtintype" id="1976672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976684">return</span>&nbsp;<span class="ident" id="1976691">r</span><span class="op" id="1976692">,</span>&nbsp;<span class="num" id="1976694">2</span><span class="op" id="1976695">,</span>&nbsp;<span class="builtintype" id="1976697">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976708">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976742">if</span>&nbsp;<span class="ident" id="1976745">n</span>&nbsp;<span class="op" id="1976747">&lt;</span>&nbsp;<span class="num" id="1976749">3</span>&nbsp;<span class="op" id="1976751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976755">return</span>&nbsp;<span class="ident" id="1976762">RuneError</span><span class="op" id="1976771">,</span>&nbsp;<span class="num" id="1976773">1</span><span class="op" id="1976774">,</span>&nbsp;<span class="builtintype" id="1976776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976785">c2</span>&nbsp;<span class="op" id="1976788">:=</span>&nbsp;<span class="ident" id="1976791">p</span><span class="op" id="1976792">[</span><span class="num" id="1976793">2</span><span class="op" id="1976794">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976797">if</span>&nbsp;<span class="ident" id="1976800">c2</span>&nbsp;<span class="op" id="1976803">&lt;</span>&nbsp;<span class="ident" id="1976805">tx</span>&nbsp;<span class="op" id="1976808">||</span>&nbsp;<span class="ident" id="1976811">t2</span>&nbsp;<span class="op" id="1976814">&lt;=</span>&nbsp;<span class="ident" id="1976817">c2</span>&nbsp;<span class="op" id="1976820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976824">return</span>&nbsp;<span class="ident" id="1976831">RuneError</span><span class="op" id="1976840">,</span>&nbsp;<span class="num" id="1976842">1</span><span class="op" id="1976843">,</span>&nbsp;<span class="builtintype" id="1976845">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1976852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1976856">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976885">if</span>&nbsp;<span class="ident" id="1976888">c0</span>&nbsp;<span class="op" id="1976891">&lt;</span>&nbsp;<span class="ident" id="1976893">t4</span>&nbsp;<span class="op" id="1976896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1976900">r</span>&nbsp;<span class="op" id="1976902">=</span>&nbsp;<span class="builtintype" id="1976904">rune</span><span class="op" id="1976908">(</span><span class="ident" id="1976909">c0</span><span class="op" id="1976911">&amp;</span><span class="ident" id="1976912">mask3</span><span class="op" id="1976917">)</span><span class="op" id="1976918">&lt;&lt;</span><span class="num" id="1976920">12</span>&nbsp;<span class="op" id="1976923">|</span>&nbsp;<span class="builtintype" id="1976925">rune</span><span class="op" id="1976929">(</span><span class="ident" id="1976930">c1</span><span class="op" id="1976932">&amp;</span><span class="ident" id="1976933">maskx</span><span class="op" id="1976938">)</span><span class="op" id="1976939">&lt;&lt;</span><span class="num" id="1976941">6</span>&nbsp;<span class="op" id="1976943">|</span>&nbsp;<span class="builtintype" id="1976945">rune</span><span class="op" id="1976949">(</span><span class="ident" id="1976950">c2</span><span class="op" id="1976952">&amp;</span><span class="ident" id="1976953">maskx</span><span class="op" id="1976958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976962">if</span>&nbsp;<span class="ident" id="1976965">r</span>&nbsp;<span class="op" id="1976967">&lt;=</span>&nbsp;<span class="ident" id="1976970">rune2Max</span>&nbsp;<span class="op" id="1976979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1976984">return</span>&nbsp;<span class="ident" id="1976991">RuneError</span><span class="op" id="1977000">,</span>&nbsp;<span class="num" id="1977002">1</span><span class="op" id="1977003">,</span>&nbsp;<span class="builtintype" id="1977005">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977013">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977017">if</span>&nbsp;<span class="ident" id="1977020">surrogateMin</span>&nbsp;<span class="op" id="1977033">&lt;=</span>&nbsp;<span class="ident" id="1977036">r</span>&nbsp;<span class="op" id="1977038">&amp;&amp;</span>&nbsp;<span class="ident" id="1977041">r</span>&nbsp;<span class="op" id="1977043">&lt;=</span>&nbsp;<span class="ident" id="1977046">surrogateMax</span>&nbsp;<span class="op" id="1977059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977064">return</span>&nbsp;<span class="ident" id="1977071">RuneError</span><span class="op" id="1977080">,</span>&nbsp;<span class="num" id="1977082">1</span><span class="op" id="1977083">,</span>&nbsp;<span class="builtintype" id="1977085">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977097">return</span>&nbsp;<span class="ident" id="1977104">r</span><span class="op" id="1977105">,</span>&nbsp;<span class="num" id="1977107">3</span><span class="op" id="1977108">,</span>&nbsp;<span class="builtintype" id="1977110">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977117">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977121">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977154">if</span>&nbsp;<span class="ident" id="1977157">n</span>&nbsp;<span class="op" id="1977159">&lt;</span>&nbsp;<span class="num" id="1977161">4</span>&nbsp;<span class="op" id="1977163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977167">return</span>&nbsp;<span class="ident" id="1977174">RuneError</span><span class="op" id="1977183">,</span>&nbsp;<span class="num" id="1977185">1</span><span class="op" id="1977186">,</span>&nbsp;<span class="builtintype" id="1977188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977194">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1977197">c3</span>&nbsp;<span class="op" id="1977200">:=</span>&nbsp;<span class="ident" id="1977203">p</span><span class="op" id="1977204">[</span><span class="num" id="1977205">3</span><span class="op" id="1977206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977209">if</span>&nbsp;<span class="ident" id="1977212">c3</span>&nbsp;<span class="op" id="1977215">&lt;</span>&nbsp;<span class="ident" id="1977217">tx</span>&nbsp;<span class="op" id="1977220">||</span>&nbsp;<span class="ident" id="1977223">t2</span>&nbsp;<span class="op" id="1977226">&lt;=</span>&nbsp;<span class="ident" id="1977229">c3</span>&nbsp;<span class="op" id="1977232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977236">return</span>&nbsp;<span class="ident" id="1977243">RuneError</span><span class="op" id="1977252">,</span>&nbsp;<span class="num" id="1977254">1</span><span class="op" id="1977255">,</span>&nbsp;<span class="builtintype" id="1977257">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977268">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977297">if</span>&nbsp;<span class="ident" id="1977300">c0</span>&nbsp;<span class="op" id="1977303">&lt;</span>&nbsp;<span class="ident" id="1977305">t5</span>&nbsp;<span class="op" id="1977308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1977312">r</span>&nbsp;<span class="op" id="1977314">=</span>&nbsp;<span class="builtintype" id="1977316">rune</span><span class="op" id="1977320">(</span><span class="ident" id="1977321">c0</span><span class="op" id="1977323">&amp;</span><span class="ident" id="1977324">mask4</span><span class="op" id="1977329">)</span><span class="op" id="1977330">&lt;&lt;</span><span class="num" id="1977332">18</span>&nbsp;<span class="op" id="1977335">|</span>&nbsp;<span class="builtintype" id="1977337">rune</span><span class="op" id="1977341">(</span><span class="ident" id="1977342">c1</span><span class="op" id="1977344">&amp;</span><span class="ident" id="1977345">maskx</span><span class="op" id="1977350">)</span><span class="op" id="1977351">&lt;&lt;</span><span class="num" id="1977353">12</span>&nbsp;<span class="op" id="1977356">|</span>&nbsp;<span class="builtintype" id="1977358">rune</span><span class="op" id="1977362">(</span><span class="ident" id="1977363">c2</span><span class="op" id="1977365">&amp;</span><span class="ident" id="1977366">maskx</span><span class="op" id="1977371">)</span><span class="op" id="1977372">&lt;&lt;</span><span class="num" id="1977374">6</span>&nbsp;<span class="op" id="1977376">|</span>&nbsp;<span class="builtintype" id="1977378">rune</span><span class="op" id="1977382">(</span><span class="ident" id="1977383">c3</span><span class="op" id="1977385">&amp;</span><span class="ident" id="1977386">maskx</span><span class="op" id="1977391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977395">if</span>&nbsp;<span class="ident" id="1977398">r</span>&nbsp;<span class="op" id="1977400">&lt;=</span>&nbsp;<span class="ident" id="1977403">rune3Max</span>&nbsp;<span class="op" id="1977412">||</span>&nbsp;<span class="ident" id="1977415">MaxRune</span>&nbsp;<span class="op" id="1977423">&lt;</span>&nbsp;<span class="ident" id="1977425">r</span>&nbsp;<span class="op" id="1977427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977432">return</span>&nbsp;<span class="ident" id="1977439">RuneError</span><span class="op" id="1977448">,</span>&nbsp;<span class="num" id="1977450">1</span><span class="op" id="1977451">,</span>&nbsp;<span class="builtintype" id="1977453">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977465">return</span>&nbsp;<span class="ident" id="1977472">r</span><span class="op" id="1977473">,</span>&nbsp;<span class="num" id="1977475">4</span><span class="op" id="1977476">,</span>&nbsp;<span class="builtintype" id="1977478">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977489">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977499">return</span>&nbsp;<span class="ident" id="1977506">RuneError</span><span class="op" id="1977515">,</span>&nbsp;<span class="num" id="1977517">1</span><span class="op" id="1977518">,</span>&nbsp;<span class="builtintype" id="1977520">false</span><br>
<span class="lineno"></span><span class="op" id="1977526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1977529">func</span>&nbsp;<span class="ident" id="1977534">decodeRuneInStringInternal</span><span class="op" id="1977560">(</span><span class="ident" id="1977561">s</span>&nbsp;<span class="builtintype" id="1977563">string</span><span class="op" id="1977569">)</span>&nbsp;<span class="op" id="1977571">(</span><span class="ident" id="1977572">r</span>&nbsp;<span class="builtintype" id="1977574">rune</span><span class="op" id="1977578">,</span>&nbsp;<span class="ident" id="1977580">size</span>&nbsp;<span class="builtintype" id="1977585">int</span><span class="op" id="1977588">,</span>&nbsp;<span class="ident" id="1977590">short</span>&nbsp;<span class="builtintype" id="1977596">bool</span><span class="op" id="1977600">)</span>&nbsp;<span class="op" id="1977602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1977605">n</span>&nbsp;<span class="op" id="1977607">:=</span>&nbsp;<span class="builtinfunc" id="1977610">len</span><span class="op" id="1977613">(</span><span class="ident" id="1977614">s</span><span class="op" id="1977615">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977618">if</span>&nbsp;<span class="ident" id="1977621">n</span>&nbsp;<span class="op" id="1977623">&lt;</span>&nbsp;<span class="num" id="1977625">1</span>&nbsp;<span class="op" id="1977627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977631">return</span>&nbsp;<span class="ident" id="1977638">RuneError</span><span class="op" id="1977647">,</span>&nbsp;<span class="num" id="1977649">0</span><span class="op" id="1977650">,</span>&nbsp;<span class="builtintype" id="1977652">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1977661">c0</span>&nbsp;<span class="op" id="1977664">:=</span>&nbsp;<span class="ident" id="1977667">s</span><span class="op" id="1977668">[</span><span class="num" id="1977669">0</span><span class="op" id="1977670">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977674">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977702">if</span>&nbsp;<span class="ident" id="1977705">c0</span>&nbsp;<span class="op" id="1977708">&lt;</span>&nbsp;<span class="ident" id="1977710">tx</span>&nbsp;<span class="op" id="1977713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977717">return</span>&nbsp;<span class="builtintype" id="1977724">rune</span><span class="op" id="1977728">(</span><span class="ident" id="1977729">c0</span><span class="op" id="1977731">)</span><span class="op" id="1977732">,</span>&nbsp;<span class="num" id="1977734">1</span><span class="op" id="1977735">,</span>&nbsp;<span class="builtintype" id="1977737">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977748">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977782">if</span>&nbsp;<span class="ident" id="1977785">c0</span>&nbsp;<span class="op" id="1977788">&lt;</span>&nbsp;<span class="ident" id="1977790">t2</span>&nbsp;<span class="op" id="1977793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977797">return</span>&nbsp;<span class="ident" id="1977804">RuneError</span><span class="op" id="1977813">,</span>&nbsp;<span class="num" id="1977815">1</span><span class="op" id="1977816">,</span>&nbsp;<span class="builtintype" id="1977818">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977829">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977862">if</span>&nbsp;<span class="ident" id="1977865">n</span>&nbsp;<span class="op" id="1977867">&lt;</span>&nbsp;<span class="num" id="1977869">2</span>&nbsp;<span class="op" id="1977871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977875">return</span>&nbsp;<span class="ident" id="1977882">RuneError</span><span class="op" id="1977891">,</span>&nbsp;<span class="num" id="1977893">1</span><span class="op" id="1977894">,</span>&nbsp;<span class="builtintype" id="1977896">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1977905">c1</span>&nbsp;<span class="op" id="1977908">:=</span>&nbsp;<span class="ident" id="1977911">s</span><span class="op" id="1977912">[</span><span class="num" id="1977913">1</span><span class="op" id="1977914">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977917">if</span>&nbsp;<span class="ident" id="1977920">c1</span>&nbsp;<span class="op" id="1977923">&lt;</span>&nbsp;<span class="ident" id="1977925">tx</span>&nbsp;<span class="op" id="1977928">||</span>&nbsp;<span class="ident" id="1977931">t2</span>&nbsp;<span class="op" id="1977934">&lt;=</span>&nbsp;<span class="ident" id="1977937">c1</span>&nbsp;<span class="op" id="1977940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1977944">return</span>&nbsp;<span class="ident" id="1977951">RuneError</span><span class="op" id="1977960">,</span>&nbsp;<span class="num" id="1977962">1</span><span class="op" id="1977963">,</span>&nbsp;<span class="builtintype" id="1977965">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1977972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1977976">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978005">if</span>&nbsp;<span class="ident" id="1978008">c0</span>&nbsp;<span class="op" id="1978011">&lt;</span>&nbsp;<span class="ident" id="1978013">t3</span>&nbsp;<span class="op" id="1978016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1978020">r</span>&nbsp;<span class="op" id="1978022">=</span>&nbsp;<span class="builtintype" id="1978024">rune</span><span class="op" id="1978028">(</span><span class="ident" id="1978029">c0</span><span class="op" id="1978031">&amp;</span><span class="ident" id="1978032">mask2</span><span class="op" id="1978037">)</span><span class="op" id="1978038">&lt;&lt;</span><span class="num" id="1978040">6</span>&nbsp;<span class="op" id="1978042">|</span>&nbsp;<span class="builtintype" id="1978044">rune</span><span class="op" id="1978048">(</span><span class="ident" id="1978049">c1</span><span class="op" id="1978051">&amp;</span><span class="ident" id="1978052">maskx</span><span class="op" id="1978057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978061">if</span>&nbsp;<span class="ident" id="1978064">r</span>&nbsp;<span class="op" id="1978066">&lt;=</span>&nbsp;<span class="ident" id="1978069">rune1Max</span>&nbsp;<span class="op" id="1978078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978083">return</span>&nbsp;<span class="ident" id="1978090">RuneError</span><span class="op" id="1978099">,</span>&nbsp;<span class="num" id="1978101">1</span><span class="op" id="1978102">,</span>&nbsp;<span class="builtintype" id="1978104">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978112">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978116">return</span>&nbsp;<span class="ident" id="1978123">r</span><span class="op" id="1978124">,</span>&nbsp;<span class="num" id="1978126">2</span><span class="op" id="1978127">,</span>&nbsp;<span class="builtintype" id="1978129">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1978140">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978174">if</span>&nbsp;<span class="ident" id="1978177">n</span>&nbsp;<span class="op" id="1978179">&lt;</span>&nbsp;<span class="num" id="1978181">3</span>&nbsp;<span class="op" id="1978183">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978187">return</span>&nbsp;<span class="ident" id="1978194">RuneError</span><span class="op" id="1978203">,</span>&nbsp;<span class="num" id="1978205">1</span><span class="op" id="1978206">,</span>&nbsp;<span class="builtintype" id="1978208">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1978217">c2</span>&nbsp;<span class="op" id="1978220">:=</span>&nbsp;<span class="ident" id="1978223">s</span><span class="op" id="1978224">[</span><span class="num" id="1978225">2</span><span class="op" id="1978226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978229">if</span>&nbsp;<span class="ident" id="1978232">c2</span>&nbsp;<span class="op" id="1978235">&lt;</span>&nbsp;<span class="ident" id="1978237">tx</span>&nbsp;<span class="op" id="1978240">||</span>&nbsp;<span class="ident" id="1978243">t2</span>&nbsp;<span class="op" id="1978246">&lt;=</span>&nbsp;<span class="ident" id="1978249">c2</span>&nbsp;<span class="op" id="1978252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978256">return</span>&nbsp;<span class="ident" id="1978263">RuneError</span><span class="op" id="1978272">,</span>&nbsp;<span class="num" id="1978274">1</span><span class="op" id="1978275">,</span>&nbsp;<span class="builtintype" id="1978277">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1978288">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978317">if</span>&nbsp;<span class="ident" id="1978320">c0</span>&nbsp;<span class="op" id="1978323">&lt;</span>&nbsp;<span class="ident" id="1978325">t4</span>&nbsp;<span class="op" id="1978328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1978332">r</span>&nbsp;<span class="op" id="1978334">=</span>&nbsp;<span class="builtintype" id="1978336">rune</span><span class="op" id="1978340">(</span><span class="ident" id="1978341">c0</span><span class="op" id="1978343">&amp;</span><span class="ident" id="1978344">mask3</span><span class="op" id="1978349">)</span><span class="op" id="1978350">&lt;&lt;</span><span class="num" id="1978352">12</span>&nbsp;<span class="op" id="1978355">|</span>&nbsp;<span class="builtintype" id="1978357">rune</span><span class="op" id="1978361">(</span><span class="ident" id="1978362">c1</span><span class="op" id="1978364">&amp;</span><span class="ident" id="1978365">maskx</span><span class="op" id="1978370">)</span><span class="op" id="1978371">&lt;&lt;</span><span class="num" id="1978373">6</span>&nbsp;<span class="op" id="1978375">|</span>&nbsp;<span class="builtintype" id="1978377">rune</span><span class="op" id="1978381">(</span><span class="ident" id="1978382">c2</span><span class="op" id="1978384">&amp;</span><span class="ident" id="1978385">maskx</span><span class="op" id="1978390">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978394">if</span>&nbsp;<span class="ident" id="1978397">r</span>&nbsp;<span class="op" id="1978399">&lt;=</span>&nbsp;<span class="ident" id="1978402">rune2Max</span>&nbsp;<span class="op" id="1978411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978416">return</span>&nbsp;<span class="ident" id="1978423">RuneError</span><span class="op" id="1978432">,</span>&nbsp;<span class="num" id="1978434">1</span><span class="op" id="1978435">,</span>&nbsp;<span class="builtintype" id="1978437">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978449">if</span>&nbsp;<span class="ident" id="1978452">surrogateMin</span>&nbsp;<span class="op" id="1978465">&lt;=</span>&nbsp;<span class="ident" id="1978468">r</span>&nbsp;<span class="op" id="1978470">&amp;&amp;</span>&nbsp;<span class="ident" id="1978473">r</span>&nbsp;<span class="op" id="1978475">&lt;=</span>&nbsp;<span class="ident" id="1978478">surrogateMax</span>&nbsp;<span class="op" id="1978491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978496">return</span>&nbsp;<span class="ident" id="1978503">RuneError</span><span class="op" id="1978512">,</span>&nbsp;<span class="num" id="1978514">1</span><span class="op" id="1978515">,</span>&nbsp;<span class="builtintype" id="1978517">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978529">return</span>&nbsp;<span class="ident" id="1978536">r</span><span class="op" id="1978537">,</span>&nbsp;<span class="num" id="1978539">3</span><span class="op" id="1978540">,</span>&nbsp;<span class="builtintype" id="1978542">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1978553">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978586">if</span>&nbsp;<span class="ident" id="1978589">n</span>&nbsp;<span class="op" id="1978591">&lt;</span>&nbsp;<span class="num" id="1978593">4</span>&nbsp;<span class="op" id="1978595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978599">return</span>&nbsp;<span class="ident" id="1978606">RuneError</span><span class="op" id="1978615">,</span>&nbsp;<span class="num" id="1978617">1</span><span class="op" id="1978618">,</span>&nbsp;<span class="builtintype" id="1978620">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1978629">c3</span>&nbsp;<span class="op" id="1978632">:=</span>&nbsp;<span class="ident" id="1978635">s</span><span class="op" id="1978636">[</span><span class="num" id="1978637">3</span><span class="op" id="1978638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978641">if</span>&nbsp;<span class="ident" id="1978644">c3</span>&nbsp;<span class="op" id="1978647">&lt;</span>&nbsp;<span class="ident" id="1978649">tx</span>&nbsp;<span class="op" id="1978652">||</span>&nbsp;<span class="ident" id="1978655">t2</span>&nbsp;<span class="op" id="1978658">&lt;=</span>&nbsp;<span class="ident" id="1978661">c3</span>&nbsp;<span class="op" id="1978664">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978668">return</span>&nbsp;<span class="ident" id="1978675">RuneError</span><span class="op" id="1978684">,</span>&nbsp;<span class="num" id="1978686">1</span><span class="op" id="1978687">,</span>&nbsp;<span class="builtintype" id="1978689">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1978700">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978729">if</span>&nbsp;<span class="ident" id="1978732">c0</span>&nbsp;<span class="op" id="1978735">&lt;</span>&nbsp;<span class="ident" id="1978737">t5</span>&nbsp;<span class="op" id="1978740">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1978744">r</span>&nbsp;<span class="op" id="1978746">=</span>&nbsp;<span class="builtintype" id="1978748">rune</span><span class="op" id="1978752">(</span><span class="ident" id="1978753">c0</span><span class="op" id="1978755">&amp;</span><span class="ident" id="1978756">mask4</span><span class="op" id="1978761">)</span><span class="op" id="1978762">&lt;&lt;</span><span class="num" id="1978764">18</span>&nbsp;<span class="op" id="1978767">|</span>&nbsp;<span class="builtintype" id="1978769">rune</span><span class="op" id="1978773">(</span><span class="ident" id="1978774">c1</span><span class="op" id="1978776">&amp;</span><span class="ident" id="1978777">maskx</span><span class="op" id="1978782">)</span><span class="op" id="1978783">&lt;&lt;</span><span class="num" id="1978785">12</span>&nbsp;<span class="op" id="1978788">|</span>&nbsp;<span class="builtintype" id="1978790">rune</span><span class="op" id="1978794">(</span><span class="ident" id="1978795">c2</span><span class="op" id="1978797">&amp;</span><span class="ident" id="1978798">maskx</span><span class="op" id="1978803">)</span><span class="op" id="1978804">&lt;&lt;</span><span class="num" id="1978806">6</span>&nbsp;<span class="op" id="1978808">|</span>&nbsp;<span class="builtintype" id="1978810">rune</span><span class="op" id="1978814">(</span><span class="ident" id="1978815">c3</span><span class="op" id="1978817">&amp;</span><span class="ident" id="1978818">maskx</span><span class="op" id="1978823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978827">if</span>&nbsp;<span class="ident" id="1978830">r</span>&nbsp;<span class="op" id="1978832">&lt;=</span>&nbsp;<span class="ident" id="1978835">rune3Max</span>&nbsp;<span class="op" id="1978844">||</span>&nbsp;<span class="ident" id="1978847">MaxRune</span>&nbsp;<span class="op" id="1978855">&lt;</span>&nbsp;<span class="ident" id="1978857">r</span>&nbsp;<span class="op" id="1978859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978864">return</span>&nbsp;<span class="ident" id="1978871">RuneError</span><span class="op" id="1978880">,</span>&nbsp;<span class="num" id="1978882">1</span><span class="op" id="1978883">,</span>&nbsp;<span class="builtintype" id="1978885">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978897">return</span>&nbsp;<span class="ident" id="1978904">r</span><span class="op" id="1978905">,</span>&nbsp;<span class="num" id="1978907">4</span><span class="op" id="1978908">,</span>&nbsp;<span class="builtintype" id="1978910">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1978917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1978921">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1978931">return</span>&nbsp;<span class="ident" id="1978938">RuneError</span><span class="op" id="1978947">,</span>&nbsp;<span class="num" id="1978949">1</span><span class="op" id="1978950">,</span>&nbsp;<span class="builtintype" id="1978952">false</span><br>
<span class="lineno"></span><span class="op" id="1978958">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1978961">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1979048">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1979144">func</span>&nbsp;<span class="ident" id="1979149">FullRune</span><span class="op" id="1979157">(</span><span class="ident" id="1979158">p</span>&nbsp;<span class="op" id="1979160">[</span><span class="op" id="1979161">]</span><span class="builtintype" id="1979162">byte</span><span class="op" id="1979166">)</span>&nbsp;<span class="builtintype" id="1979168">bool</span>&nbsp;<span class="op" id="1979173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1979176">_</span><span class="op" id="1979177">,</span>&nbsp;<span class="ident" id="1979179">_</span><span class="op" id="1979180">,</span>&nbsp;<span class="ident" id="1979182">short</span>&nbsp;<span class="op" id="1979188">:=</span>&nbsp;<span class="ident" id="1979191">decodeRuneInternal</span><span class="op" id="1979209">(</span><span class="ident" id="1979210">p</span><span class="op" id="1979211">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1979214">return</span>&nbsp;<span class="op" id="1979221">!</span><span class="ident" id="1979222">short</span><br>
<span class="lineno"></span><span class="op" id="1979228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1979231">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1979295">func</span>&nbsp;<span class="ident" id="1979300">FullRuneInString</span><span class="op" id="1979316">(</span><span class="ident" id="1979317">s</span>&nbsp;<span class="builtintype" id="1979319">string</span><span class="op" id="1979325">)</span>&nbsp;<span class="builtintype" id="1979327">bool</span>&nbsp;<span class="op" id="1979332">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1979335">_</span><span class="op" id="1979336">,</span>&nbsp;<span class="ident" id="1979338">_</span><span class="op" id="1979339">,</span>&nbsp;<span class="ident" id="1979341">short</span>&nbsp;<span class="op" id="1979347">:=</span>&nbsp;<span class="ident" id="1979350">decodeRuneInStringInternal</span><span class="op" id="1979376">(</span><span class="ident" id="1979377">s</span><span class="op" id="1979378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1979381">return</span>&nbsp;<span class="op" id="1979388">!</span><span class="ident" id="1979389">short</span><br>
<span class="lineno"></span><span class="op" id="1979395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1979398">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1979475">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1979553">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1979628">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1979658">//</span><br>
<span class="lineno"></span><span class="comment" id="1979661">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1979736">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1979808">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1979852">func</span>&nbsp;<span class="ident" id="1979857">DecodeRune</span><span class="op" id="1979867">(</span><span class="ident" id="1979868">p</span>&nbsp;<span class="op" id="1979870">[</span><span class="op" id="1979871">]</span><span class="builtintype" id="1979872">byte</span><span class="op" id="1979876">)</span>&nbsp;<span class="op" id="1979878">(</span><span class="ident" id="1979879">r</span>&nbsp;<span class="builtintype" id="1979881">rune</span><span class="op" id="1979885">,</span>&nbsp;<span class="ident" id="1979887">size</span>&nbsp;<span class="builtintype" id="1979892">int</span><span class="op" id="1979895">)</span>&nbsp;<span class="op" id="1979897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1979900">r</span><span class="op" id="1979901">,</span>&nbsp;<span class="ident" id="1979903">size</span><span class="op" id="1979907">,</span>&nbsp;<span class="ident" id="1979909">_</span>&nbsp;<span class="op" id="1979911">=</span>&nbsp;<span class="ident" id="1979913">decodeRuneInternal</span><span class="op" id="1979931">(</span><span class="ident" id="1979932">p</span><span class="op" id="1979933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1979936">return</span><br>
<span class="lineno">225</span><span class="op" id="1979943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1979946">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1980022">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1980100">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1980174">//</span><br>
<span class="lineno"></span><span class="comment" id="1980177">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1980252">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1980324">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1980368">func</span>&nbsp;<span class="ident" id="1980373">DecodeRuneInString</span><span class="op" id="1980391">(</span><span class="ident" id="1980392">s</span>&nbsp;<span class="builtintype" id="1980394">string</span><span class="op" id="1980400">)</span>&nbsp;<span class="op" id="1980402">(</span><span class="ident" id="1980403">r</span>&nbsp;<span class="builtintype" id="1980405">rune</span><span class="op" id="1980409">,</span>&nbsp;<span class="ident" id="1980411">size</span>&nbsp;<span class="builtintype" id="1980416">int</span><span class="op" id="1980419">)</span>&nbsp;<span class="op" id="1980421">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1980424">r</span><span class="op" id="1980425">,</span>&nbsp;<span class="ident" id="1980427">size</span><span class="op" id="1980431">,</span>&nbsp;<span class="ident" id="1980433">_</span>&nbsp;<span class="op" id="1980435">=</span>&nbsp;<span class="ident" id="1980437">decodeRuneInStringInternal</span><span class="op" id="1980463">(</span><span class="ident" id="1980464">s</span><span class="op" id="1980465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1980468">return</span><br>
<span class="lineno"></span><span class="op" id="1980475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1980478">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1980558">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1980636">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1980711">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1980741">//</span><br>
<span class="lineno"></span><span class="comment" id="1980744">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1980819">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1980891">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1980935">func</span>&nbsp;<span class="ident" id="1980940">DecodeLastRune</span><span class="op" id="1980954">(</span><span class="ident" id="1980955">p</span>&nbsp;<span class="op" id="1980957">[</span><span class="op" id="1980958">]</span><span class="builtintype" id="1980959">byte</span><span class="op" id="1980963">)</span>&nbsp;<span class="op" id="1980965">(</span><span class="ident" id="1980966">r</span>&nbsp;<span class="builtintype" id="1980968">rune</span><span class="op" id="1980972">,</span>&nbsp;<span class="ident" id="1980974">size</span>&nbsp;<span class="builtintype" id="1980979">int</span><span class="op" id="1980982">)</span>&nbsp;<span class="op" id="1980984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1980987">end</span>&nbsp;<span class="op" id="1980991">:=</span>&nbsp;<span class="builtinfunc" id="1980994">len</span><span class="op" id="1980997">(</span><span class="ident" id="1980998">p</span><span class="op" id="1980999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981002">if</span>&nbsp;<span class="ident" id="1981005">end</span>&nbsp;<span class="op" id="1981009">==</span>&nbsp;<span class="num" id="1981012">0</span>&nbsp;<span class="op" id="1981014">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981018">return</span>&nbsp;<span class="ident" id="1981025">RuneError</span><span class="op" id="1981034">,</span>&nbsp;<span class="num" id="1981036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981042">start</span>&nbsp;<span class="op" id="1981048">:=</span>&nbsp;<span class="ident" id="1981051">end</span>&nbsp;<span class="op" id="1981055">-</span>&nbsp;<span class="num" id="1981057">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981060">r</span>&nbsp;<span class="op" id="1981062">=</span>&nbsp;<span class="builtintype" id="1981064">rune</span><span class="op" id="1981068">(</span><span class="ident" id="1981069">p</span><span class="op" id="1981070">[</span><span class="ident" id="1981071">start</span><span class="op" id="1981076">]</span><span class="op" id="1981077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981080">if</span>&nbsp;<span class="ident" id="1981083">r</span>&nbsp;<span class="op" id="1981085">&lt;</span>&nbsp;<span class="ident" id="1981087">RuneSelf</span>&nbsp;<span class="op" id="1981096">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981100">return</span>&nbsp;<span class="ident" id="1981107">r</span><span class="op" id="1981108">,</span>&nbsp;<span class="num" id="1981110">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1981116">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1981166">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1981219">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981238">lim</span>&nbsp;<span class="op" id="1981242">:=</span>&nbsp;<span class="ident" id="1981245">end</span>&nbsp;<span class="op" id="1981249">-</span>&nbsp;<span class="ident" id="1981251">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981259">if</span>&nbsp;<span class="ident" id="1981262">lim</span>&nbsp;<span class="op" id="1981266">&lt;</span>&nbsp;<span class="num" id="1981268">0</span>&nbsp;<span class="op" id="1981270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981274">lim</span>&nbsp;<span class="op" id="1981278">=</span>&nbsp;<span class="num" id="1981280">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981286">for</span>&nbsp;<span class="ident" id="1981290">start</span><span class="op" id="1981295">--</span><span class="op" id="1981297">;</span>&nbsp;<span class="ident" id="1981299">start</span>&nbsp;<span class="op" id="1981305">&gt;=</span>&nbsp;<span class="ident" id="1981308">lim</span><span class="op" id="1981311">;</span>&nbsp;<span class="ident" id="1981313">start</span><span class="op" id="1981318">--</span>&nbsp;<span class="op" id="1981321">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981325">if</span>&nbsp;<span class="ident" id="1981328">RuneStart</span><span class="op" id="1981337">(</span><span class="ident" id="1981338">p</span><span class="op" id="1981339">[</span><span class="ident" id="1981340">start</span><span class="op" id="1981345">]</span><span class="op" id="1981346">)</span>&nbsp;<span class="op" id="1981348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981353">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981367">if</span>&nbsp;<span class="ident" id="1981370">start</span>&nbsp;<span class="op" id="1981376">&lt;</span>&nbsp;<span class="num" id="1981378">0</span>&nbsp;<span class="op" id="1981380">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981384">start</span>&nbsp;<span class="op" id="1981390">=</span>&nbsp;<span class="num" id="1981392">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981398">r</span><span class="op" id="1981399">,</span>&nbsp;<span class="ident" id="1981401">size</span>&nbsp;<span class="op" id="1981406">=</span>&nbsp;<span class="ident" id="1981408">DecodeRune</span><span class="op" id="1981418">(</span><span class="ident" id="1981419">p</span><span class="op" id="1981420">[</span><span class="ident" id="1981421">start</span><span class="op" id="1981426">:</span><span class="ident" id="1981427">end</span><span class="op" id="1981430">]</span><span class="op" id="1981431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981434">if</span>&nbsp;<span class="ident" id="1981437">start</span><span class="op" id="1981442">+</span><span class="ident" id="1981443">size</span>&nbsp;<span class="op" id="1981448">!=</span>&nbsp;<span class="ident" id="1981451">end</span>&nbsp;<span class="op" id="1981455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981459">return</span>&nbsp;<span class="ident" id="1981466">RuneError</span><span class="op" id="1981475">,</span>&nbsp;<span class="num" id="1981477">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1981480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1981483">return</span>&nbsp;<span class="ident" id="1981490">r</span><span class="op" id="1981491">,</span>&nbsp;<span class="ident" id="1981493">size</span><br>
<span class="lineno"></span><span class="op" id="1981498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1981501">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1981580">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1981660">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1981737">//</span><br>
<span class="lineno"></span><span class="comment" id="1981740">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1981815">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1981887">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1981931">func</span>&nbsp;<span class="ident" id="1981936">DecodeLastRuneInString</span><span class="op" id="1981958">(</span><span class="ident" id="1981959">s</span>&nbsp;<span class="builtintype" id="1981961">string</span><span class="op" id="1981967">)</span>&nbsp;<span class="op" id="1981969">(</span><span class="ident" id="1981970">r</span>&nbsp;<span class="builtintype" id="1981972">rune</span><span class="op" id="1981976">,</span>&nbsp;<span class="ident" id="1981978">size</span>&nbsp;<span class="builtintype" id="1981983">int</span><span class="op" id="1981986">)</span>&nbsp;<span class="op" id="1981988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1981991">end</span>&nbsp;<span class="op" id="1981995">:=</span>&nbsp;<span class="builtinfunc" id="1981998">len</span><span class="op" id="1982001">(</span><span class="ident" id="1982002">s</span><span class="op" id="1982003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982006">if</span>&nbsp;<span class="ident" id="1982009">end</span>&nbsp;<span class="op" id="1982013">==</span>&nbsp;<span class="num" id="1982016">0</span>&nbsp;<span class="op" id="1982018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982022">return</span>&nbsp;<span class="ident" id="1982029">RuneError</span><span class="op" id="1982038">,</span>&nbsp;<span class="num" id="1982040">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982046">start</span>&nbsp;<span class="op" id="1982052">:=</span>&nbsp;<span class="ident" id="1982055">end</span>&nbsp;<span class="op" id="1982059">-</span>&nbsp;<span class="num" id="1982061">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982064">r</span>&nbsp;<span class="op" id="1982066">=</span>&nbsp;<span class="builtintype" id="1982068">rune</span><span class="op" id="1982072">(</span><span class="ident" id="1982073">s</span><span class="op" id="1982074">[</span><span class="ident" id="1982075">start</span><span class="op" id="1982080">]</span><span class="op" id="1982081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982084">if</span>&nbsp;<span class="ident" id="1982087">r</span>&nbsp;<span class="op" id="1982089">&lt;</span>&nbsp;<span class="ident" id="1982091">RuneSelf</span>&nbsp;<span class="op" id="1982100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982104">return</span>&nbsp;<span class="ident" id="1982111">r</span><span class="op" id="1982112">,</span>&nbsp;<span class="num" id="1982114">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1982120">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1982170">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1982223">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982242">lim</span>&nbsp;<span class="op" id="1982246">:=</span>&nbsp;<span class="ident" id="1982249">end</span>&nbsp;<span class="op" id="1982253">-</span>&nbsp;<span class="ident" id="1982255">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982263">if</span>&nbsp;<span class="ident" id="1982266">lim</span>&nbsp;<span class="op" id="1982270">&lt;</span>&nbsp;<span class="num" id="1982272">0</span>&nbsp;<span class="op" id="1982274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982278">lim</span>&nbsp;<span class="op" id="1982282">=</span>&nbsp;<span class="num" id="1982284">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982290">for</span>&nbsp;<span class="ident" id="1982294">start</span><span class="op" id="1982299">--</span><span class="op" id="1982301">;</span>&nbsp;<span class="ident" id="1982303">start</span>&nbsp;<span class="op" id="1982309">&gt;=</span>&nbsp;<span class="ident" id="1982312">lim</span><span class="op" id="1982315">;</span>&nbsp;<span class="ident" id="1982317">start</span><span class="op" id="1982322">--</span>&nbsp;<span class="op" id="1982325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982329">if</span>&nbsp;<span class="ident" id="1982332">RuneStart</span><span class="op" id="1982341">(</span><span class="ident" id="1982342">s</span><span class="op" id="1982343">[</span><span class="ident" id="1982344">start</span><span class="op" id="1982349">]</span><span class="op" id="1982350">)</span>&nbsp;<span class="op" id="1982352">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982357">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982371">if</span>&nbsp;<span class="ident" id="1982374">start</span>&nbsp;<span class="op" id="1982380">&lt;</span>&nbsp;<span class="num" id="1982382">0</span>&nbsp;<span class="op" id="1982384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982388">start</span>&nbsp;<span class="op" id="1982394">=</span>&nbsp;<span class="num" id="1982396">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1982402">r</span><span class="op" id="1982403">,</span>&nbsp;<span class="ident" id="1982405">size</span>&nbsp;<span class="op" id="1982410">=</span>&nbsp;<span class="ident" id="1982412">DecodeRuneInString</span><span class="op" id="1982430">(</span><span class="ident" id="1982431">s</span><span class="op" id="1982432">[</span><span class="ident" id="1982433">start</span><span class="op" id="1982438">:</span><span class="ident" id="1982439">end</span><span class="op" id="1982442">]</span><span class="op" id="1982443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982446">if</span>&nbsp;<span class="ident" id="1982449">start</span><span class="op" id="1982454">+</span><span class="ident" id="1982455">size</span>&nbsp;<span class="op" id="1982460">!=</span>&nbsp;<span class="ident" id="1982463">end</span>&nbsp;<span class="op" id="1982467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982471">return</span>&nbsp;<span class="ident" id="1982478">RuneError</span><span class="op" id="1982487">,</span>&nbsp;<span class="num" id="1982489">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982492">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982495">return</span>&nbsp;<span class="ident" id="1982502">r</span><span class="op" id="1982503">,</span>&nbsp;<span class="ident" id="1982505">size</span><br>
<span class="lineno"></span><span class="op" id="1982510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1982513">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1982581">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1982651">func</span>&nbsp;<span class="ident" id="1982656">RuneLen</span><span class="op" id="1982663">(</span><span class="ident" id="1982664">r</span>&nbsp;<span class="builtintype" id="1982666">rune</span><span class="op" id="1982670">)</span>&nbsp;<span class="builtintype" id="1982672">int</span>&nbsp;<span class="op" id="1982676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982679">switch</span>&nbsp;<span class="op" id="1982686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982689">case</span>&nbsp;<span class="ident" id="1982694">r</span>&nbsp;<span class="op" id="1982696">&lt;</span>&nbsp;<span class="num" id="1982698">0</span><span class="op" id="1982699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982703">return</span>&nbsp;<span class="op" id="1982710">-</span><span class="num" id="1982711">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982714">case</span>&nbsp;<span class="ident" id="1982719">r</span>&nbsp;<span class="op" id="1982721">&lt;=</span>&nbsp;<span class="ident" id="1982724">rune1Max</span><span class="op" id="1982732">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982736">return</span>&nbsp;<span class="num" id="1982743">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982746">case</span>&nbsp;<span class="ident" id="1982751">r</span>&nbsp;<span class="op" id="1982753">&lt;=</span>&nbsp;<span class="ident" id="1982756">rune2Max</span><span class="op" id="1982764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982768">return</span>&nbsp;<span class="num" id="1982775">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982778">case</span>&nbsp;<span class="ident" id="1982783">surrogateMin</span>&nbsp;<span class="op" id="1982796">&lt;=</span>&nbsp;<span class="ident" id="1982799">r</span>&nbsp;<span class="op" id="1982801">&amp;&amp;</span>&nbsp;<span class="ident" id="1982804">r</span>&nbsp;<span class="op" id="1982806">&lt;=</span>&nbsp;<span class="ident" id="1982809">surrogateMax</span><span class="op" id="1982821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982825">return</span>&nbsp;<span class="op" id="1982832">-</span><span class="num" id="1982833">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982836">case</span>&nbsp;<span class="ident" id="1982841">r</span>&nbsp;<span class="op" id="1982843">&lt;=</span>&nbsp;<span class="ident" id="1982846">rune3Max</span><span class="op" id="1982854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982858">return</span>&nbsp;<span class="num" id="1982865">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982868">case</span>&nbsp;<span class="ident" id="1982873">r</span>&nbsp;<span class="op" id="1982875">&lt;=</span>&nbsp;<span class="ident" id="1982878">MaxRune</span><span class="op" id="1982885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982889">return</span>&nbsp;<span class="num" id="1982896">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1982899">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1982902">return</span>&nbsp;<span class="op" id="1982909">-</span><span class="num" id="1982910">1</span><br>
<span class="lineno"></span><span class="op" id="1982912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1982915">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1983004">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1983047">func</span>&nbsp;<span class="ident" id="1983052">EncodeRune</span><span class="op" id="1983062">(</span><span class="ident" id="1983063">p</span>&nbsp;<span class="op" id="1983065">[</span><span class="op" id="1983066">]</span><span class="builtintype" id="1983067">byte</span><span class="op" id="1983071">,</span>&nbsp;<span class="ident" id="1983073">r</span>&nbsp;<span class="builtintype" id="1983075">rune</span><span class="op" id="1983079">)</span>&nbsp;<span class="builtintype" id="1983081">int</span>&nbsp;<span class="op" id="1983085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1983088">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983166">switch</span>&nbsp;<span class="ident" id="1983173">i</span>&nbsp;<span class="op" id="1983175">:=</span>&nbsp;<span class="builtintype" id="1983178">uint32</span><span class="op" id="1983184">(</span><span class="ident" id="1983185">r</span><span class="op" id="1983186">)</span><span class="op" id="1983187">;</span>&nbsp;<span class="op" id="1983189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983192">case</span>&nbsp;<span class="ident" id="1983197">i</span>&nbsp;<span class="op" id="1983199">&lt;=</span>&nbsp;<span class="ident" id="1983202">rune1Max</span><span class="op" id="1983210">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983214">p</span><span class="op" id="1983215">[</span><span class="num" id="1983216">0</span><span class="op" id="1983217">]</span>&nbsp;<span class="op" id="1983219">=</span>&nbsp;<span class="builtintype" id="1983221">byte</span><span class="op" id="1983225">(</span><span class="ident" id="1983226">r</span><span class="op" id="1983227">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983231">return</span>&nbsp;<span class="num" id="1983238">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983241">case</span>&nbsp;<span class="ident" id="1983246">i</span>&nbsp;<span class="op" id="1983248">&lt;=</span>&nbsp;<span class="ident" id="1983251">rune2Max</span><span class="op" id="1983259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983263">p</span><span class="op" id="1983264">[</span><span class="num" id="1983265">0</span><span class="op" id="1983266">]</span>&nbsp;<span class="op" id="1983268">=</span>&nbsp;<span class="ident" id="1983270">t2</span>&nbsp;<span class="op" id="1983273">|</span>&nbsp;<span class="builtintype" id="1983275">byte</span><span class="op" id="1983279">(</span><span class="ident" id="1983280">r</span><span class="op" id="1983281">&gt;&gt;</span><span class="num" id="1983283">6</span><span class="op" id="1983284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983288">p</span><span class="op" id="1983289">[</span><span class="num" id="1983290">1</span><span class="op" id="1983291">]</span>&nbsp;<span class="op" id="1983293">=</span>&nbsp;<span class="ident" id="1983295">tx</span>&nbsp;<span class="op" id="1983298">|</span>&nbsp;<span class="builtintype" id="1983300">byte</span><span class="op" id="1983304">(</span><span class="ident" id="1983305">r</span><span class="op" id="1983306">)</span><span class="op" id="1983307">&amp;</span><span class="ident" id="1983308">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983316">return</span>&nbsp;<span class="num" id="1983323">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983326">case</span>&nbsp;<span class="ident" id="1983331">i</span>&nbsp;<span class="op" id="1983333">&gt;</span>&nbsp;<span class="ident" id="1983335">MaxRune</span><span class="op" id="1983342">,</span>&nbsp;<span class="ident" id="1983344">surrogateMin</span>&nbsp;<span class="op" id="1983357">&lt;=</span>&nbsp;<span class="ident" id="1983360">i</span>&nbsp;<span class="op" id="1983362">&amp;&amp;</span>&nbsp;<span class="ident" id="1983365">i</span>&nbsp;<span class="op" id="1983367">&lt;=</span>&nbsp;<span class="ident" id="1983370">surrogateMax</span><span class="op" id="1983382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983386">r</span>&nbsp;<span class="op" id="1983388">=</span>&nbsp;<span class="ident" id="1983390">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983402">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983415">case</span>&nbsp;<span class="ident" id="1983420">i</span>&nbsp;<span class="op" id="1983422">&lt;=</span>&nbsp;<span class="ident" id="1983425">rune3Max</span><span class="op" id="1983433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983437">p</span><span class="op" id="1983438">[</span><span class="num" id="1983439">0</span><span class="op" id="1983440">]</span>&nbsp;<span class="op" id="1983442">=</span>&nbsp;<span class="ident" id="1983444">t3</span>&nbsp;<span class="op" id="1983447">|</span>&nbsp;<span class="builtintype" id="1983449">byte</span><span class="op" id="1983453">(</span><span class="ident" id="1983454">r</span><span class="op" id="1983455">&gt;&gt;</span><span class="num" id="1983457">12</span><span class="op" id="1983459">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983463">p</span><span class="op" id="1983464">[</span><span class="num" id="1983465">1</span><span class="op" id="1983466">]</span>&nbsp;<span class="op" id="1983468">=</span>&nbsp;<span class="ident" id="1983470">tx</span>&nbsp;<span class="op" id="1983473">|</span>&nbsp;<span class="builtintype" id="1983475">byte</span><span class="op" id="1983479">(</span><span class="ident" id="1983480">r</span><span class="op" id="1983481">&gt;&gt;</span><span class="num" id="1983483">6</span><span class="op" id="1983484">)</span><span class="op" id="1983485">&amp;</span><span class="ident" id="1983486">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983494">p</span><span class="op" id="1983495">[</span><span class="num" id="1983496">2</span><span class="op" id="1983497">]</span>&nbsp;<span class="op" id="1983499">=</span>&nbsp;<span class="ident" id="1983501">tx</span>&nbsp;<span class="op" id="1983504">|</span>&nbsp;<span class="builtintype" id="1983506">byte</span><span class="op" id="1983510">(</span><span class="ident" id="1983511">r</span><span class="op" id="1983512">)</span><span class="op" id="1983513">&amp;</span><span class="ident" id="1983514">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983522">return</span>&nbsp;<span class="num" id="1983529">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983532">default</span><span class="op" id="1983539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983543">p</span><span class="op" id="1983544">[</span><span class="num" id="1983545">0</span><span class="op" id="1983546">]</span>&nbsp;<span class="op" id="1983548">=</span>&nbsp;<span class="ident" id="1983550">t4</span>&nbsp;<span class="op" id="1983553">|</span>&nbsp;<span class="builtintype" id="1983555">byte</span><span class="op" id="1983559">(</span><span class="ident" id="1983560">r</span><span class="op" id="1983561">&gt;&gt;</span><span class="num" id="1983563">18</span><span class="op" id="1983565">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983569">p</span><span class="op" id="1983570">[</span><span class="num" id="1983571">1</span><span class="op" id="1983572">]</span>&nbsp;<span class="op" id="1983574">=</span>&nbsp;<span class="ident" id="1983576">tx</span>&nbsp;<span class="op" id="1983579">|</span>&nbsp;<span class="builtintype" id="1983581">byte</span><span class="op" id="1983585">(</span><span class="ident" id="1983586">r</span><span class="op" id="1983587">&gt;&gt;</span><span class="num" id="1983589">12</span><span class="op" id="1983591">)</span><span class="op" id="1983592">&amp;</span><span class="ident" id="1983593">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983601">p</span><span class="op" id="1983602">[</span><span class="num" id="1983603">2</span><span class="op" id="1983604">]</span>&nbsp;<span class="op" id="1983606">=</span>&nbsp;<span class="ident" id="1983608">tx</span>&nbsp;<span class="op" id="1983611">|</span>&nbsp;<span class="builtintype" id="1983613">byte</span><span class="op" id="1983617">(</span><span class="ident" id="1983618">r</span><span class="op" id="1983619">&gt;&gt;</span><span class="num" id="1983621">6</span><span class="op" id="1983622">)</span><span class="op" id="1983623">&amp;</span><span class="ident" id="1983624">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983632">p</span><span class="op" id="1983633">[</span><span class="num" id="1983634">3</span><span class="op" id="1983635">]</span>&nbsp;<span class="op" id="1983637">=</span>&nbsp;<span class="ident" id="1983639">tx</span>&nbsp;<span class="op" id="1983642">|</span>&nbsp;<span class="builtintype" id="1983644">byte</span><span class="op" id="1983648">(</span><span class="ident" id="1983649">r</span><span class="op" id="1983650">)</span><span class="op" id="1983651">&amp;</span><span class="ident" id="1983652">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983660">return</span>&nbsp;<span class="num" id="1983667">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983670">}</span><br>
<span class="lineno">365</span><span class="op" id="1983672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1983675">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1983743">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1983801">func</span>&nbsp;<span class="ident" id="1983806">RuneCount</span><span class="op" id="1983815">(</span><span class="ident" id="1983816">p</span>&nbsp;<span class="op" id="1983818">[</span><span class="op" id="1983819">]</span><span class="builtintype" id="1983820">byte</span><span class="op" id="1983824">)</span>&nbsp;<span class="builtintype" id="1983826">int</span>&nbsp;<span class="op" id="1983830">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983833">i</span>&nbsp;<span class="op" id="1983835">:=</span>&nbsp;<span class="num" id="1983838">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983841">var</span>&nbsp;<span class="ident" id="1983845">n</span>&nbsp;<span class="builtintype" id="1983847">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983852">for</span>&nbsp;<span class="ident" id="1983856">n</span>&nbsp;<span class="op" id="1983858">=</span>&nbsp;<span class="num" id="1983860">0</span><span class="op" id="1983861">;</span>&nbsp;<span class="ident" id="1983863">i</span>&nbsp;<span class="op" id="1983865">&lt;</span>&nbsp;<span class="builtinfunc" id="1983867">len</span><span class="op" id="1983870">(</span><span class="ident" id="1983871">p</span><span class="op" id="1983872">)</span><span class="op" id="1983873">;</span>&nbsp;<span class="ident" id="1983875">n</span><span class="op" id="1983876">++</span>&nbsp;<span class="op" id="1983879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983883">if</span>&nbsp;<span class="ident" id="1983886">p</span><span class="op" id="1983887">[</span><span class="ident" id="1983888">i</span><span class="op" id="1983889">]</span>&nbsp;<span class="op" id="1983891">&lt;</span>&nbsp;<span class="ident" id="1983893">RuneSelf</span>&nbsp;<span class="op" id="1983902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983907">i</span><span class="op" id="1983908">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983913">}</span>&nbsp;<span class="keyword" id="1983915">else</span>&nbsp;<span class="op" id="1983920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983925">_</span><span class="op" id="1983926">,</span>&nbsp;<span class="ident" id="1983928">size</span>&nbsp;<span class="op" id="1983933">:=</span>&nbsp;<span class="ident" id="1983936">DecodeRune</span><span class="op" id="1983946">(</span><span class="ident" id="1983947">p</span><span class="op" id="1983948">[</span><span class="ident" id="1983949">i</span><span class="op" id="1983950">:</span><span class="op" id="1983951">]</span><span class="op" id="1983952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1983957">i</span>&nbsp;<span class="op" id="1983959">+=</span>&nbsp;<span class="ident" id="1983962">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1983972">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1983975">return</span>&nbsp;<span class="ident" id="1983982">n</span><br>
<span class="lineno"></span><span class="op" id="1983984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1983987">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1984053">func</span>&nbsp;<span class="ident" id="1984058">RuneCountInString</span><span class="op" id="1984075">(</span><span class="ident" id="1984076">s</span>&nbsp;<span class="builtintype" id="1984078">string</span><span class="op" id="1984084">)</span>&nbsp;<span class="op" id="1984086">(</span><span class="ident" id="1984087">n</span>&nbsp;<span class="builtintype" id="1984089">int</span><span class="op" id="1984092">)</span>&nbsp;<span class="op" id="1984094">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984097">for</span>&nbsp;<span class="keyword" id="1984101">range</span>&nbsp;<span class="ident" id="1984107">s</span>&nbsp;<span class="op" id="1984109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1984113">n</span><span class="op" id="1984114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1984118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984121">return</span><br>
<span class="lineno"></span><span class="op" id="1984128">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1984131">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1984196">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1984265">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1984288">func</span>&nbsp;<span class="ident" id="1984293">RuneStart</span><span class="op" id="1984302">(</span><span class="ident" id="1984303">b</span>&nbsp;<span class="builtintype" id="1984305">byte</span><span class="op" id="1984309">)</span>&nbsp;<span class="builtintype" id="1984311">bool</span>&nbsp;<span class="op" id="1984316">{</span>&nbsp;<span class="keyword" id="1984318">return</span>&nbsp;<span class="ident" id="1984325">b</span><span class="op" id="1984326">&amp;</span><span class="num" id="1984327">0xC0</span>&nbsp;<span class="op" id="1984332">!=</span>&nbsp;<span class="num" id="1984335">0x80</span>&nbsp;<span class="op" id="1984340">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1984343">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1984418">func</span>&nbsp;<span class="ident" id="1984423">Valid</span><span class="op" id="1984428">(</span><span class="ident" id="1984429">p</span>&nbsp;<span class="op" id="1984431">[</span><span class="op" id="1984432">]</span><span class="builtintype" id="1984433">byte</span><span class="op" id="1984437">)</span>&nbsp;<span class="builtintype" id="1984439">bool</span>&nbsp;<span class="op" id="1984444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1984447">i</span>&nbsp;<span class="op" id="1984449">:=</span>&nbsp;<span class="num" id="1984452">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984455">for</span>&nbsp;<span class="ident" id="1984459">i</span>&nbsp;<span class="op" id="1984461">&lt;</span>&nbsp;<span class="builtinfunc" id="1984463">len</span><span class="op" id="1984466">(</span><span class="ident" id="1984467">p</span><span class="op" id="1984468">)</span>&nbsp;<span class="op" id="1984470">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984474">if</span>&nbsp;<span class="ident" id="1984477">p</span><span class="op" id="1984478">[</span><span class="ident" id="1984479">i</span><span class="op" id="1984480">]</span>&nbsp;<span class="op" id="1984482">&lt;</span>&nbsp;<span class="ident" id="1984484">RuneSelf</span>&nbsp;<span class="op" id="1984493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1984498">i</span><span class="op" id="1984499">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1984504">}</span>&nbsp;<span class="keyword" id="1984506">else</span>&nbsp;<span class="op" id="1984511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1984516">_</span><span class="op" id="1984517">,</span>&nbsp;<span class="ident" id="1984519">size</span>&nbsp;<span class="op" id="1984524">:=</span>&nbsp;<span class="ident" id="1984527">DecodeRune</span><span class="op" id="1984537">(</span><span class="ident" id="1984538">p</span><span class="op" id="1984539">[</span><span class="ident" id="1984540">i</span><span class="op" id="1984541">:</span><span class="op" id="1984542">]</span><span class="op" id="1984543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984548">if</span>&nbsp;<span class="ident" id="1984551">size</span>&nbsp;<span class="op" id="1984556">==</span>&nbsp;<span class="num" id="1984559">1</span>&nbsp;<span class="op" id="1984561">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984567">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984607">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984650">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984683">return</span>&nbsp;<span class="builtintype" id="1984690">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1984699">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1984704">i</span>&nbsp;<span class="op" id="1984706">+=</span>&nbsp;<span class="ident" id="1984709">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1984716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1984719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984722">return</span>&nbsp;<span class="builtintype" id="1984729">true</span><br>
<span class="lineno"></span><span class="op" id="1984734">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1984737">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1984818">func</span>&nbsp;<span class="ident" id="1984823">ValidString</span><span class="op" id="1984834">(</span><span class="ident" id="1984835">s</span>&nbsp;<span class="builtintype" id="1984837">string</span><span class="op" id="1984843">)</span>&nbsp;<span class="builtintype" id="1984845">bool</span>&nbsp;<span class="op" id="1984850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984853">for</span>&nbsp;<span class="ident" id="1984857">i</span><span class="op" id="1984858">,</span>&nbsp;<span class="ident" id="1984860">r</span>&nbsp;<span class="op" id="1984862">:=</span>&nbsp;<span class="keyword" id="1984865">range</span>&nbsp;<span class="ident" id="1984871">s</span>&nbsp;<span class="op" id="1984873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1984877">if</span>&nbsp;<span class="ident" id="1984880">r</span>&nbsp;<span class="op" id="1984882">==</span>&nbsp;<span class="ident" id="1984885">RuneError</span>&nbsp;<span class="op" id="1984895">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984900">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984942">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1984992">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1985042">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1985080">_</span><span class="op" id="1985081">,</span>&nbsp;<span class="ident" id="1985083">size</span>&nbsp;<span class="op" id="1985088">:=</span>&nbsp;<span class="ident" id="1985091">DecodeRuneInString</span><span class="op" id="1985109">(</span><span class="ident" id="1985110">s</span><span class="op" id="1985111">[</span><span class="ident" id="1985112">i</span><span class="op" id="1985113">:</span><span class="op" id="1985114">]</span><span class="op" id="1985115">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985120">if</span>&nbsp;<span class="ident" id="1985123">size</span>&nbsp;<span class="op" id="1985128">==</span>&nbsp;<span class="num" id="1985131">1</span>&nbsp;<span class="op" id="1985133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985139">return</span>&nbsp;<span class="builtintype" id="1985146">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985162">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985165">return</span>&nbsp;<span class="builtintype" id="1985172">true</span><br>
<span class="lineno"></span><span class="op" id="1985177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1985180">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1985244">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1985314">func</span>&nbsp;<span class="ident" id="1985319">ValidRune</span><span class="op" id="1985328">(</span><span class="ident" id="1985329">r</span>&nbsp;<span class="builtintype" id="1985331">rune</span><span class="op" id="1985335">)</span>&nbsp;<span class="builtintype" id="1985337">bool</span>&nbsp;<span class="op" id="1985342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985345">switch</span>&nbsp;<span class="op" id="1985352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985355">case</span>&nbsp;<span class="ident" id="1985360">r</span>&nbsp;<span class="op" id="1985362">&lt;</span>&nbsp;<span class="num" id="1985364">0</span><span class="op" id="1985365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985369">return</span>&nbsp;<span class="builtintype" id="1985376">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985383">case</span>&nbsp;<span class="ident" id="1985388">surrogateMin</span>&nbsp;<span class="op" id="1985401">&lt;=</span>&nbsp;<span class="ident" id="1985404">r</span>&nbsp;<span class="op" id="1985406">&amp;&amp;</span>&nbsp;<span class="ident" id="1985409">r</span>&nbsp;<span class="op" id="1985411">&lt;=</span>&nbsp;<span class="ident" id="1985414">surrogateMax</span><span class="op" id="1985426">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985430">return</span>&nbsp;<span class="builtintype" id="1985437">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985444">case</span>&nbsp;<span class="ident" id="1985449">r</span>&nbsp;<span class="op" id="1985451">&gt;</span>&nbsp;<span class="ident" id="1985453">MaxRune</span><span class="op" id="1985460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985464">return</span>&nbsp;<span class="builtintype" id="1985471">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1985478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1985481">return</span>&nbsp;<span class="builtintype" id="1985488">true</span><br>
<span class="lineno">445</span><span class="op" id="1985493">}</span>
</div>
</body>
</html>
