<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7013376">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7013431">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7013485">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7013536">package</span>&nbsp;<span class="ident" id="7013544">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7013549">import</span>&nbsp;<span class="op" id="7013556">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013559">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013568">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013575">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013584">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013599">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013605">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013618">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013624">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013635">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7013645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7013648">var</span>&nbsp;<span class="ident" id="7013652">filenames</span>&nbsp;<span class="op" id="7013662">=</span>&nbsp;<span class="op" id="7013664">[</span><span class="op" id="7013665">]</span><span class="builtintype" id="7013666">string</span><span class="op" id="7013672">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013675">&#34;basn0g01&#34;</span><span class="op" id="7013685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013688">&#34;basn0g01-30&#34;</span><span class="op" id="7013701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013704">&#34;basn0g02&#34;</span><span class="op" id="7013714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013717">&#34;basn0g02-29&#34;</span><span class="op" id="7013730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013733">&#34;basn0g04&#34;</span><span class="op" id="7013743">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013746">&#34;basn0g04-31&#34;</span><span class="op" id="7013759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013762">&#34;basn0g08&#34;</span><span class="op" id="7013772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013775">&#34;basn0g16&#34;</span><span class="op" id="7013785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013788">&#34;basn2c08&#34;</span><span class="op" id="7013798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013801">&#34;basn2c16&#34;</span><span class="op" id="7013811">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013814">&#34;basn3p01&#34;</span><span class="op" id="7013824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013827">&#34;basn3p02&#34;</span><span class="op" id="7013837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013840">&#34;basn3p04&#34;</span><span class="op" id="7013850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013853">&#34;basn3p04-31i&#34;</span><span class="op" id="7013867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013870">&#34;basn3p08&#34;</span><span class="op" id="7013880">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013883">&#34;basn3p08-trns&#34;</span><span class="op" id="7013898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013901">&#34;basn4a08&#34;</span><span class="op" id="7013911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013914">&#34;basn4a16&#34;</span><span class="op" id="7013924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013927">&#34;basn6a08&#34;</span><span class="op" id="7013937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013940">&#34;basn6a16&#34;</span><span class="op" id="7013950">,</span><br>
<span class="lineno">40</span><span class="op" id="7013952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7013955">var</span>&nbsp;<span class="ident" id="7013959">filenamesPaletted</span>&nbsp;<span class="op" id="7013977">=</span>&nbsp;<span class="op" id="7013979">[</span><span class="op" id="7013980">]</span><span class="builtintype" id="7013981">string</span><span class="op" id="7013987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7013990">&#34;basn3p01&#34;</span><span class="op" id="7014000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014003">&#34;basn3p02&#34;</span><span class="op" id="7014013">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014016">&#34;basn3p04&#34;</span><span class="op" id="7014026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014029">&#34;basn3p08&#34;</span><span class="op" id="7014039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014042">&#34;basn3p08-trns&#34;</span><span class="op" id="7014057">,</span><br>
<span class="lineno"></span><span class="op" id="7014059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7014062">var</span>&nbsp;<span class="ident" id="7014066">filenamesShort</span>&nbsp;<span class="op" id="7014081">=</span>&nbsp;<span class="op" id="7014083">[</span><span class="op" id="7014084">]</span><span class="builtintype" id="7014085">string</span><span class="op" id="7014091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014094">&#34;basn0g01&#34;</span><span class="op" id="7014104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014107">&#34;basn0g04-31&#34;</span><span class="op" id="7014120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7014123">&#34;basn6a16&#34;</span><span class="op" id="7014133">,</span><br>
<span class="lineno"></span><span class="op" id="7014135">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7014138">func</span>&nbsp;<span class="ident" id="7014143">readPNG</span><span class="op" id="7014150">(</span><span class="ident" id="7014151">filename</span>&nbsp;<span class="builtintype" id="7014160">string</span><span class="op" id="7014166">)</span>&nbsp;<span class="op" id="7014168">(</span><span class="ident" id="7014169">image</span><span class="op" id="7014174">.</span><span class="ident" id="7014175">Image</span><span class="op" id="7014180">,</span>&nbsp;<span class="builtintype" id="7014182">error</span><span class="op" id="7014187">)</span>&nbsp;<span class="op" id="7014189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014192">f</span><span class="op" id="7014193">,</span>&nbsp;<span class="ident" id="7014195">err</span>&nbsp;<span class="op" id="7014199">:=</span>&nbsp;<span class="ident" id="7014202">os</span><span class="op" id="7014204">.</span><span class="ident" id="7014205">Open</span><span class="op" id="7014209">(</span><span class="ident" id="7014210">filename</span><span class="op" id="7014218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014221">if</span>&nbsp;<span class="ident" id="7014224">err</span>&nbsp;<span class="op" id="7014228">!=</span>&nbsp;<span class="builtintype" id="7014231">nil</span>&nbsp;<span class="op" id="7014235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014239">return</span>&nbsp;<span class="builtintype" id="7014246">nil</span><span class="op" id="7014249">,</span>&nbsp;<span class="ident" id="7014251">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7014256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014259">defer</span>&nbsp;<span class="ident" id="7014265">f</span><span class="op" id="7014266">.</span><span class="ident" id="7014267">Close</span><span class="op" id="7014272">(</span><span class="op" id="7014273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014276">return</span>&nbsp;<span class="ident" id="7014283">Decode</span><span class="op" id="7014289">(</span><span class="ident" id="7014290">f</span><span class="op" id="7014291">)</span><br>
<span class="lineno"></span><span class="op" id="7014293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="7014296">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="7014346">func</span>&nbsp;<span class="ident" id="7014351">sng</span><span class="op" id="7014354">(</span><span class="ident" id="7014355">w</span>&nbsp;<span class="ident" id="7014357">io</span><span class="op" id="7014359">.</span><span class="ident" id="7014360">WriteCloser</span><span class="op" id="7014371">,</span>&nbsp;<span class="ident" id="7014373">filename</span>&nbsp;<span class="builtintype" id="7014382">string</span><span class="op" id="7014388">,</span>&nbsp;<span class="ident" id="7014390">png</span>&nbsp;<span class="ident" id="7014394">image</span><span class="op" id="7014399">.</span><span class="ident" id="7014400">Image</span><span class="op" id="7014405">)</span>&nbsp;<span class="op" id="7014407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014410">defer</span>&nbsp;<span class="ident" id="7014416">w</span><span class="op" id="7014417">.</span><span class="ident" id="7014418">Close</span><span class="op" id="7014423">(</span><span class="op" id="7014424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014427">bounds</span>&nbsp;<span class="op" id="7014434">:=</span>&nbsp;<span class="ident" id="7014437">png</span><span class="op" id="7014440">.</span><span class="ident" id="7014441">Bounds</span><span class="op" id="7014447">(</span><span class="op" id="7014448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014451">cm</span>&nbsp;<span class="op" id="7014454">:=</span>&nbsp;<span class="ident" id="7014457">png</span><span class="op" id="7014460">.</span><span class="ident" id="7014461">ColorModel</span><span class="op" id="7014471">(</span><span class="op" id="7014472">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014475">var</span>&nbsp;<span class="ident" id="7014479">bitdepth</span>&nbsp;<span class="builtintype" id="7014488">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014493">switch</span>&nbsp;<span class="ident" id="7014500">cm</span>&nbsp;<span class="op" id="7014503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014506">case</span>&nbsp;<span class="ident" id="7014511">color</span><span class="op" id="7014516">.</span><span class="ident" id="7014517">RGBAModel</span><span class="op" id="7014526">,</span>&nbsp;<span class="ident" id="7014528">color</span><span class="op" id="7014533">.</span><span class="ident" id="7014534">NRGBAModel</span><span class="op" id="7014544">,</span>&nbsp;<span class="ident" id="7014546">color</span><span class="op" id="7014551">.</span><span class="ident" id="7014552">AlphaModel</span><span class="op" id="7014562">,</span>&nbsp;<span class="ident" id="7014564">color</span><span class="op" id="7014569">.</span><span class="ident" id="7014570">GrayModel</span><span class="op" id="7014579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014583">bitdepth</span>&nbsp;<span class="op" id="7014592">=</span>&nbsp;<span class="num" id="7014594">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014597">default</span><span class="op" id="7014604">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014608">bitdepth</span>&nbsp;<span class="op" id="7014617">=</span>&nbsp;<span class="num" id="7014619">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7014623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014626">cpm</span><span class="op" id="7014629">,</span>&nbsp;<span class="ident" id="7014631">_</span>&nbsp;<span class="op" id="7014633">:=</span>&nbsp;<span class="ident" id="7014636">cm</span><span class="op" id="7014638">.</span><span class="op" id="7014639">(</span><span class="ident" id="7014640">color</span><span class="op" id="7014645">.</span><span class="ident" id="7014646">Palette</span><span class="op" id="7014653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014656">var</span>&nbsp;<span class="ident" id="7014660">paletted</span>&nbsp;<span class="op" id="7014669">*</span><span class="ident" id="7014670">image</span><span class="op" id="7014675">.</span><span class="ident" id="7014676">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014686">if</span>&nbsp;<span class="ident" id="7014689">cpm</span>&nbsp;<span class="op" id="7014693">!=</span>&nbsp;<span class="builtintype" id="7014696">nil</span>&nbsp;<span class="op" id="7014700">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014704">switch</span>&nbsp;<span class="op" id="7014711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014715">case</span>&nbsp;<span class="builtinfunc" id="7014720">len</span><span class="op" id="7014723">(</span><span class="ident" id="7014724">cpm</span><span class="op" id="7014727">)</span>&nbsp;<span class="op" id="7014729">&lt;=</span>&nbsp;<span class="num" id="7014732">2</span><span class="op" id="7014733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014738">bitdepth</span>&nbsp;<span class="op" id="7014747">=</span>&nbsp;<span class="num" id="7014749">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014753">case</span>&nbsp;<span class="builtinfunc" id="7014758">len</span><span class="op" id="7014761">(</span><span class="ident" id="7014762">cpm</span><span class="op" id="7014765">)</span>&nbsp;<span class="op" id="7014767">&lt;=</span>&nbsp;<span class="num" id="7014770">4</span><span class="op" id="7014771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014776">bitdepth</span>&nbsp;<span class="op" id="7014785">=</span>&nbsp;<span class="num" id="7014787">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014791">case</span>&nbsp;<span class="builtinfunc" id="7014796">len</span><span class="op" id="7014799">(</span><span class="ident" id="7014800">cpm</span><span class="op" id="7014803">)</span>&nbsp;<span class="op" id="7014805">&lt;=</span>&nbsp;<span class="num" id="7014808">16</span><span class="op" id="7014810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014815">bitdepth</span>&nbsp;<span class="op" id="7014824">=</span>&nbsp;<span class="num" id="7014826">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7014830">default</span><span class="op" id="7014837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014842">bitdepth</span>&nbsp;<span class="op" id="7014851">=</span>&nbsp;<span class="num" id="7014853">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7014857">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014861">paletted</span>&nbsp;<span class="op" id="7014870">=</span>&nbsp;<span class="ident" id="7014872">png</span><span class="op" id="7014875">.</span><span class="op" id="7014876">(</span><span class="op" id="7014877">*</span><span class="ident" id="7014878">image</span><span class="op" id="7014883">.</span><span class="ident" id="7014884">Paletted</span><span class="op" id="7014892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7014895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7014899">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014932">io</span><span class="op" id="7014934">.</span><span class="ident" id="7014935">WriteString</span><span class="op" id="7014946">(</span><span class="ident" id="7014947">w</span><span class="op" id="7014948">,</span>&nbsp;<span class="string" id="7014950">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="7014963">+</span><span class="ident" id="7014964">filename</span><span class="op" id="7014972">+</span><span class="string" id="7014973">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="7014989">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7014992">fmt</span><span class="op" id="7014995">.</span><span class="ident" id="7014996">Fprintf</span><span class="op" id="7015003">(</span><span class="ident" id="7015004">w</span><span class="op" id="7015005">,</span>&nbsp;<span class="string" id="7015007">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="7015051">,</span>&nbsp;<span class="ident" id="7015053">bounds</span><span class="op" id="7015059">.</span><span class="ident" id="7015060">Dx</span><span class="op" id="7015062">(</span><span class="op" id="7015063">)</span><span class="op" id="7015064">,</span>&nbsp;<span class="ident" id="7015066">bounds</span><span class="op" id="7015072">.</span><span class="ident" id="7015073">Dy</span><span class="op" id="7015075">(</span><span class="op" id="7015076">)</span><span class="op" id="7015077">,</span>&nbsp;<span class="ident" id="7015079">bitdepth</span><span class="op" id="7015087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015090">switch</span>&nbsp;<span class="op" id="7015097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015100">case</span>&nbsp;<span class="ident" id="7015105">cm</span>&nbsp;<span class="op" id="7015108">==</span>&nbsp;<span class="ident" id="7015111">color</span><span class="op" id="7015116">.</span><span class="ident" id="7015117">RGBAModel</span><span class="op" id="7015126">,</span>&nbsp;<span class="ident" id="7015128">cm</span>&nbsp;<span class="op" id="7015131">==</span>&nbsp;<span class="ident" id="7015134">color</span><span class="op" id="7015139">.</span><span class="ident" id="7015140">RGBA64Model</span><span class="op" id="7015151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015155">io</span><span class="op" id="7015157">.</span><span class="ident" id="7015158">WriteString</span><span class="op" id="7015169">(</span><span class="ident" id="7015170">w</span><span class="op" id="7015171">,</span>&nbsp;<span class="string" id="7015173">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="7015193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015196">case</span>&nbsp;<span class="ident" id="7015201">cm</span>&nbsp;<span class="op" id="7015204">==</span>&nbsp;<span class="ident" id="7015207">color</span><span class="op" id="7015212">.</span><span class="ident" id="7015213">NRGBAModel</span><span class="op" id="7015223">,</span>&nbsp;<span class="ident" id="7015225">cm</span>&nbsp;<span class="op" id="7015228">==</span>&nbsp;<span class="ident" id="7015231">color</span><span class="op" id="7015236">.</span><span class="ident" id="7015237">NRGBA64Model</span><span class="op" id="7015249">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015253">io</span><span class="op" id="7015255">.</span><span class="ident" id="7015256">WriteString</span><span class="op" id="7015267">(</span><span class="ident" id="7015268">w</span><span class="op" id="7015269">,</span>&nbsp;<span class="string" id="7015271">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="7015297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015300">case</span>&nbsp;<span class="ident" id="7015305">cm</span>&nbsp;<span class="op" id="7015308">==</span>&nbsp;<span class="ident" id="7015311">color</span><span class="op" id="7015316">.</span><span class="ident" id="7015317">GrayModel</span><span class="op" id="7015326">,</span>&nbsp;<span class="ident" id="7015328">cm</span>&nbsp;<span class="op" id="7015331">==</span>&nbsp;<span class="ident" id="7015334">color</span><span class="op" id="7015339">.</span><span class="ident" id="7015340">Gray16Model</span><span class="op" id="7015351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015355">io</span><span class="op" id="7015357">.</span><span class="ident" id="7015358">WriteString</span><span class="op" id="7015369">(</span><span class="ident" id="7015370">w</span><span class="op" id="7015371">,</span>&nbsp;<span class="string" id="7015373">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="7015397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015400">case</span>&nbsp;<span class="ident" id="7015405">cpm</span>&nbsp;<span class="op" id="7015409">!=</span>&nbsp;<span class="builtintype" id="7015412">nil</span><span class="op" id="7015415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015419">io</span><span class="op" id="7015421">.</span><span class="ident" id="7015422">WriteString</span><span class="op" id="7015433">(</span><span class="ident" id="7015434">w</span><span class="op" id="7015435">,</span>&nbsp;<span class="string" id="7015437">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="7015465">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015468">default</span><span class="op" id="7015475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015479">io</span><span class="op" id="7015481">.</span><span class="ident" id="7015482">WriteString</span><span class="op" id="7015493">(</span><span class="ident" id="7015494">w</span><span class="op" id="7015495">,</span>&nbsp;<span class="string" id="7015497">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="7015532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7015535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015538">io</span><span class="op" id="7015540">.</span><span class="ident" id="7015541">WriteString</span><span class="op" id="7015552">(</span><span class="ident" id="7015553">w</span><span class="op" id="7015554">,</span>&nbsp;<span class="string" id="7015556">&#34;}\n&#34;</span><span class="op" id="7015561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7015565">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7015658">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015743">io</span><span class="op" id="7015745">.</span><span class="ident" id="7015746">WriteString</span><span class="op" id="7015757">(</span><span class="ident" id="7015758">w</span><span class="op" id="7015759">,</span>&nbsp;<span class="string" id="7015761">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="7015778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7015782">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015827">if</span>&nbsp;<span class="ident" id="7015830">cpm</span>&nbsp;<span class="op" id="7015834">!=</span>&nbsp;<span class="builtintype" id="7015837">nil</span>&nbsp;<span class="op" id="7015841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015845">lastAlpha</span>&nbsp;<span class="op" id="7015855">:=</span>&nbsp;<span class="op" id="7015858">-</span><span class="num" id="7015859">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015863">io</span><span class="op" id="7015865">.</span><span class="ident" id="7015866">WriteString</span><span class="op" id="7015877">(</span><span class="ident" id="7015878">w</span><span class="op" id="7015879">,</span>&nbsp;<span class="string" id="7015881">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="7015891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015895">for</span>&nbsp;<span class="ident" id="7015899">i</span><span class="op" id="7015900">,</span>&nbsp;<span class="ident" id="7015902">c</span>&nbsp;<span class="op" id="7015904">:=</span>&nbsp;<span class="keyword" id="7015907">range</span>&nbsp;<span class="ident" id="7015913">cpm</span>&nbsp;<span class="op" id="7015917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015922">var</span>&nbsp;<span class="ident" id="7015926">r</span><span class="op" id="7015927">,</span>&nbsp;<span class="ident" id="7015929">g</span><span class="op" id="7015930">,</span>&nbsp;<span class="ident" id="7015932">b</span><span class="op" id="7015933">,</span>&nbsp;<span class="ident" id="7015935">a</span>&nbsp;<span class="builtintype" id="7015937">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015946">switch</span>&nbsp;<span class="ident" id="7015953">c</span>&nbsp;<span class="op" id="7015955">:=</span>&nbsp;<span class="ident" id="7015958">c</span><span class="op" id="7015959">.</span><span class="op" id="7015960">(</span><span class="keyword" id="7015961">type</span><span class="op" id="7015965">)</span>&nbsp;<span class="op" id="7015967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7015972">case</span>&nbsp;<span class="ident" id="7015977">color</span><span class="op" id="7015982">.</span><span class="ident" id="7015983">RGBA</span><span class="op" id="7015987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7015993">r</span><span class="op" id="7015994">,</span>&nbsp;<span class="ident" id="7015996">g</span><span class="op" id="7015997">,</span>&nbsp;<span class="ident" id="7015999">b</span><span class="op" id="7016000">,</span>&nbsp;<span class="ident" id="7016002">a</span>&nbsp;<span class="op" id="7016004">=</span>&nbsp;<span class="ident" id="7016006">c</span><span class="op" id="7016007">.</span><span class="ident" id="7016008">R</span><span class="op" id="7016009">,</span>&nbsp;<span class="ident" id="7016011">c</span><span class="op" id="7016012">.</span><span class="ident" id="7016013">G</span><span class="op" id="7016014">,</span>&nbsp;<span class="ident" id="7016016">c</span><span class="op" id="7016017">.</span><span class="ident" id="7016018">B</span><span class="op" id="7016019">,</span>&nbsp;<span class="num" id="7016021">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016029">case</span>&nbsp;<span class="ident" id="7016034">color</span><span class="op" id="7016039">.</span><span class="ident" id="7016040">NRGBA</span><span class="op" id="7016045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016051">r</span><span class="op" id="7016052">,</span>&nbsp;<span class="ident" id="7016054">g</span><span class="op" id="7016055">,</span>&nbsp;<span class="ident" id="7016057">b</span><span class="op" id="7016058">,</span>&nbsp;<span class="ident" id="7016060">a</span>&nbsp;<span class="op" id="7016062">=</span>&nbsp;<span class="ident" id="7016064">c</span><span class="op" id="7016065">.</span><span class="ident" id="7016066">R</span><span class="op" id="7016067">,</span>&nbsp;<span class="ident" id="7016069">c</span><span class="op" id="7016070">.</span><span class="ident" id="7016071">G</span><span class="op" id="7016072">,</span>&nbsp;<span class="ident" id="7016074">c</span><span class="op" id="7016075">.</span><span class="ident" id="7016076">B</span><span class="op" id="7016077">,</span>&nbsp;<span class="ident" id="7016079">c</span><span class="op" id="7016080">.</span><span class="ident" id="7016081">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016086">default</span><span class="op" id="7016093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7016099">panic</span><span class="op" id="7016104">(</span><span class="string" id="7016105">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="7016133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016143">if</span>&nbsp;<span class="ident" id="7016146">a</span>&nbsp;<span class="op" id="7016148">!=</span>&nbsp;<span class="num" id="7016151">0xff</span>&nbsp;<span class="op" id="7016156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016162">lastAlpha</span>&nbsp;<span class="op" id="7016172">=</span>&nbsp;<span class="ident" id="7016174">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016184">fmt</span><span class="op" id="7016187">.</span><span class="ident" id="7016188">Fprintf</span><span class="op" id="7016195">(</span><span class="ident" id="7016196">w</span><span class="op" id="7016197">,</span>&nbsp;<span class="string" id="7016199">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="7016255">,</span>&nbsp;<span class="ident" id="7016257">r</span><span class="op" id="7016258">,</span>&nbsp;<span class="ident" id="7016260">g</span><span class="op" id="7016261">,</span>&nbsp;<span class="ident" id="7016263">b</span><span class="op" id="7016264">,</span>&nbsp;<span class="ident" id="7016266">r</span><span class="op" id="7016267">,</span>&nbsp;<span class="ident" id="7016269">g</span><span class="op" id="7016270">,</span>&nbsp;<span class="ident" id="7016272">b</span><span class="op" id="7016273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016281">io</span><span class="op" id="7016283">.</span><span class="ident" id="7016284">WriteString</span><span class="op" id="7016295">(</span><span class="ident" id="7016296">w</span><span class="op" id="7016297">,</span>&nbsp;<span class="string" id="7016299">&#34;}\n&#34;</span><span class="op" id="7016304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016308">if</span>&nbsp;<span class="ident" id="7016311">lastAlpha</span>&nbsp;<span class="op" id="7016321">!=</span>&nbsp;<span class="op" id="7016324">-</span><span class="num" id="7016325">1</span>&nbsp;<span class="op" id="7016327">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016332">io</span><span class="op" id="7016334">.</span><span class="ident" id="7016335">WriteString</span><span class="op" id="7016346">(</span><span class="ident" id="7016347">w</span><span class="op" id="7016348">,</span>&nbsp;<span class="string" id="7016350">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="7016360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016365">for</span>&nbsp;<span class="ident" id="7016369">i</span>&nbsp;<span class="op" id="7016371">:=</span>&nbsp;<span class="num" id="7016374">0</span><span class="op" id="7016375">;</span>&nbsp;<span class="ident" id="7016377">i</span>&nbsp;<span class="op" id="7016379">&lt;=</span>&nbsp;<span class="ident" id="7016382">lastAlpha</span><span class="op" id="7016391">;</span>&nbsp;<span class="ident" id="7016393">i</span><span class="op" id="7016394">++</span>&nbsp;<span class="op" id="7016397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016403">_</span><span class="op" id="7016404">,</span>&nbsp;<span class="ident" id="7016406">_</span><span class="op" id="7016407">,</span>&nbsp;<span class="ident" id="7016409">_</span><span class="op" id="7016410">,</span>&nbsp;<span class="ident" id="7016412">a</span>&nbsp;<span class="op" id="7016414">:=</span>&nbsp;<span class="ident" id="7016417">cpm</span><span class="op" id="7016420">[</span><span class="ident" id="7016421">i</span><span class="op" id="7016422">]</span><span class="op" id="7016423">.</span><span class="ident" id="7016424">RGBA</span><span class="op" id="7016428">(</span><span class="op" id="7016429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016435">a</span>&nbsp;<span class="op" id="7016437">&gt;&gt;=</span>&nbsp;<span class="num" id="7016441">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016447">fmt</span><span class="op" id="7016450">.</span><span class="ident" id="7016451">Fprintf</span><span class="op" id="7016458">(</span><span class="ident" id="7016459">w</span><span class="op" id="7016460">,</span>&nbsp;<span class="string" id="7016462">&#34;&nbsp;%d&#34;</span><span class="op" id="7016467">,</span>&nbsp;<span class="ident" id="7016469">a</span><span class="op" id="7016470">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016480">io</span><span class="op" id="7016482">.</span><span class="ident" id="7016483">WriteString</span><span class="op" id="7016494">(</span><span class="ident" id="7016495">w</span><span class="op" id="7016496">,</span>&nbsp;<span class="string" id="7016498">&#34;}\n&#34;</span><span class="op" id="7016503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7016514">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016535">io</span><span class="op" id="7016537">.</span><span class="ident" id="7016538">WriteString</span><span class="op" id="7016549">(</span><span class="ident" id="7016550">w</span><span class="op" id="7016551">,</span>&nbsp;<span class="string" id="7016553">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="7016580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016583">for</span>&nbsp;<span class="ident" id="7016587">y</span>&nbsp;<span class="op" id="7016589">:=</span>&nbsp;<span class="ident" id="7016592">bounds</span><span class="op" id="7016598">.</span><span class="ident" id="7016599">Min</span><span class="op" id="7016602">.</span><span class="ident" id="7016603">Y</span><span class="op" id="7016604">;</span>&nbsp;<span class="ident" id="7016606">y</span>&nbsp;<span class="op" id="7016608">&lt;</span>&nbsp;<span class="ident" id="7016610">bounds</span><span class="op" id="7016616">.</span><span class="ident" id="7016617">Max</span><span class="op" id="7016620">.</span><span class="ident" id="7016621">Y</span><span class="op" id="7016622">;</span>&nbsp;<span class="ident" id="7016624">y</span><span class="op" id="7016625">++</span>&nbsp;<span class="op" id="7016628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016632">switch</span>&nbsp;<span class="op" id="7016639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016643">case</span>&nbsp;<span class="ident" id="7016648">cm</span>&nbsp;<span class="op" id="7016651">==</span>&nbsp;<span class="ident" id="7016654">color</span><span class="op" id="7016659">.</span><span class="ident" id="7016660">GrayModel</span><span class="op" id="7016669">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016674">for</span>&nbsp;<span class="ident" id="7016678">x</span>&nbsp;<span class="op" id="7016680">:=</span>&nbsp;<span class="ident" id="7016683">bounds</span><span class="op" id="7016689">.</span><span class="ident" id="7016690">Min</span><span class="op" id="7016693">.</span><span class="ident" id="7016694">X</span><span class="op" id="7016695">;</span>&nbsp;<span class="ident" id="7016697">x</span>&nbsp;<span class="op" id="7016699">&lt;</span>&nbsp;<span class="ident" id="7016701">bounds</span><span class="op" id="7016707">.</span><span class="ident" id="7016708">Max</span><span class="op" id="7016711">.</span><span class="ident" id="7016712">X</span><span class="op" id="7016713">;</span>&nbsp;<span class="ident" id="7016715">x</span><span class="op" id="7016716">++</span>&nbsp;<span class="op" id="7016719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016725">gray</span>&nbsp;<span class="op" id="7016730">:=</span>&nbsp;<span class="ident" id="7016733">png</span><span class="op" id="7016736">.</span><span class="ident" id="7016737">At</span><span class="op" id="7016739">(</span><span class="ident" id="7016740">x</span><span class="op" id="7016741">,</span>&nbsp;<span class="ident" id="7016743">y</span><span class="op" id="7016744">)</span><span class="op" id="7016745">.</span><span class="op" id="7016746">(</span><span class="ident" id="7016747">color</span><span class="op" id="7016752">.</span><span class="ident" id="7016753">Gray</span><span class="op" id="7016757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016763">fmt</span><span class="op" id="7016766">.</span><span class="ident" id="7016767">Fprintf</span><span class="op" id="7016774">(</span><span class="ident" id="7016775">w</span><span class="op" id="7016776">,</span>&nbsp;<span class="string" id="7016778">&#34;%02x&#34;</span><span class="op" id="7016784">,</span>&nbsp;<span class="ident" id="7016786">gray</span><span class="op" id="7016790">.</span><span class="ident" id="7016791">Y</span><span class="op" id="7016792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016801">case</span>&nbsp;<span class="ident" id="7016806">cm</span>&nbsp;<span class="op" id="7016809">==</span>&nbsp;<span class="ident" id="7016812">color</span><span class="op" id="7016817">.</span><span class="ident" id="7016818">Gray16Model</span><span class="op" id="7016829">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016834">for</span>&nbsp;<span class="ident" id="7016838">x</span>&nbsp;<span class="op" id="7016840">:=</span>&nbsp;<span class="ident" id="7016843">bounds</span><span class="op" id="7016849">.</span><span class="ident" id="7016850">Min</span><span class="op" id="7016853">.</span><span class="ident" id="7016854">X</span><span class="op" id="7016855">;</span>&nbsp;<span class="ident" id="7016857">x</span>&nbsp;<span class="op" id="7016859">&lt;</span>&nbsp;<span class="ident" id="7016861">bounds</span><span class="op" id="7016867">.</span><span class="ident" id="7016868">Max</span><span class="op" id="7016871">.</span><span class="ident" id="7016872">X</span><span class="op" id="7016873">;</span>&nbsp;<span class="ident" id="7016875">x</span><span class="op" id="7016876">++</span>&nbsp;<span class="op" id="7016879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016885">gray16</span>&nbsp;<span class="op" id="7016892">:=</span>&nbsp;<span class="ident" id="7016895">png</span><span class="op" id="7016898">.</span><span class="ident" id="7016899">At</span><span class="op" id="7016901">(</span><span class="ident" id="7016902">x</span><span class="op" id="7016903">,</span>&nbsp;<span class="ident" id="7016905">y</span><span class="op" id="7016906">)</span><span class="op" id="7016907">.</span><span class="op" id="7016908">(</span><span class="ident" id="7016909">color</span><span class="op" id="7016914">.</span><span class="ident" id="7016915">Gray16</span><span class="op" id="7016921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7016927">fmt</span><span class="op" id="7016930">.</span><span class="ident" id="7016931">Fprintf</span><span class="op" id="7016938">(</span><span class="ident" id="7016939">w</span><span class="op" id="7016940">,</span>&nbsp;<span class="string" id="7016942">&#34;%04x&nbsp;&#34;</span><span class="op" id="7016949">,</span>&nbsp;<span class="ident" id="7016951">gray16</span><span class="op" id="7016957">.</span><span class="ident" id="7016958">Y</span><span class="op" id="7016959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7016964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016968">case</span>&nbsp;<span class="ident" id="7016973">cm</span>&nbsp;<span class="op" id="7016976">==</span>&nbsp;<span class="ident" id="7016979">color</span><span class="op" id="7016984">.</span><span class="ident" id="7016985">RGBAModel</span><span class="op" id="7016994">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7016999">for</span>&nbsp;<span class="ident" id="7017003">x</span>&nbsp;<span class="op" id="7017005">:=</span>&nbsp;<span class="ident" id="7017008">bounds</span><span class="op" id="7017014">.</span><span class="ident" id="7017015">Min</span><span class="op" id="7017018">.</span><span class="ident" id="7017019">X</span><span class="op" id="7017020">;</span>&nbsp;<span class="ident" id="7017022">x</span>&nbsp;<span class="op" id="7017024">&lt;</span>&nbsp;<span class="ident" id="7017026">bounds</span><span class="op" id="7017032">.</span><span class="ident" id="7017033">Max</span><span class="op" id="7017036">.</span><span class="ident" id="7017037">X</span><span class="op" id="7017038">;</span>&nbsp;<span class="ident" id="7017040">x</span><span class="op" id="7017041">++</span>&nbsp;<span class="op" id="7017044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017050">rgba</span>&nbsp;<span class="op" id="7017055">:=</span>&nbsp;<span class="ident" id="7017058">png</span><span class="op" id="7017061">.</span><span class="ident" id="7017062">At</span><span class="op" id="7017064">(</span><span class="ident" id="7017065">x</span><span class="op" id="7017066">,</span>&nbsp;<span class="ident" id="7017068">y</span><span class="op" id="7017069">)</span><span class="op" id="7017070">.</span><span class="op" id="7017071">(</span><span class="ident" id="7017072">color</span><span class="op" id="7017077">.</span><span class="ident" id="7017078">RGBA</span><span class="op" id="7017082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017088">fmt</span><span class="op" id="7017091">.</span><span class="ident" id="7017092">Fprintf</span><span class="op" id="7017099">(</span><span class="ident" id="7017100">w</span><span class="op" id="7017101">,</span>&nbsp;<span class="string" id="7017103">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7017118">,</span>&nbsp;<span class="ident" id="7017120">rgba</span><span class="op" id="7017124">.</span><span class="ident" id="7017125">R</span><span class="op" id="7017126">,</span>&nbsp;<span class="ident" id="7017128">rgba</span><span class="op" id="7017132">.</span><span class="ident" id="7017133">G</span><span class="op" id="7017134">,</span>&nbsp;<span class="ident" id="7017136">rgba</span><span class="op" id="7017140">.</span><span class="ident" id="7017141">B</span><span class="op" id="7017142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017151">case</span>&nbsp;<span class="ident" id="7017156">cm</span>&nbsp;<span class="op" id="7017159">==</span>&nbsp;<span class="ident" id="7017162">color</span><span class="op" id="7017167">.</span><span class="ident" id="7017168">RGBA64Model</span><span class="op" id="7017179">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017184">for</span>&nbsp;<span class="ident" id="7017188">x</span>&nbsp;<span class="op" id="7017190">:=</span>&nbsp;<span class="ident" id="7017193">bounds</span><span class="op" id="7017199">.</span><span class="ident" id="7017200">Min</span><span class="op" id="7017203">.</span><span class="ident" id="7017204">X</span><span class="op" id="7017205">;</span>&nbsp;<span class="ident" id="7017207">x</span>&nbsp;<span class="op" id="7017209">&lt;</span>&nbsp;<span class="ident" id="7017211">bounds</span><span class="op" id="7017217">.</span><span class="ident" id="7017218">Max</span><span class="op" id="7017221">.</span><span class="ident" id="7017222">X</span><span class="op" id="7017223">;</span>&nbsp;<span class="ident" id="7017225">x</span><span class="op" id="7017226">++</span>&nbsp;<span class="op" id="7017229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017235">rgba64</span>&nbsp;<span class="op" id="7017242">:=</span>&nbsp;<span class="ident" id="7017245">png</span><span class="op" id="7017248">.</span><span class="ident" id="7017249">At</span><span class="op" id="7017251">(</span><span class="ident" id="7017252">x</span><span class="op" id="7017253">,</span>&nbsp;<span class="ident" id="7017255">y</span><span class="op" id="7017256">)</span><span class="op" id="7017257">.</span><span class="op" id="7017258">(</span><span class="ident" id="7017259">color</span><span class="op" id="7017264">.</span><span class="ident" id="7017265">RGBA64</span><span class="op" id="7017271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017277">fmt</span><span class="op" id="7017280">.</span><span class="ident" id="7017281">Fprintf</span><span class="op" id="7017288">(</span><span class="ident" id="7017289">w</span><span class="op" id="7017290">,</span>&nbsp;<span class="string" id="7017292">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7017307">,</span>&nbsp;<span class="ident" id="7017309">rgba64</span><span class="op" id="7017315">.</span><span class="ident" id="7017316">R</span><span class="op" id="7017317">,</span>&nbsp;<span class="ident" id="7017319">rgba64</span><span class="op" id="7017325">.</span><span class="ident" id="7017326">G</span><span class="op" id="7017327">,</span>&nbsp;<span class="ident" id="7017329">rgba64</span><span class="op" id="7017335">.</span><span class="ident" id="7017336">B</span><span class="op" id="7017337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017346">case</span>&nbsp;<span class="ident" id="7017351">cm</span>&nbsp;<span class="op" id="7017354">==</span>&nbsp;<span class="ident" id="7017357">color</span><span class="op" id="7017362">.</span><span class="ident" id="7017363">NRGBAModel</span><span class="op" id="7017373">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017378">for</span>&nbsp;<span class="ident" id="7017382">x</span>&nbsp;<span class="op" id="7017384">:=</span>&nbsp;<span class="ident" id="7017387">bounds</span><span class="op" id="7017393">.</span><span class="ident" id="7017394">Min</span><span class="op" id="7017397">.</span><span class="ident" id="7017398">X</span><span class="op" id="7017399">;</span>&nbsp;<span class="ident" id="7017401">x</span>&nbsp;<span class="op" id="7017403">&lt;</span>&nbsp;<span class="ident" id="7017405">bounds</span><span class="op" id="7017411">.</span><span class="ident" id="7017412">Max</span><span class="op" id="7017415">.</span><span class="ident" id="7017416">X</span><span class="op" id="7017417">;</span>&nbsp;<span class="ident" id="7017419">x</span><span class="op" id="7017420">++</span>&nbsp;<span class="op" id="7017423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017429">nrgba</span>&nbsp;<span class="op" id="7017435">:=</span>&nbsp;<span class="ident" id="7017438">png</span><span class="op" id="7017441">.</span><span class="ident" id="7017442">At</span><span class="op" id="7017444">(</span><span class="ident" id="7017445">x</span><span class="op" id="7017446">,</span>&nbsp;<span class="ident" id="7017448">y</span><span class="op" id="7017449">)</span><span class="op" id="7017450">.</span><span class="op" id="7017451">(</span><span class="ident" id="7017452">color</span><span class="op" id="7017457">.</span><span class="ident" id="7017458">NRGBA</span><span class="op" id="7017463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017469">fmt</span><span class="op" id="7017472">.</span><span class="ident" id="7017473">Fprintf</span><span class="op" id="7017480">(</span><span class="ident" id="7017481">w</span><span class="op" id="7017482">,</span>&nbsp;<span class="string" id="7017484">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="7017503">,</span>&nbsp;<span class="ident" id="7017505">nrgba</span><span class="op" id="7017510">.</span><span class="ident" id="7017511">R</span><span class="op" id="7017512">,</span>&nbsp;<span class="ident" id="7017514">nrgba</span><span class="op" id="7017519">.</span><span class="ident" id="7017520">G</span><span class="op" id="7017521">,</span>&nbsp;<span class="ident" id="7017523">nrgba</span><span class="op" id="7017528">.</span><span class="ident" id="7017529">B</span><span class="op" id="7017530">,</span>&nbsp;<span class="ident" id="7017532">nrgba</span><span class="op" id="7017537">.</span><span class="ident" id="7017538">A</span><span class="op" id="7017539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017548">case</span>&nbsp;<span class="ident" id="7017553">cm</span>&nbsp;<span class="op" id="7017556">==</span>&nbsp;<span class="ident" id="7017559">color</span><span class="op" id="7017564">.</span><span class="ident" id="7017565">NRGBA64Model</span><span class="op" id="7017577">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017582">for</span>&nbsp;<span class="ident" id="7017586">x</span>&nbsp;<span class="op" id="7017588">:=</span>&nbsp;<span class="ident" id="7017591">bounds</span><span class="op" id="7017597">.</span><span class="ident" id="7017598">Min</span><span class="op" id="7017601">.</span><span class="ident" id="7017602">X</span><span class="op" id="7017603">;</span>&nbsp;<span class="ident" id="7017605">x</span>&nbsp;<span class="op" id="7017607">&lt;</span>&nbsp;<span class="ident" id="7017609">bounds</span><span class="op" id="7017615">.</span><span class="ident" id="7017616">Max</span><span class="op" id="7017619">.</span><span class="ident" id="7017620">X</span><span class="op" id="7017621">;</span>&nbsp;<span class="ident" id="7017623">x</span><span class="op" id="7017624">++</span>&nbsp;<span class="op" id="7017627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017633">nrgba64</span>&nbsp;<span class="op" id="7017641">:=</span>&nbsp;<span class="ident" id="7017644">png</span><span class="op" id="7017647">.</span><span class="ident" id="7017648">At</span><span class="op" id="7017650">(</span><span class="ident" id="7017651">x</span><span class="op" id="7017652">,</span>&nbsp;<span class="ident" id="7017654">y</span><span class="op" id="7017655">)</span><span class="op" id="7017656">.</span><span class="op" id="7017657">(</span><span class="ident" id="7017658">color</span><span class="op" id="7017663">.</span><span class="ident" id="7017664">NRGBA64</span><span class="op" id="7017671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017677">fmt</span><span class="op" id="7017680">.</span><span class="ident" id="7017681">Fprintf</span><span class="op" id="7017688">(</span><span class="ident" id="7017689">w</span><span class="op" id="7017690">,</span>&nbsp;<span class="string" id="7017692">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="7017711">,</span>&nbsp;<span class="ident" id="7017713">nrgba64</span><span class="op" id="7017720">.</span><span class="ident" id="7017721">R</span><span class="op" id="7017722">,</span>&nbsp;<span class="ident" id="7017724">nrgba64</span><span class="op" id="7017731">.</span><span class="ident" id="7017732">G</span><span class="op" id="7017733">,</span>&nbsp;<span class="ident" id="7017735">nrgba64</span><span class="op" id="7017742">.</span><span class="ident" id="7017743">B</span><span class="op" id="7017744">,</span>&nbsp;<span class="ident" id="7017746">nrgba64</span><span class="op" id="7017753">.</span><span class="ident" id="7017754">A</span><span class="op" id="7017755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017764">case</span>&nbsp;<span class="ident" id="7017769">cpm</span>&nbsp;<span class="op" id="7017773">!=</span>&nbsp;<span class="builtintype" id="7017776">nil</span><span class="op" id="7017779">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017784">var</span>&nbsp;<span class="ident" id="7017788">b</span><span class="op" id="7017789">,</span>&nbsp;<span class="ident" id="7017791">c</span>&nbsp;<span class="builtintype" id="7017793">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017800">for</span>&nbsp;<span class="ident" id="7017804">x</span>&nbsp;<span class="op" id="7017806">:=</span>&nbsp;<span class="ident" id="7017809">bounds</span><span class="op" id="7017815">.</span><span class="ident" id="7017816">Min</span><span class="op" id="7017819">.</span><span class="ident" id="7017820">X</span><span class="op" id="7017821">;</span>&nbsp;<span class="ident" id="7017823">x</span>&nbsp;<span class="op" id="7017825">&lt;</span>&nbsp;<span class="ident" id="7017827">bounds</span><span class="op" id="7017833">.</span><span class="ident" id="7017834">Max</span><span class="op" id="7017837">.</span><span class="ident" id="7017838">X</span><span class="op" id="7017839">;</span>&nbsp;<span class="ident" id="7017841">x</span><span class="op" id="7017842">++</span>&nbsp;<span class="op" id="7017845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017851">b</span>&nbsp;<span class="op" id="7017853">=</span>&nbsp;<span class="ident" id="7017855">b</span><span class="op" id="7017856">&lt;&lt;</span><span class="builtintype" id="7017858">uint</span><span class="op" id="7017862">(</span><span class="ident" id="7017863">bitdepth</span><span class="op" id="7017871">)</span>&nbsp;<span class="op" id="7017873">|</span>&nbsp;<span class="builtintype" id="7017875">int</span><span class="op" id="7017878">(</span><span class="ident" id="7017879">paletted</span><span class="op" id="7017887">.</span><span class="ident" id="7017888">ColorIndexAt</span><span class="op" id="7017900">(</span><span class="ident" id="7017901">x</span><span class="op" id="7017902">,</span>&nbsp;<span class="ident" id="7017904">y</span><span class="op" id="7017905">)</span><span class="op" id="7017906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017912">c</span><span class="op" id="7017913">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7017920">if</span>&nbsp;<span class="ident" id="7017923">c</span>&nbsp;<span class="op" id="7017925">==</span>&nbsp;<span class="num" id="7017928">8</span><span class="op" id="7017929">/</span><span class="ident" id="7017930">bitdepth</span>&nbsp;<span class="op" id="7017939">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017946">fmt</span><span class="op" id="7017949">.</span><span class="ident" id="7017950">Fprintf</span><span class="op" id="7017957">(</span><span class="ident" id="7017958">w</span><span class="op" id="7017959">,</span>&nbsp;<span class="string" id="7017961">&#34;%02x&#34;</span><span class="op" id="7017967">,</span>&nbsp;<span class="ident" id="7017969">b</span><span class="op" id="7017970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017977">b</span>&nbsp;<span class="op" id="7017979">=</span>&nbsp;<span class="num" id="7017981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7017988">c</span>&nbsp;<span class="op" id="7017990">=</span>&nbsp;<span class="num" id="7017992">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7017998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018003">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018008">if</span>&nbsp;<span class="ident" id="7018011">c</span>&nbsp;<span class="op" id="7018013">!=</span>&nbsp;<span class="num" id="7018016">0</span>&nbsp;<span class="op" id="7018018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018024">for</span>&nbsp;<span class="ident" id="7018028">c</span>&nbsp;<span class="op" id="7018030">!=</span>&nbsp;<span class="num" id="7018033">8</span><span class="op" id="7018034">/</span><span class="ident" id="7018035">bitdepth</span>&nbsp;<span class="op" id="7018044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018051">b</span>&nbsp;<span class="op" id="7018053">=</span>&nbsp;<span class="ident" id="7018055">b</span>&nbsp;<span class="op" id="7018057">&lt;&lt;</span>&nbsp;<span class="builtintype" id="7018060">uint</span><span class="op" id="7018064">(</span><span class="ident" id="7018065">bitdepth</span><span class="op" id="7018073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018080">c</span><span class="op" id="7018081">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018088">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018094">fmt</span><span class="op" id="7018097">.</span><span class="ident" id="7018098">Fprintf</span><span class="op" id="7018105">(</span><span class="ident" id="7018106">w</span><span class="op" id="7018107">,</span>&nbsp;<span class="string" id="7018109">&#34;%02x&#34;</span><span class="op" id="7018115">,</span>&nbsp;<span class="ident" id="7018117">b</span><span class="op" id="7018118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018131">io</span><span class="op" id="7018133">.</span><span class="ident" id="7018134">WriteString</span><span class="op" id="7018145">(</span><span class="ident" id="7018146">w</span><span class="op" id="7018147">,</span>&nbsp;<span class="string" id="7018149">&#34;\n&#34;</span><span class="op" id="7018153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018156">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018159">io</span><span class="op" id="7018161">.</span><span class="ident" id="7018162">WriteString</span><span class="op" id="7018173">(</span><span class="ident" id="7018174">w</span><span class="op" id="7018175">,</span>&nbsp;<span class="string" id="7018177">&#34;}\n&#34;</span><span class="op" id="7018182">)</span><br>
<span class="lineno"></span><span class="op" id="7018184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7018187">func</span>&nbsp;<span class="ident" id="7018192">TestReader</span><span class="op" id="7018202">(</span><span class="ident" id="7018203">t</span>&nbsp;<span class="op" id="7018205">*</span><span class="ident" id="7018206">testing</span><span class="op" id="7018213">.</span><span class="ident" id="7018214">T</span><span class="op" id="7018215">)</span>&nbsp;<span class="op" id="7018217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018220">names</span>&nbsp;<span class="op" id="7018226">:=</span>&nbsp;<span class="ident" id="7018229">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018240">if</span>&nbsp;<span class="ident" id="7018243">testing</span><span class="op" id="7018250">.</span><span class="ident" id="7018251">Short</span><span class="op" id="7018256">(</span><span class="op" id="7018257">)</span>&nbsp;<span class="op" id="7018259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018263">names</span>&nbsp;<span class="op" id="7018269">=</span>&nbsp;<span class="ident" id="7018271">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018290">for</span>&nbsp;<span class="ident" id="7018294">_</span><span class="op" id="7018295">,</span>&nbsp;<span class="ident" id="7018297">fn</span>&nbsp;<span class="op" id="7018300">:=</span>&nbsp;<span class="keyword" id="7018303">range</span>&nbsp;<span class="ident" id="7018309">names</span>&nbsp;<span class="op" id="7018315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7018319">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018344">img</span><span class="op" id="7018347">,</span>&nbsp;<span class="ident" id="7018349">err</span>&nbsp;<span class="op" id="7018353">:=</span>&nbsp;<span class="ident" id="7018356">readPNG</span><span class="op" id="7018363">(</span><span class="string" id="7018364">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7018385">+</span>&nbsp;<span class="ident" id="7018387">fn</span>&nbsp;<span class="op" id="7018390">+</span>&nbsp;<span class="string" id="7018392">&#34;.png&#34;</span><span class="op" id="7018398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018402">if</span>&nbsp;<span class="ident" id="7018405">err</span>&nbsp;<span class="op" id="7018409">!=</span>&nbsp;<span class="builtintype" id="7018412">nil</span>&nbsp;<span class="op" id="7018416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018421">t</span><span class="op" id="7018422">.</span><span class="ident" id="7018423">Error</span><span class="op" id="7018428">(</span><span class="ident" id="7018429">fn</span><span class="op" id="7018431">,</span>&nbsp;<span class="ident" id="7018433">err</span><span class="op" id="7018436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018441">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018452">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018457">if</span>&nbsp;<span class="ident" id="7018460">fn</span>&nbsp;<span class="op" id="7018463">==</span>&nbsp;<span class="string" id="7018466">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="7018477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7018482">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7018559">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018605">c</span>&nbsp;<span class="op" id="7018607">:=</span>&nbsp;<span class="ident" id="7018610">img</span><span class="op" id="7018613">.</span><span class="ident" id="7018614">At</span><span class="op" id="7018616">(</span><span class="num" id="7018617">2</span><span class="op" id="7018618">,</span>&nbsp;<span class="num" id="7018620">1</span><span class="op" id="7018621">)</span><span class="op" id="7018622">.</span><span class="op" id="7018623">(</span><span class="ident" id="7018624">color</span><span class="op" id="7018629">.</span><span class="ident" id="7018630">NRGBA64</span><span class="op" id="7018637">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018642">if</span>&nbsp;<span class="ident" id="7018645">c</span><span class="op" id="7018646">.</span><span class="ident" id="7018647">R</span>&nbsp;<span class="op" id="7018649">!=</span>&nbsp;<span class="num" id="7018652">0x11a7</span>&nbsp;<span class="op" id="7018659">||</span>&nbsp;<span class="ident" id="7018662">c</span><span class="op" id="7018663">.</span><span class="ident" id="7018664">G</span>&nbsp;<span class="op" id="7018666">!=</span>&nbsp;<span class="num" id="7018669">0x11a7</span>&nbsp;<span class="op" id="7018676">||</span>&nbsp;<span class="ident" id="7018679">c</span><span class="op" id="7018680">.</span><span class="ident" id="7018681">B</span>&nbsp;<span class="op" id="7018683">!=</span>&nbsp;<span class="num" id="7018686">0x11a7</span>&nbsp;<span class="op" id="7018693">||</span>&nbsp;<span class="ident" id="7018696">c</span><span class="op" id="7018697">.</span><span class="ident" id="7018698">A</span>&nbsp;<span class="op" id="7018700">!=</span>&nbsp;<span class="num" id="7018703">0x1085</span>&nbsp;<span class="op" id="7018710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018716">t</span><span class="op" id="7018717">.</span><span class="ident" id="7018718">Error</span><span class="op" id="7018723">(</span><span class="ident" id="7018724">fn</span><span class="op" id="7018726">,</span>&nbsp;<span class="ident" id="7018728">fmt</span><span class="op" id="7018731">.</span><span class="ident" id="7018732">Errorf</span><span class="op" id="7018738">(</span><span class="string" id="7018739">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="7018772">,</span>&nbsp;<span class="ident" id="7018774">c</span><span class="op" id="7018775">)</span><span class="op" id="7018776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018786">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7018797">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018802">piper</span><span class="op" id="7018807">,</span>&nbsp;<span class="ident" id="7018809">pipew</span>&nbsp;<span class="op" id="7018815">:=</span>&nbsp;<span class="ident" id="7018818">io</span><span class="op" id="7018820">.</span><span class="ident" id="7018821">Pipe</span><span class="op" id="7018825">(</span><span class="op" id="7018826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018830">pb</span>&nbsp;<span class="op" id="7018833">:=</span>&nbsp;<span class="ident" id="7018836">bufio</span><span class="op" id="7018841">.</span><span class="ident" id="7018842">NewScanner</span><span class="op" id="7018852">(</span><span class="ident" id="7018853">piper</span><span class="op" id="7018858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018862">go</span>&nbsp;<span class="ident" id="7018865">sng</span><span class="op" id="7018868">(</span><span class="ident" id="7018869">pipew</span><span class="op" id="7018874">,</span>&nbsp;<span class="ident" id="7018876">fn</span><span class="op" id="7018878">,</span>&nbsp;<span class="ident" id="7018880">img</span><span class="op" id="7018883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018887">defer</span>&nbsp;<span class="ident" id="7018893">piper</span><span class="op" id="7018898">.</span><span class="ident" id="7018899">Close</span><span class="op" id="7018904">(</span><span class="op" id="7018905">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7018910">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7018935">sf</span><span class="op" id="7018937">,</span>&nbsp;<span class="ident" id="7018939">err</span>&nbsp;<span class="op" id="7018943">:=</span>&nbsp;<span class="ident" id="7018946">os</span><span class="op" id="7018948">.</span><span class="ident" id="7018949">Open</span><span class="op" id="7018953">(</span><span class="string" id="7018954">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7018975">+</span>&nbsp;<span class="ident" id="7018977">fn</span>&nbsp;<span class="op" id="7018980">+</span>&nbsp;<span class="string" id="7018982">&#34;.sng&#34;</span><span class="op" id="7018988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7018992">if</span>&nbsp;<span class="ident" id="7018995">err</span>&nbsp;<span class="op" id="7018999">!=</span>&nbsp;<span class="builtintype" id="7019002">nil</span>&nbsp;<span class="op" id="7019006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019011">t</span><span class="op" id="7019012">.</span><span class="ident" id="7019013">Error</span><span class="op" id="7019018">(</span><span class="ident" id="7019019">fn</span><span class="op" id="7019021">,</span>&nbsp;<span class="ident" id="7019023">err</span><span class="op" id="7019026">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019031">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019046">defer</span>&nbsp;<span class="ident" id="7019052">sf</span><span class="op" id="7019054">.</span><span class="ident" id="7019055">Close</span><span class="op" id="7019060">(</span><span class="op" id="7019061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019065">sb</span>&nbsp;<span class="op" id="7019068">:=</span>&nbsp;<span class="ident" id="7019071">bufio</span><span class="op" id="7019076">.</span><span class="ident" id="7019077">NewScanner</span><span class="op" id="7019087">(</span><span class="ident" id="7019088">sf</span><span class="op" id="7019090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019094">if</span>&nbsp;<span class="ident" id="7019097">err</span>&nbsp;<span class="op" id="7019101">!=</span>&nbsp;<span class="builtintype" id="7019104">nil</span>&nbsp;<span class="op" id="7019108">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019113">t</span><span class="op" id="7019114">.</span><span class="ident" id="7019115">Error</span><span class="op" id="7019120">(</span><span class="ident" id="7019121">fn</span><span class="op" id="7019123">,</span>&nbsp;<span class="ident" id="7019125">err</span><span class="op" id="7019128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019133">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7019149">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019200">for</span>&nbsp;<span class="op" id="7019204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019209">pdone</span>&nbsp;<span class="op" id="7019215">:=</span>&nbsp;<span class="op" id="7019218">!</span><span class="ident" id="7019219">pb</span><span class="op" id="7019221">.</span><span class="ident" id="7019222">Scan</span><span class="op" id="7019226">(</span><span class="op" id="7019227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019232">sdone</span>&nbsp;<span class="op" id="7019238">:=</span>&nbsp;<span class="op" id="7019241">!</span><span class="ident" id="7019242">sb</span><span class="op" id="7019244">.</span><span class="ident" id="7019245">Scan</span><span class="op" id="7019249">(</span><span class="op" id="7019250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019255">if</span>&nbsp;<span class="ident" id="7019258">pdone</span>&nbsp;<span class="op" id="7019264">&amp;&amp;</span>&nbsp;<span class="ident" id="7019267">sdone</span>&nbsp;<span class="op" id="7019273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019279">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019293">if</span>&nbsp;<span class="ident" id="7019296">pdone</span>&nbsp;<span class="op" id="7019302">||</span>&nbsp;<span class="ident" id="7019305">sdone</span>&nbsp;<span class="op" id="7019311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019317">t</span><span class="op" id="7019318">.</span><span class="ident" id="7019319">Errorf</span><span class="op" id="7019325">(</span><span class="string" id="7019326">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="7019347">,</span>&nbsp;<span class="ident" id="7019349">fn</span><span class="op" id="7019351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019357">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019366">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019371">ps</span>&nbsp;<span class="op" id="7019374">:=</span>&nbsp;<span class="ident" id="7019377">pb</span><span class="op" id="7019379">.</span><span class="ident" id="7019380">Text</span><span class="op" id="7019384">(</span><span class="op" id="7019385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019390">ss</span>&nbsp;<span class="op" id="7019393">:=</span>&nbsp;<span class="ident" id="7019396">sb</span><span class="op" id="7019398">.</span><span class="ident" id="7019399">Text</span><span class="op" id="7019403">(</span><span class="op" id="7019404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019409">if</span>&nbsp;<span class="ident" id="7019412">ps</span>&nbsp;<span class="op" id="7019415">!=</span>&nbsp;<span class="ident" id="7019418">ss</span>&nbsp;<span class="op" id="7019421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019427">t</span><span class="op" id="7019428">.</span><span class="ident" id="7019429">Errorf</span><span class="op" id="7019435">(</span><span class="string" id="7019436">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="7019466">,</span>&nbsp;<span class="ident" id="7019468">fn</span><span class="op" id="7019470">,</span>&nbsp;<span class="ident" id="7019472">ps</span><span class="op" id="7019474">,</span>&nbsp;<span class="ident" id="7019476">ss</span><span class="op" id="7019478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019484">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019501">if</span>&nbsp;<span class="ident" id="7019504">pb</span><span class="op" id="7019506">.</span><span class="ident" id="7019507">Err</span><span class="op" id="7019510">(</span><span class="op" id="7019511">)</span>&nbsp;<span class="op" id="7019513">!=</span>&nbsp;<span class="builtintype" id="7019516">nil</span>&nbsp;<span class="op" id="7019520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019525">t</span><span class="op" id="7019526">.</span><span class="ident" id="7019527">Error</span><span class="op" id="7019532">(</span><span class="ident" id="7019533">fn</span><span class="op" id="7019535">,</span>&nbsp;<span class="ident" id="7019537">pb</span><span class="op" id="7019539">.</span><span class="ident" id="7019540">Err</span><span class="op" id="7019543">(</span><span class="op" id="7019544">)</span><span class="op" id="7019545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019549">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019553">if</span>&nbsp;<span class="ident" id="7019556">sb</span><span class="op" id="7019558">.</span><span class="ident" id="7019559">Err</span><span class="op" id="7019562">(</span><span class="op" id="7019563">)</span>&nbsp;<span class="op" id="7019565">!=</span>&nbsp;<span class="builtintype" id="7019568">nil</span>&nbsp;<span class="op" id="7019572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019577">t</span><span class="op" id="7019578">.</span><span class="ident" id="7019579">Error</span><span class="op" id="7019584">(</span><span class="ident" id="7019585">fn</span><span class="op" id="7019587">,</span>&nbsp;<span class="ident" id="7019589">sb</span><span class="op" id="7019591">.</span><span class="ident" id="7019592">Err</span><span class="op" id="7019595">(</span><span class="op" id="7019596">)</span><span class="op" id="7019597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019604">}</span><br>
<span class="lineno"></span><span class="op" id="7019606">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7019609">var</span>&nbsp;<span class="ident" id="7019613">readerErrors</span>&nbsp;<span class="op" id="7019626">=</span>&nbsp;<span class="op" id="7019628">[</span><span class="op" id="7019629">]</span><span class="keyword" id="7019630">struct</span>&nbsp;<span class="op" id="7019637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019640">file</span>&nbsp;<span class="builtintype" id="7019645">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019653">err</span>&nbsp;&nbsp;<span class="builtintype" id="7019658">string</span><br>
<span class="lineno"></span><span class="op" id="7019665">}</span><span class="op" id="7019666">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019669">{</span><span class="string" id="7019670">&#34;invalid-zlib.png&#34;</span><span class="op" id="7019688">,</span>&nbsp;<span class="string" id="7019690">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="7019714">}</span><span class="op" id="7019715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019718">{</span><span class="string" id="7019719">&#34;invalid-crc32.png&#34;</span><span class="op" id="7019738">,</span>&nbsp;<span class="string" id="7019740">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="7019758">}</span><span class="op" id="7019759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019762">{</span><span class="string" id="7019763">&#34;invalid-noend.png&#34;</span><span class="op" id="7019782">,</span>&nbsp;<span class="string" id="7019784">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7019800">}</span><span class="op" id="7019801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019804">{</span><span class="string" id="7019805">&#34;invalid-trunc.png&#34;</span><span class="op" id="7019824">,</span>&nbsp;<span class="string" id="7019826">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7019842">}</span><span class="op" id="7019843">,</span><br>
<span class="lineno"></span><span class="op" id="7019845">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7019848">func</span>&nbsp;<span class="ident" id="7019853">TestReaderError</span><span class="op" id="7019868">(</span><span class="ident" id="7019869">t</span>&nbsp;<span class="op" id="7019871">*</span><span class="ident" id="7019872">testing</span><span class="op" id="7019879">.</span><span class="ident" id="7019880">T</span><span class="op" id="7019881">)</span>&nbsp;<span class="op" id="7019883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019886">for</span>&nbsp;<span class="ident" id="7019890">_</span><span class="op" id="7019891">,</span>&nbsp;<span class="ident" id="7019893">tt</span>&nbsp;<span class="op" id="7019896">:=</span>&nbsp;<span class="keyword" id="7019899">range</span>&nbsp;<span class="ident" id="7019905">readerErrors</span>&nbsp;<span class="op" id="7019918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019922">img</span><span class="op" id="7019925">,</span>&nbsp;<span class="ident" id="7019927">err</span>&nbsp;<span class="op" id="7019931">:=</span>&nbsp;<span class="ident" id="7019934">readPNG</span><span class="op" id="7019941">(</span><span class="string" id="7019942">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="7019954">+</span>&nbsp;<span class="ident" id="7019956">tt</span><span class="op" id="7019958">.</span><span class="ident" id="7019959">file</span><span class="op" id="7019963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7019967">if</span>&nbsp;<span class="ident" id="7019970">err</span>&nbsp;<span class="op" id="7019974">==</span>&nbsp;<span class="builtintype" id="7019977">nil</span>&nbsp;<span class="op" id="7019981">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019986">t</span><span class="op" id="7019987">.</span><span class="ident" id="7019988">Errorf</span><span class="op" id="7019994">(</span><span class="string" id="7019995">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="7020023">,</span>&nbsp;<span class="ident" id="7020025">tt</span><span class="op" id="7020027">.</span><span class="ident" id="7020028">file</span><span class="op" id="7020032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020037">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020052">if</span>&nbsp;<span class="op" id="7020055">!</span><span class="ident" id="7020056">strings</span><span class="op" id="7020063">.</span><span class="ident" id="7020064">Contains</span><span class="op" id="7020072">(</span><span class="ident" id="7020073">err</span><span class="op" id="7020076">.</span><span class="ident" id="7020077">Error</span><span class="op" id="7020082">(</span><span class="op" id="7020083">)</span><span class="op" id="7020084">,</span>&nbsp;<span class="ident" id="7020086">tt</span><span class="op" id="7020088">.</span><span class="ident" id="7020089">err</span><span class="op" id="7020092">)</span>&nbsp;<span class="op" id="7020094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020099">t</span><span class="op" id="7020100">.</span><span class="ident" id="7020101">Errorf</span><span class="op" id="7020107">(</span><span class="string" id="7020108">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7020134">,</span>&nbsp;<span class="ident" id="7020136">tt</span><span class="op" id="7020138">.</span><span class="ident" id="7020139">file</span><span class="op" id="7020143">,</span>&nbsp;<span class="ident" id="7020145">err</span><span class="op" id="7020148">,</span>&nbsp;<span class="ident" id="7020150">tt</span><span class="op" id="7020152">.</span><span class="ident" id="7020153">err</span><span class="op" id="7020156">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020164">if</span>&nbsp;<span class="ident" id="7020167">img</span>&nbsp;<span class="op" id="7020171">!=</span>&nbsp;<span class="builtintype" id="7020174">nil</span>&nbsp;<span class="op" id="7020178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020183">t</span><span class="op" id="7020184">.</span><span class="ident" id="7020185">Errorf</span><span class="op" id="7020191">(</span><span class="string" id="7020192">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="7020225">,</span>&nbsp;<span class="ident" id="7020227">tt</span><span class="op" id="7020229">.</span><span class="ident" id="7020230">file</span><span class="op" id="7020234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020241">}</span><br>
<span class="lineno">295</span><span class="op" id="7020243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020246">func</span>&nbsp;<span class="ident" id="7020251">TestPalettedDecodeConfig</span><span class="op" id="7020275">(</span><span class="ident" id="7020276">t</span>&nbsp;<span class="op" id="7020278">*</span><span class="ident" id="7020279">testing</span><span class="op" id="7020286">.</span><span class="ident" id="7020287">T</span><span class="op" id="7020288">)</span>&nbsp;<span class="op" id="7020290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020293">for</span>&nbsp;<span class="ident" id="7020297">_</span><span class="op" id="7020298">,</span>&nbsp;<span class="ident" id="7020300">fn</span>&nbsp;<span class="op" id="7020303">:=</span>&nbsp;<span class="keyword" id="7020306">range</span>&nbsp;<span class="ident" id="7020312">filenamesPaletted</span>&nbsp;<span class="op" id="7020330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020334">f</span><span class="op" id="7020335">,</span>&nbsp;<span class="ident" id="7020337">err</span>&nbsp;<span class="op" id="7020341">:=</span>&nbsp;<span class="ident" id="7020344">os</span><span class="op" id="7020346">.</span><span class="ident" id="7020347">Open</span><span class="op" id="7020351">(</span><span class="string" id="7020352">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7020373">+</span>&nbsp;<span class="ident" id="7020375">fn</span>&nbsp;<span class="op" id="7020378">+</span>&nbsp;<span class="string" id="7020380">&#34;.png&#34;</span><span class="op" id="7020386">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020390">if</span>&nbsp;<span class="ident" id="7020393">err</span>&nbsp;<span class="op" id="7020397">!=</span>&nbsp;<span class="builtintype" id="7020400">nil</span>&nbsp;<span class="op" id="7020404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020409">t</span><span class="op" id="7020410">.</span><span class="ident" id="7020411">Errorf</span><span class="op" id="7020417">(</span><span class="string" id="7020418">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7020439">,</span>&nbsp;<span class="ident" id="7020441">fn</span><span class="op" id="7020443">,</span>&nbsp;<span class="ident" id="7020445">err</span><span class="op" id="7020448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020453">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020468">defer</span>&nbsp;<span class="ident" id="7020474">f</span><span class="op" id="7020475">.</span><span class="ident" id="7020476">Close</span><span class="op" id="7020481">(</span><span class="op" id="7020482">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020486">cfg</span><span class="op" id="7020489">,</span>&nbsp;<span class="ident" id="7020491">err</span>&nbsp;<span class="op" id="7020495">:=</span>&nbsp;<span class="ident" id="7020498">DecodeConfig</span><span class="op" id="7020510">(</span><span class="ident" id="7020511">f</span><span class="op" id="7020512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020516">if</span>&nbsp;<span class="ident" id="7020519">err</span>&nbsp;<span class="op" id="7020523">!=</span>&nbsp;<span class="builtintype" id="7020526">nil</span>&nbsp;<span class="op" id="7020530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020535">t</span><span class="op" id="7020536">.</span><span class="ident" id="7020537">Errorf</span><span class="op" id="7020543">(</span><span class="string" id="7020544">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7020552">,</span>&nbsp;<span class="ident" id="7020554">fn</span><span class="op" id="7020556">,</span>&nbsp;<span class="ident" id="7020558">err</span><span class="op" id="7020561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020566">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020577">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020581">pal</span><span class="op" id="7020584">,</span>&nbsp;<span class="ident" id="7020586">ok</span>&nbsp;<span class="op" id="7020589">:=</span>&nbsp;<span class="ident" id="7020592">cfg</span><span class="op" id="7020595">.</span><span class="ident" id="7020596">ColorModel</span><span class="op" id="7020606">.</span><span class="op" id="7020607">(</span><span class="ident" id="7020608">color</span><span class="op" id="7020613">.</span><span class="ident" id="7020614">Palette</span><span class="op" id="7020621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020625">if</span>&nbsp;<span class="op" id="7020628">!</span><span class="ident" id="7020629">ok</span>&nbsp;<span class="op" id="7020632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020637">t</span><span class="op" id="7020638">.</span><span class="ident" id="7020639">Errorf</span><span class="op" id="7020645">(</span><span class="string" id="7020646">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="7020681">,</span>&nbsp;<span class="ident" id="7020683">fn</span><span class="op" id="7020685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020690">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020701">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020705">if</span>&nbsp;<span class="ident" id="7020708">pal</span>&nbsp;<span class="op" id="7020712">==</span>&nbsp;<span class="builtintype" id="7020715">nil</span>&nbsp;<span class="op" id="7020719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020724">t</span><span class="op" id="7020725">.</span><span class="ident" id="7020726">Errorf</span><span class="op" id="7020732">(</span><span class="string" id="7020733">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="7020762">,</span>&nbsp;<span class="ident" id="7020764">fn</span><span class="op" id="7020766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020771">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020785">}</span><br>
<span class="lineno">320</span><span class="op" id="7020787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020790">func</span>&nbsp;<span class="ident" id="7020795">benchmarkDecode</span><span class="op" id="7020810">(</span><span class="ident" id="7020811">b</span>&nbsp;<span class="op" id="7020813">*</span><span class="ident" id="7020814">testing</span><span class="op" id="7020821">.</span><span class="ident" id="7020822">B</span><span class="op" id="7020823">,</span>&nbsp;<span class="ident" id="7020825">filename</span>&nbsp;<span class="builtintype" id="7020834">string</span><span class="op" id="7020840">,</span>&nbsp;<span class="ident" id="7020842">bytesPerPixel</span>&nbsp;<span class="builtintype" id="7020856">int</span><span class="op" id="7020859">)</span>&nbsp;<span class="op" id="7020861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020864">b</span><span class="op" id="7020865">.</span><span class="ident" id="7020866">StopTimer</span><span class="op" id="7020875">(</span><span class="op" id="7020876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020879">data</span><span class="op" id="7020883">,</span>&nbsp;<span class="ident" id="7020885">err</span>&nbsp;<span class="op" id="7020889">:=</span>&nbsp;<span class="ident" id="7020892">ioutil</span><span class="op" id="7020898">.</span><span class="ident" id="7020899">ReadFile</span><span class="op" id="7020907">(</span><span class="ident" id="7020908">filename</span><span class="op" id="7020916">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020919">if</span>&nbsp;<span class="ident" id="7020922">err</span>&nbsp;<span class="op" id="7020926">!=</span>&nbsp;<span class="builtintype" id="7020929">nil</span>&nbsp;<span class="op" id="7020933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020937">b</span><span class="op" id="7020938">.</span><span class="ident" id="7020939">Fatal</span><span class="op" id="7020944">(</span><span class="ident" id="7020945">err</span><span class="op" id="7020948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020954">s</span>&nbsp;<span class="op" id="7020956">:=</span>&nbsp;<span class="builtintype" id="7020959">string</span><span class="op" id="7020965">(</span><span class="ident" id="7020966">data</span><span class="op" id="7020970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020973">cfg</span><span class="op" id="7020976">,</span>&nbsp;<span class="ident" id="7020978">err</span>&nbsp;<span class="op" id="7020982">:=</span>&nbsp;<span class="ident" id="7020985">DecodeConfig</span><span class="op" id="7020997">(</span><span class="ident" id="7020998">strings</span><span class="op" id="7021005">.</span><span class="ident" id="7021006">NewReader</span><span class="op" id="7021015">(</span><span class="ident" id="7021016">s</span><span class="op" id="7021017">)</span><span class="op" id="7021018">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021021">if</span>&nbsp;<span class="ident" id="7021024">err</span>&nbsp;<span class="op" id="7021028">!=</span>&nbsp;<span class="builtintype" id="7021031">nil</span>&nbsp;<span class="op" id="7021035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021039">b</span><span class="op" id="7021040">.</span><span class="ident" id="7021041">Fatal</span><span class="op" id="7021046">(</span><span class="ident" id="7021047">err</span><span class="op" id="7021050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7021053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021056">b</span><span class="op" id="7021057">.</span><span class="ident" id="7021058">SetBytes</span><span class="op" id="7021066">(</span><span class="builtintype" id="7021067">int64</span><span class="op" id="7021072">(</span><span class="ident" id="7021073">cfg</span><span class="op" id="7021076">.</span><span class="ident" id="7021077">Width</span>&nbsp;<span class="op" id="7021083">*</span>&nbsp;<span class="ident" id="7021085">cfg</span><span class="op" id="7021088">.</span><span class="ident" id="7021089">Height</span>&nbsp;<span class="op" id="7021096">*</span>&nbsp;<span class="ident" id="7021098">bytesPerPixel</span><span class="op" id="7021111">)</span><span class="op" id="7021112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021115">b</span><span class="op" id="7021116">.</span><span class="ident" id="7021117">StartTimer</span><span class="op" id="7021127">(</span><span class="op" id="7021128">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021131">for</span>&nbsp;<span class="ident" id="7021135">i</span>&nbsp;<span class="op" id="7021137">:=</span>&nbsp;<span class="num" id="7021140">0</span><span class="op" id="7021141">;</span>&nbsp;<span class="ident" id="7021143">i</span>&nbsp;<span class="op" id="7021145">&lt;</span>&nbsp;<span class="ident" id="7021147">b</span><span class="op" id="7021148">.</span><span class="ident" id="7021149">N</span><span class="op" id="7021150">;</span>&nbsp;<span class="ident" id="7021152">i</span><span class="op" id="7021153">++</span>&nbsp;<span class="op" id="7021156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021160">Decode</span><span class="op" id="7021166">(</span><span class="ident" id="7021167">strings</span><span class="op" id="7021174">.</span><span class="ident" id="7021175">NewReader</span><span class="op" id="7021184">(</span><span class="ident" id="7021185">s</span><span class="op" id="7021186">)</span><span class="op" id="7021187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7021190">}</span><br>
<span class="lineno"></span><span class="op" id="7021192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="7021195">func</span>&nbsp;<span class="ident" id="7021200">BenchmarkDecodeGray</span><span class="op" id="7021219">(</span><span class="ident" id="7021220">b</span>&nbsp;<span class="op" id="7021222">*</span><span class="ident" id="7021223">testing</span><span class="op" id="7021230">.</span><span class="ident" id="7021231">B</span><span class="op" id="7021232">)</span>&nbsp;<span class="op" id="7021234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021237">benchmarkDecode</span><span class="op" id="7021252">(</span><span class="ident" id="7021253">b</span><span class="op" id="7021254">,</span>&nbsp;<span class="string" id="7021256">&#34;testdata/benchGray.png&#34;</span><span class="op" id="7021280">,</span>&nbsp;<span class="num" id="7021282">1</span><span class="op" id="7021283">)</span><br>
<span class="lineno"></span><span class="op" id="7021285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021288">func</span>&nbsp;<span class="ident" id="7021293">BenchmarkDecodeNRGBAGradient</span><span class="op" id="7021321">(</span><span class="ident" id="7021322">b</span>&nbsp;<span class="op" id="7021324">*</span><span class="ident" id="7021325">testing</span><span class="op" id="7021332">.</span><span class="ident" id="7021333">B</span><span class="op" id="7021334">)</span>&nbsp;<span class="op" id="7021336">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021339">benchmarkDecode</span><span class="op" id="7021354">(</span><span class="ident" id="7021355">b</span><span class="op" id="7021356">,</span>&nbsp;<span class="string" id="7021358">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="7021392">,</span>&nbsp;<span class="num" id="7021394">4</span><span class="op" id="7021395">)</span><br>
<span class="lineno"></span><span class="op" id="7021397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021400">func</span>&nbsp;<span class="ident" id="7021405">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="7021431">(</span><span class="ident" id="7021432">b</span>&nbsp;<span class="op" id="7021434">*</span><span class="ident" id="7021435">testing</span><span class="op" id="7021442">.</span><span class="ident" id="7021443">B</span><span class="op" id="7021444">)</span>&nbsp;<span class="op" id="7021446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021449">benchmarkDecode</span><span class="op" id="7021464">(</span><span class="ident" id="7021465">b</span><span class="op" id="7021466">,</span>&nbsp;<span class="string" id="7021468">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="7021500">,</span>&nbsp;<span class="num" id="7021502">4</span><span class="op" id="7021503">)</span><br>
<span class="lineno">350</span><span class="op" id="7021505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021508">func</span>&nbsp;<span class="ident" id="7021513">BenchmarkDecodePaletted</span><span class="op" id="7021536">(</span><span class="ident" id="7021537">b</span>&nbsp;<span class="op" id="7021539">*</span><span class="ident" id="7021540">testing</span><span class="op" id="7021547">.</span><span class="ident" id="7021548">B</span><span class="op" id="7021549">)</span>&nbsp;<span class="op" id="7021551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021554">benchmarkDecode</span><span class="op" id="7021569">(</span><span class="ident" id="7021570">b</span><span class="op" id="7021571">,</span>&nbsp;<span class="string" id="7021573">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="7021601">,</span>&nbsp;<span class="num" id="7021603">1</span><span class="op" id="7021604">)</span><br>
<span class="lineno"></span><span class="op" id="7021606">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7021609">func</span>&nbsp;<span class="ident" id="7021614">BenchmarkDecodeRGB</span><span class="op" id="7021632">(</span><span class="ident" id="7021633">b</span>&nbsp;<span class="op" id="7021635">*</span><span class="ident" id="7021636">testing</span><span class="op" id="7021643">.</span><span class="ident" id="7021644">B</span><span class="op" id="7021645">)</span>&nbsp;<span class="op" id="7021647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021650">benchmarkDecode</span><span class="op" id="7021665">(</span><span class="ident" id="7021666">b</span><span class="op" id="7021667">,</span>&nbsp;<span class="string" id="7021669">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="7021692">,</span>&nbsp;<span class="num" id="7021694">4</span><span class="op" id="7021695">)</span><br>
<span class="lineno"></span><span class="op" id="7021697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7021700">func</span>&nbsp;<span class="ident" id="7021705">BenchmarkDecodeInterlacing</span><span class="op" id="7021731">(</span><span class="ident" id="7021732">b</span>&nbsp;<span class="op" id="7021734">*</span><span class="ident" id="7021735">testing</span><span class="op" id="7021742">.</span><span class="ident" id="7021743">B</span><span class="op" id="7021744">)</span>&nbsp;<span class="op" id="7021746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021749">benchmarkDecode</span><span class="op" id="7021764">(</span><span class="ident" id="7021765">b</span><span class="op" id="7021766">,</span>&nbsp;<span class="string" id="7021768">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="7021801">,</span>&nbsp;<span class="num" id="7021803">4</span><span class="op" id="7021804">)</span><br>
<span class="lineno"></span><span class="op" id="7021806">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
