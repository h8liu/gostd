<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5362667">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5362722">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5362776">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5362827">//&nbsp;Package&nbsp;adler32&nbsp;implements&nbsp;the&nbsp;Adler-32&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="comment" id="5362880">//</span><br>
<span class="lineno"></span><span class="comment" id="5362883">//&nbsp;It&nbsp;is&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1950:</span><br>
<span class="lineno"></span><span class="comment" id="5362913">//&nbsp;&nbsp;&nbsp;&nbspAdler-32&nbsp;is&nbsp;composed&nbsp;of&nbsp;two&nbsp;sums&nbsp;accumulated&nbsp;per&nbsp;byte:&nbsp;s1&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5362977">//&nbsp;&nbsp;&nbsp;&nbspthe&nbsp;sum&nbsp;of&nbsp;all&nbsp;bytes,&nbsp;s2&nbsp;is&nbsp;the&nbsp;sum&nbsp;of&nbsp;all&nbsp;s1&nbsp;values.&nbsp;Both&nbsp;sums</span><br>
<span class="lineno">10</span><span class="comment" id="5363044">//&nbsp;&nbsp;&nbsp;&nbspare&nbsp;done&nbsp;modulo&nbsp;65521.&nbsp;s1&nbsp;is&nbsp;initialized&nbsp;to&nbsp;1,&nbsp;s2&nbsp;to&nbsp;zero.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5363111">//&nbsp;&nbsp;&nbsp;&nbspAdler-32&nbsp;checksum&nbsp;is&nbsp;stored&nbsp;as&nbsp;s2*65536&nbsp;+&nbsp;s1&nbsp;in&nbsp;most-</span><br>
<span class="lineno"></span><span class="comment" id="5363168">//&nbsp;&nbsp;&nbsp;&nbspsignificant-byte&nbsp;first&nbsp;(network)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5363211">package</span>&nbsp;<span class="ident" id="5363219">adler32</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5363228">import</span>&nbsp;<span class="string" id="5363235">&#34;hash&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5363243">const</span>&nbsp;<span class="op" id="5363249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363252">//&nbsp;mod&nbsp;is&nbsp;the&nbsp;largest&nbsp;prime&nbsp;that&nbsp;is&nbsp;less&nbsp;than&nbsp;65536.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363306">mod</span>&nbsp;<span class="op" id="5363310">=</span>&nbsp;<span class="num" id="5363312">65521</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363319">//&nbsp;nmax&nbsp;is&nbsp;the&nbsp;largest&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363355">//&nbsp;255&nbsp;*&nbsp;n&nbsp;*&nbsp;(n+1)&nbsp;/&nbsp;2&nbsp;+&nbsp;(n+1)&nbsp;*&nbsp;(mod-1)&nbsp;&lt;=&nbsp;2^32-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363408">//&nbsp;It&nbsp;is&nbsp;mentioned&nbsp;in&nbsp;RFC&nbsp;1950&nbsp;(search&nbsp;for&nbsp;&#34;5552&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363461">nmax</span>&nbsp;<span class="op" id="5363466">=</span>&nbsp;<span class="num" id="5363468">5552</span><br>
<span class="lineno"></span><span class="op" id="5363473">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="5363476">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;Adler-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5363522">const</span>&nbsp;<span class="ident" id="5363528">Size</span>&nbsp;<span class="op" id="5363533">=</span>&nbsp;<span class="num" id="5363535">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5363538">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno">30</span><span class="comment" id="5363597">//&nbsp;The&nbsp;low&nbsp;16&nbsp;bits&nbsp;are&nbsp;s1,&nbsp;the&nbsp;high&nbsp;16&nbsp;bits&nbsp;are&nbsp;s2.</span><br>
<span class="lineno"></span><span class="keyword" id="5363649">type</span>&nbsp;<span class="ident" id="5363654">digest</span>&nbsp;<span class="builtintype" id="5363661">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5363669">func</span>&nbsp;<span class="op" id="5363674">(</span><span class="ident" id="5363675">d</span>&nbsp;<span class="op" id="5363677">*</span><span class="ident" id="5363678">digest</span><span class="op" id="5363684">)</span>&nbsp;<span class="ident" id="5363686">Reset</span><span class="op" id="5363691">(</span><span class="op" id="5363692">)</span>&nbsp;<span class="op" id="5363694">{</span>&nbsp;<span class="op" id="5363696">*</span><span class="ident" id="5363697">d</span>&nbsp;<span class="op" id="5363699">=</span>&nbsp;<span class="num" id="5363701">1</span>&nbsp;<span class="op" id="5363703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5363706">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;Adler-32&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="5363772">func</span>&nbsp;<span class="ident" id="5363777">New</span><span class="op" id="5363780">(</span><span class="op" id="5363781">)</span>&nbsp;<span class="ident" id="5363783">hash</span><span class="op" id="5363787">.</span><span class="ident" id="5363788">Hash32</span>&nbsp;<span class="op" id="5363795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363798">d</span>&nbsp;<span class="op" id="5363800">:=</span>&nbsp;<span class="builtinfunc" id="5363803">new</span><span class="op" id="5363806">(</span><span class="ident" id="5363807">digest</span><span class="op" id="5363813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363816">d</span><span class="op" id="5363817">.</span><span class="ident" id="5363818">Reset</span><span class="op" id="5363823">(</span><span class="op" id="5363824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363827">return</span>&nbsp;<span class="ident" id="5363834">d</span><br>
<span class="lineno">40</span><span class="op" id="5363836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5363839">func</span>&nbsp;<span class="op" id="5363844">(</span><span class="ident" id="5363845">d</span>&nbsp;<span class="op" id="5363847">*</span><span class="ident" id="5363848">digest</span><span class="op" id="5363854">)</span>&nbsp;<span class="ident" id="5363856">Size</span><span class="op" id="5363860">(</span><span class="op" id="5363861">)</span>&nbsp;<span class="builtintype" id="5363863">int</span>&nbsp;<span class="op" id="5363867">{</span>&nbsp;<span class="keyword" id="5363869">return</span>&nbsp;<span class="ident" id="5363876">Size</span>&nbsp;<span class="op" id="5363881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5363884">func</span>&nbsp;<span class="op" id="5363889">(</span><span class="ident" id="5363890">d</span>&nbsp;<span class="op" id="5363892">*</span><span class="ident" id="5363893">digest</span><span class="op" id="5363899">)</span>&nbsp;<span class="ident" id="5363901">BlockSize</span><span class="op" id="5363910">(</span><span class="op" id="5363911">)</span>&nbsp;<span class="builtintype" id="5363913">int</span>&nbsp;<span class="op" id="5363917">{</span>&nbsp;<span class="keyword" id="5363919">return</span>&nbsp;<span class="num" id="5363926">1</span>&nbsp;<span class="op" id="5363928">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5363931">//&nbsp;Add&nbsp;p&nbsp;to&nbsp;the&nbsp;running&nbsp;checksum&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="5363967">func</span>&nbsp;<span class="ident" id="5363972">update</span><span class="op" id="5363978">(</span><span class="ident" id="5363979">d</span>&nbsp;<span class="ident" id="5363981">digest</span><span class="op" id="5363987">,</span>&nbsp;<span class="ident" id="5363989">p</span>&nbsp;<span class="op" id="5363991">[</span><span class="op" id="5363992">]</span><span class="builtintype" id="5363993">byte</span><span class="op" id="5363997">)</span>&nbsp;<span class="ident" id="5363999">digest</span>&nbsp;<span class="op" id="5364006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364009">s1</span><span class="op" id="5364011">,</span>&nbsp;<span class="ident" id="5364013">s2</span>&nbsp;<span class="op" id="5364016">:=</span>&nbsp;<span class="builtintype" id="5364019">uint32</span><span class="op" id="5364025">(</span><span class="ident" id="5364026">d</span><span class="op" id="5364027">&amp;</span><span class="num" id="5364028">0xffff</span><span class="op" id="5364034">)</span><span class="op" id="5364035">,</span>&nbsp;<span class="builtintype" id="5364037">uint32</span><span class="op" id="5364043">(</span><span class="ident" id="5364044">d</span><span class="op" id="5364045">&gt;&gt;</span><span class="num" id="5364047">16</span><span class="op" id="5364049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364052">for</span>&nbsp;<span class="builtinfunc" id="5364056">len</span><span class="op" id="5364059">(</span><span class="ident" id="5364060">p</span><span class="op" id="5364061">)</span>&nbsp;<span class="op" id="5364063">&gt;</span>&nbsp;<span class="num" id="5364065">0</span>&nbsp;<span class="op" id="5364067">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364071">var</span>&nbsp;<span class="ident" id="5364075">q</span>&nbsp;<span class="op" id="5364077">[</span><span class="op" id="5364078">]</span><span class="builtintype" id="5364079">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364086">if</span>&nbsp;<span class="builtinfunc" id="5364089">len</span><span class="op" id="5364092">(</span><span class="ident" id="5364093">p</span><span class="op" id="5364094">)</span>&nbsp;<span class="op" id="5364096">&gt;</span>&nbsp;<span class="ident" id="5364098">nmax</span>&nbsp;<span class="op" id="5364103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364108">p</span><span class="op" id="5364109">,</span>&nbsp;<span class="ident" id="5364111">q</span>&nbsp;<span class="op" id="5364113">=</span>&nbsp;<span class="ident" id="5364115">p</span><span class="op" id="5364116">[</span><span class="op" id="5364117">:</span><span class="ident" id="5364118">nmax</span><span class="op" id="5364122">]</span><span class="op" id="5364123">,</span>&nbsp;<span class="ident" id="5364125">p</span><span class="op" id="5364126">[</span><span class="ident" id="5364127">nmax</span><span class="op" id="5364131">:</span><span class="op" id="5364132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364140">for</span>&nbsp;<span class="ident" id="5364144">_</span><span class="op" id="5364145">,</span>&nbsp;<span class="ident" id="5364147">x</span>&nbsp;<span class="op" id="5364149">:=</span>&nbsp;<span class="keyword" id="5364152">range</span>&nbsp;<span class="ident" id="5364158">p</span>&nbsp;<span class="op" id="5364160">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364165">s1</span>&nbsp;<span class="op" id="5364168">+=</span>&nbsp;<span class="builtintype" id="5364171">uint32</span><span class="op" id="5364177">(</span><span class="ident" id="5364178">x</span><span class="op" id="5364179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364184">s2</span>&nbsp;<span class="op" id="5364187">+=</span>&nbsp;<span class="ident" id="5364190">s1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364199">s1</span>&nbsp;<span class="op" id="5364202">%=</span>&nbsp;<span class="ident" id="5364205">mod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364211">s2</span>&nbsp;<span class="op" id="5364214">%=</span>&nbsp;<span class="ident" id="5364217">mod</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364223">p</span>&nbsp;<span class="op" id="5364225">=</span>&nbsp;<span class="ident" id="5364227">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364233">return</span>&nbsp;<span class="ident" id="5364240">digest</span><span class="op" id="5364246">(</span><span class="ident" id="5364247">s2</span><span class="op" id="5364249">&lt;&lt;</span><span class="num" id="5364251">16</span>&nbsp;<span class="op" id="5364254">|</span>&nbsp;<span class="ident" id="5364256">s1</span><span class="op" id="5364258">)</span><br>
<span class="lineno"></span><span class="op" id="5364260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="5364263">func</span>&nbsp;<span class="op" id="5364268">(</span><span class="ident" id="5364269">d</span>&nbsp;<span class="op" id="5364271">*</span><span class="ident" id="5364272">digest</span><span class="op" id="5364278">)</span>&nbsp;<span class="ident" id="5364280">Write</span><span class="op" id="5364285">(</span><span class="ident" id="5364286">p</span>&nbsp;<span class="op" id="5364288">[</span><span class="op" id="5364289">]</span><span class="builtintype" id="5364290">byte</span><span class="op" id="5364294">)</span>&nbsp;<span class="op" id="5364296">(</span><span class="ident" id="5364297">nn</span>&nbsp;<span class="builtintype" id="5364300">int</span><span class="op" id="5364303">,</span>&nbsp;<span class="ident" id="5364305">err</span>&nbsp;<span class="builtintype" id="5364309">error</span><span class="op" id="5364314">)</span>&nbsp;<span class="op" id="5364316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364319">*</span><span class="ident" id="5364320">d</span>&nbsp;<span class="op" id="5364322">=</span>&nbsp;<span class="ident" id="5364324">update</span><span class="op" id="5364330">(</span><span class="op" id="5364331">*</span><span class="ident" id="5364332">d</span><span class="op" id="5364333">,</span>&nbsp;<span class="ident" id="5364335">p</span><span class="op" id="5364336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364339">return</span>&nbsp;<span class="builtinfunc" id="5364346">len</span><span class="op" id="5364349">(</span><span class="ident" id="5364350">p</span><span class="op" id="5364351">)</span><span class="op" id="5364352">,</span>&nbsp;<span class="ident" id="5364354">nil</span><br>
<span class="lineno"></span><span class="op" id="5364358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5364361">func</span>&nbsp;<span class="op" id="5364366">(</span><span class="ident" id="5364367">d</span>&nbsp;<span class="op" id="5364369">*</span><span class="ident" id="5364370">digest</span><span class="op" id="5364376">)</span>&nbsp;<span class="ident" id="5364378">Sum32</span><span class="op" id="5364383">(</span><span class="op" id="5364384">)</span>&nbsp;<span class="builtintype" id="5364386">uint32</span>&nbsp;<span class="op" id="5364393">{</span>&nbsp;<span class="keyword" id="5364395">return</span>&nbsp;<span class="builtintype" id="5364402">uint32</span><span class="op" id="5364408">(</span><span class="op" id="5364409">*</span><span class="ident" id="5364410">d</span><span class="op" id="5364411">)</span>&nbsp;<span class="op" id="5364413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5364416">func</span>&nbsp;<span class="op" id="5364421">(</span><span class="ident" id="5364422">d</span>&nbsp;<span class="op" id="5364424">*</span><span class="ident" id="5364425">digest</span><span class="op" id="5364431">)</span>&nbsp;<span class="ident" id="5364433">Sum</span><span class="op" id="5364436">(</span><span class="ident" id="5364437">in</span>&nbsp;<span class="op" id="5364440">[</span><span class="op" id="5364441">]</span><span class="builtintype" id="5364442">byte</span><span class="op" id="5364446">)</span>&nbsp;<span class="op" id="5364448">[</span><span class="op" id="5364449">]</span><span class="builtintype" id="5364450">byte</span>&nbsp;<span class="op" id="5364455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364458">s</span>&nbsp;<span class="op" id="5364460">:=</span>&nbsp;<span class="builtintype" id="5364463">uint32</span><span class="op" id="5364469">(</span><span class="op" id="5364470">*</span><span class="ident" id="5364471">d</span><span class="op" id="5364472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364475">return</span>&nbsp;<span class="builtinfunc" id="5364482">append</span><span class="op" id="5364488">(</span><span class="ident" id="5364489">in</span><span class="op" id="5364491">,</span>&nbsp;<span class="builtintype" id="5364493">byte</span><span class="op" id="5364497">(</span><span class="ident" id="5364498">s</span><span class="op" id="5364499">&gt;&gt;</span><span class="num" id="5364501">24</span><span class="op" id="5364503">)</span><span class="op" id="5364504">,</span>&nbsp;<span class="builtintype" id="5364506">byte</span><span class="op" id="5364510">(</span><span class="ident" id="5364511">s</span><span class="op" id="5364512">&gt;&gt;</span><span class="num" id="5364514">16</span><span class="op" id="5364516">)</span><span class="op" id="5364517">,</span>&nbsp;<span class="builtintype" id="5364519">byte</span><span class="op" id="5364523">(</span><span class="ident" id="5364524">s</span><span class="op" id="5364525">&gt;&gt;</span><span class="num" id="5364527">8</span><span class="op" id="5364528">)</span><span class="op" id="5364529">,</span>&nbsp;<span class="builtintype" id="5364531">byte</span><span class="op" id="5364535">(</span><span class="ident" id="5364536">s</span><span class="op" id="5364537">)</span><span class="op" id="5364538">)</span><br>
<span class="lineno">75</span><span class="op" id="5364540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5364543">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5364594">func</span>&nbsp;<span class="ident" id="5364599">Checksum</span><span class="op" id="5364607">(</span><span class="ident" id="5364608">data</span>&nbsp;<span class="op" id="5364613">[</span><span class="op" id="5364614">]</span><span class="builtintype" id="5364615">byte</span><span class="op" id="5364619">)</span>&nbsp;<span class="builtintype" id="5364621">uint32</span>&nbsp;<span class="op" id="5364628">{</span>&nbsp;<span class="keyword" id="5364630">return</span>&nbsp;<span class="builtintype" id="5364637">uint32</span><span class="op" id="5364643">(</span><span class="ident" id="5364644">update</span><span class="op" id="5364650">(</span><span class="num" id="5364651">1</span><span class="op" id="5364652">,</span>&nbsp;<span class="ident" id="5364654">data</span><span class="op" id="5364658">)</span><span class="op" id="5364659">)</span>&nbsp;<span class="op" id="5364661">}</span>
</div>
</body>
</html>
