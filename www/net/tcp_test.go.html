<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7969303">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7969358">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7969412">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7969463">package</span>&nbsp;<span class="ident" id="7969471">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7969476">import</span>&nbsp;<span class="op" id="7969483">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969486">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969493">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969499">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969510">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969521">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969529">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7969540">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7969547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7969550">func</span>&nbsp;<span class="ident" id="7969555">BenchmarkTCP4OneShot</span><span class="op" id="7969575">(</span><span class="ident" id="7969576">b</span>&nbsp;<span class="op" id="7969578">*</span><span class="ident" id="7969579"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7969586">.</span><span class="ident" id="7969587">B</span><span class="op" id="7969588">)</span>&nbsp;<span class="op" id="7969590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969593"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7969605">(</span><span class="ident" id="7969606"><a href="/net/tcp_test.go.html#7969576">b</a></span><span class="op" id="7969607">,</span>&nbsp;<span class="builtintype" id="7969609">false</span><span class="op" id="7969614">,</span>&nbsp;<span class="builtintype" id="7969616">false</span><span class="op" id="7969621">,</span>&nbsp;<span class="string" id="7969623">&#34;127.0.0.1:0&#34;</span><span class="op" id="7969636">)</span><br>
<span class="lineno"></span><span class="op" id="7969638">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7969641">func</span>&nbsp;<span class="ident" id="7969646">BenchmarkTCP4OneShotTimeout</span><span class="op" id="7969673">(</span><span class="ident" id="7969674">b</span>&nbsp;<span class="op" id="7969676">*</span><span class="ident" id="7969677"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7969684">.</span><span class="ident" id="7969685">B</span><span class="op" id="7969686">)</span>&nbsp;<span class="op" id="7969688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969691"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7969703">(</span><span class="ident" id="7969704"><a href="/net/tcp_test.go.html#7969674">b</a></span><span class="op" id="7969705">,</span>&nbsp;<span class="builtintype" id="7969707">false</span><span class="op" id="7969712">,</span>&nbsp;<span class="builtintype" id="7969714">true</span><span class="op" id="7969718">,</span>&nbsp;<span class="string" id="7969720">&#34;127.0.0.1:0&#34;</span><span class="op" id="7969733">)</span><br>
<span class="lineno"></span><span class="op" id="7969735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7969738">func</span>&nbsp;<span class="ident" id="7969743">BenchmarkTCP4Persistent</span><span class="op" id="7969766">(</span><span class="ident" id="7969767">b</span>&nbsp;<span class="op" id="7969769">*</span><span class="ident" id="7969770"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7969777">.</span><span class="ident" id="7969778">B</span><span class="op" id="7969779">)</span>&nbsp;<span class="op" id="7969781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969784"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7969796">(</span><span class="ident" id="7969797"><a href="/net/tcp_test.go.html#7969767">b</a></span><span class="op" id="7969798">,</span>&nbsp;<span class="builtintype" id="7969800">true</span><span class="op" id="7969804">,</span>&nbsp;<span class="builtintype" id="7969806">false</span><span class="op" id="7969811">,</span>&nbsp;<span class="string" id="7969813">&#34;127.0.0.1:0&#34;</span><span class="op" id="7969826">)</span><br>
<span class="lineno"></span><span class="op" id="7969828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7969831">func</span>&nbsp;<span class="ident" id="7969836">BenchmarkTCP4PersistentTimeout</span><span class="op" id="7969866">(</span><span class="ident" id="7969867">b</span>&nbsp;<span class="op" id="7969869">*</span><span class="ident" id="7969870"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7969877">.</span><span class="ident" id="7969878">B</span><span class="op" id="7969879">)</span>&nbsp;<span class="op" id="7969881">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969884"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7969896">(</span><span class="ident" id="7969897"><a href="/net/tcp_test.go.html#7969867">b</a></span><span class="op" id="7969898">,</span>&nbsp;<span class="builtintype" id="7969900">true</span><span class="op" id="7969904">,</span>&nbsp;<span class="builtintype" id="7969906">true</span><span class="op" id="7969910">,</span>&nbsp;<span class="string" id="7969912">&#34;127.0.0.1:0&#34;</span><span class="op" id="7969925">)</span><br>
<span class="lineno"></span><span class="op" id="7969927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7969930">func</span>&nbsp;<span class="ident" id="7969935">BenchmarkTCP6OneShot</span><span class="op" id="7969955">(</span><span class="ident" id="7969956">b</span>&nbsp;<span class="op" id="7969958">*</span><span class="ident" id="7969959"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7969966">.</span><span class="ident" id="7969967">B</span><span class="op" id="7969968">)</span>&nbsp;<span class="op" id="7969970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7969973">if</span>&nbsp;<span class="op" id="7969976">!</span><span class="ident" id="7969977"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7969990">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7969994"><a href="/net/tcp_test.go.html#7969956">b</a></span><span class="op" id="7969995">.</span><span class="ident" id="7969996">Skip</span><span class="op" id="7970000">(</span><span class="string" id="7970001">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7970024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970030"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7970042">(</span><span class="ident" id="7970043"><a href="/net/tcp_test.go.html#7969956">b</a></span><span class="op" id="7970044">,</span>&nbsp;<span class="builtintype" id="7970046">false</span><span class="op" id="7970051">,</span>&nbsp;<span class="builtintype" id="7970053">false</span><span class="op" id="7970058">,</span>&nbsp;<span class="string" id="7970060">&#34;[::1]:0&#34;</span><span class="op" id="7970069">)</span><br>
<span class="lineno"></span><span class="op" id="7970071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7970074">func</span>&nbsp;<span class="ident" id="7970079">BenchmarkTCP6OneShotTimeout</span><span class="op" id="7970106">(</span><span class="ident" id="7970107">b</span>&nbsp;<span class="op" id="7970109">*</span><span class="ident" id="7970110"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7970117">.</span><span class="ident" id="7970118">B</span><span class="op" id="7970119">)</span>&nbsp;<span class="op" id="7970121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970124">if</span>&nbsp;<span class="op" id="7970127">!</span><span class="ident" id="7970128"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7970141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970145"><a href="/net/tcp_test.go.html#7970107">b</a></span><span class="op" id="7970146">.</span><span class="ident" id="7970147">Skip</span><span class="op" id="7970151">(</span><span class="string" id="7970152">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7970175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970181"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7970193">(</span><span class="ident" id="7970194"><a href="/net/tcp_test.go.html#7970107">b</a></span><span class="op" id="7970195">,</span>&nbsp;<span class="builtintype" id="7970197">false</span><span class="op" id="7970202">,</span>&nbsp;<span class="builtintype" id="7970204">true</span><span class="op" id="7970208">,</span>&nbsp;<span class="string" id="7970210">&#34;[::1]:0&#34;</span><span class="op" id="7970219">)</span><br>
<span class="lineno">45</span><span class="op" id="7970221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7970224">func</span>&nbsp;<span class="ident" id="7970229">BenchmarkTCP6Persistent</span><span class="op" id="7970252">(</span><span class="ident" id="7970253">b</span>&nbsp;<span class="op" id="7970255">*</span><span class="ident" id="7970256"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7970263">.</span><span class="ident" id="7970264">B</span><span class="op" id="7970265">)</span>&nbsp;<span class="op" id="7970267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970270">if</span>&nbsp;<span class="op" id="7970273">!</span><span class="ident" id="7970274"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7970287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970291"><a href="/net/tcp_test.go.html#7970253">b</a></span><span class="op" id="7970292">.</span><span class="ident" id="7970293">Skip</span><span class="op" id="7970297">(</span><span class="string" id="7970298">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7970321">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970327"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7970339">(</span><span class="ident" id="7970340"><a href="/net/tcp_test.go.html#7970253">b</a></span><span class="op" id="7970341">,</span>&nbsp;<span class="builtintype" id="7970343">true</span><span class="op" id="7970347">,</span>&nbsp;<span class="builtintype" id="7970349">false</span><span class="op" id="7970354">,</span>&nbsp;<span class="string" id="7970356">&#34;[::1]:0&#34;</span><span class="op" id="7970365">)</span><br>
<span class="lineno"></span><span class="op" id="7970367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7970370">func</span>&nbsp;<span class="ident" id="7970375">BenchmarkTCP6PersistentTimeout</span><span class="op" id="7970405">(</span><span class="ident" id="7970406">b</span>&nbsp;<span class="op" id="7970408">*</span><span class="ident" id="7970409"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7970416">.</span><span class="ident" id="7970417">B</span><span class="op" id="7970418">)</span>&nbsp;<span class="op" id="7970420">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970423">if</span>&nbsp;<span class="op" id="7970426">!</span><span class="ident" id="7970427"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7970440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970444"><a href="/net/tcp_test.go.html#7970406">b</a></span><span class="op" id="7970445">.</span><span class="ident" id="7970446">Skip</span><span class="op" id="7970450">(</span><span class="string" id="7970451">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7970474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970480"><a href="/net/tcp_test.go.html#7970527">benchmarkTCP</a></span><span class="op" id="7970492">(</span><span class="ident" id="7970493"><a href="/net/tcp_test.go.html#7970406">b</a></span><span class="op" id="7970494">,</span>&nbsp;<span class="builtintype" id="7970496">true</span><span class="op" id="7970500">,</span>&nbsp;<span class="builtintype" id="7970502">true</span><span class="op" id="7970506">,</span>&nbsp;<span class="string" id="7970508">&#34;[::1]:0&#34;</span><span class="op" id="7970517">)</span><br>
<span class="lineno"></span><span class="op" id="7970519">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7970522">func</span>&nbsp;<span class="ident" id="7970527">benchmarkTCP</span><span class="op" id="7970539">(</span><span class="ident" id="7970540">b</span>&nbsp;<span class="op" id="7970542">*</span><span class="ident" id="7970543"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7970550">.</span><span class="ident" id="7970551">B</span><span class="op" id="7970552">,</span>&nbsp;<span class="ident" id="7970554">persistent</span><span class="op" id="7970564">,</span>&nbsp;<span class="ident" id="7970566">timeout</span>&nbsp;<span class="builtintype" id="7970574">bool</span><span class="op" id="7970578">,</span>&nbsp;<span class="ident" id="7970580">laddr</span>&nbsp;<span class="builtintype" id="7970586">string</span><span class="op" id="7970592">)</span>&nbsp;<span class="op" id="7970594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970597">const</span>&nbsp;<span class="ident" id="7970603">msgLen</span>&nbsp;<span class="op" id="7970610">=</span>&nbsp;<span class="num" id="7970612">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970617">conns</span>&nbsp;<span class="op" id="7970623">:=</span>&nbsp;<span class="ident" id="7970626"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7970627">.</span><span class="ident" id="7970628">N</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970631">numConcurrent</span>&nbsp;<span class="op" id="7970645">:=</span>&nbsp;<span class="ident" id="7970648"><a href="/net/tcp_test.go.html#7969510">runtime</a></span><span class="op" id="7970655">.</span><span class="ident" id="7970656">GOMAXPROCS</span><span class="op" id="7970666">(</span><span class="op" id="7970667">-</span><span class="num" id="7970668">1</span><span class="op" id="7970669">)</span>&nbsp;<span class="op" id="7970671">*</span>&nbsp;<span class="num" id="7970673">2</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970676">msgs</span>&nbsp;<span class="op" id="7970681">:=</span>&nbsp;<span class="num" id="7970684">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970687">if</span>&nbsp;<span class="ident" id="7970690"><a href="/net/tcp_test.go.html#7970554">persistent</a></span>&nbsp;<span class="op" id="7970701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970705"><a href="/net/tcp_test.go.html#7970617">conns</a></span>&nbsp;<span class="op" id="7970711">=</span>&nbsp;<span class="ident" id="7970713"><a href="/net/tcp_test.go.html#7970631">numConcurrent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970729"><a href="/net/tcp_test.go.html#7970676">msgs</a></span>&nbsp;<span class="op" id="7970734">=</span>&nbsp;<span class="ident" id="7970736"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7970737">.</span><span class="ident" id="7970738">N</span>&nbsp;<span class="op" id="7970740">/</span>&nbsp;<span class="ident" id="7970742"><a href="/net/tcp_test.go.html#7970617">conns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970750">if</span>&nbsp;<span class="ident" id="7970753"><a href="/net/tcp_test.go.html#7970676">msgs</a></span>&nbsp;<span class="op" id="7970758">==</span>&nbsp;<span class="num" id="7970761">0</span>&nbsp;<span class="op" id="7970763">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970768"><a href="/net/tcp_test.go.html#7970676">msgs</a></span>&nbsp;<span class="op" id="7970773">=</span>&nbsp;<span class="num" id="7970775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970783">if</span>&nbsp;<span class="ident" id="7970786"><a href="/net/tcp_test.go.html#7970617">conns</a></span>&nbsp;<span class="op" id="7970792">&gt;</span>&nbsp;<span class="ident" id="7970794"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7970795">.</span><span class="ident" id="7970796">N</span>&nbsp;<span class="op" id="7970798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970803"><a href="/net/tcp_test.go.html#7970617">conns</a></span>&nbsp;<span class="op" id="7970809">=</span>&nbsp;<span class="ident" id="7970811"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7970812">.</span><span class="ident" id="7970813">N</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970817">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970823">sendMsg</span>&nbsp;<span class="op" id="7970831">:=</span>&nbsp;<span class="keyword" id="7970834">func</span><span class="op" id="7970838">(</span><span class="ident" id="7970839">c</span>&nbsp;<span class="ident" id="7970841"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7970845">,</span>&nbsp;<span class="ident" id="7970847">buf</span>&nbsp;<span class="op" id="7970851">[</span><span class="op" id="7970852">]</span><span class="builtintype" id="7970853">byte</span><span class="op" id="7970857">)</span>&nbsp;<span class="builtintype" id="7970859">bool</span>&nbsp;<span class="op" id="7970864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970868">n</span><span class="op" id="7970869">,</span>&nbsp;<span class="ident" id="7970871">err</span>&nbsp;<span class="op" id="7970875">:=</span>&nbsp;<span class="ident" id="7970878"><a href="/net/tcp_test.go.html#7970839">c</a></span><span class="op" id="7970879">.</span><span class="ident" id="7970880">Write</span><span class="op" id="7970885">(</span><span class="ident" id="7970886"><a href="/net/tcp_test.go.html#7970847">buf</a></span><span class="op" id="7970889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970893">if</span>&nbsp;<span class="ident" id="7970896"><a href="/net/tcp_test.go.html#7970868">n</a></span>&nbsp;<span class="op" id="7970898">!=</span>&nbsp;<span class="builtinfunc" id="7970901">len</span><span class="op" id="7970904">(</span><span class="ident" id="7970905"><a href="/net/tcp_test.go.html#7970847">buf</a></span><span class="op" id="7970908">)</span>&nbsp;<span class="op" id="7970910">||</span>&nbsp;<span class="ident" id="7970913"><a href="/net/tcp_test.go.html#7970871">err</a></span>&nbsp;<span class="op" id="7970917">!=</span>&nbsp;<span class="ident" id="7970920">nil</span>&nbsp;<span class="op" id="7970924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970929"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7970930">.</span><span class="ident" id="7970931">Logf</span><span class="op" id="7970935">(</span><span class="string" id="7970936">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7970954">,</span>&nbsp;<span class="ident" id="7970956"><a href="/net/tcp_test.go.html#7970871">err</a></span><span class="op" id="7970959">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970964">return</span>&nbsp;<span class="builtintype" id="7970971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7970983">return</span>&nbsp;<span class="builtintype" id="7970990">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7970996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7970999">recvMsg</span>&nbsp;<span class="op" id="7971007">:=</span>&nbsp;<span class="keyword" id="7971010">func</span><span class="op" id="7971014">(</span><span class="ident" id="7971015">c</span>&nbsp;<span class="ident" id="7971017"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7971021">,</span>&nbsp;<span class="ident" id="7971023">buf</span>&nbsp;<span class="op" id="7971027">[</span><span class="op" id="7971028">]</span><span class="builtintype" id="7971029">byte</span><span class="op" id="7971033">)</span>&nbsp;<span class="builtintype" id="7971035">bool</span>&nbsp;<span class="op" id="7971040">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971044">for</span>&nbsp;<span class="ident" id="7971048">read</span>&nbsp;<span class="op" id="7971053">:=</span>&nbsp;<span class="num" id="7971056">0</span><span class="op" id="7971057">;</span>&nbsp;<span class="ident" id="7971059"><a href="/net/tcp_test.go.html#7971048">read</a></span>&nbsp;<span class="op" id="7971064">!=</span>&nbsp;<span class="builtinfunc" id="7971067">len</span><span class="op" id="7971070">(</span><span class="ident" id="7971071"><a href="/net/tcp_test.go.html#7971023">buf</a></span><span class="op" id="7971074">)</span><span class="op" id="7971075">;</span>&nbsp;<span class="op" id="7971077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971082">n</span><span class="op" id="7971083">,</span>&nbsp;<span class="ident" id="7971085">err</span>&nbsp;<span class="op" id="7971089">:=</span>&nbsp;<span class="ident" id="7971092"><a href="/net/tcp_test.go.html#7971015">c</a></span><span class="op" id="7971093">.</span><span class="ident" id="7971094">Read</span><span class="op" id="7971098">(</span><span class="ident" id="7971099"><a href="/net/tcp_test.go.html#7971023">buf</a></span><span class="op" id="7971102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971107"><a href="/net/tcp_test.go.html#7971048">read</a></span>&nbsp;<span class="op" id="7971112">+=</span>&nbsp;<span class="ident" id="7971115"><a href="/net/tcp_test.go.html#7971082">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971120">if</span>&nbsp;<span class="ident" id="7971123"><a href="/net/tcp_test.go.html#7971085">err</a></span>&nbsp;<span class="op" id="7971127">!=</span>&nbsp;<span class="ident" id="7971130">nil</span>&nbsp;<span class="op" id="7971134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971140"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7971141">.</span><span class="ident" id="7971142">Logf</span><span class="op" id="7971146">(</span><span class="string" id="7971147">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7971164">,</span>&nbsp;<span class="ident" id="7971166"><a href="/net/tcp_test.go.html#7971085">err</a></span><span class="op" id="7971169">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971175">return</span>&nbsp;<span class="builtintype" id="7971182">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971199">return</span>&nbsp;<span class="builtintype" id="7971206">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971212">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971215">ln</span><span class="op" id="7971217">,</span>&nbsp;<span class="ident" id="7971219">err</span>&nbsp;<span class="op" id="7971223">:=</span>&nbsp;<span class="ident" id="7971226"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7971232">(</span><span class="string" id="7971233">&#34;tcp&#34;</span><span class="op" id="7971238">,</span>&nbsp;<span class="ident" id="7971240"><a href="/net/tcp_test.go.html#7970580">laddr</a></span><span class="op" id="7971245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971248">if</span>&nbsp;<span class="ident" id="7971251"><a href="/net/tcp_test.go.html#7971219">err</a></span>&nbsp;<span class="op" id="7971255">!=</span>&nbsp;<span class="ident" id="7971258">nil</span>&nbsp;<span class="op" id="7971262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971266"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7971267">.</span><span class="ident" id="7971268">Fatalf</span><span class="op" id="7971274">(</span><span class="string" id="7971275">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7971294">,</span>&nbsp;<span class="ident" id="7971296"><a href="/net/tcp_test.go.html#7971219">err</a></span><span class="op" id="7971299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971305">defer</span>&nbsp;<span class="ident" id="7971311"><a href="/net/tcp_test.go.html#7971215">ln</a></span><span class="op" id="7971313">.</span><span class="ident" id="7971314">Close</span><span class="op" id="7971319">(</span><span class="op" id="7971320">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971323">serverSem</span>&nbsp;<span class="op" id="7971333">:=</span>&nbsp;<span class="builtinfunc" id="7971336">make</span><span class="op" id="7971340">(</span><span class="keyword" id="7971341">chan</span>&nbsp;<span class="builtintype" id="7971346">bool</span><span class="op" id="7971350">,</span>&nbsp;<span class="ident" id="7971352"><a href="/net/tcp_test.go.html#7970631">numConcurrent</a></span><span class="op" id="7971365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971368">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971382">go</span>&nbsp;<span class="keyword" id="7971385">func</span><span class="op" id="7971389">(</span><span class="op" id="7971390">)</span>&nbsp;<span class="op" id="7971392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971396">for</span>&nbsp;<span class="op" id="7971400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971405">c</span><span class="op" id="7971406">,</span>&nbsp;<span class="ident" id="7971408">err</span>&nbsp;<span class="op" id="7971412">:=</span>&nbsp;<span class="ident" id="7971415"><a href="/net/tcp_test.go.html#7971215">ln</a></span><span class="op" id="7971417">.</span><span class="ident" id="7971418">Accept</span><span class="op" id="7971424">(</span><span class="op" id="7971425">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971430">if</span>&nbsp;<span class="ident" id="7971433"><a href="/net/tcp_test.go.html#7971408">err</a></span>&nbsp;<span class="op" id="7971437">!=</span>&nbsp;<span class="ident" id="7971440">nil</span>&nbsp;<span class="op" id="7971444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971450">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971464"><a href="/net/tcp_test.go.html#7971323">serverSem</a></span>&nbsp;<span class="op" id="7971474">&lt;-</span>&nbsp;<span class="builtintype" id="7971477">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971485">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971510">go</span>&nbsp;<span class="keyword" id="7971513">func</span><span class="op" id="7971517">(</span><span class="ident" id="7971518">c</span>&nbsp;<span class="ident" id="7971520"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7971524">)</span>&nbsp;<span class="op" id="7971526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971532">defer</span>&nbsp;<span class="keyword" id="7971538">func</span><span class="op" id="7971542">(</span><span class="op" id="7971543">)</span>&nbsp;<span class="op" id="7971545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971552"><a href="/net/tcp_test.go.html#7971518">c</a></span><span class="op" id="7971553">.</span><span class="ident" id="7971554">Close</span><span class="op" id="7971559">(</span><span class="op" id="7971560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971567">&lt;-</span><span class="ident" id="7971569"><a href="/net/tcp_test.go.html#7971323">serverSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971583">}</span><span class="op" id="7971584">(</span><span class="op" id="7971585">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971591">if</span>&nbsp;<span class="ident" id="7971594"><a href="/net/tcp_test.go.html#7970566">timeout</a></span>&nbsp;<span class="op" id="7971602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971609"><a href="/net/tcp_test.go.html#7971518">c</a></span><span class="op" id="7971610">.</span><span class="ident" id="7971611">SetDeadline</span><span class="op" id="7971622">(</span><span class="ident" id="7971623"><a href="/net/tcp_test.go.html#7969540">time</a></span><span class="op" id="7971627">.</span><span class="ident" id="7971628">Now</span><span class="op" id="7971631">(</span><span class="op" id="7971632">)</span><span class="op" id="7971633">.</span><span class="ident" id="7971634">Add</span><span class="op" id="7971637">(</span><span class="ident" id="7971638"><a href="/net/tcp_test.go.html#7969540">time</a></span><span class="op" id="7971642">.</span><span class="ident" id="7971643">Hour</span><span class="op" id="7971647">)</span><span class="op" id="7971648">)</span>&nbsp;<span class="comment" id="7971650">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971685">var</span>&nbsp;<span class="ident" id="7971689">buf</span>&nbsp;<span class="op" id="7971693">[</span><span class="ident" id="7971694"><a href="/net/tcp_test.go.html#7970603">msgLen</a></span><span class="op" id="7971700">]</span><span class="builtintype" id="7971701">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971710">for</span>&nbsp;<span class="ident" id="7971714">m</span>&nbsp;<span class="op" id="7971716">:=</span>&nbsp;<span class="num" id="7971719">0</span><span class="op" id="7971720">;</span>&nbsp;<span class="ident" id="7971722"><a href="/net/tcp_test.go.html#7971714">m</a></span>&nbsp;<span class="op" id="7971724">&lt;</span>&nbsp;<span class="ident" id="7971726"><a href="/net/tcp_test.go.html#7970676">msgs</a></span><span class="op" id="7971730">;</span>&nbsp;<span class="ident" id="7971732"><a href="/net/tcp_test.go.html#7971714">m</a></span><span class="op" id="7971733">++</span>&nbsp;<span class="op" id="7971736">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971743">if</span>&nbsp;<span class="op" id="7971746">!</span><span class="ident" id="7971747"><a href="/net/tcp_test.go.html#7970999">recvMsg</a></span><span class="op" id="7971754">(</span><span class="ident" id="7971755"><a href="/net/tcp_test.go.html#7971518">c</a></span><span class="op" id="7971756">,</span>&nbsp;<span class="ident" id="7971758"><a href="/net/tcp_test.go.html#7971689">buf</a></span><span class="op" id="7971761">[</span><span class="op" id="7971762">:</span><span class="op" id="7971763">]</span><span class="op" id="7971764">)</span>&nbsp;<span class="op" id="7971766">||</span>&nbsp;<span class="op" id="7971769">!</span><span class="ident" id="7971770"><a href="/net/tcp_test.go.html#7970823">sendMsg</a></span><span class="op" id="7971777">(</span><span class="ident" id="7971778"><a href="/net/tcp_test.go.html#7971518">c</a></span><span class="op" id="7971779">,</span>&nbsp;<span class="ident" id="7971781"><a href="/net/tcp_test.go.html#7971689">buf</a></span><span class="op" id="7971784">[</span><span class="op" id="7971785">:</span><span class="op" id="7971786">]</span><span class="op" id="7971787">)</span>&nbsp;<span class="op" id="7971789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971797">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971819">}</span><span class="op" id="7971820">(</span><span class="ident" id="7971821"><a href="/net/tcp_test.go.html#7971405">c</a></span><span class="op" id="7971822">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971829">}</span><span class="op" id="7971830">(</span><span class="op" id="7971831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971834">clientSem</span>&nbsp;<span class="op" id="7971844">:=</span>&nbsp;<span class="builtinfunc" id="7971847">make</span><span class="op" id="7971851">(</span><span class="keyword" id="7971852">chan</span>&nbsp;<span class="builtintype" id="7971857">bool</span><span class="op" id="7971861">,</span>&nbsp;<span class="ident" id="7971863"><a href="/net/tcp_test.go.html#7970631">numConcurrent</a></span><span class="op" id="7971876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971879">for</span>&nbsp;<span class="ident" id="7971883">i</span>&nbsp;<span class="op" id="7971885">:=</span>&nbsp;<span class="num" id="7971888">0</span><span class="op" id="7971889">;</span>&nbsp;<span class="ident" id="7971891"><a href="/net/tcp_test.go.html#7971883">i</a></span>&nbsp;<span class="op" id="7971893">&lt;</span>&nbsp;<span class="ident" id="7971895"><a href="/net/tcp_test.go.html#7970617">conns</a></span><span class="op" id="7971900">;</span>&nbsp;<span class="ident" id="7971902"><a href="/net/tcp_test.go.html#7971883">i</a></span><span class="op" id="7971903">++</span>&nbsp;<span class="op" id="7971906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7971910"><a href="/net/tcp_test.go.html#7971834">clientSem</a></span>&nbsp;<span class="op" id="7971920">&lt;-</span>&nbsp;<span class="builtintype" id="7971923">true</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7971930">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971954">go</span>&nbsp;<span class="keyword" id="7971957">func</span><span class="op" id="7971961">(</span><span class="op" id="7971962">)</span>&nbsp;<span class="op" id="7971964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7971969">defer</span>&nbsp;<span class="keyword" id="7971975">func</span><span class="op" id="7971979">(</span><span class="op" id="7971980">)</span>&nbsp;<span class="op" id="7971982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7971988">&lt;-</span><span class="ident" id="7971990"><a href="/net/tcp_test.go.html#7971834">clientSem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972003">}</span><span class="op" id="7972004">(</span><span class="op" id="7972005">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972010">c</span><span class="op" id="7972011">,</span>&nbsp;<span class="ident" id="7972013">err</span>&nbsp;<span class="op" id="7972017">:=</span>&nbsp;<span class="ident" id="7972020"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7972024">(</span><span class="string" id="7972025">&#34;tcp&#34;</span><span class="op" id="7972030">,</span>&nbsp;<span class="ident" id="7972032"><a href="/net/tcp_test.go.html#7971215">ln</a></span><span class="op" id="7972034">.</span><span class="ident" id="7972035">Addr</span><span class="op" id="7972039">(</span><span class="op" id="7972040">)</span><span class="op" id="7972041">.</span><span class="ident" id="7972042">String</span><span class="op" id="7972048">(</span><span class="op" id="7972049">)</span><span class="op" id="7972050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972055">if</span>&nbsp;<span class="ident" id="7972058"><a href="/net/tcp_test.go.html#7972013">err</a></span>&nbsp;<span class="op" id="7972062">!=</span>&nbsp;<span class="ident" id="7972065">nil</span>&nbsp;<span class="op" id="7972069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972075"><a href="/net/tcp_test.go.html#7970540">b</a></span><span class="op" id="7972076">.</span><span class="ident" id="7972077">Logf</span><span class="op" id="7972081">(</span><span class="string" id="7972082">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7972099">,</span>&nbsp;<span class="ident" id="7972101"><a href="/net/tcp_test.go.html#7972013">err</a></span><span class="op" id="7972104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972120">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972125">defer</span>&nbsp;<span class="ident" id="7972131"><a href="/net/tcp_test.go.html#7972010">c</a></span><span class="op" id="7972132">.</span><span class="ident" id="7972133">Close</span><span class="op" id="7972138">(</span><span class="op" id="7972139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972144">if</span>&nbsp;<span class="ident" id="7972147"><a href="/net/tcp_test.go.html#7970566">timeout</a></span>&nbsp;<span class="op" id="7972155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972161"><a href="/net/tcp_test.go.html#7972010">c</a></span><span class="op" id="7972162">.</span><span class="ident" id="7972163">SetDeadline</span><span class="op" id="7972174">(</span><span class="ident" id="7972175"><a href="/net/tcp_test.go.html#7969540">time</a></span><span class="op" id="7972179">.</span><span class="ident" id="7972180">Now</span><span class="op" id="7972183">(</span><span class="op" id="7972184">)</span><span class="op" id="7972185">.</span><span class="ident" id="7972186">Add</span><span class="op" id="7972189">(</span><span class="ident" id="7972190"><a href="/net/tcp_test.go.html#7969540">time</a></span><span class="op" id="7972194">.</span><span class="ident" id="7972195">Hour</span><span class="op" id="7972199">)</span><span class="op" id="7972200">)</span>&nbsp;<span class="comment" id="7972202">//&nbsp;Not&nbsp;intended&nbsp;to&nbsp;fire.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972235">var</span>&nbsp;<span class="ident" id="7972239">buf</span>&nbsp;<span class="op" id="7972243">[</span><span class="ident" id="7972244"><a href="/net/tcp_test.go.html#7970603">msgLen</a></span><span class="op" id="7972250">]</span><span class="builtintype" id="7972251">byte</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972259">for</span>&nbsp;<span class="ident" id="7972263">m</span>&nbsp;<span class="op" id="7972265">:=</span>&nbsp;<span class="num" id="7972268">0</span><span class="op" id="7972269">;</span>&nbsp;<span class="ident" id="7972271"><a href="/net/tcp_test.go.html#7972263">m</a></span>&nbsp;<span class="op" id="7972273">&lt;</span>&nbsp;<span class="ident" id="7972275"><a href="/net/tcp_test.go.html#7970676">msgs</a></span><span class="op" id="7972279">;</span>&nbsp;<span class="ident" id="7972281"><a href="/net/tcp_test.go.html#7972263">m</a></span><span class="op" id="7972282">++</span>&nbsp;<span class="op" id="7972285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972291">if</span>&nbsp;<span class="op" id="7972294">!</span><span class="ident" id="7972295"><a href="/net/tcp_test.go.html#7970823">sendMsg</a></span><span class="op" id="7972302">(</span><span class="ident" id="7972303"><a href="/net/tcp_test.go.html#7972010">c</a></span><span class="op" id="7972304">,</span>&nbsp;<span class="ident" id="7972306"><a href="/net/tcp_test.go.html#7972239">buf</a></span><span class="op" id="7972309">[</span><span class="op" id="7972310">:</span><span class="op" id="7972311">]</span><span class="op" id="7972312">)</span>&nbsp;<span class="op" id="7972314">||</span>&nbsp;<span class="op" id="7972317">!</span><span class="ident" id="7972318"><a href="/net/tcp_test.go.html#7970999">recvMsg</a></span><span class="op" id="7972325">(</span><span class="ident" id="7972326"><a href="/net/tcp_test.go.html#7972010">c</a></span><span class="op" id="7972327">,</span>&nbsp;<span class="ident" id="7972329"><a href="/net/tcp_test.go.html#7972239">buf</a></span><span class="op" id="7972332">[</span><span class="op" id="7972333">:</span><span class="op" id="7972334">]</span><span class="op" id="7972335">)</span>&nbsp;<span class="op" id="7972337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972344">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972359">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972363">}</span><span class="op" id="7972364">(</span><span class="op" id="7972365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972371">for</span>&nbsp;<span class="ident" id="7972375">i</span>&nbsp;<span class="op" id="7972377">:=</span>&nbsp;<span class="num" id="7972380">0</span><span class="op" id="7972381">;</span>&nbsp;<span class="ident" id="7972383"><a href="/net/tcp_test.go.html#7972375">i</a></span>&nbsp;<span class="op" id="7972385">&lt;</span>&nbsp;<span class="ident" id="7972387"><a href="/net/tcp_test.go.html#7970631">numConcurrent</a></span><span class="op" id="7972400">;</span>&nbsp;<span class="ident" id="7972402"><a href="/net/tcp_test.go.html#7972375">i</a></span><span class="op" id="7972403">++</span>&nbsp;<span class="op" id="7972406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972410"><a href="/net/tcp_test.go.html#7971834">clientSem</a></span>&nbsp;<span class="op" id="7972420">&lt;-</span>&nbsp;<span class="builtintype" id="7972423">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972430"><a href="/net/tcp_test.go.html#7971323">serverSem</a></span>&nbsp;<span class="op" id="7972440">&lt;-</span>&nbsp;<span class="builtintype" id="7972443">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972449">}</span><br>
<span class="lineno"></span><span class="op" id="7972451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7972454">func</span>&nbsp;<span class="ident" id="7972459">BenchmarkTCP4ConcurrentReadWrite</span><span class="op" id="7972491">(</span><span class="ident" id="7972492">b</span>&nbsp;<span class="op" id="7972494">*</span><span class="ident" id="7972495"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7972502">.</span><span class="ident" id="7972503">B</span><span class="op" id="7972504">)</span>&nbsp;<span class="op" id="7972506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972509"><a href="/net/tcp_test.go.html#7972728">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="7972540">(</span><span class="ident" id="7972541"><a href="/net/tcp_test.go.html#7972492">b</a></span><span class="op" id="7972542">,</span>&nbsp;<span class="string" id="7972544">&#34;127.0.0.1:0&#34;</span><span class="op" id="7972557">)</span><br>
<span class="lineno">160</span><span class="op" id="7972559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7972562">func</span>&nbsp;<span class="ident" id="7972567">BenchmarkTCP6ConcurrentReadWrite</span><span class="op" id="7972599">(</span><span class="ident" id="7972600">b</span>&nbsp;<span class="op" id="7972602">*</span><span class="ident" id="7972603"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7972610">.</span><span class="ident" id="7972611">B</span><span class="op" id="7972612">)</span>&nbsp;<span class="op" id="7972614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7972617">if</span>&nbsp;<span class="op" id="7972620">!</span><span class="ident" id="7972621"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7972634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972638"><a href="/net/tcp_test.go.html#7972600">b</a></span><span class="op" id="7972639">.</span><span class="ident" id="7972640">Skip</span><span class="op" id="7972644">(</span><span class="string" id="7972645">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7972668">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7972671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7972674"><a href="/net/tcp_test.go.html#7972728">benchmarkTCPConcurrentReadWrite</a></span><span class="op" id="7972705">(</span><span class="ident" id="7972706"><a href="/net/tcp_test.go.html#7972600">b</a></span><span class="op" id="7972707">,</span>&nbsp;<span class="string" id="7972709">&#34;[::1]:0&#34;</span><span class="op" id="7972718">)</span><br>
<span class="lineno"></span><span class="op" id="7972720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7972723">func</span>&nbsp;<span class="ident" id="7972728">benchmarkTCPConcurrentReadWrite</span><span class="op" id="7972759">(</span><span class="ident" id="7972760">b</span>&nbsp;<span class="op" id="7972762">*</span><span class="ident" id="7972763"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7972770">.</span><span class="ident" id="7972771">B</span><span class="op" id="7972772">,</span>&nbsp;<span class="ident" id="7972774">laddr</span>&nbsp;<span class="builtintype" id="7972780">string</span><span class="op" id="7972786">)</span>&nbsp;<span class="op" id="7972788">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7972791">//&nbsp;The&nbsp;benchmark&nbsp;creates&nbsp;GOMAXPROCS&nbsp;client/server&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7972849">//&nbsp;Each&nbsp;pair&nbsp;creates&nbsp;4&nbsp;goroutines:&nbsp;client&nbsp;reader/writer&nbsp;and&nbsp;server&nbsp;reader/writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7972932">//&nbsp;The&nbsp;benchmark&nbsp;stresses&nbsp;concurrent&nbsp;reading&nbsp;and&nbsp;writing&nbsp;to&nbsp;the&nbsp;same&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7973014">//&nbsp;Such&nbsp;pattern&nbsp;is&nbsp;used&nbsp;in&nbsp;net/http&nbsp;and&nbsp;net/rpc.</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973065"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973066">.</span><span class="ident" id="7973067">StopTimer</span><span class="op" id="7973076">(</span><span class="op" id="7973077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973081">P</span>&nbsp;<span class="op" id="7973083">:=</span>&nbsp;<span class="ident" id="7973086"><a href="/net/tcp_test.go.html#7969510">runtime</a></span><span class="op" id="7973093">.</span><span class="ident" id="7973094">GOMAXPROCS</span><span class="op" id="7973104">(</span><span class="num" id="7973105">0</span><span class="op" id="7973106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973109">N</span>&nbsp;<span class="op" id="7973111">:=</span>&nbsp;<span class="ident" id="7973114"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973115">.</span><span class="ident" id="7973116">N</span>&nbsp;<span class="op" id="7973118">/</span>&nbsp;<span class="ident" id="7973120"><a href="/net/tcp_test.go.html#7973081">P</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973123">W</span>&nbsp;<span class="op" id="7973125">:=</span>&nbsp;<span class="num" id="7973128">1000</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7973135">//&nbsp;Setup&nbsp;P&nbsp;client/server&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973174">clients</span>&nbsp;<span class="op" id="7973182">:=</span>&nbsp;<span class="builtinfunc" id="7973185">make</span><span class="op" id="7973189">(</span><span class="op" id="7973190">[</span><span class="op" id="7973191">]</span><span class="ident" id="7973192"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7973196">,</span>&nbsp;<span class="ident" id="7973198"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973202">servers</span>&nbsp;<span class="op" id="7973210">:=</span>&nbsp;<span class="builtinfunc" id="7973213">make</span><span class="op" id="7973217">(</span><span class="op" id="7973218">[</span><span class="op" id="7973219">]</span><span class="ident" id="7973220"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7973224">,</span>&nbsp;<span class="ident" id="7973226"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973230">ln</span><span class="op" id="7973232">,</span>&nbsp;<span class="ident" id="7973234">err</span>&nbsp;<span class="op" id="7973238">:=</span>&nbsp;<span class="ident" id="7973241"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7973247">(</span><span class="string" id="7973248">&#34;tcp&#34;</span><span class="op" id="7973253">,</span>&nbsp;<span class="ident" id="7973255"><a href="/net/tcp_test.go.html#7972774">laddr</a></span><span class="op" id="7973260">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973263">if</span>&nbsp;<span class="ident" id="7973266"><a href="/net/tcp_test.go.html#7973234">err</a></span>&nbsp;<span class="op" id="7973270">!=</span>&nbsp;<span class="ident" id="7973273">nil</span>&nbsp;<span class="op" id="7973277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973281"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973282">.</span><span class="ident" id="7973283">Fatalf</span><span class="op" id="7973289">(</span><span class="string" id="7973290">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7973309">,</span>&nbsp;<span class="ident" id="7973311"><a href="/net/tcp_test.go.html#7973234">err</a></span><span class="op" id="7973314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973320">defer</span>&nbsp;<span class="ident" id="7973326"><a href="/net/tcp_test.go.html#7973230">ln</a></span><span class="op" id="7973328">.</span><span class="ident" id="7973329">Close</span><span class="op" id="7973334">(</span><span class="op" id="7973335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973338">done</span>&nbsp;<span class="op" id="7973343">:=</span>&nbsp;<span class="builtinfunc" id="7973346">make</span><span class="op" id="7973350">(</span><span class="keyword" id="7973351">chan</span>&nbsp;<span class="builtintype" id="7973356">bool</span><span class="op" id="7973360">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973363">go</span>&nbsp;<span class="keyword" id="7973366">func</span><span class="op" id="7973370">(</span><span class="op" id="7973371">)</span>&nbsp;<span class="op" id="7973373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973377">for</span>&nbsp;<span class="ident" id="7973381">p</span>&nbsp;<span class="op" id="7973383">:=</span>&nbsp;<span class="num" id="7973386">0</span><span class="op" id="7973387">;</span>&nbsp;<span class="ident" id="7973389"><a href="/net/tcp_test.go.html#7973381">p</a></span>&nbsp;<span class="op" id="7973391">&lt;</span>&nbsp;<span class="ident" id="7973393"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973394">;</span>&nbsp;<span class="ident" id="7973396"><a href="/net/tcp_test.go.html#7973381">p</a></span><span class="op" id="7973397">++</span>&nbsp;<span class="op" id="7973400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973405">s</span><span class="op" id="7973406">,</span>&nbsp;<span class="ident" id="7973408">err</span>&nbsp;<span class="op" id="7973412">:=</span>&nbsp;<span class="ident" id="7973415"><a href="/net/tcp_test.go.html#7973230">ln</a></span><span class="op" id="7973417">.</span><span class="ident" id="7973418">Accept</span><span class="op" id="7973424">(</span><span class="op" id="7973425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973430">if</span>&nbsp;<span class="ident" id="7973433"><a href="/net/tcp_test.go.html#7973408">err</a></span>&nbsp;<span class="op" id="7973437">!=</span>&nbsp;<span class="ident" id="7973440">nil</span>&nbsp;<span class="op" id="7973444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973450"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973451">.</span><span class="ident" id="7973452">Errorf</span><span class="op" id="7973458">(</span><span class="string" id="7973459">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7973478">,</span>&nbsp;<span class="ident" id="7973480"><a href="/net/tcp_test.go.html#7973408">err</a></span><span class="op" id="7973483">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973489">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973504"><a href="/net/tcp_test.go.html#7973202">servers</a></span><span class="op" id="7973511">[</span><span class="ident" id="7973512"><a href="/net/tcp_test.go.html#7973381">p</a></span><span class="op" id="7973513">]</span>&nbsp;<span class="op" id="7973515">=</span>&nbsp;<span class="ident" id="7973517"><a href="/net/tcp_test.go.html#7973405">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973525"><a href="/net/tcp_test.go.html#7973338">done</a></span>&nbsp;<span class="op" id="7973530">&lt;-</span>&nbsp;<span class="builtintype" id="7973533">true</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973539">}</span><span class="op" id="7973540">(</span><span class="op" id="7973541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973544">for</span>&nbsp;<span class="ident" id="7973548">p</span>&nbsp;<span class="op" id="7973550">:=</span>&nbsp;<span class="num" id="7973553">0</span><span class="op" id="7973554">;</span>&nbsp;<span class="ident" id="7973556"><a href="/net/tcp_test.go.html#7973548">p</a></span>&nbsp;<span class="op" id="7973558">&lt;</span>&nbsp;<span class="ident" id="7973560"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973561">;</span>&nbsp;<span class="ident" id="7973563"><a href="/net/tcp_test.go.html#7973548">p</a></span><span class="op" id="7973564">++</span>&nbsp;<span class="op" id="7973567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973571">c</span><span class="op" id="7973572">,</span>&nbsp;<span class="ident" id="7973574">err</span>&nbsp;<span class="op" id="7973578">:=</span>&nbsp;<span class="ident" id="7973581"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7973585">(</span><span class="string" id="7973586">&#34;tcp&#34;</span><span class="op" id="7973591">,</span>&nbsp;<span class="ident" id="7973593"><a href="/net/tcp_test.go.html#7973230">ln</a></span><span class="op" id="7973595">.</span><span class="ident" id="7973596">Addr</span><span class="op" id="7973600">(</span><span class="op" id="7973601">)</span><span class="op" id="7973602">.</span><span class="ident" id="7973603">String</span><span class="op" id="7973609">(</span><span class="op" id="7973610">)</span><span class="op" id="7973611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973615">if</span>&nbsp;<span class="ident" id="7973618"><a href="/net/tcp_test.go.html#7973574">err</a></span>&nbsp;<span class="op" id="7973622">!=</span>&nbsp;<span class="ident" id="7973625">nil</span>&nbsp;<span class="op" id="7973629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973634"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973635">.</span><span class="ident" id="7973636">Fatalf</span><span class="op" id="7973642">(</span><span class="string" id="7973643">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7973660">,</span>&nbsp;<span class="ident" id="7973662"><a href="/net/tcp_test.go.html#7973574">err</a></span><span class="op" id="7973665">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973673"><a href="/net/tcp_test.go.html#7973174">clients</a></span><span class="op" id="7973680">[</span><span class="ident" id="7973681"><a href="/net/tcp_test.go.html#7973548">p</a></span><span class="op" id="7973682">]</span>&nbsp;<span class="op" id="7973684">=</span>&nbsp;<span class="ident" id="7973686"><a href="/net/tcp_test.go.html#7973571">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973692">&lt;-</span><span class="ident" id="7973694"><a href="/net/tcp_test.go.html#7973338">done</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973701"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7973702">.</span><span class="ident" id="7973703">StartTimer</span><span class="op" id="7973713">(</span><span class="op" id="7973714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973718">var</span>&nbsp;<span class="ident" id="7973722">wg</span>&nbsp;<span class="ident" id="7973725"><a href="/net/tcp_test.go.html#7969521">sync</a></span><span class="op" id="7973729">.</span><span class="ident" id="7973730">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973741"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7973743">.</span><span class="ident" id="7973744">Add</span><span class="op" id="7973747">(</span><span class="num" id="7973748">4</span>&nbsp;<span class="op" id="7973750">*</span>&nbsp;<span class="ident" id="7973752"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973756">for</span>&nbsp;<span class="ident" id="7973760">p</span>&nbsp;<span class="op" id="7973762">:=</span>&nbsp;<span class="num" id="7973765">0</span><span class="op" id="7973766">;</span>&nbsp;<span class="ident" id="7973768"><a href="/net/tcp_test.go.html#7973760">p</a></span>&nbsp;<span class="op" id="7973770">&lt;</span>&nbsp;<span class="ident" id="7973772"><a href="/net/tcp_test.go.html#7973081">P</a></span><span class="op" id="7973773">;</span>&nbsp;<span class="ident" id="7973775"><a href="/net/tcp_test.go.html#7973760">p</a></span><span class="op" id="7973776">++</span>&nbsp;<span class="op" id="7973779">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7973783">//&nbsp;Client&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973803">go</span>&nbsp;<span class="keyword" id="7973806">func</span><span class="op" id="7973810">(</span><span class="ident" id="7973811">c</span>&nbsp;<span class="ident" id="7973813"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7973817">)</span>&nbsp;<span class="op" id="7973819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973824">defer</span>&nbsp;<span class="ident" id="7973830"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7973832">.</span><span class="ident" id="7973833">Done</span><span class="op" id="7973837">(</span><span class="op" id="7973838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973843">var</span>&nbsp;<span class="ident" id="7973847">buf</span>&nbsp;<span class="op" id="7973851">[</span><span class="num" id="7973852">1</span><span class="op" id="7973853">]</span><span class="builtintype" id="7973854">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973862">for</span>&nbsp;<span class="ident" id="7973866">i</span>&nbsp;<span class="op" id="7973868">:=</span>&nbsp;<span class="num" id="7973871">0</span><span class="op" id="7973872">;</span>&nbsp;<span class="ident" id="7973874"><a href="/net/tcp_test.go.html#7973866">i</a></span>&nbsp;<span class="op" id="7973876">&lt;</span>&nbsp;<span class="ident" id="7973878"><a href="/net/tcp_test.go.html#7973109">N</a></span><span class="op" id="7973879">;</span>&nbsp;<span class="ident" id="7973881"><a href="/net/tcp_test.go.html#7973866">i</a></span><span class="op" id="7973882">++</span>&nbsp;<span class="op" id="7973885">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973891">v</span>&nbsp;<span class="op" id="7973893">:=</span>&nbsp;<span class="builtintype" id="7973896">byte</span><span class="op" id="7973900">(</span><span class="ident" id="7973901"><a href="/net/tcp_test.go.html#7973866">i</a></span><span class="op" id="7973902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7973908">for</span>&nbsp;<span class="ident" id="7973912">w</span>&nbsp;<span class="op" id="7973914">:=</span>&nbsp;<span class="num" id="7973917">0</span><span class="op" id="7973918">;</span>&nbsp;<span class="ident" id="7973920"><a href="/net/tcp_test.go.html#7973912">w</a></span>&nbsp;<span class="op" id="7973922">&lt;</span>&nbsp;<span class="ident" id="7973924"><a href="/net/tcp_test.go.html#7973123">W</a></span><span class="op" id="7973925">;</span>&nbsp;<span class="ident" id="7973927"><a href="/net/tcp_test.go.html#7973912">w</a></span><span class="op" id="7973928">++</span>&nbsp;<span class="op" id="7973931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973938"><a href="/net/tcp_test.go.html#7973891">v</a></span>&nbsp;<span class="op" id="7973940">*=</span>&nbsp;<span class="ident" id="7973943"><a href="/net/tcp_test.go.html#7973891">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7973949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973955"><a href="/net/tcp_test.go.html#7973847">buf</a></span><span class="op" id="7973958">[</span><span class="num" id="7973959">0</span><span class="op" id="7973960">]</span>&nbsp;<span class="op" id="7973962">=</span>&nbsp;<span class="ident" id="7973964"><a href="/net/tcp_test.go.html#7973891">v</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7973970">_</span><span class="op" id="7973971">,</span>&nbsp;<span class="ident" id="7973973">err</span>&nbsp;<span class="op" id="7973977">:=</span>&nbsp;<span class="ident" id="7973980"><a href="/net/tcp_test.go.html#7973811">c</a></span><span class="op" id="7973981">.</span><span class="ident" id="7973982">Write</span><span class="op" id="7973987">(</span><span class="ident" id="7973988"><a href="/net/tcp_test.go.html#7973847">buf</a></span><span class="op" id="7973991">[</span><span class="op" id="7973992">:</span><span class="op" id="7973993">]</span><span class="op" id="7973994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974000">if</span>&nbsp;<span class="ident" id="7974003"><a href="/net/tcp_test.go.html#7973973">err</a></span>&nbsp;<span class="op" id="7974007">!=</span>&nbsp;<span class="ident" id="7974010">nil</span>&nbsp;<span class="op" id="7974014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974021"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7974022">.</span><span class="ident" id="7974023">Errorf</span><span class="op" id="7974029">(</span><span class="string" id="7974030">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7974048">,</span>&nbsp;<span class="ident" id="7974050"><a href="/net/tcp_test.go.html#7973973">err</a></span><span class="op" id="7974053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974060">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974071">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974080">}</span><span class="op" id="7974081">(</span><span class="ident" id="7974082"><a href="/net/tcp_test.go.html#7973174">clients</a></span><span class="op" id="7974089">[</span><span class="ident" id="7974090"><a href="/net/tcp_test.go.html#7973760">p</a></span><span class="op" id="7974091">]</span><span class="op" id="7974092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974097">//&nbsp;Pipe&nbsp;between&nbsp;server&nbsp;reader&nbsp;and&nbsp;server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974148">pipe</span>&nbsp;<span class="op" id="7974153">:=</span>&nbsp;<span class="builtinfunc" id="7974156">make</span><span class="op" id="7974160">(</span><span class="keyword" id="7974161">chan</span>&nbsp;<span class="builtintype" id="7974166">byte</span><span class="op" id="7974170">,</span>&nbsp;<span class="num" id="7974172">128</span><span class="op" id="7974175">)</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974180">//&nbsp;Server&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974200">go</span>&nbsp;<span class="keyword" id="7974203">func</span><span class="op" id="7974207">(</span><span class="ident" id="7974208">s</span>&nbsp;<span class="ident" id="7974210"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7974214">)</span>&nbsp;<span class="op" id="7974216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974221">defer</span>&nbsp;<span class="ident" id="7974227"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7974229">.</span><span class="ident" id="7974230">Done</span><span class="op" id="7974234">(</span><span class="op" id="7974235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974240">var</span>&nbsp;<span class="ident" id="7974244">buf</span>&nbsp;<span class="op" id="7974248">[</span><span class="num" id="7974249">1</span><span class="op" id="7974250">]</span><span class="builtintype" id="7974251">byte</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974259">for</span>&nbsp;<span class="ident" id="7974263">i</span>&nbsp;<span class="op" id="7974265">:=</span>&nbsp;<span class="num" id="7974268">0</span><span class="op" id="7974269">;</span>&nbsp;<span class="ident" id="7974271"><a href="/net/tcp_test.go.html#7974263">i</a></span>&nbsp;<span class="op" id="7974273">&lt;</span>&nbsp;<span class="ident" id="7974275"><a href="/net/tcp_test.go.html#7973109">N</a></span><span class="op" id="7974276">;</span>&nbsp;<span class="ident" id="7974278"><a href="/net/tcp_test.go.html#7974263">i</a></span><span class="op" id="7974279">++</span>&nbsp;<span class="op" id="7974282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974288">_</span><span class="op" id="7974289">,</span>&nbsp;<span class="ident" id="7974291">err</span>&nbsp;<span class="op" id="7974295">:=</span>&nbsp;<span class="ident" id="7974298"><a href="/net/tcp_test.go.html#7974208">s</a></span><span class="op" id="7974299">.</span><span class="ident" id="7974300">Read</span><span class="op" id="7974304">(</span><span class="ident" id="7974305"><a href="/net/tcp_test.go.html#7974244">buf</a></span><span class="op" id="7974308">[</span><span class="op" id="7974309">:</span><span class="op" id="7974310">]</span><span class="op" id="7974311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974317">if</span>&nbsp;<span class="ident" id="7974320"><a href="/net/tcp_test.go.html#7974291">err</a></span>&nbsp;<span class="op" id="7974324">!=</span>&nbsp;<span class="ident" id="7974327">nil</span>&nbsp;<span class="op" id="7974331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974338"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7974339">.</span><span class="ident" id="7974340">Errorf</span><span class="op" id="7974346">(</span><span class="string" id="7974347">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7974364">,</span>&nbsp;<span class="ident" id="7974366"><a href="/net/tcp_test.go.html#7974291">err</a></span><span class="op" id="7974369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974376">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974393"><a href="/net/tcp_test.go.html#7974148">pipe</a></span>&nbsp;<span class="op" id="7974398">&lt;-</span>&nbsp;<span class="ident" id="7974401"><a href="/net/tcp_test.go.html#7974244">buf</a></span><span class="op" id="7974404">[</span><span class="num" id="7974405">0</span><span class="op" id="7974406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974415">}</span><span class="op" id="7974416">(</span><span class="ident" id="7974417"><a href="/net/tcp_test.go.html#7973202">servers</a></span><span class="op" id="7974424">[</span><span class="ident" id="7974425"><a href="/net/tcp_test.go.html#7973760">p</a></span><span class="op" id="7974426">]</span><span class="op" id="7974427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974432">//&nbsp;Server&nbsp;writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974452">go</span>&nbsp;<span class="keyword" id="7974455">func</span><span class="op" id="7974459">(</span><span class="ident" id="7974460">s</span>&nbsp;<span class="ident" id="7974462"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7974466">)</span>&nbsp;<span class="op" id="7974468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974473">defer</span>&nbsp;<span class="ident" id="7974479"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7974481">.</span><span class="ident" id="7974482">Done</span><span class="op" id="7974486">(</span><span class="op" id="7974487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974492">var</span>&nbsp;<span class="ident" id="7974496">buf</span>&nbsp;<span class="op" id="7974500">[</span><span class="num" id="7974501">1</span><span class="op" id="7974502">]</span><span class="builtintype" id="7974503">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974511">for</span>&nbsp;<span class="ident" id="7974515">i</span>&nbsp;<span class="op" id="7974517">:=</span>&nbsp;<span class="num" id="7974520">0</span><span class="op" id="7974521">;</span>&nbsp;<span class="ident" id="7974523"><a href="/net/tcp_test.go.html#7974515">i</a></span>&nbsp;<span class="op" id="7974525">&lt;</span>&nbsp;<span class="ident" id="7974527"><a href="/net/tcp_test.go.html#7973109">N</a></span><span class="op" id="7974528">;</span>&nbsp;<span class="ident" id="7974530"><a href="/net/tcp_test.go.html#7974515">i</a></span><span class="op" id="7974531">++</span>&nbsp;<span class="op" id="7974534">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974540">v</span>&nbsp;<span class="op" id="7974542">:=</span>&nbsp;<span class="op" id="7974545">&lt;-</span><span class="ident" id="7974547"><a href="/net/tcp_test.go.html#7974148">pipe</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974556">for</span>&nbsp;<span class="ident" id="7974560">w</span>&nbsp;<span class="op" id="7974562">:=</span>&nbsp;<span class="num" id="7974565">0</span><span class="op" id="7974566">;</span>&nbsp;<span class="ident" id="7974568"><a href="/net/tcp_test.go.html#7974560">w</a></span>&nbsp;<span class="op" id="7974570">&lt;</span>&nbsp;<span class="ident" id="7974572"><a href="/net/tcp_test.go.html#7973123">W</a></span><span class="op" id="7974573">;</span>&nbsp;<span class="ident" id="7974575"><a href="/net/tcp_test.go.html#7974560">w</a></span><span class="op" id="7974576">++</span>&nbsp;<span class="op" id="7974579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974586"><a href="/net/tcp_test.go.html#7974540">v</a></span>&nbsp;<span class="op" id="7974588">*=</span>&nbsp;<span class="ident" id="7974591"><a href="/net/tcp_test.go.html#7974540">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974603"><a href="/net/tcp_test.go.html#7974496">buf</a></span><span class="op" id="7974606">[</span><span class="num" id="7974607">0</span><span class="op" id="7974608">]</span>&nbsp;<span class="op" id="7974610">=</span>&nbsp;<span class="ident" id="7974612"><a href="/net/tcp_test.go.html#7974540">v</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974618">_</span><span class="op" id="7974619">,</span>&nbsp;<span class="ident" id="7974621">err</span>&nbsp;<span class="op" id="7974625">:=</span>&nbsp;<span class="ident" id="7974628"><a href="/net/tcp_test.go.html#7974460">s</a></span><span class="op" id="7974629">.</span><span class="ident" id="7974630">Write</span><span class="op" id="7974635">(</span><span class="ident" id="7974636"><a href="/net/tcp_test.go.html#7974496">buf</a></span><span class="op" id="7974639">[</span><span class="op" id="7974640">:</span><span class="op" id="7974641">]</span><span class="op" id="7974642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974648">if</span>&nbsp;<span class="ident" id="7974651"><a href="/net/tcp_test.go.html#7974621">err</a></span>&nbsp;<span class="op" id="7974655">!=</span>&nbsp;<span class="ident" id="7974658">nil</span>&nbsp;<span class="op" id="7974662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974669"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7974670">.</span><span class="ident" id="7974671">Errorf</span><span class="op" id="7974677">(</span><span class="string" id="7974678">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7974696">,</span>&nbsp;<span class="ident" id="7974698"><a href="/net/tcp_test.go.html#7974621">err</a></span><span class="op" id="7974701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974719">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974729"><a href="/net/tcp_test.go.html#7974460">s</a></span><span class="op" id="7974730">.</span><span class="ident" id="7974731">Close</span><span class="op" id="7974736">(</span><span class="op" id="7974737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974741">}</span><span class="op" id="7974742">(</span><span class="ident" id="7974743"><a href="/net/tcp_test.go.html#7973202">servers</a></span><span class="op" id="7974750">[</span><span class="ident" id="7974751"><a href="/net/tcp_test.go.html#7973760">p</a></span><span class="op" id="7974752">]</span><span class="op" id="7974753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7974758">//&nbsp;Client&nbsp;reader.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974778">go</span>&nbsp;<span class="keyword" id="7974781">func</span><span class="op" id="7974785">(</span><span class="ident" id="7974786">c</span>&nbsp;<span class="ident" id="7974788"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7974792">)</span>&nbsp;<span class="op" id="7974794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974799">defer</span>&nbsp;<span class="ident" id="7974805"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7974807">.</span><span class="ident" id="7974808">Done</span><span class="op" id="7974812">(</span><span class="op" id="7974813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974818">var</span>&nbsp;<span class="ident" id="7974822">buf</span>&nbsp;<span class="op" id="7974826">[</span><span class="num" id="7974827">1</span><span class="op" id="7974828">]</span><span class="builtintype" id="7974829">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974837">for</span>&nbsp;<span class="ident" id="7974841">i</span>&nbsp;<span class="op" id="7974843">:=</span>&nbsp;<span class="num" id="7974846">0</span><span class="op" id="7974847">;</span>&nbsp;<span class="ident" id="7974849"><a href="/net/tcp_test.go.html#7974841">i</a></span>&nbsp;<span class="op" id="7974851">&lt;</span>&nbsp;<span class="ident" id="7974853"><a href="/net/tcp_test.go.html#7973109">N</a></span><span class="op" id="7974854">;</span>&nbsp;<span class="ident" id="7974856"><a href="/net/tcp_test.go.html#7974841">i</a></span><span class="op" id="7974857">++</span>&nbsp;<span class="op" id="7974860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974866">_</span><span class="op" id="7974867">,</span>&nbsp;<span class="ident" id="7974869">err</span>&nbsp;<span class="op" id="7974873">:=</span>&nbsp;<span class="ident" id="7974876"><a href="/net/tcp_test.go.html#7974786">c</a></span><span class="op" id="7974877">.</span><span class="ident" id="7974878">Read</span><span class="op" id="7974882">(</span><span class="ident" id="7974883"><a href="/net/tcp_test.go.html#7974822">buf</a></span><span class="op" id="7974886">[</span><span class="op" id="7974887">:</span><span class="op" id="7974888">]</span><span class="op" id="7974889">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974895">if</span>&nbsp;<span class="ident" id="7974898"><a href="/net/tcp_test.go.html#7974869">err</a></span>&nbsp;<span class="op" id="7974902">!=</span>&nbsp;<span class="ident" id="7974905">nil</span>&nbsp;<span class="op" id="7974909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974916"><a href="/net/tcp_test.go.html#7972760">b</a></span><span class="op" id="7974917">.</span><span class="ident" id="7974918">Errorf</span><span class="op" id="7974924">(</span><span class="string" id="7974925">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7974942">,</span>&nbsp;<span class="ident" id="7974944"><a href="/net/tcp_test.go.html#7974869">err</a></span><span class="op" id="7974947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7974954">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974970">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7974975"><a href="/net/tcp_test.go.html#7974786">c</a></span><span class="op" id="7974976">.</span><span class="ident" id="7974977">Close</span><span class="op" id="7974982">(</span><span class="op" id="7974983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7974987">}</span><span class="op" id="7974988">(</span><span class="ident" id="7974989"><a href="/net/tcp_test.go.html#7973174">clients</a></span><span class="op" id="7974996">[</span><span class="ident" id="7974997"><a href="/net/tcp_test.go.html#7973760">p</a></span><span class="op" id="7974998">]</span><span class="op" id="7974999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975005"><a href="/net/tcp_test.go.html#7973722">wg</a></span><span class="op" id="7975007">.</span><span class="ident" id="7975008">Wait</span><span class="op" id="7975012">(</span><span class="op" id="7975013">)</span><br>
<span class="lineno"></span><span class="op" id="7975015">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7975018">type</span>&nbsp;<span class="ident" id="7975023">resolveTCPAddrTest</span>&nbsp;<span class="keyword" id="7975042">struct</span>&nbsp;<span class="op" id="7975049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975052">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7975066">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975074">litAddrOrName</span>&nbsp;<span class="builtintype" id="7975088">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975096">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7975110">*</span><span class="ident" id="7975111"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7975120">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7975134">error</span><br>
<span class="lineno"></span><span class="op" id="7975140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7975143">var</span>&nbsp;<span class="ident" id="7975147">resolveTCPAddrTests</span>&nbsp;<span class="op" id="7975167">=</span>&nbsp;<span class="op" id="7975169">[</span><span class="op" id="7975170">]</span><span class="ident" id="7975171"><a href="/net/tcp_test.go.html#7975023">resolveTCPAddrTest</a></span><span class="op" id="7975189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975192">{</span><span class="string" id="7975193">&#34;tcp&#34;</span><span class="op" id="7975198">,</span>&nbsp;<span class="string" id="7975200">&#34;127.0.0.1:0&#34;</span><span class="op" id="7975213">,</span>&nbsp;<span class="op" id="7975215">&amp;</span><span class="ident" id="7975216"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975223">{</span><span class="ident" id="7975224">IP</span><span class="op" id="7975226">:</span>&nbsp;<span class="ident" id="7975228"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7975232">(</span><span class="num" id="7975233">127</span><span class="op" id="7975236">,</span>&nbsp;<span class="num" id="7975238">0</span><span class="op" id="7975239">,</span>&nbsp;<span class="num" id="7975241">0</span><span class="op" id="7975242">,</span>&nbsp;<span class="num" id="7975244">1</span><span class="op" id="7975245">)</span><span class="op" id="7975246">,</span>&nbsp;<span class="ident" id="7975248">Port</span><span class="op" id="7975252">:</span>&nbsp;<span class="num" id="7975254">0</span><span class="op" id="7975255">}</span><span class="op" id="7975256">,</span>&nbsp;<span class="ident" id="7975258">nil</span><span class="op" id="7975261">}</span><span class="op" id="7975262">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975265">{</span><span class="string" id="7975266">&#34;tcp4&#34;</span><span class="op" id="7975272">,</span>&nbsp;<span class="string" id="7975274">&#34;127.0.0.1:65535&#34;</span><span class="op" id="7975291">,</span>&nbsp;<span class="op" id="7975293">&amp;</span><span class="ident" id="7975294"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975301">{</span><span class="ident" id="7975302">IP</span><span class="op" id="7975304">:</span>&nbsp;<span class="ident" id="7975306"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7975310">(</span><span class="num" id="7975311">127</span><span class="op" id="7975314">,</span>&nbsp;<span class="num" id="7975316">0</span><span class="op" id="7975317">,</span>&nbsp;<span class="num" id="7975319">0</span><span class="op" id="7975320">,</span>&nbsp;<span class="num" id="7975322">1</span><span class="op" id="7975323">)</span><span class="op" id="7975324">,</span>&nbsp;<span class="ident" id="7975326">Port</span><span class="op" id="7975330">:</span>&nbsp;<span class="num" id="7975332">65535</span><span class="op" id="7975337">}</span><span class="op" id="7975338">,</span>&nbsp;<span class="ident" id="7975340">nil</span><span class="op" id="7975343">}</span><span class="op" id="7975344">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975348">{</span><span class="string" id="7975349">&#34;tcp&#34;</span><span class="op" id="7975354">,</span>&nbsp;<span class="string" id="7975356">&#34;[::1]:1&#34;</span><span class="op" id="7975365">,</span>&nbsp;<span class="op" id="7975367">&amp;</span><span class="ident" id="7975368"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975375">{</span><span class="ident" id="7975376">IP</span><span class="op" id="7975378">:</span>&nbsp;<span class="ident" id="7975380"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7975387">(</span><span class="string" id="7975388">&#34;::1&#34;</span><span class="op" id="7975393">)</span><span class="op" id="7975394">,</span>&nbsp;<span class="ident" id="7975396">Port</span><span class="op" id="7975400">:</span>&nbsp;<span class="num" id="7975402">1</span><span class="op" id="7975403">}</span><span class="op" id="7975404">,</span>&nbsp;<span class="ident" id="7975406">nil</span><span class="op" id="7975409">}</span><span class="op" id="7975410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975413">{</span><span class="string" id="7975414">&#34;tcp6&#34;</span><span class="op" id="7975420">,</span>&nbsp;<span class="string" id="7975422">&#34;[::1]:65534&#34;</span><span class="op" id="7975435">,</span>&nbsp;<span class="op" id="7975437">&amp;</span><span class="ident" id="7975438"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975445">{</span><span class="ident" id="7975446">IP</span><span class="op" id="7975448">:</span>&nbsp;<span class="ident" id="7975450"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7975457">(</span><span class="string" id="7975458">&#34;::1&#34;</span><span class="op" id="7975463">)</span><span class="op" id="7975464">,</span>&nbsp;<span class="ident" id="7975466">Port</span><span class="op" id="7975470">:</span>&nbsp;<span class="num" id="7975472">65534</span><span class="op" id="7975477">}</span><span class="op" id="7975478">,</span>&nbsp;<span class="ident" id="7975480">nil</span><span class="op" id="7975483">}</span><span class="op" id="7975484">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975488">{</span><span class="string" id="7975489">&#34;tcp&#34;</span><span class="op" id="7975494">,</span>&nbsp;<span class="string" id="7975496">&#34;[::1%en0]:1&#34;</span><span class="op" id="7975509">,</span>&nbsp;<span class="op" id="7975511">&amp;</span><span class="ident" id="7975512"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975519">{</span><span class="ident" id="7975520">IP</span><span class="op" id="7975522">:</span>&nbsp;<span class="ident" id="7975524"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7975531">(</span><span class="string" id="7975532">&#34;::1&#34;</span><span class="op" id="7975537">)</span><span class="op" id="7975538">,</span>&nbsp;<span class="ident" id="7975540">Port</span><span class="op" id="7975544">:</span>&nbsp;<span class="num" id="7975546">1</span><span class="op" id="7975547">,</span>&nbsp;<span class="ident" id="7975549">Zone</span><span class="op" id="7975553">:</span>&nbsp;<span class="string" id="7975555">&#34;en0&#34;</span><span class="op" id="7975560">}</span><span class="op" id="7975561">,</span>&nbsp;<span class="ident" id="7975563">nil</span><span class="op" id="7975566">}</span><span class="op" id="7975567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975570">{</span><span class="string" id="7975571">&#34;tcp6&#34;</span><span class="op" id="7975577">,</span>&nbsp;<span class="string" id="7975579">&#34;[::1%911]:2&#34;</span><span class="op" id="7975592">,</span>&nbsp;<span class="op" id="7975594">&amp;</span><span class="ident" id="7975595"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975602">{</span><span class="ident" id="7975603">IP</span><span class="op" id="7975605">:</span>&nbsp;<span class="ident" id="7975607"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7975614">(</span><span class="string" id="7975615">&#34;::1&#34;</span><span class="op" id="7975620">)</span><span class="op" id="7975621">,</span>&nbsp;<span class="ident" id="7975623">Port</span><span class="op" id="7975627">:</span>&nbsp;<span class="num" id="7975629">2</span><span class="op" id="7975630">,</span>&nbsp;<span class="ident" id="7975632">Zone</span><span class="op" id="7975636">:</span>&nbsp;<span class="string" id="7975638">&#34;911&#34;</span><span class="op" id="7975643">}</span><span class="op" id="7975644">,</span>&nbsp;<span class="ident" id="7975646">nil</span><span class="op" id="7975649">}</span><span class="op" id="7975650">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975654">{</span><span class="string" id="7975655">&#34;&#34;</span><span class="op" id="7975657">,</span>&nbsp;<span class="string" id="7975659">&#34;127.0.0.1:0&#34;</span><span class="op" id="7975672">,</span>&nbsp;<span class="op" id="7975674">&amp;</span><span class="ident" id="7975675"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975682">{</span><span class="ident" id="7975683">IP</span><span class="op" id="7975685">:</span>&nbsp;<span class="ident" id="7975687"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7975691">(</span><span class="num" id="7975692">127</span><span class="op" id="7975695">,</span>&nbsp;<span class="num" id="7975697">0</span><span class="op" id="7975698">,</span>&nbsp;<span class="num" id="7975700">0</span><span class="op" id="7975701">,</span>&nbsp;<span class="num" id="7975703">1</span><span class="op" id="7975704">)</span><span class="op" id="7975705">,</span>&nbsp;<span class="ident" id="7975707">Port</span><span class="op" id="7975711">:</span>&nbsp;<span class="num" id="7975713">0</span><span class="op" id="7975714">}</span><span class="op" id="7975715">,</span>&nbsp;<span class="ident" id="7975717">nil</span><span class="op" id="7975720">}</span><span class="op" id="7975721">,</span>&nbsp;<span class="comment" id="7975723">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975743">{</span><span class="string" id="7975744">&#34;&#34;</span><span class="op" id="7975746">,</span>&nbsp;<span class="string" id="7975748">&#34;[::1]:0&#34;</span><span class="op" id="7975757">,</span>&nbsp;<span class="op" id="7975759">&amp;</span><span class="ident" id="7975760"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975767">{</span><span class="ident" id="7975768">IP</span><span class="op" id="7975770">:</span>&nbsp;<span class="ident" id="7975772"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7975779">(</span><span class="string" id="7975780">&#34;::1&#34;</span><span class="op" id="7975785">)</span><span class="op" id="7975786">,</span>&nbsp;<span class="ident" id="7975788">Port</span><span class="op" id="7975792">:</span>&nbsp;<span class="num" id="7975794">0</span><span class="op" id="7975795">}</span><span class="op" id="7975796">,</span>&nbsp;<span class="ident" id="7975798">nil</span><span class="op" id="7975801">}</span><span class="op" id="7975802">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7975812">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975833">{</span><span class="string" id="7975834">&#34;tcp&#34;</span><span class="op" id="7975839">,</span>&nbsp;<span class="string" id="7975841">&#34;:12345&#34;</span><span class="op" id="7975849">,</span>&nbsp;<span class="op" id="7975851">&amp;</span><span class="ident" id="7975852"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7975859">{</span><span class="ident" id="7975860">Port</span><span class="op" id="7975864">:</span>&nbsp;<span class="num" id="7975866">12345</span><span class="op" id="7975871">}</span><span class="op" id="7975872">,</span>&nbsp;<span class="ident" id="7975874">nil</span><span class="op" id="7975877">}</span><span class="op" id="7975878">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7975882">{</span><span class="string" id="7975883">&#34;http&#34;</span><span class="op" id="7975889">,</span>&nbsp;<span class="string" id="7975891">&#34;127.0.0.1:0&#34;</span><span class="op" id="7975904">,</span>&nbsp;<span class="ident" id="7975906">nil</span><span class="op" id="7975909">,</span>&nbsp;<span class="ident" id="7975911"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="7975930">(</span><span class="string" id="7975931">&#34;http&#34;</span><span class="op" id="7975937">)</span><span class="op" id="7975938">}</span><span class="op" id="7975939">,</span><br>
<span class="lineno"></span><span class="op" id="7975941">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7975944">func</span>&nbsp;<span class="ident" id="7975949">init</span><span class="op" id="7975953">(</span><span class="op" id="7975954">)</span>&nbsp;<span class="op" id="7975956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7975959">if</span>&nbsp;<span class="ident" id="7975962">ifi</span>&nbsp;<span class="op" id="7975966">:=</span>&nbsp;<span class="ident" id="7975969"><a href="/net/interface_test.go.html#7876504">loopbackInterface</a></span><span class="op" id="7975986">(</span><span class="op" id="7975987">)</span><span class="op" id="7975988">;</span>&nbsp;<span class="ident" id="7975990"><a href="/net/tcp_test.go.html#7975962">ifi</a></span>&nbsp;<span class="op" id="7975994">!=</span>&nbsp;<span class="ident" id="7975997">nil</span>&nbsp;<span class="op" id="7976001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976005">index</span>&nbsp;<span class="op" id="7976011">:=</span>&nbsp;<span class="ident" id="7976014"><a href="/net/tcp_test.go.html#7969486">fmt</a></span><span class="op" id="7976017">.</span><span class="ident" id="7976018">Sprintf</span><span class="op" id="7976025">(</span><span class="string" id="7976026">&#34;%v&#34;</span><span class="op" id="7976030">,</span>&nbsp;<span class="ident" id="7976032"><a href="/net/tcp_test.go.html#7975962">ifi</a></span><span class="op" id="7976035">.</span><span class="ident" id="7976036">Index</span><span class="op" id="7976041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976045"><a href="/net/tcp_test.go.html#7975147">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="7976065">=</span>&nbsp;<span class="builtinfunc" id="7976067">append</span><span class="op" id="7976073">(</span><span class="ident" id="7976074"><a href="/net/tcp_test.go.html#7975147">resolveTCPAddrTests</a></span><span class="op" id="7976093">,</span>&nbsp;<span class="op" id="7976095">[</span><span class="op" id="7976096">]</span><span class="ident" id="7976097"><a href="/net/tcp_test.go.html#7975023">resolveTCPAddrTest</a></span><span class="op" id="7976115">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976120">{</span><span class="string" id="7976121">&#34;tcp6&#34;</span><span class="op" id="7976127">,</span>&nbsp;<span class="string" id="7976129">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="7976141">+</span>&nbsp;<span class="ident" id="7976143"><a href="/net/tcp_test.go.html#7975962">ifi</a></span><span class="op" id="7976146">.</span><span class="ident" id="7976147">Name</span>&nbsp;<span class="op" id="7976152">+</span>&nbsp;<span class="string" id="7976154">&#34;]:3&#34;</span><span class="op" id="7976159">,</span>&nbsp;<span class="op" id="7976161">&amp;</span><span class="ident" id="7976162"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7976169">{</span><span class="ident" id="7976170">IP</span><span class="op" id="7976172">:</span>&nbsp;<span class="ident" id="7976174"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7976181">(</span><span class="string" id="7976182">&#34;fe80::1&#34;</span><span class="op" id="7976191">)</span><span class="op" id="7976192">,</span>&nbsp;<span class="ident" id="7976194">Port</span><span class="op" id="7976198">:</span>&nbsp;<span class="num" id="7976200">3</span><span class="op" id="7976201">,</span>&nbsp;<span class="ident" id="7976203">Zone</span><span class="op" id="7976207">:</span>&nbsp;<span class="ident" id="7976209"><a href="/net/ipsock.go.html#1448067">zoneToString</a></span><span class="op" id="7976221">(</span><span class="ident" id="7976222"><a href="/net/tcp_test.go.html#7975962">ifi</a></span><span class="op" id="7976225">.</span><span class="ident" id="7976226">Index</span><span class="op" id="7976231">)</span><span class="op" id="7976232">}</span><span class="op" id="7976233">,</span>&nbsp;<span class="ident" id="7976235">nil</span><span class="op" id="7976238">}</span><span class="op" id="7976239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976244">{</span><span class="string" id="7976245">&#34;tcp6&#34;</span><span class="op" id="7976251">,</span>&nbsp;<span class="string" id="7976253">&#34;[fe80::1%&#34;</span>&nbsp;<span class="op" id="7976265">+</span>&nbsp;<span class="ident" id="7976267"><a href="/net/tcp_test.go.html#7976005">index</a></span>&nbsp;<span class="op" id="7976273">+</span>&nbsp;<span class="string" id="7976275">&#34;]:4&#34;</span><span class="op" id="7976280">,</span>&nbsp;<span class="op" id="7976282">&amp;</span><span class="ident" id="7976283"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7976290">{</span><span class="ident" id="7976291">IP</span><span class="op" id="7976293">:</span>&nbsp;<span class="ident" id="7976295"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="7976302">(</span><span class="string" id="7976303">&#34;fe80::1&#34;</span><span class="op" id="7976312">)</span><span class="op" id="7976313">,</span>&nbsp;<span class="ident" id="7976315">Port</span><span class="op" id="7976319">:</span>&nbsp;<span class="num" id="7976321">4</span><span class="op" id="7976322">,</span>&nbsp;<span class="ident" id="7976324">Zone</span><span class="op" id="7976328">:</span>&nbsp;<span class="ident" id="7976330"><a href="/net/tcp_test.go.html#7976005">index</a></span><span class="op" id="7976335">}</span><span class="op" id="7976336">,</span>&nbsp;<span class="ident" id="7976338">nil</span><span class="op" id="7976341">}</span><span class="op" id="7976342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976346">}</span><span class="op" id="7976347">...</span><span class="op" id="7976350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976356">if</span>&nbsp;<span class="ident" id="7976359">ips</span><span class="op" id="7976362">,</span>&nbsp;<span class="ident" id="7976364">err</span>&nbsp;<span class="op" id="7976368">:=</span>&nbsp;<span class="ident" id="7976371"><a href="/net/lookup.go.html#1454959">LookupIP</a></span><span class="op" id="7976379">(</span><span class="string" id="7976380">&#34;localhost&#34;</span><span class="op" id="7976391">)</span><span class="op" id="7976392">;</span>&nbsp;<span class="ident" id="7976394"><a href="/net/tcp_test.go.html#7976364">err</a></span>&nbsp;<span class="op" id="7976398">==</span>&nbsp;<span class="ident" id="7976401">nil</span>&nbsp;<span class="op" id="7976405">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7976408">len</span><span class="op" id="7976411">(</span><span class="ident" id="7976412"><a href="/net/tcp_test.go.html#7976359">ips</a></span><span class="op" id="7976415">)</span>&nbsp;<span class="op" id="7976417">&gt;</span>&nbsp;<span class="num" id="7976419">1</span>&nbsp;<span class="op" id="7976421">&amp;&amp;</span>&nbsp;<span class="ident" id="7976424"><a href="/net/ipsock.go.html#1440518">supportsIPv4</a></span>&nbsp;<span class="op" id="7976437">&amp;&amp;</span>&nbsp;<span class="ident" id="7976440"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7976453">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976457"><a href="/net/tcp_test.go.html#7975147">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="7976477">=</span>&nbsp;<span class="builtinfunc" id="7976479">append</span><span class="op" id="7976485">(</span><span class="ident" id="7976486"><a href="/net/tcp_test.go.html#7975147">resolveTCPAddrTests</a></span><span class="op" id="7976505">,</span>&nbsp;<span class="op" id="7976507">[</span><span class="op" id="7976508">]</span><span class="ident" id="7976509"><a href="/net/tcp_test.go.html#7975023">resolveTCPAddrTest</a></span><span class="op" id="7976527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976532">{</span><span class="string" id="7976533">&#34;tcp&#34;</span><span class="op" id="7976538">,</span>&nbsp;<span class="string" id="7976540">&#34;localhost:5&#34;</span><span class="op" id="7976553">,</span>&nbsp;<span class="op" id="7976555">&amp;</span><span class="ident" id="7976556"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7976563">{</span><span class="ident" id="7976564">IP</span><span class="op" id="7976566">:</span>&nbsp;<span class="ident" id="7976568"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7976572">(</span><span class="num" id="7976573">127</span><span class="op" id="7976576">,</span>&nbsp;<span class="num" id="7976578">0</span><span class="op" id="7976579">,</span>&nbsp;<span class="num" id="7976581">0</span><span class="op" id="7976582">,</span>&nbsp;<span class="num" id="7976584">1</span><span class="op" id="7976585">)</span><span class="op" id="7976586">,</span>&nbsp;<span class="ident" id="7976588">Port</span><span class="op" id="7976592">:</span>&nbsp;<span class="num" id="7976594">5</span><span class="op" id="7976595">}</span><span class="op" id="7976596">,</span>&nbsp;<span class="ident" id="7976598">nil</span><span class="op" id="7976601">}</span><span class="op" id="7976602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976607">{</span><span class="string" id="7976608">&#34;tcp4&#34;</span><span class="op" id="7976614">,</span>&nbsp;<span class="string" id="7976616">&#34;localhost:6&#34;</span><span class="op" id="7976629">,</span>&nbsp;<span class="op" id="7976631">&amp;</span><span class="ident" id="7976632"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7976639">{</span><span class="ident" id="7976640">IP</span><span class="op" id="7976642">:</span>&nbsp;<span class="ident" id="7976644"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7976648">(</span><span class="num" id="7976649">127</span><span class="op" id="7976652">,</span>&nbsp;<span class="num" id="7976654">0</span><span class="op" id="7976655">,</span>&nbsp;<span class="num" id="7976657">0</span><span class="op" id="7976658">,</span>&nbsp;<span class="num" id="7976660">1</span><span class="op" id="7976661">)</span><span class="op" id="7976662">,</span>&nbsp;<span class="ident" id="7976664">Port</span><span class="op" id="7976668">:</span>&nbsp;<span class="num" id="7976670">6</span><span class="op" id="7976671">}</span><span class="op" id="7976672">,</span>&nbsp;<span class="ident" id="7976674">nil</span><span class="op" id="7976677">}</span><span class="op" id="7976678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976683">{</span><span class="string" id="7976684">&#34;tcp6&#34;</span><span class="op" id="7976690">,</span>&nbsp;<span class="string" id="7976692">&#34;localhost:7&#34;</span><span class="op" id="7976705">,</span>&nbsp;<span class="op" id="7976707">&amp;</span><span class="ident" id="7976708"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7976715">{</span><span class="ident" id="7976716">IP</span><span class="op" id="7976718">:</span>&nbsp;<span class="ident" id="7976720"><a href="/net/ip.go.html#1418830">IPv6loopback</a></span><span class="op" id="7976732">,</span>&nbsp;<span class="ident" id="7976734">Port</span><span class="op" id="7976738">:</span>&nbsp;<span class="num" id="7976740">7</span><span class="op" id="7976741">}</span><span class="op" id="7976742">,</span>&nbsp;<span class="ident" id="7976744">nil</span><span class="op" id="7976747">}</span><span class="op" id="7976748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976752">}</span><span class="op" id="7976753">...</span><span class="op" id="7976756">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7976759">}</span><br>
<span class="lineno"></span><span class="op" id="7976761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7976764">func</span>&nbsp;<span class="ident" id="7976769">TestResolveTCPAddr</span><span class="op" id="7976787">(</span><span class="ident" id="7976788">t</span>&nbsp;<span class="op" id="7976790">*</span><span class="ident" id="7976791"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7976798">.</span><span class="ident" id="7976799">T</span><span class="op" id="7976800">)</span>&nbsp;<span class="op" id="7976802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976805">for</span>&nbsp;<span class="ident" id="7976809">_</span><span class="op" id="7976810">,</span>&nbsp;<span class="ident" id="7976812">tt</span>&nbsp;<span class="op" id="7976815">:=</span>&nbsp;<span class="keyword" id="7976818">range</span>&nbsp;<span class="ident" id="7976824"><a href="/net/tcp_test.go.html#7975147">resolveTCPAddrTests</a></span>&nbsp;<span class="op" id="7976844">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976848">addr</span><span class="op" id="7976852">,</span>&nbsp;<span class="ident" id="7976854">err</span>&nbsp;<span class="op" id="7976858">:=</span>&nbsp;<span class="ident" id="7976861"><a href="/net/tcpsock.go.html#1505235">ResolveTCPAddr</a></span><span class="op" id="7976875">(</span><span class="ident" id="7976876"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7976878">.</span><span class="ident" id="7976879">net</span><span class="op" id="7976882">,</span>&nbsp;<span class="ident" id="7976884"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7976886">.</span><span class="ident" id="7976887">litAddrOrName</span><span class="op" id="7976900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7976904">if</span>&nbsp;<span class="ident" id="7976907"><a href="/net/tcp_test.go.html#7976854">err</a></span>&nbsp;<span class="op" id="7976911">!=</span>&nbsp;<span class="ident" id="7976914"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7976916">.</span><span class="ident" id="7976917">err</span>&nbsp;<span class="op" id="7976921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7976926"><a href="/net/tcp_test.go.html#7976788">t</a></span><span class="op" id="7976927">.</span><span class="ident" id="7976928">Fatalf</span><span class="op" id="7976934">(</span><span class="string" id="7976935">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7976970">,</span>&nbsp;<span class="ident" id="7976972"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7976974">.</span><span class="ident" id="7976975">net</span><span class="op" id="7976978">,</span>&nbsp;<span class="ident" id="7976980"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7976982">.</span><span class="ident" id="7976983">litAddrOrName</span><span class="op" id="7976996">,</span>&nbsp;<span class="ident" id="7976998"><a href="/net/tcp_test.go.html#7976854">err</a></span><span class="op" id="7977001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977009">if</span>&nbsp;<span class="op" id="7977012">!</span><span class="ident" id="7977013"><a href="/net/tcp_test.go.html#7969499">reflect</a></span><span class="op" id="7977020">.</span><span class="ident" id="7977021">DeepEqual</span><span class="op" id="7977030">(</span><span class="ident" id="7977031"><a href="/net/tcp_test.go.html#7976848">addr</a></span><span class="op" id="7977035">,</span>&nbsp;<span class="ident" id="7977037"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977039">.</span><span class="ident" id="7977040">addr</span><span class="op" id="7977044">)</span>&nbsp;<span class="op" id="7977046">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977051"><a href="/net/tcp_test.go.html#7976788">t</a></span><span class="op" id="7977052">.</span><span class="ident" id="7977053">Fatalf</span><span class="op" id="7977059">(</span><span class="string" id="7977060">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7977100">,</span>&nbsp;<span class="ident" id="7977102"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977104">.</span><span class="ident" id="7977105">net</span><span class="op" id="7977108">,</span>&nbsp;<span class="ident" id="7977110"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977112">.</span><span class="ident" id="7977113">litAddrOrName</span><span class="op" id="7977126">,</span>&nbsp;<span class="ident" id="7977128"><a href="/net/tcp_test.go.html#7976848">addr</a></span><span class="op" id="7977132">,</span>&nbsp;<span class="ident" id="7977134"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977136">.</span><span class="ident" id="7977137">addr</span><span class="op" id="7977141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977149">if</span>&nbsp;<span class="ident" id="7977152"><a href="/net/tcp_test.go.html#7976854">err</a></span>&nbsp;<span class="op" id="7977156">==</span>&nbsp;<span class="ident" id="7977159">nil</span>&nbsp;<span class="op" id="7977163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977168">str</span>&nbsp;<span class="op" id="7977172">:=</span>&nbsp;<span class="ident" id="7977175"><a href="/net/tcp_test.go.html#7976848">addr</a></span><span class="op" id="7977179">.</span><span class="ident" id="7977180">String</span><span class="op" id="7977186">(</span><span class="op" id="7977187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977192">addr1</span><span class="op" id="7977197">,</span>&nbsp;<span class="ident" id="7977199">err</span>&nbsp;<span class="op" id="7977203">:=</span>&nbsp;<span class="ident" id="7977206"><a href="/net/tcpsock.go.html#1505235">ResolveTCPAddr</a></span><span class="op" id="7977220">(</span><span class="ident" id="7977221"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977223">.</span><span class="ident" id="7977224">net</span><span class="op" id="7977227">,</span>&nbsp;<span class="ident" id="7977229"><a href="/net/tcp_test.go.html#7977168">str</a></span><span class="op" id="7977232">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977237">if</span>&nbsp;<span class="ident" id="7977240"><a href="/net/tcp_test.go.html#7977199">err</a></span>&nbsp;<span class="op" id="7977244">!=</span>&nbsp;<span class="ident" id="7977247">nil</span>&nbsp;<span class="op" id="7977251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977257"><a href="/net/tcp_test.go.html#7976788">t</a></span><span class="op" id="7977258">.</span><span class="ident" id="7977259">Fatalf</span><span class="op" id="7977265">(</span><span class="string" id="7977266">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="7977304">,</span>&nbsp;<span class="ident" id="7977306"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977308">.</span><span class="ident" id="7977309">net</span><span class="op" id="7977312">,</span>&nbsp;<span class="ident" id="7977314"><a href="/net/tcp_test.go.html#7977168">str</a></span><span class="op" id="7977317">,</span>&nbsp;<span class="ident" id="7977319"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977321">.</span><span class="ident" id="7977322">litAddrOrName</span><span class="op" id="7977335">,</span>&nbsp;<span class="ident" id="7977337"><a href="/net/tcp_test.go.html#7977199">err</a></span><span class="op" id="7977340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977350">if</span>&nbsp;<span class="op" id="7977353">!</span><span class="ident" id="7977354"><a href="/net/tcp_test.go.html#7969499">reflect</a></span><span class="op" id="7977361">.</span><span class="ident" id="7977362">DeepEqual</span><span class="op" id="7977371">(</span><span class="ident" id="7977372"><a href="/net/tcp_test.go.html#7977192">addr1</a></span><span class="op" id="7977377">,</span>&nbsp;<span class="ident" id="7977379"><a href="/net/tcp_test.go.html#7976848">addr</a></span><span class="op" id="7977383">)</span>&nbsp;<span class="op" id="7977385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977391"><a href="/net/tcp_test.go.html#7976788">t</a></span><span class="op" id="7977392">.</span><span class="ident" id="7977393">Fatalf</span><span class="op" id="7977399">(</span><span class="string" id="7977400">&#34;ResolveTCPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7977450">,</span>&nbsp;<span class="ident" id="7977452"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977454">.</span><span class="ident" id="7977455">net</span><span class="op" id="7977458">,</span>&nbsp;<span class="ident" id="7977460"><a href="/net/tcp_test.go.html#7977168">str</a></span><span class="op" id="7977463">,</span>&nbsp;<span class="ident" id="7977465"><a href="/net/tcp_test.go.html#7976812">tt</a></span><span class="op" id="7977467">.</span><span class="ident" id="7977468">litAddrOrName</span><span class="op" id="7977481">,</span>&nbsp;<span class="ident" id="7977483"><a href="/net/tcp_test.go.html#7977192">addr1</a></span><span class="op" id="7977488">,</span>&nbsp;<span class="ident" id="7977490"><a href="/net/tcp_test.go.html#7976848">addr</a></span><span class="op" id="7977494">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977506">}</span><br>
<span class="lineno"></span><span class="op" id="7977508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="7977511">var</span>&nbsp;<span class="ident" id="7977515">tcpListenerNameTests</span>&nbsp;<span class="op" id="7977536">=</span>&nbsp;<span class="op" id="7977538">[</span><span class="op" id="7977539">]</span><span class="keyword" id="7977540">struct</span>&nbsp;<span class="op" id="7977547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977550">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7977556">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977564">laddr</span>&nbsp;<span class="op" id="7977570">*</span><span class="ident" id="7977571"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><br>
<span class="lineno"></span><span class="op" id="7977579">}</span><span class="op" id="7977580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977583">{</span><span class="string" id="7977584">&#34;tcp4&#34;</span><span class="op" id="7977590">,</span>&nbsp;<span class="op" id="7977592">&amp;</span><span class="ident" id="7977593"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7977600">{</span><span class="ident" id="7977601">IP</span><span class="op" id="7977603">:</span>&nbsp;<span class="ident" id="7977605"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="7977609">(</span><span class="num" id="7977610">127</span><span class="op" id="7977613">,</span>&nbsp;<span class="num" id="7977615">0</span><span class="op" id="7977616">,</span>&nbsp;<span class="num" id="7977618">0</span><span class="op" id="7977619">,</span>&nbsp;<span class="num" id="7977621">1</span><span class="op" id="7977622">)</span><span class="op" id="7977623">}</span><span class="op" id="7977624">}</span><span class="op" id="7977625">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977628">{</span><span class="string" id="7977629">&#34;tcp4&#34;</span><span class="op" id="7977635">,</span>&nbsp;<span class="op" id="7977637">&amp;</span><span class="ident" id="7977638"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7977645">{</span><span class="op" id="7977646">}</span><span class="op" id="7977647">}</span><span class="op" id="7977648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977651">{</span><span class="string" id="7977652">&#34;tcp4&#34;</span><span class="op" id="7977658">,</span>&nbsp;<span class="ident" id="7977660">nil</span><span class="op" id="7977663">}</span><span class="op" id="7977664">,</span><br>
<span class="lineno"></span><span class="op" id="7977666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7977669">func</span>&nbsp;<span class="ident" id="7977674">TestTCPListenerName</span><span class="op" id="7977693">(</span><span class="ident" id="7977694">t</span>&nbsp;<span class="op" id="7977696">*</span><span class="ident" id="7977697"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7977704">.</span><span class="ident" id="7977705">T</span><span class="op" id="7977706">)</span>&nbsp;<span class="op" id="7977708">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977711">if</span>&nbsp;<span class="ident" id="7977714"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7977721">.</span><span class="ident" id="7977722">Short</span><span class="op" id="7977727">(</span><span class="op" id="7977728">)</span>&nbsp;<span class="op" id="7977730">||</span>&nbsp;<span class="op" id="7977733">!</span><span class="op" id="7977734">*</span><span class="ident" id="7977735"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7977748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977752"><a href="/net/tcp_test.go.html#7977694">t</a></span><span class="op" id="7977753">.</span><span class="ident" id="7977754">Skip</span><span class="op" id="7977758">(</span><span class="string" id="7977759">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7977800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977807">for</span>&nbsp;<span class="ident" id="7977811">_</span><span class="op" id="7977812">,</span>&nbsp;<span class="ident" id="7977814">tt</span>&nbsp;<span class="op" id="7977817">:=</span>&nbsp;<span class="keyword" id="7977820">range</span>&nbsp;<span class="ident" id="7977826"><a href="/net/tcp_test.go.html#7977515">tcpListenerNameTests</a></span>&nbsp;<span class="op" id="7977847">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977851">ln</span><span class="op" id="7977853">,</span>&nbsp;<span class="ident" id="7977855">err</span>&nbsp;<span class="op" id="7977859">:=</span>&nbsp;<span class="ident" id="7977862"><a href="/net/tcpsock_posix.go.html#1514734">ListenTCP</a></span><span class="op" id="7977871">(</span><span class="ident" id="7977872"><a href="/net/tcp_test.go.html#7977814">tt</a></span><span class="op" id="7977874">.</span><span class="ident" id="7977875">net</span><span class="op" id="7977878">,</span>&nbsp;<span class="ident" id="7977880"><a href="/net/tcp_test.go.html#7977814">tt</a></span><span class="op" id="7977882">.</span><span class="ident" id="7977883">laddr</span><span class="op" id="7977888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977892">if</span>&nbsp;<span class="ident" id="7977895"><a href="/net/tcp_test.go.html#7977855">err</a></span>&nbsp;<span class="op" id="7977899">!=</span>&nbsp;<span class="ident" id="7977902">nil</span>&nbsp;<span class="op" id="7977906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977911"><a href="/net/tcp_test.go.html#7977694">t</a></span><span class="op" id="7977912">.</span><span class="ident" id="7977913">Fatalf</span><span class="op" id="7977919">(</span><span class="string" id="7977920">&#34;ListenTCP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7977942">,</span>&nbsp;<span class="ident" id="7977944"><a href="/net/tcp_test.go.html#7977855">err</a></span><span class="op" id="7977947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977955">defer</span>&nbsp;<span class="ident" id="7977961"><a href="/net/tcp_test.go.html#7977851">ln</a></span><span class="op" id="7977963">.</span><span class="ident" id="7977964">Close</span><span class="op" id="7977969">(</span><span class="op" id="7977970">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977974">la</span>&nbsp;<span class="op" id="7977977">:=</span>&nbsp;<span class="ident" id="7977980"><a href="/net/tcp_test.go.html#7977851">ln</a></span><span class="op" id="7977982">.</span><span class="ident" id="7977983">Addr</span><span class="op" id="7977987">(</span><span class="op" id="7977988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977992">if</span>&nbsp;<span class="ident" id="7977995">a</span><span class="op" id="7977996">,</span>&nbsp;<span class="ident" id="7977998">ok</span>&nbsp;<span class="op" id="7978001">:=</span>&nbsp;<span class="ident" id="7978004"><a href="/net/tcp_test.go.html#7977974">la</a></span><span class="op" id="7978006">.</span><span class="op" id="7978007">(</span><span class="op" id="7978008">*</span><span class="ident" id="7978009"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7978016">)</span><span class="op" id="7978017">;</span>&nbsp;<span class="op" id="7978019">!</span><span class="ident" id="7978020"><a href="/net/tcp_test.go.html#7977998">ok</a></span>&nbsp;<span class="op" id="7978023">||</span>&nbsp;<span class="ident" id="7978026"><a href="/net/tcp_test.go.html#7977995">a</a></span><span class="op" id="7978027">.</span><span class="ident" id="7978028">Port</span>&nbsp;<span class="op" id="7978033">==</span>&nbsp;<span class="num" id="7978036">0</span>&nbsp;<span class="op" id="7978038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978043"><a href="/net/tcp_test.go.html#7977694">t</a></span><span class="op" id="7978044">.</span><span class="ident" id="7978045">Fatalf</span><span class="op" id="7978051">(</span><span class="string" id="7978052">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="7978113">,</span>&nbsp;<span class="ident" id="7978115"><a href="/net/tcp_test.go.html#7977974">la</a></span><span class="op" id="7978117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978124">}</span><br>
<span class="lineno">375</span><span class="op" id="7978126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7978129">func</span>&nbsp;<span class="ident" id="7978134">TestIPv6LinkLocalUnicastTCP</span><span class="op" id="7978161">(</span><span class="ident" id="7978162">t</span>&nbsp;<span class="op" id="7978164">*</span><span class="ident" id="7978165"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7978172">.</span><span class="ident" id="7978173">T</span><span class="op" id="7978174">)</span>&nbsp;<span class="op" id="7978176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978179">if</span>&nbsp;<span class="ident" id="7978182"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7978189">.</span><span class="ident" id="7978190">Short</span><span class="op" id="7978195">(</span><span class="op" id="7978196">)</span>&nbsp;<span class="op" id="7978198">||</span>&nbsp;<span class="op" id="7978201">!</span><span class="op" id="7978202">*</span><span class="ident" id="7978203"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7978216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978220"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7978221">.</span><span class="ident" id="7978222">Skip</span><span class="op" id="7978226">(</span><span class="string" id="7978227">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7978268">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978274">if</span>&nbsp;<span class="op" id="7978277">!</span><span class="ident" id="7978278"><a href="/net/ipsock.go.html#1440628">supportsIPv6</a></span>&nbsp;<span class="op" id="7978291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978295"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7978296">.</span><span class="ident" id="7978297">Skip</span><span class="op" id="7978301">(</span><span class="string" id="7978302">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7978325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978331">ifi</span>&nbsp;<span class="op" id="7978335">:=</span>&nbsp;<span class="ident" id="7978338"><a href="/net/interface_test.go.html#7876504">loopbackInterface</a></span><span class="op" id="7978355">(</span><span class="op" id="7978356">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978359">if</span>&nbsp;<span class="ident" id="7978362"><a href="/net/tcp_test.go.html#7978331">ifi</a></span>&nbsp;<span class="op" id="7978366">==</span>&nbsp;<span class="ident" id="7978369">nil</span>&nbsp;<span class="op" id="7978373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978377"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7978378">.</span><span class="ident" id="7978379">Skip</span><span class="op" id="7978383">(</span><span class="string" id="7978384">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="7978414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978420">laddr</span>&nbsp;<span class="op" id="7978426">:=</span>&nbsp;<span class="ident" id="7978429"><a href="/net/interface_test.go.html#7876891">ipv6LinkLocalUnicastAddr</a></span><span class="op" id="7978453">(</span><span class="ident" id="7978454"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7978457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978460">if</span>&nbsp;<span class="ident" id="7978463"><a href="/net/tcp_test.go.html#7978420">laddr</a></span>&nbsp;<span class="op" id="7978469">==</span>&nbsp;<span class="string" id="7978472">&#34;&#34;</span>&nbsp;<span class="op" id="7978475">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978479"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7978480">.</span><span class="ident" id="7978481">Skip</span><span class="op" id="7978485">(</span><span class="string" id="7978486">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="7978530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978537">type</span>&nbsp;<span class="ident" id="7978542">test</span>&nbsp;<span class="keyword" id="7978547">struct</span>&nbsp;<span class="op" id="7978554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978558">net</span><span class="op" id="7978561">,</span>&nbsp;<span class="ident" id="7978563">addr</span>&nbsp;&nbsp;<span class="builtintype" id="7978569">string</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978578">nameLookup</span>&nbsp;<span class="builtintype" id="7978589">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978598">var</span>&nbsp;<span class="ident" id="7978602">tests</span>&nbsp;<span class="op" id="7978608">=</span>&nbsp;<span class="op" id="7978610">[</span><span class="op" id="7978611">]</span><span class="ident" id="7978612"><a href="/net/tcp_test.go.html#7978542">test</a></span><span class="op" id="7978616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978620">{</span><span class="string" id="7978621">&#34;tcp&#34;</span><span class="op" id="7978626">,</span>&nbsp;<span class="string" id="7978628">&#34;[&#34;</span>&nbsp;<span class="op" id="7978632">+</span>&nbsp;<span class="ident" id="7978634"><a href="/net/tcp_test.go.html#7978420">laddr</a></span>&nbsp;<span class="op" id="7978640">+</span>&nbsp;<span class="string" id="7978642">&#34;%&#34;</span>&nbsp;<span class="op" id="7978646">+</span>&nbsp;<span class="ident" id="7978648"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7978651">.</span><span class="ident" id="7978652">Name</span>&nbsp;<span class="op" id="7978657">+</span>&nbsp;<span class="string" id="7978659">&#34;]:0&#34;</span><span class="op" id="7978664">,</span>&nbsp;<span class="builtintype" id="7978666">false</span><span class="op" id="7978671">}</span><span class="op" id="7978672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978676">{</span><span class="string" id="7978677">&#34;tcp6&#34;</span><span class="op" id="7978683">,</span>&nbsp;<span class="string" id="7978685">&#34;[&#34;</span>&nbsp;<span class="op" id="7978689">+</span>&nbsp;<span class="ident" id="7978691"><a href="/net/tcp_test.go.html#7978420">laddr</a></span>&nbsp;<span class="op" id="7978697">+</span>&nbsp;<span class="string" id="7978699">&#34;%&#34;</span>&nbsp;<span class="op" id="7978703">+</span>&nbsp;<span class="ident" id="7978705"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7978708">.</span><span class="ident" id="7978709">Name</span>&nbsp;<span class="op" id="7978714">+</span>&nbsp;<span class="string" id="7978716">&#34;]:0&#34;</span><span class="op" id="7978721">,</span>&nbsp;<span class="builtintype" id="7978723">false</span><span class="op" id="7978728">}</span><span class="op" id="7978729">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978735">switch</span>&nbsp;<span class="ident" id="7978742"><a href="/net/tcp_test.go.html#7969510">runtime</a></span><span class="op" id="7978749">.</span><span class="ident" id="7978750">GOOS</span>&nbsp;<span class="op" id="7978755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978758">case</span>&nbsp;<span class="string" id="7978763">&#34;darwin&#34;</span><span class="op" id="7978771">,</span>&nbsp;<span class="string" id="7978773">&#34;freebsd&#34;</span><span class="op" id="7978782">,</span>&nbsp;<span class="string" id="7978784">&#34;openbsd&#34;</span><span class="op" id="7978793">,</span>&nbsp;<span class="string" id="7978795">&#34;netbsd&#34;</span><span class="op" id="7978803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978807"><a href="/net/tcp_test.go.html#7978602">tests</a></span>&nbsp;<span class="op" id="7978813">=</span>&nbsp;<span class="builtinfunc" id="7978815">append</span><span class="op" id="7978821">(</span><span class="ident" id="7978822"><a href="/net/tcp_test.go.html#7978602">tests</a></span><span class="op" id="7978827">,</span>&nbsp;<span class="op" id="7978829">[</span><span class="op" id="7978830">]</span><span class="ident" id="7978831"><a href="/net/tcp_test.go.html#7978542">test</a></span><span class="op" id="7978835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978840">{</span><span class="string" id="7978841">&#34;tcp&#34;</span><span class="op" id="7978846">,</span>&nbsp;<span class="string" id="7978848">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="7978862">+</span>&nbsp;<span class="ident" id="7978864"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7978867">.</span><span class="ident" id="7978868">Name</span>&nbsp;<span class="op" id="7978873">+</span>&nbsp;<span class="string" id="7978875">&#34;]:0&#34;</span><span class="op" id="7978880">,</span>&nbsp;<span class="builtintype" id="7978882">true</span><span class="op" id="7978886">}</span><span class="op" id="7978887">,</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978892">{</span><span class="string" id="7978893">&#34;tcp6&#34;</span><span class="op" id="7978899">,</span>&nbsp;<span class="string" id="7978901">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="7978915">+</span>&nbsp;<span class="ident" id="7978917"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7978920">.</span><span class="ident" id="7978921">Name</span>&nbsp;<span class="op" id="7978926">+</span>&nbsp;<span class="string" id="7978928">&#34;]:0&#34;</span><span class="op" id="7978933">,</span>&nbsp;<span class="builtintype" id="7978935">true</span><span class="op" id="7978939">}</span><span class="op" id="7978940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978944">}</span><span class="op" id="7978945">...</span><span class="op" id="7978948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978951">case</span>&nbsp;<span class="string" id="7978956">&#34;linux&#34;</span><span class="op" id="7978963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978967"><a href="/net/tcp_test.go.html#7978602">tests</a></span>&nbsp;<span class="op" id="7978973">=</span>&nbsp;<span class="builtinfunc" id="7978975">append</span><span class="op" id="7978981">(</span><span class="ident" id="7978982"><a href="/net/tcp_test.go.html#7978602">tests</a></span><span class="op" id="7978987">,</span>&nbsp;<span class="op" id="7978989">[</span><span class="op" id="7978990">]</span><span class="ident" id="7978991"><a href="/net/tcp_test.go.html#7978542">test</a></span><span class="op" id="7978995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979000">{</span><span class="string" id="7979001">&#34;tcp&#34;</span><span class="op" id="7979006">,</span>&nbsp;<span class="string" id="7979008">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="7979026">+</span>&nbsp;<span class="ident" id="7979028"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7979031">.</span><span class="ident" id="7979032">Name</span>&nbsp;<span class="op" id="7979037">+</span>&nbsp;<span class="string" id="7979039">&#34;]:0&#34;</span><span class="op" id="7979044">,</span>&nbsp;<span class="builtintype" id="7979046">true</span><span class="op" id="7979050">}</span><span class="op" id="7979051">,</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979056">{</span><span class="string" id="7979057">&#34;tcp6&#34;</span><span class="op" id="7979063">,</span>&nbsp;<span class="string" id="7979065">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="7979083">+</span>&nbsp;<span class="ident" id="7979085"><a href="/net/tcp_test.go.html#7978331">ifi</a></span><span class="op" id="7979088">.</span><span class="ident" id="7979089">Name</span>&nbsp;<span class="op" id="7979094">+</span>&nbsp;<span class="string" id="7979096">&#34;]:0&#34;</span><span class="op" id="7979101">,</span>&nbsp;<span class="builtintype" id="7979103">true</span><span class="op" id="7979107">}</span><span class="op" id="7979108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979112">}</span><span class="op" id="7979113">...</span><span class="op" id="7979116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979122">for</span>&nbsp;<span class="ident" id="7979126">_</span><span class="op" id="7979127">,</span>&nbsp;<span class="ident" id="7979129">tt</span>&nbsp;<span class="op" id="7979132">:=</span>&nbsp;<span class="keyword" id="7979135">range</span>&nbsp;<span class="ident" id="7979141"><a href="/net/tcp_test.go.html#7978602">tests</a></span>&nbsp;<span class="op" id="7979147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979151">ln</span><span class="op" id="7979153">,</span>&nbsp;<span class="ident" id="7979155">err</span>&nbsp;<span class="op" id="7979159">:=</span>&nbsp;<span class="ident" id="7979162"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7979168">(</span><span class="ident" id="7979169"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979171">.</span><span class="ident" id="7979172">net</span><span class="op" id="7979175">,</span>&nbsp;<span class="ident" id="7979177"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979179">.</span><span class="ident" id="7979180">addr</span><span class="op" id="7979184">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979188">if</span>&nbsp;<span class="ident" id="7979191"><a href="/net/tcp_test.go.html#7979155">err</a></span>&nbsp;<span class="op" id="7979195">!=</span>&nbsp;<span class="ident" id="7979198">nil</span>&nbsp;<span class="op" id="7979202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979207">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979253">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979302"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979303">.</span><span class="ident" id="7979304">Logf</span><span class="op" id="7979308">(</span><span class="string" id="7979309">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7979328">,</span>&nbsp;<span class="ident" id="7979330"><a href="/net/tcp_test.go.html#7979155">err</a></span><span class="op" id="7979333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979338">continue</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979353">defer</span>&nbsp;<span class="ident" id="7979359"><a href="/net/tcp_test.go.html#7979151">ln</a></span><span class="op" id="7979361">.</span><span class="ident" id="7979362">Close</span><span class="op" id="7979367">(</span><span class="op" id="7979368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979372">if</span>&nbsp;<span class="ident" id="7979375">la</span><span class="op" id="7979377">,</span>&nbsp;<span class="ident" id="7979379">ok</span>&nbsp;<span class="op" id="7979382">:=</span>&nbsp;<span class="ident" id="7979385"><a href="/net/tcp_test.go.html#7979151">ln</a></span><span class="op" id="7979387">.</span><span class="ident" id="7979388">Addr</span><span class="op" id="7979392">(</span><span class="op" id="7979393">)</span><span class="op" id="7979394">.</span><span class="op" id="7979395">(</span><span class="op" id="7979396">*</span><span class="ident" id="7979397"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7979404">)</span><span class="op" id="7979405">;</span>&nbsp;<span class="op" id="7979407">!</span><span class="ident" id="7979408"><a href="/net/tcp_test.go.html#7979379">ok</a></span>&nbsp;<span class="op" id="7979411">||</span>&nbsp;<span class="op" id="7979414">!</span><span class="ident" id="7979415"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979417">.</span><span class="ident" id="7979418">nameLookup</span>&nbsp;<span class="op" id="7979429">&amp;&amp;</span>&nbsp;<span class="ident" id="7979432"><a href="/net/tcp_test.go.html#7979375">la</a></span><span class="op" id="7979434">.</span><span class="ident" id="7979435">Zone</span>&nbsp;<span class="op" id="7979440">==</span>&nbsp;<span class="string" id="7979443">&#34;&#34;</span>&nbsp;<span class="op" id="7979446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979451"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979452">.</span><span class="ident" id="7979453">Fatalf</span><span class="op" id="7979459">(</span><span class="string" id="7979460">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7979516">,</span>&nbsp;<span class="ident" id="7979518"><a href="/net/tcp_test.go.html#7979375">la</a></span><span class="op" id="7979520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979524">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979529">done</span>&nbsp;<span class="op" id="7979534">:=</span>&nbsp;<span class="builtinfunc" id="7979537">make</span><span class="op" id="7979541">(</span><span class="keyword" id="7979542">chan</span>&nbsp;<span class="builtintype" id="7979547">int</span><span class="op" id="7979550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979554">go</span>&nbsp;<span class="ident" id="7979557"><a href="/net/conn_test.go.html#7826187">transponder</a></span><span class="op" id="7979568">(</span><span class="ident" id="7979569"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979570">,</span>&nbsp;<span class="ident" id="7979572"><a href="/net/tcp_test.go.html#7979151">ln</a></span><span class="op" id="7979574">,</span>&nbsp;<span class="ident" id="7979576"><a href="/net/tcp_test.go.html#7979529">done</a></span><span class="op" id="7979580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979585">c</span><span class="op" id="7979586">,</span>&nbsp;<span class="ident" id="7979588"><a href="/net/tcp_test.go.html#7979155">err</a></span>&nbsp;<span class="op" id="7979592">:=</span>&nbsp;<span class="ident" id="7979595"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7979599">(</span><span class="ident" id="7979600"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979602">.</span><span class="ident" id="7979603">net</span><span class="op" id="7979606">,</span>&nbsp;<span class="ident" id="7979608"><a href="/net/tcp_test.go.html#7979151">ln</a></span><span class="op" id="7979610">.</span><span class="ident" id="7979611">Addr</span><span class="op" id="7979615">(</span><span class="op" id="7979616">)</span><span class="op" id="7979617">.</span><span class="ident" id="7979618">String</span><span class="op" id="7979624">(</span><span class="op" id="7979625">)</span><span class="op" id="7979626">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979630">if</span>&nbsp;<span class="ident" id="7979633"><a href="/net/tcp_test.go.html#7979155">err</a></span>&nbsp;<span class="op" id="7979637">!=</span>&nbsp;<span class="ident" id="7979640">nil</span>&nbsp;<span class="op" id="7979644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979649"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979650">.</span><span class="ident" id="7979651">Fatalf</span><span class="op" id="7979657">(</span><span class="string" id="7979658">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7979675">,</span>&nbsp;<span class="ident" id="7979677"><a href="/net/tcp_test.go.html#7979155">err</a></span><span class="op" id="7979680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979688">defer</span>&nbsp;<span class="ident" id="7979694"><a href="/net/tcp_test.go.html#7979585">c</a></span><span class="op" id="7979695">.</span><span class="ident" id="7979696">Close</span><span class="op" id="7979701">(</span><span class="op" id="7979702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979706">if</span>&nbsp;<span class="ident" id="7979709">la</span><span class="op" id="7979711">,</span>&nbsp;<span class="ident" id="7979713">ok</span>&nbsp;<span class="op" id="7979716">:=</span>&nbsp;<span class="ident" id="7979719"><a href="/net/tcp_test.go.html#7979585">c</a></span><span class="op" id="7979720">.</span><span class="ident" id="7979721">LocalAddr</span><span class="op" id="7979730">(</span><span class="op" id="7979731">)</span><span class="op" id="7979732">.</span><span class="op" id="7979733">(</span><span class="op" id="7979734">*</span><span class="ident" id="7979735"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7979742">)</span><span class="op" id="7979743">;</span>&nbsp;<span class="op" id="7979745">!</span><span class="ident" id="7979746"><a href="/net/tcp_test.go.html#7979713">ok</a></span>&nbsp;<span class="op" id="7979749">||</span>&nbsp;<span class="op" id="7979752">!</span><span class="ident" id="7979753"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979755">.</span><span class="ident" id="7979756">nameLookup</span>&nbsp;<span class="op" id="7979767">&amp;&amp;</span>&nbsp;<span class="ident" id="7979770"><a href="/net/tcp_test.go.html#7979709">la</a></span><span class="op" id="7979772">.</span><span class="ident" id="7979773">Zone</span>&nbsp;<span class="op" id="7979778">==</span>&nbsp;<span class="string" id="7979781">&#34;&#34;</span>&nbsp;<span class="op" id="7979784">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979789"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979790">.</span><span class="ident" id="7979791">Fatalf</span><span class="op" id="7979797">(</span><span class="string" id="7979798">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7979854">,</span>&nbsp;<span class="ident" id="7979856"><a href="/net/tcp_test.go.html#7979709">la</a></span><span class="op" id="7979858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979866">if</span>&nbsp;<span class="ident" id="7979869">ra</span><span class="op" id="7979871">,</span>&nbsp;<span class="ident" id="7979873">ok</span>&nbsp;<span class="op" id="7979876">:=</span>&nbsp;<span class="ident" id="7979879"><a href="/net/tcp_test.go.html#7979585">c</a></span><span class="op" id="7979880">.</span><span class="ident" id="7979881">RemoteAddr</span><span class="op" id="7979891">(</span><span class="op" id="7979892">)</span><span class="op" id="7979893">.</span><span class="op" id="7979894">(</span><span class="op" id="7979895">*</span><span class="ident" id="7979896"><a href="/net/tcpsock.go.html#1504387">TCPAddr</a></span><span class="op" id="7979903">)</span><span class="op" id="7979904">;</span>&nbsp;<span class="op" id="7979906">!</span><span class="ident" id="7979907"><a href="/net/tcp_test.go.html#7979873">ok</a></span>&nbsp;<span class="op" id="7979910">||</span>&nbsp;<span class="op" id="7979913">!</span><span class="ident" id="7979914"><a href="/net/tcp_test.go.html#7979129">tt</a></span><span class="op" id="7979916">.</span><span class="ident" id="7979917">nameLookup</span>&nbsp;<span class="op" id="7979928">&amp;&amp;</span>&nbsp;<span class="ident" id="7979931"><a href="/net/tcp_test.go.html#7979869">ra</a></span><span class="op" id="7979933">.</span><span class="ident" id="7979934">Zone</span>&nbsp;<span class="op" id="7979939">==</span>&nbsp;<span class="string" id="7979942">&#34;&#34;</span>&nbsp;<span class="op" id="7979945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979950"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7979951">.</span><span class="ident" id="7979952">Fatalf</span><span class="op" id="7979958">(</span><span class="string" id="7979959">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="7980015">,</span>&nbsp;<span class="ident" id="7980017"><a href="/net/tcp_test.go.html#7979869">ra</a></span><span class="op" id="7980019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980023">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980028">if</span>&nbsp;<span class="ident" id="7980031">_</span><span class="op" id="7980032">,</span>&nbsp;<span class="ident" id="7980034">err</span>&nbsp;<span class="op" id="7980038">:=</span>&nbsp;<span class="ident" id="7980041"><a href="/net/tcp_test.go.html#7979585">c</a></span><span class="op" id="7980042">.</span><span class="ident" id="7980043">Write</span><span class="op" id="7980048">(</span><span class="op" id="7980049">[</span><span class="op" id="7980050">]</span><span class="builtintype" id="7980051">byte</span><span class="op" id="7980055">(</span><span class="string" id="7980056">&#34;TCP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="7980086">)</span><span class="op" id="7980087">)</span><span class="op" id="7980088">;</span>&nbsp;<span class="ident" id="7980090"><a href="/net/tcp_test.go.html#7980034">err</a></span>&nbsp;<span class="op" id="7980094">!=</span>&nbsp;<span class="ident" id="7980097">nil</span>&nbsp;<span class="op" id="7980101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980106"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7980107">.</span><span class="ident" id="7980108">Fatalf</span><span class="op" id="7980114">(</span><span class="string" id="7980115">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7980138">,</span>&nbsp;<span class="ident" id="7980140"><a href="/net/tcp_test.go.html#7980034">err</a></span><span class="op" id="7980143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980151">b</span>&nbsp;<span class="op" id="7980153">:=</span>&nbsp;<span class="builtinfunc" id="7980156">make</span><span class="op" id="7980160">(</span><span class="op" id="7980161">[</span><span class="op" id="7980162">]</span><span class="builtintype" id="7980163">byte</span><span class="op" id="7980167">,</span>&nbsp;<span class="num" id="7980169">32</span><span class="op" id="7980171">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980175">if</span>&nbsp;<span class="ident" id="7980178">_</span><span class="op" id="7980179">,</span>&nbsp;<span class="ident" id="7980181">err</span>&nbsp;<span class="op" id="7980185">:=</span>&nbsp;<span class="ident" id="7980188"><a href="/net/tcp_test.go.html#7979585">c</a></span><span class="op" id="7980189">.</span><span class="ident" id="7980190">Read</span><span class="op" id="7980194">(</span><span class="ident" id="7980195"><a href="/net/tcp_test.go.html#7980151">b</a></span><span class="op" id="7980196">)</span><span class="op" id="7980197">;</span>&nbsp;<span class="ident" id="7980199"><a href="/net/tcp_test.go.html#7980181">err</a></span>&nbsp;<span class="op" id="7980203">!=</span>&nbsp;<span class="ident" id="7980206">nil</span>&nbsp;<span class="op" id="7980210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980215"><a href="/net/tcp_test.go.html#7978162">t</a></span><span class="op" id="7980216">.</span><span class="ident" id="7980217">Fatalf</span><span class="op" id="7980223">(</span><span class="string" id="7980224">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7980246">,</span>&nbsp;<span class="ident" id="7980248"><a href="/net/tcp_test.go.html#7980181">err</a></span><span class="op" id="7980251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980260">&lt;-</span><span class="ident" id="7980262"><a href="/net/tcp_test.go.html#7979529">done</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980268">}</span><br>
<span class="lineno"></span><span class="op" id="7980270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980273">func</span>&nbsp;<span class="ident" id="7980278">TestTCPConcurrentAccept</span><span class="op" id="7980301">(</span><span class="ident" id="7980302">t</span>&nbsp;<span class="op" id="7980304">*</span><span class="ident" id="7980305"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7980312">.</span><span class="ident" id="7980313">T</span><span class="op" id="7980314">)</span>&nbsp;<span class="op" id="7980316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980319">defer</span>&nbsp;<span class="ident" id="7980325"><a href="/net/tcp_test.go.html#7969510">runtime</a></span><span class="op" id="7980332">.</span><span class="ident" id="7980333">GOMAXPROCS</span><span class="op" id="7980343">(</span><span class="ident" id="7980344"><a href="/net/tcp_test.go.html#7969510">runtime</a></span><span class="op" id="7980351">.</span><span class="ident" id="7980352">GOMAXPROCS</span><span class="op" id="7980362">(</span><span class="num" id="7980363">4</span><span class="op" id="7980364">)</span><span class="op" id="7980365">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980368">ln</span><span class="op" id="7980370">,</span>&nbsp;<span class="ident" id="7980372">err</span>&nbsp;<span class="op" id="7980376">:=</span>&nbsp;<span class="ident" id="7980379"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7980385">(</span><span class="string" id="7980386">&#34;tcp&#34;</span><span class="op" id="7980391">,</span>&nbsp;<span class="string" id="7980393">&#34;127.0.0.1:0&#34;</span><span class="op" id="7980406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980409">if</span>&nbsp;<span class="ident" id="7980412"><a href="/net/tcp_test.go.html#7980372">err</a></span>&nbsp;<span class="op" id="7980416">!=</span>&nbsp;<span class="ident" id="7980419">nil</span>&nbsp;<span class="op" id="7980423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980427"><a href="/net/tcp_test.go.html#7980302">t</a></span><span class="op" id="7980428">.</span><span class="ident" id="7980429">Fatalf</span><span class="op" id="7980435">(</span><span class="string" id="7980436">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7980455">,</span>&nbsp;<span class="ident" id="7980457"><a href="/net/tcp_test.go.html#7980372">err</a></span><span class="op" id="7980460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980466">const</span>&nbsp;<span class="ident" id="7980472">N</span>&nbsp;<span class="op" id="7980474">=</span>&nbsp;<span class="num" id="7980476">10</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980480">var</span>&nbsp;<span class="ident" id="7980484">wg</span>&nbsp;<span class="ident" id="7980487"><a href="/net/tcp_test.go.html#7969521">sync</a></span><span class="op" id="7980491">.</span><span class="ident" id="7980492">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980503"><a href="/net/tcp_test.go.html#7980484">wg</a></span><span class="op" id="7980505">.</span><span class="ident" id="7980506">Add</span><span class="op" id="7980509">(</span><span class="ident" id="7980510"><a href="/net/tcp_test.go.html#7980472">N</a></span><span class="op" id="7980511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980514">for</span>&nbsp;<span class="ident" id="7980518">i</span>&nbsp;<span class="op" id="7980520">:=</span>&nbsp;<span class="num" id="7980523">0</span><span class="op" id="7980524">;</span>&nbsp;<span class="ident" id="7980526"><a href="/net/tcp_test.go.html#7980518">i</a></span>&nbsp;<span class="op" id="7980528">&lt;</span>&nbsp;<span class="ident" id="7980530"><a href="/net/tcp_test.go.html#7980472">N</a></span><span class="op" id="7980531">;</span>&nbsp;<span class="ident" id="7980533"><a href="/net/tcp_test.go.html#7980518">i</a></span><span class="op" id="7980534">++</span>&nbsp;<span class="op" id="7980537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980541">go</span>&nbsp;<span class="keyword" id="7980544">func</span><span class="op" id="7980548">(</span><span class="op" id="7980549">)</span>&nbsp;<span class="op" id="7980551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980556">for</span>&nbsp;<span class="op" id="7980560">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980566">c</span><span class="op" id="7980567">,</span>&nbsp;<span class="ident" id="7980569">err</span>&nbsp;<span class="op" id="7980573">:=</span>&nbsp;<span class="ident" id="7980576"><a href="/net/tcp_test.go.html#7980368">ln</a></span><span class="op" id="7980578">.</span><span class="ident" id="7980579">Accept</span><span class="op" id="7980585">(</span><span class="op" id="7980586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980592">if</span>&nbsp;<span class="ident" id="7980595"><a href="/net/tcp_test.go.html#7980569">err</a></span>&nbsp;<span class="op" id="7980599">!=</span>&nbsp;<span class="ident" id="7980602">nil</span>&nbsp;<span class="op" id="7980606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980613">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980629"><a href="/net/tcp_test.go.html#7980566">c</a></span><span class="op" id="7980630">.</span><span class="ident" id="7980631">Close</span><span class="op" id="7980636">(</span><span class="op" id="7980637">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980647"><a href="/net/tcp_test.go.html#7980484">wg</a></span><span class="op" id="7980649">.</span><span class="ident" id="7980650">Done</span><span class="op" id="7980654">(</span><span class="op" id="7980655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980659">}</span><span class="op" id="7980660">(</span><span class="op" id="7980661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980667">attempts</span>&nbsp;<span class="op" id="7980676">:=</span>&nbsp;<span class="num" id="7980679">10</span>&nbsp;<span class="op" id="7980682">*</span>&nbsp;<span class="ident" id="7980684"><a href="/net/tcp_test.go.html#7980472">N</a></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980687">fails</span>&nbsp;<span class="op" id="7980693">:=</span>&nbsp;<span class="num" id="7980696">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980699">d</span>&nbsp;<span class="op" id="7980701">:=</span>&nbsp;<span class="op" id="7980704">&amp;</span><span class="ident" id="7980705"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="7980711">{</span><span class="ident" id="7980712">Timeout</span><span class="op" id="7980719">:</span>&nbsp;<span class="num" id="7980721">200</span>&nbsp;<span class="op" id="7980725">*</span>&nbsp;<span class="ident" id="7980727"><a href="/net/tcp_test.go.html#7969540">time</a></span><span class="op" id="7980731">.</span><span class="ident" id="7980732">Millisecond</span><span class="op" id="7980743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980746">for</span>&nbsp;<span class="ident" id="7980750">i</span>&nbsp;<span class="op" id="7980752">:=</span>&nbsp;<span class="num" id="7980755">0</span><span class="op" id="7980756">;</span>&nbsp;<span class="ident" id="7980758"><a href="/net/tcp_test.go.html#7980750">i</a></span>&nbsp;<span class="op" id="7980760">&lt;</span>&nbsp;<span class="ident" id="7980762"><a href="/net/tcp_test.go.html#7980667">attempts</a></span><span class="op" id="7980770">;</span>&nbsp;<span class="ident" id="7980772"><a href="/net/tcp_test.go.html#7980750">i</a></span><span class="op" id="7980773">++</span>&nbsp;<span class="op" id="7980776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980780">c</span><span class="op" id="7980781">,</span>&nbsp;<span class="ident" id="7980783">err</span>&nbsp;<span class="op" id="7980787">:=</span>&nbsp;<span class="ident" id="7980790"><a href="/net/tcp_test.go.html#7980699">d</a></span><span class="op" id="7980791">.</span><span class="ident" id="7980792">Dial</span><span class="op" id="7980796">(</span><span class="string" id="7980797">&#34;tcp&#34;</span><span class="op" id="7980802">,</span>&nbsp;<span class="ident" id="7980804"><a href="/net/tcp_test.go.html#7980368">ln</a></span><span class="op" id="7980806">.</span><span class="ident" id="7980807">Addr</span><span class="op" id="7980811">(</span><span class="op" id="7980812">)</span><span class="op" id="7980813">.</span><span class="ident" id="7980814">String</span><span class="op" id="7980820">(</span><span class="op" id="7980821">)</span><span class="op" id="7980822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980826">if</span>&nbsp;<span class="ident" id="7980829"><a href="/net/tcp_test.go.html#7980783">err</a></span>&nbsp;<span class="op" id="7980833">!=</span>&nbsp;<span class="ident" id="7980836">nil</span>&nbsp;<span class="op" id="7980840">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980845"><a href="/net/tcp_test.go.html#7980687">fails</a></span><span class="op" id="7980850">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980855">}</span>&nbsp;<span class="keyword" id="7980857">else</span>&nbsp;<span class="op" id="7980862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980867"><a href="/net/tcp_test.go.html#7980780">c</a></span><span class="op" id="7980868">.</span><span class="ident" id="7980869">Close</span><span class="op" id="7980874">(</span><span class="op" id="7980875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980882">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980885"><a href="/net/tcp_test.go.html#7980368">ln</a></span><span class="op" id="7980887">.</span><span class="ident" id="7980888">Close</span><span class="op" id="7980893">(</span><span class="op" id="7980894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980897"><a href="/net/tcp_test.go.html#7980484">wg</a></span><span class="op" id="7980899">.</span><span class="ident" id="7980900">Wait</span><span class="op" id="7980904">(</span><span class="op" id="7980905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980908">if</span>&nbsp;<span class="ident" id="7980911"><a href="/net/tcp_test.go.html#7980687">fails</a></span>&nbsp;<span class="op" id="7980917">&gt;</span>&nbsp;<span class="ident" id="7980919"><a href="/net/tcp_test.go.html#7980667">attempts</a></span><span class="op" id="7980927">/</span><span class="num" id="7980928">9</span>&nbsp;<span class="op" id="7980930">{</span>&nbsp;<span class="comment" id="7980932">//&nbsp;see&nbsp;issues&nbsp;7400&nbsp;and&nbsp;7541</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980962"><a href="/net/tcp_test.go.html#7980302">t</a></span><span class="op" id="7980963">.</span><span class="ident" id="7980964">Fatalf</span><span class="op" id="7980970">(</span><span class="string" id="7980971">&#34;too&nbsp;many&nbsp;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7980997">,</span>&nbsp;<span class="ident" id="7980999"><a href="/net/tcp_test.go.html#7980687">fails</a></span><span class="op" id="7981004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981007">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981010">if</span>&nbsp;<span class="ident" id="7981013"><a href="/net/tcp_test.go.html#7980687">fails</a></span>&nbsp;<span class="op" id="7981019">&gt;</span>&nbsp;<span class="num" id="7981021">0</span>&nbsp;<span class="op" id="7981023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981027"><a href="/net/tcp_test.go.html#7980302">t</a></span><span class="op" id="7981028">.</span><span class="ident" id="7981029">Logf</span><span class="op" id="7981033">(</span><span class="string" id="7981034">&#34;#&nbsp;of&nbsp;failed&nbsp;Dials:&nbsp;%v&#34;</span><span class="op" id="7981057">,</span>&nbsp;<span class="ident" id="7981059"><a href="/net/tcp_test.go.html#7980687">fails</a></span><span class="op" id="7981064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981067">}</span><br>
<span class="lineno"></span><span class="op" id="7981069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="keyword" id="7981072">func</span>&nbsp;<span class="ident" id="7981077">TestTCPReadWriteMallocs</span><span class="op" id="7981100">(</span><span class="ident" id="7981101">t</span>&nbsp;<span class="op" id="7981103">*</span><span class="ident" id="7981104"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7981111">.</span><span class="ident" id="7981112">T</span><span class="op" id="7981113">)</span>&nbsp;<span class="op" id="7981115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981118">if</span>&nbsp;<span class="ident" id="7981121"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7981128">.</span><span class="ident" id="7981129">Short</span><span class="op" id="7981134">(</span><span class="op" id="7981135">)</span>&nbsp;<span class="op" id="7981137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981141"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981142">.</span><span class="ident" id="7981143">Skip</span><span class="op" id="7981147">(</span><span class="string" id="7981148">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7981185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981191">ln</span><span class="op" id="7981193">,</span>&nbsp;<span class="ident" id="7981195">err</span>&nbsp;<span class="op" id="7981199">:=</span>&nbsp;<span class="ident" id="7981202"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7981208">(</span><span class="string" id="7981209">&#34;tcp&#34;</span><span class="op" id="7981214">,</span>&nbsp;<span class="string" id="7981216">&#34;127.0.0.1:0&#34;</span><span class="op" id="7981229">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981232">if</span>&nbsp;<span class="ident" id="7981235"><a href="/net/tcp_test.go.html#7981195">err</a></span>&nbsp;<span class="op" id="7981239">!=</span>&nbsp;<span class="ident" id="7981242">nil</span>&nbsp;<span class="op" id="7981246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981250"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981251">.</span><span class="ident" id="7981252">Fatalf</span><span class="op" id="7981258">(</span><span class="string" id="7981259">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7981278">,</span>&nbsp;<span class="ident" id="7981280"><a href="/net/tcp_test.go.html#7981195">err</a></span><span class="op" id="7981283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981289">defer</span>&nbsp;<span class="ident" id="7981295"><a href="/net/tcp_test.go.html#7981191">ln</a></span><span class="op" id="7981297">.</span><span class="ident" id="7981298">Close</span><span class="op" id="7981303">(</span><span class="op" id="7981304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981307">var</span>&nbsp;<span class="ident" id="7981311">server</span>&nbsp;<span class="ident" id="7981318"><a href="/net/net.go.html#1465335">Conn</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981324">errc</span>&nbsp;<span class="op" id="7981329">:=</span>&nbsp;<span class="builtinfunc" id="7981332">make</span><span class="op" id="7981336">(</span><span class="keyword" id="7981337">chan</span>&nbsp;<span class="builtintype" id="7981342">error</span><span class="op" id="7981347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981350">go</span>&nbsp;<span class="keyword" id="7981353">func</span><span class="op" id="7981357">(</span><span class="op" id="7981358">)</span>&nbsp;<span class="op" id="7981360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981364">var</span>&nbsp;<span class="ident" id="7981368">err</span>&nbsp;<span class="builtintype" id="7981372">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981380"><a href="/net/tcp_test.go.html#7981311">server</a></span><span class="op" id="7981386">,</span>&nbsp;<span class="ident" id="7981388"><a href="/net/tcp_test.go.html#7981368">err</a></span>&nbsp;<span class="op" id="7981392">=</span>&nbsp;<span class="ident" id="7981394"><a href="/net/tcp_test.go.html#7981191">ln</a></span><span class="op" id="7981396">.</span><span class="ident" id="7981397">Accept</span><span class="op" id="7981403">(</span><span class="op" id="7981404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981408"><a href="/net/tcp_test.go.html#7981324">errc</a></span>&nbsp;<span class="op" id="7981413">&lt;-</span>&nbsp;<span class="ident" id="7981416"><a href="/net/tcp_test.go.html#7981368">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981421">}</span><span class="op" id="7981422">(</span><span class="op" id="7981423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981426">client</span><span class="op" id="7981432">,</span>&nbsp;<span class="ident" id="7981434"><a href="/net/tcp_test.go.html#7981195">err</a></span>&nbsp;<span class="op" id="7981438">:=</span>&nbsp;<span class="ident" id="7981441"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7981445">(</span><span class="string" id="7981446">&#34;tcp&#34;</span><span class="op" id="7981451">,</span>&nbsp;<span class="ident" id="7981453"><a href="/net/tcp_test.go.html#7981191">ln</a></span><span class="op" id="7981455">.</span><span class="ident" id="7981456">Addr</span><span class="op" id="7981460">(</span><span class="op" id="7981461">)</span><span class="op" id="7981462">.</span><span class="ident" id="7981463">String</span><span class="op" id="7981469">(</span><span class="op" id="7981470">)</span><span class="op" id="7981471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981474">if</span>&nbsp;<span class="ident" id="7981477"><a href="/net/tcp_test.go.html#7981195">err</a></span>&nbsp;<span class="op" id="7981481">!=</span>&nbsp;<span class="ident" id="7981484">nil</span>&nbsp;<span class="op" id="7981488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981492"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981493">.</span><span class="ident" id="7981494">Fatalf</span><span class="op" id="7981500">(</span><span class="string" id="7981501">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7981518">,</span>&nbsp;<span class="ident" id="7981520"><a href="/net/tcp_test.go.html#7981195">err</a></span><span class="op" id="7981523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981526">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981529">if</span>&nbsp;<span class="ident" id="7981532">err</span>&nbsp;<span class="op" id="7981536">:=</span>&nbsp;<span class="op" id="7981539">&lt;-</span><span class="ident" id="7981541"><a href="/net/tcp_test.go.html#7981324">errc</a></span><span class="op" id="7981545">;</span>&nbsp;<span class="ident" id="7981547"><a href="/net/tcp_test.go.html#7981532">err</a></span>&nbsp;<span class="op" id="7981551">!=</span>&nbsp;<span class="ident" id="7981554">nil</span>&nbsp;<span class="op" id="7981558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981562"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981563">.</span><span class="ident" id="7981564">Fatalf</span><span class="op" id="7981570">(</span><span class="string" id="7981571">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7981590">,</span>&nbsp;<span class="ident" id="7981592"><a href="/net/tcp_test.go.html#7981532">err</a></span><span class="op" id="7981595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981601">defer</span>&nbsp;<span class="ident" id="7981607"><a href="/net/tcp_test.go.html#7981311">server</a></span><span class="op" id="7981613">.</span><span class="ident" id="7981614">Close</span><span class="op" id="7981619">(</span><span class="op" id="7981620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981623">var</span>&nbsp;<span class="ident" id="7981627">buf</span>&nbsp;<span class="op" id="7981631">[</span><span class="num" id="7981632">128</span><span class="op" id="7981635">]</span><span class="builtintype" id="7981636">byte</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981642">mallocs</span>&nbsp;<span class="op" id="7981650">:=</span>&nbsp;<span class="ident" id="7981653"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7981660">.</span><span class="ident" id="7981661">AllocsPerRun</span><span class="op" id="7981673">(</span><span class="num" id="7981674">1000</span><span class="op" id="7981678">,</span>&nbsp;<span class="keyword" id="7981680">func</span><span class="op" id="7981684">(</span><span class="op" id="7981685">)</span>&nbsp;<span class="op" id="7981687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981691">_</span><span class="op" id="7981692">,</span>&nbsp;<span class="ident" id="7981694">err</span>&nbsp;<span class="op" id="7981698">:=</span>&nbsp;<span class="ident" id="7981701"><a href="/net/tcp_test.go.html#7981311">server</a></span><span class="op" id="7981707">.</span><span class="ident" id="7981708">Write</span><span class="op" id="7981713">(</span><span class="ident" id="7981714"><a href="/net/tcp_test.go.html#7981627">buf</a></span><span class="op" id="7981717">[</span><span class="op" id="7981718">:</span><span class="op" id="7981719">]</span><span class="op" id="7981720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981724">if</span>&nbsp;<span class="ident" id="7981727"><a href="/net/tcp_test.go.html#7981694">err</a></span>&nbsp;<span class="op" id="7981731">!=</span>&nbsp;<span class="ident" id="7981734">nil</span>&nbsp;<span class="op" id="7981738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981743"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981744">.</span><span class="ident" id="7981745">Fatalf</span><span class="op" id="7981751">(</span><span class="string" id="7981752">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7981770">,</span>&nbsp;<span class="ident" id="7981772"><a href="/net/tcp_test.go.html#7981694">err</a></span><span class="op" id="7981775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981779">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981783">_</span><span class="op" id="7981784">,</span>&nbsp;<span class="ident" id="7981786"><a href="/net/tcp_test.go.html#7981694">err</a></span>&nbsp;<span class="op" id="7981790">=</span>&nbsp;<span class="ident" id="7981792"><a href="/net/tcp_test.go.html#7969493">io</a></span><span class="op" id="7981794">.</span><span class="ident" id="7981795">ReadFull</span><span class="op" id="7981803">(</span><span class="ident" id="7981804"><a href="/net/tcp_test.go.html#7981426">client</a></span><span class="op" id="7981810">,</span>&nbsp;<span class="ident" id="7981812"><a href="/net/tcp_test.go.html#7981627">buf</a></span><span class="op" id="7981815">[</span><span class="op" id="7981816">:</span><span class="op" id="7981817">]</span><span class="op" id="7981818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981822">if</span>&nbsp;<span class="ident" id="7981825"><a href="/net/tcp_test.go.html#7981694">err</a></span>&nbsp;<span class="op" id="7981829">!=</span>&nbsp;<span class="ident" id="7981832">nil</span>&nbsp;<span class="op" id="7981836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981841"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981842">.</span><span class="ident" id="7981843">Fatalf</span><span class="op" id="7981849">(</span><span class="string" id="7981850">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7981867">,</span>&nbsp;<span class="ident" id="7981869"><a href="/net/tcp_test.go.html#7981694">err</a></span><span class="op" id="7981872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981879">}</span><span class="op" id="7981880">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981883">if</span>&nbsp;<span class="ident" id="7981886"><a href="/net/tcp_test.go.html#7981642">mallocs</a></span>&nbsp;<span class="op" id="7981894">&gt;</span>&nbsp;<span class="num" id="7981896">0</span>&nbsp;<span class="op" id="7981898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981902"><a href="/net/tcp_test.go.html#7981101">t</a></span><span class="op" id="7981903">.</span><span class="ident" id="7981904">Fatalf</span><span class="op" id="7981910">(</span><span class="string" id="7981911">&#34;Got&nbsp;%v&nbsp;allocs,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7981934">,</span>&nbsp;<span class="ident" id="7981936"><a href="/net/tcp_test.go.html#7981642">mallocs</a></span><span class="op" id="7981943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981946">}</span><br>
<span class="lineno"></span><span class="op" id="7981948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="7981951">func</span>&nbsp;<span class="ident" id="7981956">TestTCPStress</span><span class="op" id="7981969">(</span><span class="ident" id="7981970">t</span>&nbsp;<span class="op" id="7981972">*</span><span class="ident" id="7981973"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7981980">.</span><span class="ident" id="7981981">T</span><span class="op" id="7981982">)</span>&nbsp;<span class="op" id="7981984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981987">const</span>&nbsp;<span class="ident" id="7981993">conns</span>&nbsp;<span class="op" id="7981999">=</span>&nbsp;<span class="num" id="7982001">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982004">const</span>&nbsp;<span class="ident" id="7982010">msgLen</span>&nbsp;<span class="op" id="7982017">=</span>&nbsp;<span class="num" id="7982019">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982024">msgs</span>&nbsp;<span class="op" id="7982029">:=</span>&nbsp;<span class="builtintype" id="7982032">int</span><span class="op" id="7982035">(</span><span class="num" id="7982036">1e4</span><span class="op" id="7982039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982042">if</span>&nbsp;<span class="ident" id="7982045"><a href="/net/tcp_test.go.html#7969529">testing</a></span><span class="op" id="7982052">.</span><span class="ident" id="7982053">Short</span><span class="op" id="7982058">(</span><span class="op" id="7982059">)</span>&nbsp;<span class="op" id="7982061">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982065"><a href="/net/tcp_test.go.html#7982024">msgs</a></span>&nbsp;<span class="op" id="7982070">=</span>&nbsp;<span class="num" id="7982072">1e2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982081">sendMsg</span>&nbsp;<span class="op" id="7982089">:=</span>&nbsp;<span class="keyword" id="7982092">func</span><span class="op" id="7982096">(</span><span class="ident" id="7982097">c</span>&nbsp;<span class="ident" id="7982099"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7982103">,</span>&nbsp;<span class="ident" id="7982105">buf</span>&nbsp;<span class="op" id="7982109">[</span><span class="op" id="7982110">]</span><span class="builtintype" id="7982111">byte</span><span class="op" id="7982115">)</span>&nbsp;<span class="builtintype" id="7982117">bool</span>&nbsp;<span class="op" id="7982122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982126">n</span><span class="op" id="7982127">,</span>&nbsp;<span class="ident" id="7982129">err</span>&nbsp;<span class="op" id="7982133">:=</span>&nbsp;<span class="ident" id="7982136"><a href="/net/tcp_test.go.html#7982097">c</a></span><span class="op" id="7982137">.</span><span class="ident" id="7982138">Write</span><span class="op" id="7982143">(</span><span class="ident" id="7982144"><a href="/net/tcp_test.go.html#7982105">buf</a></span><span class="op" id="7982147">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982151">if</span>&nbsp;<span class="ident" id="7982154"><a href="/net/tcp_test.go.html#7982126">n</a></span>&nbsp;<span class="op" id="7982156">!=</span>&nbsp;<span class="builtinfunc" id="7982159">len</span><span class="op" id="7982162">(</span><span class="ident" id="7982163"><a href="/net/tcp_test.go.html#7982105">buf</a></span><span class="op" id="7982166">)</span>&nbsp;<span class="op" id="7982168">||</span>&nbsp;<span class="ident" id="7982171"><a href="/net/tcp_test.go.html#7982129">err</a></span>&nbsp;<span class="op" id="7982175">!=</span>&nbsp;<span class="ident" id="7982178">nil</span>&nbsp;<span class="op" id="7982182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982187"><a href="/net/tcp_test.go.html#7981970">t</a></span><span class="op" id="7982188">.</span><span class="ident" id="7982189">Logf</span><span class="op" id="7982193">(</span><span class="string" id="7982194">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7982212">,</span>&nbsp;<span class="ident" id="7982214"><a href="/net/tcp_test.go.html#7982129">err</a></span><span class="op" id="7982217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982222">return</span>&nbsp;<span class="builtintype" id="7982229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982241">return</span>&nbsp;<span class="builtintype" id="7982248">true</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982257">recvMsg</span>&nbsp;<span class="op" id="7982265">:=</span>&nbsp;<span class="keyword" id="7982268">func</span><span class="op" id="7982272">(</span><span class="ident" id="7982273">c</span>&nbsp;<span class="ident" id="7982275"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7982279">,</span>&nbsp;<span class="ident" id="7982281">buf</span>&nbsp;<span class="op" id="7982285">[</span><span class="op" id="7982286">]</span><span class="builtintype" id="7982287">byte</span><span class="op" id="7982291">)</span>&nbsp;<span class="builtintype" id="7982293">bool</span>&nbsp;<span class="op" id="7982298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982302">for</span>&nbsp;<span class="ident" id="7982306">read</span>&nbsp;<span class="op" id="7982311">:=</span>&nbsp;<span class="num" id="7982314">0</span><span class="op" id="7982315">;</span>&nbsp;<span class="ident" id="7982317"><a href="/net/tcp_test.go.html#7982306">read</a></span>&nbsp;<span class="op" id="7982322">!=</span>&nbsp;<span class="builtinfunc" id="7982325">len</span><span class="op" id="7982328">(</span><span class="ident" id="7982329"><a href="/net/tcp_test.go.html#7982281">buf</a></span><span class="op" id="7982332">)</span><span class="op" id="7982333">;</span>&nbsp;<span class="op" id="7982335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982340">n</span><span class="op" id="7982341">,</span>&nbsp;<span class="ident" id="7982343">err</span>&nbsp;<span class="op" id="7982347">:=</span>&nbsp;<span class="ident" id="7982350"><a href="/net/tcp_test.go.html#7982273">c</a></span><span class="op" id="7982351">.</span><span class="ident" id="7982352">Read</span><span class="op" id="7982356">(</span><span class="ident" id="7982357"><a href="/net/tcp_test.go.html#7982281">buf</a></span><span class="op" id="7982360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982365"><a href="/net/tcp_test.go.html#7982306">read</a></span>&nbsp;<span class="op" id="7982370">+=</span>&nbsp;<span class="ident" id="7982373"><a href="/net/tcp_test.go.html#7982340">n</a></span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982378">if</span>&nbsp;<span class="ident" id="7982381"><a href="/net/tcp_test.go.html#7982343">err</a></span>&nbsp;<span class="op" id="7982385">!=</span>&nbsp;<span class="ident" id="7982388">nil</span>&nbsp;<span class="op" id="7982392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982398"><a href="/net/tcp_test.go.html#7981970">t</a></span><span class="op" id="7982399">.</span><span class="ident" id="7982400">Logf</span><span class="op" id="7982404">(</span><span class="string" id="7982405">&#34;Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7982422">,</span>&nbsp;<span class="ident" id="7982424"><a href="/net/tcp_test.go.html#7982343">err</a></span><span class="op" id="7982427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982433">return</span>&nbsp;<span class="builtintype" id="7982440">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982453">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982457">return</span>&nbsp;<span class="builtintype" id="7982464">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982474">ln</span><span class="op" id="7982476">,</span>&nbsp;<span class="ident" id="7982478">err</span>&nbsp;<span class="op" id="7982482">:=</span>&nbsp;<span class="ident" id="7982485"><a href="/net/dial.go.html#1338035">Listen</a></span><span class="op" id="7982491">(</span><span class="string" id="7982492">&#34;tcp&#34;</span><span class="op" id="7982497">,</span>&nbsp;<span class="string" id="7982499">&#34;127.0.0.1:0&#34;</span><span class="op" id="7982512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982515">if</span>&nbsp;<span class="ident" id="7982518"><a href="/net/tcp_test.go.html#7982478">err</a></span>&nbsp;<span class="op" id="7982522">!=</span>&nbsp;<span class="ident" id="7982525">nil</span>&nbsp;<span class="op" id="7982529">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982533"><a href="/net/tcp_test.go.html#7981970">t</a></span><span class="op" id="7982534">.</span><span class="ident" id="7982535">Fatalf</span><span class="op" id="7982541">(</span><span class="string" id="7982542">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7982561">,</span>&nbsp;<span class="ident" id="7982563"><a href="/net/tcp_test.go.html#7982478">err</a></span><span class="op" id="7982566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982572">defer</span>&nbsp;<span class="ident" id="7982578"><a href="/net/tcp_test.go.html#7982474">ln</a></span><span class="op" id="7982580">.</span><span class="ident" id="7982581">Close</span><span class="op" id="7982586">(</span><span class="op" id="7982587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982590">//&nbsp;Acceptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982604">go</span>&nbsp;<span class="keyword" id="7982607">func</span><span class="op" id="7982611">(</span><span class="op" id="7982612">)</span>&nbsp;<span class="op" id="7982614">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982618">for</span>&nbsp;<span class="op" id="7982622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982627">c</span><span class="op" id="7982628">,</span>&nbsp;<span class="ident" id="7982630">err</span>&nbsp;<span class="op" id="7982634">:=</span>&nbsp;<span class="ident" id="7982637"><a href="/net/tcp_test.go.html#7982474">ln</a></span><span class="op" id="7982639">.</span><span class="ident" id="7982640">Accept</span><span class="op" id="7982646">(</span><span class="op" id="7982647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982652">if</span>&nbsp;<span class="ident" id="7982655"><a href="/net/tcp_test.go.html#7982630">err</a></span>&nbsp;<span class="op" id="7982659">!=</span>&nbsp;<span class="ident" id="7982662">nil</span>&nbsp;<span class="op" id="7982666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982672">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982681">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982686">//&nbsp;Server&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982711">go</span>&nbsp;<span class="keyword" id="7982714">func</span><span class="op" id="7982718">(</span><span class="ident" id="7982719">c</span>&nbsp;<span class="ident" id="7982721"><a href="/net/net.go.html#1465335">Conn</a></span><span class="op" id="7982725">)</span>&nbsp;<span class="op" id="7982727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982733">defer</span>&nbsp;<span class="ident" id="7982739"><a href="/net/tcp_test.go.html#7982719">c</a></span><span class="op" id="7982740">.</span><span class="ident" id="7982741">Close</span><span class="op" id="7982746">(</span><span class="op" id="7982747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982753">var</span>&nbsp;<span class="ident" id="7982757">buf</span>&nbsp;<span class="op" id="7982761">[</span><span class="ident" id="7982762"><a href="/net/tcp_test.go.html#7982010">msgLen</a></span><span class="op" id="7982768">]</span><span class="builtintype" id="7982769">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982778">for</span>&nbsp;<span class="ident" id="7982782">m</span>&nbsp;<span class="op" id="7982784">:=</span>&nbsp;<span class="num" id="7982787">0</span><span class="op" id="7982788">;</span>&nbsp;<span class="ident" id="7982790"><a href="/net/tcp_test.go.html#7982782">m</a></span>&nbsp;<span class="op" id="7982792">&lt;</span>&nbsp;<span class="ident" id="7982794"><a href="/net/tcp_test.go.html#7982024">msgs</a></span><span class="op" id="7982798">;</span>&nbsp;<span class="ident" id="7982800"><a href="/net/tcp_test.go.html#7982782">m</a></span><span class="op" id="7982801">++</span>&nbsp;<span class="op" id="7982804">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982811">if</span>&nbsp;<span class="op" id="7982814">!</span><span class="ident" id="7982815"><a href="/net/tcp_test.go.html#7982257">recvMsg</a></span><span class="op" id="7982822">(</span><span class="ident" id="7982823"><a href="/net/tcp_test.go.html#7982719">c</a></span><span class="op" id="7982824">,</span>&nbsp;<span class="ident" id="7982826"><a href="/net/tcp_test.go.html#7982757">buf</a></span><span class="op" id="7982829">[</span><span class="op" id="7982830">:</span><span class="op" id="7982831">]</span><span class="op" id="7982832">)</span>&nbsp;<span class="op" id="7982834">||</span>&nbsp;<span class="op" id="7982837">!</span><span class="ident" id="7982838"><a href="/net/tcp_test.go.html#7982081">sendMsg</a></span><span class="op" id="7982845">(</span><span class="ident" id="7982846"><a href="/net/tcp_test.go.html#7982719">c</a></span><span class="op" id="7982847">,</span>&nbsp;<span class="ident" id="7982849"><a href="/net/tcp_test.go.html#7982757">buf</a></span><span class="op" id="7982852">[</span><span class="op" id="7982853">:</span><span class="op" id="7982854">]</span><span class="op" id="7982855">)</span>&nbsp;<span class="op" id="7982857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982865">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982887">}</span><span class="op" id="7982888">(</span><span class="ident" id="7982889"><a href="/net/tcp_test.go.html#7982627">c</a></span><span class="op" id="7982890">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982897">}</span><span class="op" id="7982898">(</span><span class="op" id="7982899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982902">done</span>&nbsp;<span class="op" id="7982907">:=</span>&nbsp;<span class="builtinfunc" id="7982910">make</span><span class="op" id="7982914">(</span><span class="keyword" id="7982915">chan</span>&nbsp;<span class="builtintype" id="7982920">bool</span><span class="op" id="7982924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982927">for</span>&nbsp;<span class="ident" id="7982931">i</span>&nbsp;<span class="op" id="7982933">:=</span>&nbsp;<span class="num" id="7982936">0</span><span class="op" id="7982937">;</span>&nbsp;<span class="ident" id="7982939"><a href="/net/tcp_test.go.html#7982931">i</a></span>&nbsp;<span class="op" id="7982941">&lt;</span>&nbsp;<span class="ident" id="7982943"><a href="/net/tcp_test.go.html#7981993">conns</a></span><span class="op" id="7982948">;</span>&nbsp;<span class="ident" id="7982950"><a href="/net/tcp_test.go.html#7982931">i</a></span><span class="op" id="7982951">++</span>&nbsp;<span class="op" id="7982954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982958">//&nbsp;Client&nbsp;connection.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982982">go</span>&nbsp;<span class="keyword" id="7982985">func</span><span class="op" id="7982989">(</span><span class="op" id="7982990">)</span>&nbsp;<span class="op" id="7982992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982997">defer</span>&nbsp;<span class="keyword" id="7983003">func</span><span class="op" id="7983007">(</span><span class="op" id="7983008">)</span>&nbsp;<span class="op" id="7983010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983016"><a href="/net/tcp_test.go.html#7982902">done</a></span>&nbsp;<span class="op" id="7983021">&lt;-</span>&nbsp;<span class="builtintype" id="7983024">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983032">}</span><span class="op" id="7983033">(</span><span class="op" id="7983034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983039">c</span><span class="op" id="7983040">,</span>&nbsp;<span class="ident" id="7983042">err</span>&nbsp;<span class="op" id="7983046">:=</span>&nbsp;<span class="ident" id="7983049"><a href="/net/dial.go.html#1334377">Dial</a></span><span class="op" id="7983053">(</span><span class="string" id="7983054">&#34;tcp&#34;</span><span class="op" id="7983059">,</span>&nbsp;<span class="ident" id="7983061"><a href="/net/tcp_test.go.html#7982474">ln</a></span><span class="op" id="7983063">.</span><span class="ident" id="7983064">Addr</span><span class="op" id="7983068">(</span><span class="op" id="7983069">)</span><span class="op" id="7983070">.</span><span class="ident" id="7983071">String</span><span class="op" id="7983077">(</span><span class="op" id="7983078">)</span><span class="op" id="7983079">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983084">if</span>&nbsp;<span class="ident" id="7983087"><a href="/net/tcp_test.go.html#7983042">err</a></span>&nbsp;<span class="op" id="7983091">!=</span>&nbsp;<span class="ident" id="7983094">nil</span>&nbsp;<span class="op" id="7983098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983104"><a href="/net/tcp_test.go.html#7981970">t</a></span><span class="op" id="7983105">.</span><span class="ident" id="7983106">Logf</span><span class="op" id="7983110">(</span><span class="string" id="7983111">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7983128">,</span>&nbsp;<span class="ident" id="7983130"><a href="/net/tcp_test.go.html#7983042">err</a></span><span class="op" id="7983133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983154">defer</span>&nbsp;<span class="ident" id="7983160"><a href="/net/tcp_test.go.html#7983039">c</a></span><span class="op" id="7983161">.</span><span class="ident" id="7983162">Close</span><span class="op" id="7983167">(</span><span class="op" id="7983168">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983173">var</span>&nbsp;<span class="ident" id="7983177">buf</span>&nbsp;<span class="op" id="7983181">[</span><span class="ident" id="7983182"><a href="/net/tcp_test.go.html#7982010">msgLen</a></span><span class="op" id="7983188">]</span><span class="builtintype" id="7983189">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983197">for</span>&nbsp;<span class="ident" id="7983201">m</span>&nbsp;<span class="op" id="7983203">:=</span>&nbsp;<span class="num" id="7983206">0</span><span class="op" id="7983207">;</span>&nbsp;<span class="ident" id="7983209"><a href="/net/tcp_test.go.html#7983201">m</a></span>&nbsp;<span class="op" id="7983211">&lt;</span>&nbsp;<span class="ident" id="7983213"><a href="/net/tcp_test.go.html#7982024">msgs</a></span><span class="op" id="7983217">;</span>&nbsp;<span class="ident" id="7983219"><a href="/net/tcp_test.go.html#7983201">m</a></span><span class="op" id="7983220">++</span>&nbsp;<span class="op" id="7983223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983229">if</span>&nbsp;<span class="op" id="7983232">!</span><span class="ident" id="7983233"><a href="/net/tcp_test.go.html#7982081">sendMsg</a></span><span class="op" id="7983240">(</span><span class="ident" id="7983241"><a href="/net/tcp_test.go.html#7983039">c</a></span><span class="op" id="7983242">,</span>&nbsp;<span class="ident" id="7983244"><a href="/net/tcp_test.go.html#7983177">buf</a></span><span class="op" id="7983247">[</span><span class="op" id="7983248">:</span><span class="op" id="7983249">]</span><span class="op" id="7983250">)</span>&nbsp;<span class="op" id="7983252">||</span>&nbsp;<span class="op" id="7983255">!</span><span class="ident" id="7983256"><a href="/net/tcp_test.go.html#7982257">recvMsg</a></span><span class="op" id="7983263">(</span><span class="ident" id="7983264"><a href="/net/tcp_test.go.html#7983039">c</a></span><span class="op" id="7983265">,</span>&nbsp;<span class="ident" id="7983267"><a href="/net/tcp_test.go.html#7983177">buf</a></span><span class="op" id="7983270">[</span><span class="op" id="7983271">:</span><span class="op" id="7983272">]</span><span class="op" id="7983273">)</span>&nbsp;<span class="op" id="7983275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983282">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983292">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983301">}</span><span class="op" id="7983302">(</span><span class="op" id="7983303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983309">for</span>&nbsp;<span class="ident" id="7983313">i</span>&nbsp;<span class="op" id="7983315">:=</span>&nbsp;<span class="num" id="7983318">0</span><span class="op" id="7983319">;</span>&nbsp;<span class="ident" id="7983321"><a href="/net/tcp_test.go.html#7983313">i</a></span>&nbsp;<span class="op" id="7983323">&lt;</span>&nbsp;<span class="ident" id="7983325"><a href="/net/tcp_test.go.html#7981993">conns</a></span><span class="op" id="7983330">;</span>&nbsp;<span class="ident" id="7983332"><a href="/net/tcp_test.go.html#7983313">i</a></span><span class="op" id="7983333">++</span>&nbsp;<span class="op" id="7983336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983340">&lt;-</span><span class="ident" id="7983342"><a href="/net/tcp_test.go.html#7982902">done</a></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983348">}</span><br>
<span class="lineno"></span><span class="op" id="7983350">}</span>
</div>
</body>
</html>
