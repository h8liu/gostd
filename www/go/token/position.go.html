<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5932194">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5932249">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5932303">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5932354">package</span>&nbsp;<span class="ident" id="5932362">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5932369">import</span>&nbsp;<span class="op" id="5932376">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5932379">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5932386">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5932394">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5932401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5932404">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5932485">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5932499">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5932550">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="5932600">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5932650">//</span><br>
<span class="lineno">20</span><span class="keyword" id="5932653">type</span>&nbsp;<span class="ident" id="5932658">Position</span>&nbsp;<span class="keyword" id="5932667">struct</span>&nbsp;<span class="op" id="5932674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932677">Filename</span>&nbsp;<span class="builtintype" id="5932686">string</span>&nbsp;<span class="comment" id="5932693">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932714">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5932723">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5932730">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932756">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5932765">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5932772">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5932803">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5932812">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5932819">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="5932869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5932872">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5932922">func</span>&nbsp;<span class="op" id="5932927">(</span><span class="ident" id="5932928">pos</span>&nbsp;<span class="op" id="5932932">*</span><span class="ident" id="5932933"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5932941">)</span>&nbsp;<span class="ident" id="5932943">IsValid</span><span class="op" id="5932950">(</span><span class="op" id="5932951">)</span>&nbsp;<span class="builtintype" id="5932953">bool</span>&nbsp;<span class="op" id="5932958">{</span>&nbsp;<span class="keyword" id="5932960">return</span>&nbsp;<span class="ident" id="5932967"><a href="/go/token/position.go.html#5932928">pos</a></span><span class="op" id="5932970">.</span><span class="ident" id="5932971">Line</span>&nbsp;<span class="op" id="5932976">&gt;</span>&nbsp;<span class="num" id="5932978">0</span>&nbsp;<span class="op" id="5932980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5932983">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="5933035">//</span><br>
<span class="lineno"></span><span class="comment" id="5933038">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5933091">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5933147">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5933202">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5933260">//</span><br>
<span class="lineno"></span><span class="keyword" id="5933263">func</span>&nbsp;<span class="op" id="5933268">(</span><span class="ident" id="5933269">pos</span>&nbsp;<span class="ident" id="5933273"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5933281">)</span>&nbsp;<span class="ident" id="5933283">String</span><span class="op" id="5933289">(</span><span class="op" id="5933290">)</span>&nbsp;<span class="builtintype" id="5933292">string</span>&nbsp;<span class="op" id="5933299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933302">s</span>&nbsp;<span class="op" id="5933304">:=</span>&nbsp;<span class="ident" id="5933307"><a href="/go/token/position.go.html#5933269">pos</a></span><span class="op" id="5933310">.</span><span class="ident" id="5933311">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933321">if</span>&nbsp;<span class="ident" id="5933324"><a href="/go/token/position.go.html#5933269">pos</a></span><span class="op" id="5933327">.</span><span class="ident" id="5933328">IsValid</span><span class="op" id="5933335">(</span><span class="op" id="5933336">)</span>&nbsp;<span class="op" id="5933338">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933342">if</span>&nbsp;<span class="ident" id="5933345"><a href="/go/token/position.go.html#5933302">s</a></span>&nbsp;<span class="op" id="5933347">!=</span>&nbsp;<span class="string" id="5933350">&#34;&#34;</span>&nbsp;<span class="op" id="5933353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933358"><a href="/go/token/position.go.html#5933302">s</a></span>&nbsp;<span class="op" id="5933360">+=</span>&nbsp;<span class="string" id="5933363">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933373"><a href="/go/token/position.go.html#5933302">s</a></span>&nbsp;<span class="op" id="5933375">+=</span>&nbsp;<span class="ident" id="5933378"><a href="/go/token/position.go.html#5932379">fmt</a></span><span class="op" id="5933381">.</span><span class="ident" id="5933382">Sprintf</span><span class="op" id="5933389">(</span><span class="string" id="5933390">&#34;%d:%d&#34;</span><span class="op" id="5933397">,</span>&nbsp;<span class="ident" id="5933399"><a href="/go/token/position.go.html#5933269">pos</a></span><span class="op" id="5933402">.</span><span class="ident" id="5933403">Line</span><span class="op" id="5933407">,</span>&nbsp;<span class="ident" id="5933409"><a href="/go/token/position.go.html#5933269">pos</a></span><span class="op" id="5933412">.</span><span class="ident" id="5933413">Column</span><span class="op" id="5933419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933422">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933425">if</span>&nbsp;<span class="ident" id="5933428"><a href="/go/token/position.go.html#5933302">s</a></span>&nbsp;<span class="op" id="5933430">==</span>&nbsp;<span class="string" id="5933433">&#34;&#34;</span>&nbsp;<span class="op" id="5933436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5933440"><a href="/go/token/position.go.html#5933302">s</a></span>&nbsp;<span class="op" id="5933442">=</span>&nbsp;<span class="string" id="5933444">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5933449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5933452">return</span>&nbsp;<span class="ident" id="5933459"><a href="/go/token/position.go.html#5933302">s</a></span><br>
<span class="lineno"></span><span class="op" id="5933461">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5933464">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5933533">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="5933604">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="5933631">//</span><br>
<span class="lineno">55</span><span class="comment" id="5933634">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="5933712">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5933790">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="5933802">//</span><br>
<span class="lineno"></span><span class="comment" id="5933805">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="5933872">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="5933941">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="5934010">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5934079">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="5934120">//</span><br>
<span class="lineno">65</span><span class="comment" id="5934123">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="5934199">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5934271">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="5934345">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5934421">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="5934481">//</span><br>
<span class="lineno"></span><span class="keyword" id="5934484">type</span>&nbsp;<span class="ident" id="5934489">Pos</span>&nbsp;<span class="builtintype" id="5934493">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934498">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5934572">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="5934643">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5934713">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="5934758">//</span><br>
<span class="lineno"></span><span class="keyword" id="5934761">const</span>&nbsp;<span class="ident" id="5934767">NoPos</span>&nbsp;<span class="ident" id="5934773"><a href="/go/token/position.go.html#5934489">Pos</a></span>&nbsp;<span class="op" id="5934777">=</span>&nbsp;<span class="num" id="5934779">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5934782">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5934832">func</span>&nbsp;<span class="op" id="5934837">(</span><span class="ident" id="5934838">p</span>&nbsp;<span class="ident" id="5934840"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5934843">)</span>&nbsp;<span class="ident" id="5934845">IsValid</span><span class="op" id="5934852">(</span><span class="op" id="5934853">)</span>&nbsp;<span class="builtintype" id="5934855">bool</span>&nbsp;<span class="op" id="5934860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5934863">return</span>&nbsp;<span class="ident" id="5934870"><a href="/go/token/position.go.html#5934838">p</a></span>&nbsp;<span class="op" id="5934872">!=</span>&nbsp;<span class="ident" id="5934875"><a href="/go/token/position.go.html#5934767">NoPos</a></span><br>
<span class="lineno"></span><span class="op" id="5934881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5934884">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5934965">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934974">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="5935031">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="5935082">//</span><br>
<span class="lineno"></span><span class="keyword" id="5935085">type</span>&nbsp;<span class="ident" id="5935090">File</span>&nbsp;<span class="keyword" id="5935095">struct</span>&nbsp;<span class="op" id="5935102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935105">set</span>&nbsp;&nbsp;<span class="op" id="5935110">*</span><span class="ident" id="5935111"><a href="/go/token/position.go.html#5942060">FileSet</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935120">name</span>&nbsp;<span class="builtintype" id="5935125">string</span>&nbsp;<span class="comment" id="5935132">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935169">base</span>&nbsp;<span class="builtintype" id="5935174">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935181">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935237">size</span>&nbsp;<span class="builtintype" id="5935242">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935249">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5935287">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935334">lines</span>&nbsp;<span class="op" id="5935340">[</span><span class="op" id="5935341">]</span><span class="builtintype" id="5935342">int</span>&nbsp;<span class="comment" id="5935346">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935443">infos</span>&nbsp;<span class="op" id="5935449">[</span><span class="op" id="5935450">]</span><span class="ident" id="5935451"><a href="/go/token/position.go.html#5938606">lineInfo</a></span><br>
<span class="lineno">100</span><span class="op" id="5935460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935463">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5935531">func</span>&nbsp;<span class="op" id="5935536">(</span><span class="ident" id="5935537">f</span>&nbsp;<span class="op" id="5935539">*</span><span class="ident" id="5935540"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5935544">)</span>&nbsp;<span class="ident" id="5935546">Name</span><span class="op" id="5935550">(</span><span class="op" id="5935551">)</span>&nbsp;<span class="builtintype" id="5935553">string</span>&nbsp;<span class="op" id="5935560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935563">return</span>&nbsp;<span class="ident" id="5935570"><a href="/go/token/position.go.html#5935537">f</a></span><span class="op" id="5935571">.</span><span class="ident" id="5935572">name</span><br>
<span class="lineno">105</span><span class="op" id="5935577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935580">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5935650">func</span>&nbsp;<span class="op" id="5935655">(</span><span class="ident" id="5935656">f</span>&nbsp;<span class="op" id="5935658">*</span><span class="ident" id="5935659"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5935663">)</span>&nbsp;<span class="ident" id="5935665">Base</span><span class="op" id="5935669">(</span><span class="op" id="5935670">)</span>&nbsp;<span class="builtintype" id="5935672">int</span>&nbsp;<span class="op" id="5935676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935679">return</span>&nbsp;<span class="ident" id="5935686"><a href="/go/token/position.go.html#5935656">f</a></span><span class="op" id="5935687">.</span><span class="ident" id="5935688">base</span><br>
<span class="lineno">110</span><span class="op" id="5935693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935696">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5935759">func</span>&nbsp;<span class="op" id="5935764">(</span><span class="ident" id="5935765">f</span>&nbsp;<span class="op" id="5935767">*</span><span class="ident" id="5935768"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5935772">)</span>&nbsp;<span class="ident" id="5935774">Size</span><span class="op" id="5935778">(</span><span class="op" id="5935779">)</span>&nbsp;<span class="builtintype" id="5935781">int</span>&nbsp;<span class="op" id="5935785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935788">return</span>&nbsp;<span class="ident" id="5935795"><a href="/go/token/position.go.html#5935765">f</a></span><span class="op" id="5935796">.</span><span class="ident" id="5935797">size</span><br>
<span class="lineno">115</span><span class="op" id="5935802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5935805">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5935857">func</span>&nbsp;<span class="op" id="5935862">(</span><span class="ident" id="5935863">f</span>&nbsp;<span class="op" id="5935865">*</span><span class="ident" id="5935866"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5935870">)</span>&nbsp;<span class="ident" id="5935872">LineCount</span><span class="op" id="5935881">(</span><span class="op" id="5935882">)</span>&nbsp;<span class="builtintype" id="5935884">int</span>&nbsp;<span class="op" id="5935888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935891"><a href="/go/token/position.go.html#5935863">f</a></span><span class="op" id="5935892">.</span><span class="ident" id="5935893">set</span><span class="op" id="5935896">.</span><span class="ident" id="5935897">mutex</span><span class="op" id="5935902">.</span><span class="ident" id="5935903">RLock</span><span class="op" id="5935908">(</span><span class="op" id="5935909">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935912">n</span>&nbsp;<span class="op" id="5935914">:=</span>&nbsp;<span class="builtinfunc" id="5935917">len</span><span class="op" id="5935920">(</span><span class="ident" id="5935921"><a href="/go/token/position.go.html#5935863">f</a></span><span class="op" id="5935922">.</span><span class="ident" id="5935923">lines</span><span class="op" id="5935928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5935931"><a href="/go/token/position.go.html#5935863">f</a></span><span class="op" id="5935932">.</span><span class="ident" id="5935933">set</span><span class="op" id="5935936">.</span><span class="ident" id="5935937">mutex</span><span class="op" id="5935942">.</span><span class="ident" id="5935943">RUnlock</span><span class="op" id="5935950">(</span><span class="op" id="5935951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5935954">return</span>&nbsp;<span class="ident" id="5935961"><a href="/go/token/position.go.html#5935912">n</a></span><br>
<span class="lineno"></span><span class="op" id="5935963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5935966">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5936014">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5936086">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5936159">//</span><br>
<span class="lineno"></span><span class="keyword" id="5936162">func</span>&nbsp;<span class="op" id="5936167">(</span><span class="ident" id="5936168">f</span>&nbsp;<span class="op" id="5936170">*</span><span class="ident" id="5936171"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5936175">)</span>&nbsp;<span class="ident" id="5936177">AddLine</span><span class="op" id="5936184">(</span><span class="ident" id="5936185">offset</span>&nbsp;<span class="builtintype" id="5936192">int</span><span class="op" id="5936195">)</span>&nbsp;<span class="op" id="5936197">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936200"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936201">.</span><span class="ident" id="5936202">set</span><span class="op" id="5936205">.</span><span class="ident" id="5936206">mutex</span><span class="op" id="5936211">.</span><span class="ident" id="5936212">Lock</span><span class="op" id="5936216">(</span><span class="op" id="5936217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936220">if</span>&nbsp;<span class="ident" id="5936223">i</span>&nbsp;<span class="op" id="5936225">:=</span>&nbsp;<span class="builtinfunc" id="5936228">len</span><span class="op" id="5936231">(</span><span class="ident" id="5936232"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936233">.</span><span class="ident" id="5936234">lines</span><span class="op" id="5936239">)</span><span class="op" id="5936240">;</span>&nbsp;<span class="op" id="5936242">(</span><span class="ident" id="5936243"><a href="/go/token/position.go.html#5936223">i</a></span>&nbsp;<span class="op" id="5936245">==</span>&nbsp;<span class="num" id="5936248">0</span>&nbsp;<span class="op" id="5936250">||</span>&nbsp;<span class="ident" id="5936253"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936254">.</span><span class="ident" id="5936255">lines</span><span class="op" id="5936260">[</span><span class="ident" id="5936261"><a href="/go/token/position.go.html#5936223">i</a></span><span class="op" id="5936262">-</span><span class="num" id="5936263">1</span><span class="op" id="5936264">]</span>&nbsp;<span class="op" id="5936266">&lt;</span>&nbsp;<span class="ident" id="5936268"><a href="/go/token/position.go.html#5936185">offset</a></span><span class="op" id="5936274">)</span>&nbsp;<span class="op" id="5936276">&amp;&amp;</span>&nbsp;<span class="ident" id="5936279"><a href="/go/token/position.go.html#5936185">offset</a></span>&nbsp;<span class="op" id="5936286">&lt;</span>&nbsp;<span class="ident" id="5936288"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936289">.</span><span class="ident" id="5936290">size</span>&nbsp;<span class="op" id="5936295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936299"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936300">.</span><span class="ident" id="5936301">lines</span>&nbsp;<span class="op" id="5936307">=</span>&nbsp;<span class="builtinfunc" id="5936309">append</span><span class="op" id="5936315">(</span><span class="ident" id="5936316"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936317">.</span><span class="ident" id="5936318">lines</span><span class="op" id="5936323">,</span>&nbsp;<span class="ident" id="5936325"><a href="/go/token/position.go.html#5936185">offset</a></span><span class="op" id="5936331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936337"><a href="/go/token/position.go.html#5936168">f</a></span><span class="op" id="5936338">.</span><span class="ident" id="5936339">set</span><span class="op" id="5936342">.</span><span class="ident" id="5936343">mutex</span><span class="op" id="5936348">.</span><span class="ident" id="5936349">Unlock</span><span class="op" id="5936355">(</span><span class="op" id="5936356">)</span><br>
<span class="lineno">135</span><span class="op" id="5936358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5936361">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="5936437">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5936517">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="5936595">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="5936652">//</span><br>
<span class="lineno"></span><span class="keyword" id="5936655">func</span>&nbsp;<span class="op" id="5936660">(</span><span class="ident" id="5936661">f</span>&nbsp;<span class="op" id="5936663">*</span><span class="ident" id="5936664"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5936668">)</span>&nbsp;<span class="ident" id="5936670">MergeLine</span><span class="op" id="5936679">(</span><span class="ident" id="5936680">line</span>&nbsp;<span class="builtintype" id="5936685">int</span><span class="op" id="5936688">)</span>&nbsp;<span class="op" id="5936690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936693">if</span>&nbsp;<span class="ident" id="5936696"><a href="/go/token/position.go.html#5936680">line</a></span>&nbsp;<span class="op" id="5936701">&lt;=</span>&nbsp;<span class="num" id="5936704">0</span>&nbsp;<span class="op" id="5936706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5936710">panic</span><span class="op" id="5936715">(</span><span class="string" id="5936716">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="5936766">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5936772"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5936773">.</span><span class="ident" id="5936774">set</span><span class="op" id="5936777">.</span><span class="ident" id="5936778">mutex</span><span class="op" id="5936783">.</span><span class="ident" id="5936784">Lock</span><span class="op" id="5936788">(</span><span class="op" id="5936789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936792">defer</span>&nbsp;<span class="ident" id="5936798"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5936799">.</span><span class="ident" id="5936800">set</span><span class="op" id="5936803">.</span><span class="ident" id="5936804">mutex</span><span class="op" id="5936809">.</span><span class="ident" id="5936810">Unlock</span><span class="op" id="5936816">(</span><span class="op" id="5936817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5936820">if</span>&nbsp;<span class="ident" id="5936823"><a href="/go/token/position.go.html#5936680">line</a></span>&nbsp;<span class="op" id="5936828">&gt;=</span>&nbsp;<span class="builtinfunc" id="5936831">len</span><span class="op" id="5936834">(</span><span class="ident" id="5936835"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5936836">.</span><span class="ident" id="5936837">lines</span><span class="op" id="5936842">)</span>&nbsp;<span class="op" id="5936844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5936848">panic</span><span class="op" id="5936853">(</span><span class="string" id="5936854">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="5936875">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5936878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936881">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5936952">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937019">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937087">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937160">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5937206">copy</span><span class="op" id="5937210">(</span><span class="ident" id="5937211"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5937212">.</span><span class="ident" id="5937213">lines</span><span class="op" id="5937218">[</span><span class="ident" id="5937219"><a href="/go/token/position.go.html#5936680">line</a></span><span class="op" id="5937223">:</span><span class="op" id="5937224">]</span><span class="op" id="5937225">,</span>&nbsp;<span class="ident" id="5937227"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5937228">.</span><span class="ident" id="5937229">lines</span><span class="op" id="5937234">[</span><span class="ident" id="5937235"><a href="/go/token/position.go.html#5936680">line</a></span><span class="op" id="5937239">+</span><span class="num" id="5937240">1</span><span class="op" id="5937241">:</span><span class="op" id="5937242">]</span><span class="op" id="5937243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937246"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5937247">.</span><span class="ident" id="5937248">lines</span>&nbsp;<span class="op" id="5937254">=</span>&nbsp;<span class="ident" id="5937256"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5937257">.</span><span class="ident" id="5937258">lines</span><span class="op" id="5937263">[</span><span class="op" id="5937264">:</span><span class="builtinfunc" id="5937265">len</span><span class="op" id="5937268">(</span><span class="ident" id="5937269"><a href="/go/token/position.go.html#5936661">f</a></span><span class="op" id="5937270">.</span><span class="ident" id="5937271">lines</span><span class="op" id="5937276">)</span><span class="op" id="5937277">-</span><span class="num" id="5937278">1</span><span class="op" id="5937279">]</span><br>
<span class="lineno"></span><span class="op" id="5937281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5937284">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="5937361">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="5937434">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="5937505">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="5937554">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="5937627">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5937699">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5937709">//</span><br>
<span class="lineno"></span><span class="keyword" id="5937712">func</span>&nbsp;<span class="op" id="5937717">(</span><span class="ident" id="5937718">f</span>&nbsp;<span class="op" id="5937720">*</span><span class="ident" id="5937721"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5937725">)</span>&nbsp;<span class="ident" id="5937727">SetLines</span><span class="op" id="5937735">(</span><span class="ident" id="5937736">lines</span>&nbsp;<span class="op" id="5937742">[</span><span class="op" id="5937743">]</span><span class="builtintype" id="5937744">int</span><span class="op" id="5937747">)</span>&nbsp;<span class="builtintype" id="5937749">bool</span>&nbsp;<span class="op" id="5937754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937757">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937792">size</span>&nbsp;<span class="op" id="5937797">:=</span>&nbsp;<span class="ident" id="5937800"><a href="/go/token/position.go.html#5937718">f</a></span><span class="op" id="5937801">.</span><span class="ident" id="5937802">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937808">for</span>&nbsp;<span class="ident" id="5937812">i</span><span class="op" id="5937813">,</span>&nbsp;<span class="ident" id="5937815">offset</span>&nbsp;<span class="op" id="5937822">:=</span>&nbsp;<span class="keyword" id="5937825">range</span>&nbsp;<span class="ident" id="5937831"><a href="/go/token/position.go.html#5937736">lines</a></span>&nbsp;<span class="op" id="5937837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937841">if</span>&nbsp;<span class="ident" id="5937844"><a href="/go/token/position.go.html#5937812">i</a></span>&nbsp;<span class="op" id="5937846">&gt;</span>&nbsp;<span class="num" id="5937848">0</span>&nbsp;<span class="op" id="5937850">&amp;&amp;</span>&nbsp;<span class="ident" id="5937853"><a href="/go/token/position.go.html#5937815">offset</a></span>&nbsp;<span class="op" id="5937860">&lt;=</span>&nbsp;<span class="ident" id="5937863"><a href="/go/token/position.go.html#5937736">lines</a></span><span class="op" id="5937868">[</span><span class="ident" id="5937869"><a href="/go/token/position.go.html#5937812">i</a></span><span class="op" id="5937870">-</span><span class="num" id="5937871">1</span><span class="op" id="5937872">]</span>&nbsp;<span class="op" id="5937874">||</span>&nbsp;<span class="ident" id="5937877"><a href="/go/token/position.go.html#5937792">size</a></span>&nbsp;<span class="op" id="5937882">&lt;=</span>&nbsp;<span class="ident" id="5937885"><a href="/go/token/position.go.html#5937815">offset</a></span>&nbsp;<span class="op" id="5937892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937897">return</span>&nbsp;<span class="ident" id="5937904">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937912">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5937915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5937919">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937939"><a href="/go/token/position.go.html#5937718">f</a></span><span class="op" id="5937940">.</span><span class="ident" id="5937941">set</span><span class="op" id="5937944">.</span><span class="ident" id="5937945">mutex</span><span class="op" id="5937950">.</span><span class="ident" id="5937951">Lock</span><span class="op" id="5937955">(</span><span class="op" id="5937956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937959"><a href="/go/token/position.go.html#5937718">f</a></span><span class="op" id="5937960">.</span><span class="ident" id="5937961">lines</span>&nbsp;<span class="op" id="5937967">=</span>&nbsp;<span class="ident" id="5937969"><a href="/go/token/position.go.html#5937736">lines</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937976"><a href="/go/token/position.go.html#5937718">f</a></span><span class="op" id="5937977">.</span><span class="ident" id="5937978">set</span><span class="op" id="5937981">.</span><span class="ident" id="5937982">mutex</span><span class="op" id="5937987">.</span><span class="ident" id="5937988">Unlock</span><span class="op" id="5937994">(</span><span class="op" id="5937995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5937998">return</span>&nbsp;<span class="ident" id="5938005">true</span><br>
<span class="lineno"></span><span class="op" id="5938010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938013">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="5938085">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="5938134">func</span>&nbsp;<span class="op" id="5938139">(</span><span class="ident" id="5938140">f</span>&nbsp;<span class="op" id="5938142">*</span><span class="ident" id="5938143"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5938147">)</span>&nbsp;<span class="ident" id="5938149">SetLinesForContent</span><span class="op" id="5938167">(</span><span class="ident" id="5938168">content</span>&nbsp;<span class="op" id="5938176">[</span><span class="op" id="5938177">]</span><span class="builtintype" id="5938178">byte</span><span class="op" id="5938182">)</span>&nbsp;<span class="op" id="5938184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938187">var</span>&nbsp;<span class="ident" id="5938191">lines</span>&nbsp;<span class="op" id="5938197">[</span><span class="op" id="5938198">]</span><span class="builtintype" id="5938199">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938204">line</span>&nbsp;<span class="op" id="5938209">:=</span>&nbsp;<span class="num" id="5938212">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938215">for</span>&nbsp;<span class="ident" id="5938219">offset</span><span class="op" id="5938225">,</span>&nbsp;<span class="ident" id="5938227">b</span>&nbsp;<span class="op" id="5938229">:=</span>&nbsp;<span class="keyword" id="5938232">range</span>&nbsp;<span class="ident" id="5938238"><a href="/go/token/position.go.html#5938168">content</a></span>&nbsp;<span class="op" id="5938246">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938250">if</span>&nbsp;<span class="ident" id="5938253"><a href="/go/token/position.go.html#5938204">line</a></span>&nbsp;<span class="op" id="5938258">&gt;=</span>&nbsp;<span class="num" id="5938261">0</span>&nbsp;<span class="op" id="5938263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938268"><a href="/go/token/position.go.html#5938191">lines</a></span>&nbsp;<span class="op" id="5938274">=</span>&nbsp;<span class="builtinfunc" id="5938276">append</span><span class="op" id="5938282">(</span><span class="ident" id="5938283"><a href="/go/token/position.go.html#5938191">lines</a></span><span class="op" id="5938288">,</span>&nbsp;<span class="ident" id="5938290"><a href="/go/token/position.go.html#5938204">line</a></span><span class="op" id="5938294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938302"><a href="/go/token/position.go.html#5938204">line</a></span>&nbsp;<span class="op" id="5938307">=</span>&nbsp;<span class="op" id="5938309">-</span><span class="num" id="5938310">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938314">if</span>&nbsp;<span class="ident" id="5938317"><a href="/go/token/position.go.html#5938227">b</a></span>&nbsp;<span class="op" id="5938319">==</span>&nbsp;<span class="string" id="5938322">&#39;\n&#39;</span>&nbsp;<span class="op" id="5938327">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938332"><a href="/go/token/position.go.html#5938204">line</a></span>&nbsp;<span class="op" id="5938337">=</span>&nbsp;<span class="ident" id="5938339"><a href="/go/token/position.go.html#5938219">offset</a></span>&nbsp;<span class="op" id="5938346">+</span>&nbsp;<span class="num" id="5938348">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5938355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938359">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938379"><a href="/go/token/position.go.html#5938140">f</a></span><span class="op" id="5938380">.</span><span class="ident" id="5938381">set</span><span class="op" id="5938384">.</span><span class="ident" id="5938385">mutex</span><span class="op" id="5938390">.</span><span class="ident" id="5938391">Lock</span><span class="op" id="5938395">(</span><span class="op" id="5938396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938399"><a href="/go/token/position.go.html#5938140">f</a></span><span class="op" id="5938400">.</span><span class="ident" id="5938401">lines</span>&nbsp;<span class="op" id="5938407">=</span>&nbsp;<span class="ident" id="5938409"><a href="/go/token/position.go.html#5938191">lines</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938416"><a href="/go/token/position.go.html#5938140">f</a></span><span class="op" id="5938417">.</span><span class="ident" id="5938418">set</span><span class="op" id="5938421">.</span><span class="ident" id="5938422">mutex</span><span class="op" id="5938427">.</span><span class="ident" id="5938428">Unlock</span><span class="op" id="5938434">(</span><span class="op" id="5938435">)</span><br>
<span class="lineno"></span><span class="op" id="5938437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5938440">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5938504">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="5938567">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5938601">type</span>&nbsp;<span class="ident" id="5938606">lineInfo</span>&nbsp;<span class="keyword" id="5938615">struct</span>&nbsp;<span class="op" id="5938622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5938625">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938680">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5938689">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938694">Filename</span>&nbsp;<span class="builtintype" id="5938703">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938711">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5938720">int</span><br>
<span class="lineno"></span><span class="op" id="5938724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5938727">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5938796">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5938866">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5938933">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5938985">//</span><br>
<span class="lineno">220</span><span class="comment" id="5938988">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5939054">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5939120">//</span><br>
<span class="lineno"></span><span class="keyword" id="5939123">func</span>&nbsp;<span class="op" id="5939128">(</span><span class="ident" id="5939129">f</span>&nbsp;<span class="op" id="5939131">*</span><span class="ident" id="5939132"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5939136">)</span>&nbsp;<span class="ident" id="5939138">AddLineInfo</span><span class="op" id="5939149">(</span><span class="ident" id="5939150">offset</span>&nbsp;<span class="builtintype" id="5939157">int</span><span class="op" id="5939160">,</span>&nbsp;<span class="ident" id="5939162">filename</span>&nbsp;<span class="builtintype" id="5939171">string</span><span class="op" id="5939177">,</span>&nbsp;<span class="ident" id="5939179">line</span>&nbsp;<span class="builtintype" id="5939184">int</span><span class="op" id="5939187">)</span>&nbsp;<span class="op" id="5939189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939192"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939193">.</span><span class="ident" id="5939194">set</span><span class="op" id="5939197">.</span><span class="ident" id="5939198">mutex</span><span class="op" id="5939203">.</span><span class="ident" id="5939204">Lock</span><span class="op" id="5939208">(</span><span class="op" id="5939209">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939212">if</span>&nbsp;<span class="ident" id="5939215">i</span>&nbsp;<span class="op" id="5939217">:=</span>&nbsp;<span class="builtinfunc" id="5939220">len</span><span class="op" id="5939223">(</span><span class="ident" id="5939224"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939225">.</span><span class="ident" id="5939226">infos</span><span class="op" id="5939231">)</span><span class="op" id="5939232">;</span>&nbsp;<span class="ident" id="5939234"><a href="/go/token/position.go.html#5939215">i</a></span>&nbsp;<span class="op" id="5939236">==</span>&nbsp;<span class="num" id="5939239">0</span>&nbsp;<span class="op" id="5939241">||</span>&nbsp;<span class="ident" id="5939244"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939245">.</span><span class="ident" id="5939246">infos</span><span class="op" id="5939251">[</span><span class="ident" id="5939252"><a href="/go/token/position.go.html#5939215">i</a></span><span class="op" id="5939253">-</span><span class="num" id="5939254">1</span><span class="op" id="5939255">]</span><span class="op" id="5939256">.</span><span class="ident" id="5939257">Offset</span>&nbsp;<span class="op" id="5939264">&lt;</span>&nbsp;<span class="ident" id="5939266"><a href="/go/token/position.go.html#5939150">offset</a></span>&nbsp;<span class="op" id="5939273">&amp;&amp;</span>&nbsp;<span class="ident" id="5939276"><a href="/go/token/position.go.html#5939150">offset</a></span>&nbsp;<span class="op" id="5939283">&lt;</span>&nbsp;<span class="ident" id="5939285"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939286">.</span><span class="ident" id="5939287">size</span>&nbsp;<span class="op" id="5939292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939296"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939297">.</span><span class="ident" id="5939298">infos</span>&nbsp;<span class="op" id="5939304">=</span>&nbsp;<span class="builtinfunc" id="5939306">append</span><span class="op" id="5939312">(</span><span class="ident" id="5939313"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939314">.</span><span class="ident" id="5939315">infos</span><span class="op" id="5939320">,</span>&nbsp;<span class="ident" id="5939322"><a href="/go/token/position.go.html#5938606">lineInfo</a></span><span class="op" id="5939330">{</span><span class="ident" id="5939331"><a href="/go/token/position.go.html#5939150">offset</a></span><span class="op" id="5939337">,</span>&nbsp;<span class="ident" id="5939339"><a href="/go/token/position.go.html#5939162">filename</a></span><span class="op" id="5939347">,</span>&nbsp;<span class="ident" id="5939349"><a href="/go/token/position.go.html#5939179">line</a></span><span class="op" id="5939353">}</span><span class="op" id="5939354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939360"><a href="/go/token/position.go.html#5939129">f</a></span><span class="op" id="5939361">.</span><span class="ident" id="5939362">set</span><span class="op" id="5939365">.</span><span class="ident" id="5939366">mutex</span><span class="op" id="5939371">.</span><span class="ident" id="5939372">Unlock</span><span class="op" id="5939378">(</span><span class="op" id="5939379">)</span><br>
<span class="lineno"></span><span class="op" id="5939381">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5939384">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="5939440">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="5939475">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5939503">//</span><br>
<span class="lineno">235</span><span class="keyword" id="5939506">func</span>&nbsp;<span class="op" id="5939511">(</span><span class="ident" id="5939512">f</span>&nbsp;<span class="op" id="5939514">*</span><span class="ident" id="5939515"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5939519">)</span>&nbsp;<span class="ident" id="5939521">Pos</span><span class="op" id="5939524">(</span><span class="ident" id="5939525">offset</span>&nbsp;<span class="builtintype" id="5939532">int</span><span class="op" id="5939535">)</span>&nbsp;<span class="ident" id="5939537"><a href="/go/token/position.go.html#5934489">Pos</a></span>&nbsp;<span class="op" id="5939541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939544">if</span>&nbsp;<span class="ident" id="5939547"><a href="/go/token/position.go.html#5939525">offset</a></span>&nbsp;<span class="op" id="5939554">&gt;</span>&nbsp;<span class="ident" id="5939556"><a href="/go/token/position.go.html#5939512">f</a></span><span class="op" id="5939557">.</span><span class="ident" id="5939558">size</span>&nbsp;<span class="op" id="5939563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5939567">panic</span><span class="op" id="5939572">(</span><span class="string" id="5939573">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="5939594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939600">return</span>&nbsp;<span class="ident" id="5939607"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5939610">(</span><span class="ident" id="5939611"><a href="/go/token/position.go.html#5939512">f</a></span><span class="op" id="5939612">.</span><span class="ident" id="5939613">base</span>&nbsp;<span class="op" id="5939618">+</span>&nbsp;<span class="ident" id="5939620"><a href="/go/token/position.go.html#5939525">offset</a></span><span class="op" id="5939626">)</span><br>
<span class="lineno">240</span><span class="op" id="5939628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939631">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5939691">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5939736">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="5939774">//</span><br>
<span class="lineno"></span><span class="keyword" id="5939777">func</span>&nbsp;<span class="op" id="5939782">(</span><span class="ident" id="5939783">f</span>&nbsp;<span class="op" id="5939785">*</span><span class="ident" id="5939786"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5939790">)</span>&nbsp;<span class="ident" id="5939792">Offset</span><span class="op" id="5939798">(</span><span class="ident" id="5939799">p</span>&nbsp;<span class="ident" id="5939801"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5939804">)</span>&nbsp;<span class="builtintype" id="5939806">int</span>&nbsp;<span class="op" id="5939810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939813">if</span>&nbsp;<span class="builtintype" id="5939816">int</span><span class="op" id="5939819">(</span><span class="ident" id="5939820"><a href="/go/token/position.go.html#5939799">p</a></span><span class="op" id="5939821">)</span>&nbsp;<span class="op" id="5939823">&lt;</span>&nbsp;<span class="ident" id="5939825"><a href="/go/token/position.go.html#5939783">f</a></span><span class="op" id="5939826">.</span><span class="ident" id="5939827">base</span>&nbsp;<span class="op" id="5939832">||</span>&nbsp;<span class="builtintype" id="5939835">int</span><span class="op" id="5939838">(</span><span class="ident" id="5939839"><a href="/go/token/position.go.html#5939799">p</a></span><span class="op" id="5939840">)</span>&nbsp;<span class="op" id="5939842">&gt;</span>&nbsp;<span class="ident" id="5939844"><a href="/go/token/position.go.html#5939783">f</a></span><span class="op" id="5939845">.</span><span class="ident" id="5939846">base</span><span class="op" id="5939850">+</span><span class="ident" id="5939851"><a href="/go/token/position.go.html#5939783">f</a></span><span class="op" id="5939852">.</span><span class="ident" id="5939853">size</span>&nbsp;<span class="op" id="5939858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5939862">panic</span><span class="op" id="5939867">(</span><span class="string" id="5939868">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5939887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939890">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939893">return</span>&nbsp;<span class="builtintype" id="5939900">int</span><span class="op" id="5939903">(</span><span class="ident" id="5939904"><a href="/go/token/position.go.html#5939799">p</a></span><span class="op" id="5939905">)</span>&nbsp;<span class="op" id="5939907">-</span>&nbsp;<span class="ident" id="5939909"><a href="/go/token/position.go.html#5939783">f</a></span><span class="op" id="5939910">.</span><span class="ident" id="5939911">base</span><br>
<span class="lineno"></span><span class="op" id="5939916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939919">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5939982">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="5940030">//</span><br>
<span class="lineno"></span><span class="keyword" id="5940033">func</span>&nbsp;<span class="op" id="5940038">(</span><span class="ident" id="5940039">f</span>&nbsp;<span class="op" id="5940041">*</span><span class="ident" id="5940042"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5940046">)</span>&nbsp;<span class="ident" id="5940048">Line</span><span class="op" id="5940052">(</span><span class="ident" id="5940053">p</span>&nbsp;<span class="ident" id="5940055"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5940058">)</span>&nbsp;<span class="builtintype" id="5940060">int</span>&nbsp;<span class="op" id="5940064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940067">return</span>&nbsp;<span class="ident" id="5940074"><a href="/go/token/position.go.html#5940039">f</a></span><span class="op" id="5940075">.</span><span class="ident" id="5940076">Position</span><span class="op" id="5940084">(</span><span class="ident" id="5940085"><a href="/go/token/position.go.html#5940053">p</a></span><span class="op" id="5940086">)</span><span class="op" id="5940087">.</span><span class="ident" id="5940088">Line</span><br>
<span class="lineno"></span><span class="op" id="5940093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5940096">func</span>&nbsp;<span class="ident" id="5940101">searchLineInfos</span><span class="op" id="5940116">(</span><span class="ident" id="5940117">a</span>&nbsp;<span class="op" id="5940119">[</span><span class="op" id="5940120">]</span><span class="ident" id="5940121"><a href="/go/token/position.go.html#5938606">lineInfo</a></span><span class="op" id="5940129">,</span>&nbsp;<span class="ident" id="5940131">x</span>&nbsp;<span class="builtintype" id="5940133">int</span><span class="op" id="5940136">)</span>&nbsp;<span class="builtintype" id="5940138">int</span>&nbsp;<span class="op" id="5940142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940145">return</span>&nbsp;<span class="ident" id="5940152"><a href="/go/token/position.go.html#5932386">sort</a></span><span class="op" id="5940156">.</span><span class="ident" id="5940157">Search</span><span class="op" id="5940163">(</span><span class="builtinfunc" id="5940164">len</span><span class="op" id="5940167">(</span><span class="ident" id="5940168"><a href="/go/token/position.go.html#5940117">a</a></span><span class="op" id="5940169">)</span><span class="op" id="5940170">,</span>&nbsp;<span class="keyword" id="5940172">func</span><span class="op" id="5940176">(</span><span class="ident" id="5940177">i</span>&nbsp;<span class="builtintype" id="5940179">int</span><span class="op" id="5940182">)</span>&nbsp;<span class="builtintype" id="5940184">bool</span>&nbsp;<span class="op" id="5940189">{</span>&nbsp;<span class="keyword" id="5940191">return</span>&nbsp;<span class="ident" id="5940198"><a href="/go/token/position.go.html#5940117">a</a></span><span class="op" id="5940199">[</span><span class="ident" id="5940200"><a href="/go/token/position.go.html#5940177">i</a></span><span class="op" id="5940201">]</span><span class="op" id="5940202">.</span><span class="ident" id="5940203">Offset</span>&nbsp;<span class="op" id="5940210">&gt;</span>&nbsp;<span class="ident" id="5940212"><a href="/go/token/position.go.html#5940131">x</a></span>&nbsp;<span class="op" id="5940214">}</span><span class="op" id="5940215">)</span>&nbsp;<span class="op" id="5940217">-</span>&nbsp;<span class="num" id="5940219">1</span><br>
<span class="lineno"></span><span class="op" id="5940221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940224">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="5940301">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5940377">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5940456">//</span><br>
<span class="lineno"></span><span class="keyword" id="5940459">func</span>&nbsp;<span class="op" id="5940464">(</span><span class="ident" id="5940465">f</span>&nbsp;<span class="op" id="5940467">*</span><span class="ident" id="5940468"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5940472">)</span>&nbsp;<span class="ident" id="5940474">unpack</span><span class="op" id="5940480">(</span><span class="ident" id="5940481">offset</span>&nbsp;<span class="builtintype" id="5940488">int</span><span class="op" id="5940491">,</span>&nbsp;<span class="ident" id="5940493">adjusted</span>&nbsp;<span class="builtintype" id="5940502">bool</span><span class="op" id="5940506">)</span>&nbsp;<span class="op" id="5940508">(</span><span class="ident" id="5940509">filename</span>&nbsp;<span class="builtintype" id="5940518">string</span><span class="op" id="5940524">,</span>&nbsp;<span class="ident" id="5940526">line</span><span class="op" id="5940530">,</span>&nbsp;<span class="ident" id="5940532">column</span>&nbsp;<span class="builtintype" id="5940539">int</span><span class="op" id="5940542">)</span>&nbsp;<span class="op" id="5940544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940547"><a href="/go/token/position.go.html#5940509">filename</a></span>&nbsp;<span class="op" id="5940556">=</span>&nbsp;<span class="ident" id="5940558"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940559">.</span><span class="ident" id="5940560">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940566">if</span>&nbsp;<span class="ident" id="5940569">i</span>&nbsp;<span class="op" id="5940571">:=</span>&nbsp;<span class="ident" id="5940574"><a href="/go/token/position.go.html#5945939">searchInts</a></span><span class="op" id="5940584">(</span><span class="ident" id="5940585"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940586">.</span><span class="ident" id="5940587">lines</span><span class="op" id="5940592">,</span>&nbsp;<span class="ident" id="5940594"><a href="/go/token/position.go.html#5940481">offset</a></span><span class="op" id="5940600">)</span><span class="op" id="5940601">;</span>&nbsp;<span class="ident" id="5940603"><a href="/go/token/position.go.html#5940569">i</a></span>&nbsp;<span class="op" id="5940605">&gt;=</span>&nbsp;<span class="num" id="5940608">0</span>&nbsp;<span class="op" id="5940610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940614"><a href="/go/token/position.go.html#5940526">line</a></span><span class="op" id="5940618">,</span>&nbsp;<span class="ident" id="5940620"><a href="/go/token/position.go.html#5940532">column</a></span>&nbsp;<span class="op" id="5940627">=</span>&nbsp;<span class="ident" id="5940629"><a href="/go/token/position.go.html#5940569">i</a></span><span class="op" id="5940630">+</span><span class="num" id="5940631">1</span><span class="op" id="5940632">,</span>&nbsp;<span class="ident" id="5940634"><a href="/go/token/position.go.html#5940481">offset</a></span><span class="op" id="5940640">-</span><span class="ident" id="5940641"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940642">.</span><span class="ident" id="5940643">lines</span><span class="op" id="5940648">[</span><span class="ident" id="5940649"><a href="/go/token/position.go.html#5940569">i</a></span><span class="op" id="5940650">]</span><span class="op" id="5940651">+</span><span class="num" id="5940652">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940658">if</span>&nbsp;<span class="ident" id="5940661"><a href="/go/token/position.go.html#5940493">adjusted</a></span>&nbsp;<span class="op" id="5940670">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5940673">len</span><span class="op" id="5940676">(</span><span class="ident" id="5940677"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940678">.</span><span class="ident" id="5940679">infos</span><span class="op" id="5940684">)</span>&nbsp;<span class="op" id="5940686">&gt;</span>&nbsp;<span class="num" id="5940688">0</span>&nbsp;<span class="op" id="5940690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940694">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940737">if</span>&nbsp;<span class="ident" id="5940740">i</span>&nbsp;<span class="op" id="5940742">:=</span>&nbsp;<span class="ident" id="5940745"><a href="/go/token/position.go.html#5940101">searchLineInfos</a></span><span class="op" id="5940760">(</span><span class="ident" id="5940761"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940762">.</span><span class="ident" id="5940763">infos</span><span class="op" id="5940768">,</span>&nbsp;<span class="ident" id="5940770"><a href="/go/token/position.go.html#5940481">offset</a></span><span class="op" id="5940776">)</span><span class="op" id="5940777">;</span>&nbsp;<span class="ident" id="5940779"><a href="/go/token/position.go.html#5940740">i</a></span>&nbsp;<span class="op" id="5940781">&gt;=</span>&nbsp;<span class="num" id="5940784">0</span>&nbsp;<span class="op" id="5940786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940791">alt</span>&nbsp;<span class="op" id="5940795">:=</span>&nbsp;<span class="op" id="5940798">&amp;</span><span class="ident" id="5940799"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940800">.</span><span class="ident" id="5940801">infos</span><span class="op" id="5940806">[</span><span class="ident" id="5940807"><a href="/go/token/position.go.html#5940740">i</a></span><span class="op" id="5940808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940813"><a href="/go/token/position.go.html#5940509">filename</a></span>&nbsp;<span class="op" id="5940822">=</span>&nbsp;<span class="ident" id="5940824"><a href="/go/token/position.go.html#5940791">alt</a></span><span class="op" id="5940827">.</span><span class="ident" id="5940828">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940840">if</span>&nbsp;<span class="ident" id="5940843">i</span>&nbsp;<span class="op" id="5940845">:=</span>&nbsp;<span class="ident" id="5940848"><a href="/go/token/position.go.html#5945939">searchInts</a></span><span class="op" id="5940858">(</span><span class="ident" id="5940859"><a href="/go/token/position.go.html#5940465">f</a></span><span class="op" id="5940860">.</span><span class="ident" id="5940861">lines</span><span class="op" id="5940866">,</span>&nbsp;<span class="ident" id="5940868"><a href="/go/token/position.go.html#5940791">alt</a></span><span class="op" id="5940871">.</span><span class="ident" id="5940872">Offset</span><span class="op" id="5940878">)</span><span class="op" id="5940879">;</span>&nbsp;<span class="ident" id="5940881"><a href="/go/token/position.go.html#5940843">i</a></span>&nbsp;<span class="op" id="5940883">&gt;=</span>&nbsp;<span class="num" id="5940886">0</span>&nbsp;<span class="op" id="5940888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940894"><a href="/go/token/position.go.html#5940526">line</a></span>&nbsp;<span class="op" id="5940899">+=</span>&nbsp;<span class="ident" id="5940902"><a href="/go/token/position.go.html#5940791">alt</a></span><span class="op" id="5940905">.</span><span class="ident" id="5940906">Line</span>&nbsp;<span class="op" id="5940911">-</span>&nbsp;<span class="ident" id="5940913"><a href="/go/token/position.go.html#5940843">i</a></span>&nbsp;<span class="op" id="5940915">-</span>&nbsp;<span class="num" id="5940917">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940932">return</span><br>
<span class="lineno"></span><span class="op" id="5940939">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5940942">func</span>&nbsp;<span class="op" id="5940947">(</span><span class="ident" id="5940948">f</span>&nbsp;<span class="op" id="5940950">*</span><span class="ident" id="5940951"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5940955">)</span>&nbsp;<span class="ident" id="5940957">position</span><span class="op" id="5940965">(</span><span class="ident" id="5940966">p</span>&nbsp;<span class="ident" id="5940968"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5940971">,</span>&nbsp;<span class="ident" id="5940973">adjusted</span>&nbsp;<span class="builtintype" id="5940982">bool</span><span class="op" id="5940986">)</span>&nbsp;<span class="op" id="5940988">(</span><span class="ident" id="5940989">pos</span>&nbsp;<span class="ident" id="5940993"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5941001">)</span>&nbsp;<span class="op" id="5941003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941006">offset</span>&nbsp;<span class="op" id="5941013">:=</span>&nbsp;<span class="builtintype" id="5941016">int</span><span class="op" id="5941019">(</span><span class="ident" id="5941020"><a href="/go/token/position.go.html#5940966">p</a></span><span class="op" id="5941021">)</span>&nbsp;<span class="op" id="5941023">-</span>&nbsp;<span class="ident" id="5941025"><a href="/go/token/position.go.html#5940948">f</a></span><span class="op" id="5941026">.</span><span class="ident" id="5941027">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941033"><a href="/go/token/position.go.html#5940989">pos</a></span><span class="op" id="5941036">.</span><span class="ident" id="5941037">Offset</span>&nbsp;<span class="op" id="5941044">=</span>&nbsp;<span class="ident" id="5941046"><a href="/go/token/position.go.html#5941006">offset</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941054"><a href="/go/token/position.go.html#5940989">pos</a></span><span class="op" id="5941057">.</span><span class="ident" id="5941058">Filename</span><span class="op" id="5941066">,</span>&nbsp;<span class="ident" id="5941068"><a href="/go/token/position.go.html#5940989">pos</a></span><span class="op" id="5941071">.</span><span class="ident" id="5941072">Line</span><span class="op" id="5941076">,</span>&nbsp;<span class="ident" id="5941078"><a href="/go/token/position.go.html#5940989">pos</a></span><span class="op" id="5941081">.</span><span class="ident" id="5941082">Column</span>&nbsp;<span class="op" id="5941089">=</span>&nbsp;<span class="ident" id="5941091"><a href="/go/token/position.go.html#5940948">f</a></span><span class="op" id="5941092">.</span><span class="ident" id="5941093">unpack</span><span class="op" id="5941099">(</span><span class="ident" id="5941100"><a href="/go/token/position.go.html#5941006">offset</a></span><span class="op" id="5941106">,</span>&nbsp;<span class="ident" id="5941108"><a href="/go/token/position.go.html#5940973">adjusted</a></span><span class="op" id="5941116">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941119">return</span><br>
<span class="lineno"></span><span class="op" id="5941126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941129">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5941202">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="5941275">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5941333">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5941373">//</span><br>
<span class="lineno"></span><span class="keyword" id="5941376">func</span>&nbsp;<span class="op" id="5941381">(</span><span class="ident" id="5941382">f</span>&nbsp;<span class="op" id="5941384">*</span><span class="ident" id="5941385"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5941389">)</span>&nbsp;<span class="ident" id="5941391">PositionFor</span><span class="op" id="5941402">(</span><span class="ident" id="5941403">p</span>&nbsp;<span class="ident" id="5941405"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5941408">,</span>&nbsp;<span class="ident" id="5941410">adjusted</span>&nbsp;<span class="builtintype" id="5941419">bool</span><span class="op" id="5941423">)</span>&nbsp;<span class="op" id="5941425">(</span><span class="ident" id="5941426">pos</span>&nbsp;<span class="ident" id="5941430"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5941438">)</span>&nbsp;<span class="op" id="5941440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941443">if</span>&nbsp;<span class="ident" id="5941446"><a href="/go/token/position.go.html#5941403">p</a></span>&nbsp;<span class="op" id="5941448">!=</span>&nbsp;<span class="ident" id="5941451"><a href="/go/token/position.go.html#5934767">NoPos</a></span>&nbsp;<span class="op" id="5941457">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941461">if</span>&nbsp;<span class="builtintype" id="5941464">int</span><span class="op" id="5941467">(</span><span class="ident" id="5941468"><a href="/go/token/position.go.html#5941403">p</a></span><span class="op" id="5941469">)</span>&nbsp;<span class="op" id="5941471">&lt;</span>&nbsp;<span class="ident" id="5941473"><a href="/go/token/position.go.html#5941382">f</a></span><span class="op" id="5941474">.</span><span class="ident" id="5941475">base</span>&nbsp;<span class="op" id="5941480">||</span>&nbsp;<span class="builtintype" id="5941483">int</span><span class="op" id="5941486">(</span><span class="ident" id="5941487"><a href="/go/token/position.go.html#5941403">p</a></span><span class="op" id="5941488">)</span>&nbsp;<span class="op" id="5941490">&gt;</span>&nbsp;<span class="ident" id="5941492"><a href="/go/token/position.go.html#5941382">f</a></span><span class="op" id="5941493">.</span><span class="ident" id="5941494">base</span><span class="op" id="5941498">+</span><span class="ident" id="5941499"><a href="/go/token/position.go.html#5941382">f</a></span><span class="op" id="5941500">.</span><span class="ident" id="5941501">size</span>&nbsp;<span class="op" id="5941506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5941511">panic</span><span class="op" id="5941516">(</span><span class="string" id="5941517">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5941536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5941544"><a href="/go/token/position.go.html#5941426">pos</a></span>&nbsp;<span class="op" id="5941548">=</span>&nbsp;<span class="ident" id="5941550"><a href="/go/token/position.go.html#5941382">f</a></span><span class="op" id="5941551">.</span><span class="ident" id="5941552">position</span><span class="op" id="5941560">(</span><span class="ident" id="5941561"><a href="/go/token/position.go.html#5941403">p</a></span><span class="op" id="5941562">,</span>&nbsp;<span class="ident" id="5941564"><a href="/go/token/position.go.html#5941410">adjusted</a></span><span class="op" id="5941572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5941575">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941578">return</span><br>
<span class="lineno"></span><span class="op" id="5941585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941588">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5941658">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="5941732">//</span><br>
<span class="lineno"></span><span class="keyword" id="5941735">func</span>&nbsp;<span class="op" id="5941740">(</span><span class="ident" id="5941741">f</span>&nbsp;<span class="op" id="5941743">*</span><span class="ident" id="5941744"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5941748">)</span>&nbsp;<span class="ident" id="5941750">Position</span><span class="op" id="5941758">(</span><span class="ident" id="5941759">p</span>&nbsp;<span class="ident" id="5941761"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5941764">)</span>&nbsp;<span class="op" id="5941766">(</span><span class="ident" id="5941767">pos</span>&nbsp;<span class="ident" id="5941771"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5941779">)</span>&nbsp;<span class="op" id="5941781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5941784">return</span>&nbsp;<span class="ident" id="5941791"><a href="/go/token/position.go.html#5941741">f</a></span><span class="op" id="5941792">.</span><span class="ident" id="5941793">PositionFor</span><span class="op" id="5941804">(</span><span class="ident" id="5941805"><a href="/go/token/position.go.html#5941759">p</a></span><span class="op" id="5941806">,</span>&nbsp;<span class="ident" id="5941808">true</span><span class="op" id="5941812">)</span><br>
<span class="lineno"></span><span class="op" id="5941814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5941817">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5941898">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941910">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5941957">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="5942019">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="5942052">//</span><br>
<span class="lineno"></span><span class="keyword" id="5942055">type</span>&nbsp;<span class="ident" id="5942060">FileSet</span>&nbsp;<span class="keyword" id="5942068">struct</span>&nbsp;<span class="op" id="5942075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942078">mutex</span>&nbsp;<span class="ident" id="5942084"><a href="/go/token/position.go.html#5932394">sync</a></span><span class="op" id="5942088">.</span><span class="ident" id="5942089">RWMutex</span>&nbsp;<span class="comment" id="5942097">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942123">base</span>&nbsp;&nbsp;<span class="builtintype" id="5942129">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942142">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942176">files</span>&nbsp;<span class="op" id="5942182">[</span><span class="op" id="5942183">]</span><span class="op" id="5942184">*</span><span class="ident" id="5942185"><a href="/go/token/position.go.html#5935090">File</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942195">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942243">last</span>&nbsp;&nbsp;<span class="op" id="5942249">*</span><span class="ident" id="5942250"><a href="/go/token/position.go.html#5935090">File</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942262">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="5942294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942297">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="5942335">func</span>&nbsp;<span class="ident" id="5942340">NewFileSet</span><span class="op" id="5942350">(</span><span class="op" id="5942351">)</span>&nbsp;<span class="op" id="5942353">*</span><span class="ident" id="5942354"><a href="/go/token/position.go.html#5942060">FileSet</a></span>&nbsp;<span class="op" id="5942362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942365">return</span>&nbsp;<span class="op" id="5942372">&amp;</span><span class="ident" id="5942373"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5942380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942384">base</span><span class="op" id="5942388">:</span>&nbsp;<span class="num" id="5942390">1</span><span class="op" id="5942391">,</span>&nbsp;<span class="comment" id="5942393">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5942408">}</span><br>
<span class="lineno"></span><span class="op" id="5942410">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="5942413">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5942478">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5942516">//</span><br>
<span class="lineno"></span><span class="keyword" id="5942519">func</span>&nbsp;<span class="op" id="5942524">(</span><span class="ident" id="5942525">s</span>&nbsp;<span class="op" id="5942527">*</span><span class="ident" id="5942528"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5942535">)</span>&nbsp;<span class="ident" id="5942537">Base</span><span class="op" id="5942541">(</span><span class="op" id="5942542">)</span>&nbsp;<span class="builtintype" id="5942544">int</span>&nbsp;<span class="op" id="5942548">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942551"><a href="/go/token/position.go.html#5942525">s</a></span><span class="op" id="5942552">.</span><span class="ident" id="5942553">mutex</span><span class="op" id="5942558">.</span><span class="ident" id="5942559">RLock</span><span class="op" id="5942564">(</span><span class="op" id="5942565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942568">b</span>&nbsp;<span class="op" id="5942570">:=</span>&nbsp;<span class="ident" id="5942573"><a href="/go/token/position.go.html#5942525">s</a></span><span class="op" id="5942574">.</span><span class="ident" id="5942575">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5942581"><a href="/go/token/position.go.html#5942525">s</a></span><span class="op" id="5942582">.</span><span class="ident" id="5942583">mutex</span><span class="op" id="5942588">.</span><span class="ident" id="5942589">RUnlock</span><span class="op" id="5942596">(</span><span class="op" id="5942597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5942600">return</span>&nbsp;<span class="ident" id="5942607"><a href="/go/token/position.go.html#5942568">b</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="5942610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942613">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="5942690">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5942766">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="5942842">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="5942923">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5942985">//</span><br>
<span class="lineno"></span><span class="comment" id="5942988">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5943063">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="5943138">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="5943200">//</span><br>
<span class="lineno"></span><span class="comment" id="5943203">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="5943227">//</span><br>
<span class="lineno"></span><span class="comment" id="5943230">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="5943309">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5943383">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="5943413">//</span><br>
<span class="lineno"></span><span class="keyword" id="5943416">func</span>&nbsp;<span class="op" id="5943421">(</span><span class="ident" id="5943422">s</span>&nbsp;<span class="op" id="5943424">*</span><span class="ident" id="5943425"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5943432">)</span>&nbsp;<span class="ident" id="5943434">AddFile</span><span class="op" id="5943441">(</span><span class="ident" id="5943442">filename</span>&nbsp;<span class="builtintype" id="5943451">string</span><span class="op" id="5943457">,</span>&nbsp;<span class="ident" id="5943459">base</span><span class="op" id="5943463">,</span>&nbsp;<span class="ident" id="5943465">size</span>&nbsp;<span class="builtintype" id="5943470">int</span><span class="op" id="5943473">)</span>&nbsp;<span class="op" id="5943475">*</span><span class="ident" id="5943476"><a href="/go/token/position.go.html#5935090">File</a></span>&nbsp;<span class="op" id="5943481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943484"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943485">.</span><span class="ident" id="5943486">mutex</span><span class="op" id="5943491">.</span><span class="ident" id="5943492">Lock</span><span class="op" id="5943496">(</span><span class="op" id="5943497">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943500">defer</span>&nbsp;<span class="ident" id="5943506"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943507">.</span><span class="ident" id="5943508">mutex</span><span class="op" id="5943513">.</span><span class="ident" id="5943514">Unlock</span><span class="op" id="5943520">(</span><span class="op" id="5943521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943524">if</span>&nbsp;<span class="ident" id="5943527"><a href="/go/token/position.go.html#5943459">base</a></span>&nbsp;<span class="op" id="5943532">&lt;</span>&nbsp;<span class="num" id="5943534">0</span>&nbsp;<span class="op" id="5943536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943540"><a href="/go/token/position.go.html#5943459">base</a></span>&nbsp;<span class="op" id="5943545">=</span>&nbsp;<span class="ident" id="5943547"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943548">.</span><span class="ident" id="5943549">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943558">if</span>&nbsp;<span class="ident" id="5943561"><a href="/go/token/position.go.html#5943459">base</a></span>&nbsp;<span class="op" id="5943566">&lt;</span>&nbsp;<span class="ident" id="5943568"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943569">.</span><span class="ident" id="5943570">base</span>&nbsp;<span class="op" id="5943575">||</span>&nbsp;<span class="ident" id="5943578"><a href="/go/token/position.go.html#5943465">size</a></span>&nbsp;<span class="op" id="5943583">&lt;</span>&nbsp;<span class="num" id="5943585">0</span>&nbsp;<span class="op" id="5943587">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5943591">panic</span><span class="op" id="5943596">(</span><span class="string" id="5943597">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="5943619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943625">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943657">f</span>&nbsp;<span class="op" id="5943659">:=</span>&nbsp;<span class="op" id="5943662">&amp;</span><span class="ident" id="5943663"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5943667">{</span><span class="ident" id="5943668"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943669">,</span>&nbsp;<span class="ident" id="5943671"><a href="/go/token/position.go.html#5943442">filename</a></span><span class="op" id="5943679">,</span>&nbsp;<span class="ident" id="5943681"><a href="/go/token/position.go.html#5943459">base</a></span><span class="op" id="5943685">,</span>&nbsp;<span class="ident" id="5943687"><a href="/go/token/position.go.html#5943465">size</a></span><span class="op" id="5943691">,</span>&nbsp;<span class="op" id="5943693">[</span><span class="op" id="5943694">]</span><span class="builtintype" id="5943695">int</span><span class="op" id="5943698">{</span><span class="num" id="5943699">0</span><span class="op" id="5943700">}</span><span class="op" id="5943701">,</span>&nbsp;<span class="ident" id="5943703">nil</span><span class="op" id="5943706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943709"><a href="/go/token/position.go.html#5943459">base</a></span>&nbsp;<span class="op" id="5943714">+=</span>&nbsp;<span class="ident" id="5943717"><a href="/go/token/position.go.html#5943465">size</a></span>&nbsp;<span class="op" id="5943722">+</span>&nbsp;<span class="num" id="5943724">1</span>&nbsp;<span class="comment" id="5943726">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943765">if</span>&nbsp;<span class="ident" id="5943768"><a href="/go/token/position.go.html#5943459">base</a></span>&nbsp;<span class="op" id="5943773">&lt;</span>&nbsp;<span class="num" id="5943775">0</span>&nbsp;<span class="op" id="5943777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5943781">panic</span><span class="op" id="5943786">(</span><span class="string" id="5943787">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="5943848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5943851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5943854">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943887"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943888">.</span><span class="ident" id="5943889">base</span>&nbsp;<span class="op" id="5943894">=</span>&nbsp;<span class="ident" id="5943896"><a href="/go/token/position.go.html#5943459">base</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943902"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943903">.</span><span class="ident" id="5943904">files</span>&nbsp;<span class="op" id="5943910">=</span>&nbsp;<span class="builtinfunc" id="5943912">append</span><span class="op" id="5943918">(</span><span class="ident" id="5943919"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943920">.</span><span class="ident" id="5943921">files</span><span class="op" id="5943926">,</span>&nbsp;<span class="ident" id="5943928"><a href="/go/token/position.go.html#5943657">f</a></span><span class="op" id="5943929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5943932"><a href="/go/token/position.go.html#5943422">s</a></span><span class="op" id="5943933">.</span><span class="ident" id="5943934">last</span>&nbsp;<span class="op" id="5943939">=</span>&nbsp;<span class="ident" id="5943941"><a href="/go/token/position.go.html#5943657">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5943944">return</span>&nbsp;<span class="ident" id="5943951"><a href="/go/token/position.go.html#5943657">f</a></span><br>
<span class="lineno"></span><span class="op" id="5943953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5943956">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5944034">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5944060">//</span><br>
<span class="lineno"></span><span class="keyword" id="5944063">func</span>&nbsp;<span class="op" id="5944068">(</span><span class="ident" id="5944069">s</span>&nbsp;<span class="op" id="5944071">*</span><span class="ident" id="5944072"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5944079">)</span>&nbsp;<span class="ident" id="5944081">Iterate</span><span class="op" id="5944088">(</span><span class="ident" id="5944089">f</span>&nbsp;<span class="keyword" id="5944091">func</span><span class="op" id="5944095">(</span><span class="op" id="5944096">*</span><span class="ident" id="5944097"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5944101">)</span>&nbsp;<span class="builtintype" id="5944103">bool</span><span class="op" id="5944107">)</span>&nbsp;<span class="op" id="5944109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944112">for</span>&nbsp;<span class="ident" id="5944116">i</span>&nbsp;<span class="op" id="5944118">:=</span>&nbsp;<span class="num" id="5944121">0</span><span class="op" id="5944122">;</span>&nbsp;<span class="op" id="5944124">;</span>&nbsp;<span class="ident" id="5944126"><a href="/go/token/position.go.html#5944116">i</a></span><span class="op" id="5944127">++</span>&nbsp;<span class="op" id="5944130">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944134">var</span>&nbsp;<span class="ident" id="5944138">file</span>&nbsp;<span class="op" id="5944143">*</span><span class="ident" id="5944144"><a href="/go/token/position.go.html#5935090">File</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944151"><a href="/go/token/position.go.html#5944069">s</a></span><span class="op" id="5944152">.</span><span class="ident" id="5944153">mutex</span><span class="op" id="5944158">.</span><span class="ident" id="5944159">RLock</span><span class="op" id="5944164">(</span><span class="op" id="5944165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944169">if</span>&nbsp;<span class="ident" id="5944172"><a href="/go/token/position.go.html#5944116">i</a></span>&nbsp;<span class="op" id="5944174">&lt;</span>&nbsp;<span class="builtinfunc" id="5944176">len</span><span class="op" id="5944179">(</span><span class="ident" id="5944180"><a href="/go/token/position.go.html#5944069">s</a></span><span class="op" id="5944181">.</span><span class="ident" id="5944182">files</span><span class="op" id="5944187">)</span>&nbsp;<span class="op" id="5944189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944194"><a href="/go/token/position.go.html#5944138">file</a></span>&nbsp;<span class="op" id="5944199">=</span>&nbsp;<span class="ident" id="5944201"><a href="/go/token/position.go.html#5944069">s</a></span><span class="op" id="5944202">.</span><span class="ident" id="5944203">files</span><span class="op" id="5944208">[</span><span class="ident" id="5944209"><a href="/go/token/position.go.html#5944116">i</a></span><span class="op" id="5944210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944214">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944218"><a href="/go/token/position.go.html#5944069">s</a></span><span class="op" id="5944219">.</span><span class="ident" id="5944220">mutex</span><span class="op" id="5944225">.</span><span class="ident" id="5944226">RUnlock</span><span class="op" id="5944233">(</span><span class="op" id="5944234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944238">if</span>&nbsp;<span class="ident" id="5944241"><a href="/go/token/position.go.html#5944138">file</a></span>&nbsp;<span class="op" id="5944246">==</span>&nbsp;<span class="ident" id="5944249">nil</span>&nbsp;<span class="op" id="5944253">||</span>&nbsp;<span class="op" id="5944256">!</span><span class="ident" id="5944257"><a href="/go/token/position.go.html#5944089">f</a></span><span class="op" id="5944258">(</span><span class="ident" id="5944259"><a href="/go/token/position.go.html#5944138">file</a></span><span class="op" id="5944263">)</span>&nbsp;<span class="op" id="5944265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944270">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944281">}</span><br>
<span class="lineno">400</span><span class="op" id="5944283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944286">func</span>&nbsp;<span class="ident" id="5944291">searchFiles</span><span class="op" id="5944302">(</span><span class="ident" id="5944303">a</span>&nbsp;<span class="op" id="5944305">[</span><span class="op" id="5944306">]</span><span class="op" id="5944307">*</span><span class="ident" id="5944308"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5944312">,</span>&nbsp;<span class="ident" id="5944314">x</span>&nbsp;<span class="builtintype" id="5944316">int</span><span class="op" id="5944319">)</span>&nbsp;<span class="builtintype" id="5944321">int</span>&nbsp;<span class="op" id="5944325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944328">return</span>&nbsp;<span class="ident" id="5944335"><a href="/go/token/position.go.html#5932386">sort</a></span><span class="op" id="5944339">.</span><span class="ident" id="5944340">Search</span><span class="op" id="5944346">(</span><span class="builtinfunc" id="5944347">len</span><span class="op" id="5944350">(</span><span class="ident" id="5944351"><a href="/go/token/position.go.html#5944303">a</a></span><span class="op" id="5944352">)</span><span class="op" id="5944353">,</span>&nbsp;<span class="keyword" id="5944355">func</span><span class="op" id="5944359">(</span><span class="ident" id="5944360">i</span>&nbsp;<span class="builtintype" id="5944362">int</span><span class="op" id="5944365">)</span>&nbsp;<span class="builtintype" id="5944367">bool</span>&nbsp;<span class="op" id="5944372">{</span>&nbsp;<span class="keyword" id="5944374">return</span>&nbsp;<span class="ident" id="5944381"><a href="/go/token/position.go.html#5944303">a</a></span><span class="op" id="5944382">[</span><span class="ident" id="5944383"><a href="/go/token/position.go.html#5944360">i</a></span><span class="op" id="5944384">]</span><span class="op" id="5944385">.</span><span class="ident" id="5944386">base</span>&nbsp;<span class="op" id="5944391">&gt;</span>&nbsp;<span class="ident" id="5944393"><a href="/go/token/position.go.html#5944314">x</a></span>&nbsp;<span class="op" id="5944395">}</span><span class="op" id="5944396">)</span>&nbsp;<span class="op" id="5944398">-</span>&nbsp;<span class="num" id="5944400">1</span><br>
<span class="lineno"></span><span class="op" id="5944402">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5944405">func</span>&nbsp;<span class="op" id="5944410">(</span><span class="ident" id="5944411">s</span>&nbsp;<span class="op" id="5944413">*</span><span class="ident" id="5944414"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5944421">)</span>&nbsp;<span class="ident" id="5944423">file</span><span class="op" id="5944427">(</span><span class="ident" id="5944428">p</span>&nbsp;<span class="ident" id="5944430"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5944433">)</span>&nbsp;<span class="op" id="5944435">*</span><span class="ident" id="5944436"><a href="/go/token/position.go.html#5935090">File</a></span>&nbsp;<span class="op" id="5944441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944444"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944445">.</span><span class="ident" id="5944446">mutex</span><span class="op" id="5944451">.</span><span class="ident" id="5944452">RLock</span><span class="op" id="5944457">(</span><span class="op" id="5944458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944461">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944496">if</span>&nbsp;<span class="ident" id="5944499">f</span>&nbsp;<span class="op" id="5944501">:=</span>&nbsp;<span class="ident" id="5944504"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944505">.</span><span class="ident" id="5944506">last</span><span class="op" id="5944510">;</span>&nbsp;<span class="ident" id="5944512"><a href="/go/token/position.go.html#5944499">f</a></span>&nbsp;<span class="op" id="5944514">!=</span>&nbsp;<span class="ident" id="5944517">nil</span>&nbsp;<span class="op" id="5944521">&amp;&amp;</span>&nbsp;<span class="ident" id="5944524"><a href="/go/token/position.go.html#5944499">f</a></span><span class="op" id="5944525">.</span><span class="ident" id="5944526">base</span>&nbsp;<span class="op" id="5944531">&lt;=</span>&nbsp;<span class="builtintype" id="5944534">int</span><span class="op" id="5944537">(</span><span class="ident" id="5944538"><a href="/go/token/position.go.html#5944428">p</a></span><span class="op" id="5944539">)</span>&nbsp;<span class="op" id="5944541">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5944544">int</span><span class="op" id="5944547">(</span><span class="ident" id="5944548"><a href="/go/token/position.go.html#5944428">p</a></span><span class="op" id="5944549">)</span>&nbsp;<span class="op" id="5944551">&lt;=</span>&nbsp;<span class="ident" id="5944554"><a href="/go/token/position.go.html#5944499">f</a></span><span class="op" id="5944555">.</span><span class="ident" id="5944556">base</span><span class="op" id="5944560">+</span><span class="ident" id="5944561"><a href="/go/token/position.go.html#5944499">f</a></span><span class="op" id="5944562">.</span><span class="ident" id="5944563">size</span>&nbsp;<span class="op" id="5944568">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944572"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944573">.</span><span class="ident" id="5944574">mutex</span><span class="op" id="5944579">.</span><span class="ident" id="5944580">RUnlock</span><span class="op" id="5944587">(</span><span class="op" id="5944588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944592">return</span>&nbsp;<span class="ident" id="5944599"><a href="/go/token/position.go.html#5944499">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944605">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944650">if</span>&nbsp;<span class="ident" id="5944653">i</span>&nbsp;<span class="op" id="5944655">:=</span>&nbsp;<span class="ident" id="5944658"><a href="/go/token/position.go.html#5944291">searchFiles</a></span><span class="op" id="5944669">(</span><span class="ident" id="5944670"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944671">.</span><span class="ident" id="5944672">files</span><span class="op" id="5944677">,</span>&nbsp;<span class="builtintype" id="5944679">int</span><span class="op" id="5944682">(</span><span class="ident" id="5944683"><a href="/go/token/position.go.html#5944428">p</a></span><span class="op" id="5944684">)</span><span class="op" id="5944685">)</span><span class="op" id="5944686">;</span>&nbsp;<span class="ident" id="5944688"><a href="/go/token/position.go.html#5944653">i</a></span>&nbsp;<span class="op" id="5944690">&gt;=</span>&nbsp;<span class="num" id="5944693">0</span>&nbsp;<span class="op" id="5944695">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944699">f</span>&nbsp;<span class="op" id="5944701">:=</span>&nbsp;<span class="ident" id="5944704"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944705">.</span><span class="ident" id="5944706">files</span><span class="op" id="5944711">[</span><span class="ident" id="5944712"><a href="/go/token/position.go.html#5944653">i</a></span><span class="op" id="5944713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5944717">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944768">if</span>&nbsp;<span class="builtintype" id="5944771">int</span><span class="op" id="5944774">(</span><span class="ident" id="5944775"><a href="/go/token/position.go.html#5944428">p</a></span><span class="op" id="5944776">)</span>&nbsp;<span class="op" id="5944778">&lt;=</span>&nbsp;<span class="ident" id="5944781"><a href="/go/token/position.go.html#5944699">f</a></span><span class="op" id="5944782">.</span><span class="ident" id="5944783">base</span><span class="op" id="5944787">+</span><span class="ident" id="5944788"><a href="/go/token/position.go.html#5944699">f</a></span><span class="op" id="5944789">.</span><span class="ident" id="5944790">size</span>&nbsp;<span class="op" id="5944795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944800"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944801">.</span><span class="ident" id="5944802">mutex</span><span class="op" id="5944807">.</span><span class="ident" id="5944808">RUnlock</span><span class="op" id="5944815">(</span><span class="op" id="5944816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944821"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944822">.</span><span class="ident" id="5944823">mutex</span><span class="op" id="5944828">.</span><span class="ident" id="5944829">Lock</span><span class="op" id="5944833">(</span><span class="op" id="5944834">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944839"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944840">.</span><span class="ident" id="5944841">last</span>&nbsp;<span class="op" id="5944846">=</span>&nbsp;<span class="ident" id="5944848"><a href="/go/token/position.go.html#5944699">f</a></span>&nbsp;<span class="comment" id="5944850">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944892"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944893">.</span><span class="ident" id="5944894">mutex</span><span class="op" id="5944899">.</span><span class="ident" id="5944900">Unlock</span><span class="op" id="5944906">(</span><span class="op" id="5944907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944912">return</span>&nbsp;<span class="ident" id="5944919"><a href="/go/token/position.go.html#5944699">f</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5944926">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5944929"><a href="/go/token/position.go.html#5944411">s</a></span><span class="op" id="5944930">.</span><span class="ident" id="5944931">mutex</span><span class="op" id="5944936">.</span><span class="ident" id="5944937">RUnlock</span><span class="op" id="5944944">(</span><span class="op" id="5944945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5944948">return</span>&nbsp;<span class="ident" id="5944955">nil</span><br>
<span class="lineno"></span><span class="op" id="5944959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944962">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="5945017">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="5945076">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5945098">//</span><br>
<span class="lineno"></span><span class="keyword" id="5945101">func</span>&nbsp;<span class="op" id="5945106">(</span><span class="ident" id="5945107">s</span>&nbsp;<span class="op" id="5945109">*</span><span class="ident" id="5945110"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5945117">)</span>&nbsp;<span class="ident" id="5945119">File</span><span class="op" id="5945123">(</span><span class="ident" id="5945124">p</span>&nbsp;<span class="ident" id="5945126"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5945129">)</span>&nbsp;<span class="op" id="5945131">(</span><span class="ident" id="5945132">f</span>&nbsp;<span class="op" id="5945134">*</span><span class="ident" id="5945135"><a href="/go/token/position.go.html#5935090">File</a></span><span class="op" id="5945139">)</span>&nbsp;<span class="op" id="5945141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945144">if</span>&nbsp;<span class="ident" id="5945147"><a href="/go/token/position.go.html#5945124">p</a></span>&nbsp;<span class="op" id="5945149">!=</span>&nbsp;<span class="ident" id="5945152"><a href="/go/token/position.go.html#5934767">NoPos</a></span>&nbsp;<span class="op" id="5945158">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945162"><a href="/go/token/position.go.html#5945132">f</a></span>&nbsp;<span class="op" id="5945164">=</span>&nbsp;<span class="ident" id="5945166"><a href="/go/token/position.go.html#5945107">s</a></span><span class="op" id="5945167">.</span><span class="ident" id="5945168">file</span><span class="op" id="5945172">(</span><span class="ident" id="5945173"><a href="/go/token/position.go.html#5945124">p</a></span><span class="op" id="5945174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945180">return</span><br>
<span class="lineno"></span><span class="op" id="5945187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5945190">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5945260">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="5945333">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5945391">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5945431">//</span><br>
<span class="lineno">445</span><span class="keyword" id="5945434">func</span>&nbsp;<span class="op" id="5945439">(</span><span class="ident" id="5945440">s</span>&nbsp;<span class="op" id="5945442">*</span><span class="ident" id="5945443"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5945450">)</span>&nbsp;<span class="ident" id="5945452">PositionFor</span><span class="op" id="5945463">(</span><span class="ident" id="5945464">p</span>&nbsp;<span class="ident" id="5945466"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5945469">,</span>&nbsp;<span class="ident" id="5945471">adjusted</span>&nbsp;<span class="builtintype" id="5945480">bool</span><span class="op" id="5945484">)</span>&nbsp;<span class="op" id="5945486">(</span><span class="ident" id="5945487">pos</span>&nbsp;<span class="ident" id="5945491"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5945499">)</span>&nbsp;<span class="op" id="5945501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945504">if</span>&nbsp;<span class="ident" id="5945507"><a href="/go/token/position.go.html#5945464">p</a></span>&nbsp;<span class="op" id="5945509">!=</span>&nbsp;<span class="ident" id="5945512"><a href="/go/token/position.go.html#5934767">NoPos</a></span>&nbsp;<span class="op" id="5945518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945522">if</span>&nbsp;<span class="ident" id="5945525">f</span>&nbsp;<span class="op" id="5945527">:=</span>&nbsp;<span class="ident" id="5945530"><a href="/go/token/position.go.html#5945440">s</a></span><span class="op" id="5945531">.</span><span class="ident" id="5945532">file</span><span class="op" id="5945536">(</span><span class="ident" id="5945537"><a href="/go/token/position.go.html#5945464">p</a></span><span class="op" id="5945538">)</span><span class="op" id="5945539">;</span>&nbsp;<span class="ident" id="5945541"><a href="/go/token/position.go.html#5945525">f</a></span>&nbsp;<span class="op" id="5945543">!=</span>&nbsp;<span class="ident" id="5945546">nil</span>&nbsp;<span class="op" id="5945550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5945555"><a href="/go/token/position.go.html#5945487">pos</a></span>&nbsp;<span class="op" id="5945559">=</span>&nbsp;<span class="ident" id="5945561"><a href="/go/token/position.go.html#5945525">f</a></span><span class="op" id="5945562">.</span><span class="ident" id="5945563">position</span><span class="op" id="5945571">(</span><span class="ident" id="5945572"><a href="/go/token/position.go.html#5945464">p</a></span><span class="op" id="5945573">,</span>&nbsp;<span class="ident" id="5945575"><a href="/go/token/position.go.html#5945471">adjusted</a></span><span class="op" id="5945583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945587">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5945590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945593">return</span><br>
<span class="lineno"></span><span class="op" id="5945600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5945603">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="5945670">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="5945744">//</span><br>
<span class="lineno"></span><span class="keyword" id="5945747">func</span>&nbsp;<span class="op" id="5945752">(</span><span class="ident" id="5945753">s</span>&nbsp;<span class="op" id="5945755">*</span><span class="ident" id="5945756"><a href="/go/token/position.go.html#5942060">FileSet</a></span><span class="op" id="5945763">)</span>&nbsp;<span class="ident" id="5945765">Position</span><span class="op" id="5945773">(</span><span class="ident" id="5945774">p</span>&nbsp;<span class="ident" id="5945776"><a href="/go/token/position.go.html#5934489">Pos</a></span><span class="op" id="5945779">)</span>&nbsp;<span class="op" id="5945781">(</span><span class="ident" id="5945782">pos</span>&nbsp;<span class="ident" id="5945786"><a href="/go/token/position.go.html#5932658">Position</a></span><span class="op" id="5945794">)</span>&nbsp;<span class="op" id="5945796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5945799">return</span>&nbsp;<span class="ident" id="5945806"><a href="/go/token/position.go.html#5945753">s</a></span><span class="op" id="5945807">.</span><span class="ident" id="5945808">PositionFor</span><span class="op" id="5945819">(</span><span class="ident" id="5945820"><a href="/go/token/position.go.html#5945774">p</a></span><span class="op" id="5945821">,</span>&nbsp;<span class="ident" id="5945823">true</span><span class="op" id="5945827">)</span><br>
<span class="lineno"></span><span class="op" id="5945829">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="5945832">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5945913">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945934">func</span>&nbsp;<span class="ident" id="5945939">searchInts</span><span class="op" id="5945949">(</span><span class="ident" id="5945950">a</span>&nbsp;<span class="op" id="5945952">[</span><span class="op" id="5945953">]</span><span class="builtintype" id="5945954">int</span><span class="op" id="5945957">,</span>&nbsp;<span class="ident" id="5945959">x</span>&nbsp;<span class="builtintype" id="5945961">int</span><span class="op" id="5945964">)</span>&nbsp;<span class="builtintype" id="5945966">int</span>&nbsp;<span class="op" id="5945970">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5945973">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946030">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946034">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946109">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946113">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946183">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946249">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946316">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946375">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946433">i</span><span class="op" id="5946434">,</span>&nbsp;<span class="ident" id="5946436">j</span>&nbsp;<span class="op" id="5946438">:=</span>&nbsp;<span class="num" id="5946441">0</span><span class="op" id="5946442">,</span>&nbsp;<span class="builtinfunc" id="5946444">len</span><span class="op" id="5946447">(</span><span class="ident" id="5946448"><a href="/go/token/position.go.html#5945950">a</a></span><span class="op" id="5946449">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946452">for</span>&nbsp;<span class="ident" id="5946456"><a href="/go/token/position.go.html#5946433">i</a></span>&nbsp;<span class="op" id="5946458">&lt;</span>&nbsp;<span class="ident" id="5946460"><a href="/go/token/position.go.html#5946436">j</a></span>&nbsp;<span class="op" id="5946462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946466">h</span>&nbsp;<span class="op" id="5946468">:=</span>&nbsp;<span class="ident" id="5946471"><a href="/go/token/position.go.html#5946433">i</a></span>&nbsp;<span class="op" id="5946473">+</span>&nbsp;<span class="op" id="5946475">(</span><span class="ident" id="5946476"><a href="/go/token/position.go.html#5946436">j</a></span><span class="op" id="5946477">-</span><span class="ident" id="5946478"><a href="/go/token/position.go.html#5946433">i</a></span><span class="op" id="5946479">)</span><span class="op" id="5946480">/</span><span class="num" id="5946481">2</span>&nbsp;<span class="comment" id="5946483">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5946520">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946537">if</span>&nbsp;<span class="ident" id="5946540"><a href="/go/token/position.go.html#5945950">a</a></span><span class="op" id="5946541">[</span><span class="ident" id="5946542"><a href="/go/token/position.go.html#5946466">h</a></span><span class="op" id="5946543">]</span>&nbsp;<span class="op" id="5946545">&lt;=</span>&nbsp;<span class="ident" id="5946548"><a href="/go/token/position.go.html#5945959">x</a></span>&nbsp;<span class="op" id="5946550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946555"><a href="/go/token/position.go.html#5946433">i</a></span>&nbsp;<span class="op" id="5946557">=</span>&nbsp;<span class="ident" id="5946559"><a href="/go/token/position.go.html#5946466">h</a></span>&nbsp;<span class="op" id="5946561">+</span>&nbsp;<span class="num" id="5946563">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946567">}</span>&nbsp;<span class="keyword" id="5946569">else</span>&nbsp;<span class="op" id="5946574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5946579"><a href="/go/token/position.go.html#5946436">j</a></span>&nbsp;<span class="op" id="5946581">=</span>&nbsp;<span class="ident" id="5946583"><a href="/go/token/position.go.html#5946466">h</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5946590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5946593">return</span>&nbsp;<span class="ident" id="5946600"><a href="/go/token/position.go.html#5946433">i</a></span>&nbsp;<span class="op" id="5946602">-</span>&nbsp;<span class="num" id="5946604">1</span><br>
<span class="lineno">485</span><span class="op" id="5946606">}</span>
</div>
</body>
</html>
