<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8019988">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8020044">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8020098">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8020149">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8020182">package</span>&nbsp;<span class="ident" id="8020190">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8020195">import</span>&nbsp;<span class="op" id="8020202">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020205">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020214">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020220">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020231">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020242">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020253">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8020264">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8020271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8020274">func</span>&nbsp;<span class="ident" id="8020279">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="8020312">(</span><span class="ident" id="8020313">t</span>&nbsp;<span class="op" id="8020315">*</span><span class="ident" id="8020316">testing</span><span class="op" id="8020323">.</span><span class="ident" id="8020324">T</span><span class="op" id="8020325">)</span>&nbsp;<span class="op" id="8020327">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020330">addr</span>&nbsp;<span class="op" id="8020335">:=</span>&nbsp;<span class="ident" id="8020338">testUnixAddr</span><span class="op" id="8020350">(</span><span class="op" id="8020351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020354">la</span><span class="op" id="8020356">,</span>&nbsp;<span class="ident" id="8020358">err</span>&nbsp;<span class="op" id="8020362">:=</span>&nbsp;<span class="ident" id="8020365">ResolveUnixAddr</span><span class="op" id="8020380">(</span><span class="string" id="8020381">&#34;unixgram&#34;</span><span class="op" id="8020391">,</span>&nbsp;<span class="ident" id="8020393">addr</span><span class="op" id="8020397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020400">if</span>&nbsp;<span class="ident" id="8020403">err</span>&nbsp;<span class="op" id="8020407">!=</span>&nbsp;<span class="ident" id="8020410">nil</span>&nbsp;<span class="op" id="8020414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020418">t</span><span class="op" id="8020419">.</span><span class="ident" id="8020420">Fatalf</span><span class="op" id="8020426">(</span><span class="string" id="8020427">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8020455">,</span>&nbsp;<span class="ident" id="8020457">err</span><span class="op" id="8020460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020463">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020466">c</span><span class="op" id="8020467">,</span>&nbsp;<span class="ident" id="8020469">err</span>&nbsp;<span class="op" id="8020473">:=</span>&nbsp;<span class="ident" id="8020476">ListenUnixgram</span><span class="op" id="8020490">(</span><span class="string" id="8020491">&#34;unixgram&#34;</span><span class="op" id="8020501">,</span>&nbsp;<span class="ident" id="8020503">la</span><span class="op" id="8020505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020508">if</span>&nbsp;<span class="ident" id="8020511">err</span>&nbsp;<span class="op" id="8020515">!=</span>&nbsp;<span class="ident" id="8020518">nil</span>&nbsp;<span class="op" id="8020522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020526">t</span><span class="op" id="8020527">.</span><span class="ident" id="8020528">Fatalf</span><span class="op" id="8020534">(</span><span class="string" id="8020535">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8020562">,</span>&nbsp;<span class="ident" id="8020564">err</span><span class="op" id="8020567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020573">defer</span>&nbsp;<span class="keyword" id="8020579">func</span><span class="op" id="8020583">(</span><span class="op" id="8020584">)</span>&nbsp;<span class="op" id="8020586">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020590">c</span><span class="op" id="8020591">.</span><span class="ident" id="8020592">Close</span><span class="op" id="8020597">(</span><span class="op" id="8020598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020602">os</span><span class="op" id="8020604">.</span><span class="ident" id="8020605">Remove</span><span class="op" id="8020611">(</span><span class="ident" id="8020612">addr</span><span class="op" id="8020616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020619">}</span><span class="op" id="8020620">(</span><span class="op" id="8020621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020625">off</span>&nbsp;<span class="op" id="8020629">:=</span>&nbsp;<span class="builtinfunc" id="8020632">make</span><span class="op" id="8020636">(</span><span class="keyword" id="8020637">chan</span>&nbsp;<span class="builtintype" id="8020642">bool</span><span class="op" id="8020646">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020649">data</span>&nbsp;<span class="op" id="8020654">:=</span>&nbsp;<span class="op" id="8020657">[</span><span class="num" id="8020658">5</span><span class="op" id="8020659">]</span><span class="builtintype" id="8020660">byte</span><span class="op" id="8020664">{</span><span class="num" id="8020665">1</span><span class="op" id="8020666">,</span>&nbsp;<span class="num" id="8020668">2</span><span class="op" id="8020669">,</span>&nbsp;<span class="num" id="8020671">3</span><span class="op" id="8020672">,</span>&nbsp;<span class="num" id="8020674">4</span><span class="op" id="8020675">,</span>&nbsp;<span class="num" id="8020677">5</span><span class="op" id="8020678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020681">go</span>&nbsp;<span class="keyword" id="8020684">func</span><span class="op" id="8020688">(</span><span class="op" id="8020689">)</span>&nbsp;<span class="op" id="8020691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020695">defer</span>&nbsp;<span class="keyword" id="8020701">func</span><span class="op" id="8020705">(</span><span class="op" id="8020706">)</span>&nbsp;<span class="op" id="8020708">{</span>&nbsp;<span class="ident" id="8020710">off</span>&nbsp;<span class="op" id="8020714">&lt;-</span>&nbsp;<span class="builtintype" id="8020717">true</span>&nbsp;<span class="op" id="8020722">}</span><span class="op" id="8020723">(</span><span class="op" id="8020724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020728">s</span><span class="op" id="8020729">,</span>&nbsp;<span class="ident" id="8020731">err</span>&nbsp;<span class="op" id="8020735">:=</span>&nbsp;<span class="ident" id="8020738">syscall</span><span class="op" id="8020745">.</span><span class="ident" id="8020746">Socket</span><span class="op" id="8020752">(</span><span class="ident" id="8020753">syscall</span><span class="op" id="8020760">.</span><span class="ident" id="8020761">AF_UNIX</span><span class="op" id="8020768">,</span>&nbsp;<span class="ident" id="8020770">syscall</span><span class="op" id="8020777">.</span><span class="ident" id="8020778">SOCK_DGRAM</span><span class="op" id="8020788">,</span>&nbsp;<span class="num" id="8020790">0</span><span class="op" id="8020791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020795">if</span>&nbsp;<span class="ident" id="8020798">err</span>&nbsp;<span class="op" id="8020802">!=</span>&nbsp;<span class="ident" id="8020805">nil</span>&nbsp;<span class="op" id="8020809">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020814">t</span><span class="op" id="8020815">.</span><span class="ident" id="8020816">Errorf</span><span class="op" id="8020822">(</span><span class="string" id="8020823">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8020850">,</span>&nbsp;<span class="ident" id="8020852">err</span><span class="op" id="8020855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020860">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020873">defer</span>&nbsp;<span class="ident" id="8020879">syscall</span><span class="op" id="8020886">.</span><span class="ident" id="8020887">Close</span><span class="op" id="8020892">(</span><span class="ident" id="8020893">s</span><span class="op" id="8020894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020898">rsa</span>&nbsp;<span class="op" id="8020902">:=</span>&nbsp;<span class="op" id="8020905">&amp;</span><span class="ident" id="8020906">syscall</span><span class="op" id="8020913">.</span><span class="ident" id="8020914">SockaddrUnix</span><span class="op" id="8020926">{</span><span class="ident" id="8020927">Name</span><span class="op" id="8020931">:</span>&nbsp;<span class="ident" id="8020933">addr</span><span class="op" id="8020937">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020941">if</span>&nbsp;<span class="ident" id="8020944">err</span>&nbsp;<span class="op" id="8020948">:=</span>&nbsp;<span class="ident" id="8020951">syscall</span><span class="op" id="8020958">.</span><span class="ident" id="8020959">Sendto</span><span class="op" id="8020965">(</span><span class="ident" id="8020966">s</span><span class="op" id="8020967">,</span>&nbsp;<span class="ident" id="8020969">data</span><span class="op" id="8020973">[</span><span class="op" id="8020974">:</span><span class="op" id="8020975">]</span><span class="op" id="8020976">,</span>&nbsp;<span class="num" id="8020978">0</span><span class="op" id="8020979">,</span>&nbsp;<span class="ident" id="8020981">rsa</span><span class="op" id="8020984">)</span><span class="op" id="8020985">;</span>&nbsp;<span class="ident" id="8020987">err</span>&nbsp;<span class="op" id="8020991">!=</span>&nbsp;<span class="ident" id="8020994">nil</span>&nbsp;<span class="op" id="8020998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021003">t</span><span class="op" id="8021004">.</span><span class="ident" id="8021005">Errorf</span><span class="op" id="8021011">(</span><span class="string" id="8021012">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8021039">,</span>&nbsp;<span class="ident" id="8021041">err</span><span class="op" id="8021044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021049">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021061">}</span><span class="op" id="8021062">(</span><span class="op" id="8021063">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021067">&lt;-</span><span class="ident" id="8021069">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021074">b</span>&nbsp;<span class="op" id="8021076">:=</span>&nbsp;<span class="builtinfunc" id="8021079">make</span><span class="op" id="8021083">(</span><span class="op" id="8021084">[</span><span class="op" id="8021085">]</span><span class="builtintype" id="8021086">byte</span><span class="op" id="8021090">,</span>&nbsp;<span class="num" id="8021092">64</span><span class="op" id="8021094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021097">c</span><span class="op" id="8021098">.</span><span class="ident" id="8021099">SetReadDeadline</span><span class="op" id="8021114">(</span><span class="ident" id="8021115">time</span><span class="op" id="8021119">.</span><span class="ident" id="8021120">Now</span><span class="op" id="8021123">(</span><span class="op" id="8021124">)</span><span class="op" id="8021125">.</span><span class="ident" id="8021126">Add</span><span class="op" id="8021129">(</span><span class="num" id="8021130">100</span>&nbsp;<span class="op" id="8021134">*</span>&nbsp;<span class="ident" id="8021136">time</span><span class="op" id="8021140">.</span><span class="ident" id="8021141">Millisecond</span><span class="op" id="8021152">)</span><span class="op" id="8021153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021156">n</span><span class="op" id="8021157">,</span>&nbsp;<span class="ident" id="8021159">from</span><span class="op" id="8021163">,</span>&nbsp;<span class="ident" id="8021165">err</span>&nbsp;<span class="op" id="8021169">:=</span>&nbsp;<span class="ident" id="8021172">c</span><span class="op" id="8021173">.</span><span class="ident" id="8021174">ReadFrom</span><span class="op" id="8021182">(</span><span class="ident" id="8021183">b</span><span class="op" id="8021184">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021187">if</span>&nbsp;<span class="ident" id="8021190">err</span>&nbsp;<span class="op" id="8021194">!=</span>&nbsp;<span class="ident" id="8021197">nil</span>&nbsp;<span class="op" id="8021201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021205">t</span><span class="op" id="8021206">.</span><span class="ident" id="8021207">Fatalf</span><span class="op" id="8021213">(</span><span class="string" id="8021214">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8021244">,</span>&nbsp;<span class="ident" id="8021246">err</span><span class="op" id="8021249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021255">if</span>&nbsp;<span class="ident" id="8021258">from</span>&nbsp;<span class="op" id="8021263">!=</span>&nbsp;<span class="ident" id="8021266">nil</span>&nbsp;<span class="op" id="8021270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021274">t</span><span class="op" id="8021275">.</span><span class="ident" id="8021276">Fatalf</span><span class="op" id="8021282">(</span><span class="string" id="8021283">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8021307">,</span>&nbsp;<span class="ident" id="8021309">from</span><span class="op" id="8021313">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021319">if</span>&nbsp;<span class="op" id="8021322">!</span><span class="ident" id="8021323">bytes</span><span class="op" id="8021328">.</span><span class="ident" id="8021329">Equal</span><span class="op" id="8021334">(</span><span class="ident" id="8021335">b</span><span class="op" id="8021336">[</span><span class="op" id="8021337">:</span><span class="ident" id="8021338">n</span><span class="op" id="8021339">]</span><span class="op" id="8021340">,</span>&nbsp;<span class="ident" id="8021342">data</span><span class="op" id="8021346">[</span><span class="op" id="8021347">:</span><span class="op" id="8021348">]</span><span class="op" id="8021349">)</span>&nbsp;<span class="op" id="8021351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021355">t</span><span class="op" id="8021356">.</span><span class="ident" id="8021357">Fatalf</span><span class="op" id="8021363">(</span><span class="string" id="8021364">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8021381">,</span>&nbsp;<span class="ident" id="8021383">b</span><span class="op" id="8021384">[</span><span class="op" id="8021385">:</span><span class="ident" id="8021386">n</span><span class="op" id="8021387">]</span><span class="op" id="8021388">,</span>&nbsp;<span class="ident" id="8021390">data</span><span class="op" id="8021394">[</span><span class="op" id="8021395">:</span><span class="op" id="8021396">]</span><span class="op" id="8021397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021400">}</span><br>
<span class="lineno"></span><span class="op" id="8021402">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8021405">func</span>&nbsp;<span class="ident" id="8021410">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="8021445">(</span><span class="ident" id="8021446">t</span>&nbsp;<span class="op" id="8021448">*</span><span class="ident" id="8021449">testing</span><span class="op" id="8021456">.</span><span class="ident" id="8021457">T</span><span class="op" id="8021458">)</span>&nbsp;<span class="op" id="8021460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021463">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021520">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021586">addr</span>&nbsp;<span class="op" id="8021591">:=</span>&nbsp;<span class="ident" id="8021594">testUnixAddr</span><span class="op" id="8021606">(</span><span class="op" id="8021607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021610">la</span><span class="op" id="8021612">,</span>&nbsp;<span class="ident" id="8021614">err</span>&nbsp;<span class="op" id="8021618">:=</span>&nbsp;<span class="ident" id="8021621">ResolveUnixAddr</span><span class="op" id="8021636">(</span><span class="string" id="8021637">&#34;unixgram&#34;</span><span class="op" id="8021647">,</span>&nbsp;<span class="ident" id="8021649">addr</span><span class="op" id="8021653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021656">if</span>&nbsp;<span class="ident" id="8021659">err</span>&nbsp;<span class="op" id="8021663">!=</span>&nbsp;<span class="ident" id="8021666">nil</span>&nbsp;<span class="op" id="8021670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021674">t</span><span class="op" id="8021675">.</span><span class="ident" id="8021676">Fatalf</span><span class="op" id="8021682">(</span><span class="string" id="8021683">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8021711">,</span>&nbsp;<span class="ident" id="8021713">err</span><span class="op" id="8021716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021719">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021722">c</span><span class="op" id="8021723">,</span>&nbsp;<span class="ident" id="8021725">err</span>&nbsp;<span class="op" id="8021729">:=</span>&nbsp;<span class="ident" id="8021732">ListenUnixgram</span><span class="op" id="8021746">(</span><span class="string" id="8021747">&#34;unixgram&#34;</span><span class="op" id="8021757">,</span>&nbsp;<span class="ident" id="8021759">la</span><span class="op" id="8021761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021764">if</span>&nbsp;<span class="ident" id="8021767">err</span>&nbsp;<span class="op" id="8021771">!=</span>&nbsp;<span class="ident" id="8021774">nil</span>&nbsp;<span class="op" id="8021778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021782">t</span><span class="op" id="8021783">.</span><span class="ident" id="8021784">Fatalf</span><span class="op" id="8021790">(</span><span class="string" id="8021791">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8021818">,</span>&nbsp;<span class="ident" id="8021820">err</span><span class="op" id="8021823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021829">defer</span>&nbsp;<span class="keyword" id="8021835">func</span><span class="op" id="8021839">(</span><span class="op" id="8021840">)</span>&nbsp;<span class="op" id="8021842">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021846">c</span><span class="op" id="8021847">.</span><span class="ident" id="8021848">Close</span><span class="op" id="8021853">(</span><span class="op" id="8021854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021858">os</span><span class="op" id="8021860">.</span><span class="ident" id="8021861">Remove</span><span class="op" id="8021867">(</span><span class="ident" id="8021868">addr</span><span class="op" id="8021872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021875">}</span><span class="op" id="8021876">(</span><span class="op" id="8021877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021881">off</span>&nbsp;<span class="op" id="8021885">:=</span>&nbsp;<span class="builtinfunc" id="8021888">make</span><span class="op" id="8021892">(</span><span class="keyword" id="8021893">chan</span>&nbsp;<span class="builtintype" id="8021898">bool</span><span class="op" id="8021902">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021905">go</span>&nbsp;<span class="keyword" id="8021908">func</span><span class="op" id="8021912">(</span><span class="op" id="8021913">)</span>&nbsp;<span class="op" id="8021915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021919">defer</span>&nbsp;<span class="keyword" id="8021925">func</span><span class="op" id="8021929">(</span><span class="op" id="8021930">)</span>&nbsp;<span class="op" id="8021932">{</span>&nbsp;<span class="ident" id="8021934">off</span>&nbsp;<span class="op" id="8021938">&lt;-</span>&nbsp;<span class="builtintype" id="8021941">true</span>&nbsp;<span class="op" id="8021946">}</span><span class="op" id="8021947">(</span><span class="op" id="8021948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021952">c</span><span class="op" id="8021953">,</span>&nbsp;<span class="ident" id="8021955">err</span>&nbsp;<span class="op" id="8021959">:=</span>&nbsp;<span class="ident" id="8021962">DialUnix</span><span class="op" id="8021970">(</span><span class="string" id="8021971">&#34;unixgram&#34;</span><span class="op" id="8021981">,</span>&nbsp;<span class="ident" id="8021983">nil</span><span class="op" id="8021986">,</span>&nbsp;<span class="ident" id="8021988">la</span><span class="op" id="8021990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021994">if</span>&nbsp;<span class="ident" id="8021997">err</span>&nbsp;<span class="op" id="8022001">!=</span>&nbsp;<span class="ident" id="8022004">nil</span>&nbsp;<span class="op" id="8022008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022013">t</span><span class="op" id="8022014">.</span><span class="ident" id="8022015">Errorf</span><span class="op" id="8022021">(</span><span class="string" id="8022022">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8022043">,</span>&nbsp;<span class="ident" id="8022045">err</span><span class="op" id="8022048">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022066">defer</span>&nbsp;<span class="ident" id="8022072">c</span><span class="op" id="8022073">.</span><span class="ident" id="8022074">Close</span><span class="op" id="8022079">(</span><span class="op" id="8022080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022084">if</span>&nbsp;<span class="ident" id="8022087">_</span><span class="op" id="8022088">,</span>&nbsp;<span class="ident" id="8022090">err</span>&nbsp;<span class="op" id="8022094">:=</span>&nbsp;<span class="ident" id="8022097">c</span><span class="op" id="8022098">.</span><span class="ident" id="8022099">Write</span><span class="op" id="8022104">(</span><span class="op" id="8022105">[</span><span class="op" id="8022106">]</span><span class="builtintype" id="8022107">byte</span><span class="op" id="8022111">{</span><span class="num" id="8022112">1</span><span class="op" id="8022113">,</span>&nbsp;<span class="num" id="8022115">2</span><span class="op" id="8022116">,</span>&nbsp;<span class="num" id="8022118">3</span><span class="op" id="8022119">,</span>&nbsp;<span class="num" id="8022121">4</span><span class="op" id="8022122">,</span>&nbsp;<span class="num" id="8022124">5</span><span class="op" id="8022125">}</span><span class="op" id="8022126">)</span><span class="op" id="8022127">;</span>&nbsp;<span class="ident" id="8022129">err</span>&nbsp;<span class="op" id="8022133">!=</span>&nbsp;<span class="ident" id="8022136">nil</span>&nbsp;<span class="op" id="8022140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022145">t</span><span class="op" id="8022146">.</span><span class="ident" id="8022147">Errorf</span><span class="op" id="8022153">(</span><span class="string" id="8022154">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8022181">,</span>&nbsp;<span class="ident" id="8022183">err</span><span class="op" id="8022186">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022191">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022203">}</span><span class="op" id="8022204">(</span><span class="op" id="8022205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022209">&lt;-</span><span class="ident" id="8022211">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022216">c</span><span class="op" id="8022217">.</span><span class="ident" id="8022218">SetReadDeadline</span><span class="op" id="8022233">(</span><span class="ident" id="8022234">time</span><span class="op" id="8022238">.</span><span class="ident" id="8022239">Now</span><span class="op" id="8022242">(</span><span class="op" id="8022243">)</span><span class="op" id="8022244">.</span><span class="ident" id="8022245">Add</span><span class="op" id="8022248">(</span><span class="num" id="8022249">100</span>&nbsp;<span class="op" id="8022253">*</span>&nbsp;<span class="ident" id="8022255">time</span><span class="op" id="8022259">.</span><span class="ident" id="8022260">Millisecond</span><span class="op" id="8022271">)</span><span class="op" id="8022272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022275">_</span><span class="op" id="8022276">,</span>&nbsp;<span class="ident" id="8022278">from</span><span class="op" id="8022282">,</span>&nbsp;<span class="ident" id="8022284">err</span>&nbsp;<span class="op" id="8022288">:=</span>&nbsp;<span class="ident" id="8022291">c</span><span class="op" id="8022292">.</span><span class="ident" id="8022293">ReadFrom</span><span class="op" id="8022301">(</span><span class="ident" id="8022302">nil</span><span class="op" id="8022305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022308">if</span>&nbsp;<span class="ident" id="8022311">err</span>&nbsp;<span class="op" id="8022315">!=</span>&nbsp;<span class="ident" id="8022318">nil</span>&nbsp;<span class="op" id="8022322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022326">t</span><span class="op" id="8022327">.</span><span class="ident" id="8022328">Fatalf</span><span class="op" id="8022334">(</span><span class="string" id="8022335">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8022365">,</span>&nbsp;<span class="ident" id="8022367">err</span><span class="op" id="8022370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022373">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022376">if</span>&nbsp;<span class="ident" id="8022379">from</span>&nbsp;<span class="op" id="8022384">!=</span>&nbsp;<span class="ident" id="8022387">nil</span>&nbsp;<span class="op" id="8022391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022395">t</span><span class="op" id="8022396">.</span><span class="ident" id="8022397">Fatalf</span><span class="op" id="8022403">(</span><span class="string" id="8022404">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="8022428">,</span>&nbsp;<span class="ident" id="8022430">from</span><span class="op" id="8022434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022437">}</span><br>
<span class="lineno"></span><span class="op" id="8022439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8022442">func</span>&nbsp;<span class="ident" id="8022447">TestUnixgramAutobind</span><span class="op" id="8022467">(</span><span class="ident" id="8022468">t</span>&nbsp;<span class="op" id="8022470">*</span><span class="ident" id="8022471">testing</span><span class="op" id="8022478">.</span><span class="ident" id="8022479">T</span><span class="op" id="8022480">)</span>&nbsp;<span class="op" id="8022482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022485">if</span>&nbsp;<span class="ident" id="8022488">runtime</span><span class="op" id="8022495">.</span><span class="ident" id="8022496">GOOS</span>&nbsp;<span class="op" id="8022501">!=</span>&nbsp;<span class="string" id="8022504">&#34;linux&#34;</span>&nbsp;<span class="op" id="8022512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022516">t</span><span class="op" id="8022517">.</span><span class="ident" id="8022518">Skip</span><span class="op" id="8022522">(</span><span class="string" id="8022523">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8022557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022564">laddr</span>&nbsp;<span class="op" id="8022570">:=</span>&nbsp;<span class="op" id="8022573">&amp;</span><span class="ident" id="8022574">UnixAddr</span><span class="op" id="8022582">{</span><span class="ident" id="8022583">Name</span><span class="op" id="8022587">:</span>&nbsp;<span class="string" id="8022589">&#34;&#34;</span><span class="op" id="8022591">,</span>&nbsp;<span class="ident" id="8022593">Net</span><span class="op" id="8022596">:</span>&nbsp;<span class="string" id="8022598">&#34;unixgram&#34;</span><span class="op" id="8022608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022611">c1</span><span class="op" id="8022613">,</span>&nbsp;<span class="ident" id="8022615">err</span>&nbsp;<span class="op" id="8022619">:=</span>&nbsp;<span class="ident" id="8022622">ListenUnixgram</span><span class="op" id="8022636">(</span><span class="string" id="8022637">&#34;unixgram&#34;</span><span class="op" id="8022647">,</span>&nbsp;<span class="ident" id="8022649">laddr</span><span class="op" id="8022654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022657">if</span>&nbsp;<span class="ident" id="8022660">err</span>&nbsp;<span class="op" id="8022664">!=</span>&nbsp;<span class="ident" id="8022667">nil</span>&nbsp;<span class="op" id="8022671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022675">t</span><span class="op" id="8022676">.</span><span class="ident" id="8022677">Fatalf</span><span class="op" id="8022683">(</span><span class="string" id="8022684">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8022711">,</span>&nbsp;<span class="ident" id="8022713">err</span><span class="op" id="8022716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022719">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022722">defer</span>&nbsp;<span class="ident" id="8022728">c1</span><span class="op" id="8022730">.</span><span class="ident" id="8022731">Close</span><span class="op" id="8022736">(</span><span class="op" id="8022737">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8022741">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022775">autoAddr</span>&nbsp;<span class="op" id="8022784">:=</span>&nbsp;<span class="ident" id="8022787">c1</span><span class="op" id="8022789">.</span><span class="ident" id="8022790">LocalAddr</span><span class="op" id="8022799">(</span><span class="op" id="8022800">)</span><span class="op" id="8022801">.</span><span class="op" id="8022802">(</span><span class="op" id="8022803">*</span><span class="ident" id="8022804">UnixAddr</span><span class="op" id="8022812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022815">if</span>&nbsp;<span class="builtinfunc" id="8022818">len</span><span class="op" id="8022821">(</span><span class="ident" id="8022822">autoAddr</span><span class="op" id="8022830">.</span><span class="ident" id="8022831">Name</span><span class="op" id="8022835">)</span>&nbsp;<span class="op" id="8022837">&lt;=</span>&nbsp;<span class="num" id="8022840">1</span>&nbsp;<span class="op" id="8022842">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022846">t</span><span class="op" id="8022847">.</span><span class="ident" id="8022848">Fatalf</span><span class="op" id="8022854">(</span><span class="string" id="8022855">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8022885">,</span>&nbsp;<span class="ident" id="8022887">autoAddr</span><span class="op" id="8022895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8022901">if</span>&nbsp;<span class="ident" id="8022904">autoAddr</span><span class="op" id="8022912">.</span><span class="ident" id="8022913">Name</span><span class="op" id="8022917">[</span><span class="num" id="8022918">0</span><span class="op" id="8022919">]</span>&nbsp;<span class="op" id="8022921">!=</span>&nbsp;<span class="string" id="8022924">&#39;@&#39;</span>&nbsp;<span class="op" id="8022928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022932">t</span><span class="op" id="8022933">.</span><span class="ident" id="8022934">Fatalf</span><span class="op" id="8022940">(</span><span class="string" id="8022941">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="8022971">,</span>&nbsp;<span class="ident" id="8022973">autoAddr</span><span class="op" id="8022981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022984">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022988">c2</span><span class="op" id="8022990">,</span>&nbsp;<span class="ident" id="8022992">err</span>&nbsp;<span class="op" id="8022996">:=</span>&nbsp;<span class="ident" id="8022999">DialUnix</span><span class="op" id="8023007">(</span><span class="string" id="8023008">&#34;unixgram&#34;</span><span class="op" id="8023018">,</span>&nbsp;<span class="ident" id="8023020">nil</span><span class="op" id="8023023">,</span>&nbsp;<span class="ident" id="8023025">autoAddr</span><span class="op" id="8023033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023036">if</span>&nbsp;<span class="ident" id="8023039">err</span>&nbsp;<span class="op" id="8023043">!=</span>&nbsp;<span class="ident" id="8023046">nil</span>&nbsp;<span class="op" id="8023050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023054">t</span><span class="op" id="8023055">.</span><span class="ident" id="8023056">Fatalf</span><span class="op" id="8023062">(</span><span class="string" id="8023063">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8023084">,</span>&nbsp;<span class="ident" id="8023086">err</span><span class="op" id="8023089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023092">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023095">defer</span>&nbsp;<span class="ident" id="8023101">c2</span><span class="op" id="8023103">.</span><span class="ident" id="8023104">Close</span><span class="op" id="8023109">(</span><span class="op" id="8023110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023114">if</span>&nbsp;<span class="op" id="8023117">!</span><span class="ident" id="8023118">reflect</span><span class="op" id="8023125">.</span><span class="ident" id="8023126">DeepEqual</span><span class="op" id="8023135">(</span><span class="ident" id="8023136">c1</span><span class="op" id="8023138">.</span><span class="ident" id="8023139">LocalAddr</span><span class="op" id="8023148">(</span><span class="op" id="8023149">)</span><span class="op" id="8023150">,</span>&nbsp;<span class="ident" id="8023152">c2</span><span class="op" id="8023154">.</span><span class="ident" id="8023155">RemoteAddr</span><span class="op" id="8023165">(</span><span class="op" id="8023166">)</span><span class="op" id="8023167">)</span>&nbsp;<span class="op" id="8023169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023173">t</span><span class="op" id="8023174">.</span><span class="ident" id="8023175">Fatalf</span><span class="op" id="8023181">(</span><span class="string" id="8023182">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8023220">,</span>&nbsp;<span class="ident" id="8023222">c1</span><span class="op" id="8023224">.</span><span class="ident" id="8023225">LocalAddr</span><span class="op" id="8023234">(</span><span class="op" id="8023235">)</span><span class="op" id="8023236">,</span>&nbsp;<span class="ident" id="8023238">c2</span><span class="op" id="8023240">.</span><span class="ident" id="8023241">RemoteAddr</span><span class="op" id="8023251">(</span><span class="op" id="8023252">)</span><span class="op" id="8023253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023256">}</span><br>
<span class="lineno">140</span><span class="op" id="8023258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8023261">func</span>&nbsp;<span class="ident" id="8023266">TestUnixAutobindClose</span><span class="op" id="8023287">(</span><span class="ident" id="8023288">t</span>&nbsp;<span class="op" id="8023290">*</span><span class="ident" id="8023291">testing</span><span class="op" id="8023298">.</span><span class="ident" id="8023299">T</span><span class="op" id="8023300">)</span>&nbsp;<span class="op" id="8023302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023305">if</span>&nbsp;<span class="ident" id="8023308">runtime</span><span class="op" id="8023315">.</span><span class="ident" id="8023316">GOOS</span>&nbsp;<span class="op" id="8023321">!=</span>&nbsp;<span class="string" id="8023324">&#34;linux&#34;</span>&nbsp;<span class="op" id="8023332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023336">t</span><span class="op" id="8023337">.</span><span class="ident" id="8023338">Skip</span><span class="op" id="8023342">(</span><span class="string" id="8023343">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="8023377">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023383">laddr</span>&nbsp;<span class="op" id="8023389">:=</span>&nbsp;<span class="op" id="8023392">&amp;</span><span class="ident" id="8023393">UnixAddr</span><span class="op" id="8023401">{</span><span class="ident" id="8023402">Name</span><span class="op" id="8023406">:</span>&nbsp;<span class="string" id="8023408">&#34;&#34;</span><span class="op" id="8023410">,</span>&nbsp;<span class="ident" id="8023412">Net</span><span class="op" id="8023415">:</span>&nbsp;<span class="string" id="8023417">&#34;unix&#34;</span><span class="op" id="8023423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023426">ln</span><span class="op" id="8023428">,</span>&nbsp;<span class="ident" id="8023430">err</span>&nbsp;<span class="op" id="8023434">:=</span>&nbsp;<span class="ident" id="8023437">ListenUnix</span><span class="op" id="8023447">(</span><span class="string" id="8023448">&#34;unix&#34;</span><span class="op" id="8023454">,</span>&nbsp;<span class="ident" id="8023456">laddr</span><span class="op" id="8023461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023464">if</span>&nbsp;<span class="ident" id="8023467">err</span>&nbsp;<span class="op" id="8023471">!=</span>&nbsp;<span class="ident" id="8023474">nil</span>&nbsp;<span class="op" id="8023478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023482">t</span><span class="op" id="8023483">.</span><span class="ident" id="8023484">Fatalf</span><span class="op" id="8023490">(</span><span class="string" id="8023491">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8023514">,</span>&nbsp;<span class="ident" id="8023516">err</span><span class="op" id="8023519">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023525">ln</span><span class="op" id="8023527">.</span><span class="ident" id="8023528">Close</span><span class="op" id="8023533">(</span><span class="op" id="8023534">)</span><br>
<span class="lineno"></span><span class="op" id="8023536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8023539">func</span>&nbsp;<span class="ident" id="8023544">TestUnixgramWrite</span><span class="op" id="8023561">(</span><span class="ident" id="8023562">t</span>&nbsp;<span class="op" id="8023564">*</span><span class="ident" id="8023565">testing</span><span class="op" id="8023572">.</span><span class="ident" id="8023573">T</span><span class="op" id="8023574">)</span>&nbsp;<span class="op" id="8023576">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023579">addr</span>&nbsp;<span class="op" id="8023584">:=</span>&nbsp;<span class="ident" id="8023587">testUnixAddr</span><span class="op" id="8023599">(</span><span class="op" id="8023600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023603">laddr</span><span class="op" id="8023608">,</span>&nbsp;<span class="ident" id="8023610">err</span>&nbsp;<span class="op" id="8023614">:=</span>&nbsp;<span class="ident" id="8023617">ResolveUnixAddr</span><span class="op" id="8023632">(</span><span class="string" id="8023633">&#34;unixgram&#34;</span><span class="op" id="8023643">,</span>&nbsp;<span class="ident" id="8023645">addr</span><span class="op" id="8023649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023652">if</span>&nbsp;<span class="ident" id="8023655">err</span>&nbsp;<span class="op" id="8023659">!=</span>&nbsp;<span class="ident" id="8023662">nil</span>&nbsp;<span class="op" id="8023666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023670">t</span><span class="op" id="8023671">.</span><span class="ident" id="8023672">Fatalf</span><span class="op" id="8023678">(</span><span class="string" id="8023679">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8023707">,</span>&nbsp;<span class="ident" id="8023709">err</span><span class="op" id="8023712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023715">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023718">c</span><span class="op" id="8023719">,</span>&nbsp;<span class="ident" id="8023721">err</span>&nbsp;<span class="op" id="8023725">:=</span>&nbsp;<span class="ident" id="8023728">ListenPacket</span><span class="op" id="8023740">(</span><span class="string" id="8023741">&#34;unixgram&#34;</span><span class="op" id="8023751">,</span>&nbsp;<span class="ident" id="8023753">addr</span><span class="op" id="8023757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023760">if</span>&nbsp;<span class="ident" id="8023763">err</span>&nbsp;<span class="op" id="8023767">!=</span>&nbsp;<span class="ident" id="8023770">nil</span>&nbsp;<span class="op" id="8023774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023778">t</span><span class="op" id="8023779">.</span><span class="ident" id="8023780">Fatalf</span><span class="op" id="8023786">(</span><span class="string" id="8023787">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8023812">,</span>&nbsp;<span class="ident" id="8023814">err</span><span class="op" id="8023817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8023820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023823">defer</span>&nbsp;<span class="ident" id="8023829">os</span><span class="op" id="8023831">.</span><span class="ident" id="8023832">Remove</span><span class="op" id="8023838">(</span><span class="ident" id="8023839">addr</span><span class="op" id="8023843">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8023846">defer</span>&nbsp;<span class="ident" id="8023852">c</span><span class="op" id="8023853">.</span><span class="ident" id="8023854">Close</span><span class="op" id="8023859">(</span><span class="op" id="8023860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023864">testUnixgramWriteConn</span><span class="op" id="8023885">(</span><span class="ident" id="8023886">t</span><span class="op" id="8023887">,</span>&nbsp;<span class="ident" id="8023889">laddr</span><span class="op" id="8023894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023897">testUnixgramWritePacketConn</span><span class="op" id="8023924">(</span><span class="ident" id="8023925">t</span><span class="op" id="8023926">,</span>&nbsp;<span class="ident" id="8023928">laddr</span><span class="op" id="8023933">)</span><br>
<span class="lineno"></span><span class="op" id="8023935">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8023938">func</span>&nbsp;<span class="ident" id="8023943">testUnixgramWriteConn</span><span class="op" id="8023964">(</span><span class="ident" id="8023965">t</span>&nbsp;<span class="op" id="8023967">*</span><span class="ident" id="8023968">testing</span><span class="op" id="8023975">.</span><span class="ident" id="8023976">T</span><span class="op" id="8023977">,</span>&nbsp;<span class="ident" id="8023979">raddr</span>&nbsp;<span class="op" id="8023985">*</span><span class="ident" id="8023986">UnixAddr</span><span class="op" id="8023994">)</span>&nbsp;<span class="op" id="8023996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8023999">c</span><span class="op" id="8024000">,</span>&nbsp;<span class="ident" id="8024002">err</span>&nbsp;<span class="op" id="8024006">:=</span>&nbsp;<span class="ident" id="8024009">Dial</span><span class="op" id="8024013">(</span><span class="string" id="8024014">&#34;unixgram&#34;</span><span class="op" id="8024024">,</span>&nbsp;<span class="ident" id="8024026">raddr</span><span class="op" id="8024031">.</span><span class="ident" id="8024032">String</span><span class="op" id="8024038">(</span><span class="op" id="8024039">)</span><span class="op" id="8024040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024043">if</span>&nbsp;<span class="ident" id="8024046">err</span>&nbsp;<span class="op" id="8024050">!=</span>&nbsp;<span class="ident" id="8024053">nil</span>&nbsp;<span class="op" id="8024057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024061">t</span><span class="op" id="8024062">.</span><span class="ident" id="8024063">Fatalf</span><span class="op" id="8024069">(</span><span class="string" id="8024070">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8024087">,</span>&nbsp;<span class="ident" id="8024089">err</span><span class="op" id="8024092">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024098">defer</span>&nbsp;<span class="ident" id="8024104">c</span><span class="op" id="8024105">.</span><span class="ident" id="8024106">Close</span><span class="op" id="8024111">(</span><span class="op" id="8024112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024116">if</span>&nbsp;<span class="ident" id="8024119">_</span><span class="op" id="8024120">,</span>&nbsp;<span class="ident" id="8024122">err</span>&nbsp;<span class="op" id="8024126">:=</span>&nbsp;<span class="ident" id="8024129">c</span><span class="op" id="8024130">.</span><span class="op" id="8024131">(</span><span class="op" id="8024132">*</span><span class="ident" id="8024133">UnixConn</span><span class="op" id="8024141">)</span><span class="op" id="8024142">.</span><span class="ident" id="8024143">WriteToUnix</span><span class="op" id="8024154">(</span><span class="op" id="8024155">[</span><span class="op" id="8024156">]</span><span class="builtintype" id="8024157">byte</span><span class="op" id="8024161">(</span><span class="string" id="8024162">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8024195">)</span><span class="op" id="8024196">,</span>&nbsp;<span class="ident" id="8024198">raddr</span><span class="op" id="8024203">)</span><span class="op" id="8024204">;</span>&nbsp;<span class="ident" id="8024206">err</span>&nbsp;<span class="op" id="8024210">==</span>&nbsp;<span class="ident" id="8024213">nil</span>&nbsp;<span class="op" id="8024217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024221">t</span><span class="op" id="8024222">.</span><span class="ident" id="8024223">Fatal</span><span class="op" id="8024228">(</span><span class="string" id="8024229">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8024254">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024257">}</span>&nbsp;<span class="keyword" id="8024259">else</span>&nbsp;<span class="keyword" id="8024264">if</span>&nbsp;<span class="ident" id="8024267">err</span><span class="op" id="8024270">.</span><span class="op" id="8024271">(</span><span class="op" id="8024272">*</span><span class="ident" id="8024273">OpError</span><span class="op" id="8024280">)</span><span class="op" id="8024281">.</span><span class="ident" id="8024282">Err</span>&nbsp;<span class="op" id="8024286">!=</span>&nbsp;<span class="ident" id="8024289">ErrWriteToConnected</span>&nbsp;<span class="op" id="8024309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024313">t</span><span class="op" id="8024314">.</span><span class="ident" id="8024315">Fatalf</span><span class="op" id="8024321">(</span><span class="string" id="8024322">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8024374">,</span>&nbsp;<span class="ident" id="8024376">err</span><span class="op" id="8024379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024385">if</span>&nbsp;<span class="ident" id="8024388">_</span><span class="op" id="8024389">,</span>&nbsp;<span class="ident" id="8024391">err</span>&nbsp;<span class="op" id="8024395">=</span>&nbsp;<span class="ident" id="8024397">c</span><span class="op" id="8024398">.</span><span class="op" id="8024399">(</span><span class="op" id="8024400">*</span><span class="ident" id="8024401">UnixConn</span><span class="op" id="8024409">)</span><span class="op" id="8024410">.</span><span class="ident" id="8024411">WriteTo</span><span class="op" id="8024418">(</span><span class="op" id="8024419">[</span><span class="op" id="8024420">]</span><span class="builtintype" id="8024421">byte</span><span class="op" id="8024425">(</span><span class="string" id="8024426">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8024459">)</span><span class="op" id="8024460">,</span>&nbsp;<span class="ident" id="8024462">raddr</span><span class="op" id="8024467">)</span><span class="op" id="8024468">;</span>&nbsp;<span class="ident" id="8024470">err</span>&nbsp;<span class="op" id="8024474">==</span>&nbsp;<span class="ident" id="8024477">nil</span>&nbsp;<span class="op" id="8024481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024485">t</span><span class="op" id="8024486">.</span><span class="ident" id="8024487">Fatal</span><span class="op" id="8024492">(</span><span class="string" id="8024493">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8024514">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024517">}</span>&nbsp;<span class="keyword" id="8024519">else</span>&nbsp;<span class="keyword" id="8024524">if</span>&nbsp;<span class="ident" id="8024527">err</span><span class="op" id="8024530">.</span><span class="op" id="8024531">(</span><span class="op" id="8024532">*</span><span class="ident" id="8024533">OpError</span><span class="op" id="8024540">)</span><span class="op" id="8024541">.</span><span class="ident" id="8024542">Err</span>&nbsp;<span class="op" id="8024546">!=</span>&nbsp;<span class="ident" id="8024549">ErrWriteToConnected</span>&nbsp;<span class="op" id="8024569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024573">t</span><span class="op" id="8024574">.</span><span class="ident" id="8024575">Fatalf</span><span class="op" id="8024581">(</span><span class="string" id="8024582">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8024630">,</span>&nbsp;<span class="ident" id="8024632">err</span><span class="op" id="8024635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024641">if</span>&nbsp;<span class="ident" id="8024644">_</span><span class="op" id="8024645">,</span>&nbsp;<span class="ident" id="8024647">_</span><span class="op" id="8024648">,</span>&nbsp;<span class="ident" id="8024650">err</span>&nbsp;<span class="op" id="8024654">=</span>&nbsp;<span class="ident" id="8024656">c</span><span class="op" id="8024657">.</span><span class="op" id="8024658">(</span><span class="op" id="8024659">*</span><span class="ident" id="8024660">UnixConn</span><span class="op" id="8024668">)</span><span class="op" id="8024669">.</span><span class="ident" id="8024670">WriteMsgUnix</span><span class="op" id="8024682">(</span><span class="op" id="8024683">[</span><span class="op" id="8024684">]</span><span class="builtintype" id="8024685">byte</span><span class="op" id="8024689">(</span><span class="string" id="8024690">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8024723">)</span><span class="op" id="8024724">,</span>&nbsp;<span class="ident" id="8024726">nil</span><span class="op" id="8024729">,</span>&nbsp;<span class="ident" id="8024731">raddr</span><span class="op" id="8024736">)</span><span class="op" id="8024737">;</span>&nbsp;<span class="ident" id="8024739">err</span>&nbsp;<span class="op" id="8024743">==</span>&nbsp;<span class="ident" id="8024746">nil</span>&nbsp;<span class="op" id="8024750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024754">t</span><span class="op" id="8024755">.</span><span class="ident" id="8024756">Fatal</span><span class="op" id="8024761">(</span><span class="string" id="8024762">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8024783">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024786">}</span>&nbsp;<span class="keyword" id="8024788">else</span>&nbsp;<span class="keyword" id="8024793">if</span>&nbsp;<span class="ident" id="8024796">err</span><span class="op" id="8024799">.</span><span class="op" id="8024800">(</span><span class="op" id="8024801">*</span><span class="ident" id="8024802">OpError</span><span class="op" id="8024809">)</span><span class="op" id="8024810">.</span><span class="ident" id="8024811">Err</span>&nbsp;<span class="op" id="8024815">!=</span>&nbsp;<span class="ident" id="8024818">ErrWriteToConnected</span>&nbsp;<span class="op" id="8024838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024842">t</span><span class="op" id="8024843">.</span><span class="ident" id="8024844">Fatalf</span><span class="op" id="8024850">(</span><span class="string" id="8024851">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="8024904">,</span>&nbsp;<span class="ident" id="8024906">err</span><span class="op" id="8024909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8024912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8024915">if</span>&nbsp;<span class="ident" id="8024918">_</span><span class="op" id="8024919">,</span>&nbsp;<span class="ident" id="8024921">err</span>&nbsp;<span class="op" id="8024925">:=</span>&nbsp;<span class="ident" id="8024928">c</span><span class="op" id="8024929">.</span><span class="ident" id="8024930">Write</span><span class="op" id="8024935">(</span><span class="op" id="8024936">[</span><span class="op" id="8024937">]</span><span class="builtintype" id="8024938">byte</span><span class="op" id="8024942">(</span><span class="string" id="8024943">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8024976">)</span><span class="op" id="8024977">)</span><span class="op" id="8024978">;</span>&nbsp;<span class="ident" id="8024980">err</span>&nbsp;<span class="op" id="8024984">!=</span>&nbsp;<span class="ident" id="8024987">nil</span>&nbsp;<span class="op" id="8024991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8024995">t</span><span class="op" id="8024996">.</span><span class="ident" id="8024997">Fatalf</span><span class="op" id="8025003">(</span><span class="string" id="8025004">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8025022">,</span>&nbsp;<span class="ident" id="8025024">err</span><span class="op" id="8025027">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025030">}</span><br>
<span class="lineno"></span><span class="op" id="8025032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8025035">func</span>&nbsp;<span class="ident" id="8025040">testUnixgramWritePacketConn</span><span class="op" id="8025067">(</span><span class="ident" id="8025068">t</span>&nbsp;<span class="op" id="8025070">*</span><span class="ident" id="8025071">testing</span><span class="op" id="8025078">.</span><span class="ident" id="8025079">T</span><span class="op" id="8025080">,</span>&nbsp;<span class="ident" id="8025082">raddr</span>&nbsp;<span class="op" id="8025088">*</span><span class="ident" id="8025089">UnixAddr</span><span class="op" id="8025097">)</span>&nbsp;<span class="op" id="8025099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025102">addr</span>&nbsp;<span class="op" id="8025107">:=</span>&nbsp;<span class="ident" id="8025110">testUnixAddr</span><span class="op" id="8025122">(</span><span class="op" id="8025123">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025126">c</span><span class="op" id="8025127">,</span>&nbsp;<span class="ident" id="8025129">err</span>&nbsp;<span class="op" id="8025133">:=</span>&nbsp;<span class="ident" id="8025136">ListenPacket</span><span class="op" id="8025148">(</span><span class="string" id="8025149">&#34;unixgram&#34;</span><span class="op" id="8025159">,</span>&nbsp;<span class="ident" id="8025161">addr</span><span class="op" id="8025165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025168">if</span>&nbsp;<span class="ident" id="8025171">err</span>&nbsp;<span class="op" id="8025175">!=</span>&nbsp;<span class="ident" id="8025178">nil</span>&nbsp;<span class="op" id="8025182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025186">t</span><span class="op" id="8025187">.</span><span class="ident" id="8025188">Fatalf</span><span class="op" id="8025194">(</span><span class="string" id="8025195">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8025220">,</span>&nbsp;<span class="ident" id="8025222">err</span><span class="op" id="8025225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025231">defer</span>&nbsp;<span class="ident" id="8025237">os</span><span class="op" id="8025239">.</span><span class="ident" id="8025240">Remove</span><span class="op" id="8025246">(</span><span class="ident" id="8025247">addr</span><span class="op" id="8025251">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025254">defer</span>&nbsp;<span class="ident" id="8025260">c</span><span class="op" id="8025261">.</span><span class="ident" id="8025262">Close</span><span class="op" id="8025267">(</span><span class="op" id="8025268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025272">if</span>&nbsp;<span class="ident" id="8025275">_</span><span class="op" id="8025276">,</span>&nbsp;<span class="ident" id="8025278">err</span>&nbsp;<span class="op" id="8025282">:=</span>&nbsp;<span class="ident" id="8025285">c</span><span class="op" id="8025286">.</span><span class="op" id="8025287">(</span><span class="op" id="8025288">*</span><span class="ident" id="8025289">UnixConn</span><span class="op" id="8025297">)</span><span class="op" id="8025298">.</span><span class="ident" id="8025299">WriteToUnix</span><span class="op" id="8025310">(</span><span class="op" id="8025311">[</span><span class="op" id="8025312">]</span><span class="builtintype" id="8025313">byte</span><span class="op" id="8025317">(</span><span class="string" id="8025318">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8025346">)</span><span class="op" id="8025347">,</span>&nbsp;<span class="ident" id="8025349">raddr</span><span class="op" id="8025354">)</span><span class="op" id="8025355">;</span>&nbsp;<span class="ident" id="8025357">err</span>&nbsp;<span class="op" id="8025361">!=</span>&nbsp;<span class="ident" id="8025364">nil</span>&nbsp;<span class="op" id="8025368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025372">t</span><span class="op" id="8025373">.</span><span class="ident" id="8025374">Fatalf</span><span class="op" id="8025380">(</span><span class="string" id="8025381">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8025405">,</span>&nbsp;<span class="ident" id="8025407">err</span><span class="op" id="8025410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025413">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025416">if</span>&nbsp;<span class="ident" id="8025419">_</span><span class="op" id="8025420">,</span>&nbsp;<span class="ident" id="8025422">err</span>&nbsp;<span class="op" id="8025426">:=</span>&nbsp;<span class="ident" id="8025429">c</span><span class="op" id="8025430">.</span><span class="ident" id="8025431">WriteTo</span><span class="op" id="8025438">(</span><span class="op" id="8025439">[</span><span class="op" id="8025440">]</span><span class="builtintype" id="8025441">byte</span><span class="op" id="8025445">(</span><span class="string" id="8025446">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8025474">)</span><span class="op" id="8025475">,</span>&nbsp;<span class="ident" id="8025477">raddr</span><span class="op" id="8025482">)</span><span class="op" id="8025483">;</span>&nbsp;<span class="ident" id="8025485">err</span>&nbsp;<span class="op" id="8025489">!=</span>&nbsp;<span class="ident" id="8025492">nil</span>&nbsp;<span class="op" id="8025496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025500">t</span><span class="op" id="8025501">.</span><span class="ident" id="8025502">Fatalf</span><span class="op" id="8025508">(</span><span class="string" id="8025509">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8025529">,</span>&nbsp;<span class="ident" id="8025531">err</span><span class="op" id="8025534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025540">if</span>&nbsp;<span class="ident" id="8025543">_</span><span class="op" id="8025544">,</span>&nbsp;<span class="ident" id="8025546">_</span><span class="op" id="8025547">,</span>&nbsp;<span class="ident" id="8025549">err</span>&nbsp;<span class="op" id="8025553">:=</span>&nbsp;<span class="ident" id="8025556">c</span><span class="op" id="8025557">.</span><span class="op" id="8025558">(</span><span class="op" id="8025559">*</span><span class="ident" id="8025560">UnixConn</span><span class="op" id="8025568">)</span><span class="op" id="8025569">.</span><span class="ident" id="8025570">WriteMsgUnix</span><span class="op" id="8025582">(</span><span class="op" id="8025583">[</span><span class="op" id="8025584">]</span><span class="builtintype" id="8025585">byte</span><span class="op" id="8025589">(</span><span class="string" id="8025590">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8025618">)</span><span class="op" id="8025619">,</span>&nbsp;<span class="ident" id="8025621">nil</span><span class="op" id="8025624">,</span>&nbsp;<span class="ident" id="8025626">raddr</span><span class="op" id="8025631">)</span><span class="op" id="8025632">;</span>&nbsp;<span class="ident" id="8025634">err</span>&nbsp;<span class="op" id="8025638">!=</span>&nbsp;<span class="ident" id="8025641">nil</span>&nbsp;<span class="op" id="8025645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025649">t</span><span class="op" id="8025650">.</span><span class="ident" id="8025651">Fatalf</span><span class="op" id="8025657">(</span><span class="string" id="8025658">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8025683">,</span>&nbsp;<span class="ident" id="8025685">err</span><span class="op" id="8025688">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025694">if</span>&nbsp;<span class="ident" id="8025697">_</span><span class="op" id="8025698">,</span>&nbsp;<span class="ident" id="8025700">err</span>&nbsp;<span class="op" id="8025704">:=</span>&nbsp;<span class="ident" id="8025707">c</span><span class="op" id="8025708">.</span><span class="op" id="8025709">(</span><span class="op" id="8025710">*</span><span class="ident" id="8025711">UnixConn</span><span class="op" id="8025719">)</span><span class="op" id="8025720">.</span><span class="ident" id="8025721">Write</span><span class="op" id="8025726">(</span><span class="op" id="8025727">[</span><span class="op" id="8025728">]</span><span class="builtintype" id="8025729">byte</span><span class="op" id="8025733">(</span><span class="string" id="8025734">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8025762">)</span><span class="op" id="8025763">)</span><span class="op" id="8025764">;</span>&nbsp;<span class="ident" id="8025766">err</span>&nbsp;<span class="op" id="8025770">==</span>&nbsp;<span class="ident" id="8025773">nil</span>&nbsp;<span class="op" id="8025777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025781">t</span><span class="op" id="8025782">.</span><span class="ident" id="8025783">Fatal</span><span class="op" id="8025788">(</span><span class="string" id="8025789">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8025808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8025811">}</span><br>
<span class="lineno"></span><span class="op" id="8025813">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8025816">func</span>&nbsp;<span class="ident" id="8025821">TestUnixConnLocalAndRemoteNames</span><span class="op" id="8025852">(</span><span class="ident" id="8025853">t</span>&nbsp;<span class="op" id="8025855">*</span><span class="ident" id="8025856">testing</span><span class="op" id="8025863">.</span><span class="ident" id="8025864">T</span><span class="op" id="8025865">)</span>&nbsp;<span class="op" id="8025867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8025870">for</span>&nbsp;<span class="ident" id="8025874">_</span><span class="op" id="8025875">,</span>&nbsp;<span class="ident" id="8025877">laddr</span>&nbsp;<span class="op" id="8025883">:=</span>&nbsp;<span class="keyword" id="8025886">range</span>&nbsp;<span class="op" id="8025892">[</span><span class="op" id="8025893">]</span><span class="builtintype" id="8025894">string</span><span class="op" id="8025900">{</span><span class="string" id="8025901">&#34;&#34;</span><span class="op" id="8025903">,</span>&nbsp;<span class="ident" id="8025905">testUnixAddr</span><span class="op" id="8025917">(</span><span class="op" id="8025918">)</span><span class="op" id="8025919">}</span>&nbsp;<span class="op" id="8025921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025925">laddr</span>&nbsp;<span class="op" id="8025931">:=</span>&nbsp;<span class="ident" id="8025934">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025942">taddr</span>&nbsp;<span class="op" id="8025948">:=</span>&nbsp;<span class="ident" id="8025951">testUnixAddr</span><span class="op" id="8025963">(</span><span class="op" id="8025964">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8025968">ta</span><span class="op" id="8025970">,</span>&nbsp;<span class="ident" id="8025972">err</span>&nbsp;<span class="op" id="8025976">:=</span>&nbsp;<span class="ident" id="8025979">ResolveUnixAddr</span><span class="op" id="8025994">(</span><span class="string" id="8025995">&#34;unix&#34;</span><span class="op" id="8026001">,</span>&nbsp;<span class="ident" id="8026003">taddr</span><span class="op" id="8026008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026012">if</span>&nbsp;<span class="ident" id="8026015">err</span>&nbsp;<span class="op" id="8026019">!=</span>&nbsp;<span class="ident" id="8026022">nil</span>&nbsp;<span class="op" id="8026026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026031">t</span><span class="op" id="8026032">.</span><span class="ident" id="8026033">Fatalf</span><span class="op" id="8026039">(</span><span class="string" id="8026040">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8026068">,</span>&nbsp;<span class="ident" id="8026070">err</span><span class="op" id="8026073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026081">ln</span><span class="op" id="8026083">,</span>&nbsp;<span class="ident" id="8026085">err</span>&nbsp;<span class="op" id="8026089">:=</span>&nbsp;<span class="ident" id="8026092">ListenUnix</span><span class="op" id="8026102">(</span><span class="string" id="8026103">&#34;unix&#34;</span><span class="op" id="8026109">,</span>&nbsp;<span class="ident" id="8026111">ta</span><span class="op" id="8026113">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026117">if</span>&nbsp;<span class="ident" id="8026120">err</span>&nbsp;<span class="op" id="8026124">!=</span>&nbsp;<span class="ident" id="8026127">nil</span>&nbsp;<span class="op" id="8026131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026136">t</span><span class="op" id="8026137">.</span><span class="ident" id="8026138">Fatalf</span><span class="op" id="8026144">(</span><span class="string" id="8026145">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8026168">,</span>&nbsp;<span class="ident" id="8026170">err</span><span class="op" id="8026173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026181">defer</span>&nbsp;<span class="keyword" id="8026187">func</span><span class="op" id="8026191">(</span><span class="op" id="8026192">)</span>&nbsp;<span class="op" id="8026194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026199">ln</span><span class="op" id="8026201">.</span><span class="ident" id="8026202">Close</span><span class="op" id="8026207">(</span><span class="op" id="8026208">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026213">os</span><span class="op" id="8026215">.</span><span class="ident" id="8026216">Remove</span><span class="op" id="8026222">(</span><span class="ident" id="8026223">taddr</span><span class="op" id="8026228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026232">}</span><span class="op" id="8026233">(</span><span class="op" id="8026234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026239">done</span>&nbsp;<span class="op" id="8026244">:=</span>&nbsp;<span class="builtinfunc" id="8026247">make</span><span class="op" id="8026251">(</span><span class="keyword" id="8026252">chan</span>&nbsp;<span class="builtintype" id="8026257">int</span><span class="op" id="8026260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026264">go</span>&nbsp;<span class="ident" id="8026267">transponder</span><span class="op" id="8026278">(</span><span class="ident" id="8026279">t</span><span class="op" id="8026280">,</span>&nbsp;<span class="ident" id="8026282">ln</span><span class="op" id="8026284">,</span>&nbsp;<span class="ident" id="8026286">done</span><span class="op" id="8026290">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026295">la</span><span class="op" id="8026297">,</span>&nbsp;<span class="ident" id="8026299">err</span>&nbsp;<span class="op" id="8026303">:=</span>&nbsp;<span class="ident" id="8026306">ResolveUnixAddr</span><span class="op" id="8026321">(</span><span class="string" id="8026322">&#34;unix&#34;</span><span class="op" id="8026328">,</span>&nbsp;<span class="ident" id="8026330">laddr</span><span class="op" id="8026335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026339">if</span>&nbsp;<span class="ident" id="8026342">err</span>&nbsp;<span class="op" id="8026346">!=</span>&nbsp;<span class="ident" id="8026349">nil</span>&nbsp;<span class="op" id="8026353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026358">t</span><span class="op" id="8026359">.</span><span class="ident" id="8026360">Fatalf</span><span class="op" id="8026366">(</span><span class="string" id="8026367">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8026395">,</span>&nbsp;<span class="ident" id="8026397">err</span><span class="op" id="8026400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026404">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026408">c</span><span class="op" id="8026409">,</span>&nbsp;<span class="ident" id="8026411">err</span>&nbsp;<span class="op" id="8026415">:=</span>&nbsp;<span class="ident" id="8026418">DialUnix</span><span class="op" id="8026426">(</span><span class="string" id="8026427">&#34;unix&#34;</span><span class="op" id="8026433">,</span>&nbsp;<span class="ident" id="8026435">la</span><span class="op" id="8026437">,</span>&nbsp;<span class="ident" id="8026439">ta</span><span class="op" id="8026441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026445">if</span>&nbsp;<span class="ident" id="8026448">err</span>&nbsp;<span class="op" id="8026452">!=</span>&nbsp;<span class="ident" id="8026455">nil</span>&nbsp;<span class="op" id="8026459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026464">t</span><span class="op" id="8026465">.</span><span class="ident" id="8026466">Fatalf</span><span class="op" id="8026472">(</span><span class="string" id="8026473">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8026494">,</span>&nbsp;<span class="ident" id="8026496">err</span><span class="op" id="8026499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026507">defer</span>&nbsp;<span class="keyword" id="8026513">func</span><span class="op" id="8026517">(</span><span class="op" id="8026518">)</span>&nbsp;<span class="op" id="8026520">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026525">c</span><span class="op" id="8026526">.</span><span class="ident" id="8026527">Close</span><span class="op" id="8026532">(</span><span class="op" id="8026533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026538">if</span>&nbsp;<span class="ident" id="8026541">la</span>&nbsp;<span class="op" id="8026544">!=</span>&nbsp;<span class="ident" id="8026547">nil</span>&nbsp;<span class="op" id="8026551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026557">defer</span>&nbsp;<span class="ident" id="8026563">os</span><span class="op" id="8026565">.</span><span class="ident" id="8026566">Remove</span><span class="op" id="8026572">(</span><span class="ident" id="8026573">laddr</span><span class="op" id="8026578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026587">}</span><span class="op" id="8026588">(</span><span class="op" id="8026589">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026593">if</span>&nbsp;<span class="ident" id="8026596">_</span><span class="op" id="8026597">,</span>&nbsp;<span class="ident" id="8026599">err</span>&nbsp;<span class="op" id="8026603">:=</span>&nbsp;<span class="ident" id="8026606">c</span><span class="op" id="8026607">.</span><span class="ident" id="8026608">Write</span><span class="op" id="8026613">(</span><span class="op" id="8026614">[</span><span class="op" id="8026615">]</span><span class="builtintype" id="8026616">byte</span><span class="op" id="8026620">(</span><span class="string" id="8026621">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="8026658">)</span><span class="op" id="8026659">)</span><span class="op" id="8026660">;</span>&nbsp;<span class="ident" id="8026662">err</span>&nbsp;<span class="op" id="8026666">!=</span>&nbsp;<span class="ident" id="8026669">nil</span>&nbsp;<span class="op" id="8026673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026678">t</span><span class="op" id="8026679">.</span><span class="ident" id="8026680">Fatalf</span><span class="op" id="8026686">(</span><span class="string" id="8026687">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8026714">,</span>&nbsp;<span class="ident" id="8026716">err</span><span class="op" id="8026719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026728">switch</span>&nbsp;<span class="ident" id="8026735">runtime</span><span class="op" id="8026742">.</span><span class="ident" id="8026743">GOOS</span>&nbsp;<span class="op" id="8026748">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026752">case</span>&nbsp;<span class="string" id="8026757">&#34;android&#34;</span><span class="op" id="8026766">,</span>&nbsp;<span class="string" id="8026768">&#34;linux&#34;</span><span class="op" id="8026775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026780">if</span>&nbsp;<span class="ident" id="8026783">laddr</span>&nbsp;<span class="op" id="8026789">==</span>&nbsp;<span class="string" id="8026792">&#34;&#34;</span>&nbsp;<span class="op" id="8026795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8026801">laddr</span>&nbsp;<span class="op" id="8026807">=</span>&nbsp;<span class="string" id="8026809">&#34;@&#34;</span>&nbsp;<span class="comment" id="8026813">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026840">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026844">var</span>&nbsp;<span class="ident" id="8026848">connAddrs</span>&nbsp;<span class="op" id="8026858">=</span>&nbsp;<span class="op" id="8026860">[</span><span class="num" id="8026861">3</span><span class="op" id="8026862">]</span><span class="keyword" id="8026863">struct</span><span class="op" id="8026869">{</span>&nbsp;<span class="ident" id="8026871">got</span><span class="op" id="8026874">,</span>&nbsp;<span class="ident" id="8026876">want</span>&nbsp;<span class="ident" id="8026881">Addr</span>&nbsp;<span class="op" id="8026886">}</span><span class="op" id="8026887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026892">{</span><span class="ident" id="8026893">ln</span><span class="op" id="8026895">.</span><span class="ident" id="8026896">Addr</span><span class="op" id="8026900">(</span><span class="op" id="8026901">)</span><span class="op" id="8026902">,</span>&nbsp;<span class="ident" id="8026904">ta</span><span class="op" id="8026906">}</span><span class="op" id="8026907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026912">{</span><span class="ident" id="8026913">c</span><span class="op" id="8026914">.</span><span class="ident" id="8026915">LocalAddr</span><span class="op" id="8026924">(</span><span class="op" id="8026925">)</span><span class="op" id="8026926">,</span>&nbsp;<span class="op" id="8026928">&amp;</span><span class="ident" id="8026929">UnixAddr</span><span class="op" id="8026937">{</span><span class="ident" id="8026938">Name</span><span class="op" id="8026942">:</span>&nbsp;<span class="ident" id="8026944">laddr</span><span class="op" id="8026949">,</span>&nbsp;<span class="ident" id="8026951">Net</span><span class="op" id="8026954">:</span>&nbsp;<span class="string" id="8026956">&#34;unix&#34;</span><span class="op" id="8026962">}</span><span class="op" id="8026963">}</span><span class="op" id="8026964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026969">{</span><span class="ident" id="8026970">c</span><span class="op" id="8026971">.</span><span class="ident" id="8026972">RemoteAddr</span><span class="op" id="8026982">(</span><span class="op" id="8026983">)</span><span class="op" id="8026984">,</span>&nbsp;<span class="ident" id="8026986">ta</span><span class="op" id="8026988">}</span><span class="op" id="8026989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8026993">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8026997">for</span>&nbsp;<span class="ident" id="8027001">_</span><span class="op" id="8027002">,</span>&nbsp;<span class="ident" id="8027004">ca</span>&nbsp;<span class="op" id="8027007">:=</span>&nbsp;<span class="keyword" id="8027010">range</span>&nbsp;<span class="ident" id="8027016">connAddrs</span>&nbsp;<span class="op" id="8027026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027031">if</span>&nbsp;<span class="op" id="8027034">!</span><span class="ident" id="8027035">reflect</span><span class="op" id="8027042">.</span><span class="ident" id="8027043">DeepEqual</span><span class="op" id="8027052">(</span><span class="ident" id="8027053">ca</span><span class="op" id="8027055">.</span><span class="ident" id="8027056">got</span><span class="op" id="8027059">,</span>&nbsp;<span class="ident" id="8027061">ca</span><span class="op" id="8027063">.</span><span class="ident" id="8027064">want</span><span class="op" id="8027068">)</span>&nbsp;<span class="op" id="8027070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027076">t</span><span class="op" id="8027077">.</span><span class="ident" id="8027078">Fatalf</span><span class="op" id="8027084">(</span><span class="string" id="8027085">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8027108">,</span>&nbsp;<span class="ident" id="8027110">ca</span><span class="op" id="8027112">.</span><span class="ident" id="8027113">got</span><span class="op" id="8027116">,</span>&nbsp;<span class="ident" id="8027118">ca</span><span class="op" id="8027120">.</span><span class="ident" id="8027121">want</span><span class="op" id="8027125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027134">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027139">&lt;-</span><span class="ident" id="8027141">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027147">}</span><br>
<span class="lineno"></span><span class="op" id="8027149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8027152">func</span>&nbsp;<span class="ident" id="8027157">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="8027192">(</span><span class="ident" id="8027193">t</span>&nbsp;<span class="op" id="8027195">*</span><span class="ident" id="8027196">testing</span><span class="op" id="8027203">.</span><span class="ident" id="8027204">T</span><span class="op" id="8027205">)</span>&nbsp;<span class="op" id="8027207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027210">for</span>&nbsp;<span class="ident" id="8027214">_</span><span class="op" id="8027215">,</span>&nbsp;<span class="ident" id="8027217">laddr</span>&nbsp;<span class="op" id="8027223">:=</span>&nbsp;<span class="keyword" id="8027226">range</span>&nbsp;<span class="op" id="8027232">[</span><span class="op" id="8027233">]</span><span class="builtintype" id="8027234">string</span><span class="op" id="8027240">{</span><span class="string" id="8027241">&#34;&#34;</span><span class="op" id="8027243">,</span>&nbsp;<span class="ident" id="8027245">testUnixAddr</span><span class="op" id="8027257">(</span><span class="op" id="8027258">)</span><span class="op" id="8027259">}</span>&nbsp;<span class="op" id="8027261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027265">laddr</span>&nbsp;<span class="op" id="8027271">:=</span>&nbsp;<span class="ident" id="8027274">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027282">taddr</span>&nbsp;<span class="op" id="8027288">:=</span>&nbsp;<span class="ident" id="8027291">testUnixAddr</span><span class="op" id="8027303">(</span><span class="op" id="8027304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027308">ta</span><span class="op" id="8027310">,</span>&nbsp;<span class="ident" id="8027312">err</span>&nbsp;<span class="op" id="8027316">:=</span>&nbsp;<span class="ident" id="8027319">ResolveUnixAddr</span><span class="op" id="8027334">(</span><span class="string" id="8027335">&#34;unixgram&#34;</span><span class="op" id="8027345">,</span>&nbsp;<span class="ident" id="8027347">taddr</span><span class="op" id="8027352">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027356">if</span>&nbsp;<span class="ident" id="8027359">err</span>&nbsp;<span class="op" id="8027363">!=</span>&nbsp;<span class="ident" id="8027366">nil</span>&nbsp;<span class="op" id="8027370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027375">t</span><span class="op" id="8027376">.</span><span class="ident" id="8027377">Fatalf</span><span class="op" id="8027383">(</span><span class="string" id="8027384">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8027412">,</span>&nbsp;<span class="ident" id="8027414">err</span><span class="op" id="8027417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027425">c1</span><span class="op" id="8027427">,</span>&nbsp;<span class="ident" id="8027429">err</span>&nbsp;<span class="op" id="8027433">:=</span>&nbsp;<span class="ident" id="8027436">ListenUnixgram</span><span class="op" id="8027450">(</span><span class="string" id="8027451">&#34;unixgram&#34;</span><span class="op" id="8027461">,</span>&nbsp;<span class="ident" id="8027463">ta</span><span class="op" id="8027465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027469">if</span>&nbsp;<span class="ident" id="8027472">err</span>&nbsp;<span class="op" id="8027476">!=</span>&nbsp;<span class="ident" id="8027479">nil</span>&nbsp;<span class="op" id="8027483">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027488">t</span><span class="op" id="8027489">.</span><span class="ident" id="8027490">Fatalf</span><span class="op" id="8027496">(</span><span class="string" id="8027497">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8027524">,</span>&nbsp;<span class="ident" id="8027526">err</span><span class="op" id="8027529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027537">defer</span>&nbsp;<span class="keyword" id="8027543">func</span><span class="op" id="8027547">(</span><span class="op" id="8027548">)</span>&nbsp;<span class="op" id="8027550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027555">c1</span><span class="op" id="8027557">.</span><span class="ident" id="8027558">Close</span><span class="op" id="8027563">(</span><span class="op" id="8027564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027569">os</span><span class="op" id="8027571">.</span><span class="ident" id="8027572">Remove</span><span class="op" id="8027578">(</span><span class="ident" id="8027579">taddr</span><span class="op" id="8027584">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027588">}</span><span class="op" id="8027589">(</span><span class="op" id="8027590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027595">var</span>&nbsp;<span class="ident" id="8027599">la</span>&nbsp;<span class="op" id="8027602">*</span><span class="ident" id="8027603">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027614">if</span>&nbsp;<span class="ident" id="8027617">laddr</span>&nbsp;<span class="op" id="8027623">!=</span>&nbsp;<span class="string" id="8027626">&#34;&#34;</span>&nbsp;<span class="op" id="8027629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027634">if</span>&nbsp;<span class="ident" id="8027637">la</span><span class="op" id="8027639">,</span>&nbsp;<span class="ident" id="8027641">err</span>&nbsp;<span class="op" id="8027645">=</span>&nbsp;<span class="ident" id="8027647">ResolveUnixAddr</span><span class="op" id="8027662">(</span><span class="string" id="8027663">&#34;unixgram&#34;</span><span class="op" id="8027673">,</span>&nbsp;<span class="ident" id="8027675">laddr</span><span class="op" id="8027680">)</span><span class="op" id="8027681">;</span>&nbsp;<span class="ident" id="8027683">err</span>&nbsp;<span class="op" id="8027687">!=</span>&nbsp;<span class="ident" id="8027690">nil</span>&nbsp;<span class="op" id="8027694">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027700">t</span><span class="op" id="8027701">.</span><span class="ident" id="8027702">Fatalf</span><span class="op" id="8027708">(</span><span class="string" id="8027709">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8027737">,</span>&nbsp;<span class="ident" id="8027739">err</span><span class="op" id="8027742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027755">c2</span><span class="op" id="8027757">,</span>&nbsp;<span class="ident" id="8027759">err</span>&nbsp;<span class="op" id="8027763">:=</span>&nbsp;<span class="ident" id="8027766">DialUnix</span><span class="op" id="8027774">(</span><span class="string" id="8027775">&#34;unixgram&#34;</span><span class="op" id="8027785">,</span>&nbsp;<span class="ident" id="8027787">la</span><span class="op" id="8027789">,</span>&nbsp;<span class="ident" id="8027791">ta</span><span class="op" id="8027793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027797">if</span>&nbsp;<span class="ident" id="8027800">err</span>&nbsp;<span class="op" id="8027804">!=</span>&nbsp;<span class="ident" id="8027807">nil</span>&nbsp;<span class="op" id="8027811">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027816">t</span><span class="op" id="8027817">.</span><span class="ident" id="8027818">Fatalf</span><span class="op" id="8027824">(</span><span class="string" id="8027825">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8027846">,</span>&nbsp;<span class="ident" id="8027848">err</span><span class="op" id="8027851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027859">defer</span>&nbsp;<span class="keyword" id="8027865">func</span><span class="op" id="8027869">(</span><span class="op" id="8027870">)</span>&nbsp;<span class="op" id="8027872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8027877">c2</span><span class="op" id="8027879">.</span><span class="ident" id="8027880">Close</span><span class="op" id="8027885">(</span><span class="op" id="8027886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027891">if</span>&nbsp;<span class="ident" id="8027894">la</span>&nbsp;<span class="op" id="8027897">!=</span>&nbsp;<span class="ident" id="8027900">nil</span>&nbsp;<span class="op" id="8027904">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027910">defer</span>&nbsp;<span class="ident" id="8027916">os</span><span class="op" id="8027918">.</span><span class="ident" id="8027919">Remove</span><span class="op" id="8027925">(</span><span class="ident" id="8027926">laddr</span><span class="op" id="8027931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8027940">}</span><span class="op" id="8027941">(</span><span class="op" id="8027942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027947">switch</span>&nbsp;<span class="ident" id="8027954">runtime</span><span class="op" id="8027961">.</span><span class="ident" id="8027962">GOOS</span>&nbsp;<span class="op" id="8027967">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027971">case</span>&nbsp;<span class="string" id="8027976">&#34;android&#34;</span><span class="op" id="8027985">,</span>&nbsp;<span class="string" id="8027987">&#34;linux&#34;</span><span class="op" id="8027994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8027999">if</span>&nbsp;<span class="ident" id="8028002">laddr</span>&nbsp;<span class="op" id="8028008">==</span>&nbsp;<span class="string" id="8028011">&#34;&#34;</span>&nbsp;<span class="op" id="8028014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028020">laddr</span>&nbsp;<span class="op" id="8028026">=</span>&nbsp;<span class="string" id="8028028">&#34;@&#34;</span>&nbsp;<span class="comment" id="8028032">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028059">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028064">var</span>&nbsp;<span class="ident" id="8028068">connAddrs</span>&nbsp;<span class="op" id="8028078">=</span>&nbsp;<span class="op" id="8028080">[</span><span class="num" id="8028081">4</span><span class="op" id="8028082">]</span><span class="keyword" id="8028083">struct</span><span class="op" id="8028089">{</span>&nbsp;<span class="ident" id="8028091">got</span><span class="op" id="8028094">,</span>&nbsp;<span class="ident" id="8028096">want</span>&nbsp;<span class="ident" id="8028101">Addr</span>&nbsp;<span class="op" id="8028106">}</span><span class="op" id="8028107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028112">{</span><span class="ident" id="8028113">c1</span><span class="op" id="8028115">.</span><span class="ident" id="8028116">LocalAddr</span><span class="op" id="8028125">(</span><span class="op" id="8028126">)</span><span class="op" id="8028127">,</span>&nbsp;<span class="ident" id="8028129">ta</span><span class="op" id="8028131">}</span><span class="op" id="8028132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028137">{</span><span class="ident" id="8028138">c1</span><span class="op" id="8028140">.</span><span class="ident" id="8028141">RemoteAddr</span><span class="op" id="8028151">(</span><span class="op" id="8028152">)</span><span class="op" id="8028153">,</span>&nbsp;<span class="ident" id="8028155">nil</span><span class="op" id="8028158">}</span><span class="op" id="8028159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028164">{</span><span class="ident" id="8028165">c2</span><span class="op" id="8028167">.</span><span class="ident" id="8028168">LocalAddr</span><span class="op" id="8028177">(</span><span class="op" id="8028178">)</span><span class="op" id="8028179">,</span>&nbsp;<span class="op" id="8028181">&amp;</span><span class="ident" id="8028182">UnixAddr</span><span class="op" id="8028190">{</span><span class="ident" id="8028191">Name</span><span class="op" id="8028195">:</span>&nbsp;<span class="ident" id="8028197">laddr</span><span class="op" id="8028202">,</span>&nbsp;<span class="ident" id="8028204">Net</span><span class="op" id="8028207">:</span>&nbsp;<span class="string" id="8028209">&#34;unixgram&#34;</span><span class="op" id="8028219">}</span><span class="op" id="8028220">}</span><span class="op" id="8028221">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028226">{</span><span class="ident" id="8028227">c2</span><span class="op" id="8028229">.</span><span class="ident" id="8028230">RemoteAddr</span><span class="op" id="8028240">(</span><span class="op" id="8028241">)</span><span class="op" id="8028242">,</span>&nbsp;<span class="ident" id="8028244">ta</span><span class="op" id="8028246">}</span><span class="op" id="8028247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028255">for</span>&nbsp;<span class="ident" id="8028259">_</span><span class="op" id="8028260">,</span>&nbsp;<span class="ident" id="8028262">ca</span>&nbsp;<span class="op" id="8028265">:=</span>&nbsp;<span class="keyword" id="8028268">range</span>&nbsp;<span class="ident" id="8028274">connAddrs</span>&nbsp;<span class="op" id="8028284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028289">if</span>&nbsp;<span class="op" id="8028292">!</span><span class="ident" id="8028293">reflect</span><span class="op" id="8028300">.</span><span class="ident" id="8028301">DeepEqual</span><span class="op" id="8028310">(</span><span class="ident" id="8028311">ca</span><span class="op" id="8028313">.</span><span class="ident" id="8028314">got</span><span class="op" id="8028317">,</span>&nbsp;<span class="ident" id="8028319">ca</span><span class="op" id="8028321">.</span><span class="ident" id="8028322">want</span><span class="op" id="8028326">)</span>&nbsp;<span class="op" id="8028328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028334">t</span><span class="op" id="8028335">.</span><span class="ident" id="8028336">Fatalf</span><span class="op" id="8028342">(</span><span class="string" id="8028343">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8028366">,</span>&nbsp;<span class="ident" id="8028368">ca</span><span class="op" id="8028370">.</span><span class="ident" id="8028371">got</span><span class="op" id="8028374">,</span>&nbsp;<span class="ident" id="8028376">ca</span><span class="op" id="8028378">.</span><span class="ident" id="8028379">want</span><span class="op" id="8028383">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028395">}</span><br>
<span class="lineno"></span><span class="op" id="8028397">}</span>
</div>
</body>
</html>
