<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7391443">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7391498">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7391552">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7391603">package</span>&nbsp;<span class="ident" id="7391611">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7391617">import</span>&nbsp;<span class="op" id="7391624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7391627">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7391636">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7391644">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7391655">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7391666">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="7391676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7391679">type</span>&nbsp;<span class="ident" id="7391684">Optionals</span>&nbsp;<span class="keyword" id="7391694">struct</span>&nbsp;<span class="op" id="7391701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391704">Sr</span>&nbsp;<span class="builtintype" id="7391707">string</span>&nbsp;<span class="string" id="7391714">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391727">So</span>&nbsp;<span class="builtintype" id="7391730">string</span>&nbsp;<span class="string" id="7391737">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391760">Sw</span>&nbsp;<span class="builtintype" id="7391763">string</span>&nbsp;<span class="string" id="7391770">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391783">Ir</span>&nbsp;<span class="builtintype" id="7391786">int</span>&nbsp;<span class="string" id="7391790">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="7391809">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391853">Io</span>&nbsp;<span class="builtintype" id="7391856">int</span>&nbsp;<span class="string" id="7391860">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391884">Slr</span>&nbsp;<span class="op" id="7391888">[</span><span class="op" id="7391889">]</span><span class="builtintype" id="7391890">string</span>&nbsp;<span class="string" id="7391897">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391918">Slo</span>&nbsp;<span class="op" id="7391922">[</span><span class="op" id="7391923">]</span><span class="builtintype" id="7391924">string</span>&nbsp;<span class="string" id="7391931">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391956">Mr</span>&nbsp;<span class="keyword" id="7391959">map</span><span class="op" id="7391962">[</span><span class="builtintype" id="7391963">string</span><span class="op" id="7391969">]</span><span class="keyword" id="7391970">interface</span><span class="op" id="7391979">{</span><span class="op" id="7391980">}</span>&nbsp;<span class="string" id="7391982">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7391995">Mo</span>&nbsp;<span class="keyword" id="7391998">map</span><span class="op" id="7392001">[</span><span class="builtintype" id="7392002">string</span><span class="op" id="7392008">]</span><span class="keyword" id="7392009">interface</span><span class="op" id="7392018">{</span><span class="op" id="7392019">}</span>&nbsp;<span class="string" id="7392021">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392043">Fr</span>&nbsp;<span class="builtintype" id="7392046">float64</span>&nbsp;<span class="string" id="7392054">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392067">Fo</span>&nbsp;<span class="builtintype" id="7392070">float64</span>&nbsp;<span class="string" id="7392078">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392102">Br</span>&nbsp;<span class="builtintype" id="7392105">bool</span>&nbsp;<span class="string" id="7392110">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392123">Bo</span>&nbsp;<span class="builtintype" id="7392126">bool</span>&nbsp;<span class="string" id="7392131">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392155">Ur</span>&nbsp;<span class="builtintype" id="7392158">uint</span>&nbsp;<span class="string" id="7392163">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392176">Uo</span>&nbsp;<span class="builtintype" id="7392179">uint</span>&nbsp;<span class="string" id="7392184">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392208">Str</span>&nbsp;<span class="keyword" id="7392212">struct</span><span class="op" id="7392218">{</span><span class="op" id="7392219">}</span>&nbsp;<span class="string" id="7392221">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392235">Sto</span>&nbsp;<span class="keyword" id="7392239">struct</span><span class="op" id="7392245">{</span><span class="op" id="7392246">}</span>&nbsp;<span class="string" id="7392248">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="7392271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7392274">var</span>&nbsp;<span class="ident" id="7392278">optionalsExpected</span>&nbsp;<span class="op" id="7392296">=</span>&nbsp;<span class="string" id="7392298">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7392415">func</span>&nbsp;<span class="ident" id="7392420">TestOmitEmpty</span><span class="op" id="7392433">(</span><span class="ident" id="7392434">t</span>&nbsp;<span class="op" id="7392436">*</span><span class="ident" id="7392437">testing</span><span class="op" id="7392444">.</span><span class="ident" id="7392445">T</span><span class="op" id="7392446">)</span>&nbsp;<span class="op" id="7392448">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7392451">var</span>&nbsp;<span class="ident" id="7392455">o</span>&nbsp;<span class="ident" id="7392457">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392468">o</span><span class="op" id="7392469">.</span><span class="ident" id="7392470">Sw</span>&nbsp;<span class="op" id="7392473">=</span>&nbsp;<span class="string" id="7392475">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392488">o</span><span class="op" id="7392489">.</span><span class="ident" id="7392490">Mr</span>&nbsp;<span class="op" id="7392493">=</span>&nbsp;<span class="keyword" id="7392495">map</span><span class="op" id="7392498">[</span><span class="builtintype" id="7392499">string</span><span class="op" id="7392505">]</span><span class="keyword" id="7392506">interface</span><span class="op" id="7392515">{</span><span class="op" id="7392516">}</span><span class="op" id="7392517">{</span><span class="op" id="7392518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392521">o</span><span class="op" id="7392522">.</span><span class="ident" id="7392523">Mo</span>&nbsp;<span class="op" id="7392526">=</span>&nbsp;<span class="keyword" id="7392528">map</span><span class="op" id="7392531">[</span><span class="builtintype" id="7392532">string</span><span class="op" id="7392538">]</span><span class="keyword" id="7392539">interface</span><span class="op" id="7392548">{</span><span class="op" id="7392549">}</span><span class="op" id="7392550">{</span><span class="op" id="7392551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392555">got</span><span class="op" id="7392558">,</span>&nbsp;<span class="ident" id="7392560">err</span>&nbsp;<span class="op" id="7392564">:=</span>&nbsp;<span class="ident" id="7392567">MarshalIndent</span><span class="op" id="7392580">(</span><span class="op" id="7392581">&amp;</span><span class="ident" id="7392582">o</span><span class="op" id="7392583">,</span>&nbsp;<span class="string" id="7392585">&#34;&#34;</span><span class="op" id="7392587">,</span>&nbsp;<span class="string" id="7392589">&#34;&nbsp;&#34;</span><span class="op" id="7392592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7392595">if</span>&nbsp;<span class="ident" id="7392598">err</span>&nbsp;<span class="op" id="7392602">!=</span>&nbsp;<span class="ident" id="7392605">nil</span>&nbsp;<span class="op" id="7392609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392613">t</span><span class="op" id="7392614">.</span><span class="ident" id="7392615">Fatal</span><span class="op" id="7392620">(</span><span class="ident" id="7392621">err</span><span class="op" id="7392624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7392627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7392630">if</span>&nbsp;<span class="ident" id="7392633">got</span>&nbsp;<span class="op" id="7392637">:=</span>&nbsp;<span class="builtintype" id="7392640">string</span><span class="op" id="7392646">(</span><span class="ident" id="7392647">got</span><span class="op" id="7392650">)</span><span class="op" id="7392651">;</span>&nbsp;<span class="ident" id="7392653">got</span>&nbsp;<span class="op" id="7392657">!=</span>&nbsp;<span class="ident" id="7392660">optionalsExpected</span>&nbsp;<span class="op" id="7392678">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392682">t</span><span class="op" id="7392683">.</span><span class="ident" id="7392684">Errorf</span><span class="op" id="7392690">(</span><span class="string" id="7392691">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7392713">,</span>&nbsp;<span class="ident" id="7392715">got</span><span class="op" id="7392718">,</span>&nbsp;<span class="ident" id="7392720">optionalsExpected</span><span class="op" id="7392737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7392740">}</span><br>
<span class="lineno"></span><span class="op" id="7392742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7392745">type</span>&nbsp;<span class="ident" id="7392750">StringTag</span>&nbsp;<span class="keyword" id="7392760">struct</span>&nbsp;<span class="op" id="7392767">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392770">BoolStr</span>&nbsp;<span class="builtintype" id="7392778">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7392785">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392803">IntStr</span>&nbsp;&nbsp;<span class="ident" id="7392811">int64</span>&nbsp;&nbsp;<span class="string" id="7392818">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7392836">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="7392844">string</span>&nbsp;<span class="string" id="7392851">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7392868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7392871">var</span>&nbsp;<span class="ident" id="7392875">stringTagExpected</span>&nbsp;<span class="op" id="7392893">=</span>&nbsp;<span class="string" id="7392895">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7392962">func</span>&nbsp;<span class="ident" id="7392967">TestStringTag</span><span class="op" id="7392980">(</span><span class="ident" id="7392981">t</span>&nbsp;<span class="op" id="7392983">*</span><span class="ident" id="7392984">testing</span><span class="op" id="7392991">.</span><span class="ident" id="7392992">T</span><span class="op" id="7392993">)</span>&nbsp;<span class="op" id="7392995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7392998">var</span>&nbsp;<span class="ident" id="7393002">s</span>&nbsp;<span class="ident" id="7393004">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393015">s</span><span class="op" id="7393016">.</span><span class="ident" id="7393017">BoolStr</span>&nbsp;<span class="op" id="7393025">=</span>&nbsp;<span class="builtintype" id="7393027">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393033">s</span><span class="op" id="7393034">.</span><span class="ident" id="7393035">IntStr</span>&nbsp;<span class="op" id="7393042">=</span>&nbsp;<span class="num" id="7393044">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393048">s</span><span class="op" id="7393049">.</span><span class="ident" id="7393050">StrStr</span>&nbsp;<span class="op" id="7393057">=</span>&nbsp;<span class="string" id="7393059">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393068">got</span><span class="op" id="7393071">,</span>&nbsp;<span class="ident" id="7393073">err</span>&nbsp;<span class="op" id="7393077">:=</span>&nbsp;<span class="ident" id="7393080">MarshalIndent</span><span class="op" id="7393093">(</span><span class="op" id="7393094">&amp;</span><span class="ident" id="7393095">s</span><span class="op" id="7393096">,</span>&nbsp;<span class="string" id="7393098">&#34;&#34;</span><span class="op" id="7393100">,</span>&nbsp;<span class="string" id="7393102">&#34;&nbsp;&#34;</span><span class="op" id="7393105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393108">if</span>&nbsp;<span class="ident" id="7393111">err</span>&nbsp;<span class="op" id="7393115">!=</span>&nbsp;<span class="ident" id="7393118">nil</span>&nbsp;<span class="op" id="7393122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393126">t</span><span class="op" id="7393127">.</span><span class="ident" id="7393128">Fatal</span><span class="op" id="7393133">(</span><span class="ident" id="7393134">err</span><span class="op" id="7393137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393140">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393143">if</span>&nbsp;<span class="ident" id="7393146">got</span>&nbsp;<span class="op" id="7393150">:=</span>&nbsp;<span class="builtintype" id="7393153">string</span><span class="op" id="7393159">(</span><span class="ident" id="7393160">got</span><span class="op" id="7393163">)</span><span class="op" id="7393164">;</span>&nbsp;<span class="ident" id="7393166">got</span>&nbsp;<span class="op" id="7393170">!=</span>&nbsp;<span class="ident" id="7393173">stringTagExpected</span>&nbsp;<span class="op" id="7393191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393195">t</span><span class="op" id="7393196">.</span><span class="ident" id="7393197">Fatalf</span><span class="op" id="7393203">(</span><span class="string" id="7393204">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7393226">,</span>&nbsp;<span class="ident" id="7393228">got</span><span class="op" id="7393231">,</span>&nbsp;<span class="ident" id="7393233">stringTagExpected</span><span class="op" id="7393250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7393257">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393289">var</span>&nbsp;<span class="ident" id="7393293">s2</span>&nbsp;<span class="ident" id="7393296">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393307">err</span>&nbsp;<span class="op" id="7393311">=</span>&nbsp;<span class="ident" id="7393313">NewDecoder</span><span class="op" id="7393323">(</span><span class="ident" id="7393324">bytes</span><span class="op" id="7393329">.</span><span class="ident" id="7393330">NewReader</span><span class="op" id="7393339">(</span><span class="ident" id="7393340">got</span><span class="op" id="7393343">)</span><span class="op" id="7393344">)</span><span class="op" id="7393345">.</span><span class="ident" id="7393346">Decode</span><span class="op" id="7393352">(</span><span class="op" id="7393353">&amp;</span><span class="ident" id="7393354">s2</span><span class="op" id="7393356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393359">if</span>&nbsp;<span class="ident" id="7393362">err</span>&nbsp;<span class="op" id="7393366">!=</span>&nbsp;<span class="ident" id="7393369">nil</span>&nbsp;<span class="op" id="7393373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393377">t</span><span class="op" id="7393378">.</span><span class="ident" id="7393379">Fatalf</span><span class="op" id="7393385">(</span><span class="string" id="7393386">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7393398">,</span>&nbsp;<span class="ident" id="7393400">err</span><span class="op" id="7393403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393406">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393409">if</span>&nbsp;<span class="op" id="7393412">!</span><span class="ident" id="7393413">reflect</span><span class="op" id="7393420">.</span><span class="ident" id="7393421">DeepEqual</span><span class="op" id="7393430">(</span><span class="ident" id="7393431">s</span><span class="op" id="7393432">,</span>&nbsp;<span class="ident" id="7393434">s2</span><span class="op" id="7393436">)</span>&nbsp;<span class="op" id="7393438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393442">t</span><span class="op" id="7393443">.</span><span class="ident" id="7393444">Fatalf</span><span class="op" id="7393450">(</span><span class="string" id="7393451">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="7393516">,</span>&nbsp;<span class="ident" id="7393518">s</span><span class="op" id="7393519">,</span>&nbsp;<span class="builtintype" id="7393521">string</span><span class="op" id="7393527">(</span><span class="ident" id="7393528">got</span><span class="op" id="7393531">)</span><span class="op" id="7393532">,</span>&nbsp;<span class="ident" id="7393534">s2</span><span class="op" id="7393536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393539">}</span><br>
<span class="lineno"></span><span class="op" id="7393541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="7393544">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="7393602">type</span>&nbsp;<span class="ident" id="7393607">renamedByte</span>&nbsp;<span class="builtintype" id="7393619">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7393624">type</span>&nbsp;<span class="ident" id="7393629">renamedByteSlice</span>&nbsp;<span class="op" id="7393646">[</span><span class="op" id="7393647">]</span><span class="builtintype" id="7393648">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7393653">type</span>&nbsp;<span class="ident" id="7393658">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="7393682">[</span><span class="op" id="7393683">]</span><span class="ident" id="7393684">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7393697">func</span>&nbsp;<span class="ident" id="7393702">TestEncodeRenamedByteSlice</span><span class="op" id="7393728">(</span><span class="ident" id="7393729">t</span>&nbsp;<span class="op" id="7393731">*</span><span class="ident" id="7393732">testing</span><span class="op" id="7393739">.</span><span class="ident" id="7393740">T</span><span class="op" id="7393741">)</span>&nbsp;<span class="op" id="7393743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393746">s</span>&nbsp;<span class="op" id="7393748">:=</span>&nbsp;<span class="ident" id="7393751">renamedByteSlice</span><span class="op" id="7393767">(</span><span class="string" id="7393768">&#34;abc&#34;</span><span class="op" id="7393773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393776">result</span><span class="op" id="7393782">,</span>&nbsp;<span class="ident" id="7393784">err</span>&nbsp;<span class="op" id="7393788">:=</span>&nbsp;<span class="ident" id="7393791">Marshal</span><span class="op" id="7393798">(</span><span class="ident" id="7393799">s</span><span class="op" id="7393800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393803">if</span>&nbsp;<span class="ident" id="7393806">err</span>&nbsp;<span class="op" id="7393810">!=</span>&nbsp;<span class="ident" id="7393813">nil</span>&nbsp;<span class="op" id="7393817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393821">t</span><span class="op" id="7393822">.</span><span class="ident" id="7393823">Fatal</span><span class="op" id="7393828">(</span><span class="ident" id="7393829">err</span><span class="op" id="7393832">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393838">expect</span>&nbsp;<span class="op" id="7393845">:=</span>&nbsp;<span class="string" id="7393848">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7393858">if</span>&nbsp;<span class="builtintype" id="7393861">string</span><span class="op" id="7393867">(</span><span class="ident" id="7393868">result</span><span class="op" id="7393874">)</span>&nbsp;<span class="op" id="7393876">!=</span>&nbsp;<span class="ident" id="7393879">expect</span>&nbsp;<span class="op" id="7393886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393890">t</span><span class="op" id="7393891">.</span><span class="ident" id="7393892">Errorf</span><span class="op" id="7393898">(</span><span class="string" id="7393899">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7393916">,</span>&nbsp;<span class="ident" id="7393918">result</span><span class="op" id="7393924">,</span>&nbsp;<span class="ident" id="7393926">expect</span><span class="op" id="7393932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7393935">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393938">r</span>&nbsp;<span class="op" id="7393940">:=</span>&nbsp;<span class="ident" id="7393943">renamedRenamedByteSlice</span><span class="op" id="7393966">(</span><span class="string" id="7393967">&#34;abc&#34;</span><span class="op" id="7393972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7393975">result</span><span class="op" id="7393981">,</span>&nbsp;<span class="ident" id="7393983">err</span>&nbsp;<span class="op" id="7393987">=</span>&nbsp;<span class="ident" id="7393989">Marshal</span><span class="op" id="7393996">(</span><span class="ident" id="7393997">r</span><span class="op" id="7393998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394001">if</span>&nbsp;<span class="ident" id="7394004">err</span>&nbsp;<span class="op" id="7394008">!=</span>&nbsp;<span class="ident" id="7394011">nil</span>&nbsp;<span class="op" id="7394015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394019">t</span><span class="op" id="7394020">.</span><span class="ident" id="7394021">Fatal</span><span class="op" id="7394026">(</span><span class="ident" id="7394027">err</span><span class="op" id="7394030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394033">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394036">if</span>&nbsp;<span class="builtintype" id="7394039">string</span><span class="op" id="7394045">(</span><span class="ident" id="7394046">result</span><span class="op" id="7394052">)</span>&nbsp;<span class="op" id="7394054">!=</span>&nbsp;<span class="ident" id="7394057">expect</span>&nbsp;<span class="op" id="7394064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394068">t</span><span class="op" id="7394069">.</span><span class="ident" id="7394070">Errorf</span><span class="op" id="7394076">(</span><span class="string" id="7394077">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7394094">,</span>&nbsp;<span class="ident" id="7394096">result</span><span class="op" id="7394102">,</span>&nbsp;<span class="ident" id="7394104">expect</span><span class="op" id="7394110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394113">}</span><br>
<span class="lineno"></span><span class="op" id="7394115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7394118">var</span>&nbsp;<span class="ident" id="7394122">unsupportedValues</span>&nbsp;<span class="op" id="7394140">=</span>&nbsp;<span class="op" id="7394142">[</span><span class="op" id="7394143">]</span><span class="keyword" id="7394144">interface</span><span class="op" id="7394153">{</span><span class="op" id="7394154">}</span><span class="op" id="7394155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394158">math</span><span class="op" id="7394162">.</span><span class="ident" id="7394163">NaN</span><span class="op" id="7394166">(</span><span class="op" id="7394167">)</span><span class="op" id="7394168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394171">math</span><span class="op" id="7394175">.</span><span class="ident" id="7394176">Inf</span><span class="op" id="7394179">(</span><span class="op" id="7394180">-</span><span class="num" id="7394181">1</span><span class="op" id="7394182">)</span><span class="op" id="7394183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394186">math</span><span class="op" id="7394190">.</span><span class="ident" id="7394191">Inf</span><span class="op" id="7394194">(</span><span class="num" id="7394195">1</span><span class="op" id="7394196">)</span><span class="op" id="7394197">,</span><br>
<span class="lineno"></span><span class="op" id="7394199">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="7394202">func</span>&nbsp;<span class="ident" id="7394207">TestUnsupportedValues</span><span class="op" id="7394228">(</span><span class="ident" id="7394229">t</span>&nbsp;<span class="op" id="7394231">*</span><span class="ident" id="7394232">testing</span><span class="op" id="7394239">.</span><span class="ident" id="7394240">T</span><span class="op" id="7394241">)</span>&nbsp;<span class="op" id="7394243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394246">for</span>&nbsp;<span class="ident" id="7394250">_</span><span class="op" id="7394251">,</span>&nbsp;<span class="ident" id="7394253">v</span>&nbsp;<span class="op" id="7394255">:=</span>&nbsp;<span class="keyword" id="7394258">range</span>&nbsp;<span class="ident" id="7394264">unsupportedValues</span>&nbsp;<span class="op" id="7394282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394286">if</span>&nbsp;<span class="ident" id="7394289">_</span><span class="op" id="7394290">,</span>&nbsp;<span class="ident" id="7394292">err</span>&nbsp;<span class="op" id="7394296">:=</span>&nbsp;<span class="ident" id="7394299">Marshal</span><span class="op" id="7394306">(</span><span class="ident" id="7394307">v</span><span class="op" id="7394308">)</span><span class="op" id="7394309">;</span>&nbsp;<span class="ident" id="7394311">err</span>&nbsp;<span class="op" id="7394315">!=</span>&nbsp;<span class="ident" id="7394318">nil</span>&nbsp;<span class="op" id="7394322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394327">if</span>&nbsp;<span class="ident" id="7394330">_</span><span class="op" id="7394331">,</span>&nbsp;<span class="ident" id="7394333">ok</span>&nbsp;<span class="op" id="7394336">:=</span>&nbsp;<span class="ident" id="7394339">err</span><span class="op" id="7394342">.</span><span class="op" id="7394343">(</span><span class="op" id="7394344">*</span><span class="ident" id="7394345">UnsupportedValueError</span><span class="op" id="7394366">)</span><span class="op" id="7394367">;</span>&nbsp;<span class="op" id="7394369">!</span><span class="ident" id="7394370">ok</span>&nbsp;<span class="op" id="7394373">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394379">t</span><span class="op" id="7394380">.</span><span class="ident" id="7394381">Errorf</span><span class="op" id="7394387">(</span><span class="string" id="7394388">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="7394431">,</span>&nbsp;<span class="ident" id="7394433">v</span><span class="op" id="7394434">,</span>&nbsp;<span class="ident" id="7394436">err</span><span class="op" id="7394439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394448">}</span>&nbsp;<span class="keyword" id="7394450">else</span>&nbsp;<span class="op" id="7394455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7394460">t</span><span class="op" id="7394461">.</span><span class="ident" id="7394462">Errorf</span><span class="op" id="7394468">(</span><span class="string" id="7394469">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7394493">,</span>&nbsp;<span class="ident" id="7394495">v</span><span class="op" id="7394496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394500">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394503">}</span><br>
<span class="lineno"></span><span class="op" id="7394505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7394508">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7394576">type</span>&nbsp;<span class="ident" id="7394581">Ref</span>&nbsp;<span class="builtintype" id="7394585">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7394590">func</span>&nbsp;<span class="op" id="7394595">(</span><span class="op" id="7394596">*</span><span class="ident" id="7394597">Ref</span><span class="op" id="7394600">)</span>&nbsp;<span class="ident" id="7394602">MarshalJSON</span><span class="op" id="7394613">(</span><span class="op" id="7394614">)</span>&nbsp;<span class="op" id="7394616">(</span><span class="op" id="7394617">[</span><span class="op" id="7394618">]</span><span class="builtintype" id="7394619">byte</span><span class="op" id="7394623">,</span>&nbsp;<span class="builtintype" id="7394625">error</span><span class="op" id="7394630">)</span>&nbsp;<span class="op" id="7394632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394635">return</span>&nbsp;<span class="op" id="7394642">[</span><span class="op" id="7394643">]</span><span class="builtintype" id="7394644">byte</span><span class="op" id="7394648">(</span><span class="string" id="7394649">`&#34;ref&#34;`</span><span class="op" id="7394656">)</span><span class="op" id="7394657">,</span>&nbsp;<span class="ident" id="7394659">nil</span><br>
<span class="lineno"></span><span class="op" id="7394663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="7394666">func</span>&nbsp;<span class="op" id="7394671">(</span><span class="ident" id="7394672">r</span>&nbsp;<span class="op" id="7394674">*</span><span class="ident" id="7394675">Ref</span><span class="op" id="7394678">)</span>&nbsp;<span class="ident" id="7394680">UnmarshalJSON</span><span class="op" id="7394693">(</span><span class="op" id="7394694">[</span><span class="op" id="7394695">]</span><span class="builtintype" id="7394696">byte</span><span class="op" id="7394700">)</span>&nbsp;<span class="builtintype" id="7394702">error</span>&nbsp;<span class="op" id="7394708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7394711">*</span><span class="ident" id="7394712">r</span>&nbsp;<span class="op" id="7394714">=</span>&nbsp;<span class="num" id="7394716">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394720">return</span>&nbsp;<span class="ident" id="7394727">nil</span><br>
<span class="lineno"></span><span class="op" id="7394731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="7394734">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7394784">type</span>&nbsp;<span class="ident" id="7394789">Val</span>&nbsp;<span class="builtintype" id="7394793">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7394798">func</span>&nbsp;<span class="op" id="7394803">(</span><span class="ident" id="7394804">Val</span><span class="op" id="7394807">)</span>&nbsp;<span class="ident" id="7394809">MarshalJSON</span><span class="op" id="7394820">(</span><span class="op" id="7394821">)</span>&nbsp;<span class="op" id="7394823">(</span><span class="op" id="7394824">[</span><span class="op" id="7394825">]</span><span class="builtintype" id="7394826">byte</span><span class="op" id="7394830">,</span>&nbsp;<span class="builtintype" id="7394832">error</span><span class="op" id="7394837">)</span>&nbsp;<span class="op" id="7394839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7394842">return</span>&nbsp;<span class="op" id="7394849">[</span><span class="op" id="7394850">]</span><span class="builtintype" id="7394851">byte</span><span class="op" id="7394855">(</span><span class="string" id="7394856">`&#34;val&#34;`</span><span class="op" id="7394863">)</span><span class="op" id="7394864">,</span>&nbsp;<span class="ident" id="7394866">nil</span><br>
<span class="lineno">165</span><span class="op" id="7394870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7394873">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7394945">type</span>&nbsp;<span class="ident" id="7394950">RefText</span>&nbsp;<span class="builtintype" id="7394958">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7394963">func</span>&nbsp;<span class="op" id="7394968">(</span><span class="op" id="7394969">*</span><span class="ident" id="7394970">RefText</span><span class="op" id="7394977">)</span>&nbsp;<span class="ident" id="7394979">MarshalText</span><span class="op" id="7394990">(</span><span class="op" id="7394991">)</span>&nbsp;<span class="op" id="7394993">(</span><span class="op" id="7394994">[</span><span class="op" id="7394995">]</span><span class="builtintype" id="7394996">byte</span><span class="op" id="7395000">,</span>&nbsp;<span class="builtintype" id="7395002">error</span><span class="op" id="7395007">)</span>&nbsp;<span class="op" id="7395009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395012">return</span>&nbsp;<span class="op" id="7395019">[</span><span class="op" id="7395020">]</span><span class="builtintype" id="7395021">byte</span><span class="op" id="7395025">(</span><span class="string" id="7395026">`&#34;ref&#34;`</span><span class="op" id="7395033">)</span><span class="op" id="7395034">,</span>&nbsp;<span class="ident" id="7395036">nil</span><br>
<span class="lineno"></span><span class="op" id="7395040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7395043">func</span>&nbsp;<span class="op" id="7395048">(</span><span class="ident" id="7395049">r</span>&nbsp;<span class="op" id="7395051">*</span><span class="ident" id="7395052">RefText</span><span class="op" id="7395059">)</span>&nbsp;<span class="ident" id="7395061">UnmarshalText</span><span class="op" id="7395074">(</span><span class="op" id="7395075">[</span><span class="op" id="7395076">]</span><span class="builtintype" id="7395077">byte</span><span class="op" id="7395081">)</span>&nbsp;<span class="builtintype" id="7395083">error</span>&nbsp;<span class="op" id="7395089">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7395092">*</span><span class="ident" id="7395093">r</span>&nbsp;<span class="op" id="7395095">=</span>&nbsp;<span class="num" id="7395097">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395101">return</span>&nbsp;<span class="ident" id="7395108">nil</span><br>
<span class="lineno"></span><span class="op" id="7395112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7395115">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="7395169">type</span>&nbsp;<span class="ident" id="7395174">ValText</span>&nbsp;<span class="builtintype" id="7395182">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7395187">func</span>&nbsp;<span class="op" id="7395192">(</span><span class="ident" id="7395193">ValText</span><span class="op" id="7395200">)</span>&nbsp;<span class="ident" id="7395202">MarshalText</span><span class="op" id="7395213">(</span><span class="op" id="7395214">)</span>&nbsp;<span class="op" id="7395216">(</span><span class="op" id="7395217">[</span><span class="op" id="7395218">]</span><span class="builtintype" id="7395219">byte</span><span class="op" id="7395223">,</span>&nbsp;<span class="builtintype" id="7395225">error</span><span class="op" id="7395230">)</span>&nbsp;<span class="op" id="7395232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395235">return</span>&nbsp;<span class="op" id="7395242">[</span><span class="op" id="7395243">]</span><span class="builtintype" id="7395244">byte</span><span class="op" id="7395248">(</span><span class="string" id="7395249">`&#34;val&#34;`</span><span class="op" id="7395256">)</span><span class="op" id="7395257">,</span>&nbsp;<span class="ident" id="7395259">nil</span><br>
<span class="lineno"></span><span class="op" id="7395263">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7395266">func</span>&nbsp;<span class="ident" id="7395271">TestRefValMarshal</span><span class="op" id="7395288">(</span><span class="ident" id="7395289">t</span>&nbsp;<span class="op" id="7395291">*</span><span class="ident" id="7395292">testing</span><span class="op" id="7395299">.</span><span class="ident" id="7395300">T</span><span class="op" id="7395301">)</span>&nbsp;<span class="op" id="7395303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395306">var</span>&nbsp;<span class="ident" id="7395310">s</span>&nbsp;<span class="op" id="7395312">=</span>&nbsp;<span class="keyword" id="7395314">struct</span>&nbsp;<span class="op" id="7395321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395325">R0</span>&nbsp;<span class="ident" id="7395328">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395334">R1</span>&nbsp;<span class="op" id="7395337">*</span><span class="ident" id="7395338">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395344">R2</span>&nbsp;<span class="ident" id="7395347">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395357">R3</span>&nbsp;<span class="op" id="7395360">*</span><span class="ident" id="7395361">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395371">V0</span>&nbsp;<span class="ident" id="7395374">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395380">V1</span>&nbsp;<span class="op" id="7395383">*</span><span class="ident" id="7395384">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395390">V2</span>&nbsp;<span class="ident" id="7395393">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395403">V3</span>&nbsp;<span class="op" id="7395406">*</span><span class="ident" id="7395407">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7395416">}</span><span class="op" id="7395417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395421">R0</span><span class="op" id="7395423">:</span>&nbsp;<span class="num" id="7395425">12</span><span class="op" id="7395427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395431">R1</span><span class="op" id="7395433">:</span>&nbsp;<span class="builtinfunc" id="7395435">new</span><span class="op" id="7395438">(</span><span class="ident" id="7395439">Ref</span><span class="op" id="7395442">)</span><span class="op" id="7395443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395447">R2</span><span class="op" id="7395449">:</span>&nbsp;<span class="num" id="7395451">14</span><span class="op" id="7395453">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395457">R3</span><span class="op" id="7395459">:</span>&nbsp;<span class="builtinfunc" id="7395461">new</span><span class="op" id="7395464">(</span><span class="ident" id="7395465">RefText</span><span class="op" id="7395472">)</span><span class="op" id="7395473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395477">V0</span><span class="op" id="7395479">:</span>&nbsp;<span class="num" id="7395481">13</span><span class="op" id="7395483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395487">V1</span><span class="op" id="7395489">:</span>&nbsp;<span class="builtinfunc" id="7395491">new</span><span class="op" id="7395494">(</span><span class="ident" id="7395495">Val</span><span class="op" id="7395498">)</span><span class="op" id="7395499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395503">V2</span><span class="op" id="7395505">:</span>&nbsp;<span class="num" id="7395507">15</span><span class="op" id="7395509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395513">V3</span><span class="op" id="7395515">:</span>&nbsp;<span class="builtinfunc" id="7395517">new</span><span class="op" id="7395520">(</span><span class="ident" id="7395521">ValText</span><span class="op" id="7395528">)</span><span class="op" id="7395529">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7395532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395535">const</span>&nbsp;<span class="ident" id="7395541">want</span>&nbsp;<span class="op" id="7395546">=</span>&nbsp;<span class="string" id="7395548">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395657">b</span><span class="op" id="7395658">,</span>&nbsp;<span class="ident" id="7395660">err</span>&nbsp;<span class="op" id="7395664">:=</span>&nbsp;<span class="ident" id="7395667">Marshal</span><span class="op" id="7395674">(</span><span class="op" id="7395675">&amp;</span><span class="ident" id="7395676">s</span><span class="op" id="7395677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395680">if</span>&nbsp;<span class="ident" id="7395683">err</span>&nbsp;<span class="op" id="7395687">!=</span>&nbsp;<span class="ident" id="7395690">nil</span>&nbsp;<span class="op" id="7395694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395698">t</span><span class="op" id="7395699">.</span><span class="ident" id="7395700">Fatalf</span><span class="op" id="7395706">(</span><span class="string" id="7395707">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7395720">,</span>&nbsp;<span class="ident" id="7395722">err</span><span class="op" id="7395725">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7395728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395731">if</span>&nbsp;<span class="ident" id="7395734">got</span>&nbsp;<span class="op" id="7395738">:=</span>&nbsp;<span class="builtintype" id="7395741">string</span><span class="op" id="7395747">(</span><span class="ident" id="7395748">b</span><span class="op" id="7395749">)</span><span class="op" id="7395750">;</span>&nbsp;<span class="ident" id="7395752">got</span>&nbsp;<span class="op" id="7395756">!=</span>&nbsp;<span class="ident" id="7395759">want</span>&nbsp;<span class="op" id="7395764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7395768">t</span><span class="op" id="7395769">.</span><span class="ident" id="7395770">Errorf</span><span class="op" id="7395776">(</span><span class="string" id="7395777">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7395794">,</span>&nbsp;<span class="ident" id="7395796">got</span><span class="op" id="7395799">,</span>&nbsp;<span class="ident" id="7395801">want</span><span class="op" id="7395805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7395808">}</span><br>
<span class="lineno"></span><span class="op" id="7395810">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="7395813">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="7395867">type</span>&nbsp;<span class="ident" id="7395872">C</span>&nbsp;<span class="builtintype" id="7395874">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7395879">func</span>&nbsp;<span class="op" id="7395884">(</span><span class="ident" id="7395885">C</span><span class="op" id="7395886">)</span>&nbsp;<span class="ident" id="7395888">MarshalJSON</span><span class="op" id="7395899">(</span><span class="op" id="7395900">)</span>&nbsp;<span class="op" id="7395902">(</span><span class="op" id="7395903">[</span><span class="op" id="7395904">]</span><span class="builtintype" id="7395905">byte</span><span class="op" id="7395909">,</span>&nbsp;<span class="builtintype" id="7395911">error</span><span class="op" id="7395916">)</span>&nbsp;<span class="op" id="7395918">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7395921">return</span>&nbsp;<span class="op" id="7395928">[</span><span class="op" id="7395929">]</span><span class="builtintype" id="7395930">byte</span><span class="op" id="7395934">(</span><span class="string" id="7395935">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7395942">)</span><span class="op" id="7395943">,</span>&nbsp;<span class="ident" id="7395945">nil</span><br>
<span class="lineno"></span><span class="op" id="7395949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7395952">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="7396010">type</span>&nbsp;<span class="ident" id="7396015">CText</span>&nbsp;<span class="builtintype" id="7396021">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="7396026">func</span>&nbsp;<span class="op" id="7396031">(</span><span class="ident" id="7396032">CText</span><span class="op" id="7396037">)</span>&nbsp;<span class="ident" id="7396039">MarshalText</span><span class="op" id="7396050">(</span><span class="op" id="7396051">)</span>&nbsp;<span class="op" id="7396053">(</span><span class="op" id="7396054">[</span><span class="op" id="7396055">]</span><span class="builtintype" id="7396056">byte</span><span class="op" id="7396060">,</span>&nbsp;<span class="builtintype" id="7396062">error</span><span class="op" id="7396067">)</span>&nbsp;<span class="op" id="7396069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396072">return</span>&nbsp;<span class="op" id="7396079">[</span><span class="op" id="7396080">]</span><span class="builtintype" id="7396081">byte</span><span class="op" id="7396085">(</span><span class="string" id="7396086">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7396093">)</span><span class="op" id="7396094">,</span>&nbsp;<span class="ident" id="7396096">nil</span><br>
<span class="lineno"></span><span class="op" id="7396100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7396103">func</span>&nbsp;<span class="ident" id="7396108">TestMarshalerEscaping</span><span class="op" id="7396129">(</span><span class="ident" id="7396130">t</span>&nbsp;<span class="op" id="7396132">*</span><span class="ident" id="7396133">testing</span><span class="op" id="7396140">.</span><span class="ident" id="7396141">T</span><span class="op" id="7396142">)</span>&nbsp;<span class="op" id="7396144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396147">var</span>&nbsp;<span class="ident" id="7396151">c</span>&nbsp;<span class="ident" id="7396153">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396156">want</span>&nbsp;<span class="op" id="7396161">:=</span>&nbsp;<span class="string" id="7396164">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396188">b</span><span class="op" id="7396189">,</span>&nbsp;<span class="ident" id="7396191">err</span>&nbsp;<span class="op" id="7396195">:=</span>&nbsp;<span class="ident" id="7396198">Marshal</span><span class="op" id="7396205">(</span><span class="ident" id="7396206">c</span><span class="op" id="7396207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396210">if</span>&nbsp;<span class="ident" id="7396213">err</span>&nbsp;<span class="op" id="7396217">!=</span>&nbsp;<span class="ident" id="7396220">nil</span>&nbsp;<span class="op" id="7396224">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396228">t</span><span class="op" id="7396229">.</span><span class="ident" id="7396230">Fatalf</span><span class="op" id="7396236">(</span><span class="string" id="7396237">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="7396253">,</span>&nbsp;<span class="ident" id="7396255">err</span><span class="op" id="7396258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396264">if</span>&nbsp;<span class="ident" id="7396267">got</span>&nbsp;<span class="op" id="7396271">:=</span>&nbsp;<span class="builtintype" id="7396274">string</span><span class="op" id="7396280">(</span><span class="ident" id="7396281">b</span><span class="op" id="7396282">)</span><span class="op" id="7396283">;</span>&nbsp;<span class="ident" id="7396285">got</span>&nbsp;<span class="op" id="7396289">!=</span>&nbsp;<span class="ident" id="7396292">want</span>&nbsp;<span class="op" id="7396297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396301">t</span><span class="op" id="7396302">.</span><span class="ident" id="7396303">Errorf</span><span class="op" id="7396309">(</span><span class="string" id="7396310">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7396338">,</span>&nbsp;<span class="ident" id="7396340">got</span><span class="op" id="7396343">,</span>&nbsp;<span class="ident" id="7396345">want</span><span class="op" id="7396349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396352">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396356">var</span>&nbsp;<span class="ident" id="7396360">ct</span>&nbsp;<span class="ident" id="7396363">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396370">want</span>&nbsp;<span class="op" id="7396375">=</span>&nbsp;<span class="string" id="7396377">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396405">b</span><span class="op" id="7396406">,</span>&nbsp;<span class="ident" id="7396408">err</span>&nbsp;<span class="op" id="7396412">=</span>&nbsp;<span class="ident" id="7396414">Marshal</span><span class="op" id="7396421">(</span><span class="ident" id="7396422">ct</span><span class="op" id="7396424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396427">if</span>&nbsp;<span class="ident" id="7396430">err</span>&nbsp;<span class="op" id="7396434">!=</span>&nbsp;<span class="ident" id="7396437">nil</span>&nbsp;<span class="op" id="7396441">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396445">t</span><span class="op" id="7396446">.</span><span class="ident" id="7396447">Fatalf</span><span class="op" id="7396453">(</span><span class="string" id="7396454">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="7396471">,</span>&nbsp;<span class="ident" id="7396473">err</span><span class="op" id="7396476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396482">if</span>&nbsp;<span class="ident" id="7396485">got</span>&nbsp;<span class="op" id="7396489">:=</span>&nbsp;<span class="builtintype" id="7396492">string</span><span class="op" id="7396498">(</span><span class="ident" id="7396499">b</span><span class="op" id="7396500">)</span><span class="op" id="7396501">;</span>&nbsp;<span class="ident" id="7396503">got</span>&nbsp;<span class="op" id="7396507">!=</span>&nbsp;<span class="ident" id="7396510">want</span>&nbsp;<span class="op" id="7396515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396519">t</span><span class="op" id="7396520">.</span><span class="ident" id="7396521">Errorf</span><span class="op" id="7396527">(</span><span class="string" id="7396528">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7396557">,</span>&nbsp;<span class="ident" id="7396559">got</span><span class="op" id="7396562">,</span>&nbsp;<span class="ident" id="7396564">want</span><span class="op" id="7396568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396571">}</span><br>
<span class="lineno">250</span><span class="op" id="7396573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396576">type</span>&nbsp;<span class="ident" id="7396581">IntType</span>&nbsp;<span class="builtintype" id="7396589">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396594">type</span>&nbsp;<span class="ident" id="7396599">MyStruct</span>&nbsp;<span class="keyword" id="7396608">struct</span>&nbsp;<span class="op" id="7396615">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396618">IntType</span><br>
<span class="lineno"></span><span class="op" id="7396626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396629">func</span>&nbsp;<span class="ident" id="7396634">TestAnonymousNonstruct</span><span class="op" id="7396656">(</span><span class="ident" id="7396657">t</span>&nbsp;<span class="op" id="7396659">*</span><span class="ident" id="7396660">testing</span><span class="op" id="7396667">.</span><span class="ident" id="7396668">T</span><span class="op" id="7396669">)</span>&nbsp;<span class="op" id="7396671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396674">var</span>&nbsp;<span class="ident" id="7396678">i</span>&nbsp;<span class="ident" id="7396680">IntType</span>&nbsp;<span class="op" id="7396688">=</span>&nbsp;<span class="num" id="7396690">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396694">a</span>&nbsp;<span class="op" id="7396696">:=</span>&nbsp;<span class="ident" id="7396699">MyStruct</span><span class="op" id="7396707">{</span><span class="ident" id="7396708">i</span><span class="op" id="7396709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396712">const</span>&nbsp;<span class="ident" id="7396718">want</span>&nbsp;<span class="op" id="7396723">=</span>&nbsp;<span class="string" id="7396725">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396744">b</span><span class="op" id="7396745">,</span>&nbsp;<span class="ident" id="7396747">err</span>&nbsp;<span class="op" id="7396751">:=</span>&nbsp;<span class="ident" id="7396754">Marshal</span><span class="op" id="7396761">(</span><span class="ident" id="7396762">a</span><span class="op" id="7396763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396766">if</span>&nbsp;<span class="ident" id="7396769">err</span>&nbsp;<span class="op" id="7396773">!=</span>&nbsp;<span class="ident" id="7396776">nil</span>&nbsp;<span class="op" id="7396780">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396784">t</span><span class="op" id="7396785">.</span><span class="ident" id="7396786">Fatalf</span><span class="op" id="7396792">(</span><span class="string" id="7396793">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7396806">,</span>&nbsp;<span class="ident" id="7396808">err</span><span class="op" id="7396811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7396817">if</span>&nbsp;<span class="ident" id="7396820">got</span>&nbsp;<span class="op" id="7396824">:=</span>&nbsp;<span class="builtintype" id="7396827">string</span><span class="op" id="7396833">(</span><span class="ident" id="7396834">b</span><span class="op" id="7396835">)</span><span class="op" id="7396836">;</span>&nbsp;<span class="ident" id="7396838">got</span>&nbsp;<span class="op" id="7396842">!=</span>&nbsp;<span class="ident" id="7396845">want</span>&nbsp;<span class="op" id="7396850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396854">t</span><span class="op" id="7396855">.</span><span class="ident" id="7396856">Errorf</span><span class="op" id="7396862">(</span><span class="string" id="7396863">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7396880">,</span>&nbsp;<span class="ident" id="7396882">got</span><span class="op" id="7396885">,</span>&nbsp;<span class="ident" id="7396887">want</span><span class="op" id="7396891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7396894">}</span><br>
<span class="lineno">270</span><span class="op" id="7396896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7396899">type</span>&nbsp;<span class="ident" id="7396904">BugA</span>&nbsp;<span class="keyword" id="7396909">struct</span>&nbsp;<span class="op" id="7396916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396919">S</span>&nbsp;<span class="builtintype" id="7396921">string</span><br>
<span class="lineno"></span><span class="op" id="7396928">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="7396931">type</span>&nbsp;<span class="ident" id="7396936">BugB</span>&nbsp;<span class="keyword" id="7396941">struct</span>&nbsp;<span class="op" id="7396948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396951">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396957">S</span>&nbsp;<span class="builtintype" id="7396959">string</span><br>
<span class="lineno"></span><span class="op" id="7396966">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7396969">type</span>&nbsp;<span class="ident" id="7396974">BugC</span>&nbsp;<span class="keyword" id="7396979">struct</span>&nbsp;<span class="op" id="7396986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7396989">S</span>&nbsp;<span class="builtintype" id="7396991">string</span><br>
<span class="lineno"></span><span class="op" id="7396998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="7397001">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="7397060">type</span>&nbsp;<span class="ident" id="7397065">BugX</span>&nbsp;<span class="keyword" id="7397070">struct</span>&nbsp;<span class="op" id="7397077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397080">A</span>&nbsp;<span class="builtintype" id="7397082">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397087">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397093">BugB</span><br>
<span class="lineno">290</span><span class="op" id="7397098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7397101">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="7397116">func</span>&nbsp;<span class="ident" id="7397121">TestEmbeddedBug</span><span class="op" id="7397136">(</span><span class="ident" id="7397137">t</span>&nbsp;<span class="op" id="7397139">*</span><span class="ident" id="7397140">testing</span><span class="op" id="7397147">.</span><span class="ident" id="7397148">T</span><span class="op" id="7397149">)</span>&nbsp;<span class="op" id="7397151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397154">v</span>&nbsp;<span class="op" id="7397156">:=</span>&nbsp;<span class="ident" id="7397159">BugB</span><span class="op" id="7397163">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397167">BugA</span><span class="op" id="7397171">{</span><span class="string" id="7397172">&#34;A&#34;</span><span class="op" id="7397175">}</span><span class="op" id="7397176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7397180">&#34;B&#34;</span><span class="op" id="7397183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397189">b</span><span class="op" id="7397190">,</span>&nbsp;<span class="ident" id="7397192">err</span>&nbsp;<span class="op" id="7397196">:=</span>&nbsp;<span class="ident" id="7397199">Marshal</span><span class="op" id="7397206">(</span><span class="ident" id="7397207">v</span><span class="op" id="7397208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7397211">if</span>&nbsp;<span class="ident" id="7397214">err</span>&nbsp;<span class="op" id="7397218">!=</span>&nbsp;<span class="ident" id="7397221">nil</span>&nbsp;<span class="op" id="7397225">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397229">t</span><span class="op" id="7397230">.</span><span class="ident" id="7397231">Fatal</span><span class="op" id="7397236">(</span><span class="string" id="7397237">&#34;Marshal:&#34;</span><span class="op" id="7397247">,</span>&nbsp;<span class="ident" id="7397249">err</span><span class="op" id="7397252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397258">want</span>&nbsp;<span class="op" id="7397263">:=</span>&nbsp;<span class="string" id="7397266">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397279">got</span>&nbsp;<span class="op" id="7397283">:=</span>&nbsp;<span class="builtintype" id="7397286">string</span><span class="op" id="7397292">(</span><span class="ident" id="7397293">b</span><span class="op" id="7397294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7397297">if</span>&nbsp;<span class="ident" id="7397300">got</span>&nbsp;<span class="op" id="7397304">!=</span>&nbsp;<span class="ident" id="7397307">want</span>&nbsp;<span class="op" id="7397312">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397316">t</span><span class="op" id="7397317">.</span><span class="ident" id="7397318">Fatalf</span><span class="op" id="7397324">(</span><span class="string" id="7397325">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7397350">,</span>&nbsp;<span class="ident" id="7397352">got</span><span class="op" id="7397355">,</span>&nbsp;<span class="ident" id="7397357">want</span><span class="op" id="7397361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7397367">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397427">x</span>&nbsp;<span class="op" id="7397429">:=</span>&nbsp;<span class="ident" id="7397432">BugX</span><span class="op" id="7397436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397440">A</span><span class="op" id="7397441">:</span>&nbsp;<span class="num" id="7397443">23</span><span class="op" id="7397445">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397451">b</span><span class="op" id="7397452">,</span>&nbsp;<span class="ident" id="7397454">err</span>&nbsp;<span class="op" id="7397458">=</span>&nbsp;<span class="ident" id="7397460">Marshal</span><span class="op" id="7397467">(</span><span class="ident" id="7397468">x</span><span class="op" id="7397469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7397472">if</span>&nbsp;<span class="ident" id="7397475">err</span>&nbsp;<span class="op" id="7397479">!=</span>&nbsp;<span class="ident" id="7397482">nil</span>&nbsp;<span class="op" id="7397486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397490">t</span><span class="op" id="7397491">.</span><span class="ident" id="7397492">Fatal</span><span class="op" id="7397497">(</span><span class="string" id="7397498">&#34;Marshal:&#34;</span><span class="op" id="7397508">,</span>&nbsp;<span class="ident" id="7397510">err</span><span class="op" id="7397513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397516">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397519">want</span>&nbsp;<span class="op" id="7397524">=</span>&nbsp;<span class="string" id="7397526">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397538">got</span>&nbsp;<span class="op" id="7397542">=</span>&nbsp;<span class="builtintype" id="7397544">string</span><span class="op" id="7397550">(</span><span class="ident" id="7397551">b</span><span class="op" id="7397552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7397555">if</span>&nbsp;<span class="ident" id="7397558">got</span>&nbsp;<span class="op" id="7397562">!=</span>&nbsp;<span class="ident" id="7397565">want</span>&nbsp;<span class="op" id="7397570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397574">t</span><span class="op" id="7397575">.</span><span class="ident" id="7397576">Fatalf</span><span class="op" id="7397582">(</span><span class="string" id="7397583">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7397608">,</span>&nbsp;<span class="ident" id="7397610">got</span><span class="op" id="7397613">,</span>&nbsp;<span class="ident" id="7397615">want</span><span class="op" id="7397619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397622">}</span><br>
<span class="lineno">320</span><span class="op" id="7397624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7397627">type</span>&nbsp;<span class="ident" id="7397632">BugD</span>&nbsp;<span class="keyword" id="7397637">struct</span>&nbsp;<span class="op" id="7397644">{</span>&nbsp;<span class="comment" id="7397646">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397678">XXX</span>&nbsp;<span class="builtintype" id="7397682">string</span>&nbsp;<span class="string" id="7397689">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7397700">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="7397703">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="7397752">type</span>&nbsp;<span class="ident" id="7397757">BugY</span>&nbsp;<span class="keyword" id="7397762">struct</span>&nbsp;<span class="op" id="7397769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397772">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397778">BugD</span><br>
<span class="lineno">330</span><span class="op" id="7397783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7397786">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="7397845">func</span>&nbsp;<span class="ident" id="7397850">TestTaggedFieldDominates</span><span class="op" id="7397874">(</span><span class="ident" id="7397875">t</span>&nbsp;<span class="op" id="7397877">*</span><span class="ident" id="7397878">testing</span><span class="op" id="7397885">.</span><span class="ident" id="7397886">T</span><span class="op" id="7397887">)</span>&nbsp;<span class="op" id="7397889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397892">v</span>&nbsp;<span class="op" id="7397894">:=</span>&nbsp;<span class="ident" id="7397897">BugY</span><span class="op" id="7397901">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397905">BugA</span><span class="op" id="7397909">{</span><span class="string" id="7397910">&#34;BugA&#34;</span><span class="op" id="7397916">}</span><span class="op" id="7397917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397921">BugD</span><span class="op" id="7397925">{</span><span class="string" id="7397926">&#34;BugD&#34;</span><span class="op" id="7397932">}</span><span class="op" id="7397933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7397936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397939">b</span><span class="op" id="7397940">,</span>&nbsp;<span class="ident" id="7397942">err</span>&nbsp;<span class="op" id="7397946">:=</span>&nbsp;<span class="ident" id="7397949">Marshal</span><span class="op" id="7397956">(</span><span class="ident" id="7397957">v</span><span class="op" id="7397958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7397961">if</span>&nbsp;<span class="ident" id="7397964">err</span>&nbsp;<span class="op" id="7397968">!=</span>&nbsp;<span class="ident" id="7397971">nil</span>&nbsp;<span class="op" id="7397975">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7397979">t</span><span class="op" id="7397980">.</span><span class="ident" id="7397981">Fatal</span><span class="op" id="7397986">(</span><span class="string" id="7397987">&#34;Marshal:&#34;</span><span class="op" id="7397997">,</span>&nbsp;<span class="ident" id="7397999">err</span><span class="op" id="7398002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398008">want</span>&nbsp;<span class="op" id="7398013">:=</span>&nbsp;<span class="string" id="7398016">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398032">got</span>&nbsp;<span class="op" id="7398036">:=</span>&nbsp;<span class="builtintype" id="7398039">string</span><span class="op" id="7398045">(</span><span class="ident" id="7398046">b</span><span class="op" id="7398047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398050">if</span>&nbsp;<span class="ident" id="7398053">got</span>&nbsp;<span class="op" id="7398057">!=</span>&nbsp;<span class="ident" id="7398060">want</span>&nbsp;<span class="op" id="7398065">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398069">t</span><span class="op" id="7398070">.</span><span class="ident" id="7398071">Fatalf</span><span class="op" id="7398077">(</span><span class="string" id="7398078">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7398103">,</span>&nbsp;<span class="ident" id="7398105">got</span><span class="op" id="7398108">,</span>&nbsp;<span class="ident" id="7398110">want</span><span class="op" id="7398114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398117">}</span><br>
<span class="lineno"></span><span class="op" id="7398119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7398122">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="7398173">type</span>&nbsp;<span class="ident" id="7398178">BugZ</span>&nbsp;<span class="keyword" id="7398183">struct</span>&nbsp;<span class="op" id="7398190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398193">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398199">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398205">BugY</span>&nbsp;<span class="comment" id="7398210">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="7398274">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7398277">func</span>&nbsp;<span class="ident" id="7398282">TestDuplicatedFieldDisappears</span><span class="op" id="7398311">(</span><span class="ident" id="7398312">t</span>&nbsp;<span class="op" id="7398314">*</span><span class="ident" id="7398315">testing</span><span class="op" id="7398322">.</span><span class="ident" id="7398323">T</span><span class="op" id="7398324">)</span>&nbsp;<span class="op" id="7398326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398329">v</span>&nbsp;<span class="op" id="7398331">:=</span>&nbsp;<span class="ident" id="7398334">BugZ</span><span class="op" id="7398338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398342">BugA</span><span class="op" id="7398346">{</span><span class="string" id="7398347">&#34;BugA&#34;</span><span class="op" id="7398353">}</span><span class="op" id="7398354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398358">BugC</span><span class="op" id="7398362">{</span><span class="string" id="7398363">&#34;BugC&#34;</span><span class="op" id="7398369">}</span><span class="op" id="7398370">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398374">BugY</span><span class="op" id="7398378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398383">BugA</span><span class="op" id="7398387">{</span><span class="string" id="7398388">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="7398401">}</span><span class="op" id="7398402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398407">BugD</span><span class="op" id="7398411">{</span><span class="string" id="7398412">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="7398425">}</span><span class="op" id="7398426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398430">}</span><span class="op" id="7398431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398434">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398437">b</span><span class="op" id="7398438">,</span>&nbsp;<span class="ident" id="7398440">err</span>&nbsp;<span class="op" id="7398444">:=</span>&nbsp;<span class="ident" id="7398447">Marshal</span><span class="op" id="7398454">(</span><span class="ident" id="7398455">v</span><span class="op" id="7398456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398459">if</span>&nbsp;<span class="ident" id="7398462">err</span>&nbsp;<span class="op" id="7398466">!=</span>&nbsp;<span class="ident" id="7398469">nil</span>&nbsp;<span class="op" id="7398473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398477">t</span><span class="op" id="7398478">.</span><span class="ident" id="7398479">Fatal</span><span class="op" id="7398484">(</span><span class="string" id="7398485">&#34;Marshal:&#34;</span><span class="op" id="7398495">,</span>&nbsp;<span class="ident" id="7398497">err</span><span class="op" id="7398500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398506">want</span>&nbsp;<span class="op" id="7398511">:=</span>&nbsp;<span class="string" id="7398514">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398520">got</span>&nbsp;<span class="op" id="7398524">:=</span>&nbsp;<span class="builtintype" id="7398527">string</span><span class="op" id="7398533">(</span><span class="ident" id="7398534">b</span><span class="op" id="7398535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398538">if</span>&nbsp;<span class="ident" id="7398541">got</span>&nbsp;<span class="op" id="7398545">!=</span>&nbsp;<span class="ident" id="7398548">want</span>&nbsp;<span class="op" id="7398553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398557">t</span><span class="op" id="7398558">.</span><span class="ident" id="7398559">Fatalf</span><span class="op" id="7398565">(</span><span class="string" id="7398566">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7398591">,</span>&nbsp;<span class="ident" id="7398593">got</span><span class="op" id="7398596">,</span>&nbsp;<span class="ident" id="7398598">want</span><span class="op" id="7398602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398605">}</span><br>
<span class="lineno"></span><span class="op" id="7398607">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7398610">func</span>&nbsp;<span class="ident" id="7398615">TestStringBytes</span><span class="op" id="7398630">(</span><span class="ident" id="7398631">t</span>&nbsp;<span class="op" id="7398633">*</span><span class="ident" id="7398634">testing</span><span class="op" id="7398641">.</span><span class="ident" id="7398642">T</span><span class="op" id="7398643">)</span>&nbsp;<span class="op" id="7398645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7398648">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398732">es</span>&nbsp;<span class="op" id="7398735">:=</span>&nbsp;<span class="op" id="7398738">&amp;</span><span class="ident" id="7398739">encodeState</span><span class="op" id="7398750">{</span><span class="op" id="7398751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398754">var</span>&nbsp;<span class="ident" id="7398758">r</span>&nbsp;<span class="op" id="7398760">[</span><span class="op" id="7398761">]</span><span class="builtintype" id="7398762">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398768">for</span>&nbsp;<span class="ident" id="7398772">i</span>&nbsp;<span class="op" id="7398774">:=</span>&nbsp;<span class="string" id="7398777">&#39;\u0000&#39;</span><span class="op" id="7398785">;</span>&nbsp;<span class="ident" id="7398787">i</span>&nbsp;<span class="op" id="7398789">&lt;=</span>&nbsp;<span class="ident" id="7398792">unicode</span><span class="op" id="7398799">.</span><span class="ident" id="7398800">MaxRune</span><span class="op" id="7398807">;</span>&nbsp;<span class="ident" id="7398809">i</span><span class="op" id="7398810">++</span>&nbsp;<span class="op" id="7398813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398817">r</span>&nbsp;<span class="op" id="7398819">=</span>&nbsp;<span class="builtinfunc" id="7398821">append</span><span class="op" id="7398827">(</span><span class="ident" id="7398828">r</span><span class="op" id="7398829">,</span>&nbsp;<span class="ident" id="7398831">i</span><span class="op" id="7398832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398838">s</span>&nbsp;<span class="op" id="7398840">:=</span>&nbsp;<span class="builtintype" id="7398843">string</span><span class="op" id="7398849">(</span><span class="ident" id="7398850">r</span><span class="op" id="7398851">)</span>&nbsp;<span class="op" id="7398853">+</span>&nbsp;<span class="string" id="7398855">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="7398875">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398902">_</span><span class="op" id="7398903">,</span>&nbsp;<span class="ident" id="7398905">err</span>&nbsp;<span class="op" id="7398909">:=</span>&nbsp;<span class="ident" id="7398912">es</span><span class="op" id="7398914">.</span><span class="builtintype" id="7398915">string</span><span class="op" id="7398921">(</span><span class="ident" id="7398922">s</span><span class="op" id="7398923">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7398926">if</span>&nbsp;<span class="ident" id="7398929">err</span>&nbsp;<span class="op" id="7398933">!=</span>&nbsp;<span class="ident" id="7398936">nil</span>&nbsp;<span class="op" id="7398940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398944">t</span><span class="op" id="7398945">.</span><span class="ident" id="7398946">Fatal</span><span class="op" id="7398951">(</span><span class="ident" id="7398952">err</span><span class="op" id="7398955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7398958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398962">esBytes</span>&nbsp;<span class="op" id="7398970">:=</span>&nbsp;<span class="op" id="7398973">&amp;</span><span class="ident" id="7398974">encodeState</span><span class="op" id="7398985">{</span><span class="op" id="7398986">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7398989">_</span><span class="op" id="7398990">,</span>&nbsp;<span class="ident" id="7398992">err</span>&nbsp;<span class="op" id="7398996">=</span>&nbsp;<span class="ident" id="7398998">esBytes</span><span class="op" id="7399005">.</span><span class="ident" id="7399006">stringBytes</span><span class="op" id="7399017">(</span><span class="op" id="7399018">[</span><span class="op" id="7399019">]</span><span class="builtintype" id="7399020">byte</span><span class="op" id="7399024">(</span><span class="ident" id="7399025">s</span><span class="op" id="7399026">)</span><span class="op" id="7399027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399030">if</span>&nbsp;<span class="ident" id="7399033">err</span>&nbsp;<span class="op" id="7399037">!=</span>&nbsp;<span class="ident" id="7399040">nil</span>&nbsp;<span class="op" id="7399044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399048">t</span><span class="op" id="7399049">.</span><span class="ident" id="7399050">Fatal</span><span class="op" id="7399055">(</span><span class="ident" id="7399056">err</span><span class="op" id="7399059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399066">enc</span>&nbsp;<span class="op" id="7399070">:=</span>&nbsp;<span class="ident" id="7399073">es</span><span class="op" id="7399075">.</span><span class="ident" id="7399076">Buffer</span><span class="op" id="7399082">.</span><span class="ident" id="7399083">String</span><span class="op" id="7399089">(</span><span class="op" id="7399090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399093">encBytes</span>&nbsp;<span class="op" id="7399102">:=</span>&nbsp;<span class="ident" id="7399105">esBytes</span><span class="op" id="7399112">.</span><span class="ident" id="7399113">Buffer</span><span class="op" id="7399119">.</span><span class="ident" id="7399120">String</span><span class="op" id="7399126">(</span><span class="op" id="7399127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399130">if</span>&nbsp;<span class="ident" id="7399133">enc</span>&nbsp;<span class="op" id="7399137">!=</span>&nbsp;<span class="ident" id="7399140">encBytes</span>&nbsp;<span class="op" id="7399149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399153">i</span>&nbsp;<span class="op" id="7399155">:=</span>&nbsp;<span class="num" id="7399158">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399162">for</span>&nbsp;<span class="ident" id="7399166">i</span>&nbsp;<span class="op" id="7399168">&lt;</span>&nbsp;<span class="builtinfunc" id="7399170">len</span><span class="op" id="7399173">(</span><span class="ident" id="7399174">enc</span><span class="op" id="7399177">)</span>&nbsp;<span class="op" id="7399179">&amp;&amp;</span>&nbsp;<span class="ident" id="7399182">i</span>&nbsp;<span class="op" id="7399184">&lt;</span>&nbsp;<span class="builtinfunc" id="7399186">len</span><span class="op" id="7399189">(</span><span class="ident" id="7399190">encBytes</span><span class="op" id="7399198">)</span>&nbsp;<span class="op" id="7399200">&amp;&amp;</span>&nbsp;<span class="ident" id="7399203">enc</span><span class="op" id="7399206">[</span><span class="ident" id="7399207">i</span><span class="op" id="7399208">]</span>&nbsp;<span class="op" id="7399210">==</span>&nbsp;<span class="ident" id="7399213">encBytes</span><span class="op" id="7399221">[</span><span class="ident" id="7399222">i</span><span class="op" id="7399223">]</span>&nbsp;<span class="op" id="7399225">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399230">i</span><span class="op" id="7399231">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399240">enc</span>&nbsp;<span class="op" id="7399244">=</span>&nbsp;<span class="ident" id="7399246">enc</span><span class="op" id="7399249">[</span><span class="ident" id="7399250">i</span><span class="op" id="7399251">:</span><span class="op" id="7399252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399256">encBytes</span>&nbsp;<span class="op" id="7399265">=</span>&nbsp;<span class="ident" id="7399267">encBytes</span><span class="op" id="7399275">[</span><span class="ident" id="7399276">i</span><span class="op" id="7399277">:</span><span class="op" id="7399278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399282">i</span>&nbsp;<span class="op" id="7399284">=</span>&nbsp;<span class="num" id="7399286">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399290">for</span>&nbsp;<span class="ident" id="7399294">i</span>&nbsp;<span class="op" id="7399296">&lt;</span>&nbsp;<span class="builtinfunc" id="7399298">len</span><span class="op" id="7399301">(</span><span class="ident" id="7399302">enc</span><span class="op" id="7399305">)</span>&nbsp;<span class="op" id="7399307">&amp;&amp;</span>&nbsp;<span class="ident" id="7399310">i</span>&nbsp;<span class="op" id="7399312">&lt;</span>&nbsp;<span class="builtinfunc" id="7399314">len</span><span class="op" id="7399317">(</span><span class="ident" id="7399318">encBytes</span><span class="op" id="7399326">)</span>&nbsp;<span class="op" id="7399328">&amp;&amp;</span>&nbsp;<span class="ident" id="7399331">enc</span><span class="op" id="7399334">[</span><span class="builtinfunc" id="7399335">len</span><span class="op" id="7399338">(</span><span class="ident" id="7399339">enc</span><span class="op" id="7399342">)</span><span class="op" id="7399343">-</span><span class="ident" id="7399344">i</span><span class="op" id="7399345">-</span><span class="num" id="7399346">1</span><span class="op" id="7399347">]</span>&nbsp;<span class="op" id="7399349">==</span>&nbsp;<span class="ident" id="7399352">encBytes</span><span class="op" id="7399360">[</span><span class="builtinfunc" id="7399361">len</span><span class="op" id="7399364">(</span><span class="ident" id="7399365">encBytes</span><span class="op" id="7399373">)</span><span class="op" id="7399374">-</span><span class="ident" id="7399375">i</span><span class="op" id="7399376">-</span><span class="num" id="7399377">1</span><span class="op" id="7399378">]</span>&nbsp;<span class="op" id="7399380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399385">i</span><span class="op" id="7399386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399395">enc</span>&nbsp;<span class="op" id="7399399">=</span>&nbsp;<span class="ident" id="7399401">enc</span><span class="op" id="7399404">[</span><span class="op" id="7399405">:</span><span class="builtinfunc" id="7399406">len</span><span class="op" id="7399409">(</span><span class="ident" id="7399410">enc</span><span class="op" id="7399413">)</span><span class="op" id="7399414">-</span><span class="ident" id="7399415">i</span><span class="op" id="7399416">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399420">encBytes</span>&nbsp;<span class="op" id="7399429">=</span>&nbsp;<span class="ident" id="7399431">encBytes</span><span class="op" id="7399439">[</span><span class="op" id="7399440">:</span><span class="builtinfunc" id="7399441">len</span><span class="op" id="7399444">(</span><span class="ident" id="7399445">encBytes</span><span class="op" id="7399453">)</span><span class="op" id="7399454">-</span><span class="ident" id="7399455">i</span><span class="op" id="7399456">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399461">if</span>&nbsp;<span class="builtinfunc" id="7399464">len</span><span class="op" id="7399467">(</span><span class="ident" id="7399468">enc</span><span class="op" id="7399471">)</span>&nbsp;<span class="op" id="7399473">&gt;</span>&nbsp;<span class="num" id="7399475">20</span>&nbsp;<span class="op" id="7399478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399483">enc</span>&nbsp;<span class="op" id="7399487">=</span>&nbsp;<span class="ident" id="7399489">enc</span><span class="op" id="7399492">[</span><span class="op" id="7399493">:</span><span class="num" id="7399494">20</span><span class="op" id="7399496">]</span>&nbsp;<span class="op" id="7399498">+</span>&nbsp;<span class="string" id="7399500">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399512">if</span>&nbsp;<span class="builtinfunc" id="7399515">len</span><span class="op" id="7399518">(</span><span class="ident" id="7399519">encBytes</span><span class="op" id="7399527">)</span>&nbsp;<span class="op" id="7399529">&gt;</span>&nbsp;<span class="num" id="7399531">20</span>&nbsp;<span class="op" id="7399534">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399539">encBytes</span>&nbsp;<span class="op" id="7399548">=</span>&nbsp;<span class="ident" id="7399550">encBytes</span><span class="op" id="7399558">[</span><span class="op" id="7399559">:</span><span class="num" id="7399560">20</span><span class="op" id="7399562">]</span>&nbsp;<span class="op" id="7399564">+</span>&nbsp;<span class="string" id="7399566">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399579">t</span><span class="op" id="7399580">.</span><span class="ident" id="7399581">Errorf</span><span class="op" id="7399587">(</span><span class="string" id="7399588">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="7399620">,</span>&nbsp;<span class="ident" id="7399622">enc</span><span class="op" id="7399625">,</span>&nbsp;<span class="ident" id="7399627">encBytes</span><span class="op" id="7399635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399638">}</span><br>
<span class="lineno">420</span><span class="op" id="7399640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7399643">func</span>&nbsp;<span class="ident" id="7399648">TestIssue6458</span><span class="op" id="7399661">(</span><span class="ident" id="7399662">t</span>&nbsp;<span class="op" id="7399664">*</span><span class="ident" id="7399665">testing</span><span class="op" id="7399672">.</span><span class="ident" id="7399673">T</span><span class="op" id="7399674">)</span>&nbsp;<span class="op" id="7399676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399679">type</span>&nbsp;<span class="ident" id="7399684">Foo</span>&nbsp;<span class="keyword" id="7399688">struct</span>&nbsp;<span class="op" id="7399695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399699">M</span>&nbsp;<span class="ident" id="7399701">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399716">x</span>&nbsp;<span class="op" id="7399718">:=</span>&nbsp;<span class="ident" id="7399721">Foo</span><span class="op" id="7399724">{</span><span class="ident" id="7399725">RawMessage</span><span class="op" id="7399735">(</span><span class="string" id="7399736">`&#34;foo&#34;`</span><span class="op" id="7399743">)</span><span class="op" id="7399744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399748">b</span><span class="op" id="7399749">,</span>&nbsp;<span class="ident" id="7399751">err</span>&nbsp;<span class="op" id="7399755">:=</span>&nbsp;<span class="ident" id="7399758">Marshal</span><span class="op" id="7399765">(</span><span class="op" id="7399766">&amp;</span><span class="ident" id="7399767">x</span><span class="op" id="7399768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399771">if</span>&nbsp;<span class="ident" id="7399774">err</span>&nbsp;<span class="op" id="7399778">!=</span>&nbsp;<span class="ident" id="7399781">nil</span>&nbsp;<span class="op" id="7399785">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399789">t</span><span class="op" id="7399790">.</span><span class="ident" id="7399791">Fatal</span><span class="op" id="7399796">(</span><span class="ident" id="7399797">err</span><span class="op" id="7399800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399806">if</span>&nbsp;<span class="ident" id="7399809">want</span>&nbsp;<span class="op" id="7399814">:=</span>&nbsp;<span class="string" id="7399817">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="7399830">;</span>&nbsp;<span class="builtintype" id="7399832">string</span><span class="op" id="7399838">(</span><span class="ident" id="7399839">b</span><span class="op" id="7399840">)</span>&nbsp;<span class="op" id="7399842">!=</span>&nbsp;<span class="ident" id="7399845">want</span>&nbsp;<span class="op" id="7399850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399854">t</span><span class="op" id="7399855">.</span><span class="ident" id="7399856">Errorf</span><span class="op" id="7399862">(</span><span class="string" id="7399863">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7399892">,</span>&nbsp;<span class="ident" id="7399894">b</span><span class="op" id="7399895">,</span>&nbsp;<span class="ident" id="7399897">want</span><span class="op" id="7399901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399904">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399908">b</span><span class="op" id="7399909">,</span>&nbsp;<span class="ident" id="7399911">err</span>&nbsp;<span class="op" id="7399915">=</span>&nbsp;<span class="ident" id="7399917">Marshal</span><span class="op" id="7399924">(</span><span class="ident" id="7399925">x</span><span class="op" id="7399926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399929">if</span>&nbsp;<span class="ident" id="7399932">err</span>&nbsp;<span class="op" id="7399936">!=</span>&nbsp;<span class="ident" id="7399939">nil</span>&nbsp;<span class="op" id="7399943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7399947">t</span><span class="op" id="7399948">.</span><span class="ident" id="7399949">Fatal</span><span class="op" id="7399954">(</span><span class="ident" id="7399955">err</span><span class="op" id="7399958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7399961">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7399965">if</span>&nbsp;<span class="ident" id="7399968">want</span>&nbsp;<span class="op" id="7399973">:=</span>&nbsp;<span class="string" id="7399976">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="7399994">;</span>&nbsp;<span class="builtintype" id="7399996">string</span><span class="op" id="7400002">(</span><span class="ident" id="7400003">b</span><span class="op" id="7400004">)</span>&nbsp;<span class="op" id="7400006">!=</span>&nbsp;<span class="ident" id="7400009">want</span>&nbsp;<span class="op" id="7400014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400018">t</span><span class="op" id="7400019">.</span><span class="ident" id="7400020">Errorf</span><span class="op" id="7400026">(</span><span class="string" id="7400027">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7400055">,</span>&nbsp;<span class="ident" id="7400057">b</span><span class="op" id="7400058">,</span>&nbsp;<span class="ident" id="7400060">want</span><span class="op" id="7400064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400067">}</span><br>
<span class="lineno"></span><span class="op" id="7400069">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7400072">func</span>&nbsp;<span class="ident" id="7400077">TestHTMLEscape</span><span class="op" id="7400091">(</span><span class="ident" id="7400092">t</span>&nbsp;<span class="op" id="7400094">*</span><span class="ident" id="7400095">testing</span><span class="op" id="7400102">.</span><span class="ident" id="7400103">T</span><span class="op" id="7400104">)</span>&nbsp;<span class="op" id="7400106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400109">var</span>&nbsp;<span class="ident" id="7400113">b</span><span class="op" id="7400114">,</span>&nbsp;<span class="ident" id="7400116">want</span>&nbsp;<span class="ident" id="7400121">bytes</span><span class="op" id="7400126">.</span><span class="ident" id="7400127">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400135">m</span>&nbsp;<span class="op" id="7400137">:=</span>&nbsp;<span class="string" id="7400140">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="7400160">+</span>&nbsp;<span class="string" id="7400162">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="7400190">+</span>&nbsp;<span class="string" id="7400192">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400205">want</span><span class="op" id="7400209">.</span><span class="ident" id="7400210">Write</span><span class="op" id="7400215">(</span><span class="op" id="7400216">[</span><span class="op" id="7400217">]</span><span class="builtintype" id="7400218">byte</span><span class="op" id="7400222">(</span><span class="string" id="7400223">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="7400289">)</span><span class="op" id="7400290">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400293">HTMLEscape</span><span class="op" id="7400303">(</span><span class="op" id="7400304">&amp;</span><span class="ident" id="7400305">b</span><span class="op" id="7400306">,</span>&nbsp;<span class="op" id="7400308">[</span><span class="op" id="7400309">]</span><span class="builtintype" id="7400310">byte</span><span class="op" id="7400314">(</span><span class="ident" id="7400315">m</span><span class="op" id="7400316">)</span><span class="op" id="7400317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400320">if</span>&nbsp;<span class="op" id="7400323">!</span><span class="ident" id="7400324">bytes</span><span class="op" id="7400329">.</span><span class="ident" id="7400330">Equal</span><span class="op" id="7400335">(</span><span class="ident" id="7400336">b</span><span class="op" id="7400337">.</span><span class="ident" id="7400338">Bytes</span><span class="op" id="7400343">(</span><span class="op" id="7400344">)</span><span class="op" id="7400345">,</span>&nbsp;<span class="ident" id="7400347">want</span><span class="op" id="7400351">.</span><span class="ident" id="7400352">Bytes</span><span class="op" id="7400357">(</span><span class="op" id="7400358">)</span><span class="op" id="7400359">)</span>&nbsp;<span class="op" id="7400361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400365">t</span><span class="op" id="7400366">.</span><span class="ident" id="7400367">Errorf</span><span class="op" id="7400373">(</span><span class="string" id="7400374">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7400415">,</span>&nbsp;<span class="ident" id="7400417">b</span><span class="op" id="7400418">.</span><span class="ident" id="7400419">Bytes</span><span class="op" id="7400424">(</span><span class="op" id="7400425">)</span><span class="op" id="7400426">,</span>&nbsp;<span class="ident" id="7400428">want</span><span class="op" id="7400432">.</span><span class="ident" id="7400433">Bytes</span><span class="op" id="7400438">(</span><span class="op" id="7400439">)</span><span class="op" id="7400440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400443">}</span><br>
<span class="lineno"></span><span class="op" id="7400445">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="7400448">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="7400473">func</span>&nbsp;<span class="ident" id="7400478">TestEncodePointerString</span><span class="op" id="7400501">(</span><span class="ident" id="7400502">t</span>&nbsp;<span class="op" id="7400504">*</span><span class="ident" id="7400505">testing</span><span class="op" id="7400512">.</span><span class="ident" id="7400513">T</span><span class="op" id="7400514">)</span>&nbsp;<span class="op" id="7400516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400519">type</span>&nbsp;<span class="ident" id="7400524">stringPointer</span>&nbsp;<span class="keyword" id="7400538">struct</span>&nbsp;<span class="op" id="7400545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400549">N</span>&nbsp;<span class="op" id="7400551">*</span><span class="ident" id="7400552">int64</span>&nbsp;<span class="string" id="7400558">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400580">var</span>&nbsp;<span class="ident" id="7400584">n</span>&nbsp;<span class="ident" id="7400586">int64</span>&nbsp;<span class="op" id="7400592">=</span>&nbsp;<span class="num" id="7400594">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400598">b</span><span class="op" id="7400599">,</span>&nbsp;<span class="ident" id="7400601">err</span>&nbsp;<span class="op" id="7400605">:=</span>&nbsp;<span class="ident" id="7400608">Marshal</span><span class="op" id="7400615">(</span><span class="ident" id="7400616">stringPointer</span><span class="op" id="7400629">{</span><span class="ident" id="7400630">N</span><span class="op" id="7400631">:</span>&nbsp;<span class="op" id="7400633">&amp;</span><span class="ident" id="7400634">n</span><span class="op" id="7400635">}</span><span class="op" id="7400636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400639">if</span>&nbsp;<span class="ident" id="7400642">err</span>&nbsp;<span class="op" id="7400646">!=</span>&nbsp;<span class="ident" id="7400649">nil</span>&nbsp;<span class="op" id="7400653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400657">t</span><span class="op" id="7400658">.</span><span class="ident" id="7400659">Fatalf</span><span class="op" id="7400665">(</span><span class="string" id="7400666">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7400679">,</span>&nbsp;<span class="ident" id="7400681">err</span><span class="op" id="7400684">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400690">if</span>&nbsp;<span class="ident" id="7400693">got</span><span class="op" id="7400696">,</span>&nbsp;<span class="ident" id="7400698">want</span>&nbsp;<span class="op" id="7400703">:=</span>&nbsp;<span class="builtintype" id="7400706">string</span><span class="op" id="7400712">(</span><span class="ident" id="7400713">b</span><span class="op" id="7400714">)</span><span class="op" id="7400715">,</span>&nbsp;<span class="string" id="7400717">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="7400729">;</span>&nbsp;<span class="ident" id="7400731">got</span>&nbsp;<span class="op" id="7400735">!=</span>&nbsp;<span class="ident" id="7400738">want</span>&nbsp;<span class="op" id="7400743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400747">t</span><span class="op" id="7400748">.</span><span class="ident" id="7400749">Errorf</span><span class="op" id="7400755">(</span><span class="string" id="7400756">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7400779">,</span>&nbsp;<span class="ident" id="7400781">got</span><span class="op" id="7400784">,</span>&nbsp;<span class="ident" id="7400786">want</span><span class="op" id="7400790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400796">var</span>&nbsp;<span class="ident" id="7400800">back</span>&nbsp;<span class="ident" id="7400805">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400820">err</span>&nbsp;<span class="op" id="7400824">=</span>&nbsp;<span class="ident" id="7400826">Unmarshal</span><span class="op" id="7400835">(</span><span class="ident" id="7400836">b</span><span class="op" id="7400837">,</span>&nbsp;<span class="op" id="7400839">&amp;</span><span class="ident" id="7400840">back</span><span class="op" id="7400844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400847">if</span>&nbsp;<span class="ident" id="7400850">err</span>&nbsp;<span class="op" id="7400854">!=</span>&nbsp;<span class="ident" id="7400857">nil</span>&nbsp;<span class="op" id="7400861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400865">t</span><span class="op" id="7400866">.</span><span class="ident" id="7400867">Fatalf</span><span class="op" id="7400873">(</span><span class="string" id="7400874">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="7400889">,</span>&nbsp;<span class="ident" id="7400891">err</span><span class="op" id="7400894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400900">if</span>&nbsp;<span class="ident" id="7400903">back</span><span class="op" id="7400907">.</span><span class="ident" id="7400908">N</span>&nbsp;<span class="op" id="7400910">==</span>&nbsp;<span class="ident" id="7400913">nil</span>&nbsp;<span class="op" id="7400917">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400921">t</span><span class="op" id="7400922">.</span><span class="ident" id="7400923">Fatalf</span><span class="op" id="7400929">(</span><span class="string" id="7400930">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="7400956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7400959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7400962">if</span>&nbsp;<span class="op" id="7400965">*</span><span class="ident" id="7400966">back</span><span class="op" id="7400970">.</span><span class="ident" id="7400971">N</span>&nbsp;<span class="op" id="7400973">!=</span>&nbsp;<span class="num" id="7400976">42</span>&nbsp;<span class="op" id="7400979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7400983">t</span><span class="op" id="7400984">.</span><span class="ident" id="7400985">Fatalf</span><span class="op" id="7400991">(</span><span class="string" id="7400992">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="7401010">,</span>&nbsp;<span class="op" id="7401012">*</span><span class="ident" id="7401013">back</span><span class="op" id="7401017">.</span><span class="ident" id="7401018">N</span><span class="op" id="7401019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401022">}</span><br>
<span class="lineno">480</span><span class="op" id="7401024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7401027">var</span>&nbsp;<span class="ident" id="7401031">encodeStringTests</span>&nbsp;<span class="op" id="7401049">=</span>&nbsp;<span class="op" id="7401051">[</span><span class="op" id="7401052">]</span><span class="keyword" id="7401053">struct</span>&nbsp;<span class="op" id="7401060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7401063">in</span>&nbsp;&nbsp;<span class="builtintype" id="7401067">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7401075">out</span>&nbsp;<span class="builtintype" id="7401079">string</span><br>
<span class="lineno">485</span><span class="op" id="7401086">}</span><span class="op" id="7401087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401090">{</span><span class="string" id="7401091">&#34;\x00&#34;</span><span class="op" id="7401097">,</span>&nbsp;<span class="string" id="7401099">`&#34;\u0000&#34;`</span><span class="op" id="7401109">}</span><span class="op" id="7401110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401113">{</span><span class="string" id="7401114">&#34;\x01&#34;</span><span class="op" id="7401120">,</span>&nbsp;<span class="string" id="7401122">`&#34;\u0001&#34;`</span><span class="op" id="7401132">}</span><span class="op" id="7401133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401136">{</span><span class="string" id="7401137">&#34;\x02&#34;</span><span class="op" id="7401143">,</span>&nbsp;<span class="string" id="7401145">`&#34;\u0002&#34;`</span><span class="op" id="7401155">}</span><span class="op" id="7401156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401159">{</span><span class="string" id="7401160">&#34;\x03&#34;</span><span class="op" id="7401166">,</span>&nbsp;<span class="string" id="7401168">`&#34;\u0003&#34;`</span><span class="op" id="7401178">}</span><span class="op" id="7401179">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401182">{</span><span class="string" id="7401183">&#34;\x04&#34;</span><span class="op" id="7401189">,</span>&nbsp;<span class="string" id="7401191">`&#34;\u0004&#34;`</span><span class="op" id="7401201">}</span><span class="op" id="7401202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401205">{</span><span class="string" id="7401206">&#34;\x05&#34;</span><span class="op" id="7401212">,</span>&nbsp;<span class="string" id="7401214">`&#34;\u0005&#34;`</span><span class="op" id="7401224">}</span><span class="op" id="7401225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401228">{</span><span class="string" id="7401229">&#34;\x06&#34;</span><span class="op" id="7401235">,</span>&nbsp;<span class="string" id="7401237">`&#34;\u0006&#34;`</span><span class="op" id="7401247">}</span><span class="op" id="7401248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401251">{</span><span class="string" id="7401252">&#34;\x07&#34;</span><span class="op" id="7401258">,</span>&nbsp;<span class="string" id="7401260">`&#34;\u0007&#34;`</span><span class="op" id="7401270">}</span><span class="op" id="7401271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401274">{</span><span class="string" id="7401275">&#34;\x08&#34;</span><span class="op" id="7401281">,</span>&nbsp;<span class="string" id="7401283">`&#34;\u0008&#34;`</span><span class="op" id="7401293">}</span><span class="op" id="7401294">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401297">{</span><span class="string" id="7401298">&#34;\x09&#34;</span><span class="op" id="7401304">,</span>&nbsp;<span class="string" id="7401306">`&#34;\t&#34;`</span><span class="op" id="7401312">}</span><span class="op" id="7401313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401316">{</span><span class="string" id="7401317">&#34;\x0a&#34;</span><span class="op" id="7401323">,</span>&nbsp;<span class="string" id="7401325">`&#34;\n&#34;`</span><span class="op" id="7401331">}</span><span class="op" id="7401332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401335">{</span><span class="string" id="7401336">&#34;\x0b&#34;</span><span class="op" id="7401342">,</span>&nbsp;<span class="string" id="7401344">`&#34;\u000b&#34;`</span><span class="op" id="7401354">}</span><span class="op" id="7401355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401358">{</span><span class="string" id="7401359">&#34;\x0c&#34;</span><span class="op" id="7401365">,</span>&nbsp;<span class="string" id="7401367">`&#34;\u000c&#34;`</span><span class="op" id="7401377">}</span><span class="op" id="7401378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401381">{</span><span class="string" id="7401382">&#34;\x0d&#34;</span><span class="op" id="7401388">,</span>&nbsp;<span class="string" id="7401390">`&#34;\r&#34;`</span><span class="op" id="7401396">}</span><span class="op" id="7401397">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401400">{</span><span class="string" id="7401401">&#34;\x0e&#34;</span><span class="op" id="7401407">,</span>&nbsp;<span class="string" id="7401409">`&#34;\u000e&#34;`</span><span class="op" id="7401419">}</span><span class="op" id="7401420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401423">{</span><span class="string" id="7401424">&#34;\x0f&#34;</span><span class="op" id="7401430">,</span>&nbsp;<span class="string" id="7401432">`&#34;\u000f&#34;`</span><span class="op" id="7401442">}</span><span class="op" id="7401443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401446">{</span><span class="string" id="7401447">&#34;\x10&#34;</span><span class="op" id="7401453">,</span>&nbsp;<span class="string" id="7401455">`&#34;\u0010&#34;`</span><span class="op" id="7401465">}</span><span class="op" id="7401466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401469">{</span><span class="string" id="7401470">&#34;\x11&#34;</span><span class="op" id="7401476">,</span>&nbsp;<span class="string" id="7401478">`&#34;\u0011&#34;`</span><span class="op" id="7401488">}</span><span class="op" id="7401489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401492">{</span><span class="string" id="7401493">&#34;\x12&#34;</span><span class="op" id="7401499">,</span>&nbsp;<span class="string" id="7401501">`&#34;\u0012&#34;`</span><span class="op" id="7401511">}</span><span class="op" id="7401512">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401515">{</span><span class="string" id="7401516">&#34;\x13&#34;</span><span class="op" id="7401522">,</span>&nbsp;<span class="string" id="7401524">`&#34;\u0013&#34;`</span><span class="op" id="7401534">}</span><span class="op" id="7401535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401538">{</span><span class="string" id="7401539">&#34;\x14&#34;</span><span class="op" id="7401545">,</span>&nbsp;<span class="string" id="7401547">`&#34;\u0014&#34;`</span><span class="op" id="7401557">}</span><span class="op" id="7401558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401561">{</span><span class="string" id="7401562">&#34;\x15&#34;</span><span class="op" id="7401568">,</span>&nbsp;<span class="string" id="7401570">`&#34;\u0015&#34;`</span><span class="op" id="7401580">}</span><span class="op" id="7401581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401584">{</span><span class="string" id="7401585">&#34;\x16&#34;</span><span class="op" id="7401591">,</span>&nbsp;<span class="string" id="7401593">`&#34;\u0016&#34;`</span><span class="op" id="7401603">}</span><span class="op" id="7401604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401607">{</span><span class="string" id="7401608">&#34;\x17&#34;</span><span class="op" id="7401614">,</span>&nbsp;<span class="string" id="7401616">`&#34;\u0017&#34;`</span><span class="op" id="7401626">}</span><span class="op" id="7401627">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401630">{</span><span class="string" id="7401631">&#34;\x18&#34;</span><span class="op" id="7401637">,</span>&nbsp;<span class="string" id="7401639">`&#34;\u0018&#34;`</span><span class="op" id="7401649">}</span><span class="op" id="7401650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401653">{</span><span class="string" id="7401654">&#34;\x19&#34;</span><span class="op" id="7401660">,</span>&nbsp;<span class="string" id="7401662">`&#34;\u0019&#34;`</span><span class="op" id="7401672">}</span><span class="op" id="7401673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401676">{</span><span class="string" id="7401677">&#34;\x1a&#34;</span><span class="op" id="7401683">,</span>&nbsp;<span class="string" id="7401685">`&#34;\u001a&#34;`</span><span class="op" id="7401695">}</span><span class="op" id="7401696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401699">{</span><span class="string" id="7401700">&#34;\x1b&#34;</span><span class="op" id="7401706">,</span>&nbsp;<span class="string" id="7401708">`&#34;\u001b&#34;`</span><span class="op" id="7401718">}</span><span class="op" id="7401719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401722">{</span><span class="string" id="7401723">&#34;\x1c&#34;</span><span class="op" id="7401729">,</span>&nbsp;<span class="string" id="7401731">`&#34;\u001c&#34;`</span><span class="op" id="7401741">}</span><span class="op" id="7401742">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401745">{</span><span class="string" id="7401746">&#34;\x1d&#34;</span><span class="op" id="7401752">,</span>&nbsp;<span class="string" id="7401754">`&#34;\u001d&#34;`</span><span class="op" id="7401764">}</span><span class="op" id="7401765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401768">{</span><span class="string" id="7401769">&#34;\x1e&#34;</span><span class="op" id="7401775">,</span>&nbsp;<span class="string" id="7401777">`&#34;\u001e&#34;`</span><span class="op" id="7401787">}</span><span class="op" id="7401788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401791">{</span><span class="string" id="7401792">&#34;\x1f&#34;</span><span class="op" id="7401798">,</span>&nbsp;<span class="string" id="7401800">`&#34;\u001f&#34;`</span><span class="op" id="7401810">}</span><span class="op" id="7401811">,</span><br>
<span class="lineno"></span><span class="op" id="7401813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="7401816">func</span>&nbsp;<span class="ident" id="7401821">TestEncodeString</span><span class="op" id="7401837">(</span><span class="ident" id="7401838">t</span>&nbsp;<span class="op" id="7401840">*</span><span class="ident" id="7401841">testing</span><span class="op" id="7401848">.</span><span class="ident" id="7401849">T</span><span class="op" id="7401850">)</span>&nbsp;<span class="op" id="7401852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7401855">for</span>&nbsp;<span class="ident" id="7401859">_</span><span class="op" id="7401860">,</span>&nbsp;<span class="ident" id="7401862">tt</span>&nbsp;<span class="op" id="7401865">:=</span>&nbsp;<span class="keyword" id="7401868">range</span>&nbsp;<span class="ident" id="7401874">encodeStringTests</span>&nbsp;<span class="op" id="7401892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7401896">b</span><span class="op" id="7401897">,</span>&nbsp;<span class="ident" id="7401899">err</span>&nbsp;<span class="op" id="7401903">:=</span>&nbsp;<span class="ident" id="7401906">Marshal</span><span class="op" id="7401913">(</span><span class="ident" id="7401914">tt</span><span class="op" id="7401916">.</span><span class="ident" id="7401917">in</span><span class="op" id="7401919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7401923">if</span>&nbsp;<span class="ident" id="7401926">err</span>&nbsp;<span class="op" id="7401930">!=</span>&nbsp;<span class="ident" id="7401933">nil</span>&nbsp;<span class="op" id="7401937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7401942">t</span><span class="op" id="7401943">.</span><span class="ident" id="7401944">Errorf</span><span class="op" id="7401950">(</span><span class="string" id="7401951">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="7401968">,</span>&nbsp;<span class="ident" id="7401970">tt</span><span class="op" id="7401972">.</span><span class="ident" id="7401973">in</span><span class="op" id="7401975">,</span>&nbsp;<span class="ident" id="7401977">err</span><span class="op" id="7401980">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7401985">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7401996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7402000">out</span>&nbsp;<span class="op" id="7402004">:=</span>&nbsp;<span class="builtintype" id="7402007">string</span><span class="op" id="7402013">(</span><span class="ident" id="7402014">b</span><span class="op" id="7402015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7402019">if</span>&nbsp;<span class="ident" id="7402022">out</span>&nbsp;<span class="op" id="7402026">!=</span>&nbsp;<span class="ident" id="7402029">tt</span><span class="op" id="7402031">.</span><span class="ident" id="7402032">out</span>&nbsp;<span class="op" id="7402036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7402041">t</span><span class="op" id="7402042">.</span><span class="ident" id="7402043">Errorf</span><span class="op" id="7402049">(</span><span class="string" id="7402050">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7402079">,</span>&nbsp;<span class="ident" id="7402081">tt</span><span class="op" id="7402083">.</span><span class="ident" id="7402084">in</span><span class="op" id="7402086">,</span>&nbsp;<span class="ident" id="7402088">out</span><span class="op" id="7402091">,</span>&nbsp;<span class="ident" id="7402093">tt</span><span class="op" id="7402095">.</span><span class="ident" id="7402096">out</span><span class="op" id="7402099">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7402103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7402106">}</span><br>
<span class="lineno"></span><span class="op" id="7402108">}</span>
</div>
</body>
</html>
