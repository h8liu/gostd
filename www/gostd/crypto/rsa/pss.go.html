<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3703390">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3703445">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3703499">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3703550">package</span>&nbsp;<span class="ident" id="3703558">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3703563">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3703617">//</span><br>
<span class="lineno"></span><span class="comment" id="3703620">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3703717">import</span>&nbsp;<span class="op" id="3703724">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703727">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703736">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703746">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703756">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703764">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3703770">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3703781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3703784">func</span>&nbsp;<span class="ident" id="3703789">emsaPSSEncode</span><span class="op" id="3703802">(</span><span class="ident" id="3703803">mHash</span>&nbsp;<span class="op" id="3703809">[</span><span class="op" id="3703810">]</span><span class="builtintype" id="3703811">byte</span><span class="op" id="3703815">,</span>&nbsp;<span class="ident" id="3703817">emBits</span>&nbsp;<span class="builtintype" id="3703824">int</span><span class="op" id="3703827">,</span>&nbsp;<span class="ident" id="3703829">salt</span>&nbsp;<span class="op" id="3703834">[</span><span class="op" id="3703835">]</span><span class="builtintype" id="3703836">byte</span><span class="op" id="3703840">,</span>&nbsp;<span class="ident" id="3703842">hash</span>&nbsp;<span class="ident" id="3703847">hash</span><span class="op" id="3703851">.</span><span class="ident" id="3703852">Hash</span><span class="op" id="3703856">)</span>&nbsp;<span class="op" id="3703858">(</span><span class="op" id="3703859">[</span><span class="op" id="3703860">]</span><span class="builtintype" id="3703861">byte</span><span class="op" id="3703865">,</span>&nbsp;<span class="builtintype" id="3703867">error</span><span class="op" id="3703872">)</span>&nbsp;<span class="op" id="3703874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703877">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703904">hLen</span>&nbsp;<span class="op" id="3703909">:=</span>&nbsp;<span class="ident" id="3703912">hash</span><span class="op" id="3703916">.</span><span class="ident" id="3703917">Size</span><span class="op" id="3703921">(</span><span class="op" id="3703922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703925">sLen</span>&nbsp;<span class="op" id="3703930">:=</span>&nbsp;<span class="builtinfunc" id="3703933">len</span><span class="op" id="3703936">(</span><span class="ident" id="3703937">salt</span><span class="op" id="3703941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703944">emLen</span>&nbsp;<span class="op" id="3703950">:=</span>&nbsp;<span class="op" id="3703953">(</span><span class="ident" id="3703954">emBits</span>&nbsp;<span class="op" id="3703961">+</span>&nbsp;<span class="num" id="3703963">7</span><span class="op" id="3703964">)</span>&nbsp;<span class="op" id="3703966">/</span>&nbsp;<span class="num" id="3703968">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703972">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704044">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704115">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704139">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704143">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704205">if</span>&nbsp;<span class="builtinfunc" id="3704208">len</span><span class="op" id="3704211">(</span><span class="ident" id="3704212">mHash</span><span class="op" id="3704217">)</span>&nbsp;<span class="op" id="3704219">!=</span>&nbsp;<span class="ident" id="3704222">hLen</span>&nbsp;<span class="op" id="3704227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704231">return</span>&nbsp;<span class="ident" id="3704238">nil</span><span class="op" id="3704241">,</span>&nbsp;<span class="ident" id="3704243">errors</span><span class="op" id="3704249">.</span><span class="ident" id="3704250">New</span><span class="op" id="3704253">(</span><span class="string" id="3704254">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="3704296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704299">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704303">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704374">if</span>&nbsp;<span class="ident" id="3704377">emLen</span>&nbsp;<span class="op" id="3704383">&lt;</span>&nbsp;<span class="ident" id="3704385">hLen</span><span class="op" id="3704389">+</span><span class="ident" id="3704390">sLen</span><span class="op" id="3704394">+</span><span class="num" id="3704395">2</span>&nbsp;<span class="op" id="3704397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704401">return</span>&nbsp;<span class="ident" id="3704408">nil</span><span class="op" id="3704411">,</span>&nbsp;<span class="ident" id="3704413">errors</span><span class="op" id="3704419">.</span><span class="ident" id="3704420">New</span><span class="op" id="3704423">(</span><span class="string" id="3704424">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="3704452">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704459">em</span>&nbsp;<span class="op" id="3704462">:=</span>&nbsp;<span class="builtinfunc" id="3704465">make</span><span class="op" id="3704469">(</span><span class="op" id="3704470">[</span><span class="op" id="3704471">]</span><span class="builtintype" id="3704472">byte</span><span class="op" id="3704476">,</span>&nbsp;<span class="ident" id="3704478">emLen</span><span class="op" id="3704483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704486">db</span>&nbsp;<span class="op" id="3704489">:=</span>&nbsp;<span class="ident" id="3704492">em</span><span class="op" id="3704494">[</span><span class="op" id="3704495">:</span><span class="ident" id="3704496">emLen</span><span class="op" id="3704501">-</span><span class="ident" id="3704502">sLen</span><span class="op" id="3704506">-</span><span class="ident" id="3704507">hLen</span><span class="op" id="3704511">-</span><span class="num" id="3704512">2</span><span class="op" id="3704513">+</span><span class="num" id="3704514">1</span><span class="op" id="3704515">+</span><span class="ident" id="3704516">sLen</span><span class="op" id="3704520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704523">h</span>&nbsp;<span class="op" id="3704525">:=</span>&nbsp;<span class="ident" id="3704528">em</span><span class="op" id="3704530">[</span><span class="ident" id="3704531">emLen</span><span class="op" id="3704536">-</span><span class="ident" id="3704537">sLen</span><span class="op" id="3704541">-</span><span class="ident" id="3704542">hLen</span><span class="op" id="3704546">-</span><span class="num" id="3704547">2</span><span class="op" id="3704548">+</span><span class="num" id="3704549">1</span><span class="op" id="3704550">+</span><span class="ident" id="3704551">sLen</span>&nbsp;<span class="op" id="3704556">:</span>&nbsp;<span class="ident" id="3704558">emLen</span><span class="op" id="3704563">-</span><span class="num" id="3704564">1</span><span class="op" id="3704565">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704569">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704642">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704681">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704685">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704697">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704758">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704762">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704829">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704858">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704862">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704921">var</span>&nbsp;<span class="ident" id="3704925">prefix</span>&nbsp;<span class="op" id="3704932">[</span><span class="num" id="3704933">8</span><span class="op" id="3704934">]</span><span class="builtintype" id="3704935">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704942">hash</span><span class="op" id="3704946">.</span><span class="ident" id="3704947">Write</span><span class="op" id="3704952">(</span><span class="ident" id="3704953">prefix</span><span class="op" id="3704959">[</span><span class="op" id="3704960">:</span><span class="op" id="3704961">]</span><span class="op" id="3704962">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704965">hash</span><span class="op" id="3704969">.</span><span class="ident" id="3704970">Write</span><span class="op" id="3704975">(</span><span class="ident" id="3704976">mHash</span><span class="op" id="3704981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704984">hash</span><span class="op" id="3704988">.</span><span class="ident" id="3704989">Write</span><span class="op" id="3704994">(</span><span class="ident" id="3704995">salt</span><span class="op" id="3704999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705003">h</span>&nbsp;<span class="op" id="3705005">=</span>&nbsp;<span class="ident" id="3705007">hash</span><span class="op" id="3705011">.</span><span class="ident" id="3705012">Sum</span><span class="op" id="3705015">(</span><span class="ident" id="3705016">h</span><span class="op" id="3705017">[</span><span class="op" id="3705018">:</span><span class="num" id="3705019">0</span><span class="op" id="3705020">]</span><span class="op" id="3705021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705024">hash</span><span class="op" id="3705028">.</span><span class="ident" id="3705029">Reset</span><span class="op" id="3705034">(</span><span class="op" id="3705035">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705039">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705113">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705162">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705166">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705235">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705262">db</span><span class="op" id="3705264">[</span><span class="ident" id="3705265">emLen</span><span class="op" id="3705270">-</span><span class="ident" id="3705271">sLen</span><span class="op" id="3705275">-</span><span class="ident" id="3705276">hLen</span><span class="op" id="3705280">-</span><span class="num" id="3705281">2</span><span class="op" id="3705282">]</span>&nbsp;<span class="op" id="3705284">=</span>&nbsp;<span class="num" id="3705286">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3705292">copy</span><span class="op" id="3705296">(</span><span class="ident" id="3705297">db</span><span class="op" id="3705299">[</span><span class="ident" id="3705300">emLen</span><span class="op" id="3705305">-</span><span class="ident" id="3705306">sLen</span><span class="op" id="3705310">-</span><span class="ident" id="3705311">hLen</span><span class="op" id="3705315">-</span><span class="num" id="3705316">1</span><span class="op" id="3705317">:</span><span class="op" id="3705318">]</span><span class="op" id="3705319">,</span>&nbsp;<span class="ident" id="3705321">salt</span><span class="op" id="3705325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705329">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705376">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705380">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705420">mgf1XOR</span><span class="op" id="3705427">(</span><span class="ident" id="3705428">db</span><span class="op" id="3705430">,</span>&nbsp;<span class="ident" id="3705432">hash</span><span class="op" id="3705436">,</span>&nbsp;<span class="ident" id="3705438">h</span><span class="op" id="3705439">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705443">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705517">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705544">db</span><span class="op" id="3705546">[</span><span class="num" id="3705547">0</span><span class="op" id="3705548">]</span>&nbsp;<span class="op" id="3705550">&amp;=</span>&nbsp;<span class="op" id="3705553">(</span><span class="num" id="3705554">0xFF</span>&nbsp;<span class="op" id="3705559">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3705562">uint</span><span class="op" id="3705566">(</span><span class="num" id="3705567">8</span><span class="op" id="3705568">*</span><span class="ident" id="3705569">emLen</span><span class="op" id="3705574">-</span><span class="ident" id="3705575">emBits</span><span class="op" id="3705581">)</span><span class="op" id="3705582">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705586">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705626">em</span><span class="op" id="3705628">[</span><span class="ident" id="3705629">emLen</span><span class="op" id="3705634">-</span><span class="num" id="3705635">1</span><span class="op" id="3705636">]</span>&nbsp;<span class="op" id="3705638">=</span>&nbsp;<span class="num" id="3705640">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705647">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705666">return</span>&nbsp;<span class="ident" id="3705673">em</span><span class="op" id="3705675">,</span>&nbsp;<span class="ident" id="3705677">nil</span><br>
<span class="lineno"></span><span class="op" id="3705681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3705684">func</span>&nbsp;<span class="ident" id="3705689">emsaPSSVerify</span><span class="op" id="3705702">(</span><span class="ident" id="3705703">mHash</span><span class="op" id="3705708">,</span>&nbsp;<span class="ident" id="3705710">em</span>&nbsp;<span class="op" id="3705713">[</span><span class="op" id="3705714">]</span><span class="builtintype" id="3705715">byte</span><span class="op" id="3705719">,</span>&nbsp;<span class="ident" id="3705721">emBits</span><span class="op" id="3705727">,</span>&nbsp;<span class="ident" id="3705729">sLen</span>&nbsp;<span class="builtintype" id="3705734">int</span><span class="op" id="3705737">,</span>&nbsp;<span class="ident" id="3705739">hash</span>&nbsp;<span class="ident" id="3705744">hash</span><span class="op" id="3705748">.</span><span class="ident" id="3705749">Hash</span><span class="op" id="3705753">)</span>&nbsp;<span class="builtintype" id="3705755">error</span>&nbsp;<span class="op" id="3705761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705764">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705836">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705927">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705931">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705992">hLen</span>&nbsp;<span class="op" id="3705997">:=</span>&nbsp;<span class="ident" id="3706000">hash</span><span class="op" id="3706004">.</span><span class="ident" id="3706005">Size</span><span class="op" id="3706009">(</span><span class="op" id="3706010">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706013">if</span>&nbsp;<span class="ident" id="3706016">hLen</span>&nbsp;<span class="op" id="3706021">!=</span>&nbsp;<span class="builtinfunc" id="3706024">len</span><span class="op" id="3706027">(</span><span class="ident" id="3706028">mHash</span><span class="op" id="3706033">)</span>&nbsp;<span class="op" id="3706035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706039">return</span>&nbsp;<span class="ident" id="3706046">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706067">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706135">emLen</span>&nbsp;<span class="op" id="3706141">:=</span>&nbsp;<span class="op" id="3706144">(</span><span class="ident" id="3706145">emBits</span>&nbsp;<span class="op" id="3706152">+</span>&nbsp;<span class="num" id="3706154">7</span><span class="op" id="3706155">)</span>&nbsp;<span class="op" id="3706157">/</span>&nbsp;<span class="num" id="3706159">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706162">if</span>&nbsp;<span class="ident" id="3706165">emLen</span>&nbsp;<span class="op" id="3706171">&lt;</span>&nbsp;<span class="ident" id="3706173">hLen</span><span class="op" id="3706177">+</span><span class="ident" id="3706178">sLen</span><span class="op" id="3706182">+</span><span class="num" id="3706183">2</span>&nbsp;<span class="op" id="3706185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706189">return</span>&nbsp;<span class="ident" id="3706196">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706217">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706332">if</span>&nbsp;<span class="ident" id="3706335">em</span><span class="op" id="3706337">[</span><span class="builtinfunc" id="3706338">len</span><span class="op" id="3706341">(</span><span class="ident" id="3706342">em</span><span class="op" id="3706344">)</span><span class="op" id="3706345">-</span><span class="num" id="3706346">1</span><span class="op" id="3706347">]</span>&nbsp;<span class="op" id="3706349">!=</span>&nbsp;<span class="num" id="3706352">0xBC</span>&nbsp;<span class="op" id="3706357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706361">return</span>&nbsp;<span class="ident" id="3706368">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706385">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706389">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706461">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706500">db</span>&nbsp;<span class="op" id="3706503">:=</span>&nbsp;<span class="ident" id="3706506">em</span><span class="op" id="3706508">[</span><span class="op" id="3706509">:</span><span class="ident" id="3706510">emLen</span><span class="op" id="3706515">-</span><span class="ident" id="3706516">hLen</span><span class="op" id="3706520">-</span><span class="num" id="3706521">1</span><span class="op" id="3706522">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706525">h</span>&nbsp;<span class="op" id="3706527">:=</span>&nbsp;<span class="ident" id="3706530">em</span><span class="op" id="3706532">[</span><span class="ident" id="3706533">emLen</span><span class="op" id="3706538">-</span><span class="ident" id="3706539">hLen</span><span class="op" id="3706543">-</span><span class="num" id="3706544">1</span>&nbsp;<span class="op" id="3706546">:</span>&nbsp;<span class="builtinfunc" id="3706548">len</span><span class="op" id="3706551">(</span><span class="ident" id="3706552">em</span><span class="op" id="3706554">)</span><span class="op" id="3706555">-</span><span class="num" id="3706556">1</span><span class="op" id="3706557">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706561">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706634">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706704">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706718">if</span>&nbsp;<span class="ident" id="3706721">em</span><span class="op" id="3706723">[</span><span class="num" id="3706724">0</span><span class="op" id="3706725">]</span><span class="op" id="3706726">&amp;</span><span class="op" id="3706727">(</span><span class="num" id="3706728">0xFF</span><span class="op" id="3706732">&lt;&lt;</span><span class="builtintype" id="3706734">uint</span><span class="op" id="3706738">(</span><span class="num" id="3706739">8</span><span class="op" id="3706740">-</span><span class="op" id="3706741">(</span><span class="num" id="3706742">8</span><span class="op" id="3706743">*</span><span class="ident" id="3706744">emLen</span><span class="op" id="3706749">-</span><span class="ident" id="3706750">emBits</span><span class="op" id="3706756">)</span><span class="op" id="3706757">)</span><span class="op" id="3706758">)</span>&nbsp;<span class="op" id="3706760">!=</span>&nbsp;<span class="num" id="3706763">0</span>&nbsp;<span class="op" id="3706765">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706769">return</span>&nbsp;<span class="ident" id="3706776">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706797">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706844">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706848">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706887">mgf1XOR</span><span class="op" id="3706894">(</span><span class="ident" id="3706895">db</span><span class="op" id="3706897">,</span>&nbsp;<span class="ident" id="3706899">hash</span><span class="op" id="3706903">,</span>&nbsp;<span class="ident" id="3706905">h</span><span class="op" id="3706906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706910">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706987">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707004">db</span><span class="op" id="3707006">[</span><span class="num" id="3707007">0</span><span class="op" id="3707008">]</span>&nbsp;<span class="op" id="3707010">&amp;=</span>&nbsp;<span class="op" id="3707013">(</span><span class="num" id="3707014">0xFF</span>&nbsp;<span class="op" id="3707019">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3707022">uint</span><span class="op" id="3707026">(</span><span class="num" id="3707027">8</span><span class="op" id="3707028">*</span><span class="ident" id="3707029">emLen</span><span class="op" id="3707034">-</span><span class="ident" id="3707035">emBits</span><span class="op" id="3707041">)</span><span class="op" id="3707042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707046">if</span>&nbsp;<span class="ident" id="3707049">sLen</span>&nbsp;<span class="op" id="3707054">==</span>&nbsp;<span class="ident" id="3707057">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3707075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707078">FindSaltLength</span><span class="op" id="3707092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707096">for</span>&nbsp;<span class="ident" id="3707100">sLen</span>&nbsp;<span class="op" id="3707105">=</span>&nbsp;<span class="ident" id="3707107">emLen</span>&nbsp;<span class="op" id="3707113">-</span>&nbsp;<span class="op" id="3707115">(</span><span class="ident" id="3707116">hLen</span>&nbsp;<span class="op" id="3707121">+</span>&nbsp;<span class="num" id="3707123">2</span><span class="op" id="3707124">)</span><span class="op" id="3707125">;</span>&nbsp;<span class="ident" id="3707127">sLen</span>&nbsp;<span class="op" id="3707132">&gt;=</span>&nbsp;<span class="num" id="3707135">0</span><span class="op" id="3707136">;</span>&nbsp;<span class="ident" id="3707138">sLen</span><span class="op" id="3707142">--</span>&nbsp;<span class="op" id="3707145">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707150">switch</span>&nbsp;<span class="ident" id="3707157">db</span><span class="op" id="3707159">[</span><span class="ident" id="3707160">emLen</span><span class="op" id="3707165">-</span><span class="ident" id="3707166">hLen</span><span class="op" id="3707170">-</span><span class="ident" id="3707171">sLen</span><span class="op" id="3707175">-</span><span class="num" id="3707176">2</span><span class="op" id="3707177">]</span>&nbsp;<span class="op" id="3707179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707184">case</span>&nbsp;<span class="num" id="3707189">1</span><span class="op" id="3707190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707196">break</span>&nbsp;<span class="ident" id="3707202">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707220">case</span>&nbsp;<span class="num" id="3707225">0</span><span class="op" id="3707226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707232">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707244">default</span><span class="op" id="3707251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707257">return</span>&nbsp;<span class="ident" id="3707264">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707291">if</span>&nbsp;<span class="ident" id="3707294">sLen</span>&nbsp;<span class="op" id="3707299">&lt;</span>&nbsp;<span class="num" id="3707301">0</span>&nbsp;<span class="op" id="3707303">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707308">return</span>&nbsp;<span class="ident" id="3707315">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707336">}</span>&nbsp;<span class="keyword" id="3707338">else</span>&nbsp;<span class="op" id="3707343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707347">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707422">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707497">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707570">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707611">for</span>&nbsp;<span class="ident" id="3707615">_</span><span class="op" id="3707616">,</span>&nbsp;<span class="ident" id="3707618">e</span>&nbsp;<span class="op" id="3707620">:=</span>&nbsp;<span class="keyword" id="3707623">range</span>&nbsp;<span class="ident" id="3707629">db</span><span class="op" id="3707631">[</span><span class="op" id="3707632">:</span><span class="ident" id="3707633">emLen</span><span class="op" id="3707638">-</span><span class="ident" id="3707639">hLen</span><span class="op" id="3707643">-</span><span class="ident" id="3707644">sLen</span><span class="op" id="3707648">-</span><span class="num" id="3707649">2</span><span class="op" id="3707650">]</span>&nbsp;<span class="op" id="3707652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707657">if</span>&nbsp;<span class="ident" id="3707660">e</span>&nbsp;<span class="op" id="3707662">!=</span>&nbsp;<span class="num" id="3707665">0x00</span>&nbsp;<span class="op" id="3707670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707676">return</span>&nbsp;<span class="ident" id="3707683">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707710">if</span>&nbsp;<span class="ident" id="3707713">db</span><span class="op" id="3707715">[</span><span class="ident" id="3707716">emLen</span><span class="op" id="3707721">-</span><span class="ident" id="3707722">hLen</span><span class="op" id="3707726">-</span><span class="ident" id="3707727">sLen</span><span class="op" id="3707731">-</span><span class="num" id="3707732">2</span><span class="op" id="3707733">]</span>&nbsp;<span class="op" id="3707735">!=</span>&nbsp;<span class="num" id="3707738">0x01</span>&nbsp;<span class="op" id="3707743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707748">return</span>&nbsp;<span class="ident" id="3707755">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707773">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707780">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707829">salt</span>&nbsp;<span class="op" id="3707834">:=</span>&nbsp;<span class="ident" id="3707837">db</span><span class="op" id="3707839">[</span><span class="builtinfunc" id="3707840">len</span><span class="op" id="3707843">(</span><span class="ident" id="3707844">db</span><span class="op" id="3707846">)</span><span class="op" id="3707847">-</span><span class="ident" id="3707848">sLen</span><span class="op" id="3707852">:</span><span class="op" id="3707853">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707857">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707870">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707935">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708002">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708031">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708035">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708094">var</span>&nbsp;<span class="ident" id="3708098">prefix</span>&nbsp;<span class="op" id="3708105">[</span><span class="num" id="3708106">8</span><span class="op" id="3708107">]</span><span class="builtintype" id="3708108">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708114">hash</span><span class="op" id="3708118">.</span><span class="ident" id="3708119">Write</span><span class="op" id="3708124">(</span><span class="ident" id="3708125">prefix</span><span class="op" id="3708131">[</span><span class="op" id="3708132">:</span><span class="op" id="3708133">]</span><span class="op" id="3708134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708137">hash</span><span class="op" id="3708141">.</span><span class="ident" id="3708142">Write</span><span class="op" id="3708147">(</span><span class="ident" id="3708148">mHash</span><span class="op" id="3708153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708156">hash</span><span class="op" id="3708160">.</span><span class="ident" id="3708161">Write</span><span class="op" id="3708166">(</span><span class="ident" id="3708167">salt</span><span class="op" id="3708171">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708175">h0</span>&nbsp;<span class="op" id="3708178">:=</span>&nbsp;<span class="ident" id="3708181">hash</span><span class="op" id="3708185">.</span><span class="ident" id="3708186">Sum</span><span class="op" id="3708189">(</span><span class="ident" id="3708190">nil</span><span class="op" id="3708193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3708197">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708271">if</span>&nbsp;<span class="op" id="3708274">!</span><span class="ident" id="3708275">bytes</span><span class="op" id="3708280">.</span><span class="ident" id="3708281">Equal</span><span class="op" id="3708286">(</span><span class="ident" id="3708287">h0</span><span class="op" id="3708289">,</span>&nbsp;<span class="ident" id="3708291">h</span><span class="op" id="3708292">)</span>&nbsp;<span class="op" id="3708294">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708298">return</span>&nbsp;<span class="ident" id="3708305">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708325">return</span>&nbsp;<span class="ident" id="3708332">nil</span><br>
<span class="lineno"></span><span class="op" id="3708336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3708339">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="3708428">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3708506">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3708586">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="3708625">func</span>&nbsp;<span class="ident" id="3708630">signPSSWithSalt</span><span class="op" id="3708645">(</span><span class="ident" id="3708646">rand</span>&nbsp;<span class="ident" id="3708651">io</span><span class="op" id="3708653">.</span><span class="ident" id="3708654">Reader</span><span class="op" id="3708660">,</span>&nbsp;<span class="ident" id="3708662">priv</span>&nbsp;<span class="op" id="3708667">*</span><span class="ident" id="3708668">PrivateKey</span><span class="op" id="3708678">,</span>&nbsp;<span class="ident" id="3708680">hash</span>&nbsp;<span class="ident" id="3708685">crypto</span><span class="op" id="3708691">.</span><span class="ident" id="3708692">Hash</span><span class="op" id="3708696">,</span>&nbsp;<span class="ident" id="3708698">hashed</span><span class="op" id="3708704">,</span>&nbsp;<span class="ident" id="3708706">salt</span>&nbsp;<span class="op" id="3708711">[</span><span class="op" id="3708712">]</span><span class="builtintype" id="3708713">byte</span><span class="op" id="3708717">)</span>&nbsp;<span class="op" id="3708719">(</span><span class="ident" id="3708720">s</span>&nbsp;<span class="op" id="3708722">[</span><span class="op" id="3708723">]</span><span class="builtintype" id="3708724">byte</span><span class="op" id="3708728">,</span>&nbsp;<span class="ident" id="3708730">err</span>&nbsp;<span class="builtintype" id="3708734">error</span><span class="op" id="3708739">)</span>&nbsp;<span class="op" id="3708741">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708744">nBits</span>&nbsp;<span class="op" id="3708750">:=</span>&nbsp;<span class="ident" id="3708753">priv</span><span class="op" id="3708757">.</span><span class="ident" id="3708758">N</span><span class="op" id="3708759">.</span><span class="ident" id="3708760">BitLen</span><span class="op" id="3708766">(</span><span class="op" id="3708767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708770">em</span><span class="op" id="3708772">,</span>&nbsp;<span class="ident" id="3708774">err</span>&nbsp;<span class="op" id="3708778">:=</span>&nbsp;<span class="ident" id="3708781">emsaPSSEncode</span><span class="op" id="3708794">(</span><span class="ident" id="3708795">hashed</span><span class="op" id="3708801">,</span>&nbsp;<span class="ident" id="3708803">nBits</span><span class="op" id="3708808">-</span><span class="num" id="3708809">1</span><span class="op" id="3708810">,</span>&nbsp;<span class="ident" id="3708812">salt</span><span class="op" id="3708816">,</span>&nbsp;<span class="ident" id="3708818">hash</span><span class="op" id="3708822">.</span><span class="ident" id="3708823">New</span><span class="op" id="3708826">(</span><span class="op" id="3708827">)</span><span class="op" id="3708828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708831">if</span>&nbsp;<span class="ident" id="3708834">err</span>&nbsp;<span class="op" id="3708838">!=</span>&nbsp;<span class="ident" id="3708841">nil</span>&nbsp;<span class="op" id="3708845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708849">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708857">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708860">m</span>&nbsp;<span class="op" id="3708862">:=</span>&nbsp;<span class="builtinfunc" id="3708865">new</span><span class="op" id="3708868">(</span><span class="ident" id="3708869">big</span><span class="op" id="3708872">.</span><span class="ident" id="3708873">Int</span><span class="op" id="3708876">)</span><span class="op" id="3708877">.</span><span class="ident" id="3708878">SetBytes</span><span class="op" id="3708886">(</span><span class="ident" id="3708887">em</span><span class="op" id="3708889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708892">c</span><span class="op" id="3708893">,</span>&nbsp;<span class="ident" id="3708895">err</span>&nbsp;<span class="op" id="3708899">:=</span>&nbsp;<span class="ident" id="3708902">decrypt</span><span class="op" id="3708909">(</span><span class="ident" id="3708910">rand</span><span class="op" id="3708914">,</span>&nbsp;<span class="ident" id="3708916">priv</span><span class="op" id="3708920">,</span>&nbsp;<span class="ident" id="3708922">m</span><span class="op" id="3708923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708926">if</span>&nbsp;<span class="ident" id="3708929">err</span>&nbsp;<span class="op" id="3708933">!=</span>&nbsp;<span class="ident" id="3708936">nil</span>&nbsp;<span class="op" id="3708940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708944">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708952">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708955">s</span>&nbsp;<span class="op" id="3708957">=</span>&nbsp;<span class="builtinfunc" id="3708959">make</span><span class="op" id="3708963">(</span><span class="op" id="3708964">[</span><span class="op" id="3708965">]</span><span class="builtintype" id="3708966">byte</span><span class="op" id="3708970">,</span>&nbsp;<span class="op" id="3708972">(</span><span class="ident" id="3708973">nBits</span><span class="op" id="3708978">+</span><span class="num" id="3708979">7</span><span class="op" id="3708980">)</span><span class="op" id="3708981">/</span><span class="num" id="3708982">8</span><span class="op" id="3708983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708986">copyWithLeftPad</span><span class="op" id="3709001">(</span><span class="ident" id="3709002">s</span><span class="op" id="3709003">,</span>&nbsp;<span class="ident" id="3709005">c</span><span class="op" id="3709006">.</span><span class="ident" id="3709007">Bytes</span><span class="op" id="3709012">(</span><span class="op" id="3709013">)</span><span class="op" id="3709014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709017">return</span><br>
<span class="lineno"></span><span class="op" id="3709024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3709027">const</span>&nbsp;<span class="op" id="3709033">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709036">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709108">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709178">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3709196">=</span>&nbsp;<span class="num" id="3709198">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709201">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709272">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709311">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3709335">=</span>&nbsp;<span class="op" id="3709337">-</span><span class="num" id="3709338">1</span><br>
<span class="lineno"></span><span class="op" id="3709340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709343">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="3709417">type</span>&nbsp;<span class="ident" id="3709422">PSSOptions</span>&nbsp;<span class="keyword" id="3709433">struct</span>&nbsp;<span class="op" id="3709440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709443">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709506">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709579">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709608">SaltLength</span>&nbsp;<span class="builtintype" id="3709619">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709625">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709695">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3709764">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709793">Hash</span>&nbsp;<span class="ident" id="3709798">crypto</span><span class="op" id="3709804">.</span><span class="ident" id="3709805">Hash</span><br>
<span class="lineno">230</span><span class="op" id="3709810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709813">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3709876">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="3709898">func</span>&nbsp;<span class="op" id="3709903">(</span><span class="ident" id="3709904">pssOpts</span>&nbsp;<span class="op" id="3709912">*</span><span class="ident" id="3709913">PSSOptions</span><span class="op" id="3709923">)</span>&nbsp;<span class="ident" id="3709925">HashFunc</span><span class="op" id="3709933">(</span><span class="op" id="3709934">)</span>&nbsp;<span class="ident" id="3709936">crypto</span><span class="op" id="3709942">.</span><span class="ident" id="3709943">Hash</span>&nbsp;<span class="op" id="3709948">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709951">return</span>&nbsp;<span class="ident" id="3709958">pssOpts</span><span class="op" id="3709965">.</span><span class="ident" id="3709966">Hash</span><br>
<span class="lineno"></span><span class="op" id="3709971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3709974">func</span>&nbsp;<span class="op" id="3709979">(</span><span class="ident" id="3709980">opts</span>&nbsp;<span class="op" id="3709985">*</span><span class="ident" id="3709986">PSSOptions</span><span class="op" id="3709996">)</span>&nbsp;<span class="ident" id="3709998">saltLength</span><span class="op" id="3710008">(</span><span class="op" id="3710009">)</span>&nbsp;<span class="builtintype" id="3710011">int</span>&nbsp;<span class="op" id="3710015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710018">if</span>&nbsp;<span class="ident" id="3710021">opts</span>&nbsp;<span class="op" id="3710026">==</span>&nbsp;<span class="ident" id="3710029">nil</span>&nbsp;<span class="op" id="3710033">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710037">return</span>&nbsp;<span class="ident" id="3710044">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710066">return</span>&nbsp;<span class="ident" id="3710073">opts</span><span class="op" id="3710077">.</span><span class="ident" id="3710078">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="3710089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3710092">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3710160">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3710238">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3710315">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3710337">func</span>&nbsp;<span class="ident" id="3710342">SignPSS</span><span class="op" id="3710349">(</span><span class="ident" id="3710350">rand</span>&nbsp;<span class="ident" id="3710355">io</span><span class="op" id="3710357">.</span><span class="ident" id="3710358">Reader</span><span class="op" id="3710364">,</span>&nbsp;<span class="ident" id="3710366">priv</span>&nbsp;<span class="op" id="3710371">*</span><span class="ident" id="3710372">PrivateKey</span><span class="op" id="3710382">,</span>&nbsp;<span class="ident" id="3710384">hash</span>&nbsp;<span class="ident" id="3710389">crypto</span><span class="op" id="3710395">.</span><span class="ident" id="3710396">Hash</span><span class="op" id="3710400">,</span>&nbsp;<span class="ident" id="3710402">hashed</span>&nbsp;<span class="op" id="3710409">[</span><span class="op" id="3710410">]</span><span class="builtintype" id="3710411">byte</span><span class="op" id="3710415">,</span>&nbsp;<span class="ident" id="3710417">opts</span>&nbsp;<span class="op" id="3710422">*</span><span class="ident" id="3710423">PSSOptions</span><span class="op" id="3710433">)</span>&nbsp;<span class="op" id="3710435">(</span><span class="ident" id="3710436">s</span>&nbsp;<span class="op" id="3710438">[</span><span class="op" id="3710439">]</span><span class="builtintype" id="3710440">byte</span><span class="op" id="3710444">,</span>&nbsp;<span class="ident" id="3710446">err</span>&nbsp;<span class="builtintype" id="3710450">error</span><span class="op" id="3710455">)</span>&nbsp;<span class="op" id="3710457">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710460">saltLength</span>&nbsp;<span class="op" id="3710471">:=</span>&nbsp;<span class="ident" id="3710474">opts</span><span class="op" id="3710478">.</span><span class="ident" id="3710479">saltLength</span><span class="op" id="3710489">(</span><span class="op" id="3710490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710493">switch</span>&nbsp;<span class="ident" id="3710500">saltLength</span>&nbsp;<span class="op" id="3710511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710514">case</span>&nbsp;<span class="ident" id="3710519">PSSSaltLengthAuto</span><span class="op" id="3710536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710540">saltLength</span>&nbsp;<span class="op" id="3710551">=</span>&nbsp;<span class="op" id="3710553">(</span><span class="ident" id="3710554">priv</span><span class="op" id="3710558">.</span><span class="ident" id="3710559">N</span><span class="op" id="3710560">.</span><span class="ident" id="3710561">BitLen</span><span class="op" id="3710567">(</span><span class="op" id="3710568">)</span><span class="op" id="3710569">+</span><span class="num" id="3710570">7</span><span class="op" id="3710571">)</span><span class="op" id="3710572">/</span><span class="num" id="3710573">8</span>&nbsp;<span class="op" id="3710575">-</span>&nbsp;<span class="num" id="3710577">2</span>&nbsp;<span class="op" id="3710579">-</span>&nbsp;<span class="ident" id="3710581">hash</span><span class="op" id="3710585">.</span><span class="ident" id="3710586">Size</span><span class="op" id="3710590">(</span><span class="op" id="3710591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710594">case</span>&nbsp;<span class="ident" id="3710599">PSSSaltLengthEqualsHash</span><span class="op" id="3710622">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710626">saltLength</span>&nbsp;<span class="op" id="3710637">=</span>&nbsp;<span class="ident" id="3710639">hash</span><span class="op" id="3710643">.</span><span class="ident" id="3710644">Size</span><span class="op" id="3710648">(</span><span class="op" id="3710649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710656">if</span>&nbsp;<span class="ident" id="3710659">opts</span><span class="op" id="3710663">.</span><span class="ident" id="3710664">Hash</span>&nbsp;<span class="op" id="3710669">!=</span>&nbsp;<span class="num" id="3710672">0</span>&nbsp;<span class="op" id="3710674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710678">hash</span>&nbsp;<span class="op" id="3710683">=</span>&nbsp;<span class="ident" id="3710685">opts</span><span class="op" id="3710689">.</span><span class="ident" id="3710690">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3710700">salt</span>&nbsp;<span class="op" id="3710705">:=</span>&nbsp;<span class="builtinfunc" id="3710708">make</span><span class="op" id="3710712">(</span><span class="op" id="3710713">[</span><span class="op" id="3710714">]</span><span class="builtintype" id="3710715">byte</span><span class="op" id="3710719">,</span>&nbsp;<span class="ident" id="3710721">saltLength</span><span class="op" id="3710731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710734">if</span>&nbsp;<span class="ident" id="3710737">_</span><span class="op" id="3710738">,</span>&nbsp;<span class="ident" id="3710740">err</span>&nbsp;<span class="op" id="3710744">=</span>&nbsp;<span class="ident" id="3710746">io</span><span class="op" id="3710748">.</span><span class="ident" id="3710749">ReadFull</span><span class="op" id="3710757">(</span><span class="ident" id="3710758">rand</span><span class="op" id="3710762">,</span>&nbsp;<span class="ident" id="3710764">salt</span><span class="op" id="3710768">)</span><span class="op" id="3710769">;</span>&nbsp;<span class="ident" id="3710771">err</span>&nbsp;<span class="op" id="3710775">!=</span>&nbsp;<span class="ident" id="3710778">nil</span>&nbsp;<span class="op" id="3710782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710786">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3710794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3710797">return</span>&nbsp;<span class="ident" id="3710804">signPSSWithSalt</span><span class="op" id="3710819">(</span><span class="ident" id="3710820">rand</span><span class="op" id="3710824">,</span>&nbsp;<span class="ident" id="3710826">priv</span><span class="op" id="3710830">,</span>&nbsp;<span class="ident" id="3710832">hash</span><span class="op" id="3710836">,</span>&nbsp;<span class="ident" id="3710838">hashed</span><span class="op" id="3710844">,</span>&nbsp;<span class="ident" id="3710846">salt</span><span class="op" id="3710850">)</span><br>
<span class="lineno"></span><span class="op" id="3710852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3710855">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="3710894">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3710968">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3711040">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3711119">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3711141">func</span>&nbsp;<span class="ident" id="3711146">VerifyPSS</span><span class="op" id="3711155">(</span><span class="ident" id="3711156">pub</span>&nbsp;<span class="op" id="3711160">*</span><span class="ident" id="3711161">PublicKey</span><span class="op" id="3711170">,</span>&nbsp;<span class="ident" id="3711172">hash</span>&nbsp;<span class="ident" id="3711177">crypto</span><span class="op" id="3711183">.</span><span class="ident" id="3711184">Hash</span><span class="op" id="3711188">,</span>&nbsp;<span class="ident" id="3711190">hashed</span>&nbsp;<span class="op" id="3711197">[</span><span class="op" id="3711198">]</span><span class="builtintype" id="3711199">byte</span><span class="op" id="3711203">,</span>&nbsp;<span class="ident" id="3711205">sig</span>&nbsp;<span class="op" id="3711209">[</span><span class="op" id="3711210">]</span><span class="builtintype" id="3711211">byte</span><span class="op" id="3711215">,</span>&nbsp;<span class="ident" id="3711217">opts</span>&nbsp;<span class="op" id="3711222">*</span><span class="ident" id="3711223">PSSOptions</span><span class="op" id="3711233">)</span>&nbsp;<span class="builtintype" id="3711235">error</span>&nbsp;<span class="op" id="3711241">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711244">return</span>&nbsp;<span class="ident" id="3711251">verifyPSS</span><span class="op" id="3711260">(</span><span class="ident" id="3711261">pub</span><span class="op" id="3711264">,</span>&nbsp;<span class="ident" id="3711266">hash</span><span class="op" id="3711270">,</span>&nbsp;<span class="ident" id="3711272">hashed</span><span class="op" id="3711278">,</span>&nbsp;<span class="ident" id="3711280">sig</span><span class="op" id="3711283">,</span>&nbsp;<span class="ident" id="3711285">opts</span><span class="op" id="3711289">.</span><span class="ident" id="3711290">saltLength</span><span class="op" id="3711300">(</span><span class="op" id="3711301">)</span><span class="op" id="3711302">)</span><br>
<span class="lineno"></span><span class="op" id="3711304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3711307">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3711373">func</span>&nbsp;<span class="ident" id="3711378">verifyPSS</span><span class="op" id="3711387">(</span><span class="ident" id="3711388">pub</span>&nbsp;<span class="op" id="3711392">*</span><span class="ident" id="3711393">PublicKey</span><span class="op" id="3711402">,</span>&nbsp;<span class="ident" id="3711404">hash</span>&nbsp;<span class="ident" id="3711409">crypto</span><span class="op" id="3711415">.</span><span class="ident" id="3711416">Hash</span><span class="op" id="3711420">,</span>&nbsp;<span class="ident" id="3711422">hashed</span>&nbsp;<span class="op" id="3711429">[</span><span class="op" id="3711430">]</span><span class="builtintype" id="3711431">byte</span><span class="op" id="3711435">,</span>&nbsp;<span class="ident" id="3711437">sig</span>&nbsp;<span class="op" id="3711441">[</span><span class="op" id="3711442">]</span><span class="builtintype" id="3711443">byte</span><span class="op" id="3711447">,</span>&nbsp;<span class="ident" id="3711449">saltLen</span>&nbsp;<span class="builtintype" id="3711457">int</span><span class="op" id="3711460">)</span>&nbsp;<span class="builtintype" id="3711462">error</span>&nbsp;<span class="op" id="3711468">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711471">nBits</span>&nbsp;<span class="op" id="3711477">:=</span>&nbsp;<span class="ident" id="3711480">pub</span><span class="op" id="3711483">.</span><span class="ident" id="3711484">N</span><span class="op" id="3711485">.</span><span class="ident" id="3711486">BitLen</span><span class="op" id="3711492">(</span><span class="op" id="3711493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711496">if</span>&nbsp;<span class="builtinfunc" id="3711499">len</span><span class="op" id="3711502">(</span><span class="ident" id="3711503">sig</span><span class="op" id="3711506">)</span>&nbsp;<span class="op" id="3711508">!=</span>&nbsp;<span class="op" id="3711511">(</span><span class="ident" id="3711512">nBits</span><span class="op" id="3711517">+</span><span class="num" id="3711518">7</span><span class="op" id="3711519">)</span><span class="op" id="3711520">/</span><span class="num" id="3711521">8</span>&nbsp;<span class="op" id="3711523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711527">return</span>&nbsp;<span class="ident" id="3711534">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711554">s</span>&nbsp;<span class="op" id="3711556">:=</span>&nbsp;<span class="builtinfunc" id="3711559">new</span><span class="op" id="3711562">(</span><span class="ident" id="3711563">big</span><span class="op" id="3711566">.</span><span class="ident" id="3711567">Int</span><span class="op" id="3711570">)</span><span class="op" id="3711571">.</span><span class="ident" id="3711572">SetBytes</span><span class="op" id="3711580">(</span><span class="ident" id="3711581">sig</span><span class="op" id="3711584">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711587">m</span>&nbsp;<span class="op" id="3711589">:=</span>&nbsp;<span class="ident" id="3711592">encrypt</span><span class="op" id="3711599">(</span><span class="builtinfunc" id="3711600">new</span><span class="op" id="3711603">(</span><span class="ident" id="3711604">big</span><span class="op" id="3711607">.</span><span class="ident" id="3711608">Int</span><span class="op" id="3711611">)</span><span class="op" id="3711612">,</span>&nbsp;<span class="ident" id="3711614">pub</span><span class="op" id="3711617">,</span>&nbsp;<span class="ident" id="3711619">s</span><span class="op" id="3711620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711623">emBits</span>&nbsp;<span class="op" id="3711630">:=</span>&nbsp;<span class="ident" id="3711633">nBits</span>&nbsp;<span class="op" id="3711639">-</span>&nbsp;<span class="num" id="3711641">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711644">emLen</span>&nbsp;<span class="op" id="3711650">:=</span>&nbsp;<span class="op" id="3711653">(</span><span class="ident" id="3711654">emBits</span>&nbsp;<span class="op" id="3711661">+</span>&nbsp;<span class="num" id="3711663">7</span><span class="op" id="3711664">)</span>&nbsp;<span class="op" id="3711666">/</span>&nbsp;<span class="num" id="3711668">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711671">if</span>&nbsp;<span class="ident" id="3711674">emLen</span>&nbsp;<span class="op" id="3711680">&lt;</span>&nbsp;<span class="builtinfunc" id="3711682">len</span><span class="op" id="3711685">(</span><span class="ident" id="3711686">m</span><span class="op" id="3711687">.</span><span class="ident" id="3711688">Bytes</span><span class="op" id="3711693">(</span><span class="op" id="3711694">)</span><span class="op" id="3711695">)</span>&nbsp;<span class="op" id="3711697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711701">return</span>&nbsp;<span class="ident" id="3711708">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711728">em</span>&nbsp;<span class="op" id="3711731">:=</span>&nbsp;<span class="builtinfunc" id="3711734">make</span><span class="op" id="3711738">(</span><span class="op" id="3711739">[</span><span class="op" id="3711740">]</span><span class="builtintype" id="3711741">byte</span><span class="op" id="3711745">,</span>&nbsp;<span class="ident" id="3711747">emLen</span><span class="op" id="3711752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711755">copyWithLeftPad</span><span class="op" id="3711770">(</span><span class="ident" id="3711771">em</span><span class="op" id="3711773">,</span>&nbsp;<span class="ident" id="3711775">m</span><span class="op" id="3711776">.</span><span class="ident" id="3711777">Bytes</span><span class="op" id="3711782">(</span><span class="op" id="3711783">)</span><span class="op" id="3711784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711787">if</span>&nbsp;<span class="ident" id="3711790">saltLen</span>&nbsp;<span class="op" id="3711798">==</span>&nbsp;<span class="ident" id="3711801">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3711825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3711829">saltLen</span>&nbsp;<span class="op" id="3711837">=</span>&nbsp;<span class="ident" id="3711839">hash</span><span class="op" id="3711843">.</span><span class="ident" id="3711844">Size</span><span class="op" id="3711848">(</span><span class="op" id="3711849">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3711852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3711855">return</span>&nbsp;<span class="ident" id="3711862">emsaPSSVerify</span><span class="op" id="3711875">(</span><span class="ident" id="3711876">hashed</span><span class="op" id="3711882">,</span>&nbsp;<span class="ident" id="3711884">em</span><span class="op" id="3711886">,</span>&nbsp;<span class="ident" id="3711888">emBits</span><span class="op" id="3711894">,</span>&nbsp;<span class="ident" id="3711896">saltLen</span><span class="op" id="3711903">,</span>&nbsp;<span class="ident" id="3711905">hash</span><span class="op" id="3711909">.</span><span class="ident" id="3711910">New</span><span class="op" id="3711913">(</span><span class="op" id="3711914">)</span><span class="op" id="3711915">)</span><br>
<span class="lineno"></span><span class="op" id="3711917">}</span>
</div>
</body>
</html>
