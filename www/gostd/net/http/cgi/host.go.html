<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4828682">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4828737">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4828791">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4828842">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="4828908">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4828929">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4828999">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="4829015">//</span><br>
<span class="lineno"></span><span class="comment" id="4829018">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="4829085">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4829144">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4829208">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="4829248">package</span>&nbsp;<span class="ident" id="4829256">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4829261">import</span>&nbsp;<span class="op" id="4829268">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829271">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829280">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829287">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829293">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829300">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829312">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829318">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829329">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829346">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829356">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829367">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829378">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="4829388">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4829391">var</span>&nbsp;<span class="ident" id="4829395">trailingPort</span>&nbsp;<span class="op" id="4829408">=</span>&nbsp;<span class="ident" id="4829410">regexp</span><span class="op" id="4829416">.</span><span class="ident" id="4829417">MustCompile</span><span class="op" id="4829428">(</span><span class="string" id="4829429">`:([0-9]+)$`</span><span class="op" id="4829441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4829444">var</span>&nbsp;<span class="ident" id="4829448">osDefaultInheritEnv</span>&nbsp;<span class="op" id="4829468">=</span>&nbsp;<span class="keyword" id="4829470">map</span><span class="op" id="4829473">[</span><span class="builtintype" id="4829474">string</span><span class="op" id="4829480">]</span><span class="op" id="4829481">[</span><span class="op" id="4829482">]</span><span class="builtintype" id="4829483">string</span><span class="op" id="4829489">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829492">&#34;darwin&#34;</span><span class="op" id="4829500">:</span>&nbsp;&nbsp;<span class="op" id="4829503">{</span><span class="string" id="4829504">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="4829523">}</span><span class="op" id="4829524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829527">&#34;freebsd&#34;</span><span class="op" id="4829536">:</span>&nbsp;<span class="op" id="4829538">{</span><span class="string" id="4829539">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829556">}</span><span class="op" id="4829557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829560">&#34;hpux&#34;</span><span class="op" id="4829566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829571">{</span><span class="string" id="4829572">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829589">,</span>&nbsp;<span class="string" id="4829591">&#34;SHLIB_PATH&#34;</span><span class="op" id="4829603">}</span><span class="op" id="4829604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829607">&#34;irix&#34;</span><span class="op" id="4829613">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4829618">{</span><span class="string" id="4829619">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829636">,</span>&nbsp;<span class="string" id="4829638">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="4829658">,</span>&nbsp;<span class="string" id="4829660">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="4829679">}</span><span class="op" id="4829680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829683">&#34;linux&#34;</span><span class="op" id="4829690">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4829694">{</span><span class="string" id="4829695">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829712">}</span><span class="op" id="4829713">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829716">&#34;openbsd&#34;</span><span class="op" id="4829725">:</span>&nbsp;<span class="op" id="4829727">{</span><span class="string" id="4829728">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829745">}</span><span class="op" id="4829746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829749">&#34;solaris&#34;</span><span class="op" id="4829758">:</span>&nbsp;<span class="op" id="4829760">{</span><span class="string" id="4829761">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="4829778">,</span>&nbsp;<span class="string" id="4829780">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="4829800">,</span>&nbsp;<span class="string" id="4829802">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="4829822">}</span><span class="op" id="4829823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4829826">&#34;windows&#34;</span><span class="op" id="4829835">:</span>&nbsp;<span class="op" id="4829837">{</span><span class="string" id="4829838">&#34;SystemRoot&#34;</span><span class="op" id="4829850">,</span>&nbsp;<span class="string" id="4829852">&#34;COMSPEC&#34;</span><span class="op" id="4829861">,</span>&nbsp;<span class="string" id="4829863">&#34;PATHEXT&#34;</span><span class="op" id="4829872">,</span>&nbsp;<span class="string" id="4829874">&#34;WINDIR&#34;</span><span class="op" id="4829882">}</span><span class="op" id="4829883">,</span><br>
<span class="lineno"></span><span class="op" id="4829885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4829888">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="4829958">type</span>&nbsp;<span class="ident" id="4829963">Handler</span>&nbsp;<span class="keyword" id="4829971">struct</span>&nbsp;<span class="op" id="4829978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829981">Path</span>&nbsp;<span class="builtintype" id="4829986">string</span>&nbsp;<span class="comment" id="4829993">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830024">Root</span>&nbsp;<span class="builtintype" id="4830029">string</span>&nbsp;<span class="comment" id="4830036">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830085">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830143">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830200">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830255">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830278">Dir</span>&nbsp;<span class="builtintype" id="4830282">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830291">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830302">[</span><span class="op" id="4830303">]</span><span class="builtintype" id="4830304">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830314">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830377">InheritEnv</span>&nbsp;<span class="op" id="4830388">[</span><span class="op" id="4830389">]</span><span class="builtintype" id="4830390">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830400">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830457">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830468">*</span><span class="ident" id="4830469">log</span><span class="op" id="4830472">.</span><span class="ident" id="4830473">Logger</span>&nbsp;<span class="comment" id="4830480">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830532">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4830543">[</span><span class="op" id="4830544">]</span><span class="builtintype" id="4830545">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4830555">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830604">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830665">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830723">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830783">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830839">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830869">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830934">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830988">PathLocationHandler</span>&nbsp;<span class="ident" id="4831008">http</span><span class="op" id="4831012">.</span><span class="ident" id="4831013">Handler</span><br>
<span class="lineno">70</span><span class="op" id="4831021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831024">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="4831093">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="4831150">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="4831169">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="4831181">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4831231">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="4831239">func</span>&nbsp;<span class="ident" id="4831244">removeLeadingDuplicates</span><span class="op" id="4831267">(</span><span class="ident" id="4831268">env</span>&nbsp;<span class="op" id="4831272">[</span><span class="op" id="4831273">]</span><span class="builtintype" id="4831274">string</span><span class="op" id="4831280">)</span>&nbsp;<span class="op" id="4831282">(</span><span class="ident" id="4831283">ret</span>&nbsp;<span class="op" id="4831287">[</span><span class="op" id="4831288">]</span><span class="builtintype" id="4831289">string</span><span class="op" id="4831295">)</span>&nbsp;<span class="op" id="4831297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831300">n</span>&nbsp;<span class="op" id="4831302">:=</span>&nbsp;<span class="builtinfunc" id="4831305">len</span><span class="op" id="4831308">(</span><span class="ident" id="4831309">env</span><span class="op" id="4831312">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831315">for</span>&nbsp;<span class="ident" id="4831319">i</span>&nbsp;<span class="op" id="4831321">:=</span>&nbsp;<span class="num" id="4831324">0</span><span class="op" id="4831325">;</span>&nbsp;<span class="ident" id="4831327">i</span>&nbsp;<span class="op" id="4831329">&lt;</span>&nbsp;<span class="ident" id="4831331">n</span><span class="op" id="4831332">;</span>&nbsp;<span class="ident" id="4831334">i</span><span class="op" id="4831335">++</span>&nbsp;<span class="op" id="4831338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831342">e</span>&nbsp;<span class="op" id="4831344">:=</span>&nbsp;<span class="ident" id="4831347">env</span><span class="op" id="4831350">[</span><span class="ident" id="4831351">i</span><span class="op" id="4831352">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831356">s</span>&nbsp;<span class="op" id="4831358">:=</span>&nbsp;<span class="ident" id="4831361">strings</span><span class="op" id="4831368">.</span><span class="ident" id="4831369">SplitN</span><span class="op" id="4831375">(</span><span class="ident" id="4831376">e</span><span class="op" id="4831377">,</span>&nbsp;<span class="string" id="4831379">&#34;=&#34;</span><span class="op" id="4831382">,</span>&nbsp;<span class="num" id="4831384">2</span><span class="op" id="4831385">)</span><span class="op" id="4831386">[</span><span class="num" id="4831387">0</span><span class="op" id="4831388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831392">found</span>&nbsp;<span class="op" id="4831398">:=</span>&nbsp;<span class="builtintype" id="4831401">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831409">for</span>&nbsp;<span class="ident" id="4831413">j</span>&nbsp;<span class="op" id="4831415">:=</span>&nbsp;<span class="ident" id="4831418">i</span>&nbsp;<span class="op" id="4831420">+</span>&nbsp;<span class="num" id="4831422">1</span><span class="op" id="4831423">;</span>&nbsp;<span class="ident" id="4831425">j</span>&nbsp;<span class="op" id="4831427">&lt;</span>&nbsp;<span class="ident" id="4831429">n</span><span class="op" id="4831430">;</span>&nbsp;<span class="ident" id="4831432">j</span><span class="op" id="4831433">++</span>&nbsp;<span class="op" id="4831436">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831441">if</span>&nbsp;<span class="ident" id="4831444">s</span>&nbsp;<span class="op" id="4831446">==</span>&nbsp;<span class="ident" id="4831449">strings</span><span class="op" id="4831456">.</span><span class="ident" id="4831457">SplitN</span><span class="op" id="4831463">(</span><span class="ident" id="4831464">env</span><span class="op" id="4831467">[</span><span class="ident" id="4831468">j</span><span class="op" id="4831469">]</span><span class="op" id="4831470">,</span>&nbsp;<span class="string" id="4831472">&#34;=&#34;</span><span class="op" id="4831475">,</span>&nbsp;<span class="num" id="4831477">2</span><span class="op" id="4831478">)</span><span class="op" id="4831479">[</span><span class="num" id="4831480">0</span><span class="op" id="4831481">]</span>&nbsp;<span class="op" id="4831483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831489">found</span>&nbsp;<span class="op" id="4831495">=</span>&nbsp;<span class="builtintype" id="4831497">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831506">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831519">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831523">if</span>&nbsp;<span class="op" id="4831526">!</span><span class="ident" id="4831527">found</span>&nbsp;<span class="op" id="4831533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831538">ret</span>&nbsp;<span class="op" id="4831542">=</span>&nbsp;<span class="builtinfunc" id="4831544">append</span><span class="op" id="4831550">(</span><span class="ident" id="4831551">ret</span><span class="op" id="4831554">,</span>&nbsp;<span class="ident" id="4831556">e</span><span class="op" id="4831557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831567">return</span><br>
<span class="lineno">95</span><span class="op" id="4831574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4831577">func</span>&nbsp;<span class="op" id="4831582">(</span><span class="ident" id="4831583">h</span>&nbsp;<span class="op" id="4831585">*</span><span class="ident" id="4831586">Handler</span><span class="op" id="4831593">)</span>&nbsp;<span class="ident" id="4831595">ServeHTTP</span><span class="op" id="4831604">(</span><span class="ident" id="4831605">rw</span>&nbsp;<span class="ident" id="4831608">http</span><span class="op" id="4831612">.</span><span class="ident" id="4831613">ResponseWriter</span><span class="op" id="4831627">,</span>&nbsp;<span class="ident" id="4831629">req</span>&nbsp;<span class="op" id="4831633">*</span><span class="ident" id="4831634">http</span><span class="op" id="4831638">.</span><span class="ident" id="4831639">Request</span><span class="op" id="4831646">)</span>&nbsp;<span class="op" id="4831648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831651">root</span>&nbsp;<span class="op" id="4831656">:=</span>&nbsp;<span class="ident" id="4831659">h</span><span class="op" id="4831660">.</span><span class="ident" id="4831661">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831667">if</span>&nbsp;<span class="ident" id="4831670">root</span>&nbsp;<span class="op" id="4831675">==</span>&nbsp;<span class="string" id="4831678">&#34;&#34;</span>&nbsp;<span class="op" id="4831681">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831685">root</span>&nbsp;<span class="op" id="4831690">=</span>&nbsp;<span class="string" id="4831692">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831701">if</span>&nbsp;<span class="builtinfunc" id="4831704">len</span><span class="op" id="4831707">(</span><span class="ident" id="4831708">req</span><span class="op" id="4831711">.</span><span class="ident" id="4831712">TransferEncoding</span><span class="op" id="4831728">)</span>&nbsp;<span class="op" id="4831730">&gt;</span>&nbsp;<span class="num" id="4831732">0</span>&nbsp;<span class="op" id="4831734">&amp;&amp;</span>&nbsp;<span class="ident" id="4831737">req</span><span class="op" id="4831740">.</span><span class="ident" id="4831741">TransferEncoding</span><span class="op" id="4831757">[</span><span class="num" id="4831758">0</span><span class="op" id="4831759">]</span>&nbsp;<span class="op" id="4831761">==</span>&nbsp;<span class="string" id="4831764">&#34;chunked&#34;</span>&nbsp;<span class="op" id="4831774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831778">rw</span><span class="op" id="4831780">.</span><span class="ident" id="4831781">WriteHeader</span><span class="op" id="4831792">(</span><span class="ident" id="4831793">http</span><span class="op" id="4831797">.</span><span class="ident" id="4831798">StatusBadRequest</span><span class="op" id="4831814">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831818">rw</span><span class="op" id="4831820">.</span><span class="ident" id="4831821">Write</span><span class="op" id="4831826">(</span><span class="op" id="4831827">[</span><span class="op" id="4831828">]</span><span class="builtintype" id="4831829">byte</span><span class="op" id="4831833">(</span><span class="string" id="4831834">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="4831884">)</span><span class="op" id="4831885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831889">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831901">pathInfo</span>&nbsp;<span class="op" id="4831910">:=</span>&nbsp;<span class="ident" id="4831913">req</span><span class="op" id="4831916">.</span><span class="ident" id="4831917">URL</span><span class="op" id="4831920">.</span><span class="ident" id="4831921">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831927">if</span>&nbsp;<span class="ident" id="4831930">root</span>&nbsp;<span class="op" id="4831935">!=</span>&nbsp;<span class="string" id="4831938">&#34;/&#34;</span>&nbsp;<span class="op" id="4831942">&amp;&amp;</span>&nbsp;<span class="ident" id="4831945">strings</span><span class="op" id="4831952">.</span><span class="ident" id="4831953">HasPrefix</span><span class="op" id="4831962">(</span><span class="ident" id="4831963">pathInfo</span><span class="op" id="4831971">,</span>&nbsp;<span class="ident" id="4831973">root</span><span class="op" id="4831977">)</span>&nbsp;<span class="op" id="4831979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831983">pathInfo</span>&nbsp;<span class="op" id="4831992">=</span>&nbsp;<span class="ident" id="4831994">pathInfo</span><span class="op" id="4832002">[</span><span class="builtinfunc" id="4832003">len</span><span class="op" id="4832006">(</span><span class="ident" id="4832007">root</span><span class="op" id="4832011">)</span><span class="op" id="4832012">:</span><span class="op" id="4832013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832020">port</span>&nbsp;<span class="op" id="4832025">:=</span>&nbsp;<span class="string" id="4832028">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832034">if</span>&nbsp;<span class="ident" id="4832037">matches</span>&nbsp;<span class="op" id="4832045">:=</span>&nbsp;<span class="ident" id="4832048">trailingPort</span><span class="op" id="4832060">.</span><span class="ident" id="4832061">FindStringSubmatch</span><span class="op" id="4832079">(</span><span class="ident" id="4832080">req</span><span class="op" id="4832083">.</span><span class="ident" id="4832084">Host</span><span class="op" id="4832088">)</span><span class="op" id="4832089">;</span>&nbsp;<span class="builtinfunc" id="4832091">len</span><span class="op" id="4832094">(</span><span class="ident" id="4832095">matches</span><span class="op" id="4832102">)</span>&nbsp;<span class="op" id="4832104">!=</span>&nbsp;<span class="num" id="4832107">0</span>&nbsp;<span class="op" id="4832109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832113">port</span>&nbsp;<span class="op" id="4832118">=</span>&nbsp;<span class="ident" id="4832120">matches</span><span class="op" id="4832127">[</span><span class="num" id="4832128">1</span><span class="op" id="4832129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832136">env</span>&nbsp;<span class="op" id="4832140">:=</span>&nbsp;<span class="op" id="4832143">[</span><span class="op" id="4832144">]</span><span class="builtintype" id="4832145">string</span><span class="op" id="4832151">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832155">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="4832175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832179">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="4832194">+</span>&nbsp;<span class="ident" id="4832196">req</span><span class="op" id="4832199">.</span><span class="ident" id="4832200">Host</span><span class="op" id="4832204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832208">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="4832234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832238">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="4832251">+</span>&nbsp;<span class="ident" id="4832253">req</span><span class="op" id="4832256">.</span><span class="ident" id="4832257">Host</span><span class="op" id="4832261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832265">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="4832292">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832296">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="4832314">+</span>&nbsp;<span class="ident" id="4832316">req</span><span class="op" id="4832319">.</span><span class="ident" id="4832320">Method</span><span class="op" id="4832326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832330">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="4832346">+</span>&nbsp;<span class="ident" id="4832348">req</span><span class="op" id="4832351">.</span><span class="ident" id="4832352">URL</span><span class="op" id="4832355">.</span><span class="ident" id="4832356">RawQuery</span><span class="op" id="4832364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832368">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="4832383">+</span>&nbsp;<span class="ident" id="4832385">req</span><span class="op" id="4832388">.</span><span class="ident" id="4832389">URL</span><span class="op" id="4832392">.</span><span class="ident" id="4832393">RequestURI</span><span class="op" id="4832403">(</span><span class="op" id="4832404">)</span><span class="op" id="4832405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832409">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="4832422">+</span>&nbsp;<span class="ident" id="4832424">pathInfo</span><span class="op" id="4832432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832436">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="4832451">+</span>&nbsp;<span class="ident" id="4832453">root</span><span class="op" id="4832457">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832461">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="4832480">+</span>&nbsp;<span class="ident" id="4832482">h</span><span class="op" id="4832483">.</span><span class="ident" id="4832484">Path</span><span class="op" id="4832488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832492">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="4832507">+</span>&nbsp;<span class="ident" id="4832509">req</span><span class="op" id="4832512">.</span><span class="ident" id="4832513">RemoteAddr</span><span class="op" id="4832523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832527">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="4832542">+</span>&nbsp;<span class="ident" id="4832544">req</span><span class="op" id="4832547">.</span><span class="ident" id="4832548">RemoteAddr</span><span class="op" id="4832558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832562">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="4832577">+</span>&nbsp;<span class="ident" id="4832579">port</span><span class="op" id="4832583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832586">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832590">if</span>&nbsp;<span class="ident" id="4832593">req</span><span class="op" id="4832596">.</span><span class="ident" id="4832597">TLS</span>&nbsp;<span class="op" id="4832601">!=</span>&nbsp;<span class="ident" id="4832604">nil</span>&nbsp;<span class="op" id="4832608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832612">env</span>&nbsp;<span class="op" id="4832616">=</span>&nbsp;<span class="builtinfunc" id="4832618">append</span><span class="op" id="4832624">(</span><span class="ident" id="4832625">env</span><span class="op" id="4832628">,</span>&nbsp;<span class="string" id="4832630">&#34;HTTPS=on&#34;</span><span class="op" id="4832640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832647">for</span>&nbsp;<span class="ident" id="4832651">k</span><span class="op" id="4832652">,</span>&nbsp;<span class="ident" id="4832654">v</span>&nbsp;<span class="op" id="4832656">:=</span>&nbsp;<span class="keyword" id="4832659">range</span>&nbsp;<span class="ident" id="4832665">req</span><span class="op" id="4832668">.</span><span class="ident" id="4832669">Header</span>&nbsp;<span class="op" id="4832676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832680">k</span>&nbsp;<span class="op" id="4832682">=</span>&nbsp;<span class="ident" id="4832684">strings</span><span class="op" id="4832691">.</span><span class="ident" id="4832692">Map</span><span class="op" id="4832695">(</span><span class="ident" id="4832696">upperCaseAndUnderscore</span><span class="op" id="4832718">,</span>&nbsp;<span class="ident" id="4832720">k</span><span class="op" id="4832721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832725">joinStr</span>&nbsp;<span class="op" id="4832733">:=</span>&nbsp;<span class="string" id="4832736">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832743">if</span>&nbsp;<span class="ident" id="4832746">k</span>&nbsp;<span class="op" id="4832748">==</span>&nbsp;<span class="string" id="4832751">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="4832760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832765">joinStr</span>&nbsp;<span class="op" id="4832773">=</span>&nbsp;<span class="string" id="4832775">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832786">env</span>&nbsp;<span class="op" id="4832790">=</span>&nbsp;<span class="builtinfunc" id="4832792">append</span><span class="op" id="4832798">(</span><span class="ident" id="4832799">env</span><span class="op" id="4832802">,</span>&nbsp;<span class="string" id="4832804">&#34;HTTP_&#34;</span><span class="op" id="4832811">+</span><span class="ident" id="4832812">k</span><span class="op" id="4832813">+</span><span class="string" id="4832814">&#34;=&#34;</span><span class="op" id="4832817">+</span><span class="ident" id="4832818">strings</span><span class="op" id="4832825">.</span><span class="ident" id="4832826">Join</span><span class="op" id="4832830">(</span><span class="ident" id="4832831">v</span><span class="op" id="4832832">,</span>&nbsp;<span class="ident" id="4832834">joinStr</span><span class="op" id="4832841">)</span><span class="op" id="4832842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832849">if</span>&nbsp;<span class="ident" id="4832852">req</span><span class="op" id="4832855">.</span><span class="ident" id="4832856">ContentLength</span>&nbsp;<span class="op" id="4832870">&gt;</span>&nbsp;<span class="num" id="4832872">0</span>&nbsp;<span class="op" id="4832874">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832878">env</span>&nbsp;<span class="op" id="4832882">=</span>&nbsp;<span class="builtinfunc" id="4832884">append</span><span class="op" id="4832890">(</span><span class="ident" id="4832891">env</span><span class="op" id="4832894">,</span>&nbsp;<span class="ident" id="4832896">fmt</span><span class="op" id="4832899">.</span><span class="ident" id="4832900">Sprintf</span><span class="op" id="4832907">(</span><span class="string" id="4832908">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="4832927">,</span>&nbsp;<span class="ident" id="4832929">req</span><span class="op" id="4832932">.</span><span class="ident" id="4832933">ContentLength</span><span class="op" id="4832946">)</span><span class="op" id="4832947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832953">if</span>&nbsp;<span class="ident" id="4832956">ctype</span>&nbsp;<span class="op" id="4832962">:=</span>&nbsp;<span class="ident" id="4832965">req</span><span class="op" id="4832968">.</span><span class="ident" id="4832969">Header</span><span class="op" id="4832975">.</span><span class="ident" id="4832976">Get</span><span class="op" id="4832979">(</span><span class="string" id="4832980">&#34;Content-Type&#34;</span><span class="op" id="4832994">)</span><span class="op" id="4832995">;</span>&nbsp;<span class="ident" id="4832997">ctype</span>&nbsp;<span class="op" id="4833003">!=</span>&nbsp;<span class="string" id="4833006">&#34;&#34;</span>&nbsp;<span class="op" id="4833009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833013">env</span>&nbsp;<span class="op" id="4833017">=</span>&nbsp;<span class="builtinfunc" id="4833019">append</span><span class="op" id="4833025">(</span><span class="ident" id="4833026">env</span><span class="op" id="4833029">,</span>&nbsp;<span class="string" id="4833031">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="4833046">+</span><span class="ident" id="4833047">ctype</span><span class="op" id="4833052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833055">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833059">if</span>&nbsp;<span class="ident" id="4833062">h</span><span class="op" id="4833063">.</span><span class="ident" id="4833064">Env</span>&nbsp;<span class="op" id="4833068">!=</span>&nbsp;<span class="ident" id="4833071">nil</span>&nbsp;<span class="op" id="4833075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833079">env</span>&nbsp;<span class="op" id="4833083">=</span>&nbsp;<span class="builtinfunc" id="4833085">append</span><span class="op" id="4833091">(</span><span class="ident" id="4833092">env</span><span class="op" id="4833095">,</span>&nbsp;<span class="ident" id="4833097">h</span><span class="op" id="4833098">.</span><span class="ident" id="4833099">Env</span><span class="op" id="4833102">...</span><span class="op" id="4833105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833112">envPath</span>&nbsp;<span class="op" id="4833120">:=</span>&nbsp;<span class="ident" id="4833123">os</span><span class="op" id="4833125">.</span><span class="ident" id="4833126">Getenv</span><span class="op" id="4833132">(</span><span class="string" id="4833133">&#34;PATH&#34;</span><span class="op" id="4833139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833142">if</span>&nbsp;<span class="ident" id="4833145">envPath</span>&nbsp;<span class="op" id="4833153">==</span>&nbsp;<span class="string" id="4833156">&#34;&#34;</span>&nbsp;<span class="op" id="4833159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833163">envPath</span>&nbsp;<span class="op" id="4833171">=</span>&nbsp;<span class="string" id="4833173">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833226">env</span>&nbsp;<span class="op" id="4833230">=</span>&nbsp;<span class="builtinfunc" id="4833232">append</span><span class="op" id="4833238">(</span><span class="ident" id="4833239">env</span><span class="op" id="4833242">,</span>&nbsp;<span class="string" id="4833244">&#34;PATH=&#34;</span><span class="op" id="4833251">+</span><span class="ident" id="4833252">envPath</span><span class="op" id="4833259">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833263">for</span>&nbsp;<span class="ident" id="4833267">_</span><span class="op" id="4833268">,</span>&nbsp;<span class="ident" id="4833270">e</span>&nbsp;<span class="op" id="4833272">:=</span>&nbsp;<span class="keyword" id="4833275">range</span>&nbsp;<span class="ident" id="4833281">h</span><span class="op" id="4833282">.</span><span class="ident" id="4833283">InheritEnv</span>&nbsp;<span class="op" id="4833294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833298">if</span>&nbsp;<span class="ident" id="4833301">v</span>&nbsp;<span class="op" id="4833303">:=</span>&nbsp;<span class="ident" id="4833306">os</span><span class="op" id="4833308">.</span><span class="ident" id="4833309">Getenv</span><span class="op" id="4833315">(</span><span class="ident" id="4833316">e</span><span class="op" id="4833317">)</span><span class="op" id="4833318">;</span>&nbsp;<span class="ident" id="4833320">v</span>&nbsp;<span class="op" id="4833322">!=</span>&nbsp;<span class="string" id="4833325">&#34;&#34;</span>&nbsp;<span class="op" id="4833328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833333">env</span>&nbsp;<span class="op" id="4833337">=</span>&nbsp;<span class="builtinfunc" id="4833339">append</span><span class="op" id="4833345">(</span><span class="ident" id="4833346">env</span><span class="op" id="4833349">,</span>&nbsp;<span class="ident" id="4833351">e</span><span class="op" id="4833352">+</span><span class="string" id="4833353">&#34;=&#34;</span><span class="op" id="4833356">+</span><span class="ident" id="4833357">v</span><span class="op" id="4833358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833362">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833369">for</span>&nbsp;<span class="ident" id="4833373">_</span><span class="op" id="4833374">,</span>&nbsp;<span class="ident" id="4833376">e</span>&nbsp;<span class="op" id="4833378">:=</span>&nbsp;<span class="keyword" id="4833381">range</span>&nbsp;<span class="ident" id="4833387">osDefaultInheritEnv</span><span class="op" id="4833406">[</span><span class="ident" id="4833407">runtime</span><span class="op" id="4833414">.</span><span class="ident" id="4833415">GOOS</span><span class="op" id="4833419">]</span>&nbsp;<span class="op" id="4833421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833425">if</span>&nbsp;<span class="ident" id="4833428">v</span>&nbsp;<span class="op" id="4833430">:=</span>&nbsp;<span class="ident" id="4833433">os</span><span class="op" id="4833435">.</span><span class="ident" id="4833436">Getenv</span><span class="op" id="4833442">(</span><span class="ident" id="4833443">e</span><span class="op" id="4833444">)</span><span class="op" id="4833445">;</span>&nbsp;<span class="ident" id="4833447">v</span>&nbsp;<span class="op" id="4833449">!=</span>&nbsp;<span class="string" id="4833452">&#34;&#34;</span>&nbsp;<span class="op" id="4833455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833460">env</span>&nbsp;<span class="op" id="4833464">=</span>&nbsp;<span class="builtinfunc" id="4833466">append</span><span class="op" id="4833472">(</span><span class="ident" id="4833473">env</span><span class="op" id="4833476">,</span>&nbsp;<span class="ident" id="4833478">e</span><span class="op" id="4833479">+</span><span class="string" id="4833480">&#34;=&#34;</span><span class="op" id="4833483">+</span><span class="ident" id="4833484">v</span><span class="op" id="4833485">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833496">env</span>&nbsp;<span class="op" id="4833500">=</span>&nbsp;<span class="ident" id="4833502">removeLeadingDuplicates</span><span class="op" id="4833525">(</span><span class="ident" id="4833526">env</span><span class="op" id="4833529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833533">var</span>&nbsp;<span class="ident" id="4833537">cwd</span><span class="op" id="4833540">,</span>&nbsp;<span class="ident" id="4833542">path</span>&nbsp;<span class="builtintype" id="4833547">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833555">if</span>&nbsp;<span class="ident" id="4833558">h</span><span class="op" id="4833559">.</span><span class="ident" id="4833560">Dir</span>&nbsp;<span class="op" id="4833564">!=</span>&nbsp;<span class="string" id="4833567">&#34;&#34;</span>&nbsp;<span class="op" id="4833570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833574">path</span>&nbsp;<span class="op" id="4833579">=</span>&nbsp;<span class="ident" id="4833581">h</span><span class="op" id="4833582">.</span><span class="ident" id="4833583">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833590">cwd</span>&nbsp;<span class="op" id="4833594">=</span>&nbsp;<span class="ident" id="4833596">h</span><span class="op" id="4833597">.</span><span class="ident" id="4833598">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833603">}</span>&nbsp;<span class="keyword" id="4833605">else</span>&nbsp;<span class="op" id="4833610">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833614">cwd</span><span class="op" id="4833617">,</span>&nbsp;<span class="ident" id="4833619">path</span>&nbsp;<span class="op" id="4833624">=</span>&nbsp;<span class="ident" id="4833626">filepath</span><span class="op" id="4833634">.</span><span class="ident" id="4833635">Split</span><span class="op" id="4833640">(</span><span class="ident" id="4833641">h</span><span class="op" id="4833642">.</span><span class="ident" id="4833643">Path</span><span class="op" id="4833647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833653">if</span>&nbsp;<span class="ident" id="4833656">cwd</span>&nbsp;<span class="op" id="4833660">==</span>&nbsp;<span class="string" id="4833663">&#34;&#34;</span>&nbsp;<span class="op" id="4833666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833670">cwd</span>&nbsp;<span class="op" id="4833674">=</span>&nbsp;<span class="string" id="4833676">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833681">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833685">internalError</span>&nbsp;<span class="op" id="4833699">:=</span>&nbsp;<span class="keyword" id="4833702">func</span><span class="op" id="4833706">(</span><span class="ident" id="4833707">err</span>&nbsp;<span class="builtintype" id="4833711">error</span><span class="op" id="4833716">)</span>&nbsp;<span class="op" id="4833718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833722">rw</span><span class="op" id="4833724">.</span><span class="ident" id="4833725">WriteHeader</span><span class="op" id="4833736">(</span><span class="ident" id="4833737">http</span><span class="op" id="4833741">.</span><span class="ident" id="4833742">StatusInternalServerError</span><span class="op" id="4833767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833771">h</span><span class="op" id="4833772">.</span><span class="ident" id="4833773">printf</span><span class="op" id="4833779">(</span><span class="string" id="4833780">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="4833795">,</span>&nbsp;<span class="ident" id="4833797">err</span><span class="op" id="4833800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833803">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833807">cmd</span>&nbsp;<span class="op" id="4833811">:=</span>&nbsp;<span class="op" id="4833814">&amp;</span><span class="ident" id="4833815">exec</span><span class="op" id="4833819">.</span><span class="ident" id="4833820">Cmd</span><span class="op" id="4833823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833827">Path</span><span class="op" id="4833831">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4833835">path</span><span class="op" id="4833839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833843">Args</span><span class="op" id="4833847">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4833851">append</span><span class="op" id="4833857">(</span><span class="op" id="4833858">[</span><span class="op" id="4833859">]</span><span class="builtintype" id="4833860">string</span><span class="op" id="4833866">{</span><span class="ident" id="4833867">h</span><span class="op" id="4833868">.</span><span class="ident" id="4833869">Path</span><span class="op" id="4833873">}</span><span class="op" id="4833874">,</span>&nbsp;<span class="ident" id="4833876">h</span><span class="op" id="4833877">.</span><span class="ident" id="4833878">Args</span><span class="op" id="4833882">...</span><span class="op" id="4833885">)</span><span class="op" id="4833886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833890">Dir</span><span class="op" id="4833893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833898">cwd</span><span class="op" id="4833901">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833905">Env</span><span class="op" id="4833908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4833913">env</span><span class="op" id="4833916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833920">Stderr</span><span class="op" id="4833926">:</span>&nbsp;<span class="ident" id="4833928">os</span><span class="op" id="4833930">.</span><span class="ident" id="4833931">Stderr</span><span class="op" id="4833937">,</span>&nbsp;<span class="comment" id="4833939">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833954">if</span>&nbsp;<span class="ident" id="4833957">req</span><span class="op" id="4833960">.</span><span class="ident" id="4833961">ContentLength</span>&nbsp;<span class="op" id="4833975">!=</span>&nbsp;<span class="num" id="4833978">0</span>&nbsp;<span class="op" id="4833980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833984">cmd</span><span class="op" id="4833987">.</span><span class="ident" id="4833988">Stdin</span>&nbsp;<span class="op" id="4833994">=</span>&nbsp;<span class="ident" id="4833996">req</span><span class="op" id="4833999">.</span><span class="ident" id="4834000">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834009">stdoutRead</span><span class="op" id="4834019">,</span>&nbsp;<span class="ident" id="4834021">err</span>&nbsp;<span class="op" id="4834025">:=</span>&nbsp;<span class="ident" id="4834028">cmd</span><span class="op" id="4834031">.</span><span class="ident" id="4834032">StdoutPipe</span><span class="op" id="4834042">(</span><span class="op" id="4834043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834046">if</span>&nbsp;<span class="ident" id="4834049">err</span>&nbsp;<span class="op" id="4834053">!=</span>&nbsp;<span class="ident" id="4834056">nil</span>&nbsp;<span class="op" id="4834060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834064">internalError</span><span class="op" id="4834077">(</span><span class="ident" id="4834078">err</span><span class="op" id="4834081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834085">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834097">err</span>&nbsp;<span class="op" id="4834101">=</span>&nbsp;<span class="ident" id="4834103">cmd</span><span class="op" id="4834106">.</span><span class="ident" id="4834107">Start</span><span class="op" id="4834112">(</span><span class="op" id="4834113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834116">if</span>&nbsp;<span class="ident" id="4834119">err</span>&nbsp;<span class="op" id="4834123">!=</span>&nbsp;<span class="ident" id="4834126">nil</span>&nbsp;<span class="op" id="4834130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834134">internalError</span><span class="op" id="4834147">(</span><span class="ident" id="4834148">err</span><span class="op" id="4834151">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834155">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834166">if</span>&nbsp;<span class="ident" id="4834169">hook</span>&nbsp;<span class="op" id="4834174">:=</span>&nbsp;<span class="ident" id="4834177">testHookStartProcess</span><span class="op" id="4834197">;</span>&nbsp;<span class="ident" id="4834199">hook</span>&nbsp;<span class="op" id="4834204">!=</span>&nbsp;<span class="ident" id="4834207">nil</span>&nbsp;<span class="op" id="4834211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834215">hook</span><span class="op" id="4834219">(</span><span class="ident" id="4834220">cmd</span><span class="op" id="4834223">.</span><span class="ident" id="4834224">Process</span><span class="op" id="4834231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834234">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834237">defer</span>&nbsp;<span class="ident" id="4834243">cmd</span><span class="op" id="4834246">.</span><span class="ident" id="4834247">Wait</span><span class="op" id="4834251">(</span><span class="op" id="4834252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834255">defer</span>&nbsp;<span class="ident" id="4834261">stdoutRead</span><span class="op" id="4834271">.</span><span class="ident" id="4834272">Close</span><span class="op" id="4834277">(</span><span class="op" id="4834278">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834282">linebody</span>&nbsp;<span class="op" id="4834291">:=</span>&nbsp;<span class="ident" id="4834294">bufio</span><span class="op" id="4834299">.</span><span class="ident" id="4834300">NewReaderSize</span><span class="op" id="4834313">(</span><span class="ident" id="4834314">stdoutRead</span><span class="op" id="4834324">,</span>&nbsp;<span class="num" id="4834326">1024</span><span class="op" id="4834330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834333">headers</span>&nbsp;<span class="op" id="4834341">:=</span>&nbsp;<span class="builtinfunc" id="4834344">make</span><span class="op" id="4834348">(</span><span class="ident" id="4834349">http</span><span class="op" id="4834353">.</span><span class="ident" id="4834354">Header</span><span class="op" id="4834360">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834363">statusCode</span>&nbsp;<span class="op" id="4834374">:=</span>&nbsp;<span class="num" id="4834377">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834380">headerLines</span>&nbsp;<span class="op" id="4834392">:=</span>&nbsp;<span class="num" id="4834395">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834398">sawBlankLine</span>&nbsp;<span class="op" id="4834411">:=</span>&nbsp;<span class="builtintype" id="4834414">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834421">for</span>&nbsp;<span class="op" id="4834425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834429">line</span><span class="op" id="4834433">,</span>&nbsp;<span class="ident" id="4834435">isPrefix</span><span class="op" id="4834443">,</span>&nbsp;<span class="ident" id="4834445">err</span>&nbsp;<span class="op" id="4834449">:=</span>&nbsp;<span class="ident" id="4834452">linebody</span><span class="op" id="4834460">.</span><span class="ident" id="4834461">ReadLine</span><span class="op" id="4834469">(</span><span class="op" id="4834470">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834474">if</span>&nbsp;<span class="ident" id="4834477">isPrefix</span>&nbsp;<span class="op" id="4834486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834491">rw</span><span class="op" id="4834493">.</span><span class="ident" id="4834494">WriteHeader</span><span class="op" id="4834505">(</span><span class="ident" id="4834506">http</span><span class="op" id="4834510">.</span><span class="ident" id="4834511">StatusInternalServerError</span><span class="op" id="4834536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834541">h</span><span class="op" id="4834542">.</span><span class="ident" id="4834543">printf</span><span class="op" id="4834549">(</span><span class="string" id="4834550">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="4834590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834604">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834608">if</span>&nbsp;<span class="ident" id="4834611">err</span>&nbsp;<span class="op" id="4834615">==</span>&nbsp;<span class="ident" id="4834618">io</span><span class="op" id="4834620">.</span><span class="ident" id="4834621">EOF</span>&nbsp;<span class="op" id="4834625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834630">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834642">if</span>&nbsp;<span class="ident" id="4834645">err</span>&nbsp;<span class="op" id="4834649">!=</span>&nbsp;<span class="ident" id="4834652">nil</span>&nbsp;<span class="op" id="4834656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834661">rw</span><span class="op" id="4834663">.</span><span class="ident" id="4834664">WriteHeader</span><span class="op" id="4834675">(</span><span class="ident" id="4834676">http</span><span class="op" id="4834680">.</span><span class="ident" id="4834681">StatusInternalServerError</span><span class="op" id="4834706">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834711">h</span><span class="op" id="4834712">.</span><span class="ident" id="4834713">printf</span><span class="op" id="4834719">(</span><span class="string" id="4834720">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="4834752">,</span>&nbsp;<span class="ident" id="4834754">err</span><span class="op" id="4834757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834762">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834775">if</span>&nbsp;<span class="builtinfunc" id="4834778">len</span><span class="op" id="4834781">(</span><span class="ident" id="4834782">line</span><span class="op" id="4834786">)</span>&nbsp;<span class="op" id="4834788">==</span>&nbsp;<span class="num" id="4834791">0</span>&nbsp;<span class="op" id="4834793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834798">sawBlankLine</span>&nbsp;<span class="op" id="4834811">=</span>&nbsp;<span class="builtintype" id="4834813">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834821">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834833">headerLines</span><span class="op" id="4834844">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834849">parts</span>&nbsp;<span class="op" id="4834855">:=</span>&nbsp;<span class="ident" id="4834858">strings</span><span class="op" id="4834865">.</span><span class="ident" id="4834866">SplitN</span><span class="op" id="4834872">(</span><span class="builtintype" id="4834873">string</span><span class="op" id="4834879">(</span><span class="ident" id="4834880">line</span><span class="op" id="4834884">)</span><span class="op" id="4834885">,</span>&nbsp;<span class="string" id="4834887">&#34;:&#34;</span><span class="op" id="4834890">,</span>&nbsp;<span class="num" id="4834892">2</span><span class="op" id="4834893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834897">if</span>&nbsp;<span class="builtinfunc" id="4834900">len</span><span class="op" id="4834903">(</span><span class="ident" id="4834904">parts</span><span class="op" id="4834909">)</span>&nbsp;<span class="op" id="4834911">&lt;</span>&nbsp;<span class="num" id="4834913">2</span>&nbsp;<span class="op" id="4834915">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834920">h</span><span class="op" id="4834921">.</span><span class="ident" id="4834922">printf</span><span class="op" id="4834928">(</span><span class="string" id="4834929">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="4834957">,</span>&nbsp;<span class="builtintype" id="4834959">string</span><span class="op" id="4834965">(</span><span class="ident" id="4834966">line</span><span class="op" id="4834970">)</span><span class="op" id="4834971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834976">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834991">header</span><span class="op" id="4834997">,</span>&nbsp;<span class="ident" id="4834999">val</span>&nbsp;<span class="op" id="4835003">:=</span>&nbsp;<span class="ident" id="4835006">parts</span><span class="op" id="4835011">[</span><span class="num" id="4835012">0</span><span class="op" id="4835013">]</span><span class="op" id="4835014">,</span>&nbsp;<span class="ident" id="4835016">parts</span><span class="op" id="4835021">[</span><span class="num" id="4835022">1</span><span class="op" id="4835023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835027">header</span>&nbsp;<span class="op" id="4835034">=</span>&nbsp;<span class="ident" id="4835036">strings</span><span class="op" id="4835043">.</span><span class="ident" id="4835044">TrimSpace</span><span class="op" id="4835053">(</span><span class="ident" id="4835054">header</span><span class="op" id="4835060">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835064">val</span>&nbsp;<span class="op" id="4835068">=</span>&nbsp;<span class="ident" id="4835070">strings</span><span class="op" id="4835077">.</span><span class="ident" id="4835078">TrimSpace</span><span class="op" id="4835087">(</span><span class="ident" id="4835088">val</span><span class="op" id="4835091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835095">switch</span>&nbsp;<span class="op" id="4835102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835106">case</span>&nbsp;<span class="ident" id="4835111">header</span>&nbsp;<span class="op" id="4835118">==</span>&nbsp;<span class="string" id="4835121">&#34;Status&#34;</span><span class="op" id="4835129">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835134">if</span>&nbsp;<span class="builtinfunc" id="4835137">len</span><span class="op" id="4835140">(</span><span class="ident" id="4835141">val</span><span class="op" id="4835144">)</span>&nbsp;<span class="op" id="4835146">&lt;</span>&nbsp;<span class="num" id="4835148">3</span>&nbsp;<span class="op" id="4835150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835156">h</span><span class="op" id="4835157">.</span><span class="ident" id="4835158">printf</span><span class="op" id="4835164">(</span><span class="string" id="4835165">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="4835196">,</span>&nbsp;<span class="ident" id="4835198">val</span><span class="op" id="4835201">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835207">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835222">code</span><span class="op" id="4835226">,</span>&nbsp;<span class="ident" id="4835228">err</span>&nbsp;<span class="op" id="4835232">:=</span>&nbsp;<span class="ident" id="4835235">strconv</span><span class="op" id="4835242">.</span><span class="ident" id="4835243">Atoi</span><span class="op" id="4835247">(</span><span class="ident" id="4835248">val</span><span class="op" id="4835251">[</span><span class="num" id="4835252">0</span><span class="op" id="4835253">:</span><span class="num" id="4835254">3</span><span class="op" id="4835255">]</span><span class="op" id="4835256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835261">if</span>&nbsp;<span class="ident" id="4835264">err</span>&nbsp;<span class="op" id="4835268">!=</span>&nbsp;<span class="ident" id="4835271">nil</span>&nbsp;<span class="op" id="4835275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835281">h</span><span class="op" id="4835282">.</span><span class="ident" id="4835283">printf</span><span class="op" id="4835289">(</span><span class="string" id="4835290">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="4835313">,</span>&nbsp;<span class="ident" id="4835315">val</span><span class="op" id="4835318">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835324">h</span><span class="op" id="4835325">.</span><span class="ident" id="4835326">printf</span><span class="op" id="4835332">(</span><span class="string" id="4835333">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="4835351">,</span>&nbsp;<span class="ident" id="4835353">line</span><span class="op" id="4835357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835378">statusCode</span>&nbsp;<span class="op" id="4835389">=</span>&nbsp;<span class="ident" id="4835391">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835398">default</span><span class="op" id="4835405">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835410">headers</span><span class="op" id="4835417">.</span><span class="ident" id="4835418">Add</span><span class="op" id="4835421">(</span><span class="ident" id="4835422">header</span><span class="op" id="4835428">,</span>&nbsp;<span class="ident" id="4835430">val</span><span class="op" id="4835433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835443">if</span>&nbsp;<span class="ident" id="4835446">headerLines</span>&nbsp;<span class="op" id="4835458">==</span>&nbsp;<span class="num" id="4835461">0</span>&nbsp;<span class="op" id="4835463">||</span>&nbsp;<span class="op" id="4835466">!</span><span class="ident" id="4835467">sawBlankLine</span>&nbsp;<span class="op" id="4835480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835484">rw</span><span class="op" id="4835486">.</span><span class="ident" id="4835487">WriteHeader</span><span class="op" id="4835498">(</span><span class="ident" id="4835499">http</span><span class="op" id="4835503">.</span><span class="ident" id="4835504">StatusInternalServerError</span><span class="op" id="4835529">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835533">h</span><span class="op" id="4835534">.</span><span class="ident" id="4835535">printf</span><span class="op" id="4835541">(</span><span class="string" id="4835542">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="4835559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835563">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835575">if</span>&nbsp;<span class="ident" id="4835578">loc</span>&nbsp;<span class="op" id="4835582">:=</span>&nbsp;<span class="ident" id="4835585">headers</span><span class="op" id="4835592">.</span><span class="ident" id="4835593">Get</span><span class="op" id="4835596">(</span><span class="string" id="4835597">&#34;Location&#34;</span><span class="op" id="4835607">)</span><span class="op" id="4835608">;</span>&nbsp;<span class="ident" id="4835610">loc</span>&nbsp;<span class="op" id="4835614">!=</span>&nbsp;<span class="string" id="4835617">&#34;&#34;</span>&nbsp;<span class="op" id="4835620">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835624">if</span>&nbsp;<span class="ident" id="4835627">strings</span><span class="op" id="4835634">.</span><span class="ident" id="4835635">HasPrefix</span><span class="op" id="4835644">(</span><span class="ident" id="4835645">loc</span><span class="op" id="4835648">,</span>&nbsp;<span class="string" id="4835650">&#34;/&#34;</span><span class="op" id="4835653">)</span>&nbsp;<span class="op" id="4835655">&amp;&amp;</span>&nbsp;<span class="ident" id="4835658">h</span><span class="op" id="4835659">.</span><span class="ident" id="4835660">PathLocationHandler</span>&nbsp;<span class="op" id="4835680">!=</span>&nbsp;<span class="ident" id="4835683">nil</span>&nbsp;<span class="op" id="4835687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835692">h</span><span class="op" id="4835693">.</span><span class="ident" id="4835694">handleInternalRedirect</span><span class="op" id="4835716">(</span><span class="ident" id="4835717">rw</span><span class="op" id="4835719">,</span>&nbsp;<span class="ident" id="4835721">req</span><span class="op" id="4835724">,</span>&nbsp;<span class="ident" id="4835726">loc</span><span class="op" id="4835729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835747">if</span>&nbsp;<span class="ident" id="4835750">statusCode</span>&nbsp;<span class="op" id="4835761">==</span>&nbsp;<span class="num" id="4835764">0</span>&nbsp;<span class="op" id="4835766">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835771">statusCode</span>&nbsp;<span class="op" id="4835782">=</span>&nbsp;<span class="ident" id="4835784">http</span><span class="op" id="4835788">.</span><span class="ident" id="4835789">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835810">if</span>&nbsp;<span class="ident" id="4835813">statusCode</span>&nbsp;<span class="op" id="4835824">==</span>&nbsp;<span class="num" id="4835827">0</span>&nbsp;<span class="op" id="4835829">&amp;&amp;</span>&nbsp;<span class="ident" id="4835832">headers</span><span class="op" id="4835839">.</span><span class="ident" id="4835840">Get</span><span class="op" id="4835843">(</span><span class="string" id="4835844">&#34;Content-Type&#34;</span><span class="op" id="4835858">)</span>&nbsp;<span class="op" id="4835860">==</span>&nbsp;<span class="string" id="4835863">&#34;&#34;</span>&nbsp;<span class="op" id="4835866">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835870">rw</span><span class="op" id="4835872">.</span><span class="ident" id="4835873">WriteHeader</span><span class="op" id="4835884">(</span><span class="ident" id="4835885">http</span><span class="op" id="4835889">.</span><span class="ident" id="4835890">StatusInternalServerError</span><span class="op" id="4835915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835919">h</span><span class="op" id="4835920">.</span><span class="ident" id="4835921">printf</span><span class="op" id="4835927">(</span><span class="string" id="4835928">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="4835975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835979">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835991">if</span>&nbsp;<span class="ident" id="4835994">statusCode</span>&nbsp;<span class="op" id="4836005">==</span>&nbsp;<span class="num" id="4836008">0</span>&nbsp;<span class="op" id="4836010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836014">statusCode</span>&nbsp;<span class="op" id="4836025">=</span>&nbsp;<span class="ident" id="4836027">http</span><span class="op" id="4836031">.</span><span class="ident" id="4836032">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836046">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836107">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836167">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836201">for</span>&nbsp;<span class="ident" id="4836205">k</span><span class="op" id="4836206">,</span>&nbsp;<span class="ident" id="4836208">vv</span>&nbsp;<span class="op" id="4836211">:=</span>&nbsp;<span class="keyword" id="4836214">range</span>&nbsp;<span class="ident" id="4836220">headers</span>&nbsp;<span class="op" id="4836228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836232">for</span>&nbsp;<span class="ident" id="4836236">_</span><span class="op" id="4836237">,</span>&nbsp;<span class="ident" id="4836239">v</span>&nbsp;<span class="op" id="4836241">:=</span>&nbsp;<span class="keyword" id="4836244">range</span>&nbsp;<span class="ident" id="4836250">vv</span>&nbsp;<span class="op" id="4836253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836258">rw</span><span class="op" id="4836260">.</span><span class="ident" id="4836261">Header</span><span class="op" id="4836267">(</span><span class="op" id="4836268">)</span><span class="op" id="4836269">.</span><span class="ident" id="4836270">Add</span><span class="op" id="4836273">(</span><span class="ident" id="4836274">k</span><span class="op" id="4836275">,</span>&nbsp;<span class="ident" id="4836277">v</span><span class="op" id="4836278">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836289">rw</span><span class="op" id="4836291">.</span><span class="ident" id="4836292">WriteHeader</span><span class="op" id="4836303">(</span><span class="ident" id="4836304">statusCode</span><span class="op" id="4836314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836318">_</span><span class="op" id="4836319">,</span>&nbsp;<span class="ident" id="4836321">err</span>&nbsp;<span class="op" id="4836325">=</span>&nbsp;<span class="ident" id="4836327">io</span><span class="op" id="4836329">.</span><span class="ident" id="4836330">Copy</span><span class="op" id="4836334">(</span><span class="ident" id="4836335">rw</span><span class="op" id="4836337">,</span>&nbsp;<span class="ident" id="4836339">linebody</span><span class="op" id="4836347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836350">if</span>&nbsp;<span class="ident" id="4836353">err</span>&nbsp;<span class="op" id="4836357">!=</span>&nbsp;<span class="ident" id="4836360">nil</span>&nbsp;<span class="op" id="4836364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836368">h</span><span class="op" id="4836369">.</span><span class="ident" id="4836370">printf</span><span class="op" id="4836376">(</span><span class="string" id="4836377">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="4836398">,</span>&nbsp;<span class="ident" id="4836400">err</span><span class="op" id="4836403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836407">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836463">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836518">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836574">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836627">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4836685">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836729">cmd</span><span class="op" id="4836732">.</span><span class="ident" id="4836733">Process</span><span class="op" id="4836740">.</span><span class="ident" id="4836741">Kill</span><span class="op" id="4836745">(</span><span class="op" id="4836746">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836749">}</span><br>
<span class="lineno"></span><span class="op" id="4836751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4836754">func</span>&nbsp;<span class="op" id="4836759">(</span><span class="ident" id="4836760">h</span>&nbsp;<span class="op" id="4836762">*</span><span class="ident" id="4836763">Handler</span><span class="op" id="4836770">)</span>&nbsp;<span class="ident" id="4836772">printf</span><span class="op" id="4836778">(</span><span class="ident" id="4836779">format</span>&nbsp;<span class="builtintype" id="4836786">string</span><span class="op" id="4836792">,</span>&nbsp;<span class="ident" id="4836794">v</span>&nbsp;<span class="op" id="4836796">...</span><span class="keyword" id="4836799">interface</span><span class="op" id="4836808">{</span><span class="op" id="4836809">}</span><span class="op" id="4836810">)</span>&nbsp;<span class="op" id="4836812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836815">if</span>&nbsp;<span class="ident" id="4836818">h</span><span class="op" id="4836819">.</span><span class="ident" id="4836820">Logger</span>&nbsp;<span class="op" id="4836827">!=</span>&nbsp;<span class="ident" id="4836830">nil</span>&nbsp;<span class="op" id="4836834">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836838">h</span><span class="op" id="4836839">.</span><span class="ident" id="4836840">Logger</span><span class="op" id="4836846">.</span><span class="ident" id="4836847">Printf</span><span class="op" id="4836853">(</span><span class="ident" id="4836854">format</span><span class="op" id="4836860">,</span>&nbsp;<span class="ident" id="4836862">v</span><span class="op" id="4836863">...</span><span class="op" id="4836866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836869">}</span>&nbsp;<span class="keyword" id="4836871">else</span>&nbsp;<span class="op" id="4836876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836880">log</span><span class="op" id="4836883">.</span><span class="ident" id="4836884">Printf</span><span class="op" id="4836890">(</span><span class="ident" id="4836891">format</span><span class="op" id="4836897">,</span>&nbsp;<span class="ident" id="4836899">v</span><span class="op" id="4836900">...</span><span class="op" id="4836903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836906">}</span><br>
<span class="lineno"></span><span class="op" id="4836908">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4836911">func</span>&nbsp;<span class="op" id="4836916">(</span><span class="ident" id="4836917">h</span>&nbsp;<span class="op" id="4836919">*</span><span class="ident" id="4836920">Handler</span><span class="op" id="4836927">)</span>&nbsp;<span class="ident" id="4836929">handleInternalRedirect</span><span class="op" id="4836951">(</span><span class="ident" id="4836952">rw</span>&nbsp;<span class="ident" id="4836955">http</span><span class="op" id="4836959">.</span><span class="ident" id="4836960">ResponseWriter</span><span class="op" id="4836974">,</span>&nbsp;<span class="ident" id="4836976">req</span>&nbsp;<span class="op" id="4836980">*</span><span class="ident" id="4836981">http</span><span class="op" id="4836985">.</span><span class="ident" id="4836986">Request</span><span class="op" id="4836993">,</span>&nbsp;<span class="ident" id="4836995">path</span>&nbsp;<span class="builtintype" id="4837000">string</span><span class="op" id="4837006">)</span>&nbsp;<span class="op" id="4837008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837011">url</span><span class="op" id="4837014">,</span>&nbsp;<span class="ident" id="4837016">err</span>&nbsp;<span class="op" id="4837020">:=</span>&nbsp;<span class="ident" id="4837023">req</span><span class="op" id="4837026">.</span><span class="ident" id="4837027">URL</span><span class="op" id="4837030">.</span><span class="ident" id="4837031">Parse</span><span class="op" id="4837036">(</span><span class="ident" id="4837037">path</span><span class="op" id="4837041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837044">if</span>&nbsp;<span class="ident" id="4837047">err</span>&nbsp;<span class="op" id="4837051">!=</span>&nbsp;<span class="ident" id="4837054">nil</span>&nbsp;<span class="op" id="4837058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837062">rw</span><span class="op" id="4837064">.</span><span class="ident" id="4837065">WriteHeader</span><span class="op" id="4837076">(</span><span class="ident" id="4837077">http</span><span class="op" id="4837081">.</span><span class="ident" id="4837082">StatusInternalServerError</span><span class="op" id="4837107">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837111">h</span><span class="op" id="4837112">.</span><span class="ident" id="4837113">printf</span><span class="op" id="4837119">(</span><span class="string" id="4837120">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="4837164">,</span>&nbsp;<span class="ident" id="4837166">path</span><span class="op" id="4837170">,</span>&nbsp;<span class="ident" id="4837172">err</span><span class="op" id="4837175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837179">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4837187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837190">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837254">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837315">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837377">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837438">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837500">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837561">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837614">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4837676">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837696">newReq</span>&nbsp;<span class="op" id="4837703">:=</span>&nbsp;<span class="op" id="4837706">&amp;</span><span class="ident" id="4837707">http</span><span class="op" id="4837711">.</span><span class="ident" id="4837712">Request</span><span class="op" id="4837719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837723">Method</span><span class="op" id="4837729">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4837735">&#34;GET&#34;</span><span class="op" id="4837740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837744">URL</span><span class="op" id="4837747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4837756">url</span><span class="op" id="4837759">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837763">Proto</span><span class="op" id="4837768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4837775">&#34;HTTP/1.1&#34;</span><span class="op" id="4837785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837789">ProtoMajor</span><span class="op" id="4837799">:</span>&nbsp;<span class="num" id="4837801">1</span><span class="op" id="4837802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837806">ProtoMinor</span><span class="op" id="4837816">:</span>&nbsp;<span class="num" id="4837818">1</span><span class="op" id="4837819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837823">Header</span><span class="op" id="4837829">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4837835">make</span><span class="op" id="4837839">(</span><span class="ident" id="4837840">http</span><span class="op" id="4837844">.</span><span class="ident" id="4837845">Header</span><span class="op" id="4837851">)</span><span class="op" id="4837852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837856">Host</span><span class="op" id="4837860">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4837868">url</span><span class="op" id="4837871">.</span><span class="ident" id="4837872">Host</span><span class="op" id="4837876">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837880">RemoteAddr</span><span class="op" id="4837890">:</span>&nbsp;<span class="ident" id="4837892">req</span><span class="op" id="4837895">.</span><span class="ident" id="4837896">RemoteAddr</span><span class="op" id="4837906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837910">TLS</span><span class="op" id="4837913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4837922">req</span><span class="op" id="4837925">.</span><span class="ident" id="4837926">TLS</span><span class="op" id="4837929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4837932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4837935">h</span><span class="op" id="4837936">.</span><span class="ident" id="4837937">PathLocationHandler</span><span class="op" id="4837956">.</span><span class="ident" id="4837957">ServeHTTP</span><span class="op" id="4837966">(</span><span class="ident" id="4837967">rw</span><span class="op" id="4837969">,</span>&nbsp;<span class="ident" id="4837971">newReq</span><span class="op" id="4837977">)</span><br>
<span class="lineno"></span><span class="op" id="4837979">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4837982">func</span>&nbsp;<span class="ident" id="4837987">upperCaseAndUnderscore</span><span class="op" id="4838009">(</span><span class="ident" id="4838010">r</span>&nbsp;<span class="builtintype" id="4838012">rune</span><span class="op" id="4838016">)</span>&nbsp;<span class="builtintype" id="4838018">rune</span>&nbsp;<span class="op" id="4838023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838026">switch</span>&nbsp;<span class="op" id="4838033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838036">case</span>&nbsp;<span class="ident" id="4838041">r</span>&nbsp;<span class="op" id="4838043">&gt;=</span>&nbsp;<span class="string" id="4838046">&#39;a&#39;</span>&nbsp;<span class="op" id="4838050">&amp;&amp;</span>&nbsp;<span class="ident" id="4838053">r</span>&nbsp;<span class="op" id="4838055">&lt;=</span>&nbsp;<span class="string" id="4838058">&#39;z&#39;</span><span class="op" id="4838061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838065">return</span>&nbsp;<span class="ident" id="4838072">r</span>&nbsp;<span class="op" id="4838074">-</span>&nbsp;<span class="op" id="4838076">(</span><span class="string" id="4838077">&#39;a&#39;</span>&nbsp;<span class="op" id="4838081">-</span>&nbsp;<span class="string" id="4838083">&#39;A&#39;</span><span class="op" id="4838086">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838089">case</span>&nbsp;<span class="ident" id="4838094">r</span>&nbsp;<span class="op" id="4838096">==</span>&nbsp;<span class="string" id="4838099">&#39;-&#39;</span><span class="op" id="4838102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838106">return</span>&nbsp;<span class="string" id="4838113">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838118">case</span>&nbsp;<span class="ident" id="4838123">r</span>&nbsp;<span class="op" id="4838125">==</span>&nbsp;<span class="string" id="4838128">&#39;=&#39;</span><span class="op" id="4838131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4838135">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4838191">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4838246">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838298">return</span>&nbsp;<span class="string" id="4838305">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4838313">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838366">return</span>&nbsp;<span class="ident" id="4838373">r</span><br>
<span class="lineno">375</span><span class="op" id="4838375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838378">var</span>&nbsp;<span class="ident" id="4838382">testHookStartProcess</span>&nbsp;<span class="keyword" id="4838403">func</span><span class="op" id="4838407">(</span><span class="op" id="4838408">*</span><span class="ident" id="4838409">os</span><span class="op" id="4838411">.</span><span class="ident" id="4838412">Process</span><span class="op" id="4838419">)</span>&nbsp;<span class="comment" id="4838421">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
