<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5022319">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5022374">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5022428">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5022479">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;printing&nbsp;support&nbsp;for&nbsp;ASTs.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5022529">package</span>&nbsp;<span class="ident" id="5022537">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5022542">import</span>&nbsp;<span class="op" id="5022549">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5022552">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5022559">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5022571">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5022577">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5022583">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5022593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5022596">//&nbsp;A&nbsp;FieldFilter&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Fprint&nbsp;to&nbsp;control&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5022662">type</span>&nbsp;<span class="ident" id="5022667">FieldFilter</span>&nbsp;<span class="keyword" id="5022679">func</span><span class="op" id="5022683">(</span><span class="ident" id="5022684">name</span>&nbsp;<span class="builtintype" id="5022689">string</span><span class="op" id="5022695">,</span>&nbsp;<span class="ident" id="5022697">value</span>&nbsp;<span class="ident" id="5022703">reflect</span><span class="op" id="5022710">.</span><span class="ident" id="5022711">Value</span><span class="op" id="5022716">)</span>&nbsp;<span class="builtintype" id="5022718">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5022724">//&nbsp;NotNilFilter&nbsp;returns&nbsp;true&nbsp;for&nbsp;field&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;nil;</span><br>
<span class="lineno"></span><span class="comment" id="5022788">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="5022819">func</span>&nbsp;<span class="ident" id="5022824">NotNilFilter</span><span class="op" id="5022836">(</span><span class="ident" id="5022837">_</span>&nbsp;<span class="builtintype" id="5022839">string</span><span class="op" id="5022845">,</span>&nbsp;<span class="ident" id="5022847">v</span>&nbsp;<span class="ident" id="5022849">reflect</span><span class="op" id="5022856">.</span><span class="ident" id="5022857">Value</span><span class="op" id="5022862">)</span>&nbsp;<span class="builtintype" id="5022864">bool</span>&nbsp;<span class="op" id="5022869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022872">switch</span>&nbsp;<span class="ident" id="5022879">v</span><span class="op" id="5022880">.</span><span class="ident" id="5022881">Kind</span><span class="op" id="5022885">(</span><span class="op" id="5022886">)</span>&nbsp;<span class="op" id="5022888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022891">case</span>&nbsp;<span class="ident" id="5022896">reflect</span><span class="op" id="5022903">.</span><span class="ident" id="5022904">Chan</span><span class="op" id="5022908">,</span>&nbsp;<span class="ident" id="5022910">reflect</span><span class="op" id="5022917">.</span><span class="ident" id="5022918">Func</span><span class="op" id="5022922">,</span>&nbsp;<span class="ident" id="5022924">reflect</span><span class="op" id="5022931">.</span><span class="ident" id="5022932">Interface</span><span class="op" id="5022941">,</span>&nbsp;<span class="ident" id="5022943">reflect</span><span class="op" id="5022950">.</span><span class="ident" id="5022951">Map</span><span class="op" id="5022954">,</span>&nbsp;<span class="ident" id="5022956">reflect</span><span class="op" id="5022963">.</span><span class="ident" id="5022964">Ptr</span><span class="op" id="5022967">,</span>&nbsp;<span class="ident" id="5022969">reflect</span><span class="op" id="5022976">.</span><span class="ident" id="5022977">Slice</span><span class="op" id="5022982">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5022986">return</span>&nbsp;<span class="op" id="5022993">!</span><span class="ident" id="5022994">v</span><span class="op" id="5022995">.</span><span class="ident" id="5022996">IsNil</span><span class="op" id="5023001">(</span><span class="op" id="5023002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023008">return</span>&nbsp;<span class="ident" id="5023015">true</span><br>
<span class="lineno"></span><span class="op" id="5023020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5023023">//&nbsp;Fprint&nbsp;prints&nbsp;the&nbsp;(sub-)tree&nbsp;starting&nbsp;at&nbsp;AST&nbsp;node&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5023084">//&nbsp;If&nbsp;fset&nbsp;!=&nbsp;nil,&nbsp;position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative</span><br>
<span class="lineno"></span><span class="comment" id="5023148">//&nbsp;to&nbsp;that&nbsp;file&nbsp;set.&nbsp;Otherwise&nbsp;positions&nbsp;are&nbsp;printed&nbsp;as&nbsp;integer</span><br>
<span class="lineno"></span><span class="comment" id="5023212">//&nbsp;values&nbsp;(file&nbsp;set&nbsp;specific&nbsp;offsets).</span><br>
<span class="lineno"></span><span class="comment" id="5023251">//</span><br>
<span class="lineno">35</span><span class="comment" id="5023254">//&nbsp;A&nbsp;non-nil&nbsp;FieldFilter&nbsp;f&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;control&nbsp;the&nbsp;output:</span><br>
<span class="lineno"></span><span class="comment" id="5023320">//&nbsp;struct&nbsp;fields&nbsp;for&nbsp;which&nbsp;f(fieldname,&nbsp;fieldvalue)&nbsp;is&nbsp;true&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5023384">//&nbsp;printed;&nbsp;all&nbsp;others&nbsp;are&nbsp;filtered&nbsp;from&nbsp;the&nbsp;output.&nbsp;Unexported</span><br>
<span class="lineno"></span><span class="comment" id="5023448">//&nbsp;struct&nbsp;fields&nbsp;are&nbsp;never&nbsp;printed.</span><br>
<span class="lineno"></span><span class="comment" id="5023484">//</span><br>
<span class="lineno">40</span><span class="keyword" id="5023487">func</span>&nbsp;<span class="ident" id="5023492">Fprint</span><span class="op" id="5023498">(</span><span class="ident" id="5023499">w</span>&nbsp;<span class="ident" id="5023501">io</span><span class="op" id="5023503">.</span><span class="ident" id="5023504">Writer</span><span class="op" id="5023510">,</span>&nbsp;<span class="ident" id="5023512">fset</span>&nbsp;<span class="op" id="5023517">*</span><span class="ident" id="5023518">token</span><span class="op" id="5023523">.</span><span class="ident" id="5023524">FileSet</span><span class="op" id="5023531">,</span>&nbsp;<span class="ident" id="5023533">x</span>&nbsp;<span class="keyword" id="5023535">interface</span><span class="op" id="5023544">{</span><span class="op" id="5023545">}</span><span class="op" id="5023546">,</span>&nbsp;<span class="ident" id="5023548">f</span>&nbsp;<span class="ident" id="5023550">FieldFilter</span><span class="op" id="5023561">)</span>&nbsp;<span class="op" id="5023563">(</span><span class="ident" id="5023564">err</span>&nbsp;<span class="builtintype" id="5023568">error</span><span class="op" id="5023573">)</span>&nbsp;<span class="op" id="5023575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023578">//&nbsp;setup&nbsp;printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023596">p</span>&nbsp;<span class="op" id="5023598">:=</span>&nbsp;<span class="ident" id="5023601">printer</span><span class="op" id="5023608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023612">output</span><span class="op" id="5023618">:</span>&nbsp;<span class="ident" id="5023620">w</span><span class="op" id="5023621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023625">fset</span><span class="op" id="5023629">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5023633">fset</span><span class="op" id="5023637">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023641">filter</span><span class="op" id="5023647">:</span>&nbsp;<span class="ident" id="5023649">f</span><span class="op" id="5023650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023654">ptrmap</span><span class="op" id="5023660">:</span>&nbsp;<span class="builtinfunc" id="5023662">make</span><span class="op" id="5023666">(</span><span class="keyword" id="5023667">map</span><span class="op" id="5023670">[</span><span class="keyword" id="5023671">interface</span><span class="op" id="5023680">{</span><span class="op" id="5023681">}</span><span class="op" id="5023682">]</span><span class="builtintype" id="5023683">int</span><span class="op" id="5023686">)</span><span class="op" id="5023687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023691">last</span><span class="op" id="5023695">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5023699">&#39;\n&#39;</span><span class="op" id="5023703">,</span>&nbsp;<span class="comment" id="5023705">//&nbsp;force&nbsp;printing&nbsp;of&nbsp;line&nbsp;number&nbsp;on&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023757">//&nbsp;install&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023783">defer</span>&nbsp;<span class="keyword" id="5023789">func</span><span class="op" id="5023793">(</span><span class="op" id="5023794">)</span>&nbsp;<span class="op" id="5023796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023800">if</span>&nbsp;<span class="ident" id="5023803">e</span>&nbsp;<span class="op" id="5023805">:=</span>&nbsp;<span class="builtinfunc" id="5023808">recover</span><span class="op" id="5023815">(</span><span class="op" id="5023816">)</span><span class="op" id="5023817">;</span>&nbsp;<span class="ident" id="5023819">e</span>&nbsp;<span class="op" id="5023821">!=</span>&nbsp;<span class="ident" id="5023824">nil</span>&nbsp;<span class="op" id="5023828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023833">err</span>&nbsp;<span class="op" id="5023837">=</span>&nbsp;<span class="ident" id="5023839">e</span><span class="op" id="5023840">.</span><span class="op" id="5023841">(</span><span class="ident" id="5023842">localError</span><span class="op" id="5023852">)</span><span class="op" id="5023853">.</span><span class="ident" id="5023854">err</span>&nbsp;<span class="comment" id="5023858">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;localError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023898">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023901">}</span><span class="op" id="5023902">(</span><span class="op" id="5023903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5023907">//&nbsp;print&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023919">if</span>&nbsp;<span class="ident" id="5023922">x</span>&nbsp;<span class="op" id="5023924">==</span>&nbsp;<span class="ident" id="5023927">nil</span>&nbsp;<span class="op" id="5023931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023935">p</span><span class="op" id="5023936">.</span><span class="ident" id="5023937">printf</span><span class="op" id="5023943">(</span><span class="string" id="5023944">&#34;nil\n&#34;</span><span class="op" id="5023951">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5023955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5023963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023966">p</span><span class="op" id="5023967">.</span><span class="builtinfunc" id="5023968">print</span><span class="op" id="5023973">(</span><span class="ident" id="5023974">reflect</span><span class="op" id="5023981">.</span><span class="ident" id="5023982">ValueOf</span><span class="op" id="5023989">(</span><span class="ident" id="5023990">x</span><span class="op" id="5023991">)</span><span class="op" id="5023992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5023995">p</span><span class="op" id="5023996">.</span><span class="ident" id="5023997">printf</span><span class="op" id="5024003">(</span><span class="string" id="5024004">&#34;\n&#34;</span><span class="op" id="5024008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024012">return</span><br>
<span class="lineno"></span><span class="op" id="5024019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5024022">//&nbsp;Print&nbsp;prints&nbsp;x&nbsp;to&nbsp;standard&nbsp;output,&nbsp;skipping&nbsp;nil&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5024081">//&nbsp;Print(fset,&nbsp;x)&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;Fprint(os.Stdout,&nbsp;fset,&nbsp;x,&nbsp;NotNilFilter).</span><br>
<span class="lineno">70</span><span class="keyword" id="5024156">func</span>&nbsp;<span class="ident" id="5024161">Print</span><span class="op" id="5024166">(</span><span class="ident" id="5024167">fset</span>&nbsp;<span class="op" id="5024172">*</span><span class="ident" id="5024173">token</span><span class="op" id="5024178">.</span><span class="ident" id="5024179">FileSet</span><span class="op" id="5024186">,</span>&nbsp;<span class="ident" id="5024188">x</span>&nbsp;<span class="keyword" id="5024190">interface</span><span class="op" id="5024199">{</span><span class="op" id="5024200">}</span><span class="op" id="5024201">)</span>&nbsp;<span class="builtintype" id="5024203">error</span>&nbsp;<span class="op" id="5024209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024212">return</span>&nbsp;<span class="ident" id="5024219">Fprint</span><span class="op" id="5024225">(</span><span class="ident" id="5024226">os</span><span class="op" id="5024228">.</span><span class="ident" id="5024229">Stdout</span><span class="op" id="5024235">,</span>&nbsp;<span class="ident" id="5024237">fset</span><span class="op" id="5024241">,</span>&nbsp;<span class="ident" id="5024243">x</span><span class="op" id="5024244">,</span>&nbsp;<span class="ident" id="5024246">NotNilFilter</span><span class="op" id="5024258">)</span><br>
<span class="lineno"></span><span class="op" id="5024260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024263">type</span>&nbsp;<span class="ident" id="5024268">printer</span>&nbsp;<span class="keyword" id="5024276">struct</span>&nbsp;<span class="op" id="5024283">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024286">output</span>&nbsp;<span class="ident" id="5024293">io</span><span class="op" id="5024295">.</span><span class="ident" id="5024296">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024304">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5024311">*</span><span class="ident" id="5024312">token</span><span class="op" id="5024317">.</span><span class="ident" id="5024318">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024327">filter</span>&nbsp;<span class="ident" id="5024334">FieldFilter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024347">ptrmap</span>&nbsp;<span class="keyword" id="5024354">map</span><span class="op" id="5024357">[</span><span class="keyword" id="5024358">interface</span><span class="op" id="5024367">{</span><span class="op" id="5024368">}</span><span class="op" id="5024369">]</span><span class="builtintype" id="5024370">int</span>&nbsp;<span class="comment" id="5024374">//&nbsp;*T&nbsp;-&gt;&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024396">indent</span>&nbsp;<span class="builtintype" id="5024403">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5024423">//&nbsp;current&nbsp;indentation&nbsp;level</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024453">last</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5024460">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5024480">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;processed&nbsp;by&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024517">line</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5024524">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5024544">//&nbsp;current&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="op" id="5024567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5024570">var</span>&nbsp;<span class="ident" id="5024574">indent</span>&nbsp;<span class="op" id="5024581">=</span>&nbsp;<span class="op" id="5024583">[</span><span class="op" id="5024584">]</span><span class="builtintype" id="5024585">byte</span><span class="op" id="5024589">(</span><span class="string" id="5024590">&#34;.&nbsp;&nbsp;&#34;</span><span class="op" id="5024595">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="5024598">func</span>&nbsp;<span class="op" id="5024603">(</span><span class="ident" id="5024604">p</span>&nbsp;<span class="op" id="5024606">*</span><span class="ident" id="5024607">printer</span><span class="op" id="5024614">)</span>&nbsp;<span class="ident" id="5024616">Write</span><span class="op" id="5024621">(</span><span class="ident" id="5024622">data</span>&nbsp;<span class="op" id="5024627">[</span><span class="op" id="5024628">]</span><span class="builtintype" id="5024629">byte</span><span class="op" id="5024633">)</span>&nbsp;<span class="op" id="5024635">(</span><span class="ident" id="5024636">n</span>&nbsp;<span class="builtintype" id="5024638">int</span><span class="op" id="5024641">,</span>&nbsp;<span class="ident" id="5024643">err</span>&nbsp;<span class="builtintype" id="5024647">error</span><span class="op" id="5024652">)</span>&nbsp;<span class="op" id="5024654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024657">var</span>&nbsp;<span class="ident" id="5024661">m</span>&nbsp;<span class="builtintype" id="5024663">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024668">for</span>&nbsp;<span class="ident" id="5024672">i</span><span class="op" id="5024673">,</span>&nbsp;<span class="ident" id="5024675">b</span>&nbsp;<span class="op" id="5024677">:=</span>&nbsp;<span class="keyword" id="5024680">range</span>&nbsp;<span class="ident" id="5024686">data</span>&nbsp;<span class="op" id="5024691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5024695">//&nbsp;invariant:&nbsp;data[0:n]&nbsp;has&nbsp;been&nbsp;written</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024738">if</span>&nbsp;<span class="ident" id="5024741">b</span>&nbsp;<span class="op" id="5024743">==</span>&nbsp;<span class="string" id="5024746">&#39;\n&#39;</span>&nbsp;<span class="op" id="5024751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024756">m</span><span class="op" id="5024757">,</span>&nbsp;<span class="ident" id="5024759">err</span>&nbsp;<span class="op" id="5024763">=</span>&nbsp;<span class="ident" id="5024765">p</span><span class="op" id="5024766">.</span><span class="ident" id="5024767">output</span><span class="op" id="5024773">.</span><span class="ident" id="5024774">Write</span><span class="op" id="5024779">(</span><span class="ident" id="5024780">data</span><span class="op" id="5024784">[</span><span class="ident" id="5024785">n</span>&nbsp;<span class="op" id="5024787">:</span>&nbsp;<span class="ident" id="5024789">i</span><span class="op" id="5024790">+</span><span class="num" id="5024791">1</span><span class="op" id="5024792">]</span><span class="op" id="5024793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024798">n</span>&nbsp;<span class="op" id="5024800">+=</span>&nbsp;<span class="ident" id="5024803">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024808">if</span>&nbsp;<span class="ident" id="5024811">err</span>&nbsp;<span class="op" id="5024815">!=</span>&nbsp;<span class="ident" id="5024818">nil</span>&nbsp;<span class="op" id="5024822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024828">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024843">p</span><span class="op" id="5024844">.</span><span class="ident" id="5024845">line</span><span class="op" id="5024849">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024854">}</span>&nbsp;<span class="keyword" id="5024856">else</span>&nbsp;<span class="keyword" id="5024861">if</span>&nbsp;<span class="ident" id="5024864">p</span><span class="op" id="5024865">.</span><span class="ident" id="5024866">last</span>&nbsp;<span class="op" id="5024871">==</span>&nbsp;<span class="string" id="5024874">&#39;\n&#39;</span>&nbsp;<span class="op" id="5024879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5024884">_</span><span class="op" id="5024885">,</span>&nbsp;<span class="ident" id="5024887">err</span>&nbsp;<span class="op" id="5024891">=</span>&nbsp;<span class="ident" id="5024893">fmt</span><span class="op" id="5024896">.</span><span class="ident" id="5024897">Fprintf</span><span class="op" id="5024904">(</span><span class="ident" id="5024905">p</span><span class="op" id="5024906">.</span><span class="ident" id="5024907">output</span><span class="op" id="5024913">,</span>&nbsp;<span class="string" id="5024915">&#34;%6d&nbsp;&nbsp;&#34;</span><span class="op" id="5024922">,</span>&nbsp;<span class="ident" id="5024924">p</span><span class="op" id="5024925">.</span><span class="ident" id="5024926">line</span><span class="op" id="5024930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024935">if</span>&nbsp;<span class="ident" id="5024938">err</span>&nbsp;<span class="op" id="5024942">!=</span>&nbsp;<span class="ident" id="5024945">nil</span>&nbsp;<span class="op" id="5024949">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5024965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5024970">for</span>&nbsp;<span class="ident" id="5024974">j</span>&nbsp;<span class="op" id="5024976">:=</span>&nbsp;<span class="ident" id="5024979">p</span><span class="op" id="5024980">.</span><span class="ident" id="5024981">indent</span><span class="op" id="5024987">;</span>&nbsp;<span class="ident" id="5024989">j</span>&nbsp;<span class="op" id="5024991">&gt;</span>&nbsp;<span class="num" id="5024993">0</span><span class="op" id="5024994">;</span>&nbsp;<span class="ident" id="5024996">j</span><span class="op" id="5024997">--</span>&nbsp;<span class="op" id="5025000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025006">_</span><span class="op" id="5025007">,</span>&nbsp;<span class="ident" id="5025009">err</span>&nbsp;<span class="op" id="5025013">=</span>&nbsp;<span class="ident" id="5025015">p</span><span class="op" id="5025016">.</span><span class="ident" id="5025017">output</span><span class="op" id="5025023">.</span><span class="ident" id="5025024">Write</span><span class="op" id="5025029">(</span><span class="ident" id="5025030">indent</span><span class="op" id="5025036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025042">if</span>&nbsp;<span class="ident" id="5025045">err</span>&nbsp;<span class="op" id="5025049">!=</span>&nbsp;<span class="ident" id="5025052">nil</span>&nbsp;<span class="op" id="5025056">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025063">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025087">p</span><span class="op" id="5025088">.</span><span class="ident" id="5025089">last</span>&nbsp;<span class="op" id="5025094">=</span>&nbsp;<span class="ident" id="5025096">b</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025102">if</span>&nbsp;<span class="builtinfunc" id="5025105">len</span><span class="op" id="5025108">(</span><span class="ident" id="5025109">data</span><span class="op" id="5025113">)</span>&nbsp;<span class="op" id="5025115">&gt;</span>&nbsp;<span class="ident" id="5025117">n</span>&nbsp;<span class="op" id="5025119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025123">m</span><span class="op" id="5025124">,</span>&nbsp;<span class="ident" id="5025126">err</span>&nbsp;<span class="op" id="5025130">=</span>&nbsp;<span class="ident" id="5025132">p</span><span class="op" id="5025133">.</span><span class="ident" id="5025134">output</span><span class="op" id="5025140">.</span><span class="ident" id="5025141">Write</span><span class="op" id="5025146">(</span><span class="ident" id="5025147">data</span><span class="op" id="5025151">[</span><span class="ident" id="5025152">n</span><span class="op" id="5025153">:</span><span class="op" id="5025154">]</span><span class="op" id="5025155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025159">n</span>&nbsp;<span class="op" id="5025161">+=</span>&nbsp;<span class="ident" id="5025164">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025167">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025170">return</span><br>
<span class="lineno"></span><span class="op" id="5025177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5025180">//&nbsp;localError&nbsp;wraps&nbsp;locally&nbsp;caught&nbsp;errors&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish</span><br>
<span class="lineno"></span><span class="comment" id="5025244">//&nbsp;them&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors.</span><br>
<span class="lineno">120</span><span class="keyword" id="5025313">type</span>&nbsp;<span class="ident" id="5025318">localError</span>&nbsp;<span class="keyword" id="5025329">struct</span>&nbsp;<span class="op" id="5025336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5025339">err</span>&nbsp;<span class="builtintype" id="5025343">error</span><br>
<span class="lineno"></span><span class="op" id="5025349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5025352">//&nbsp;printf&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;that&nbsp;takes&nbsp;care&nbsp;of&nbsp;print&nbsp;errors.</span><br>
<span class="lineno">125</span><span class="keyword" id="5025420">func</span>&nbsp;<span class="op" id="5025425">(</span><span class="ident" id="5025426">p</span>&nbsp;<span class="op" id="5025428">*</span><span class="ident" id="5025429">printer</span><span class="op" id="5025436">)</span>&nbsp;<span class="ident" id="5025438">printf</span><span class="op" id="5025444">(</span><span class="ident" id="5025445">format</span>&nbsp;<span class="builtintype" id="5025452">string</span><span class="op" id="5025458">,</span>&nbsp;<span class="ident" id="5025460">args</span>&nbsp;<span class="op" id="5025465">...</span><span class="keyword" id="5025468">interface</span><span class="op" id="5025477">{</span><span class="op" id="5025478">}</span><span class="op" id="5025479">)</span>&nbsp;<span class="op" id="5025481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5025484">if</span>&nbsp;<span class="ident" id="5025487">_</span><span class="op" id="5025488">,</span>&nbsp;<span class="ident" id="5025490">err</span>&nbsp;<span class="op" id="5025494">:=</span>&nbsp;<span class="ident" id="5025497">fmt</span><span class="op" id="5025500">.</span><span class="ident" id="5025501">Fprintf</span><span class="op" id="5025508">(</span><span class="ident" id="5025509">p</span><span class="op" id="5025510">,</span>&nbsp;<span class="ident" id="5025512">format</span><span class="op" id="5025518">,</span>&nbsp;<span class="ident" id="5025520">args</span><span class="op" id="5025524">...</span><span class="op" id="5025527">)</span><span class="op" id="5025528">;</span>&nbsp;<span class="ident" id="5025530">err</span>&nbsp;<span class="op" id="5025534">!=</span>&nbsp;<span class="ident" id="5025537">nil</span>&nbsp;<span class="op" id="5025541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5025545">panic</span><span class="op" id="5025550">(</span><span class="ident" id="5025551">localError</span><span class="op" id="5025561">{</span><span class="ident" id="5025562">err</span><span class="op" id="5025565">}</span><span class="op" id="5025566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5025569">}</span><br>
<span class="lineno"></span><span class="op" id="5025571">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5025574">//&nbsp;Implementation&nbsp;note:&nbsp;Print&nbsp;is&nbsp;written&nbsp;for&nbsp;AST&nbsp;nodes&nbsp;but&nbsp;could&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5025642">//&nbsp;used&nbsp;to&nbsp;print&nbsp;arbitrary&nbsp;data&nbsp;structures;&nbsp;such&nbsp;a&nbsp;version&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="5025708">//&nbsp;probably&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5025747">//</span><br>
<span class="lineno">135</span><span class="comment" id="5025750">//&nbsp;Note:&nbsp;This&nbsp;code&nbsp;detects&nbsp;(some)&nbsp;cycles&nbsp;created&nbsp;via&nbsp;pointers&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5025816">//&nbsp;not&nbsp;cycles&nbsp;that&nbsp;are&nbsp;created&nbsp;via&nbsp;slices&nbsp;or&nbsp;maps&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5025881">//&nbsp;same&nbsp;slice&nbsp;or&nbsp;map.&nbsp;Code&nbsp;for&nbsp;general&nbsp;data&nbsp;structures&nbsp;probably</span><br>
<span class="lineno"></span><span class="comment" id="5025945">//&nbsp;should&nbsp;catch&nbsp;those&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="5025977">func</span>&nbsp;<span class="op" id="5025982">(</span><span class="ident" id="5025983">p</span>&nbsp;<span class="op" id="5025985">*</span><span class="ident" id="5025986">printer</span><span class="op" id="5025993">)</span>&nbsp;<span class="builtinfunc" id="5025995">print</span><span class="op" id="5026000">(</span><span class="ident" id="5026001">x</span>&nbsp;<span class="ident" id="5026003">reflect</span><span class="op" id="5026010">.</span><span class="ident" id="5026011">Value</span><span class="op" id="5026016">)</span>&nbsp;<span class="op" id="5026018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026021">if</span>&nbsp;<span class="op" id="5026024">!</span><span class="ident" id="5026025">NotNilFilter</span><span class="op" id="5026037">(</span><span class="string" id="5026038">&#34;&#34;</span><span class="op" id="5026040">,</span>&nbsp;<span class="ident" id="5026042">x</span><span class="op" id="5026043">)</span>&nbsp;<span class="op" id="5026045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026049">p</span><span class="op" id="5026050">.</span><span class="ident" id="5026051">printf</span><span class="op" id="5026057">(</span><span class="string" id="5026058">&#34;nil&#34;</span><span class="op" id="5026063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026067">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026075">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026079">switch</span>&nbsp;<span class="ident" id="5026086">x</span><span class="op" id="5026087">.</span><span class="ident" id="5026088">Kind</span><span class="op" id="5026092">(</span><span class="op" id="5026093">)</span>&nbsp;<span class="op" id="5026095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026098">case</span>&nbsp;<span class="ident" id="5026103">reflect</span><span class="op" id="5026110">.</span><span class="ident" id="5026111">Interface</span><span class="op" id="5026120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026124">p</span><span class="op" id="5026125">.</span><span class="builtinfunc" id="5026126">print</span><span class="op" id="5026131">(</span><span class="ident" id="5026132">x</span><span class="op" id="5026133">.</span><span class="ident" id="5026134">Elem</span><span class="op" id="5026138">(</span><span class="op" id="5026139">)</span><span class="op" id="5026140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026144">case</span>&nbsp;<span class="ident" id="5026149">reflect</span><span class="op" id="5026156">.</span><span class="ident" id="5026157">Map</span><span class="op" id="5026160">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026164">p</span><span class="op" id="5026165">.</span><span class="ident" id="5026166">printf</span><span class="op" id="5026172">(</span><span class="string" id="5026173">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="5026190">,</span>&nbsp;<span class="ident" id="5026192">x</span><span class="op" id="5026193">.</span><span class="ident" id="5026194">Type</span><span class="op" id="5026198">(</span><span class="op" id="5026199">)</span><span class="op" id="5026200">,</span>&nbsp;<span class="ident" id="5026202">x</span><span class="op" id="5026203">.</span><span class="ident" id="5026204">Len</span><span class="op" id="5026207">(</span><span class="op" id="5026208">)</span><span class="op" id="5026209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026213">if</span>&nbsp;<span class="ident" id="5026216">x</span><span class="op" id="5026217">.</span><span class="ident" id="5026218">Len</span><span class="op" id="5026221">(</span><span class="op" id="5026222">)</span>&nbsp;<span class="op" id="5026224">&gt;</span>&nbsp;<span class="num" id="5026226">0</span>&nbsp;<span class="op" id="5026228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026233">p</span><span class="op" id="5026234">.</span><span class="ident" id="5026235">indent</span><span class="op" id="5026241">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026247">p</span><span class="op" id="5026248">.</span><span class="ident" id="5026249">printf</span><span class="op" id="5026255">(</span><span class="string" id="5026256">&#34;\n&#34;</span><span class="op" id="5026260">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026265">for</span>&nbsp;<span class="ident" id="5026269">_</span><span class="op" id="5026270">,</span>&nbsp;<span class="ident" id="5026272">key</span>&nbsp;<span class="op" id="5026276">:=</span>&nbsp;<span class="keyword" id="5026279">range</span>&nbsp;<span class="ident" id="5026285">x</span><span class="op" id="5026286">.</span><span class="ident" id="5026287">MapKeys</span><span class="op" id="5026294">(</span><span class="op" id="5026295">)</span>&nbsp;<span class="op" id="5026297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026303">p</span><span class="op" id="5026304">.</span><span class="builtinfunc" id="5026305">print</span><span class="op" id="5026310">(</span><span class="ident" id="5026311">key</span><span class="op" id="5026314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026320">p</span><span class="op" id="5026321">.</span><span class="ident" id="5026322">printf</span><span class="op" id="5026328">(</span><span class="string" id="5026329">&#34;:&nbsp;&#34;</span><span class="op" id="5026333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026339">p</span><span class="op" id="5026340">.</span><span class="builtinfunc" id="5026341">print</span><span class="op" id="5026346">(</span><span class="ident" id="5026347">x</span><span class="op" id="5026348">.</span><span class="ident" id="5026349">MapIndex</span><span class="op" id="5026357">(</span><span class="ident" id="5026358">key</span><span class="op" id="5026361">)</span><span class="op" id="5026362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026368">p</span><span class="op" id="5026369">.</span><span class="ident" id="5026370">printf</span><span class="op" id="5026376">(</span><span class="string" id="5026377">&#34;\n&#34;</span><span class="op" id="5026381">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026391">p</span><span class="op" id="5026392">.</span><span class="ident" id="5026393">indent</span><span class="op" id="5026399">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026408">p</span><span class="op" id="5026409">.</span><span class="ident" id="5026410">printf</span><span class="op" id="5026416">(</span><span class="string" id="5026417">&#34;}&#34;</span><span class="op" id="5026420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026424">case</span>&nbsp;<span class="ident" id="5026429">reflect</span><span class="op" id="5026436">.</span><span class="ident" id="5026437">Ptr</span><span class="op" id="5026440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026444">p</span><span class="op" id="5026445">.</span><span class="ident" id="5026446">printf</span><span class="op" id="5026452">(</span><span class="string" id="5026453">&#34;*&#34;</span><span class="op" id="5026456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026460">//&nbsp;type-checked&nbsp;ASTs&nbsp;may&nbsp;contain&nbsp;cycles&nbsp;-&nbsp;use&nbsp;ptrmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026515">//&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;objects&nbsp;that&nbsp;have&nbsp;been&nbsp;printed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5026568">//&nbsp;already&nbsp;and&nbsp;print&nbsp;the&nbsp;respective&nbsp;line&nbsp;number&nbsp;instead</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026626">ptr</span>&nbsp;<span class="op" id="5026630">:=</span>&nbsp;<span class="ident" id="5026633">x</span><span class="op" id="5026634">.</span><span class="ident" id="5026635">Interface</span><span class="op" id="5026644">(</span><span class="op" id="5026645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026649">if</span>&nbsp;<span class="ident" id="5026652">line</span><span class="op" id="5026656">,</span>&nbsp;<span class="ident" id="5026658">exists</span>&nbsp;<span class="op" id="5026665">:=</span>&nbsp;<span class="ident" id="5026668">p</span><span class="op" id="5026669">.</span><span class="ident" id="5026670">ptrmap</span><span class="op" id="5026676">[</span><span class="ident" id="5026677">ptr</span><span class="op" id="5026680">]</span><span class="op" id="5026681">;</span>&nbsp;<span class="ident" id="5026683">exists</span>&nbsp;<span class="op" id="5026690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026695">p</span><span class="op" id="5026696">.</span><span class="ident" id="5026697">printf</span><span class="op" id="5026703">(</span><span class="string" id="5026704">&#34;(obj&nbsp;@&nbsp;%d)&#34;</span><span class="op" id="5026716">,</span>&nbsp;<span class="ident" id="5026718">line</span><span class="op" id="5026722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026726">}</span>&nbsp;<span class="keyword" id="5026728">else</span>&nbsp;<span class="op" id="5026733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026738">p</span><span class="op" id="5026739">.</span><span class="ident" id="5026740">ptrmap</span><span class="op" id="5026746">[</span><span class="ident" id="5026747">ptr</span><span class="op" id="5026750">]</span>&nbsp;<span class="op" id="5026752">=</span>&nbsp;<span class="ident" id="5026754">p</span><span class="op" id="5026755">.</span><span class="ident" id="5026756">line</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026764">p</span><span class="op" id="5026765">.</span><span class="builtinfunc" id="5026766">print</span><span class="op" id="5026771">(</span><span class="ident" id="5026772">x</span><span class="op" id="5026773">.</span><span class="ident" id="5026774">Elem</span><span class="op" id="5026778">(</span><span class="op" id="5026779">)</span><span class="op" id="5026780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026788">case</span>&nbsp;<span class="ident" id="5026793">reflect</span><span class="op" id="5026800">.</span><span class="ident" id="5026801">Array</span><span class="op" id="5026806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026810">p</span><span class="op" id="5026811">.</span><span class="ident" id="5026812">printf</span><span class="op" id="5026818">(</span><span class="string" id="5026819">&#34;%s&nbsp;{&#34;</span><span class="op" id="5026825">,</span>&nbsp;<span class="ident" id="5026827">x</span><span class="op" id="5026828">.</span><span class="ident" id="5026829">Type</span><span class="op" id="5026833">(</span><span class="op" id="5026834">)</span><span class="op" id="5026835">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026839">if</span>&nbsp;<span class="ident" id="5026842">x</span><span class="op" id="5026843">.</span><span class="ident" id="5026844">Len</span><span class="op" id="5026847">(</span><span class="op" id="5026848">)</span>&nbsp;<span class="op" id="5026850">&gt;</span>&nbsp;<span class="num" id="5026852">0</span>&nbsp;<span class="op" id="5026854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026859">p</span><span class="op" id="5026860">.</span><span class="ident" id="5026861">indent</span><span class="op" id="5026867">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026873">p</span><span class="op" id="5026874">.</span><span class="ident" id="5026875">printf</span><span class="op" id="5026881">(</span><span class="string" id="5026882">&#34;\n&#34;</span><span class="op" id="5026886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5026891">for</span>&nbsp;<span class="ident" id="5026895">i</span><span class="op" id="5026896">,</span>&nbsp;<span class="ident" id="5026898">n</span>&nbsp;<span class="op" id="5026900">:=</span>&nbsp;<span class="num" id="5026903">0</span><span class="op" id="5026904">,</span>&nbsp;<span class="ident" id="5026906">x</span><span class="op" id="5026907">.</span><span class="ident" id="5026908">Len</span><span class="op" id="5026911">(</span><span class="op" id="5026912">)</span><span class="op" id="5026913">;</span>&nbsp;<span class="ident" id="5026915">i</span>&nbsp;<span class="op" id="5026917">&lt;</span>&nbsp;<span class="ident" id="5026919">n</span><span class="op" id="5026920">;</span>&nbsp;<span class="ident" id="5026922">i</span><span class="op" id="5026923">++</span>&nbsp;<span class="op" id="5026926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026932">p</span><span class="op" id="5026933">.</span><span class="ident" id="5026934">printf</span><span class="op" id="5026940">(</span><span class="string" id="5026941">&#34;%d:&nbsp;&#34;</span><span class="op" id="5026947">,</span>&nbsp;<span class="ident" id="5026949">i</span><span class="op" id="5026950">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026956">p</span><span class="op" id="5026957">.</span><span class="builtinfunc" id="5026958">print</span><span class="op" id="5026963">(</span><span class="ident" id="5026964">x</span><span class="op" id="5026965">.</span><span class="ident" id="5026966">Index</span><span class="op" id="5026971">(</span><span class="ident" id="5026972">i</span><span class="op" id="5026973">)</span><span class="op" id="5026974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5026980">p</span><span class="op" id="5026981">.</span><span class="ident" id="5026982">printf</span><span class="op" id="5026988">(</span><span class="string" id="5026989">&#34;\n&#34;</span><span class="op" id="5026993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5026998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027003">p</span><span class="op" id="5027004">.</span><span class="ident" id="5027005">indent</span><span class="op" id="5027011">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027016">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027020">p</span><span class="op" id="5027021">.</span><span class="ident" id="5027022">printf</span><span class="op" id="5027028">(</span><span class="string" id="5027029">&#34;}&#34;</span><span class="op" id="5027032">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027036">case</span>&nbsp;<span class="ident" id="5027041">reflect</span><span class="op" id="5027048">.</span><span class="ident" id="5027049">Slice</span><span class="op" id="5027054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027058">if</span>&nbsp;<span class="ident" id="5027061">s</span><span class="op" id="5027062">,</span>&nbsp;<span class="ident" id="5027064">ok</span>&nbsp;<span class="op" id="5027067">:=</span>&nbsp;<span class="ident" id="5027070">x</span><span class="op" id="5027071">.</span><span class="ident" id="5027072">Interface</span><span class="op" id="5027081">(</span><span class="op" id="5027082">)</span><span class="op" id="5027083">.</span><span class="op" id="5027084">(</span><span class="op" id="5027085">[</span><span class="op" id="5027086">]</span><span class="builtintype" id="5027087">byte</span><span class="op" id="5027091">)</span><span class="op" id="5027092">;</span>&nbsp;<span class="ident" id="5027094">ok</span>&nbsp;<span class="op" id="5027097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027102">p</span><span class="op" id="5027103">.</span><span class="ident" id="5027104">printf</span><span class="op" id="5027110">(</span><span class="string" id="5027111">&#34;%#q&#34;</span><span class="op" id="5027116">,</span>&nbsp;<span class="ident" id="5027118">s</span><span class="op" id="5027119">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027124">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027137">p</span><span class="op" id="5027138">.</span><span class="ident" id="5027139">printf</span><span class="op" id="5027145">(</span><span class="string" id="5027146">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="5027163">,</span>&nbsp;<span class="ident" id="5027165">x</span><span class="op" id="5027166">.</span><span class="ident" id="5027167">Type</span><span class="op" id="5027171">(</span><span class="op" id="5027172">)</span><span class="op" id="5027173">,</span>&nbsp;<span class="ident" id="5027175">x</span><span class="op" id="5027176">.</span><span class="ident" id="5027177">Len</span><span class="op" id="5027180">(</span><span class="op" id="5027181">)</span><span class="op" id="5027182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027186">if</span>&nbsp;<span class="ident" id="5027189">x</span><span class="op" id="5027190">.</span><span class="ident" id="5027191">Len</span><span class="op" id="5027194">(</span><span class="op" id="5027195">)</span>&nbsp;<span class="op" id="5027197">&gt;</span>&nbsp;<span class="num" id="5027199">0</span>&nbsp;<span class="op" id="5027201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027206">p</span><span class="op" id="5027207">.</span><span class="ident" id="5027208">indent</span><span class="op" id="5027214">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027220">p</span><span class="op" id="5027221">.</span><span class="ident" id="5027222">printf</span><span class="op" id="5027228">(</span><span class="string" id="5027229">&#34;\n&#34;</span><span class="op" id="5027233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027238">for</span>&nbsp;<span class="ident" id="5027242">i</span><span class="op" id="5027243">,</span>&nbsp;<span class="ident" id="5027245">n</span>&nbsp;<span class="op" id="5027247">:=</span>&nbsp;<span class="num" id="5027250">0</span><span class="op" id="5027251">,</span>&nbsp;<span class="ident" id="5027253">x</span><span class="op" id="5027254">.</span><span class="ident" id="5027255">Len</span><span class="op" id="5027258">(</span><span class="op" id="5027259">)</span><span class="op" id="5027260">;</span>&nbsp;<span class="ident" id="5027262">i</span>&nbsp;<span class="op" id="5027264">&lt;</span>&nbsp;<span class="ident" id="5027266">n</span><span class="op" id="5027267">;</span>&nbsp;<span class="ident" id="5027269">i</span><span class="op" id="5027270">++</span>&nbsp;<span class="op" id="5027273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027279">p</span><span class="op" id="5027280">.</span><span class="ident" id="5027281">printf</span><span class="op" id="5027287">(</span><span class="string" id="5027288">&#34;%d:&nbsp;&#34;</span><span class="op" id="5027294">,</span>&nbsp;<span class="ident" id="5027296">i</span><span class="op" id="5027297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027303">p</span><span class="op" id="5027304">.</span><span class="builtinfunc" id="5027305">print</span><span class="op" id="5027310">(</span><span class="ident" id="5027311">x</span><span class="op" id="5027312">.</span><span class="ident" id="5027313">Index</span><span class="op" id="5027318">(</span><span class="ident" id="5027319">i</span><span class="op" id="5027320">)</span><span class="op" id="5027321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027327">p</span><span class="op" id="5027328">.</span><span class="ident" id="5027329">printf</span><span class="op" id="5027335">(</span><span class="string" id="5027336">&#34;\n&#34;</span><span class="op" id="5027340">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027350">p</span><span class="op" id="5027351">.</span><span class="ident" id="5027352">indent</span><span class="op" id="5027358">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027367">p</span><span class="op" id="5027368">.</span><span class="ident" id="5027369">printf</span><span class="op" id="5027375">(</span><span class="string" id="5027376">&#34;}&#34;</span><span class="op" id="5027379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027383">case</span>&nbsp;<span class="ident" id="5027388">reflect</span><span class="op" id="5027395">.</span><span class="ident" id="5027396">Struct</span><span class="op" id="5027402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027406">t</span>&nbsp;<span class="op" id="5027408">:=</span>&nbsp;<span class="ident" id="5027411">x</span><span class="op" id="5027412">.</span><span class="ident" id="5027413">Type</span><span class="op" id="5027417">(</span><span class="op" id="5027418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027422">p</span><span class="op" id="5027423">.</span><span class="ident" id="5027424">printf</span><span class="op" id="5027430">(</span><span class="string" id="5027431">&#34;%s&nbsp;{&#34;</span><span class="op" id="5027437">,</span>&nbsp;<span class="ident" id="5027439">t</span><span class="op" id="5027440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027444">p</span><span class="op" id="5027445">.</span><span class="ident" id="5027446">indent</span><span class="op" id="5027452">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027457">first</span>&nbsp;<span class="op" id="5027463">:=</span>&nbsp;<span class="ident" id="5027466">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027473">for</span>&nbsp;<span class="ident" id="5027477">i</span><span class="op" id="5027478">,</span>&nbsp;<span class="ident" id="5027480">n</span>&nbsp;<span class="op" id="5027482">:=</span>&nbsp;<span class="num" id="5027485">0</span><span class="op" id="5027486">,</span>&nbsp;<span class="ident" id="5027488">t</span><span class="op" id="5027489">.</span><span class="ident" id="5027490">NumField</span><span class="op" id="5027498">(</span><span class="op" id="5027499">)</span><span class="op" id="5027500">;</span>&nbsp;<span class="ident" id="5027502">i</span>&nbsp;<span class="op" id="5027504">&lt;</span>&nbsp;<span class="ident" id="5027506">n</span><span class="op" id="5027507">;</span>&nbsp;<span class="ident" id="5027509">i</span><span class="op" id="5027510">++</span>&nbsp;<span class="op" id="5027513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027518">//&nbsp;exclude&nbsp;non-exported&nbsp;fields&nbsp;because&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027566">//&nbsp;values&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;via&nbsp;reflection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027613">if</span>&nbsp;<span class="ident" id="5027616">name</span>&nbsp;<span class="op" id="5027621">:=</span>&nbsp;<span class="ident" id="5027624">t</span><span class="op" id="5027625">.</span><span class="ident" id="5027626">Field</span><span class="op" id="5027631">(</span><span class="ident" id="5027632">i</span><span class="op" id="5027633">)</span><span class="op" id="5027634">.</span><span class="ident" id="5027635">Name</span><span class="op" id="5027639">;</span>&nbsp;<span class="ident" id="5027641">IsExported</span><span class="op" id="5027651">(</span><span class="ident" id="5027652">name</span><span class="op" id="5027656">)</span>&nbsp;<span class="op" id="5027658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027664">value</span>&nbsp;<span class="op" id="5027670">:=</span>&nbsp;<span class="ident" id="5027673">x</span><span class="op" id="5027674">.</span><span class="ident" id="5027675">Field</span><span class="op" id="5027680">(</span><span class="ident" id="5027681">i</span><span class="op" id="5027682">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027688">if</span>&nbsp;<span class="ident" id="5027691">p</span><span class="op" id="5027692">.</span><span class="ident" id="5027693">filter</span>&nbsp;<span class="op" id="5027700">==</span>&nbsp;<span class="ident" id="5027703">nil</span>&nbsp;<span class="op" id="5027707">||</span>&nbsp;<span class="ident" id="5027710">p</span><span class="op" id="5027711">.</span><span class="ident" id="5027712">filter</span><span class="op" id="5027718">(</span><span class="ident" id="5027719">name</span><span class="op" id="5027723">,</span>&nbsp;<span class="ident" id="5027725">value</span><span class="op" id="5027730">)</span>&nbsp;<span class="op" id="5027732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027739">if</span>&nbsp;<span class="ident" id="5027742">first</span>&nbsp;<span class="op" id="5027748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027756">p</span><span class="op" id="5027757">.</span><span class="ident" id="5027758">printf</span><span class="op" id="5027764">(</span><span class="string" id="5027765">&#34;\n&#34;</span><span class="op" id="5027769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027777">first</span>&nbsp;<span class="op" id="5027783">=</span>&nbsp;<span class="ident" id="5027785">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027796">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027803">p</span><span class="op" id="5027804">.</span><span class="ident" id="5027805">printf</span><span class="op" id="5027811">(</span><span class="string" id="5027812">&#34;%s:&nbsp;&#34;</span><span class="op" id="5027818">,</span>&nbsp;<span class="ident" id="5027820">name</span><span class="op" id="5027824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027831">p</span><span class="op" id="5027832">.</span><span class="builtinfunc" id="5027833">print</span><span class="op" id="5027838">(</span><span class="ident" id="5027839">value</span><span class="op" id="5027844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027851">p</span><span class="op" id="5027852">.</span><span class="ident" id="5027853">printf</span><span class="op" id="5027859">(</span><span class="string" id="5027860">&#34;\n&#34;</span><span class="op" id="5027864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027875">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5027879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027883">p</span><span class="op" id="5027884">.</span><span class="ident" id="5027885">indent</span><span class="op" id="5027891">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027896">p</span><span class="op" id="5027897">.</span><span class="ident" id="5027898">printf</span><span class="op" id="5027904">(</span><span class="string" id="5027905">&#34;}&#34;</span><span class="op" id="5027908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027912">default</span><span class="op" id="5027919">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5027923">v</span>&nbsp;<span class="op" id="5027925">:=</span>&nbsp;<span class="ident" id="5027928">x</span><span class="op" id="5027929">.</span><span class="ident" id="5027930">Interface</span><span class="op" id="5027939">(</span><span class="op" id="5027940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027944">switch</span>&nbsp;<span class="ident" id="5027951">v</span>&nbsp;<span class="op" id="5027953">:=</span>&nbsp;<span class="ident" id="5027956">v</span><span class="op" id="5027957">.</span><span class="op" id="5027958">(</span><span class="keyword" id="5027959">type</span><span class="op" id="5027963">)</span>&nbsp;<span class="op" id="5027965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5027969">case</span>&nbsp;<span class="builtintype" id="5027974">string</span><span class="op" id="5027980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5027985">//&nbsp;print&nbsp;strings&nbsp;in&nbsp;quotes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028015">p</span><span class="op" id="5028016">.</span><span class="ident" id="5028017">printf</span><span class="op" id="5028023">(</span><span class="string" id="5028024">&#34;%q&#34;</span><span class="op" id="5028028">,</span>&nbsp;<span class="ident" id="5028030">v</span><span class="op" id="5028031">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028036">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028045">case</span>&nbsp;<span class="ident" id="5028050">token</span><span class="op" id="5028055">.</span><span class="ident" id="5028056">Pos</span><span class="op" id="5028059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028064">//&nbsp;position&nbsp;values&nbsp;can&nbsp;be&nbsp;printed&nbsp;nicely&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028130">if</span>&nbsp;<span class="ident" id="5028133">p</span><span class="op" id="5028134">.</span><span class="ident" id="5028135">fset</span>&nbsp;<span class="op" id="5028140">!=</span>&nbsp;<span class="ident" id="5028143">nil</span>&nbsp;<span class="op" id="5028147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028153">p</span><span class="op" id="5028154">.</span><span class="ident" id="5028155">printf</span><span class="op" id="5028161">(</span><span class="string" id="5028162">&#34;%s&#34;</span><span class="op" id="5028166">,</span>&nbsp;<span class="ident" id="5028168">p</span><span class="op" id="5028169">.</span><span class="ident" id="5028170">fset</span><span class="op" id="5028174">.</span><span class="ident" id="5028175">Position</span><span class="op" id="5028183">(</span><span class="ident" id="5028184">v</span><span class="op" id="5028185">)</span><span class="op" id="5028186">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5028192">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5028210">//&nbsp;default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5028223">p</span><span class="op" id="5028224">.</span><span class="ident" id="5028225">printf</span><span class="op" id="5028231">(</span><span class="string" id="5028232">&#34;%v&#34;</span><span class="op" id="5028236">,</span>&nbsp;<span class="ident" id="5028238">v</span><span class="op" id="5028239">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5028242">}</span><br>
<span class="lineno"></span><span class="op" id="5028244">}</span>
</div>
</body>
</html>
