<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3565103">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3565158">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3565212">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3565263">package</span>&nbsp;<span class="ident" id="3565271">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3565281">import</span>&nbsp;<span class="op" id="3565288">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3565291">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3565300">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3565310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3565313">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="3565392">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3565470">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="3565548">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3565558">var</span>&nbsp;<span class="ident" id="3565562">transitionFunc</span>&nbsp;<span class="op" id="3565577">=</span>&nbsp;<span class="op" id="3565579">[</span><span class="op" id="3565580">...</span><span class="op" id="3565583">]</span><span class="keyword" id="3565584">func</span><span class="op" id="3565588">(</span><span class="ident" id="3565589">context</span><span class="op" id="3565596">,</span>&nbsp;<span class="op" id="3565598">[</span><span class="op" id="3565599">]</span><span class="builtintype" id="3565600">byte</span><span class="op" id="3565604">)</span>&nbsp;<span class="op" id="3565606">(</span><span class="ident" id="3565607">context</span><span class="op" id="3565614">,</span>&nbsp;<span class="builtintype" id="3565616">int</span><span class="op" id="3565619">)</span><span class="op" id="3565620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565623">stateText</span><span class="op" id="3565632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565641">tText</span><span class="op" id="3565646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565649">stateTag</span><span class="op" id="3565657">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565667">tTag</span><span class="op" id="3565671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565674">stateAttrName</span><span class="op" id="3565687">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565692">tAttrName</span><span class="op" id="3565701">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565704">stateAfterName</span><span class="op" id="3565718">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3565722">tAfterName</span><span class="op" id="3565732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565735">stateBeforeValue</span><span class="op" id="3565751">:</span>&nbsp;<span class="ident" id="3565753">tBeforeValue</span><span class="op" id="3565765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565768">stateHTMLCmt</span><span class="op" id="3565780">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565786">tHTMLCmt</span><span class="op" id="3565794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565797">stateRCDATA</span><span class="op" id="3565808">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565815">tSpecialTagEnd</span><span class="op" id="3565829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565832">stateAttr</span><span class="op" id="3565841">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565850">tAttr</span><span class="op" id="3565855">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565858">stateURL</span><span class="op" id="3565866">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565876">tURL</span><span class="op" id="3565880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565883">stateJS</span><span class="op" id="3565890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565901">tJS</span><span class="op" id="3565904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565907">stateJSDqStr</span><span class="op" id="3565919">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565925">tJSDelimited</span><span class="op" id="3565937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565940">stateJSSqStr</span><span class="op" id="3565952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565958">tJSDelimited</span><span class="op" id="3565970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3565973">stateJSRegexp</span><span class="op" id="3565986">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3565991">tJSDelimited</span><span class="op" id="3566003">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566006">stateJSBlockCmt</span><span class="op" id="3566021">:</span>&nbsp;&nbsp;<span class="ident" id="3566024">tBlockCmt</span><span class="op" id="3566033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566036">stateJSLineCmt</span><span class="op" id="3566050">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3566054">tLineCmt</span><span class="op" id="3566062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566065">stateCSS</span><span class="op" id="3566073">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566083">tCSS</span><span class="op" id="3566087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566090">stateCSSDqStr</span><span class="op" id="3566103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566108">tCSSStr</span><span class="op" id="3566115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566118">stateCSSSqStr</span><span class="op" id="3566131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566136">tCSSStr</span><span class="op" id="3566143">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566146">stateCSSDqURL</span><span class="op" id="3566159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566164">tCSSStr</span><span class="op" id="3566171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566174">stateCSSSqURL</span><span class="op" id="3566187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566192">tCSSStr</span><span class="op" id="3566199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566202">stateCSSURL</span><span class="op" id="3566213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566220">tCSSStr</span><span class="op" id="3566227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566230">stateCSSBlockCmt</span><span class="op" id="3566246">:</span>&nbsp;<span class="ident" id="3566248">tBlockCmt</span><span class="op" id="3566257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566260">stateCSSLineCmt</span><span class="op" id="3566275">:</span>&nbsp;&nbsp;<span class="ident" id="3566278">tLineCmt</span><span class="op" id="3566286">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566289">stateError</span><span class="op" id="3566299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3566307">tError</span><span class="op" id="3566313">,</span><br>
<span class="lineno"></span><span class="op" id="3566315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3566318">var</span>&nbsp;<span class="ident" id="3566322">commentStart</span>&nbsp;<span class="op" id="3566335">=</span>&nbsp;<span class="op" id="3566337">[</span><span class="op" id="3566338">]</span><span class="builtintype" id="3566339">byte</span><span class="op" id="3566343">(</span><span class="string" id="3566344">&#34;&lt;!--&#34;</span><span class="op" id="3566350">)</span><br>
<span class="lineno"></span><span class="keyword" id="3566352">var</span>&nbsp;<span class="ident" id="3566356">commentEnd</span>&nbsp;<span class="op" id="3566367">=</span>&nbsp;<span class="op" id="3566369">[</span><span class="op" id="3566370">]</span><span class="builtintype" id="3566371">byte</span><span class="op" id="3566375">(</span><span class="string" id="3566376">&#34;--&gt;&#34;</span><span class="op" id="3566381">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3566384">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3566448">func</span>&nbsp;<span class="ident" id="3566453">tText</span><span class="op" id="3566458">(</span><span class="ident" id="3566459">c</span>&nbsp;<span class="ident" id="3566461">context</span><span class="op" id="3566468">,</span>&nbsp;<span class="ident" id="3566470">s</span>&nbsp;<span class="op" id="3566472">[</span><span class="op" id="3566473">]</span><span class="builtintype" id="3566474">byte</span><span class="op" id="3566478">)</span>&nbsp;<span class="op" id="3566480">(</span><span class="ident" id="3566481">context</span><span class="op" id="3566488">,</span>&nbsp;<span class="builtintype" id="3566490">int</span><span class="op" id="3566493">)</span>&nbsp;<span class="op" id="3566495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566498">k</span>&nbsp;<span class="op" id="3566500">:=</span>&nbsp;<span class="num" id="3566503">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566506">for</span>&nbsp;<span class="op" id="3566510">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566514">i</span>&nbsp;<span class="op" id="3566516">:=</span>&nbsp;<span class="ident" id="3566519">k</span>&nbsp;<span class="op" id="3566521">+</span>&nbsp;<span class="ident" id="3566523">bytes</span><span class="op" id="3566528">.</span><span class="ident" id="3566529">IndexByte</span><span class="op" id="3566538">(</span><span class="ident" id="3566539">s</span><span class="op" id="3566540">[</span><span class="ident" id="3566541">k</span><span class="op" id="3566542">:</span><span class="op" id="3566543">]</span><span class="op" id="3566544">,</span>&nbsp;<span class="string" id="3566546">&#39;&lt;&#39;</span><span class="op" id="3566549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566553">if</span>&nbsp;<span class="ident" id="3566556">i</span>&nbsp;<span class="op" id="3566558">&lt;</span>&nbsp;<span class="ident" id="3566560">k</span>&nbsp;<span class="op" id="3566562">||</span>&nbsp;<span class="ident" id="3566565">i</span><span class="op" id="3566566">+</span><span class="num" id="3566567">1</span>&nbsp;<span class="op" id="3566569">==</span>&nbsp;<span class="builtinfunc" id="3566572">len</span><span class="op" id="3566575">(</span><span class="ident" id="3566576">s</span><span class="op" id="3566577">)</span>&nbsp;<span class="op" id="3566579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566584">return</span>&nbsp;<span class="ident" id="3566591">c</span><span class="op" id="3566592">,</span>&nbsp;<span class="builtinfunc" id="3566594">len</span><span class="op" id="3566597">(</span><span class="ident" id="3566598">s</span><span class="op" id="3566599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566603">}</span>&nbsp;<span class="keyword" id="3566605">else</span>&nbsp;<span class="keyword" id="3566610">if</span>&nbsp;<span class="ident" id="3566613">i</span><span class="op" id="3566614">+</span><span class="num" id="3566615">4</span>&nbsp;<span class="op" id="3566617">&lt;=</span>&nbsp;<span class="builtinfunc" id="3566620">len</span><span class="op" id="3566623">(</span><span class="ident" id="3566624">s</span><span class="op" id="3566625">)</span>&nbsp;<span class="op" id="3566627">&amp;&amp;</span>&nbsp;<span class="ident" id="3566630">bytes</span><span class="op" id="3566635">.</span><span class="ident" id="3566636">Equal</span><span class="op" id="3566641">(</span><span class="ident" id="3566642">commentStart</span><span class="op" id="3566654">,</span>&nbsp;<span class="ident" id="3566656">s</span><span class="op" id="3566657">[</span><span class="ident" id="3566658">i</span><span class="op" id="3566659">:</span><span class="ident" id="3566660">i</span><span class="op" id="3566661">+</span><span class="num" id="3566662">4</span><span class="op" id="3566663">]</span><span class="op" id="3566664">)</span>&nbsp;<span class="op" id="3566666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566671">return</span>&nbsp;<span class="ident" id="3566678">context</span><span class="op" id="3566685">{</span><span class="ident" id="3566686">state</span><span class="op" id="3566691">:</span>&nbsp;<span class="ident" id="3566693">stateHTMLCmt</span><span class="op" id="3566705">}</span><span class="op" id="3566706">,</span>&nbsp;<span class="ident" id="3566708">i</span>&nbsp;<span class="op" id="3566710">+</span>&nbsp;<span class="num" id="3566712">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566720">i</span><span class="op" id="3566721">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566726">end</span>&nbsp;<span class="op" id="3566730">:=</span>&nbsp;<span class="builtintype" id="3566733">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566741">if</span>&nbsp;<span class="ident" id="3566744">s</span><span class="op" id="3566745">[</span><span class="ident" id="3566746">i</span><span class="op" id="3566747">]</span>&nbsp;<span class="op" id="3566749">==</span>&nbsp;<span class="string" id="3566752">&#39;/&#39;</span>&nbsp;<span class="op" id="3566756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566761">if</span>&nbsp;<span class="ident" id="3566764">i</span><span class="op" id="3566765">+</span><span class="num" id="3566766">1</span>&nbsp;<span class="op" id="3566768">==</span>&nbsp;<span class="builtinfunc" id="3566771">len</span><span class="op" id="3566774">(</span><span class="ident" id="3566775">s</span><span class="op" id="3566776">)</span>&nbsp;<span class="op" id="3566778">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566784">return</span>&nbsp;<span class="ident" id="3566791">c</span><span class="op" id="3566792">,</span>&nbsp;<span class="builtinfunc" id="3566794">len</span><span class="op" id="3566797">(</span><span class="ident" id="3566798">s</span><span class="op" id="3566799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566809">end</span><span class="op" id="3566812">,</span>&nbsp;<span class="ident" id="3566814">i</span>&nbsp;<span class="op" id="3566816">=</span>&nbsp;<span class="builtintype" id="3566818">true</span><span class="op" id="3566822">,</span>&nbsp;<span class="ident" id="3566824">i</span><span class="op" id="3566825">+</span><span class="num" id="3566826">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566834">j</span><span class="op" id="3566835">,</span>&nbsp;<span class="ident" id="3566837">e</span>&nbsp;<span class="op" id="3566839">:=</span>&nbsp;<span class="ident" id="3566842">eatTagName</span><span class="op" id="3566852">(</span><span class="ident" id="3566853">s</span><span class="op" id="3566854">,</span>&nbsp;<span class="ident" id="3566856">i</span><span class="op" id="3566857">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566861">if</span>&nbsp;<span class="ident" id="3566864">j</span>&nbsp;<span class="op" id="3566866">!=</span>&nbsp;<span class="ident" id="3566869">i</span>&nbsp;<span class="op" id="3566871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566876">if</span>&nbsp;<span class="ident" id="3566879">end</span>&nbsp;<span class="op" id="3566883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566889">e</span>&nbsp;<span class="op" id="3566891">=</span>&nbsp;<span class="ident" id="3566893">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3566913">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3566944">return</span>&nbsp;<span class="ident" id="3566951">context</span><span class="op" id="3566958">{</span><span class="ident" id="3566959">state</span><span class="op" id="3566964">:</span>&nbsp;<span class="ident" id="3566966">stateTag</span><span class="op" id="3566974">,</span>&nbsp;<span class="ident" id="3566976">element</span><span class="op" id="3566983">:</span>&nbsp;<span class="ident" id="3566985">e</span><span class="op" id="3566986">}</span><span class="op" id="3566987">,</span>&nbsp;<span class="ident" id="3566989">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3566993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3566997">k</span>&nbsp;<span class="op" id="3566999">=</span>&nbsp;<span class="ident" id="3567001">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567004">}</span><br>
<span class="lineno"></span><span class="op" id="3567006">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="3567009">var</span>&nbsp;<span class="ident" id="3567013">elementContentType</span>&nbsp;<span class="op" id="3567032">=</span>&nbsp;<span class="op" id="3567034">[</span><span class="op" id="3567035">...</span><span class="op" id="3567038">]</span><span class="ident" id="3567039">state</span><span class="op" id="3567044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567047">elementNone</span><span class="op" id="3567058">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3567064">stateText</span><span class="op" id="3567073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567076">elementScript</span><span class="op" id="3567089">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3567093">stateJS</span><span class="op" id="3567100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567103">elementStyle</span><span class="op" id="3567115">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3567120">stateCSS</span><span class="op" id="3567128">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567131">elementTextarea</span><span class="op" id="3567146">:</span>&nbsp;<span class="ident" id="3567148">stateRCDATA</span><span class="op" id="3567159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567162">elementTitle</span><span class="op" id="3567174">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3567179">stateRCDATA</span><span class="op" id="3567190">,</span><br>
<span class="lineno"></span><span class="op" id="3567192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3567195">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="3567257">func</span>&nbsp;<span class="ident" id="3567262">tTag</span><span class="op" id="3567266">(</span><span class="ident" id="3567267">c</span>&nbsp;<span class="ident" id="3567269">context</span><span class="op" id="3567276">,</span>&nbsp;<span class="ident" id="3567278">s</span>&nbsp;<span class="op" id="3567280">[</span><span class="op" id="3567281">]</span><span class="builtintype" id="3567282">byte</span><span class="op" id="3567286">)</span>&nbsp;<span class="op" id="3567288">(</span><span class="ident" id="3567289">context</span><span class="op" id="3567296">,</span>&nbsp;<span class="builtintype" id="3567298">int</span><span class="op" id="3567301">)</span>&nbsp;<span class="op" id="3567303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3567306">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567335">i</span>&nbsp;<span class="op" id="3567337">:=</span>&nbsp;<span class="ident" id="3567340">eatWhiteSpace</span><span class="op" id="3567353">(</span><span class="ident" id="3567354">s</span><span class="op" id="3567355">,</span>&nbsp;<span class="num" id="3567357">0</span><span class="op" id="3567358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567361">if</span>&nbsp;<span class="ident" id="3567364">i</span>&nbsp;<span class="op" id="3567366">==</span>&nbsp;<span class="builtinfunc" id="3567369">len</span><span class="op" id="3567372">(</span><span class="ident" id="3567373">s</span><span class="op" id="3567374">)</span>&nbsp;<span class="op" id="3567376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567380">return</span>&nbsp;<span class="ident" id="3567387">c</span><span class="op" id="3567388">,</span>&nbsp;<span class="builtinfunc" id="3567390">len</span><span class="op" id="3567393">(</span><span class="ident" id="3567394">s</span><span class="op" id="3567395">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567401">if</span>&nbsp;<span class="ident" id="3567404">s</span><span class="op" id="3567405">[</span><span class="ident" id="3567406">i</span><span class="op" id="3567407">]</span>&nbsp;<span class="op" id="3567409">==</span>&nbsp;<span class="string" id="3567412">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3567416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567420">return</span>&nbsp;<span class="ident" id="3567427">context</span><span class="op" id="3567434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567439">state</span><span class="op" id="3567444">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3567448">elementContentType</span><span class="op" id="3567466">[</span><span class="ident" id="3567467">c</span><span class="op" id="3567468">.</span><span class="ident" id="3567469">element</span><span class="op" id="3567476">]</span><span class="op" id="3567477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567482">element</span><span class="op" id="3567489">:</span>&nbsp;<span class="ident" id="3567491">c</span><span class="op" id="3567492">.</span><span class="ident" id="3567493">element</span><span class="op" id="3567500">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567504">}</span><span class="op" id="3567505">,</span>&nbsp;<span class="ident" id="3567507">i</span>&nbsp;<span class="op" id="3567509">+</span>&nbsp;<span class="num" id="3567511">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567517">j</span><span class="op" id="3567518">,</span>&nbsp;<span class="ident" id="3567520">err</span>&nbsp;<span class="op" id="3567524">:=</span>&nbsp;<span class="ident" id="3567527">eatAttrName</span><span class="op" id="3567538">(</span><span class="ident" id="3567539">s</span><span class="op" id="3567540">,</span>&nbsp;<span class="ident" id="3567542">i</span><span class="op" id="3567543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567546">if</span>&nbsp;<span class="ident" id="3567549">err</span>&nbsp;<span class="op" id="3567553">!=</span>&nbsp;<span class="ident" id="3567556">nil</span>&nbsp;<span class="op" id="3567560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567564">return</span>&nbsp;<span class="ident" id="3567571">context</span><span class="op" id="3567578">{</span><span class="ident" id="3567579">state</span><span class="op" id="3567584">:</span>&nbsp;<span class="ident" id="3567586">stateError</span><span class="op" id="3567596">,</span>&nbsp;<span class="ident" id="3567598">err</span><span class="op" id="3567601">:</span>&nbsp;<span class="ident" id="3567603">err</span><span class="op" id="3567606">}</span><span class="op" id="3567607">,</span>&nbsp;<span class="builtinfunc" id="3567609">len</span><span class="op" id="3567612">(</span><span class="ident" id="3567613">s</span><span class="op" id="3567614">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567620">state</span><span class="op" id="3567625">,</span>&nbsp;<span class="ident" id="3567627">attr</span>&nbsp;<span class="op" id="3567632">:=</span>&nbsp;<span class="ident" id="3567635">stateTag</span><span class="op" id="3567643">,</span>&nbsp;<span class="ident" id="3567645">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567655">if</span>&nbsp;<span class="ident" id="3567658">i</span>&nbsp;<span class="op" id="3567660">==</span>&nbsp;<span class="ident" id="3567663">j</span>&nbsp;<span class="op" id="3567665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567669">return</span>&nbsp;<span class="ident" id="3567676">context</span><span class="op" id="3567683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567688">state</span><span class="op" id="3567693">:</span>&nbsp;<span class="ident" id="3567695">stateError</span><span class="op" id="3567705">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567710">err</span><span class="op" id="3567713">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3567717">errorf</span><span class="op" id="3567723">(</span><span class="ident" id="3567724">ErrBadHTML</span><span class="op" id="3567734">,</span>&nbsp;<span class="ident" id="3567736">nil</span><span class="op" id="3567739">,</span>&nbsp;<span class="num" id="3567741">0</span><span class="op" id="3567742">,</span>&nbsp;<span class="string" id="3567744">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="3567798">,</span>&nbsp;<span class="ident" id="3567800">s</span><span class="op" id="3567801">[</span><span class="ident" id="3567802">i</span><span class="op" id="3567803">:</span><span class="op" id="3567804">]</span><span class="op" id="3567805">)</span><span class="op" id="3567806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567810">}</span><span class="op" id="3567811">,</span>&nbsp;<span class="builtinfunc" id="3567813">len</span><span class="op" id="3567816">(</span><span class="ident" id="3567817">s</span><span class="op" id="3567818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567824">switch</span>&nbsp;<span class="ident" id="3567831">attrType</span><span class="op" id="3567839">(</span><span class="builtintype" id="3567840">string</span><span class="op" id="3567846">(</span><span class="ident" id="3567847">s</span><span class="op" id="3567848">[</span><span class="ident" id="3567849">i</span><span class="op" id="3567850">:</span><span class="ident" id="3567851">j</span><span class="op" id="3567852">]</span><span class="op" id="3567853">)</span><span class="op" id="3567854">)</span>&nbsp;<span class="op" id="3567856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567859">case</span>&nbsp;<span class="ident" id="3567864">contentTypeURL</span><span class="op" id="3567878">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567882">attr</span>&nbsp;<span class="op" id="3567887">=</span>&nbsp;<span class="ident" id="3567889">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567898">case</span>&nbsp;<span class="ident" id="3567903">contentTypeCSS</span><span class="op" id="3567917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567921">attr</span>&nbsp;<span class="op" id="3567926">=</span>&nbsp;<span class="ident" id="3567928">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567939">case</span>&nbsp;<span class="ident" id="3567944">contentTypeJS</span><span class="op" id="3567957">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3567961">attr</span>&nbsp;<span class="op" id="3567966">=</span>&nbsp;<span class="ident" id="3567968">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3567980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3567983">if</span>&nbsp;<span class="ident" id="3567986">j</span>&nbsp;<span class="op" id="3567988">==</span>&nbsp;<span class="builtinfunc" id="3567991">len</span><span class="op" id="3567994">(</span><span class="ident" id="3567995">s</span><span class="op" id="3567996">)</span>&nbsp;<span class="op" id="3567998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568002">state</span>&nbsp;<span class="op" id="3568008">=</span>&nbsp;<span class="ident" id="3568010">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568025">}</span>&nbsp;<span class="keyword" id="3568027">else</span>&nbsp;<span class="op" id="3568032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568036">state</span>&nbsp;<span class="op" id="3568042">=</span>&nbsp;<span class="ident" id="3568044">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568063">return</span>&nbsp;<span class="ident" id="3568070">context</span><span class="op" id="3568077">{</span><span class="ident" id="3568078">state</span><span class="op" id="3568083">:</span>&nbsp;<span class="ident" id="3568085">state</span><span class="op" id="3568090">,</span>&nbsp;<span class="ident" id="3568092">element</span><span class="op" id="3568099">:</span>&nbsp;<span class="ident" id="3568101">c</span><span class="op" id="3568102">.</span><span class="ident" id="3568103">element</span><span class="op" id="3568110">,</span>&nbsp;<span class="ident" id="3568112">attr</span><span class="op" id="3568116">:</span>&nbsp;<span class="ident" id="3568118">attr</span><span class="op" id="3568122">}</span><span class="op" id="3568123">,</span>&nbsp;<span class="ident" id="3568125">j</span><br>
<span class="lineno"></span><span class="op" id="3568127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3568130">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="3568197">func</span>&nbsp;<span class="ident" id="3568202">tAttrName</span><span class="op" id="3568211">(</span><span class="ident" id="3568212">c</span>&nbsp;<span class="ident" id="3568214">context</span><span class="op" id="3568221">,</span>&nbsp;<span class="ident" id="3568223">s</span>&nbsp;<span class="op" id="3568225">[</span><span class="op" id="3568226">]</span><span class="builtintype" id="3568227">byte</span><span class="op" id="3568231">)</span>&nbsp;<span class="op" id="3568233">(</span><span class="ident" id="3568234">context</span><span class="op" id="3568241">,</span>&nbsp;<span class="builtintype" id="3568243">int</span><span class="op" id="3568246">)</span>&nbsp;<span class="op" id="3568248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568251">i</span><span class="op" id="3568252">,</span>&nbsp;<span class="ident" id="3568254">err</span>&nbsp;<span class="op" id="3568258">:=</span>&nbsp;<span class="ident" id="3568261">eatAttrName</span><span class="op" id="3568272">(</span><span class="ident" id="3568273">s</span><span class="op" id="3568274">,</span>&nbsp;<span class="num" id="3568276">0</span><span class="op" id="3568277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568280">if</span>&nbsp;<span class="ident" id="3568283">err</span>&nbsp;<span class="op" id="3568287">!=</span>&nbsp;<span class="ident" id="3568290">nil</span>&nbsp;<span class="op" id="3568294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568298">return</span>&nbsp;<span class="ident" id="3568305">context</span><span class="op" id="3568312">{</span><span class="ident" id="3568313">state</span><span class="op" id="3568318">:</span>&nbsp;<span class="ident" id="3568320">stateError</span><span class="op" id="3568330">,</span>&nbsp;<span class="ident" id="3568332">err</span><span class="op" id="3568335">:</span>&nbsp;<span class="ident" id="3568337">err</span><span class="op" id="3568340">}</span><span class="op" id="3568341">,</span>&nbsp;<span class="builtinfunc" id="3568343">len</span><span class="op" id="3568346">(</span><span class="ident" id="3568347">s</span><span class="op" id="3568348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568351">}</span>&nbsp;<span class="keyword" id="3568353">else</span>&nbsp;<span class="keyword" id="3568358">if</span>&nbsp;<span class="ident" id="3568361">i</span>&nbsp;<span class="op" id="3568363">!=</span>&nbsp;<span class="builtinfunc" id="3568366">len</span><span class="op" id="3568369">(</span><span class="ident" id="3568370">s</span><span class="op" id="3568371">)</span>&nbsp;<span class="op" id="3568373">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568377">c</span><span class="op" id="3568378">.</span><span class="ident" id="3568379">state</span>&nbsp;<span class="op" id="3568385">=</span>&nbsp;<span class="ident" id="3568387">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568406">return</span>&nbsp;<span class="ident" id="3568413">c</span><span class="op" id="3568414">,</span>&nbsp;<span class="ident" id="3568416">i</span><br>
<span class="lineno"></span><span class="op" id="3568418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="3568421">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="3568490">func</span>&nbsp;<span class="ident" id="3568495">tAfterName</span><span class="op" id="3568505">(</span><span class="ident" id="3568506">c</span>&nbsp;<span class="ident" id="3568508">context</span><span class="op" id="3568515">,</span>&nbsp;<span class="ident" id="3568517">s</span>&nbsp;<span class="op" id="3568519">[</span><span class="op" id="3568520">]</span><span class="builtintype" id="3568521">byte</span><span class="op" id="3568525">)</span>&nbsp;<span class="op" id="3568527">(</span><span class="ident" id="3568528">context</span><span class="op" id="3568535">,</span>&nbsp;<span class="builtintype" id="3568537">int</span><span class="op" id="3568540">)</span>&nbsp;<span class="op" id="3568542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568545">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568582">i</span>&nbsp;<span class="op" id="3568584">:=</span>&nbsp;<span class="ident" id="3568587">eatWhiteSpace</span><span class="op" id="3568600">(</span><span class="ident" id="3568601">s</span><span class="op" id="3568602">,</span>&nbsp;<span class="num" id="3568604">0</span><span class="op" id="3568605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568608">if</span>&nbsp;<span class="ident" id="3568611">i</span>&nbsp;<span class="op" id="3568613">==</span>&nbsp;<span class="builtinfunc" id="3568616">len</span><span class="op" id="3568619">(</span><span class="ident" id="3568620">s</span><span class="op" id="3568621">)</span>&nbsp;<span class="op" id="3568623">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568627">return</span>&nbsp;<span class="ident" id="3568634">c</span><span class="op" id="3568635">,</span>&nbsp;<span class="builtinfunc" id="3568637">len</span><span class="op" id="3568640">(</span><span class="ident" id="3568641">s</span><span class="op" id="3568642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568645">}</span>&nbsp;<span class="keyword" id="3568647">else</span>&nbsp;<span class="keyword" id="3568652">if</span>&nbsp;<span class="ident" id="3568655">s</span><span class="op" id="3568656">[</span><span class="ident" id="3568657">i</span><span class="op" id="3568658">]</span>&nbsp;<span class="op" id="3568660">!=</span>&nbsp;<span class="string" id="3568663">&#39;=&#39;</span>&nbsp;<span class="op" id="3568667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568671">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568731">c</span><span class="op" id="3568732">.</span><span class="ident" id="3568733">state</span>&nbsp;<span class="op" id="3568739">=</span>&nbsp;<span class="ident" id="3568741">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568752">return</span>&nbsp;<span class="ident" id="3568759">c</span><span class="op" id="3568760">,</span>&nbsp;<span class="ident" id="3568762">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3568765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568768">c</span><span class="op" id="3568769">.</span><span class="ident" id="3568770">state</span>&nbsp;<span class="op" id="3568776">=</span>&nbsp;<span class="ident" id="3568778">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3568796">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3568817">return</span>&nbsp;<span class="ident" id="3568824">c</span><span class="op" id="3568825">,</span>&nbsp;<span class="ident" id="3568827">i</span>&nbsp;<span class="op" id="3568829">+</span>&nbsp;<span class="num" id="3568831">1</span><br>
<span class="lineno"></span><span class="op" id="3568833">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="3568836">var</span>&nbsp;<span class="ident" id="3568840">attrStartStates</span>&nbsp;<span class="op" id="3568856">=</span>&nbsp;<span class="op" id="3568858">[</span><span class="op" id="3568859">...</span><span class="op" id="3568862">]</span><span class="ident" id="3568863">state</span><span class="op" id="3568868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568871">attrNone</span><span class="op" id="3568879">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3568883">stateAttr</span><span class="op" id="3568892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568895">attrScript</span><span class="op" id="3568905">:</span>&nbsp;<span class="ident" id="3568907">stateJS</span><span class="op" id="3568914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568917">attrStyle</span><span class="op" id="3568926">:</span>&nbsp;&nbsp;<span class="ident" id="3568929">stateCSS</span><span class="op" id="3568937">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3568940">attrURL</span><span class="op" id="3568947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3568952">stateURL</span><span class="op" id="3568960">,</span><br>
<span class="lineno"></span><span class="op" id="3568962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3568965">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="3569038">func</span>&nbsp;<span class="ident" id="3569043">tBeforeValue</span><span class="op" id="3569055">(</span><span class="ident" id="3569056">c</span>&nbsp;<span class="ident" id="3569058">context</span><span class="op" id="3569065">,</span>&nbsp;<span class="ident" id="3569067">s</span>&nbsp;<span class="op" id="3569069">[</span><span class="op" id="3569070">]</span><span class="builtintype" id="3569071">byte</span><span class="op" id="3569075">)</span>&nbsp;<span class="op" id="3569077">(</span><span class="ident" id="3569078">context</span><span class="op" id="3569085">,</span>&nbsp;<span class="builtintype" id="3569087">int</span><span class="op" id="3569090">)</span>&nbsp;<span class="op" id="3569092">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569095">i</span>&nbsp;<span class="op" id="3569097">:=</span>&nbsp;<span class="ident" id="3569100">eatWhiteSpace</span><span class="op" id="3569113">(</span><span class="ident" id="3569114">s</span><span class="op" id="3569115">,</span>&nbsp;<span class="num" id="3569117">0</span><span class="op" id="3569118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569121">if</span>&nbsp;<span class="ident" id="3569124">i</span>&nbsp;<span class="op" id="3569126">==</span>&nbsp;<span class="builtinfunc" id="3569129">len</span><span class="op" id="3569132">(</span><span class="ident" id="3569133">s</span><span class="op" id="3569134">)</span>&nbsp;<span class="op" id="3569136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569140">return</span>&nbsp;<span class="ident" id="3569147">c</span><span class="op" id="3569148">,</span>&nbsp;<span class="builtinfunc" id="3569150">len</span><span class="op" id="3569153">(</span><span class="ident" id="3569154">s</span><span class="op" id="3569155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3569161">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569195">delim</span>&nbsp;<span class="op" id="3569201">:=</span>&nbsp;<span class="ident" id="3569204">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569224">switch</span>&nbsp;<span class="ident" id="3569231">s</span><span class="op" id="3569232">[</span><span class="ident" id="3569233">i</span><span class="op" id="3569234">]</span>&nbsp;<span class="op" id="3569236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569239">case</span>&nbsp;<span class="string" id="3569244">&#39;\&#39;&#39;</span><span class="op" id="3569248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569252">delim</span><span class="op" id="3569257">,</span>&nbsp;<span class="ident" id="3569259">i</span>&nbsp;<span class="op" id="3569261">=</span>&nbsp;<span class="ident" id="3569263">delimSingleQuote</span><span class="op" id="3569279">,</span>&nbsp;<span class="ident" id="3569281">i</span><span class="op" id="3569282">+</span><span class="num" id="3569283">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569286">case</span>&nbsp;<span class="string" id="3569291">&#39;&#34;&#39;</span><span class="op" id="3569294">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569298">delim</span><span class="op" id="3569303">,</span>&nbsp;<span class="ident" id="3569305">i</span>&nbsp;<span class="op" id="3569307">=</span>&nbsp;<span class="ident" id="3569309">delimDoubleQuote</span><span class="op" id="3569325">,</span>&nbsp;<span class="ident" id="3569327">i</span><span class="op" id="3569328">+</span><span class="num" id="3569329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569335">c</span><span class="op" id="3569336">.</span><span class="ident" id="3569337">state</span><span class="op" id="3569342">,</span>&nbsp;<span class="ident" id="3569344">c</span><span class="op" id="3569345">.</span><span class="ident" id="3569346">delim</span><span class="op" id="3569351">,</span>&nbsp;<span class="ident" id="3569353">c</span><span class="op" id="3569354">.</span><span class="ident" id="3569355">attr</span>&nbsp;<span class="op" id="3569360">=</span>&nbsp;<span class="ident" id="3569362">attrStartStates</span><span class="op" id="3569377">[</span><span class="ident" id="3569378">c</span><span class="op" id="3569379">.</span><span class="ident" id="3569380">attr</span><span class="op" id="3569384">]</span><span class="op" id="3569385">,</span>&nbsp;<span class="ident" id="3569387">delim</span><span class="op" id="3569392">,</span>&nbsp;<span class="ident" id="3569394">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569404">return</span>&nbsp;<span class="ident" id="3569411">c</span><span class="op" id="3569412">,</span>&nbsp;<span class="ident" id="3569414">i</span><br>
<span class="lineno"></span><span class="op" id="3569416">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3569419">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="3569484">func</span>&nbsp;<span class="ident" id="3569489">tHTMLCmt</span><span class="op" id="3569497">(</span><span class="ident" id="3569498">c</span>&nbsp;<span class="ident" id="3569500">context</span><span class="op" id="3569507">,</span>&nbsp;<span class="ident" id="3569509">s</span>&nbsp;<span class="op" id="3569511">[</span><span class="op" id="3569512">]</span><span class="builtintype" id="3569513">byte</span><span class="op" id="3569517">)</span>&nbsp;<span class="op" id="3569519">(</span><span class="ident" id="3569520">context</span><span class="op" id="3569527">,</span>&nbsp;<span class="builtintype" id="3569529">int</span><span class="op" id="3569532">)</span>&nbsp;<span class="op" id="3569534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569537">if</span>&nbsp;<span class="ident" id="3569540">i</span>&nbsp;<span class="op" id="3569542">:=</span>&nbsp;<span class="ident" id="3569545">bytes</span><span class="op" id="3569550">.</span><span class="ident" id="3569551">Index</span><span class="op" id="3569556">(</span><span class="ident" id="3569557">s</span><span class="op" id="3569558">,</span>&nbsp;<span class="ident" id="3569560">commentEnd</span><span class="op" id="3569570">)</span><span class="op" id="3569571">;</span>&nbsp;<span class="ident" id="3569573">i</span>&nbsp;<span class="op" id="3569575">!=</span>&nbsp;<span class="op" id="3569578">-</span><span class="num" id="3569579">1</span>&nbsp;<span class="op" id="3569581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569585">return</span>&nbsp;<span class="ident" id="3569592">context</span><span class="op" id="3569599">{</span><span class="op" id="3569600">}</span><span class="op" id="3569601">,</span>&nbsp;<span class="ident" id="3569603">i</span>&nbsp;<span class="op" id="3569605">+</span>&nbsp;<span class="num" id="3569607">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3569610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3569613">return</span>&nbsp;<span class="ident" id="3569620">c</span><span class="op" id="3569621">,</span>&nbsp;<span class="builtinfunc" id="3569623">len</span><span class="op" id="3569626">(</span><span class="ident" id="3569627">s</span><span class="op" id="3569628">)</span><br>
<span class="lineno"></span><span class="op" id="3569630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3569633">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="3569707">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="3569770">var</span>&nbsp;<span class="ident" id="3569774">specialTagEndMarkers</span>&nbsp;<span class="op" id="3569795">=</span>&nbsp;<span class="op" id="3569797">[</span><span class="op" id="3569798">...</span><span class="op" id="3569801">]</span><span class="builtintype" id="3569802">string</span><span class="op" id="3569808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569811">elementScript</span><span class="op" id="3569824">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3569828">&#34;&lt;/script&#34;</span><span class="op" id="3569838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569841">elementStyle</span><span class="op" id="3569853">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3569858">&#34;&lt;/style&#34;</span><span class="op" id="3569867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569870">elementTextarea</span><span class="op" id="3569885">:</span>&nbsp;<span class="string" id="3569887">&#34;&lt;/textarea&#34;</span><span class="op" id="3569899">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3569902">elementTitle</span><span class="op" id="3569914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3569919">&#34;&lt;/title&#34;</span><span class="op" id="3569928">,</span><br>
<span class="lineno"></span><span class="op" id="3569930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3569933">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="3570010">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="3570029">func</span>&nbsp;<span class="ident" id="3570034">tSpecialTagEnd</span><span class="op" id="3570048">(</span><span class="ident" id="3570049">c</span>&nbsp;<span class="ident" id="3570051">context</span><span class="op" id="3570058">,</span>&nbsp;<span class="ident" id="3570060">s</span>&nbsp;<span class="op" id="3570062">[</span><span class="op" id="3570063">]</span><span class="builtintype" id="3570064">byte</span><span class="op" id="3570068">)</span>&nbsp;<span class="op" id="3570070">(</span><span class="ident" id="3570071">context</span><span class="op" id="3570078">,</span>&nbsp;<span class="builtintype" id="3570080">int</span><span class="op" id="3570083">)</span>&nbsp;<span class="op" id="3570085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570088">if</span>&nbsp;<span class="ident" id="3570091">c</span><span class="op" id="3570092">.</span><span class="ident" id="3570093">element</span>&nbsp;<span class="op" id="3570101">!=</span>&nbsp;<span class="ident" id="3570104">elementNone</span>&nbsp;<span class="op" id="3570116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570120">if</span>&nbsp;<span class="ident" id="3570123">i</span>&nbsp;<span class="op" id="3570125">:=</span>&nbsp;<span class="ident" id="3570128">strings</span><span class="op" id="3570135">.</span><span class="ident" id="3570136">Index</span><span class="op" id="3570141">(</span><span class="ident" id="3570142">strings</span><span class="op" id="3570149">.</span><span class="ident" id="3570150">ToLower</span><span class="op" id="3570157">(</span><span class="builtintype" id="3570158">string</span><span class="op" id="3570164">(</span><span class="ident" id="3570165">s</span><span class="op" id="3570166">)</span><span class="op" id="3570167">)</span><span class="op" id="3570168">,</span>&nbsp;<span class="ident" id="3570170">specialTagEndMarkers</span><span class="op" id="3570190">[</span><span class="ident" id="3570191">c</span><span class="op" id="3570192">.</span><span class="ident" id="3570193">element</span><span class="op" id="3570200">]</span><span class="op" id="3570201">)</span><span class="op" id="3570202">;</span>&nbsp;<span class="ident" id="3570204">i</span>&nbsp;<span class="op" id="3570206">!=</span>&nbsp;<span class="op" id="3570209">-</span><span class="num" id="3570210">1</span>&nbsp;<span class="op" id="3570212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570217">return</span>&nbsp;<span class="ident" id="3570224">context</span><span class="op" id="3570231">{</span><span class="op" id="3570232">}</span><span class="op" id="3570233">,</span>&nbsp;<span class="ident" id="3570235">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570239">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570245">return</span>&nbsp;<span class="ident" id="3570252">c</span><span class="op" id="3570253">,</span>&nbsp;<span class="builtinfunc" id="3570255">len</span><span class="op" id="3570258">(</span><span class="ident" id="3570259">s</span><span class="op" id="3570260">)</span><br>
<span class="lineno"></span><span class="op" id="3570262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3570265">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="3570334">func</span>&nbsp;<span class="ident" id="3570339">tAttr</span><span class="op" id="3570344">(</span><span class="ident" id="3570345">c</span>&nbsp;<span class="ident" id="3570347">context</span><span class="op" id="3570354">,</span>&nbsp;<span class="ident" id="3570356">s</span>&nbsp;<span class="op" id="3570358">[</span><span class="op" id="3570359">]</span><span class="builtintype" id="3570360">byte</span><span class="op" id="3570364">)</span>&nbsp;<span class="op" id="3570366">(</span><span class="ident" id="3570367">context</span><span class="op" id="3570374">,</span>&nbsp;<span class="builtintype" id="3570376">int</span><span class="op" id="3570379">)</span>&nbsp;<span class="op" id="3570381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570384">return</span>&nbsp;<span class="ident" id="3570391">c</span><span class="op" id="3570392">,</span>&nbsp;<span class="builtinfunc" id="3570394">len</span><span class="op" id="3570397">(</span><span class="ident" id="3570398">s</span><span class="op" id="3570399">)</span><br>
<span class="lineno"></span><span class="op" id="3570401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3570404">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="3570466">func</span>&nbsp;<span class="ident" id="3570471">tURL</span><span class="op" id="3570475">(</span><span class="ident" id="3570476">c</span>&nbsp;<span class="ident" id="3570478">context</span><span class="op" id="3570485">,</span>&nbsp;<span class="ident" id="3570487">s</span>&nbsp;<span class="op" id="3570489">[</span><span class="op" id="3570490">]</span><span class="builtintype" id="3570491">byte</span><span class="op" id="3570495">)</span>&nbsp;<span class="op" id="3570497">(</span><span class="ident" id="3570498">context</span><span class="op" id="3570505">,</span>&nbsp;<span class="builtintype" id="3570507">int</span><span class="op" id="3570510">)</span>&nbsp;<span class="op" id="3570512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570515">if</span>&nbsp;<span class="ident" id="3570518">bytes</span><span class="op" id="3570523">.</span><span class="ident" id="3570524">IndexAny</span><span class="op" id="3570532">(</span><span class="ident" id="3570533">s</span><span class="op" id="3570534">,</span>&nbsp;<span class="string" id="3570536">&#34;#?&#34;</span><span class="op" id="3570540">)</span>&nbsp;<span class="op" id="3570542">&gt;=</span>&nbsp;<span class="num" id="3570545">0</span>&nbsp;<span class="op" id="3570547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570551">c</span><span class="op" id="3570552">.</span><span class="ident" id="3570553">urlPart</span>&nbsp;<span class="op" id="3570561">=</span>&nbsp;<span class="ident" id="3570563">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570583">}</span>&nbsp;<span class="keyword" id="3570585">else</span>&nbsp;<span class="keyword" id="3570590">if</span>&nbsp;<span class="builtinfunc" id="3570593">len</span><span class="op" id="3570596">(</span><span class="ident" id="3570597">s</span><span class="op" id="3570598">)</span>&nbsp;<span class="op" id="3570600">!=</span>&nbsp;<span class="ident" id="3570603">eatWhiteSpace</span><span class="op" id="3570616">(</span><span class="ident" id="3570617">s</span><span class="op" id="3570618">,</span>&nbsp;<span class="num" id="3570620">0</span><span class="op" id="3570621">)</span>&nbsp;<span class="op" id="3570623">&amp;&amp;</span>&nbsp;<span class="ident" id="3570626">c</span><span class="op" id="3570627">.</span><span class="ident" id="3570628">urlPart</span>&nbsp;<span class="op" id="3570636">==</span>&nbsp;<span class="ident" id="3570639">urlPartNone</span>&nbsp;<span class="op" id="3570651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3570655">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3570720">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570783">c</span><span class="op" id="3570784">.</span><span class="ident" id="3570785">urlPart</span>&nbsp;<span class="op" id="3570793">=</span>&nbsp;<span class="ident" id="3570795">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3570812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570815">return</span>&nbsp;<span class="ident" id="3570822">c</span><span class="op" id="3570823">,</span>&nbsp;<span class="builtinfunc" id="3570825">len</span><span class="op" id="3570828">(</span><span class="ident" id="3570829">s</span><span class="op" id="3570830">)</span><br>
<span class="lineno"></span><span class="op" id="3570832">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3570835">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3570895">func</span>&nbsp;<span class="ident" id="3570900">tJS</span><span class="op" id="3570903">(</span><span class="ident" id="3570904">c</span>&nbsp;<span class="ident" id="3570906">context</span><span class="op" id="3570913">,</span>&nbsp;<span class="ident" id="3570915">s</span>&nbsp;<span class="op" id="3570917">[</span><span class="op" id="3570918">]</span><span class="builtintype" id="3570919">byte</span><span class="op" id="3570923">)</span>&nbsp;<span class="op" id="3570925">(</span><span class="ident" id="3570926">context</span><span class="op" id="3570933">,</span>&nbsp;<span class="builtintype" id="3570935">int</span><span class="op" id="3570938">)</span>&nbsp;<span class="op" id="3570940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3570943">i</span>&nbsp;<span class="op" id="3570945">:=</span>&nbsp;<span class="ident" id="3570948">bytes</span><span class="op" id="3570953">.</span><span class="ident" id="3570954">IndexAny</span><span class="op" id="3570962">(</span><span class="ident" id="3570963">s</span><span class="op" id="3570964">,</span>&nbsp;<span class="string" id="3570966">`&#34;&#39;/`</span><span class="op" id="3570971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3570974">if</span>&nbsp;<span class="ident" id="3570977">i</span>&nbsp;<span class="op" id="3570979">==</span>&nbsp;<span class="op" id="3570982">-</span><span class="num" id="3570983">1</span>&nbsp;<span class="op" id="3570985">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3570989">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571046">c</span><span class="op" id="3571047">.</span><span class="ident" id="3571048">jsCtx</span>&nbsp;<span class="op" id="3571054">=</span>&nbsp;<span class="ident" id="3571056">nextJSCtx</span><span class="op" id="3571065">(</span><span class="ident" id="3571066">s</span><span class="op" id="3571067">,</span>&nbsp;<span class="ident" id="3571069">c</span><span class="op" id="3571070">.</span><span class="ident" id="3571071">jsCtx</span><span class="op" id="3571076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571080">return</span>&nbsp;<span class="ident" id="3571087">c</span><span class="op" id="3571088">,</span>&nbsp;<span class="builtinfunc" id="3571090">len</span><span class="op" id="3571093">(</span><span class="ident" id="3571094">s</span><span class="op" id="3571095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571101">c</span><span class="op" id="3571102">.</span><span class="ident" id="3571103">jsCtx</span>&nbsp;<span class="op" id="3571109">=</span>&nbsp;<span class="ident" id="3571111">nextJSCtx</span><span class="op" id="3571120">(</span><span class="ident" id="3571121">s</span><span class="op" id="3571122">[</span><span class="op" id="3571123">:</span><span class="ident" id="3571124">i</span><span class="op" id="3571125">]</span><span class="op" id="3571126">,</span>&nbsp;<span class="ident" id="3571128">c</span><span class="op" id="3571129">.</span><span class="ident" id="3571130">jsCtx</span><span class="op" id="3571135">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571138">switch</span>&nbsp;<span class="ident" id="3571145">s</span><span class="op" id="3571146">[</span><span class="ident" id="3571147">i</span><span class="op" id="3571148">]</span>&nbsp;<span class="op" id="3571150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571153">case</span>&nbsp;<span class="string" id="3571158">&#39;&#34;&#39;</span><span class="op" id="3571161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571165">c</span><span class="op" id="3571166">.</span><span class="ident" id="3571167">state</span><span class="op" id="3571172">,</span>&nbsp;<span class="ident" id="3571174">c</span><span class="op" id="3571175">.</span><span class="ident" id="3571176">jsCtx</span>&nbsp;<span class="op" id="3571182">=</span>&nbsp;<span class="ident" id="3571184">stateJSDqStr</span><span class="op" id="3571196">,</span>&nbsp;<span class="ident" id="3571198">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571211">case</span>&nbsp;<span class="string" id="3571216">&#39;\&#39;&#39;</span><span class="op" id="3571220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571224">c</span><span class="op" id="3571225">.</span><span class="ident" id="3571226">state</span><span class="op" id="3571231">,</span>&nbsp;<span class="ident" id="3571233">c</span><span class="op" id="3571234">.</span><span class="ident" id="3571235">jsCtx</span>&nbsp;<span class="op" id="3571241">=</span>&nbsp;<span class="ident" id="3571243">stateJSSqStr</span><span class="op" id="3571255">,</span>&nbsp;<span class="ident" id="3571257">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571270">case</span>&nbsp;<span class="string" id="3571275">&#39;/&#39;</span><span class="op" id="3571278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571282">switch</span>&nbsp;<span class="op" id="3571289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571293">case</span>&nbsp;<span class="ident" id="3571298">i</span><span class="op" id="3571299">+</span><span class="num" id="3571300">1</span>&nbsp;<span class="op" id="3571302">&lt;</span>&nbsp;<span class="builtinfunc" id="3571304">len</span><span class="op" id="3571307">(</span><span class="ident" id="3571308">s</span><span class="op" id="3571309">)</span>&nbsp;<span class="op" id="3571311">&amp;&amp;</span>&nbsp;<span class="ident" id="3571314">s</span><span class="op" id="3571315">[</span><span class="ident" id="3571316">i</span><span class="op" id="3571317">+</span><span class="num" id="3571318">1</span><span class="op" id="3571319">]</span>&nbsp;<span class="op" id="3571321">==</span>&nbsp;<span class="string" id="3571324">&#39;/&#39;</span><span class="op" id="3571327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571332">c</span><span class="op" id="3571333">.</span><span class="ident" id="3571334">state</span><span class="op" id="3571339">,</span>&nbsp;<span class="ident" id="3571341">i</span>&nbsp;<span class="op" id="3571343">=</span>&nbsp;<span class="ident" id="3571345">stateJSLineCmt</span><span class="op" id="3571359">,</span>&nbsp;<span class="ident" id="3571361">i</span><span class="op" id="3571362">+</span><span class="num" id="3571363">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571367">case</span>&nbsp;<span class="ident" id="3571372">i</span><span class="op" id="3571373">+</span><span class="num" id="3571374">1</span>&nbsp;<span class="op" id="3571376">&lt;</span>&nbsp;<span class="builtinfunc" id="3571378">len</span><span class="op" id="3571381">(</span><span class="ident" id="3571382">s</span><span class="op" id="3571383">)</span>&nbsp;<span class="op" id="3571385">&amp;&amp;</span>&nbsp;<span class="ident" id="3571388">s</span><span class="op" id="3571389">[</span><span class="ident" id="3571390">i</span><span class="op" id="3571391">+</span><span class="num" id="3571392">1</span><span class="op" id="3571393">]</span>&nbsp;<span class="op" id="3571395">==</span>&nbsp;<span class="string" id="3571398">&#39;*&#39;</span><span class="op" id="3571401">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571406">c</span><span class="op" id="3571407">.</span><span class="ident" id="3571408">state</span><span class="op" id="3571413">,</span>&nbsp;<span class="ident" id="3571415">i</span>&nbsp;<span class="op" id="3571417">=</span>&nbsp;<span class="ident" id="3571419">stateJSBlockCmt</span><span class="op" id="3571434">,</span>&nbsp;<span class="ident" id="3571436">i</span><span class="op" id="3571437">+</span><span class="num" id="3571438">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571442">case</span>&nbsp;<span class="ident" id="3571447">c</span><span class="op" id="3571448">.</span><span class="ident" id="3571449">jsCtx</span>&nbsp;<span class="op" id="3571455">==</span>&nbsp;<span class="ident" id="3571458">jsCtxRegexp</span><span class="op" id="3571469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571474">c</span><span class="op" id="3571475">.</span><span class="ident" id="3571476">state</span>&nbsp;<span class="op" id="3571482">=</span>&nbsp;<span class="ident" id="3571484">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571500">case</span>&nbsp;<span class="ident" id="3571505">c</span><span class="op" id="3571506">.</span><span class="ident" id="3571507">jsCtx</span>&nbsp;<span class="op" id="3571513">==</span>&nbsp;<span class="ident" id="3571516">jsCtxDivOp</span><span class="op" id="3571526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571531">c</span><span class="op" id="3571532">.</span><span class="ident" id="3571533">jsCtx</span>&nbsp;<span class="op" id="3571539">=</span>&nbsp;<span class="ident" id="3571541">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571555">default</span><span class="op" id="3571562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571567">return</span>&nbsp;<span class="ident" id="3571574">context</span><span class="op" id="3571581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571587">state</span><span class="op" id="3571592">:</span>&nbsp;<span class="ident" id="3571594">stateError</span><span class="op" id="3571604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571610">err</span><span class="op" id="3571613">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3571617">errorf</span><span class="op" id="3571623">(</span><span class="ident" id="3571624">ErrSlashAmbig</span><span class="op" id="3571637">,</span>&nbsp;<span class="ident" id="3571639">nil</span><span class="op" id="3571642">,</span>&nbsp;<span class="num" id="3571644">0</span><span class="op" id="3571645">,</span>&nbsp;<span class="string" id="3571647">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="3571692">,</span>&nbsp;<span class="ident" id="3571694">s</span><span class="op" id="3571695">[</span><span class="ident" id="3571696">i</span><span class="op" id="3571697">:</span><span class="op" id="3571698">]</span><span class="op" id="3571699">)</span><span class="op" id="3571700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571705">}</span><span class="op" id="3571706">,</span>&nbsp;<span class="builtinfunc" id="3571708">len</span><span class="op" id="3571711">(</span><span class="ident" id="3571712">s</span><span class="op" id="3571713">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571720">default</span><span class="op" id="3571727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3571731">panic</span><span class="op" id="3571736">(</span><span class="string" id="3571737">&#34;unreachable&#34;</span><span class="op" id="3571750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3571753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571756">return</span>&nbsp;<span class="ident" id="3571763">c</span><span class="op" id="3571764">,</span>&nbsp;<span class="ident" id="3571766">i</span>&nbsp;<span class="op" id="3571768">+</span>&nbsp;<span class="num" id="3571770">1</span><br>
<span class="lineno">255</span><span class="op" id="3571772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3571775">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3571855">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3571866">func</span>&nbsp;<span class="ident" id="3571871">tJSDelimited</span><span class="op" id="3571883">(</span><span class="ident" id="3571884">c</span>&nbsp;<span class="ident" id="3571886">context</span><span class="op" id="3571893">,</span>&nbsp;<span class="ident" id="3571895">s</span>&nbsp;<span class="op" id="3571897">[</span><span class="op" id="3571898">]</span><span class="builtintype" id="3571899">byte</span><span class="op" id="3571903">)</span>&nbsp;<span class="op" id="3571905">(</span><span class="ident" id="3571906">context</span><span class="op" id="3571913">,</span>&nbsp;<span class="builtintype" id="3571915">int</span><span class="op" id="3571918">)</span>&nbsp;<span class="op" id="3571920">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571923">specials</span>&nbsp;<span class="op" id="3571932">:=</span>&nbsp;<span class="string" id="3571935">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571941">switch</span>&nbsp;<span class="ident" id="3571948">c</span><span class="op" id="3571949">.</span><span class="ident" id="3571950">state</span>&nbsp;<span class="op" id="3571956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571959">case</span>&nbsp;<span class="ident" id="3571964">stateJSSqStr</span><span class="op" id="3571976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3571980">specials</span>&nbsp;<span class="op" id="3571989">=</span>&nbsp;<span class="string" id="3571991">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3571997">case</span>&nbsp;<span class="ident" id="3572002">stateJSRegexp</span><span class="op" id="3572015">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572019">specials</span>&nbsp;<span class="op" id="3572028">=</span>&nbsp;<span class="string" id="3572030">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572042">k</span><span class="op" id="3572043">,</span>&nbsp;<span class="ident" id="3572045">inCharset</span>&nbsp;<span class="op" id="3572055">:=</span>&nbsp;<span class="num" id="3572058">0</span><span class="op" id="3572059">,</span>&nbsp;<span class="builtintype" id="3572061">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572068">for</span>&nbsp;<span class="op" id="3572072">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572076">i</span>&nbsp;<span class="op" id="3572078">:=</span>&nbsp;<span class="ident" id="3572081">k</span>&nbsp;<span class="op" id="3572083">+</span>&nbsp;<span class="ident" id="3572085">bytes</span><span class="op" id="3572090">.</span><span class="ident" id="3572091">IndexAny</span><span class="op" id="3572099">(</span><span class="ident" id="3572100">s</span><span class="op" id="3572101">[</span><span class="ident" id="3572102">k</span><span class="op" id="3572103">:</span><span class="op" id="3572104">]</span><span class="op" id="3572105">,</span>&nbsp;<span class="ident" id="3572107">specials</span><span class="op" id="3572115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572119">if</span>&nbsp;<span class="ident" id="3572122">i</span>&nbsp;<span class="op" id="3572124">&lt;</span>&nbsp;<span class="ident" id="3572126">k</span>&nbsp;<span class="op" id="3572128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572133">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572145">switch</span>&nbsp;<span class="ident" id="3572152">s</span><span class="op" id="3572153">[</span><span class="ident" id="3572154">i</span><span class="op" id="3572155">]</span>&nbsp;<span class="op" id="3572157">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572161">case</span>&nbsp;<span class="string" id="3572166">&#39;\\&#39;</span><span class="op" id="3572170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572175">i</span><span class="op" id="3572176">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572182">if</span>&nbsp;<span class="ident" id="3572185">i</span>&nbsp;<span class="op" id="3572187">==</span>&nbsp;<span class="builtinfunc" id="3572190">len</span><span class="op" id="3572193">(</span><span class="ident" id="3572194">s</span><span class="op" id="3572195">)</span>&nbsp;<span class="op" id="3572197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572203">return</span>&nbsp;<span class="ident" id="3572210">context</span><span class="op" id="3572217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572224">state</span><span class="op" id="3572229">:</span>&nbsp;<span class="ident" id="3572231">stateError</span><span class="op" id="3572241">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572248">err</span><span class="op" id="3572251">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3572255">errorf</span><span class="op" id="3572261">(</span><span class="ident" id="3572262">ErrPartialEscape</span><span class="op" id="3572278">,</span>&nbsp;<span class="ident" id="3572280">nil</span><span class="op" id="3572283">,</span>&nbsp;<span class="num" id="3572285">0</span><span class="op" id="3572286">,</span>&nbsp;<span class="string" id="3572288">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="3572333">,</span>&nbsp;<span class="ident" id="3572335">s</span><span class="op" id="3572336">)</span><span class="op" id="3572337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572343">}</span><span class="op" id="3572344">,</span>&nbsp;<span class="builtinfunc" id="3572346">len</span><span class="op" id="3572349">(</span><span class="ident" id="3572350">s</span><span class="op" id="3572351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572360">case</span>&nbsp;<span class="string" id="3572365">&#39;[&#39;</span><span class="op" id="3572368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572373">inCharset</span>&nbsp;<span class="op" id="3572383">=</span>&nbsp;<span class="builtintype" id="3572385">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572392">case</span>&nbsp;<span class="string" id="3572397">&#39;]&#39;</span><span class="op" id="3572400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572405">inCharset</span>&nbsp;<span class="op" id="3572415">=</span>&nbsp;<span class="builtintype" id="3572417">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572425">default</span><span class="op" id="3572432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572437">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572457">if</span>&nbsp;<span class="op" id="3572460">!</span><span class="ident" id="3572461">inCharset</span>&nbsp;<span class="op" id="3572471">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572477">c</span><span class="op" id="3572478">.</span><span class="ident" id="3572479">state</span><span class="op" id="3572484">,</span>&nbsp;<span class="ident" id="3572486">c</span><span class="op" id="3572487">.</span><span class="ident" id="3572488">jsCtx</span>&nbsp;<span class="op" id="3572494">=</span>&nbsp;<span class="ident" id="3572496">stateJS</span><span class="op" id="3572503">,</span>&nbsp;<span class="ident" id="3572505">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572520">return</span>&nbsp;<span class="ident" id="3572527">c</span><span class="op" id="3572528">,</span>&nbsp;<span class="ident" id="3572530">i</span>&nbsp;<span class="op" id="3572532">+</span>&nbsp;<span class="num" id="3572534">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572547">k</span>&nbsp;<span class="op" id="3572549">=</span>&nbsp;<span class="ident" id="3572551">i</span>&nbsp;<span class="op" id="3572553">+</span>&nbsp;<span class="num" id="3572555">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572562">if</span>&nbsp;<span class="ident" id="3572565">inCharset</span>&nbsp;<span class="op" id="3572575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572579">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3572644">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572675">return</span>&nbsp;<span class="ident" id="3572682">context</span><span class="op" id="3572689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572694">state</span><span class="op" id="3572699">:</span>&nbsp;<span class="ident" id="3572701">stateError</span><span class="op" id="3572711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572716">err</span><span class="op" id="3572719">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3572723">errorf</span><span class="op" id="3572729">(</span><span class="ident" id="3572730">ErrPartialCharset</span><span class="op" id="3572747">,</span>&nbsp;<span class="ident" id="3572749">nil</span><span class="op" id="3572752">,</span>&nbsp;<span class="num" id="3572754">0</span><span class="op" id="3572755">,</span>&nbsp;<span class="string" id="3572757">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="3572791">,</span>&nbsp;<span class="ident" id="3572793">s</span><span class="op" id="3572794">)</span><span class="op" id="3572795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572799">}</span><span class="op" id="3572800">,</span>&nbsp;<span class="builtinfunc" id="3572802">len</span><span class="op" id="3572805">(</span><span class="ident" id="3572806">s</span><span class="op" id="3572807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3572810">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3572814">return</span>&nbsp;<span class="ident" id="3572821">c</span><span class="op" id="3572822">,</span>&nbsp;<span class="builtinfunc" id="3572824">len</span><span class="op" id="3572827">(</span><span class="ident" id="3572828">s</span><span class="op" id="3572829">)</span><br>
<span class="lineno"></span><span class="op" id="3572831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3572834">var</span>&nbsp;<span class="ident" id="3572838">blockCommentEnd</span>&nbsp;<span class="op" id="3572854">=</span>&nbsp;<span class="op" id="3572856">[</span><span class="op" id="3572857">]</span><span class="builtintype" id="3572858">byte</span><span class="op" id="3572862">(</span><span class="string" id="3572863">&#34;*/&#34;</span><span class="op" id="3572867">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="3572870">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3572942">func</span>&nbsp;<span class="ident" id="3572947">tBlockCmt</span><span class="op" id="3572956">(</span><span class="ident" id="3572957">c</span>&nbsp;<span class="ident" id="3572959">context</span><span class="op" id="3572966">,</span>&nbsp;<span class="ident" id="3572968">s</span>&nbsp;<span class="op" id="3572970">[</span><span class="op" id="3572971">]</span><span class="builtintype" id="3572972">byte</span><span class="op" id="3572976">)</span>&nbsp;<span class="op" id="3572978">(</span><span class="ident" id="3572979">context</span><span class="op" id="3572986">,</span>&nbsp;<span class="builtintype" id="3572988">int</span><span class="op" id="3572991">)</span>&nbsp;<span class="op" id="3572993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3572996">i</span>&nbsp;<span class="op" id="3572998">:=</span>&nbsp;<span class="ident" id="3573001">bytes</span><span class="op" id="3573006">.</span><span class="ident" id="3573007">Index</span><span class="op" id="3573012">(</span><span class="ident" id="3573013">s</span><span class="op" id="3573014">,</span>&nbsp;<span class="ident" id="3573016">blockCommentEnd</span><span class="op" id="3573031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573034">if</span>&nbsp;<span class="ident" id="3573037">i</span>&nbsp;<span class="op" id="3573039">==</span>&nbsp;<span class="op" id="3573042">-</span><span class="num" id="3573043">1</span>&nbsp;<span class="op" id="3573045">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573049">return</span>&nbsp;<span class="ident" id="3573056">c</span><span class="op" id="3573057">,</span>&nbsp;<span class="builtinfunc" id="3573059">len</span><span class="op" id="3573062">(</span><span class="ident" id="3573063">s</span><span class="op" id="3573064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573070">switch</span>&nbsp;<span class="ident" id="3573077">c</span><span class="op" id="3573078">.</span><span class="ident" id="3573079">state</span>&nbsp;<span class="op" id="3573085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573088">case</span>&nbsp;<span class="ident" id="3573093">stateJSBlockCmt</span><span class="op" id="3573108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573112">c</span><span class="op" id="3573113">.</span><span class="ident" id="3573114">state</span>&nbsp;<span class="op" id="3573120">=</span>&nbsp;<span class="ident" id="3573122">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573131">case</span>&nbsp;<span class="ident" id="3573136">stateCSSBlockCmt</span><span class="op" id="3573152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573156">c</span><span class="op" id="3573157">.</span><span class="ident" id="3573158">state</span>&nbsp;<span class="op" id="3573164">=</span>&nbsp;<span class="ident" id="3573166">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573176">default</span><span class="op" id="3573183">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3573187">panic</span><span class="op" id="3573192">(</span><span class="ident" id="3573193">c</span><span class="op" id="3573194">.</span><span class="ident" id="3573195">state</span><span class="op" id="3573200">.</span><span class="ident" id="3573201">String</span><span class="op" id="3573207">(</span><span class="op" id="3573208">)</span><span class="op" id="3573209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573212">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573215">return</span>&nbsp;<span class="ident" id="3573222">c</span><span class="op" id="3573223">,</span>&nbsp;<span class="ident" id="3573225">i</span>&nbsp;<span class="op" id="3573227">+</span>&nbsp;<span class="num" id="3573229">2</span><br>
<span class="lineno"></span><span class="op" id="3573231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3573234">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3573303">func</span>&nbsp;<span class="ident" id="3573308">tLineCmt</span><span class="op" id="3573316">(</span><span class="ident" id="3573317">c</span>&nbsp;<span class="ident" id="3573319">context</span><span class="op" id="3573326">,</span>&nbsp;<span class="ident" id="3573328">s</span>&nbsp;<span class="op" id="3573330">[</span><span class="op" id="3573331">]</span><span class="builtintype" id="3573332">byte</span><span class="op" id="3573336">)</span>&nbsp;<span class="op" id="3573338">(</span><span class="ident" id="3573339">context</span><span class="op" id="3573346">,</span>&nbsp;<span class="builtintype" id="3573348">int</span><span class="op" id="3573351">)</span>&nbsp;<span class="op" id="3573353">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573356">var</span>&nbsp;<span class="ident" id="3573360">lineTerminators</span>&nbsp;<span class="builtintype" id="3573376">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573384">var</span>&nbsp;<span class="ident" id="3573388">endState</span>&nbsp;<span class="ident" id="3573397">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573404">switch</span>&nbsp;<span class="ident" id="3573411">c</span><span class="op" id="3573412">.</span><span class="ident" id="3573413">state</span>&nbsp;<span class="op" id="3573419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573422">case</span>&nbsp;<span class="ident" id="3573427">stateJSLineCmt</span><span class="op" id="3573441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573445">lineTerminators</span><span class="op" id="3573460">,</span>&nbsp;<span class="ident" id="3573462">endState</span>&nbsp;<span class="op" id="3573471">=</span>&nbsp;<span class="string" id="3573473">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="3573491">,</span>&nbsp;<span class="ident" id="3573493">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573502">case</span>&nbsp;<span class="ident" id="3573507">stateCSSLineCmt</span><span class="op" id="3573522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573526">lineTerminators</span><span class="op" id="3573541">,</span>&nbsp;<span class="ident" id="3573543">endState</span>&nbsp;<span class="op" id="3573552">=</span>&nbsp;<span class="string" id="3573554">&#34;\n\f\r&#34;</span><span class="op" id="3573562">,</span>&nbsp;<span class="ident" id="3573564">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573575">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573641">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573685">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573720">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573761">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573824">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3573839">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573880">default</span><span class="op" id="3573887">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3573891">panic</span><span class="op" id="3573896">(</span><span class="ident" id="3573897">c</span><span class="op" id="3573898">.</span><span class="ident" id="3573899">state</span><span class="op" id="3573904">.</span><span class="ident" id="3573905">String</span><span class="op" id="3573911">(</span><span class="op" id="3573912">)</span><span class="op" id="3573913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573920">i</span>&nbsp;<span class="op" id="3573922">:=</span>&nbsp;<span class="ident" id="3573925">bytes</span><span class="op" id="3573930">.</span><span class="ident" id="3573931">IndexAny</span><span class="op" id="3573939">(</span><span class="ident" id="3573940">s</span><span class="op" id="3573941">,</span>&nbsp;<span class="ident" id="3573943">lineTerminators</span><span class="op" id="3573958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573961">if</span>&nbsp;<span class="ident" id="3573964">i</span>&nbsp;<span class="op" id="3573966">==</span>&nbsp;<span class="op" id="3573969">-</span><span class="num" id="3573970">1</span>&nbsp;<span class="op" id="3573972">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3573976">return</span>&nbsp;<span class="ident" id="3573983">c</span><span class="op" id="3573984">,</span>&nbsp;<span class="builtinfunc" id="3573986">len</span><span class="op" id="3573989">(</span><span class="ident" id="3573990">s</span><span class="op" id="3573991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3573994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3573997">c</span><span class="op" id="3573998">.</span><span class="ident" id="3573999">state</span>&nbsp;<span class="op" id="3574005">=</span>&nbsp;<span class="ident" id="3574007">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574017">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574083">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574146">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574206">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574272">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3574336">return</span>&nbsp;<span class="ident" id="3574343">c</span><span class="op" id="3574344">,</span>&nbsp;<span class="ident" id="3574346">i</span><br>
<span class="lineno"></span><span class="op" id="3574348">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3574351">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3574413">func</span>&nbsp;<span class="ident" id="3574418">tCSS</span><span class="op" id="3574422">(</span><span class="ident" id="3574423">c</span>&nbsp;<span class="ident" id="3574425">context</span><span class="op" id="3574432">,</span>&nbsp;<span class="ident" id="3574434">s</span>&nbsp;<span class="op" id="3574436">[</span><span class="op" id="3574437">]</span><span class="builtintype" id="3574438">byte</span><span class="op" id="3574442">)</span>&nbsp;<span class="op" id="3574444">(</span><span class="ident" id="3574445">context</span><span class="op" id="3574452">,</span>&nbsp;<span class="builtintype" id="3574454">int</span><span class="op" id="3574457">)</span>&nbsp;<span class="op" id="3574459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574462">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574519">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574561">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574627">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574689">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574704">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574757">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574803">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574854">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574915">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574931">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3574988">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575058">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575062">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575125">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575160">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575164">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575218">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575287">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575359">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575380">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575448">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575518">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575579">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575650">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575719">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575758">k</span>&nbsp;<span class="op" id="3575760">:=</span>&nbsp;<span class="num" id="3575763">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575766">for</span>&nbsp;<span class="op" id="3575770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575774">i</span>&nbsp;<span class="op" id="3575776">:=</span>&nbsp;<span class="ident" id="3575779">k</span>&nbsp;<span class="op" id="3575781">+</span>&nbsp;<span class="ident" id="3575783">bytes</span><span class="op" id="3575788">.</span><span class="ident" id="3575789">IndexAny</span><span class="op" id="3575797">(</span><span class="ident" id="3575798">s</span><span class="op" id="3575799">[</span><span class="ident" id="3575800">k</span><span class="op" id="3575801">:</span><span class="op" id="3575802">]</span><span class="op" id="3575803">,</span>&nbsp;<span class="string" id="3575805">`(&#34;&#39;/`</span><span class="op" id="3575811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575815">if</span>&nbsp;<span class="ident" id="3575818">i</span>&nbsp;<span class="op" id="3575820">&lt;</span>&nbsp;<span class="ident" id="3575822">k</span>&nbsp;<span class="op" id="3575824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575829">return</span>&nbsp;<span class="ident" id="3575836">c</span><span class="op" id="3575837">,</span>&nbsp;<span class="builtinfunc" id="3575839">len</span><span class="op" id="3575842">(</span><span class="ident" id="3575843">s</span><span class="op" id="3575844">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3575848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575852">switch</span>&nbsp;<span class="ident" id="3575859">s</span><span class="op" id="3575860">[</span><span class="ident" id="3575861">i</span><span class="op" id="3575862">]</span>&nbsp;<span class="op" id="3575864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575868">case</span>&nbsp;<span class="string" id="3575873">&#39;(&#39;</span><span class="op" id="3575876">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3575881">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575913">p</span>&nbsp;<span class="op" id="3575915">:=</span>&nbsp;<span class="ident" id="3575918">bytes</span><span class="op" id="3575923">.</span><span class="ident" id="3575924">TrimRight</span><span class="op" id="3575933">(</span><span class="ident" id="3575934">s</span><span class="op" id="3575935">[</span><span class="op" id="3575936">:</span><span class="ident" id="3575937">i</span><span class="op" id="3575938">]</span><span class="op" id="3575939">,</span>&nbsp;<span class="string" id="3575941">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="3575952">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3575957">if</span>&nbsp;<span class="ident" id="3575960">endsWithCSSKeyword</span><span class="op" id="3575978">(</span><span class="ident" id="3575979">p</span><span class="op" id="3575980">,</span>&nbsp;<span class="string" id="3575982">&#34;url&#34;</span><span class="op" id="3575987">)</span>&nbsp;<span class="op" id="3575989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3575995">j</span>&nbsp;<span class="op" id="3575997">:=</span>&nbsp;<span class="builtinfunc" id="3576000">len</span><span class="op" id="3576003">(</span><span class="ident" id="3576004">s</span><span class="op" id="3576005">)</span>&nbsp;<span class="op" id="3576007">-</span>&nbsp;<span class="builtinfunc" id="3576009">len</span><span class="op" id="3576012">(</span><span class="ident" id="3576013">bytes</span><span class="op" id="3576018">.</span><span class="ident" id="3576019">TrimLeft</span><span class="op" id="3576027">(</span><span class="ident" id="3576028">s</span><span class="op" id="3576029">[</span><span class="ident" id="3576030">i</span><span class="op" id="3576031">+</span><span class="num" id="3576032">1</span><span class="op" id="3576033">:</span><span class="op" id="3576034">]</span><span class="op" id="3576035">,</span>&nbsp;<span class="string" id="3576037">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="3576048">)</span><span class="op" id="3576049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576055">switch</span>&nbsp;<span class="op" id="3576062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576068">case</span>&nbsp;<span class="ident" id="3576073">j</span>&nbsp;<span class="op" id="3576075">!=</span>&nbsp;<span class="builtinfunc" id="3576078">len</span><span class="op" id="3576081">(</span><span class="ident" id="3576082">s</span><span class="op" id="3576083">)</span>&nbsp;<span class="op" id="3576085">&amp;&amp;</span>&nbsp;<span class="ident" id="3576088">s</span><span class="op" id="3576089">[</span><span class="ident" id="3576090">j</span><span class="op" id="3576091">]</span>&nbsp;<span class="op" id="3576093">==</span>&nbsp;<span class="string" id="3576096">&#39;&#34;&#39;</span><span class="op" id="3576099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576106">c</span><span class="op" id="3576107">.</span><span class="ident" id="3576108">state</span><span class="op" id="3576113">,</span>&nbsp;<span class="ident" id="3576115">j</span>&nbsp;<span class="op" id="3576117">=</span>&nbsp;<span class="ident" id="3576119">stateCSSDqURL</span><span class="op" id="3576132">,</span>&nbsp;<span class="ident" id="3576134">j</span><span class="op" id="3576135">+</span><span class="num" id="3576136">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576142">case</span>&nbsp;<span class="ident" id="3576147">j</span>&nbsp;<span class="op" id="3576149">!=</span>&nbsp;<span class="builtinfunc" id="3576152">len</span><span class="op" id="3576155">(</span><span class="ident" id="3576156">s</span><span class="op" id="3576157">)</span>&nbsp;<span class="op" id="3576159">&amp;&amp;</span>&nbsp;<span class="ident" id="3576162">s</span><span class="op" id="3576163">[</span><span class="ident" id="3576164">j</span><span class="op" id="3576165">]</span>&nbsp;<span class="op" id="3576167">==</span>&nbsp;<span class="string" id="3576170">&#39;\&#39;&#39;</span><span class="op" id="3576174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576181">c</span><span class="op" id="3576182">.</span><span class="ident" id="3576183">state</span><span class="op" id="3576188">,</span>&nbsp;<span class="ident" id="3576190">j</span>&nbsp;<span class="op" id="3576192">=</span>&nbsp;<span class="ident" id="3576194">stateCSSSqURL</span><span class="op" id="3576207">,</span>&nbsp;<span class="ident" id="3576209">j</span><span class="op" id="3576210">+</span><span class="num" id="3576211">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576217">default</span><span class="op" id="3576224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576231">c</span><span class="op" id="3576232">.</span><span class="ident" id="3576233">state</span>&nbsp;<span class="op" id="3576239">=</span>&nbsp;<span class="ident" id="3576241">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576257">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576263">return</span>&nbsp;<span class="ident" id="3576270">c</span><span class="op" id="3576271">,</span>&nbsp;<span class="ident" id="3576273">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576282">case</span>&nbsp;<span class="string" id="3576287">&#39;/&#39;</span><span class="op" id="3576290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576295">if</span>&nbsp;<span class="ident" id="3576298">i</span><span class="op" id="3576299">+</span><span class="num" id="3576300">1</span>&nbsp;<span class="op" id="3576302">&lt;</span>&nbsp;<span class="builtinfunc" id="3576304">len</span><span class="op" id="3576307">(</span><span class="ident" id="3576308">s</span><span class="op" id="3576309">)</span>&nbsp;<span class="op" id="3576311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576317">switch</span>&nbsp;<span class="ident" id="3576324">s</span><span class="op" id="3576325">[</span><span class="ident" id="3576326">i</span><span class="op" id="3576327">+</span><span class="num" id="3576328">1</span><span class="op" id="3576329">]</span>&nbsp;<span class="op" id="3576331">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576337">case</span>&nbsp;<span class="string" id="3576342">&#39;/&#39;</span><span class="op" id="3576345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576352">c</span><span class="op" id="3576353">.</span><span class="ident" id="3576354">state</span>&nbsp;<span class="op" id="3576360">=</span>&nbsp;<span class="ident" id="3576362">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576383">return</span>&nbsp;<span class="ident" id="3576390">c</span><span class="op" id="3576391">,</span>&nbsp;<span class="ident" id="3576393">i</span>&nbsp;<span class="op" id="3576395">+</span>&nbsp;<span class="num" id="3576397">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576403">case</span>&nbsp;<span class="string" id="3576408">&#39;*&#39;</span><span class="op" id="3576411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576418">c</span><span class="op" id="3576419">.</span><span class="ident" id="3576420">state</span>&nbsp;<span class="op" id="3576426">=</span>&nbsp;<span class="ident" id="3576428">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576450">return</span>&nbsp;<span class="ident" id="3576457">c</span><span class="op" id="3576458">,</span>&nbsp;<span class="ident" id="3576460">i</span>&nbsp;<span class="op" id="3576462">+</span>&nbsp;<span class="num" id="3576464">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576479">case</span>&nbsp;<span class="string" id="3576484">&#39;&#34;&#39;</span><span class="op" id="3576487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576492">c</span><span class="op" id="3576493">.</span><span class="ident" id="3576494">state</span>&nbsp;<span class="op" id="3576500">=</span>&nbsp;<span class="ident" id="3576502">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576519">return</span>&nbsp;<span class="ident" id="3576526">c</span><span class="op" id="3576527">,</span>&nbsp;<span class="ident" id="3576529">i</span>&nbsp;<span class="op" id="3576531">+</span>&nbsp;<span class="num" id="3576533">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576537">case</span>&nbsp;<span class="string" id="3576542">&#39;\&#39;&#39;</span><span class="op" id="3576546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576551">c</span><span class="op" id="3576552">.</span><span class="ident" id="3576553">state</span>&nbsp;<span class="op" id="3576559">=</span>&nbsp;<span class="ident" id="3576561">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576578">return</span>&nbsp;<span class="ident" id="3576585">c</span><span class="op" id="3576586">,</span>&nbsp;<span class="ident" id="3576588">i</span>&nbsp;<span class="op" id="3576590">+</span>&nbsp;<span class="num" id="3576592">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576596">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576600">k</span>&nbsp;<span class="op" id="3576602">=</span>&nbsp;<span class="ident" id="3576604">i</span>&nbsp;<span class="op" id="3576606">+</span>&nbsp;<span class="num" id="3576608">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3576611">}</span><br>
<span class="lineno"></span><span class="op" id="3576613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3576616">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="3576697">func</span>&nbsp;<span class="ident" id="3576702">tCSSStr</span><span class="op" id="3576709">(</span><span class="ident" id="3576710">c</span>&nbsp;<span class="ident" id="3576712">context</span><span class="op" id="3576719">,</span>&nbsp;<span class="ident" id="3576721">s</span>&nbsp;<span class="op" id="3576723">[</span><span class="op" id="3576724">]</span><span class="builtintype" id="3576725">byte</span><span class="op" id="3576729">)</span>&nbsp;<span class="op" id="3576731">(</span><span class="ident" id="3576732">context</span><span class="op" id="3576739">,</span>&nbsp;<span class="builtintype" id="3576741">int</span><span class="op" id="3576744">)</span>&nbsp;<span class="op" id="3576746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576749">var</span>&nbsp;<span class="ident" id="3576753">endAndEsc</span>&nbsp;<span class="builtintype" id="3576763">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576771">switch</span>&nbsp;<span class="ident" id="3576778">c</span><span class="op" id="3576779">.</span><span class="ident" id="3576780">state</span>&nbsp;<span class="op" id="3576786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576789">case</span>&nbsp;<span class="ident" id="3576794">stateCSSDqStr</span><span class="op" id="3576807">,</span>&nbsp;<span class="ident" id="3576809">stateCSSDqURL</span><span class="op" id="3576822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576826">endAndEsc</span>&nbsp;<span class="op" id="3576836">=</span>&nbsp;<span class="string" id="3576838">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576844">case</span>&nbsp;<span class="ident" id="3576849">stateCSSSqStr</span><span class="op" id="3576862">,</span>&nbsp;<span class="ident" id="3576864">stateCSSSqURL</span><span class="op" id="3576877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3576881">endAndEsc</span>&nbsp;<span class="op" id="3576891">=</span>&nbsp;<span class="string" id="3576893">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3576899">case</span>&nbsp;<span class="ident" id="3576904">stateCSSURL</span><span class="op" id="3576915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576919">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3576979">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577041">endAndEsc</span>&nbsp;<span class="op" id="3577051">=</span>&nbsp;<span class="string" id="3577053">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577069">default</span><span class="op" id="3577076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3577080">panic</span><span class="op" id="3577085">(</span><span class="ident" id="3577086">c</span><span class="op" id="3577087">.</span><span class="ident" id="3577088">state</span><span class="op" id="3577093">.</span><span class="ident" id="3577094">String</span><span class="op" id="3577100">(</span><span class="op" id="3577101">)</span><span class="op" id="3577102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577109">k</span>&nbsp;<span class="op" id="3577111">:=</span>&nbsp;<span class="num" id="3577114">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577117">for</span>&nbsp;<span class="op" id="3577121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577125">i</span>&nbsp;<span class="op" id="3577127">:=</span>&nbsp;<span class="ident" id="3577130">k</span>&nbsp;<span class="op" id="3577132">+</span>&nbsp;<span class="ident" id="3577134">bytes</span><span class="op" id="3577139">.</span><span class="ident" id="3577140">IndexAny</span><span class="op" id="3577148">(</span><span class="ident" id="3577149">s</span><span class="op" id="3577150">[</span><span class="ident" id="3577151">k</span><span class="op" id="3577152">:</span><span class="op" id="3577153">]</span><span class="op" id="3577154">,</span>&nbsp;<span class="ident" id="3577156">endAndEsc</span><span class="op" id="3577165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577169">if</span>&nbsp;<span class="ident" id="3577172">i</span>&nbsp;<span class="op" id="3577174">&lt;</span>&nbsp;<span class="ident" id="3577176">k</span>&nbsp;<span class="op" id="3577178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577183">c</span><span class="op" id="3577184">,</span>&nbsp;<span class="ident" id="3577186">nread</span>&nbsp;<span class="op" id="3577192">:=</span>&nbsp;<span class="ident" id="3577195">tURL</span><span class="op" id="3577199">(</span><span class="ident" id="3577200">c</span><span class="op" id="3577201">,</span>&nbsp;<span class="ident" id="3577203">decodeCSS</span><span class="op" id="3577212">(</span><span class="ident" id="3577213">s</span><span class="op" id="3577214">[</span><span class="ident" id="3577215">k</span><span class="op" id="3577216">:</span><span class="op" id="3577217">]</span><span class="op" id="3577218">)</span><span class="op" id="3577219">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577224">return</span>&nbsp;<span class="ident" id="3577231">c</span><span class="op" id="3577232">,</span>&nbsp;<span class="ident" id="3577234">k</span>&nbsp;<span class="op" id="3577236">+</span>&nbsp;<span class="ident" id="3577238">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577250">if</span>&nbsp;<span class="ident" id="3577253">s</span><span class="op" id="3577254">[</span><span class="ident" id="3577255">i</span><span class="op" id="3577256">]</span>&nbsp;<span class="op" id="3577258">==</span>&nbsp;<span class="string" id="3577261">&#39;\\&#39;</span>&nbsp;<span class="op" id="3577266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577271">i</span><span class="op" id="3577272">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577278">if</span>&nbsp;<span class="ident" id="3577281">i</span>&nbsp;<span class="op" id="3577283">==</span>&nbsp;<span class="builtinfunc" id="3577286">len</span><span class="op" id="3577289">(</span><span class="ident" id="3577290">s</span><span class="op" id="3577291">)</span>&nbsp;<span class="op" id="3577293">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577299">return</span>&nbsp;<span class="ident" id="3577306">context</span><span class="op" id="3577313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577320">state</span><span class="op" id="3577325">:</span>&nbsp;<span class="ident" id="3577327">stateError</span><span class="op" id="3577337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577344">err</span><span class="op" id="3577347">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3577351">errorf</span><span class="op" id="3577357">(</span><span class="ident" id="3577358">ErrPartialEscape</span><span class="op" id="3577374">,</span>&nbsp;<span class="ident" id="3577376">nil</span><span class="op" id="3577379">,</span>&nbsp;<span class="num" id="3577381">0</span><span class="op" id="3577382">,</span>&nbsp;<span class="string" id="3577384">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="3577430">,</span>&nbsp;<span class="ident" id="3577432">s</span><span class="op" id="3577433">)</span><span class="op" id="3577434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577440">}</span><span class="op" id="3577441">,</span>&nbsp;<span class="builtinfunc" id="3577443">len</span><span class="op" id="3577446">(</span><span class="ident" id="3577447">s</span><span class="op" id="3577448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577453">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577457">}</span>&nbsp;<span class="keyword" id="3577459">else</span>&nbsp;<span class="op" id="3577464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577469">c</span><span class="op" id="3577470">.</span><span class="ident" id="3577471">state</span>&nbsp;<span class="op" id="3577477">=</span>&nbsp;<span class="ident" id="3577479">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577491">return</span>&nbsp;<span class="ident" id="3577498">c</span><span class="op" id="3577499">,</span>&nbsp;<span class="ident" id="3577501">i</span>&nbsp;<span class="op" id="3577503">+</span>&nbsp;<span class="num" id="3577505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577513">c</span><span class="op" id="3577514">,</span>&nbsp;<span class="ident" id="3577516">_</span>&nbsp;<span class="op" id="3577518">=</span>&nbsp;<span class="ident" id="3577520">tURL</span><span class="op" id="3577524">(</span><span class="ident" id="3577525">c</span><span class="op" id="3577526">,</span>&nbsp;<span class="ident" id="3577528">decodeCSS</span><span class="op" id="3577537">(</span><span class="ident" id="3577538">s</span><span class="op" id="3577539">[</span><span class="op" id="3577540">:</span><span class="ident" id="3577541">i</span><span class="op" id="3577542">+</span><span class="num" id="3577543">1</span><span class="op" id="3577544">]</span><span class="op" id="3577545">)</span><span class="op" id="3577546">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3577550">k</span>&nbsp;<span class="op" id="3577552">=</span>&nbsp;<span class="ident" id="3577554">i</span>&nbsp;<span class="op" id="3577556">+</span>&nbsp;<span class="num" id="3577558">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3577561">}</span><br>
<span class="lineno"></span><span class="op" id="3577563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3577566">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="3577632">func</span>&nbsp;<span class="ident" id="3577637">tError</span><span class="op" id="3577643">(</span><span class="ident" id="3577644">c</span>&nbsp;<span class="ident" id="3577646">context</span><span class="op" id="3577653">,</span>&nbsp;<span class="ident" id="3577655">s</span>&nbsp;<span class="op" id="3577657">[</span><span class="op" id="3577658">]</span><span class="builtintype" id="3577659">byte</span><span class="op" id="3577663">)</span>&nbsp;<span class="op" id="3577665">(</span><span class="ident" id="3577666">context</span><span class="op" id="3577673">,</span>&nbsp;<span class="builtintype" id="3577675">int</span><span class="op" id="3577678">)</span>&nbsp;<span class="op" id="3577680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577683">return</span>&nbsp;<span class="ident" id="3577690">c</span><span class="op" id="3577691">,</span>&nbsp;<span class="builtinfunc" id="3577693">len</span><span class="op" id="3577696">(</span><span class="ident" id="3577697">s</span><span class="op" id="3577698">)</span><br>
<span class="lineno"></span><span class="op" id="3577700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3577703">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="3577779">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3577848">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="3577921">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="3577937">func</span>&nbsp;<span class="ident" id="3577942">eatAttrName</span><span class="op" id="3577953">(</span><span class="ident" id="3577954">s</span>&nbsp;<span class="op" id="3577956">[</span><span class="op" id="3577957">]</span><span class="builtintype" id="3577958">byte</span><span class="op" id="3577962">,</span>&nbsp;<span class="ident" id="3577964">i</span>&nbsp;<span class="builtintype" id="3577966">int</span><span class="op" id="3577969">)</span>&nbsp;<span class="op" id="3577971">(</span><span class="builtintype" id="3577972">int</span><span class="op" id="3577975">,</span>&nbsp;<span class="op" id="3577977">*</span><span class="ident" id="3577978">Error</span><span class="op" id="3577983">)</span>&nbsp;<span class="op" id="3577985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3577988">for</span>&nbsp;<span class="ident" id="3577992">j</span>&nbsp;<span class="op" id="3577994">:=</span>&nbsp;<span class="ident" id="3577997">i</span><span class="op" id="3577998">;</span>&nbsp;<span class="ident" id="3578000">j</span>&nbsp;<span class="op" id="3578002">&lt;</span>&nbsp;<span class="builtinfunc" id="3578004">len</span><span class="op" id="3578007">(</span><span class="ident" id="3578008">s</span><span class="op" id="3578009">)</span><span class="op" id="3578010">;</span>&nbsp;<span class="ident" id="3578012">j</span><span class="op" id="3578013">++</span>&nbsp;<span class="op" id="3578016">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578020">switch</span>&nbsp;<span class="ident" id="3578027">s</span><span class="op" id="3578028">[</span><span class="ident" id="3578029">j</span><span class="op" id="3578030">]</span>&nbsp;<span class="op" id="3578032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578036">case</span>&nbsp;<span class="string" id="3578041">&#39;&nbsp;&#39;</span><span class="op" id="3578044">,</span>&nbsp;<span class="string" id="3578046">&#39;\t&#39;</span><span class="op" id="3578050">,</span>&nbsp;<span class="string" id="3578052">&#39;\n&#39;</span><span class="op" id="3578056">,</span>&nbsp;<span class="string" id="3578058">&#39;\f&#39;</span><span class="op" id="3578062">,</span>&nbsp;<span class="string" id="3578064">&#39;\r&#39;</span><span class="op" id="3578068">,</span>&nbsp;<span class="string" id="3578070">&#39;=&#39;</span><span class="op" id="3578073">,</span>&nbsp;<span class="string" id="3578075">&#39;&gt;&#39;</span><span class="op" id="3578078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578083">return</span>&nbsp;<span class="ident" id="3578090">j</span><span class="op" id="3578091">,</span>&nbsp;<span class="ident" id="3578093">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578099">case</span>&nbsp;<span class="string" id="3578104">&#39;\&#39;&#39;</span><span class="op" id="3578108">,</span>&nbsp;<span class="string" id="3578110">&#39;&#34;&#39;</span><span class="op" id="3578113">,</span>&nbsp;<span class="string" id="3578115">&#39;&lt;&#39;</span><span class="op" id="3578118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578123">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578178">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578234">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578260">return</span>&nbsp;<span class="op" id="3578267">-</span><span class="num" id="3578268">1</span><span class="op" id="3578269">,</span>&nbsp;<span class="ident" id="3578271">errorf</span><span class="op" id="3578277">(</span><span class="ident" id="3578278">ErrBadHTML</span><span class="op" id="3578288">,</span>&nbsp;<span class="ident" id="3578290">nil</span><span class="op" id="3578293">,</span>&nbsp;<span class="num" id="3578295">0</span><span class="op" id="3578296">,</span>&nbsp;<span class="string" id="3578298">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="3578327">,</span>&nbsp;<span class="ident" id="3578329">s</span><span class="op" id="3578330">[</span><span class="ident" id="3578331">j</span><span class="op" id="3578332">:</span><span class="ident" id="3578333">j</span><span class="op" id="3578334">+</span><span class="num" id="3578335">1</span><span class="op" id="3578336">]</span><span class="op" id="3578337">,</span>&nbsp;<span class="ident" id="3578339">s</span><span class="op" id="3578340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578344">default</span><span class="op" id="3578351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3578356">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3578371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578374">return</span>&nbsp;<span class="builtinfunc" id="3578381">len</span><span class="op" id="3578384">(</span><span class="ident" id="3578385">s</span><span class="op" id="3578386">)</span><span class="op" id="3578387">,</span>&nbsp;<span class="ident" id="3578389">nil</span><br>
<span class="lineno"></span><span class="op" id="3578393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="3578396">var</span>&nbsp;<span class="ident" id="3578400">elementNameMap</span>&nbsp;<span class="op" id="3578415">=</span>&nbsp;<span class="keyword" id="3578417">map</span><span class="op" id="3578420">[</span><span class="builtintype" id="3578421">string</span><span class="op" id="3578427">]</span><span class="ident" id="3578428">element</span><span class="op" id="3578435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3578438">&#34;script&#34;</span><span class="op" id="3578446">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3578450">elementScript</span><span class="op" id="3578463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3578466">&#34;style&#34;</span><span class="op" id="3578473">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3578478">elementStyle</span><span class="op" id="3578490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3578493">&#34;textarea&#34;</span><span class="op" id="3578503">:</span>&nbsp;<span class="ident" id="3578505">elementTextarea</span><span class="op" id="3578520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3578523">&#34;title&#34;</span><span class="op" id="3578530">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3578535">elementTitle</span><span class="op" id="3578547">,</span><br>
<span class="lineno">505</span><span class="op" id="3578549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578552">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="3578604">func</span>&nbsp;<span class="ident" id="3578609">asciiAlpha</span><span class="op" id="3578619">(</span><span class="ident" id="3578620">c</span>&nbsp;<span class="builtintype" id="3578622">byte</span><span class="op" id="3578626">)</span>&nbsp;<span class="builtintype" id="3578628">bool</span>&nbsp;<span class="op" id="3578633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578636">return</span>&nbsp;<span class="string" id="3578643">&#39;A&#39;</span>&nbsp;<span class="op" id="3578647">&lt;=</span>&nbsp;<span class="ident" id="3578650">c</span>&nbsp;<span class="op" id="3578652">&amp;&amp;</span>&nbsp;<span class="ident" id="3578655">c</span>&nbsp;<span class="op" id="3578657">&lt;=</span>&nbsp;<span class="string" id="3578660">&#39;Z&#39;</span>&nbsp;<span class="op" id="3578664">||</span>&nbsp;<span class="string" id="3578667">&#39;a&#39;</span>&nbsp;<span class="op" id="3578671">&lt;=</span>&nbsp;<span class="ident" id="3578674">c</span>&nbsp;<span class="op" id="3578676">&amp;&amp;</span>&nbsp;<span class="ident" id="3578679">c</span>&nbsp;<span class="op" id="3578681">&lt;=</span>&nbsp;<span class="string" id="3578684">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="3578688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578691">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="3578755">func</span>&nbsp;<span class="ident" id="3578760">asciiAlphaNum</span><span class="op" id="3578773">(</span><span class="ident" id="3578774">c</span>&nbsp;<span class="builtintype" id="3578776">byte</span><span class="op" id="3578780">)</span>&nbsp;<span class="builtintype" id="3578782">bool</span>&nbsp;<span class="op" id="3578787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578790">return</span>&nbsp;<span class="ident" id="3578797">asciiAlpha</span><span class="op" id="3578807">(</span><span class="ident" id="3578808">c</span><span class="op" id="3578809">)</span>&nbsp;<span class="op" id="3578811">||</span>&nbsp;<span class="string" id="3578814">&#39;0&#39;</span>&nbsp;<span class="op" id="3578818">&lt;=</span>&nbsp;<span class="ident" id="3578821">c</span>&nbsp;<span class="op" id="3578823">&amp;&amp;</span>&nbsp;<span class="ident" id="3578826">c</span>&nbsp;<span class="op" id="3578828">&lt;=</span>&nbsp;<span class="string" id="3578831">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="3578835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3578838">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3578923">func</span>&nbsp;<span class="ident" id="3578928">eatTagName</span><span class="op" id="3578938">(</span><span class="ident" id="3578939">s</span>&nbsp;<span class="op" id="3578941">[</span><span class="op" id="3578942">]</span><span class="builtintype" id="3578943">byte</span><span class="op" id="3578947">,</span>&nbsp;<span class="ident" id="3578949">i</span>&nbsp;<span class="builtintype" id="3578951">int</span><span class="op" id="3578954">)</span>&nbsp;<span class="op" id="3578956">(</span><span class="builtintype" id="3578957">int</span><span class="op" id="3578960">,</span>&nbsp;<span class="ident" id="3578962">element</span><span class="op" id="3578969">)</span>&nbsp;<span class="op" id="3578971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3578974">if</span>&nbsp;<span class="ident" id="3578977">i</span>&nbsp;<span class="op" id="3578979">==</span>&nbsp;<span class="builtinfunc" id="3578982">len</span><span class="op" id="3578985">(</span><span class="ident" id="3578986">s</span><span class="op" id="3578987">)</span>&nbsp;<span class="op" id="3578989">||</span>&nbsp;<span class="op" id="3578992">!</span><span class="ident" id="3578993">asciiAlpha</span><span class="op" id="3579003">(</span><span class="ident" id="3579004">s</span><span class="op" id="3579005">[</span><span class="ident" id="3579006">i</span><span class="op" id="3579007">]</span><span class="op" id="3579008">)</span>&nbsp;<span class="op" id="3579010">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579014">return</span>&nbsp;<span class="ident" id="3579021">i</span><span class="op" id="3579022">,</span>&nbsp;<span class="ident" id="3579024">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579040">j</span>&nbsp;<span class="op" id="3579042">:=</span>&nbsp;<span class="ident" id="3579045">i</span>&nbsp;<span class="op" id="3579047">+</span>&nbsp;<span class="num" id="3579049">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579052">for</span>&nbsp;<span class="ident" id="3579056">j</span>&nbsp;<span class="op" id="3579058">&lt;</span>&nbsp;<span class="builtinfunc" id="3579060">len</span><span class="op" id="3579063">(</span><span class="ident" id="3579064">s</span><span class="op" id="3579065">)</span>&nbsp;<span class="op" id="3579067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579071">x</span>&nbsp;<span class="op" id="3579073">:=</span>&nbsp;<span class="ident" id="3579076">s</span><span class="op" id="3579077">[</span><span class="ident" id="3579078">j</span><span class="op" id="3579079">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579083">if</span>&nbsp;<span class="ident" id="3579086">asciiAlphaNum</span><span class="op" id="3579099">(</span><span class="ident" id="3579100">x</span><span class="op" id="3579101">)</span>&nbsp;<span class="op" id="3579103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579108">j</span><span class="op" id="3579109">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579115">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579130">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579187">if</span>&nbsp;<span class="op" id="3579190">(</span><span class="ident" id="3579191">x</span>&nbsp;<span class="op" id="3579193">==</span>&nbsp;<span class="string" id="3579196">&#39;:&#39;</span>&nbsp;<span class="op" id="3579200">||</span>&nbsp;<span class="ident" id="3579203">x</span>&nbsp;<span class="op" id="3579205">==</span>&nbsp;<span class="string" id="3579208">&#39;-&#39;</span><span class="op" id="3579211">)</span>&nbsp;<span class="op" id="3579213">&amp;&amp;</span>&nbsp;<span class="ident" id="3579216">j</span><span class="op" id="3579217">+</span><span class="num" id="3579218">1</span>&nbsp;<span class="op" id="3579220">&lt;</span>&nbsp;<span class="builtinfunc" id="3579222">len</span><span class="op" id="3579225">(</span><span class="ident" id="3579226">s</span><span class="op" id="3579227">)</span>&nbsp;<span class="op" id="3579229">&amp;&amp;</span>&nbsp;<span class="ident" id="3579232">asciiAlphaNum</span><span class="op" id="3579245">(</span><span class="ident" id="3579246">s</span><span class="op" id="3579247">[</span><span class="ident" id="3579248">j</span><span class="op" id="3579249">+</span><span class="num" id="3579250">1</span><span class="op" id="3579251">]</span><span class="op" id="3579252">)</span>&nbsp;<span class="op" id="3579254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3579259">j</span>&nbsp;<span class="op" id="3579261">+=</span>&nbsp;<span class="num" id="3579264">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579284">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579294">return</span>&nbsp;<span class="ident" id="3579301">j</span><span class="op" id="3579302">,</span>&nbsp;<span class="ident" id="3579304">elementNameMap</span><span class="op" id="3579318">[</span><span class="ident" id="3579319">strings</span><span class="op" id="3579326">.</span><span class="ident" id="3579327">ToLower</span><span class="op" id="3579334">(</span><span class="builtintype" id="3579335">string</span><span class="op" id="3579341">(</span><span class="ident" id="3579342">s</span><span class="op" id="3579343">[</span><span class="ident" id="3579344">i</span><span class="op" id="3579345">:</span><span class="ident" id="3579346">j</span><span class="op" id="3579347">]</span><span class="op" id="3579348">)</span><span class="op" id="3579349">)</span><span class="op" id="3579350">]</span><br>
<span class="lineno"></span><span class="op" id="3579352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3579355">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="3579427">func</span>&nbsp;<span class="ident" id="3579432">eatWhiteSpace</span><span class="op" id="3579445">(</span><span class="ident" id="3579446">s</span>&nbsp;<span class="op" id="3579448">[</span><span class="op" id="3579449">]</span><span class="builtintype" id="3579450">byte</span><span class="op" id="3579454">,</span>&nbsp;<span class="ident" id="3579456">i</span>&nbsp;<span class="builtintype" id="3579458">int</span><span class="op" id="3579461">)</span>&nbsp;<span class="builtintype" id="3579463">int</span>&nbsp;<span class="op" id="3579467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579470">for</span>&nbsp;<span class="ident" id="3579474">j</span>&nbsp;<span class="op" id="3579476">:=</span>&nbsp;<span class="ident" id="3579479">i</span><span class="op" id="3579480">;</span>&nbsp;<span class="ident" id="3579482">j</span>&nbsp;<span class="op" id="3579484">&lt;</span>&nbsp;<span class="builtinfunc" id="3579486">len</span><span class="op" id="3579489">(</span><span class="ident" id="3579490">s</span><span class="op" id="3579491">)</span><span class="op" id="3579492">;</span>&nbsp;<span class="ident" id="3579494">j</span><span class="op" id="3579495">++</span>&nbsp;<span class="op" id="3579498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579502">switch</span>&nbsp;<span class="ident" id="3579509">s</span><span class="op" id="3579510">[</span><span class="ident" id="3579511">j</span><span class="op" id="3579512">]</span>&nbsp;<span class="op" id="3579514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579518">case</span>&nbsp;<span class="string" id="3579523">&#39;&nbsp;&#39;</span><span class="op" id="3579526">,</span>&nbsp;<span class="string" id="3579528">&#39;\t&#39;</span><span class="op" id="3579532">,</span>&nbsp;<span class="string" id="3579534">&#39;\n&#39;</span><span class="op" id="3579538">,</span>&nbsp;<span class="string" id="3579540">&#39;\f&#39;</span><span class="op" id="3579544">,</span>&nbsp;<span class="string" id="3579546">&#39;\r&#39;</span><span class="op" id="3579550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3579555">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579567">default</span><span class="op" id="3579574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579579">return</span>&nbsp;<span class="ident" id="3579586">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3579593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3579596">return</span>&nbsp;<span class="builtinfunc" id="3579603">len</span><span class="op" id="3579606">(</span><span class="ident" id="3579607">s</span><span class="op" id="3579608">)</span><br>
<span class="lineno">550</span><span class="op" id="3579610">}</span>
</div>
</body>
</html>
