<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2210530">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2210585">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2210639">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2210690">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2210760">package</span>&nbsp;<span class="ident" id="2210768">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2210772">import</span>&nbsp;<span class="op" id="2210779">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2210782">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2210792">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2210803">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2210814">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2210821">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2210824">func</span>&nbsp;<span class="op" id="2210829">(</span><span class="ident" id="2210830">p</span>&nbsp;<span class="op" id="2210832">*</span><span class="ident" id="2210833">Process</span><span class="op" id="2210840">)</span>&nbsp;<span class="ident" id="2210842">wait</span><span class="op" id="2210846">(</span><span class="op" id="2210847">)</span>&nbsp;<span class="op" id="2210849">(</span><span class="ident" id="2210850">ps</span>&nbsp;<span class="op" id="2210853">*</span><span class="ident" id="2210854">ProcessState</span><span class="op" id="2210866">,</span>&nbsp;<span class="ident" id="2210868">err</span>&nbsp;<span class="builtintype" id="2210872">error</span><span class="op" id="2210877">)</span>&nbsp;<span class="op" id="2210879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210882">if</span>&nbsp;<span class="ident" id="2210885">p</span><span class="op" id="2210886">.</span><span class="ident" id="2210887">Pid</span>&nbsp;<span class="op" id="2210891">==</span>&nbsp;<span class="op" id="2210894">-</span><span class="num" id="2210895">1</span>&nbsp;<span class="op" id="2210897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210901">return</span>&nbsp;<span class="ident" id="2210908">nil</span><span class="op" id="2210911">,</span>&nbsp;<span class="ident" id="2210913">syscall</span><span class="op" id="2210920">.</span><span class="ident" id="2210921">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210929">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210932">var</span>&nbsp;<span class="ident" id="2210936">status</span>&nbsp;<span class="ident" id="2210943">syscall</span><span class="op" id="2210950">.</span><span class="ident" id="2210951">WaitStatus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210963">var</span>&nbsp;<span class="ident" id="2210967">rusage</span>&nbsp;<span class="ident" id="2210974">syscall</span><span class="op" id="2210981">.</span><span class="ident" id="2210982">Rusage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210990">pid1</span><span class="op" id="2210994">,</span>&nbsp;<span class="ident" id="2210996">e</span>&nbsp;<span class="op" id="2210998">:=</span>&nbsp;<span class="ident" id="2211001">syscall</span><span class="op" id="2211008">.</span><span class="ident" id="2211009">Wait4</span><span class="op" id="2211014">(</span><span class="ident" id="2211015">p</span><span class="op" id="2211016">.</span><span class="ident" id="2211017">Pid</span><span class="op" id="2211020">,</span>&nbsp;<span class="op" id="2211022">&amp;</span><span class="ident" id="2211023">status</span><span class="op" id="2211029">,</span>&nbsp;<span class="num" id="2211031">0</span><span class="op" id="2211032">,</span>&nbsp;<span class="op" id="2211034">&amp;</span><span class="ident" id="2211035">rusage</span><span class="op" id="2211041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211044">if</span>&nbsp;<span class="ident" id="2211047">e</span>&nbsp;<span class="op" id="2211049">!=</span>&nbsp;<span class="ident" id="2211052">nil</span>&nbsp;<span class="op" id="2211056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211060">return</span>&nbsp;<span class="ident" id="2211067">nil</span><span class="op" id="2211070">,</span>&nbsp;<span class="ident" id="2211072">NewSyscallError</span><span class="op" id="2211087">(</span><span class="string" id="2211088">&#34;wait&#34;</span><span class="op" id="2211094">,</span>&nbsp;<span class="ident" id="2211096">e</span><span class="op" id="2211097">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211103">if</span>&nbsp;<span class="ident" id="2211106">pid1</span>&nbsp;<span class="op" id="2211111">!=</span>&nbsp;<span class="num" id="2211114">0</span>&nbsp;<span class="op" id="2211116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211120">p</span><span class="op" id="2211121">.</span><span class="ident" id="2211122">setDone</span><span class="op" id="2211129">(</span><span class="op" id="2211130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211136">ps</span>&nbsp;<span class="op" id="2211139">=</span>&nbsp;<span class="op" id="2211141">&amp;</span><span class="ident" id="2211142">ProcessState</span><span class="op" id="2211154">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211158">pid</span><span class="op" id="2211161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2211166">pid1</span><span class="op" id="2211170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211174">status</span><span class="op" id="2211180">:</span>&nbsp;<span class="ident" id="2211182">status</span><span class="op" id="2211188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211192">rusage</span><span class="op" id="2211198">:</span>&nbsp;<span class="op" id="2211200">&amp;</span><span class="ident" id="2211201">rusage</span><span class="op" id="2211207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211213">return</span>&nbsp;<span class="ident" id="2211220">ps</span><span class="op" id="2211222">,</span>&nbsp;<span class="ident" id="2211224">nil</span><br>
<span class="lineno">35</span><span class="op" id="2211228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2211231">var</span>&nbsp;<span class="ident" id="2211235">errFinished</span>&nbsp;<span class="op" id="2211247">=</span>&nbsp;<span class="ident" id="2211249">errors</span><span class="op" id="2211255">.</span><span class="ident" id="2211256">New</span><span class="op" id="2211259">(</span><span class="string" id="2211260">&#34;os:&nbsp;process&nbsp;already&nbsp;finished&#34;</span><span class="op" id="2211290">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2211293">func</span>&nbsp;<span class="op" id="2211298">(</span><span class="ident" id="2211299">p</span>&nbsp;<span class="op" id="2211301">*</span><span class="ident" id="2211302">Process</span><span class="op" id="2211309">)</span>&nbsp;<span class="ident" id="2211311">signal</span><span class="op" id="2211317">(</span><span class="ident" id="2211318">sig</span>&nbsp;<span class="ident" id="2211322">Signal</span><span class="op" id="2211328">)</span>&nbsp;<span class="builtintype" id="2211330">error</span>&nbsp;<span class="op" id="2211336">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211339">if</span>&nbsp;<span class="ident" id="2211342">p</span><span class="op" id="2211343">.</span><span class="ident" id="2211344">Pid</span>&nbsp;<span class="op" id="2211348">==</span>&nbsp;<span class="op" id="2211351">-</span><span class="num" id="2211352">1</span>&nbsp;<span class="op" id="2211354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211358">return</span>&nbsp;<span class="ident" id="2211365">errors</span><span class="op" id="2211371">.</span><span class="ident" id="2211372">New</span><span class="op" id="2211375">(</span><span class="string" id="2211376">&#34;os:&nbsp;process&nbsp;already&nbsp;released&#34;</span><span class="op" id="2211406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211412">if</span>&nbsp;<span class="ident" id="2211415">p</span><span class="op" id="2211416">.</span><span class="ident" id="2211417">Pid</span>&nbsp;<span class="op" id="2211421">==</span>&nbsp;<span class="num" id="2211424">0</span>&nbsp;<span class="op" id="2211426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211430">return</span>&nbsp;<span class="ident" id="2211437">errors</span><span class="op" id="2211443">.</span><span class="ident" id="2211444">New</span><span class="op" id="2211447">(</span><span class="string" id="2211448">&#34;os:&nbsp;process&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="2211477">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211483">if</span>&nbsp;<span class="ident" id="2211486">p</span><span class="op" id="2211487">.</span><span class="ident" id="2211488">done</span><span class="op" id="2211492">(</span><span class="op" id="2211493">)</span>&nbsp;<span class="op" id="2211495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211499">return</span>&nbsp;<span class="ident" id="2211506">errFinished</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211522">s</span><span class="op" id="2211523">,</span>&nbsp;<span class="ident" id="2211525">ok</span>&nbsp;<span class="op" id="2211528">:=</span>&nbsp;<span class="ident" id="2211531">sig</span><span class="op" id="2211534">.</span><span class="op" id="2211535">(</span><span class="ident" id="2211536">syscall</span><span class="op" id="2211543">.</span><span class="ident" id="2211544">Signal</span><span class="op" id="2211550">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211553">if</span>&nbsp;<span class="op" id="2211556">!</span><span class="ident" id="2211557">ok</span>&nbsp;<span class="op" id="2211560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211564">return</span>&nbsp;<span class="ident" id="2211571">errors</span><span class="op" id="2211577">.</span><span class="ident" id="2211578">New</span><span class="op" id="2211581">(</span><span class="string" id="2211582">&#34;os:&nbsp;unsupported&nbsp;signal&nbsp;type&#34;</span><span class="op" id="2211611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211617">if</span>&nbsp;<span class="ident" id="2211620">e</span>&nbsp;<span class="op" id="2211622">:=</span>&nbsp;<span class="ident" id="2211625">syscall</span><span class="op" id="2211632">.</span><span class="ident" id="2211633">Kill</span><span class="op" id="2211637">(</span><span class="ident" id="2211638">p</span><span class="op" id="2211639">.</span><span class="ident" id="2211640">Pid</span><span class="op" id="2211643">,</span>&nbsp;<span class="ident" id="2211645">s</span><span class="op" id="2211646">)</span><span class="op" id="2211647">;</span>&nbsp;<span class="ident" id="2211649">e</span>&nbsp;<span class="op" id="2211651">!=</span>&nbsp;<span class="ident" id="2211654">nil</span>&nbsp;<span class="op" id="2211658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211662">if</span>&nbsp;<span class="ident" id="2211665">e</span>&nbsp;<span class="op" id="2211667">==</span>&nbsp;<span class="ident" id="2211670">syscall</span><span class="op" id="2211677">.</span><span class="ident" id="2211678">ESRCH</span>&nbsp;<span class="op" id="2211684">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211689">return</span>&nbsp;<span class="ident" id="2211696">errFinished</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211714">return</span>&nbsp;<span class="ident" id="2211721">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211727">return</span>&nbsp;<span class="ident" id="2211734">nil</span><br>
<span class="lineno">60</span><span class="op" id="2211738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2211741">func</span>&nbsp;<span class="op" id="2211746">(</span><span class="ident" id="2211747">p</span>&nbsp;<span class="op" id="2211749">*</span><span class="ident" id="2211750">Process</span><span class="op" id="2211757">)</span>&nbsp;<span class="ident" id="2211759">release</span><span class="op" id="2211766">(</span><span class="op" id="2211767">)</span>&nbsp;<span class="builtintype" id="2211769">error</span>&nbsp;<span class="op" id="2211775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211778">//&nbsp;NOOP&nbsp;for&nbsp;unix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211797">p</span><span class="op" id="2211798">.</span><span class="ident" id="2211799">Pid</span>&nbsp;<span class="op" id="2211803">=</span>&nbsp;<span class="op" id="2211805">-</span><span class="num" id="2211806">1</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211809">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211845">runtime</span><span class="op" id="2211852">.</span><span class="ident" id="2211853">SetFinalizer</span><span class="op" id="2211865">(</span><span class="ident" id="2211866">p</span><span class="op" id="2211867">,</span>&nbsp;<span class="ident" id="2211869">nil</span><span class="op" id="2211872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211875">return</span>&nbsp;<span class="ident" id="2211882">nil</span><br>
<span class="lineno"></span><span class="op" id="2211886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2211889">func</span>&nbsp;<span class="ident" id="2211894">findProcess</span><span class="op" id="2211905">(</span><span class="ident" id="2211906">pid</span>&nbsp;<span class="builtintype" id="2211910">int</span><span class="op" id="2211913">)</span>&nbsp;<span class="op" id="2211915">(</span><span class="ident" id="2211916">p</span>&nbsp;<span class="op" id="2211918">*</span><span class="ident" id="2211919">Process</span><span class="op" id="2211926">,</span>&nbsp;<span class="ident" id="2211928">err</span>&nbsp;<span class="builtintype" id="2211932">error</span><span class="op" id="2211937">)</span>&nbsp;<span class="op" id="2211939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211942">//&nbsp;NOOP&nbsp;for&nbsp;unix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211961">return</span>&nbsp;<span class="ident" id="2211968">newProcess</span><span class="op" id="2211978">(</span><span class="ident" id="2211979">pid</span><span class="op" id="2211982">,</span>&nbsp;<span class="num" id="2211984">0</span><span class="op" id="2211985">)</span><span class="op" id="2211986">,</span>&nbsp;<span class="ident" id="2211988">nil</span><br>
<span class="lineno"></span><span class="op" id="2211992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2211995">func</span>&nbsp;<span class="op" id="2212000">(</span><span class="ident" id="2212001">p</span>&nbsp;<span class="op" id="2212003">*</span><span class="ident" id="2212004">ProcessState</span><span class="op" id="2212016">)</span>&nbsp;<span class="ident" id="2212018">userTime</span><span class="op" id="2212026">(</span><span class="op" id="2212027">)</span>&nbsp;<span class="ident" id="2212029">time</span><span class="op" id="2212033">.</span><span class="ident" id="2212034">Duration</span>&nbsp;<span class="op" id="2212043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212046">return</span>&nbsp;<span class="ident" id="2212053">time</span><span class="op" id="2212057">.</span><span class="ident" id="2212058">Duration</span><span class="op" id="2212066">(</span><span class="ident" id="2212067">p</span><span class="op" id="2212068">.</span><span class="ident" id="2212069">rusage</span><span class="op" id="2212075">.</span><span class="ident" id="2212076">Utime</span><span class="op" id="2212081">.</span><span class="ident" id="2212082">Nano</span><span class="op" id="2212086">(</span><span class="op" id="2212087">)</span><span class="op" id="2212088">)</span>&nbsp;<span class="op" id="2212090">*</span>&nbsp;<span class="ident" id="2212092">time</span><span class="op" id="2212096">.</span><span class="ident" id="2212097">Nanosecond</span><br>
<span class="lineno"></span><span class="op" id="2212108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2212111">func</span>&nbsp;<span class="op" id="2212116">(</span><span class="ident" id="2212117">p</span>&nbsp;<span class="op" id="2212119">*</span><span class="ident" id="2212120">ProcessState</span><span class="op" id="2212132">)</span>&nbsp;<span class="ident" id="2212134">systemTime</span><span class="op" id="2212144">(</span><span class="op" id="2212145">)</span>&nbsp;<span class="ident" id="2212147">time</span><span class="op" id="2212151">.</span><span class="ident" id="2212152">Duration</span>&nbsp;<span class="op" id="2212161">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212164">return</span>&nbsp;<span class="ident" id="2212171">time</span><span class="op" id="2212175">.</span><span class="ident" id="2212176">Duration</span><span class="op" id="2212184">(</span><span class="ident" id="2212185">p</span><span class="op" id="2212186">.</span><span class="ident" id="2212187">rusage</span><span class="op" id="2212193">.</span><span class="ident" id="2212194">Stime</span><span class="op" id="2212199">.</span><span class="ident" id="2212200">Nano</span><span class="op" id="2212204">(</span><span class="op" id="2212205">)</span><span class="op" id="2212206">)</span>&nbsp;<span class="op" id="2212208">*</span>&nbsp;<span class="ident" id="2212210">time</span><span class="op" id="2212214">.</span><span class="ident" id="2212215">Nanosecond</span><br>
<span class="lineno"></span><span class="op" id="2212226">}</span>
</div>
</body>
</html>
