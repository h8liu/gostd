<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html" class="current">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4656979">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4657034">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4657088">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4657139">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4657218">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4657244">package</span>&nbsp;<span class="ident" id="4657252">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657259">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4657274">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4657329">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4657375">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4657399">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4657456">import</span>&nbsp;<span class="op" id="4657463">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4657466">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4657476">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4657495">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4657512">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4657518">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4657529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657532">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4657577">type</span>&nbsp;<span class="ident" id="4657582">PublicKey</span>&nbsp;<span class="keyword" id="4657592">struct</span>&nbsp;<span class="op" id="4657599">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657602">elliptic</span><span class="op" id="4657610">.</span><span class="ident" id="4657611">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657618">X</span><span class="op" id="4657619">,</span>&nbsp;<span class="ident" id="4657621">Y</span>&nbsp;<span class="op" id="4657623">*</span><span class="ident" id="4657624">big</span><span class="op" id="4657627">.</span><span class="ident" id="4657628">Int</span><br>
<span class="lineno"></span><span class="op" id="4657632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657635">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4657681">type</span>&nbsp;<span class="ident" id="4657686">PrivateKey</span>&nbsp;<span class="keyword" id="4657697">struct</span>&nbsp;<span class="op" id="4657704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657707">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657718">D</span>&nbsp;<span class="op" id="4657720">*</span><span class="ident" id="4657721">big</span><span class="op" id="4657724">.</span><span class="ident" id="4657725">Int</span><br>
<span class="lineno"></span><span class="op" id="4657729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4657732">type</span>&nbsp;<span class="ident" id="4657737">ecdsaSignature</span>&nbsp;<span class="keyword" id="4657752">struct</span>&nbsp;<span class="op" id="4657759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657762">R</span><span class="op" id="4657763">,</span>&nbsp;<span class="ident" id="4657765">S</span>&nbsp;<span class="op" id="4657767">*</span><span class="ident" id="4657768">big</span><span class="op" id="4657771">.</span><span class="ident" id="4657772">Int</span><br>
<span class="lineno"></span><span class="op" id="4657776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657779">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4657835">func</span>&nbsp;<span class="op" id="4657840">(</span><span class="ident" id="4657841">priv</span>&nbsp;<span class="op" id="4657846">*</span><span class="ident" id="4657847">PrivateKey</span><span class="op" id="4657857">)</span>&nbsp;<span class="ident" id="4657859">Public</span><span class="op" id="4657865">(</span><span class="op" id="4657866">)</span>&nbsp;<span class="ident" id="4657868">crypto</span><span class="op" id="4657874">.</span><span class="ident" id="4657875">PublicKey</span>&nbsp;<span class="op" id="4657885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657888">return</span>&nbsp;<span class="op" id="4657895">&amp;</span><span class="ident" id="4657896">priv</span><span class="op" id="4657900">.</span><span class="ident" id="4657901">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4657911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657914">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4657988">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4658066">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4658143">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4658156">func</span>&nbsp;<span class="op" id="4658161">(</span><span class="ident" id="4658162">priv</span>&nbsp;<span class="op" id="4658167">*</span><span class="ident" id="4658168">PrivateKey</span><span class="op" id="4658178">)</span>&nbsp;<span class="ident" id="4658180">Sign</span><span class="op" id="4658184">(</span><span class="ident" id="4658185">rand</span>&nbsp;<span class="ident" id="4658190">io</span><span class="op" id="4658192">.</span><span class="ident" id="4658193">Reader</span><span class="op" id="4658199">,</span>&nbsp;<span class="ident" id="4658201">msg</span>&nbsp;<span class="op" id="4658205">[</span><span class="op" id="4658206">]</span><span class="builtintype" id="4658207">byte</span><span class="op" id="4658211">,</span>&nbsp;<span class="ident" id="4658213">opts</span>&nbsp;<span class="ident" id="4658218">crypto</span><span class="op" id="4658224">.</span><span class="ident" id="4658225">SignerOpts</span><span class="op" id="4658235">)</span>&nbsp;<span class="op" id="4658237">(</span><span class="op" id="4658238">[</span><span class="op" id="4658239">]</span><span class="builtintype" id="4658240">byte</span><span class="op" id="4658244">,</span>&nbsp;<span class="builtintype" id="4658246">error</span><span class="op" id="4658251">)</span>&nbsp;<span class="op" id="4658253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658256">r</span><span class="op" id="4658257">,</span>&nbsp;<span class="ident" id="4658259">s</span><span class="op" id="4658260">,</span>&nbsp;<span class="ident" id="4658262">err</span>&nbsp;<span class="op" id="4658266">:=</span>&nbsp;<span class="ident" id="4658269">Sign</span><span class="op" id="4658273">(</span><span class="ident" id="4658274">rand</span><span class="op" id="4658278">,</span>&nbsp;<span class="ident" id="4658280">priv</span><span class="op" id="4658284">,</span>&nbsp;<span class="ident" id="4658286">msg</span><span class="op" id="4658289">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658292">if</span>&nbsp;<span class="ident" id="4658295">err</span>&nbsp;<span class="op" id="4658299">!=</span>&nbsp;<span class="builtintype" id="4658302">nil</span>&nbsp;<span class="op" id="4658306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658310">return</span>&nbsp;<span class="builtintype" id="4658317">nil</span><span class="op" id="4658320">,</span>&nbsp;<span class="ident" id="4658322">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658331">return</span>&nbsp;<span class="ident" id="4658338">asn1</span><span class="op" id="4658342">.</span><span class="ident" id="4658343">Marshal</span><span class="op" id="4658350">(</span><span class="ident" id="4658351">ecdsaSignature</span><span class="op" id="4658365">{</span><span class="ident" id="4658366">r</span><span class="op" id="4658367">,</span>&nbsp;<span class="ident" id="4658369">s</span><span class="op" id="4658370">}</span><span class="op" id="4658371">)</span><br>
<span class="lineno">55</span><span class="op" id="4658373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4658376">var</span>&nbsp;<span class="ident" id="4658380">one</span>&nbsp;<span class="op" id="4658384">=</span>&nbsp;<span class="builtinfunc" id="4658386">new</span><span class="op" id="4658389">(</span><span class="ident" id="4658390">big</span><span class="op" id="4658393">.</span><span class="ident" id="4658394">Int</span><span class="op" id="4658397">)</span><span class="op" id="4658398">.</span><span class="ident" id="4658399">SetInt64</span><span class="op" id="4658407">(</span><span class="num" id="4658408">1</span><span class="op" id="4658409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4658412">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4658491">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4658542">func</span>&nbsp;<span class="ident" id="4658547">randFieldElement</span><span class="op" id="4658563">(</span><span class="ident" id="4658564">c</span>&nbsp;<span class="ident" id="4658566">elliptic</span><span class="op" id="4658574">.</span><span class="ident" id="4658575">Curve</span><span class="op" id="4658580">,</span>&nbsp;<span class="ident" id="4658582">rand</span>&nbsp;<span class="ident" id="4658587">io</span><span class="op" id="4658589">.</span><span class="ident" id="4658590">Reader</span><span class="op" id="4658596">)</span>&nbsp;<span class="op" id="4658598">(</span><span class="ident" id="4658599">k</span>&nbsp;<span class="op" id="4658601">*</span><span class="ident" id="4658602">big</span><span class="op" id="4658605">.</span><span class="ident" id="4658606">Int</span><span class="op" id="4658609">,</span>&nbsp;<span class="ident" id="4658611">err</span>&nbsp;<span class="builtintype" id="4658615">error</span><span class="op" id="4658620">)</span>&nbsp;<span class="op" id="4658622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658625">params</span>&nbsp;<span class="op" id="4658632">:=</span>&nbsp;<span class="ident" id="4658635">c</span><span class="op" id="4658636">.</span><span class="ident" id="4658637">Params</span><span class="op" id="4658643">(</span><span class="op" id="4658644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658647">b</span>&nbsp;<span class="op" id="4658649">:=</span>&nbsp;<span class="builtinfunc" id="4658652">make</span><span class="op" id="4658656">(</span><span class="op" id="4658657">[</span><span class="op" id="4658658">]</span><span class="builtintype" id="4658659">byte</span><span class="op" id="4658663">,</span>&nbsp;<span class="ident" id="4658665">params</span><span class="op" id="4658671">.</span><span class="ident" id="4658672">BitSize</span><span class="op" id="4658679">/</span><span class="num" id="4658680">8</span><span class="op" id="4658681">+</span><span class="num" id="4658682">8</span><span class="op" id="4658683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658686">_</span><span class="op" id="4658687">,</span>&nbsp;<span class="ident" id="4658689">err</span>&nbsp;<span class="op" id="4658693">=</span>&nbsp;<span class="ident" id="4658695">io</span><span class="op" id="4658697">.</span><span class="ident" id="4658698">ReadFull</span><span class="op" id="4658706">(</span><span class="ident" id="4658707">rand</span><span class="op" id="4658711">,</span>&nbsp;<span class="ident" id="4658713">b</span><span class="op" id="4658714">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658717">if</span>&nbsp;<span class="ident" id="4658720">err</span>&nbsp;<span class="op" id="4658724">!=</span>&nbsp;<span class="builtintype" id="4658727">nil</span>&nbsp;<span class="op" id="4658731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658735">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658747">k</span>&nbsp;<span class="op" id="4658749">=</span>&nbsp;<span class="builtinfunc" id="4658751">new</span><span class="op" id="4658754">(</span><span class="ident" id="4658755">big</span><span class="op" id="4658758">.</span><span class="ident" id="4658759">Int</span><span class="op" id="4658762">)</span><span class="op" id="4658763">.</span><span class="ident" id="4658764">SetBytes</span><span class="op" id="4658772">(</span><span class="ident" id="4658773">b</span><span class="op" id="4658774">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658777">n</span>&nbsp;<span class="op" id="4658779">:=</span>&nbsp;<span class="builtinfunc" id="4658782">new</span><span class="op" id="4658785">(</span><span class="ident" id="4658786">big</span><span class="op" id="4658789">.</span><span class="ident" id="4658790">Int</span><span class="op" id="4658793">)</span><span class="op" id="4658794">.</span><span class="ident" id="4658795">Sub</span><span class="op" id="4658798">(</span><span class="ident" id="4658799">params</span><span class="op" id="4658805">.</span><span class="ident" id="4658806">N</span><span class="op" id="4658807">,</span>&nbsp;<span class="ident" id="4658809">one</span><span class="op" id="4658812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658815">k</span><span class="op" id="4658816">.</span><span class="ident" id="4658817">Mod</span><span class="op" id="4658820">(</span><span class="ident" id="4658821">k</span><span class="op" id="4658822">,</span>&nbsp;<span class="ident" id="4658824">n</span><span class="op" id="4658825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658828">k</span><span class="op" id="4658829">.</span><span class="ident" id="4658830">Add</span><span class="op" id="4658833">(</span><span class="ident" id="4658834">k</span><span class="op" id="4658835">,</span>&nbsp;<span class="ident" id="4658837">one</span><span class="op" id="4658840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658843">return</span><br>
<span class="lineno"></span><span class="op" id="4658850">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4658853">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4658909">func</span>&nbsp;<span class="ident" id="4658914">GenerateKey</span><span class="op" id="4658925">(</span><span class="ident" id="4658926">c</span>&nbsp;<span class="ident" id="4658928">elliptic</span><span class="op" id="4658936">.</span><span class="ident" id="4658937">Curve</span><span class="op" id="4658942">,</span>&nbsp;<span class="ident" id="4658944">rand</span>&nbsp;<span class="ident" id="4658949">io</span><span class="op" id="4658951">.</span><span class="ident" id="4658952">Reader</span><span class="op" id="4658958">)</span>&nbsp;<span class="op" id="4658960">(</span><span class="ident" id="4658961">priv</span>&nbsp;<span class="op" id="4658966">*</span><span class="ident" id="4658967">PrivateKey</span><span class="op" id="4658977">,</span>&nbsp;<span class="ident" id="4658979">err</span>&nbsp;<span class="builtintype" id="4658983">error</span><span class="op" id="4658988">)</span>&nbsp;<span class="op" id="4658990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658993">k</span><span class="op" id="4658994">,</span>&nbsp;<span class="ident" id="4658996">err</span>&nbsp;<span class="op" id="4659000">:=</span>&nbsp;<span class="ident" id="4659003">randFieldElement</span><span class="op" id="4659019">(</span><span class="ident" id="4659020">c</span><span class="op" id="4659021">,</span>&nbsp;<span class="ident" id="4659023">rand</span><span class="op" id="4659027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659030">if</span>&nbsp;<span class="ident" id="4659033">err</span>&nbsp;<span class="op" id="4659037">!=</span>&nbsp;<span class="builtintype" id="4659040">nil</span>&nbsp;<span class="op" id="4659044">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659048">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4659056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659060">priv</span>&nbsp;<span class="op" id="4659065">=</span>&nbsp;<span class="builtinfunc" id="4659067">new</span><span class="op" id="4659070">(</span><span class="ident" id="4659071">PrivateKey</span><span class="op" id="4659081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659084">priv</span><span class="op" id="4659088">.</span><span class="ident" id="4659089">PublicKey</span><span class="op" id="4659098">.</span><span class="ident" id="4659099">Curve</span>&nbsp;<span class="op" id="4659105">=</span>&nbsp;<span class="ident" id="4659107">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659110">priv</span><span class="op" id="4659114">.</span><span class="ident" id="4659115">D</span>&nbsp;<span class="op" id="4659117">=</span>&nbsp;<span class="ident" id="4659119">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659122">priv</span><span class="op" id="4659126">.</span><span class="ident" id="4659127">PublicKey</span><span class="op" id="4659136">.</span><span class="ident" id="4659137">X</span><span class="op" id="4659138">,</span>&nbsp;<span class="ident" id="4659140">priv</span><span class="op" id="4659144">.</span><span class="ident" id="4659145">PublicKey</span><span class="op" id="4659154">.</span><span class="ident" id="4659155">Y</span>&nbsp;<span class="op" id="4659157">=</span>&nbsp;<span class="ident" id="4659159">c</span><span class="op" id="4659160">.</span><span class="ident" id="4659161">ScalarBaseMult</span><span class="op" id="4659175">(</span><span class="ident" id="4659176">k</span><span class="op" id="4659177">.</span><span class="ident" id="4659178">Bytes</span><span class="op" id="4659183">(</span><span class="op" id="4659184">)</span><span class="op" id="4659185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659188">return</span><br>
<span class="lineno"></span><span class="op" id="4659195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4659198">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4659275">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4659350">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4659428">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4659503">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4659580">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4659607">func</span>&nbsp;<span class="ident" id="4659612">hashToInt</span><span class="op" id="4659621">(</span><span class="ident" id="4659622">hash</span>&nbsp;<span class="op" id="4659627">[</span><span class="op" id="4659628">]</span><span class="builtintype" id="4659629">byte</span><span class="op" id="4659633">,</span>&nbsp;<span class="ident" id="4659635">c</span>&nbsp;<span class="ident" id="4659637">elliptic</span><span class="op" id="4659645">.</span><span class="ident" id="4659646">Curve</span><span class="op" id="4659651">)</span>&nbsp;<span class="op" id="4659653">*</span><span class="ident" id="4659654">big</span><span class="op" id="4659657">.</span><span class="ident" id="4659658">Int</span>&nbsp;<span class="op" id="4659662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659665">orderBits</span>&nbsp;<span class="op" id="4659675">:=</span>&nbsp;<span class="ident" id="4659678">c</span><span class="op" id="4659679">.</span><span class="ident" id="4659680">Params</span><span class="op" id="4659686">(</span><span class="op" id="4659687">)</span><span class="op" id="4659688">.</span><span class="ident" id="4659689">N</span><span class="op" id="4659690">.</span><span class="ident" id="4659691">BitLen</span><span class="op" id="4659697">(</span><span class="op" id="4659698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659701">orderBytes</span>&nbsp;<span class="op" id="4659712">:=</span>&nbsp;<span class="op" id="4659715">(</span><span class="ident" id="4659716">orderBits</span>&nbsp;<span class="op" id="4659726">+</span>&nbsp;<span class="num" id="4659728">7</span><span class="op" id="4659729">)</span>&nbsp;<span class="op" id="4659731">/</span>&nbsp;<span class="num" id="4659733">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659736">if</span>&nbsp;<span class="builtinfunc" id="4659739">len</span><span class="op" id="4659742">(</span><span class="ident" id="4659743">hash</span><span class="op" id="4659747">)</span>&nbsp;<span class="op" id="4659749">&gt;</span>&nbsp;<span class="ident" id="4659751">orderBytes</span>&nbsp;<span class="op" id="4659762">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659766">hash</span>&nbsp;<span class="op" id="4659771">=</span>&nbsp;<span class="ident" id="4659773">hash</span><span class="op" id="4659777">[</span><span class="op" id="4659778">:</span><span class="ident" id="4659779">orderBytes</span><span class="op" id="4659789">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4659792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659796">ret</span>&nbsp;<span class="op" id="4659800">:=</span>&nbsp;<span class="builtinfunc" id="4659803">new</span><span class="op" id="4659806">(</span><span class="ident" id="4659807">big</span><span class="op" id="4659810">.</span><span class="ident" id="4659811">Int</span><span class="op" id="4659814">)</span><span class="op" id="4659815">.</span><span class="ident" id="4659816">SetBytes</span><span class="op" id="4659824">(</span><span class="ident" id="4659825">hash</span><span class="op" id="4659829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659832">excess</span>&nbsp;<span class="op" id="4659839">:=</span>&nbsp;<span class="builtinfunc" id="4659842">len</span><span class="op" id="4659845">(</span><span class="ident" id="4659846">hash</span><span class="op" id="4659850">)</span><span class="op" id="4659851">*</span><span class="num" id="4659852">8</span>&nbsp;<span class="op" id="4659854">-</span>&nbsp;<span class="ident" id="4659856">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659867">if</span>&nbsp;<span class="ident" id="4659870">excess</span>&nbsp;<span class="op" id="4659877">&gt;</span>&nbsp;<span class="num" id="4659879">0</span>&nbsp;<span class="op" id="4659881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4659885">ret</span><span class="op" id="4659888">.</span><span class="ident" id="4659889">Rsh</span><span class="op" id="4659892">(</span><span class="ident" id="4659893">ret</span><span class="op" id="4659896">,</span>&nbsp;<span class="builtintype" id="4659898">uint</span><span class="op" id="4659902">(</span><span class="ident" id="4659903">excess</span><span class="op" id="4659909">)</span><span class="op" id="4659910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4659913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659916">return</span>&nbsp;<span class="ident" id="4659923">ret</span><br>
<span class="lineno"></span><span class="op" id="4659927">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4659930">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4660007">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4660085">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4660156">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4660194">func</span>&nbsp;<span class="ident" id="4660199">fermatInverse</span><span class="op" id="4660212">(</span><span class="ident" id="4660213">k</span><span class="op" id="4660214">,</span>&nbsp;<span class="ident" id="4660216">N</span>&nbsp;<span class="op" id="4660218">*</span><span class="ident" id="4660219">big</span><span class="op" id="4660222">.</span><span class="ident" id="4660223">Int</span><span class="op" id="4660226">)</span>&nbsp;<span class="op" id="4660228">*</span><span class="ident" id="4660229">big</span><span class="op" id="4660232">.</span><span class="ident" id="4660233">Int</span>&nbsp;<span class="op" id="4660237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660240">two</span>&nbsp;<span class="op" id="4660244">:=</span>&nbsp;<span class="ident" id="4660247">big</span><span class="op" id="4660250">.</span><span class="ident" id="4660251">NewInt</span><span class="op" id="4660257">(</span><span class="num" id="4660258">2</span><span class="op" id="4660259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660262">nMinus2</span>&nbsp;<span class="op" id="4660270">:=</span>&nbsp;<span class="builtinfunc" id="4660273">new</span><span class="op" id="4660276">(</span><span class="ident" id="4660277">big</span><span class="op" id="4660280">.</span><span class="ident" id="4660281">Int</span><span class="op" id="4660284">)</span><span class="op" id="4660285">.</span><span class="ident" id="4660286">Sub</span><span class="op" id="4660289">(</span><span class="ident" id="4660290">N</span><span class="op" id="4660291">,</span>&nbsp;<span class="ident" id="4660293">two</span><span class="op" id="4660296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660299">return</span>&nbsp;<span class="builtinfunc" id="4660306">new</span><span class="op" id="4660309">(</span><span class="ident" id="4660310">big</span><span class="op" id="4660313">.</span><span class="ident" id="4660314">Int</span><span class="op" id="4660317">)</span><span class="op" id="4660318">.</span><span class="ident" id="4660319">Exp</span><span class="op" id="4660322">(</span><span class="ident" id="4660323">k</span><span class="op" id="4660324">,</span>&nbsp;<span class="ident" id="4660326">nMinus2</span><span class="op" id="4660333">,</span>&nbsp;<span class="ident" id="4660335">N</span><span class="op" id="4660336">)</span><br>
<span class="lineno"></span><span class="op" id="4660338">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4660341">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4660421">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4660499">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4660578">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4660587">func</span>&nbsp;<span class="ident" id="4660592">Sign</span><span class="op" id="4660596">(</span><span class="ident" id="4660597">rand</span>&nbsp;<span class="ident" id="4660602">io</span><span class="op" id="4660604">.</span><span class="ident" id="4660605">Reader</span><span class="op" id="4660611">,</span>&nbsp;<span class="ident" id="4660613">priv</span>&nbsp;<span class="op" id="4660618">*</span><span class="ident" id="4660619">PrivateKey</span><span class="op" id="4660629">,</span>&nbsp;<span class="ident" id="4660631">hash</span>&nbsp;<span class="op" id="4660636">[</span><span class="op" id="4660637">]</span><span class="builtintype" id="4660638">byte</span><span class="op" id="4660642">)</span>&nbsp;<span class="op" id="4660644">(</span><span class="ident" id="4660645">r</span><span class="op" id="4660646">,</span>&nbsp;<span class="ident" id="4660648">s</span>&nbsp;<span class="op" id="4660650">*</span><span class="ident" id="4660651">big</span><span class="op" id="4660654">.</span><span class="ident" id="4660655">Int</span><span class="op" id="4660658">,</span>&nbsp;<span class="ident" id="4660660">err</span>&nbsp;<span class="builtintype" id="4660664">error</span><span class="op" id="4660669">)</span>&nbsp;<span class="op" id="4660671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4660674">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660694">c</span>&nbsp;<span class="op" id="4660696">:=</span>&nbsp;<span class="ident" id="4660699">priv</span><span class="op" id="4660703">.</span><span class="ident" id="4660704">PublicKey</span><span class="op" id="4660713">.</span><span class="ident" id="4660714">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660721">N</span>&nbsp;<span class="op" id="4660723">:=</span>&nbsp;<span class="ident" id="4660726">c</span><span class="op" id="4660727">.</span><span class="ident" id="4660728">Params</span><span class="op" id="4660734">(</span><span class="op" id="4660735">)</span><span class="op" id="4660736">.</span><span class="ident" id="4660737">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660741">var</span>&nbsp;<span class="ident" id="4660745">k</span><span class="op" id="4660746">,</span>&nbsp;<span class="ident" id="4660748">kInv</span>&nbsp;<span class="op" id="4660753">*</span><span class="ident" id="4660754">big</span><span class="op" id="4660757">.</span><span class="ident" id="4660758">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660763">for</span>&nbsp;<span class="op" id="4660767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660771">for</span>&nbsp;<span class="op" id="4660775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660780">k</span><span class="op" id="4660781">,</span>&nbsp;<span class="ident" id="4660783">err</span>&nbsp;<span class="op" id="4660787">=</span>&nbsp;<span class="ident" id="4660789">randFieldElement</span><span class="op" id="4660805">(</span><span class="ident" id="4660806">c</span><span class="op" id="4660807">,</span>&nbsp;<span class="ident" id="4660809">rand</span><span class="op" id="4660813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660818">if</span>&nbsp;<span class="ident" id="4660821">err</span>&nbsp;<span class="op" id="4660825">!=</span>&nbsp;<span class="builtintype" id="4660828">nil</span>&nbsp;<span class="op" id="4660832">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660838">r</span>&nbsp;<span class="op" id="4660840">=</span>&nbsp;<span class="builtintype" id="4660842">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660850">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4660860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660866">kInv</span>&nbsp;<span class="op" id="4660871">=</span>&nbsp;<span class="ident" id="4660873">fermatInverse</span><span class="op" id="4660886">(</span><span class="ident" id="4660887">k</span><span class="op" id="4660888">,</span>&nbsp;<span class="ident" id="4660890">N</span><span class="op" id="4660891">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660896">r</span><span class="op" id="4660897">,</span>&nbsp;<span class="ident" id="4660899">_</span>&nbsp;<span class="op" id="4660901">=</span>&nbsp;<span class="ident" id="4660903">priv</span><span class="op" id="4660907">.</span><span class="ident" id="4660908">Curve</span><span class="op" id="4660913">.</span><span class="ident" id="4660914">ScalarBaseMult</span><span class="op" id="4660928">(</span><span class="ident" id="4660929">k</span><span class="op" id="4660930">.</span><span class="ident" id="4660931">Bytes</span><span class="op" id="4660936">(</span><span class="op" id="4660937">)</span><span class="op" id="4660938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660943">r</span><span class="op" id="4660944">.</span><span class="ident" id="4660945">Mod</span><span class="op" id="4660948">(</span><span class="ident" id="4660949">r</span><span class="op" id="4660950">,</span>&nbsp;<span class="ident" id="4660952">N</span><span class="op" id="4660953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660958">if</span>&nbsp;<span class="ident" id="4660961">r</span><span class="op" id="4660962">.</span><span class="ident" id="4660963">Sign</span><span class="op" id="4660967">(</span><span class="op" id="4660968">)</span>&nbsp;<span class="op" id="4660970">!=</span>&nbsp;<span class="num" id="4660973">0</span>&nbsp;<span class="op" id="4660975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4660981">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4660990">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4660994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4660999">e</span>&nbsp;<span class="op" id="4661001">:=</span>&nbsp;<span class="ident" id="4661004">hashToInt</span><span class="op" id="4661013">(</span><span class="ident" id="4661014">hash</span><span class="op" id="4661018">,</span>&nbsp;<span class="ident" id="4661020">c</span><span class="op" id="4661021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661025">s</span>&nbsp;<span class="op" id="4661027">=</span>&nbsp;<span class="builtinfunc" id="4661029">new</span><span class="op" id="4661032">(</span><span class="ident" id="4661033">big</span><span class="op" id="4661036">.</span><span class="ident" id="4661037">Int</span><span class="op" id="4661040">)</span><span class="op" id="4661041">.</span><span class="ident" id="4661042">Mul</span><span class="op" id="4661045">(</span><span class="ident" id="4661046">priv</span><span class="op" id="4661050">.</span><span class="ident" id="4661051">D</span><span class="op" id="4661052">,</span>&nbsp;<span class="ident" id="4661054">r</span><span class="op" id="4661055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661059">s</span><span class="op" id="4661060">.</span><span class="ident" id="4661061">Add</span><span class="op" id="4661064">(</span><span class="ident" id="4661065">s</span><span class="op" id="4661066">,</span>&nbsp;<span class="ident" id="4661068">e</span><span class="op" id="4661069">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661073">s</span><span class="op" id="4661074">.</span><span class="ident" id="4661075">Mul</span><span class="op" id="4661078">(</span><span class="ident" id="4661079">s</span><span class="op" id="4661080">,</span>&nbsp;<span class="ident" id="4661082">kInv</span><span class="op" id="4661086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661090">s</span><span class="op" id="4661091">.</span><span class="ident" id="4661092">Mod</span><span class="op" id="4661095">(</span><span class="ident" id="4661096">s</span><span class="op" id="4661097">,</span>&nbsp;<span class="ident" id="4661099">N</span><span class="op" id="4661100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661104">if</span>&nbsp;<span class="ident" id="4661107">s</span><span class="op" id="4661108">.</span><span class="ident" id="4661109">Sign</span><span class="op" id="4661113">(</span><span class="op" id="4661114">)</span>&nbsp;<span class="op" id="4661116">!=</span>&nbsp;<span class="num" id="4661119">0</span>&nbsp;<span class="op" id="4661121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661126">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4661134">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4661137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661141">return</span><br>
<span class="lineno"></span><span class="op" id="4661148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4661151">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4661231">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4661287">func</span>&nbsp;<span class="ident" id="4661292">Verify</span><span class="op" id="4661298">(</span><span class="ident" id="4661299">pub</span>&nbsp;<span class="op" id="4661303">*</span><span class="ident" id="4661304">PublicKey</span><span class="op" id="4661313">,</span>&nbsp;<span class="ident" id="4661315">hash</span>&nbsp;<span class="op" id="4661320">[</span><span class="op" id="4661321">]</span><span class="builtintype" id="4661322">byte</span><span class="op" id="4661326">,</span>&nbsp;<span class="ident" id="4661328">r</span><span class="op" id="4661329">,</span>&nbsp;<span class="ident" id="4661331">s</span>&nbsp;<span class="op" id="4661333">*</span><span class="ident" id="4661334">big</span><span class="op" id="4661337">.</span><span class="ident" id="4661338">Int</span><span class="op" id="4661341">)</span>&nbsp;<span class="builtintype" id="4661343">bool</span>&nbsp;<span class="op" id="4661348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4661351">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661371">c</span>&nbsp;<span class="op" id="4661373">:=</span>&nbsp;<span class="ident" id="4661376">pub</span><span class="op" id="4661379">.</span><span class="ident" id="4661380">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661387">N</span>&nbsp;<span class="op" id="4661389">:=</span>&nbsp;<span class="ident" id="4661392">c</span><span class="op" id="4661393">.</span><span class="ident" id="4661394">Params</span><span class="op" id="4661400">(</span><span class="op" id="4661401">)</span><span class="op" id="4661402">.</span><span class="ident" id="4661403">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661407">if</span>&nbsp;<span class="ident" id="4661410">r</span><span class="op" id="4661411">.</span><span class="ident" id="4661412">Sign</span><span class="op" id="4661416">(</span><span class="op" id="4661417">)</span>&nbsp;<span class="op" id="4661419">==</span>&nbsp;<span class="num" id="4661422">0</span>&nbsp;<span class="op" id="4661424">||</span>&nbsp;<span class="ident" id="4661427">s</span><span class="op" id="4661428">.</span><span class="ident" id="4661429">Sign</span><span class="op" id="4661433">(</span><span class="op" id="4661434">)</span>&nbsp;<span class="op" id="4661436">==</span>&nbsp;<span class="num" id="4661439">0</span>&nbsp;<span class="op" id="4661441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661445">return</span>&nbsp;<span class="builtintype" id="4661452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4661459">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661462">if</span>&nbsp;<span class="ident" id="4661465">r</span><span class="op" id="4661466">.</span><span class="ident" id="4661467">Cmp</span><span class="op" id="4661470">(</span><span class="ident" id="4661471">N</span><span class="op" id="4661472">)</span>&nbsp;<span class="op" id="4661474">&gt;=</span>&nbsp;<span class="num" id="4661477">0</span>&nbsp;<span class="op" id="4661479">||</span>&nbsp;<span class="ident" id="4661482">s</span><span class="op" id="4661483">.</span><span class="ident" id="4661484">Cmp</span><span class="op" id="4661487">(</span><span class="ident" id="4661488">N</span><span class="op" id="4661489">)</span>&nbsp;<span class="op" id="4661491">&gt;=</span>&nbsp;<span class="num" id="4661494">0</span>&nbsp;<span class="op" id="4661496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661500">return</span>&nbsp;<span class="builtintype" id="4661507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4661514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661517">e</span>&nbsp;<span class="op" id="4661519">:=</span>&nbsp;<span class="ident" id="4661522">hashToInt</span><span class="op" id="4661531">(</span><span class="ident" id="4661532">hash</span><span class="op" id="4661536">,</span>&nbsp;<span class="ident" id="4661538">c</span><span class="op" id="4661539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661542">w</span>&nbsp;<span class="op" id="4661544">:=</span>&nbsp;<span class="builtinfunc" id="4661547">new</span><span class="op" id="4661550">(</span><span class="ident" id="4661551">big</span><span class="op" id="4661554">.</span><span class="ident" id="4661555">Int</span><span class="op" id="4661558">)</span><span class="op" id="4661559">.</span><span class="ident" id="4661560">ModInverse</span><span class="op" id="4661570">(</span><span class="ident" id="4661571">s</span><span class="op" id="4661572">,</span>&nbsp;<span class="ident" id="4661574">N</span><span class="op" id="4661575">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661579">u1</span>&nbsp;<span class="op" id="4661582">:=</span>&nbsp;<span class="ident" id="4661585">e</span><span class="op" id="4661586">.</span><span class="ident" id="4661587">Mul</span><span class="op" id="4661590">(</span><span class="ident" id="4661591">e</span><span class="op" id="4661592">,</span>&nbsp;<span class="ident" id="4661594">w</span><span class="op" id="4661595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661598">u1</span><span class="op" id="4661600">.</span><span class="ident" id="4661601">Mod</span><span class="op" id="4661604">(</span><span class="ident" id="4661605">u1</span><span class="op" id="4661607">,</span>&nbsp;<span class="ident" id="4661609">N</span><span class="op" id="4661610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661613">u2</span>&nbsp;<span class="op" id="4661616">:=</span>&nbsp;<span class="ident" id="4661619">w</span><span class="op" id="4661620">.</span><span class="ident" id="4661621">Mul</span><span class="op" id="4661624">(</span><span class="ident" id="4661625">r</span><span class="op" id="4661626">,</span>&nbsp;<span class="ident" id="4661628">w</span><span class="op" id="4661629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661632">u2</span><span class="op" id="4661634">.</span><span class="ident" id="4661635">Mod</span><span class="op" id="4661638">(</span><span class="ident" id="4661639">u2</span><span class="op" id="4661641">,</span>&nbsp;<span class="ident" id="4661643">N</span><span class="op" id="4661644">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661648">x1</span><span class="op" id="4661650">,</span>&nbsp;<span class="ident" id="4661652">y1</span>&nbsp;<span class="op" id="4661655">:=</span>&nbsp;<span class="ident" id="4661658">c</span><span class="op" id="4661659">.</span><span class="ident" id="4661660">ScalarBaseMult</span><span class="op" id="4661674">(</span><span class="ident" id="4661675">u1</span><span class="op" id="4661677">.</span><span class="ident" id="4661678">Bytes</span><span class="op" id="4661683">(</span><span class="op" id="4661684">)</span><span class="op" id="4661685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661688">x2</span><span class="op" id="4661690">,</span>&nbsp;<span class="ident" id="4661692">y2</span>&nbsp;<span class="op" id="4661695">:=</span>&nbsp;<span class="ident" id="4661698">c</span><span class="op" id="4661699">.</span><span class="ident" id="4661700">ScalarMult</span><span class="op" id="4661710">(</span><span class="ident" id="4661711">pub</span><span class="op" id="4661714">.</span><span class="ident" id="4661715">X</span><span class="op" id="4661716">,</span>&nbsp;<span class="ident" id="4661718">pub</span><span class="op" id="4661721">.</span><span class="ident" id="4661722">Y</span><span class="op" id="4661723">,</span>&nbsp;<span class="ident" id="4661725">u2</span><span class="op" id="4661727">.</span><span class="ident" id="4661728">Bytes</span><span class="op" id="4661733">(</span><span class="op" id="4661734">)</span><span class="op" id="4661735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661738">x</span><span class="op" id="4661739">,</span>&nbsp;<span class="ident" id="4661741">y</span>&nbsp;<span class="op" id="4661743">:=</span>&nbsp;<span class="ident" id="4661746">c</span><span class="op" id="4661747">.</span><span class="ident" id="4661748">Add</span><span class="op" id="4661751">(</span><span class="ident" id="4661752">x1</span><span class="op" id="4661754">,</span>&nbsp;<span class="ident" id="4661756">y1</span><span class="op" id="4661758">,</span>&nbsp;<span class="ident" id="4661760">x2</span><span class="op" id="4661762">,</span>&nbsp;<span class="ident" id="4661764">y2</span><span class="op" id="4661766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661769">if</span>&nbsp;<span class="ident" id="4661772">x</span><span class="op" id="4661773">.</span><span class="ident" id="4661774">Sign</span><span class="op" id="4661778">(</span><span class="op" id="4661779">)</span>&nbsp;<span class="op" id="4661781">==</span>&nbsp;<span class="num" id="4661784">0</span>&nbsp;<span class="op" id="4661786">&amp;&amp;</span>&nbsp;<span class="ident" id="4661789">y</span><span class="op" id="4661790">.</span><span class="ident" id="4661791">Sign</span><span class="op" id="4661795">(</span><span class="op" id="4661796">)</span>&nbsp;<span class="op" id="4661798">==</span>&nbsp;<span class="num" id="4661801">0</span>&nbsp;<span class="op" id="4661803">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661807">return</span>&nbsp;<span class="builtintype" id="4661814">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4661821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4661824">x</span><span class="op" id="4661825">.</span><span class="ident" id="4661826">Mod</span><span class="op" id="4661829">(</span><span class="ident" id="4661830">x</span><span class="op" id="4661831">,</span>&nbsp;<span class="ident" id="4661833">N</span><span class="op" id="4661834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4661837">return</span>&nbsp;<span class="ident" id="4661844">x</span><span class="op" id="4661845">.</span><span class="ident" id="4661846">Cmp</span><span class="op" id="4661849">(</span><span class="ident" id="4661850">r</span><span class="op" id="4661851">)</span>&nbsp;<span class="op" id="4661853">==</span>&nbsp;<span class="num" id="4661856">0</span><br>
<span class="lineno"></span><span class="op" id="4661858">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
