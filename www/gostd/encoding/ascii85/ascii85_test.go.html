<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8253678">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8253733">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8253787">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8253838">package</span>&nbsp;<span class="ident" id="8253846">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8253855">import</span>&nbsp;<span class="op" id="8253862">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253865">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253874">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253880">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253893">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8253904">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8253914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8253917">type</span>&nbsp;<span class="ident" id="8253922">testpair</span>&nbsp;<span class="keyword" id="8253931">struct</span>&nbsp;<span class="op" id="8253938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8253941">decoded</span><span class="op" id="8253948">,</span>&nbsp;<span class="ident" id="8253950">encoded</span>&nbsp;<span class="builtintype" id="8253958">string</span><br>
<span class="lineno"></span><span class="op" id="8253965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8253968">var</span>&nbsp;<span class="ident" id="8253972">pairs</span>&nbsp;<span class="op" id="8253978">=</span>&nbsp;<span class="op" id="8253980">[</span><span class="op" id="8253981">]</span><span class="ident" id="8253982">testpair</span><span class="op" id="8253990">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8253993">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254037">&#34;&#34;</span><span class="op" id="8254039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254043">&#34;&#34;</span><span class="op" id="8254045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254048">}</span><span class="op" id="8254049">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8254052">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254078">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="8254161">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254166">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="8254250">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254255">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="8254333">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254338">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="8254373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254377">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="8254455">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254460">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="8254542">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254547">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="8254627">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254632">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="8254712">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254717">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="8254760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254763">}</span><span class="op" id="8254764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8254767">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254816">&#34;\000\000\000\000&#34;</span><span class="op" id="8254834">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8254838">&#34;z&#34;</span><span class="op" id="8254841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8254844">}</span><span class="op" id="8254845">,</span><br>
<span class="lineno"></span><span class="op" id="8254847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8254850">var</span>&nbsp;<span class="ident" id="8254854">bigtest</span>&nbsp;<span class="op" id="8254862">=</span>&nbsp;<span class="ident" id="8254864">pairs</span><span class="op" id="8254869">[</span><span class="builtinfunc" id="8254870">len</span><span class="op" id="8254873">(</span><span class="ident" id="8254874">pairs</span><span class="op" id="8254879">)</span><span class="op" id="8254880">-</span><span class="num" id="8254881">1</span><span class="op" id="8254882">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8254885">func</span>&nbsp;<span class="ident" id="8254890">testEqual</span><span class="op" id="8254899">(</span><span class="ident" id="8254900">t</span>&nbsp;<span class="op" id="8254902">*</span><span class="ident" id="8254903">testing</span><span class="op" id="8254910">.</span><span class="ident" id="8254911">T</span><span class="op" id="8254912">,</span>&nbsp;<span class="ident" id="8254914">msg</span>&nbsp;<span class="builtintype" id="8254918">string</span><span class="op" id="8254924">,</span>&nbsp;<span class="ident" id="8254926">args</span>&nbsp;<span class="op" id="8254931">...</span><span class="keyword" id="8254934">interface</span><span class="op" id="8254943">{</span><span class="op" id="8254944">}</span><span class="op" id="8254945">)</span>&nbsp;<span class="builtintype" id="8254947">bool</span>&nbsp;<span class="op" id="8254952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8254955">if</span>&nbsp;<span class="ident" id="8254958">args</span><span class="op" id="8254962">[</span><span class="builtinfunc" id="8254963">len</span><span class="op" id="8254966">(</span><span class="ident" id="8254967">args</span><span class="op" id="8254971">)</span><span class="op" id="8254972">-</span><span class="num" id="8254973">2</span><span class="op" id="8254974">]</span>&nbsp;<span class="op" id="8254976">!=</span>&nbsp;<span class="ident" id="8254979">args</span><span class="op" id="8254983">[</span><span class="builtinfunc" id="8254984">len</span><span class="op" id="8254987">(</span><span class="ident" id="8254988">args</span><span class="op" id="8254992">)</span><span class="op" id="8254993">-</span><span class="num" id="8254994">1</span><span class="op" id="8254995">]</span>&nbsp;<span class="op" id="8254997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255001">t</span><span class="op" id="8255002">.</span><span class="ident" id="8255003">Errorf</span><span class="op" id="8255009">(</span><span class="ident" id="8255010">msg</span><span class="op" id="8255013">,</span>&nbsp;<span class="ident" id="8255015">args</span><span class="op" id="8255019">...</span><span class="op" id="8255022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255026">return</span>&nbsp;<span class="builtintype" id="8255033">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255043">return</span>&nbsp;<span class="builtintype" id="8255050">true</span><br>
<span class="lineno"></span><span class="op" id="8255055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8255058">func</span>&nbsp;<span class="ident" id="8255063">strip85</span><span class="op" id="8255070">(</span><span class="ident" id="8255071">s</span>&nbsp;<span class="builtintype" id="8255073">string</span><span class="op" id="8255079">)</span>&nbsp;<span class="builtintype" id="8255081">string</span>&nbsp;<span class="op" id="8255088">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255091">t</span>&nbsp;<span class="op" id="8255093">:=</span>&nbsp;<span class="builtinfunc" id="8255096">make</span><span class="op" id="8255100">(</span><span class="op" id="8255101">[</span><span class="op" id="8255102">]</span><span class="builtintype" id="8255103">byte</span><span class="op" id="8255107">,</span>&nbsp;<span class="builtinfunc" id="8255109">len</span><span class="op" id="8255112">(</span><span class="ident" id="8255113">s</span><span class="op" id="8255114">)</span><span class="op" id="8255115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255118">w</span>&nbsp;<span class="op" id="8255120">:=</span>&nbsp;<span class="num" id="8255123">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255126">for</span>&nbsp;<span class="ident" id="8255130">r</span>&nbsp;<span class="op" id="8255132">:=</span>&nbsp;<span class="num" id="8255135">0</span><span class="op" id="8255136">;</span>&nbsp;<span class="ident" id="8255138">r</span>&nbsp;<span class="op" id="8255140">&lt;</span>&nbsp;<span class="builtinfunc" id="8255142">len</span><span class="op" id="8255145">(</span><span class="ident" id="8255146">s</span><span class="op" id="8255147">)</span><span class="op" id="8255148">;</span>&nbsp;<span class="ident" id="8255150">r</span><span class="op" id="8255151">++</span>&nbsp;<span class="op" id="8255154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255158">c</span>&nbsp;<span class="op" id="8255160">:=</span>&nbsp;<span class="ident" id="8255163">s</span><span class="op" id="8255164">[</span><span class="ident" id="8255165">r</span><span class="op" id="8255166">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255170">if</span>&nbsp;<span class="ident" id="8255173">c</span>&nbsp;<span class="op" id="8255175">&gt;</span>&nbsp;<span class="string" id="8255177">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="8255181">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255186">t</span><span class="op" id="8255187">[</span><span class="ident" id="8255188">w</span><span class="op" id="8255189">]</span>&nbsp;<span class="op" id="8255191">=</span>&nbsp;<span class="ident" id="8255193">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255198">w</span><span class="op" id="8255199">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255210">return</span>&nbsp;<span class="builtintype" id="8255217">string</span><span class="op" id="8255223">(</span><span class="ident" id="8255224">t</span><span class="op" id="8255225">[</span><span class="num" id="8255226">0</span><span class="op" id="8255227">:</span><span class="ident" id="8255228">w</span><span class="op" id="8255229">]</span><span class="op" id="8255230">)</span><br>
<span class="lineno">65</span><span class="op" id="8255232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8255235">func</span>&nbsp;<span class="ident" id="8255240">TestEncode</span><span class="op" id="8255250">(</span><span class="ident" id="8255251">t</span>&nbsp;<span class="op" id="8255253">*</span><span class="ident" id="8255254">testing</span><span class="op" id="8255261">.</span><span class="ident" id="8255262">T</span><span class="op" id="8255263">)</span>&nbsp;<span class="op" id="8255265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255268">for</span>&nbsp;<span class="ident" id="8255272">_</span><span class="op" id="8255273">,</span>&nbsp;<span class="ident" id="8255275">p</span>&nbsp;<span class="op" id="8255277">:=</span>&nbsp;<span class="keyword" id="8255280">range</span>&nbsp;<span class="ident" id="8255286">pairs</span>&nbsp;<span class="op" id="8255292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255296">buf</span>&nbsp;<span class="op" id="8255300">:=</span>&nbsp;<span class="builtinfunc" id="8255303">make</span><span class="op" id="8255307">(</span><span class="op" id="8255308">[</span><span class="op" id="8255309">]</span><span class="builtintype" id="8255310">byte</span><span class="op" id="8255314">,</span>&nbsp;<span class="ident" id="8255316">MaxEncodedLen</span><span class="op" id="8255329">(</span><span class="builtinfunc" id="8255330">len</span><span class="op" id="8255333">(</span><span class="ident" id="8255334">p</span><span class="op" id="8255335">.</span><span class="ident" id="8255336">decoded</span><span class="op" id="8255343">)</span><span class="op" id="8255344">)</span><span class="op" id="8255345">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255349">n</span>&nbsp;<span class="op" id="8255351">:=</span>&nbsp;<span class="ident" id="8255354">Encode</span><span class="op" id="8255360">(</span><span class="ident" id="8255361">buf</span><span class="op" id="8255364">,</span>&nbsp;<span class="op" id="8255366">[</span><span class="op" id="8255367">]</span><span class="builtintype" id="8255368">byte</span><span class="op" id="8255372">(</span><span class="ident" id="8255373">p</span><span class="op" id="8255374">.</span><span class="ident" id="8255375">decoded</span><span class="op" id="8255382">)</span><span class="op" id="8255383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255387">buf</span>&nbsp;<span class="op" id="8255391">=</span>&nbsp;<span class="ident" id="8255393">buf</span><span class="op" id="8255396">[</span><span class="num" id="8255397">0</span><span class="op" id="8255398">:</span><span class="ident" id="8255399">n</span><span class="op" id="8255400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255404">testEqual</span><span class="op" id="8255413">(</span><span class="ident" id="8255414">t</span><span class="op" id="8255415">,</span>&nbsp;<span class="string" id="8255417">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8255443">,</span>&nbsp;<span class="ident" id="8255445">p</span><span class="op" id="8255446">.</span><span class="ident" id="8255447">decoded</span><span class="op" id="8255454">,</span>&nbsp;<span class="ident" id="8255456">strip85</span><span class="op" id="8255463">(</span><span class="builtintype" id="8255464">string</span><span class="op" id="8255470">(</span><span class="ident" id="8255471">buf</span><span class="op" id="8255474">)</span><span class="op" id="8255475">)</span><span class="op" id="8255476">,</span>&nbsp;<span class="ident" id="8255478">strip85</span><span class="op" id="8255485">(</span><span class="ident" id="8255486">p</span><span class="op" id="8255487">.</span><span class="ident" id="8255488">encoded</span><span class="op" id="8255495">)</span><span class="op" id="8255496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255499">}</span><br>
<span class="lineno"></span><span class="op" id="8255501">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8255504">func</span>&nbsp;<span class="ident" id="8255509">TestEncoder</span><span class="op" id="8255520">(</span><span class="ident" id="8255521">t</span>&nbsp;<span class="op" id="8255523">*</span><span class="ident" id="8255524">testing</span><span class="op" id="8255531">.</span><span class="ident" id="8255532">T</span><span class="op" id="8255533">)</span>&nbsp;<span class="op" id="8255535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255538">for</span>&nbsp;<span class="ident" id="8255542">_</span><span class="op" id="8255543">,</span>&nbsp;<span class="ident" id="8255545">p</span>&nbsp;<span class="op" id="8255547">:=</span>&nbsp;<span class="keyword" id="8255550">range</span>&nbsp;<span class="ident" id="8255556">pairs</span>&nbsp;<span class="op" id="8255562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255566">bb</span>&nbsp;<span class="op" id="8255569">:=</span>&nbsp;<span class="op" id="8255572">&amp;</span><span class="ident" id="8255573">bytes</span><span class="op" id="8255578">.</span><span class="ident" id="8255579">Buffer</span><span class="op" id="8255585">{</span><span class="op" id="8255586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255590">encoder</span>&nbsp;<span class="op" id="8255598">:=</span>&nbsp;<span class="ident" id="8255601">NewEncoder</span><span class="op" id="8255611">(</span><span class="ident" id="8255612">bb</span><span class="op" id="8255614">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255618">encoder</span><span class="op" id="8255625">.</span><span class="ident" id="8255626">Write</span><span class="op" id="8255631">(</span><span class="op" id="8255632">[</span><span class="op" id="8255633">]</span><span class="builtintype" id="8255634">byte</span><span class="op" id="8255638">(</span><span class="ident" id="8255639">p</span><span class="op" id="8255640">.</span><span class="ident" id="8255641">decoded</span><span class="op" id="8255648">)</span><span class="op" id="8255649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255653">encoder</span><span class="op" id="8255660">.</span><span class="ident" id="8255661">Close</span><span class="op" id="8255666">(</span><span class="op" id="8255667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255671">testEqual</span><span class="op" id="8255680">(</span><span class="ident" id="8255681">t</span><span class="op" id="8255682">,</span>&nbsp;<span class="string" id="8255684">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8255710">,</span>&nbsp;<span class="ident" id="8255712">p</span><span class="op" id="8255713">.</span><span class="ident" id="8255714">decoded</span><span class="op" id="8255721">,</span>&nbsp;<span class="ident" id="8255723">strip85</span><span class="op" id="8255730">(</span><span class="ident" id="8255731">bb</span><span class="op" id="8255733">.</span><span class="ident" id="8255734">String</span><span class="op" id="8255740">(</span><span class="op" id="8255741">)</span><span class="op" id="8255742">)</span><span class="op" id="8255743">,</span>&nbsp;<span class="ident" id="8255745">strip85</span><span class="op" id="8255752">(</span><span class="ident" id="8255753">p</span><span class="op" id="8255754">.</span><span class="ident" id="8255755">encoded</span><span class="op" id="8255762">)</span><span class="op" id="8255763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8255766">}</span><br>
<span class="lineno"></span><span class="op" id="8255768">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8255771">func</span>&nbsp;<span class="ident" id="8255776">TestEncoderBuffering</span><span class="op" id="8255796">(</span><span class="ident" id="8255797">t</span>&nbsp;<span class="op" id="8255799">*</span><span class="ident" id="8255800">testing</span><span class="op" id="8255807">.</span><span class="ident" id="8255808">T</span><span class="op" id="8255809">)</span>&nbsp;<span class="op" id="8255811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255814">input</span>&nbsp;<span class="op" id="8255820">:=</span>&nbsp;<span class="op" id="8255823">[</span><span class="op" id="8255824">]</span><span class="builtintype" id="8255825">byte</span><span class="op" id="8255829">(</span><span class="ident" id="8255830">bigtest</span><span class="op" id="8255837">.</span><span class="ident" id="8255838">decoded</span><span class="op" id="8255845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255848">for</span>&nbsp;<span class="ident" id="8255852">bs</span>&nbsp;<span class="op" id="8255855">:=</span>&nbsp;<span class="num" id="8255858">1</span><span class="op" id="8255859">;</span>&nbsp;<span class="ident" id="8255861">bs</span>&nbsp;<span class="op" id="8255864">&lt;=</span>&nbsp;<span class="num" id="8255867">12</span><span class="op" id="8255869">;</span>&nbsp;<span class="ident" id="8255871">bs</span><span class="op" id="8255873">++</span>&nbsp;<span class="op" id="8255876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255880">bb</span>&nbsp;<span class="op" id="8255883">:=</span>&nbsp;<span class="op" id="8255886">&amp;</span><span class="ident" id="8255887">bytes</span><span class="op" id="8255892">.</span><span class="ident" id="8255893">Buffer</span><span class="op" id="8255899">{</span><span class="op" id="8255900">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255904">encoder</span>&nbsp;<span class="op" id="8255912">:=</span>&nbsp;<span class="ident" id="8255915">NewEncoder</span><span class="op" id="8255925">(</span><span class="ident" id="8255926">bb</span><span class="op" id="8255928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255932">for</span>&nbsp;<span class="ident" id="8255936">pos</span>&nbsp;<span class="op" id="8255940">:=</span>&nbsp;<span class="num" id="8255943">0</span><span class="op" id="8255944">;</span>&nbsp;<span class="ident" id="8255946">pos</span>&nbsp;<span class="op" id="8255950">&lt;</span>&nbsp;<span class="builtinfunc" id="8255952">len</span><span class="op" id="8255955">(</span><span class="ident" id="8255956">input</span><span class="op" id="8255961">)</span><span class="op" id="8255962">;</span>&nbsp;<span class="ident" id="8255964">pos</span>&nbsp;<span class="op" id="8255968">+=</span>&nbsp;<span class="ident" id="8255971">bs</span>&nbsp;<span class="op" id="8255974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8255979">end</span>&nbsp;<span class="op" id="8255983">:=</span>&nbsp;<span class="ident" id="8255986">pos</span>&nbsp;<span class="op" id="8255990">+</span>&nbsp;<span class="ident" id="8255992">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8255998">if</span>&nbsp;<span class="ident" id="8256001">end</span>&nbsp;<span class="op" id="8256005">&gt;</span>&nbsp;<span class="builtinfunc" id="8256007">len</span><span class="op" id="8256010">(</span><span class="ident" id="8256011">input</span><span class="op" id="8256016">)</span>&nbsp;<span class="op" id="8256018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256024">end</span>&nbsp;<span class="op" id="8256028">=</span>&nbsp;<span class="builtinfunc" id="8256030">len</span><span class="op" id="8256033">(</span><span class="ident" id="8256034">input</span><span class="op" id="8256039">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256049">n</span><span class="op" id="8256050">,</span>&nbsp;<span class="ident" id="8256052">err</span>&nbsp;<span class="op" id="8256056">:=</span>&nbsp;<span class="ident" id="8256059">encoder</span><span class="op" id="8256066">.</span><span class="ident" id="8256067">Write</span><span class="op" id="8256072">(</span><span class="ident" id="8256073">input</span><span class="op" id="8256078">[</span><span class="ident" id="8256079">pos</span><span class="op" id="8256082">:</span><span class="ident" id="8256083">end</span><span class="op" id="8256086">]</span><span class="op" id="8256087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256092">testEqual</span><span class="op" id="8256101">(</span><span class="ident" id="8256102">t</span><span class="op" id="8256103">,</span>&nbsp;<span class="string" id="8256105">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256139">,</span>&nbsp;<span class="ident" id="8256141">input</span><span class="op" id="8256146">[</span><span class="ident" id="8256147">pos</span><span class="op" id="8256150">:</span><span class="ident" id="8256151">end</span><span class="op" id="8256154">]</span><span class="op" id="8256155">,</span>&nbsp;<span class="ident" id="8256157">err</span><span class="op" id="8256160">,</span>&nbsp;<span class="builtintype" id="8256162">error</span><span class="op" id="8256167">(</span><span class="ident" id="8256168">nil</span><span class="op" id="8256171">)</span><span class="op" id="8256172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256177">testEqual</span><span class="op" id="8256186">(</span><span class="ident" id="8256187">t</span><span class="op" id="8256188">,</span>&nbsp;<span class="string" id="8256190">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256225">,</span>&nbsp;<span class="ident" id="8256227">input</span><span class="op" id="8256232">[</span><span class="ident" id="8256233">pos</span><span class="op" id="8256236">:</span><span class="ident" id="8256237">end</span><span class="op" id="8256240">]</span><span class="op" id="8256241">,</span>&nbsp;<span class="ident" id="8256243">n</span><span class="op" id="8256244">,</span>&nbsp;<span class="ident" id="8256246">end</span><span class="op" id="8256249">-</span><span class="ident" id="8256250">pos</span><span class="op" id="8256253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256257">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256261">err</span>&nbsp;<span class="op" id="8256265">:=</span>&nbsp;<span class="ident" id="8256268">encoder</span><span class="op" id="8256275">.</span><span class="ident" id="8256276">Close</span><span class="op" id="8256281">(</span><span class="op" id="8256282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256286">testEqual</span><span class="op" id="8256295">(</span><span class="ident" id="8256296">t</span><span class="op" id="8256297">,</span>&nbsp;<span class="string" id="8256299">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256329">,</span>&nbsp;<span class="ident" id="8256331">err</span><span class="op" id="8256334">,</span>&nbsp;<span class="builtintype" id="8256336">error</span><span class="op" id="8256341">(</span><span class="ident" id="8256342">nil</span><span class="op" id="8256345">)</span><span class="op" id="8256346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256350">testEqual</span><span class="op" id="8256359">(</span><span class="ident" id="8256360">t</span><span class="op" id="8256361">,</span>&nbsp;<span class="string" id="8256363">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8256396">,</span>&nbsp;<span class="ident" id="8256398">bs</span><span class="op" id="8256400">,</span>&nbsp;<span class="ident" id="8256402">bigtest</span><span class="op" id="8256409">.</span><span class="ident" id="8256410">decoded</span><span class="op" id="8256417">,</span>&nbsp;<span class="ident" id="8256419">strip85</span><span class="op" id="8256426">(</span><span class="ident" id="8256427">bb</span><span class="op" id="8256429">.</span><span class="ident" id="8256430">String</span><span class="op" id="8256436">(</span><span class="op" id="8256437">)</span><span class="op" id="8256438">)</span><span class="op" id="8256439">,</span>&nbsp;<span class="ident" id="8256441">strip85</span><span class="op" id="8256448">(</span><span class="ident" id="8256449">bigtest</span><span class="op" id="8256456">.</span><span class="ident" id="8256457">encoded</span><span class="op" id="8256464">)</span><span class="op" id="8256465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256468">}</span><br>
<span class="lineno"></span><span class="op" id="8256470">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8256473">func</span>&nbsp;<span class="ident" id="8256478">TestDecode</span><span class="op" id="8256488">(</span><span class="ident" id="8256489">t</span>&nbsp;<span class="op" id="8256491">*</span><span class="ident" id="8256492">testing</span><span class="op" id="8256499">.</span><span class="ident" id="8256500">T</span><span class="op" id="8256501">)</span>&nbsp;<span class="op" id="8256503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256506">for</span>&nbsp;<span class="ident" id="8256510">_</span><span class="op" id="8256511">,</span>&nbsp;<span class="ident" id="8256513">p</span>&nbsp;<span class="op" id="8256515">:=</span>&nbsp;<span class="keyword" id="8256518">range</span>&nbsp;<span class="ident" id="8256524">pairs</span>&nbsp;<span class="op" id="8256530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256534">dbuf</span>&nbsp;<span class="op" id="8256539">:=</span>&nbsp;<span class="builtinfunc" id="8256542">make</span><span class="op" id="8256546">(</span><span class="op" id="8256547">[</span><span class="op" id="8256548">]</span><span class="builtintype" id="8256549">byte</span><span class="op" id="8256553">,</span>&nbsp;<span class="num" id="8256555">4</span><span class="op" id="8256556">*</span><span class="builtinfunc" id="8256557">len</span><span class="op" id="8256560">(</span><span class="ident" id="8256561">p</span><span class="op" id="8256562">.</span><span class="ident" id="8256563">encoded</span><span class="op" id="8256570">)</span><span class="op" id="8256571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256575">ndst</span><span class="op" id="8256579">,</span>&nbsp;<span class="ident" id="8256581">nsrc</span><span class="op" id="8256585">,</span>&nbsp;<span class="ident" id="8256587">err</span>&nbsp;<span class="op" id="8256591">:=</span>&nbsp;<span class="ident" id="8256594">Decode</span><span class="op" id="8256600">(</span><span class="ident" id="8256601">dbuf</span><span class="op" id="8256605">,</span>&nbsp;<span class="op" id="8256607">[</span><span class="op" id="8256608">]</span><span class="builtintype" id="8256609">byte</span><span class="op" id="8256613">(</span><span class="ident" id="8256614">p</span><span class="op" id="8256615">.</span><span class="ident" id="8256616">encoded</span><span class="op" id="8256623">)</span><span class="op" id="8256624">,</span>&nbsp;<span class="builtintype" id="8256626">true</span><span class="op" id="8256630">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256634">testEqual</span><span class="op" id="8256643">(</span><span class="ident" id="8256644">t</span><span class="op" id="8256645">,</span>&nbsp;<span class="string" id="8256647">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256679">,</span>&nbsp;<span class="ident" id="8256681">p</span><span class="op" id="8256682">.</span><span class="ident" id="8256683">encoded</span><span class="op" id="8256690">,</span>&nbsp;<span class="ident" id="8256692">err</span><span class="op" id="8256695">,</span>&nbsp;<span class="builtintype" id="8256697">error</span><span class="op" id="8256702">(</span><span class="ident" id="8256703">nil</span><span class="op" id="8256706">)</span><span class="op" id="8256707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256711">testEqual</span><span class="op" id="8256720">(</span><span class="ident" id="8256721">t</span><span class="op" id="8256722">,</span>&nbsp;<span class="string" id="8256724">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256755">,</span>&nbsp;<span class="ident" id="8256757">p</span><span class="op" id="8256758">.</span><span class="ident" id="8256759">encoded</span><span class="op" id="8256766">,</span>&nbsp;<span class="ident" id="8256768">nsrc</span><span class="op" id="8256772">,</span>&nbsp;<span class="builtinfunc" id="8256774">len</span><span class="op" id="8256777">(</span><span class="ident" id="8256778">p</span><span class="op" id="8256779">.</span><span class="ident" id="8256780">encoded</span><span class="op" id="8256787">)</span><span class="op" id="8256788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256792">testEqual</span><span class="op" id="8256801">(</span><span class="ident" id="8256802">t</span><span class="op" id="8256803">,</span>&nbsp;<span class="string" id="8256805">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8256836">,</span>&nbsp;<span class="ident" id="8256838">p</span><span class="op" id="8256839">.</span><span class="ident" id="8256840">encoded</span><span class="op" id="8256847">,</span>&nbsp;<span class="ident" id="8256849">ndst</span><span class="op" id="8256853">,</span>&nbsp;<span class="builtinfunc" id="8256855">len</span><span class="op" id="8256858">(</span><span class="ident" id="8256859">p</span><span class="op" id="8256860">.</span><span class="ident" id="8256861">decoded</span><span class="op" id="8256868">)</span><span class="op" id="8256869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8256873">testEqual</span><span class="op" id="8256882">(</span><span class="ident" id="8256883">t</span><span class="op" id="8256884">,</span>&nbsp;<span class="string" id="8256886">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8256912">,</span>&nbsp;<span class="ident" id="8256914">p</span><span class="op" id="8256915">.</span><span class="ident" id="8256916">encoded</span><span class="op" id="8256923">,</span>&nbsp;<span class="builtintype" id="8256925">string</span><span class="op" id="8256931">(</span><span class="ident" id="8256932">dbuf</span><span class="op" id="8256936">[</span><span class="num" id="8256937">0</span><span class="op" id="8256938">:</span><span class="ident" id="8256939">ndst</span><span class="op" id="8256943">]</span><span class="op" id="8256944">)</span><span class="op" id="8256945">,</span>&nbsp;<span class="ident" id="8256947">p</span><span class="op" id="8256948">.</span><span class="ident" id="8256949">decoded</span><span class="op" id="8256956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256959">}</span><br>
<span class="lineno">115</span><span class="op" id="8256961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8256964">func</span>&nbsp;<span class="ident" id="8256969">TestDecoder</span><span class="op" id="8256980">(</span><span class="ident" id="8256981">t</span>&nbsp;<span class="op" id="8256983">*</span><span class="ident" id="8256984">testing</span><span class="op" id="8256991">.</span><span class="ident" id="8256992">T</span><span class="op" id="8256993">)</span>&nbsp;<span class="op" id="8256995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256998">for</span>&nbsp;<span class="ident" id="8257002">_</span><span class="op" id="8257003">,</span>&nbsp;<span class="ident" id="8257005">p</span>&nbsp;<span class="op" id="8257007">:=</span>&nbsp;<span class="keyword" id="8257010">range</span>&nbsp;<span class="ident" id="8257016">pairs</span>&nbsp;<span class="op" id="8257022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257026">decoder</span>&nbsp;<span class="op" id="8257034">:=</span>&nbsp;<span class="ident" id="8257037">NewDecoder</span><span class="op" id="8257047">(</span><span class="ident" id="8257048">strings</span><span class="op" id="8257055">.</span><span class="ident" id="8257056">NewReader</span><span class="op" id="8257065">(</span><span class="ident" id="8257066">p</span><span class="op" id="8257067">.</span><span class="ident" id="8257068">encoded</span><span class="op" id="8257075">)</span><span class="op" id="8257076">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257080">dbuf</span><span class="op" id="8257084">,</span>&nbsp;<span class="ident" id="8257086">err</span>&nbsp;<span class="op" id="8257090">:=</span>&nbsp;<span class="ident" id="8257093">ioutil</span><span class="op" id="8257099">.</span><span class="ident" id="8257100">ReadAll</span><span class="op" id="8257107">(</span><span class="ident" id="8257108">decoder</span><span class="op" id="8257115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257119">if</span>&nbsp;<span class="ident" id="8257122">err</span>&nbsp;<span class="op" id="8257126">!=</span>&nbsp;<span class="ident" id="8257129">nil</span>&nbsp;<span class="op" id="8257133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257138">t</span><span class="op" id="8257139">.</span><span class="ident" id="8257140">Fatal</span><span class="op" id="8257145">(</span><span class="string" id="8257146">&#34;Read&nbsp;failed&#34;</span><span class="op" id="8257159">,</span>&nbsp;<span class="ident" id="8257161">err</span><span class="op" id="8257164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257172">testEqual</span><span class="op" id="8257181">(</span><span class="ident" id="8257182">t</span><span class="op" id="8257183">,</span>&nbsp;<span class="string" id="8257185">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8257220">,</span>&nbsp;<span class="ident" id="8257222">p</span><span class="op" id="8257223">.</span><span class="ident" id="8257224">encoded</span><span class="op" id="8257231">,</span>&nbsp;<span class="builtinfunc" id="8257233">len</span><span class="op" id="8257236">(</span><span class="ident" id="8257237">dbuf</span><span class="op" id="8257241">)</span><span class="op" id="8257242">,</span>&nbsp;<span class="builtinfunc" id="8257244">len</span><span class="op" id="8257247">(</span><span class="ident" id="8257248">p</span><span class="op" id="8257249">.</span><span class="ident" id="8257250">decoded</span><span class="op" id="8257257">)</span><span class="op" id="8257258">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257262">testEqual</span><span class="op" id="8257271">(</span><span class="ident" id="8257272">t</span><span class="op" id="8257273">,</span>&nbsp;<span class="string" id="8257275">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8257305">,</span>&nbsp;<span class="ident" id="8257307">p</span><span class="op" id="8257308">.</span><span class="ident" id="8257309">encoded</span><span class="op" id="8257316">,</span>&nbsp;<span class="builtintype" id="8257318">string</span><span class="op" id="8257324">(</span><span class="ident" id="8257325">dbuf</span><span class="op" id="8257329">)</span><span class="op" id="8257330">,</span>&nbsp;<span class="ident" id="8257332">p</span><span class="op" id="8257333">.</span><span class="ident" id="8257334">decoded</span><span class="op" id="8257341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257345">if</span>&nbsp;<span class="ident" id="8257348">err</span>&nbsp;<span class="op" id="8257352">!=</span>&nbsp;<span class="ident" id="8257355">nil</span>&nbsp;<span class="op" id="8257359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257364">testEqual</span><span class="op" id="8257373">(</span><span class="ident" id="8257374">t</span><span class="op" id="8257375">,</span>&nbsp;<span class="string" id="8257377">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8257405">,</span>&nbsp;<span class="ident" id="8257407">p</span><span class="op" id="8257408">.</span><span class="ident" id="8257409">encoded</span><span class="op" id="8257416">,</span>&nbsp;<span class="ident" id="8257418">err</span><span class="op" id="8257421">,</span>&nbsp;<span class="ident" id="8257423">io</span><span class="op" id="8257425">.</span><span class="ident" id="8257426">EOF</span><span class="op" id="8257429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257436">}</span><br>
<span class="lineno">130</span><span class="op" id="8257438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8257441">func</span>&nbsp;<span class="ident" id="8257446">TestDecoderBuffering</span><span class="op" id="8257466">(</span><span class="ident" id="8257467">t</span>&nbsp;<span class="op" id="8257469">*</span><span class="ident" id="8257470">testing</span><span class="op" id="8257477">.</span><span class="ident" id="8257478">T</span><span class="op" id="8257479">)</span>&nbsp;<span class="op" id="8257481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257484">for</span>&nbsp;<span class="ident" id="8257488">bs</span>&nbsp;<span class="op" id="8257491">:=</span>&nbsp;<span class="num" id="8257494">1</span><span class="op" id="8257495">;</span>&nbsp;<span class="ident" id="8257497">bs</span>&nbsp;<span class="op" id="8257500">&lt;=</span>&nbsp;<span class="num" id="8257503">12</span><span class="op" id="8257505">;</span>&nbsp;<span class="ident" id="8257507">bs</span><span class="op" id="8257509">++</span>&nbsp;<span class="op" id="8257512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257516">decoder</span>&nbsp;<span class="op" id="8257524">:=</span>&nbsp;<span class="ident" id="8257527">NewDecoder</span><span class="op" id="8257537">(</span><span class="ident" id="8257538">strings</span><span class="op" id="8257545">.</span><span class="ident" id="8257546">NewReader</span><span class="op" id="8257555">(</span><span class="ident" id="8257556">bigtest</span><span class="op" id="8257563">.</span><span class="ident" id="8257564">encoded</span><span class="op" id="8257571">)</span><span class="op" id="8257572">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257576">buf</span>&nbsp;<span class="op" id="8257580">:=</span>&nbsp;<span class="builtinfunc" id="8257583">make</span><span class="op" id="8257587">(</span><span class="op" id="8257588">[</span><span class="op" id="8257589">]</span><span class="builtintype" id="8257590">byte</span><span class="op" id="8257594">,</span>&nbsp;<span class="builtinfunc" id="8257596">len</span><span class="op" id="8257599">(</span><span class="ident" id="8257600">bigtest</span><span class="op" id="8257607">.</span><span class="ident" id="8257608">decoded</span><span class="op" id="8257615">)</span><span class="op" id="8257616">+</span><span class="num" id="8257617">12</span><span class="op" id="8257619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257623">var</span>&nbsp;<span class="ident" id="8257627">total</span>&nbsp;<span class="builtintype" id="8257633">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8257639">for</span>&nbsp;<span class="ident" id="8257643">total</span>&nbsp;<span class="op" id="8257649">=</span>&nbsp;<span class="num" id="8257651">0</span><span class="op" id="8257652">;</span>&nbsp;<span class="ident" id="8257654">total</span>&nbsp;<span class="op" id="8257660">&lt;</span>&nbsp;<span class="builtinfunc" id="8257662">len</span><span class="op" id="8257665">(</span><span class="ident" id="8257666">bigtest</span><span class="op" id="8257673">.</span><span class="ident" id="8257674">decoded</span><span class="op" id="8257681">)</span><span class="op" id="8257682">;</span>&nbsp;<span class="op" id="8257684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257689">n</span><span class="op" id="8257690">,</span>&nbsp;<span class="ident" id="8257692">err</span>&nbsp;<span class="op" id="8257696">:=</span>&nbsp;<span class="ident" id="8257699">decoder</span><span class="op" id="8257706">.</span><span class="ident" id="8257707">Read</span><span class="op" id="8257711">(</span><span class="ident" id="8257712">buf</span><span class="op" id="8257715">[</span><span class="ident" id="8257716">total</span>&nbsp;<span class="op" id="8257722">:</span>&nbsp;<span class="ident" id="8257724">total</span><span class="op" id="8257729">+</span><span class="ident" id="8257730">bs</span><span class="op" id="8257732">]</span><span class="op" id="8257733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257738">testEqual</span><span class="op" id="8257747">(</span><span class="ident" id="8257748">t</span><span class="op" id="8257749">,</span>&nbsp;<span class="string" id="8257751">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="8257796">,</span>&nbsp;<span class="ident" id="8257798">bigtest</span><span class="op" id="8257805">.</span><span class="ident" id="8257806">encoded</span><span class="op" id="8257813">,</span>&nbsp;<span class="ident" id="8257815">total</span><span class="op" id="8257820">,</span>&nbsp;<span class="ident" id="8257822">n</span><span class="op" id="8257823">,</span>&nbsp;<span class="ident" id="8257825">err</span><span class="op" id="8257828">,</span>&nbsp;<span class="builtintype" id="8257830">error</span><span class="op" id="8257835">(</span><span class="ident" id="8257836">nil</span><span class="op" id="8257839">)</span><span class="op" id="8257840">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257845">total</span>&nbsp;<span class="op" id="8257851">+=</span>&nbsp;<span class="ident" id="8257854">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257862">testEqual</span><span class="op" id="8257871">(</span><span class="ident" id="8257872">t</span><span class="op" id="8257873">,</span>&nbsp;<span class="string" id="8257875">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8257908">,</span>&nbsp;<span class="ident" id="8257910">bs</span><span class="op" id="8257912">,</span>&nbsp;<span class="ident" id="8257914">bigtest</span><span class="op" id="8257921">.</span><span class="ident" id="8257922">encoded</span><span class="op" id="8257929">,</span>&nbsp;<span class="builtintype" id="8257931">string</span><span class="op" id="8257937">(</span><span class="ident" id="8257938">buf</span><span class="op" id="8257941">[</span><span class="num" id="8257942">0</span><span class="op" id="8257943">:</span><span class="ident" id="8257944">total</span><span class="op" id="8257949">]</span><span class="op" id="8257950">)</span><span class="op" id="8257951">,</span>&nbsp;<span class="ident" id="8257953">bigtest</span><span class="op" id="8257960">.</span><span class="ident" id="8257961">decoded</span><span class="op" id="8257968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8257971">}</span><br>
<span class="lineno"></span><span class="op" id="8257973">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8257976">func</span>&nbsp;<span class="ident" id="8257981">TestDecodeCorrupt</span><span class="op" id="8257998">(</span><span class="ident" id="8257999">t</span>&nbsp;<span class="op" id="8258001">*</span><span class="ident" id="8258002">testing</span><span class="op" id="8258009">.</span><span class="ident" id="8258010">T</span><span class="op" id="8258011">)</span>&nbsp;<span class="op" id="8258013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258016">type</span>&nbsp;<span class="ident" id="8258021">corrupt</span>&nbsp;<span class="keyword" id="8258029">struct</span>&nbsp;<span class="op" id="8258036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258040">e</span>&nbsp;<span class="builtintype" id="8258042">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258051">p</span>&nbsp;<span class="builtintype" id="8258053">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258061">examples</span>&nbsp;<span class="op" id="8258070">:=</span>&nbsp;<span class="op" id="8258073">[</span><span class="op" id="8258074">]</span><span class="ident" id="8258075">corrupt</span><span class="op" id="8258082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258086">{</span><span class="string" id="8258087">&#34;v&#34;</span><span class="op" id="8258090">,</span>&nbsp;<span class="num" id="8258092">0</span><span class="op" id="8258093">}</span><span class="op" id="8258094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258098">{</span><span class="string" id="8258099">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="8258112">,</span>&nbsp;<span class="num" id="8258114">1</span><span class="op" id="8258115">}</span><span class="op" id="8258116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258119">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258123">for</span>&nbsp;<span class="ident" id="8258127">_</span><span class="op" id="8258128">,</span>&nbsp;<span class="ident" id="8258130">e</span>&nbsp;<span class="op" id="8258132">:=</span>&nbsp;<span class="keyword" id="8258135">range</span>&nbsp;<span class="ident" id="8258141">examples</span>&nbsp;<span class="op" id="8258150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258154">dbuf</span>&nbsp;<span class="op" id="8258159">:=</span>&nbsp;<span class="builtinfunc" id="8258162">make</span><span class="op" id="8258166">(</span><span class="op" id="8258167">[</span><span class="op" id="8258168">]</span><span class="builtintype" id="8258169">byte</span><span class="op" id="8258173">,</span>&nbsp;<span class="num" id="8258175">4</span><span class="op" id="8258176">*</span><span class="builtinfunc" id="8258177">len</span><span class="op" id="8258180">(</span><span class="ident" id="8258181">e</span><span class="op" id="8258182">.</span><span class="ident" id="8258183">e</span><span class="op" id="8258184">)</span><span class="op" id="8258185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258189">_</span><span class="op" id="8258190">,</span>&nbsp;<span class="ident" id="8258192">_</span><span class="op" id="8258193">,</span>&nbsp;<span class="ident" id="8258195">err</span>&nbsp;<span class="op" id="8258199">:=</span>&nbsp;<span class="ident" id="8258202">Decode</span><span class="op" id="8258208">(</span><span class="ident" id="8258209">dbuf</span><span class="op" id="8258213">,</span>&nbsp;<span class="op" id="8258215">[</span><span class="op" id="8258216">]</span><span class="builtintype" id="8258217">byte</span><span class="op" id="8258221">(</span><span class="ident" id="8258222">e</span><span class="op" id="8258223">.</span><span class="ident" id="8258224">e</span><span class="op" id="8258225">)</span><span class="op" id="8258226">,</span>&nbsp;<span class="builtintype" id="8258228">true</span><span class="op" id="8258232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258236">switch</span>&nbsp;<span class="ident" id="8258243">err</span>&nbsp;<span class="op" id="8258247">:=</span>&nbsp;<span class="ident" id="8258250">err</span><span class="op" id="8258253">.</span><span class="op" id="8258254">(</span><span class="keyword" id="8258255">type</span><span class="op" id="8258259">)</span>&nbsp;<span class="op" id="8258261">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258265">case</span>&nbsp;<span class="ident" id="8258270">CorruptInputError</span><span class="op" id="8258287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258292">testEqual</span><span class="op" id="8258301">(</span><span class="ident" id="8258302">t</span><span class="op" id="8258303">,</span>&nbsp;<span class="string" id="8258305">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8258345">,</span>&nbsp;<span class="ident" id="8258347">e</span><span class="op" id="8258348">.</span><span class="ident" id="8258349">e</span><span class="op" id="8258350">,</span>&nbsp;<span class="builtintype" id="8258352">int</span><span class="op" id="8258355">(</span><span class="ident" id="8258356">err</span><span class="op" id="8258359">)</span><span class="op" id="8258360">,</span>&nbsp;<span class="ident" id="8258362">e</span><span class="op" id="8258363">.</span><span class="ident" id="8258364">p</span><span class="op" id="8258365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258369">default</span><span class="op" id="8258376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258381">t</span><span class="op" id="8258382">.</span><span class="ident" id="8258383">Error</span><span class="op" id="8258388">(</span><span class="string" id="8258389">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="8258429">,</span>&nbsp;<span class="ident" id="8258431">e</span><span class="op" id="8258432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258436">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258439">}</span><br>
<span class="lineno"></span><span class="op" id="8258441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8258444">func</span>&nbsp;<span class="ident" id="8258449">TestBig</span><span class="op" id="8258456">(</span><span class="ident" id="8258457">t</span>&nbsp;<span class="op" id="8258459">*</span><span class="ident" id="8258460">testing</span><span class="op" id="8258467">.</span><span class="ident" id="8258468">T</span><span class="op" id="8258469">)</span>&nbsp;<span class="op" id="8258471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258474">n</span>&nbsp;<span class="op" id="8258476">:=</span>&nbsp;<span class="num" id="8258479">3</span><span class="op" id="8258480">*</span><span class="num" id="8258481">1000</span>&nbsp;<span class="op" id="8258486">+</span>&nbsp;<span class="num" id="8258488">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258491">raw</span>&nbsp;<span class="op" id="8258495">:=</span>&nbsp;<span class="builtinfunc" id="8258498">make</span><span class="op" id="8258502">(</span><span class="op" id="8258503">[</span><span class="op" id="8258504">]</span><span class="builtintype" id="8258505">byte</span><span class="op" id="8258509">,</span>&nbsp;<span class="ident" id="8258511">n</span><span class="op" id="8258512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258515">const</span>&nbsp;<span class="ident" id="8258521">alpha</span>&nbsp;<span class="op" id="8258527">=</span>&nbsp;<span class="string" id="8258529">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258595">for</span>&nbsp;<span class="ident" id="8258599">i</span>&nbsp;<span class="op" id="8258601">:=</span>&nbsp;<span class="num" id="8258604">0</span><span class="op" id="8258605">;</span>&nbsp;<span class="ident" id="8258607">i</span>&nbsp;<span class="op" id="8258609">&lt;</span>&nbsp;<span class="ident" id="8258611">n</span><span class="op" id="8258612">;</span>&nbsp;<span class="ident" id="8258614">i</span><span class="op" id="8258615">++</span>&nbsp;<span class="op" id="8258618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258622">raw</span><span class="op" id="8258625">[</span><span class="ident" id="8258626">i</span><span class="op" id="8258627">]</span>&nbsp;<span class="op" id="8258629">=</span>&nbsp;<span class="ident" id="8258631">alpha</span><span class="op" id="8258636">[</span><span class="ident" id="8258637">i</span><span class="op" id="8258638">%</span><span class="builtinfunc" id="8258639">len</span><span class="op" id="8258642">(</span><span class="ident" id="8258643">alpha</span><span class="op" id="8258648">)</span><span class="op" id="8258649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258652">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258655">encoded</span>&nbsp;<span class="op" id="8258663">:=</span>&nbsp;<span class="builtinfunc" id="8258666">new</span><span class="op" id="8258669">(</span><span class="ident" id="8258670">bytes</span><span class="op" id="8258675">.</span><span class="ident" id="8258676">Buffer</span><span class="op" id="8258682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258685">w</span>&nbsp;<span class="op" id="8258687">:=</span>&nbsp;<span class="ident" id="8258690">NewEncoder</span><span class="op" id="8258700">(</span><span class="ident" id="8258701">encoded</span><span class="op" id="8258708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258711">nn</span><span class="op" id="8258713">,</span>&nbsp;<span class="ident" id="8258715">err</span>&nbsp;<span class="op" id="8258719">:=</span>&nbsp;<span class="ident" id="8258722">w</span><span class="op" id="8258723">.</span><span class="ident" id="8258724">Write</span><span class="op" id="8258729">(</span><span class="ident" id="8258730">raw</span><span class="op" id="8258733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258736">if</span>&nbsp;<span class="ident" id="8258739">nn</span>&nbsp;<span class="op" id="8258742">!=</span>&nbsp;<span class="ident" id="8258745">n</span>&nbsp;<span class="op" id="8258747">||</span>&nbsp;<span class="ident" id="8258750">err</span>&nbsp;<span class="op" id="8258754">!=</span>&nbsp;<span class="ident" id="8258757">nil</span>&nbsp;<span class="op" id="8258761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258765">t</span><span class="op" id="8258766">.</span><span class="ident" id="8258767">Fatalf</span><span class="op" id="8258773">(</span><span class="string" id="8258774">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8258816">,</span>&nbsp;<span class="ident" id="8258818">nn</span><span class="op" id="8258820">,</span>&nbsp;<span class="ident" id="8258822">err</span><span class="op" id="8258825">,</span>&nbsp;<span class="ident" id="8258827">n</span><span class="op" id="8258828">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258834">err</span>&nbsp;<span class="op" id="8258838">=</span>&nbsp;<span class="ident" id="8258840">w</span><span class="op" id="8258841">.</span><span class="ident" id="8258842">Close</span><span class="op" id="8258847">(</span><span class="op" id="8258848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258851">if</span>&nbsp;<span class="ident" id="8258854">err</span>&nbsp;<span class="op" id="8258858">!=</span>&nbsp;<span class="ident" id="8258861">nil</span>&nbsp;<span class="op" id="8258865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258869">t</span><span class="op" id="8258870">.</span><span class="ident" id="8258871">Fatalf</span><span class="op" id="8258877">(</span><span class="string" id="8258878">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="8258909">,</span>&nbsp;<span class="ident" id="8258911">err</span><span class="op" id="8258914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258917">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258920">decoded</span><span class="op" id="8258927">,</span>&nbsp;<span class="ident" id="8258929">err</span>&nbsp;<span class="op" id="8258933">:=</span>&nbsp;<span class="ident" id="8258936">ioutil</span><span class="op" id="8258942">.</span><span class="ident" id="8258943">ReadAll</span><span class="op" id="8258950">(</span><span class="ident" id="8258951">NewDecoder</span><span class="op" id="8258961">(</span><span class="ident" id="8258962">encoded</span><span class="op" id="8258969">)</span><span class="op" id="8258970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258973">if</span>&nbsp;<span class="ident" id="8258976">err</span>&nbsp;<span class="op" id="8258980">!=</span>&nbsp;<span class="ident" id="8258983">nil</span>&nbsp;<span class="op" id="8258987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258991">t</span><span class="op" id="8258992">.</span><span class="ident" id="8258993">Fatalf</span><span class="op" id="8258999">(</span><span class="string" id="8259000">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="8259033">,</span>&nbsp;<span class="ident" id="8259035">err</span><span class="op" id="8259038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259045">if</span>&nbsp;<span class="op" id="8259048">!</span><span class="ident" id="8259049">bytes</span><span class="op" id="8259054">.</span><span class="ident" id="8259055">Equal</span><span class="op" id="8259060">(</span><span class="ident" id="8259061">raw</span><span class="op" id="8259064">,</span>&nbsp;<span class="ident" id="8259066">decoded</span><span class="op" id="8259073">)</span>&nbsp;<span class="op" id="8259075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259079">var</span>&nbsp;<span class="ident" id="8259083">i</span>&nbsp;<span class="builtintype" id="8259085">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259091">for</span>&nbsp;<span class="ident" id="8259095">i</span>&nbsp;<span class="op" id="8259097">=</span>&nbsp;<span class="num" id="8259099">0</span><span class="op" id="8259100">;</span>&nbsp;<span class="ident" id="8259102">i</span>&nbsp;<span class="op" id="8259104">&lt;</span>&nbsp;<span class="builtinfunc" id="8259106">len</span><span class="op" id="8259109">(</span><span class="ident" id="8259110">decoded</span><span class="op" id="8259117">)</span>&nbsp;<span class="op" id="8259119">&amp;&amp;</span>&nbsp;<span class="ident" id="8259122">i</span>&nbsp;<span class="op" id="8259124">&lt;</span>&nbsp;<span class="builtinfunc" id="8259126">len</span><span class="op" id="8259129">(</span><span class="ident" id="8259130">raw</span><span class="op" id="8259133">)</span><span class="op" id="8259134">;</span>&nbsp;<span class="ident" id="8259136">i</span><span class="op" id="8259137">++</span>&nbsp;<span class="op" id="8259140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259145">if</span>&nbsp;<span class="ident" id="8259148">decoded</span><span class="op" id="8259155">[</span><span class="ident" id="8259156">i</span><span class="op" id="8259157">]</span>&nbsp;<span class="op" id="8259159">!=</span>&nbsp;<span class="ident" id="8259162">raw</span><span class="op" id="8259165">[</span><span class="ident" id="8259166">i</span><span class="op" id="8259167">]</span>&nbsp;<span class="op" id="8259169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259175">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259192">t</span><span class="op" id="8259193">.</span><span class="ident" id="8259194">Errorf</span><span class="op" id="8259200">(</span><span class="string" id="8259201">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="8259253">,</span>&nbsp;<span class="ident" id="8259255">n</span><span class="op" id="8259256">,</span>&nbsp;<span class="ident" id="8259258">i</span><span class="op" id="8259259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259262">}</span><br>
<span class="lineno"></span><span class="op" id="8259264">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="8259267">func</span>&nbsp;<span class="ident" id="8259272">TestDecoderInternalWhitespace</span><span class="op" id="8259301">(</span><span class="ident" id="8259302">t</span>&nbsp;<span class="op" id="8259304">*</span><span class="ident" id="8259305">testing</span><span class="op" id="8259312">.</span><span class="ident" id="8259313">T</span><span class="op" id="8259314">)</span>&nbsp;<span class="op" id="8259316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259319">s</span>&nbsp;<span class="op" id="8259321">:=</span>&nbsp;<span class="ident" id="8259324">strings</span><span class="op" id="8259331">.</span><span class="ident" id="8259332">Repeat</span><span class="op" id="8259338">(</span><span class="string" id="8259339">&#34;&nbsp;&#34;</span><span class="op" id="8259342">,</span>&nbsp;<span class="num" id="8259344">2048</span><span class="op" id="8259348">)</span>&nbsp;<span class="op" id="8259350">+</span>&nbsp;<span class="string" id="8259352">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259357">decoded</span><span class="op" id="8259364">,</span>&nbsp;<span class="ident" id="8259366">err</span>&nbsp;<span class="op" id="8259370">:=</span>&nbsp;<span class="ident" id="8259373">ioutil</span><span class="op" id="8259379">.</span><span class="ident" id="8259380">ReadAll</span><span class="op" id="8259387">(</span><span class="ident" id="8259388">NewDecoder</span><span class="op" id="8259398">(</span><span class="ident" id="8259399">strings</span><span class="op" id="8259406">.</span><span class="ident" id="8259407">NewReader</span><span class="op" id="8259416">(</span><span class="ident" id="8259417">s</span><span class="op" id="8259418">)</span><span class="op" id="8259419">)</span><span class="op" id="8259420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259423">if</span>&nbsp;<span class="ident" id="8259426">err</span>&nbsp;<span class="op" id="8259430">!=</span>&nbsp;<span class="ident" id="8259433">nil</span>&nbsp;<span class="op" id="8259437">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259441">t</span><span class="op" id="8259442">.</span><span class="ident" id="8259443">Errorf</span><span class="op" id="8259449">(</span><span class="string" id="8259450">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="8259472">,</span>&nbsp;<span class="ident" id="8259474">err</span><span class="op" id="8259477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259483">if</span>&nbsp;<span class="ident" id="8259486">want</span>&nbsp;<span class="op" id="8259491">:=</span>&nbsp;<span class="op" id="8259494">[</span><span class="op" id="8259495">]</span><span class="builtintype" id="8259496">byte</span><span class="op" id="8259500">(</span><span class="string" id="8259501">&#34;\000\000\000\000&#34;</span><span class="op" id="8259519">)</span><span class="op" id="8259520">;</span>&nbsp;<span class="op" id="8259522">!</span><span class="ident" id="8259523">bytes</span><span class="op" id="8259528">.</span><span class="ident" id="8259529">Equal</span><span class="op" id="8259534">(</span><span class="ident" id="8259535">want</span><span class="op" id="8259539">,</span>&nbsp;<span class="ident" id="8259541">decoded</span><span class="op" id="8259548">)</span>&nbsp;<span class="op" id="8259550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259554">t</span><span class="op" id="8259555">.</span><span class="ident" id="8259556">Errorf</span><span class="op" id="8259562">(</span><span class="string" id="8259563">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8259595">,</span>&nbsp;<span class="ident" id="8259597">decoded</span><span class="op" id="8259604">,</span>&nbsp;<span class="ident" id="8259606">want</span><span class="op" id="8259610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259613">}</span><br>
<span class="lineno">210</span><span class="op" id="8259615">}</span>
</div>
</body>
</html>
