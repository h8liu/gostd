<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7033510">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7033565">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7033619">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7033670">package</span>&nbsp;<span class="ident" id="7033678">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033685">import</span>&nbsp;<span class="op" id="7033692">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7033695">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7033706">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="7033716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033719">type</span>&nbsp;<span class="ident" id="7033724">T</span>&nbsp;<span class="builtintype" id="7033726">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033731">func</span>&nbsp;<span class="op" id="7033736">(</span><span class="ident" id="7033737">t</span>&nbsp;<span class="op" id="7033739">*</span><span class="ident" id="7033740">T</span><span class="op" id="7033741">)</span>&nbsp;<span class="ident" id="7033743">ptrmethod</span><span class="op" id="7033752">(</span><span class="op" id="7033753">)</span>&nbsp;<span class="op" id="7033755">[</span><span class="op" id="7033756">]</span><span class="builtintype" id="7033757">byte</span>&nbsp;<span class="op" id="7033762">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033765">return</span>&nbsp;<span class="ident" id="7033772">Stack</span><span class="op" id="7033777">(</span><span class="op" id="7033778">)</span><br>
<span class="lineno"></span><span class="op" id="7033780">}</span><br>
<span class="lineno"></span><span class="keyword" id="7033782">func</span>&nbsp;<span class="op" id="7033787">(</span><span class="ident" id="7033788">t</span>&nbsp;<span class="ident" id="7033790">T</span><span class="op" id="7033791">)</span>&nbsp;<span class="ident" id="7033793">method</span><span class="op" id="7033799">(</span><span class="op" id="7033800">)</span>&nbsp;<span class="op" id="7033802">[</span><span class="op" id="7033803">]</span><span class="builtintype" id="7033804">byte</span>&nbsp;<span class="op" id="7033809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7033812">return</span>&nbsp;<span class="ident" id="7033819">t</span><span class="op" id="7033820">.</span><span class="ident" id="7033821">ptrmethod</span><span class="op" id="7033830">(</span><span class="op" id="7033831">)</span><br>
<span class="lineno"></span><span class="op" id="7033833">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="7033836">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="7034449">func</span>&nbsp;<span class="ident" id="7034454">TestStack</span><span class="op" id="7034463">(</span><span class="ident" id="7034464">t</span>&nbsp;<span class="op" id="7034466">*</span><span class="ident" id="7034467">testing</span><span class="op" id="7034474">.</span><span class="ident" id="7034475">T</span><span class="op" id="7034476">)</span>&nbsp;<span class="op" id="7034478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034481">b</span>&nbsp;<span class="op" id="7034483">:=</span>&nbsp;<span class="ident" id="7034486">T</span><span class="op" id="7034487">(</span><span class="num" id="7034488">0</span><span class="op" id="7034489">)</span><span class="op" id="7034490">.</span><span class="ident" id="7034491">method</span><span class="op" id="7034497">(</span><span class="op" id="7034498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034501">lines</span>&nbsp;<span class="op" id="7034507">:=</span>&nbsp;<span class="ident" id="7034510">strings</span><span class="op" id="7034517">.</span><span class="ident" id="7034518">Split</span><span class="op" id="7034523">(</span><span class="builtintype" id="7034524">string</span><span class="op" id="7034530">(</span><span class="ident" id="7034531">b</span><span class="op" id="7034532">)</span><span class="op" id="7034533">,</span>&nbsp;<span class="string" id="7034535">&#34;\n&#34;</span><span class="op" id="7034539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034542">if</span>&nbsp;<span class="builtinfunc" id="7034545">len</span><span class="op" id="7034548">(</span><span class="ident" id="7034549">lines</span><span class="op" id="7034554">)</span>&nbsp;<span class="op" id="7034556">&lt;</span>&nbsp;<span class="num" id="7034558">6</span>&nbsp;<span class="op" id="7034560">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034564">t</span><span class="op" id="7034565">.</span><span class="ident" id="7034566">Fatal</span><span class="op" id="7034571">(</span><span class="string" id="7034572">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="7034587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034593">n</span>&nbsp;<span class="op" id="7034595">:=</span>&nbsp;<span class="num" id="7034598">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034601">frame</span>&nbsp;<span class="op" id="7034607">:=</span>&nbsp;<span class="keyword" id="7034610">func</span><span class="op" id="7034614">(</span><span class="ident" id="7034615">line</span><span class="op" id="7034619">,</span>&nbsp;<span class="ident" id="7034621">code</span>&nbsp;<span class="builtintype" id="7034626">string</span><span class="op" id="7034632">)</span>&nbsp;<span class="op" id="7034634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034638">check</span><span class="op" id="7034643">(</span><span class="ident" id="7034644">t</span><span class="op" id="7034645">,</span>&nbsp;<span class="ident" id="7034647">lines</span><span class="op" id="7034652">[</span><span class="ident" id="7034653">n</span><span class="op" id="7034654">]</span><span class="op" id="7034655">,</span>&nbsp;<span class="ident" id="7034657">line</span><span class="op" id="7034661">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034665">n</span><span class="op" id="7034666">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7034671">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7034734">if</span>&nbsp;<span class="ident" id="7034737">strings</span><span class="op" id="7034744">.</span><span class="ident" id="7034745">HasPrefix</span><span class="op" id="7034754">(</span><span class="ident" id="7034755">lines</span><span class="op" id="7034760">[</span><span class="ident" id="7034761">n</span><span class="op" id="7034762">]</span><span class="op" id="7034763">,</span>&nbsp;<span class="string" id="7034765">&#34;\t&#34;</span><span class="op" id="7034769">)</span>&nbsp;<span class="op" id="7034771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034776">check</span><span class="op" id="7034781">(</span><span class="ident" id="7034782">t</span><span class="op" id="7034783">,</span>&nbsp;<span class="ident" id="7034785">lines</span><span class="op" id="7034790">[</span><span class="ident" id="7034791">n</span><span class="op" id="7034792">]</span><span class="op" id="7034793">,</span>&nbsp;<span class="ident" id="7034795">code</span><span class="op" id="7034799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034804">n</span><span class="op" id="7034805">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7034813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034816">frame</span><span class="op" id="7034821">(</span><span class="string" id="7034822">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7034855">,</span>&nbsp;<span class="string" id="7034857">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="7034891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034894">frame</span><span class="op" id="7034899">(</span><span class="string" id="7034900">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7034933">,</span>&nbsp;<span class="string" id="7034935">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="7034969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7034972">frame</span><span class="op" id="7034977">(</span><span class="string" id="7034978">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="7035011">,</span>&nbsp;<span class="string" id="7035013">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="7035046">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7035049">frame</span><span class="op" id="7035054">(</span><span class="string" id="7035055">&#34;src/testing/testing.go&#34;</span><span class="op" id="7035079">,</span>&nbsp;<span class="string" id="7035081">&#34;&#34;</span><span class="op" id="7035083">)</span><br>
<span class="lineno"></span><span class="op" id="7035085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035088">func</span>&nbsp;<span class="ident" id="7035093">check</span><span class="op" id="7035098">(</span><span class="ident" id="7035099">t</span>&nbsp;<span class="op" id="7035101">*</span><span class="ident" id="7035102">testing</span><span class="op" id="7035109">.</span><span class="ident" id="7035110">T</span><span class="op" id="7035111">,</span>&nbsp;<span class="ident" id="7035113">line</span><span class="op" id="7035117">,</span>&nbsp;<span class="ident" id="7035119">has</span>&nbsp;<span class="builtintype" id="7035123">string</span><span class="op" id="7035129">)</span>&nbsp;<span class="op" id="7035131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7035134">if</span>&nbsp;<span class="ident" id="7035137">strings</span><span class="op" id="7035144">.</span><span class="ident" id="7035145">Index</span><span class="op" id="7035150">(</span><span class="ident" id="7035151">line</span><span class="op" id="7035155">,</span>&nbsp;<span class="ident" id="7035157">has</span><span class="op" id="7035160">)</span>&nbsp;<span class="op" id="7035162">&lt;</span>&nbsp;<span class="num" id="7035164">0</span>&nbsp;<span class="op" id="7035166">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7035170">t</span><span class="op" id="7035171">.</span><span class="ident" id="7035172">Errorf</span><span class="op" id="7035178">(</span><span class="string" id="7035179">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="7035198">,</span>&nbsp;<span class="ident" id="7035200">has</span><span class="op" id="7035203">,</span>&nbsp;<span class="ident" id="7035205">line</span><span class="op" id="7035209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7035212">}</span><br>
<span class="lineno"></span><span class="op" id="7035214">}</span>
</div>
</body>
</html>
