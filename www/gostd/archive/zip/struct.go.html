<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html" class="current">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5432208">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5432263">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5432317">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5432368">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="5432877">package</span>&nbsp;<span class="ident" id="5432885">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5432890">import</span>&nbsp;<span class="op" id="5432897">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5432900">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5432906">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5432914">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5432921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5432924">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5432948">const</span>&nbsp;<span class="op" id="5432954">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432957">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5432965">uint16</span>&nbsp;<span class="op" id="5432972">=</span>&nbsp;<span class="num" id="5432974">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5432977">Deflate</span>&nbsp;<span class="builtintype" id="5432985">uint16</span>&nbsp;<span class="op" id="5432992">=</span>&nbsp;<span class="num" id="5432994">8</span><br>
<span class="lineno"></span><span class="op" id="5432996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5432999">const</span>&nbsp;<span class="op" id="5433005">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433008">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433033">=</span>&nbsp;<span class="num" id="5433035">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433047">directoryHeaderSignature</span>&nbsp;<span class="op" id="5433072">=</span>&nbsp;<span class="num" id="5433074">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433086">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433111">=</span>&nbsp;<span class="num" id="5433113">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433125">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="5433150">=</span>&nbsp;<span class="num" id="5433152">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433164">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="5433189">=</span>&nbsp;<span class="num" id="5433191">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433203">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="5433228">=</span>&nbsp;<span class="num" id="5433230">0x08074b50</span>&nbsp;<span class="comment" id="5433241">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433288">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433313">=</span>&nbsp;<span class="num" id="5433315">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433326">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433349">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433374">=</span>&nbsp;<span class="num" id="5433376">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433387">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433420">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433445">=</span>&nbsp;<span class="num" id="5433447">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433458">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433472">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433497">=</span>&nbsp;<span class="num" id="5433499">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433510">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433578">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433603">=</span>&nbsp;<span class="num" id="5433605">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433616">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433649">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433674">=</span>&nbsp;<span class="num" id="5433676">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433687">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433691">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433716">=</span>&nbsp;<span class="num" id="5433718">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433729">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433742">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433793">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5433807">=</span>&nbsp;<span class="num" id="5433809">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433812">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5433826">=</span>&nbsp;<span class="num" id="5433828">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433831">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5433845">=</span>&nbsp;<span class="num" id="5433847">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433851">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5433865">=</span>&nbsp;<span class="num" id="5433867">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433871">creatorMacOSX</span>&nbsp;<span class="op" id="5433885">=</span>&nbsp;<span class="num" id="5433887">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433892">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433912">zipVersion20</span>&nbsp;<span class="op" id="5433925">=</span>&nbsp;<span class="num" id="5433927">20</span>&nbsp;<span class="comment" id="5433930">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5433938">zipVersion45</span>&nbsp;<span class="op" id="5433951">=</span>&nbsp;<span class="num" id="5433953">45</span>&nbsp;<span class="comment" id="5433956">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5433999">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434030">uint16max</span>&nbsp;<span class="op" id="5434040">=</span>&nbsp;<span class="op" id="5434042">(</span><span class="num" id="5434043">1</span>&nbsp;<span class="op" id="5434045">&lt;&lt;</span>&nbsp;<span class="num" id="5434048">16</span><span class="op" id="5434050">)</span>&nbsp;<span class="op" id="5434052">-</span>&nbsp;<span class="num" id="5434054">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434057">uint32max</span>&nbsp;<span class="op" id="5434067">=</span>&nbsp;<span class="op" id="5434069">(</span><span class="num" id="5434070">1</span>&nbsp;<span class="op" id="5434072">&lt;&lt;</span>&nbsp;<span class="num" id="5434075">32</span><span class="op" id="5434077">)</span>&nbsp;<span class="op" id="5434079">-</span>&nbsp;<span class="num" id="5434081">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434085">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434107">zip64ExtraId</span>&nbsp;<span class="op" id="5434120">=</span>&nbsp;<span class="num" id="5434122">0x0001</span>&nbsp;<span class="comment" id="5434129">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="5434171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5434174">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5434224">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="5434257">type</span>&nbsp;<span class="ident" id="5434262">FileHeader</span>&nbsp;<span class="keyword" id="5434273">struct</span>&nbsp;<span class="op" id="5434280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434283">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434317">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434380">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5434444">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434461">Name</span>&nbsp;<span class="builtintype" id="5434466">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434475">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434494">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434502">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434521">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434529">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434548">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434556">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434575">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434583">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434602">uint16</span>&nbsp;<span class="comment" id="5434609">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434625">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434644">uint16</span>&nbsp;<span class="comment" id="5434651">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434667">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434686">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434694">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434713">uint32</span>&nbsp;<span class="comment" id="5434720">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434757">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434776">uint32</span>&nbsp;<span class="comment" id="5434783">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434822">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5434841">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434849">UncompressedSize64</span>&nbsp;<span class="ident" id="5434868">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434876">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5434895">[</span><span class="op" id="5434896">]</span><span class="builtintype" id="5434897">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434903">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434922">uint32</span>&nbsp;<span class="comment" id="5434929">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5434967">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5434986">string</span><br>
<span class="lineno"></span><span class="op" id="5434993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5434996">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5435051">func</span>&nbsp;<span class="op" id="5435056">(</span><span class="ident" id="5435057">h</span>&nbsp;<span class="op" id="5435059">*</span><span class="ident" id="5435060">FileHeader</span><span class="op" id="5435070">)</span>&nbsp;<span class="ident" id="5435072">FileInfo</span><span class="op" id="5435080">(</span><span class="op" id="5435081">)</span>&nbsp;<span class="ident" id="5435083">os</span><span class="op" id="5435085">.</span><span class="ident" id="5435086">FileInfo</span>&nbsp;<span class="op" id="5435095">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435098">return</span>&nbsp;<span class="ident" id="5435105">headerFileInfo</span><span class="op" id="5435119">{</span><span class="ident" id="5435120">h</span><span class="op" id="5435121">}</span><br>
<span class="lineno"></span><span class="op" id="5435123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5435126">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="5435168">type</span>&nbsp;<span class="ident" id="5435173">headerFileInfo</span>&nbsp;<span class="keyword" id="5435188">struct</span>&nbsp;<span class="op" id="5435195">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5435198">fh</span>&nbsp;<span class="op" id="5435201">*</span><span class="ident" id="5435202">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="5435213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5435216">func</span>&nbsp;<span class="op" id="5435221">(</span><span class="ident" id="5435222">fi</span>&nbsp;<span class="ident" id="5435225">headerFileInfo</span><span class="op" id="5435239">)</span>&nbsp;<span class="ident" id="5435241">Name</span><span class="op" id="5435245">(</span><span class="op" id="5435246">)</span>&nbsp;<span class="builtintype" id="5435248">string</span>&nbsp;<span class="op" id="5435255">{</span>&nbsp;<span class="keyword" id="5435257">return</span>&nbsp;<span class="ident" id="5435264">path</span><span class="op" id="5435268">.</span><span class="ident" id="5435269">Base</span><span class="op" id="5435273">(</span><span class="ident" id="5435274">fi</span><span class="op" id="5435276">.</span><span class="ident" id="5435277">fh</span><span class="op" id="5435279">.</span><span class="ident" id="5435280">Name</span><span class="op" id="5435284">)</span>&nbsp;<span class="op" id="5435286">}</span><br>
<span class="lineno"></span><span class="keyword" id="5435288">func</span>&nbsp;<span class="op" id="5435293">(</span><span class="ident" id="5435294">fi</span>&nbsp;<span class="ident" id="5435297">headerFileInfo</span><span class="op" id="5435311">)</span>&nbsp;<span class="ident" id="5435313">Size</span><span class="op" id="5435317">(</span><span class="op" id="5435318">)</span>&nbsp;<span class="ident" id="5435320">int64</span>&nbsp;<span class="op" id="5435326">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435329">if</span>&nbsp;<span class="ident" id="5435332">fi</span><span class="op" id="5435334">.</span><span class="ident" id="5435335">fh</span><span class="op" id="5435337">.</span><span class="ident" id="5435338">UncompressedSize64</span>&nbsp;<span class="op" id="5435357">&gt;</span>&nbsp;<span class="num" id="5435359">0</span>&nbsp;<span class="op" id="5435361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435365">return</span>&nbsp;<span class="ident" id="5435372">int64</span><span class="op" id="5435377">(</span><span class="ident" id="5435378">fi</span><span class="op" id="5435380">.</span><span class="ident" id="5435381">fh</span><span class="op" id="5435383">.</span><span class="ident" id="5435384">UncompressedSize64</span><span class="op" id="5435402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5435408">return</span>&nbsp;<span class="ident" id="5435415">int64</span><span class="op" id="5435420">(</span><span class="ident" id="5435421">fi</span><span class="op" id="5435423">.</span><span class="ident" id="5435424">fh</span><span class="op" id="5435426">.</span><span class="ident" id="5435427">UncompressedSize</span><span class="op" id="5435443">)</span><br>
<span class="lineno"></span><span class="op" id="5435445">}</span><br>
<span class="lineno">110</span><span class="keyword" id="5435447">func</span>&nbsp;<span class="op" id="5435452">(</span><span class="ident" id="5435453">fi</span>&nbsp;<span class="ident" id="5435456">headerFileInfo</span><span class="op" id="5435470">)</span>&nbsp;<span class="ident" id="5435472">IsDir</span><span class="op" id="5435477">(</span><span class="op" id="5435478">)</span>&nbsp;<span class="builtintype" id="5435480">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5435492">{</span>&nbsp;<span class="keyword" id="5435494">return</span>&nbsp;<span class="ident" id="5435501">fi</span><span class="op" id="5435503">.</span><span class="ident" id="5435504">Mode</span><span class="op" id="5435508">(</span><span class="op" id="5435509">)</span><span class="op" id="5435510">.</span><span class="ident" id="5435511">IsDir</span><span class="op" id="5435516">(</span><span class="op" id="5435517">)</span>&nbsp;<span class="op" id="5435519">}</span><br>
<span class="lineno"></span><span class="keyword" id="5435521">func</span>&nbsp;<span class="op" id="5435526">(</span><span class="ident" id="5435527">fi</span>&nbsp;<span class="ident" id="5435530">headerFileInfo</span><span class="op" id="5435544">)</span>&nbsp;<span class="ident" id="5435546">ModTime</span><span class="op" id="5435553">(</span><span class="op" id="5435554">)</span>&nbsp;<span class="ident" id="5435556">time</span><span class="op" id="5435560">.</span><span class="ident" id="5435561">Time</span>&nbsp;<span class="op" id="5435566">{</span>&nbsp;<span class="keyword" id="5435568">return</span>&nbsp;<span class="ident" id="5435575">fi</span><span class="op" id="5435577">.</span><span class="ident" id="5435578">fh</span><span class="op" id="5435580">.</span><span class="ident" id="5435581">ModTime</span><span class="op" id="5435588">(</span><span class="op" id="5435589">)</span>&nbsp;<span class="op" id="5435591">}</span><br>
<span class="lineno"></span><span class="keyword" id="5435593">func</span>&nbsp;<span class="op" id="5435598">(</span><span class="ident" id="5435599">fi</span>&nbsp;<span class="ident" id="5435602">headerFileInfo</span><span class="op" id="5435616">)</span>&nbsp;<span class="ident" id="5435618">Mode</span><span class="op" id="5435622">(</span><span class="op" id="5435623">)</span>&nbsp;<span class="ident" id="5435625">os</span><span class="op" id="5435627">.</span><span class="ident" id="5435628">FileMode</span>&nbsp;&nbsp;<span class="op" id="5435638">{</span>&nbsp;<span class="keyword" id="5435640">return</span>&nbsp;<span class="ident" id="5435647">fi</span><span class="op" id="5435649">.</span><span class="ident" id="5435650">fh</span><span class="op" id="5435652">.</span><span class="ident" id="5435653">Mode</span><span class="op" id="5435657">(</span><span class="op" id="5435658">)</span>&nbsp;<span class="op" id="5435660">}</span><br>
<span class="lineno"></span><span class="keyword" id="5435662">func</span>&nbsp;<span class="op" id="5435667">(</span><span class="ident" id="5435668">fi</span>&nbsp;<span class="ident" id="5435671">headerFileInfo</span><span class="op" id="5435685">)</span>&nbsp;<span class="ident" id="5435687">Sys</span><span class="op" id="5435690">(</span><span class="op" id="5435691">)</span>&nbsp;<span class="keyword" id="5435693">interface</span><span class="op" id="5435702">{</span><span class="op" id="5435703">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5435707">{</span>&nbsp;<span class="keyword" id="5435709">return</span>&nbsp;<span class="ident" id="5435716">fi</span><span class="op" id="5435718">.</span><span class="ident" id="5435719">fh</span>&nbsp;<span class="op" id="5435722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5435725">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5435792">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5435808">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5435875">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5435946">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="5436015">func</span>&nbsp;<span class="ident" id="5436020">FileInfoHeader</span><span class="op" id="5436034">(</span><span class="ident" id="5436035">fi</span>&nbsp;<span class="ident" id="5436038">os</span><span class="op" id="5436040">.</span><span class="ident" id="5436041">FileInfo</span><span class="op" id="5436049">)</span>&nbsp;<span class="op" id="5436051">(</span><span class="op" id="5436052">*</span><span class="ident" id="5436053">FileHeader</span><span class="op" id="5436063">,</span>&nbsp;<span class="builtintype" id="5436065">error</span><span class="op" id="5436070">)</span>&nbsp;<span class="op" id="5436072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436075">size</span>&nbsp;<span class="op" id="5436080">:=</span>&nbsp;<span class="ident" id="5436083">fi</span><span class="op" id="5436085">.</span><span class="ident" id="5436086">Size</span><span class="op" id="5436090">(</span><span class="op" id="5436091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436094">fh</span>&nbsp;<span class="op" id="5436097">:=</span>&nbsp;<span class="op" id="5436100">&amp;</span><span class="ident" id="5436101">FileHeader</span><span class="op" id="5436111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436115">Name</span><span class="op" id="5436119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436135">fi</span><span class="op" id="5436137">.</span><span class="ident" id="5436138">Name</span><span class="op" id="5436142">(</span><span class="op" id="5436143">)</span><span class="op" id="5436144">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436148">UncompressedSize64</span><span class="op" id="5436166">:</span>&nbsp;<span class="ident" id="5436168">uint64</span><span class="op" id="5436174">(</span><span class="ident" id="5436175">size</span><span class="op" id="5436179">)</span><span class="op" id="5436180">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436186">fh</span><span class="op" id="5436188">.</span><span class="ident" id="5436189">SetModTime</span><span class="op" id="5436199">(</span><span class="ident" id="5436200">fi</span><span class="op" id="5436202">.</span><span class="ident" id="5436203">ModTime</span><span class="op" id="5436210">(</span><span class="op" id="5436211">)</span><span class="op" id="5436212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436215">fh</span><span class="op" id="5436217">.</span><span class="ident" id="5436218">SetMode</span><span class="op" id="5436225">(</span><span class="ident" id="5436226">fi</span><span class="op" id="5436228">.</span><span class="ident" id="5436229">Mode</span><span class="op" id="5436233">(</span><span class="op" id="5436234">)</span><span class="op" id="5436235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436238">if</span>&nbsp;<span class="ident" id="5436241">fh</span><span class="op" id="5436243">.</span><span class="ident" id="5436244">UncompressedSize64</span>&nbsp;<span class="op" id="5436263">&gt;</span>&nbsp;<span class="ident" id="5436265">uint32max</span>&nbsp;<span class="op" id="5436275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436279">fh</span><span class="op" id="5436281">.</span><span class="ident" id="5436282">UncompressedSize</span>&nbsp;<span class="op" id="5436299">=</span>&nbsp;<span class="ident" id="5436301">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436312">}</span>&nbsp;<span class="keyword" id="5436314">else</span>&nbsp;<span class="op" id="5436319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436323">fh</span><span class="op" id="5436325">.</span><span class="ident" id="5436326">UncompressedSize</span>&nbsp;<span class="op" id="5436343">=</span>&nbsp;<span class="builtintype" id="5436345">uint32</span><span class="op" id="5436351">(</span><span class="ident" id="5436352">fh</span><span class="op" id="5436354">.</span><span class="ident" id="5436355">UncompressedSize64</span><span class="op" id="5436373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5436376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436379">return</span>&nbsp;<span class="ident" id="5436386">fh</span><span class="op" id="5436388">,</span>&nbsp;<span class="builtintype" id="5436390">nil</span><br>
<span class="lineno"></span><span class="op" id="5436394">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5436397">type</span>&nbsp;<span class="ident" id="5436402">directoryEnd</span>&nbsp;<span class="keyword" id="5436415">struct</span>&nbsp;<span class="op" id="5436422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436425">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5436444">uint32</span>&nbsp;<span class="comment" id="5436451">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436462">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5436481">uint32</span>&nbsp;<span class="comment" id="5436488">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436499">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="5436518">uint64</span>&nbsp;<span class="comment" id="5436525">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436536">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5436555">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436563">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436582">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436590">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436609">uint64</span>&nbsp;<span class="comment" id="5436616">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436637">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5436656">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5436664">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5436683">string</span><br>
<span class="lineno">145</span><span class="op" id="5436690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5436693">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="5436763">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5436788">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="5436859">func</span>&nbsp;<span class="ident" id="5436864">msDosTimeToTime</span><span class="op" id="5436879">(</span><span class="ident" id="5436880">dosDate</span><span class="op" id="5436887">,</span>&nbsp;<span class="ident" id="5436889">dosTime</span>&nbsp;<span class="builtintype" id="5436897">uint16</span><span class="op" id="5436903">)</span>&nbsp;<span class="ident" id="5436905">time</span><span class="op" id="5436909">.</span><span class="ident" id="5436910">Time</span>&nbsp;<span class="op" id="5436915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5436918">return</span>&nbsp;<span class="ident" id="5436925">time</span><span class="op" id="5436929">.</span><span class="ident" id="5436930">Date</span><span class="op" id="5436934">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5436938">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437007">int</span><span class="op" id="5437010">(</span><span class="ident" id="5437011">dosDate</span><span class="op" id="5437018">&gt;&gt;</span><span class="num" id="5437020">9</span><span class="op" id="5437021">+</span><span class="num" id="5437022">1980</span><span class="op" id="5437026">)</span><span class="op" id="5437027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437031">time</span><span class="op" id="5437035">.</span><span class="ident" id="5437036">Month</span><span class="op" id="5437041">(</span><span class="ident" id="5437042">dosDate</span><span class="op" id="5437049">&gt;&gt;</span><span class="num" id="5437051">5</span><span class="op" id="5437052">&amp;</span><span class="num" id="5437053">0xf</span><span class="op" id="5437056">)</span><span class="op" id="5437057">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437061">int</span><span class="op" id="5437064">(</span><span class="ident" id="5437065">dosDate</span><span class="op" id="5437072">&amp;</span><span class="num" id="5437073">0x1f</span><span class="op" id="5437077">)</span><span class="op" id="5437078">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5437083">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437139">int</span><span class="op" id="5437142">(</span><span class="ident" id="5437143">dosTime</span><span class="op" id="5437150">&gt;&gt;</span><span class="num" id="5437152">11</span><span class="op" id="5437154">)</span><span class="op" id="5437155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437159">int</span><span class="op" id="5437162">(</span><span class="ident" id="5437163">dosTime</span><span class="op" id="5437170">&gt;&gt;</span><span class="num" id="5437172">5</span><span class="op" id="5437173">&amp;</span><span class="num" id="5437174">0x3f</span><span class="op" id="5437178">)</span><span class="op" id="5437179">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5437183">int</span><span class="op" id="5437186">(</span><span class="ident" id="5437187">dosTime</span><span class="op" id="5437194">&amp;</span><span class="num" id="5437195">0x1f</span><span class="op" id="5437199">*</span><span class="num" id="5437200">2</span><span class="op" id="5437201">)</span><span class="op" id="5437202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5437206">0</span><span class="op" id="5437207">,</span>&nbsp;<span class="comment" id="5437209">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437227">time</span><span class="op" id="5437231">.</span><span class="ident" id="5437232">UTC</span><span class="op" id="5437235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5437238">)</span><br>
<span class="lineno">165</span><span class="op" id="5437240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437243">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="5437311">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="5437336">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="5437407">func</span>&nbsp;<span class="ident" id="5437412">timeToMsDosTime</span><span class="op" id="5437427">(</span><span class="ident" id="5437428">t</span>&nbsp;<span class="ident" id="5437430">time</span><span class="op" id="5437434">.</span><span class="ident" id="5437435">Time</span><span class="op" id="5437439">)</span>&nbsp;<span class="op" id="5437441">(</span><span class="ident" id="5437442">fDate</span>&nbsp;<span class="builtintype" id="5437448">uint16</span><span class="op" id="5437454">,</span>&nbsp;<span class="ident" id="5437456">fTime</span>&nbsp;<span class="builtintype" id="5437462">uint16</span><span class="op" id="5437468">)</span>&nbsp;<span class="op" id="5437470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437473">t</span>&nbsp;<span class="op" id="5437475">=</span>&nbsp;<span class="ident" id="5437477">t</span><span class="op" id="5437478">.</span><span class="ident" id="5437479">In</span><span class="op" id="5437481">(</span><span class="ident" id="5437482">time</span><span class="op" id="5437486">.</span><span class="ident" id="5437487">UTC</span><span class="op" id="5437490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437493">fDate</span>&nbsp;<span class="op" id="5437499">=</span>&nbsp;<span class="builtintype" id="5437501">uint16</span><span class="op" id="5437507">(</span><span class="ident" id="5437508">t</span><span class="op" id="5437509">.</span><span class="ident" id="5437510">Day</span><span class="op" id="5437513">(</span><span class="op" id="5437514">)</span>&nbsp;<span class="op" id="5437516">+</span>&nbsp;<span class="builtintype" id="5437518">int</span><span class="op" id="5437521">(</span><span class="ident" id="5437522">t</span><span class="op" id="5437523">.</span><span class="ident" id="5437524">Month</span><span class="op" id="5437529">(</span><span class="op" id="5437530">)</span><span class="op" id="5437531">)</span><span class="op" id="5437532">&lt;&lt;</span><span class="num" id="5437534">5</span>&nbsp;<span class="op" id="5437536">+</span>&nbsp;<span class="op" id="5437538">(</span><span class="ident" id="5437539">t</span><span class="op" id="5437540">.</span><span class="ident" id="5437541">Year</span><span class="op" id="5437545">(</span><span class="op" id="5437546">)</span><span class="op" id="5437547">-</span><span class="num" id="5437548">1980</span><span class="op" id="5437552">)</span><span class="op" id="5437553">&lt;&lt;</span><span class="num" id="5437555">9</span><span class="op" id="5437556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437559">fTime</span>&nbsp;<span class="op" id="5437565">=</span>&nbsp;<span class="builtintype" id="5437567">uint16</span><span class="op" id="5437573">(</span><span class="ident" id="5437574">t</span><span class="op" id="5437575">.</span><span class="ident" id="5437576">Second</span><span class="op" id="5437582">(</span><span class="op" id="5437583">)</span><span class="op" id="5437584">/</span><span class="num" id="5437585">2</span>&nbsp;<span class="op" id="5437587">+</span>&nbsp;<span class="ident" id="5437589">t</span><span class="op" id="5437590">.</span><span class="ident" id="5437591">Minute</span><span class="op" id="5437597">(</span><span class="op" id="5437598">)</span><span class="op" id="5437599">&lt;&lt;</span><span class="num" id="5437601">5</span>&nbsp;<span class="op" id="5437603">+</span>&nbsp;<span class="ident" id="5437605">t</span><span class="op" id="5437606">.</span><span class="ident" id="5437607">Hour</span><span class="op" id="5437611">(</span><span class="op" id="5437612">)</span><span class="op" id="5437613">&lt;&lt;</span><span class="num" id="5437615">11</span><span class="op" id="5437617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437620">return</span><br>
<span class="lineno">175</span><span class="op" id="5437627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437630">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5437679">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="5437704">func</span>&nbsp;<span class="op" id="5437709">(</span><span class="ident" id="5437710">h</span>&nbsp;<span class="op" id="5437712">*</span><span class="ident" id="5437713">FileHeader</span><span class="op" id="5437723">)</span>&nbsp;<span class="ident" id="5437725">ModTime</span><span class="op" id="5437732">(</span><span class="op" id="5437733">)</span>&nbsp;<span class="ident" id="5437735">time</span><span class="op" id="5437739">.</span><span class="ident" id="5437740">Time</span>&nbsp;<span class="op" id="5437745">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5437748">return</span>&nbsp;<span class="ident" id="5437755">msDosTimeToTime</span><span class="op" id="5437770">(</span><span class="ident" id="5437771">h</span><span class="op" id="5437772">.</span><span class="ident" id="5437773">ModifiedDate</span><span class="op" id="5437785">,</span>&nbsp;<span class="ident" id="5437787">h</span><span class="op" id="5437788">.</span><span class="ident" id="5437789">ModifiedTime</span><span class="op" id="5437801">)</span><br>
<span class="lineno"></span><span class="op" id="5437803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5437806">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="5437892">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="5437917">func</span>&nbsp;<span class="op" id="5437922">(</span><span class="ident" id="5437923">h</span>&nbsp;<span class="op" id="5437925">*</span><span class="ident" id="5437926">FileHeader</span><span class="op" id="5437936">)</span>&nbsp;<span class="ident" id="5437938">SetModTime</span><span class="op" id="5437948">(</span><span class="ident" id="5437949">t</span>&nbsp;<span class="ident" id="5437951">time</span><span class="op" id="5437955">.</span><span class="ident" id="5437956">Time</span><span class="op" id="5437960">)</span>&nbsp;<span class="op" id="5437962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5437965">h</span><span class="op" id="5437966">.</span><span class="ident" id="5437967">ModifiedDate</span><span class="op" id="5437979">,</span>&nbsp;<span class="ident" id="5437981">h</span><span class="op" id="5437982">.</span><span class="ident" id="5437983">ModifiedTime</span>&nbsp;<span class="op" id="5437996">=</span>&nbsp;<span class="ident" id="5437998">timeToMsDosTime</span><span class="op" id="5438013">(</span><span class="ident" id="5438014">t</span><span class="op" id="5438015">)</span><br>
<span class="lineno"></span><span class="op" id="5438017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5438020">const</span>&nbsp;<span class="op" id="5438026">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5438029">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5438089">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438145">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5438154">=</span>&nbsp;<span class="num" id="5438156">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438164">s_IFSOCK</span>&nbsp;<span class="op" id="5438173">=</span>&nbsp;<span class="num" id="5438175">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438183">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="5438192">=</span>&nbsp;<span class="num" id="5438194">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438202">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="5438211">=</span>&nbsp;<span class="num" id="5438213">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438221">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="5438230">=</span>&nbsp;<span class="num" id="5438232">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438240">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="5438249">=</span>&nbsp;<span class="num" id="5438251">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438259">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="5438268">=</span>&nbsp;<span class="num" id="5438270">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438278">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="5438287">=</span>&nbsp;<span class="num" id="5438289">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438297">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="5438306">=</span>&nbsp;<span class="num" id="5438308">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438315">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="5438324">=</span>&nbsp;<span class="num" id="5438326">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438333">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="5438342">=</span>&nbsp;<span class="num" id="5438344">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438352">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438366">=</span>&nbsp;<span class="num" id="5438368">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438374">msdosReadOnly</span>&nbsp;<span class="op" id="5438388">=</span>&nbsp;<span class="num" id="5438390">0x01</span><br>
<span class="lineno"></span><span class="op" id="5438395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5438398">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5438463">func</span>&nbsp;<span class="op" id="5438468">(</span><span class="ident" id="5438469">h</span>&nbsp;<span class="op" id="5438471">*</span><span class="ident" id="5438472">FileHeader</span><span class="op" id="5438482">)</span>&nbsp;<span class="ident" id="5438484">Mode</span><span class="op" id="5438488">(</span><span class="op" id="5438489">)</span>&nbsp;<span class="op" id="5438491">(</span><span class="ident" id="5438492">mode</span>&nbsp;<span class="ident" id="5438497">os</span><span class="op" id="5438499">.</span><span class="ident" id="5438500">FileMode</span><span class="op" id="5438508">)</span>&nbsp;<span class="op" id="5438510">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438513">switch</span>&nbsp;<span class="ident" id="5438520">h</span><span class="op" id="5438521">.</span><span class="ident" id="5438522">CreatorVersion</span>&nbsp;<span class="op" id="5438537">&gt;&gt;</span>&nbsp;<span class="num" id="5438540">8</span>&nbsp;<span class="op" id="5438542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438545">case</span>&nbsp;<span class="ident" id="5438550">creatorUnix</span><span class="op" id="5438561">,</span>&nbsp;<span class="ident" id="5438563">creatorMacOSX</span><span class="op" id="5438576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438580">mode</span>&nbsp;<span class="op" id="5438585">=</span>&nbsp;<span class="ident" id="5438587">unixModeToFileMode</span><span class="op" id="5438605">(</span><span class="ident" id="5438606">h</span><span class="op" id="5438607">.</span><span class="ident" id="5438608">ExternalAttrs</span>&nbsp;<span class="op" id="5438622">&gt;&gt;</span>&nbsp;<span class="num" id="5438625">16</span><span class="op" id="5438627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438630">case</span>&nbsp;<span class="ident" id="5438635">creatorNTFS</span><span class="op" id="5438646">,</span>&nbsp;<span class="ident" id="5438648">creatorVFAT</span><span class="op" id="5438659">,</span>&nbsp;<span class="ident" id="5438661">creatorFAT</span><span class="op" id="5438671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438675">mode</span>&nbsp;<span class="op" id="5438680">=</span>&nbsp;<span class="ident" id="5438682">msdosModeToFileMode</span><span class="op" id="5438701">(</span><span class="ident" id="5438702">h</span><span class="op" id="5438703">.</span><span class="ident" id="5438704">ExternalAttrs</span><span class="op" id="5438717">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438723">if</span>&nbsp;<span class="builtinfunc" id="5438726">len</span><span class="op" id="5438729">(</span><span class="ident" id="5438730">h</span><span class="op" id="5438731">.</span><span class="ident" id="5438732">Name</span><span class="op" id="5438736">)</span>&nbsp;<span class="op" id="5438738">&gt;</span>&nbsp;<span class="num" id="5438740">0</span>&nbsp;<span class="op" id="5438742">&amp;&amp;</span>&nbsp;<span class="ident" id="5438745">h</span><span class="op" id="5438746">.</span><span class="ident" id="5438747">Name</span><span class="op" id="5438751">[</span><span class="builtinfunc" id="5438752">len</span><span class="op" id="5438755">(</span><span class="ident" id="5438756">h</span><span class="op" id="5438757">.</span><span class="ident" id="5438758">Name</span><span class="op" id="5438762">)</span><span class="op" id="5438763">-</span><span class="num" id="5438764">1</span><span class="op" id="5438765">]</span>&nbsp;<span class="op" id="5438767">==</span>&nbsp;<span class="string" id="5438770">&#39;/&#39;</span>&nbsp;<span class="op" id="5438774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438778">mode</span>&nbsp;<span class="op" id="5438783">|=</span>&nbsp;<span class="ident" id="5438786">os</span><span class="op" id="5438788">.</span><span class="ident" id="5438789">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5438798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5438801">return</span>&nbsp;<span class="ident" id="5438808">mode</span><br>
<span class="lineno">220</span><span class="op" id="5438813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5438816">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5438884">func</span>&nbsp;<span class="op" id="5438889">(</span><span class="ident" id="5438890">h</span>&nbsp;<span class="op" id="5438892">*</span><span class="ident" id="5438893">FileHeader</span><span class="op" id="5438903">)</span>&nbsp;<span class="ident" id="5438905">SetMode</span><span class="op" id="5438912">(</span><span class="ident" id="5438913">mode</span>&nbsp;<span class="ident" id="5438918">os</span><span class="op" id="5438920">.</span><span class="ident" id="5438921">FileMode</span><span class="op" id="5438929">)</span>&nbsp;<span class="op" id="5438931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438934">h</span><span class="op" id="5438935">.</span><span class="ident" id="5438936">CreatorVersion</span>&nbsp;<span class="op" id="5438951">=</span>&nbsp;<span class="ident" id="5438953">h</span><span class="op" id="5438954">.</span><span class="ident" id="5438955">CreatorVersion</span><span class="op" id="5438969">&amp;</span><span class="num" id="5438970">0xff</span>&nbsp;<span class="op" id="5438975">|</span>&nbsp;<span class="ident" id="5438977">creatorUnix</span><span class="op" id="5438988">&lt;&lt;</span><span class="num" id="5438990">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5438993">h</span><span class="op" id="5438994">.</span><span class="ident" id="5438995">ExternalAttrs</span>&nbsp;<span class="op" id="5439009">=</span>&nbsp;<span class="ident" id="5439011">fileModeToUnixMode</span><span class="op" id="5439029">(</span><span class="ident" id="5439030">mode</span><span class="op" id="5439034">)</span>&nbsp;<span class="op" id="5439036">&lt;&lt;</span>&nbsp;<span class="num" id="5439039">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5439044">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439100">if</span>&nbsp;<span class="ident" id="5439103">mode</span><span class="op" id="5439107">&amp;</span><span class="ident" id="5439108">os</span><span class="op" id="5439110">.</span><span class="ident" id="5439111">ModeDir</span>&nbsp;<span class="op" id="5439119">!=</span>&nbsp;<span class="num" id="5439122">0</span>&nbsp;<span class="op" id="5439124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439128">h</span><span class="op" id="5439129">.</span><span class="ident" id="5439130">ExternalAttrs</span>&nbsp;<span class="op" id="5439144">|=</span>&nbsp;<span class="ident" id="5439147">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439160">if</span>&nbsp;<span class="ident" id="5439163">mode</span><span class="op" id="5439167">&amp;</span><span class="num" id="5439168">0200</span>&nbsp;<span class="op" id="5439173">==</span>&nbsp;<span class="num" id="5439176">0</span>&nbsp;<span class="op" id="5439178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439182">h</span><span class="op" id="5439183">.</span><span class="ident" id="5439184">ExternalAttrs</span>&nbsp;<span class="op" id="5439198">|=</span>&nbsp;<span class="ident" id="5439201">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439216">}</span><br>
<span class="lineno"></span><span class="op" id="5439218">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5439221">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="5439287">func</span>&nbsp;<span class="op" id="5439292">(</span><span class="ident" id="5439293">fh</span>&nbsp;<span class="op" id="5439296">*</span><span class="ident" id="5439297">FileHeader</span><span class="op" id="5439307">)</span>&nbsp;<span class="ident" id="5439309">isZip64</span><span class="op" id="5439316">(</span><span class="op" id="5439317">)</span>&nbsp;<span class="builtintype" id="5439319">bool</span>&nbsp;<span class="op" id="5439324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439327">return</span>&nbsp;<span class="ident" id="5439334">fh</span><span class="op" id="5439336">.</span><span class="ident" id="5439337">CompressedSize64</span>&nbsp;<span class="op" id="5439354">&gt;</span>&nbsp;<span class="ident" id="5439356">uint32max</span>&nbsp;<span class="op" id="5439366">||</span>&nbsp;<span class="ident" id="5439369">fh</span><span class="op" id="5439371">.</span><span class="ident" id="5439372">UncompressedSize64</span>&nbsp;<span class="op" id="5439391">&gt;</span>&nbsp;<span class="ident" id="5439393">uint32max</span><br>
<span class="lineno"></span><span class="op" id="5439403">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5439406">func</span>&nbsp;<span class="ident" id="5439411">msdosModeToFileMode</span><span class="op" id="5439430">(</span><span class="ident" id="5439431">m</span>&nbsp;<span class="builtintype" id="5439433">uint32</span><span class="op" id="5439439">)</span>&nbsp;<span class="op" id="5439441">(</span><span class="ident" id="5439442">mode</span>&nbsp;<span class="ident" id="5439447">os</span><span class="op" id="5439449">.</span><span class="ident" id="5439450">FileMode</span><span class="op" id="5439458">)</span>&nbsp;<span class="op" id="5439460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439463">if</span>&nbsp;<span class="ident" id="5439466">m</span><span class="op" id="5439467">&amp;</span><span class="ident" id="5439468">msdosDir</span>&nbsp;<span class="op" id="5439477">!=</span>&nbsp;<span class="num" id="5439480">0</span>&nbsp;<span class="op" id="5439482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439486">mode</span>&nbsp;<span class="op" id="5439491">=</span>&nbsp;<span class="ident" id="5439493">os</span><span class="op" id="5439495">.</span><span class="ident" id="5439496">ModeDir</span>&nbsp;<span class="op" id="5439504">|</span>&nbsp;<span class="num" id="5439506">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439512">}</span>&nbsp;<span class="keyword" id="5439514">else</span>&nbsp;<span class="op" id="5439519">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439523">mode</span>&nbsp;<span class="op" id="5439528">=</span>&nbsp;<span class="num" id="5439530">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439539">if</span>&nbsp;<span class="ident" id="5439542">m</span><span class="op" id="5439543">&amp;</span><span class="ident" id="5439544">msdosReadOnly</span>&nbsp;<span class="op" id="5439558">!=</span>&nbsp;<span class="num" id="5439561">0</span>&nbsp;<span class="op" id="5439563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439567">mode</span>&nbsp;<span class="op" id="5439572">&amp;^=</span>&nbsp;<span class="num" id="5439576">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439582">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439585">return</span>&nbsp;<span class="ident" id="5439592">mode</span><br>
<span class="lineno"></span><span class="op" id="5439597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5439600">func</span>&nbsp;<span class="ident" id="5439605">fileModeToUnixMode</span><span class="op" id="5439623">(</span><span class="ident" id="5439624">mode</span>&nbsp;<span class="ident" id="5439629">os</span><span class="op" id="5439631">.</span><span class="ident" id="5439632">FileMode</span><span class="op" id="5439640">)</span>&nbsp;<span class="builtintype" id="5439642">uint32</span>&nbsp;<span class="op" id="5439649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439652">var</span>&nbsp;<span class="ident" id="5439656">m</span>&nbsp;<span class="builtintype" id="5439658">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439666">switch</span>&nbsp;<span class="ident" id="5439673">mode</span>&nbsp;<span class="op" id="5439678">&amp;</span>&nbsp;<span class="ident" id="5439680">os</span><span class="op" id="5439682">.</span><span class="ident" id="5439683">ModeType</span>&nbsp;<span class="op" id="5439692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439695">default</span><span class="op" id="5439702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439706">m</span>&nbsp;<span class="op" id="5439708">=</span>&nbsp;<span class="ident" id="5439710">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439719">case</span>&nbsp;<span class="ident" id="5439724">os</span><span class="op" id="5439726">.</span><span class="ident" id="5439727">ModeDir</span><span class="op" id="5439734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439738">m</span>&nbsp;<span class="op" id="5439740">=</span>&nbsp;<span class="ident" id="5439742">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439751">case</span>&nbsp;<span class="ident" id="5439756">os</span><span class="op" id="5439758">.</span><span class="ident" id="5439759">ModeSymlink</span><span class="op" id="5439770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439774">m</span>&nbsp;<span class="op" id="5439776">=</span>&nbsp;<span class="ident" id="5439778">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439787">case</span>&nbsp;<span class="ident" id="5439792">os</span><span class="op" id="5439794">.</span><span class="ident" id="5439795">ModeNamedPipe</span><span class="op" id="5439808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439812">m</span>&nbsp;<span class="op" id="5439814">=</span>&nbsp;<span class="ident" id="5439816">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439825">case</span>&nbsp;<span class="ident" id="5439830">os</span><span class="op" id="5439832">.</span><span class="ident" id="5439833">ModeSocket</span><span class="op" id="5439843">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439847">m</span>&nbsp;<span class="op" id="5439849">=</span>&nbsp;<span class="ident" id="5439851">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439861">case</span>&nbsp;<span class="ident" id="5439866">os</span><span class="op" id="5439868">.</span><span class="ident" id="5439869">ModeDevice</span><span class="op" id="5439879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439883">if</span>&nbsp;<span class="ident" id="5439886">mode</span><span class="op" id="5439890">&amp;</span><span class="ident" id="5439891">os</span><span class="op" id="5439893">.</span><span class="ident" id="5439894">ModeCharDevice</span>&nbsp;<span class="op" id="5439909">!=</span>&nbsp;<span class="num" id="5439912">0</span>&nbsp;<span class="op" id="5439914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439919">m</span>&nbsp;<span class="op" id="5439921">=</span>&nbsp;<span class="ident" id="5439923">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439933">}</span>&nbsp;<span class="keyword" id="5439935">else</span>&nbsp;<span class="op" id="5439940">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439945">m</span>&nbsp;<span class="op" id="5439947">=</span>&nbsp;<span class="ident" id="5439949">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5439962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5439965">if</span>&nbsp;<span class="ident" id="5439968">mode</span><span class="op" id="5439972">&amp;</span><span class="ident" id="5439973">os</span><span class="op" id="5439975">.</span><span class="ident" id="5439976">ModeSetuid</span>&nbsp;<span class="op" id="5439987">!=</span>&nbsp;<span class="num" id="5439990">0</span>&nbsp;<span class="op" id="5439992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5439996">m</span>&nbsp;<span class="op" id="5439998">|=</span>&nbsp;<span class="ident" id="5440001">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440013">if</span>&nbsp;<span class="ident" id="5440016">mode</span><span class="op" id="5440020">&amp;</span><span class="ident" id="5440021">os</span><span class="op" id="5440023">.</span><span class="ident" id="5440024">ModeSetgid</span>&nbsp;<span class="op" id="5440035">!=</span>&nbsp;<span class="num" id="5440038">0</span>&nbsp;<span class="op" id="5440040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440044">m</span>&nbsp;<span class="op" id="5440046">|=</span>&nbsp;<span class="ident" id="5440049">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440061">if</span>&nbsp;<span class="ident" id="5440064">mode</span><span class="op" id="5440068">&amp;</span><span class="ident" id="5440069">os</span><span class="op" id="5440071">.</span><span class="ident" id="5440072">ModeSticky</span>&nbsp;<span class="op" id="5440083">!=</span>&nbsp;<span class="num" id="5440086">0</span>&nbsp;<span class="op" id="5440088">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440092">m</span>&nbsp;<span class="op" id="5440094">|=</span>&nbsp;<span class="ident" id="5440097">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440109">return</span>&nbsp;<span class="ident" id="5440116">m</span>&nbsp;<span class="op" id="5440118">|</span>&nbsp;<span class="builtintype" id="5440120">uint32</span><span class="op" id="5440126">(</span><span class="ident" id="5440127">mode</span><span class="op" id="5440131">&amp;</span><span class="num" id="5440132">0777</span><span class="op" id="5440136">)</span><br>
<span class="lineno"></span><span class="op" id="5440138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5440141">func</span>&nbsp;<span class="ident" id="5440146">unixModeToFileMode</span><span class="op" id="5440164">(</span><span class="ident" id="5440165">m</span>&nbsp;<span class="builtintype" id="5440167">uint32</span><span class="op" id="5440173">)</span>&nbsp;<span class="ident" id="5440175">os</span><span class="op" id="5440177">.</span><span class="ident" id="5440178">FileMode</span>&nbsp;<span class="op" id="5440187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440190">mode</span>&nbsp;<span class="op" id="5440195">:=</span>&nbsp;<span class="ident" id="5440198">os</span><span class="op" id="5440200">.</span><span class="ident" id="5440201">FileMode</span><span class="op" id="5440209">(</span><span class="ident" id="5440210">m</span>&nbsp;<span class="op" id="5440212">&amp;</span>&nbsp;<span class="num" id="5440214">0777</span><span class="op" id="5440218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440221">switch</span>&nbsp;<span class="ident" id="5440228">m</span>&nbsp;<span class="op" id="5440230">&amp;</span>&nbsp;<span class="ident" id="5440232">s_IFMT</span>&nbsp;<span class="op" id="5440239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440242">case</span>&nbsp;<span class="ident" id="5440247">s_IFBLK</span><span class="op" id="5440254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440258">mode</span>&nbsp;<span class="op" id="5440263">|=</span>&nbsp;<span class="ident" id="5440266">os</span><span class="op" id="5440268">.</span><span class="ident" id="5440269">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440281">case</span>&nbsp;<span class="ident" id="5440286">s_IFCHR</span><span class="op" id="5440293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440297">mode</span>&nbsp;<span class="op" id="5440302">|=</span>&nbsp;<span class="ident" id="5440305">os</span><span class="op" id="5440307">.</span><span class="ident" id="5440308">ModeDevice</span>&nbsp;<span class="op" id="5440319">|</span>&nbsp;<span class="ident" id="5440321">os</span><span class="op" id="5440323">.</span><span class="ident" id="5440324">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440340">case</span>&nbsp;<span class="ident" id="5440345">s_IFDIR</span><span class="op" id="5440352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440356">mode</span>&nbsp;<span class="op" id="5440361">|=</span>&nbsp;<span class="ident" id="5440364">os</span><span class="op" id="5440366">.</span><span class="ident" id="5440367">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440376">case</span>&nbsp;<span class="ident" id="5440381">s_IFIFO</span><span class="op" id="5440388">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440392">mode</span>&nbsp;<span class="op" id="5440397">|=</span>&nbsp;<span class="ident" id="5440400">os</span><span class="op" id="5440402">.</span><span class="ident" id="5440403">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440418">case</span>&nbsp;<span class="ident" id="5440423">s_IFLNK</span><span class="op" id="5440430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440434">mode</span>&nbsp;<span class="op" id="5440439">|=</span>&nbsp;<span class="ident" id="5440442">os</span><span class="op" id="5440444">.</span><span class="ident" id="5440445">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440458">case</span>&nbsp;<span class="ident" id="5440463">s_IFREG</span><span class="op" id="5440470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5440474">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440492">case</span>&nbsp;<span class="ident" id="5440497">s_IFSOCK</span><span class="op" id="5440505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440509">mode</span>&nbsp;<span class="op" id="5440514">|=</span>&nbsp;<span class="ident" id="5440517">os</span><span class="op" id="5440519">.</span><span class="ident" id="5440520">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440535">if</span>&nbsp;<span class="ident" id="5440538">m</span><span class="op" id="5440539">&amp;</span><span class="ident" id="5440540">s_ISGID</span>&nbsp;<span class="op" id="5440548">!=</span>&nbsp;<span class="num" id="5440551">0</span>&nbsp;<span class="op" id="5440553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440557">mode</span>&nbsp;<span class="op" id="5440562">|=</span>&nbsp;<span class="ident" id="5440565">os</span><span class="op" id="5440567">.</span><span class="ident" id="5440568">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440583">if</span>&nbsp;<span class="ident" id="5440586">m</span><span class="op" id="5440587">&amp;</span><span class="ident" id="5440588">s_ISUID</span>&nbsp;<span class="op" id="5440596">!=</span>&nbsp;<span class="num" id="5440599">0</span>&nbsp;<span class="op" id="5440601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440605">mode</span>&nbsp;<span class="op" id="5440610">|=</span>&nbsp;<span class="ident" id="5440613">os</span><span class="op" id="5440615">.</span><span class="ident" id="5440616">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440631">if</span>&nbsp;<span class="ident" id="5440634">m</span><span class="op" id="5440635">&amp;</span><span class="ident" id="5440636">s_ISVTX</span>&nbsp;<span class="op" id="5440644">!=</span>&nbsp;<span class="num" id="5440647">0</span>&nbsp;<span class="op" id="5440649">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5440653">mode</span>&nbsp;<span class="op" id="5440658">|=</span>&nbsp;<span class="ident" id="5440661">os</span><span class="op" id="5440663">.</span><span class="ident" id="5440664">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5440676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5440679">return</span>&nbsp;<span class="ident" id="5440686">mode</span><br>
<span class="lineno"></span><span class="op" id="5440691">}</span>
</div>
</body>
</html>
