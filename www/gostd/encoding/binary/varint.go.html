<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4486236">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4486292">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4486346">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4486397">package</span>&nbsp;<span class="ident" id="4486405">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4486413">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4486475">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4486495">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="4486569">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4486597">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4486672">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="4486710">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4486779">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="4486852">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="4486927">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4486979">//</span><br>
<span class="lineno"></span><span class="comment" id="4486982">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="4486998">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="4487067">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="4487146">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="4487225">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4487301">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4487380">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="4487458">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4487539">import</span>&nbsp;<span class="op" id="4487546">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4487549">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4487559">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="4487564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4487567">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="4487641">const</span>&nbsp;<span class="op" id="4487647">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487650">MaxVarintLen16</span>&nbsp;<span class="op" id="4487665">=</span>&nbsp;<span class="num" id="4487667">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487670">MaxVarintLen32</span>&nbsp;<span class="op" id="4487685">=</span>&nbsp;<span class="num" id="4487687">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487690">MaxVarintLen64</span>&nbsp;<span class="op" id="4487705">=</span>&nbsp;<span class="num" id="4487707">10</span><br>
<span class="lineno"></span><span class="op" id="4487710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4487713">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="4487794">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4487848">func</span>&nbsp;<span class="ident" id="4487853">PutUvarint</span><span class="op" id="4487863">(</span><span class="ident" id="4487864">buf</span>&nbsp;<span class="op" id="4487868">[</span><span class="op" id="4487869">]</span><span class="builtintype" id="4487870">byte</span><span class="op" id="4487874">,</span>&nbsp;<span class="ident" id="4487876">x</span>&nbsp;<span class="ident" id="4487878">uint64</span><span class="op" id="4487884">)</span>&nbsp;<span class="builtintype" id="4487886">int</span>&nbsp;<span class="op" id="4487890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487893">i</span>&nbsp;<span class="op" id="4487895">:=</span>&nbsp;<span class="num" id="4487898">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487901">for</span>&nbsp;<span class="ident" id="4487905">x</span>&nbsp;<span class="op" id="4487907">&gt;=</span>&nbsp;<span class="num" id="4487910">0x80</span>&nbsp;<span class="op" id="4487915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487919">buf</span><span class="op" id="4487922">[</span><span class="ident" id="4487923">i</span><span class="op" id="4487924">]</span>&nbsp;<span class="op" id="4487926">=</span>&nbsp;<span class="builtintype" id="4487928">byte</span><span class="op" id="4487932">(</span><span class="ident" id="4487933">x</span><span class="op" id="4487934">)</span>&nbsp;<span class="op" id="4487936">|</span>&nbsp;<span class="num" id="4487938">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487945">x</span>&nbsp;<span class="op" id="4487947">&gt;&gt;=</span>&nbsp;<span class="num" id="4487951">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487955">i</span><span class="op" id="4487956">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4487960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4487963">buf</span><span class="op" id="4487966">[</span><span class="ident" id="4487967">i</span><span class="op" id="4487968">]</span>&nbsp;<span class="op" id="4487970">=</span>&nbsp;<span class="builtintype" id="4487972">byte</span><span class="op" id="4487976">(</span><span class="ident" id="4487977">x</span><span class="op" id="4487978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4487981">return</span>&nbsp;<span class="ident" id="4487988">i</span>&nbsp;<span class="op" id="4487990">+</span>&nbsp;<span class="num" id="4487992">1</span><br>
<span class="lineno">50</span><span class="op" id="4487994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4487997">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4488065">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4488133">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="4488179">//</span><br>
<span class="lineno"></span><span class="comment" id="4488182">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4488207">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4488255">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4488306">//</span><br>
<span class="lineno">60</span><span class="keyword" id="4488309">func</span>&nbsp;<span class="ident" id="4488314">Uvarint</span><span class="op" id="4488321">(</span><span class="ident" id="4488322">buf</span>&nbsp;<span class="op" id="4488326">[</span><span class="op" id="4488327">]</span><span class="builtintype" id="4488328">byte</span><span class="op" id="4488332">)</span>&nbsp;<span class="op" id="4488334">(</span><span class="ident" id="4488335">uint64</span><span class="op" id="4488341">,</span>&nbsp;<span class="builtintype" id="4488343">int</span><span class="op" id="4488346">)</span>&nbsp;<span class="op" id="4488348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488351">var</span>&nbsp;<span class="ident" id="4488355">x</span>&nbsp;<span class="ident" id="4488357">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488365">var</span>&nbsp;<span class="ident" id="4488369">s</span>&nbsp;<span class="builtintype" id="4488371">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488377">for</span>&nbsp;<span class="ident" id="4488381">i</span><span class="op" id="4488382">,</span>&nbsp;<span class="ident" id="4488384">b</span>&nbsp;<span class="op" id="4488386">:=</span>&nbsp;<span class="keyword" id="4488389">range</span>&nbsp;<span class="ident" id="4488395">buf</span>&nbsp;<span class="op" id="4488399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488403">if</span>&nbsp;<span class="ident" id="4488406">b</span>&nbsp;<span class="op" id="4488408">&lt;</span>&nbsp;<span class="num" id="4488410">0x80</span>&nbsp;<span class="op" id="4488415">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488420">if</span>&nbsp;<span class="ident" id="4488423">i</span>&nbsp;<span class="op" id="4488425">&gt;</span>&nbsp;<span class="num" id="4488427">9</span>&nbsp;<span class="op" id="4488429">||</span>&nbsp;<span class="ident" id="4488432">i</span>&nbsp;<span class="op" id="4488434">==</span>&nbsp;<span class="num" id="4488437">9</span>&nbsp;<span class="op" id="4488439">&amp;&amp;</span>&nbsp;<span class="ident" id="4488442">b</span>&nbsp;<span class="op" id="4488444">&gt;</span>&nbsp;<span class="num" id="4488446">1</span>&nbsp;<span class="op" id="4488448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488454">return</span>&nbsp;<span class="num" id="4488461">0</span><span class="op" id="4488462">,</span>&nbsp;<span class="op" id="4488464">-</span><span class="op" id="4488465">(</span><span class="ident" id="4488466">i</span>&nbsp;<span class="op" id="4488468">+</span>&nbsp;<span class="num" id="4488470">1</span><span class="op" id="4488471">)</span>&nbsp;<span class="comment" id="4488473">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488493">return</span>&nbsp;<span class="ident" id="4488500">x</span>&nbsp;<span class="op" id="4488502">|</span>&nbsp;<span class="ident" id="4488504">uint64</span><span class="op" id="4488510">(</span><span class="ident" id="4488511">b</span><span class="op" id="4488512">)</span><span class="op" id="4488513">&lt;&lt;</span><span class="ident" id="4488515">s</span><span class="op" id="4488516">,</span>&nbsp;<span class="ident" id="4488518">i</span>&nbsp;<span class="op" id="4488520">+</span>&nbsp;<span class="num" id="4488522">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488526">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488530">x</span>&nbsp;<span class="op" id="4488532">|=</span>&nbsp;<span class="ident" id="4488535">uint64</span><span class="op" id="4488541">(</span><span class="ident" id="4488542">b</span><span class="op" id="4488543">&amp;</span><span class="num" id="4488544">0x7f</span><span class="op" id="4488548">)</span>&nbsp;<span class="op" id="4488550">&lt;&lt;</span>&nbsp;<span class="ident" id="4488553">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488557">s</span>&nbsp;<span class="op" id="4488559">+=</span>&nbsp;<span class="num" id="4488562">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488568">return</span>&nbsp;<span class="num" id="4488575">0</span><span class="op" id="4488576">,</span>&nbsp;<span class="num" id="4488578">0</span><br>
<span class="lineno"></span><span class="op" id="4488580">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4488583">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4488663">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4488716">func</span>&nbsp;<span class="ident" id="4488721">PutVarint</span><span class="op" id="4488730">(</span><span class="ident" id="4488731">buf</span>&nbsp;<span class="op" id="4488735">[</span><span class="op" id="4488736">]</span><span class="builtintype" id="4488737">byte</span><span class="op" id="4488741">,</span>&nbsp;<span class="ident" id="4488743">x</span>&nbsp;<span class="ident" id="4488745">int64</span><span class="op" id="4488750">)</span>&nbsp;<span class="builtintype" id="4488752">int</span>&nbsp;<span class="op" id="4488756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488759">ux</span>&nbsp;<span class="op" id="4488762">:=</span>&nbsp;<span class="ident" id="4488765">uint64</span><span class="op" id="4488771">(</span><span class="ident" id="4488772">x</span><span class="op" id="4488773">)</span>&nbsp;<span class="op" id="4488775">&lt;&lt;</span>&nbsp;<span class="num" id="4488778">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488781">if</span>&nbsp;<span class="ident" id="4488784">x</span>&nbsp;<span class="op" id="4488786">&lt;</span>&nbsp;<span class="num" id="4488788">0</span>&nbsp;<span class="op" id="4488790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4488794">ux</span>&nbsp;<span class="op" id="4488797">=</span>&nbsp;<span class="op" id="4488799">^</span><span class="ident" id="4488800">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4488804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4488807">return</span>&nbsp;<span class="ident" id="4488814">PutUvarint</span><span class="op" id="4488824">(</span><span class="ident" id="4488825">buf</span><span class="op" id="4488828">,</span>&nbsp;<span class="ident" id="4488830">ux</span><span class="op" id="4488832">)</span><br>
<span class="lineno"></span><span class="op" id="4488834">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4488837">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4488904">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="4488972">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="4489037">//</span><br>
<span class="lineno">90</span><span class="comment" id="4489040">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="4489065">//&nbsp;&nbsp;&nbsp;&nbspn&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="4489113">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="4489164">//</span><br>
<span class="lineno"></span><span class="keyword" id="4489167">func</span>&nbsp;<span class="ident" id="4489172">Varint</span><span class="op" id="4489178">(</span><span class="ident" id="4489179">buf</span>&nbsp;<span class="op" id="4489183">[</span><span class="op" id="4489184">]</span><span class="builtintype" id="4489185">byte</span><span class="op" id="4489189">)</span>&nbsp;<span class="op" id="4489191">(</span><span class="ident" id="4489192">int64</span><span class="op" id="4489197">,</span>&nbsp;<span class="builtintype" id="4489199">int</span><span class="op" id="4489202">)</span>&nbsp;<span class="op" id="4489204">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489207">ux</span><span class="op" id="4489209">,</span>&nbsp;<span class="ident" id="4489211">n</span>&nbsp;<span class="op" id="4489213">:=</span>&nbsp;<span class="ident" id="4489216">Uvarint</span><span class="op" id="4489223">(</span><span class="ident" id="4489224">buf</span><span class="op" id="4489227">)</span>&nbsp;<span class="comment" id="4489229">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489269">x</span>&nbsp;<span class="op" id="4489271">:=</span>&nbsp;<span class="ident" id="4489274">int64</span><span class="op" id="4489279">(</span><span class="ident" id="4489280">ux</span>&nbsp;<span class="op" id="4489283">&gt;&gt;</span>&nbsp;<span class="num" id="4489286">1</span><span class="op" id="4489287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489290">if</span>&nbsp;<span class="ident" id="4489293">ux</span><span class="op" id="4489295">&amp;</span><span class="num" id="4489296">1</span>&nbsp;<span class="op" id="4489298">!=</span>&nbsp;<span class="num" id="4489301">0</span>&nbsp;<span class="op" id="4489303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489307">x</span>&nbsp;<span class="op" id="4489309">=</span>&nbsp;<span class="op" id="4489311">^</span><span class="ident" id="4489312">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489315">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489318">return</span>&nbsp;<span class="ident" id="4489325">x</span><span class="op" id="4489326">,</span>&nbsp;<span class="ident" id="4489328">n</span><br>
<span class="lineno"></span><span class="op" id="4489330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4489333">var</span>&nbsp;<span class="ident" id="4489337">overflow</span>&nbsp;<span class="op" id="4489346">=</span>&nbsp;<span class="ident" id="4489348">errors</span><span class="op" id="4489354">.</span><span class="ident" id="4489355">New</span><span class="op" id="4489358">(</span><span class="string" id="4489359">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="4489402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4489405">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="4489489">func</span>&nbsp;<span class="ident" id="4489494">ReadUvarint</span><span class="op" id="4489505">(</span><span class="ident" id="4489506">r</span>&nbsp;<span class="ident" id="4489508">io</span><span class="op" id="4489510">.</span><span class="ident" id="4489511">ByteReader</span><span class="op" id="4489521">)</span>&nbsp;<span class="op" id="4489523">(</span><span class="ident" id="4489524">uint64</span><span class="op" id="4489530">,</span>&nbsp;<span class="builtintype" id="4489532">error</span><span class="op" id="4489537">)</span>&nbsp;<span class="op" id="4489539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489542">var</span>&nbsp;<span class="ident" id="4489546">x</span>&nbsp;<span class="ident" id="4489548">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489556">var</span>&nbsp;<span class="ident" id="4489560">s</span>&nbsp;<span class="builtintype" id="4489562">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489568">for</span>&nbsp;<span class="ident" id="4489572">i</span>&nbsp;<span class="op" id="4489574">:=</span>&nbsp;<span class="num" id="4489577">0</span><span class="op" id="4489578">;</span>&nbsp;<span class="op" id="4489580">;</span>&nbsp;<span class="ident" id="4489582">i</span><span class="op" id="4489583">++</span>&nbsp;<span class="op" id="4489586">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489590">b</span><span class="op" id="4489591">,</span>&nbsp;<span class="ident" id="4489593">err</span>&nbsp;<span class="op" id="4489597">:=</span>&nbsp;<span class="ident" id="4489600">r</span><span class="op" id="4489601">.</span><span class="ident" id="4489602">ReadByte</span><span class="op" id="4489610">(</span><span class="op" id="4489611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489615">if</span>&nbsp;<span class="ident" id="4489618">err</span>&nbsp;<span class="op" id="4489622">!=</span>&nbsp;<span class="ident" id="4489625">nil</span>&nbsp;<span class="op" id="4489629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489634">return</span>&nbsp;<span class="ident" id="4489641">x</span><span class="op" id="4489642">,</span>&nbsp;<span class="ident" id="4489644">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489654">if</span>&nbsp;<span class="ident" id="4489657">b</span>&nbsp;<span class="op" id="4489659">&lt;</span>&nbsp;<span class="num" id="4489661">0x80</span>&nbsp;<span class="op" id="4489666">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489671">if</span>&nbsp;<span class="ident" id="4489674">i</span>&nbsp;<span class="op" id="4489676">&gt;</span>&nbsp;<span class="num" id="4489678">9</span>&nbsp;<span class="op" id="4489680">||</span>&nbsp;<span class="ident" id="4489683">i</span>&nbsp;<span class="op" id="4489685">==</span>&nbsp;<span class="num" id="4489688">9</span>&nbsp;<span class="op" id="4489690">&amp;&amp;</span>&nbsp;<span class="ident" id="4489693">b</span>&nbsp;<span class="op" id="4489695">&gt;</span>&nbsp;<span class="num" id="4489697">1</span>&nbsp;<span class="op" id="4489699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489705">return</span>&nbsp;<span class="ident" id="4489712">x</span><span class="op" id="4489713">,</span>&nbsp;<span class="ident" id="4489715">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4489732">return</span>&nbsp;<span class="ident" id="4489739">x</span>&nbsp;<span class="op" id="4489741">|</span>&nbsp;<span class="ident" id="4489743">uint64</span><span class="op" id="4489749">(</span><span class="ident" id="4489750">b</span><span class="op" id="4489751">)</span><span class="op" id="4489752">&lt;&lt;</span><span class="ident" id="4489754">s</span><span class="op" id="4489755">,</span>&nbsp;<span class="ident" id="4489757">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489763">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489767">x</span>&nbsp;<span class="op" id="4489769">|=</span>&nbsp;<span class="ident" id="4489772">uint64</span><span class="op" id="4489778">(</span><span class="ident" id="4489779">b</span><span class="op" id="4489780">&amp;</span><span class="num" id="4489781">0x7f</span><span class="op" id="4489785">)</span>&nbsp;<span class="op" id="4489787">&lt;&lt;</span>&nbsp;<span class="ident" id="4489790">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489794">s</span>&nbsp;<span class="op" id="4489796">+=</span>&nbsp;<span class="num" id="4489799">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4489802">}</span><br>
<span class="lineno"></span><span class="op" id="4489804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4489807">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="4489888">func</span>&nbsp;<span class="ident" id="4489893">ReadVarint</span><span class="op" id="4489903">(</span><span class="ident" id="4489904">r</span>&nbsp;<span class="ident" id="4489906">io</span><span class="op" id="4489908">.</span><span class="ident" id="4489909">ByteReader</span><span class="op" id="4489919">)</span>&nbsp;<span class="op" id="4489921">(</span><span class="ident" id="4489922">int64</span><span class="op" id="4489927">,</span>&nbsp;<span class="builtintype" id="4489929">error</span><span class="op" id="4489934">)</span>&nbsp;<span class="op" id="4489936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4489939">ux</span><span class="op" id="4489941">,</span>&nbsp;<span class="ident" id="4489943">err</span>&nbsp;<span class="op" id="4489947">:=</span>&nbsp;<span class="ident" id="4489950">ReadUvarint</span><span class="op" id="4489961">(</span><span class="ident" id="4489962">r</span><span class="op" id="4489963">)</span>&nbsp;<span class="comment" id="4489965">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490005">x</span>&nbsp;<span class="op" id="4490007">:=</span>&nbsp;<span class="ident" id="4490010">int64</span><span class="op" id="4490015">(</span><span class="ident" id="4490016">ux</span>&nbsp;<span class="op" id="4490019">&gt;&gt;</span>&nbsp;<span class="num" id="4490022">1</span><span class="op" id="4490023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490026">if</span>&nbsp;<span class="ident" id="4490029">ux</span><span class="op" id="4490031">&amp;</span><span class="num" id="4490032">1</span>&nbsp;<span class="op" id="4490034">!=</span>&nbsp;<span class="num" id="4490037">0</span>&nbsp;<span class="op" id="4490039">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4490043">x</span>&nbsp;<span class="op" id="4490045">=</span>&nbsp;<span class="op" id="4490047">^</span><span class="ident" id="4490048">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4490051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4490054">return</span>&nbsp;<span class="ident" id="4490061">x</span><span class="op" id="4490062">,</span>&nbsp;<span class="ident" id="4490064">err</span><br>
<span class="lineno"></span><span class="op" id="4490068">}</span>
</div>
</body>
</html>
