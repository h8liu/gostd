<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6431251">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6431306">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6431360">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6431411">//&nbsp;Package&nbsp;testing&nbsp;provides&nbsp;support&nbsp;for&nbsp;automated&nbsp;testing&nbsp;of&nbsp;Go&nbsp;packages.</span><br>
<span class="lineno"></span><span class="comment" id="6431485">//&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;concert&nbsp;with&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command,&nbsp;which&nbsp;automates</span><br>
<span class="lineno"></span><span class="comment" id="6431571">//&nbsp;execution&nbsp;of&nbsp;any&nbsp;function&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6431612">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestXxx(*testing.T)</span><br>
<span class="lineno"></span><span class="comment" id="6431644">//&nbsp;where&nbsp;Xxx&nbsp;can&nbsp;be&nbsp;any&nbsp;alphanumeric&nbsp;string&nbsp;(but&nbsp;the&nbsp;first&nbsp;letter&nbsp;must&nbsp;not&nbsp;be&nbsp;in</span><br>
<span class="lineno">10</span><span class="comment" id="6431725">//&nbsp;[a-z])&nbsp;and&nbsp;serves&nbsp;to&nbsp;identify&nbsp;the&nbsp;test&nbsp;routine.</span><br>
<span class="lineno"></span><span class="comment" id="6431776">//</span><br>
<span class="lineno"></span><span class="comment" id="6431779">//&nbsp;Within&nbsp;these&nbsp;functions,&nbsp;use&nbsp;the&nbsp;Error,&nbsp;Fail&nbsp;or&nbsp;related&nbsp;methods&nbsp;to&nbsp;signal&nbsp;failure.</span><br>
<span class="lineno"></span><span class="comment" id="6431864">//</span><br>
<span class="lineno"></span><span class="comment" id="6431867">//&nbsp;To&nbsp;write&nbsp;a&nbsp;new&nbsp;test&nbsp;suite,&nbsp;create&nbsp;a&nbsp;file&nbsp;whose&nbsp;name&nbsp;ends&nbsp;_test.go&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="6431941">//&nbsp;contains&nbsp;the&nbsp;TestXxx&nbsp;functions&nbsp;as&nbsp;described&nbsp;here.&nbsp;Put&nbsp;the&nbsp;file&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="6432019">//&nbsp;package&nbsp;as&nbsp;the&nbsp;one&nbsp;being&nbsp;tested.&nbsp;The&nbsp;file&nbsp;will&nbsp;be&nbsp;excluded&nbsp;from&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="6432094">//&nbsp;package&nbsp;builds&nbsp;but&nbsp;will&nbsp;be&nbsp;included&nbsp;when&nbsp;the&nbsp;``go&nbsp;test&#39;&#39;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="6432170">//&nbsp;For&nbsp;more&nbsp;detail,&nbsp;run&nbsp;``go&nbsp;help&nbsp;test&#39;&#39;&nbsp;and&nbsp;``go&nbsp;help&nbsp;testflag&#39;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6432237">//</span><br>
<span class="lineno">20</span><span class="comment" id="6432240">//&nbsp;Tests&nbsp;and&nbsp;benchmarks&nbsp;may&nbsp;be&nbsp;skipped&nbsp;if&nbsp;not&nbsp;applicable&nbsp;with&nbsp;a&nbsp;call&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6432312">//&nbsp;the&nbsp;Skip&nbsp;method&nbsp;of&nbsp;*T&nbsp;and&nbsp;*B:</span><br>
<span class="lineno"></span><span class="comment" id="6432345">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;TestTimeConsuming(t&nbsp;*testing.T)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6432391">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;testing.Short()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6432423">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.Skip(&#34;skipping&nbsp;test&nbsp;in&nbsp;short&nbsp;mode.&#34;)</span><br>
<span class="lineno">25</span><span class="comment" id="6432477">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6432490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6432505">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6432514">//</span><br>
<span class="lineno"></span><span class="comment" id="6432517">//&nbsp;Benchmarks</span><br>
<span class="lineno">30</span><span class="comment" id="6432531">//</span><br>
<span class="lineno"></span><span class="comment" id="6432534">//&nbsp;Functions&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6432559">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkXxx(*testing.B)</span><br>
<span class="lineno"></span><span class="comment" id="6432596">//&nbsp;are&nbsp;considered&nbsp;benchmarks,&nbsp;and&nbsp;are&nbsp;executed&nbsp;by&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6432673">//&nbsp;its&nbsp;-bench&nbsp;flag&nbsp;is&nbsp;provided.&nbsp;Benchmarks&nbsp;are&nbsp;run&nbsp;sequentially.</span><br>
<span class="lineno">35</span><span class="comment" id="6432738">//</span><br>
<span class="lineno"></span><span class="comment" id="6432741">//&nbsp;For&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;testing&nbsp;flags,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="6432788">//&nbsp;http://golang.org/cmd/go/#hdr-Description_of_testing_flags.</span><br>
<span class="lineno"></span><span class="comment" id="6432851">//</span><br>
<span class="lineno"></span><span class="comment" id="6432854">//&nbsp;A&nbsp;sample&nbsp;benchmark&nbsp;function&nbsp;looks&nbsp;like&nbsp;this:</span><br>
<span class="lineno">40</span><span class="comment" id="6432902">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkHello(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6432945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6432983">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Sprintf(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6433019">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6433032">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">45</span><span class="comment" id="6433041">//</span><br>
<span class="lineno"></span><span class="comment" id="6433044">//&nbsp;The&nbsp;benchmark&nbsp;function&nbsp;must&nbsp;run&nbsp;the&nbsp;target&nbsp;code&nbsp;b.N&nbsp;times.</span><br>
<span class="lineno"></span><span class="comment" id="6433106">//&nbsp;During&nbsp;benchark&nbsp;execution,&nbsp;b.N&nbsp;is&nbsp;adjusted&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;lasts</span><br>
<span class="lineno"></span><span class="comment" id="6433187">//&nbsp;long&nbsp;enough&nbsp;to&nbsp;be&nbsp;timed&nbsp;reliably.&nbsp;&nbsp;The&nbsp;output</span><br>
<span class="lineno"></span><span class="comment" id="6433236">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;10000000&nbsp;&nbsp;&nbsp;&nbsp;282&nbsp;ns/op</span><br>
<span class="lineno">50</span><span class="comment" id="6433283">//&nbsp;means&nbsp;that&nbsp;the&nbsp;loop&nbsp;ran&nbsp;10000000&nbsp;times&nbsp;at&nbsp;a&nbsp;speed&nbsp;of&nbsp;282&nbsp;ns&nbsp;per&nbsp;loop.</span><br>
<span class="lineno"></span><span class="comment" id="6433356">//</span><br>
<span class="lineno"></span><span class="comment" id="6433359">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;some&nbsp;expensive&nbsp;setup&nbsp;before&nbsp;running,&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6433430">//&nbsp;may&nbsp;be&nbsp;reset:</span><br>
<span class="lineno"></span><span class="comment" id="6433447">//</span><br>
<span class="lineno">55</span><span class="comment" id="6433450">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkBigLen(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6433494">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;:=&nbsp;NewBig()</span><br>
<span class="lineno"></span><span class="comment" id="6433521">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.ResetTimer()</span><br>
<span class="lineno"></span><span class="comment" id="6433547">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;b.N;&nbsp;i++&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6433585">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big.Len()</span><br>
<span class="lineno">60</span><span class="comment" id="6433610">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6433623">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6433632">//</span><br>
<span class="lineno"></span><span class="comment" id="6433635">//&nbsp;If&nbsp;a&nbsp;benchmark&nbsp;needs&nbsp;to&nbsp;test&nbsp;performance&nbsp;in&nbsp;a&nbsp;parallel&nbsp;setting,&nbsp;it&nbsp;may&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="6433713">//&nbsp;the&nbsp;RunParallel&nbsp;helper&nbsp;function;&nbsp;such&nbsp;benchmarks&nbsp;are&nbsp;intended&nbsp;to&nbsp;be&nbsp;used&nbsp;with</span><br>
<span class="lineno">65</span><span class="comment" id="6433794">//&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag:</span><br>
<span class="lineno"></span><span class="comment" id="6433820">//</span><br>
<span class="lineno"></span><span class="comment" id="6433823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;BenchmarkTemplateParallel(b&nbsp;*testing.B)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6433877">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ&nbsp;:=&nbsp;template.Must(template.New(&#34;test&#34;).Parse(&#34;Hello,&nbsp;{{.}}!&#34;))</span><br>
<span class="lineno"></span><span class="comment" id="6433956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b.RunParallel(func(pb&nbsp;*testing.PB)&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6434004">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;buf&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span><span class="comment" id="6434040">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;pb.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6434071">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.Reset()</span><br>
<span class="lineno"></span><span class="comment" id="6434102">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;templ.Execute(&amp;buf,&nbsp;&#34;World&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6434150">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">75</span><span class="comment" id="6434167">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})</span><br>
<span class="lineno"></span><span class="comment" id="6434181">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6434190">//</span><br>
<span class="lineno"></span><span class="comment" id="6434193">//&nbsp;Examples</span><br>
<span class="lineno"></span><span class="comment" id="6434205">//</span><br>
<span class="lineno">80</span><span class="comment" id="6434208">//&nbsp;The&nbsp;package&nbsp;also&nbsp;runs&nbsp;and&nbsp;verifies&nbsp;example&nbsp;code.&nbsp;Example&nbsp;functions&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="6434282">//&nbsp;include&nbsp;a&nbsp;concluding&nbsp;line&nbsp;comment&nbsp;that&nbsp;begins&nbsp;with&nbsp;&#34;Output:&#34;&nbsp;and&nbsp;is&nbsp;compared&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6434367">//&nbsp;the&nbsp;standard&nbsp;output&nbsp;of&nbsp;the&nbsp;function&nbsp;when&nbsp;the&nbsp;tests&nbsp;are&nbsp;run.&nbsp;(The&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="6434446">//&nbsp;ignores&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.)&nbsp;These&nbsp;are&nbsp;examples&nbsp;of&nbsp;an&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6434520">//</span><br>
<span class="lineno">85</span><span class="comment" id="6434523">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleHello()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6434552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6434588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:&nbsp;hello</span><br>
<span class="lineno"></span><span class="comment" id="6434620">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6434629">//</span><br>
<span class="lineno">90</span><span class="comment" id="6434632">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleSalutations()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6434667">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;hello,&nbsp;and&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6434708">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.Println(&#34;goodbye&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6434746">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Output:</span><br>
<span class="lineno"></span><span class="comment" id="6434772">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;hello,&nbsp;and</span><br>
<span class="lineno">95</span><span class="comment" id="6434801">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;goodbye</span><br>
<span class="lineno"></span><span class="comment" id="6434827">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6434836">//</span><br>
<span class="lineno"></span><span class="comment" id="6434839">//&nbsp;Example&nbsp;functions&nbsp;without&nbsp;output&nbsp;comments&nbsp;are&nbsp;compiled&nbsp;but&nbsp;not&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="6434915">//</span><br>
<span class="lineno">100</span><span class="comment" id="6434918">//&nbsp;The&nbsp;naming&nbsp;convention&nbsp;to&nbsp;declare&nbsp;examples&nbsp;for&nbsp;the&nbsp;package,&nbsp;a&nbsp;function&nbsp;F,&nbsp;a&nbsp;type&nbsp;T&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6435007">//&nbsp;method&nbsp;M&nbsp;on&nbsp;type&nbsp;T&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="6435034">//</span><br>
<span class="lineno"></span><span class="comment" id="6435037">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435067">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">105</span><span class="comment" id="6435098">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435129">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435162">//</span><br>
<span class="lineno"></span><span class="comment" id="6435165">//&nbsp;Multiple&nbsp;example&nbsp;functions&nbsp;for&nbsp;a&nbsp;package/type/function/method&nbsp;may&nbsp;be&nbsp;provided&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6435249">//&nbsp;appending&nbsp;a&nbsp;distinct&nbsp;suffix&nbsp;to&nbsp;the&nbsp;name.&nbsp;The&nbsp;suffix&nbsp;must&nbsp;start&nbsp;with&nbsp;a</span><br>
<span class="lineno">110</span><span class="comment" id="6435322">//&nbsp;lower-case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="comment" id="6435344">//</span><br>
<span class="lineno"></span><span class="comment" id="6435347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;Example_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435384">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleF_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435422">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno">115</span><span class="comment" id="6435460">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;ExampleT_M_suffix()&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6435500">//</span><br>
<span class="lineno"></span><span class="comment" id="6435503">//&nbsp;The&nbsp;entire&nbsp;test&nbsp;file&nbsp;is&nbsp;presented&nbsp;as&nbsp;the&nbsp;example&nbsp;when&nbsp;it&nbsp;contains&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="6435581">//&nbsp;example&nbsp;function,&nbsp;at&nbsp;least&nbsp;one&nbsp;other&nbsp;function,&nbsp;type,&nbsp;variable,&nbsp;or&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="6435659">//&nbsp;declaration,&nbsp;and&nbsp;no&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;functions.</span><br>
<span class="lineno">120</span><span class="comment" id="6435711">//</span><br>
<span class="lineno"></span><span class="comment" id="6435714">//&nbsp;Main</span><br>
<span class="lineno"></span><span class="comment" id="6435722">//</span><br>
<span class="lineno"></span><span class="comment" id="6435725">//&nbsp;It&nbsp;is&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;program&nbsp;to&nbsp;do&nbsp;extra&nbsp;setup&nbsp;or&nbsp;teardown</span><br>
<span class="lineno"></span><span class="comment" id="6435803">//&nbsp;before&nbsp;or&nbsp;after&nbsp;testing.&nbsp;It&nbsp;is&nbsp;also&nbsp;sometimes&nbsp;necessary&nbsp;for&nbsp;a&nbsp;test&nbsp;to&nbsp;control</span><br>
<span class="lineno">125</span><span class="comment" id="6435884">//&nbsp;which&nbsp;code&nbsp;runs&nbsp;on&nbsp;the&nbsp;main&nbsp;thread.&nbsp;To&nbsp;support&nbsp;these&nbsp;and&nbsp;other&nbsp;cases,</span><br>
<span class="lineno"></span><span class="comment" id="6435957">//&nbsp;if&nbsp;a&nbsp;test&nbsp;file&nbsp;contains&nbsp;a&nbsp;function:</span><br>
<span class="lineno"></span><span class="comment" id="6435996">//</span><br>
<span class="lineno"></span><span class="comment" id="6435999">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)</span><br>
<span class="lineno"></span><span class="comment" id="6436030">//</span><br>
<span class="lineno">130</span><span class="comment" id="6436033">//&nbsp;then&nbsp;the&nbsp;generated&nbsp;test&nbsp;will&nbsp;call&nbsp;TestMain(m)&nbsp;instead&nbsp;of&nbsp;running&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="6436111">//&nbsp;directly.&nbsp;TestMain&nbsp;runs&nbsp;in&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;and&nbsp;can&nbsp;do&nbsp;whatever&nbsp;setup</span><br>
<span class="lineno"></span><span class="comment" id="6436186">//&nbsp;and&nbsp;teardown&nbsp;is&nbsp;necessary&nbsp;around&nbsp;a&nbsp;call&nbsp;to&nbsp;m.Run.&nbsp;It&nbsp;should&nbsp;then&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="6436259">//&nbsp;os.Exit&nbsp;with&nbsp;the&nbsp;result&nbsp;of&nbsp;m.Run.</span><br>
<span class="lineno"></span><span class="comment" id="6436296">//</span><br>
<span class="lineno">135</span><span class="comment" id="6436299">//&nbsp;The&nbsp;minimal&nbsp;implementation&nbsp;of&nbsp;TestMain&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="6436345">//</span><br>
<span class="lineno"></span><span class="comment" id="6436348">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;TestMain(m&nbsp;*testing.M)&nbsp;{&nbsp;os.Exit(m.Run())&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6436400">//</span><br>
<span class="lineno"></span><span class="comment" id="6436403">//&nbsp;In&nbsp;effect,&nbsp;that&nbsp;is&nbsp;the&nbsp;implementation&nbsp;used&nbsp;when&nbsp;no&nbsp;TestMain&nbsp;is&nbsp;explicitly&nbsp;defined.</span><br>
<span class="lineno">140</span><span class="keyword" id="6436489">package</span>&nbsp;<span class="ident" id="6436497">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6436506">import</span>&nbsp;<span class="op" id="6436513">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436516">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436525">&#34;flag&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436533">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436540">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436546">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436557">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436574">&#34;strconv&#34;</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436585">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436596">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6436604">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6436611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6436614">var</span>&nbsp;<span class="op" id="6436618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436621">//&nbsp;The&nbsp;short&nbsp;flag&nbsp;requests&nbsp;that&nbsp;tests&nbsp;run&nbsp;more&nbsp;quickly,&nbsp;but&nbsp;its&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436700">//&nbsp;is&nbsp;provided&nbsp;by&nbsp;test&nbsp;writers&nbsp;themselves.&nbsp;&nbsp;The&nbsp;testing&nbsp;package&nbsp;is&nbsp;just&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436777">//&nbsp;home.&nbsp;&nbsp;The&nbsp;all.bash&nbsp;installation&nbsp;script&nbsp;sets&nbsp;it&nbsp;to&nbsp;make&nbsp;installation&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436855">//&nbsp;efficient,&nbsp;but&nbsp;by&nbsp;default&nbsp;the&nbsp;flag&nbsp;is&nbsp;off&nbsp;so&nbsp;a&nbsp;plain&nbsp;&#34;go&nbsp;test&#34;&nbsp;will&nbsp;do&nbsp;a</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436932">//&nbsp;full&nbsp;test&nbsp;of&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436962">short</span>&nbsp;<span class="op" id="6436968">=</span>&nbsp;<span class="ident" id="6436970">flag</span><span class="op" id="6436974">.</span><span class="ident" id="6436975">Bool</span><span class="op" id="6436979">(</span><span class="string" id="6436980">&#34;test.short&#34;</span><span class="op" id="6436992">,</span>&nbsp;<span class="builtintype" id="6436994">false</span><span class="op" id="6436999">,</span>&nbsp;<span class="string" id="6437001">&#34;run&nbsp;smaller&nbsp;test&nbsp;suite&nbsp;to&nbsp;save&nbsp;time&#34;</span><span class="op" id="6437038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437042">//&nbsp;The&nbsp;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;create&nbsp;profile&nbsp;files&nbsp;and&nbsp;the&nbsp;like.&nbsp;When&nbsp;run&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437121">//&nbsp;&#34;go&nbsp;test&#34;,&nbsp;the&nbsp;binary&nbsp;always&nbsp;runs&nbsp;in&nbsp;the&nbsp;source&nbsp;directory&nbsp;for&nbsp;the&nbsp;package;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437200">//&nbsp;this&nbsp;flag&nbsp;lets&nbsp;&#34;go&nbsp;test&#34;&nbsp;tell&nbsp;the&nbsp;binary&nbsp;to&nbsp;write&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;directory&nbsp;where</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437287">//&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command&nbsp;is&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437321">outputDir</span>&nbsp;<span class="op" id="6437331">=</span>&nbsp;<span class="ident" id="6437333">flag</span><span class="op" id="6437337">.</span><span class="ident" id="6437338">String</span><span class="op" id="6437344">(</span><span class="string" id="6437345">&#34;test.outputdir&#34;</span><span class="op" id="6437361">,</span>&nbsp;<span class="string" id="6437363">&#34;&#34;</span><span class="op" id="6437365">,</span>&nbsp;<span class="string" id="6437367">&#34;directory&nbsp;in&nbsp;which&nbsp;to&nbsp;write&nbsp;profiles&#34;</span><span class="op" id="6437405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437409">//&nbsp;Report&nbsp;as&nbsp;tests&nbsp;are&nbsp;run;&nbsp;default&nbsp;is&nbsp;silent&nbsp;for&nbsp;success.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437469">chatty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437486">=</span>&nbsp;<span class="ident" id="6437488">flag</span><span class="op" id="6437492">.</span><span class="ident" id="6437493">Bool</span><span class="op" id="6437497">(</span><span class="string" id="6437498">&#34;test.v&#34;</span><span class="op" id="6437506">,</span>&nbsp;<span class="builtintype" id="6437508">false</span><span class="op" id="6437513">,</span>&nbsp;<span class="string" id="6437515">&#34;verbose:&nbsp;print&nbsp;additional&nbsp;output&#34;</span><span class="op" id="6437549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437552">coverProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437569">=</span>&nbsp;<span class="ident" id="6437571">flag</span><span class="op" id="6437575">.</span><span class="ident" id="6437576">String</span><span class="op" id="6437582">(</span><span class="string" id="6437583">&#34;test.coverprofile&#34;</span><span class="op" id="6437602">,</span>&nbsp;<span class="string" id="6437604">&#34;&#34;</span><span class="op" id="6437606">,</span>&nbsp;<span class="string" id="6437608">&#34;write&nbsp;a&nbsp;coverage&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6437668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437671">match</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437688">=</span>&nbsp;<span class="ident" id="6437690">flag</span><span class="op" id="6437694">.</span><span class="ident" id="6437695">String</span><span class="op" id="6437701">(</span><span class="string" id="6437702">&#34;test.run&#34;</span><span class="op" id="6437712">,</span>&nbsp;<span class="string" id="6437714">&#34;&#34;</span><span class="op" id="6437716">,</span>&nbsp;<span class="string" id="6437718">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;tests&nbsp;and&nbsp;examples&nbsp;to&nbsp;run&#34;</span><span class="op" id="6437774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437777">memProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437794">=</span>&nbsp;<span class="ident" id="6437796">flag</span><span class="op" id="6437800">.</span><span class="ident" id="6437801">String</span><span class="op" id="6437807">(</span><span class="string" id="6437808">&#34;test.memprofile&#34;</span><span class="op" id="6437825">,</span>&nbsp;<span class="string" id="6437827">&#34;&#34;</span><span class="op" id="6437829">,</span>&nbsp;<span class="string" id="6437831">&#34;write&nbsp;a&nbsp;memory&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6437889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437892">memProfileRate</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6437909">=</span>&nbsp;<span class="ident" id="6437911">flag</span><span class="op" id="6437915">.</span><span class="ident" id="6437916">Int</span><span class="op" id="6437919">(</span><span class="string" id="6437920">&#34;test.memprofilerate&#34;</span><span class="op" id="6437941">,</span>&nbsp;<span class="num" id="6437943">0</span><span class="op" id="6437944">,</span>&nbsp;<span class="string" id="6437946">&#34;if&nbsp;&gt;=0,&nbsp;sets&nbsp;runtime.MemProfileRate&#34;</span><span class="op" id="6437983">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437986">cpuProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438003">=</span>&nbsp;<span class="ident" id="6438005">flag</span><span class="op" id="6438009">.</span><span class="ident" id="6438010">String</span><span class="op" id="6438016">(</span><span class="string" id="6438017">&#34;test.cpuprofile&#34;</span><span class="op" id="6438034">,</span>&nbsp;<span class="string" id="6438036">&#34;&#34;</span><span class="op" id="6438038">,</span>&nbsp;<span class="string" id="6438040">&#34;write&nbsp;a&nbsp;cpu&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;during&nbsp;execution&#34;</span><span class="op" id="6438096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438099">blockProfile</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438116">=</span>&nbsp;<span class="ident" id="6438118">flag</span><span class="op" id="6438122">.</span><span class="ident" id="6438123">String</span><span class="op" id="6438129">(</span><span class="string" id="6438130">&#34;test.blockprofile&#34;</span><span class="op" id="6438149">,</span>&nbsp;<span class="string" id="6438151">&#34;&#34;</span><span class="op" id="6438153">,</span>&nbsp;<span class="string" id="6438155">&#34;write&nbsp;a&nbsp;goroutine&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;the&nbsp;named&nbsp;file&nbsp;after&nbsp;execution&#34;</span><span class="op" id="6438225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438228">blockProfileRate</span>&nbsp;<span class="op" id="6438245">=</span>&nbsp;<span class="ident" id="6438247">flag</span><span class="op" id="6438251">.</span><span class="ident" id="6438252">Int</span><span class="op" id="6438255">(</span><span class="string" id="6438256">&#34;test.blockprofilerate&#34;</span><span class="op" id="6438279">,</span>&nbsp;<span class="num" id="6438281">1</span><span class="op" id="6438282">,</span>&nbsp;<span class="string" id="6438284">&#34;if&nbsp;&gt;=&nbsp;0,&nbsp;calls&nbsp;runtime.SetBlockProfileRate()&#34;</span><span class="op" id="6438330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438333">timeout</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438350">=</span>&nbsp;<span class="ident" id="6438352">flag</span><span class="op" id="6438356">.</span><span class="ident" id="6438357">Duration</span><span class="op" id="6438365">(</span><span class="string" id="6438366">&#34;test.timeout&#34;</span><span class="op" id="6438380">,</span>&nbsp;<span class="num" id="6438382">0</span><span class="op" id="6438383">,</span>&nbsp;<span class="string" id="6438385">&#34;if&nbsp;positive,&nbsp;sets&nbsp;an&nbsp;aggregate&nbsp;time&nbsp;limit&nbsp;for&nbsp;all&nbsp;tests&#34;</span><span class="op" id="6438442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438445">cpuListStr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438462">=</span>&nbsp;<span class="ident" id="6438464">flag</span><span class="op" id="6438468">.</span><span class="ident" id="6438469">String</span><span class="op" id="6438475">(</span><span class="string" id="6438476">&#34;test.cpu&#34;</span><span class="op" id="6438486">,</span>&nbsp;<span class="string" id="6438488">&#34;&#34;</span><span class="op" id="6438490">,</span>&nbsp;<span class="string" id="6438492">&#34;comma-separated&nbsp;list&nbsp;of&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;to&nbsp;use&nbsp;for&nbsp;each&nbsp;test&#34;</span><span class="op" id="6438553">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438556">parallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438573">=</span>&nbsp;<span class="ident" id="6438575">flag</span><span class="op" id="6438579">.</span><span class="ident" id="6438580">Int</span><span class="op" id="6438583">(</span><span class="string" id="6438584">&#34;test.parallel&#34;</span><span class="op" id="6438599">,</span>&nbsp;<span class="ident" id="6438601">runtime</span><span class="op" id="6438608">.</span><span class="ident" id="6438609">GOMAXPROCS</span><span class="op" id="6438619">(</span><span class="num" id="6438620">0</span><span class="op" id="6438621">)</span><span class="op" id="6438622">,</span>&nbsp;<span class="string" id="6438624">&#34;maximum&nbsp;test&nbsp;parallelism&#34;</span><span class="op" id="6438650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438654">haveExamples</span>&nbsp;<span class="builtintype" id="6438667">bool</span>&nbsp;<span class="comment" id="6438672">//&nbsp;are&nbsp;there&nbsp;examples?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438697">cpuList</span>&nbsp;<span class="op" id="6438705">[</span><span class="op" id="6438706">]</span><span class="builtintype" id="6438707">int</span><br>
<span class="lineno">185</span><span class="op" id="6438711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6438714">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;elements&nbsp;common&nbsp;between&nbsp;T&nbsp;and&nbsp;B&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6438770">//&nbsp;captures&nbsp;common&nbsp;methods&nbsp;such&nbsp;as&nbsp;Errorf.</span><br>
<span class="lineno"></span><span class="keyword" id="6438813">type</span>&nbsp;<span class="ident" id="6438818">common</span>&nbsp;<span class="keyword" id="6438825">struct</span>&nbsp;<span class="op" id="6438832">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438835">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438844">sync</span><span class="op" id="6438848">.</span><span class="ident" id="6438849">RWMutex</span>&nbsp;<span class="comment" id="6438857">//&nbsp;guards&nbsp;output&nbsp;and&nbsp;failed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438886">output</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6438895">[</span><span class="op" id="6438896">]</span><span class="builtintype" id="6438897">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6438908">//&nbsp;Output&nbsp;generated&nbsp;by&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438951">failed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6438960">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6438973">//&nbsp;Test&nbsp;or&nbsp;benchmark&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439007">skipped</span>&nbsp;&nbsp;<span class="builtintype" id="6439016">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439029">//&nbsp;Test&nbsp;of&nbsp;benchmark&nbsp;has&nbsp;been&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439069">finished</span>&nbsp;<span class="builtintype" id="6439078">bool</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439085">start</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439094">time</span><span class="op" id="6439098">.</span><span class="ident" id="6439099">Time</span>&nbsp;<span class="comment" id="6439104">//&nbsp;Time&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;started</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439139">duration</span>&nbsp;<span class="ident" id="6439148">time</span><span class="op" id="6439152">.</span><span class="ident" id="6439153">Duration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439163">self</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439172">interface</span><span class="op" id="6439181">{</span><span class="op" id="6439182">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439189">//&nbsp;To&nbsp;be&nbsp;sent&nbsp;on&nbsp;signal&nbsp;channel&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439233">signal</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439242">chan</span>&nbsp;<span class="keyword" id="6439247">interface</span><span class="op" id="6439256">{</span><span class="op" id="6439257">}</span>&nbsp;<span class="comment" id="6439259">//&nbsp;Output&nbsp;for&nbsp;serial&nbsp;tests.</span><br>
<span class="lineno">200</span><span class="op" id="6439287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6439290">//&nbsp;Short&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.short&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6439344">func</span>&nbsp;<span class="ident" id="6439349">Short</span><span class="op" id="6439354">(</span><span class="op" id="6439355">)</span>&nbsp;<span class="builtintype" id="6439357">bool</span>&nbsp;<span class="op" id="6439362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439365">return</span>&nbsp;<span class="op" id="6439372">*</span><span class="ident" id="6439373">short</span><br>
<span class="lineno">205</span><span class="op" id="6439379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6439382">//&nbsp;Verbose&nbsp;reports&nbsp;whether&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6439434">func</span>&nbsp;<span class="ident" id="6439439">Verbose</span><span class="op" id="6439446">(</span><span class="op" id="6439447">)</span>&nbsp;<span class="builtintype" id="6439449">bool</span>&nbsp;<span class="op" id="6439454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439457">return</span>&nbsp;<span class="op" id="6439464">*</span><span class="ident" id="6439465">chatty</span><br>
<span class="lineno">210</span><span class="op" id="6439472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6439475">//&nbsp;decorate&nbsp;prefixes&nbsp;the&nbsp;string&nbsp;with&nbsp;the&nbsp;file&nbsp;and&nbsp;line&nbsp;of&nbsp;the&nbsp;call&nbsp;site</span><br>
<span class="lineno"></span><span class="comment" id="6439547">//&nbsp;and&nbsp;inserts&nbsp;the&nbsp;final&nbsp;newline&nbsp;if&nbsp;needed&nbsp;and&nbsp;indentation&nbsp;tabs&nbsp;for&nbsp;formatting.</span><br>
<span class="lineno"></span><span class="keyword" id="6439627">func</span>&nbsp;<span class="ident" id="6439632">decorate</span><span class="op" id="6439640">(</span><span class="ident" id="6439641">s</span>&nbsp;<span class="builtintype" id="6439643">string</span><span class="op" id="6439649">)</span>&nbsp;<span class="builtintype" id="6439651">string</span>&nbsp;<span class="op" id="6439658">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439661">_</span><span class="op" id="6439662">,</span>&nbsp;<span class="ident" id="6439664">file</span><span class="op" id="6439668">,</span>&nbsp;<span class="ident" id="6439670">line</span><span class="op" id="6439674">,</span>&nbsp;<span class="ident" id="6439676">ok</span>&nbsp;<span class="op" id="6439679">:=</span>&nbsp;<span class="ident" id="6439682">runtime</span><span class="op" id="6439689">.</span><span class="ident" id="6439690">Caller</span><span class="op" id="6439696">(</span><span class="num" id="6439697">3</span><span class="op" id="6439698">)</span>&nbsp;<span class="comment" id="6439700">//&nbsp;decorate&nbsp;+&nbsp;log&nbsp;+&nbsp;public&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439738">if</span>&nbsp;<span class="ident" id="6439741">ok</span>&nbsp;<span class="op" id="6439744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6439748">//&nbsp;Truncate&nbsp;file&nbsp;name&nbsp;at&nbsp;last&nbsp;file&nbsp;name&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439801">if</span>&nbsp;<span class="ident" id="6439804">index</span>&nbsp;<span class="op" id="6439810">:=</span>&nbsp;<span class="ident" id="6439813">strings</span><span class="op" id="6439820">.</span><span class="ident" id="6439821">LastIndex</span><span class="op" id="6439830">(</span><span class="ident" id="6439831">file</span><span class="op" id="6439835">,</span>&nbsp;<span class="string" id="6439837">&#34;/&#34;</span><span class="op" id="6439840">)</span><span class="op" id="6439841">;</span>&nbsp;<span class="ident" id="6439843">index</span>&nbsp;<span class="op" id="6439849">&gt;=</span>&nbsp;<span class="num" id="6439852">0</span>&nbsp;<span class="op" id="6439854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439859">file</span>&nbsp;<span class="op" id="6439864">=</span>&nbsp;<span class="ident" id="6439866">file</span><span class="op" id="6439870">[</span><span class="ident" id="6439871">index</span><span class="op" id="6439876">+</span><span class="num" id="6439877">1</span><span class="op" id="6439878">:</span><span class="op" id="6439879">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439883">}</span>&nbsp;<span class="keyword" id="6439885">else</span>&nbsp;<span class="keyword" id="6439890">if</span>&nbsp;<span class="ident" id="6439893">index</span>&nbsp;<span class="op" id="6439899">=</span>&nbsp;<span class="ident" id="6439901">strings</span><span class="op" id="6439908">.</span><span class="ident" id="6439909">LastIndex</span><span class="op" id="6439918">(</span><span class="ident" id="6439919">file</span><span class="op" id="6439923">,</span>&nbsp;<span class="string" id="6439925">&#34;\\&#34;</span><span class="op" id="6439929">)</span><span class="op" id="6439930">;</span>&nbsp;<span class="ident" id="6439932">index</span>&nbsp;<span class="op" id="6439938">&gt;=</span>&nbsp;<span class="num" id="6439941">0</span>&nbsp;<span class="op" id="6439943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439948">file</span>&nbsp;<span class="op" id="6439953">=</span>&nbsp;<span class="ident" id="6439955">file</span><span class="op" id="6439959">[</span><span class="ident" id="6439960">index</span><span class="op" id="6439965">+</span><span class="num" id="6439966">1</span><span class="op" id="6439967">:</span><span class="op" id="6439968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439975">}</span>&nbsp;<span class="keyword" id="6439977">else</span>&nbsp;<span class="op" id="6439982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439986">file</span>&nbsp;<span class="op" id="6439991">=</span>&nbsp;<span class="string" id="6439993">&#34;???&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440001">line</span>&nbsp;<span class="op" id="6440006">=</span>&nbsp;<span class="num" id="6440008">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440014">buf</span>&nbsp;<span class="op" id="6440018">:=</span>&nbsp;<span class="builtinfunc" id="6440021">new</span><span class="op" id="6440024">(</span><span class="ident" id="6440025">bytes</span><span class="op" id="6440030">.</span><span class="ident" id="6440031">Buffer</span><span class="op" id="6440037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6440040">//&nbsp;Every&nbsp;line&nbsp;is&nbsp;indented&nbsp;at&nbsp;least&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440085">buf</span><span class="op" id="6440088">.</span><span class="ident" id="6440089">WriteByte</span><span class="op" id="6440098">(</span><span class="string" id="6440099">&#39;\t&#39;</span><span class="op" id="6440103">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440106">fmt</span><span class="op" id="6440109">.</span><span class="ident" id="6440110">Fprintf</span><span class="op" id="6440117">(</span><span class="ident" id="6440118">buf</span><span class="op" id="6440121">,</span>&nbsp;<span class="string" id="6440123">&#34;%s:%d:&nbsp;&#34;</span><span class="op" id="6440132">,</span>&nbsp;<span class="ident" id="6440134">file</span><span class="op" id="6440138">,</span>&nbsp;<span class="ident" id="6440140">line</span><span class="op" id="6440144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440147">lines</span>&nbsp;<span class="op" id="6440153">:=</span>&nbsp;<span class="ident" id="6440156">strings</span><span class="op" id="6440163">.</span><span class="ident" id="6440164">Split</span><span class="op" id="6440169">(</span><span class="ident" id="6440170">s</span><span class="op" id="6440171">,</span>&nbsp;<span class="string" id="6440173">&#34;\n&#34;</span><span class="op" id="6440177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440180">if</span>&nbsp;<span class="ident" id="6440183">l</span>&nbsp;<span class="op" id="6440185">:=</span>&nbsp;<span class="builtinfunc" id="6440188">len</span><span class="op" id="6440191">(</span><span class="ident" id="6440192">lines</span><span class="op" id="6440197">)</span><span class="op" id="6440198">;</span>&nbsp;<span class="ident" id="6440200">l</span>&nbsp;<span class="op" id="6440202">&gt;</span>&nbsp;<span class="num" id="6440204">1</span>&nbsp;<span class="op" id="6440206">&amp;&amp;</span>&nbsp;<span class="ident" id="6440209">lines</span><span class="op" id="6440214">[</span><span class="ident" id="6440215">l</span><span class="op" id="6440216">-</span><span class="num" id="6440217">1</span><span class="op" id="6440218">]</span>&nbsp;<span class="op" id="6440220">==</span>&nbsp;<span class="string" id="6440223">&#34;&#34;</span>&nbsp;<span class="op" id="6440226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440230">lines</span>&nbsp;<span class="op" id="6440236">=</span>&nbsp;<span class="ident" id="6440238">lines</span><span class="op" id="6440243">[</span><span class="op" id="6440244">:</span><span class="ident" id="6440245">l</span><span class="op" id="6440246">-</span><span class="num" id="6440247">1</span><span class="op" id="6440248">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440251">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440254">for</span>&nbsp;<span class="ident" id="6440258">i</span><span class="op" id="6440259">,</span>&nbsp;<span class="ident" id="6440261">line</span>&nbsp;<span class="op" id="6440266">:=</span>&nbsp;<span class="keyword" id="6440269">range</span>&nbsp;<span class="ident" id="6440275">lines</span>&nbsp;<span class="op" id="6440281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440285">if</span>&nbsp;<span class="ident" id="6440288">i</span>&nbsp;<span class="op" id="6440290">&gt;</span>&nbsp;<span class="num" id="6440292">0</span>&nbsp;<span class="op" id="6440294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6440299">//&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;lines&nbsp;are&nbsp;indented&nbsp;an&nbsp;extra&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440360">buf</span><span class="op" id="6440363">.</span><span class="ident" id="6440364">WriteString</span><span class="op" id="6440375">(</span><span class="string" id="6440376">&#34;\n\t\t&#34;</span><span class="op" id="6440384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440388">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440392">buf</span><span class="op" id="6440395">.</span><span class="ident" id="6440396">WriteString</span><span class="op" id="6440407">(</span><span class="ident" id="6440408">line</span><span class="op" id="6440412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440418">buf</span><span class="op" id="6440421">.</span><span class="ident" id="6440422">WriteByte</span><span class="op" id="6440431">(</span><span class="string" id="6440432">&#39;\n&#39;</span><span class="op" id="6440436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440439">return</span>&nbsp;<span class="ident" id="6440446">buf</span><span class="op" id="6440449">.</span><span class="ident" id="6440450">String</span><span class="op" id="6440456">(</span><span class="op" id="6440457">)</span><br>
<span class="lineno"></span><span class="op" id="6440459">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="6440462">//&nbsp;fmtDuration&nbsp;returns&nbsp;a&nbsp;string&nbsp;representing&nbsp;d&nbsp;in&nbsp;the&nbsp;form&nbsp;&#34;87.00s&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6440531">func</span>&nbsp;<span class="ident" id="6440536">fmtDuration</span><span class="op" id="6440547">(</span><span class="ident" id="6440548">d</span>&nbsp;<span class="ident" id="6440550">time</span><span class="op" id="6440554">.</span><span class="ident" id="6440555">Duration</span><span class="op" id="6440563">)</span>&nbsp;<span class="builtintype" id="6440565">string</span>&nbsp;<span class="op" id="6440572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440575">return</span>&nbsp;<span class="ident" id="6440582">fmt</span><span class="op" id="6440585">.</span><span class="ident" id="6440586">Sprintf</span><span class="op" id="6440593">(</span><span class="string" id="6440594">&#34;%.2fs&#34;</span><span class="op" id="6440601">,</span>&nbsp;<span class="ident" id="6440603">d</span><span class="op" id="6440604">.</span><span class="ident" id="6440605">Seconds</span><span class="op" id="6440612">(</span><span class="op" id="6440613">)</span><span class="op" id="6440614">)</span><br>
<span class="lineno"></span><span class="op" id="6440616">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment" id="6440619">//&nbsp;TB&nbsp;is&nbsp;the&nbsp;interface&nbsp;common&nbsp;to&nbsp;T&nbsp;and&nbsp;B.</span><br>
<span class="lineno"></span><span class="keyword" id="6440661">type</span>&nbsp;<span class="ident" id="6440666">TB</span>&nbsp;<span class="keyword" id="6440669">interface</span>&nbsp;<span class="op" id="6440679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440682">Error</span><span class="op" id="6440687">(</span><span class="ident" id="6440688">args</span>&nbsp;<span class="op" id="6440693">...</span><span class="keyword" id="6440696">interface</span><span class="op" id="6440705">{</span><span class="op" id="6440706">}</span><span class="op" id="6440707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440710">Errorf</span><span class="op" id="6440716">(</span><span class="ident" id="6440717">format</span>&nbsp;<span class="builtintype" id="6440724">string</span><span class="op" id="6440730">,</span>&nbsp;<span class="ident" id="6440732">args</span>&nbsp;<span class="op" id="6440737">...</span><span class="keyword" id="6440740">interface</span><span class="op" id="6440749">{</span><span class="op" id="6440750">}</span><span class="op" id="6440751">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440754">Fail</span><span class="op" id="6440758">(</span><span class="op" id="6440759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440762">FailNow</span><span class="op" id="6440769">(</span><span class="op" id="6440770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440773">Failed</span><span class="op" id="6440779">(</span><span class="op" id="6440780">)</span>&nbsp;<span class="builtintype" id="6440782">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440788">Fatal</span><span class="op" id="6440793">(</span><span class="ident" id="6440794">args</span>&nbsp;<span class="op" id="6440799">...</span><span class="keyword" id="6440802">interface</span><span class="op" id="6440811">{</span><span class="op" id="6440812">}</span><span class="op" id="6440813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440816">Fatalf</span><span class="op" id="6440822">(</span><span class="ident" id="6440823">format</span>&nbsp;<span class="builtintype" id="6440830">string</span><span class="op" id="6440836">,</span>&nbsp;<span class="ident" id="6440838">args</span>&nbsp;<span class="op" id="6440843">...</span><span class="keyword" id="6440846">interface</span><span class="op" id="6440855">{</span><span class="op" id="6440856">}</span><span class="op" id="6440857">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440860">Log</span><span class="op" id="6440863">(</span><span class="ident" id="6440864">args</span>&nbsp;<span class="op" id="6440869">...</span><span class="keyword" id="6440872">interface</span><span class="op" id="6440881">{</span><span class="op" id="6440882">}</span><span class="op" id="6440883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440886">Logf</span><span class="op" id="6440890">(</span><span class="ident" id="6440891">format</span>&nbsp;<span class="builtintype" id="6440898">string</span><span class="op" id="6440904">,</span>&nbsp;<span class="ident" id="6440906">args</span>&nbsp;<span class="op" id="6440911">...</span><span class="keyword" id="6440914">interface</span><span class="op" id="6440923">{</span><span class="op" id="6440924">}</span><span class="op" id="6440925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440928">Skip</span><span class="op" id="6440932">(</span><span class="ident" id="6440933">args</span>&nbsp;<span class="op" id="6440938">...</span><span class="keyword" id="6440941">interface</span><span class="op" id="6440950">{</span><span class="op" id="6440951">}</span><span class="op" id="6440952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440955">SkipNow</span><span class="op" id="6440962">(</span><span class="op" id="6440963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440966">Skipf</span><span class="op" id="6440971">(</span><span class="ident" id="6440972">format</span>&nbsp;<span class="builtintype" id="6440979">string</span><span class="op" id="6440985">,</span>&nbsp;<span class="ident" id="6440987">args</span>&nbsp;<span class="op" id="6440992">...</span><span class="keyword" id="6440995">interface</span><span class="op" id="6441004">{</span><span class="op" id="6441005">}</span><span class="op" id="6441006">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441009">Skipped</span><span class="op" id="6441016">(</span><span class="op" id="6441017">)</span>&nbsp;<span class="builtintype" id="6441019">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6441026">//&nbsp;A&nbsp;private&nbsp;method&nbsp;to&nbsp;prevent&nbsp;users&nbsp;implementing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6441081">//&nbsp;interface&nbsp;and&nbsp;so&nbsp;future&nbsp;additions&nbsp;to&nbsp;it&nbsp;will&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6441134">//&nbsp;violate&nbsp;Go&nbsp;1&nbsp;compatibility.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441166">private</span><span class="op" id="6441173">(</span><span class="op" id="6441174">)</span><br>
<span class="lineno"></span><span class="op" id="6441176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6441179">var</span>&nbsp;<span class="ident" id="6441183">_</span>&nbsp;<span class="ident" id="6441185">TB</span>&nbsp;<span class="op" id="6441188">=</span>&nbsp;<span class="op" id="6441190">(</span><span class="op" id="6441191">*</span><span class="ident" id="6441192">T</span><span class="op" id="6441193">)</span><span class="op" id="6441194">(</span><span class="ident" id="6441195">nil</span><span class="op" id="6441198">)</span><br>
<span class="lineno"></span><span class="keyword" id="6441200">var</span>&nbsp;<span class="ident" id="6441204">_</span>&nbsp;<span class="ident" id="6441206">TB</span>&nbsp;<span class="op" id="6441209">=</span>&nbsp;<span class="op" id="6441211">(</span><span class="op" id="6441212">*</span><span class="ident" id="6441213">B</span><span class="op" id="6441214">)</span><span class="op" id="6441215">(</span><span class="ident" id="6441216">nil</span><span class="op" id="6441219">)</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6441222">//&nbsp;T&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Test&nbsp;functions&nbsp;to&nbsp;manage&nbsp;test&nbsp;state&nbsp;and&nbsp;support&nbsp;formatted&nbsp;test&nbsp;logs.</span><br>
<span class="lineno"></span><span class="comment" id="6441316">//&nbsp;Logs&nbsp;are&nbsp;accumulated&nbsp;during&nbsp;execution&nbsp;and&nbsp;dumped&nbsp;to&nbsp;standard&nbsp;error&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="6441397">type</span>&nbsp;<span class="ident" id="6441402">T</span>&nbsp;<span class="keyword" id="6441404">struct</span>&nbsp;<span class="op" id="6441411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441414">common</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441422">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6441436">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6441446">//&nbsp;Name&nbsp;of&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441464">startParallel</span>&nbsp;<span class="keyword" id="6441478">chan</span>&nbsp;<span class="builtintype" id="6441483">bool</span>&nbsp;<span class="comment" id="6441488">//&nbsp;Parallel&nbsp;tests&nbsp;will&nbsp;wait&nbsp;on&nbsp;this.</span><br>
<span class="lineno"></span><span class="op" id="6441525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6441528">func</span>&nbsp;<span class="op" id="6441533">(</span><span class="ident" id="6441534">c</span>&nbsp;<span class="op" id="6441536">*</span><span class="ident" id="6441537">common</span><span class="op" id="6441543">)</span>&nbsp;<span class="ident" id="6441545">private</span><span class="op" id="6441552">(</span><span class="op" id="6441553">)</span>&nbsp;<span class="op" id="6441555">{</span><span class="op" id="6441556">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6441559">//&nbsp;Fail&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;but&nbsp;continues&nbsp;execution.</span><br>
<span class="lineno"></span><span class="keyword" id="6441628">func</span>&nbsp;<span class="op" id="6441633">(</span><span class="ident" id="6441634">c</span>&nbsp;<span class="op" id="6441636">*</span><span class="ident" id="6441637">common</span><span class="op" id="6441643">)</span>&nbsp;<span class="ident" id="6441645">Fail</span><span class="op" id="6441649">(</span><span class="op" id="6441650">)</span>&nbsp;<span class="op" id="6441652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441655">c</span><span class="op" id="6441656">.</span><span class="ident" id="6441657">mu</span><span class="op" id="6441659">.</span><span class="ident" id="6441660">Lock</span><span class="op" id="6441664">(</span><span class="op" id="6441665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441668">defer</span>&nbsp;<span class="ident" id="6441674">c</span><span class="op" id="6441675">.</span><span class="ident" id="6441676">mu</span><span class="op" id="6441678">.</span><span class="ident" id="6441679">Unlock</span><span class="op" id="6441685">(</span><span class="op" id="6441686">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441689">c</span><span class="op" id="6441690">.</span><span class="ident" id="6441691">failed</span>&nbsp;<span class="op" id="6441698">=</span>&nbsp;<span class="builtintype" id="6441700">true</span><br>
<span class="lineno"></span><span class="op" id="6441705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6441708">//&nbsp;Failed&nbsp;reports&nbsp;whether&nbsp;the&nbsp;function&nbsp;has&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6441759">func</span>&nbsp;<span class="op" id="6441764">(</span><span class="ident" id="6441765">c</span>&nbsp;<span class="op" id="6441767">*</span><span class="ident" id="6441768">common</span><span class="op" id="6441774">)</span>&nbsp;<span class="ident" id="6441776">Failed</span><span class="op" id="6441782">(</span><span class="op" id="6441783">)</span>&nbsp;<span class="builtintype" id="6441785">bool</span>&nbsp;<span class="op" id="6441790">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441793">c</span><span class="op" id="6441794">.</span><span class="ident" id="6441795">mu</span><span class="op" id="6441797">.</span><span class="ident" id="6441798">RLock</span><span class="op" id="6441803">(</span><span class="op" id="6441804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441807">defer</span>&nbsp;<span class="ident" id="6441813">c</span><span class="op" id="6441814">.</span><span class="ident" id="6441815">mu</span><span class="op" id="6441817">.</span><span class="ident" id="6441818">RUnlock</span><span class="op" id="6441825">(</span><span class="op" id="6441826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441829">return</span>&nbsp;<span class="ident" id="6441836">c</span><span class="op" id="6441837">.</span><span class="ident" id="6441838">failed</span><br>
<span class="lineno"></span><span class="op" id="6441845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="6441848">//&nbsp;FailNow&nbsp;marks&nbsp;the&nbsp;function&nbsp;as&nbsp;having&nbsp;failed&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6441920">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.</span><br>
<span class="lineno"></span><span class="comment" id="6441978">//&nbsp;FailNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6442035">//&nbsp;test&nbsp;or&nbsp;benchmark&nbsp;function,&nbsp;not&nbsp;from&nbsp;other&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6442092">//&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;FailNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno">305</span><span class="comment" id="6442150">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6442177">func</span>&nbsp;<span class="op" id="6442182">(</span><span class="ident" id="6442183">c</span>&nbsp;<span class="op" id="6442185">*</span><span class="ident" id="6442186">common</span><span class="op" id="6442192">)</span>&nbsp;<span class="ident" id="6442194">FailNow</span><span class="op" id="6442201">(</span><span class="op" id="6442202">)</span>&nbsp;<span class="op" id="6442204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442207">c</span><span class="op" id="6442208">.</span><span class="ident" id="6442209">Fail</span><span class="op" id="6442213">(</span><span class="op" id="6442214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442218">//&nbsp;Calling&nbsp;runtime.Goexit&nbsp;will&nbsp;exit&nbsp;the&nbsp;goroutine,&nbsp;which</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442276">//&nbsp;will&nbsp;run&nbsp;the&nbsp;deferred&nbsp;functions&nbsp;in&nbsp;this&nbsp;goroutine,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442331">//&nbsp;which&nbsp;will&nbsp;eventually&nbsp;run&nbsp;the&nbsp;deferred&nbsp;lines&nbsp;in&nbsp;tRunner,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442392">//&nbsp;which&nbsp;will&nbsp;signal&nbsp;to&nbsp;the&nbsp;test&nbsp;loop&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442455">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442459">//&nbsp;A&nbsp;previous&nbsp;version&nbsp;of&nbsp;this&nbsp;code&nbsp;said:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442501">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442505">//&nbsp;&nbsp;&nbsp;&nbspc.duration&nbsp;=&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442526">//&nbsp;&nbsp;&nbsp;&nbspc.signal&nbsp;&lt;-&nbsp;c.self</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442549">//&nbsp;&nbsp;&nbsp;&nbspruntime.Goexit()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442570">//</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442574">//&nbsp;This&nbsp;previous&nbsp;version&nbsp;duplicated&nbsp;code&nbsp;(those&nbsp;lines&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442636">//&nbsp;tRunner&nbsp;no&nbsp;matter&nbsp;what),&nbsp;but&nbsp;worse&nbsp;the&nbsp;goroutine&nbsp;teardown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442698">//&nbsp;implicit&nbsp;in&nbsp;runtime.Goexit&nbsp;was&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442760">//&nbsp;before&nbsp;the&nbsp;test&nbsp;exited.&nbsp;&nbsp;If&nbsp;a&nbsp;test&nbsp;deferred&nbsp;an&nbsp;important&nbsp;cleanup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442829">//&nbsp;function&nbsp;(like&nbsp;removing&nbsp;temporary&nbsp;files),&nbsp;there&nbsp;was&nbsp;no&nbsp;guarantee</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442898">//&nbsp;it&nbsp;would&nbsp;run&nbsp;on&nbsp;a&nbsp;test&nbsp;failure.&nbsp;&nbsp;Because&nbsp;we&nbsp;send&nbsp;on&nbsp;c.signal&nbsp;during</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442970">//&nbsp;a&nbsp;top-of-stack&nbsp;deferred&nbsp;function&nbsp;now,&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6443034">//&nbsp;only&nbsp;happens&nbsp;after&nbsp;any&nbsp;other&nbsp;stacked&nbsp;defers&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443098">c</span><span class="op" id="6443099">.</span><span class="ident" id="6443100">finished</span>&nbsp;<span class="op" id="6443109">=</span>&nbsp;<span class="builtintype" id="6443111">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443117">runtime</span><span class="op" id="6443124">.</span><span class="ident" id="6443125">Goexit</span><span class="op" id="6443131">(</span><span class="op" id="6443132">)</span><br>
<span class="lineno">330</span><span class="op" id="6443134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6443137">//&nbsp;log&nbsp;generates&nbsp;the&nbsp;output.&nbsp;It&#39;s&nbsp;always&nbsp;at&nbsp;the&nbsp;same&nbsp;stack&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6443203">func</span>&nbsp;<span class="op" id="6443208">(</span><span class="ident" id="6443209">c</span>&nbsp;<span class="op" id="6443211">*</span><span class="ident" id="6443212">common</span><span class="op" id="6443218">)</span>&nbsp;<span class="ident" id="6443220">log</span><span class="op" id="6443223">(</span><span class="ident" id="6443224">s</span>&nbsp;<span class="builtintype" id="6443226">string</span><span class="op" id="6443232">)</span>&nbsp;<span class="op" id="6443234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443237">c</span><span class="op" id="6443238">.</span><span class="ident" id="6443239">mu</span><span class="op" id="6443241">.</span><span class="ident" id="6443242">Lock</span><span class="op" id="6443246">(</span><span class="op" id="6443247">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443250">defer</span>&nbsp;<span class="ident" id="6443256">c</span><span class="op" id="6443257">.</span><span class="ident" id="6443258">mu</span><span class="op" id="6443260">.</span><span class="ident" id="6443261">Unlock</span><span class="op" id="6443267">(</span><span class="op" id="6443268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443271">c</span><span class="op" id="6443272">.</span><span class="ident" id="6443273">output</span>&nbsp;<span class="op" id="6443280">=</span>&nbsp;<span class="builtinfunc" id="6443282">append</span><span class="op" id="6443288">(</span><span class="ident" id="6443289">c</span><span class="op" id="6443290">.</span><span class="ident" id="6443291">output</span><span class="op" id="6443297">,</span>&nbsp;<span class="ident" id="6443299">decorate</span><span class="op" id="6443307">(</span><span class="ident" id="6443308">s</span><span class="op" id="6443309">)</span><span class="op" id="6443310">...</span><span class="op" id="6443313">)</span><br>
<span class="lineno"></span><span class="op" id="6443315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6443318">//&nbsp;Log&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;using&nbsp;default&nbsp;formatting,&nbsp;analogous&nbsp;to&nbsp;Println,</span><br>
<span class="lineno">340</span><span class="comment" id="6443395">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6443470">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6443516">func</span>&nbsp;<span class="op" id="6443521">(</span><span class="ident" id="6443522">c</span>&nbsp;<span class="op" id="6443524">*</span><span class="ident" id="6443525">common</span><span class="op" id="6443531">)</span>&nbsp;<span class="ident" id="6443533">Log</span><span class="op" id="6443536">(</span><span class="ident" id="6443537">args</span>&nbsp;<span class="op" id="6443542">...</span><span class="keyword" id="6443545">interface</span><span class="op" id="6443554">{</span><span class="op" id="6443555">}</span><span class="op" id="6443556">)</span>&nbsp;<span class="op" id="6443558">{</span>&nbsp;<span class="ident" id="6443560">c</span><span class="op" id="6443561">.</span><span class="ident" id="6443562">log</span><span class="op" id="6443565">(</span><span class="ident" id="6443566">fmt</span><span class="op" id="6443569">.</span><span class="ident" id="6443570">Sprintln</span><span class="op" id="6443578">(</span><span class="ident" id="6443579">args</span><span class="op" id="6443583">...</span><span class="op" id="6443586">)</span><span class="op" id="6443587">)</span>&nbsp;<span class="op" id="6443589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6443592">//&nbsp;Logf&nbsp;formats&nbsp;its&nbsp;arguments&nbsp;according&nbsp;to&nbsp;the&nbsp;format,&nbsp;analogous&nbsp;to&nbsp;Printf,</span><br>
<span class="lineno">345</span><span class="comment" id="6443668">//&nbsp;and&nbsp;records&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;error&nbsp;log.&nbsp;The&nbsp;text&nbsp;will&nbsp;be&nbsp;printed&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6443743">//&nbsp;the&nbsp;test&nbsp;fails&nbsp;or&nbsp;the&nbsp;-test.v&nbsp;flag&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="6443789">func</span>&nbsp;<span class="op" id="6443794">(</span><span class="ident" id="6443795">c</span>&nbsp;<span class="op" id="6443797">*</span><span class="ident" id="6443798">common</span><span class="op" id="6443804">)</span>&nbsp;<span class="ident" id="6443806">Logf</span><span class="op" id="6443810">(</span><span class="ident" id="6443811">format</span>&nbsp;<span class="builtintype" id="6443818">string</span><span class="op" id="6443824">,</span>&nbsp;<span class="ident" id="6443826">args</span>&nbsp;<span class="op" id="6443831">...</span><span class="keyword" id="6443834">interface</span><span class="op" id="6443843">{</span><span class="op" id="6443844">}</span><span class="op" id="6443845">)</span>&nbsp;<span class="op" id="6443847">{</span>&nbsp;<span class="ident" id="6443849">c</span><span class="op" id="6443850">.</span><span class="ident" id="6443851">log</span><span class="op" id="6443854">(</span><span class="ident" id="6443855">fmt</span><span class="op" id="6443858">.</span><span class="ident" id="6443859">Sprintf</span><span class="op" id="6443866">(</span><span class="ident" id="6443867">format</span><span class="op" id="6443873">,</span>&nbsp;<span class="ident" id="6443875">args</span><span class="op" id="6443879">...</span><span class="op" id="6443882">)</span><span class="op" id="6443883">)</span>&nbsp;<span class="op" id="6443885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6443888">//&nbsp;Error&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno">350</span><span class="keyword" id="6443936">func</span>&nbsp;<span class="op" id="6443941">(</span><span class="ident" id="6443942">c</span>&nbsp;<span class="op" id="6443944">*</span><span class="ident" id="6443945">common</span><span class="op" id="6443951">)</span>&nbsp;<span class="ident" id="6443953">Error</span><span class="op" id="6443958">(</span><span class="ident" id="6443959">args</span>&nbsp;<span class="op" id="6443964">...</span><span class="keyword" id="6443967">interface</span><span class="op" id="6443976">{</span><span class="op" id="6443977">}</span><span class="op" id="6443978">)</span>&nbsp;<span class="op" id="6443980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443983">c</span><span class="op" id="6443984">.</span><span class="ident" id="6443985">log</span><span class="op" id="6443988">(</span><span class="ident" id="6443989">fmt</span><span class="op" id="6443992">.</span><span class="ident" id="6443993">Sprintln</span><span class="op" id="6444001">(</span><span class="ident" id="6444002">args</span><span class="op" id="6444006">...</span><span class="op" id="6444009">)</span><span class="op" id="6444010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444013">c</span><span class="op" id="6444014">.</span><span class="ident" id="6444015">Fail</span><span class="op" id="6444019">(</span><span class="op" id="6444020">)</span><br>
<span class="lineno"></span><span class="op" id="6444022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6444025">//&nbsp;Errorf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;Fail.</span><br>
<span class="lineno"></span><span class="keyword" id="6444075">func</span>&nbsp;<span class="op" id="6444080">(</span><span class="ident" id="6444081">c</span>&nbsp;<span class="op" id="6444083">*</span><span class="ident" id="6444084">common</span><span class="op" id="6444090">)</span>&nbsp;<span class="ident" id="6444092">Errorf</span><span class="op" id="6444098">(</span><span class="ident" id="6444099">format</span>&nbsp;<span class="builtintype" id="6444106">string</span><span class="op" id="6444112">,</span>&nbsp;<span class="ident" id="6444114">args</span>&nbsp;<span class="op" id="6444119">...</span><span class="keyword" id="6444122">interface</span><span class="op" id="6444131">{</span><span class="op" id="6444132">}</span><span class="op" id="6444133">)</span>&nbsp;<span class="op" id="6444135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444138">c</span><span class="op" id="6444139">.</span><span class="ident" id="6444140">log</span><span class="op" id="6444143">(</span><span class="ident" id="6444144">fmt</span><span class="op" id="6444147">.</span><span class="ident" id="6444148">Sprintf</span><span class="op" id="6444155">(</span><span class="ident" id="6444156">format</span><span class="op" id="6444162">,</span>&nbsp;<span class="ident" id="6444164">args</span><span class="op" id="6444168">...</span><span class="op" id="6444171">)</span><span class="op" id="6444172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444175">c</span><span class="op" id="6444176">.</span><span class="ident" id="6444177">Fail</span><span class="op" id="6444181">(</span><span class="op" id="6444182">)</span><br>
<span class="lineno"></span><span class="op" id="6444184">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="6444187">//&nbsp;Fatal&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6444238">func</span>&nbsp;<span class="op" id="6444243">(</span><span class="ident" id="6444244">c</span>&nbsp;<span class="op" id="6444246">*</span><span class="ident" id="6444247">common</span><span class="op" id="6444253">)</span>&nbsp;<span class="ident" id="6444255">Fatal</span><span class="op" id="6444260">(</span><span class="ident" id="6444261">args</span>&nbsp;<span class="op" id="6444266">...</span><span class="keyword" id="6444269">interface</span><span class="op" id="6444278">{</span><span class="op" id="6444279">}</span><span class="op" id="6444280">)</span>&nbsp;<span class="op" id="6444282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444285">c</span><span class="op" id="6444286">.</span><span class="ident" id="6444287">log</span><span class="op" id="6444290">(</span><span class="ident" id="6444291">fmt</span><span class="op" id="6444294">.</span><span class="ident" id="6444295">Sprintln</span><span class="op" id="6444303">(</span><span class="ident" id="6444304">args</span><span class="op" id="6444308">...</span><span class="op" id="6444311">)</span><span class="op" id="6444312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444315">c</span><span class="op" id="6444316">.</span><span class="ident" id="6444317">FailNow</span><span class="op" id="6444324">(</span><span class="op" id="6444325">)</span><br>
<span class="lineno">365</span><span class="op" id="6444327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6444330">//&nbsp;Fatalf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6444383">func</span>&nbsp;<span class="op" id="6444388">(</span><span class="ident" id="6444389">c</span>&nbsp;<span class="op" id="6444391">*</span><span class="ident" id="6444392">common</span><span class="op" id="6444398">)</span>&nbsp;<span class="ident" id="6444400">Fatalf</span><span class="op" id="6444406">(</span><span class="ident" id="6444407">format</span>&nbsp;<span class="builtintype" id="6444414">string</span><span class="op" id="6444420">,</span>&nbsp;<span class="ident" id="6444422">args</span>&nbsp;<span class="op" id="6444427">...</span><span class="keyword" id="6444430">interface</span><span class="op" id="6444439">{</span><span class="op" id="6444440">}</span><span class="op" id="6444441">)</span>&nbsp;<span class="op" id="6444443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444446">c</span><span class="op" id="6444447">.</span><span class="ident" id="6444448">log</span><span class="op" id="6444451">(</span><span class="ident" id="6444452">fmt</span><span class="op" id="6444455">.</span><span class="ident" id="6444456">Sprintf</span><span class="op" id="6444463">(</span><span class="ident" id="6444464">format</span><span class="op" id="6444470">,</span>&nbsp;<span class="ident" id="6444472">args</span><span class="op" id="6444476">...</span><span class="op" id="6444479">)</span><span class="op" id="6444480">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444483">c</span><span class="op" id="6444484">.</span><span class="ident" id="6444485">FailNow</span><span class="op" id="6444492">(</span><span class="op" id="6444493">)</span><br>
<span class="lineno"></span><span class="op" id="6444495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6444498">//&nbsp;Skip&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Log&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno"></span><span class="keyword" id="6444548">func</span>&nbsp;<span class="op" id="6444553">(</span><span class="ident" id="6444554">c</span>&nbsp;<span class="op" id="6444556">*</span><span class="ident" id="6444557">common</span><span class="op" id="6444563">)</span>&nbsp;<span class="ident" id="6444565">Skip</span><span class="op" id="6444569">(</span><span class="ident" id="6444570">args</span>&nbsp;<span class="op" id="6444575">...</span><span class="keyword" id="6444578">interface</span><span class="op" id="6444587">{</span><span class="op" id="6444588">}</span><span class="op" id="6444589">)</span>&nbsp;<span class="op" id="6444591">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444594">c</span><span class="op" id="6444595">.</span><span class="ident" id="6444596">log</span><span class="op" id="6444599">(</span><span class="ident" id="6444600">fmt</span><span class="op" id="6444603">.</span><span class="ident" id="6444604">Sprintln</span><span class="op" id="6444612">(</span><span class="ident" id="6444613">args</span><span class="op" id="6444617">...</span><span class="op" id="6444620">)</span><span class="op" id="6444621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444624">c</span><span class="op" id="6444625">.</span><span class="ident" id="6444626">SkipNow</span><span class="op" id="6444633">(</span><span class="op" id="6444634">)</span><br>
<span class="lineno"></span><span class="op" id="6444636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6444639">//&nbsp;Skipf&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Logf&nbsp;followed&nbsp;by&nbsp;SkipNow.</span><br>
<span class="lineno">380</span><span class="keyword" id="6444691">func</span>&nbsp;<span class="op" id="6444696">(</span><span class="ident" id="6444697">c</span>&nbsp;<span class="op" id="6444699">*</span><span class="ident" id="6444700">common</span><span class="op" id="6444706">)</span>&nbsp;<span class="ident" id="6444708">Skipf</span><span class="op" id="6444713">(</span><span class="ident" id="6444714">format</span>&nbsp;<span class="builtintype" id="6444721">string</span><span class="op" id="6444727">,</span>&nbsp;<span class="ident" id="6444729">args</span>&nbsp;<span class="op" id="6444734">...</span><span class="keyword" id="6444737">interface</span><span class="op" id="6444746">{</span><span class="op" id="6444747">}</span><span class="op" id="6444748">)</span>&nbsp;<span class="op" id="6444750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444753">c</span><span class="op" id="6444754">.</span><span class="ident" id="6444755">log</span><span class="op" id="6444758">(</span><span class="ident" id="6444759">fmt</span><span class="op" id="6444762">.</span><span class="ident" id="6444763">Sprintf</span><span class="op" id="6444770">(</span><span class="ident" id="6444771">format</span><span class="op" id="6444777">,</span>&nbsp;<span class="ident" id="6444779">args</span><span class="op" id="6444783">...</span><span class="op" id="6444786">)</span><span class="op" id="6444787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444790">c</span><span class="op" id="6444791">.</span><span class="ident" id="6444792">SkipNow</span><span class="op" id="6444799">(</span><span class="op" id="6444800">)</span><br>
<span class="lineno"></span><span class="op" id="6444802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="6444805">//&nbsp;SkipNow&nbsp;marks&nbsp;the&nbsp;test&nbsp;as&nbsp;having&nbsp;been&nbsp;skipped&nbsp;and&nbsp;stops&nbsp;its&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="6444879">//&nbsp;Execution&nbsp;will&nbsp;continue&nbsp;at&nbsp;the&nbsp;next&nbsp;test&nbsp;or&nbsp;benchmark.&nbsp;See&nbsp;also&nbsp;FailNow.</span><br>
<span class="lineno"></span><span class="comment" id="6444955">//&nbsp;SkipNow&nbsp;must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;goroutine&nbsp;running&nbsp;the&nbsp;test,&nbsp;not&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6445027">//&nbsp;other&nbsp;goroutines&nbsp;created&nbsp;during&nbsp;the&nbsp;test.&nbsp;Calling&nbsp;SkipNow&nbsp;does&nbsp;not&nbsp;stop</span><br>
<span class="lineno"></span><span class="comment" id="6445102">//&nbsp;those&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno">390</span><span class="keyword" id="6445129">func</span>&nbsp;<span class="op" id="6445134">(</span><span class="ident" id="6445135">c</span>&nbsp;<span class="op" id="6445137">*</span><span class="ident" id="6445138">common</span><span class="op" id="6445144">)</span>&nbsp;<span class="ident" id="6445146">SkipNow</span><span class="op" id="6445153">(</span><span class="op" id="6445154">)</span>&nbsp;<span class="op" id="6445156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445159">c</span><span class="op" id="6445160">.</span><span class="ident" id="6445161">skip</span><span class="op" id="6445165">(</span><span class="op" id="6445166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445169">c</span><span class="op" id="6445170">.</span><span class="ident" id="6445171">finished</span>&nbsp;<span class="op" id="6445180">=</span>&nbsp;<span class="builtintype" id="6445182">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445188">runtime</span><span class="op" id="6445195">.</span><span class="ident" id="6445196">Goexit</span><span class="op" id="6445202">(</span><span class="op" id="6445203">)</span><br>
<span class="lineno"></span><span class="op" id="6445205">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="6445208">func</span>&nbsp;<span class="op" id="6445213">(</span><span class="ident" id="6445214">c</span>&nbsp;<span class="op" id="6445216">*</span><span class="ident" id="6445217">common</span><span class="op" id="6445223">)</span>&nbsp;<span class="ident" id="6445225">skip</span><span class="op" id="6445229">(</span><span class="op" id="6445230">)</span>&nbsp;<span class="op" id="6445232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445235">c</span><span class="op" id="6445236">.</span><span class="ident" id="6445237">mu</span><span class="op" id="6445239">.</span><span class="ident" id="6445240">Lock</span><span class="op" id="6445244">(</span><span class="op" id="6445245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445248">defer</span>&nbsp;<span class="ident" id="6445254">c</span><span class="op" id="6445255">.</span><span class="ident" id="6445256">mu</span><span class="op" id="6445258">.</span><span class="ident" id="6445259">Unlock</span><span class="op" id="6445265">(</span><span class="op" id="6445266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445269">c</span><span class="op" id="6445270">.</span><span class="ident" id="6445271">skipped</span>&nbsp;<span class="op" id="6445279">=</span>&nbsp;<span class="builtintype" id="6445281">true</span><br>
<span class="lineno">400</span><span class="op" id="6445286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6445289">//&nbsp;Skipped&nbsp;reports&nbsp;whether&nbsp;the&nbsp;test&nbsp;was&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="6445338">func</span>&nbsp;<span class="op" id="6445343">(</span><span class="ident" id="6445344">c</span>&nbsp;<span class="op" id="6445346">*</span><span class="ident" id="6445347">common</span><span class="op" id="6445353">)</span>&nbsp;<span class="ident" id="6445355">Skipped</span><span class="op" id="6445362">(</span><span class="op" id="6445363">)</span>&nbsp;<span class="builtintype" id="6445365">bool</span>&nbsp;<span class="op" id="6445370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445373">c</span><span class="op" id="6445374">.</span><span class="ident" id="6445375">mu</span><span class="op" id="6445377">.</span><span class="ident" id="6445378">RLock</span><span class="op" id="6445383">(</span><span class="op" id="6445384">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445387">defer</span>&nbsp;<span class="ident" id="6445393">c</span><span class="op" id="6445394">.</span><span class="ident" id="6445395">mu</span><span class="op" id="6445397">.</span><span class="ident" id="6445398">RUnlock</span><span class="op" id="6445405">(</span><span class="op" id="6445406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445409">return</span>&nbsp;<span class="ident" id="6445416">c</span><span class="op" id="6445417">.</span><span class="ident" id="6445418">skipped</span><br>
<span class="lineno"></span><span class="op" id="6445426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6445429">//&nbsp;Parallel&nbsp;signals&nbsp;that&nbsp;this&nbsp;test&nbsp;is&nbsp;to&nbsp;be&nbsp;run&nbsp;in&nbsp;parallel&nbsp;with&nbsp;(and&nbsp;only&nbsp;with)</span><br>
<span class="lineno">410</span><span class="comment" id="6445510">//&nbsp;other&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6445535">func</span>&nbsp;<span class="op" id="6445540">(</span><span class="ident" id="6445541">t</span>&nbsp;<span class="op" id="6445543">*</span><span class="ident" id="6445544">T</span><span class="op" id="6445545">)</span>&nbsp;<span class="ident" id="6445547">Parallel</span><span class="op" id="6445555">(</span><span class="op" id="6445556">)</span>&nbsp;<span class="op" id="6445558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445561">t</span><span class="op" id="6445562">.</span><span class="ident" id="6445563">signal</span>&nbsp;<span class="op" id="6445570">&lt;-</span>&nbsp;<span class="op" id="6445573">(</span><span class="op" id="6445574">*</span><span class="ident" id="6445575">T</span><span class="op" id="6445576">)</span><span class="op" id="6445577">(</span><span class="ident" id="6445578">nil</span><span class="op" id="6445581">)</span>&nbsp;<span class="comment" id="6445583">//&nbsp;Release&nbsp;main&nbsp;testing&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445613">&lt;-</span><span class="ident" id="6445615">t</span><span class="op" id="6445616">.</span><span class="ident" id="6445617">startParallel</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6445635">//&nbsp;Wait&nbsp;for&nbsp;serial&nbsp;tests&nbsp;to&nbsp;finish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6445671">//&nbsp;Assuming&nbsp;Parallel&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;a&nbsp;test&nbsp;does,&nbsp;which&nbsp;is&nbsp;reasonable,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6445746">//&nbsp;reinitialize&nbsp;the&nbsp;test&#39;s&nbsp;start&nbsp;time&nbsp;because&nbsp;it&#39;s&nbsp;actually&nbsp;starting&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445821">t</span><span class="op" id="6445822">.</span><span class="ident" id="6445823">start</span>&nbsp;<span class="op" id="6445829">=</span>&nbsp;<span class="ident" id="6445831">time</span><span class="op" id="6445835">.</span><span class="ident" id="6445836">Now</span><span class="op" id="6445839">(</span><span class="op" id="6445840">)</span><br>
<span class="lineno"></span><span class="op" id="6445842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6445845">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno">420</span><span class="comment" id="6445934">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6445963">type</span>&nbsp;<span class="ident" id="6445968">InternalTest</span>&nbsp;<span class="keyword" id="6445981">struct</span>&nbsp;<span class="op" id="6445988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445991">Name</span>&nbsp;<span class="builtintype" id="6445996">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446004">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6446009">func</span><span class="op" id="6446013">(</span><span class="op" id="6446014">*</span><span class="ident" id="6446015">T</span><span class="op" id="6446016">)</span><br>
<span class="lineno"></span><span class="op" id="6446018">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="6446021">func</span>&nbsp;<span class="ident" id="6446026">tRunner</span><span class="op" id="6446033">(</span><span class="ident" id="6446034">t</span>&nbsp;<span class="op" id="6446036">*</span><span class="ident" id="6446037">T</span><span class="op" id="6446038">,</span>&nbsp;<span class="ident" id="6446040">test</span>&nbsp;<span class="op" id="6446045">*</span><span class="ident" id="6446046">InternalTest</span><span class="op" id="6446058">)</span>&nbsp;<span class="op" id="6446060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6446063">//&nbsp;When&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;done,&nbsp;either&nbsp;because&nbsp;test.F(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6446121">//&nbsp;returned&nbsp;normally&nbsp;or&nbsp;because&nbsp;a&nbsp;test&nbsp;failure&nbsp;triggered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6446179">//&nbsp;a&nbsp;call&nbsp;to&nbsp;runtime.Goexit,&nbsp;record&nbsp;the&nbsp;duration&nbsp;and&nbsp;send</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6446238">//&nbsp;a&nbsp;signal&nbsp;saying&nbsp;that&nbsp;the&nbsp;test&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446281">defer</span>&nbsp;<span class="keyword" id="6446287">func</span><span class="op" id="6446291">(</span><span class="op" id="6446292">)</span>&nbsp;<span class="op" id="6446294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446298">t</span><span class="op" id="6446299">.</span><span class="ident" id="6446300">duration</span>&nbsp;<span class="op" id="6446309">=</span>&nbsp;<span class="ident" id="6446311">time</span><span class="op" id="6446315">.</span><span class="ident" id="6446316">Now</span><span class="op" id="6446319">(</span><span class="op" id="6446320">)</span><span class="op" id="6446321">.</span><span class="ident" id="6446322">Sub</span><span class="op" id="6446325">(</span><span class="ident" id="6446326">t</span><span class="op" id="6446327">.</span><span class="ident" id="6446328">start</span><span class="op" id="6446333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6446337">//&nbsp;If&nbsp;the&nbsp;test&nbsp;panicked,&nbsp;print&nbsp;any&nbsp;test&nbsp;output&nbsp;before&nbsp;dying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446400">err</span>&nbsp;<span class="op" id="6446404">:=</span>&nbsp;<span class="builtinfunc" id="6446407">recover</span><span class="op" id="6446414">(</span><span class="op" id="6446415">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446419">if</span>&nbsp;<span class="op" id="6446422">!</span><span class="ident" id="6446423">t</span><span class="op" id="6446424">.</span><span class="ident" id="6446425">finished</span>&nbsp;<span class="op" id="6446434">&amp;&amp;</span>&nbsp;<span class="ident" id="6446437">err</span>&nbsp;<span class="op" id="6446441">==</span>&nbsp;<span class="ident" id="6446444">nil</span>&nbsp;<span class="op" id="6446448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446453">err</span>&nbsp;<span class="op" id="6446457">=</span>&nbsp;<span class="ident" id="6446459">fmt</span><span class="op" id="6446462">.</span><span class="ident" id="6446463">Errorf</span><span class="op" id="6446469">(</span><span class="string" id="6446470">&#34;test&nbsp;executed&nbsp;panic(nil)&nbsp;or&nbsp;runtime.Goexit&#34;</span><span class="op" id="6446514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446522">if</span>&nbsp;<span class="ident" id="6446525">err</span>&nbsp;<span class="op" id="6446529">!=</span>&nbsp;<span class="ident" id="6446532">nil</span>&nbsp;<span class="op" id="6446536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446541">t</span><span class="op" id="6446542">.</span><span class="ident" id="6446543">Fail</span><span class="op" id="6446547">(</span><span class="op" id="6446548">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446553">t</span><span class="op" id="6446554">.</span><span class="ident" id="6446555">report</span><span class="op" id="6446561">(</span><span class="op" id="6446562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6446567">panic</span><span class="op" id="6446572">(</span><span class="ident" id="6446573">err</span><span class="op" id="6446576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446584">t</span><span class="op" id="6446585">.</span><span class="ident" id="6446586">signal</span>&nbsp;<span class="op" id="6446593">&lt;-</span>&nbsp;<span class="ident" id="6446596">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446599">}</span><span class="op" id="6446600">(</span><span class="op" id="6446601">)</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446605">t</span><span class="op" id="6446606">.</span><span class="ident" id="6446607">start</span>&nbsp;<span class="op" id="6446613">=</span>&nbsp;<span class="ident" id="6446615">time</span><span class="op" id="6446619">.</span><span class="ident" id="6446620">Now</span><span class="op" id="6446623">(</span><span class="op" id="6446624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446627">test</span><span class="op" id="6446631">.</span><span class="ident" id="6446632">F</span><span class="op" id="6446633">(</span><span class="ident" id="6446634">t</span><span class="op" id="6446635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446638">t</span><span class="op" id="6446639">.</span><span class="ident" id="6446640">finished</span>&nbsp;<span class="op" id="6446649">=</span>&nbsp;<span class="builtintype" id="6446651">true</span><br>
<span class="lineno"></span><span class="op" id="6446656">}</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span><span class="comment" id="6446659">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6446752">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6446781">func</span>&nbsp;<span class="ident" id="6446786">Main</span><span class="op" id="6446790">(</span><span class="ident" id="6446791">matchString</span>&nbsp;<span class="keyword" id="6446803">func</span><span class="op" id="6446807">(</span><span class="ident" id="6446808">pat</span><span class="op" id="6446811">,</span>&nbsp;<span class="ident" id="6446813">str</span>&nbsp;<span class="builtintype" id="6446817">string</span><span class="op" id="6446823">)</span>&nbsp;<span class="op" id="6446825">(</span><span class="builtintype" id="6446826">bool</span><span class="op" id="6446830">,</span>&nbsp;<span class="builtintype" id="6446832">error</span><span class="op" id="6446837">)</span><span class="op" id="6446838">,</span>&nbsp;<span class="ident" id="6446840">tests</span>&nbsp;<span class="op" id="6446846">[</span><span class="op" id="6446847">]</span><span class="ident" id="6446848">InternalTest</span><span class="op" id="6446860">,</span>&nbsp;<span class="ident" id="6446862">benchmarks</span>&nbsp;<span class="op" id="6446873">[</span><span class="op" id="6446874">]</span><span class="ident" id="6446875">InternalBenchmark</span><span class="op" id="6446892">,</span>&nbsp;<span class="ident" id="6446894">examples</span>&nbsp;<span class="op" id="6446903">[</span><span class="op" id="6446904">]</span><span class="ident" id="6446905">InternalExample</span><span class="op" id="6446920">)</span>&nbsp;<span class="op" id="6446922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446925">os</span><span class="op" id="6446927">.</span><span class="ident" id="6446928">Exit</span><span class="op" id="6446932">(</span><span class="ident" id="6446933">MainStart</span><span class="op" id="6446942">(</span><span class="ident" id="6446943">matchString</span><span class="op" id="6446954">,</span>&nbsp;<span class="ident" id="6446956">tests</span><span class="op" id="6446961">,</span>&nbsp;<span class="ident" id="6446963">benchmarks</span><span class="op" id="6446973">,</span>&nbsp;<span class="ident" id="6446975">examples</span><span class="op" id="6446983">)</span><span class="op" id="6446984">.</span><span class="ident" id="6446985">Run</span><span class="op" id="6446988">(</span><span class="op" id="6446989">)</span><span class="op" id="6446990">)</span><br>
<span class="lineno">455</span><span class="op" id="6446992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6446995">//&nbsp;M&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;a&nbsp;TestMain&nbsp;function&nbsp;to&nbsp;run&nbsp;the&nbsp;actual&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="6447065">type</span>&nbsp;<span class="ident" id="6447070">M</span>&nbsp;<span class="keyword" id="6447072">struct</span>&nbsp;<span class="op" id="6447079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447082">matchString</span>&nbsp;<span class="keyword" id="6447094">func</span><span class="op" id="6447098">(</span><span class="ident" id="6447099">pat</span><span class="op" id="6447102">,</span>&nbsp;<span class="ident" id="6447104">str</span>&nbsp;<span class="builtintype" id="6447108">string</span><span class="op" id="6447114">)</span>&nbsp;<span class="op" id="6447116">(</span><span class="builtintype" id="6447117">bool</span><span class="op" id="6447121">,</span>&nbsp;<span class="builtintype" id="6447123">error</span><span class="op" id="6447128">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447131">tests</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6447143">[</span><span class="op" id="6447144">]</span><span class="ident" id="6447145">InternalTest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447159">benchmarks</span>&nbsp;&nbsp;<span class="op" id="6447171">[</span><span class="op" id="6447172">]</span><span class="ident" id="6447173">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447192">examples</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6447204">[</span><span class="op" id="6447205">]</span><span class="ident" id="6447206">InternalExample</span><br>
<span class="lineno"></span><span class="op" id="6447222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="comment" id="6447225">//&nbsp;MainStart&nbsp;is&nbsp;meant&nbsp;for&nbsp;use&nbsp;by&nbsp;tests&nbsp;generated&nbsp;by&nbsp;&#39;go&nbsp;test&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="6447288">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;called&nbsp;directly&nbsp;and&nbsp;is&nbsp;not&nbsp;subject&nbsp;to&nbsp;the&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;document.</span><br>
<span class="lineno"></span><span class="comment" id="6447384">//&nbsp;It&nbsp;may&nbsp;change&nbsp;signature&nbsp;from&nbsp;release&nbsp;to&nbsp;release.</span><br>
<span class="lineno"></span><span class="keyword" id="6447436">func</span>&nbsp;<span class="ident" id="6447441">MainStart</span><span class="op" id="6447450">(</span><span class="ident" id="6447451">matchString</span>&nbsp;<span class="keyword" id="6447463">func</span><span class="op" id="6447467">(</span><span class="ident" id="6447468">pat</span><span class="op" id="6447471">,</span>&nbsp;<span class="ident" id="6447473">str</span>&nbsp;<span class="builtintype" id="6447477">string</span><span class="op" id="6447483">)</span>&nbsp;<span class="op" id="6447485">(</span><span class="builtintype" id="6447486">bool</span><span class="op" id="6447490">,</span>&nbsp;<span class="builtintype" id="6447492">error</span><span class="op" id="6447497">)</span><span class="op" id="6447498">,</span>&nbsp;<span class="ident" id="6447500">tests</span>&nbsp;<span class="op" id="6447506">[</span><span class="op" id="6447507">]</span><span class="ident" id="6447508">InternalTest</span><span class="op" id="6447520">,</span>&nbsp;<span class="ident" id="6447522">benchmarks</span>&nbsp;<span class="op" id="6447533">[</span><span class="op" id="6447534">]</span><span class="ident" id="6447535">InternalBenchmark</span><span class="op" id="6447552">,</span>&nbsp;<span class="ident" id="6447554">examples</span>&nbsp;<span class="op" id="6447563">[</span><span class="op" id="6447564">]</span><span class="ident" id="6447565">InternalExample</span><span class="op" id="6447580">)</span>&nbsp;<span class="op" id="6447582">*</span><span class="ident" id="6447583">M</span>&nbsp;<span class="op" id="6447585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447588">return</span>&nbsp;<span class="op" id="6447595">&amp;</span><span class="ident" id="6447596">M</span><span class="op" id="6447597">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447601">matchString</span><span class="op" id="6447612">:</span>&nbsp;<span class="ident" id="6447614">matchString</span><span class="op" id="6447625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447629">tests</span><span class="op" id="6447634">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6447642">tests</span><span class="op" id="6447647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447651">benchmarks</span><span class="op" id="6447661">:</span>&nbsp;&nbsp;<span class="ident" id="6447664">benchmarks</span><span class="op" id="6447674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447678">examples</span><span class="op" id="6447686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6447691">examples</span><span class="op" id="6447699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447702">}</span><br>
<span class="lineno">475</span><span class="op" id="6447704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6447707">//&nbsp;Run&nbsp;runs&nbsp;the&nbsp;tests.&nbsp;It&nbsp;returns&nbsp;an&nbsp;exit&nbsp;code&nbsp;to&nbsp;pass&nbsp;to&nbsp;os.Exit.</span><br>
<span class="lineno"></span><span class="keyword" id="6447774">func</span>&nbsp;<span class="op" id="6447779">(</span><span class="ident" id="6447780">m</span>&nbsp;<span class="op" id="6447782">*</span><span class="ident" id="6447783">M</span><span class="op" id="6447784">)</span>&nbsp;<span class="ident" id="6447786">Run</span><span class="op" id="6447789">(</span><span class="op" id="6447790">)</span>&nbsp;<span class="builtintype" id="6447792">int</span>&nbsp;<span class="op" id="6447796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447799">flag</span><span class="op" id="6447803">.</span><span class="ident" id="6447804">Parse</span><span class="op" id="6447809">(</span><span class="op" id="6447810">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447813">parseCpuList</span><span class="op" id="6447825">(</span><span class="op" id="6447826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447830">before</span><span class="op" id="6447836">(</span><span class="op" id="6447837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447840">startAlarm</span><span class="op" id="6447850">(</span><span class="op" id="6447851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447854">haveExamples</span>&nbsp;<span class="op" id="6447867">=</span>&nbsp;<span class="builtinfunc" id="6447869">len</span><span class="op" id="6447872">(</span><span class="ident" id="6447873">m</span><span class="op" id="6447874">.</span><span class="ident" id="6447875">examples</span><span class="op" id="6447883">)</span>&nbsp;<span class="op" id="6447885">&gt;</span>&nbsp;<span class="num" id="6447887">0</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447890">testOk</span>&nbsp;<span class="op" id="6447897">:=</span>&nbsp;<span class="ident" id="6447900">RunTests</span><span class="op" id="6447908">(</span><span class="ident" id="6447909">m</span><span class="op" id="6447910">.</span><span class="ident" id="6447911">matchString</span><span class="op" id="6447922">,</span>&nbsp;<span class="ident" id="6447924">m</span><span class="op" id="6447925">.</span><span class="ident" id="6447926">tests</span><span class="op" id="6447931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447934">exampleOk</span>&nbsp;<span class="op" id="6447944">:=</span>&nbsp;<span class="ident" id="6447947">RunExamples</span><span class="op" id="6447958">(</span><span class="ident" id="6447959">m</span><span class="op" id="6447960">.</span><span class="ident" id="6447961">matchString</span><span class="op" id="6447972">,</span>&nbsp;<span class="ident" id="6447974">m</span><span class="op" id="6447975">.</span><span class="ident" id="6447976">examples</span><span class="op" id="6447984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447987">stopAlarm</span><span class="op" id="6447996">(</span><span class="op" id="6447997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448000">if</span>&nbsp;<span class="op" id="6448003">!</span><span class="ident" id="6448004">testOk</span>&nbsp;<span class="op" id="6448011">||</span>&nbsp;<span class="op" id="6448014">!</span><span class="ident" id="6448015">exampleOk</span>&nbsp;<span class="op" id="6448025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448029">fmt</span><span class="op" id="6448032">.</span><span class="ident" id="6448033">Println</span><span class="op" id="6448040">(</span><span class="string" id="6448041">&#34;FAIL&#34;</span><span class="op" id="6448047">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448051">after</span><span class="op" id="6448056">(</span><span class="op" id="6448057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448061">return</span>&nbsp;<span class="num" id="6448068">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448074">fmt</span><span class="op" id="6448077">.</span><span class="ident" id="6448078">Println</span><span class="op" id="6448085">(</span><span class="string" id="6448086">&#34;PASS&#34;</span><span class="op" id="6448092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448095">RunBenchmarks</span><span class="op" id="6448108">(</span><span class="ident" id="6448109">m</span><span class="op" id="6448110">.</span><span class="ident" id="6448111">matchString</span><span class="op" id="6448122">,</span>&nbsp;<span class="ident" id="6448124">m</span><span class="op" id="6448125">.</span><span class="ident" id="6448126">benchmarks</span><span class="op" id="6448136">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448139">after</span><span class="op" id="6448144">(</span><span class="op" id="6448145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448148">return</span>&nbsp;<span class="num" id="6448155">0</span><br>
<span class="lineno"></span><span class="op" id="6448157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448160">func</span>&nbsp;<span class="op" id="6448165">(</span><span class="ident" id="6448166">t</span>&nbsp;<span class="op" id="6448168">*</span><span class="ident" id="6448169">T</span><span class="op" id="6448170">)</span>&nbsp;<span class="ident" id="6448172">report</span><span class="op" id="6448178">(</span><span class="op" id="6448179">)</span>&nbsp;<span class="op" id="6448181">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448184">dstr</span>&nbsp;<span class="op" id="6448189">:=</span>&nbsp;<span class="ident" id="6448192">fmtDuration</span><span class="op" id="6448203">(</span><span class="ident" id="6448204">t</span><span class="op" id="6448205">.</span><span class="ident" id="6448206">duration</span><span class="op" id="6448214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448217">format</span>&nbsp;<span class="op" id="6448224">:=</span>&nbsp;<span class="string" id="6448227">&#34;---&nbsp;%s:&nbsp;%s&nbsp;(%s)\n%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448250">if</span>&nbsp;<span class="ident" id="6448253">t</span><span class="op" id="6448254">.</span><span class="ident" id="6448255">Failed</span><span class="op" id="6448261">(</span><span class="op" id="6448262">)</span>&nbsp;<span class="op" id="6448264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448268">fmt</span><span class="op" id="6448271">.</span><span class="ident" id="6448272">Printf</span><span class="op" id="6448278">(</span><span class="ident" id="6448279">format</span><span class="op" id="6448285">,</span>&nbsp;<span class="string" id="6448287">&#34;FAIL&#34;</span><span class="op" id="6448293">,</span>&nbsp;<span class="ident" id="6448295">t</span><span class="op" id="6448296">.</span><span class="ident" id="6448297">name</span><span class="op" id="6448301">,</span>&nbsp;<span class="ident" id="6448303">dstr</span><span class="op" id="6448307">,</span>&nbsp;<span class="ident" id="6448309">t</span><span class="op" id="6448310">.</span><span class="ident" id="6448311">output</span><span class="op" id="6448317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448320">}</span>&nbsp;<span class="keyword" id="6448322">else</span>&nbsp;<span class="keyword" id="6448327">if</span>&nbsp;<span class="op" id="6448330">*</span><span class="ident" id="6448331">chatty</span>&nbsp;<span class="op" id="6448338">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448342">if</span>&nbsp;<span class="ident" id="6448345">t</span><span class="op" id="6448346">.</span><span class="ident" id="6448347">Skipped</span><span class="op" id="6448354">(</span><span class="op" id="6448355">)</span>&nbsp;<span class="op" id="6448357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448362">fmt</span><span class="op" id="6448365">.</span><span class="ident" id="6448366">Printf</span><span class="op" id="6448372">(</span><span class="ident" id="6448373">format</span><span class="op" id="6448379">,</span>&nbsp;<span class="string" id="6448381">&#34;SKIP&#34;</span><span class="op" id="6448387">,</span>&nbsp;<span class="ident" id="6448389">t</span><span class="op" id="6448390">.</span><span class="ident" id="6448391">name</span><span class="op" id="6448395">,</span>&nbsp;<span class="ident" id="6448397">dstr</span><span class="op" id="6448401">,</span>&nbsp;<span class="ident" id="6448403">t</span><span class="op" id="6448404">.</span><span class="ident" id="6448405">output</span><span class="op" id="6448411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448415">}</span>&nbsp;<span class="keyword" id="6448417">else</span>&nbsp;<span class="op" id="6448422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448427">fmt</span><span class="op" id="6448430">.</span><span class="ident" id="6448431">Printf</span><span class="op" id="6448437">(</span><span class="ident" id="6448438">format</span><span class="op" id="6448444">,</span>&nbsp;<span class="string" id="6448446">&#34;PASS&#34;</span><span class="op" id="6448452">,</span>&nbsp;<span class="ident" id="6448454">t</span><span class="op" id="6448455">.</span><span class="ident" id="6448456">name</span><span class="op" id="6448460">,</span>&nbsp;<span class="ident" id="6448462">dstr</span><span class="op" id="6448466">,</span>&nbsp;<span class="ident" id="6448468">t</span><span class="op" id="6448469">.</span><span class="ident" id="6448470">output</span><span class="op" id="6448476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448480">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448483">}</span><br>
<span class="lineno"></span><span class="op" id="6448485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6448488">func</span>&nbsp;<span class="ident" id="6448493">RunTests</span><span class="op" id="6448501">(</span><span class="ident" id="6448502">matchString</span>&nbsp;<span class="keyword" id="6448514">func</span><span class="op" id="6448518">(</span><span class="ident" id="6448519">pat</span><span class="op" id="6448522">,</span>&nbsp;<span class="ident" id="6448524">str</span>&nbsp;<span class="builtintype" id="6448528">string</span><span class="op" id="6448534">)</span>&nbsp;<span class="op" id="6448536">(</span><span class="builtintype" id="6448537">bool</span><span class="op" id="6448541">,</span>&nbsp;<span class="builtintype" id="6448543">error</span><span class="op" id="6448548">)</span><span class="op" id="6448549">,</span>&nbsp;<span class="ident" id="6448551">tests</span>&nbsp;<span class="op" id="6448557">[</span><span class="op" id="6448558">]</span><span class="ident" id="6448559">InternalTest</span><span class="op" id="6448571">)</span>&nbsp;<span class="op" id="6448573">(</span><span class="ident" id="6448574">ok</span>&nbsp;<span class="builtintype" id="6448577">bool</span><span class="op" id="6448581">)</span>&nbsp;<span class="op" id="6448583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448586">ok</span>&nbsp;<span class="op" id="6448589">=</span>&nbsp;<span class="builtintype" id="6448591">true</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448597">if</span>&nbsp;<span class="builtinfunc" id="6448600">len</span><span class="op" id="6448603">(</span><span class="ident" id="6448604">tests</span><span class="op" id="6448609">)</span>&nbsp;<span class="op" id="6448611">==</span>&nbsp;<span class="num" id="6448614">0</span>&nbsp;<span class="op" id="6448616">&amp;&amp;</span>&nbsp;<span class="op" id="6448619">!</span><span class="ident" id="6448620">haveExamples</span>&nbsp;<span class="op" id="6448633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448637">fmt</span><span class="op" id="6448640">.</span><span class="ident" id="6448641">Fprintln</span><span class="op" id="6448649">(</span><span class="ident" id="6448650">os</span><span class="op" id="6448652">.</span><span class="ident" id="6448653">Stderr</span><span class="op" id="6448659">,</span>&nbsp;<span class="string" id="6448661">&#34;testing:&nbsp;warning:&nbsp;no&nbsp;tests&nbsp;to&nbsp;run&#34;</span><span class="op" id="6448696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6448708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6448711">for</span>&nbsp;<span class="ident" id="6448715">_</span><span class="op" id="6448716">,</span>&nbsp;<span class="ident" id="6448718">procs</span>&nbsp;<span class="op" id="6448724">:=</span>&nbsp;<span class="keyword" id="6448727">range</span>&nbsp;<span class="ident" id="6448733">cpuList</span>&nbsp;<span class="op" id="6448741">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6448745">runtime</span><span class="op" id="6448752">.</span><span class="ident" id="6448753">GOMAXPROCS</span><span class="op" id="6448763">(</span><span class="ident" id="6448764">procs</span><span class="op" id="6448769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6448773">//&nbsp;We&nbsp;build&nbsp;a&nbsp;new&nbsp;channel&nbsp;tree&nbsp;for&nbsp;each&nbsp;run&nbsp;of&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6448832">//&nbsp;collector&nbsp;merges&nbsp;in&nbsp;one&nbsp;channel&nbsp;all&nbsp;the&nbsp;upstream&nbsp;signals&nbsp;from&nbsp;parallel&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6448915">//&nbsp;If&nbsp;all&nbsp;tests&nbsp;pump&nbsp;to&nbsp;the&nbsp;same&nbsp;channel,&nbsp;a&nbsp;bug&nbsp;can&nbsp;occur&nbsp;where&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6448988">//&nbsp;kicks&nbsp;off&nbsp;a&nbsp;goroutine&nbsp;that&nbsp;Fails,&nbsp;yet&nbsp;the&nbsp;test&nbsp;still&nbsp;delivers&nbsp;a&nbsp;completion&nbsp;signal,</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6449076">//&nbsp;which&nbsp;skews&nbsp;the&nbsp;counting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449107">var</span>&nbsp;<span class="ident" id="6449111">collector</span>&nbsp;<span class="op" id="6449121">=</span>&nbsp;<span class="builtinfunc" id="6449123">make</span><span class="op" id="6449127">(</span><span class="keyword" id="6449128">chan</span>&nbsp;<span class="keyword" id="6449133">interface</span><span class="op" id="6449142">{</span><span class="op" id="6449143">}</span><span class="op" id="6449144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449149">numParallel</span>&nbsp;<span class="op" id="6449161">:=</span>&nbsp;<span class="num" id="6449164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449168">startParallel</span>&nbsp;<span class="op" id="6449182">:=</span>&nbsp;<span class="builtinfunc" id="6449185">make</span><span class="op" id="6449189">(</span><span class="keyword" id="6449190">chan</span>&nbsp;<span class="builtintype" id="6449195">bool</span><span class="op" id="6449199">)</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449204">for</span>&nbsp;<span class="ident" id="6449208">i</span>&nbsp;<span class="op" id="6449210">:=</span>&nbsp;<span class="num" id="6449213">0</span><span class="op" id="6449214">;</span>&nbsp;<span class="ident" id="6449216">i</span>&nbsp;<span class="op" id="6449218">&lt;</span>&nbsp;<span class="builtinfunc" id="6449220">len</span><span class="op" id="6449223">(</span><span class="ident" id="6449224">tests</span><span class="op" id="6449229">)</span><span class="op" id="6449230">;</span>&nbsp;<span class="ident" id="6449232">i</span><span class="op" id="6449233">++</span>&nbsp;<span class="op" id="6449236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449241">matched</span><span class="op" id="6449248">,</span>&nbsp;<span class="ident" id="6449250">err</span>&nbsp;<span class="op" id="6449254">:=</span>&nbsp;<span class="ident" id="6449257">matchString</span><span class="op" id="6449268">(</span><span class="op" id="6449269">*</span><span class="ident" id="6449270">match</span><span class="op" id="6449275">,</span>&nbsp;<span class="ident" id="6449277">tests</span><span class="op" id="6449282">[</span><span class="ident" id="6449283">i</span><span class="op" id="6449284">]</span><span class="op" id="6449285">.</span><span class="ident" id="6449286">Name</span><span class="op" id="6449290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449295">if</span>&nbsp;<span class="ident" id="6449298">err</span>&nbsp;<span class="op" id="6449302">!=</span>&nbsp;<span class="ident" id="6449305">nil</span>&nbsp;<span class="op" id="6449309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449315">fmt</span><span class="op" id="6449318">.</span><span class="ident" id="6449319">Fprintf</span><span class="op" id="6449326">(</span><span class="ident" id="6449327">os</span><span class="op" id="6449329">.</span><span class="ident" id="6449330">Stderr</span><span class="op" id="6449336">,</span>&nbsp;<span class="string" id="6449338">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.run:&nbsp;%s\n&#34;</span><span class="op" id="6449383">,</span>&nbsp;<span class="ident" id="6449385">err</span><span class="op" id="6449388">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449394">os</span><span class="op" id="6449396">.</span><span class="ident" id="6449397">Exit</span><span class="op" id="6449401">(</span><span class="num" id="6449402">1</span><span class="op" id="6449403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449413">if</span>&nbsp;<span class="op" id="6449416">!</span><span class="ident" id="6449417">matched</span>&nbsp;<span class="op" id="6449425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449431">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449443">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449448">testName</span>&nbsp;<span class="op" id="6449457">:=</span>&nbsp;<span class="ident" id="6449460">tests</span><span class="op" id="6449465">[</span><span class="ident" id="6449466">i</span><span class="op" id="6449467">]</span><span class="op" id="6449468">.</span><span class="ident" id="6449469">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449477">if</span>&nbsp;<span class="ident" id="6449480">procs</span>&nbsp;<span class="op" id="6449486">!=</span>&nbsp;<span class="num" id="6449489">1</span>&nbsp;<span class="op" id="6449491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449497">testName</span>&nbsp;<span class="op" id="6449506">=</span>&nbsp;<span class="ident" id="6449508">fmt</span><span class="op" id="6449511">.</span><span class="ident" id="6449512">Sprintf</span><span class="op" id="6449519">(</span><span class="string" id="6449520">&#34;%s-%d&#34;</span><span class="op" id="6449527">,</span>&nbsp;<span class="ident" id="6449529">tests</span><span class="op" id="6449534">[</span><span class="ident" id="6449535">i</span><span class="op" id="6449536">]</span><span class="op" id="6449537">.</span><span class="ident" id="6449538">Name</span><span class="op" id="6449542">,</span>&nbsp;<span class="ident" id="6449544">procs</span><span class="op" id="6449549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449559">t</span>&nbsp;<span class="op" id="6449561">:=</span>&nbsp;<span class="op" id="6449564">&amp;</span><span class="ident" id="6449565">T</span><span class="op" id="6449566">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449572">common</span><span class="op" id="6449578">:</span>&nbsp;<span class="ident" id="6449580">common</span><span class="op" id="6449586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449593">signal</span><span class="op" id="6449599">:</span>&nbsp;<span class="builtinfunc" id="6449601">make</span><span class="op" id="6449605">(</span><span class="keyword" id="6449606">chan</span>&nbsp;<span class="keyword" id="6449611">interface</span><span class="op" id="6449620">{</span><span class="op" id="6449621">}</span><span class="op" id="6449622">)</span><span class="op" id="6449623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449629">}</span><span class="op" id="6449630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449636">name</span><span class="op" id="6449640">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6449651">testName</span><span class="op" id="6449659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449665">startParallel</span><span class="op" id="6449678">:</span>&nbsp;<span class="ident" id="6449680">startParallel</span><span class="op" id="6449693">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449703">t</span><span class="op" id="6449704">.</span><span class="ident" id="6449705">self</span>&nbsp;<span class="op" id="6449710">=</span>&nbsp;<span class="ident" id="6449712">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449717">if</span>&nbsp;<span class="op" id="6449720">*</span><span class="ident" id="6449721">chatty</span>&nbsp;<span class="op" id="6449728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449734">fmt</span><span class="op" id="6449737">.</span><span class="ident" id="6449738">Printf</span><span class="op" id="6449744">(</span><span class="string" id="6449745">&#34;===&nbsp;RUN&nbsp;%s\n&#34;</span><span class="op" id="6449759">,</span>&nbsp;<span class="ident" id="6449761">t</span><span class="op" id="6449762">.</span><span class="ident" id="6449763">name</span><span class="op" id="6449767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449772">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449777">go</span>&nbsp;<span class="ident" id="6449780">tRunner</span><span class="op" id="6449787">(</span><span class="ident" id="6449788">t</span><span class="op" id="6449789">,</span>&nbsp;<span class="op" id="6449791">&amp;</span><span class="ident" id="6449792">tests</span><span class="op" id="6449797">[</span><span class="ident" id="6449798">i</span><span class="op" id="6449799">]</span><span class="op" id="6449800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449805">out</span>&nbsp;<span class="op" id="6449809">:=</span>&nbsp;<span class="op" id="6449812">(</span><span class="op" id="6449813">&lt;-</span><span class="ident" id="6449815">t</span><span class="op" id="6449816">.</span><span class="ident" id="6449817">signal</span><span class="op" id="6449823">)</span><span class="op" id="6449824">.</span><span class="op" id="6449825">(</span><span class="op" id="6449826">*</span><span class="ident" id="6449827">T</span><span class="op" id="6449828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449833">if</span>&nbsp;<span class="ident" id="6449836">out</span>&nbsp;<span class="op" id="6449840">==</span>&nbsp;<span class="ident" id="6449843">nil</span>&nbsp;<span class="op" id="6449847">{</span>&nbsp;<span class="comment" id="6449849">//&nbsp;Parallel&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449870">go</span>&nbsp;<span class="keyword" id="6449873">func</span><span class="op" id="6449877">(</span><span class="op" id="6449878">)</span>&nbsp;<span class="op" id="6449880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449887">collector</span>&nbsp;<span class="op" id="6449897">&lt;-</span>&nbsp;<span class="op" id="6449900">&lt;-</span><span class="ident" id="6449902">t</span><span class="op" id="6449903">.</span><span class="ident" id="6449904">signal</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449915">}</span><span class="op" id="6449916">(</span><span class="op" id="6449917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449923">numParallel</span><span class="op" id="6449934">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6449941">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449958">t</span><span class="op" id="6449959">.</span><span class="ident" id="6449960">report</span><span class="op" id="6449966">(</span><span class="op" id="6449967">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6449972">ok</span>&nbsp;<span class="op" id="6449975">=</span>&nbsp;<span class="ident" id="6449977">ok</span>&nbsp;<span class="op" id="6449980">&amp;&amp;</span>&nbsp;<span class="op" id="6449983">!</span><span class="ident" id="6449984">out</span><span class="op" id="6449987">.</span><span class="ident" id="6449988">Failed</span><span class="op" id="6449994">(</span><span class="op" id="6449995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6449999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450004">running</span>&nbsp;<span class="op" id="6450012">:=</span>&nbsp;<span class="num" id="6450015">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450019">for</span>&nbsp;<span class="ident" id="6450023">numParallel</span><span class="op" id="6450034">+</span><span class="ident" id="6450035">running</span>&nbsp;<span class="op" id="6450043">&gt;</span>&nbsp;<span class="num" id="6450045">0</span>&nbsp;<span class="op" id="6450047">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450052">if</span>&nbsp;<span class="ident" id="6450055">running</span>&nbsp;<span class="op" id="6450063">&lt;</span>&nbsp;<span class="op" id="6450065">*</span><span class="ident" id="6450066">parallel</span>&nbsp;<span class="op" id="6450075">&amp;&amp;</span>&nbsp;<span class="ident" id="6450078">numParallel</span>&nbsp;<span class="op" id="6450090">&gt;</span>&nbsp;<span class="num" id="6450092">0</span>&nbsp;<span class="op" id="6450094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450100">startParallel</span>&nbsp;<span class="op" id="6450114">&lt;-</span>&nbsp;<span class="builtintype" id="6450117">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450126">running</span><span class="op" id="6450133">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450140">numParallel</span><span class="op" id="6450151">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450158">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450175">t</span>&nbsp;<span class="op" id="6450177">:=</span>&nbsp;<span class="op" id="6450180">(</span><span class="op" id="6450181">&lt;-</span><span class="ident" id="6450183">collector</span><span class="op" id="6450192">)</span><span class="op" id="6450193">.</span><span class="op" id="6450194">(</span><span class="op" id="6450195">*</span><span class="ident" id="6450196">T</span><span class="op" id="6450197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450202">t</span><span class="op" id="6450203">.</span><span class="ident" id="6450204">report</span><span class="op" id="6450210">(</span><span class="op" id="6450211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450216">ok</span>&nbsp;<span class="op" id="6450219">=</span>&nbsp;<span class="ident" id="6450221">ok</span>&nbsp;<span class="op" id="6450224">&amp;&amp;</span>&nbsp;<span class="op" id="6450227">!</span><span class="ident" id="6450228">t</span><span class="op" id="6450229">.</span><span class="ident" id="6450230">Failed</span><span class="op" id="6450236">(</span><span class="op" id="6450237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450242">running</span><span class="op" id="6450249">--</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450260">return</span><br>
<span class="lineno"></span><span class="op" id="6450267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="comment" id="6450270">//&nbsp;before&nbsp;runs&nbsp;before&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6450305">func</span>&nbsp;<span class="ident" id="6450310">before</span><span class="op" id="6450316">(</span><span class="op" id="6450317">)</span>&nbsp;<span class="op" id="6450319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450322">if</span>&nbsp;<span class="op" id="6450325">*</span><span class="ident" id="6450326">memProfileRate</span>&nbsp;<span class="op" id="6450341">&gt;</span>&nbsp;<span class="num" id="6450343">0</span>&nbsp;<span class="op" id="6450345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450349">runtime</span><span class="op" id="6450356">.</span><span class="ident" id="6450357">MemProfileRate</span>&nbsp;<span class="op" id="6450372">=</span>&nbsp;<span class="op" id="6450374">*</span><span class="ident" id="6450375">memProfileRate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450391">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450394">if</span>&nbsp;<span class="op" id="6450397">*</span><span class="ident" id="6450398">cpuProfile</span>&nbsp;<span class="op" id="6450409">!=</span>&nbsp;<span class="string" id="6450412">&#34;&#34;</span>&nbsp;<span class="op" id="6450415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450419">f</span><span class="op" id="6450420">,</span>&nbsp;<span class="ident" id="6450422">err</span>&nbsp;<span class="op" id="6450426">:=</span>&nbsp;<span class="ident" id="6450429">os</span><span class="op" id="6450431">.</span><span class="ident" id="6450432">Create</span><span class="op" id="6450438">(</span><span class="ident" id="6450439">toOutputDir</span><span class="op" id="6450450">(</span><span class="op" id="6450451">*</span><span class="ident" id="6450452">cpuProfile</span><span class="op" id="6450462">)</span><span class="op" id="6450463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450467">if</span>&nbsp;<span class="ident" id="6450470">err</span>&nbsp;<span class="op" id="6450474">!=</span>&nbsp;<span class="ident" id="6450477">nil</span>&nbsp;<span class="op" id="6450481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450486">fmt</span><span class="op" id="6450489">.</span><span class="ident" id="6450490">Fprintf</span><span class="op" id="6450497">(</span><span class="ident" id="6450498">os</span><span class="op" id="6450500">.</span><span class="ident" id="6450501">Stderr</span><span class="op" id="6450507">,</span>&nbsp;<span class="string" id="6450509">&#34;testing:&nbsp;%s&#34;</span><span class="op" id="6450522">,</span>&nbsp;<span class="ident" id="6450524">err</span><span class="op" id="6450527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450532">return</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450545">if</span>&nbsp;<span class="ident" id="6450548">err</span>&nbsp;<span class="op" id="6450552">:=</span>&nbsp;<span class="ident" id="6450555">pprof</span><span class="op" id="6450560">.</span><span class="ident" id="6450561">StartCPUProfile</span><span class="op" id="6450576">(</span><span class="ident" id="6450577">f</span><span class="op" id="6450578">)</span><span class="op" id="6450579">;</span>&nbsp;<span class="ident" id="6450581">err</span>&nbsp;<span class="op" id="6450585">!=</span>&nbsp;<span class="ident" id="6450588">nil</span>&nbsp;<span class="op" id="6450592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450597">fmt</span><span class="op" id="6450600">.</span><span class="ident" id="6450601">Fprintf</span><span class="op" id="6450608">(</span><span class="ident" id="6450609">os</span><span class="op" id="6450611">.</span><span class="ident" id="6450612">Stderr</span><span class="op" id="6450618">,</span>&nbsp;<span class="string" id="6450620">&#34;testing:&nbsp;can&#39;t&nbsp;start&nbsp;cpu&nbsp;profile:&nbsp;%s&#34;</span><span class="op" id="6450658">,</span>&nbsp;<span class="ident" id="6450660">err</span><span class="op" id="6450663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450668">f</span><span class="op" id="6450669">.</span><span class="ident" id="6450670">Close</span><span class="op" id="6450675">(</span><span class="op" id="6450676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450681">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6450694">//&nbsp;Could&nbsp;save&nbsp;f&nbsp;so&nbsp;after&nbsp;can&nbsp;call&nbsp;f.Close;&nbsp;not&nbsp;worth&nbsp;the&nbsp;effort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450763">if</span>&nbsp;<span class="op" id="6450766">*</span><span class="ident" id="6450767">blockProfile</span>&nbsp;<span class="op" id="6450780">!=</span>&nbsp;<span class="string" id="6450783">&#34;&#34;</span>&nbsp;<span class="op" id="6450786">&amp;&amp;</span>&nbsp;<span class="op" id="6450789">*</span><span class="ident" id="6450790">blockProfileRate</span>&nbsp;<span class="op" id="6450807">&gt;=</span>&nbsp;<span class="num" id="6450810">0</span>&nbsp;<span class="op" id="6450812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450816">runtime</span><span class="op" id="6450823">.</span><span class="ident" id="6450824">SetBlockProfileRate</span><span class="op" id="6450843">(</span><span class="op" id="6450844">*</span><span class="ident" id="6450845">blockProfileRate</span><span class="op" id="6450861">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6450864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6450867">if</span>&nbsp;<span class="op" id="6450870">*</span><span class="ident" id="6450871">coverProfile</span>&nbsp;<span class="op" id="6450884">!=</span>&nbsp;<span class="string" id="6450887">&#34;&#34;</span>&nbsp;<span class="op" id="6450890">&amp;&amp;</span>&nbsp;<span class="ident" id="6450893">cover</span><span class="op" id="6450898">.</span><span class="ident" id="6450899">Mode</span>&nbsp;<span class="op" id="6450904">==</span>&nbsp;<span class="string" id="6450907">&#34;&#34;</span>&nbsp;<span class="op" id="6450910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6450914">fmt</span><span class="op" id="6450917">.</span><span class="ident" id="6450918">Fprintf</span><span class="op" id="6450925">(</span><span class="ident" id="6450926">os</span><span class="op" id="6450928">.</span><span class="ident" id="6450929">Stderr</span><span class="op" id="6450935">,</span>&nbsp;<span class="string" id="6450937">&#34;testing:&nbsp;cannot&nbsp;use&nbsp;-test.coverprofile&nbsp;because&nbsp;test&nbsp;binary&nbsp;was&nbsp;not&nbsp;built&nbsp;with&nbsp;coverage&nbsp;enabled\n&#34;</span><span class="op" id="6451035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451039">os</span><span class="op" id="6451041">.</span><span class="ident" id="6451042">Exit</span><span class="op" id="6451046">(</span><span class="num" id="6451047">2</span><span class="op" id="6451048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451051">}</span><br>
<span class="lineno">610</span><span class="op" id="6451053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6451056">//&nbsp;after&nbsp;runs&nbsp;after&nbsp;all&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6451089">func</span>&nbsp;<span class="ident" id="6451094">after</span><span class="op" id="6451099">(</span><span class="op" id="6451100">)</span>&nbsp;<span class="op" id="6451102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451105">if</span>&nbsp;<span class="op" id="6451108">*</span><span class="ident" id="6451109">cpuProfile</span>&nbsp;<span class="op" id="6451120">!=</span>&nbsp;<span class="string" id="6451123">&#34;&#34;</span>&nbsp;<span class="op" id="6451126">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451130">pprof</span><span class="op" id="6451135">.</span><span class="ident" id="6451136">StopCPUProfile</span><span class="op" id="6451150">(</span><span class="op" id="6451151">)</span>&nbsp;<span class="comment" id="6451153">//&nbsp;flushes&nbsp;profile&nbsp;to&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451184">if</span>&nbsp;<span class="op" id="6451187">*</span><span class="ident" id="6451188">memProfile</span>&nbsp;<span class="op" id="6451199">!=</span>&nbsp;<span class="string" id="6451202">&#34;&#34;</span>&nbsp;<span class="op" id="6451205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451209">f</span><span class="op" id="6451210">,</span>&nbsp;<span class="ident" id="6451212">err</span>&nbsp;<span class="op" id="6451216">:=</span>&nbsp;<span class="ident" id="6451219">os</span><span class="op" id="6451221">.</span><span class="ident" id="6451222">Create</span><span class="op" id="6451228">(</span><span class="ident" id="6451229">toOutputDir</span><span class="op" id="6451240">(</span><span class="op" id="6451241">*</span><span class="ident" id="6451242">memProfile</span><span class="op" id="6451252">)</span><span class="op" id="6451253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451257">if</span>&nbsp;<span class="ident" id="6451260">err</span>&nbsp;<span class="op" id="6451264">!=</span>&nbsp;<span class="ident" id="6451267">nil</span>&nbsp;<span class="op" id="6451271">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451276">fmt</span><span class="op" id="6451279">.</span><span class="ident" id="6451280">Fprintf</span><span class="op" id="6451287">(</span><span class="ident" id="6451288">os</span><span class="op" id="6451290">.</span><span class="ident" id="6451291">Stderr</span><span class="op" id="6451297">,</span>&nbsp;<span class="string" id="6451299">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6451314">,</span>&nbsp;<span class="ident" id="6451316">err</span><span class="op" id="6451319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451324">os</span><span class="op" id="6451326">.</span><span class="ident" id="6451327">Exit</span><span class="op" id="6451331">(</span><span class="num" id="6451332">2</span><span class="op" id="6451333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451341">runtime</span><span class="op" id="6451348">.</span><span class="ident" id="6451349">GC</span><span class="op" id="6451351">(</span><span class="op" id="6451352">)</span>&nbsp;<span class="comment" id="6451354">//&nbsp;materialize&nbsp;all&nbsp;statistics</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451386">if</span>&nbsp;<span class="ident" id="6451389">err</span>&nbsp;<span class="op" id="6451393">=</span>&nbsp;<span class="ident" id="6451395">pprof</span><span class="op" id="6451400">.</span><span class="ident" id="6451401">WriteHeapProfile</span><span class="op" id="6451417">(</span><span class="ident" id="6451418">f</span><span class="op" id="6451419">)</span><span class="op" id="6451420">;</span>&nbsp;<span class="ident" id="6451422">err</span>&nbsp;<span class="op" id="6451426">!=</span>&nbsp;<span class="ident" id="6451429">nil</span>&nbsp;<span class="op" id="6451433">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451438">fmt</span><span class="op" id="6451441">.</span><span class="ident" id="6451442">Fprintf</span><span class="op" id="6451449">(</span><span class="ident" id="6451450">os</span><span class="op" id="6451452">.</span><span class="ident" id="6451453">Stderr</span><span class="op" id="6451459">,</span>&nbsp;<span class="string" id="6451461">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6451492">,</span>&nbsp;<span class="op" id="6451494">*</span><span class="ident" id="6451495">memProfile</span><span class="op" id="6451505">,</span>&nbsp;<span class="ident" id="6451507">err</span><span class="op" id="6451510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451515">os</span><span class="op" id="6451517">.</span><span class="ident" id="6451518">Exit</span><span class="op" id="6451522">(</span><span class="num" id="6451523">2</span><span class="op" id="6451524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451532">f</span><span class="op" id="6451533">.</span><span class="ident" id="6451534">Close</span><span class="op" id="6451539">(</span><span class="op" id="6451540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451543">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451546">if</span>&nbsp;<span class="op" id="6451549">*</span><span class="ident" id="6451550">blockProfile</span>&nbsp;<span class="op" id="6451563">!=</span>&nbsp;<span class="string" id="6451566">&#34;&#34;</span>&nbsp;<span class="op" id="6451569">&amp;&amp;</span>&nbsp;<span class="op" id="6451572">*</span><span class="ident" id="6451573">blockProfileRate</span>&nbsp;<span class="op" id="6451590">&gt;=</span>&nbsp;<span class="num" id="6451593">0</span>&nbsp;<span class="op" id="6451595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451599">f</span><span class="op" id="6451600">,</span>&nbsp;<span class="ident" id="6451602">err</span>&nbsp;<span class="op" id="6451606">:=</span>&nbsp;<span class="ident" id="6451609">os</span><span class="op" id="6451611">.</span><span class="ident" id="6451612">Create</span><span class="op" id="6451618">(</span><span class="ident" id="6451619">toOutputDir</span><span class="op" id="6451630">(</span><span class="op" id="6451631">*</span><span class="ident" id="6451632">blockProfile</span><span class="op" id="6451644">)</span><span class="op" id="6451645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451649">if</span>&nbsp;<span class="ident" id="6451652">err</span>&nbsp;<span class="op" id="6451656">!=</span>&nbsp;<span class="ident" id="6451659">nil</span>&nbsp;<span class="op" id="6451663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451668">fmt</span><span class="op" id="6451671">.</span><span class="ident" id="6451672">Fprintf</span><span class="op" id="6451679">(</span><span class="ident" id="6451680">os</span><span class="op" id="6451682">.</span><span class="ident" id="6451683">Stderr</span><span class="op" id="6451689">,</span>&nbsp;<span class="string" id="6451691">&#34;testing:&nbsp;%s\n&#34;</span><span class="op" id="6451706">,</span>&nbsp;<span class="ident" id="6451708">err</span><span class="op" id="6451711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451716">os</span><span class="op" id="6451718">.</span><span class="ident" id="6451719">Exit</span><span class="op" id="6451723">(</span><span class="num" id="6451724">2</span><span class="op" id="6451725">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451733">if</span>&nbsp;<span class="ident" id="6451736">err</span>&nbsp;<span class="op" id="6451740">=</span>&nbsp;<span class="ident" id="6451742">pprof</span><span class="op" id="6451747">.</span><span class="ident" id="6451748">Lookup</span><span class="op" id="6451754">(</span><span class="string" id="6451755">&#34;block&#34;</span><span class="op" id="6451762">)</span><span class="op" id="6451763">.</span><span class="ident" id="6451764">WriteTo</span><span class="op" id="6451771">(</span><span class="ident" id="6451772">f</span><span class="op" id="6451773">,</span>&nbsp;<span class="num" id="6451775">0</span><span class="op" id="6451776">)</span><span class="op" id="6451777">;</span>&nbsp;<span class="ident" id="6451779">err</span>&nbsp;<span class="op" id="6451783">!=</span>&nbsp;<span class="ident" id="6451786">nil</span>&nbsp;<span class="op" id="6451790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451795">fmt</span><span class="op" id="6451798">.</span><span class="ident" id="6451799">Fprintf</span><span class="op" id="6451806">(</span><span class="ident" id="6451807">os</span><span class="op" id="6451809">.</span><span class="ident" id="6451810">Stderr</span><span class="op" id="6451816">,</span>&nbsp;<span class="string" id="6451818">&#34;testing:&nbsp;can&#39;t&nbsp;write&nbsp;%s:&nbsp;%s\n&#34;</span><span class="op" id="6451849">,</span>&nbsp;<span class="op" id="6451851">*</span><span class="ident" id="6451852">blockProfile</span><span class="op" id="6451864">,</span>&nbsp;<span class="ident" id="6451866">err</span><span class="op" id="6451869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451874">os</span><span class="op" id="6451876">.</span><span class="ident" id="6451877">Exit</span><span class="op" id="6451881">(</span><span class="num" id="6451882">2</span><span class="op" id="6451883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451887">}</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451891">f</span><span class="op" id="6451892">.</span><span class="ident" id="6451893">Close</span><span class="op" id="6451898">(</span><span class="op" id="6451899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6451905">if</span>&nbsp;<span class="ident" id="6451908">cover</span><span class="op" id="6451913">.</span><span class="ident" id="6451914">Mode</span>&nbsp;<span class="op" id="6451919">!=</span>&nbsp;<span class="string" id="6451922">&#34;&#34;</span>&nbsp;<span class="op" id="6451925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6451929">coverReport</span><span class="op" id="6451940">(</span><span class="op" id="6451941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6451944">}</span><br>
<span class="lineno">645</span><span class="op" id="6451946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6451949">//&nbsp;toOutputDir&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;relocated,&nbsp;if&nbsp;required,&nbsp;to&nbsp;outputDir.</span><br>
<span class="lineno"></span><span class="comment" id="6452024">//&nbsp;Simple&nbsp;implementation&nbsp;to&nbsp;avoid&nbsp;pulling&nbsp;in&nbsp;path/filepath.</span><br>
<span class="lineno"></span><span class="keyword" id="6452084">func</span>&nbsp;<span class="ident" id="6452089">toOutputDir</span><span class="op" id="6452100">(</span><span class="ident" id="6452101">path</span>&nbsp;<span class="builtintype" id="6452106">string</span><span class="op" id="6452112">)</span>&nbsp;<span class="builtintype" id="6452114">string</span>&nbsp;<span class="op" id="6452121">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452124">if</span>&nbsp;<span class="op" id="6452127">*</span><span class="ident" id="6452128">outputDir</span>&nbsp;<span class="op" id="6452138">==</span>&nbsp;<span class="string" id="6452141">&#34;&#34;</span>&nbsp;<span class="op" id="6452144">||</span>&nbsp;<span class="ident" id="6452147">path</span>&nbsp;<span class="op" id="6452152">==</span>&nbsp;<span class="string" id="6452155">&#34;&#34;</span>&nbsp;<span class="op" id="6452158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452162">return</span>&nbsp;<span class="ident" id="6452169">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6452175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452178">if</span>&nbsp;<span class="ident" id="6452181">runtime</span><span class="op" id="6452188">.</span><span class="ident" id="6452189">GOOS</span>&nbsp;<span class="op" id="6452194">==</span>&nbsp;<span class="string" id="6452197">&#34;windows&#34;</span>&nbsp;<span class="op" id="6452207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452211">//&nbsp;On&nbsp;Windows,&nbsp;it&#39;s&nbsp;clumsy,&nbsp;but&nbsp;we&nbsp;can&nbsp;be&nbsp;almost&nbsp;always&nbsp;correct</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452277">//&nbsp;by&nbsp;just&nbsp;looking&nbsp;for&nbsp;a&nbsp;drive&nbsp;letter&nbsp;and&nbsp;a&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452330">//&nbsp;Absolute&nbsp;paths&nbsp;always&nbsp;have&nbsp;a&nbsp;drive&nbsp;letter&nbsp;(ignoring&nbsp;UNC).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452393">//&nbsp;Problem:&nbsp;if&nbsp;path&nbsp;==&nbsp;&#34;C:A&#34;&nbsp;and&nbsp;outputdir&nbsp;==&nbsp;&#34;C:\Go&#34;&nbsp;it&#39;s&nbsp;unclear</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452462">//&nbsp;what&nbsp;to&nbsp;do,&nbsp;but&nbsp;even&nbsp;then&nbsp;path/filepath&nbsp;doesn&#39;t&nbsp;help.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452521">//&nbsp;TODO:&nbsp;Worth&nbsp;doing&nbsp;better?&nbsp;Probably&nbsp;not,&nbsp;because&nbsp;we&#39;re&nbsp;here&nbsp;only</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452590">//&nbsp;under&nbsp;the&nbsp;management&nbsp;of&nbsp;go&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452628">if</span>&nbsp;<span class="builtinfunc" id="6452631">len</span><span class="op" id="6452634">(</span><span class="ident" id="6452635">path</span><span class="op" id="6452639">)</span>&nbsp;<span class="op" id="6452641">&gt;=</span>&nbsp;<span class="num" id="6452644">2</span>&nbsp;<span class="op" id="6452646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6452651">letter</span><span class="op" id="6452657">,</span>&nbsp;<span class="ident" id="6452659">colon</span>&nbsp;<span class="op" id="6452665">:=</span>&nbsp;<span class="ident" id="6452668">path</span><span class="op" id="6452672">[</span><span class="num" id="6452673">0</span><span class="op" id="6452674">]</span><span class="op" id="6452675">,</span>&nbsp;<span class="ident" id="6452677">path</span><span class="op" id="6452681">[</span><span class="num" id="6452682">1</span><span class="op" id="6452683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452688">if</span>&nbsp;<span class="op" id="6452691">(</span><span class="string" id="6452692">&#39;a&#39;</span>&nbsp;<span class="op" id="6452696">&lt;=</span>&nbsp;<span class="ident" id="6452699">letter</span>&nbsp;<span class="op" id="6452706">&amp;&amp;</span>&nbsp;<span class="ident" id="6452709">letter</span>&nbsp;<span class="op" id="6452716">&lt;=</span>&nbsp;<span class="string" id="6452719">&#39;z&#39;</span>&nbsp;<span class="op" id="6452723">||</span>&nbsp;<span class="string" id="6452726">&#39;A&#39;</span>&nbsp;<span class="op" id="6452730">&lt;=</span>&nbsp;<span class="ident" id="6452733">letter</span>&nbsp;<span class="op" id="6452740">&amp;&amp;</span>&nbsp;<span class="ident" id="6452743">letter</span>&nbsp;<span class="op" id="6452750">&lt;=</span>&nbsp;<span class="string" id="6452753">&#39;Z&#39;</span><span class="op" id="6452756">)</span>&nbsp;<span class="op" id="6452758">&amp;&amp;</span>&nbsp;<span class="ident" id="6452761">colon</span>&nbsp;<span class="op" id="6452767">==</span>&nbsp;<span class="string" id="6452770">&#39;:&#39;</span>&nbsp;<span class="op" id="6452774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6452780">//&nbsp;If&nbsp;path&nbsp;starts&nbsp;with&nbsp;a&nbsp;drive&nbsp;letter&nbsp;we&#39;re&nbsp;stuck&nbsp;with&nbsp;it&nbsp;regardless.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452854">return</span>&nbsp;<span class="ident" id="6452861">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6452869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6452873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6452876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452879">if</span>&nbsp;<span class="ident" id="6452882">os</span><span class="op" id="6452884">.</span><span class="ident" id="6452885">IsPathSeparator</span><span class="op" id="6452900">(</span><span class="ident" id="6452901">path</span><span class="op" id="6452905">[</span><span class="num" id="6452906">0</span><span class="op" id="6452907">]</span><span class="op" id="6452908">)</span>&nbsp;<span class="op" id="6452910">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452914">return</span>&nbsp;<span class="ident" id="6452921">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6452927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6452930">return</span>&nbsp;<span class="ident" id="6452937">fmt</span><span class="op" id="6452940">.</span><span class="ident" id="6452941">Sprintf</span><span class="op" id="6452948">(</span><span class="string" id="6452949">&#34;%s%c%s&#34;</span><span class="op" id="6452957">,</span>&nbsp;<span class="op" id="6452959">*</span><span class="ident" id="6452960">outputDir</span><span class="op" id="6452969">,</span>&nbsp;<span class="ident" id="6452971">os</span><span class="op" id="6452973">.</span><span class="ident" id="6452974">PathSeparator</span><span class="op" id="6452987">,</span>&nbsp;<span class="ident" id="6452989">path</span><span class="op" id="6452993">)</span><br>
<span class="lineno"></span><span class="op" id="6452995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="6452998">var</span>&nbsp;<span class="ident" id="6453002">timer</span>&nbsp;<span class="op" id="6453008">*</span><span class="ident" id="6453009">time</span><span class="op" id="6453013">.</span><span class="ident" id="6453014">Timer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6453021">//&nbsp;startAlarm&nbsp;starts&nbsp;an&nbsp;alarm&nbsp;if&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6453065">func</span>&nbsp;<span class="ident" id="6453070">startAlarm</span><span class="op" id="6453080">(</span><span class="op" id="6453081">)</span>&nbsp;<span class="op" id="6453083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453086">if</span>&nbsp;<span class="op" id="6453089">*</span><span class="ident" id="6453090">timeout</span>&nbsp;<span class="op" id="6453098">&gt;</span>&nbsp;<span class="num" id="6453100">0</span>&nbsp;<span class="op" id="6453102">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453106">timer</span>&nbsp;<span class="op" id="6453112">=</span>&nbsp;<span class="ident" id="6453114">time</span><span class="op" id="6453118">.</span><span class="ident" id="6453119">AfterFunc</span><span class="op" id="6453128">(</span><span class="op" id="6453129">*</span><span class="ident" id="6453130">timeout</span><span class="op" id="6453137">,</span>&nbsp;<span class="keyword" id="6453139">func</span><span class="op" id="6453143">(</span><span class="op" id="6453144">)</span>&nbsp;<span class="op" id="6453146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6453151">panic</span><span class="op" id="6453156">(</span><span class="ident" id="6453157">fmt</span><span class="op" id="6453160">.</span><span class="ident" id="6453161">Sprintf</span><span class="op" id="6453168">(</span><span class="string" id="6453169">&#34;test&nbsp;timed&nbsp;out&nbsp;after&nbsp;%v&#34;</span><span class="op" id="6453194">,</span>&nbsp;<span class="op" id="6453196">*</span><span class="ident" id="6453197">timeout</span><span class="op" id="6453204">)</span><span class="op" id="6453205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453209">}</span><span class="op" id="6453210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453213">}</span><br>
<span class="lineno"></span><span class="op" id="6453215">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="6453218">//&nbsp;stopAlarm&nbsp;turns&nbsp;off&nbsp;the&nbsp;alarm.</span><br>
<span class="lineno"></span><span class="keyword" id="6453252">func</span>&nbsp;<span class="ident" id="6453257">stopAlarm</span><span class="op" id="6453266">(</span><span class="op" id="6453267">)</span>&nbsp;<span class="op" id="6453269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453272">if</span>&nbsp;<span class="op" id="6453275">*</span><span class="ident" id="6453276">timeout</span>&nbsp;<span class="op" id="6453284">&gt;</span>&nbsp;<span class="num" id="6453286">0</span>&nbsp;<span class="op" id="6453288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453292">timer</span><span class="op" id="6453297">.</span><span class="ident" id="6453298">Stop</span><span class="op" id="6453302">(</span><span class="op" id="6453303">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453306">}</span><br>
<span class="lineno"></span><span class="op" id="6453308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6453311">func</span>&nbsp;<span class="ident" id="6453316">parseCpuList</span><span class="op" id="6453328">(</span><span class="op" id="6453329">)</span>&nbsp;<span class="op" id="6453331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453334">for</span>&nbsp;<span class="ident" id="6453338">_</span><span class="op" id="6453339">,</span>&nbsp;<span class="ident" id="6453341">val</span>&nbsp;<span class="op" id="6453345">:=</span>&nbsp;<span class="keyword" id="6453348">range</span>&nbsp;<span class="ident" id="6453354">strings</span><span class="op" id="6453361">.</span><span class="ident" id="6453362">Split</span><span class="op" id="6453367">(</span><span class="op" id="6453368">*</span><span class="ident" id="6453369">cpuListStr</span><span class="op" id="6453379">,</span>&nbsp;<span class="string" id="6453381">&#34;,&#34;</span><span class="op" id="6453384">)</span>&nbsp;<span class="op" id="6453386">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453390">val</span>&nbsp;<span class="op" id="6453394">=</span>&nbsp;<span class="ident" id="6453396">strings</span><span class="op" id="6453403">.</span><span class="ident" id="6453404">TrimSpace</span><span class="op" id="6453413">(</span><span class="ident" id="6453414">val</span><span class="op" id="6453417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453421">if</span>&nbsp;<span class="ident" id="6453424">val</span>&nbsp;<span class="op" id="6453428">==</span>&nbsp;<span class="string" id="6453431">&#34;&#34;</span>&nbsp;<span class="op" id="6453434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453454">cpu</span><span class="op" id="6453457">,</span>&nbsp;<span class="ident" id="6453459">err</span>&nbsp;<span class="op" id="6453463">:=</span>&nbsp;<span class="ident" id="6453466">strconv</span><span class="op" id="6453473">.</span><span class="ident" id="6453474">Atoi</span><span class="op" id="6453478">(</span><span class="ident" id="6453479">val</span><span class="op" id="6453482">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453486">if</span>&nbsp;<span class="ident" id="6453489">err</span>&nbsp;<span class="op" id="6453493">!=</span>&nbsp;<span class="ident" id="6453496">nil</span>&nbsp;<span class="op" id="6453500">||</span>&nbsp;<span class="ident" id="6453503">cpu</span>&nbsp;<span class="op" id="6453507">&lt;=</span>&nbsp;<span class="num" id="6453510">0</span>&nbsp;<span class="op" id="6453512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453517">fmt</span><span class="op" id="6453520">.</span><span class="ident" id="6453521">Fprintf</span><span class="op" id="6453528">(</span><span class="ident" id="6453529">os</span><span class="op" id="6453531">.</span><span class="ident" id="6453532">Stderr</span><span class="op" id="6453538">,</span>&nbsp;<span class="string" id="6453540">&#34;testing:&nbsp;invalid&nbsp;value&nbsp;%q&nbsp;for&nbsp;-test.cpu\n&#34;</span><span class="op" id="6453583">,</span>&nbsp;<span class="ident" id="6453585">val</span><span class="op" id="6453588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453593">os</span><span class="op" id="6453595">.</span><span class="ident" id="6453596">Exit</span><span class="op" id="6453600">(</span><span class="num" id="6453601">1</span><span class="op" id="6453602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453610">cpuList</span>&nbsp;<span class="op" id="6453618">=</span>&nbsp;<span class="builtinfunc" id="6453620">append</span><span class="op" id="6453626">(</span><span class="ident" id="6453627">cpuList</span><span class="op" id="6453634">,</span>&nbsp;<span class="ident" id="6453636">cpu</span><span class="op" id="6453639">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6453645">if</span>&nbsp;<span class="ident" id="6453648">cpuList</span>&nbsp;<span class="op" id="6453656">==</span>&nbsp;<span class="ident" id="6453659">nil</span>&nbsp;<span class="op" id="6453663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6453667">cpuList</span>&nbsp;<span class="op" id="6453675">=</span>&nbsp;<span class="builtinfunc" id="6453677">append</span><span class="op" id="6453683">(</span><span class="ident" id="6453684">cpuList</span><span class="op" id="6453691">,</span>&nbsp;<span class="ident" id="6453693">runtime</span><span class="op" id="6453700">.</span><span class="ident" id="6453701">GOMAXPROCS</span><span class="op" id="6453711">(</span><span class="op" id="6453712">-</span><span class="num" id="6453713">1</span><span class="op" id="6453714">)</span><span class="op" id="6453715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6453718">}</span><br>
<span class="lineno"></span><span class="op" id="6453720">}</span>
</div>
</body>
</html>
