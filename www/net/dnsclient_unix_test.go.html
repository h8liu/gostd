<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6790654">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6790709">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6790763">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6790814">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6790879">package</span>&nbsp;<span class="ident" id="6790887">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6790892">import</span>&nbsp;<span class="op" id="6790899">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790902">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790908">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790921">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790927">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790935">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790946">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6790957">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6790964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6790967">var</span>&nbsp;<span class="ident" id="6790971">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6790997">=</span>&nbsp;<span class="op" id="6790999">[</span><span class="op" id="6791000">]</span><span class="keyword" id="6791001">struct</span>&nbsp;<span class="op" id="6791008">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791011">server</span>&nbsp;&nbsp;<span class="builtintype" id="6791019">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791027">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6791035">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791043">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6791051">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791059">timeout</span>&nbsp;<span class="builtintype" id="6791067">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791072">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6791080">int</span><br>
<span class="lineno">25</span><span class="op" id="6791084">}</span><span class="op" id="6791085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6791088">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6791147">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791187">{</span><span class="string" id="6791188">&#34;8.8.8.8:53&#34;</span><span class="op" id="6791200">,</span>&nbsp;<span class="string" id="6791202">&#34;com.&#34;</span><span class="op" id="6791208">,</span>&nbsp;<span class="ident" id="6791210"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6791220">,</span>&nbsp;<span class="num" id="6791222">2</span><span class="op" id="6791223">,</span>&nbsp;<span class="ident" id="6791225"><a href="/net/dnsmsg.go.html#2547442">dnsRcodeSuccess</a></span><span class="op" id="6791240">}</span><span class="op" id="6791241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791244">{</span><span class="string" id="6791245">&#34;8.8.4.4:53&#34;</span><span class="op" id="6791257">,</span>&nbsp;<span class="string" id="6791259">&#34;com.&#34;</span><span class="op" id="6791265">,</span>&nbsp;<span class="ident" id="6791267"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6791277">,</span>&nbsp;<span class="num" id="6791279">4</span><span class="op" id="6791280">,</span>&nbsp;<span class="ident" id="6791282"><a href="/net/dnsmsg.go.html#2547442">dnsRcodeSuccess</a></span><span class="op" id="6791297">}</span><span class="op" id="6791298">,</span><br>
<span class="lineno">30</span><span class="op" id="6791300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6791303">func</span>&nbsp;<span class="ident" id="6791308">TestDNSTransportFallback</span><span class="op" id="6791332">(</span><span class="ident" id="6791333">t</span>&nbsp;<span class="op" id="6791335">*</span><span class="ident" id="6791336"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6791343">.</span><span class="ident" id="6791344">T</span><span class="op" id="6791345">)</span>&nbsp;<span class="op" id="6791347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791350">if</span>&nbsp;<span class="ident" id="6791353"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6791360">.</span><span class="ident" id="6791361">Short</span><span class="op" id="6791366">(</span><span class="op" id="6791367">)</span>&nbsp;<span class="op" id="6791369">||</span>&nbsp;<span class="op" id="6791372">!</span><span class="op" id="6791373">*</span><span class="ident" id="6791374"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6791387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791391"><a href="/net/dnsclient_unix_test.go.html#6791333">t</a></span><span class="op" id="6791392">.</span><span class="ident" id="6791393">Skip</span><span class="op" id="6791397">(</span><span class="string" id="6791398">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6791439">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791446">for</span>&nbsp;<span class="ident" id="6791450">_</span><span class="op" id="6791451">,</span>&nbsp;<span class="ident" id="6791453">tt</span>&nbsp;<span class="op" id="6791456">:=</span>&nbsp;<span class="keyword" id="6791459">range</span>&nbsp;<span class="ident" id="6791465"><a href="/net/dnsclient_unix_test.go.html#6790971">dnsTransportFallbackTests</a></span>&nbsp;<span class="op" id="6791491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791495">timeout</span>&nbsp;<span class="op" id="6791503">:=</span>&nbsp;<span class="ident" id="6791506"><a href="/net/dnsclient_unix_test.go.html#6790957">time</a></span><span class="op" id="6791510">.</span><span class="ident" id="6791511">Duration</span><span class="op" id="6791519">(</span><span class="ident" id="6791520"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791522">.</span><span class="ident" id="6791523">timeout</span><span class="op" id="6791530">)</span>&nbsp;<span class="op" id="6791532">*</span>&nbsp;<span class="ident" id="6791534"><a href="/net/dnsclient_unix_test.go.html#6790957">time</a></span><span class="op" id="6791538">.</span><span class="ident" id="6791539">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791548">msg</span><span class="op" id="6791551">,</span>&nbsp;<span class="ident" id="6791553">err</span>&nbsp;<span class="op" id="6791557">:=</span>&nbsp;<span class="ident" id="6791560"><a href="/net/dnsclient_unix.go.html#2535627">exchange</a></span><span class="op" id="6791568">(</span><span class="ident" id="6791569"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791571">.</span><span class="ident" id="6791572">server</span><span class="op" id="6791578">,</span>&nbsp;<span class="ident" id="6791580"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791582">.</span><span class="ident" id="6791583">name</span><span class="op" id="6791587">,</span>&nbsp;<span class="ident" id="6791589"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791591">.</span><span class="ident" id="6791592">qtype</span><span class="op" id="6791597">,</span>&nbsp;<span class="ident" id="6791599"><a href="/net/dnsclient_unix_test.go.html#6791495">timeout</a></span><span class="op" id="6791606">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791610">if</span>&nbsp;<span class="ident" id="6791613"><a href="/net/dnsclient_unix_test.go.html#6791553">err</a></span>&nbsp;<span class="op" id="6791617">!=</span>&nbsp;<span class="ident" id="6791620">nil</span>&nbsp;<span class="op" id="6791624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791629"><a href="/net/dnsclient_unix_test.go.html#6791333">t</a></span><span class="op" id="6791630">.</span><span class="ident" id="6791631">Error</span><span class="op" id="6791636">(</span><span class="ident" id="6791637"><a href="/net/dnsclient_unix_test.go.html#6791553">err</a></span><span class="op" id="6791640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791645">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791660">switch</span>&nbsp;<span class="ident" id="6791667"><a href="/net/dnsclient_unix_test.go.html#6791548">msg</a></span><span class="op" id="6791670">.</span><span class="ident" id="6791671">rcode</span>&nbsp;<span class="op" id="6791677">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791681">case</span>&nbsp;<span class="ident" id="6791686"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791688">.</span><span class="ident" id="6791689">rcode</span><span class="op" id="6791694">,</span>&nbsp;<span class="ident" id="6791696"><a href="/net/dnsmsg.go.html#2547498">dnsRcodeServerFailure</a></span><span class="op" id="6791717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791721">default</span><span class="op" id="6791728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791733"><a href="/net/dnsclient_unix_test.go.html#6791333">t</a></span><span class="op" id="6791734">.</span><span class="ident" id="6791735">Errorf</span><span class="op" id="6791741">(</span><span class="string" id="6791742">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6791767">,</span>&nbsp;<span class="ident" id="6791769"><a href="/net/dnsclient_unix_test.go.html#6791548">msg</a></span><span class="op" id="6791772">.</span><span class="ident" id="6791773">rcode</span><span class="op" id="6791778">,</span>&nbsp;<span class="ident" id="6791780"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791782">.</span><span class="ident" id="6791783">server</span><span class="op" id="6791789">,</span>&nbsp;<span class="ident" id="6791791"><a href="/net/dnsclient_unix_test.go.html#6791453">tt</a></span><span class="op" id="6791793">.</span><span class="ident" id="6791794">rcode</span><span class="op" id="6791799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791804">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791815">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791818">}</span><br>
<span class="lineno"></span><span class="op" id="6791820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6791823">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="6791890">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="6791907">var</span>&nbsp;<span class="ident" id="6791911">specialDomainNameTests</span>&nbsp;<span class="op" id="6791934">=</span>&nbsp;<span class="op" id="6791936">[</span><span class="op" id="6791937">]</span><span class="keyword" id="6791938">struct</span>&nbsp;<span class="op" id="6791945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791948">name</span>&nbsp;&nbsp;<span class="builtintype" id="6791954">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791962">qtype</span>&nbsp;<span class="builtintype" id="6791968">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791976">rcode</span>&nbsp;<span class="builtintype" id="6791982">int</span><br>
<span class="lineno"></span><span class="op" id="6791986">}</span><span class="op" id="6791987">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6791990">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792054">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792081">{</span><span class="string" id="6792082">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="6792109">,</span>&nbsp;<span class="ident" id="6792111"><a href="/net/dnsmsg.go.html#2547045">dnsTypePTR</a></span><span class="op" id="6792121">,</span>&nbsp;<span class="ident" id="6792123"><a href="/net/dnsmsg.go.html#2547526">dnsRcodeNameError</a></span><span class="op" id="6792140">}</span><span class="op" id="6792141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792144">{</span><span class="string" id="6792145">&#34;test.&#34;</span><span class="op" id="6792152">,</span>&nbsp;<span class="ident" id="6792154"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6792164">,</span>&nbsp;<span class="ident" id="6792166"><a href="/net/dnsmsg.go.html#2547526">dnsRcodeNameError</a></span><span class="op" id="6792183">}</span><span class="op" id="6792184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792187">{</span><span class="string" id="6792188">&#34;example.com.&#34;</span><span class="op" id="6792202">,</span>&nbsp;<span class="ident" id="6792204"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6792214">,</span>&nbsp;<span class="ident" id="6792216"><a href="/net/dnsmsg.go.html#2547442">dnsRcodeSuccess</a></span><span class="op" id="6792231">}</span><span class="op" id="6792232">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792236">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792296">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792355">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792415">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792468">{</span><span class="string" id="6792469">&#34;localhost.&#34;</span><span class="op" id="6792481">,</span>&nbsp;<span class="ident" id="6792483"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6792493">,</span>&nbsp;<span class="ident" id="6792495"><a href="/net/dnsmsg.go.html#2547526">dnsRcodeNameError</a></span><span class="op" id="6792512">}</span><span class="op" id="6792513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792516">{</span><span class="string" id="6792517">&#34;invalid.&#34;</span><span class="op" id="6792527">,</span>&nbsp;<span class="ident" id="6792529"><a href="/net/dnsmsg.go.html#2547272">dnsTypeALL</a></span><span class="op" id="6792539">,</span>&nbsp;<span class="ident" id="6792541"><a href="/net/dnsmsg.go.html#2547526">dnsRcodeNameError</a></span><span class="op" id="6792558">}</span><span class="op" id="6792559">,</span><br>
<span class="lineno"></span><span class="op" id="6792561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6792564">func</span>&nbsp;<span class="ident" id="6792569">TestSpecialDomainName</span><span class="op" id="6792590">(</span><span class="ident" id="6792591">t</span>&nbsp;<span class="op" id="6792593">*</span><span class="ident" id="6792594"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6792601">.</span><span class="ident" id="6792602">T</span><span class="op" id="6792603">)</span>&nbsp;<span class="op" id="6792605">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792608">if</span>&nbsp;<span class="ident" id="6792611"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6792618">.</span><span class="ident" id="6792619">Short</span><span class="op" id="6792624">(</span><span class="op" id="6792625">)</span>&nbsp;<span class="op" id="6792627">||</span>&nbsp;<span class="op" id="6792630">!</span><span class="op" id="6792631">*</span><span class="ident" id="6792632"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6792645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792649"><a href="/net/dnsclient_unix_test.go.html#6792591">t</a></span><span class="op" id="6792650">.</span><span class="ident" id="6792651">Skip</span><span class="op" id="6792655">(</span><span class="string" id="6792656">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6792697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792704">server</span>&nbsp;<span class="op" id="6792711">:=</span>&nbsp;<span class="string" id="6792714">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792728">for</span>&nbsp;<span class="ident" id="6792732">_</span><span class="op" id="6792733">,</span>&nbsp;<span class="ident" id="6792735">tt</span>&nbsp;<span class="op" id="6792738">:=</span>&nbsp;<span class="keyword" id="6792741">range</span>&nbsp;<span class="ident" id="6792747"><a href="/net/dnsclient_unix_test.go.html#6791911">specialDomainNameTests</a></span>&nbsp;<span class="op" id="6792770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792774">msg</span><span class="op" id="6792777">,</span>&nbsp;<span class="ident" id="6792779">err</span>&nbsp;<span class="op" id="6792783">:=</span>&nbsp;<span class="ident" id="6792786"><a href="/net/dnsclient_unix.go.html#2535627">exchange</a></span><span class="op" id="6792794">(</span><span class="ident" id="6792795"><a href="/net/dnsclient_unix_test.go.html#6792704">server</a></span><span class="op" id="6792801">,</span>&nbsp;<span class="ident" id="6792803"><a href="/net/dnsclient_unix_test.go.html#6792735">tt</a></span><span class="op" id="6792805">.</span><span class="ident" id="6792806">name</span><span class="op" id="6792810">,</span>&nbsp;<span class="ident" id="6792812"><a href="/net/dnsclient_unix_test.go.html#6792735">tt</a></span><span class="op" id="6792814">.</span><span class="ident" id="6792815">qtype</span><span class="op" id="6792820">,</span>&nbsp;<span class="num" id="6792822">0</span><span class="op" id="6792823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792827">if</span>&nbsp;<span class="ident" id="6792830"><a href="/net/dnsclient_unix_test.go.html#6792779">err</a></span>&nbsp;<span class="op" id="6792834">!=</span>&nbsp;<span class="ident" id="6792837">nil</span>&nbsp;<span class="op" id="6792841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792846"><a href="/net/dnsclient_unix_test.go.html#6792591">t</a></span><span class="op" id="6792847">.</span><span class="ident" id="6792848">Error</span><span class="op" id="6792853">(</span><span class="ident" id="6792854"><a href="/net/dnsclient_unix_test.go.html#6792779">err</a></span><span class="op" id="6792857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792862">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792877">switch</span>&nbsp;<span class="ident" id="6792884"><a href="/net/dnsclient_unix_test.go.html#6792774">msg</a></span><span class="op" id="6792887">.</span><span class="ident" id="6792888">rcode</span>&nbsp;<span class="op" id="6792894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792898">case</span>&nbsp;<span class="ident" id="6792903"><a href="/net/dnsclient_unix_test.go.html#6792735">tt</a></span><span class="op" id="6792905">.</span><span class="ident" id="6792906">rcode</span><span class="op" id="6792911">,</span>&nbsp;<span class="ident" id="6792913"><a href="/net/dnsmsg.go.html#2547498">dnsRcodeServerFailure</a></span><span class="op" id="6792934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792938">default</span><span class="op" id="6792945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792950"><a href="/net/dnsclient_unix_test.go.html#6792591">t</a></span><span class="op" id="6792951">.</span><span class="ident" id="6792952">Errorf</span><span class="op" id="6792958">(</span><span class="string" id="6792959">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6792984">,</span>&nbsp;<span class="ident" id="6792986"><a href="/net/dnsclient_unix_test.go.html#6792774">msg</a></span><span class="op" id="6792989">.</span><span class="ident" id="6792990">rcode</span><span class="op" id="6792995">,</span>&nbsp;<span class="ident" id="6792997"><a href="/net/dnsclient_unix_test.go.html#6792704">server</a></span><span class="op" id="6793003">,</span>&nbsp;<span class="ident" id="6793005"><a href="/net/dnsclient_unix_test.go.html#6792735">tt</a></span><span class="op" id="6793007">.</span><span class="ident" id="6793008">rcode</span><span class="op" id="6793013">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6793018">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793032">}</span><br>
<span class="lineno"></span><span class="op" id="6793034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6793037">type</span>&nbsp;<span class="ident" id="6793042">resolvConfTest</span>&nbsp;<span class="keyword" id="6793057">struct</span>&nbsp;<span class="op" id="6793064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793067">*</span><span class="ident" id="6793068"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6793075">.</span><span class="ident" id="6793076">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793079">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6793087">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793095">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6793103">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793111">started</span>&nbsp;<span class="builtintype" id="6793119">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793125">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793133">chan</span>&nbsp;<span class="keyword" id="6793138">chan</span>&nbsp;<span class="keyword" id="6793143">struct</span><span class="op" id="6793149">{</span><span class="op" id="6793150">}</span><br>
<span class="lineno"></span><span class="op" id="6793152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6793155">func</span>&nbsp;<span class="ident" id="6793160">newResolvConfTest</span><span class="op" id="6793177">(</span><span class="ident" id="6793178">t</span>&nbsp;<span class="op" id="6793180">*</span><span class="ident" id="6793181"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6793188">.</span><span class="ident" id="6793189">T</span><span class="op" id="6793190">)</span>&nbsp;<span class="op" id="6793192">*</span><span class="ident" id="6793193"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span>&nbsp;<span class="op" id="6793208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793211">dir</span><span class="op" id="6793214">,</span>&nbsp;<span class="ident" id="6793216">err</span>&nbsp;<span class="op" id="6793220">:=</span>&nbsp;<span class="ident" id="6793223"><a href="/net/dnsclient_unix_test.go.html#6790908">ioutil</a></span><span class="op" id="6793229">.</span><span class="ident" id="6793230">TempDir</span><span class="op" id="6793237">(</span><span class="string" id="6793238">&#34;&#34;</span><span class="op" id="6793240">,</span>&nbsp;<span class="string" id="6793242">&#34;resolvConfTest&#34;</span><span class="op" id="6793258">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6793261">if</span>&nbsp;<span class="ident" id="6793264"><a href="/net/dnsclient_unix_test.go.html#6793216">err</a></span>&nbsp;<span class="op" id="6793268">!=</span>&nbsp;<span class="ident" id="6793271">nil</span>&nbsp;<span class="op" id="6793275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793279"><a href="/net/dnsclient_unix_test.go.html#6793178">t</a></span><span class="op" id="6793280">.</span><span class="ident" id="6793281">Fatalf</span><span class="op" id="6793287">(</span><span class="string" id="6793288">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="6793319">,</span>&nbsp;<span class="ident" id="6793321"><a href="/net/dnsclient_unix_test.go.html#6793216">err</a></span><span class="op" id="6793324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6793331">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793366"><a href="/net/dnsclient_unix.go.html#2538128">onceLoadConfig</a></span><span class="op" id="6793380">.</span><span class="ident" id="6793381">Do</span><span class="op" id="6793383">(</span><span class="keyword" id="6793384">func</span><span class="op" id="6793388">(</span><span class="op" id="6793389">)</span>&nbsp;<span class="op" id="6793391">{</span><span class="op" id="6793392">}</span><span class="op" id="6793393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793397">r</span>&nbsp;<span class="op" id="6793399">:=</span>&nbsp;<span class="op" id="6793402">&amp;</span><span class="ident" id="6793403"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span><span class="op" id="6793417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793421">T</span><span class="op" id="6793422">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793428"><a href="/net/dnsclient_unix_test.go.html#6793178">t</a></span><span class="op" id="6793429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793433">dir</span><span class="op" id="6793436">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6793440"><a href="/net/dnsclient_unix_test.go.html#6793211">dir</a></span><span class="op" id="6793443">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793447">path</span><span class="op" id="6793451">:</span>&nbsp;&nbsp;<span class="ident" id="6793454"><a href="/net/dnsclient_unix_test.go.html#6790927">path</a></span><span class="op" id="6793458">.</span><span class="ident" id="6793459">Join</span><span class="op" id="6793463">(</span><span class="ident" id="6793464"><a href="/net/dnsclient_unix_test.go.html#6793211">dir</a></span><span class="op" id="6793467">,</span>&nbsp;<span class="string" id="6793469">&#34;resolv.conf&#34;</span><span class="op" id="6793482">)</span><span class="op" id="6793483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793487">quitc</span><span class="op" id="6793492">:</span>&nbsp;<span class="builtinfunc" id="6793494">make</span><span class="op" id="6793498">(</span><span class="keyword" id="6793499">chan</span>&nbsp;<span class="keyword" id="6793504">chan</span>&nbsp;<span class="keyword" id="6793509">struct</span><span class="op" id="6793515">{</span><span class="op" id="6793516">}</span><span class="op" id="6793517">)</span><span class="op" id="6793518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6793525">return</span>&nbsp;<span class="ident" id="6793532"><a href="/net/dnsclient_unix_test.go.html#6793397">r</a></span><br>
<span class="lineno">120</span><span class="op" id="6793534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6793537">func</span>&nbsp;<span class="op" id="6793542">(</span><span class="ident" id="6793543">r</span>&nbsp;<span class="op" id="6793545">*</span><span class="ident" id="6793546"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span><span class="op" id="6793560">)</span>&nbsp;<span class="ident" id="6793562">Start</span><span class="op" id="6793567">(</span><span class="op" id="6793568">)</span>&nbsp;<span class="op" id="6793570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793573"><a href="/net/dnsclient_unix.go.html#2538292">loadConfig</a></span><span class="op" id="6793583">(</span><span class="ident" id="6793584"><a href="/net/dnsclient_unix_test.go.html#6793543">r</a></span><span class="op" id="6793585">.</span><span class="ident" id="6793586">path</span><span class="op" id="6793590">,</span>&nbsp;<span class="num" id="6793592">100</span><span class="op" id="6793595">*</span><span class="ident" id="6793596"><a href="/net/dnsclient_unix_test.go.html#6790957">time</a></span><span class="op" id="6793600">.</span><span class="ident" id="6793601">Millisecond</span><span class="op" id="6793612">,</span>&nbsp;<span class="ident" id="6793614"><a href="/net/dnsclient_unix_test.go.html#6793543">r</a></span><span class="op" id="6793615">.</span><span class="ident" id="6793616">quitc</span><span class="op" id="6793621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793624"><a href="/net/dnsclient_unix_test.go.html#6793543">r</a></span><span class="op" id="6793625">.</span><span class="ident" id="6793626">started</span>&nbsp;<span class="op" id="6793634">=</span>&nbsp;<span class="ident" id="6793636">true</span><br>
<span class="lineno">125</span><span class="op" id="6793641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6793644">func</span>&nbsp;<span class="op" id="6793649">(</span><span class="ident" id="6793650">r</span>&nbsp;<span class="op" id="6793652">*</span><span class="ident" id="6793653"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span><span class="op" id="6793667">)</span>&nbsp;<span class="ident" id="6793669">SetConf</span><span class="op" id="6793676">(</span><span class="ident" id="6793677">s</span>&nbsp;<span class="builtintype" id="6793679">string</span><span class="op" id="6793685">)</span>&nbsp;<span class="op" id="6793687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6793690">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6793759">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793814"><a href="/net/dnsclient_unix_test.go.html#6790957">time</a></span><span class="op" id="6793818">.</span><span class="ident" id="6793819">Sleep</span><span class="op" id="6793824">(</span><span class="ident" id="6793825"><a href="/net/dnsclient_unix_test.go.html#6790957">time</a></span><span class="op" id="6793829">.</span><span class="ident" id="6793830">Second</span><span class="op" id="6793836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793840">f</span><span class="op" id="6793841">,</span>&nbsp;<span class="ident" id="6793843">err</span>&nbsp;<span class="op" id="6793847">:=</span>&nbsp;<span class="ident" id="6793850"><a href="/net/dnsclient_unix_test.go.html#6790921">os</a></span><span class="op" id="6793852">.</span><span class="ident" id="6793853">OpenFile</span><span class="op" id="6793861">(</span><span class="ident" id="6793862"><a href="/net/dnsclient_unix_test.go.html#6793650">r</a></span><span class="op" id="6793863">.</span><span class="ident" id="6793864">path</span><span class="op" id="6793868">,</span>&nbsp;<span class="ident" id="6793870"><a href="/net/dnsclient_unix_test.go.html#6790921">os</a></span><span class="op" id="6793872">.</span><span class="ident" id="6793873">O_CREATE</span><span class="op" id="6793881">|</span><span class="ident" id="6793882"><a href="/net/dnsclient_unix_test.go.html#6790921">os</a></span><span class="op" id="6793884">.</span><span class="ident" id="6793885">O_TRUNC</span><span class="op" id="6793892">|</span><span class="ident" id="6793893"><a href="/net/dnsclient_unix_test.go.html#6790921">os</a></span><span class="op" id="6793895">.</span><span class="ident" id="6793896">O_WRONLY</span><span class="op" id="6793904">,</span>&nbsp;<span class="num" id="6793906">0600</span><span class="op" id="6793910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6793913">if</span>&nbsp;<span class="ident" id="6793916"><a href="/net/dnsclient_unix_test.go.html#6793843">err</a></span>&nbsp;<span class="op" id="6793920">!=</span>&nbsp;<span class="ident" id="6793923">nil</span>&nbsp;<span class="op" id="6793927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6793931"><a href="/net/dnsclient_unix_test.go.html#6793650">r</a></span><span class="op" id="6793932">.</span><span class="ident" id="6793933">Fatalf</span><span class="op" id="6793939">(</span><span class="string" id="6793940">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6793975">,</span>&nbsp;<span class="ident" id="6793977"><a href="/net/dnsclient_unix_test.go.html#6793650">r</a></span><span class="op" id="6793978">.</span><span class="ident" id="6793979">path</span><span class="op" id="6793983">,</span>&nbsp;<span class="ident" id="6793985"><a href="/net/dnsclient_unix_test.go.html#6793843">err</a></span><span class="op" id="6793988">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6793991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6793994">if</span>&nbsp;<span class="ident" id="6793997">_</span><span class="op" id="6793998">,</span>&nbsp;<span class="ident" id="6794000">err</span>&nbsp;<span class="op" id="6794004">:=</span>&nbsp;<span class="ident" id="6794007"><a href="/net/dnsclient_unix_test.go.html#6790902">io</a></span><span class="op" id="6794009">.</span><span class="ident" id="6794010">WriteString</span><span class="op" id="6794021">(</span><span class="ident" id="6794022"><a href="/net/dnsclient_unix_test.go.html#6793840">f</a></span><span class="op" id="6794023">,</span>&nbsp;<span class="ident" id="6794025"><a href="/net/dnsclient_unix_test.go.html#6793677">s</a></span><span class="op" id="6794026">)</span><span class="op" id="6794027">;</span>&nbsp;<span class="ident" id="6794029"><a href="/net/dnsclient_unix_test.go.html#6794000">err</a></span>&nbsp;<span class="op" id="6794033">!=</span>&nbsp;<span class="ident" id="6794036">nil</span>&nbsp;<span class="op" id="6794040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794044"><a href="/net/dnsclient_unix_test.go.html#6793840">f</a></span><span class="op" id="6794045">.</span><span class="ident" id="6794046">Close</span><span class="op" id="6794051">(</span><span class="op" id="6794052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794056"><a href="/net/dnsclient_unix_test.go.html#6793650">r</a></span><span class="op" id="6794057">.</span><span class="ident" id="6794058">Fatalf</span><span class="op" id="6794064">(</span><span class="string" id="6794065">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="6794096">,</span>&nbsp;<span class="ident" id="6794098"><a href="/net/dnsclient_unix_test.go.html#6794000">err</a></span><span class="op" id="6794101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794104">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794107"><a href="/net/dnsclient_unix_test.go.html#6793840">f</a></span><span class="op" id="6794108">.</span><span class="ident" id="6794109">Close</span><span class="op" id="6794114">(</span><span class="op" id="6794115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794119">if</span>&nbsp;<span class="ident" id="6794122"><a href="/net/dnsclient_unix_test.go.html#6793650">r</a></span><span class="op" id="6794123">.</span><span class="ident" id="6794124">started</span>&nbsp;<span class="op" id="6794132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794136"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794139">.</span><span class="ident" id="6794140">ch</span>&nbsp;<span class="op" id="6794143">&lt;-</span>&nbsp;<span class="keyword" id="6794146">struct</span><span class="op" id="6794152">{</span><span class="op" id="6794153">}</span><span class="op" id="6794154">{</span><span class="op" id="6794155">}</span>&nbsp;<span class="comment" id="6794157">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794174"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794177">.</span><span class="ident" id="6794178">ch</span>&nbsp;<span class="op" id="6794181">&lt;-</span>&nbsp;<span class="keyword" id="6794184">struct</span><span class="op" id="6794190">{</span><span class="op" id="6794191">}</span><span class="op" id="6794192">{</span><span class="op" id="6794193">}</span>&nbsp;<span class="comment" id="6794195">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794225"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794228">.</span><span class="ident" id="6794229">ch</span>&nbsp;<span class="op" id="6794232">&lt;-</span>&nbsp;<span class="keyword" id="6794235">struct</span><span class="op" id="6794241">{</span><span class="op" id="6794242">}</span><span class="op" id="6794243">{</span><span class="op" id="6794244">}</span>&nbsp;<span class="comment" id="6794246">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794278">}</span><br>
<span class="lineno"></span><span class="op" id="6794280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6794283">func</span>&nbsp;<span class="op" id="6794288">(</span><span class="ident" id="6794289">r</span>&nbsp;<span class="op" id="6794291">*</span><span class="ident" id="6794292"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span><span class="op" id="6794306">)</span>&nbsp;<span class="ident" id="6794308">WantServers</span><span class="op" id="6794319">(</span><span class="ident" id="6794320">want</span>&nbsp;<span class="op" id="6794325">[</span><span class="op" id="6794326">]</span><span class="builtintype" id="6794327">string</span><span class="op" id="6794333">)</span>&nbsp;<span class="op" id="6794335">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794338"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794341">.</span><span class="ident" id="6794342">mu</span><span class="op" id="6794344">.</span><span class="ident" id="6794345">RLock</span><span class="op" id="6794350">(</span><span class="op" id="6794351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794354">defer</span>&nbsp;<span class="ident" id="6794360"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794363">.</span><span class="ident" id="6794364">mu</span><span class="op" id="6794366">.</span><span class="ident" id="6794367">RUnlock</span><span class="op" id="6794374">(</span><span class="op" id="6794375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794378">if</span>&nbsp;<span class="ident" id="6794381">got</span>&nbsp;<span class="op" id="6794385">:=</span>&nbsp;<span class="ident" id="6794388"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6794391">.</span><span class="ident" id="6794392">dnsConfig</span><span class="op" id="6794401">.</span><span class="ident" id="6794402">servers</span><span class="op" id="6794409">;</span>&nbsp;<span class="op" id="6794411">!</span><span class="ident" id="6794412"><a href="/net/dnsclient_unix_test.go.html#6790935">reflect</a></span><span class="op" id="6794419">.</span><span class="ident" id="6794420">DeepEqual</span><span class="op" id="6794429">(</span><span class="ident" id="6794430"><a href="/net/dnsclient_unix_test.go.html#6794381">got</a></span><span class="op" id="6794433">,</span>&nbsp;<span class="ident" id="6794435"><a href="/net/dnsclient_unix_test.go.html#6794320">want</a></span><span class="op" id="6794439">)</span>&nbsp;<span class="op" id="6794441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794445"><a href="/net/dnsclient_unix_test.go.html#6794289">r</a></span><span class="op" id="6794446">.</span><span class="ident" id="6794447">Fatalf</span><span class="op" id="6794453">(</span><span class="string" id="6794454">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6794500">,</span>&nbsp;<span class="ident" id="6794502"><a href="/net/dnsclient_unix_test.go.html#6794381">got</a></span><span class="op" id="6794505">,</span>&nbsp;<span class="ident" id="6794507"><a href="/net/dnsclient_unix_test.go.html#6794320">want</a></span><span class="op" id="6794511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794514">}</span><br>
<span class="lineno">155</span><span class="op" id="6794516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6794519">func</span>&nbsp;<span class="op" id="6794524">(</span><span class="ident" id="6794525">r</span>&nbsp;<span class="op" id="6794527">*</span><span class="ident" id="6794528"><a href="/net/dnsclient_unix_test.go.html#6793042">resolvConfTest</a></span><span class="op" id="6794542">)</span>&nbsp;<span class="ident" id="6794544">Close</span><span class="op" id="6794549">(</span><span class="op" id="6794550">)</span>&nbsp;<span class="op" id="6794552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794555">resp</span>&nbsp;<span class="op" id="6794560">:=</span>&nbsp;<span class="builtinfunc" id="6794563">make</span><span class="op" id="6794567">(</span><span class="keyword" id="6794568">chan</span>&nbsp;<span class="keyword" id="6794573">struct</span><span class="op" id="6794579">{</span><span class="op" id="6794580">}</span><span class="op" id="6794581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794584"><a href="/net/dnsclient_unix_test.go.html#6794525">r</a></span><span class="op" id="6794585">.</span><span class="ident" id="6794586">quitc</span>&nbsp;<span class="op" id="6794592">&lt;-</span>&nbsp;<span class="ident" id="6794595"><a href="/net/dnsclient_unix_test.go.html#6794555">resp</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794601">&lt;-</span><span class="ident" id="6794603"><a href="/net/dnsclient_unix_test.go.html#6794555">resp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794609">if</span>&nbsp;<span class="ident" id="6794612">err</span>&nbsp;<span class="op" id="6794616">:=</span>&nbsp;<span class="ident" id="6794619"><a href="/net/dnsclient_unix_test.go.html#6790921">os</a></span><span class="op" id="6794621">.</span><span class="ident" id="6794622">RemoveAll</span><span class="op" id="6794631">(</span><span class="ident" id="6794632"><a href="/net/dnsclient_unix_test.go.html#6794525">r</a></span><span class="op" id="6794633">.</span><span class="ident" id="6794634">dir</span><span class="op" id="6794637">)</span><span class="op" id="6794638">;</span>&nbsp;<span class="ident" id="6794640"><a href="/net/dnsclient_unix_test.go.html#6794612">err</a></span>&nbsp;<span class="op" id="6794644">!=</span>&nbsp;<span class="ident" id="6794647">nil</span>&nbsp;<span class="op" id="6794651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794655"><a href="/net/dnsclient_unix_test.go.html#6794525">r</a></span><span class="op" id="6794656">.</span><span class="ident" id="6794657">Logf</span><span class="op" id="6794661">(</span><span class="string" id="6794662">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6794696">,</span>&nbsp;<span class="ident" id="6794698"><a href="/net/dnsclient_unix_test.go.html#6794525">r</a></span><span class="op" id="6794699">.</span><span class="ident" id="6794700">dir</span><span class="op" id="6794703">,</span>&nbsp;<span class="ident" id="6794705"><a href="/net/dnsclient_unix_test.go.html#6794612">err</a></span><span class="op" id="6794708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794711">}</span><br>
<span class="lineno"></span><span class="op" id="6794713">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6794716">func</span>&nbsp;<span class="ident" id="6794721">TestReloadResolvConfFail</span><span class="op" id="6794745">(</span><span class="ident" id="6794746">t</span>&nbsp;<span class="op" id="6794748">*</span><span class="ident" id="6794749"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6794756">.</span><span class="ident" id="6794757">T</span><span class="op" id="6794758">)</span>&nbsp;<span class="op" id="6794760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794763">if</span>&nbsp;<span class="ident" id="6794766"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6794773">.</span><span class="ident" id="6794774">Short</span><span class="op" id="6794779">(</span><span class="op" id="6794780">)</span>&nbsp;<span class="op" id="6794782">||</span>&nbsp;<span class="op" id="6794785">!</span><span class="op" id="6794786">*</span><span class="ident" id="6794787"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6794800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794804"><a href="/net/dnsclient_unix_test.go.html#6794746">t</a></span><span class="op" id="6794805">.</span><span class="ident" id="6794806">Skip</span><span class="op" id="6794810">(</span><span class="string" id="6794811">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6794852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6794855">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794859">r</span>&nbsp;<span class="op" id="6794861">:=</span>&nbsp;<span class="ident" id="6794864"><a href="/net/dnsclient_unix_test.go.html#6793160">newResolvConfTest</a></span><span class="op" id="6794881">(</span><span class="ident" id="6794882"><a href="/net/dnsclient_unix_test.go.html#6794746">t</a></span><span class="op" id="6794883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794886">defer</span>&nbsp;<span class="ident" id="6794892"><a href="/net/dnsclient_unix_test.go.html#6794859">r</a></span><span class="op" id="6794893">.</span><span class="ident" id="6794894">Close</span><span class="op" id="6794899">(</span><span class="op" id="6794900">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6794904">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6794943"><a href="/net/dnsclient_unix_test.go.html#6794859">r</a></span><span class="op" id="6794944">.</span><span class="ident" id="6794945">Start</span><span class="op" id="6794950">(</span><span class="op" id="6794951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6794954">if</span>&nbsp;<span class="ident" id="6794957">_</span><span class="op" id="6794958">,</span>&nbsp;<span class="ident" id="6794960">err</span>&nbsp;<span class="op" id="6794964">:=</span>&nbsp;<span class="ident" id="6794967"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6794977">(</span><span class="string" id="6794978">&#34;golang.org&#34;</span><span class="op" id="6794990">)</span><span class="op" id="6794991">;</span>&nbsp;<span class="ident" id="6794993"><a href="/net/dnsclient_unix_test.go.html#6794960">err</a></span>&nbsp;<span class="op" id="6794997">==</span>&nbsp;<span class="ident" id="6795000">nil</span>&nbsp;<span class="op" id="6795004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795008"><a href="/net/dnsclient_unix_test.go.html#6794746">t</a></span><span class="op" id="6795009">.</span><span class="ident" id="6795010">Fatal</span><span class="op" id="6795015">(</span><span class="string" id="6795016">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="6795047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6795050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795054"><a href="/net/dnsclient_unix_test.go.html#6794859">r</a></span><span class="op" id="6795055">.</span><span class="ident" id="6795056">SetConf</span><span class="op" id="6795063">(</span><span class="string" id="6795064">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6795084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795087">if</span>&nbsp;<span class="ident" id="6795090">_</span><span class="op" id="6795091">,</span>&nbsp;<span class="ident" id="6795093">err</span>&nbsp;<span class="op" id="6795097">:=</span>&nbsp;<span class="ident" id="6795100"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6795110">(</span><span class="string" id="6795111">&#34;golang.org&#34;</span><span class="op" id="6795123">)</span><span class="op" id="6795124">;</span>&nbsp;<span class="ident" id="6795126"><a href="/net/dnsclient_unix_test.go.html#6795093">err</a></span>&nbsp;<span class="op" id="6795130">!=</span>&nbsp;<span class="ident" id="6795133">nil</span>&nbsp;<span class="op" id="6795137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795141"><a href="/net/dnsclient_unix_test.go.html#6794746">t</a></span><span class="op" id="6795142">.</span><span class="ident" id="6795143">Fatalf</span><span class="op" id="6795149">(</span><span class="string" id="6795150">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6795188">,</span>&nbsp;<span class="ident" id="6795190"><a href="/net/dnsclient_unix_test.go.html#6795093">err</a></span><span class="op" id="6795193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6795196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6795200">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6795248">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795292"><a href="/net/dnsclient_unix_test.go.html#6794859">r</a></span><span class="op" id="6795293">.</span><span class="ident" id="6795294">SetConf</span><span class="op" id="6795301">(</span><span class="string" id="6795302">&#34;&#34;</span><span class="op" id="6795304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795307">if</span>&nbsp;<span class="ident" id="6795310">_</span><span class="op" id="6795311">,</span>&nbsp;<span class="ident" id="6795313">err</span>&nbsp;<span class="op" id="6795317">:=</span>&nbsp;<span class="ident" id="6795320"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6795330">(</span><span class="string" id="6795331">&#34;golang.org&#34;</span><span class="op" id="6795343">)</span><span class="op" id="6795344">;</span>&nbsp;<span class="ident" id="6795346"><a href="/net/dnsclient_unix_test.go.html#6795313">err</a></span>&nbsp;<span class="op" id="6795350">!=</span>&nbsp;<span class="ident" id="6795353">nil</span>&nbsp;<span class="op" id="6795357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795361"><a href="/net/dnsclient_unix_test.go.html#6794746">t</a></span><span class="op" id="6795362">.</span><span class="ident" id="6795363">Fatalf</span><span class="op" id="6795369">(</span><span class="string" id="6795370">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6795413">,</span>&nbsp;<span class="ident" id="6795415"><a href="/net/dnsclient_unix_test.go.html#6795313">err</a></span><span class="op" id="6795418">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6795421">}</span><br>
<span class="lineno"></span><span class="op" id="6795423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6795426">func</span>&nbsp;<span class="ident" id="6795431">TestReloadResolvConfChange</span><span class="op" id="6795457">(</span><span class="ident" id="6795458">t</span>&nbsp;<span class="op" id="6795460">*</span><span class="ident" id="6795461"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6795468">.</span><span class="ident" id="6795469">T</span><span class="op" id="6795470">)</span>&nbsp;<span class="op" id="6795472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795475">if</span>&nbsp;<span class="ident" id="6795478"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6795485">.</span><span class="ident" id="6795486">Short</span><span class="op" id="6795491">(</span><span class="op" id="6795492">)</span>&nbsp;<span class="op" id="6795494">||</span>&nbsp;<span class="op" id="6795497">!</span><span class="op" id="6795498">*</span><span class="ident" id="6795499"><a href="/net/lookup_test.go.html#6856134">testExternal</a></span>&nbsp;<span class="op" id="6795512">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795516"><a href="/net/dnsclient_unix_test.go.html#6795458">t</a></span><span class="op" id="6795517">.</span><span class="ident" id="6795518">Skip</span><span class="op" id="6795522">(</span><span class="string" id="6795523">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6795564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6795567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795571">r</span>&nbsp;<span class="op" id="6795573">:=</span>&nbsp;<span class="ident" id="6795576"><a href="/net/dnsclient_unix_test.go.html#6793160">newResolvConfTest</a></span><span class="op" id="6795593">(</span><span class="ident" id="6795594"><a href="/net/dnsclient_unix_test.go.html#6795458">t</a></span><span class="op" id="6795595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795598">defer</span>&nbsp;<span class="ident" id="6795604"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6795605">.</span><span class="ident" id="6795606">Close</span><span class="op" id="6795611">(</span><span class="op" id="6795612">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795616"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6795617">.</span><span class="ident" id="6795618">SetConf</span><span class="op" id="6795625">(</span><span class="string" id="6795626">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6795646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795649"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6795650">.</span><span class="ident" id="6795651">Start</span><span class="op" id="6795656">(</span><span class="op" id="6795657">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795661">if</span>&nbsp;<span class="ident" id="6795664">_</span><span class="op" id="6795665">,</span>&nbsp;<span class="ident" id="6795667">err</span>&nbsp;<span class="op" id="6795671">:=</span>&nbsp;<span class="ident" id="6795674"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6795684">(</span><span class="string" id="6795685">&#34;golang.org&#34;</span><span class="op" id="6795697">)</span><span class="op" id="6795698">;</span>&nbsp;<span class="ident" id="6795700"><a href="/net/dnsclient_unix_test.go.html#6795667">err</a></span>&nbsp;<span class="op" id="6795704">!=</span>&nbsp;<span class="ident" id="6795707">nil</span>&nbsp;<span class="op" id="6795711">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795715"><a href="/net/dnsclient_unix_test.go.html#6795458">t</a></span><span class="op" id="6795716">.</span><span class="ident" id="6795717">Fatalf</span><span class="op" id="6795723">(</span><span class="string" id="6795724">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6795753">,</span>&nbsp;<span class="ident" id="6795755"><a href="/net/dnsclient_unix_test.go.html#6795667">err</a></span><span class="op" id="6795758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6795761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795764"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6795765">.</span><span class="ident" id="6795766">WantServers</span><span class="op" id="6795777">(</span><span class="op" id="6795778">[</span><span class="op" id="6795779">]</span><span class="builtintype" id="6795780">string</span><span class="op" id="6795786">{</span><span class="string" id="6795787">&#34;8.8.8.8&#34;</span><span class="op" id="6795796">}</span><span class="op" id="6795797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6795801">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6795852">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795892"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6795893">.</span><span class="ident" id="6795894">SetConf</span><span class="op" id="6795901">(</span><span class="string" id="6795902">&#34;&#34;</span><span class="op" id="6795904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6795907">if</span>&nbsp;<span class="ident" id="6795910">_</span><span class="op" id="6795911">,</span>&nbsp;<span class="ident" id="6795913">err</span>&nbsp;<span class="op" id="6795917">:=</span>&nbsp;<span class="ident" id="6795920"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6795930">(</span><span class="string" id="6795931">&#34;golang.org&#34;</span><span class="op" id="6795943">)</span><span class="op" id="6795944">;</span>&nbsp;<span class="ident" id="6795946"><a href="/net/dnsclient_unix_test.go.html#6795913">err</a></span>&nbsp;<span class="op" id="6795950">!=</span>&nbsp;<span class="ident" id="6795953">nil</span>&nbsp;<span class="op" id="6795957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6795961"><a href="/net/dnsclient_unix_test.go.html#6795458">t</a></span><span class="op" id="6795962">.</span><span class="ident" id="6795963">Fatalf</span><span class="op" id="6795969">(</span><span class="string" id="6795970">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6796004">,</span>&nbsp;<span class="ident" id="6796006"><a href="/net/dnsclient_unix_test.go.html#6795913">err</a></span><span class="op" id="6796009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6796012">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6796016">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796059"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6796060">.</span><span class="ident" id="6796061">SetConf</span><span class="op" id="6796068">(</span><span class="string" id="6796069">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="6796089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796092"><a href="/net/dnsclient_unix_test.go.html#6795571">r</a></span><span class="op" id="6796093">.</span><span class="ident" id="6796094">WantServers</span><span class="op" id="6796105">(</span><span class="op" id="6796106">[</span><span class="op" id="6796107">]</span><span class="builtintype" id="6796108">string</span><span class="op" id="6796114">{</span><span class="string" id="6796115">&#34;8.8.4.4&#34;</span><span class="op" id="6796124">}</span><span class="op" id="6796125">)</span><br>
<span class="lineno"></span><span class="op" id="6796127">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6796130">func</span>&nbsp;<span class="ident" id="6796135">BenchmarkGoLookupIP</span><span class="op" id="6796154">(</span><span class="ident" id="6796155">b</span>&nbsp;<span class="op" id="6796157">*</span><span class="ident" id="6796158"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6796165">.</span><span class="ident" id="6796166">B</span><span class="op" id="6796167">)</span>&nbsp;<span class="op" id="6796169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6796172">for</span>&nbsp;<span class="ident" id="6796176">i</span>&nbsp;<span class="op" id="6796178">:=</span>&nbsp;<span class="num" id="6796181">0</span><span class="op" id="6796182">;</span>&nbsp;<span class="ident" id="6796184"><a href="/net/dnsclient_unix_test.go.html#6796176">i</a></span>&nbsp;<span class="op" id="6796186">&lt;</span>&nbsp;<span class="ident" id="6796188"><a href="/net/dnsclient_unix_test.go.html#6796155">b</a></span><span class="op" id="6796189">.</span><span class="ident" id="6796190">N</span><span class="op" id="6796191">;</span>&nbsp;<span class="ident" id="6796193"><a href="/net/dnsclient_unix_test.go.html#6796176">i</a></span><span class="op" id="6796194">++</span>&nbsp;<span class="op" id="6796197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796201"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6796211">(</span><span class="string" id="6796212">&#34;www.example.com&#34;</span><span class="op" id="6796229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6796232">}</span><br>
<span class="lineno">225</span><span class="op" id="6796234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6796237">func</span>&nbsp;<span class="ident" id="6796242">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="6796271">(</span><span class="ident" id="6796272">b</span>&nbsp;<span class="op" id="6796274">*</span><span class="ident" id="6796275"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6796282">.</span><span class="ident" id="6796283">B</span><span class="op" id="6796284">)</span>&nbsp;<span class="op" id="6796286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6796289">for</span>&nbsp;<span class="ident" id="6796293">i</span>&nbsp;<span class="op" id="6796295">:=</span>&nbsp;<span class="num" id="6796298">0</span><span class="op" id="6796299">;</span>&nbsp;<span class="ident" id="6796301"><a href="/net/dnsclient_unix_test.go.html#6796293">i</a></span>&nbsp;<span class="op" id="6796303">&lt;</span>&nbsp;<span class="ident" id="6796305"><a href="/net/dnsclient_unix_test.go.html#6796272">b</a></span><span class="op" id="6796306">.</span><span class="ident" id="6796307">N</span><span class="op" id="6796308">;</span>&nbsp;<span class="ident" id="6796310"><a href="/net/dnsclient_unix_test.go.html#6796293">i</a></span><span class="op" id="6796311">++</span>&nbsp;<span class="op" id="6796314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796318"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6796328">(</span><span class="string" id="6796329">&#34;some.nonexistent&#34;</span><span class="op" id="6796347">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6796350">}</span><br>
<span class="lineno"></span><span class="op" id="6796352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6796355">func</span>&nbsp;<span class="ident" id="6796360">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="6796399">(</span><span class="ident" id="6796400">b</span>&nbsp;<span class="op" id="6796402">*</span><span class="ident" id="6796403"><a href="/net/dnsclient_unix_test.go.html#6790946">testing</a></span><span class="op" id="6796410">.</span><span class="ident" id="6796411">B</span><span class="op" id="6796412">)</span>&nbsp;<span class="op" id="6796414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796417"><a href="/net/dnsclient_unix.go.html#2538128">onceLoadConfig</a></span><span class="op" id="6796431">.</span><span class="ident" id="6796432">Do</span><span class="op" id="6796434">(</span><span class="ident" id="6796435"><a href="/net/dnsclient_unix.go.html#2538210">loadDefaultConfig</a></span><span class="op" id="6796452">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6796455">if</span>&nbsp;<span class="ident" id="6796458"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796461">.</span><span class="ident" id="6796462">dnserr</span>&nbsp;<span class="op" id="6796469">!=</span>&nbsp;<span class="ident" id="6796472">nil</span>&nbsp;<span class="op" id="6796476">||</span>&nbsp;<span class="ident" id="6796479"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796482">.</span><span class="ident" id="6796483">dnsConfig</span>&nbsp;<span class="op" id="6796493">==</span>&nbsp;<span class="ident" id="6796496">nil</span>&nbsp;<span class="op" id="6796500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796504"><a href="/net/dnsclient_unix_test.go.html#6796400">b</a></span><span class="op" id="6796505">.</span><span class="ident" id="6796506">Fatalf</span><span class="op" id="6796512">(</span><span class="string" id="6796513">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6796536">,</span>&nbsp;<span class="ident" id="6796538"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796541">.</span><span class="ident" id="6796542">dnserr</span><span class="op" id="6796548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6796551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6796554">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6796618">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796655">orig</span>&nbsp;<span class="op" id="6796660">:=</span>&nbsp;<span class="ident" id="6796663"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796666">.</span><span class="ident" id="6796667">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796678"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796681">.</span><span class="ident" id="6796682">dnsConfig</span><span class="op" id="6796691">.</span><span class="ident" id="6796692">servers</span>&nbsp;<span class="op" id="6796700">=</span>&nbsp;<span class="builtinfunc" id="6796702">append</span><span class="op" id="6796708">(</span><span class="op" id="6796709">[</span><span class="op" id="6796710">]</span><span class="builtintype" id="6796711">string</span><span class="op" id="6796717">{</span><span class="string" id="6796718">&#34;203.0.113.254&#34;</span><span class="op" id="6796733">}</span><span class="op" id="6796734">,</span>&nbsp;<span class="ident" id="6796736"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796739">.</span><span class="ident" id="6796740">dnsConfig</span><span class="op" id="6796749">.</span><span class="ident" id="6796750">servers</span><span class="op" id="6796757">...</span><span class="op" id="6796760">)</span>&nbsp;<span class="comment" id="6796762">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6796801">for</span>&nbsp;<span class="ident" id="6796805">i</span>&nbsp;<span class="op" id="6796807">:=</span>&nbsp;<span class="num" id="6796810">0</span><span class="op" id="6796811">;</span>&nbsp;<span class="ident" id="6796813"><a href="/net/dnsclient_unix_test.go.html#6796805">i</a></span>&nbsp;<span class="op" id="6796815">&lt;</span>&nbsp;<span class="ident" id="6796817"><a href="/net/dnsclient_unix_test.go.html#6796400">b</a></span><span class="op" id="6796818">.</span><span class="ident" id="6796819">N</span><span class="op" id="6796820">;</span>&nbsp;<span class="ident" id="6796822"><a href="/net/dnsclient_unix_test.go.html#6796805">i</a></span><span class="op" id="6796823">++</span>&nbsp;<span class="op" id="6796826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796830"><a href="/net/dnsclient_unix.go.html#2541824">goLookupIP</a></span><span class="op" id="6796840">(</span><span class="string" id="6796841">&#34;www.example.com&#34;</span><span class="op" id="6796858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6796861">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6796864"><a href="/net/dnsclient_unix.go.html#2537988">cfg</a></span><span class="op" id="6796867">.</span><span class="ident" id="6796868">dnsConfig</span>&nbsp;<span class="op" id="6796878">=</span>&nbsp;<span class="ident" id="6796880"><a href="/net/dnsclient_unix_test.go.html#6796655">orig</a></span><br>
<span class="lineno"></span><span class="op" id="6796885">}</span>
</div>
</body>
</html>
