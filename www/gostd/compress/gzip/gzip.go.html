<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html" class="current">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4767014">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4767069">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4767123">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4767174">package</span>&nbsp;<span class="ident" id="4767182">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4767188">import</span>&nbsp;<span class="op" id="4767195">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767198">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767216">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767226">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767233">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767241">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4767255">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4767260">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4767263">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4767343">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4767409">const</span>&nbsp;<span class="op" id="4767415">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767418">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4767437">=</span>&nbsp;<span class="ident" id="4767439">flate</span><span class="op" id="4767444">.</span><span class="ident" id="4767445">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767460">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4767479">=</span>&nbsp;<span class="ident" id="4767481">flate</span><span class="op" id="4767486">.</span><span class="ident" id="4767487">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767498">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4767517">=</span>&nbsp;<span class="ident" id="4767519">flate</span><span class="op" id="4767524">.</span><span class="ident" id="4767525">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767542">DefaultCompression</span>&nbsp;<span class="op" id="4767561">=</span>&nbsp;<span class="ident" id="4767563">flate</span><span class="op" id="4767568">.</span><span class="ident" id="4767569">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4767588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4767591">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4767625">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4767680">type</span>&nbsp;<span class="ident" id="4767685">Writer</span>&nbsp;<span class="keyword" id="4767692">struct</span>&nbsp;<span class="op" id="4767699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767702">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767710">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767722">io</span><span class="op" id="4767724">.</span><span class="ident" id="4767725">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767733">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4767745">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767750">wroteHeader</span>&nbsp;<span class="builtintype" id="4767762">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767768">compressor</span>&nbsp;&nbsp;<span class="op" id="4767780">*</span><span class="ident" id="4767781">flate</span><span class="op" id="4767786">.</span><span class="ident" id="4767787">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767795">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767807">hash</span><span class="op" id="4767811">.</span><span class="ident" id="4767812">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767820">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4767832">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767840">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4767852">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767858">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4767870">[</span><span class="num" id="4767871">10</span><span class="op" id="4767873">]</span><span class="builtintype" id="4767874">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4767880">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4767892">error</span><br>
<span class="lineno"></span><span class="op" id="4767898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4767901">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4767936">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4768002">//</span><br>
<span class="lineno"></span><span class="comment" id="4768005">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4768086">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4768141">//</span><br>
<span class="lineno"></span><span class="comment" id="4768144">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4768218">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4768294">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4768372">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4768451">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4768470">func</span>&nbsp;<span class="ident" id="4768475">NewWriter</span><span class="op" id="4768484">(</span><span class="ident" id="4768485">w</span>&nbsp;<span class="ident" id="4768487">io</span><span class="op" id="4768489">.</span><span class="ident" id="4768490">Writer</span><span class="op" id="4768496">)</span>&nbsp;<span class="op" id="4768498">*</span><span class="ident" id="4768499">Writer</span>&nbsp;<span class="op" id="4768506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4768509">z</span><span class="op" id="4768510">,</span>&nbsp;<span class="ident" id="4768512">_</span>&nbsp;<span class="op" id="4768514">:=</span>&nbsp;<span class="ident" id="4768517">NewWriterLevel</span><span class="op" id="4768531">(</span><span class="ident" id="4768532">w</span><span class="op" id="4768533">,</span>&nbsp;<span class="ident" id="4768535">DefaultCompression</span><span class="op" id="4768553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4768556">return</span>&nbsp;<span class="ident" id="4768563">z</span><br>
<span class="lineno"></span><span class="op" id="4768565">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4768568">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4768648">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4768683">//</span><br>
<span class="lineno"></span><span class="comment" id="4768686">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4768760">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4768836">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4768883">func</span>&nbsp;<span class="ident" id="4768888">NewWriterLevel</span><span class="op" id="4768902">(</span><span class="ident" id="4768903">w</span>&nbsp;<span class="ident" id="4768905">io</span><span class="op" id="4768907">.</span><span class="ident" id="4768908">Writer</span><span class="op" id="4768914">,</span>&nbsp;<span class="ident" id="4768916">level</span>&nbsp;<span class="builtintype" id="4768922">int</span><span class="op" id="4768925">)</span>&nbsp;<span class="op" id="4768927">(</span><span class="op" id="4768928">*</span><span class="ident" id="4768929">Writer</span><span class="op" id="4768935">,</span>&nbsp;<span class="builtintype" id="4768937">error</span><span class="op" id="4768942">)</span>&nbsp;<span class="op" id="4768944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4768947">if</span>&nbsp;<span class="ident" id="4768950">level</span>&nbsp;<span class="op" id="4768956">&lt;</span>&nbsp;<span class="ident" id="4768958">DefaultCompression</span>&nbsp;<span class="op" id="4768977">||</span>&nbsp;<span class="ident" id="4768980">level</span>&nbsp;<span class="op" id="4768986">&gt;</span>&nbsp;<span class="ident" id="4768988">BestCompression</span>&nbsp;<span class="op" id="4769004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4769008">return</span>&nbsp;<span class="builtintype" id="4769015">nil</span><span class="op" id="4769018">,</span>&nbsp;<span class="ident" id="4769020">fmt</span><span class="op" id="4769023">.</span><span class="ident" id="4769024">Errorf</span><span class="op" id="4769030">(</span><span class="string" id="4769031">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4769068">,</span>&nbsp;<span class="ident" id="4769070">level</span><span class="op" id="4769075">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769081">z</span>&nbsp;<span class="op" id="4769083">:=</span>&nbsp;<span class="builtinfunc" id="4769086">new</span><span class="op" id="4769089">(</span><span class="ident" id="4769090">Writer</span><span class="op" id="4769096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769099">z</span><span class="op" id="4769100">.</span><span class="ident" id="4769101">init</span><span class="op" id="4769105">(</span><span class="ident" id="4769106">w</span><span class="op" id="4769107">,</span>&nbsp;<span class="ident" id="4769109">level</span><span class="op" id="4769114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4769117">return</span>&nbsp;<span class="ident" id="4769124">z</span><span class="op" id="4769125">,</span>&nbsp;<span class="builtintype" id="4769127">nil</span><br>
<span class="lineno"></span><span class="op" id="4769131">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4769134">func</span>&nbsp;<span class="op" id="4769139">(</span><span class="ident" id="4769140">z</span>&nbsp;<span class="op" id="4769142">*</span><span class="ident" id="4769143">Writer</span><span class="op" id="4769149">)</span>&nbsp;<span class="ident" id="4769151">init</span><span class="op" id="4769155">(</span><span class="ident" id="4769156">w</span>&nbsp;<span class="ident" id="4769158">io</span><span class="op" id="4769160">.</span><span class="ident" id="4769161">Writer</span><span class="op" id="4769167">,</span>&nbsp;<span class="ident" id="4769169">level</span>&nbsp;<span class="builtintype" id="4769175">int</span><span class="op" id="4769178">)</span>&nbsp;<span class="op" id="4769180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769183">digest</span>&nbsp;<span class="op" id="4769190">:=</span>&nbsp;<span class="ident" id="4769193">z</span><span class="op" id="4769194">.</span><span class="ident" id="4769195">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4769203">if</span>&nbsp;<span class="ident" id="4769206">digest</span>&nbsp;<span class="op" id="4769213">!=</span>&nbsp;<span class="builtintype" id="4769216">nil</span>&nbsp;<span class="op" id="4769220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769224">digest</span><span class="op" id="4769230">.</span><span class="ident" id="4769231">Reset</span><span class="op" id="4769236">(</span><span class="op" id="4769237">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769240">}</span>&nbsp;<span class="keyword" id="4769242">else</span>&nbsp;<span class="op" id="4769247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769251">digest</span>&nbsp;<span class="op" id="4769258">=</span>&nbsp;<span class="ident" id="4769260">crc32</span><span class="op" id="4769265">.</span><span class="ident" id="4769266">NewIEEE</span><span class="op" id="4769273">(</span><span class="op" id="4769274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769280">compressor</span>&nbsp;<span class="op" id="4769291">:=</span>&nbsp;<span class="ident" id="4769294">z</span><span class="op" id="4769295">.</span><span class="ident" id="4769296">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4769308">if</span>&nbsp;<span class="ident" id="4769311">compressor</span>&nbsp;<span class="op" id="4769322">!=</span>&nbsp;<span class="builtintype" id="4769325">nil</span>&nbsp;<span class="op" id="4769329">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769333">compressor</span><span class="op" id="4769343">.</span><span class="ident" id="4769344">Reset</span><span class="op" id="4769349">(</span><span class="ident" id="4769350">w</span><span class="op" id="4769351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769357">*</span><span class="ident" id="4769358">z</span>&nbsp;<span class="op" id="4769360">=</span>&nbsp;<span class="ident" id="4769362">Writer</span><span class="op" id="4769368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769372">Header</span><span class="op" id="4769378">:</span>&nbsp;<span class="ident" id="4769380">Header</span><span class="op" id="4769386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769391">OS</span><span class="op" id="4769393">:</span>&nbsp;<span class="num" id="4769395">255</span><span class="op" id="4769398">,</span>&nbsp;<span class="comment" id="4769400">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769413">}</span><span class="op" id="4769414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769418">w</span><span class="op" id="4769419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769430">w</span><span class="op" id="4769431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769435">level</span><span class="op" id="4769440">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769447">level</span><span class="op" id="4769452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769456">digest</span><span class="op" id="4769462">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769468">digest</span><span class="op" id="4769474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769478">compressor</span><span class="op" id="4769488">:</span>&nbsp;<span class="ident" id="4769490">compressor</span><span class="op" id="4769500">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4769503">}</span><br>
<span class="lineno"></span><span class="op" id="4769505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4769508">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4769578">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4769648">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4769715">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4769740">func</span>&nbsp;<span class="op" id="4769745">(</span><span class="ident" id="4769746">z</span>&nbsp;<span class="op" id="4769748">*</span><span class="ident" id="4769749">Writer</span><span class="op" id="4769755">)</span>&nbsp;<span class="ident" id="4769757">Reset</span><span class="op" id="4769762">(</span><span class="ident" id="4769763">w</span>&nbsp;<span class="ident" id="4769765">io</span><span class="op" id="4769767">.</span><span class="ident" id="4769768">Writer</span><span class="op" id="4769774">)</span>&nbsp;<span class="op" id="4769776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769779">z</span><span class="op" id="4769780">.</span><span class="ident" id="4769781">init</span><span class="op" id="4769785">(</span><span class="ident" id="4769786">w</span><span class="op" id="4769787">,</span>&nbsp;<span class="ident" id="4769789">z</span><span class="op" id="4769790">.</span><span class="ident" id="4769791">level</span><span class="op" id="4769796">)</span><br>
<span class="lineno"></span><span class="op" id="4769798">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4769801">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4769862">func</span>&nbsp;<span class="ident" id="4769867">put2</span><span class="op" id="4769871">(</span><span class="ident" id="4769872">p</span>&nbsp;<span class="op" id="4769874">[</span><span class="op" id="4769875">]</span><span class="builtintype" id="4769876">byte</span><span class="op" id="4769880">,</span>&nbsp;<span class="ident" id="4769882">v</span>&nbsp;<span class="builtintype" id="4769884">uint16</span><span class="op" id="4769890">)</span>&nbsp;<span class="op" id="4769892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769895">p</span><span class="op" id="4769896">[</span><span class="num" id="4769897">0</span><span class="op" id="4769898">]</span>&nbsp;<span class="op" id="4769900">=</span>&nbsp;<span class="builtintype" id="4769902">uint8</span><span class="op" id="4769907">(</span><span class="ident" id="4769908">v</span>&nbsp;<span class="op" id="4769910">&gt;&gt;</span>&nbsp;<span class="num" id="4769913">0</span><span class="op" id="4769914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769917">p</span><span class="op" id="4769918">[</span><span class="num" id="4769919">1</span><span class="op" id="4769920">]</span>&nbsp;<span class="op" id="4769922">=</span>&nbsp;<span class="builtintype" id="4769924">uint8</span><span class="op" id="4769929">(</span><span class="ident" id="4769930">v</span>&nbsp;<span class="op" id="4769932">&gt;&gt;</span>&nbsp;<span class="num" id="4769935">8</span><span class="op" id="4769936">)</span><br>
<span class="lineno">105</span><span class="op" id="4769938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4769941">func</span>&nbsp;<span class="ident" id="4769946">put4</span><span class="op" id="4769950">(</span><span class="ident" id="4769951">p</span>&nbsp;<span class="op" id="4769953">[</span><span class="op" id="4769954">]</span><span class="builtintype" id="4769955">byte</span><span class="op" id="4769959">,</span>&nbsp;<span class="ident" id="4769961">v</span>&nbsp;<span class="builtintype" id="4769963">uint32</span><span class="op" id="4769969">)</span>&nbsp;<span class="op" id="4769971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769974">p</span><span class="op" id="4769975">[</span><span class="num" id="4769976">0</span><span class="op" id="4769977">]</span>&nbsp;<span class="op" id="4769979">=</span>&nbsp;<span class="builtintype" id="4769981">uint8</span><span class="op" id="4769986">(</span><span class="ident" id="4769987">v</span>&nbsp;<span class="op" id="4769989">&gt;&gt;</span>&nbsp;<span class="num" id="4769992">0</span><span class="op" id="4769993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4769996">p</span><span class="op" id="4769997">[</span><span class="num" id="4769998">1</span><span class="op" id="4769999">]</span>&nbsp;<span class="op" id="4770001">=</span>&nbsp;<span class="builtintype" id="4770003">uint8</span><span class="op" id="4770008">(</span><span class="ident" id="4770009">v</span>&nbsp;<span class="op" id="4770011">&gt;&gt;</span>&nbsp;<span class="num" id="4770014">8</span><span class="op" id="4770015">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770018">p</span><span class="op" id="4770019">[</span><span class="num" id="4770020">2</span><span class="op" id="4770021">]</span>&nbsp;<span class="op" id="4770023">=</span>&nbsp;<span class="builtintype" id="4770025">uint8</span><span class="op" id="4770030">(</span><span class="ident" id="4770031">v</span>&nbsp;<span class="op" id="4770033">&gt;&gt;</span>&nbsp;<span class="num" id="4770036">16</span><span class="op" id="4770038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770041">p</span><span class="op" id="4770042">[</span><span class="num" id="4770043">3</span><span class="op" id="4770044">]</span>&nbsp;<span class="op" id="4770046">=</span>&nbsp;<span class="builtintype" id="4770048">uint8</span><span class="op" id="4770053">(</span><span class="ident" id="4770054">v</span>&nbsp;<span class="op" id="4770056">&gt;&gt;</span>&nbsp;<span class="num" id="4770059">24</span><span class="op" id="4770061">)</span><br>
<span class="lineno"></span><span class="op" id="4770063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4770066">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4770124">func</span>&nbsp;<span class="op" id="4770129">(</span><span class="ident" id="4770130">z</span>&nbsp;<span class="op" id="4770132">*</span><span class="ident" id="4770133">Writer</span><span class="op" id="4770139">)</span>&nbsp;<span class="ident" id="4770141">writeBytes</span><span class="op" id="4770151">(</span><span class="ident" id="4770152">b</span>&nbsp;<span class="op" id="4770154">[</span><span class="op" id="4770155">]</span><span class="builtintype" id="4770156">byte</span><span class="op" id="4770160">)</span>&nbsp;<span class="builtintype" id="4770162">error</span>&nbsp;<span class="op" id="4770168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770171">if</span>&nbsp;<span class="builtinfunc" id="4770174">len</span><span class="op" id="4770177">(</span><span class="ident" id="4770178">b</span><span class="op" id="4770179">)</span>&nbsp;<span class="op" id="4770181">&gt;</span>&nbsp;<span class="num" id="4770183">0xffff</span>&nbsp;<span class="op" id="4770190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770194">return</span>&nbsp;<span class="ident" id="4770201">errors</span><span class="op" id="4770207">.</span><span class="ident" id="4770208">New</span><span class="op" id="4770211">(</span><span class="string" id="4770212">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4770249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770255">put2</span><span class="op" id="4770259">(</span><span class="ident" id="4770260">z</span><span class="op" id="4770261">.</span><span class="ident" id="4770262">buf</span><span class="op" id="4770265">[</span><span class="num" id="4770266">0</span><span class="op" id="4770267">:</span><span class="num" id="4770268">2</span><span class="op" id="4770269">]</span><span class="op" id="4770270">,</span>&nbsp;<span class="builtintype" id="4770272">uint16</span><span class="op" id="4770278">(</span><span class="builtinfunc" id="4770279">len</span><span class="op" id="4770282">(</span><span class="ident" id="4770283">b</span><span class="op" id="4770284">)</span><span class="op" id="4770285">)</span><span class="op" id="4770286">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770289">_</span><span class="op" id="4770290">,</span>&nbsp;<span class="ident" id="4770292">err</span>&nbsp;<span class="op" id="4770296">:=</span>&nbsp;<span class="ident" id="4770299">z</span><span class="op" id="4770300">.</span><span class="ident" id="4770301">w</span><span class="op" id="4770302">.</span><span class="ident" id="4770303">Write</span><span class="op" id="4770308">(</span><span class="ident" id="4770309">z</span><span class="op" id="4770310">.</span><span class="ident" id="4770311">buf</span><span class="op" id="4770314">[</span><span class="num" id="4770315">0</span><span class="op" id="4770316">:</span><span class="num" id="4770317">2</span><span class="op" id="4770318">]</span><span class="op" id="4770319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770322">if</span>&nbsp;<span class="ident" id="4770325">err</span>&nbsp;<span class="op" id="4770329">!=</span>&nbsp;<span class="builtintype" id="4770332">nil</span>&nbsp;<span class="op" id="4770336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770340">return</span>&nbsp;<span class="ident" id="4770347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770355">_</span><span class="op" id="4770356">,</span>&nbsp;<span class="ident" id="4770358">err</span>&nbsp;<span class="op" id="4770362">=</span>&nbsp;<span class="ident" id="4770364">z</span><span class="op" id="4770365">.</span><span class="ident" id="4770366">w</span><span class="op" id="4770367">.</span><span class="ident" id="4770368">Write</span><span class="op" id="4770373">(</span><span class="ident" id="4770374">b</span><span class="op" id="4770375">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770378">return</span>&nbsp;<span class="ident" id="4770385">err</span><br>
<span class="lineno"></span><span class="op" id="4770389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4770392">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4770456">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4770539">func</span>&nbsp;<span class="op" id="4770544">(</span><span class="ident" id="4770545">z</span>&nbsp;<span class="op" id="4770547">*</span><span class="ident" id="4770548">Writer</span><span class="op" id="4770554">)</span>&nbsp;<span class="ident" id="4770556">writeString</span><span class="op" id="4770567">(</span><span class="ident" id="4770568">s</span>&nbsp;<span class="builtintype" id="4770570">string</span><span class="op" id="4770576">)</span>&nbsp;<span class="op" id="4770578">(</span><span class="ident" id="4770579">err</span>&nbsp;<span class="builtintype" id="4770583">error</span><span class="op" id="4770588">)</span>&nbsp;<span class="op" id="4770590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4770593">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770670">needconv</span>&nbsp;<span class="op" id="4770679">:=</span>&nbsp;<span class="builtintype" id="4770682">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770689">for</span>&nbsp;<span class="ident" id="4770693">_</span><span class="op" id="4770694">,</span>&nbsp;<span class="ident" id="4770696">v</span>&nbsp;<span class="op" id="4770698">:=</span>&nbsp;<span class="keyword" id="4770701">range</span>&nbsp;<span class="ident" id="4770707">s</span>&nbsp;<span class="op" id="4770709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770713">if</span>&nbsp;<span class="ident" id="4770716">v</span>&nbsp;<span class="op" id="4770718">==</span>&nbsp;<span class="num" id="4770721">0</span>&nbsp;<span class="op" id="4770723">||</span>&nbsp;<span class="ident" id="4770726">v</span>&nbsp;<span class="op" id="4770728">&gt;</span>&nbsp;<span class="num" id="4770730">0xff</span>&nbsp;<span class="op" id="4770735">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770740">return</span>&nbsp;<span class="ident" id="4770747">errors</span><span class="op" id="4770753">.</span><span class="ident" id="4770754">New</span><span class="op" id="4770757">(</span><span class="string" id="4770758">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4770797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770805">if</span>&nbsp;<span class="ident" id="4770808">v</span>&nbsp;<span class="op" id="4770810">&gt;</span>&nbsp;<span class="num" id="4770812">0x7f</span>&nbsp;<span class="op" id="4770817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770822">needconv</span>&nbsp;<span class="op" id="4770831">=</span>&nbsp;<span class="builtintype" id="4770833">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770840">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770846">if</span>&nbsp;<span class="ident" id="4770849">needconv</span>&nbsp;<span class="op" id="4770858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770862">b</span>&nbsp;<span class="op" id="4770864">:=</span>&nbsp;<span class="builtinfunc" id="4770867">make</span><span class="op" id="4770871">(</span><span class="op" id="4770872">[</span><span class="op" id="4770873">]</span><span class="builtintype" id="4770874">byte</span><span class="op" id="4770878">,</span>&nbsp;<span class="num" id="4770880">0</span><span class="op" id="4770881">,</span>&nbsp;<span class="builtinfunc" id="4770883">len</span><span class="op" id="4770886">(</span><span class="ident" id="4770887">s</span><span class="op" id="4770888">)</span><span class="op" id="4770889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4770893">for</span>&nbsp;<span class="ident" id="4770897">_</span><span class="op" id="4770898">,</span>&nbsp;<span class="ident" id="4770900">v</span>&nbsp;<span class="op" id="4770902">:=</span>&nbsp;<span class="keyword" id="4770905">range</span>&nbsp;<span class="ident" id="4770911">s</span>&nbsp;<span class="op" id="4770913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770918">b</span>&nbsp;<span class="op" id="4770920">=</span>&nbsp;<span class="builtinfunc" id="4770922">append</span><span class="op" id="4770928">(</span><span class="ident" id="4770929">b</span><span class="op" id="4770930">,</span>&nbsp;<span class="builtintype" id="4770932">byte</span><span class="op" id="4770936">(</span><span class="ident" id="4770937">v</span><span class="op" id="4770938">)</span><span class="op" id="4770939">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770947">_</span><span class="op" id="4770948">,</span>&nbsp;<span class="ident" id="4770950">err</span>&nbsp;<span class="op" id="4770954">=</span>&nbsp;<span class="ident" id="4770956">z</span><span class="op" id="4770957">.</span><span class="ident" id="4770958">w</span><span class="op" id="4770959">.</span><span class="ident" id="4770960">Write</span><span class="op" id="4770965">(</span><span class="ident" id="4770966">b</span><span class="op" id="4770967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4770970">}</span>&nbsp;<span class="keyword" id="4770972">else</span>&nbsp;<span class="op" id="4770977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4770981">_</span><span class="op" id="4770982">,</span>&nbsp;<span class="ident" id="4770984">err</span>&nbsp;<span class="op" id="4770988">=</span>&nbsp;<span class="ident" id="4770990">io</span><span class="op" id="4770992">.</span><span class="ident" id="4770993">WriteString</span><span class="op" id="4771004">(</span><span class="ident" id="4771005">z</span><span class="op" id="4771006">.</span><span class="ident" id="4771007">w</span><span class="op" id="4771008">,</span>&nbsp;<span class="ident" id="4771010">s</span><span class="op" id="4771011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771014">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771017">if</span>&nbsp;<span class="ident" id="4771020">err</span>&nbsp;<span class="op" id="4771024">!=</span>&nbsp;<span class="builtintype" id="4771027">nil</span>&nbsp;<span class="op" id="4771031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771035">return</span>&nbsp;<span class="ident" id="4771042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4771050">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771087">z</span><span class="op" id="4771088">.</span><span class="ident" id="4771089">buf</span><span class="op" id="4771092">[</span><span class="num" id="4771093">0</span><span class="op" id="4771094">]</span>&nbsp;<span class="op" id="4771096">=</span>&nbsp;<span class="num" id="4771098">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771101">_</span><span class="op" id="4771102">,</span>&nbsp;<span class="ident" id="4771104">err</span>&nbsp;<span class="op" id="4771108">=</span>&nbsp;<span class="ident" id="4771110">z</span><span class="op" id="4771111">.</span><span class="ident" id="4771112">w</span><span class="op" id="4771113">.</span><span class="ident" id="4771114">Write</span><span class="op" id="4771119">(</span><span class="ident" id="4771120">z</span><span class="op" id="4771121">.</span><span class="ident" id="4771122">buf</span><span class="op" id="4771125">[</span><span class="num" id="4771126">0</span><span class="op" id="4771127">:</span><span class="num" id="4771128">1</span><span class="op" id="4771129">]</span><span class="op" id="4771130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771133">return</span>&nbsp;<span class="ident" id="4771140">err</span><br>
<span class="lineno"></span><span class="op" id="4771144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4771147">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4771219">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4771295">func</span>&nbsp;<span class="op" id="4771300">(</span><span class="ident" id="4771301">z</span>&nbsp;<span class="op" id="4771303">*</span><span class="ident" id="4771304">Writer</span><span class="op" id="4771310">)</span>&nbsp;<span class="ident" id="4771312">Write</span><span class="op" id="4771317">(</span><span class="ident" id="4771318">p</span>&nbsp;<span class="op" id="4771320">[</span><span class="op" id="4771321">]</span><span class="builtintype" id="4771322">byte</span><span class="op" id="4771326">)</span>&nbsp;<span class="op" id="4771328">(</span><span class="builtintype" id="4771329">int</span><span class="op" id="4771332">,</span>&nbsp;<span class="builtintype" id="4771334">error</span><span class="op" id="4771339">)</span>&nbsp;<span class="op" id="4771341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771344">if</span>&nbsp;<span class="ident" id="4771347">z</span><span class="op" id="4771348">.</span><span class="ident" id="4771349">err</span>&nbsp;<span class="op" id="4771353">!=</span>&nbsp;<span class="builtintype" id="4771356">nil</span>&nbsp;<span class="op" id="4771360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771364">return</span>&nbsp;<span class="num" id="4771371">0</span><span class="op" id="4771372">,</span>&nbsp;<span class="ident" id="4771374">z</span><span class="op" id="4771375">.</span><span class="ident" id="4771376">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771381">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771384">var</span>&nbsp;<span class="ident" id="4771388">n</span>&nbsp;<span class="builtintype" id="4771390">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4771395">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771429">if</span>&nbsp;<span class="op" id="4771432">!</span><span class="ident" id="4771433">z</span><span class="op" id="4771434">.</span><span class="ident" id="4771435">wroteHeader</span>&nbsp;<span class="op" id="4771447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771451">z</span><span class="op" id="4771452">.</span><span class="ident" id="4771453">wroteHeader</span>&nbsp;<span class="op" id="4771465">=</span>&nbsp;<span class="builtintype" id="4771467">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771474">z</span><span class="op" id="4771475">.</span><span class="ident" id="4771476">buf</span><span class="op" id="4771479">[</span><span class="num" id="4771480">0</span><span class="op" id="4771481">]</span>&nbsp;<span class="op" id="4771483">=</span>&nbsp;<span class="ident" id="4771485">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771495">z</span><span class="op" id="4771496">.</span><span class="ident" id="4771497">buf</span><span class="op" id="4771500">[</span><span class="num" id="4771501">1</span><span class="op" id="4771502">]</span>&nbsp;<span class="op" id="4771504">=</span>&nbsp;<span class="ident" id="4771506">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771516">z</span><span class="op" id="4771517">.</span><span class="ident" id="4771518">buf</span><span class="op" id="4771521">[</span><span class="num" id="4771522">2</span><span class="op" id="4771523">]</span>&nbsp;<span class="op" id="4771525">=</span>&nbsp;<span class="ident" id="4771527">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771541">z</span><span class="op" id="4771542">.</span><span class="ident" id="4771543">buf</span><span class="op" id="4771546">[</span><span class="num" id="4771547">3</span><span class="op" id="4771548">]</span>&nbsp;<span class="op" id="4771550">=</span>&nbsp;<span class="num" id="4771552">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771556">if</span>&nbsp;<span class="ident" id="4771559">z</span><span class="op" id="4771560">.</span><span class="ident" id="4771561">Extra</span>&nbsp;<span class="op" id="4771567">!=</span>&nbsp;<span class="builtintype" id="4771570">nil</span>&nbsp;<span class="op" id="4771574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771579">z</span><span class="op" id="4771580">.</span><span class="ident" id="4771581">buf</span><span class="op" id="4771584">[</span><span class="num" id="4771585">3</span><span class="op" id="4771586">]</span>&nbsp;<span class="op" id="4771588">|=</span>&nbsp;<span class="num" id="4771591">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771602">if</span>&nbsp;<span class="ident" id="4771605">z</span><span class="op" id="4771606">.</span><span class="ident" id="4771607">Name</span>&nbsp;<span class="op" id="4771612">!=</span>&nbsp;<span class="string" id="4771615">&#34;&#34;</span>&nbsp;<span class="op" id="4771618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771623">z</span><span class="op" id="4771624">.</span><span class="ident" id="4771625">buf</span><span class="op" id="4771628">[</span><span class="num" id="4771629">3</span><span class="op" id="4771630">]</span>&nbsp;<span class="op" id="4771632">|=</span>&nbsp;<span class="num" id="4771635">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771646">if</span>&nbsp;<span class="ident" id="4771649">z</span><span class="op" id="4771650">.</span><span class="ident" id="4771651">Comment</span>&nbsp;<span class="op" id="4771659">!=</span>&nbsp;<span class="string" id="4771662">&#34;&#34;</span>&nbsp;<span class="op" id="4771665">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771670">z</span><span class="op" id="4771671">.</span><span class="ident" id="4771672">buf</span><span class="op" id="4771675">[</span><span class="num" id="4771676">3</span><span class="op" id="4771677">]</span>&nbsp;<span class="op" id="4771679">|=</span>&nbsp;<span class="num" id="4771682">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771693">put4</span><span class="op" id="4771697">(</span><span class="ident" id="4771698">z</span><span class="op" id="4771699">.</span><span class="ident" id="4771700">buf</span><span class="op" id="4771703">[</span><span class="num" id="4771704">4</span><span class="op" id="4771705">:</span><span class="num" id="4771706">8</span><span class="op" id="4771707">]</span><span class="op" id="4771708">,</span>&nbsp;<span class="builtintype" id="4771710">uint32</span><span class="op" id="4771716">(</span><span class="ident" id="4771717">z</span><span class="op" id="4771718">.</span><span class="ident" id="4771719">ModTime</span><span class="op" id="4771726">.</span><span class="ident" id="4771727">Unix</span><span class="op" id="4771731">(</span><span class="op" id="4771732">)</span><span class="op" id="4771733">)</span><span class="op" id="4771734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771738">if</span>&nbsp;<span class="ident" id="4771741">z</span><span class="op" id="4771742">.</span><span class="ident" id="4771743">level</span>&nbsp;<span class="op" id="4771749">==</span>&nbsp;<span class="ident" id="4771752">BestCompression</span>&nbsp;<span class="op" id="4771768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771773">z</span><span class="op" id="4771774">.</span><span class="ident" id="4771775">buf</span><span class="op" id="4771778">[</span><span class="num" id="4771779">8</span><span class="op" id="4771780">]</span>&nbsp;<span class="op" id="4771782">=</span>&nbsp;<span class="num" id="4771784">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771788">}</span>&nbsp;<span class="keyword" id="4771790">else</span>&nbsp;<span class="keyword" id="4771795">if</span>&nbsp;<span class="ident" id="4771798">z</span><span class="op" id="4771799">.</span><span class="ident" id="4771800">level</span>&nbsp;<span class="op" id="4771806">==</span>&nbsp;<span class="ident" id="4771809">BestSpeed</span>&nbsp;<span class="op" id="4771819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771824">z</span><span class="op" id="4771825">.</span><span class="ident" id="4771826">buf</span><span class="op" id="4771829">[</span><span class="num" id="4771830">8</span><span class="op" id="4771831">]</span>&nbsp;<span class="op" id="4771833">=</span>&nbsp;<span class="num" id="4771835">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771839">}</span>&nbsp;<span class="keyword" id="4771841">else</span>&nbsp;<span class="op" id="4771846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771851">z</span><span class="op" id="4771852">.</span><span class="ident" id="4771853">buf</span><span class="op" id="4771856">[</span><span class="num" id="4771857">8</span><span class="op" id="4771858">]</span>&nbsp;<span class="op" id="4771860">=</span>&nbsp;<span class="num" id="4771862">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771866">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771870">z</span><span class="op" id="4771871">.</span><span class="ident" id="4771872">buf</span><span class="op" id="4771875">[</span><span class="num" id="4771876">9</span><span class="op" id="4771877">]</span>&nbsp;<span class="op" id="4771879">=</span>&nbsp;<span class="ident" id="4771881">z</span><span class="op" id="4771882">.</span><span class="ident" id="4771883">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771888">n</span><span class="op" id="4771889">,</span>&nbsp;<span class="ident" id="4771891">z</span><span class="op" id="4771892">.</span><span class="ident" id="4771893">err</span>&nbsp;<span class="op" id="4771897">=</span>&nbsp;<span class="ident" id="4771899">z</span><span class="op" id="4771900">.</span><span class="ident" id="4771901">w</span><span class="op" id="4771902">.</span><span class="ident" id="4771903">Write</span><span class="op" id="4771908">(</span><span class="ident" id="4771909">z</span><span class="op" id="4771910">.</span><span class="ident" id="4771911">buf</span><span class="op" id="4771914">[</span><span class="num" id="4771915">0</span><span class="op" id="4771916">:</span><span class="num" id="4771917">10</span><span class="op" id="4771919">]</span><span class="op" id="4771920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771924">if</span>&nbsp;<span class="ident" id="4771927">z</span><span class="op" id="4771928">.</span><span class="ident" id="4771929">err</span>&nbsp;<span class="op" id="4771933">!=</span>&nbsp;<span class="builtintype" id="4771936">nil</span>&nbsp;<span class="op" id="4771940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771945">return</span>&nbsp;<span class="ident" id="4771952">n</span><span class="op" id="4771953">,</span>&nbsp;<span class="ident" id="4771955">z</span><span class="op" id="4771956">.</span><span class="ident" id="4771957">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4771963">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4771967">if</span>&nbsp;<span class="ident" id="4771970">z</span><span class="op" id="4771971">.</span><span class="ident" id="4771972">Extra</span>&nbsp;<span class="op" id="4771978">!=</span>&nbsp;<span class="builtintype" id="4771981">nil</span>&nbsp;<span class="op" id="4771985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4771990">z</span><span class="op" id="4771991">.</span><span class="ident" id="4771992">err</span>&nbsp;<span class="op" id="4771996">=</span>&nbsp;<span class="ident" id="4771998">z</span><span class="op" id="4771999">.</span><span class="ident" id="4772000">writeBytes</span><span class="op" id="4772010">(</span><span class="ident" id="4772011">z</span><span class="op" id="4772012">.</span><span class="ident" id="4772013">Extra</span><span class="op" id="4772018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772023">if</span>&nbsp;<span class="ident" id="4772026">z</span><span class="op" id="4772027">.</span><span class="ident" id="4772028">err</span>&nbsp;<span class="op" id="4772032">!=</span>&nbsp;<span class="builtintype" id="4772035">nil</span>&nbsp;<span class="op" id="4772039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772045">return</span>&nbsp;<span class="ident" id="4772052">n</span><span class="op" id="4772053">,</span>&nbsp;<span class="ident" id="4772055">z</span><span class="op" id="4772056">.</span><span class="ident" id="4772057">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772064">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772072">if</span>&nbsp;<span class="ident" id="4772075">z</span><span class="op" id="4772076">.</span><span class="ident" id="4772077">Name</span>&nbsp;<span class="op" id="4772082">!=</span>&nbsp;<span class="string" id="4772085">&#34;&#34;</span>&nbsp;<span class="op" id="4772088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772093">z</span><span class="op" id="4772094">.</span><span class="ident" id="4772095">err</span>&nbsp;<span class="op" id="4772099">=</span>&nbsp;<span class="ident" id="4772101">z</span><span class="op" id="4772102">.</span><span class="ident" id="4772103">writeString</span><span class="op" id="4772114">(</span><span class="ident" id="4772115">z</span><span class="op" id="4772116">.</span><span class="ident" id="4772117">Name</span><span class="op" id="4772121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772126">if</span>&nbsp;<span class="ident" id="4772129">z</span><span class="op" id="4772130">.</span><span class="ident" id="4772131">err</span>&nbsp;<span class="op" id="4772135">!=</span>&nbsp;<span class="builtintype" id="4772138">nil</span>&nbsp;<span class="op" id="4772142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772148">return</span>&nbsp;<span class="ident" id="4772155">n</span><span class="op" id="4772156">,</span>&nbsp;<span class="ident" id="4772158">z</span><span class="op" id="4772159">.</span><span class="ident" id="4772160">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772175">if</span>&nbsp;<span class="ident" id="4772178">z</span><span class="op" id="4772179">.</span><span class="ident" id="4772180">Comment</span>&nbsp;<span class="op" id="4772188">!=</span>&nbsp;<span class="string" id="4772191">&#34;&#34;</span>&nbsp;<span class="op" id="4772194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772199">z</span><span class="op" id="4772200">.</span><span class="ident" id="4772201">err</span>&nbsp;<span class="op" id="4772205">=</span>&nbsp;<span class="ident" id="4772207">z</span><span class="op" id="4772208">.</span><span class="ident" id="4772209">writeString</span><span class="op" id="4772220">(</span><span class="ident" id="4772221">z</span><span class="op" id="4772222">.</span><span class="ident" id="4772223">Comment</span><span class="op" id="4772230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772235">if</span>&nbsp;<span class="ident" id="4772238">z</span><span class="op" id="4772239">.</span><span class="ident" id="4772240">err</span>&nbsp;<span class="op" id="4772244">!=</span>&nbsp;<span class="builtintype" id="4772247">nil</span>&nbsp;<span class="op" id="4772251">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772257">return</span>&nbsp;<span class="ident" id="4772264">n</span><span class="op" id="4772265">,</span>&nbsp;<span class="ident" id="4772267">z</span><span class="op" id="4772268">.</span><span class="ident" id="4772269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772284">if</span>&nbsp;<span class="ident" id="4772287">z</span><span class="op" id="4772288">.</span><span class="ident" id="4772289">compressor</span>&nbsp;<span class="op" id="4772300">==</span>&nbsp;<span class="builtintype" id="4772303">nil</span>&nbsp;<span class="op" id="4772307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772312">z</span><span class="op" id="4772313">.</span><span class="ident" id="4772314">compressor</span><span class="op" id="4772324">,</span>&nbsp;<span class="ident" id="4772326">_</span>&nbsp;<span class="op" id="4772328">=</span>&nbsp;<span class="ident" id="4772330">flate</span><span class="op" id="4772335">.</span><span class="ident" id="4772336">NewWriter</span><span class="op" id="4772345">(</span><span class="ident" id="4772346">z</span><span class="op" id="4772347">.</span><span class="ident" id="4772348">w</span><span class="op" id="4772349">,</span>&nbsp;<span class="ident" id="4772351">z</span><span class="op" id="4772352">.</span><span class="ident" id="4772353">level</span><span class="op" id="4772358">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772368">z</span><span class="op" id="4772369">.</span><span class="ident" id="4772370">size</span>&nbsp;<span class="op" id="4772375">+=</span>&nbsp;<span class="builtintype" id="4772378">uint32</span><span class="op" id="4772384">(</span><span class="builtinfunc" id="4772385">len</span><span class="op" id="4772388">(</span><span class="ident" id="4772389">p</span><span class="op" id="4772390">)</span><span class="op" id="4772391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772394">z</span><span class="op" id="4772395">.</span><span class="ident" id="4772396">digest</span><span class="op" id="4772402">.</span><span class="ident" id="4772403">Write</span><span class="op" id="4772408">(</span><span class="ident" id="4772409">p</span><span class="op" id="4772410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4772413">n</span><span class="op" id="4772414">,</span>&nbsp;<span class="ident" id="4772416">z</span><span class="op" id="4772417">.</span><span class="ident" id="4772418">err</span>&nbsp;<span class="op" id="4772422">=</span>&nbsp;<span class="ident" id="4772424">z</span><span class="op" id="4772425">.</span><span class="ident" id="4772426">compressor</span><span class="op" id="4772436">.</span><span class="ident" id="4772437">Write</span><span class="op" id="4772442">(</span><span class="ident" id="4772443">p</span><span class="op" id="4772444">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772447">return</span>&nbsp;<span class="ident" id="4772454">n</span><span class="op" id="4772455">,</span>&nbsp;<span class="ident" id="4772457">z</span><span class="op" id="4772458">.</span><span class="ident" id="4772459">err</span><br>
<span class="lineno"></span><span class="op" id="4772463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4772466">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4772537">//</span><br>
<span class="lineno">225</span><span class="comment" id="4772540">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4772611">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4772682">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4772747">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4772801">//</span><br>
<span class="lineno">230</span><span class="comment" id="4772804">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4772884">func</span>&nbsp;<span class="op" id="4772889">(</span><span class="ident" id="4772890">z</span>&nbsp;<span class="op" id="4772892">*</span><span class="ident" id="4772893">Writer</span><span class="op" id="4772899">)</span>&nbsp;<span class="ident" id="4772901">Flush</span><span class="op" id="4772906">(</span><span class="op" id="4772907">)</span>&nbsp;<span class="builtintype" id="4772909">error</span>&nbsp;<span class="op" id="4772915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772918">if</span>&nbsp;<span class="ident" id="4772921">z</span><span class="op" id="4772922">.</span><span class="ident" id="4772923">err</span>&nbsp;<span class="op" id="4772927">!=</span>&nbsp;<span class="builtintype" id="4772930">nil</span>&nbsp;<span class="op" id="4772934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772938">return</span>&nbsp;<span class="ident" id="4772945">z</span><span class="op" id="4772946">.</span><span class="ident" id="4772947">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772952">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772955">if</span>&nbsp;<span class="ident" id="4772958">z</span><span class="op" id="4772959">.</span><span class="ident" id="4772960">closed</span>&nbsp;<span class="op" id="4772967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772971">return</span>&nbsp;<span class="builtintype" id="4772978">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4772983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4772986">if</span>&nbsp;<span class="op" id="4772989">!</span><span class="ident" id="4772990">z</span><span class="op" id="4772991">.</span><span class="ident" id="4772992">wroteHeader</span>&nbsp;<span class="op" id="4773004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773008">z</span><span class="op" id="4773009">.</span><span class="ident" id="4773010">Write</span><span class="op" id="4773015">(</span><span class="builtintype" id="4773016">nil</span><span class="op" id="4773019">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773023">if</span>&nbsp;<span class="ident" id="4773026">z</span><span class="op" id="4773027">.</span><span class="ident" id="4773028">err</span>&nbsp;<span class="op" id="4773032">!=</span>&nbsp;<span class="builtintype" id="4773035">nil</span>&nbsp;<span class="op" id="4773039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773044">return</span>&nbsp;<span class="ident" id="4773051">z</span><span class="op" id="4773052">.</span><span class="ident" id="4773053">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773065">z</span><span class="op" id="4773066">.</span><span class="ident" id="4773067">err</span>&nbsp;<span class="op" id="4773071">=</span>&nbsp;<span class="ident" id="4773073">z</span><span class="op" id="4773074">.</span><span class="ident" id="4773075">compressor</span><span class="op" id="4773085">.</span><span class="ident" id="4773086">Flush</span><span class="op" id="4773091">(</span><span class="op" id="4773092">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773095">return</span>&nbsp;<span class="ident" id="4773102">z</span><span class="op" id="4773103">.</span><span class="ident" id="4773104">err</span><br>
<span class="lineno"></span><span class="op" id="4773108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4773111">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4773185">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4773244">func</span>&nbsp;<span class="op" id="4773249">(</span><span class="ident" id="4773250">z</span>&nbsp;<span class="op" id="4773252">*</span><span class="ident" id="4773253">Writer</span><span class="op" id="4773259">)</span>&nbsp;<span class="ident" id="4773261">Close</span><span class="op" id="4773266">(</span><span class="op" id="4773267">)</span>&nbsp;<span class="builtintype" id="4773269">error</span>&nbsp;<span class="op" id="4773275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773278">if</span>&nbsp;<span class="ident" id="4773281">z</span><span class="op" id="4773282">.</span><span class="ident" id="4773283">err</span>&nbsp;<span class="op" id="4773287">!=</span>&nbsp;<span class="builtintype" id="4773290">nil</span>&nbsp;<span class="op" id="4773294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773298">return</span>&nbsp;<span class="ident" id="4773305">z</span><span class="op" id="4773306">.</span><span class="ident" id="4773307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773315">if</span>&nbsp;<span class="ident" id="4773318">z</span><span class="op" id="4773319">.</span><span class="ident" id="4773320">closed</span>&nbsp;<span class="op" id="4773327">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773331">return</span>&nbsp;<span class="builtintype" id="4773338">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773346">z</span><span class="op" id="4773347">.</span><span class="ident" id="4773348">closed</span>&nbsp;<span class="op" id="4773355">=</span>&nbsp;<span class="builtintype" id="4773357">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773363">if</span>&nbsp;<span class="op" id="4773366">!</span><span class="ident" id="4773367">z</span><span class="op" id="4773368">.</span><span class="ident" id="4773369">wroteHeader</span>&nbsp;<span class="op" id="4773381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773385">z</span><span class="op" id="4773386">.</span><span class="ident" id="4773387">Write</span><span class="op" id="4773392">(</span><span class="builtintype" id="4773393">nil</span><span class="op" id="4773396">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773400">if</span>&nbsp;<span class="ident" id="4773403">z</span><span class="op" id="4773404">.</span><span class="ident" id="4773405">err</span>&nbsp;<span class="op" id="4773409">!=</span>&nbsp;<span class="builtintype" id="4773412">nil</span>&nbsp;<span class="op" id="4773416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773421">return</span>&nbsp;<span class="ident" id="4773428">z</span><span class="op" id="4773429">.</span><span class="ident" id="4773430">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773442">z</span><span class="op" id="4773443">.</span><span class="ident" id="4773444">err</span>&nbsp;<span class="op" id="4773448">=</span>&nbsp;<span class="ident" id="4773450">z</span><span class="op" id="4773451">.</span><span class="ident" id="4773452">compressor</span><span class="op" id="4773462">.</span><span class="ident" id="4773463">Close</span><span class="op" id="4773468">(</span><span class="op" id="4773469">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773472">if</span>&nbsp;<span class="ident" id="4773475">z</span><span class="op" id="4773476">.</span><span class="ident" id="4773477">err</span>&nbsp;<span class="op" id="4773481">!=</span>&nbsp;<span class="builtintype" id="4773484">nil</span>&nbsp;<span class="op" id="4773488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773492">return</span>&nbsp;<span class="ident" id="4773499">z</span><span class="op" id="4773500">.</span><span class="ident" id="4773501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4773506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773509">put4</span><span class="op" id="4773513">(</span><span class="ident" id="4773514">z</span><span class="op" id="4773515">.</span><span class="ident" id="4773516">buf</span><span class="op" id="4773519">[</span><span class="num" id="4773520">0</span><span class="op" id="4773521">:</span><span class="num" id="4773522">4</span><span class="op" id="4773523">]</span><span class="op" id="4773524">,</span>&nbsp;<span class="ident" id="4773526">z</span><span class="op" id="4773527">.</span><span class="ident" id="4773528">digest</span><span class="op" id="4773534">.</span><span class="ident" id="4773535">Sum32</span><span class="op" id="4773540">(</span><span class="op" id="4773541">)</span><span class="op" id="4773542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773545">put4</span><span class="op" id="4773549">(</span><span class="ident" id="4773550">z</span><span class="op" id="4773551">.</span><span class="ident" id="4773552">buf</span><span class="op" id="4773555">[</span><span class="num" id="4773556">4</span><span class="op" id="4773557">:</span><span class="num" id="4773558">8</span><span class="op" id="4773559">]</span><span class="op" id="4773560">,</span>&nbsp;<span class="ident" id="4773562">z</span><span class="op" id="4773563">.</span><span class="ident" id="4773564">size</span><span class="op" id="4773568">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4773571">_</span><span class="op" id="4773572">,</span>&nbsp;<span class="ident" id="4773574">z</span><span class="op" id="4773575">.</span><span class="ident" id="4773576">err</span>&nbsp;<span class="op" id="4773580">=</span>&nbsp;<span class="ident" id="4773582">z</span><span class="op" id="4773583">.</span><span class="ident" id="4773584">w</span><span class="op" id="4773585">.</span><span class="ident" id="4773586">Write</span><span class="op" id="4773591">(</span><span class="ident" id="4773592">z</span><span class="op" id="4773593">.</span><span class="ident" id="4773594">buf</span><span class="op" id="4773597">[</span><span class="num" id="4773598">0</span><span class="op" id="4773599">:</span><span class="num" id="4773600">8</span><span class="op" id="4773601">]</span><span class="op" id="4773602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4773605">return</span>&nbsp;<span class="ident" id="4773612">z</span><span class="op" id="4773613">.</span><span class="ident" id="4773614">err</span><br>
<span class="lineno"></span><span class="op" id="4773618">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
