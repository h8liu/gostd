<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html" class="current">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3464171">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3464227">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3464281">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3464332">package</span>&nbsp;<span class="ident" id="3464340">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3464348">import</span>&nbsp;<span class="op" id="3464355">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3464358">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3464366">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3464377">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3464388">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3464403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464406">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="3464468">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3464507">type</span>&nbsp;<span class="ident" id="3464512">Error</span>&nbsp;<span class="keyword" id="3464518">struct</span>&nbsp;<span class="op" id="3464525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464528">Code</span>&nbsp;<span class="ident" id="3464533">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464544">Expr</span>&nbsp;<span class="builtintype" id="3464549">string</span><br>
<span class="lineno"></span><span class="op" id="3464556">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3464559">func</span>&nbsp;<span class="op" id="3464564">(</span><span class="ident" id="3464565">e</span>&nbsp;<span class="op" id="3464567">*</span><span class="ident" id="3464568">Error</span><span class="op" id="3464573">)</span>&nbsp;<span class="ident" id="3464575">Error</span><span class="op" id="3464580">(</span><span class="op" id="3464581">)</span>&nbsp;<span class="builtintype" id="3464583">string</span>&nbsp;<span class="op" id="3464590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464593">return</span>&nbsp;<span class="string" id="3464600">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="3464625">+</span>&nbsp;<span class="ident" id="3464627">e</span><span class="op" id="3464628">.</span><span class="ident" id="3464629">Code</span><span class="op" id="3464633">.</span><span class="ident" id="3464634">String</span><span class="op" id="3464640">(</span><span class="op" id="3464641">)</span>&nbsp;<span class="op" id="3464643">+</span>&nbsp;<span class="string" id="3464645">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="3464651">+</span>&nbsp;<span class="ident" id="3464653">e</span><span class="op" id="3464654">.</span><span class="ident" id="3464655">Expr</span>&nbsp;<span class="op" id="3464660">+</span>&nbsp;<span class="string" id="3464662">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="3464666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3464669">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3464736">type</span>&nbsp;<span class="ident" id="3464741">ErrorCode</span>&nbsp;<span class="builtintype" id="3464751">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3464759">const</span>&nbsp;<span class="op" id="3464765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464768">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464789">ErrInternalError</span>&nbsp;<span class="ident" id="3464806">ErrorCode</span>&nbsp;<span class="op" id="3464816">=</span>&nbsp;<span class="string" id="3464818">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464852">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464869">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464894">ErrorCode</span>&nbsp;<span class="op" id="3464904">=</span>&nbsp;<span class="string" id="3464906">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464933">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464958">ErrorCode</span>&nbsp;<span class="op" id="3464968">=</span>&nbsp;<span class="string" id="3464970">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465003">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465028">ErrorCode</span>&nbsp;<span class="op" id="3465038">=</span>&nbsp;<span class="string" id="3465040">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465067">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3465092">ErrorCode</span>&nbsp;<span class="op" id="3465102">=</span>&nbsp;<span class="string" id="3465104">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465129">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465154">ErrorCode</span>&nbsp;<span class="op" id="3465164">=</span>&nbsp;<span class="string" id="3465166">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465204">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465229">ErrorCode</span>&nbsp;<span class="op" id="3465239">=</span>&nbsp;<span class="string" id="3465241">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465279">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465304">ErrorCode</span>&nbsp;<span class="op" id="3465314">=</span>&nbsp;<span class="string" id="3465316">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465340">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465365">ErrorCode</span>&nbsp;<span class="op" id="3465375">=</span>&nbsp;<span class="string" id="3465377">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465394">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465419">ErrorCode</span>&nbsp;<span class="op" id="3465429">=</span>&nbsp;<span class="string" id="3465431">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465452">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465477">ErrorCode</span>&nbsp;<span class="op" id="3465487">=</span>&nbsp;<span class="string" id="3465489">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465510">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="3465535">ErrorCode</span>&nbsp;<span class="op" id="3465545">=</span>&nbsp;<span class="string" id="3465547">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465590">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465615">ErrorCode</span>&nbsp;<span class="op" id="3465625">=</span>&nbsp;<span class="string" id="3465627">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465670">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465695">ErrorCode</span>&nbsp;<span class="op" id="3465705">=</span>&nbsp;<span class="string" id="3465707">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="3465722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3465725">func</span>&nbsp;<span class="op" id="3465730">(</span><span class="ident" id="3465731">e</span>&nbsp;<span class="ident" id="3465733">ErrorCode</span><span class="op" id="3465742">)</span>&nbsp;<span class="ident" id="3465744">String</span><span class="op" id="3465750">(</span><span class="op" id="3465751">)</span>&nbsp;<span class="builtintype" id="3465753">string</span>&nbsp;<span class="op" id="3465760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465763">return</span>&nbsp;<span class="builtintype" id="3465770">string</span><span class="op" id="3465776">(</span><span class="ident" id="3465777">e</span><span class="op" id="3465778">)</span><br>
<span class="lineno">50</span><span class="op" id="3465780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465783">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3465872">type</span>&nbsp;<span class="ident" id="3465877">Flags</span>&nbsp;<span class="builtintype" id="3465883">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3465891">const</span>&nbsp;<span class="op" id="3465897">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465900">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465914">Flags</span>&nbsp;<span class="op" id="3465920">=</span>&nbsp;<span class="num" id="3465922">1</span>&nbsp;<span class="op" id="3465924">&lt;&lt;</span>&nbsp;<span class="ident" id="3465927">iota</span>&nbsp;<span class="comment" id="3465932">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465959">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3465991">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466027">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466059">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466132">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466164">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466193">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466225">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466289">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466321">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466373">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466405">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466431">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466463">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466521">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466553">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466588">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466620">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466663">MatchNL</span>&nbsp;<span class="op" id="3466671">=</span>&nbsp;<span class="ident" id="3466673">ClassNL</span>&nbsp;<span class="op" id="3466681">|</span>&nbsp;<span class="ident" id="3466683">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466691">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466703">=</span>&nbsp;<span class="ident" id="3466705">ClassNL</span>&nbsp;<span class="op" id="3466713">|</span>&nbsp;<span class="ident" id="3466715">OneLine</span>&nbsp;<span class="op" id="3466723">|</span>&nbsp;<span class="ident" id="3466725">PerlX</span>&nbsp;<span class="op" id="3466731">|</span>&nbsp;<span class="ident" id="3466733">UnicodeGroups</span>&nbsp;<span class="comment" id="3466747">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466780">POSIX</span>&nbsp;<span class="ident" id="3466786">Flags</span>&nbsp;<span class="op" id="3466792">=</span>&nbsp;<span class="num" id="3466794">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466836">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="3466852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466855">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="3466888">const</span>&nbsp;<span class="op" id="3466894">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466897">opLeftParen</span>&nbsp;<span class="op" id="3466909">=</span>&nbsp;<span class="ident" id="3466911">opPseudo</span>&nbsp;<span class="op" id="3466920">+</span>&nbsp;<span class="ident" id="3466922">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466928">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="3466942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3466945">type</span>&nbsp;<span class="ident" id="3466950">parser</span>&nbsp;<span class="keyword" id="3466957">struct</span>&nbsp;<span class="op" id="3466964">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466967">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466979">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466989">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467010">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467022">[</span><span class="op" id="3467023">]</span><span class="op" id="3467024">*</span><span class="ident" id="3467025">Regexp</span>&nbsp;<span class="comment" id="3467032">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467064">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467076">*</span><span class="ident" id="3467077">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467085">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3467097">int</span>&nbsp;<span class="comment" id="3467101">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467137">wholeRegexp</span>&nbsp;<span class="builtintype" id="3467149">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467157">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467169">[</span><span class="op" id="3467170">]</span><span class="builtintype" id="3467171">rune</span>&nbsp;<span class="comment" id="3467176">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="3467211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3467214">func</span>&nbsp;<span class="op" id="3467219">(</span><span class="ident" id="3467220">p</span>&nbsp;<span class="op" id="3467222">*</span><span class="ident" id="3467223">parser</span><span class="op" id="3467229">)</span>&nbsp;<span class="ident" id="3467231">newRegexp</span><span class="op" id="3467240">(</span><span class="ident" id="3467241">op</span>&nbsp;<span class="ident" id="3467244">Op</span><span class="op" id="3467246">)</span>&nbsp;<span class="op" id="3467248">*</span><span class="ident" id="3467249">Regexp</span>&nbsp;<span class="op" id="3467256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467259">re</span>&nbsp;<span class="op" id="3467262">:=</span>&nbsp;<span class="ident" id="3467265">p</span><span class="op" id="3467266">.</span><span class="ident" id="3467267">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467273">if</span>&nbsp;<span class="ident" id="3467276">re</span>&nbsp;<span class="op" id="3467279">!=</span>&nbsp;<span class="builtintype" id="3467282">nil</span>&nbsp;<span class="op" id="3467286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467290">p</span><span class="op" id="3467291">.</span><span class="ident" id="3467292">free</span>&nbsp;<span class="op" id="3467297">=</span>&nbsp;<span class="ident" id="3467299">re</span><span class="op" id="3467301">.</span><span class="ident" id="3467302">Sub0</span><span class="op" id="3467306">[</span><span class="num" id="3467307">0</span><span class="op" id="3467308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467312">*</span><span class="ident" id="3467313">re</span>&nbsp;<span class="op" id="3467316">=</span>&nbsp;<span class="ident" id="3467318">Regexp</span><span class="op" id="3467324">{</span><span class="op" id="3467325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467328">}</span>&nbsp;<span class="keyword" id="3467330">else</span>&nbsp;<span class="op" id="3467335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467339">re</span>&nbsp;<span class="op" id="3467342">=</span>&nbsp;<span class="builtinfunc" id="3467344">new</span><span class="op" id="3467347">(</span><span class="ident" id="3467348">Regexp</span><span class="op" id="3467354">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467360">re</span><span class="op" id="3467362">.</span><span class="ident" id="3467363">Op</span>&nbsp;<span class="op" id="3467366">=</span>&nbsp;<span class="ident" id="3467368">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467372">return</span>&nbsp;<span class="ident" id="3467379">re</span><br>
<span class="lineno"></span><span class="op" id="3467382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3467385">func</span>&nbsp;<span class="op" id="3467390">(</span><span class="ident" id="3467391">p</span>&nbsp;<span class="op" id="3467393">*</span><span class="ident" id="3467394">parser</span><span class="op" id="3467400">)</span>&nbsp;<span class="ident" id="3467402">reuse</span><span class="op" id="3467407">(</span><span class="ident" id="3467408">re</span>&nbsp;<span class="op" id="3467411">*</span><span class="ident" id="3467412">Regexp</span><span class="op" id="3467418">)</span>&nbsp;<span class="op" id="3467420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467423">re</span><span class="op" id="3467425">.</span><span class="ident" id="3467426">Sub0</span><span class="op" id="3467430">[</span><span class="num" id="3467431">0</span><span class="op" id="3467432">]</span>&nbsp;<span class="op" id="3467434">=</span>&nbsp;<span class="ident" id="3467436">p</span><span class="op" id="3467437">.</span><span class="ident" id="3467438">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467444">p</span><span class="op" id="3467445">.</span><span class="ident" id="3467446">free</span>&nbsp;<span class="op" id="3467451">=</span>&nbsp;<span class="ident" id="3467453">re</span><br>
<span class="lineno"></span><span class="op" id="3467456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3467459">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3467489">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="3467563">func</span>&nbsp;<span class="op" id="3467568">(</span><span class="ident" id="3467569">p</span>&nbsp;<span class="op" id="3467571">*</span><span class="ident" id="3467572">parser</span><span class="op" id="3467578">)</span>&nbsp;<span class="ident" id="3467580">push</span><span class="op" id="3467584">(</span><span class="ident" id="3467585">re</span>&nbsp;<span class="op" id="3467588">*</span><span class="ident" id="3467589">Regexp</span><span class="op" id="3467595">)</span>&nbsp;<span class="op" id="3467597">*</span><span class="ident" id="3467598">Regexp</span>&nbsp;<span class="op" id="3467605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467608">if</span>&nbsp;<span class="ident" id="3467611">re</span><span class="op" id="3467613">.</span><span class="ident" id="3467614">Op</span>&nbsp;<span class="op" id="3467617">==</span>&nbsp;<span class="ident" id="3467620">OpCharClass</span>&nbsp;<span class="op" id="3467632">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3467635">len</span><span class="op" id="3467638">(</span><span class="ident" id="3467639">re</span><span class="op" id="3467641">.</span><span class="ident" id="3467642">Rune</span><span class="op" id="3467646">)</span>&nbsp;<span class="op" id="3467648">==</span>&nbsp;<span class="num" id="3467651">2</span>&nbsp;<span class="op" id="3467653">&amp;&amp;</span>&nbsp;<span class="ident" id="3467656">re</span><span class="op" id="3467658">.</span><span class="ident" id="3467659">Rune</span><span class="op" id="3467663">[</span><span class="num" id="3467664">0</span><span class="op" id="3467665">]</span>&nbsp;<span class="op" id="3467667">==</span>&nbsp;<span class="ident" id="3467670">re</span><span class="op" id="3467672">.</span><span class="ident" id="3467673">Rune</span><span class="op" id="3467677">[</span><span class="num" id="3467678">1</span><span class="op" id="3467679">]</span>&nbsp;<span class="op" id="3467681">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3467685">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467703">if</span>&nbsp;<span class="ident" id="3467706">p</span><span class="op" id="3467707">.</span><span class="ident" id="3467708">maybeConcat</span><span class="op" id="3467719">(</span><span class="ident" id="3467720">re</span><span class="op" id="3467722">.</span><span class="ident" id="3467723">Rune</span><span class="op" id="3467727">[</span><span class="num" id="3467728">0</span><span class="op" id="3467729">]</span><span class="op" id="3467730">,</span>&nbsp;<span class="ident" id="3467732">p</span><span class="op" id="3467733">.</span><span class="ident" id="3467734">flags</span><span class="op" id="3467739">&amp;^</span><span class="ident" id="3467741">FoldCase</span><span class="op" id="3467749">)</span>&nbsp;<span class="op" id="3467751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3467756">return</span>&nbsp;<span class="builtintype" id="3467763">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467773">re</span><span class="op" id="3467775">.</span><span class="ident" id="3467776">Op</span>&nbsp;<span class="op" id="3467779">=</span>&nbsp;<span class="ident" id="3467781">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467793">re</span><span class="op" id="3467795">.</span><span class="ident" id="3467796">Rune</span>&nbsp;<span class="op" id="3467801">=</span>&nbsp;<span class="ident" id="3467803">re</span><span class="op" id="3467805">.</span><span class="ident" id="3467806">Rune</span><span class="op" id="3467810">[</span><span class="op" id="3467811">:</span><span class="num" id="3467812">1</span><span class="op" id="3467813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467817">re</span><span class="op" id="3467819">.</span><span class="ident" id="3467820">Flags</span>&nbsp;<span class="op" id="3467826">=</span>&nbsp;<span class="ident" id="3467828">p</span><span class="op" id="3467829">.</span><span class="ident" id="3467830">flags</span>&nbsp;<span class="op" id="3467836">&amp;^</span>&nbsp;<span class="ident" id="3467839">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3467849">}</span>&nbsp;<span class="keyword" id="3467851">else</span>&nbsp;<span class="keyword" id="3467856">if</span>&nbsp;<span class="ident" id="3467859">re</span><span class="op" id="3467861">.</span><span class="ident" id="3467862">Op</span>&nbsp;<span class="op" id="3467865">==</span>&nbsp;<span class="ident" id="3467868">OpCharClass</span>&nbsp;<span class="op" id="3467880">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3467883">len</span><span class="op" id="3467886">(</span><span class="ident" id="3467887">re</span><span class="op" id="3467889">.</span><span class="ident" id="3467890">Rune</span><span class="op" id="3467894">)</span>&nbsp;<span class="op" id="3467896">==</span>&nbsp;<span class="num" id="3467899">4</span>&nbsp;<span class="op" id="3467901">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467906">re</span><span class="op" id="3467908">.</span><span class="ident" id="3467909">Rune</span><span class="op" id="3467913">[</span><span class="num" id="3467914">0</span><span class="op" id="3467915">]</span>&nbsp;<span class="op" id="3467917">==</span>&nbsp;<span class="ident" id="3467920">re</span><span class="op" id="3467922">.</span><span class="ident" id="3467923">Rune</span><span class="op" id="3467927">[</span><span class="num" id="3467928">1</span><span class="op" id="3467929">]</span>&nbsp;<span class="op" id="3467931">&amp;&amp;</span>&nbsp;<span class="ident" id="3467934">re</span><span class="op" id="3467936">.</span><span class="ident" id="3467937">Rune</span><span class="op" id="3467941">[</span><span class="num" id="3467942">2</span><span class="op" id="3467943">]</span>&nbsp;<span class="op" id="3467945">==</span>&nbsp;<span class="ident" id="3467948">re</span><span class="op" id="3467950">.</span><span class="ident" id="3467951">Rune</span><span class="op" id="3467955">[</span><span class="num" id="3467956">3</span><span class="op" id="3467957">]</span>&nbsp;<span class="op" id="3467959">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3467964">unicode</span><span class="op" id="3467971">.</span><span class="ident" id="3467972">SimpleFold</span><span class="op" id="3467982">(</span><span class="ident" id="3467983">re</span><span class="op" id="3467985">.</span><span class="ident" id="3467986">Rune</span><span class="op" id="3467990">[</span><span class="num" id="3467991">0</span><span class="op" id="3467992">]</span><span class="op" id="3467993">)</span>&nbsp;<span class="op" id="3467995">==</span>&nbsp;<span class="ident" id="3467998">re</span><span class="op" id="3468000">.</span><span class="ident" id="3468001">Rune</span><span class="op" id="3468005">[</span><span class="num" id="3468006">2</span><span class="op" id="3468007">]</span>&nbsp;<span class="op" id="3468009">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468014">unicode</span><span class="op" id="3468021">.</span><span class="ident" id="3468022">SimpleFold</span><span class="op" id="3468032">(</span><span class="ident" id="3468033">re</span><span class="op" id="3468035">.</span><span class="ident" id="3468036">Rune</span><span class="op" id="3468040">[</span><span class="num" id="3468041">2</span><span class="op" id="3468042">]</span><span class="op" id="3468043">)</span>&nbsp;<span class="op" id="3468045">==</span>&nbsp;<span class="ident" id="3468048">re</span><span class="op" id="3468050">.</span><span class="ident" id="3468051">Rune</span><span class="op" id="3468055">[</span><span class="num" id="3468056">0</span><span class="op" id="3468057">]</span>&nbsp;<span class="op" id="3468059">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468064">re</span><span class="op" id="3468066">.</span><span class="ident" id="3468067">Op</span>&nbsp;<span class="op" id="3468070">==</span>&nbsp;<span class="ident" id="3468073">OpCharClass</span>&nbsp;<span class="op" id="3468085">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3468088">len</span><span class="op" id="3468091">(</span><span class="ident" id="3468092">re</span><span class="op" id="3468094">.</span><span class="ident" id="3468095">Rune</span><span class="op" id="3468099">)</span>&nbsp;<span class="op" id="3468101">==</span>&nbsp;<span class="num" id="3468104">2</span>&nbsp;<span class="op" id="3468106">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468112">re</span><span class="op" id="3468114">.</span><span class="ident" id="3468115">Rune</span><span class="op" id="3468119">[</span><span class="num" id="3468120">0</span><span class="op" id="3468121">]</span><span class="op" id="3468122">+</span><span class="num" id="3468123">1</span>&nbsp;<span class="op" id="3468125">==</span>&nbsp;<span class="ident" id="3468128">re</span><span class="op" id="3468130">.</span><span class="ident" id="3468131">Rune</span><span class="op" id="3468135">[</span><span class="num" id="3468136">1</span><span class="op" id="3468137">]</span>&nbsp;<span class="op" id="3468139">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468145">unicode</span><span class="op" id="3468152">.</span><span class="ident" id="3468153">SimpleFold</span><span class="op" id="3468163">(</span><span class="ident" id="3468164">re</span><span class="op" id="3468166">.</span><span class="ident" id="3468167">Rune</span><span class="op" id="3468171">[</span><span class="num" id="3468172">0</span><span class="op" id="3468173">]</span><span class="op" id="3468174">)</span>&nbsp;<span class="op" id="3468176">==</span>&nbsp;<span class="ident" id="3468179">re</span><span class="op" id="3468181">.</span><span class="ident" id="3468182">Rune</span><span class="op" id="3468186">[</span><span class="num" id="3468187">1</span><span class="op" id="3468188">]</span>&nbsp;<span class="op" id="3468190">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468196">unicode</span><span class="op" id="3468203">.</span><span class="ident" id="3468204">SimpleFold</span><span class="op" id="3468214">(</span><span class="ident" id="3468215">re</span><span class="op" id="3468217">.</span><span class="ident" id="3468218">Rune</span><span class="op" id="3468222">[</span><span class="num" id="3468223">1</span><span class="op" id="3468224">]</span><span class="op" id="3468225">)</span>&nbsp;<span class="op" id="3468227">==</span>&nbsp;<span class="ident" id="3468230">re</span><span class="op" id="3468232">.</span><span class="ident" id="3468233">Rune</span><span class="op" id="3468237">[</span><span class="num" id="3468238">0</span><span class="op" id="3468239">]</span>&nbsp;<span class="op" id="3468241">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468245">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468293">if</span>&nbsp;<span class="ident" id="3468296">p</span><span class="op" id="3468297">.</span><span class="ident" id="3468298">maybeConcat</span><span class="op" id="3468309">(</span><span class="ident" id="3468310">re</span><span class="op" id="3468312">.</span><span class="ident" id="3468313">Rune</span><span class="op" id="3468317">[</span><span class="num" id="3468318">0</span><span class="op" id="3468319">]</span><span class="op" id="3468320">,</span>&nbsp;<span class="ident" id="3468322">p</span><span class="op" id="3468323">.</span><span class="ident" id="3468324">flags</span><span class="op" id="3468329">|</span><span class="ident" id="3468330">FoldCase</span><span class="op" id="3468338">)</span>&nbsp;<span class="op" id="3468340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468345">return</span>&nbsp;<span class="builtintype" id="3468352">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468363">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468407">re</span><span class="op" id="3468409">.</span><span class="ident" id="3468410">Op</span>&nbsp;<span class="op" id="3468413">=</span>&nbsp;<span class="ident" id="3468415">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468427">re</span><span class="op" id="3468429">.</span><span class="ident" id="3468430">Rune</span>&nbsp;<span class="op" id="3468435">=</span>&nbsp;<span class="ident" id="3468437">re</span><span class="op" id="3468439">.</span><span class="ident" id="3468440">Rune</span><span class="op" id="3468444">[</span><span class="op" id="3468445">:</span><span class="num" id="3468446">1</span><span class="op" id="3468447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468451">re</span><span class="op" id="3468453">.</span><span class="ident" id="3468454">Flags</span>&nbsp;<span class="op" id="3468460">=</span>&nbsp;<span class="ident" id="3468462">p</span><span class="op" id="3468463">.</span><span class="ident" id="3468464">flags</span>&nbsp;<span class="op" id="3468470">|</span>&nbsp;<span class="ident" id="3468472">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468482">}</span>&nbsp;<span class="keyword" id="3468484">else</span>&nbsp;<span class="op" id="3468489">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3468493">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468525">p</span><span class="op" id="3468526">.</span><span class="ident" id="3468527">maybeConcat</span><span class="op" id="3468538">(</span><span class="op" id="3468539">-</span><span class="num" id="3468540">1</span><span class="op" id="3468541">,</span>&nbsp;<span class="num" id="3468543">0</span><span class="op" id="3468544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3468547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3468551">p</span><span class="op" id="3468552">.</span><span class="ident" id="3468553">stack</span>&nbsp;<span class="op" id="3468559">=</span>&nbsp;<span class="builtinfunc" id="3468561">append</span><span class="op" id="3468567">(</span><span class="ident" id="3468568">p</span><span class="op" id="3468569">.</span><span class="ident" id="3468570">stack</span><span class="op" id="3468575">,</span>&nbsp;<span class="ident" id="3468577">re</span><span class="op" id="3468579">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3468582">return</span>&nbsp;<span class="ident" id="3468589">re</span><br>
<span class="lineno"></span><span class="op" id="3468592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3468595">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="3468647">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="3468709">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3468768">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="3468831">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="3468895">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="3468937">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="3469000">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="3469035">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="3469080">func</span>&nbsp;<span class="op" id="3469085">(</span><span class="ident" id="3469086">p</span>&nbsp;<span class="op" id="3469088">*</span><span class="ident" id="3469089">parser</span><span class="op" id="3469095">)</span>&nbsp;<span class="ident" id="3469097">maybeConcat</span><span class="op" id="3469108">(</span><span class="ident" id="3469109">r</span>&nbsp;<span class="builtintype" id="3469111">rune</span><span class="op" id="3469115">,</span>&nbsp;<span class="ident" id="3469117">flags</span>&nbsp;<span class="ident" id="3469123">Flags</span><span class="op" id="3469128">)</span>&nbsp;<span class="builtintype" id="3469130">bool</span>&nbsp;<span class="op" id="3469135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469138">n</span>&nbsp;<span class="op" id="3469140">:=</span>&nbsp;<span class="builtinfunc" id="3469143">len</span><span class="op" id="3469146">(</span><span class="ident" id="3469147">p</span><span class="op" id="3469148">.</span><span class="ident" id="3469149">stack</span><span class="op" id="3469154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469157">if</span>&nbsp;<span class="ident" id="3469160">n</span>&nbsp;<span class="op" id="3469162">&lt;</span>&nbsp;<span class="num" id="3469164">2</span>&nbsp;<span class="op" id="3469166">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469170">return</span>&nbsp;<span class="builtintype" id="3469177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469188">re1</span>&nbsp;<span class="op" id="3469192">:=</span>&nbsp;<span class="ident" id="3469195">p</span><span class="op" id="3469196">.</span><span class="ident" id="3469197">stack</span><span class="op" id="3469202">[</span><span class="ident" id="3469203">n</span><span class="op" id="3469204">-</span><span class="num" id="3469205">1</span><span class="op" id="3469206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469209">re2</span>&nbsp;<span class="op" id="3469213">:=</span>&nbsp;<span class="ident" id="3469216">p</span><span class="op" id="3469217">.</span><span class="ident" id="3469218">stack</span><span class="op" id="3469223">[</span><span class="ident" id="3469224">n</span><span class="op" id="3469225">-</span><span class="num" id="3469226">2</span><span class="op" id="3469227">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469230">if</span>&nbsp;<span class="ident" id="3469233">re1</span><span class="op" id="3469236">.</span><span class="ident" id="3469237">Op</span>&nbsp;<span class="op" id="3469240">!=</span>&nbsp;<span class="ident" id="3469243">OpLiteral</span>&nbsp;<span class="op" id="3469253">||</span>&nbsp;<span class="ident" id="3469256">re2</span><span class="op" id="3469259">.</span><span class="ident" id="3469260">Op</span>&nbsp;<span class="op" id="3469263">!=</span>&nbsp;<span class="ident" id="3469266">OpLiteral</span>&nbsp;<span class="op" id="3469276">||</span>&nbsp;<span class="ident" id="3469279">re1</span><span class="op" id="3469282">.</span><span class="ident" id="3469283">Flags</span><span class="op" id="3469288">&amp;</span><span class="ident" id="3469289">FoldCase</span>&nbsp;<span class="op" id="3469298">!=</span>&nbsp;<span class="ident" id="3469301">re2</span><span class="op" id="3469304">.</span><span class="ident" id="3469305">Flags</span><span class="op" id="3469310">&amp;</span><span class="ident" id="3469311">FoldCase</span>&nbsp;<span class="op" id="3469320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469324">return</span>&nbsp;<span class="builtintype" id="3469331">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3469342">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469365">re2</span><span class="op" id="3469368">.</span><span class="ident" id="3469369">Rune</span>&nbsp;<span class="op" id="3469374">=</span>&nbsp;<span class="builtinfunc" id="3469376">append</span><span class="op" id="3469382">(</span><span class="ident" id="3469383">re2</span><span class="op" id="3469386">.</span><span class="ident" id="3469387">Rune</span><span class="op" id="3469391">,</span>&nbsp;<span class="ident" id="3469393">re1</span><span class="op" id="3469396">.</span><span class="ident" id="3469397">Rune</span><span class="op" id="3469401">...</span><span class="op" id="3469404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3469408">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469435">if</span>&nbsp;<span class="ident" id="3469438">r</span>&nbsp;<span class="op" id="3469440">&gt;=</span>&nbsp;<span class="num" id="3469443">0</span>&nbsp;<span class="op" id="3469445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469449">re1</span><span class="op" id="3469452">.</span><span class="ident" id="3469453">Rune</span>&nbsp;<span class="op" id="3469458">=</span>&nbsp;<span class="ident" id="3469460">re1</span><span class="op" id="3469463">.</span><span class="ident" id="3469464">Rune0</span><span class="op" id="3469469">[</span><span class="op" id="3469470">:</span><span class="num" id="3469471">1</span><span class="op" id="3469472">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469476">re1</span><span class="op" id="3469479">.</span><span class="ident" id="3469480">Rune</span><span class="op" id="3469484">[</span><span class="num" id="3469485">0</span><span class="op" id="3469486">]</span>&nbsp;<span class="op" id="3469488">=</span>&nbsp;<span class="ident" id="3469490">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469494">re1</span><span class="op" id="3469497">.</span><span class="ident" id="3469498">Flags</span>&nbsp;<span class="op" id="3469504">=</span>&nbsp;<span class="ident" id="3469506">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469514">return</span>&nbsp;<span class="builtintype" id="3469521">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469531">p</span><span class="op" id="3469532">.</span><span class="ident" id="3469533">stack</span>&nbsp;<span class="op" id="3469539">=</span>&nbsp;<span class="ident" id="3469541">p</span><span class="op" id="3469542">.</span><span class="ident" id="3469543">stack</span><span class="op" id="3469548">[</span><span class="op" id="3469549">:</span><span class="ident" id="3469550">n</span><span class="op" id="3469551">-</span><span class="num" id="3469552">1</span><span class="op" id="3469553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469556">p</span><span class="op" id="3469557">.</span><span class="ident" id="3469558">reuse</span><span class="op" id="3469563">(</span><span class="ident" id="3469564">re1</span><span class="op" id="3469567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469570">return</span>&nbsp;<span class="builtintype" id="3469577">false</span>&nbsp;<span class="comment" id="3469583">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="3469601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3469604">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="3469670">func</span>&nbsp;<span class="op" id="3469675">(</span><span class="ident" id="3469676">p</span>&nbsp;<span class="op" id="3469678">*</span><span class="ident" id="3469679">parser</span><span class="op" id="3469685">)</span>&nbsp;<span class="ident" id="3469687">newLiteral</span><span class="op" id="3469697">(</span><span class="ident" id="3469698">r</span>&nbsp;<span class="builtintype" id="3469700">rune</span><span class="op" id="3469704">,</span>&nbsp;<span class="ident" id="3469706">flags</span>&nbsp;<span class="ident" id="3469712">Flags</span><span class="op" id="3469717">)</span>&nbsp;<span class="op" id="3469719">*</span><span class="ident" id="3469720">Regexp</span>&nbsp;<span class="op" id="3469727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469730">re</span>&nbsp;<span class="op" id="3469733">:=</span>&nbsp;<span class="ident" id="3469736">p</span><span class="op" id="3469737">.</span><span class="ident" id="3469738">newRegexp</span><span class="op" id="3469747">(</span><span class="ident" id="3469748">OpLiteral</span><span class="op" id="3469757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469760">re</span><span class="op" id="3469762">.</span><span class="ident" id="3469763">Flags</span>&nbsp;<span class="op" id="3469769">=</span>&nbsp;<span class="ident" id="3469771">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469778">if</span>&nbsp;<span class="ident" id="3469781">flags</span><span class="op" id="3469786">&amp;</span><span class="ident" id="3469787">FoldCase</span>&nbsp;<span class="op" id="3469796">!=</span>&nbsp;<span class="num" id="3469799">0</span>&nbsp;<span class="op" id="3469801">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469805">r</span>&nbsp;<span class="op" id="3469807">=</span>&nbsp;<span class="ident" id="3469809">minFoldRune</span><span class="op" id="3469820">(</span><span class="ident" id="3469821">r</span><span class="op" id="3469822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3469825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469828">re</span><span class="op" id="3469830">.</span><span class="ident" id="3469831">Rune0</span><span class="op" id="3469836">[</span><span class="num" id="3469837">0</span><span class="op" id="3469838">]</span>&nbsp;<span class="op" id="3469840">=</span>&nbsp;<span class="ident" id="3469842">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3469845">re</span><span class="op" id="3469847">.</span><span class="ident" id="3469848">Rune</span>&nbsp;<span class="op" id="3469853">=</span>&nbsp;<span class="ident" id="3469855">re</span><span class="op" id="3469857">.</span><span class="ident" id="3469858">Rune0</span><span class="op" id="3469863">[</span><span class="op" id="3469864">:</span><span class="num" id="3469865">1</span><span class="op" id="3469866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469869">return</span>&nbsp;<span class="ident" id="3469876">re</span><br>
<span class="lineno">190</span><span class="op" id="3469879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3469882">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3469944">func</span>&nbsp;<span class="ident" id="3469949">minFoldRune</span><span class="op" id="3469960">(</span><span class="ident" id="3469961">r</span>&nbsp;<span class="builtintype" id="3469963">rune</span><span class="op" id="3469967">)</span>&nbsp;<span class="builtintype" id="3469969">rune</span>&nbsp;<span class="op" id="3469974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3469977">if</span>&nbsp;<span class="ident" id="3469980">r</span>&nbsp;<span class="op" id="3469982">&lt;</span>&nbsp;<span class="ident" id="3469984">minFold</span>&nbsp;<span class="op" id="3469992">||</span>&nbsp;<span class="ident" id="3469995">r</span>&nbsp;<span class="op" id="3469997">&gt;</span>&nbsp;<span class="ident" id="3469999">maxFold</span>&nbsp;<span class="op" id="3470007">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470011">return</span>&nbsp;<span class="ident" id="3470018">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470024">min</span>&nbsp;<span class="op" id="3470028">:=</span>&nbsp;<span class="ident" id="3470031">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470034">r0</span>&nbsp;<span class="op" id="3470037">:=</span>&nbsp;<span class="ident" id="3470040">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470043">for</span>&nbsp;<span class="ident" id="3470047">r</span>&nbsp;<span class="op" id="3470049">=</span>&nbsp;<span class="ident" id="3470051">unicode</span><span class="op" id="3470058">.</span><span class="ident" id="3470059">SimpleFold</span><span class="op" id="3470069">(</span><span class="ident" id="3470070">r</span><span class="op" id="3470071">)</span><span class="op" id="3470072">;</span>&nbsp;<span class="ident" id="3470074">r</span>&nbsp;<span class="op" id="3470076">!=</span>&nbsp;<span class="ident" id="3470079">r0</span><span class="op" id="3470081">;</span>&nbsp;<span class="ident" id="3470083">r</span>&nbsp;<span class="op" id="3470085">=</span>&nbsp;<span class="ident" id="3470087">unicode</span><span class="op" id="3470094">.</span><span class="ident" id="3470095">SimpleFold</span><span class="op" id="3470105">(</span><span class="ident" id="3470106">r</span><span class="op" id="3470107">)</span>&nbsp;<span class="op" id="3470109">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470113">if</span>&nbsp;<span class="ident" id="3470116">min</span>&nbsp;<span class="op" id="3470120">&gt;</span>&nbsp;<span class="ident" id="3470122">r</span>&nbsp;<span class="op" id="3470124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470129">min</span>&nbsp;<span class="op" id="3470133">=</span>&nbsp;<span class="ident" id="3470135">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3470142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470145">return</span>&nbsp;<span class="ident" id="3470152">min</span><br>
<span class="lineno">205</span><span class="op" id="3470156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470159">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3470222">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="3470250">func</span>&nbsp;<span class="op" id="3470255">(</span><span class="ident" id="3470256">p</span>&nbsp;<span class="op" id="3470258">*</span><span class="ident" id="3470259">parser</span><span class="op" id="3470265">)</span>&nbsp;<span class="ident" id="3470267">literal</span><span class="op" id="3470274">(</span><span class="ident" id="3470275">r</span>&nbsp;<span class="builtintype" id="3470277">rune</span><span class="op" id="3470281">)</span>&nbsp;<span class="op" id="3470283">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470286">p</span><span class="op" id="3470287">.</span><span class="ident" id="3470288">push</span><span class="op" id="3470292">(</span><span class="ident" id="3470293">p</span><span class="op" id="3470294">.</span><span class="ident" id="3470295">newLiteral</span><span class="op" id="3470305">(</span><span class="ident" id="3470306">r</span><span class="op" id="3470307">,</span>&nbsp;<span class="ident" id="3470309">p</span><span class="op" id="3470310">.</span><span class="ident" id="3470311">flags</span><span class="op" id="3470316">)</span><span class="op" id="3470317">)</span><br>
<span class="lineno"></span><span class="op" id="3470319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470322">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3470377">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="3470405">func</span>&nbsp;<span class="op" id="3470410">(</span><span class="ident" id="3470411">p</span>&nbsp;<span class="op" id="3470413">*</span><span class="ident" id="3470414">parser</span><span class="op" id="3470420">)</span>&nbsp;<span class="ident" id="3470422">op</span><span class="op" id="3470424">(</span><span class="ident" id="3470425">op</span>&nbsp;<span class="ident" id="3470428">Op</span><span class="op" id="3470430">)</span>&nbsp;<span class="op" id="3470432">*</span><span class="ident" id="3470433">Regexp</span>&nbsp;<span class="op" id="3470440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470443">re</span>&nbsp;<span class="op" id="3470446">:=</span>&nbsp;<span class="ident" id="3470449">p</span><span class="op" id="3470450">.</span><span class="ident" id="3470451">newRegexp</span><span class="op" id="3470460">(</span><span class="ident" id="3470461">op</span><span class="op" id="3470463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470466">re</span><span class="op" id="3470468">.</span><span class="ident" id="3470469">Flags</span>&nbsp;<span class="op" id="3470475">=</span>&nbsp;<span class="ident" id="3470477">p</span><span class="op" id="3470478">.</span><span class="ident" id="3470479">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470486">return</span>&nbsp;<span class="ident" id="3470493">p</span><span class="op" id="3470494">.</span><span class="ident" id="3470495">push</span><span class="op" id="3470499">(</span><span class="ident" id="3470500">re</span><span class="op" id="3470502">)</span><br>
<span class="lineno"></span><span class="op" id="3470504">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3470507">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="3470596">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="3470664">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="3470735">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="3470794">func</span>&nbsp;<span class="op" id="3470799">(</span><span class="ident" id="3470800">p</span>&nbsp;<span class="op" id="3470802">*</span><span class="ident" id="3470803">parser</span><span class="op" id="3470809">)</span>&nbsp;<span class="ident" id="3470811">repeat</span><span class="op" id="3470817">(</span><span class="ident" id="3470818">op</span>&nbsp;<span class="ident" id="3470821">Op</span><span class="op" id="3470823">,</span>&nbsp;<span class="ident" id="3470825">min</span><span class="op" id="3470828">,</span>&nbsp;<span class="ident" id="3470830">max</span>&nbsp;<span class="builtintype" id="3470834">int</span><span class="op" id="3470837">,</span>&nbsp;<span class="ident" id="3470839">before</span><span class="op" id="3470845">,</span>&nbsp;<span class="ident" id="3470847">after</span><span class="op" id="3470852">,</span>&nbsp;<span class="ident" id="3470854">lastRepeat</span>&nbsp;<span class="builtintype" id="3470865">string</span><span class="op" id="3470871">)</span>&nbsp;<span class="op" id="3470873">(</span><span class="builtintype" id="3470874">string</span><span class="op" id="3470880">,</span>&nbsp;<span class="builtintype" id="3470882">error</span><span class="op" id="3470887">)</span>&nbsp;<span class="op" id="3470889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470892">flags</span>&nbsp;<span class="op" id="3470898">:=</span>&nbsp;<span class="ident" id="3470901">p</span><span class="op" id="3470902">.</span><span class="ident" id="3470903">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470910">if</span>&nbsp;<span class="ident" id="3470913">p</span><span class="op" id="3470914">.</span><span class="ident" id="3470915">flags</span><span class="op" id="3470920">&amp;</span><span class="ident" id="3470921">PerlX</span>&nbsp;<span class="op" id="3470927">!=</span>&nbsp;<span class="num" id="3470930">0</span>&nbsp;<span class="op" id="3470932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3470936">if</span>&nbsp;<span class="builtinfunc" id="3470939">len</span><span class="op" id="3470942">(</span><span class="ident" id="3470943">after</span><span class="op" id="3470948">)</span>&nbsp;<span class="op" id="3470950">&gt;</span>&nbsp;<span class="num" id="3470952">0</span>&nbsp;<span class="op" id="3470954">&amp;&amp;</span>&nbsp;<span class="ident" id="3470957">after</span><span class="op" id="3470962">[</span><span class="num" id="3470963">0</span><span class="op" id="3470964">]</span>&nbsp;<span class="op" id="3470966">==</span>&nbsp;<span class="string" id="3470969">&#39;?&#39;</span>&nbsp;<span class="op" id="3470973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470978">after</span>&nbsp;<span class="op" id="3470984">=</span>&nbsp;<span class="ident" id="3470986">after</span><span class="op" id="3470991">[</span><span class="num" id="3470992">1</span><span class="op" id="3470993">:</span><span class="op" id="3470994">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3470999">flags</span>&nbsp;<span class="op" id="3471005">^=</span>&nbsp;<span class="ident" id="3471008">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471024">if</span>&nbsp;<span class="ident" id="3471027">lastRepeat</span>&nbsp;<span class="op" id="3471038">!=</span>&nbsp;<span class="string" id="3471041">&#34;&#34;</span>&nbsp;<span class="op" id="3471044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471049">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471112">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3471175">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471230">return</span>&nbsp;<span class="string" id="3471237">&#34;&#34;</span><span class="op" id="3471239">,</span>&nbsp;<span class="op" id="3471241">&amp;</span><span class="ident" id="3471242">Error</span><span class="op" id="3471247">{</span><span class="ident" id="3471248">ErrInvalidRepeatOp</span><span class="op" id="3471266">,</span>&nbsp;<span class="ident" id="3471268">lastRepeat</span><span class="op" id="3471278">[</span><span class="op" id="3471279">:</span><span class="builtinfunc" id="3471280">len</span><span class="op" id="3471283">(</span><span class="ident" id="3471284">lastRepeat</span><span class="op" id="3471294">)</span><span class="op" id="3471295">-</span><span class="builtinfunc" id="3471296">len</span><span class="op" id="3471299">(</span><span class="ident" id="3471300">after</span><span class="op" id="3471305">)</span><span class="op" id="3471306">]</span><span class="op" id="3471307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471317">n</span>&nbsp;<span class="op" id="3471319">:=</span>&nbsp;<span class="builtinfunc" id="3471322">len</span><span class="op" id="3471325">(</span><span class="ident" id="3471326">p</span><span class="op" id="3471327">.</span><span class="ident" id="3471328">stack</span><span class="op" id="3471333">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471336">if</span>&nbsp;<span class="ident" id="3471339">n</span>&nbsp;<span class="op" id="3471341">==</span>&nbsp;<span class="num" id="3471344">0</span>&nbsp;<span class="op" id="3471346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471350">return</span>&nbsp;<span class="string" id="3471357">&#34;&#34;</span><span class="op" id="3471359">,</span>&nbsp;<span class="op" id="3471361">&amp;</span><span class="ident" id="3471362">Error</span><span class="op" id="3471367">{</span><span class="ident" id="3471368">ErrMissingRepeatArgument</span><span class="op" id="3471392">,</span>&nbsp;<span class="ident" id="3471394">before</span><span class="op" id="3471400">[</span><span class="op" id="3471401">:</span><span class="builtinfunc" id="3471402">len</span><span class="op" id="3471405">(</span><span class="ident" id="3471406">before</span><span class="op" id="3471412">)</span><span class="op" id="3471413">-</span><span class="builtinfunc" id="3471414">len</span><span class="op" id="3471417">(</span><span class="ident" id="3471418">after</span><span class="op" id="3471423">)</span><span class="op" id="3471424">]</span><span class="op" id="3471425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471431">sub</span>&nbsp;<span class="op" id="3471435">:=</span>&nbsp;<span class="ident" id="3471438">p</span><span class="op" id="3471439">.</span><span class="ident" id="3471440">stack</span><span class="op" id="3471445">[</span><span class="ident" id="3471446">n</span><span class="op" id="3471447">-</span><span class="num" id="3471448">1</span><span class="op" id="3471449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471452">if</span>&nbsp;<span class="ident" id="3471455">sub</span><span class="op" id="3471458">.</span><span class="ident" id="3471459">Op</span>&nbsp;<span class="op" id="3471462">&gt;=</span>&nbsp;<span class="ident" id="3471465">opPseudo</span>&nbsp;<span class="op" id="3471474">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471478">return</span>&nbsp;<span class="string" id="3471485">&#34;&#34;</span><span class="op" id="3471487">,</span>&nbsp;<span class="op" id="3471489">&amp;</span><span class="ident" id="3471490">Error</span><span class="op" id="3471495">{</span><span class="ident" id="3471496">ErrMissingRepeatArgument</span><span class="op" id="3471520">,</span>&nbsp;<span class="ident" id="3471522">before</span><span class="op" id="3471528">[</span><span class="op" id="3471529">:</span><span class="builtinfunc" id="3471530">len</span><span class="op" id="3471533">(</span><span class="ident" id="3471534">before</span><span class="op" id="3471540">)</span><span class="op" id="3471541">-</span><span class="builtinfunc" id="3471542">len</span><span class="op" id="3471545">(</span><span class="ident" id="3471546">after</span><span class="op" id="3471551">)</span><span class="op" id="3471552">]</span><span class="op" id="3471553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471560">re</span>&nbsp;<span class="op" id="3471563">:=</span>&nbsp;<span class="ident" id="3471566">p</span><span class="op" id="3471567">.</span><span class="ident" id="3471568">newRegexp</span><span class="op" id="3471577">(</span><span class="ident" id="3471578">op</span><span class="op" id="3471580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471583">re</span><span class="op" id="3471585">.</span><span class="ident" id="3471586">Min</span>&nbsp;<span class="op" id="3471590">=</span>&nbsp;<span class="ident" id="3471592">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471597">re</span><span class="op" id="3471599">.</span><span class="ident" id="3471600">Max</span>&nbsp;<span class="op" id="3471604">=</span>&nbsp;<span class="ident" id="3471606">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471611">re</span><span class="op" id="3471613">.</span><span class="ident" id="3471614">Flags</span>&nbsp;<span class="op" id="3471620">=</span>&nbsp;<span class="ident" id="3471622">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471629">re</span><span class="op" id="3471631">.</span><span class="ident" id="3471632">Sub</span>&nbsp;<span class="op" id="3471636">=</span>&nbsp;<span class="ident" id="3471638">re</span><span class="op" id="3471640">.</span><span class="ident" id="3471641">Sub0</span><span class="op" id="3471645">[</span><span class="op" id="3471646">:</span><span class="num" id="3471647">1</span><span class="op" id="3471648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471651">re</span><span class="op" id="3471653">.</span><span class="ident" id="3471654">Sub</span><span class="op" id="3471657">[</span><span class="num" id="3471658">0</span><span class="op" id="3471659">]</span>&nbsp;<span class="op" id="3471661">=</span>&nbsp;<span class="ident" id="3471663">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3471668">p</span><span class="op" id="3471669">.</span><span class="ident" id="3471670">stack</span><span class="op" id="3471675">[</span><span class="ident" id="3471676">n</span><span class="op" id="3471677">-</span><span class="num" id="3471678">1</span><span class="op" id="3471679">]</span>&nbsp;<span class="op" id="3471681">=</span>&nbsp;<span class="ident" id="3471683">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471688">if</span>&nbsp;<span class="ident" id="3471691">op</span>&nbsp;<span class="op" id="3471694">==</span>&nbsp;<span class="ident" id="3471697">OpRepeat</span>&nbsp;<span class="op" id="3471706">&amp;&amp;</span>&nbsp;<span class="op" id="3471709">(</span><span class="ident" id="3471710">min</span>&nbsp;<span class="op" id="3471714">&gt;=</span>&nbsp;<span class="num" id="3471717">2</span>&nbsp;<span class="op" id="3471719">||</span>&nbsp;<span class="ident" id="3471722">max</span>&nbsp;<span class="op" id="3471726">&gt;=</span>&nbsp;<span class="num" id="3471729">2</span><span class="op" id="3471730">)</span>&nbsp;<span class="op" id="3471732">&amp;&amp;</span>&nbsp;<span class="op" id="3471735">!</span><span class="ident" id="3471736">repeatIsValid</span><span class="op" id="3471749">(</span><span class="ident" id="3471750">re</span><span class="op" id="3471752">,</span>&nbsp;<span class="num" id="3471754">1000</span><span class="op" id="3471758">)</span>&nbsp;<span class="op" id="3471760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471764">return</span>&nbsp;<span class="string" id="3471771">&#34;&#34;</span><span class="op" id="3471773">,</span>&nbsp;<span class="op" id="3471775">&amp;</span><span class="ident" id="3471776">Error</span><span class="op" id="3471781">{</span><span class="ident" id="3471782">ErrInvalidRepeatSize</span><span class="op" id="3471802">,</span>&nbsp;<span class="ident" id="3471804">before</span><span class="op" id="3471810">[</span><span class="op" id="3471811">:</span><span class="builtinfunc" id="3471812">len</span><span class="op" id="3471815">(</span><span class="ident" id="3471816">before</span><span class="op" id="3471822">)</span><span class="op" id="3471823">-</span><span class="builtinfunc" id="3471824">len</span><span class="op" id="3471827">(</span><span class="ident" id="3471828">after</span><span class="op" id="3471833">)</span><span class="op" id="3471834">]</span><span class="op" id="3471835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3471838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3471842">return</span>&nbsp;<span class="ident" id="3471849">after</span><span class="op" id="3471854">,</span>&nbsp;<span class="builtintype" id="3471856">nil</span><br>
<span class="lineno"></span><span class="op" id="3471860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3471863">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="3471924">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="3471988">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3472049">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="3472069">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="3472146">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="3472218">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="3472287">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="3472359">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="3472434">func</span>&nbsp;<span class="ident" id="3472439">repeatIsValid</span><span class="op" id="3472452">(</span><span class="ident" id="3472453">re</span>&nbsp;<span class="op" id="3472456">*</span><span class="ident" id="3472457">Regexp</span><span class="op" id="3472463">,</span>&nbsp;<span class="ident" id="3472465">n</span>&nbsp;<span class="builtintype" id="3472467">int</span><span class="op" id="3472470">)</span>&nbsp;<span class="builtintype" id="3472472">bool</span>&nbsp;<span class="op" id="3472477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472480">if</span>&nbsp;<span class="ident" id="3472483">re</span><span class="op" id="3472485">.</span><span class="ident" id="3472486">Op</span>&nbsp;<span class="op" id="3472489">==</span>&nbsp;<span class="ident" id="3472492">OpRepeat</span>&nbsp;<span class="op" id="3472501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472505">m</span>&nbsp;<span class="op" id="3472507">:=</span>&nbsp;<span class="ident" id="3472510">re</span><span class="op" id="3472512">.</span><span class="ident" id="3472513">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472519">if</span>&nbsp;<span class="ident" id="3472522">m</span>&nbsp;<span class="op" id="3472524">==</span>&nbsp;<span class="num" id="3472527">0</span>&nbsp;<span class="op" id="3472529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472534">return</span>&nbsp;<span class="builtintype" id="3472541">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472552">if</span>&nbsp;<span class="ident" id="3472555">m</span>&nbsp;<span class="op" id="3472557">&lt;</span>&nbsp;<span class="num" id="3472559">0</span>&nbsp;<span class="op" id="3472561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472566">m</span>&nbsp;<span class="op" id="3472568">=</span>&nbsp;<span class="ident" id="3472570">re</span><span class="op" id="3472572">.</span><span class="ident" id="3472573">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472583">if</span>&nbsp;<span class="ident" id="3472586">m</span>&nbsp;<span class="op" id="3472588">&gt;</span>&nbsp;<span class="ident" id="3472590">n</span>&nbsp;<span class="op" id="3472592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472597">return</span>&nbsp;<span class="builtintype" id="3472604">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472616">if</span>&nbsp;<span class="ident" id="3472619">m</span>&nbsp;<span class="op" id="3472621">&gt;</span>&nbsp;<span class="num" id="3472623">0</span>&nbsp;<span class="op" id="3472625">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472630">n</span>&nbsp;<span class="op" id="3472632">/=</span>&nbsp;<span class="ident" id="3472635">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472645">for</span>&nbsp;<span class="ident" id="3472649">_</span><span class="op" id="3472650">,</span>&nbsp;<span class="ident" id="3472652">sub</span>&nbsp;<span class="op" id="3472656">:=</span>&nbsp;<span class="keyword" id="3472659">range</span>&nbsp;<span class="ident" id="3472665">re</span><span class="op" id="3472667">.</span><span class="ident" id="3472668">Sub</span>&nbsp;<span class="op" id="3472672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472676">if</span>&nbsp;<span class="op" id="3472679">!</span><span class="ident" id="3472680">repeatIsValid</span><span class="op" id="3472693">(</span><span class="ident" id="3472694">sub</span><span class="op" id="3472697">,</span>&nbsp;<span class="ident" id="3472699">n</span><span class="op" id="3472700">)</span>&nbsp;<span class="op" id="3472702">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472707">return</span>&nbsp;<span class="builtintype" id="3472714">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3472725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472728">return</span>&nbsp;<span class="builtintype" id="3472735">true</span><br>
<span class="lineno"></span><span class="op" id="3472740">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="3472743">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="3472838">func</span>&nbsp;<span class="op" id="3472843">(</span><span class="ident" id="3472844">p</span>&nbsp;<span class="op" id="3472846">*</span><span class="ident" id="3472847">parser</span><span class="op" id="3472853">)</span>&nbsp;<span class="ident" id="3472855">concat</span><span class="op" id="3472861">(</span><span class="op" id="3472862">)</span>&nbsp;<span class="op" id="3472864">*</span><span class="ident" id="3472865">Regexp</span>&nbsp;<span class="op" id="3472872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472875">p</span><span class="op" id="3472876">.</span><span class="ident" id="3472877">maybeConcat</span><span class="op" id="3472888">(</span><span class="op" id="3472889">-</span><span class="num" id="3472890">1</span><span class="op" id="3472891">,</span>&nbsp;<span class="num" id="3472893">0</span><span class="op" id="3472894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3472898">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3472944">i</span>&nbsp;<span class="op" id="3472946">:=</span>&nbsp;<span class="builtinfunc" id="3472949">len</span><span class="op" id="3472952">(</span><span class="ident" id="3472953">p</span><span class="op" id="3472954">.</span><span class="ident" id="3472955">stack</span><span class="op" id="3472960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3472963">for</span>&nbsp;<span class="ident" id="3472967">i</span>&nbsp;<span class="op" id="3472969">&gt;</span>&nbsp;<span class="num" id="3472971">0</span>&nbsp;<span class="op" id="3472973">&amp;&amp;</span>&nbsp;<span class="ident" id="3472976">p</span><span class="op" id="3472977">.</span><span class="ident" id="3472978">stack</span><span class="op" id="3472983">[</span><span class="ident" id="3472984">i</span><span class="op" id="3472985">-</span><span class="num" id="3472986">1</span><span class="op" id="3472987">]</span><span class="op" id="3472988">.</span><span class="ident" id="3472989">Op</span>&nbsp;<span class="op" id="3472992">&lt;</span>&nbsp;<span class="ident" id="3472994">opPseudo</span>&nbsp;<span class="op" id="3473003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473007">i</span><span class="op" id="3473008">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473012">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473015">subs</span>&nbsp;<span class="op" id="3473020">:=</span>&nbsp;<span class="ident" id="3473023">p</span><span class="op" id="3473024">.</span><span class="ident" id="3473025">stack</span><span class="op" id="3473030">[</span><span class="ident" id="3473031">i</span><span class="op" id="3473032">:</span><span class="op" id="3473033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473036">p</span><span class="op" id="3473037">.</span><span class="ident" id="3473038">stack</span>&nbsp;<span class="op" id="3473044">=</span>&nbsp;<span class="ident" id="3473046">p</span><span class="op" id="3473047">.</span><span class="ident" id="3473048">stack</span><span class="op" id="3473053">[</span><span class="op" id="3473054">:</span><span class="ident" id="3473055">i</span><span class="op" id="3473056">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473060">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473101">if</span>&nbsp;<span class="builtinfunc" id="3473104">len</span><span class="op" id="3473107">(</span><span class="ident" id="3473108">subs</span><span class="op" id="3473112">)</span>&nbsp;<span class="op" id="3473114">==</span>&nbsp;<span class="num" id="3473117">0</span>&nbsp;<span class="op" id="3473119">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473123">return</span>&nbsp;<span class="ident" id="3473130">p</span><span class="op" id="3473131">.</span><span class="ident" id="3473132">push</span><span class="op" id="3473136">(</span><span class="ident" id="3473137">p</span><span class="op" id="3473138">.</span><span class="ident" id="3473139">newRegexp</span><span class="op" id="3473148">(</span><span class="ident" id="3473149">OpEmptyMatch</span><span class="op" id="3473161">)</span><span class="op" id="3473162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473169">return</span>&nbsp;<span class="ident" id="3473176">p</span><span class="op" id="3473177">.</span><span class="ident" id="3473178">push</span><span class="op" id="3473182">(</span><span class="ident" id="3473183">p</span><span class="op" id="3473184">.</span><span class="ident" id="3473185">collapse</span><span class="op" id="3473193">(</span><span class="ident" id="3473194">subs</span><span class="op" id="3473198">,</span>&nbsp;<span class="ident" id="3473200">OpConcat</span><span class="op" id="3473208">)</span><span class="op" id="3473209">)</span><br>
<span class="lineno"></span><span class="op" id="3473211">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3473214">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="3473303">func</span>&nbsp;<span class="op" id="3473308">(</span><span class="ident" id="3473309">p</span>&nbsp;<span class="op" id="3473311">*</span><span class="ident" id="3473312">parser</span><span class="op" id="3473318">)</span>&nbsp;<span class="ident" id="3473320">alternate</span><span class="op" id="3473329">(</span><span class="op" id="3473330">)</span>&nbsp;<span class="op" id="3473332">*</span><span class="ident" id="3473333">Regexp</span>&nbsp;<span class="op" id="3473340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473343">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473384">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473412">i</span>&nbsp;<span class="op" id="3473414">:=</span>&nbsp;<span class="builtinfunc" id="3473417">len</span><span class="op" id="3473420">(</span><span class="ident" id="3473421">p</span><span class="op" id="3473422">.</span><span class="ident" id="3473423">stack</span><span class="op" id="3473428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473431">for</span>&nbsp;<span class="ident" id="3473435">i</span>&nbsp;<span class="op" id="3473437">&gt;</span>&nbsp;<span class="num" id="3473439">0</span>&nbsp;<span class="op" id="3473441">&amp;&amp;</span>&nbsp;<span class="ident" id="3473444">p</span><span class="op" id="3473445">.</span><span class="ident" id="3473446">stack</span><span class="op" id="3473451">[</span><span class="ident" id="3473452">i</span><span class="op" id="3473453">-</span><span class="num" id="3473454">1</span><span class="op" id="3473455">]</span><span class="op" id="3473456">.</span><span class="ident" id="3473457">Op</span>&nbsp;<span class="op" id="3473460">&lt;</span>&nbsp;<span class="ident" id="3473462">opPseudo</span>&nbsp;<span class="op" id="3473471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473475">i</span><span class="op" id="3473476">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473483">subs</span>&nbsp;<span class="op" id="3473488">:=</span>&nbsp;<span class="ident" id="3473491">p</span><span class="op" id="3473492">.</span><span class="ident" id="3473493">stack</span><span class="op" id="3473498">[</span><span class="ident" id="3473499">i</span><span class="op" id="3473500">:</span><span class="op" id="3473501">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473504">p</span><span class="op" id="3473505">.</span><span class="ident" id="3473506">stack</span>&nbsp;<span class="op" id="3473512">=</span>&nbsp;<span class="ident" id="3473514">p</span><span class="op" id="3473515">.</span><span class="ident" id="3473516">stack</span><span class="op" id="3473521">[</span><span class="op" id="3473522">:</span><span class="ident" id="3473523">i</span><span class="op" id="3473524">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473528">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473562">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473616">if</span>&nbsp;<span class="builtinfunc" id="3473619">len</span><span class="op" id="3473622">(</span><span class="ident" id="3473623">subs</span><span class="op" id="3473627">)</span>&nbsp;<span class="op" id="3473629">&gt;</span>&nbsp;<span class="num" id="3473631">0</span>&nbsp;<span class="op" id="3473633">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473637">cleanAlt</span><span class="op" id="3473645">(</span><span class="ident" id="3473646">subs</span><span class="op" id="3473650">[</span><span class="builtinfunc" id="3473651">len</span><span class="op" id="3473654">(</span><span class="ident" id="3473655">subs</span><span class="op" id="3473659">)</span><span class="op" id="3473660">-</span><span class="num" id="3473661">1</span><span class="op" id="3473662">]</span><span class="op" id="3473663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473670">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3473706">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473749">if</span>&nbsp;<span class="builtinfunc" id="3473752">len</span><span class="op" id="3473755">(</span><span class="ident" id="3473756">subs</span><span class="op" id="3473760">)</span>&nbsp;<span class="op" id="3473762">==</span>&nbsp;<span class="num" id="3473765">0</span>&nbsp;<span class="op" id="3473767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473771">return</span>&nbsp;<span class="ident" id="3473778">p</span><span class="op" id="3473779">.</span><span class="ident" id="3473780">push</span><span class="op" id="3473784">(</span><span class="ident" id="3473785">p</span><span class="op" id="3473786">.</span><span class="ident" id="3473787">newRegexp</span><span class="op" id="3473796">(</span><span class="ident" id="3473797">OpNoMatch</span><span class="op" id="3473806">)</span><span class="op" id="3473807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3473810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473814">return</span>&nbsp;<span class="ident" id="3473821">p</span><span class="op" id="3473822">.</span><span class="ident" id="3473823">push</span><span class="op" id="3473827">(</span><span class="ident" id="3473828">p</span><span class="op" id="3473829">.</span><span class="ident" id="3473830">collapse</span><span class="op" id="3473838">(</span><span class="ident" id="3473839">subs</span><span class="op" id="3473843">,</span>&nbsp;<span class="ident" id="3473845">OpAlternate</span><span class="op" id="3473856">)</span><span class="op" id="3473857">)</span><br>
<span class="lineno">340</span><span class="op" id="3473859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3473862">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="3473926">func</span>&nbsp;<span class="ident" id="3473931">cleanAlt</span><span class="op" id="3473939">(</span><span class="ident" id="3473940">re</span>&nbsp;<span class="op" id="3473943">*</span><span class="ident" id="3473944">Regexp</span><span class="op" id="3473950">)</span>&nbsp;<span class="op" id="3473952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473955">switch</span>&nbsp;<span class="ident" id="3473962">re</span><span class="op" id="3473964">.</span><span class="ident" id="3473965">Op</span>&nbsp;<span class="op" id="3473968">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3473971">case</span>&nbsp;<span class="ident" id="3473976">OpCharClass</span><span class="op" id="3473987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3473991">re</span><span class="op" id="3473993">.</span><span class="ident" id="3473994">Rune</span>&nbsp;<span class="op" id="3473999">=</span>&nbsp;<span class="ident" id="3474001">cleanClass</span><span class="op" id="3474011">(</span><span class="op" id="3474012">&amp;</span><span class="ident" id="3474013">re</span><span class="op" id="3474015">.</span><span class="ident" id="3474016">Rune</span><span class="op" id="3474020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474024">if</span>&nbsp;<span class="builtinfunc" id="3474027">len</span><span class="op" id="3474030">(</span><span class="ident" id="3474031">re</span><span class="op" id="3474033">.</span><span class="ident" id="3474034">Rune</span><span class="op" id="3474038">)</span>&nbsp;<span class="op" id="3474040">==</span>&nbsp;<span class="num" id="3474043">2</span>&nbsp;<span class="op" id="3474045">&amp;&amp;</span>&nbsp;<span class="ident" id="3474048">re</span><span class="op" id="3474050">.</span><span class="ident" id="3474051">Rune</span><span class="op" id="3474055">[</span><span class="num" id="3474056">0</span><span class="op" id="3474057">]</span>&nbsp;<span class="op" id="3474059">==</span>&nbsp;<span class="num" id="3474062">0</span>&nbsp;<span class="op" id="3474064">&amp;&amp;</span>&nbsp;<span class="ident" id="3474067">re</span><span class="op" id="3474069">.</span><span class="ident" id="3474070">Rune</span><span class="op" id="3474074">[</span><span class="num" id="3474075">1</span><span class="op" id="3474076">]</span>&nbsp;<span class="op" id="3474078">==</span>&nbsp;<span class="ident" id="3474081">unicode</span><span class="op" id="3474088">.</span><span class="ident" id="3474089">MaxRune</span>&nbsp;<span class="op" id="3474097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474102">re</span><span class="op" id="3474104">.</span><span class="ident" id="3474105">Rune</span>&nbsp;<span class="op" id="3474110">=</span>&nbsp;<span class="builtintype" id="3474112">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474119">re</span><span class="op" id="3474121">.</span><span class="ident" id="3474122">Op</span>&nbsp;<span class="op" id="3474125">=</span>&nbsp;<span class="ident" id="3474127">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474140">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474153">if</span>&nbsp;<span class="builtinfunc" id="3474156">len</span><span class="op" id="3474159">(</span><span class="ident" id="3474160">re</span><span class="op" id="3474162">.</span><span class="ident" id="3474163">Rune</span><span class="op" id="3474167">)</span>&nbsp;<span class="op" id="3474169">==</span>&nbsp;<span class="num" id="3474172">4</span>&nbsp;<span class="op" id="3474174">&amp;&amp;</span>&nbsp;<span class="ident" id="3474177">re</span><span class="op" id="3474179">.</span><span class="ident" id="3474180">Rune</span><span class="op" id="3474184">[</span><span class="num" id="3474185">0</span><span class="op" id="3474186">]</span>&nbsp;<span class="op" id="3474188">==</span>&nbsp;<span class="num" id="3474191">0</span>&nbsp;<span class="op" id="3474193">&amp;&amp;</span>&nbsp;<span class="ident" id="3474196">re</span><span class="op" id="3474198">.</span><span class="ident" id="3474199">Rune</span><span class="op" id="3474203">[</span><span class="num" id="3474204">1</span><span class="op" id="3474205">]</span>&nbsp;<span class="op" id="3474207">==</span>&nbsp;<span class="string" id="3474210">&#39;\n&#39;</span><span class="op" id="3474214">-</span><span class="num" id="3474215">1</span>&nbsp;<span class="op" id="3474217">&amp;&amp;</span>&nbsp;<span class="ident" id="3474220">re</span><span class="op" id="3474222">.</span><span class="ident" id="3474223">Rune</span><span class="op" id="3474227">[</span><span class="num" id="3474228">2</span><span class="op" id="3474229">]</span>&nbsp;<span class="op" id="3474231">==</span>&nbsp;<span class="string" id="3474234">&#39;\n&#39;</span><span class="op" id="3474238">+</span><span class="num" id="3474239">1</span>&nbsp;<span class="op" id="3474241">&amp;&amp;</span>&nbsp;<span class="ident" id="3474244">re</span><span class="op" id="3474246">.</span><span class="ident" id="3474247">Rune</span><span class="op" id="3474251">[</span><span class="num" id="3474252">3</span><span class="op" id="3474253">]</span>&nbsp;<span class="op" id="3474255">==</span>&nbsp;<span class="ident" id="3474258">unicode</span><span class="op" id="3474265">.</span><span class="ident" id="3474266">MaxRune</span>&nbsp;<span class="op" id="3474274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474279">re</span><span class="op" id="3474281">.</span><span class="ident" id="3474282">Rune</span>&nbsp;<span class="op" id="3474287">=</span>&nbsp;<span class="builtintype" id="3474289">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474296">re</span><span class="op" id="3474298">.</span><span class="ident" id="3474299">Op</span>&nbsp;<span class="op" id="3474302">=</span>&nbsp;<span class="ident" id="3474304">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474322">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474335">if</span>&nbsp;<span class="builtinfunc" id="3474338">cap</span><span class="op" id="3474341">(</span><span class="ident" id="3474342">re</span><span class="op" id="3474344">.</span><span class="ident" id="3474345">Rune</span><span class="op" id="3474349">)</span><span class="op" id="3474350">-</span><span class="builtinfunc" id="3474351">len</span><span class="op" id="3474354">(</span><span class="ident" id="3474355">re</span><span class="op" id="3474357">.</span><span class="ident" id="3474358">Rune</span><span class="op" id="3474362">)</span>&nbsp;<span class="op" id="3474364">&gt;</span>&nbsp;<span class="num" id="3474366">100</span>&nbsp;<span class="op" id="3474370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474375">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3474413">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474461">re</span><span class="op" id="3474463">.</span><span class="ident" id="3474464">Rune</span>&nbsp;<span class="op" id="3474469">=</span>&nbsp;<span class="builtinfunc" id="3474471">append</span><span class="op" id="3474477">(</span><span class="ident" id="3474478">re</span><span class="op" id="3474480">.</span><span class="ident" id="3474481">Rune0</span><span class="op" id="3474486">[</span><span class="op" id="3474487">:</span><span class="num" id="3474488">0</span><span class="op" id="3474489">]</span><span class="op" id="3474490">,</span>&nbsp;<span class="ident" id="3474492">re</span><span class="op" id="3474494">.</span><span class="ident" id="3474495">Rune</span><span class="op" id="3474499">...</span><span class="op" id="3474502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474509">}</span><br>
<span class="lineno"></span><span class="op" id="3474511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3474514">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="3474568">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3474621">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3474674">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="3474704">func</span>&nbsp;<span class="op" id="3474709">(</span><span class="ident" id="3474710">p</span>&nbsp;<span class="op" id="3474712">*</span><span class="ident" id="3474713">parser</span><span class="op" id="3474719">)</span>&nbsp;<span class="ident" id="3474721">collapse</span><span class="op" id="3474729">(</span><span class="ident" id="3474730">subs</span>&nbsp;<span class="op" id="3474735">[</span><span class="op" id="3474736">]</span><span class="op" id="3474737">*</span><span class="ident" id="3474738">Regexp</span><span class="op" id="3474744">,</span>&nbsp;<span class="ident" id="3474746">op</span>&nbsp;<span class="ident" id="3474749">Op</span><span class="op" id="3474751">)</span>&nbsp;<span class="op" id="3474753">*</span><span class="ident" id="3474754">Regexp</span>&nbsp;<span class="op" id="3474761">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474764">if</span>&nbsp;<span class="builtinfunc" id="3474767">len</span><span class="op" id="3474770">(</span><span class="ident" id="3474771">subs</span><span class="op" id="3474775">)</span>&nbsp;<span class="op" id="3474777">==</span>&nbsp;<span class="num" id="3474780">1</span>&nbsp;<span class="op" id="3474782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474786">return</span>&nbsp;<span class="ident" id="3474793">subs</span><span class="op" id="3474797">[</span><span class="num" id="3474798">0</span><span class="op" id="3474799">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474805">re</span>&nbsp;<span class="op" id="3474808">:=</span>&nbsp;<span class="ident" id="3474811">p</span><span class="op" id="3474812">.</span><span class="ident" id="3474813">newRegexp</span><span class="op" id="3474822">(</span><span class="ident" id="3474823">op</span><span class="op" id="3474825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474828">re</span><span class="op" id="3474830">.</span><span class="ident" id="3474831">Sub</span>&nbsp;<span class="op" id="3474835">=</span>&nbsp;<span class="ident" id="3474837">re</span><span class="op" id="3474839">.</span><span class="ident" id="3474840">Sub0</span><span class="op" id="3474844">[</span><span class="op" id="3474845">:</span><span class="num" id="3474846">0</span><span class="op" id="3474847">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474850">for</span>&nbsp;<span class="ident" id="3474854">_</span><span class="op" id="3474855">,</span>&nbsp;<span class="ident" id="3474857">sub</span>&nbsp;<span class="op" id="3474861">:=</span>&nbsp;<span class="keyword" id="3474864">range</span>&nbsp;<span class="ident" id="3474870">subs</span>&nbsp;<span class="op" id="3474875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3474879">if</span>&nbsp;<span class="ident" id="3474882">sub</span><span class="op" id="3474885">.</span><span class="ident" id="3474886">Op</span>&nbsp;<span class="op" id="3474889">==</span>&nbsp;<span class="ident" id="3474892">op</span>&nbsp;<span class="op" id="3474895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474900">re</span><span class="op" id="3474902">.</span><span class="ident" id="3474903">Sub</span>&nbsp;<span class="op" id="3474907">=</span>&nbsp;<span class="builtinfunc" id="3474909">append</span><span class="op" id="3474915">(</span><span class="ident" id="3474916">re</span><span class="op" id="3474918">.</span><span class="ident" id="3474919">Sub</span><span class="op" id="3474922">,</span>&nbsp;<span class="ident" id="3474924">sub</span><span class="op" id="3474927">.</span><span class="ident" id="3474928">Sub</span><span class="op" id="3474931">...</span><span class="op" id="3474934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474939">p</span><span class="op" id="3474940">.</span><span class="ident" id="3474941">reuse</span><span class="op" id="3474946">(</span><span class="ident" id="3474947">sub</span><span class="op" id="3474950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474954">}</span>&nbsp;<span class="keyword" id="3474956">else</span>&nbsp;<span class="op" id="3474961">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3474966">re</span><span class="op" id="3474968">.</span><span class="ident" id="3474969">Sub</span>&nbsp;<span class="op" id="3474973">=</span>&nbsp;<span class="builtinfunc" id="3474975">append</span><span class="op" id="3474981">(</span><span class="ident" id="3474982">re</span><span class="op" id="3474984">.</span><span class="ident" id="3474985">Sub</span><span class="op" id="3474988">,</span>&nbsp;<span class="ident" id="3474990">sub</span><span class="op" id="3474993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3474997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475003">if</span>&nbsp;<span class="ident" id="3475006">op</span>&nbsp;<span class="op" id="3475009">==</span>&nbsp;<span class="ident" id="3475012">OpAlternate</span>&nbsp;<span class="op" id="3475024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475028">re</span><span class="op" id="3475030">.</span><span class="ident" id="3475031">Sub</span>&nbsp;<span class="op" id="3475035">=</span>&nbsp;<span class="ident" id="3475037">p</span><span class="op" id="3475038">.</span><span class="ident" id="3475039">factor</span><span class="op" id="3475045">(</span><span class="ident" id="3475046">re</span><span class="op" id="3475048">.</span><span class="ident" id="3475049">Sub</span><span class="op" id="3475052">,</span>&nbsp;<span class="ident" id="3475054">re</span><span class="op" id="3475056">.</span><span class="ident" id="3475057">Flags</span><span class="op" id="3475062">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475066">if</span>&nbsp;<span class="builtinfunc" id="3475069">len</span><span class="op" id="3475072">(</span><span class="ident" id="3475073">re</span><span class="op" id="3475075">.</span><span class="ident" id="3475076">Sub</span><span class="op" id="3475079">)</span>&nbsp;<span class="op" id="3475081">==</span>&nbsp;<span class="num" id="3475084">1</span>&nbsp;<span class="op" id="3475086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475091">old</span>&nbsp;<span class="op" id="3475095">:=</span>&nbsp;<span class="ident" id="3475098">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475104">re</span>&nbsp;<span class="op" id="3475107">=</span>&nbsp;<span class="ident" id="3475109">re</span><span class="op" id="3475111">.</span><span class="ident" id="3475112">Sub</span><span class="op" id="3475115">[</span><span class="num" id="3475116">0</span><span class="op" id="3475117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475122">p</span><span class="op" id="3475123">.</span><span class="ident" id="3475124">reuse</span><span class="op" id="3475129">(</span><span class="ident" id="3475130">old</span><span class="op" id="3475133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475137">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475143">return</span>&nbsp;<span class="ident" id="3475150">re</span><br>
<span class="lineno"></span><span class="op" id="3475153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3475156">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="3475221">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3475287">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="3475338">//</span><br>
<span class="lineno"></span><span class="comment" id="3475341">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="3475357">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="3475384">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3475430">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="3475458">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3475513">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="3475539">//</span><br>
<span class="lineno">405</span><span class="keyword" id="3475542">func</span>&nbsp;<span class="op" id="3475547">(</span><span class="ident" id="3475548">p</span>&nbsp;<span class="op" id="3475550">*</span><span class="ident" id="3475551">parser</span><span class="op" id="3475557">)</span>&nbsp;<span class="ident" id="3475559">factor</span><span class="op" id="3475565">(</span><span class="ident" id="3475566">sub</span>&nbsp;<span class="op" id="3475570">[</span><span class="op" id="3475571">]</span><span class="op" id="3475572">*</span><span class="ident" id="3475573">Regexp</span><span class="op" id="3475579">,</span>&nbsp;<span class="ident" id="3475581">flags</span>&nbsp;<span class="ident" id="3475587">Flags</span><span class="op" id="3475592">)</span>&nbsp;<span class="op" id="3475594">[</span><span class="op" id="3475595">]</span><span class="op" id="3475596">*</span><span class="ident" id="3475597">Regexp</span>&nbsp;<span class="op" id="3475604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475607">if</span>&nbsp;<span class="builtinfunc" id="3475610">len</span><span class="op" id="3475613">(</span><span class="ident" id="3475614">sub</span><span class="op" id="3475617">)</span>&nbsp;<span class="op" id="3475619">&lt;</span>&nbsp;<span class="num" id="3475621">2</span>&nbsp;<span class="op" id="3475623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475627">return</span>&nbsp;<span class="ident" id="3475634">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3475639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475643">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475692">var</span>&nbsp;<span class="ident" id="3475696">str</span>&nbsp;<span class="op" id="3475700">[</span><span class="op" id="3475701">]</span><span class="builtintype" id="3475702">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475708">var</span>&nbsp;<span class="ident" id="3475712">strflags</span>&nbsp;<span class="ident" id="3475721">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475728">start</span>&nbsp;<span class="op" id="3475734">:=</span>&nbsp;<span class="num" id="3475737">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3475740">out</span>&nbsp;<span class="op" id="3475744">:=</span>&nbsp;<span class="ident" id="3475747">sub</span><span class="op" id="3475750">[</span><span class="op" id="3475751">:</span><span class="num" id="3475752">0</span><span class="op" id="3475753">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3475756">for</span>&nbsp;<span class="ident" id="3475760">i</span>&nbsp;<span class="op" id="3475762">:=</span>&nbsp;<span class="num" id="3475765">0</span><span class="op" id="3475766">;</span>&nbsp;<span class="ident" id="3475768">i</span>&nbsp;<span class="op" id="3475770">&lt;=</span>&nbsp;<span class="builtinfunc" id="3475773">len</span><span class="op" id="3475776">(</span><span class="ident" id="3475777">sub</span><span class="op" id="3475780">)</span><span class="op" id="3475781">;</span>&nbsp;<span class="ident" id="3475783">i</span><span class="op" id="3475784">++</span>&nbsp;<span class="op" id="3475787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475791">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475855">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475922">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475956">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3475961">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476025">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476064">var</span>&nbsp;<span class="ident" id="3476068">istr</span>&nbsp;<span class="op" id="3476073">[</span><span class="op" id="3476074">]</span><span class="builtintype" id="3476075">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476082">var</span>&nbsp;<span class="ident" id="3476086">iflags</span>&nbsp;<span class="ident" id="3476093">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476101">if</span>&nbsp;<span class="ident" id="3476104">i</span>&nbsp;<span class="op" id="3476106">&lt;</span>&nbsp;<span class="builtinfunc" id="3476108">len</span><span class="op" id="3476111">(</span><span class="ident" id="3476112">sub</span><span class="op" id="3476115">)</span>&nbsp;<span class="op" id="3476117">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476122">istr</span><span class="op" id="3476126">,</span>&nbsp;<span class="ident" id="3476128">iflags</span>&nbsp;<span class="op" id="3476135">=</span>&nbsp;<span class="ident" id="3476137">p</span><span class="op" id="3476138">.</span><span class="ident" id="3476139">leadingString</span><span class="op" id="3476152">(</span><span class="ident" id="3476153">sub</span><span class="op" id="3476156">[</span><span class="ident" id="3476157">i</span><span class="op" id="3476158">]</span><span class="op" id="3476159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476164">if</span>&nbsp;<span class="ident" id="3476167">iflags</span>&nbsp;<span class="op" id="3476174">==</span>&nbsp;<span class="ident" id="3476177">strflags</span>&nbsp;<span class="op" id="3476186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476192">same</span>&nbsp;<span class="op" id="3476197">:=</span>&nbsp;<span class="num" id="3476200">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476206">for</span>&nbsp;<span class="ident" id="3476210">same</span>&nbsp;<span class="op" id="3476215">&lt;</span>&nbsp;<span class="builtinfunc" id="3476217">len</span><span class="op" id="3476220">(</span><span class="ident" id="3476221">str</span><span class="op" id="3476224">)</span>&nbsp;<span class="op" id="3476226">&amp;&amp;</span>&nbsp;<span class="ident" id="3476229">same</span>&nbsp;<span class="op" id="3476234">&lt;</span>&nbsp;<span class="builtinfunc" id="3476236">len</span><span class="op" id="3476239">(</span><span class="ident" id="3476240">istr</span><span class="op" id="3476244">)</span>&nbsp;<span class="op" id="3476246">&amp;&amp;</span>&nbsp;<span class="ident" id="3476249">str</span><span class="op" id="3476252">[</span><span class="ident" id="3476253">same</span><span class="op" id="3476257">]</span>&nbsp;<span class="op" id="3476259">==</span>&nbsp;<span class="ident" id="3476262">istr</span><span class="op" id="3476266">[</span><span class="ident" id="3476267">same</span><span class="op" id="3476271">]</span>&nbsp;<span class="op" id="3476273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476280">same</span><span class="op" id="3476284">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476297">if</span>&nbsp;<span class="ident" id="3476300">same</span>&nbsp;<span class="op" id="3476305">&gt;</span>&nbsp;<span class="num" id="3476307">0</span>&nbsp;<span class="op" id="3476309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476316">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476368">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476395">str</span>&nbsp;<span class="op" id="3476399">=</span>&nbsp;<span class="ident" id="3476401">str</span><span class="op" id="3476404">[</span><span class="op" id="3476405">:</span><span class="ident" id="3476406">same</span><span class="op" id="3476410">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476444">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476504">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476565">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476603">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476608">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3476677">if</span>&nbsp;<span class="ident" id="3476680">i</span>&nbsp;<span class="op" id="3476682">==</span>&nbsp;<span class="ident" id="3476685">start</span>&nbsp;<span class="op" id="3476691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476696">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476734">}</span>&nbsp;<span class="keyword" id="3476736">else</span>&nbsp;<span class="keyword" id="3476741">if</span>&nbsp;<span class="ident" id="3476744">i</span>&nbsp;<span class="op" id="3476746">==</span>&nbsp;<span class="ident" id="3476749">start</span><span class="op" id="3476754">+</span><span class="num" id="3476755">1</span>&nbsp;<span class="op" id="3476757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476762">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476802">out</span>&nbsp;<span class="op" id="3476806">=</span>&nbsp;<span class="builtinfunc" id="3476808">append</span><span class="op" id="3476814">(</span><span class="ident" id="3476815">out</span><span class="op" id="3476818">,</span>&nbsp;<span class="ident" id="3476820">sub</span><span class="op" id="3476823">[</span><span class="ident" id="3476824">start</span><span class="op" id="3476829">]</span><span class="op" id="3476830">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3476834">}</span>&nbsp;<span class="keyword" id="3476836">else</span>&nbsp;<span class="op" id="3476841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3476846">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476905">prefix</span>&nbsp;<span class="op" id="3476912">:=</span>&nbsp;<span class="ident" id="3476915">p</span><span class="op" id="3476916">.</span><span class="ident" id="3476917">newRegexp</span><span class="op" id="3476926">(</span><span class="ident" id="3476927">OpLiteral</span><span class="op" id="3476936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476941">prefix</span><span class="op" id="3476947">.</span><span class="ident" id="3476948">Flags</span>&nbsp;<span class="op" id="3476954">=</span>&nbsp;<span class="ident" id="3476956">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3476968">prefix</span><span class="op" id="3476974">.</span><span class="ident" id="3476975">Rune</span>&nbsp;<span class="op" id="3476980">=</span>&nbsp;<span class="builtinfunc" id="3476982">append</span><span class="op" id="3476988">(</span><span class="ident" id="3476989">prefix</span><span class="op" id="3476995">.</span><span class="ident" id="3476996">Rune</span><span class="op" id="3477000">[</span><span class="op" id="3477001">:</span><span class="num" id="3477002">0</span><span class="op" id="3477003">]</span><span class="op" id="3477004">,</span>&nbsp;<span class="ident" id="3477006">str</span><span class="op" id="3477009">...</span><span class="op" id="3477012">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477018">for</span>&nbsp;<span class="ident" id="3477022">j</span>&nbsp;<span class="op" id="3477024">:=</span>&nbsp;<span class="ident" id="3477027">start</span><span class="op" id="3477032">;</span>&nbsp;<span class="ident" id="3477034">j</span>&nbsp;<span class="op" id="3477036">&lt;</span>&nbsp;<span class="ident" id="3477038">i</span><span class="op" id="3477039">;</span>&nbsp;<span class="ident" id="3477041">j</span><span class="op" id="3477042">++</span>&nbsp;<span class="op" id="3477045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477051">sub</span><span class="op" id="3477054">[</span><span class="ident" id="3477055">j</span><span class="op" id="3477056">]</span>&nbsp;<span class="op" id="3477058">=</span>&nbsp;<span class="ident" id="3477060">p</span><span class="op" id="3477061">.</span><span class="ident" id="3477062">removeLeadingString</span><span class="op" id="3477081">(</span><span class="ident" id="3477082">sub</span><span class="op" id="3477085">[</span><span class="ident" id="3477086">j</span><span class="op" id="3477087">]</span><span class="op" id="3477088">,</span>&nbsp;<span class="builtinfunc" id="3477090">len</span><span class="op" id="3477093">(</span><span class="ident" id="3477094">str</span><span class="op" id="3477097">)</span><span class="op" id="3477098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477108">suffix</span>&nbsp;<span class="op" id="3477115">:=</span>&nbsp;<span class="ident" id="3477118">p</span><span class="op" id="3477119">.</span><span class="ident" id="3477120">collapse</span><span class="op" id="3477128">(</span><span class="ident" id="3477129">sub</span><span class="op" id="3477132">[</span><span class="ident" id="3477133">start</span><span class="op" id="3477138">:</span><span class="ident" id="3477139">i</span><span class="op" id="3477140">]</span><span class="op" id="3477141">,</span>&nbsp;<span class="ident" id="3477143">OpAlternate</span><span class="op" id="3477154">)</span>&nbsp;<span class="comment" id="3477156">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477171">re</span>&nbsp;<span class="op" id="3477174">:=</span>&nbsp;<span class="ident" id="3477177">p</span><span class="op" id="3477178">.</span><span class="ident" id="3477179">newRegexp</span><span class="op" id="3477188">(</span><span class="ident" id="3477189">OpConcat</span><span class="op" id="3477197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477202">re</span><span class="op" id="3477204">.</span><span class="ident" id="3477205">Sub</span>&nbsp;<span class="op" id="3477209">=</span>&nbsp;<span class="builtinfunc" id="3477211">append</span><span class="op" id="3477217">(</span><span class="ident" id="3477218">re</span><span class="op" id="3477220">.</span><span class="ident" id="3477221">Sub</span><span class="op" id="3477224">[</span><span class="op" id="3477225">:</span><span class="num" id="3477226">0</span><span class="op" id="3477227">]</span><span class="op" id="3477228">,</span>&nbsp;<span class="ident" id="3477230">prefix</span><span class="op" id="3477236">,</span>&nbsp;<span class="ident" id="3477238">suffix</span><span class="op" id="3477244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477249">out</span>&nbsp;<span class="op" id="3477253">=</span>&nbsp;<span class="builtinfunc" id="3477255">append</span><span class="op" id="3477261">(</span><span class="ident" id="3477262">out</span><span class="op" id="3477265">,</span>&nbsp;<span class="ident" id="3477267">re</span><span class="op" id="3477269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477273">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477278">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477311">start</span>&nbsp;<span class="op" id="3477317">=</span>&nbsp;<span class="ident" id="3477319">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477323">str</span>&nbsp;<span class="op" id="3477327">=</span>&nbsp;<span class="ident" id="3477329">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477336">strflags</span>&nbsp;<span class="op" id="3477345">=</span>&nbsp;<span class="ident" id="3477347">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477358">sub</span>&nbsp;<span class="op" id="3477362">=</span>&nbsp;<span class="ident" id="3477364">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477370">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477419">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477467">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477527">start</span>&nbsp;<span class="op" id="3477533">=</span>&nbsp;<span class="num" id="3477535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477538">out</span>&nbsp;<span class="op" id="3477542">=</span>&nbsp;<span class="ident" id="3477544">sub</span><span class="op" id="3477547">[</span><span class="op" id="3477548">:</span><span class="num" id="3477549">0</span><span class="op" id="3477550">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477553">var</span>&nbsp;<span class="ident" id="3477557">first</span>&nbsp;<span class="op" id="3477563">*</span><span class="ident" id="3477564">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477572">for</span>&nbsp;<span class="ident" id="3477576">i</span>&nbsp;<span class="op" id="3477578">:=</span>&nbsp;<span class="num" id="3477581">0</span><span class="op" id="3477582">;</span>&nbsp;<span class="ident" id="3477584">i</span>&nbsp;<span class="op" id="3477586">&lt;=</span>&nbsp;<span class="builtinfunc" id="3477589">len</span><span class="op" id="3477592">(</span><span class="ident" id="3477593">sub</span><span class="op" id="3477596">)</span><span class="op" id="3477597">;</span>&nbsp;<span class="ident" id="3477599">i</span><span class="op" id="3477600">++</span>&nbsp;<span class="op" id="3477603">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477607">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477671">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477738">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477772">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477777">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477854">var</span>&nbsp;<span class="ident" id="3477858">ifirst</span>&nbsp;<span class="op" id="3477865">*</span><span class="ident" id="3477866">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477875">if</span>&nbsp;<span class="ident" id="3477878">i</span>&nbsp;<span class="op" id="3477880">&lt;</span>&nbsp;<span class="builtinfunc" id="3477882">len</span><span class="op" id="3477885">(</span><span class="ident" id="3477886">sub</span><span class="op" id="3477889">)</span>&nbsp;<span class="op" id="3477891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3477896">ifirst</span>&nbsp;<span class="op" id="3477903">=</span>&nbsp;<span class="ident" id="3477905">p</span><span class="op" id="3477906">.</span><span class="ident" id="3477907">leadingRegexp</span><span class="op" id="3477920">(</span><span class="ident" id="3477921">sub</span><span class="op" id="3477924">[</span><span class="ident" id="3477925">i</span><span class="op" id="3477926">]</span><span class="op" id="3477927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477932">if</span>&nbsp;<span class="ident" id="3477935">first</span>&nbsp;<span class="op" id="3477941">!=</span>&nbsp;<span class="builtintype" id="3477944">nil</span>&nbsp;<span class="op" id="3477948">&amp;&amp;</span>&nbsp;<span class="ident" id="3477951">first</span><span class="op" id="3477956">.</span><span class="ident" id="3477957">Equal</span><span class="op" id="3477962">(</span><span class="ident" id="3477963">ifirst</span><span class="op" id="3477969">)</span>&nbsp;<span class="op" id="3477971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3477977">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3477993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3477998">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478050">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478110">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478115">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478184">if</span>&nbsp;<span class="ident" id="3478187">i</span>&nbsp;<span class="op" id="3478189">==</span>&nbsp;<span class="ident" id="3478192">start</span>&nbsp;<span class="op" id="3478198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478203">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478241">}</span>&nbsp;<span class="keyword" id="3478243">else</span>&nbsp;<span class="keyword" id="3478248">if</span>&nbsp;<span class="ident" id="3478251">i</span>&nbsp;<span class="op" id="3478253">==</span>&nbsp;<span class="ident" id="3478256">start</span><span class="op" id="3478261">+</span><span class="num" id="3478262">1</span>&nbsp;<span class="op" id="3478264">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478269">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478309">out</span>&nbsp;<span class="op" id="3478313">=</span>&nbsp;<span class="builtinfunc" id="3478315">append</span><span class="op" id="3478321">(</span><span class="ident" id="3478322">out</span><span class="op" id="3478325">,</span>&nbsp;<span class="ident" id="3478327">sub</span><span class="op" id="3478330">[</span><span class="ident" id="3478331">start</span><span class="op" id="3478336">]</span><span class="op" id="3478337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478341">}</span>&nbsp;<span class="keyword" id="3478343">else</span>&nbsp;<span class="op" id="3478348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478353">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478412">prefix</span>&nbsp;<span class="op" id="3478419">:=</span>&nbsp;<span class="ident" id="3478422">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478431">for</span>&nbsp;<span class="ident" id="3478435">j</span>&nbsp;<span class="op" id="3478437">:=</span>&nbsp;<span class="ident" id="3478440">start</span><span class="op" id="3478445">;</span>&nbsp;<span class="ident" id="3478447">j</span>&nbsp;<span class="op" id="3478449">&lt;</span>&nbsp;<span class="ident" id="3478451">i</span><span class="op" id="3478452">;</span>&nbsp;<span class="ident" id="3478454">j</span><span class="op" id="3478455">++</span>&nbsp;<span class="op" id="3478458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478464">reuse</span>&nbsp;<span class="op" id="3478470">:=</span>&nbsp;<span class="ident" id="3478473">j</span>&nbsp;<span class="op" id="3478475">!=</span>&nbsp;<span class="ident" id="3478478">start</span>&nbsp;<span class="comment" id="3478484">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478519">sub</span><span class="op" id="3478522">[</span><span class="ident" id="3478523">j</span><span class="op" id="3478524">]</span>&nbsp;<span class="op" id="3478526">=</span>&nbsp;<span class="ident" id="3478528">p</span><span class="op" id="3478529">.</span><span class="ident" id="3478530">removeLeadingRegexp</span><span class="op" id="3478549">(</span><span class="ident" id="3478550">sub</span><span class="op" id="3478553">[</span><span class="ident" id="3478554">j</span><span class="op" id="3478555">]</span><span class="op" id="3478556">,</span>&nbsp;<span class="ident" id="3478558">reuse</span><span class="op" id="3478563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478573">suffix</span>&nbsp;<span class="op" id="3478580">:=</span>&nbsp;<span class="ident" id="3478583">p</span><span class="op" id="3478584">.</span><span class="ident" id="3478585">collapse</span><span class="op" id="3478593">(</span><span class="ident" id="3478594">sub</span><span class="op" id="3478597">[</span><span class="ident" id="3478598">start</span><span class="op" id="3478603">:</span><span class="ident" id="3478604">i</span><span class="op" id="3478605">]</span><span class="op" id="3478606">,</span>&nbsp;<span class="ident" id="3478608">OpAlternate</span><span class="op" id="3478619">)</span>&nbsp;<span class="comment" id="3478621">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478636">re</span>&nbsp;<span class="op" id="3478639">:=</span>&nbsp;<span class="ident" id="3478642">p</span><span class="op" id="3478643">.</span><span class="ident" id="3478644">newRegexp</span><span class="op" id="3478653">(</span><span class="ident" id="3478654">OpConcat</span><span class="op" id="3478662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478667">re</span><span class="op" id="3478669">.</span><span class="ident" id="3478670">Sub</span>&nbsp;<span class="op" id="3478674">=</span>&nbsp;<span class="builtinfunc" id="3478676">append</span><span class="op" id="3478682">(</span><span class="ident" id="3478683">re</span><span class="op" id="3478685">.</span><span class="ident" id="3478686">Sub</span><span class="op" id="3478689">[</span><span class="op" id="3478690">:</span><span class="num" id="3478691">0</span><span class="op" id="3478692">]</span><span class="op" id="3478693">,</span>&nbsp;<span class="ident" id="3478695">prefix</span><span class="op" id="3478701">,</span>&nbsp;<span class="ident" id="3478703">suffix</span><span class="op" id="3478709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478714">out</span>&nbsp;<span class="op" id="3478718">=</span>&nbsp;<span class="builtinfunc" id="3478720">append</span><span class="op" id="3478726">(</span><span class="ident" id="3478727">out</span><span class="op" id="3478730">,</span>&nbsp;<span class="ident" id="3478732">re</span><span class="op" id="3478734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478738">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478743">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478776">start</span>&nbsp;<span class="op" id="3478782">=</span>&nbsp;<span class="ident" id="3478784">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478788">first</span>&nbsp;<span class="op" id="3478794">=</span>&nbsp;<span class="ident" id="3478796">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3478804">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478807">sub</span>&nbsp;<span class="op" id="3478811">=</span>&nbsp;<span class="ident" id="3478813">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478819">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478889">start</span>&nbsp;<span class="op" id="3478895">=</span>&nbsp;<span class="num" id="3478897">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3478900">out</span>&nbsp;<span class="op" id="3478904">=</span>&nbsp;<span class="ident" id="3478906">sub</span><span class="op" id="3478909">[</span><span class="op" id="3478910">:</span><span class="num" id="3478911">0</span><span class="op" id="3478912">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3478915">for</span>&nbsp;<span class="ident" id="3478919">i</span>&nbsp;<span class="op" id="3478921">:=</span>&nbsp;<span class="num" id="3478924">0</span><span class="op" id="3478925">;</span>&nbsp;<span class="ident" id="3478927">i</span>&nbsp;<span class="op" id="3478929">&lt;=</span>&nbsp;<span class="builtinfunc" id="3478932">len</span><span class="op" id="3478935">(</span><span class="ident" id="3478936">sub</span><span class="op" id="3478939">)</span><span class="op" id="3478940">;</span>&nbsp;<span class="ident" id="3478942">i</span><span class="op" id="3478943">++</span>&nbsp;<span class="op" id="3478946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3478950">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479014">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479081">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479115">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479120">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479185">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479226">if</span>&nbsp;<span class="ident" id="3479229">i</span>&nbsp;<span class="op" id="3479231">&lt;</span>&nbsp;<span class="builtinfunc" id="3479233">len</span><span class="op" id="3479236">(</span><span class="ident" id="3479237">sub</span><span class="op" id="3479240">)</span>&nbsp;<span class="op" id="3479242">&amp;&amp;</span>&nbsp;<span class="ident" id="3479245">isCharClass</span><span class="op" id="3479256">(</span><span class="ident" id="3479257">sub</span><span class="op" id="3479260">[</span><span class="ident" id="3479261">i</span><span class="op" id="3479262">]</span><span class="op" id="3479263">)</span>&nbsp;<span class="op" id="3479265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479281">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479286">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479327">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479368">if</span>&nbsp;<span class="ident" id="3479371">i</span>&nbsp;<span class="op" id="3479373">==</span>&nbsp;<span class="ident" id="3479376">start</span>&nbsp;<span class="op" id="3479382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479387">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479425">}</span>&nbsp;<span class="keyword" id="3479427">else</span>&nbsp;<span class="keyword" id="3479432">if</span>&nbsp;<span class="ident" id="3479435">i</span>&nbsp;<span class="op" id="3479437">==</span>&nbsp;<span class="ident" id="3479440">start</span><span class="op" id="3479445">+</span><span class="num" id="3479446">1</span>&nbsp;<span class="op" id="3479448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479453">out</span>&nbsp;<span class="op" id="3479457">=</span>&nbsp;<span class="builtinfunc" id="3479459">append</span><span class="op" id="3479465">(</span><span class="ident" id="3479466">out</span><span class="op" id="3479469">,</span>&nbsp;<span class="ident" id="3479471">sub</span><span class="op" id="3479474">[</span><span class="ident" id="3479475">start</span><span class="op" id="3479480">]</span><span class="op" id="3479481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479485">}</span>&nbsp;<span class="keyword" id="3479487">else</span>&nbsp;<span class="op" id="3479492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479497">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479524">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479576">max</span>&nbsp;<span class="op" id="3479580">:=</span>&nbsp;<span class="ident" id="3479583">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479592">for</span>&nbsp;<span class="ident" id="3479596">j</span>&nbsp;<span class="op" id="3479598">:=</span>&nbsp;<span class="ident" id="3479601">start</span>&nbsp;<span class="op" id="3479607">+</span>&nbsp;<span class="num" id="3479609">1</span><span class="op" id="3479610">;</span>&nbsp;<span class="ident" id="3479612">j</span>&nbsp;<span class="op" id="3479614">&lt;</span>&nbsp;<span class="ident" id="3479616">i</span><span class="op" id="3479617">;</span>&nbsp;<span class="ident" id="3479619">j</span><span class="op" id="3479620">++</span>&nbsp;<span class="op" id="3479623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479629">if</span>&nbsp;<span class="ident" id="3479632">sub</span><span class="op" id="3479635">[</span><span class="ident" id="3479636">max</span><span class="op" id="3479639">]</span><span class="op" id="3479640">.</span><span class="ident" id="3479641">Op</span>&nbsp;<span class="op" id="3479644">&lt;</span>&nbsp;<span class="ident" id="3479646">sub</span><span class="op" id="3479649">[</span><span class="ident" id="3479650">j</span><span class="op" id="3479651">]</span><span class="op" id="3479652">.</span><span class="ident" id="3479653">Op</span>&nbsp;<span class="op" id="3479656">||</span>&nbsp;<span class="ident" id="3479659">sub</span><span class="op" id="3479662">[</span><span class="ident" id="3479663">max</span><span class="op" id="3479666">]</span><span class="op" id="3479667">.</span><span class="ident" id="3479668">Op</span>&nbsp;<span class="op" id="3479671">==</span>&nbsp;<span class="ident" id="3479674">sub</span><span class="op" id="3479677">[</span><span class="ident" id="3479678">j</span><span class="op" id="3479679">]</span><span class="op" id="3479680">.</span><span class="ident" id="3479681">Op</span>&nbsp;<span class="op" id="3479684">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3479687">len</span><span class="op" id="3479690">(</span><span class="ident" id="3479691">sub</span><span class="op" id="3479694">[</span><span class="ident" id="3479695">max</span><span class="op" id="3479698">]</span><span class="op" id="3479699">.</span><span class="ident" id="3479700">Rune</span><span class="op" id="3479704">)</span>&nbsp;<span class="op" id="3479706">&lt;</span>&nbsp;<span class="builtinfunc" id="3479708">len</span><span class="op" id="3479711">(</span><span class="ident" id="3479712">sub</span><span class="op" id="3479715">[</span><span class="ident" id="3479716">j</span><span class="op" id="3479717">]</span><span class="op" id="3479718">.</span><span class="ident" id="3479719">Rune</span><span class="op" id="3479723">)</span>&nbsp;<span class="op" id="3479725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479732">max</span>&nbsp;<span class="op" id="3479736">=</span>&nbsp;<span class="ident" id="3479738">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479744">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479754">sub</span><span class="op" id="3479757">[</span><span class="ident" id="3479758">start</span><span class="op" id="3479763">]</span><span class="op" id="3479764">,</span>&nbsp;<span class="ident" id="3479766">sub</span><span class="op" id="3479769">[</span><span class="ident" id="3479770">max</span><span class="op" id="3479773">]</span>&nbsp;<span class="op" id="3479775">=</span>&nbsp;<span class="ident" id="3479777">sub</span><span class="op" id="3479780">[</span><span class="ident" id="3479781">max</span><span class="op" id="3479784">]</span><span class="op" id="3479785">,</span>&nbsp;<span class="ident" id="3479787">sub</span><span class="op" id="3479790">[</span><span class="ident" id="3479791">start</span><span class="op" id="3479796">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479802">for</span>&nbsp;<span class="ident" id="3479806">j</span>&nbsp;<span class="op" id="3479808">:=</span>&nbsp;<span class="ident" id="3479811">start</span>&nbsp;<span class="op" id="3479817">+</span>&nbsp;<span class="num" id="3479819">1</span><span class="op" id="3479820">;</span>&nbsp;<span class="ident" id="3479822">j</span>&nbsp;<span class="op" id="3479824">&lt;</span>&nbsp;<span class="ident" id="3479826">i</span><span class="op" id="3479827">;</span>&nbsp;<span class="ident" id="3479829">j</span><span class="op" id="3479830">++</span>&nbsp;<span class="op" id="3479833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479839">mergeCharClass</span><span class="op" id="3479853">(</span><span class="ident" id="3479854">sub</span><span class="op" id="3479857">[</span><span class="ident" id="3479858">start</span><span class="op" id="3479863">]</span><span class="op" id="3479864">,</span>&nbsp;<span class="ident" id="3479866">sub</span><span class="op" id="3479869">[</span><span class="ident" id="3479870">j</span><span class="op" id="3479871">]</span><span class="op" id="3479872">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479878">p</span><span class="op" id="3479879">.</span><span class="ident" id="3479880">reuse</span><span class="op" id="3479885">(</span><span class="ident" id="3479886">sub</span><span class="op" id="3479889">[</span><span class="ident" id="3479890">j</span><span class="op" id="3479891">]</span><span class="op" id="3479892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479902">cleanAlt</span><span class="op" id="3479910">(</span><span class="ident" id="3479911">sub</span><span class="op" id="3479914">[</span><span class="ident" id="3479915">start</span><span class="op" id="3479920">]</span><span class="op" id="3479921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3479926">out</span>&nbsp;<span class="op" id="3479930">=</span>&nbsp;<span class="builtinfunc" id="3479932">append</span><span class="op" id="3479938">(</span><span class="ident" id="3479939">out</span><span class="op" id="3479942">,</span>&nbsp;<span class="ident" id="3479944">sub</span><span class="op" id="3479947">[</span><span class="ident" id="3479948">start</span><span class="op" id="3479953">]</span><span class="op" id="3479954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3479958">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3479963">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3479994">if</span>&nbsp;<span class="ident" id="3479997">i</span>&nbsp;<span class="op" id="3479999">&lt;</span>&nbsp;<span class="builtinfunc" id="3480001">len</span><span class="op" id="3480004">(</span><span class="ident" id="3480005">sub</span><span class="op" id="3480008">)</span>&nbsp;<span class="op" id="3480010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480015">out</span>&nbsp;<span class="op" id="3480019">=</span>&nbsp;<span class="builtinfunc" id="3480021">append</span><span class="op" id="3480027">(</span><span class="ident" id="3480028">out</span><span class="op" id="3480031">,</span>&nbsp;<span class="ident" id="3480033">sub</span><span class="op" id="3480036">[</span><span class="ident" id="3480037">i</span><span class="op" id="3480038">]</span><span class="op" id="3480039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480043">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480047">start</span>&nbsp;<span class="op" id="3480053">=</span>&nbsp;<span class="ident" id="3480055">i</span>&nbsp;<span class="op" id="3480057">+</span>&nbsp;<span class="num" id="3480059">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480065">sub</span>&nbsp;<span class="op" id="3480069">=</span>&nbsp;<span class="ident" id="3480071">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3480077">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480148">start</span>&nbsp;<span class="op" id="3480154">=</span>&nbsp;<span class="num" id="3480156">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480159">out</span>&nbsp;<span class="op" id="3480163">=</span>&nbsp;<span class="ident" id="3480165">sub</span><span class="op" id="3480168">[</span><span class="op" id="3480169">:</span><span class="num" id="3480170">0</span><span class="op" id="3480171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480174">for</span>&nbsp;<span class="ident" id="3480178">i</span>&nbsp;<span class="op" id="3480180">:=</span>&nbsp;<span class="keyword" id="3480183">range</span>&nbsp;<span class="ident" id="3480189">sub</span>&nbsp;<span class="op" id="3480193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480197">if</span>&nbsp;<span class="ident" id="3480200">i</span><span class="op" id="3480201">+</span><span class="num" id="3480202">1</span>&nbsp;<span class="op" id="3480204">&lt;</span>&nbsp;<span class="builtinfunc" id="3480206">len</span><span class="op" id="3480209">(</span><span class="ident" id="3480210">sub</span><span class="op" id="3480213">)</span>&nbsp;<span class="op" id="3480215">&amp;&amp;</span>&nbsp;<span class="ident" id="3480218">sub</span><span class="op" id="3480221">[</span><span class="ident" id="3480222">i</span><span class="op" id="3480223">]</span><span class="op" id="3480224">.</span><span class="ident" id="3480225">Op</span>&nbsp;<span class="op" id="3480228">==</span>&nbsp;<span class="ident" id="3480231">OpEmptyMatch</span>&nbsp;<span class="op" id="3480244">&amp;&amp;</span>&nbsp;<span class="ident" id="3480247">sub</span><span class="op" id="3480250">[</span><span class="ident" id="3480251">i</span><span class="op" id="3480252">+</span><span class="num" id="3480253">1</span><span class="op" id="3480254">]</span><span class="op" id="3480255">.</span><span class="ident" id="3480256">Op</span>&nbsp;<span class="op" id="3480259">==</span>&nbsp;<span class="ident" id="3480262">OpEmptyMatch</span>&nbsp;<span class="op" id="3480275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480280">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480295">out</span>&nbsp;<span class="op" id="3480299">=</span>&nbsp;<span class="builtinfunc" id="3480301">append</span><span class="op" id="3480307">(</span><span class="ident" id="3480308">out</span><span class="op" id="3480311">,</span>&nbsp;<span class="ident" id="3480313">sub</span><span class="op" id="3480316">[</span><span class="ident" id="3480317">i</span><span class="op" id="3480318">]</span><span class="op" id="3480319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480325">sub</span>&nbsp;<span class="op" id="3480329">=</span>&nbsp;<span class="ident" id="3480331">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480337">return</span>&nbsp;<span class="ident" id="3480344">sub</span><br>
<span class="lineno"></span><span class="op" id="3480348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3480351">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="3480424">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="3480479">func</span>&nbsp;<span class="op" id="3480484">(</span><span class="ident" id="3480485">p</span>&nbsp;<span class="op" id="3480487">*</span><span class="ident" id="3480488">parser</span><span class="op" id="3480494">)</span>&nbsp;<span class="ident" id="3480496">leadingString</span><span class="op" id="3480509">(</span><span class="ident" id="3480510">re</span>&nbsp;<span class="op" id="3480513">*</span><span class="ident" id="3480514">Regexp</span><span class="op" id="3480520">)</span>&nbsp;<span class="op" id="3480522">(</span><span class="op" id="3480523">[</span><span class="op" id="3480524">]</span><span class="builtintype" id="3480525">rune</span><span class="op" id="3480529">,</span>&nbsp;<span class="ident" id="3480531">Flags</span><span class="op" id="3480536">)</span>&nbsp;<span class="op" id="3480538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480541">if</span>&nbsp;<span class="ident" id="3480544">re</span><span class="op" id="3480546">.</span><span class="ident" id="3480547">Op</span>&nbsp;<span class="op" id="3480550">==</span>&nbsp;<span class="ident" id="3480553">OpConcat</span>&nbsp;<span class="op" id="3480562">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3480565">len</span><span class="op" id="3480568">(</span><span class="ident" id="3480569">re</span><span class="op" id="3480571">.</span><span class="ident" id="3480572">Sub</span><span class="op" id="3480575">)</span>&nbsp;<span class="op" id="3480577">&gt;</span>&nbsp;<span class="num" id="3480579">0</span>&nbsp;<span class="op" id="3480581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3480585">re</span>&nbsp;<span class="op" id="3480588">=</span>&nbsp;<span class="ident" id="3480590">re</span><span class="op" id="3480592">.</span><span class="ident" id="3480593">Sub</span><span class="op" id="3480596">[</span><span class="num" id="3480597">0</span><span class="op" id="3480598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480604">if</span>&nbsp;<span class="ident" id="3480607">re</span><span class="op" id="3480609">.</span><span class="ident" id="3480610">Op</span>&nbsp;<span class="op" id="3480613">!=</span>&nbsp;<span class="ident" id="3480616">OpLiteral</span>&nbsp;<span class="op" id="3480626">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480630">return</span>&nbsp;<span class="builtintype" id="3480637">nil</span><span class="op" id="3480640">,</span>&nbsp;<span class="num" id="3480642">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3480645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480648">return</span>&nbsp;<span class="ident" id="3480655">re</span><span class="op" id="3480657">.</span><span class="ident" id="3480658">Rune</span><span class="op" id="3480662">,</span>&nbsp;<span class="ident" id="3480664">re</span><span class="op" id="3480666">.</span><span class="ident" id="3480667">Flags</span>&nbsp;<span class="op" id="3480673">&amp;</span>&nbsp;<span class="ident" id="3480675">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="3480684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="3480687">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="3480744">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="3480809">func</span>&nbsp;<span class="op" id="3480814">(</span><span class="ident" id="3480815">p</span>&nbsp;<span class="op" id="3480817">*</span><span class="ident" id="3480818">parser</span><span class="op" id="3480824">)</span>&nbsp;<span class="ident" id="3480826">removeLeadingString</span><span class="op" id="3480845">(</span><span class="ident" id="3480846">re</span>&nbsp;<span class="op" id="3480849">*</span><span class="ident" id="3480850">Regexp</span><span class="op" id="3480856">,</span>&nbsp;<span class="ident" id="3480858">n</span>&nbsp;<span class="builtintype" id="3480860">int</span><span class="op" id="3480863">)</span>&nbsp;<span class="op" id="3480865">*</span><span class="ident" id="3480866">Regexp</span>&nbsp;<span class="op" id="3480873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3480876">if</span>&nbsp;<span class="ident" id="3480879">re</span><span class="op" id="3480881">.</span><span class="ident" id="3480882">Op</span>&nbsp;<span class="op" id="3480885">==</span>&nbsp;<span class="ident" id="3480888">OpConcat</span>&nbsp;<span class="op" id="3480897">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3480900">len</span><span class="op" id="3480903">(</span><span class="ident" id="3480904">re</span><span class="op" id="3480906">.</span><span class="ident" id="3480907">Sub</span><span class="op" id="3480910">)</span>&nbsp;<span class="op" id="3480912">&gt;</span>&nbsp;<span class="num" id="3480914">0</span>&nbsp;<span class="op" id="3480916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3480920">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3480970">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481009">sub</span>&nbsp;<span class="op" id="3481013">:=</span>&nbsp;<span class="ident" id="3481016">re</span><span class="op" id="3481018">.</span><span class="ident" id="3481019">Sub</span><span class="op" id="3481022">[</span><span class="num" id="3481023">0</span><span class="op" id="3481024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481028">sub</span>&nbsp;<span class="op" id="3481032">=</span>&nbsp;<span class="ident" id="3481034">p</span><span class="op" id="3481035">.</span><span class="ident" id="3481036">removeLeadingString</span><span class="op" id="3481055">(</span><span class="ident" id="3481056">sub</span><span class="op" id="3481059">,</span>&nbsp;<span class="ident" id="3481061">n</span><span class="op" id="3481062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481066">re</span><span class="op" id="3481068">.</span><span class="ident" id="3481069">Sub</span><span class="op" id="3481072">[</span><span class="num" id="3481073">0</span><span class="op" id="3481074">]</span>&nbsp;<span class="op" id="3481076">=</span>&nbsp;<span class="ident" id="3481078">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481084">if</span>&nbsp;<span class="ident" id="3481087">sub</span><span class="op" id="3481090">.</span><span class="ident" id="3481091">Op</span>&nbsp;<span class="op" id="3481094">==</span>&nbsp;<span class="ident" id="3481097">OpEmptyMatch</span>&nbsp;<span class="op" id="3481110">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481115">p</span><span class="op" id="3481116">.</span><span class="ident" id="3481117">reuse</span><span class="op" id="3481122">(</span><span class="ident" id="3481123">sub</span><span class="op" id="3481126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481131">switch</span>&nbsp;<span class="builtinfunc" id="3481138">len</span><span class="op" id="3481141">(</span><span class="ident" id="3481142">re</span><span class="op" id="3481144">.</span><span class="ident" id="3481145">Sub</span><span class="op" id="3481148">)</span>&nbsp;<span class="op" id="3481150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481155">case</span>&nbsp;<span class="num" id="3481160">0</span><span class="op" id="3481161">,</span>&nbsp;<span class="num" id="3481163">1</span><span class="op" id="3481164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3481170">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481200">re</span><span class="op" id="3481202">.</span><span class="ident" id="3481203">Op</span>&nbsp;<span class="op" id="3481206">=</span>&nbsp;<span class="ident" id="3481208">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481225">re</span><span class="op" id="3481227">.</span><span class="ident" id="3481228">Sub</span>&nbsp;<span class="op" id="3481232">=</span>&nbsp;<span class="builtintype" id="3481234">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481241">case</span>&nbsp;<span class="num" id="3481246">2</span><span class="op" id="3481247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481253">old</span>&nbsp;<span class="op" id="3481257">:=</span>&nbsp;<span class="ident" id="3481260">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481267">re</span>&nbsp;<span class="op" id="3481270">=</span>&nbsp;<span class="ident" id="3481272">re</span><span class="op" id="3481274">.</span><span class="ident" id="3481275">Sub</span><span class="op" id="3481278">[</span><span class="num" id="3481279">1</span><span class="op" id="3481280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481286">p</span><span class="op" id="3481287">.</span><span class="ident" id="3481288">reuse</span><span class="op" id="3481293">(</span><span class="ident" id="3481294">old</span><span class="op" id="3481297">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481302">default</span><span class="op" id="3481309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3481315">copy</span><span class="op" id="3481319">(</span><span class="ident" id="3481320">re</span><span class="op" id="3481322">.</span><span class="ident" id="3481323">Sub</span><span class="op" id="3481326">,</span>&nbsp;<span class="ident" id="3481328">re</span><span class="op" id="3481330">.</span><span class="ident" id="3481331">Sub</span><span class="op" id="3481334">[</span><span class="num" id="3481335">1</span><span class="op" id="3481336">:</span><span class="op" id="3481337">]</span><span class="op" id="3481338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481344">re</span><span class="op" id="3481346">.</span><span class="ident" id="3481347">Sub</span>&nbsp;<span class="op" id="3481351">=</span>&nbsp;<span class="ident" id="3481353">re</span><span class="op" id="3481355">.</span><span class="ident" id="3481356">Sub</span><span class="op" id="3481359">[</span><span class="op" id="3481360">:</span><span class="builtinfunc" id="3481361">len</span><span class="op" id="3481364">(</span><span class="ident" id="3481365">re</span><span class="op" id="3481367">.</span><span class="ident" id="3481368">Sub</span><span class="op" id="3481371">)</span><span class="op" id="3481372">-</span><span class="num" id="3481373">1</span><span class="op" id="3481374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481383">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481387">return</span>&nbsp;<span class="ident" id="3481394">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481402">if</span>&nbsp;<span class="ident" id="3481405">re</span><span class="op" id="3481407">.</span><span class="ident" id="3481408">Op</span>&nbsp;<span class="op" id="3481411">==</span>&nbsp;<span class="ident" id="3481414">OpLiteral</span>&nbsp;<span class="op" id="3481424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481428">re</span><span class="op" id="3481430">.</span><span class="ident" id="3481431">Rune</span>&nbsp;<span class="op" id="3481436">=</span>&nbsp;<span class="ident" id="3481438">re</span><span class="op" id="3481440">.</span><span class="ident" id="3481441">Rune</span><span class="op" id="3481445">[</span><span class="op" id="3481446">:</span><span class="builtinfunc" id="3481447">copy</span><span class="op" id="3481451">(</span><span class="ident" id="3481452">re</span><span class="op" id="3481454">.</span><span class="ident" id="3481455">Rune</span><span class="op" id="3481459">,</span>&nbsp;<span class="ident" id="3481461">re</span><span class="op" id="3481463">.</span><span class="ident" id="3481464">Rune</span><span class="op" id="3481468">[</span><span class="ident" id="3481469">n</span><span class="op" id="3481470">:</span><span class="op" id="3481471">]</span><span class="op" id="3481472">)</span><span class="op" id="3481473">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481477">if</span>&nbsp;<span class="builtinfunc" id="3481480">len</span><span class="op" id="3481483">(</span><span class="ident" id="3481484">re</span><span class="op" id="3481486">.</span><span class="ident" id="3481487">Rune</span><span class="op" id="3481491">)</span>&nbsp;<span class="op" id="3481493">==</span>&nbsp;<span class="num" id="3481496">0</span>&nbsp;<span class="op" id="3481498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481503">re</span><span class="op" id="3481505">.</span><span class="ident" id="3481506">Op</span>&nbsp;<span class="op" id="3481509">=</span>&nbsp;<span class="ident" id="3481511">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481532">return</span>&nbsp;<span class="ident" id="3481539">re</span><br>
<span class="lineno">630</span><span class="op" id="3481542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3481545">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="3481610">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="3481665">func</span>&nbsp;<span class="op" id="3481670">(</span><span class="ident" id="3481671">p</span>&nbsp;<span class="op" id="3481673">*</span><span class="ident" id="3481674">parser</span><span class="op" id="3481680">)</span>&nbsp;<span class="ident" id="3481682">leadingRegexp</span><span class="op" id="3481695">(</span><span class="ident" id="3481696">re</span>&nbsp;<span class="op" id="3481699">*</span><span class="ident" id="3481700">Regexp</span><span class="op" id="3481706">)</span>&nbsp;<span class="op" id="3481708">*</span><span class="ident" id="3481709">Regexp</span>&nbsp;<span class="op" id="3481716">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481719">if</span>&nbsp;<span class="ident" id="3481722">re</span><span class="op" id="3481724">.</span><span class="ident" id="3481725">Op</span>&nbsp;<span class="op" id="3481728">==</span>&nbsp;<span class="ident" id="3481731">OpEmptyMatch</span>&nbsp;<span class="op" id="3481744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481748">return</span>&nbsp;<span class="builtintype" id="3481755">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481763">if</span>&nbsp;<span class="ident" id="3481766">re</span><span class="op" id="3481768">.</span><span class="ident" id="3481769">Op</span>&nbsp;<span class="op" id="3481772">==</span>&nbsp;<span class="ident" id="3481775">OpConcat</span>&nbsp;<span class="op" id="3481784">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3481787">len</span><span class="op" id="3481790">(</span><span class="ident" id="3481791">re</span><span class="op" id="3481793">.</span><span class="ident" id="3481794">Sub</span><span class="op" id="3481797">)</span>&nbsp;<span class="op" id="3481799">&gt;</span>&nbsp;<span class="num" id="3481801">0</span>&nbsp;<span class="op" id="3481803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3481807">sub</span>&nbsp;<span class="op" id="3481811">:=</span>&nbsp;<span class="ident" id="3481814">re</span><span class="op" id="3481816">.</span><span class="ident" id="3481817">Sub</span><span class="op" id="3481820">[</span><span class="num" id="3481821">0</span><span class="op" id="3481822">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481826">if</span>&nbsp;<span class="ident" id="3481829">sub</span><span class="op" id="3481832">.</span><span class="ident" id="3481833">Op</span>&nbsp;<span class="op" id="3481836">==</span>&nbsp;<span class="ident" id="3481839">OpEmptyMatch</span>&nbsp;<span class="op" id="3481852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481857">return</span>&nbsp;<span class="builtintype" id="3481864">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481874">return</span>&nbsp;<span class="ident" id="3481881">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3481886">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3481889">return</span>&nbsp;<span class="ident" id="3481896">re</span><br>
<span class="lineno"></span><span class="op" id="3481899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3481902">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="3481959">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="3481997">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="3482081">func</span>&nbsp;<span class="op" id="3482086">(</span><span class="ident" id="3482087">p</span>&nbsp;<span class="op" id="3482089">*</span><span class="ident" id="3482090">parser</span><span class="op" id="3482096">)</span>&nbsp;<span class="ident" id="3482098">removeLeadingRegexp</span><span class="op" id="3482117">(</span><span class="ident" id="3482118">re</span>&nbsp;<span class="op" id="3482121">*</span><span class="ident" id="3482122">Regexp</span><span class="op" id="3482128">,</span>&nbsp;<span class="ident" id="3482130">reuse</span>&nbsp;<span class="builtintype" id="3482136">bool</span><span class="op" id="3482140">)</span>&nbsp;<span class="op" id="3482142">*</span><span class="ident" id="3482143">Regexp</span>&nbsp;<span class="op" id="3482150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482153">if</span>&nbsp;<span class="ident" id="3482156">re</span><span class="op" id="3482158">.</span><span class="ident" id="3482159">Op</span>&nbsp;<span class="op" id="3482162">==</span>&nbsp;<span class="ident" id="3482165">OpConcat</span>&nbsp;<span class="op" id="3482174">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3482177">len</span><span class="op" id="3482180">(</span><span class="ident" id="3482181">re</span><span class="op" id="3482183">.</span><span class="ident" id="3482184">Sub</span><span class="op" id="3482187">)</span>&nbsp;<span class="op" id="3482189">&gt;</span>&nbsp;<span class="num" id="3482191">0</span>&nbsp;<span class="op" id="3482193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482197">if</span>&nbsp;<span class="ident" id="3482200">reuse</span>&nbsp;<span class="op" id="3482206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482211">p</span><span class="op" id="3482212">.</span><span class="ident" id="3482213">reuse</span><span class="op" id="3482218">(</span><span class="ident" id="3482219">re</span><span class="op" id="3482221">.</span><span class="ident" id="3482222">Sub</span><span class="op" id="3482225">[</span><span class="num" id="3482226">0</span><span class="op" id="3482227">]</span><span class="op" id="3482228">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482236">re</span><span class="op" id="3482238">.</span><span class="ident" id="3482239">Sub</span>&nbsp;<span class="op" id="3482243">=</span>&nbsp;<span class="ident" id="3482245">re</span><span class="op" id="3482247">.</span><span class="ident" id="3482248">Sub</span><span class="op" id="3482251">[</span><span class="op" id="3482252">:</span><span class="builtinfunc" id="3482253">copy</span><span class="op" id="3482257">(</span><span class="ident" id="3482258">re</span><span class="op" id="3482260">.</span><span class="ident" id="3482261">Sub</span><span class="op" id="3482264">,</span>&nbsp;<span class="ident" id="3482266">re</span><span class="op" id="3482268">.</span><span class="ident" id="3482269">Sub</span><span class="op" id="3482272">[</span><span class="num" id="3482273">1</span><span class="op" id="3482274">:</span><span class="op" id="3482275">]</span><span class="op" id="3482276">)</span><span class="op" id="3482277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482281">switch</span>&nbsp;<span class="builtinfunc" id="3482288">len</span><span class="op" id="3482291">(</span><span class="ident" id="3482292">re</span><span class="op" id="3482294">.</span><span class="ident" id="3482295">Sub</span><span class="op" id="3482298">)</span>&nbsp;<span class="op" id="3482300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482304">case</span>&nbsp;<span class="num" id="3482309">0</span><span class="op" id="3482310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482315">re</span><span class="op" id="3482317">.</span><span class="ident" id="3482318">Op</span>&nbsp;<span class="op" id="3482321">=</span>&nbsp;<span class="ident" id="3482323">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482339">re</span><span class="op" id="3482341">.</span><span class="ident" id="3482342">Sub</span>&nbsp;<span class="op" id="3482346">=</span>&nbsp;<span class="builtintype" id="3482348">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482354">case</span>&nbsp;<span class="num" id="3482359">1</span><span class="op" id="3482360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482365">old</span>&nbsp;<span class="op" id="3482369">:=</span>&nbsp;<span class="ident" id="3482372">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482378">re</span>&nbsp;<span class="op" id="3482381">=</span>&nbsp;<span class="ident" id="3482383">re</span><span class="op" id="3482385">.</span><span class="ident" id="3482386">Sub</span><span class="op" id="3482389">[</span><span class="num" id="3482390">0</span><span class="op" id="3482391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482396">p</span><span class="op" id="3482397">.</span><span class="ident" id="3482398">reuse</span><span class="op" id="3482403">(</span><span class="ident" id="3482404">old</span><span class="op" id="3482407">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482415">return</span>&nbsp;<span class="ident" id="3482422">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482429">if</span>&nbsp;<span class="ident" id="3482432">reuse</span>&nbsp;<span class="op" id="3482438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482442">p</span><span class="op" id="3482443">.</span><span class="ident" id="3482444">reuse</span><span class="op" id="3482449">(</span><span class="ident" id="3482450">re</span><span class="op" id="3482452">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482458">return</span>&nbsp;<span class="ident" id="3482465">p</span><span class="op" id="3482466">.</span><span class="ident" id="3482467">newRegexp</span><span class="op" id="3482476">(</span><span class="ident" id="3482477">OpEmptyMatch</span><span class="op" id="3482489">)</span><br>
<span class="lineno"></span><span class="op" id="3482491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3482494">func</span>&nbsp;<span class="ident" id="3482499">literalRegexp</span><span class="op" id="3482512">(</span><span class="ident" id="3482513">s</span>&nbsp;<span class="builtintype" id="3482515">string</span><span class="op" id="3482521">,</span>&nbsp;<span class="ident" id="3482523">flags</span>&nbsp;<span class="ident" id="3482529">Flags</span><span class="op" id="3482534">)</span>&nbsp;<span class="op" id="3482536">*</span><span class="ident" id="3482537">Regexp</span>&nbsp;<span class="op" id="3482544">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482547">re</span>&nbsp;<span class="op" id="3482550">:=</span>&nbsp;<span class="op" id="3482553">&amp;</span><span class="ident" id="3482554">Regexp</span><span class="op" id="3482560">{</span><span class="ident" id="3482561">Op</span><span class="op" id="3482563">:</span>&nbsp;<span class="ident" id="3482565">OpLiteral</span><span class="op" id="3482574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482577">re</span><span class="op" id="3482579">.</span><span class="ident" id="3482580">Flags</span>&nbsp;<span class="op" id="3482586">=</span>&nbsp;<span class="ident" id="3482588">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482595">re</span><span class="op" id="3482597">.</span><span class="ident" id="3482598">Rune</span>&nbsp;<span class="op" id="3482603">=</span>&nbsp;<span class="ident" id="3482605">re</span><span class="op" id="3482607">.</span><span class="ident" id="3482608">Rune0</span><span class="op" id="3482613">[</span><span class="op" id="3482614">:</span><span class="num" id="3482615">0</span><span class="op" id="3482616">]</span>&nbsp;<span class="comment" id="3482618">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482658">for</span>&nbsp;<span class="ident" id="3482662">_</span><span class="op" id="3482663">,</span>&nbsp;<span class="ident" id="3482665">c</span>&nbsp;<span class="op" id="3482667">:=</span>&nbsp;<span class="keyword" id="3482670">range</span>&nbsp;<span class="ident" id="3482676">s</span>&nbsp;<span class="op" id="3482678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482682">if</span>&nbsp;<span class="builtinfunc" id="3482685">len</span><span class="op" id="3482688">(</span><span class="ident" id="3482689">re</span><span class="op" id="3482691">.</span><span class="ident" id="3482692">Rune</span><span class="op" id="3482696">)</span>&nbsp;<span class="op" id="3482698">&gt;=</span>&nbsp;<span class="builtinfunc" id="3482701">cap</span><span class="op" id="3482704">(</span><span class="ident" id="3482705">re</span><span class="op" id="3482707">.</span><span class="ident" id="3482708">Rune</span><span class="op" id="3482712">)</span>&nbsp;<span class="op" id="3482714">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3482719">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482779">re</span><span class="op" id="3482781">.</span><span class="ident" id="3482782">Rune</span>&nbsp;<span class="op" id="3482787">=</span>&nbsp;<span class="op" id="3482789">[</span><span class="op" id="3482790">]</span><span class="builtintype" id="3482791">rune</span><span class="op" id="3482795">(</span><span class="ident" id="3482796">s</span><span class="op" id="3482797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482802">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482814">re</span><span class="op" id="3482816">.</span><span class="ident" id="3482817">Rune</span>&nbsp;<span class="op" id="3482822">=</span>&nbsp;<span class="builtinfunc" id="3482824">append</span><span class="op" id="3482830">(</span><span class="ident" id="3482831">re</span><span class="op" id="3482833">.</span><span class="ident" id="3482834">Rune</span><span class="op" id="3482838">,</span>&nbsp;<span class="ident" id="3482840">c</span><span class="op" id="3482841">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3482844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3482847">return</span>&nbsp;<span class="ident" id="3482854">re</span><br>
<span class="lineno"></span><span class="op" id="3482857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3482860">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="3482873">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3482948">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3483017">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="3483056">func</span>&nbsp;<span class="ident" id="3483061">Parse</span><span class="op" id="3483066">(</span><span class="ident" id="3483067">s</span>&nbsp;<span class="builtintype" id="3483069">string</span><span class="op" id="3483075">,</span>&nbsp;<span class="ident" id="3483077">flags</span>&nbsp;<span class="ident" id="3483083">Flags</span><span class="op" id="3483088">)</span>&nbsp;<span class="op" id="3483090">(</span><span class="op" id="3483091">*</span><span class="ident" id="3483092">Regexp</span><span class="op" id="3483098">,</span>&nbsp;<span class="builtintype" id="3483100">error</span><span class="op" id="3483105">)</span>&nbsp;<span class="op" id="3483107">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483110">if</span>&nbsp;<span class="ident" id="3483113">flags</span><span class="op" id="3483118">&amp;</span><span class="ident" id="3483119">Literal</span>&nbsp;<span class="op" id="3483127">!=</span>&nbsp;<span class="num" id="3483130">0</span>&nbsp;<span class="op" id="3483132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483136">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483176">if</span>&nbsp;<span class="ident" id="3483179">err</span>&nbsp;<span class="op" id="3483183">:=</span>&nbsp;<span class="ident" id="3483186">checkUTF8</span><span class="op" id="3483195">(</span><span class="ident" id="3483196">s</span><span class="op" id="3483197">)</span><span class="op" id="3483198">;</span>&nbsp;<span class="ident" id="3483200">err</span>&nbsp;<span class="op" id="3483204">!=</span>&nbsp;<span class="builtintype" id="3483207">nil</span>&nbsp;<span class="op" id="3483211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483216">return</span>&nbsp;<span class="builtintype" id="3483223">nil</span><span class="op" id="3483226">,</span>&nbsp;<span class="ident" id="3483228">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483234">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483238">return</span>&nbsp;<span class="ident" id="3483245">literalRegexp</span><span class="op" id="3483258">(</span><span class="ident" id="3483259">s</span><span class="op" id="3483260">,</span>&nbsp;<span class="ident" id="3483262">flags</span><span class="op" id="3483267">)</span><span class="op" id="3483268">,</span>&nbsp;<span class="builtintype" id="3483270">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483279">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483313">var</span>&nbsp;<span class="op" id="3483317">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483321">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483332">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483341">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3483352">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483360">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3483371">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483378">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483389">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483394">lastRepeat</span>&nbsp;<span class="builtintype" id="3483405">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483416">p</span><span class="op" id="3483417">.</span><span class="ident" id="3483418">flags</span>&nbsp;<span class="op" id="3483424">=</span>&nbsp;<span class="ident" id="3483426">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483433">p</span><span class="op" id="3483434">.</span><span class="ident" id="3483435">wholeRegexp</span>&nbsp;<span class="op" id="3483447">=</span>&nbsp;<span class="ident" id="3483449">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483452">t</span>&nbsp;<span class="op" id="3483454">:=</span>&nbsp;<span class="ident" id="3483457">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483460">for</span>&nbsp;<span class="ident" id="3483464">t</span>&nbsp;<span class="op" id="3483466">!=</span>&nbsp;<span class="string" id="3483469">&#34;&#34;</span>&nbsp;<span class="op" id="3483472">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483476">repeat</span>&nbsp;<span class="op" id="3483483">:=</span>&nbsp;<span class="string" id="3483486">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483490">BigSwitch</span><span class="op" id="3483499">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483503">switch</span>&nbsp;<span class="ident" id="3483510">t</span><span class="op" id="3483511">[</span><span class="num" id="3483512">0</span><span class="op" id="3483513">]</span>&nbsp;<span class="op" id="3483515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483519">default</span><span class="op" id="3483526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483531">if</span>&nbsp;<span class="ident" id="3483534">c</span><span class="op" id="3483535">,</span>&nbsp;<span class="ident" id="3483537">t</span><span class="op" id="3483538">,</span>&nbsp;<span class="ident" id="3483540">err</span>&nbsp;<span class="op" id="3483544">=</span>&nbsp;<span class="ident" id="3483546">nextRune</span><span class="op" id="3483554">(</span><span class="ident" id="3483555">t</span><span class="op" id="3483556">)</span><span class="op" id="3483557">;</span>&nbsp;<span class="ident" id="3483559">err</span>&nbsp;<span class="op" id="3483563">!=</span>&nbsp;<span class="builtintype" id="3483566">nil</span>&nbsp;<span class="op" id="3483570">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483576">return</span>&nbsp;<span class="builtintype" id="3483583">nil</span><span class="op" id="3483586">,</span>&nbsp;<span class="ident" id="3483588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483600">p</span><span class="op" id="3483601">.</span><span class="ident" id="3483602">literal</span><span class="op" id="3483609">(</span><span class="ident" id="3483610">c</span><span class="op" id="3483611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483616">case</span>&nbsp;<span class="string" id="3483621">&#39;(&#39;</span><span class="op" id="3483624">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483629">if</span>&nbsp;<span class="ident" id="3483632">p</span><span class="op" id="3483633">.</span><span class="ident" id="3483634">flags</span><span class="op" id="3483639">&amp;</span><span class="ident" id="3483640">PerlX</span>&nbsp;<span class="op" id="3483646">!=</span>&nbsp;<span class="num" id="3483649">0</span>&nbsp;<span class="op" id="3483651">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3483654">len</span><span class="op" id="3483657">(</span><span class="ident" id="3483658">t</span><span class="op" id="3483659">)</span>&nbsp;<span class="op" id="3483661">&gt;=</span>&nbsp;<span class="num" id="3483664">2</span>&nbsp;<span class="op" id="3483666">&amp;&amp;</span>&nbsp;<span class="ident" id="3483669">t</span><span class="op" id="3483670">[</span><span class="num" id="3483671">1</span><span class="op" id="3483672">]</span>&nbsp;<span class="op" id="3483674">==</span>&nbsp;<span class="string" id="3483677">&#39;?&#39;</span>&nbsp;<span class="op" id="3483681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3483687">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483733">if</span>&nbsp;<span class="ident" id="3483736">t</span><span class="op" id="3483737">,</span>&nbsp;<span class="ident" id="3483739">err</span>&nbsp;<span class="op" id="3483743">=</span>&nbsp;<span class="ident" id="3483745">p</span><span class="op" id="3483746">.</span><span class="ident" id="3483747">parsePerlFlags</span><span class="op" id="3483761">(</span><span class="ident" id="3483762">t</span><span class="op" id="3483763">)</span><span class="op" id="3483764">;</span>&nbsp;<span class="ident" id="3483766">err</span>&nbsp;<span class="op" id="3483770">!=</span>&nbsp;<span class="builtintype" id="3483773">nil</span>&nbsp;<span class="op" id="3483777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483784">return</span>&nbsp;<span class="builtintype" id="3483791">nil</span><span class="op" id="3483794">,</span>&nbsp;<span class="ident" id="3483796">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483804">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483810">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483824">p</span><span class="op" id="3483825">.</span><span class="ident" id="3483826">numCap</span><span class="op" id="3483832">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483838">p</span><span class="op" id="3483839">.</span><span class="ident" id="3483840">op</span><span class="op" id="3483842">(</span><span class="ident" id="3483843">opLeftParen</span><span class="op" id="3483854">)</span><span class="op" id="3483855">.</span><span class="ident" id="3483856">Cap</span>&nbsp;<span class="op" id="3483860">=</span>&nbsp;<span class="ident" id="3483862">p</span><span class="op" id="3483863">.</span><span class="ident" id="3483864">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483874">t</span>&nbsp;<span class="op" id="3483876">=</span>&nbsp;<span class="ident" id="3483878">t</span><span class="op" id="3483879">[</span><span class="num" id="3483880">1</span><span class="op" id="3483881">:</span><span class="op" id="3483882">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483886">case</span>&nbsp;<span class="string" id="3483891">&#39;|&#39;</span><span class="op" id="3483894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483899">if</span>&nbsp;<span class="ident" id="3483902">err</span>&nbsp;<span class="op" id="3483906">=</span>&nbsp;<span class="ident" id="3483908">p</span><span class="op" id="3483909">.</span><span class="ident" id="3483910">parseVerticalBar</span><span class="op" id="3483926">(</span><span class="op" id="3483927">)</span><span class="op" id="3483928">;</span>&nbsp;<span class="ident" id="3483930">err</span>&nbsp;<span class="op" id="3483934">!=</span>&nbsp;<span class="builtintype" id="3483937">nil</span>&nbsp;<span class="op" id="3483941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483947">return</span>&nbsp;<span class="builtintype" id="3483954">nil</span><span class="op" id="3483957">,</span>&nbsp;<span class="ident" id="3483959">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3483966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3483971">t</span>&nbsp;<span class="op" id="3483973">=</span>&nbsp;<span class="ident" id="3483975">t</span><span class="op" id="3483976">[</span><span class="num" id="3483977">1</span><span class="op" id="3483978">:</span><span class="op" id="3483979">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483983">case</span>&nbsp;<span class="string" id="3483988">&#39;)&#39;</span><span class="op" id="3483991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3483996">if</span>&nbsp;<span class="ident" id="3483999">err</span>&nbsp;<span class="op" id="3484003">=</span>&nbsp;<span class="ident" id="3484005">p</span><span class="op" id="3484006">.</span><span class="ident" id="3484007">parseRightParen</span><span class="op" id="3484022">(</span><span class="op" id="3484023">)</span><span class="op" id="3484024">;</span>&nbsp;<span class="ident" id="3484026">err</span>&nbsp;<span class="op" id="3484030">!=</span>&nbsp;<span class="builtintype" id="3484033">nil</span>&nbsp;<span class="op" id="3484037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484043">return</span>&nbsp;<span class="builtintype" id="3484050">nil</span><span class="op" id="3484053">,</span>&nbsp;<span class="ident" id="3484055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484067">t</span>&nbsp;<span class="op" id="3484069">=</span>&nbsp;<span class="ident" id="3484071">t</span><span class="op" id="3484072">[</span><span class="num" id="3484073">1</span><span class="op" id="3484074">:</span><span class="op" id="3484075">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484079">case</span>&nbsp;<span class="string" id="3484084">&#39;^&#39;</span><span class="op" id="3484087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484092">if</span>&nbsp;<span class="ident" id="3484095">p</span><span class="op" id="3484096">.</span><span class="ident" id="3484097">flags</span><span class="op" id="3484102">&amp;</span><span class="ident" id="3484103">OneLine</span>&nbsp;<span class="op" id="3484111">!=</span>&nbsp;<span class="num" id="3484114">0</span>&nbsp;<span class="op" id="3484116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484122">p</span><span class="op" id="3484123">.</span><span class="ident" id="3484124">op</span><span class="op" id="3484126">(</span><span class="ident" id="3484127">OpBeginText</span><span class="op" id="3484138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484143">}</span>&nbsp;<span class="keyword" id="3484145">else</span>&nbsp;<span class="op" id="3484150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484156">p</span><span class="op" id="3484157">.</span><span class="ident" id="3484158">op</span><span class="op" id="3484160">(</span><span class="ident" id="3484161">OpBeginLine</span><span class="op" id="3484172">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484182">t</span>&nbsp;<span class="op" id="3484184">=</span>&nbsp;<span class="ident" id="3484186">t</span><span class="op" id="3484187">[</span><span class="num" id="3484188">1</span><span class="op" id="3484189">:</span><span class="op" id="3484190">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484194">case</span>&nbsp;<span class="string" id="3484199">&#39;$&#39;</span><span class="op" id="3484202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484207">if</span>&nbsp;<span class="ident" id="3484210">p</span><span class="op" id="3484211">.</span><span class="ident" id="3484212">flags</span><span class="op" id="3484217">&amp;</span><span class="ident" id="3484218">OneLine</span>&nbsp;<span class="op" id="3484226">!=</span>&nbsp;<span class="num" id="3484229">0</span>&nbsp;<span class="op" id="3484231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484237">p</span><span class="op" id="3484238">.</span><span class="ident" id="3484239">op</span><span class="op" id="3484241">(</span><span class="ident" id="3484242">OpEndText</span><span class="op" id="3484251">)</span><span class="op" id="3484252">.</span><span class="ident" id="3484253">Flags</span>&nbsp;<span class="op" id="3484259">|=</span>&nbsp;<span class="ident" id="3484262">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484275">}</span>&nbsp;<span class="keyword" id="3484277">else</span>&nbsp;<span class="op" id="3484282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484288">p</span><span class="op" id="3484289">.</span><span class="ident" id="3484290">op</span><span class="op" id="3484292">(</span><span class="ident" id="3484293">OpEndLine</span><span class="op" id="3484302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484312">t</span>&nbsp;<span class="op" id="3484314">=</span>&nbsp;<span class="ident" id="3484316">t</span><span class="op" id="3484317">[</span><span class="num" id="3484318">1</span><span class="op" id="3484319">:</span><span class="op" id="3484320">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484324">case</span>&nbsp;<span class="string" id="3484329">&#39;.&#39;</span><span class="op" id="3484332">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484337">if</span>&nbsp;<span class="ident" id="3484340">p</span><span class="op" id="3484341">.</span><span class="ident" id="3484342">flags</span><span class="op" id="3484347">&amp;</span><span class="ident" id="3484348">DotNL</span>&nbsp;<span class="op" id="3484354">!=</span>&nbsp;<span class="num" id="3484357">0</span>&nbsp;<span class="op" id="3484359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484365">p</span><span class="op" id="3484366">.</span><span class="ident" id="3484367">op</span><span class="op" id="3484369">(</span><span class="ident" id="3484370">OpAnyChar</span><span class="op" id="3484379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484384">}</span>&nbsp;<span class="keyword" id="3484386">else</span>&nbsp;<span class="op" id="3484391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484397">p</span><span class="op" id="3484398">.</span><span class="ident" id="3484399">op</span><span class="op" id="3484401">(</span><span class="ident" id="3484402">OpAnyCharNotNL</span><span class="op" id="3484416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484421">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484426">t</span>&nbsp;<span class="op" id="3484428">=</span>&nbsp;<span class="ident" id="3484430">t</span><span class="op" id="3484431">[</span><span class="num" id="3484432">1</span><span class="op" id="3484433">:</span><span class="op" id="3484434">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484438">case</span>&nbsp;<span class="string" id="3484443">&#39;[&#39;</span><span class="op" id="3484446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484451">if</span>&nbsp;<span class="ident" id="3484454">t</span><span class="op" id="3484455">,</span>&nbsp;<span class="ident" id="3484457">err</span>&nbsp;<span class="op" id="3484461">=</span>&nbsp;<span class="ident" id="3484463">p</span><span class="op" id="3484464">.</span><span class="ident" id="3484465">parseClass</span><span class="op" id="3484475">(</span><span class="ident" id="3484476">t</span><span class="op" id="3484477">)</span><span class="op" id="3484478">;</span>&nbsp;<span class="ident" id="3484480">err</span>&nbsp;<span class="op" id="3484484">!=</span>&nbsp;<span class="builtintype" id="3484487">nil</span>&nbsp;<span class="op" id="3484491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484497">return</span>&nbsp;<span class="builtintype" id="3484504">nil</span><span class="op" id="3484507">,</span>&nbsp;<span class="ident" id="3484509">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484516">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484520">case</span>&nbsp;<span class="string" id="3484525">&#39;*&#39;</span><span class="op" id="3484528">,</span>&nbsp;<span class="string" id="3484530">&#39;+&#39;</span><span class="op" id="3484533">,</span>&nbsp;<span class="string" id="3484535">&#39;?&#39;</span><span class="op" id="3484538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484543">before</span>&nbsp;<span class="op" id="3484550">:=</span>&nbsp;<span class="ident" id="3484553">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484558">switch</span>&nbsp;<span class="ident" id="3484565">t</span><span class="op" id="3484566">[</span><span class="num" id="3484567">0</span><span class="op" id="3484568">]</span>&nbsp;<span class="op" id="3484570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484575">case</span>&nbsp;<span class="string" id="3484580">&#39;*&#39;</span><span class="op" id="3484583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484589">op</span>&nbsp;<span class="op" id="3484592">=</span>&nbsp;<span class="ident" id="3484594">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484604">case</span>&nbsp;<span class="string" id="3484609">&#39;+&#39;</span><span class="op" id="3484612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484618">op</span>&nbsp;<span class="op" id="3484621">=</span>&nbsp;<span class="ident" id="3484623">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484633">case</span>&nbsp;<span class="string" id="3484638">&#39;?&#39;</span><span class="op" id="3484641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484647">op</span>&nbsp;<span class="op" id="3484650">=</span>&nbsp;<span class="ident" id="3484652">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484663">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484668">after</span>&nbsp;<span class="op" id="3484674">:=</span>&nbsp;<span class="ident" id="3484677">t</span><span class="op" id="3484678">[</span><span class="num" id="3484679">1</span><span class="op" id="3484680">:</span><span class="op" id="3484681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484686">if</span>&nbsp;<span class="ident" id="3484689">after</span><span class="op" id="3484694">,</span>&nbsp;<span class="ident" id="3484696">err</span>&nbsp;<span class="op" id="3484700">=</span>&nbsp;<span class="ident" id="3484702">p</span><span class="op" id="3484703">.</span><span class="ident" id="3484704">repeat</span><span class="op" id="3484710">(</span><span class="ident" id="3484711">op</span><span class="op" id="3484713">,</span>&nbsp;<span class="num" id="3484715">0</span><span class="op" id="3484716">,</span>&nbsp;<span class="num" id="3484718">0</span><span class="op" id="3484719">,</span>&nbsp;<span class="ident" id="3484721">before</span><span class="op" id="3484727">,</span>&nbsp;<span class="ident" id="3484729">after</span><span class="op" id="3484734">,</span>&nbsp;<span class="ident" id="3484736">lastRepeat</span><span class="op" id="3484746">)</span><span class="op" id="3484747">;</span>&nbsp;<span class="ident" id="3484749">err</span>&nbsp;<span class="op" id="3484753">!=</span>&nbsp;<span class="builtintype" id="3484756">nil</span>&nbsp;<span class="op" id="3484760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484766">return</span>&nbsp;<span class="builtintype" id="3484773">nil</span><span class="op" id="3484776">,</span>&nbsp;<span class="ident" id="3484778">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3484785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484790">repeat</span>&nbsp;<span class="op" id="3484797">=</span>&nbsp;<span class="ident" id="3484799">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484809">t</span>&nbsp;<span class="op" id="3484811">=</span>&nbsp;<span class="ident" id="3484813">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484821">case</span>&nbsp;<span class="string" id="3484826">&#39;{&#39;</span><span class="op" id="3484829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484834">op</span>&nbsp;<span class="op" id="3484837">=</span>&nbsp;<span class="ident" id="3484839">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484851">before</span>&nbsp;<span class="op" id="3484858">:=</span>&nbsp;<span class="ident" id="3484861">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484866">min</span><span class="op" id="3484869">,</span>&nbsp;<span class="ident" id="3484871">max</span><span class="op" id="3484874">,</span>&nbsp;<span class="ident" id="3484876">after</span><span class="op" id="3484881">,</span>&nbsp;<span class="ident" id="3484883">ok</span>&nbsp;<span class="op" id="3484886">:=</span>&nbsp;<span class="ident" id="3484889">p</span><span class="op" id="3484890">.</span><span class="ident" id="3484891">parseRepeat</span><span class="op" id="3484902">(</span><span class="ident" id="3484903">t</span><span class="op" id="3484904">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3484909">if</span>&nbsp;<span class="op" id="3484912">!</span><span class="ident" id="3484913">ok</span>&nbsp;<span class="op" id="3484916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3484922">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484977">p</span><span class="op" id="3484978">.</span><span class="ident" id="3484979">literal</span><span class="op" id="3484986">(</span><span class="string" id="3484987">&#39;{&#39;</span><span class="op" id="3484990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3484996">t</span>&nbsp;<span class="op" id="3484998">=</span>&nbsp;<span class="ident" id="3485000">t</span><span class="op" id="3485001">[</span><span class="num" id="3485002">1</span><span class="op" id="3485003">:</span><span class="op" id="3485004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485010">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485024">if</span>&nbsp;<span class="ident" id="3485027">min</span>&nbsp;<span class="op" id="3485031">&lt;</span>&nbsp;<span class="num" id="3485033">0</span>&nbsp;<span class="op" id="3485035">||</span>&nbsp;<span class="ident" id="3485038">min</span>&nbsp;<span class="op" id="3485042">&gt;</span>&nbsp;<span class="num" id="3485044">1000</span>&nbsp;<span class="op" id="3485049">||</span>&nbsp;<span class="ident" id="3485052">max</span>&nbsp;<span class="op" id="3485056">&gt;</span>&nbsp;<span class="num" id="3485058">1000</span>&nbsp;<span class="op" id="3485063">||</span>&nbsp;<span class="ident" id="3485066">max</span>&nbsp;<span class="op" id="3485070">&gt;=</span>&nbsp;<span class="num" id="3485073">0</span>&nbsp;<span class="op" id="3485075">&amp;&amp;</span>&nbsp;<span class="ident" id="3485078">min</span>&nbsp;<span class="op" id="3485082">&gt;</span>&nbsp;<span class="ident" id="3485084">max</span>&nbsp;<span class="op" id="3485088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3485094">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485156">return</span>&nbsp;<span class="builtintype" id="3485163">nil</span><span class="op" id="3485166">,</span>&nbsp;<span class="op" id="3485168">&amp;</span><span class="ident" id="3485169">Error</span><span class="op" id="3485174">{</span><span class="ident" id="3485175">ErrInvalidRepeatSize</span><span class="op" id="3485195">,</span>&nbsp;<span class="ident" id="3485197">before</span><span class="op" id="3485203">[</span><span class="op" id="3485204">:</span><span class="builtinfunc" id="3485205">len</span><span class="op" id="3485208">(</span><span class="ident" id="3485209">before</span><span class="op" id="3485215">)</span><span class="op" id="3485216">-</span><span class="builtinfunc" id="3485217">len</span><span class="op" id="3485220">(</span><span class="ident" id="3485221">after</span><span class="op" id="3485226">)</span><span class="op" id="3485227">]</span><span class="op" id="3485228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485233">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485238">if</span>&nbsp;<span class="ident" id="3485241">after</span><span class="op" id="3485246">,</span>&nbsp;<span class="ident" id="3485248">err</span>&nbsp;<span class="op" id="3485252">=</span>&nbsp;<span class="ident" id="3485254">p</span><span class="op" id="3485255">.</span><span class="ident" id="3485256">repeat</span><span class="op" id="3485262">(</span><span class="ident" id="3485263">op</span><span class="op" id="3485265">,</span>&nbsp;<span class="ident" id="3485267">min</span><span class="op" id="3485270">,</span>&nbsp;<span class="ident" id="3485272">max</span><span class="op" id="3485275">,</span>&nbsp;<span class="ident" id="3485277">before</span><span class="op" id="3485283">,</span>&nbsp;<span class="ident" id="3485285">after</span><span class="op" id="3485290">,</span>&nbsp;<span class="ident" id="3485292">lastRepeat</span><span class="op" id="3485302">)</span><span class="op" id="3485303">;</span>&nbsp;<span class="ident" id="3485305">err</span>&nbsp;<span class="op" id="3485309">!=</span>&nbsp;<span class="builtintype" id="3485312">nil</span>&nbsp;<span class="op" id="3485316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485322">return</span>&nbsp;<span class="builtintype" id="3485329">nil</span><span class="op" id="3485332">,</span>&nbsp;<span class="ident" id="3485334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485346">repeat</span>&nbsp;<span class="op" id="3485353">=</span>&nbsp;<span class="ident" id="3485355">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485365">t</span>&nbsp;<span class="op" id="3485367">=</span>&nbsp;<span class="ident" id="3485369">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485377">case</span>&nbsp;<span class="string" id="3485382">&#39;\\&#39;</span><span class="op" id="3485386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485391">if</span>&nbsp;<span class="ident" id="3485394">p</span><span class="op" id="3485395">.</span><span class="ident" id="3485396">flags</span><span class="op" id="3485401">&amp;</span><span class="ident" id="3485402">PerlX</span>&nbsp;<span class="op" id="3485408">!=</span>&nbsp;<span class="num" id="3485411">0</span>&nbsp;<span class="op" id="3485413">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3485416">len</span><span class="op" id="3485419">(</span><span class="ident" id="3485420">t</span><span class="op" id="3485421">)</span>&nbsp;<span class="op" id="3485423">&gt;=</span>&nbsp;<span class="num" id="3485426">2</span>&nbsp;<span class="op" id="3485428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485434">switch</span>&nbsp;<span class="ident" id="3485441">t</span><span class="op" id="3485442">[</span><span class="num" id="3485443">1</span><span class="op" id="3485444">]</span>&nbsp;<span class="op" id="3485446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485452">case</span>&nbsp;<span class="string" id="3485457">&#39;A&#39;</span><span class="op" id="3485460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485467">p</span><span class="op" id="3485468">.</span><span class="ident" id="3485469">op</span><span class="op" id="3485471">(</span><span class="ident" id="3485472">OpBeginText</span><span class="op" id="3485483">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485490">t</span>&nbsp;<span class="op" id="3485492">=</span>&nbsp;<span class="ident" id="3485494">t</span><span class="op" id="3485495">[</span><span class="num" id="3485496">2</span><span class="op" id="3485497">:</span><span class="op" id="3485498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485505">break</span>&nbsp;<span class="ident" id="3485511">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485525">case</span>&nbsp;<span class="string" id="3485530">&#39;b&#39;</span><span class="op" id="3485533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485540">p</span><span class="op" id="3485541">.</span><span class="ident" id="3485542">op</span><span class="op" id="3485544">(</span><span class="ident" id="3485545">OpWordBoundary</span><span class="op" id="3485559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485566">t</span>&nbsp;<span class="op" id="3485568">=</span>&nbsp;<span class="ident" id="3485570">t</span><span class="op" id="3485571">[</span><span class="num" id="3485572">2</span><span class="op" id="3485573">:</span><span class="op" id="3485574">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485581">break</span>&nbsp;<span class="ident" id="3485587">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485601">case</span>&nbsp;<span class="string" id="3485606">&#39;B&#39;</span><span class="op" id="3485609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485616">p</span><span class="op" id="3485617">.</span><span class="ident" id="3485618">op</span><span class="op" id="3485620">(</span><span class="ident" id="3485621">OpNoWordBoundary</span><span class="op" id="3485637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485644">t</span>&nbsp;<span class="op" id="3485646">=</span>&nbsp;<span class="ident" id="3485648">t</span><span class="op" id="3485649">[</span><span class="num" id="3485650">2</span><span class="op" id="3485651">:</span><span class="op" id="3485652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485659">break</span>&nbsp;<span class="ident" id="3485665">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485679">case</span>&nbsp;<span class="string" id="3485684">&#39;C&#39;</span><span class="op" id="3485687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3485694">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485726">return</span>&nbsp;<span class="builtintype" id="3485733">nil</span><span class="op" id="3485736">,</span>&nbsp;<span class="op" id="3485738">&amp;</span><span class="ident" id="3485739">Error</span><span class="op" id="3485744">{</span><span class="ident" id="3485745">ErrInvalidEscape</span><span class="op" id="3485761">,</span>&nbsp;<span class="ident" id="3485763">t</span><span class="op" id="3485764">[</span><span class="op" id="3485765">:</span><span class="num" id="3485766">2</span><span class="op" id="3485767">]</span><span class="op" id="3485768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485774">case</span>&nbsp;<span class="string" id="3485779">&#39;Q&#39;</span><span class="op" id="3485782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3485789">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485835">var</span>&nbsp;<span class="ident" id="3485839">lit</span>&nbsp;<span class="builtintype" id="3485843">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3485855">if</span>&nbsp;<span class="ident" id="3485858">i</span>&nbsp;<span class="op" id="3485860">:=</span>&nbsp;<span class="ident" id="3485863">strings</span><span class="op" id="3485870">.</span><span class="ident" id="3485871">Index</span><span class="op" id="3485876">(</span><span class="ident" id="3485877">t</span><span class="op" id="3485878">,</span>&nbsp;<span class="string" id="3485880">`\E`</span><span class="op" id="3485884">)</span><span class="op" id="3485885">;</span>&nbsp;<span class="ident" id="3485887">i</span>&nbsp;<span class="op" id="3485889">&lt;</span>&nbsp;<span class="num" id="3485891">0</span>&nbsp;<span class="op" id="3485893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485901">lit</span>&nbsp;<span class="op" id="3485905">=</span>&nbsp;<span class="ident" id="3485907">t</span><span class="op" id="3485908">[</span><span class="num" id="3485909">2</span><span class="op" id="3485910">:</span><span class="op" id="3485911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485919">t</span>&nbsp;<span class="op" id="3485921">=</span>&nbsp;<span class="string" id="3485923">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485931">}</span>&nbsp;<span class="keyword" id="3485933">else</span>&nbsp;<span class="op" id="3485938">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485946">lit</span>&nbsp;<span class="op" id="3485950">=</span>&nbsp;<span class="ident" id="3485952">t</span><span class="op" id="3485953">[</span><span class="num" id="3485954">2</span><span class="op" id="3485955">:</span><span class="ident" id="3485956">i</span><span class="op" id="3485957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485965">t</span>&nbsp;<span class="op" id="3485967">=</span>&nbsp;<span class="ident" id="3485969">t</span><span class="op" id="3485970">[</span><span class="ident" id="3485971">i</span><span class="op" id="3485972">+</span><span class="num" id="3485973">2</span><span class="op" id="3485974">:</span><span class="op" id="3485975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3485982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3485989">p</span><span class="op" id="3485990">.</span><span class="ident" id="3485991">push</span><span class="op" id="3485995">(</span><span class="ident" id="3485996">literalRegexp</span><span class="op" id="3486009">(</span><span class="ident" id="3486010">lit</span><span class="op" id="3486013">,</span>&nbsp;<span class="ident" id="3486015">p</span><span class="op" id="3486016">.</span><span class="ident" id="3486017">flags</span><span class="op" id="3486022">)</span><span class="op" id="3486023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486030">break</span>&nbsp;<span class="ident" id="3486036">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486050">case</span>&nbsp;<span class="string" id="3486055">&#39;z&#39;</span><span class="op" id="3486058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486065">p</span><span class="op" id="3486066">.</span><span class="ident" id="3486067">op</span><span class="op" id="3486069">(</span><span class="ident" id="3486070">OpEndText</span><span class="op" id="3486079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486086">t</span>&nbsp;<span class="op" id="3486088">=</span>&nbsp;<span class="ident" id="3486090">t</span><span class="op" id="3486091">[</span><span class="num" id="3486092">2</span><span class="op" id="3486093">:</span><span class="op" id="3486094">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486101">break</span>&nbsp;<span class="ident" id="3486107">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486121">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486132">re</span>&nbsp;<span class="op" id="3486135">:=</span>&nbsp;<span class="ident" id="3486138">p</span><span class="op" id="3486139">.</span><span class="ident" id="3486140">newRegexp</span><span class="op" id="3486149">(</span><span class="ident" id="3486150">OpCharClass</span><span class="op" id="3486161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486166">re</span><span class="op" id="3486168">.</span><span class="ident" id="3486169">Flags</span>&nbsp;<span class="op" id="3486175">=</span>&nbsp;<span class="ident" id="3486177">p</span><span class="op" id="3486178">.</span><span class="ident" id="3486179">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3486189">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486241">if</span>&nbsp;<span class="builtinfunc" id="3486244">len</span><span class="op" id="3486247">(</span><span class="ident" id="3486248">t</span><span class="op" id="3486249">)</span>&nbsp;<span class="op" id="3486251">&gt;=</span>&nbsp;<span class="num" id="3486254">2</span>&nbsp;<span class="op" id="3486256">&amp;&amp;</span>&nbsp;<span class="op" id="3486259">(</span><span class="ident" id="3486260">t</span><span class="op" id="3486261">[</span><span class="num" id="3486262">1</span><span class="op" id="3486263">]</span>&nbsp;<span class="op" id="3486265">==</span>&nbsp;<span class="string" id="3486268">&#39;p&#39;</span>&nbsp;<span class="op" id="3486272">||</span>&nbsp;<span class="ident" id="3486275">t</span><span class="op" id="3486276">[</span><span class="num" id="3486277">1</span><span class="op" id="3486278">]</span>&nbsp;<span class="op" id="3486280">==</span>&nbsp;<span class="string" id="3486283">&#39;P&#39;</span><span class="op" id="3486286">)</span>&nbsp;<span class="op" id="3486288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486294">r</span><span class="op" id="3486295">,</span>&nbsp;<span class="ident" id="3486297">rest</span><span class="op" id="3486301">,</span>&nbsp;<span class="ident" id="3486303">err</span>&nbsp;<span class="op" id="3486307">:=</span>&nbsp;<span class="ident" id="3486310">p</span><span class="op" id="3486311">.</span><span class="ident" id="3486312">parseUnicodeClass</span><span class="op" id="3486329">(</span><span class="ident" id="3486330">t</span><span class="op" id="3486331">,</span>&nbsp;<span class="ident" id="3486333">re</span><span class="op" id="3486335">.</span><span class="ident" id="3486336">Rune0</span><span class="op" id="3486341">[</span><span class="op" id="3486342">:</span><span class="num" id="3486343">0</span><span class="op" id="3486344">]</span><span class="op" id="3486345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486351">if</span>&nbsp;<span class="ident" id="3486354">err</span>&nbsp;<span class="op" id="3486358">!=</span>&nbsp;<span class="builtintype" id="3486361">nil</span>&nbsp;<span class="op" id="3486365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486372">return</span>&nbsp;<span class="builtintype" id="3486379">nil</span><span class="op" id="3486382">,</span>&nbsp;<span class="ident" id="3486384">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486398">if</span>&nbsp;<span class="ident" id="3486401">r</span>&nbsp;<span class="op" id="3486403">!=</span>&nbsp;<span class="builtintype" id="3486406">nil</span>&nbsp;<span class="op" id="3486410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486417">re</span><span class="op" id="3486419">.</span><span class="ident" id="3486420">Rune</span>&nbsp;<span class="op" id="3486425">=</span>&nbsp;<span class="ident" id="3486427">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486434">t</span>&nbsp;<span class="op" id="3486436">=</span>&nbsp;<span class="ident" id="3486438">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486448">p</span><span class="op" id="3486449">.</span><span class="ident" id="3486450">push</span><span class="op" id="3486454">(</span><span class="ident" id="3486455">re</span><span class="op" id="3486457">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486464">break</span>&nbsp;<span class="ident" id="3486470">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3486495">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486530">if</span>&nbsp;<span class="ident" id="3486533">r</span><span class="op" id="3486534">,</span>&nbsp;<span class="ident" id="3486536">rest</span>&nbsp;<span class="op" id="3486541">:=</span>&nbsp;<span class="ident" id="3486544">p</span><span class="op" id="3486545">.</span><span class="ident" id="3486546">parsePerlClassEscape</span><span class="op" id="3486566">(</span><span class="ident" id="3486567">t</span><span class="op" id="3486568">,</span>&nbsp;<span class="ident" id="3486570">re</span><span class="op" id="3486572">.</span><span class="ident" id="3486573">Rune0</span><span class="op" id="3486578">[</span><span class="op" id="3486579">:</span><span class="num" id="3486580">0</span><span class="op" id="3486581">]</span><span class="op" id="3486582">)</span><span class="op" id="3486583">;</span>&nbsp;<span class="ident" id="3486585">r</span>&nbsp;<span class="op" id="3486587">!=</span>&nbsp;<span class="builtintype" id="3486590">nil</span>&nbsp;<span class="op" id="3486594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486600">re</span><span class="op" id="3486602">.</span><span class="ident" id="3486603">Rune</span>&nbsp;<span class="op" id="3486608">=</span>&nbsp;<span class="ident" id="3486610">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486616">t</span>&nbsp;<span class="op" id="3486618">=</span>&nbsp;<span class="ident" id="3486620">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486629">p</span><span class="op" id="3486630">.</span><span class="ident" id="3486631">push</span><span class="op" id="3486635">(</span><span class="ident" id="3486636">re</span><span class="op" id="3486638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486644">break</span>&nbsp;<span class="ident" id="3486650">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486668">p</span><span class="op" id="3486669">.</span><span class="ident" id="3486670">reuse</span><span class="op" id="3486675">(</span><span class="ident" id="3486676">re</span><span class="op" id="3486678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3486684">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486724">if</span>&nbsp;<span class="ident" id="3486727">c</span><span class="op" id="3486728">,</span>&nbsp;<span class="ident" id="3486730">t</span><span class="op" id="3486731">,</span>&nbsp;<span class="ident" id="3486733">err</span>&nbsp;<span class="op" id="3486737">=</span>&nbsp;<span class="ident" id="3486739">p</span><span class="op" id="3486740">.</span><span class="ident" id="3486741">parseEscape</span><span class="op" id="3486752">(</span><span class="ident" id="3486753">t</span><span class="op" id="3486754">)</span><span class="op" id="3486755">;</span>&nbsp;<span class="ident" id="3486757">err</span>&nbsp;<span class="op" id="3486761">!=</span>&nbsp;<span class="builtintype" id="3486764">nil</span>&nbsp;<span class="op" id="3486768">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486774">return</span>&nbsp;<span class="builtintype" id="3486781">nil</span><span class="op" id="3486784">,</span>&nbsp;<span class="ident" id="3486786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486798">p</span><span class="op" id="3486799">.</span><span class="ident" id="3486800">literal</span><span class="op" id="3486807">(</span><span class="ident" id="3486808">c</span><span class="op" id="3486809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486817">lastRepeat</span>&nbsp;<span class="op" id="3486828">=</span>&nbsp;<span class="ident" id="3486830">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486842">p</span><span class="op" id="3486843">.</span><span class="ident" id="3486844">concat</span><span class="op" id="3486850">(</span><span class="op" id="3486851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486854">if</span>&nbsp;<span class="ident" id="3486857">p</span><span class="op" id="3486858">.</span><span class="ident" id="3486859">swapVerticalBar</span><span class="op" id="3486874">(</span><span class="op" id="3486875">)</span>&nbsp;<span class="op" id="3486877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3486881">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486903">p</span><span class="op" id="3486904">.</span><span class="ident" id="3486905">stack</span>&nbsp;<span class="op" id="3486911">=</span>&nbsp;<span class="ident" id="3486913">p</span><span class="op" id="3486914">.</span><span class="ident" id="3486915">stack</span><span class="op" id="3486920">[</span><span class="op" id="3486921">:</span><span class="builtinfunc" id="3486922">len</span><span class="op" id="3486925">(</span><span class="ident" id="3486926">p</span><span class="op" id="3486927">.</span><span class="ident" id="3486928">stack</span><span class="op" id="3486933">)</span><span class="op" id="3486934">-</span><span class="num" id="3486935">1</span><span class="op" id="3486936">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3486939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486942">p</span><span class="op" id="3486943">.</span><span class="ident" id="3486944">alternate</span><span class="op" id="3486953">(</span><span class="op" id="3486954">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3486958">n</span>&nbsp;<span class="op" id="3486960">:=</span>&nbsp;<span class="builtinfunc" id="3486963">len</span><span class="op" id="3486966">(</span><span class="ident" id="3486967">p</span><span class="op" id="3486968">.</span><span class="ident" id="3486969">stack</span><span class="op" id="3486974">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486977">if</span>&nbsp;<span class="ident" id="3486980">n</span>&nbsp;<span class="op" id="3486982">!=</span>&nbsp;<span class="num" id="3486985">1</span>&nbsp;<span class="op" id="3486987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3486991">return</span>&nbsp;<span class="builtintype" id="3486998">nil</span><span class="op" id="3487001">,</span>&nbsp;<span class="op" id="3487003">&amp;</span><span class="ident" id="3487004">Error</span><span class="op" id="3487009">{</span><span class="ident" id="3487010">ErrMissingParen</span><span class="op" id="3487025">,</span>&nbsp;<span class="ident" id="3487027">s</span><span class="op" id="3487028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487034">return</span>&nbsp;<span class="ident" id="3487041">p</span><span class="op" id="3487042">.</span><span class="ident" id="3487043">stack</span><span class="op" id="3487048">[</span><span class="num" id="3487049">0</span><span class="op" id="3487050">]</span><span class="op" id="3487051">,</span>&nbsp;<span class="builtintype" id="3487053">nil</span><br>
<span class="lineno"></span><span class="op" id="3487057">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="3487060">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="3487131">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3487184">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3487273">func</span>&nbsp;<span class="op" id="3487278">(</span><span class="ident" id="3487279">p</span>&nbsp;<span class="op" id="3487281">*</span><span class="ident" id="3487282">parser</span><span class="op" id="3487288">)</span>&nbsp;<span class="ident" id="3487290">parseRepeat</span><span class="op" id="3487301">(</span><span class="ident" id="3487302">s</span>&nbsp;<span class="builtintype" id="3487304">string</span><span class="op" id="3487310">)</span>&nbsp;<span class="op" id="3487312">(</span><span class="ident" id="3487313">min</span><span class="op" id="3487316">,</span>&nbsp;<span class="ident" id="3487318">max</span>&nbsp;<span class="builtintype" id="3487322">int</span><span class="op" id="3487325">,</span>&nbsp;<span class="ident" id="3487327">rest</span>&nbsp;<span class="builtintype" id="3487332">string</span><span class="op" id="3487338">,</span>&nbsp;<span class="ident" id="3487340">ok</span>&nbsp;<span class="builtintype" id="3487343">bool</span><span class="op" id="3487347">)</span>&nbsp;<span class="op" id="3487349">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487352">if</span>&nbsp;<span class="ident" id="3487355">s</span>&nbsp;<span class="op" id="3487357">==</span>&nbsp;<span class="string" id="3487360">&#34;&#34;</span>&nbsp;<span class="op" id="3487363">||</span>&nbsp;<span class="ident" id="3487366">s</span><span class="op" id="3487367">[</span><span class="num" id="3487368">0</span><span class="op" id="3487369">]</span>&nbsp;<span class="op" id="3487371">!=</span>&nbsp;<span class="string" id="3487374">&#39;{&#39;</span>&nbsp;<span class="op" id="3487378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487382">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487393">s</span>&nbsp;<span class="op" id="3487395">=</span>&nbsp;<span class="ident" id="3487397">s</span><span class="op" id="3487398">[</span><span class="num" id="3487399">1</span><span class="op" id="3487400">:</span><span class="op" id="3487401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487404">var</span>&nbsp;<span class="ident" id="3487408">ok1</span>&nbsp;<span class="builtintype" id="3487412">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487418">if</span>&nbsp;<span class="ident" id="3487421">min</span><span class="op" id="3487424">,</span>&nbsp;<span class="ident" id="3487426">s</span><span class="op" id="3487427">,</span>&nbsp;<span class="ident" id="3487429">ok1</span>&nbsp;<span class="op" id="3487433">=</span>&nbsp;<span class="ident" id="3487435">p</span><span class="op" id="3487436">.</span><span class="ident" id="3487437">parseInt</span><span class="op" id="3487445">(</span><span class="ident" id="3487446">s</span><span class="op" id="3487447">)</span><span class="op" id="3487448">;</span>&nbsp;<span class="op" id="3487450">!</span><span class="ident" id="3487451">ok1</span>&nbsp;<span class="op" id="3487455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487459">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487470">if</span>&nbsp;<span class="ident" id="3487473">s</span>&nbsp;<span class="op" id="3487475">==</span>&nbsp;<span class="string" id="3487478">&#34;&#34;</span>&nbsp;<span class="op" id="3487481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487485">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487496">if</span>&nbsp;<span class="ident" id="3487499">s</span><span class="op" id="3487500">[</span><span class="num" id="3487501">0</span><span class="op" id="3487502">]</span>&nbsp;<span class="op" id="3487504">!=</span>&nbsp;<span class="string" id="3487507">&#39;,&#39;</span>&nbsp;<span class="op" id="3487511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487515">max</span>&nbsp;<span class="op" id="3487519">=</span>&nbsp;<span class="ident" id="3487521">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487526">}</span>&nbsp;<span class="keyword" id="3487528">else</span>&nbsp;<span class="op" id="3487533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487537">s</span>&nbsp;<span class="op" id="3487539">=</span>&nbsp;<span class="ident" id="3487541">s</span><span class="op" id="3487542">[</span><span class="num" id="3487543">1</span><span class="op" id="3487544">:</span><span class="op" id="3487545">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487549">if</span>&nbsp;<span class="ident" id="3487552">s</span>&nbsp;<span class="op" id="3487554">==</span>&nbsp;<span class="string" id="3487557">&#34;&#34;</span>&nbsp;<span class="op" id="3487560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487565">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487578">if</span>&nbsp;<span class="ident" id="3487581">s</span><span class="op" id="3487582">[</span><span class="num" id="3487583">0</span><span class="op" id="3487584">]</span>&nbsp;<span class="op" id="3487586">==</span>&nbsp;<span class="string" id="3487589">&#39;}&#39;</span>&nbsp;<span class="op" id="3487593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487598">max</span>&nbsp;<span class="op" id="3487602">=</span>&nbsp;<span class="op" id="3487604">-</span><span class="num" id="3487605">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487609">}</span>&nbsp;<span class="keyword" id="3487611">else</span>&nbsp;<span class="keyword" id="3487616">if</span>&nbsp;<span class="ident" id="3487619">max</span><span class="op" id="3487622">,</span>&nbsp;<span class="ident" id="3487624">s</span><span class="op" id="3487625">,</span>&nbsp;<span class="ident" id="3487627">ok1</span>&nbsp;<span class="op" id="3487631">=</span>&nbsp;<span class="ident" id="3487633">p</span><span class="op" id="3487634">.</span><span class="ident" id="3487635">parseInt</span><span class="op" id="3487643">(</span><span class="ident" id="3487644">s</span><span class="op" id="3487645">)</span><span class="op" id="3487646">;</span>&nbsp;<span class="op" id="3487648">!</span><span class="ident" id="3487649">ok1</span>&nbsp;<span class="op" id="3487653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487667">}</span>&nbsp;<span class="keyword" id="3487669">else</span>&nbsp;<span class="keyword" id="3487674">if</span>&nbsp;<span class="ident" id="3487677">max</span>&nbsp;<span class="op" id="3487681">&lt;</span>&nbsp;<span class="num" id="3487683">0</span>&nbsp;<span class="op" id="3487685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3487690">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487728">min</span>&nbsp;<span class="op" id="3487732">=</span>&nbsp;<span class="op" id="3487734">-</span><span class="num" id="3487735">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487745">if</span>&nbsp;<span class="ident" id="3487748">s</span>&nbsp;<span class="op" id="3487750">==</span>&nbsp;<span class="string" id="3487753">&#34;&#34;</span>&nbsp;<span class="op" id="3487756">||</span>&nbsp;<span class="ident" id="3487759">s</span><span class="op" id="3487760">[</span><span class="num" id="3487761">0</span><span class="op" id="3487762">]</span>&nbsp;<span class="op" id="3487764">!=</span>&nbsp;<span class="string" id="3487767">&#39;}&#39;</span>&nbsp;<span class="op" id="3487771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487775">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3487783">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487786">rest</span>&nbsp;<span class="op" id="3487791">=</span>&nbsp;<span class="ident" id="3487793">s</span><span class="op" id="3487794">[</span><span class="num" id="3487795">1</span><span class="op" id="3487796">:</span><span class="op" id="3487797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3487800">ok</span>&nbsp;<span class="op" id="3487803">=</span>&nbsp;<span class="builtintype" id="3487805">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3487811">return</span><br>
<span class="lineno"></span><span class="op" id="3487818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="3487821">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="3487898">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="3487986">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3488043">func</span>&nbsp;<span class="op" id="3488048">(</span><span class="ident" id="3488049">p</span>&nbsp;<span class="op" id="3488051">*</span><span class="ident" id="3488052">parser</span><span class="op" id="3488058">)</span>&nbsp;<span class="ident" id="3488060">parsePerlFlags</span><span class="op" id="3488074">(</span><span class="ident" id="3488075">s</span>&nbsp;<span class="builtintype" id="3488077">string</span><span class="op" id="3488083">)</span>&nbsp;<span class="op" id="3488085">(</span><span class="ident" id="3488086">rest</span>&nbsp;<span class="builtintype" id="3488091">string</span><span class="op" id="3488097">,</span>&nbsp;<span class="ident" id="3488099">err</span>&nbsp;<span class="builtintype" id="3488103">error</span><span class="op" id="3488108">)</span>&nbsp;<span class="op" id="3488110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488113">t</span>&nbsp;<span class="op" id="3488115">:=</span>&nbsp;<span class="ident" id="3488118">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488122">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488197">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488256">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488260">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488318">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488383">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488452">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488456">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488518">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488580">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488644">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488716">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488720">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488780">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488841">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488893">if</span>&nbsp;<span class="builtinfunc" id="3488896">len</span><span class="op" id="3488899">(</span><span class="ident" id="3488900">t</span><span class="op" id="3488901">)</span>&nbsp;<span class="op" id="3488903">&gt;</span>&nbsp;<span class="num" id="3488905">4</span>&nbsp;<span class="op" id="3488907">&amp;&amp;</span>&nbsp;<span class="ident" id="3488910">t</span><span class="op" id="3488911">[</span><span class="num" id="3488912">2</span><span class="op" id="3488913">]</span>&nbsp;<span class="op" id="3488915">==</span>&nbsp;<span class="string" id="3488918">&#39;P&#39;</span>&nbsp;<span class="op" id="3488922">&amp;&amp;</span>&nbsp;<span class="ident" id="3488925">t</span><span class="op" id="3488926">[</span><span class="num" id="3488927">3</span><span class="op" id="3488928">]</span>&nbsp;<span class="op" id="3488930">==</span>&nbsp;<span class="string" id="3488933">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3488937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3488941">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3488961">end</span>&nbsp;<span class="op" id="3488965">:=</span>&nbsp;<span class="ident" id="3488968">strings</span><span class="op" id="3488975">.</span><span class="ident" id="3488976">IndexRune</span><span class="op" id="3488985">(</span><span class="ident" id="3488986">t</span><span class="op" id="3488987">,</span>&nbsp;<span class="string" id="3488989">&#39;&gt;&#39;</span><span class="op" id="3488992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3488996">if</span>&nbsp;<span class="ident" id="3488999">end</span>&nbsp;<span class="op" id="3489003">&lt;</span>&nbsp;<span class="num" id="3489005">0</span>&nbsp;<span class="op" id="3489007">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489012">if</span>&nbsp;<span class="ident" id="3489015">err</span>&nbsp;<span class="op" id="3489019">=</span>&nbsp;<span class="ident" id="3489021">checkUTF8</span><span class="op" id="3489030">(</span><span class="ident" id="3489031">t</span><span class="op" id="3489032">)</span><span class="op" id="3489033">;</span>&nbsp;<span class="ident" id="3489035">err</span>&nbsp;<span class="op" id="3489039">!=</span>&nbsp;<span class="builtintype" id="3489042">nil</span>&nbsp;<span class="op" id="3489046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489052">return</span>&nbsp;<span class="string" id="3489059">&#34;&#34;</span><span class="op" id="3489061">,</span>&nbsp;<span class="ident" id="3489063">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489075">return</span>&nbsp;<span class="string" id="3489082">&#34;&#34;</span><span class="op" id="3489084">,</span>&nbsp;<span class="op" id="3489086">&amp;</span><span class="ident" id="3489087">Error</span><span class="op" id="3489092">{</span><span class="ident" id="3489093">ErrInvalidNamedCapture</span><span class="op" id="3489115">,</span>&nbsp;<span class="ident" id="3489117">s</span><span class="op" id="3489118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489122">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489127">capture</span>&nbsp;<span class="op" id="3489135">:=</span>&nbsp;<span class="ident" id="3489138">t</span><span class="op" id="3489139">[</span><span class="op" id="3489140">:</span><span class="ident" id="3489141">end</span><span class="op" id="3489144">+</span><span class="num" id="3489145">1</span><span class="op" id="3489146">]</span>&nbsp;<span class="comment" id="3489148">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489165">name</span>&nbsp;<span class="op" id="3489170">:=</span>&nbsp;<span class="ident" id="3489173">t</span><span class="op" id="3489174">[</span><span class="num" id="3489175">4</span><span class="op" id="3489176">:</span><span class="ident" id="3489177">end</span><span class="op" id="3489180">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489186">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489198">if</span>&nbsp;<span class="ident" id="3489201">err</span>&nbsp;<span class="op" id="3489205">=</span>&nbsp;<span class="ident" id="3489207">checkUTF8</span><span class="op" id="3489216">(</span><span class="ident" id="3489217">name</span><span class="op" id="3489221">)</span><span class="op" id="3489222">;</span>&nbsp;<span class="ident" id="3489224">err</span>&nbsp;<span class="op" id="3489228">!=</span>&nbsp;<span class="builtintype" id="3489231">nil</span>&nbsp;<span class="op" id="3489235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489240">return</span>&nbsp;<span class="string" id="3489247">&#34;&#34;</span><span class="op" id="3489249">,</span>&nbsp;<span class="ident" id="3489251">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489261">if</span>&nbsp;<span class="op" id="3489264">!</span><span class="ident" id="3489265">isValidCaptureName</span><span class="op" id="3489283">(</span><span class="ident" id="3489284">name</span><span class="op" id="3489288">)</span>&nbsp;<span class="op" id="3489290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489295">return</span>&nbsp;<span class="string" id="3489302">&#34;&#34;</span><span class="op" id="3489304">,</span>&nbsp;<span class="op" id="3489306">&amp;</span><span class="ident" id="3489307">Error</span><span class="op" id="3489312">{</span><span class="ident" id="3489313">ErrInvalidNamedCapture</span><span class="op" id="3489335">,</span>&nbsp;<span class="ident" id="3489337">capture</span><span class="op" id="3489344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489353">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489392">p</span><span class="op" id="3489393">.</span><span class="ident" id="3489394">numCap</span><span class="op" id="3489400">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489405">re</span>&nbsp;<span class="op" id="3489408">:=</span>&nbsp;<span class="ident" id="3489411">p</span><span class="op" id="3489412">.</span><span class="ident" id="3489413">op</span><span class="op" id="3489415">(</span><span class="ident" id="3489416">opLeftParen</span><span class="op" id="3489427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489431">re</span><span class="op" id="3489433">.</span><span class="ident" id="3489434">Cap</span>&nbsp;<span class="op" id="3489438">=</span>&nbsp;<span class="ident" id="3489440">p</span><span class="op" id="3489441">.</span><span class="ident" id="3489442">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489451">re</span><span class="op" id="3489453">.</span><span class="ident" id="3489454">Name</span>&nbsp;<span class="op" id="3489459">=</span>&nbsp;<span class="ident" id="3489461">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489468">return</span>&nbsp;<span class="ident" id="3489475">t</span><span class="op" id="3489476">[</span><span class="ident" id="3489477">end</span><span class="op" id="3489480">+</span><span class="num" id="3489481">1</span><span class="op" id="3489482">:</span><span class="op" id="3489483">]</span><span class="op" id="3489484">,</span>&nbsp;<span class="builtintype" id="3489486">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489495">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489552">var</span>&nbsp;<span class="ident" id="3489556">c</span>&nbsp;<span class="builtintype" id="3489558">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489564">t</span>&nbsp;<span class="op" id="3489566">=</span>&nbsp;<span class="ident" id="3489568">t</span><span class="op" id="3489569">[</span><span class="num" id="3489570">2</span><span class="op" id="3489571">:</span><span class="op" id="3489572">]</span>&nbsp;<span class="comment" id="3489574">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489586">flags</span>&nbsp;<span class="op" id="3489592">:=</span>&nbsp;<span class="ident" id="3489595">p</span><span class="op" id="3489596">.</span><span class="ident" id="3489597">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489604">sign</span>&nbsp;<span class="op" id="3489609">:=</span>&nbsp;<span class="op" id="3489612">+</span><span class="num" id="3489613">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489616">sawFlag</span>&nbsp;<span class="op" id="3489624">:=</span>&nbsp;<span class="builtintype" id="3489627">false</span><br>
<span class="lineno"></span><span class="ident" id="3489633">Loop</span><span class="op" id="3489637">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489640">for</span>&nbsp;<span class="ident" id="3489644">t</span>&nbsp;<span class="op" id="3489646">!=</span>&nbsp;<span class="string" id="3489649">&#34;&#34;</span>&nbsp;<span class="op" id="3489652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489656">if</span>&nbsp;<span class="ident" id="3489659">c</span><span class="op" id="3489660">,</span>&nbsp;<span class="ident" id="3489662">t</span><span class="op" id="3489663">,</span>&nbsp;<span class="ident" id="3489665">err</span>&nbsp;<span class="op" id="3489669">=</span>&nbsp;<span class="ident" id="3489671">nextRune</span><span class="op" id="3489679">(</span><span class="ident" id="3489680">t</span><span class="op" id="3489681">)</span><span class="op" id="3489682">;</span>&nbsp;<span class="ident" id="3489684">err</span>&nbsp;<span class="op" id="3489688">!=</span>&nbsp;<span class="builtintype" id="3489691">nil</span>&nbsp;<span class="op" id="3489695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489700">return</span>&nbsp;<span class="string" id="3489707">&#34;&#34;</span><span class="op" id="3489709">,</span>&nbsp;<span class="ident" id="3489711">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3489717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489721">switch</span>&nbsp;<span class="ident" id="3489728">c</span>&nbsp;<span class="op" id="3489730">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489734">default</span><span class="op" id="3489741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489746">break</span>&nbsp;<span class="ident" id="3489752">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489760">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489772">case</span>&nbsp;<span class="string" id="3489777">&#39;i&#39;</span><span class="op" id="3489780">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489785">flags</span>&nbsp;<span class="op" id="3489791">|=</span>&nbsp;<span class="ident" id="3489794">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489806">sawFlag</span>&nbsp;<span class="op" id="3489814">=</span>&nbsp;<span class="builtintype" id="3489816">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489823">case</span>&nbsp;<span class="string" id="3489828">&#39;m&#39;</span><span class="op" id="3489831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489836">flags</span>&nbsp;<span class="op" id="3489842">&amp;^=</span>&nbsp;<span class="ident" id="3489846">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489857">sawFlag</span>&nbsp;<span class="op" id="3489865">=</span>&nbsp;<span class="builtintype" id="3489867">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489874">case</span>&nbsp;<span class="string" id="3489879">&#39;s&#39;</span><span class="op" id="3489882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489887">flags</span>&nbsp;<span class="op" id="3489893">|=</span>&nbsp;<span class="ident" id="3489896">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489905">sawFlag</span>&nbsp;<span class="op" id="3489913">=</span>&nbsp;<span class="builtintype" id="3489915">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3489922">case</span>&nbsp;<span class="string" id="3489927">&#39;U&#39;</span><span class="op" id="3489930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489935">flags</span>&nbsp;<span class="op" id="3489941">|=</span>&nbsp;<span class="ident" id="3489944">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3489957">sawFlag</span>&nbsp;<span class="op" id="3489965">=</span>&nbsp;<span class="builtintype" id="3489967">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3489975">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490000">case</span>&nbsp;<span class="string" id="3490005">&#39;-&#39;</span><span class="op" id="3490008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490013">if</span>&nbsp;<span class="ident" id="3490016">sign</span>&nbsp;<span class="op" id="3490021">&lt;</span>&nbsp;<span class="num" id="3490023">0</span>&nbsp;<span class="op" id="3490025">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490031">break</span>&nbsp;<span class="ident" id="3490037">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490050">sign</span>&nbsp;<span class="op" id="3490055">=</span>&nbsp;<span class="op" id="3490057">-</span><span class="num" id="3490058">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3490063">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3490127">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490181">flags</span>&nbsp;<span class="op" id="3490187">=</span>&nbsp;<span class="op" id="3490189">^</span><span class="ident" id="3490190">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490199">sawFlag</span>&nbsp;<span class="op" id="3490207">=</span>&nbsp;<span class="builtintype" id="3490209">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3490218">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490260">case</span>&nbsp;<span class="string" id="3490265">&#39;:&#39;</span><span class="op" id="3490268">,</span>&nbsp;<span class="string" id="3490270">&#39;)&#39;</span><span class="op" id="3490273">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490278">if</span>&nbsp;<span class="ident" id="3490281">sign</span>&nbsp;<span class="op" id="3490286">&lt;</span>&nbsp;<span class="num" id="3490288">0</span>&nbsp;<span class="op" id="3490290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490296">if</span>&nbsp;<span class="op" id="3490299">!</span><span class="ident" id="3490300">sawFlag</span>&nbsp;<span class="op" id="3490308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490315">break</span>&nbsp;<span class="ident" id="3490321">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490336">flags</span>&nbsp;<span class="op" id="3490342">=</span>&nbsp;<span class="op" id="3490344">^</span><span class="ident" id="3490345">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490359">if</span>&nbsp;<span class="ident" id="3490362">c</span>&nbsp;<span class="op" id="3490364">==</span>&nbsp;<span class="string" id="3490367">&#39;:&#39;</span>&nbsp;<span class="op" id="3490371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3490377">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490399">p</span><span class="op" id="3490400">.</span><span class="ident" id="3490401">op</span><span class="op" id="3490403">(</span><span class="ident" id="3490404">opLeftParen</span><span class="op" id="3490415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490420">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3490425">p</span><span class="op" id="3490426">.</span><span class="ident" id="3490427">flags</span>&nbsp;<span class="op" id="3490433">=</span>&nbsp;<span class="ident" id="3490435">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490444">return</span>&nbsp;<span class="ident" id="3490451">t</span><span class="op" id="3490452">,</span>&nbsp;<span class="builtintype" id="3490454">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490467">return</span>&nbsp;<span class="string" id="3490474">&#34;&#34;</span><span class="op" id="3490476">,</span>&nbsp;<span class="op" id="3490478">&amp;</span><span class="ident" id="3490479">Error</span><span class="op" id="3490484">{</span><span class="ident" id="3490485">ErrInvalidPerlOp</span><span class="op" id="3490501">,</span>&nbsp;<span class="ident" id="3490503">s</span><span class="op" id="3490504">[</span><span class="op" id="3490505">:</span><span class="builtinfunc" id="3490506">len</span><span class="op" id="3490509">(</span><span class="ident" id="3490510">s</span><span class="op" id="3490511">)</span><span class="op" id="3490512">-</span><span class="builtinfunc" id="3490513">len</span><span class="op" id="3490516">(</span><span class="ident" id="3490517">t</span><span class="op" id="3490518">)</span><span class="op" id="3490519">]</span><span class="op" id="3490520">}</span><br>
<span class="lineno"></span><span class="op" id="3490522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3490525">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3490568">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="3490611">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3490645">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3490691">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="3490728">func</span>&nbsp;<span class="ident" id="3490733">isValidCaptureName</span><span class="op" id="3490751">(</span><span class="ident" id="3490752">name</span>&nbsp;<span class="builtintype" id="3490757">string</span><span class="op" id="3490763">)</span>&nbsp;<span class="builtintype" id="3490765">bool</span>&nbsp;<span class="op" id="3490770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490773">if</span>&nbsp;<span class="ident" id="3490776">name</span>&nbsp;<span class="op" id="3490781">==</span>&nbsp;<span class="string" id="3490784">&#34;&#34;</span>&nbsp;<span class="op" id="3490787">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490791">return</span>&nbsp;<span class="builtintype" id="3490798">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490808">for</span>&nbsp;<span class="ident" id="3490812">_</span><span class="op" id="3490813">,</span>&nbsp;<span class="ident" id="3490815">c</span>&nbsp;<span class="op" id="3490817">:=</span>&nbsp;<span class="keyword" id="3490820">range</span>&nbsp;<span class="ident" id="3490826">name</span>&nbsp;<span class="op" id="3490831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490835">if</span>&nbsp;<span class="ident" id="3490838">c</span>&nbsp;<span class="op" id="3490840">!=</span>&nbsp;<span class="string" id="3490843">&#39;_&#39;</span>&nbsp;<span class="op" id="3490847">&amp;&amp;</span>&nbsp;<span class="op" id="3490850">!</span><span class="ident" id="3490851">isalnum</span><span class="op" id="3490858">(</span><span class="ident" id="3490859">c</span><span class="op" id="3490860">)</span>&nbsp;<span class="op" id="3490862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490867">return</span>&nbsp;<span class="builtintype" id="3490874">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3490885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3490888">return</span>&nbsp;<span class="builtintype" id="3490895">true</span><br>
<span class="lineno"></span><span class="op" id="3490900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="3490903">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3490941">func</span>&nbsp;<span class="op" id="3490946">(</span><span class="ident" id="3490947">p</span>&nbsp;<span class="op" id="3490949">*</span><span class="ident" id="3490950">parser</span><span class="op" id="3490956">)</span>&nbsp;<span class="ident" id="3490958">parseInt</span><span class="op" id="3490966">(</span><span class="ident" id="3490967">s</span>&nbsp;<span class="builtintype" id="3490969">string</span><span class="op" id="3490975">)</span>&nbsp;<span class="op" id="3490977">(</span><span class="ident" id="3490978">n</span>&nbsp;<span class="builtintype" id="3490980">int</span><span class="op" id="3490983">,</span>&nbsp;<span class="ident" id="3490985">rest</span>&nbsp;<span class="builtintype" id="3490990">string</span><span class="op" id="3490996">,</span>&nbsp;<span class="ident" id="3490998">ok</span>&nbsp;<span class="builtintype" id="3491001">bool</span><span class="op" id="3491005">)</span>&nbsp;<span class="op" id="3491007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491010">if</span>&nbsp;<span class="ident" id="3491013">s</span>&nbsp;<span class="op" id="3491015">==</span>&nbsp;<span class="string" id="3491018">&#34;&#34;</span>&nbsp;<span class="op" id="3491021">||</span>&nbsp;<span class="ident" id="3491024">s</span><span class="op" id="3491025">[</span><span class="num" id="3491026">0</span><span class="op" id="3491027">]</span>&nbsp;<span class="op" id="3491029">&lt;</span>&nbsp;<span class="string" id="3491031">&#39;0&#39;</span>&nbsp;<span class="op" id="3491035">||</span>&nbsp;<span class="string" id="3491038">&#39;9&#39;</span>&nbsp;<span class="op" id="3491042">&lt;</span>&nbsp;<span class="ident" id="3491044">s</span><span class="op" id="3491045">[</span><span class="num" id="3491046">0</span><span class="op" id="3491047">]</span>&nbsp;<span class="op" id="3491049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491061">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491064">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491092">if</span>&nbsp;<span class="builtinfunc" id="3491095">len</span><span class="op" id="3491098">(</span><span class="ident" id="3491099">s</span><span class="op" id="3491100">)</span>&nbsp;<span class="op" id="3491102">&gt;=</span>&nbsp;<span class="num" id="3491105">2</span>&nbsp;<span class="op" id="3491107">&amp;&amp;</span>&nbsp;<span class="ident" id="3491110">s</span><span class="op" id="3491111">[</span><span class="num" id="3491112">0</span><span class="op" id="3491113">]</span>&nbsp;<span class="op" id="3491115">==</span>&nbsp;<span class="string" id="3491118">&#39;0&#39;</span>&nbsp;<span class="op" id="3491122">&amp;&amp;</span>&nbsp;<span class="string" id="3491125">&#39;0&#39;</span>&nbsp;<span class="op" id="3491129">&lt;=</span>&nbsp;<span class="ident" id="3491132">s</span><span class="op" id="3491133">[</span><span class="num" id="3491134">1</span><span class="op" id="3491135">]</span>&nbsp;<span class="op" id="3491137">&amp;&amp;</span>&nbsp;<span class="ident" id="3491140">s</span><span class="op" id="3491141">[</span><span class="num" id="3491142">1</span><span class="op" id="3491143">]</span>&nbsp;<span class="op" id="3491145">&lt;=</span>&nbsp;<span class="string" id="3491148">&#39;9&#39;</span>&nbsp;<span class="op" id="3491152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491167">t</span>&nbsp;<span class="op" id="3491169">:=</span>&nbsp;<span class="ident" id="3491172">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491175">for</span>&nbsp;<span class="ident" id="3491179">s</span>&nbsp;<span class="op" id="3491181">!=</span>&nbsp;<span class="string" id="3491184">&#34;&#34;</span>&nbsp;<span class="op" id="3491187">&amp;&amp;</span>&nbsp;<span class="string" id="3491190">&#39;0&#39;</span>&nbsp;<span class="op" id="3491194">&lt;=</span>&nbsp;<span class="ident" id="3491197">s</span><span class="op" id="3491198">[</span><span class="num" id="3491199">0</span><span class="op" id="3491200">]</span>&nbsp;<span class="op" id="3491202">&amp;&amp;</span>&nbsp;<span class="ident" id="3491205">s</span><span class="op" id="3491206">[</span><span class="num" id="3491207">0</span><span class="op" id="3491208">]</span>&nbsp;<span class="op" id="3491210">&lt;=</span>&nbsp;<span class="string" id="3491213">&#39;9&#39;</span>&nbsp;<span class="op" id="3491217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491221">s</span>&nbsp;<span class="op" id="3491223">=</span>&nbsp;<span class="ident" id="3491225">s</span><span class="op" id="3491226">[</span><span class="num" id="3491227">1</span><span class="op" id="3491228">:</span><span class="op" id="3491229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491235">rest</span>&nbsp;<span class="op" id="3491240">=</span>&nbsp;<span class="ident" id="3491242">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491245">ok</span>&nbsp;<span class="op" id="3491248">=</span>&nbsp;<span class="builtintype" id="3491250">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491256">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491288">t</span>&nbsp;<span class="op" id="3491290">=</span>&nbsp;<span class="ident" id="3491292">t</span><span class="op" id="3491293">[</span><span class="op" id="3491294">:</span><span class="builtinfunc" id="3491295">len</span><span class="op" id="3491298">(</span><span class="ident" id="3491299">t</span><span class="op" id="3491300">)</span><span class="op" id="3491301">-</span><span class="builtinfunc" id="3491302">len</span><span class="op" id="3491305">(</span><span class="ident" id="3491306">s</span><span class="op" id="3491307">)</span><span class="op" id="3491308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491311">for</span>&nbsp;<span class="ident" id="3491315">i</span>&nbsp;<span class="op" id="3491317">:=</span>&nbsp;<span class="num" id="3491320">0</span><span class="op" id="3491321">;</span>&nbsp;<span class="ident" id="3491323">i</span>&nbsp;<span class="op" id="3491325">&lt;</span>&nbsp;<span class="builtinfunc" id="3491327">len</span><span class="op" id="3491330">(</span><span class="ident" id="3491331">t</span><span class="op" id="3491332">)</span><span class="op" id="3491333">;</span>&nbsp;<span class="ident" id="3491335">i</span><span class="op" id="3491336">++</span>&nbsp;<span class="op" id="3491339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3491343">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491364">if</span>&nbsp;<span class="ident" id="3491367">n</span>&nbsp;<span class="op" id="3491369">&gt;=</span>&nbsp;<span class="num" id="3491372">1e8</span>&nbsp;<span class="op" id="3491376">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491381">n</span>&nbsp;<span class="op" id="3491383">=</span>&nbsp;<span class="op" id="3491385">-</span><span class="num" id="3491386">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491391">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491403">n</span>&nbsp;<span class="op" id="3491405">=</span>&nbsp;<span class="ident" id="3491407">n</span><span class="op" id="3491408">*</span><span class="num" id="3491409">10</span>&nbsp;<span class="op" id="3491412">+</span>&nbsp;<span class="builtintype" id="3491414">int</span><span class="op" id="3491417">(</span><span class="ident" id="3491418">t</span><span class="op" id="3491419">[</span><span class="ident" id="3491420">i</span><span class="op" id="3491421">]</span><span class="op" id="3491422">)</span>&nbsp;<span class="op" id="3491424">-</span>&nbsp;<span class="string" id="3491426">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491431">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491434">return</span><br>
<span class="lineno"></span><span class="op" id="3491441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491444">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="3491493">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="3491549">func</span>&nbsp;<span class="ident" id="3491554">isCharClass</span><span class="op" id="3491565">(</span><span class="ident" id="3491566">re</span>&nbsp;<span class="op" id="3491569">*</span><span class="ident" id="3491570">Regexp</span><span class="op" id="3491576">)</span>&nbsp;<span class="builtintype" id="3491578">bool</span>&nbsp;<span class="op" id="3491583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491586">return</span>&nbsp;<span class="ident" id="3491593">re</span><span class="op" id="3491595">.</span><span class="ident" id="3491596">Op</span>&nbsp;<span class="op" id="3491599">==</span>&nbsp;<span class="ident" id="3491602">OpLiteral</span>&nbsp;<span class="op" id="3491612">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3491615">len</span><span class="op" id="3491618">(</span><span class="ident" id="3491619">re</span><span class="op" id="3491621">.</span><span class="ident" id="3491622">Rune</span><span class="op" id="3491626">)</span>&nbsp;<span class="op" id="3491628">==</span>&nbsp;<span class="num" id="3491631">1</span>&nbsp;<span class="op" id="3491633">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491638">re</span><span class="op" id="3491640">.</span><span class="ident" id="3491641">Op</span>&nbsp;<span class="op" id="3491644">==</span>&nbsp;<span class="ident" id="3491647">OpCharClass</span>&nbsp;<span class="op" id="3491659">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491664">re</span><span class="op" id="3491666">.</span><span class="ident" id="3491667">Op</span>&nbsp;<span class="op" id="3491670">==</span>&nbsp;<span class="ident" id="3491673">OpAnyCharNotNL</span>&nbsp;<span class="op" id="3491688">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3491693">re</span><span class="op" id="3491695">.</span><span class="ident" id="3491696">Op</span>&nbsp;<span class="op" id="3491699">==</span>&nbsp;<span class="ident" id="3491702">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="3491712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3491715">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="3491735">func</span>&nbsp;<span class="ident" id="3491740">matchRune</span><span class="op" id="3491749">(</span><span class="ident" id="3491750">re</span>&nbsp;<span class="op" id="3491753">*</span><span class="ident" id="3491754">Regexp</span><span class="op" id="3491760">,</span>&nbsp;<span class="ident" id="3491762">r</span>&nbsp;<span class="builtintype" id="3491764">rune</span><span class="op" id="3491768">)</span>&nbsp;<span class="builtintype" id="3491770">bool</span>&nbsp;<span class="op" id="3491775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491778">switch</span>&nbsp;<span class="ident" id="3491785">re</span><span class="op" id="3491787">.</span><span class="ident" id="3491788">Op</span>&nbsp;<span class="op" id="3491791">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491794">case</span>&nbsp;<span class="ident" id="3491799">OpLiteral</span><span class="op" id="3491808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491812">return</span>&nbsp;<span class="builtinfunc" id="3491819">len</span><span class="op" id="3491822">(</span><span class="ident" id="3491823">re</span><span class="op" id="3491825">.</span><span class="ident" id="3491826">Rune</span><span class="op" id="3491830">)</span>&nbsp;<span class="op" id="3491832">==</span>&nbsp;<span class="num" id="3491835">1</span>&nbsp;<span class="op" id="3491837">&amp;&amp;</span>&nbsp;<span class="ident" id="3491840">re</span><span class="op" id="3491842">.</span><span class="ident" id="3491843">Rune</span><span class="op" id="3491847">[</span><span class="num" id="3491848">0</span><span class="op" id="3491849">]</span>&nbsp;<span class="op" id="3491851">==</span>&nbsp;<span class="ident" id="3491854">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491857">case</span>&nbsp;<span class="ident" id="3491862">OpCharClass</span><span class="op" id="3491873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491877">for</span>&nbsp;<span class="ident" id="3491881">i</span>&nbsp;<span class="op" id="3491883">:=</span>&nbsp;<span class="num" id="3491886">0</span><span class="op" id="3491887">;</span>&nbsp;<span class="ident" id="3491889">i</span>&nbsp;<span class="op" id="3491891">&lt;</span>&nbsp;<span class="builtinfunc" id="3491893">len</span><span class="op" id="3491896">(</span><span class="ident" id="3491897">re</span><span class="op" id="3491899">.</span><span class="ident" id="3491900">Rune</span><span class="op" id="3491904">)</span><span class="op" id="3491905">;</span>&nbsp;<span class="ident" id="3491907">i</span>&nbsp;<span class="op" id="3491909">+=</span>&nbsp;<span class="num" id="3491912">2</span>&nbsp;<span class="op" id="3491914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491919">if</span>&nbsp;<span class="ident" id="3491922">re</span><span class="op" id="3491924">.</span><span class="ident" id="3491925">Rune</span><span class="op" id="3491929">[</span><span class="ident" id="3491930">i</span><span class="op" id="3491931">]</span>&nbsp;<span class="op" id="3491933">&lt;=</span>&nbsp;<span class="ident" id="3491936">r</span>&nbsp;<span class="op" id="3491938">&amp;&amp;</span>&nbsp;<span class="ident" id="3491941">r</span>&nbsp;<span class="op" id="3491943">&lt;=</span>&nbsp;<span class="ident" id="3491946">re</span><span class="op" id="3491948">.</span><span class="ident" id="3491949">Rune</span><span class="op" id="3491953">[</span><span class="ident" id="3491954">i</span><span class="op" id="3491955">+</span><span class="num" id="3491956">1</span><span class="op" id="3491957">]</span>&nbsp;<span class="op" id="3491959">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491965">return</span>&nbsp;<span class="builtintype" id="3491972">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3491984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3491988">return</span>&nbsp;<span class="builtintype" id="3491995">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492002">case</span>&nbsp;<span class="ident" id="3492007">OpAnyCharNotNL</span><span class="op" id="3492021">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492025">return</span>&nbsp;<span class="ident" id="3492032">r</span>&nbsp;<span class="op" id="3492034">!=</span>&nbsp;<span class="string" id="3492037">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492043">case</span>&nbsp;<span class="ident" id="3492048">OpAnyChar</span><span class="op" id="3492057">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492061">return</span>&nbsp;<span class="builtintype" id="3492068">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492077">return</span>&nbsp;<span class="builtintype" id="3492084">false</span><br>
<span class="lineno">1110</span><span class="op" id="3492090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3492093">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3492139">func</span>&nbsp;<span class="op" id="3492144">(</span><span class="ident" id="3492145">p</span>&nbsp;<span class="op" id="3492147">*</span><span class="ident" id="3492148">parser</span><span class="op" id="3492154">)</span>&nbsp;<span class="ident" id="3492156">parseVerticalBar</span><span class="op" id="3492172">(</span><span class="op" id="3492173">)</span>&nbsp;<span class="builtintype" id="3492175">error</span>&nbsp;<span class="op" id="3492181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492184">p</span><span class="op" id="3492185">.</span><span class="ident" id="3492186">concat</span><span class="op" id="3492192">(</span><span class="op" id="3492193">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492197">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492258">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492311">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492370">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492410">if</span>&nbsp;<span class="op" id="3492413">!</span><span class="ident" id="3492414">p</span><span class="op" id="3492415">.</span><span class="ident" id="3492416">swapVerticalBar</span><span class="op" id="3492431">(</span><span class="op" id="3492432">)</span>&nbsp;<span class="op" id="3492434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492438">p</span><span class="op" id="3492439">.</span><span class="ident" id="3492440">op</span><span class="op" id="3492442">(</span><span class="ident" id="3492443">opVerticalBar</span><span class="op" id="3492456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492463">return</span>&nbsp;<span class="builtintype" id="3492470">nil</span><br>
<span class="lineno">1125</span><span class="op" id="3492474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3492477">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="3492516">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="3492565">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="3492601">func</span>&nbsp;<span class="ident" id="3492606">mergeCharClass</span><span class="op" id="3492620">(</span><span class="ident" id="3492621">dst</span><span class="op" id="3492624">,</span>&nbsp;<span class="ident" id="3492626">src</span>&nbsp;<span class="op" id="3492630">*</span><span class="ident" id="3492631">Regexp</span><span class="op" id="3492637">)</span>&nbsp;<span class="op" id="3492639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492642">switch</span>&nbsp;<span class="ident" id="3492649">dst</span><span class="op" id="3492652">.</span><span class="ident" id="3492653">Op</span>&nbsp;<span class="op" id="3492656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492659">case</span>&nbsp;<span class="ident" id="3492664">OpAnyChar</span><span class="op" id="3492673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492677">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492707">case</span>&nbsp;<span class="ident" id="3492712">OpAnyCharNotNL</span><span class="op" id="3492726">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492730">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492752">if</span>&nbsp;<span class="ident" id="3492755">matchRune</span><span class="op" id="3492764">(</span><span class="ident" id="3492765">src</span><span class="op" id="3492768">,</span>&nbsp;<span class="string" id="3492770">&#39;\n&#39;</span><span class="op" id="3492774">)</span>&nbsp;<span class="op" id="3492776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492781">dst</span><span class="op" id="3492784">.</span><span class="ident" id="3492785">Op</span>&nbsp;<span class="op" id="3492788">=</span>&nbsp;<span class="ident" id="3492790">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492805">case</span>&nbsp;<span class="ident" id="3492810">OpCharClass</span><span class="op" id="3492821">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3492825">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3492878">if</span>&nbsp;<span class="ident" id="3492881">src</span><span class="op" id="3492884">.</span><span class="ident" id="3492885">Op</span>&nbsp;<span class="op" id="3492888">==</span>&nbsp;<span class="ident" id="3492891">OpLiteral</span>&nbsp;<span class="op" id="3492901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492906">dst</span><span class="op" id="3492909">.</span><span class="ident" id="3492910">Rune</span>&nbsp;<span class="op" id="3492915">=</span>&nbsp;<span class="ident" id="3492917">appendLiteral</span><span class="op" id="3492930">(</span><span class="ident" id="3492931">dst</span><span class="op" id="3492934">.</span><span class="ident" id="3492935">Rune</span><span class="op" id="3492939">,</span>&nbsp;<span class="ident" id="3492941">src</span><span class="op" id="3492944">.</span><span class="ident" id="3492945">Rune</span><span class="op" id="3492949">[</span><span class="num" id="3492950">0</span><span class="op" id="3492951">]</span><span class="op" id="3492952">,</span>&nbsp;<span class="ident" id="3492954">src</span><span class="op" id="3492957">.</span><span class="ident" id="3492958">Flags</span><span class="op" id="3492963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3492967">}</span>&nbsp;<span class="keyword" id="3492969">else</span>&nbsp;<span class="op" id="3492974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3492979">dst</span><span class="op" id="3492982">.</span><span class="ident" id="3492983">Rune</span>&nbsp;<span class="op" id="3492988">=</span>&nbsp;<span class="ident" id="3492990">appendClass</span><span class="op" id="3493001">(</span><span class="ident" id="3493002">dst</span><span class="op" id="3493005">.</span><span class="ident" id="3493006">Rune</span><span class="op" id="3493010">,</span>&nbsp;<span class="ident" id="3493012">src</span><span class="op" id="3493015">.</span><span class="ident" id="3493016">Rune</span><span class="op" id="3493020">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493027">case</span>&nbsp;<span class="ident" id="3493032">OpLiteral</span><span class="op" id="3493041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3493045">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493063">if</span>&nbsp;<span class="ident" id="3493066">src</span><span class="op" id="3493069">.</span><span class="ident" id="3493070">Rune</span><span class="op" id="3493074">[</span><span class="num" id="3493075">0</span><span class="op" id="3493076">]</span>&nbsp;<span class="op" id="3493078">==</span>&nbsp;<span class="ident" id="3493081">dst</span><span class="op" id="3493084">.</span><span class="ident" id="3493085">Rune</span><span class="op" id="3493089">[</span><span class="num" id="3493090">0</span><span class="op" id="3493091">]</span>&nbsp;<span class="op" id="3493093">&amp;&amp;</span>&nbsp;<span class="ident" id="3493096">src</span><span class="op" id="3493099">.</span><span class="ident" id="3493100">Flags</span>&nbsp;<span class="op" id="3493106">==</span>&nbsp;<span class="ident" id="3493109">dst</span><span class="op" id="3493112">.</span><span class="ident" id="3493113">Flags</span>&nbsp;<span class="op" id="3493119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493124">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493136">dst</span><span class="op" id="3493139">.</span><span class="ident" id="3493140">Op</span>&nbsp;<span class="op" id="3493143">=</span>&nbsp;<span class="ident" id="3493145">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493159">dst</span><span class="op" id="3493162">.</span><span class="ident" id="3493163">Rune</span>&nbsp;<span class="op" id="3493168">=</span>&nbsp;<span class="ident" id="3493170">appendLiteral</span><span class="op" id="3493183">(</span><span class="ident" id="3493184">dst</span><span class="op" id="3493187">.</span><span class="ident" id="3493188">Rune</span><span class="op" id="3493192">[</span><span class="op" id="3493193">:</span><span class="num" id="3493194">0</span><span class="op" id="3493195">]</span><span class="op" id="3493196">,</span>&nbsp;<span class="ident" id="3493198">dst</span><span class="op" id="3493201">.</span><span class="ident" id="3493202">Rune</span><span class="op" id="3493206">[</span><span class="num" id="3493207">0</span><span class="op" id="3493208">]</span><span class="op" id="3493209">,</span>&nbsp;<span class="ident" id="3493211">dst</span><span class="op" id="3493214">.</span><span class="ident" id="3493215">Flags</span><span class="op" id="3493220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493224">dst</span><span class="op" id="3493227">.</span><span class="ident" id="3493228">Rune</span>&nbsp;<span class="op" id="3493233">=</span>&nbsp;<span class="ident" id="3493235">appendLiteral</span><span class="op" id="3493248">(</span><span class="ident" id="3493249">dst</span><span class="op" id="3493252">.</span><span class="ident" id="3493253">Rune</span><span class="op" id="3493257">,</span>&nbsp;<span class="ident" id="3493259">src</span><span class="op" id="3493262">.</span><span class="ident" id="3493263">Rune</span><span class="op" id="3493267">[</span><span class="num" id="3493268">0</span><span class="op" id="3493269">]</span><span class="op" id="3493270">,</span>&nbsp;<span class="ident" id="3493272">src</span><span class="op" id="3493275">.</span><span class="ident" id="3493276">Flags</span><span class="op" id="3493281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493284">}</span><br>
<span class="lineno">1155</span><span class="op" id="3493286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3493289">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="3493359">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="3493410">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="3493441">func</span>&nbsp;<span class="op" id="3493446">(</span><span class="ident" id="3493447">p</span>&nbsp;<span class="op" id="3493449">*</span><span class="ident" id="3493450">parser</span><span class="op" id="3493456">)</span>&nbsp;<span class="ident" id="3493458">swapVerticalBar</span><span class="op" id="3493473">(</span><span class="op" id="3493474">)</span>&nbsp;<span class="builtintype" id="3493476">bool</span>&nbsp;<span class="op" id="3493481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3493484">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3493547">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493587">n</span>&nbsp;<span class="op" id="3493589">:=</span>&nbsp;<span class="builtinfunc" id="3493592">len</span><span class="op" id="3493595">(</span><span class="ident" id="3493596">p</span><span class="op" id="3493597">.</span><span class="ident" id="3493598">stack</span><span class="op" id="3493603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493606">if</span>&nbsp;<span class="ident" id="3493609">n</span>&nbsp;<span class="op" id="3493611">&gt;=</span>&nbsp;<span class="num" id="3493614">3</span>&nbsp;<span class="op" id="3493616">&amp;&amp;</span>&nbsp;<span class="ident" id="3493619">p</span><span class="op" id="3493620">.</span><span class="ident" id="3493621">stack</span><span class="op" id="3493626">[</span><span class="ident" id="3493627">n</span><span class="op" id="3493628">-</span><span class="num" id="3493629">2</span><span class="op" id="3493630">]</span><span class="op" id="3493631">.</span><span class="ident" id="3493632">Op</span>&nbsp;<span class="op" id="3493635">==</span>&nbsp;<span class="ident" id="3493638">opVerticalBar</span>&nbsp;<span class="op" id="3493652">&amp;&amp;</span>&nbsp;<span class="ident" id="3493655">isCharClass</span><span class="op" id="3493666">(</span><span class="ident" id="3493667">p</span><span class="op" id="3493668">.</span><span class="ident" id="3493669">stack</span><span class="op" id="3493674">[</span><span class="ident" id="3493675">n</span><span class="op" id="3493676">-</span><span class="num" id="3493677">1</span><span class="op" id="3493678">]</span><span class="op" id="3493679">)</span>&nbsp;<span class="op" id="3493681">&amp;&amp;</span>&nbsp;<span class="ident" id="3493684">isCharClass</span><span class="op" id="3493695">(</span><span class="ident" id="3493696">p</span><span class="op" id="3493697">.</span><span class="ident" id="3493698">stack</span><span class="op" id="3493703">[</span><span class="ident" id="3493704">n</span><span class="op" id="3493705">-</span><span class="num" id="3493706">3</span><span class="op" id="3493707">]</span><span class="op" id="3493708">)</span>&nbsp;<span class="op" id="3493710">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493714">re1</span>&nbsp;<span class="op" id="3493718">:=</span>&nbsp;<span class="ident" id="3493721">p</span><span class="op" id="3493722">.</span><span class="ident" id="3493723">stack</span><span class="op" id="3493728">[</span><span class="ident" id="3493729">n</span><span class="op" id="3493730">-</span><span class="num" id="3493731">1</span><span class="op" id="3493732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493736">re3</span>&nbsp;<span class="op" id="3493740">:=</span>&nbsp;<span class="ident" id="3493743">p</span><span class="op" id="3493744">.</span><span class="ident" id="3493745">stack</span><span class="op" id="3493750">[</span><span class="ident" id="3493751">n</span><span class="op" id="3493752">-</span><span class="num" id="3493753">3</span><span class="op" id="3493754">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3493758">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493801">if</span>&nbsp;<span class="ident" id="3493804">re1</span><span class="op" id="3493807">.</span><span class="ident" id="3493808">Op</span>&nbsp;<span class="op" id="3493811">&gt;</span>&nbsp;<span class="ident" id="3493813">re3</span><span class="op" id="3493816">.</span><span class="ident" id="3493817">Op</span>&nbsp;<span class="op" id="3493820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493825">re1</span><span class="op" id="3493828">,</span>&nbsp;<span class="ident" id="3493830">re3</span>&nbsp;<span class="op" id="3493834">=</span>&nbsp;<span class="ident" id="3493836">re3</span><span class="op" id="3493839">,</span>&nbsp;<span class="ident" id="3493841">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493848">p</span><span class="op" id="3493849">.</span><span class="ident" id="3493850">stack</span><span class="op" id="3493855">[</span><span class="ident" id="3493856">n</span><span class="op" id="3493857">-</span><span class="num" id="3493858">3</span><span class="op" id="3493859">]</span>&nbsp;<span class="op" id="3493861">=</span>&nbsp;<span class="ident" id="3493863">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493873">mergeCharClass</span><span class="op" id="3493887">(</span><span class="ident" id="3493888">re3</span><span class="op" id="3493891">,</span>&nbsp;<span class="ident" id="3493893">re1</span><span class="op" id="3493896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493900">p</span><span class="op" id="3493901">.</span><span class="ident" id="3493902">reuse</span><span class="op" id="3493907">(</span><span class="ident" id="3493908">re1</span><span class="op" id="3493911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493915">p</span><span class="op" id="3493916">.</span><span class="ident" id="3493917">stack</span>&nbsp;<span class="op" id="3493923">=</span>&nbsp;<span class="ident" id="3493925">p</span><span class="op" id="3493926">.</span><span class="ident" id="3493927">stack</span><span class="op" id="3493932">[</span><span class="op" id="3493933">:</span><span class="ident" id="3493934">n</span><span class="op" id="3493935">-</span><span class="num" id="3493936">1</span><span class="op" id="3493937">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493941">return</span>&nbsp;<span class="builtintype" id="3493948">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3493954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3493958">if</span>&nbsp;<span class="ident" id="3493961">n</span>&nbsp;<span class="op" id="3493963">&gt;=</span>&nbsp;<span class="num" id="3493966">2</span>&nbsp;<span class="op" id="3493968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493972">re1</span>&nbsp;<span class="op" id="3493976">:=</span>&nbsp;<span class="ident" id="3493979">p</span><span class="op" id="3493980">.</span><span class="ident" id="3493981">stack</span><span class="op" id="3493986">[</span><span class="ident" id="3493987">n</span><span class="op" id="3493988">-</span><span class="num" id="3493989">1</span><span class="op" id="3493990">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3493994">re2</span>&nbsp;<span class="op" id="3493998">:=</span>&nbsp;<span class="ident" id="3494001">p</span><span class="op" id="3494002">.</span><span class="ident" id="3494003">stack</span><span class="op" id="3494008">[</span><span class="ident" id="3494009">n</span><span class="op" id="3494010">-</span><span class="num" id="3494011">2</span><span class="op" id="3494012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494016">if</span>&nbsp;<span class="ident" id="3494019">re2</span><span class="op" id="3494022">.</span><span class="ident" id="3494023">Op</span>&nbsp;<span class="op" id="3494026">==</span>&nbsp;<span class="ident" id="3494029">opVerticalBar</span>&nbsp;<span class="op" id="3494043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494048">if</span>&nbsp;<span class="ident" id="3494051">n</span>&nbsp;<span class="op" id="3494053">&gt;=</span>&nbsp;<span class="num" id="3494056">3</span>&nbsp;<span class="op" id="3494058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3494064">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3494089">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494121">cleanAlt</span><span class="op" id="3494129">(</span><span class="ident" id="3494130">p</span><span class="op" id="3494131">.</span><span class="ident" id="3494132">stack</span><span class="op" id="3494137">[</span><span class="ident" id="3494138">n</span><span class="op" id="3494139">-</span><span class="num" id="3494140">3</span><span class="op" id="3494141">]</span><span class="op" id="3494142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494152">p</span><span class="op" id="3494153">.</span><span class="ident" id="3494154">stack</span><span class="op" id="3494159">[</span><span class="ident" id="3494160">n</span><span class="op" id="3494161">-</span><span class="num" id="3494162">2</span><span class="op" id="3494163">]</span>&nbsp;<span class="op" id="3494165">=</span>&nbsp;<span class="ident" id="3494167">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494174">p</span><span class="op" id="3494175">.</span><span class="ident" id="3494176">stack</span><span class="op" id="3494181">[</span><span class="ident" id="3494182">n</span><span class="op" id="3494183">-</span><span class="num" id="3494184">1</span><span class="op" id="3494185">]</span>&nbsp;<span class="op" id="3494187">=</span>&nbsp;<span class="ident" id="3494189">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494196">return</span>&nbsp;<span class="builtintype" id="3494203">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494216">return</span>&nbsp;<span class="builtintype" id="3494223">false</span><br>
<span class="lineno"></span><span class="op" id="3494229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="3494232">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3494277">func</span>&nbsp;<span class="op" id="3494282">(</span><span class="ident" id="3494283">p</span>&nbsp;<span class="op" id="3494285">*</span><span class="ident" id="3494286">parser</span><span class="op" id="3494292">)</span>&nbsp;<span class="ident" id="3494294">parseRightParen</span><span class="op" id="3494309">(</span><span class="op" id="3494310">)</span>&nbsp;<span class="builtintype" id="3494312">error</span>&nbsp;<span class="op" id="3494318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494321">p</span><span class="op" id="3494322">.</span><span class="ident" id="3494323">concat</span><span class="op" id="3494329">(</span><span class="op" id="3494330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494333">if</span>&nbsp;<span class="ident" id="3494336">p</span><span class="op" id="3494337">.</span><span class="ident" id="3494338">swapVerticalBar</span><span class="op" id="3494353">(</span><span class="op" id="3494354">)</span>&nbsp;<span class="op" id="3494356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3494360">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494382">p</span><span class="op" id="3494383">.</span><span class="ident" id="3494384">stack</span>&nbsp;<span class="op" id="3494390">=</span>&nbsp;<span class="ident" id="3494392">p</span><span class="op" id="3494393">.</span><span class="ident" id="3494394">stack</span><span class="op" id="3494399">[</span><span class="op" id="3494400">:</span><span class="builtinfunc" id="3494401">len</span><span class="op" id="3494404">(</span><span class="ident" id="3494405">p</span><span class="op" id="3494406">.</span><span class="ident" id="3494407">stack</span><span class="op" id="3494412">)</span><span class="op" id="3494413">-</span><span class="num" id="3494414">1</span><span class="op" id="3494415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494421">p</span><span class="op" id="3494422">.</span><span class="ident" id="3494423">alternate</span><span class="op" id="3494432">(</span><span class="op" id="3494433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494437">n</span>&nbsp;<span class="op" id="3494439">:=</span>&nbsp;<span class="builtinfunc" id="3494442">len</span><span class="op" id="3494445">(</span><span class="ident" id="3494446">p</span><span class="op" id="3494447">.</span><span class="ident" id="3494448">stack</span><span class="op" id="3494453">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494456">if</span>&nbsp;<span class="ident" id="3494459">n</span>&nbsp;<span class="op" id="3494461">&lt;</span>&nbsp;<span class="num" id="3494463">2</span>&nbsp;<span class="op" id="3494465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494469">return</span>&nbsp;<span class="op" id="3494476">&amp;</span><span class="ident" id="3494477">Error</span><span class="op" id="3494482">{</span><span class="ident" id="3494483">ErrUnexpectedParen</span><span class="op" id="3494501">,</span>&nbsp;<span class="ident" id="3494503">p</span><span class="op" id="3494504">.</span><span class="ident" id="3494505">wholeRegexp</span><span class="op" id="3494516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494522">re1</span>&nbsp;<span class="op" id="3494526">:=</span>&nbsp;<span class="ident" id="3494529">p</span><span class="op" id="3494530">.</span><span class="ident" id="3494531">stack</span><span class="op" id="3494536">[</span><span class="ident" id="3494537">n</span><span class="op" id="3494538">-</span><span class="num" id="3494539">1</span><span class="op" id="3494540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494543">re2</span>&nbsp;<span class="op" id="3494547">:=</span>&nbsp;<span class="ident" id="3494550">p</span><span class="op" id="3494551">.</span><span class="ident" id="3494552">stack</span><span class="op" id="3494557">[</span><span class="ident" id="3494558">n</span><span class="op" id="3494559">-</span><span class="num" id="3494560">2</span><span class="op" id="3494561">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494564">p</span><span class="op" id="3494565">.</span><span class="ident" id="3494566">stack</span>&nbsp;<span class="op" id="3494572">=</span>&nbsp;<span class="ident" id="3494574">p</span><span class="op" id="3494575">.</span><span class="ident" id="3494576">stack</span><span class="op" id="3494581">[</span><span class="op" id="3494582">:</span><span class="ident" id="3494583">n</span><span class="op" id="3494584">-</span><span class="num" id="3494585">2</span><span class="op" id="3494586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494589">if</span>&nbsp;<span class="ident" id="3494592">re2</span><span class="op" id="3494595">.</span><span class="ident" id="3494596">Op</span>&nbsp;<span class="op" id="3494599">!=</span>&nbsp;<span class="ident" id="3494602">opLeftParen</span>&nbsp;<span class="op" id="3494614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494618">return</span>&nbsp;<span class="op" id="3494625">&amp;</span><span class="ident" id="3494626">Error</span><span class="op" id="3494631">{</span><span class="ident" id="3494632">ErrUnexpectedParen</span><span class="op" id="3494650">,</span>&nbsp;<span class="ident" id="3494652">p</span><span class="op" id="3494653">.</span><span class="ident" id="3494654">wholeRegexp</span><span class="op" id="3494665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3494671">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494707">p</span><span class="op" id="3494708">.</span><span class="ident" id="3494709">flags</span>&nbsp;<span class="op" id="3494715">=</span>&nbsp;<span class="ident" id="3494717">re2</span><span class="op" id="3494720">.</span><span class="ident" id="3494721">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494728">if</span>&nbsp;<span class="ident" id="3494731">re2</span><span class="op" id="3494734">.</span><span class="ident" id="3494735">Cap</span>&nbsp;<span class="op" id="3494739">==</span>&nbsp;<span class="num" id="3494742">0</span>&nbsp;<span class="op" id="3494744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3494748">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494772">p</span><span class="op" id="3494773">.</span><span class="ident" id="3494774">push</span><span class="op" id="3494778">(</span><span class="ident" id="3494779">re1</span><span class="op" id="3494782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494785">}</span>&nbsp;<span class="keyword" id="3494787">else</span>&nbsp;<span class="op" id="3494792">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494796">re2</span><span class="op" id="3494799">.</span><span class="ident" id="3494800">Op</span>&nbsp;<span class="op" id="3494803">=</span>&nbsp;<span class="ident" id="3494805">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494817">re2</span><span class="op" id="3494820">.</span><span class="ident" id="3494821">Sub</span>&nbsp;<span class="op" id="3494825">=</span>&nbsp;<span class="ident" id="3494827">re2</span><span class="op" id="3494830">.</span><span class="ident" id="3494831">Sub0</span><span class="op" id="3494835">[</span><span class="op" id="3494836">:</span><span class="num" id="3494837">1</span><span class="op" id="3494838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494842">re2</span><span class="op" id="3494845">.</span><span class="ident" id="3494846">Sub</span><span class="op" id="3494849">[</span><span class="num" id="3494850">0</span><span class="op" id="3494851">]</span>&nbsp;<span class="op" id="3494853">=</span>&nbsp;<span class="ident" id="3494855">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3494861">p</span><span class="op" id="3494862">.</span><span class="ident" id="3494863">push</span><span class="op" id="3494867">(</span><span class="ident" id="3494868">re2</span><span class="op" id="3494871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3494874">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3494877">return</span>&nbsp;<span class="builtintype" id="3494884">nil</span><br>
<span class="lineno"></span><span class="op" id="3494888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3494891">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3494954">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3494979">func</span>&nbsp;<span class="op" id="3494984">(</span><span class="ident" id="3494985">p</span>&nbsp;<span class="op" id="3494987">*</span><span class="ident" id="3494988">parser</span><span class="op" id="3494994">)</span>&nbsp;<span class="ident" id="3494996">parseEscape</span><span class="op" id="3495007">(</span><span class="ident" id="3495008">s</span>&nbsp;<span class="builtintype" id="3495010">string</span><span class="op" id="3495016">)</span>&nbsp;<span class="op" id="3495018">(</span><span class="ident" id="3495019">r</span>&nbsp;<span class="builtintype" id="3495021">rune</span><span class="op" id="3495025">,</span>&nbsp;<span class="ident" id="3495027">rest</span>&nbsp;<span class="builtintype" id="3495032">string</span><span class="op" id="3495038">,</span>&nbsp;<span class="ident" id="3495040">err</span>&nbsp;<span class="builtintype" id="3495044">error</span><span class="op" id="3495049">)</span>&nbsp;<span class="op" id="3495051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495054">t</span>&nbsp;<span class="op" id="3495056">:=</span>&nbsp;<span class="ident" id="3495059">s</span><span class="op" id="3495060">[</span><span class="num" id="3495061">1</span><span class="op" id="3495062">:</span><span class="op" id="3495063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495066">if</span>&nbsp;<span class="ident" id="3495069">t</span>&nbsp;<span class="op" id="3495071">==</span>&nbsp;<span class="string" id="3495074">&#34;&#34;</span>&nbsp;<span class="op" id="3495077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495081">return</span>&nbsp;<span class="num" id="3495088">0</span><span class="op" id="3495089">,</span>&nbsp;<span class="string" id="3495091">&#34;&#34;</span><span class="op" id="3495093">,</span>&nbsp;<span class="op" id="3495095">&amp;</span><span class="ident" id="3495096">Error</span><span class="op" id="3495101">{</span><span class="ident" id="3495102">ErrTrailingBackslash</span><span class="op" id="3495122">,</span>&nbsp;<span class="string" id="3495124">&#34;&#34;</span><span class="op" id="3495126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495129">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495132">c</span><span class="op" id="3495133">,</span>&nbsp;<span class="ident" id="3495135">t</span><span class="op" id="3495136">,</span>&nbsp;<span class="ident" id="3495138">err</span>&nbsp;<span class="op" id="3495142">:=</span>&nbsp;<span class="ident" id="3495145">nextRune</span><span class="op" id="3495153">(</span><span class="ident" id="3495154">t</span><span class="op" id="3495155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495158">if</span>&nbsp;<span class="ident" id="3495161">err</span>&nbsp;<span class="op" id="3495165">!=</span>&nbsp;<span class="builtintype" id="3495168">nil</span>&nbsp;<span class="op" id="3495172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495176">return</span>&nbsp;<span class="num" id="3495183">0</span><span class="op" id="3495184">,</span>&nbsp;<span class="string" id="3495186">&#34;&#34;</span><span class="op" id="3495188">,</span>&nbsp;<span class="ident" id="3495190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="3495198">Switch</span><span class="op" id="3495204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495207">switch</span>&nbsp;<span class="ident" id="3495214">c</span>&nbsp;<span class="op" id="3495216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495219">default</span><span class="op" id="3495226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495230">if</span>&nbsp;<span class="ident" id="3495233">c</span>&nbsp;<span class="op" id="3495235">&lt;</span>&nbsp;<span class="ident" id="3495237">utf8</span><span class="op" id="3495241">.</span><span class="ident" id="3495242">RuneSelf</span>&nbsp;<span class="op" id="3495251">&amp;&amp;</span>&nbsp;<span class="op" id="3495254">!</span><span class="ident" id="3495255">isalnum</span><span class="op" id="3495262">(</span><span class="ident" id="3495263">c</span><span class="op" id="3495264">)</span>&nbsp;<span class="op" id="3495266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495271">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495328">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495388">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495447">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495506">return</span>&nbsp;<span class="ident" id="3495513">c</span><span class="op" id="3495514">,</span>&nbsp;<span class="ident" id="3495516">t</span><span class="op" id="3495517">,</span>&nbsp;<span class="builtintype" id="3495519">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495525">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495529">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495548">case</span>&nbsp;<span class="string" id="3495553">&#39;1&#39;</span><span class="op" id="3495556">,</span>&nbsp;<span class="string" id="3495558">&#39;2&#39;</span><span class="op" id="3495561">,</span>&nbsp;<span class="string" id="3495563">&#39;3&#39;</span><span class="op" id="3495566">,</span>&nbsp;<span class="string" id="3495568">&#39;4&#39;</span><span class="op" id="3495571">,</span>&nbsp;<span class="string" id="3495573">&#39;5&#39;</span><span class="op" id="3495576">,</span>&nbsp;<span class="string" id="3495578">&#39;6&#39;</span><span class="op" id="3495581">,</span>&nbsp;<span class="string" id="3495583">&#39;7&#39;</span><span class="op" id="3495586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495590">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495651">if</span>&nbsp;<span class="ident" id="3495654">t</span>&nbsp;<span class="op" id="3495656">==</span>&nbsp;<span class="string" id="3495659">&#34;&#34;</span>&nbsp;<span class="op" id="3495662">||</span>&nbsp;<span class="ident" id="3495665">t</span><span class="op" id="3495666">[</span><span class="num" id="3495667">0</span><span class="op" id="3495668">]</span>&nbsp;<span class="op" id="3495670">&lt;</span>&nbsp;<span class="string" id="3495672">&#39;0&#39;</span>&nbsp;<span class="op" id="3495676">||</span>&nbsp;<span class="ident" id="3495679">t</span><span class="op" id="3495680">[</span><span class="num" id="3495681">0</span><span class="op" id="3495682">]</span>&nbsp;<span class="op" id="3495684">&gt;</span>&nbsp;<span class="string" id="3495686">&#39;7&#39;</span>&nbsp;<span class="op" id="3495690">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495695">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495707">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495720">case</span>&nbsp;<span class="string" id="3495725">&#39;0&#39;</span><span class="op" id="3495728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495732">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495789">r</span>&nbsp;<span class="op" id="3495791">=</span>&nbsp;<span class="ident" id="3495793">c</span>&nbsp;<span class="op" id="3495795">-</span>&nbsp;<span class="string" id="3495797">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495803">for</span>&nbsp;<span class="ident" id="3495807">i</span>&nbsp;<span class="op" id="3495809">:=</span>&nbsp;<span class="num" id="3495812">1</span><span class="op" id="3495813">;</span>&nbsp;<span class="ident" id="3495815">i</span>&nbsp;<span class="op" id="3495817">&lt;</span>&nbsp;<span class="num" id="3495819">3</span><span class="op" id="3495820">;</span>&nbsp;<span class="ident" id="3495822">i</span><span class="op" id="3495823">++</span>&nbsp;<span class="op" id="3495826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495831">if</span>&nbsp;<span class="ident" id="3495834">t</span>&nbsp;<span class="op" id="3495836">==</span>&nbsp;<span class="string" id="3495839">&#34;&#34;</span>&nbsp;<span class="op" id="3495842">||</span>&nbsp;<span class="ident" id="3495845">t</span><span class="op" id="3495846">[</span><span class="num" id="3495847">0</span><span class="op" id="3495848">]</span>&nbsp;<span class="op" id="3495850">&lt;</span>&nbsp;<span class="string" id="3495852">&#39;0&#39;</span>&nbsp;<span class="op" id="3495856">||</span>&nbsp;<span class="ident" id="3495859">t</span><span class="op" id="3495860">[</span><span class="num" id="3495861">0</span><span class="op" id="3495862">]</span>&nbsp;<span class="op" id="3495864">&gt;</span>&nbsp;<span class="string" id="3495866">&#39;7&#39;</span>&nbsp;<span class="op" id="3495870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495876">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495885">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495890">r</span>&nbsp;<span class="op" id="3495892">=</span>&nbsp;<span class="ident" id="3495894">r</span><span class="op" id="3495895">*</span><span class="num" id="3495896">8</span>&nbsp;<span class="op" id="3495898">+</span>&nbsp;<span class="builtintype" id="3495900">rune</span><span class="op" id="3495904">(</span><span class="ident" id="3495905">t</span><span class="op" id="3495906">[</span><span class="num" id="3495907">0</span><span class="op" id="3495908">]</span><span class="op" id="3495909">)</span>&nbsp;<span class="op" id="3495911">-</span>&nbsp;<span class="string" id="3495913">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3495920">t</span>&nbsp;<span class="op" id="3495922">=</span>&nbsp;<span class="ident" id="3495924">t</span><span class="op" id="3495925">[</span><span class="num" id="3495926">1</span><span class="op" id="3495927">:</span><span class="op" id="3495928">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3495932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495936">return</span>&nbsp;<span class="ident" id="3495943">r</span><span class="op" id="3495944">,</span>&nbsp;<span class="ident" id="3495946">t</span><span class="op" id="3495947">,</span>&nbsp;<span class="builtintype" id="3495949">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3495955">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495980">case</span>&nbsp;<span class="string" id="3495985">&#39;x&#39;</span><span class="op" id="3495988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3495992">if</span>&nbsp;<span class="ident" id="3495995">t</span>&nbsp;<span class="op" id="3495997">==</span>&nbsp;<span class="string" id="3496000">&#34;&#34;</span>&nbsp;<span class="op" id="3496003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496008">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496016">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496020">if</span>&nbsp;<span class="ident" id="3496023">c</span><span class="op" id="3496024">,</span>&nbsp;<span class="ident" id="3496026">t</span><span class="op" id="3496027">,</span>&nbsp;<span class="ident" id="3496029">err</span>&nbsp;<span class="op" id="3496033">=</span>&nbsp;<span class="ident" id="3496035">nextRune</span><span class="op" id="3496043">(</span><span class="ident" id="3496044">t</span><span class="op" id="3496045">)</span><span class="op" id="3496046">;</span>&nbsp;<span class="ident" id="3496048">err</span>&nbsp;<span class="op" id="3496052">!=</span>&nbsp;<span class="builtintype" id="3496055">nil</span>&nbsp;<span class="op" id="3496059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496064">return</span>&nbsp;<span class="num" id="3496071">0</span><span class="op" id="3496072">,</span>&nbsp;<span class="string" id="3496074">&#34;&#34;</span><span class="op" id="3496076">,</span>&nbsp;<span class="ident" id="3496078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496088">if</span>&nbsp;<span class="ident" id="3496091">c</span>&nbsp;<span class="op" id="3496093">==</span>&nbsp;<span class="string" id="3496096">&#39;{&#39;</span>&nbsp;<span class="op" id="3496100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496105">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496143">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496199">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496265">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496289">nhex</span>&nbsp;<span class="op" id="3496294">:=</span>&nbsp;<span class="num" id="3496297">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496302">r</span>&nbsp;<span class="op" id="3496304">=</span>&nbsp;<span class="num" id="3496306">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496311">for</span>&nbsp;<span class="op" id="3496315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496321">if</span>&nbsp;<span class="ident" id="3496324">t</span>&nbsp;<span class="op" id="3496326">==</span>&nbsp;<span class="string" id="3496329">&#34;&#34;</span>&nbsp;<span class="op" id="3496332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496339">break</span>&nbsp;<span class="ident" id="3496345">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496362">if</span>&nbsp;<span class="ident" id="3496365">c</span><span class="op" id="3496366">,</span>&nbsp;<span class="ident" id="3496368">t</span><span class="op" id="3496369">,</span>&nbsp;<span class="ident" id="3496371">err</span>&nbsp;<span class="op" id="3496375">=</span>&nbsp;<span class="ident" id="3496377">nextRune</span><span class="op" id="3496385">(</span><span class="ident" id="3496386">t</span><span class="op" id="3496387">)</span><span class="op" id="3496388">;</span>&nbsp;<span class="ident" id="3496390">err</span>&nbsp;<span class="op" id="3496394">!=</span>&nbsp;<span class="builtintype" id="3496397">nil</span>&nbsp;<span class="op" id="3496401">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496408">return</span>&nbsp;<span class="num" id="3496415">0</span><span class="op" id="3496416">,</span>&nbsp;<span class="string" id="3496418">&#34;&#34;</span><span class="op" id="3496420">,</span>&nbsp;<span class="ident" id="3496422">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496436">if</span>&nbsp;<span class="ident" id="3496439">c</span>&nbsp;<span class="op" id="3496441">==</span>&nbsp;<span class="string" id="3496444">&#39;}&#39;</span>&nbsp;<span class="op" id="3496448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496455">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496465">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496471">v</span>&nbsp;<span class="op" id="3496473">:=</span>&nbsp;<span class="ident" id="3496476">unhex</span><span class="op" id="3496481">(</span><span class="ident" id="3496482">c</span><span class="op" id="3496483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496489">if</span>&nbsp;<span class="ident" id="3496492">v</span>&nbsp;<span class="op" id="3496494">&lt;</span>&nbsp;<span class="num" id="3496496">0</span>&nbsp;<span class="op" id="3496498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496505">break</span>&nbsp;<span class="ident" id="3496511">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496528">r</span>&nbsp;<span class="op" id="3496530">=</span>&nbsp;<span class="ident" id="3496532">r</span><span class="op" id="3496533">*</span><span class="num" id="3496534">16</span>&nbsp;<span class="op" id="3496537">+</span>&nbsp;<span class="ident" id="3496539">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496545">if</span>&nbsp;<span class="ident" id="3496548">r</span>&nbsp;<span class="op" id="3496550">&gt;</span>&nbsp;<span class="ident" id="3496552">unicode</span><span class="op" id="3496559">.</span><span class="ident" id="3496560">MaxRune</span>&nbsp;<span class="op" id="3496568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496575">break</span>&nbsp;<span class="ident" id="3496581">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496598">nhex</span><span class="op" id="3496602">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496608">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496613">if</span>&nbsp;<span class="ident" id="3496616">nhex</span>&nbsp;<span class="op" id="3496621">==</span>&nbsp;<span class="num" id="3496624">0</span>&nbsp;<span class="op" id="3496626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496632">break</span>&nbsp;<span class="ident" id="3496638">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496653">return</span>&nbsp;<span class="ident" id="3496660">r</span><span class="op" id="3496661">,</span>&nbsp;<span class="ident" id="3496663">t</span><span class="op" id="3496664">,</span>&nbsp;<span class="builtintype" id="3496666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496672">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496677">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496709">x</span>&nbsp;<span class="op" id="3496711">:=</span>&nbsp;<span class="ident" id="3496714">unhex</span><span class="op" id="3496719">(</span><span class="ident" id="3496720">c</span><span class="op" id="3496721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496725">if</span>&nbsp;<span class="ident" id="3496728">c</span><span class="op" id="3496729">,</span>&nbsp;<span class="ident" id="3496731">t</span><span class="op" id="3496732">,</span>&nbsp;<span class="ident" id="3496734">err</span>&nbsp;<span class="op" id="3496738">=</span>&nbsp;<span class="ident" id="3496740">nextRune</span><span class="op" id="3496748">(</span><span class="ident" id="3496749">t</span><span class="op" id="3496750">)</span><span class="op" id="3496751">;</span>&nbsp;<span class="ident" id="3496753">err</span>&nbsp;<span class="op" id="3496757">!=</span>&nbsp;<span class="builtintype" id="3496760">nil</span>&nbsp;<span class="op" id="3496764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496769">return</span>&nbsp;<span class="num" id="3496776">0</span><span class="op" id="3496777">,</span>&nbsp;<span class="string" id="3496779">&#34;&#34;</span><span class="op" id="3496781">,</span>&nbsp;<span class="ident" id="3496783">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3496793">y</span>&nbsp;<span class="op" id="3496795">:=</span>&nbsp;<span class="ident" id="3496798">unhex</span><span class="op" id="3496803">(</span><span class="ident" id="3496804">c</span><span class="op" id="3496805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496809">if</span>&nbsp;<span class="ident" id="3496812">x</span>&nbsp;<span class="op" id="3496814">&lt;</span>&nbsp;<span class="num" id="3496816">0</span>&nbsp;<span class="op" id="3496818">||</span>&nbsp;<span class="ident" id="3496821">y</span>&nbsp;<span class="op" id="3496823">&lt;</span>&nbsp;<span class="num" id="3496825">0</span>&nbsp;<span class="op" id="3496827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496832">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3496840">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3496844">return</span>&nbsp;<span class="ident" id="3496851">x</span><span class="op" id="3496852">*</span><span class="num" id="3496853">16</span>&nbsp;<span class="op" id="3496856">+</span>&nbsp;<span class="ident" id="3496858">y</span><span class="op" id="3496859">,</span>&nbsp;<span class="ident" id="3496861">t</span><span class="op" id="3496862">,</span>&nbsp;<span class="builtintype" id="3496864">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496870">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496928">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3496980">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497039">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497095">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497150">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497177">case</span>&nbsp;<span class="string" id="3497182">&#39;a&#39;</span><span class="op" id="3497185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497189">return</span>&nbsp;<span class="string" id="3497196">&#39;\a&#39;</span><span class="op" id="3497200">,</span>&nbsp;<span class="ident" id="3497202">t</span><span class="op" id="3497203">,</span>&nbsp;<span class="ident" id="3497205">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497210">case</span>&nbsp;<span class="string" id="3497215">&#39;f&#39;</span><span class="op" id="3497218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497222">return</span>&nbsp;<span class="string" id="3497229">&#39;\f&#39;</span><span class="op" id="3497233">,</span>&nbsp;<span class="ident" id="3497235">t</span><span class="op" id="3497236">,</span>&nbsp;<span class="ident" id="3497238">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497243">case</span>&nbsp;<span class="string" id="3497248">&#39;n&#39;</span><span class="op" id="3497251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497255">return</span>&nbsp;<span class="string" id="3497262">&#39;\n&#39;</span><span class="op" id="3497266">,</span>&nbsp;<span class="ident" id="3497268">t</span><span class="op" id="3497269">,</span>&nbsp;<span class="ident" id="3497271">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497276">case</span>&nbsp;<span class="string" id="3497281">&#39;r&#39;</span><span class="op" id="3497284">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497288">return</span>&nbsp;<span class="string" id="3497295">&#39;\r&#39;</span><span class="op" id="3497299">,</span>&nbsp;<span class="ident" id="3497301">t</span><span class="op" id="3497302">,</span>&nbsp;<span class="ident" id="3497304">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497309">case</span>&nbsp;<span class="string" id="3497314">&#39;t&#39;</span><span class="op" id="3497317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497321">return</span>&nbsp;<span class="string" id="3497328">&#39;\t&#39;</span><span class="op" id="3497332">,</span>&nbsp;<span class="ident" id="3497334">t</span><span class="op" id="3497335">,</span>&nbsp;<span class="ident" id="3497337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497342">case</span>&nbsp;<span class="string" id="3497347">&#39;v&#39;</span><span class="op" id="3497350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497354">return</span>&nbsp;<span class="string" id="3497361">&#39;\v&#39;</span><span class="op" id="3497365">,</span>&nbsp;<span class="ident" id="3497367">t</span><span class="op" id="3497368">,</span>&nbsp;<span class="ident" id="3497370">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497378">return</span>&nbsp;<span class="num" id="3497385">0</span><span class="op" id="3497386">,</span>&nbsp;<span class="string" id="3497388">&#34;&#34;</span><span class="op" id="3497390">,</span>&nbsp;<span class="op" id="3497392">&amp;</span><span class="ident" id="3497393">Error</span><span class="op" id="3497398">{</span><span class="ident" id="3497399">ErrInvalidEscape</span><span class="op" id="3497415">,</span>&nbsp;<span class="ident" id="3497417">s</span><span class="op" id="3497418">[</span><span class="op" id="3497419">:</span><span class="builtinfunc" id="3497420">len</span><span class="op" id="3497423">(</span><span class="ident" id="3497424">s</span><span class="op" id="3497425">)</span><span class="op" id="3497426">-</span><span class="builtinfunc" id="3497427">len</span><span class="op" id="3497430">(</span><span class="ident" id="3497431">t</span><span class="op" id="3497432">)</span><span class="op" id="3497433">]</span><span class="op" id="3497434">}</span><br>
<span class="lineno"></span><span class="op" id="3497436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3497439">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="3497514">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3497533">func</span>&nbsp;<span class="op" id="3497538">(</span><span class="ident" id="3497539">p</span>&nbsp;<span class="op" id="3497541">*</span><span class="ident" id="3497542">parser</span><span class="op" id="3497548">)</span>&nbsp;<span class="ident" id="3497550">parseClassChar</span><span class="op" id="3497564">(</span><span class="ident" id="3497565">s</span><span class="op" id="3497566">,</span>&nbsp;<span class="ident" id="3497568">wholeClass</span>&nbsp;<span class="builtintype" id="3497579">string</span><span class="op" id="3497585">)</span>&nbsp;<span class="op" id="3497587">(</span><span class="ident" id="3497588">r</span>&nbsp;<span class="builtintype" id="3497590">rune</span><span class="op" id="3497594">,</span>&nbsp;<span class="ident" id="3497596">rest</span>&nbsp;<span class="builtintype" id="3497601">string</span><span class="op" id="3497607">,</span>&nbsp;<span class="ident" id="3497609">err</span>&nbsp;<span class="builtintype" id="3497613">error</span><span class="op" id="3497618">)</span>&nbsp;<span class="op" id="3497620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497623">if</span>&nbsp;<span class="ident" id="3497626">s</span>&nbsp;<span class="op" id="3497628">==</span>&nbsp;<span class="string" id="3497631">&#34;&#34;</span>&nbsp;<span class="op" id="3497634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497638">return</span>&nbsp;<span class="num" id="3497645">0</span><span class="op" id="3497646">,</span>&nbsp;<span class="string" id="3497648">&#34;&#34;</span><span class="op" id="3497650">,</span>&nbsp;<span class="op" id="3497652">&amp;</span><span class="ident" id="3497653">Error</span><span class="op" id="3497658">{</span><span class="ident" id="3497659">Code</span><span class="op" id="3497663">:</span>&nbsp;<span class="ident" id="3497665">ErrMissingBracket</span><span class="op" id="3497682">,</span>&nbsp;<span class="ident" id="3497684">Expr</span><span class="op" id="3497688">:</span>&nbsp;<span class="ident" id="3497690">wholeClass</span><span class="op" id="3497700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497703">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497707">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3497754">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497800">if</span>&nbsp;<span class="ident" id="3497803">s</span><span class="op" id="3497804">[</span><span class="num" id="3497805">0</span><span class="op" id="3497806">]</span>&nbsp;<span class="op" id="3497808">==</span>&nbsp;<span class="string" id="3497811">&#39;\\&#39;</span>&nbsp;<span class="op" id="3497816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497820">return</span>&nbsp;<span class="ident" id="3497827">p</span><span class="op" id="3497828">.</span><span class="ident" id="3497829">parseEscape</span><span class="op" id="3497840">(</span><span class="ident" id="3497841">s</span><span class="op" id="3497842">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3497845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3497849">return</span>&nbsp;<span class="ident" id="3497856">nextRune</span><span class="op" id="3497864">(</span><span class="ident" id="3497865">s</span><span class="op" id="3497866">)</span><br>
<span class="lineno"></span><span class="op" id="3497868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="3497871">type</span>&nbsp;<span class="ident" id="3497876">charGroup</span>&nbsp;<span class="keyword" id="3497886">struct</span>&nbsp;<span class="op" id="3497893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497896">sign</span>&nbsp;&nbsp;<span class="builtintype" id="3497902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3497907">class</span>&nbsp;<span class="op" id="3497913">[</span><span class="op" id="3497914">]</span><span class="builtintype" id="3497915">rune</span><br>
<span class="lineno"></span><span class="op" id="3497920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="3497923">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="3498000">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3498079">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3498143">func</span>&nbsp;<span class="op" id="3498148">(</span><span class="ident" id="3498149">p</span>&nbsp;<span class="op" id="3498151">*</span><span class="ident" id="3498152">parser</span><span class="op" id="3498158">)</span>&nbsp;<span class="ident" id="3498160">parsePerlClassEscape</span><span class="op" id="3498180">(</span><span class="ident" id="3498181">s</span>&nbsp;<span class="builtintype" id="3498183">string</span><span class="op" id="3498189">,</span>&nbsp;<span class="ident" id="3498191">r</span>&nbsp;<span class="op" id="3498193">[</span><span class="op" id="3498194">]</span><span class="builtintype" id="3498195">rune</span><span class="op" id="3498199">)</span>&nbsp;<span class="op" id="3498201">(</span><span class="ident" id="3498202">out</span>&nbsp;<span class="op" id="3498206">[</span><span class="op" id="3498207">]</span><span class="builtintype" id="3498208">rune</span><span class="op" id="3498212">,</span>&nbsp;<span class="ident" id="3498214">rest</span>&nbsp;<span class="builtintype" id="3498219">string</span><span class="op" id="3498225">)</span>&nbsp;<span class="op" id="3498227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498230">if</span>&nbsp;<span class="ident" id="3498233">p</span><span class="op" id="3498234">.</span><span class="ident" id="3498235">flags</span><span class="op" id="3498240">&amp;</span><span class="ident" id="3498241">PerlX</span>&nbsp;<span class="op" id="3498247">==</span>&nbsp;<span class="num" id="3498250">0</span>&nbsp;<span class="op" id="3498252">||</span>&nbsp;<span class="builtinfunc" id="3498255">len</span><span class="op" id="3498258">(</span><span class="ident" id="3498259">s</span><span class="op" id="3498260">)</span>&nbsp;<span class="op" id="3498262">&lt;</span>&nbsp;<span class="num" id="3498264">2</span>&nbsp;<span class="op" id="3498266">||</span>&nbsp;<span class="ident" id="3498269">s</span><span class="op" id="3498270">[</span><span class="num" id="3498271">0</span><span class="op" id="3498272">]</span>&nbsp;<span class="op" id="3498274">!=</span>&nbsp;<span class="string" id="3498277">&#39;\\&#39;</span>&nbsp;<span class="op" id="3498282">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498286">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498297">g</span>&nbsp;<span class="op" id="3498299">:=</span>&nbsp;<span class="ident" id="3498302">perlGroup</span><span class="op" id="3498311">[</span><span class="ident" id="3498312">s</span><span class="op" id="3498313">[</span><span class="num" id="3498314">0</span><span class="op" id="3498315">:</span><span class="num" id="3498316">2</span><span class="op" id="3498317">]</span><span class="op" id="3498318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498321">if</span>&nbsp;<span class="ident" id="3498324">g</span><span class="op" id="3498325">.</span><span class="ident" id="3498326">sign</span>&nbsp;<span class="op" id="3498331">==</span>&nbsp;<span class="num" id="3498334">0</span>&nbsp;<span class="op" id="3498336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498340">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498351">return</span>&nbsp;<span class="ident" id="3498358">p</span><span class="op" id="3498359">.</span><span class="ident" id="3498360">appendGroup</span><span class="op" id="3498371">(</span><span class="ident" id="3498372">r</span><span class="op" id="3498373">,</span>&nbsp;<span class="ident" id="3498375">g</span><span class="op" id="3498376">)</span><span class="op" id="3498377">,</span>&nbsp;<span class="ident" id="3498379">s</span><span class="op" id="3498380">[</span><span class="num" id="3498381">2</span><span class="op" id="3498382">:</span><span class="op" id="3498383">]</span><br>
<span class="lineno"></span><span class="op" id="3498385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3498388">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="3498467">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3498546">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3498610">func</span>&nbsp;<span class="op" id="3498615">(</span><span class="ident" id="3498616">p</span>&nbsp;<span class="op" id="3498618">*</span><span class="ident" id="3498619">parser</span><span class="op" id="3498625">)</span>&nbsp;<span class="ident" id="3498627">parseNamedClass</span><span class="op" id="3498642">(</span><span class="ident" id="3498643">s</span>&nbsp;<span class="builtintype" id="3498645">string</span><span class="op" id="3498651">,</span>&nbsp;<span class="ident" id="3498653">r</span>&nbsp;<span class="op" id="3498655">[</span><span class="op" id="3498656">]</span><span class="builtintype" id="3498657">rune</span><span class="op" id="3498661">)</span>&nbsp;<span class="op" id="3498663">(</span><span class="ident" id="3498664">out</span>&nbsp;<span class="op" id="3498668">[</span><span class="op" id="3498669">]</span><span class="builtintype" id="3498670">rune</span><span class="op" id="3498674">,</span>&nbsp;<span class="ident" id="3498676">rest</span>&nbsp;<span class="builtintype" id="3498681">string</span><span class="op" id="3498687">,</span>&nbsp;<span class="ident" id="3498689">err</span>&nbsp;<span class="builtintype" id="3498693">error</span><span class="op" id="3498698">)</span>&nbsp;<span class="op" id="3498700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498703">if</span>&nbsp;<span class="builtinfunc" id="3498706">len</span><span class="op" id="3498709">(</span><span class="ident" id="3498710">s</span><span class="op" id="3498711">)</span>&nbsp;<span class="op" id="3498713">&lt;</span>&nbsp;<span class="num" id="3498715">2</span>&nbsp;<span class="op" id="3498717">||</span>&nbsp;<span class="ident" id="3498720">s</span><span class="op" id="3498721">[</span><span class="num" id="3498722">0</span><span class="op" id="3498723">]</span>&nbsp;<span class="op" id="3498725">!=</span>&nbsp;<span class="string" id="3498728">&#39;[&#39;</span>&nbsp;<span class="op" id="3498732">||</span>&nbsp;<span class="ident" id="3498735">s</span><span class="op" id="3498736">[</span><span class="num" id="3498737">1</span><span class="op" id="3498738">]</span>&nbsp;<span class="op" id="3498740">!=</span>&nbsp;<span class="string" id="3498743">&#39;:&#39;</span>&nbsp;<span class="op" id="3498747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498751">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498763">i</span>&nbsp;<span class="op" id="3498765">:=</span>&nbsp;<span class="ident" id="3498768">strings</span><span class="op" id="3498775">.</span><span class="ident" id="3498776">Index</span><span class="op" id="3498781">(</span><span class="ident" id="3498782">s</span><span class="op" id="3498783">[</span><span class="num" id="3498784">2</span><span class="op" id="3498785">:</span><span class="op" id="3498786">]</span><span class="op" id="3498787">,</span>&nbsp;<span class="string" id="3498789">&#34;:]&#34;</span><span class="op" id="3498793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498796">if</span>&nbsp;<span class="ident" id="3498799">i</span>&nbsp;<span class="op" id="3498801">&lt;</span>&nbsp;<span class="num" id="3498803">0</span>&nbsp;<span class="op" id="3498805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498809">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498820">i</span>&nbsp;<span class="op" id="3498822">+=</span>&nbsp;<span class="num" id="3498825">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498828">name</span><span class="op" id="3498832">,</span>&nbsp;<span class="ident" id="3498834">s</span>&nbsp;<span class="op" id="3498836">:=</span>&nbsp;<span class="ident" id="3498839">s</span><span class="op" id="3498840">[</span><span class="num" id="3498841">0</span><span class="op" id="3498842">:</span><span class="ident" id="3498843">i</span><span class="op" id="3498844">+</span><span class="num" id="3498845">2</span><span class="op" id="3498846">]</span><span class="op" id="3498847">,</span>&nbsp;<span class="ident" id="3498849">s</span><span class="op" id="3498850">[</span><span class="ident" id="3498851">i</span><span class="op" id="3498852">+</span><span class="num" id="3498853">2</span><span class="op" id="3498854">:</span><span class="op" id="3498855">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3498858">g</span>&nbsp;<span class="op" id="3498860">:=</span>&nbsp;<span class="ident" id="3498863">posixGroup</span><span class="op" id="3498873">[</span><span class="ident" id="3498874">name</span><span class="op" id="3498878">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498881">if</span>&nbsp;<span class="ident" id="3498884">g</span><span class="op" id="3498885">.</span><span class="ident" id="3498886">sign</span>&nbsp;<span class="op" id="3498891">==</span>&nbsp;<span class="num" id="3498894">0</span>&nbsp;<span class="op" id="3498896">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498900">return</span>&nbsp;<span class="builtintype" id="3498907">nil</span><span class="op" id="3498910">,</span>&nbsp;<span class="string" id="3498912">&#34;&#34;</span><span class="op" id="3498914">,</span>&nbsp;<span class="op" id="3498916">&amp;</span><span class="ident" id="3498917">Error</span><span class="op" id="3498922">{</span><span class="ident" id="3498923">ErrInvalidCharRange</span><span class="op" id="3498942">,</span>&nbsp;<span class="ident" id="3498944">name</span><span class="op" id="3498948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3498951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3498954">return</span>&nbsp;<span class="ident" id="3498961">p</span><span class="op" id="3498962">.</span><span class="ident" id="3498963">appendGroup</span><span class="op" id="3498974">(</span><span class="ident" id="3498975">r</span><span class="op" id="3498976">,</span>&nbsp;<span class="ident" id="3498978">g</span><span class="op" id="3498979">)</span><span class="op" id="3498980">,</span>&nbsp;<span class="ident" id="3498982">s</span><span class="op" id="3498983">,</span>&nbsp;<span class="builtintype" id="3498985">nil</span><br>
<span class="lineno"></span><span class="op" id="3498989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="3498992">func</span>&nbsp;<span class="op" id="3498997">(</span><span class="ident" id="3498998">p</span>&nbsp;<span class="op" id="3499000">*</span><span class="ident" id="3499001">parser</span><span class="op" id="3499007">)</span>&nbsp;<span class="ident" id="3499009">appendGroup</span><span class="op" id="3499020">(</span><span class="ident" id="3499021">r</span>&nbsp;<span class="op" id="3499023">[</span><span class="op" id="3499024">]</span><span class="builtintype" id="3499025">rune</span><span class="op" id="3499029">,</span>&nbsp;<span class="ident" id="3499031">g</span>&nbsp;<span class="ident" id="3499033">charGroup</span><span class="op" id="3499042">)</span>&nbsp;<span class="op" id="3499044">[</span><span class="op" id="3499045">]</span><span class="builtintype" id="3499046">rune</span>&nbsp;<span class="op" id="3499051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499054">if</span>&nbsp;<span class="ident" id="3499057">p</span><span class="op" id="3499058">.</span><span class="ident" id="3499059">flags</span><span class="op" id="3499064">&amp;</span><span class="ident" id="3499065">FoldCase</span>&nbsp;<span class="op" id="3499074">==</span>&nbsp;<span class="num" id="3499077">0</span>&nbsp;<span class="op" id="3499079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499083">if</span>&nbsp;<span class="ident" id="3499086">g</span><span class="op" id="3499087">.</span><span class="ident" id="3499088">sign</span>&nbsp;<span class="op" id="3499093">&lt;</span>&nbsp;<span class="num" id="3499095">0</span>&nbsp;<span class="op" id="3499097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499102">r</span>&nbsp;<span class="op" id="3499104">=</span>&nbsp;<span class="ident" id="3499106">appendNegatedClass</span><span class="op" id="3499124">(</span><span class="ident" id="3499125">r</span><span class="op" id="3499126">,</span>&nbsp;<span class="ident" id="3499128">g</span><span class="op" id="3499129">.</span><span class="ident" id="3499130">class</span><span class="op" id="3499135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499139">}</span>&nbsp;<span class="keyword" id="3499141">else</span>&nbsp;<span class="op" id="3499146">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499151">r</span>&nbsp;<span class="op" id="3499153">=</span>&nbsp;<span class="ident" id="3499155">appendClass</span><span class="op" id="3499166">(</span><span class="ident" id="3499167">r</span><span class="op" id="3499168">,</span>&nbsp;<span class="ident" id="3499170">g</span><span class="op" id="3499171">.</span><span class="ident" id="3499172">class</span><span class="op" id="3499177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499184">}</span>&nbsp;<span class="keyword" id="3499186">else</span>&nbsp;<span class="op" id="3499191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499195">tmp</span>&nbsp;<span class="op" id="3499199">:=</span>&nbsp;<span class="ident" id="3499202">p</span><span class="op" id="3499203">.</span><span class="ident" id="3499204">tmpClass</span><span class="op" id="3499212">[</span><span class="op" id="3499213">:</span><span class="num" id="3499214">0</span><span class="op" id="3499215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499219">tmp</span>&nbsp;<span class="op" id="3499223">=</span>&nbsp;<span class="ident" id="3499225">appendFoldedClass</span><span class="op" id="3499242">(</span><span class="ident" id="3499243">tmp</span><span class="op" id="3499246">,</span>&nbsp;<span class="ident" id="3499248">g</span><span class="op" id="3499249">.</span><span class="ident" id="3499250">class</span><span class="op" id="3499255">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499259">p</span><span class="op" id="3499260">.</span><span class="ident" id="3499261">tmpClass</span>&nbsp;<span class="op" id="3499270">=</span>&nbsp;<span class="ident" id="3499272">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499278">tmp</span>&nbsp;<span class="op" id="3499282">=</span>&nbsp;<span class="ident" id="3499284">cleanClass</span><span class="op" id="3499294">(</span><span class="op" id="3499295">&amp;</span><span class="ident" id="3499296">p</span><span class="op" id="3499297">.</span><span class="ident" id="3499298">tmpClass</span><span class="op" id="3499306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499310">if</span>&nbsp;<span class="ident" id="3499313">g</span><span class="op" id="3499314">.</span><span class="ident" id="3499315">sign</span>&nbsp;<span class="op" id="3499320">&lt;</span>&nbsp;<span class="num" id="3499322">0</span>&nbsp;<span class="op" id="3499324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499329">r</span>&nbsp;<span class="op" id="3499331">=</span>&nbsp;<span class="ident" id="3499333">appendNegatedClass</span><span class="op" id="3499351">(</span><span class="ident" id="3499352">r</span><span class="op" id="3499353">,</span>&nbsp;<span class="ident" id="3499355">tmp</span><span class="op" id="3499358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499362">}</span>&nbsp;<span class="keyword" id="3499364">else</span>&nbsp;<span class="op" id="3499369">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499374">r</span>&nbsp;<span class="op" id="3499376">=</span>&nbsp;<span class="ident" id="3499378">appendClass</span><span class="op" id="3499389">(</span><span class="ident" id="3499390">r</span><span class="op" id="3499391">,</span>&nbsp;<span class="ident" id="3499393">tmp</span><span class="op" id="3499396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499406">return</span>&nbsp;<span class="ident" id="3499413">r</span><br>
<span class="lineno"></span><span class="op" id="3499415">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="3499418">var</span>&nbsp;<span class="ident" id="3499422">anyTable</span>&nbsp;<span class="op" id="3499431">=</span>&nbsp;<span class="op" id="3499433">&amp;</span><span class="ident" id="3499434">unicode</span><span class="op" id="3499441">.</span><span class="ident" id="3499442">RangeTable</span><span class="op" id="3499452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499455">R16</span><span class="op" id="3499458">:</span>&nbsp;<span class="op" id="3499460">[</span><span class="op" id="3499461">]</span><span class="ident" id="3499462">unicode</span><span class="op" id="3499469">.</span><span class="ident" id="3499470">Range16</span><span class="op" id="3499477">{</span><span class="op" id="3499478">{</span><span class="ident" id="3499479">Lo</span><span class="op" id="3499481">:</span>&nbsp;<span class="num" id="3499483">0</span><span class="op" id="3499484">,</span>&nbsp;<span class="ident" id="3499486">Hi</span><span class="op" id="3499488">:</span>&nbsp;<span class="num" id="3499490">1</span><span class="op" id="3499491">&lt;&lt;</span><span class="num" id="3499493">16</span>&nbsp;<span class="op" id="3499496">-</span>&nbsp;<span class="num" id="3499498">1</span><span class="op" id="3499499">,</span>&nbsp;<span class="ident" id="3499501">Stride</span><span class="op" id="3499507">:</span>&nbsp;<span class="num" id="3499509">1</span><span class="op" id="3499510">}</span><span class="op" id="3499511">}</span><span class="op" id="3499512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3499515">R32</span><span class="op" id="3499518">:</span>&nbsp;<span class="op" id="3499520">[</span><span class="op" id="3499521">]</span><span class="ident" id="3499522">unicode</span><span class="op" id="3499529">.</span><span class="ident" id="3499530">Range32</span><span class="op" id="3499537">{</span><span class="op" id="3499538">{</span><span class="ident" id="3499539">Lo</span><span class="op" id="3499541">:</span>&nbsp;<span class="num" id="3499543">1</span>&nbsp;<span class="op" id="3499545">&lt;&lt;</span>&nbsp;<span class="num" id="3499548">16</span><span class="op" id="3499550">,</span>&nbsp;<span class="ident" id="3499552">Hi</span><span class="op" id="3499554">:</span>&nbsp;<span class="ident" id="3499556">unicode</span><span class="op" id="3499563">.</span><span class="ident" id="3499564">MaxRune</span><span class="op" id="3499571">,</span>&nbsp;<span class="ident" id="3499573">Stride</span><span class="op" id="3499579">:</span>&nbsp;<span class="num" id="3499581">1</span><span class="op" id="3499582">}</span><span class="op" id="3499583">}</span><span class="op" id="3499584">,</span><br>
<span class="lineno"></span><span class="op" id="3499586">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="3499589">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3499655">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="3499715">func</span>&nbsp;<span class="ident" id="3499720">unicodeTable</span><span class="op" id="3499732">(</span><span class="ident" id="3499733">name</span>&nbsp;<span class="builtintype" id="3499738">string</span><span class="op" id="3499744">)</span>&nbsp;<span class="op" id="3499746">(</span><span class="op" id="3499747">*</span><span class="ident" id="3499748">unicode</span><span class="op" id="3499755">.</span><span class="ident" id="3499756">RangeTable</span><span class="op" id="3499766">,</span>&nbsp;<span class="op" id="3499768">*</span><span class="ident" id="3499769">unicode</span><span class="op" id="3499776">.</span><span class="ident" id="3499777">RangeTable</span><span class="op" id="3499787">)</span>&nbsp;<span class="op" id="3499789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3499792">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499827">if</span>&nbsp;<span class="ident" id="3499830">name</span>&nbsp;<span class="op" id="3499835">==</span>&nbsp;<span class="string" id="3499838">&#34;Any&#34;</span>&nbsp;<span class="op" id="3499844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499848">return</span>&nbsp;<span class="ident" id="3499855">anyTable</span><span class="op" id="3499863">,</span>&nbsp;<span class="ident" id="3499865">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499878">if</span>&nbsp;<span class="ident" id="3499881">t</span>&nbsp;<span class="op" id="3499883">:=</span>&nbsp;<span class="ident" id="3499886">unicode</span><span class="op" id="3499893">.</span><span class="ident" id="3499894">Categories</span><span class="op" id="3499904">[</span><span class="ident" id="3499905">name</span><span class="op" id="3499909">]</span><span class="op" id="3499910">;</span>&nbsp;<span class="ident" id="3499912">t</span>&nbsp;<span class="op" id="3499914">!=</span>&nbsp;<span class="builtintype" id="3499917">nil</span>&nbsp;<span class="op" id="3499921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499925">return</span>&nbsp;<span class="ident" id="3499932">t</span><span class="op" id="3499933">,</span>&nbsp;<span class="ident" id="3499935">unicode</span><span class="op" id="3499942">.</span><span class="ident" id="3499943">FoldCategory</span><span class="op" id="3499955">[</span><span class="ident" id="3499956">name</span><span class="op" id="3499960">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3499963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3499966">if</span>&nbsp;<span class="ident" id="3499969">t</span>&nbsp;<span class="op" id="3499971">:=</span>&nbsp;<span class="ident" id="3499974">unicode</span><span class="op" id="3499981">.</span><span class="ident" id="3499982">Scripts</span><span class="op" id="3499989">[</span><span class="ident" id="3499990">name</span><span class="op" id="3499994">]</span><span class="op" id="3499995">;</span>&nbsp;<span class="ident" id="3499997">t</span>&nbsp;<span class="op" id="3499999">!=</span>&nbsp;<span class="builtintype" id="3500002">nil</span>&nbsp;<span class="op" id="3500006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500010">return</span>&nbsp;<span class="ident" id="3500017">t</span><span class="op" id="3500018">,</span>&nbsp;<span class="ident" id="3500020">unicode</span><span class="op" id="3500027">.</span><span class="ident" id="3500028">FoldScript</span><span class="op" id="3500038">[</span><span class="ident" id="3500039">name</span><span class="op" id="3500043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500049">return</span>&nbsp;<span class="builtintype" id="3500056">nil</span><span class="op" id="3500059">,</span>&nbsp;<span class="builtintype" id="3500061">nil</span><br>
<span class="lineno">1440</span><span class="op" id="3500065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3500068">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="3500143">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3500222">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="3500286">func</span>&nbsp;<span class="op" id="3500291">(</span><span class="ident" id="3500292">p</span>&nbsp;<span class="op" id="3500294">*</span><span class="ident" id="3500295">parser</span><span class="op" id="3500301">)</span>&nbsp;<span class="ident" id="3500303">parseUnicodeClass</span><span class="op" id="3500320">(</span><span class="ident" id="3500321">s</span>&nbsp;<span class="builtintype" id="3500323">string</span><span class="op" id="3500329">,</span>&nbsp;<span class="ident" id="3500331">r</span>&nbsp;<span class="op" id="3500333">[</span><span class="op" id="3500334">]</span><span class="builtintype" id="3500335">rune</span><span class="op" id="3500339">)</span>&nbsp;<span class="op" id="3500341">(</span><span class="ident" id="3500342">out</span>&nbsp;<span class="op" id="3500346">[</span><span class="op" id="3500347">]</span><span class="builtintype" id="3500348">rune</span><span class="op" id="3500352">,</span>&nbsp;<span class="ident" id="3500354">rest</span>&nbsp;<span class="builtintype" id="3500359">string</span><span class="op" id="3500365">,</span>&nbsp;<span class="ident" id="3500367">err</span>&nbsp;<span class="builtintype" id="3500371">error</span><span class="op" id="3500376">)</span>&nbsp;<span class="op" id="3500378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500381">if</span>&nbsp;<span class="ident" id="3500384">p</span><span class="op" id="3500385">.</span><span class="ident" id="3500386">flags</span><span class="op" id="3500391">&amp;</span><span class="ident" id="3500392">UnicodeGroups</span>&nbsp;<span class="op" id="3500406">==</span>&nbsp;<span class="num" id="3500409">0</span>&nbsp;<span class="op" id="3500411">||</span>&nbsp;<span class="builtinfunc" id="3500414">len</span><span class="op" id="3500417">(</span><span class="ident" id="3500418">s</span><span class="op" id="3500419">)</span>&nbsp;<span class="op" id="3500421">&lt;</span>&nbsp;<span class="num" id="3500423">2</span>&nbsp;<span class="op" id="3500425">||</span>&nbsp;<span class="ident" id="3500428">s</span><span class="op" id="3500429">[</span><span class="num" id="3500430">0</span><span class="op" id="3500431">]</span>&nbsp;<span class="op" id="3500433">!=</span>&nbsp;<span class="string" id="3500436">&#39;\\&#39;</span>&nbsp;<span class="op" id="3500441">||</span>&nbsp;<span class="ident" id="3500444">s</span><span class="op" id="3500445">[</span><span class="num" id="3500446">1</span><span class="op" id="3500447">]</span>&nbsp;<span class="op" id="3500449">!=</span>&nbsp;<span class="string" id="3500452">&#39;p&#39;</span>&nbsp;<span class="op" id="3500456">&amp;&amp;</span>&nbsp;<span class="ident" id="3500459">s</span><span class="op" id="3500460">[</span><span class="num" id="3500461">1</span><span class="op" id="3500462">]</span>&nbsp;<span class="op" id="3500464">!=</span>&nbsp;<span class="string" id="3500467">&#39;P&#39;</span>&nbsp;<span class="op" id="3500471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500475">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3500487">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500527">sign</span>&nbsp;<span class="op" id="3500532">:=</span>&nbsp;<span class="op" id="3500535">+</span><span class="num" id="3500536">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500539">if</span>&nbsp;<span class="ident" id="3500542">s</span><span class="op" id="3500543">[</span><span class="num" id="3500544">1</span><span class="op" id="3500545">]</span>&nbsp;<span class="op" id="3500547">==</span>&nbsp;<span class="string" id="3500550">&#39;P&#39;</span>&nbsp;<span class="op" id="3500554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500558">sign</span>&nbsp;<span class="op" id="3500563">=</span>&nbsp;<span class="op" id="3500565">-</span><span class="num" id="3500566">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500569">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500572">t</span>&nbsp;<span class="op" id="3500574">:=</span>&nbsp;<span class="ident" id="3500577">s</span><span class="op" id="3500578">[</span><span class="num" id="3500579">2</span><span class="op" id="3500580">:</span><span class="op" id="3500581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500584">c</span><span class="op" id="3500585">,</span>&nbsp;<span class="ident" id="3500587">t</span><span class="op" id="3500588">,</span>&nbsp;<span class="ident" id="3500590">err</span>&nbsp;<span class="op" id="3500594">:=</span>&nbsp;<span class="ident" id="3500597">nextRune</span><span class="op" id="3500605">(</span><span class="ident" id="3500606">t</span><span class="op" id="3500607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500610">if</span>&nbsp;<span class="ident" id="3500613">err</span>&nbsp;<span class="op" id="3500617">!=</span>&nbsp;<span class="builtintype" id="3500620">nil</span>&nbsp;<span class="op" id="3500624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500628">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500636">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500639">var</span>&nbsp;<span class="ident" id="3500643">seq</span><span class="op" id="3500646">,</span>&nbsp;<span class="ident" id="3500648">name</span>&nbsp;<span class="builtintype" id="3500653">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500661">if</span>&nbsp;<span class="ident" id="3500664">c</span>&nbsp;<span class="op" id="3500666">!=</span>&nbsp;<span class="string" id="3500669">&#39;{&#39;</span>&nbsp;<span class="op" id="3500673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3500677">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500702">seq</span>&nbsp;<span class="op" id="3500706">=</span>&nbsp;<span class="ident" id="3500708">s</span><span class="op" id="3500709">[</span><span class="op" id="3500710">:</span><span class="builtinfunc" id="3500711">len</span><span class="op" id="3500714">(</span><span class="ident" id="3500715">s</span><span class="op" id="3500716">)</span><span class="op" id="3500717">-</span><span class="builtinfunc" id="3500718">len</span><span class="op" id="3500721">(</span><span class="ident" id="3500722">t</span><span class="op" id="3500723">)</span><span class="op" id="3500724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500728">name</span>&nbsp;<span class="op" id="3500733">=</span>&nbsp;<span class="ident" id="3500735">seq</span><span class="op" id="3500738">[</span><span class="num" id="3500739">2</span><span class="op" id="3500740">:</span><span class="op" id="3500741">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500744">}</span>&nbsp;<span class="keyword" id="3500746">else</span>&nbsp;<span class="op" id="3500751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3500755">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500779">end</span>&nbsp;<span class="op" id="3500783">:=</span>&nbsp;<span class="ident" id="3500786">strings</span><span class="op" id="3500793">.</span><span class="ident" id="3500794">IndexRune</span><span class="op" id="3500803">(</span><span class="ident" id="3500804">s</span><span class="op" id="3500805">,</span>&nbsp;<span class="string" id="3500807">&#39;}&#39;</span><span class="op" id="3500810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500814">if</span>&nbsp;<span class="ident" id="3500817">end</span>&nbsp;<span class="op" id="3500821">&lt;</span>&nbsp;<span class="num" id="3500823">0</span>&nbsp;<span class="op" id="3500825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500830">if</span>&nbsp;<span class="ident" id="3500833">err</span>&nbsp;<span class="op" id="3500837">=</span>&nbsp;<span class="ident" id="3500839">checkUTF8</span><span class="op" id="3500848">(</span><span class="ident" id="3500849">s</span><span class="op" id="3500850">)</span><span class="op" id="3500851">;</span>&nbsp;<span class="ident" id="3500853">err</span>&nbsp;<span class="op" id="3500857">!=</span>&nbsp;<span class="builtintype" id="3500860">nil</span>&nbsp;<span class="op" id="3500864">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500870">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500885">return</span>&nbsp;<span class="builtintype" id="3500892">nil</span><span class="op" id="3500895">,</span>&nbsp;<span class="string" id="3500897">&#34;&#34;</span><span class="op" id="3500899">,</span>&nbsp;<span class="op" id="3500901">&amp;</span><span class="ident" id="3500902">Error</span><span class="op" id="3500907">{</span><span class="ident" id="3500908">ErrInvalidCharRange</span><span class="op" id="3500927">,</span>&nbsp;<span class="ident" id="3500929">s</span><span class="op" id="3500930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3500934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500938">seq</span><span class="op" id="3500941">,</span>&nbsp;<span class="ident" id="3500943">t</span>&nbsp;<span class="op" id="3500945">=</span>&nbsp;<span class="ident" id="3500947">s</span><span class="op" id="3500948">[</span><span class="op" id="3500949">:</span><span class="ident" id="3500950">end</span><span class="op" id="3500953">+</span><span class="num" id="3500954">1</span><span class="op" id="3500955">]</span><span class="op" id="3500956">,</span>&nbsp;<span class="ident" id="3500958">s</span><span class="op" id="3500959">[</span><span class="ident" id="3500960">end</span><span class="op" id="3500963">+</span><span class="num" id="3500964">1</span><span class="op" id="3500965">:</span><span class="op" id="3500966">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3500970">name</span>&nbsp;<span class="op" id="3500975">=</span>&nbsp;<span class="ident" id="3500977">s</span><span class="op" id="3500978">[</span><span class="num" id="3500979">3</span><span class="op" id="3500980">:</span><span class="ident" id="3500981">end</span><span class="op" id="3500984">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3500988">if</span>&nbsp;<span class="ident" id="3500991">err</span>&nbsp;<span class="op" id="3500995">=</span>&nbsp;<span class="ident" id="3500997">checkUTF8</span><span class="op" id="3501006">(</span><span class="ident" id="3501007">name</span><span class="op" id="3501011">)</span><span class="op" id="3501012">;</span>&nbsp;<span class="ident" id="3501014">err</span>&nbsp;<span class="op" id="3501018">!=</span>&nbsp;<span class="builtintype" id="3501021">nil</span>&nbsp;<span class="op" id="3501025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501030">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501042">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3501046">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501130">if</span>&nbsp;<span class="ident" id="3501133">name</span>&nbsp;<span class="op" id="3501138">!=</span>&nbsp;<span class="string" id="3501141">&#34;&#34;</span>&nbsp;<span class="op" id="3501144">&amp;&amp;</span>&nbsp;<span class="ident" id="3501147">name</span><span class="op" id="3501151">[</span><span class="num" id="3501152">0</span><span class="op" id="3501153">]</span>&nbsp;<span class="op" id="3501155">==</span>&nbsp;<span class="string" id="3501158">&#39;^&#39;</span>&nbsp;<span class="op" id="3501162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501166">sign</span>&nbsp;<span class="op" id="3501171">=</span>&nbsp;<span class="op" id="3501173">-</span><span class="ident" id="3501174">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501181">name</span>&nbsp;<span class="op" id="3501186">=</span>&nbsp;<span class="ident" id="3501188">name</span><span class="op" id="3501192">[</span><span class="num" id="3501193">1</span><span class="op" id="3501194">:</span><span class="op" id="3501195">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501202">tab</span><span class="op" id="3501205">,</span>&nbsp;<span class="ident" id="3501207">fold</span>&nbsp;<span class="op" id="3501212">:=</span>&nbsp;<span class="ident" id="3501215">unicodeTable</span><span class="op" id="3501227">(</span><span class="ident" id="3501228">name</span><span class="op" id="3501232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501235">if</span>&nbsp;<span class="ident" id="3501238">tab</span>&nbsp;<span class="op" id="3501242">==</span>&nbsp;<span class="builtintype" id="3501245">nil</span>&nbsp;<span class="op" id="3501249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501253">return</span>&nbsp;<span class="builtintype" id="3501260">nil</span><span class="op" id="3501263">,</span>&nbsp;<span class="string" id="3501265">&#34;&#34;</span><span class="op" id="3501267">,</span>&nbsp;<span class="op" id="3501269">&amp;</span><span class="ident" id="3501270">Error</span><span class="op" id="3501275">{</span><span class="ident" id="3501276">ErrInvalidCharRange</span><span class="op" id="3501295">,</span>&nbsp;<span class="ident" id="3501297">seq</span><span class="op" id="3501300">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501307">if</span>&nbsp;<span class="ident" id="3501310">p</span><span class="op" id="3501311">.</span><span class="ident" id="3501312">flags</span><span class="op" id="3501317">&amp;</span><span class="ident" id="3501318">FoldCase</span>&nbsp;<span class="op" id="3501327">==</span>&nbsp;<span class="num" id="3501330">0</span>&nbsp;<span class="op" id="3501332">||</span>&nbsp;<span class="ident" id="3501335">fold</span>&nbsp;<span class="op" id="3501340">==</span>&nbsp;<span class="builtintype" id="3501343">nil</span>&nbsp;<span class="op" id="3501347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501351">if</span>&nbsp;<span class="ident" id="3501354">sign</span>&nbsp;<span class="op" id="3501359">&gt;</span>&nbsp;<span class="num" id="3501361">0</span>&nbsp;<span class="op" id="3501363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501368">r</span>&nbsp;<span class="op" id="3501370">=</span>&nbsp;<span class="ident" id="3501372">appendTable</span><span class="op" id="3501383">(</span><span class="ident" id="3501384">r</span><span class="op" id="3501385">,</span>&nbsp;<span class="ident" id="3501387">tab</span><span class="op" id="3501390">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501394">}</span>&nbsp;<span class="keyword" id="3501396">else</span>&nbsp;<span class="op" id="3501401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501406">r</span>&nbsp;<span class="op" id="3501408">=</span>&nbsp;<span class="ident" id="3501410">appendNegatedTable</span><span class="op" id="3501428">(</span><span class="ident" id="3501429">r</span><span class="op" id="3501430">,</span>&nbsp;<span class="ident" id="3501432">tab</span><span class="op" id="3501435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501442">}</span>&nbsp;<span class="keyword" id="3501444">else</span>&nbsp;<span class="op" id="3501449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3501453">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3501510">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3501569">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501597">tmp</span>&nbsp;<span class="op" id="3501601">:=</span>&nbsp;<span class="ident" id="3501604">p</span><span class="op" id="3501605">.</span><span class="ident" id="3501606">tmpClass</span><span class="op" id="3501614">[</span><span class="op" id="3501615">:</span><span class="num" id="3501616">0</span><span class="op" id="3501617">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501621">tmp</span>&nbsp;<span class="op" id="3501625">=</span>&nbsp;<span class="ident" id="3501627">appendTable</span><span class="op" id="3501638">(</span><span class="ident" id="3501639">tmp</span><span class="op" id="3501642">,</span>&nbsp;<span class="ident" id="3501644">tab</span><span class="op" id="3501647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501651">tmp</span>&nbsp;<span class="op" id="3501655">=</span>&nbsp;<span class="ident" id="3501657">appendTable</span><span class="op" id="3501668">(</span><span class="ident" id="3501669">tmp</span><span class="op" id="3501672">,</span>&nbsp;<span class="ident" id="3501674">fold</span><span class="op" id="3501678">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501682">p</span><span class="op" id="3501683">.</span><span class="ident" id="3501684">tmpClass</span>&nbsp;<span class="op" id="3501693">=</span>&nbsp;<span class="ident" id="3501695">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501701">tmp</span>&nbsp;<span class="op" id="3501705">=</span>&nbsp;<span class="ident" id="3501707">cleanClass</span><span class="op" id="3501717">(</span><span class="op" id="3501718">&amp;</span><span class="ident" id="3501719">p</span><span class="op" id="3501720">.</span><span class="ident" id="3501721">tmpClass</span><span class="op" id="3501729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501733">if</span>&nbsp;<span class="ident" id="3501736">sign</span>&nbsp;<span class="op" id="3501741">&gt;</span>&nbsp;<span class="num" id="3501743">0</span>&nbsp;<span class="op" id="3501745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501750">r</span>&nbsp;<span class="op" id="3501752">=</span>&nbsp;<span class="ident" id="3501754">appendClass</span><span class="op" id="3501765">(</span><span class="ident" id="3501766">r</span><span class="op" id="3501767">,</span>&nbsp;<span class="ident" id="3501769">tmp</span><span class="op" id="3501772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501776">}</span>&nbsp;<span class="keyword" id="3501778">else</span>&nbsp;<span class="op" id="3501783">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3501788">r</span>&nbsp;<span class="op" id="3501790">=</span>&nbsp;<span class="ident" id="3501792">appendNegatedClass</span><span class="op" id="3501810">(</span><span class="ident" id="3501811">r</span><span class="op" id="3501812">,</span>&nbsp;<span class="ident" id="3501814">tmp</span><span class="op" id="3501817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3501824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3501827">return</span>&nbsp;<span class="ident" id="3501834">r</span><span class="op" id="3501835">,</span>&nbsp;<span class="ident" id="3501837">t</span><span class="op" id="3501838">,</span>&nbsp;<span class="builtintype" id="3501840">nil</span><br>
<span class="lineno"></span><span class="op" id="3501844">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="3501847">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3501908">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="3501947">func</span>&nbsp;<span class="op" id="3501952">(</span><span class="ident" id="3501953">p</span>&nbsp;<span class="op" id="3501955">*</span><span class="ident" id="3501956">parser</span><span class="op" id="3501962">)</span>&nbsp;<span class="ident" id="3501964">parseClass</span><span class="op" id="3501974">(</span><span class="ident" id="3501975">s</span>&nbsp;<span class="builtintype" id="3501977">string</span><span class="op" id="3501983">)</span>&nbsp;<span class="op" id="3501985">(</span><span class="ident" id="3501986">rest</span>&nbsp;<span class="builtintype" id="3501991">string</span><span class="op" id="3501997">,</span>&nbsp;<span class="ident" id="3501999">err</span>&nbsp;<span class="builtintype" id="3502003">error</span><span class="op" id="3502008">)</span>&nbsp;<span class="op" id="3502010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502013">t</span>&nbsp;<span class="op" id="3502015">:=</span>&nbsp;<span class="ident" id="3502018">s</span><span class="op" id="3502019">[</span><span class="num" id="3502020">1</span><span class="op" id="3502021">:</span><span class="op" id="3502022">]</span>&nbsp;<span class="comment" id="3502024">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502035">re</span>&nbsp;<span class="op" id="3502038">:=</span>&nbsp;<span class="ident" id="3502041">p</span><span class="op" id="3502042">.</span><span class="ident" id="3502043">newRegexp</span><span class="op" id="3502052">(</span><span class="ident" id="3502053">OpCharClass</span><span class="op" id="3502064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502067">re</span><span class="op" id="3502069">.</span><span class="ident" id="3502070">Flags</span>&nbsp;<span class="op" id="3502076">=</span>&nbsp;<span class="ident" id="3502078">p</span><span class="op" id="3502079">.</span><span class="ident" id="3502080">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502087">re</span><span class="op" id="3502089">.</span><span class="ident" id="3502090">Rune</span>&nbsp;<span class="op" id="3502095">=</span>&nbsp;<span class="ident" id="3502097">re</span><span class="op" id="3502099">.</span><span class="ident" id="3502100">Rune0</span><span class="op" id="3502105">[</span><span class="op" id="3502106">:</span><span class="num" id="3502107">0</span><span class="op" id="3502108">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502112">sign</span>&nbsp;<span class="op" id="3502117">:=</span>&nbsp;<span class="op" id="3502120">+</span><span class="num" id="3502121">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502124">if</span>&nbsp;<span class="ident" id="3502127">t</span>&nbsp;<span class="op" id="3502129">!=</span>&nbsp;<span class="string" id="3502132">&#34;&#34;</span>&nbsp;<span class="op" id="3502135">&amp;&amp;</span>&nbsp;<span class="ident" id="3502138">t</span><span class="op" id="3502139">[</span><span class="num" id="3502140">0</span><span class="op" id="3502141">]</span>&nbsp;<span class="op" id="3502143">==</span>&nbsp;<span class="string" id="3502146">&#39;^&#39;</span>&nbsp;<span class="op" id="3502150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502154">sign</span>&nbsp;<span class="op" id="3502159">=</span>&nbsp;<span class="op" id="3502161">-</span><span class="num" id="3502162">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502166">t</span>&nbsp;<span class="op" id="3502168">=</span>&nbsp;<span class="ident" id="3502170">t</span><span class="op" id="3502171">[</span><span class="num" id="3502172">1</span><span class="op" id="3502173">:</span><span class="op" id="3502174">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502179">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502235">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502288">if</span>&nbsp;<span class="ident" id="3502291">p</span><span class="op" id="3502292">.</span><span class="ident" id="3502293">flags</span><span class="op" id="3502298">&amp;</span><span class="ident" id="3502299">ClassNL</span>&nbsp;<span class="op" id="3502307">==</span>&nbsp;<span class="num" id="3502310">0</span>&nbsp;<span class="op" id="3502312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502317">re</span><span class="op" id="3502319">.</span><span class="ident" id="3502320">Rune</span>&nbsp;<span class="op" id="3502325">=</span>&nbsp;<span class="builtinfunc" id="3502327">append</span><span class="op" id="3502333">(</span><span class="ident" id="3502334">re</span><span class="op" id="3502336">.</span><span class="ident" id="3502337">Rune</span><span class="op" id="3502341">,</span>&nbsp;<span class="string" id="3502343">&#39;\n&#39;</span><span class="op" id="3502347">,</span>&nbsp;<span class="string" id="3502349">&#39;\n&#39;</span><span class="op" id="3502353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502360">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502364">class</span>&nbsp;<span class="op" id="3502370">:=</span>&nbsp;<span class="ident" id="3502373">re</span><span class="op" id="3502375">.</span><span class="ident" id="3502376">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502382">first</span>&nbsp;<span class="op" id="3502388">:=</span>&nbsp;<span class="builtintype" id="3502391">true</span>&nbsp;<span class="comment" id="3502396">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502440">for</span>&nbsp;<span class="ident" id="3502444">t</span>&nbsp;<span class="op" id="3502446">==</span>&nbsp;<span class="string" id="3502449">&#34;&#34;</span>&nbsp;<span class="op" id="3502452">||</span>&nbsp;<span class="ident" id="3502455">t</span><span class="op" id="3502456">[</span><span class="num" id="3502457">0</span><span class="op" id="3502458">]</span>&nbsp;<span class="op" id="3502460">!=</span>&nbsp;<span class="string" id="3502463">&#39;]&#39;</span>&nbsp;<span class="op" id="3502467">||</span>&nbsp;<span class="ident" id="3502470">first</span>&nbsp;<span class="op" id="3502476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502480">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502544">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502575">if</span>&nbsp;<span class="ident" id="3502578">t</span>&nbsp;<span class="op" id="3502580">!=</span>&nbsp;<span class="string" id="3502583">&#34;&#34;</span>&nbsp;<span class="op" id="3502586">&amp;&amp;</span>&nbsp;<span class="ident" id="3502589">t</span><span class="op" id="3502590">[</span><span class="num" id="3502591">0</span><span class="op" id="3502592">]</span>&nbsp;<span class="op" id="3502594">==</span>&nbsp;<span class="string" id="3502597">&#39;-&#39;</span>&nbsp;<span class="op" id="3502601">&amp;&amp;</span>&nbsp;<span class="ident" id="3502604">p</span><span class="op" id="3502605">.</span><span class="ident" id="3502606">flags</span><span class="op" id="3502611">&amp;</span><span class="ident" id="3502612">PerlX</span>&nbsp;<span class="op" id="3502618">==</span>&nbsp;<span class="num" id="3502621">0</span>&nbsp;<span class="op" id="3502623">&amp;&amp;</span>&nbsp;<span class="op" id="3502626">!</span><span class="ident" id="3502627">first</span>&nbsp;<span class="op" id="3502633">&amp;&amp;</span>&nbsp;<span class="op" id="3502636">(</span><span class="builtinfunc" id="3502637">len</span><span class="op" id="3502640">(</span><span class="ident" id="3502641">t</span><span class="op" id="3502642">)</span>&nbsp;<span class="op" id="3502644">==</span>&nbsp;<span class="num" id="3502647">1</span>&nbsp;<span class="op" id="3502649">||</span>&nbsp;<span class="ident" id="3502652">t</span><span class="op" id="3502653">[</span><span class="num" id="3502654">1</span><span class="op" id="3502655">]</span>&nbsp;<span class="op" id="3502657">!=</span>&nbsp;<span class="string" id="3502660">&#39;]&#39;</span><span class="op" id="3502663">)</span>&nbsp;<span class="op" id="3502665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502670">_</span><span class="op" id="3502671">,</span>&nbsp;<span class="ident" id="3502673">size</span>&nbsp;<span class="op" id="3502678">:=</span>&nbsp;<span class="ident" id="3502681">utf8</span><span class="op" id="3502685">.</span><span class="ident" id="3502686">DecodeRuneInString</span><span class="op" id="3502704">(</span><span class="ident" id="3502705">t</span><span class="op" id="3502706">[</span><span class="num" id="3502707">1</span><span class="op" id="3502708">:</span><span class="op" id="3502709">]</span><span class="op" id="3502710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502715">return</span>&nbsp;<span class="string" id="3502722">&#34;&#34;</span><span class="op" id="3502724">,</span>&nbsp;<span class="op" id="3502726">&amp;</span><span class="ident" id="3502727">Error</span><span class="op" id="3502732">{</span><span class="ident" id="3502733">Code</span><span class="op" id="3502737">:</span>&nbsp;<span class="ident" id="3502739">ErrInvalidCharRange</span><span class="op" id="3502758">,</span>&nbsp;<span class="ident" id="3502760">Expr</span><span class="op" id="3502764">:</span>&nbsp;<span class="ident" id="3502766">t</span><span class="op" id="3502767">[</span><span class="op" id="3502768">:</span><span class="num" id="3502769">1</span><span class="op" id="3502770">+</span><span class="ident" id="3502771">size</span><span class="op" id="3502775">]</span><span class="op" id="3502776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502780">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502784">first</span>&nbsp;<span class="op" id="3502790">=</span>&nbsp;<span class="builtintype" id="3502792">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3502801">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502836">if</span>&nbsp;<span class="builtinfunc" id="3502839">len</span><span class="op" id="3502842">(</span><span class="ident" id="3502843">t</span><span class="op" id="3502844">)</span>&nbsp;<span class="op" id="3502846">&gt;</span>&nbsp;<span class="num" id="3502848">2</span>&nbsp;<span class="op" id="3502850">&amp;&amp;</span>&nbsp;<span class="ident" id="3502853">t</span><span class="op" id="3502854">[</span><span class="num" id="3502855">0</span><span class="op" id="3502856">]</span>&nbsp;<span class="op" id="3502858">==</span>&nbsp;<span class="string" id="3502861">&#39;[&#39;</span>&nbsp;<span class="op" id="3502865">&amp;&amp;</span>&nbsp;<span class="ident" id="3502868">t</span><span class="op" id="3502869">[</span><span class="num" id="3502870">1</span><span class="op" id="3502871">]</span>&nbsp;<span class="op" id="3502873">==</span>&nbsp;<span class="string" id="3502876">&#39;:&#39;</span>&nbsp;<span class="op" id="3502880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3502885">nclass</span><span class="op" id="3502891">,</span>&nbsp;<span class="ident" id="3502893">nt</span><span class="op" id="3502895">,</span>&nbsp;<span class="ident" id="3502897">err</span>&nbsp;<span class="op" id="3502901">:=</span>&nbsp;<span class="ident" id="3502904">p</span><span class="op" id="3502905">.</span><span class="ident" id="3502906">parseNamedClass</span><span class="op" id="3502921">(</span><span class="ident" id="3502922">t</span><span class="op" id="3502923">,</span>&nbsp;<span class="ident" id="3502925">class</span><span class="op" id="3502930">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502935">if</span>&nbsp;<span class="ident" id="3502938">err</span>&nbsp;<span class="op" id="3502942">!=</span>&nbsp;<span class="builtintype" id="3502945">nil</span>&nbsp;<span class="op" id="3502949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502955">return</span>&nbsp;<span class="string" id="3502962">&#34;&#34;</span><span class="op" id="3502964">,</span>&nbsp;<span class="ident" id="3502966">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3502973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3502978">if</span>&nbsp;<span class="ident" id="3502981">nclass</span>&nbsp;<span class="op" id="3502988">!=</span>&nbsp;<span class="builtintype" id="3502991">nil</span>&nbsp;<span class="op" id="3502995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503001">class</span><span class="op" id="3503006">,</span>&nbsp;<span class="ident" id="3503008">t</span>&nbsp;<span class="op" id="3503010">=</span>&nbsp;<span class="ident" id="3503012">nclass</span><span class="op" id="3503018">,</span>&nbsp;<span class="ident" id="3503020">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503027">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503048">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503100">nclass</span><span class="op" id="3503106">,</span>&nbsp;<span class="ident" id="3503108">nt</span><span class="op" id="3503110">,</span>&nbsp;<span class="ident" id="3503112">err</span>&nbsp;<span class="op" id="3503116">:=</span>&nbsp;<span class="ident" id="3503119">p</span><span class="op" id="3503120">.</span><span class="ident" id="3503121">parseUnicodeClass</span><span class="op" id="3503138">(</span><span class="ident" id="3503139">t</span><span class="op" id="3503140">,</span>&nbsp;<span class="ident" id="3503142">class</span><span class="op" id="3503147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503151">if</span>&nbsp;<span class="ident" id="3503154">err</span>&nbsp;<span class="op" id="3503158">!=</span>&nbsp;<span class="builtintype" id="3503161">nil</span>&nbsp;<span class="op" id="3503165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503170">return</span>&nbsp;<span class="string" id="3503177">&#34;&#34;</span><span class="op" id="3503179">,</span>&nbsp;<span class="ident" id="3503181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503191">if</span>&nbsp;<span class="ident" id="3503194">nclass</span>&nbsp;<span class="op" id="3503201">!=</span>&nbsp;<span class="builtintype" id="3503204">nil</span>&nbsp;<span class="op" id="3503208">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503213">class</span><span class="op" id="3503218">,</span>&nbsp;<span class="ident" id="3503220">t</span>&nbsp;<span class="op" id="3503222">=</span>&nbsp;<span class="ident" id="3503224">nclass</span><span class="op" id="3503230">,</span>&nbsp;<span class="ident" id="3503232">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503238">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503254">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503310">if</span>&nbsp;<span class="ident" id="3503313">nclass</span><span class="op" id="3503319">,</span>&nbsp;<span class="ident" id="3503321">nt</span>&nbsp;<span class="op" id="3503324">:=</span>&nbsp;<span class="ident" id="3503327">p</span><span class="op" id="3503328">.</span><span class="ident" id="3503329">parsePerlClassEscape</span><span class="op" id="3503349">(</span><span class="ident" id="3503350">t</span><span class="op" id="3503351">,</span>&nbsp;<span class="ident" id="3503353">class</span><span class="op" id="3503358">)</span><span class="op" id="3503359">;</span>&nbsp;<span class="ident" id="3503361">nclass</span>&nbsp;<span class="op" id="3503368">!=</span>&nbsp;<span class="builtintype" id="3503371">nil</span>&nbsp;<span class="op" id="3503375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503380">class</span><span class="op" id="3503385">,</span>&nbsp;<span class="ident" id="3503387">t</span>&nbsp;<span class="op" id="3503389">=</span>&nbsp;<span class="ident" id="3503391">nclass</span><span class="op" id="3503397">,</span>&nbsp;<span class="ident" id="3503399">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503405">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503421">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503460">rng</span>&nbsp;<span class="op" id="3503464">:=</span>&nbsp;<span class="ident" id="3503467">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503471">var</span>&nbsp;<span class="ident" id="3503475">lo</span><span class="op" id="3503477">,</span>&nbsp;<span class="ident" id="3503479">hi</span>&nbsp;<span class="builtintype" id="3503482">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503489">if</span>&nbsp;<span class="ident" id="3503492">lo</span><span class="op" id="3503494">,</span>&nbsp;<span class="ident" id="3503496">t</span><span class="op" id="3503497">,</span>&nbsp;<span class="ident" id="3503499">err</span>&nbsp;<span class="op" id="3503503">=</span>&nbsp;<span class="ident" id="3503505">p</span><span class="op" id="3503506">.</span><span class="ident" id="3503507">parseClassChar</span><span class="op" id="3503521">(</span><span class="ident" id="3503522">t</span><span class="op" id="3503523">,</span>&nbsp;<span class="ident" id="3503525">s</span><span class="op" id="3503526">)</span><span class="op" id="3503527">;</span>&nbsp;<span class="ident" id="3503529">err</span>&nbsp;<span class="op" id="3503533">!=</span>&nbsp;<span class="builtintype" id="3503536">nil</span>&nbsp;<span class="op" id="3503540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503545">return</span>&nbsp;<span class="string" id="3503552">&#34;&#34;</span><span class="op" id="3503554">,</span>&nbsp;<span class="ident" id="3503556">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503566">hi</span>&nbsp;<span class="op" id="3503569">=</span>&nbsp;<span class="ident" id="3503571">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3503576">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503620">if</span>&nbsp;<span class="builtinfunc" id="3503623">len</span><span class="op" id="3503626">(</span><span class="ident" id="3503627">t</span><span class="op" id="3503628">)</span>&nbsp;<span class="op" id="3503630">&gt;=</span>&nbsp;<span class="num" id="3503633">2</span>&nbsp;<span class="op" id="3503635">&amp;&amp;</span>&nbsp;<span class="ident" id="3503638">t</span><span class="op" id="3503639">[</span><span class="num" id="3503640">0</span><span class="op" id="3503641">]</span>&nbsp;<span class="op" id="3503643">==</span>&nbsp;<span class="string" id="3503646">&#39;-&#39;</span>&nbsp;<span class="op" id="3503650">&amp;&amp;</span>&nbsp;<span class="ident" id="3503653">t</span><span class="op" id="3503654">[</span><span class="num" id="3503655">1</span><span class="op" id="3503656">]</span>&nbsp;<span class="op" id="3503658">!=</span>&nbsp;<span class="string" id="3503661">&#39;]&#39;</span>&nbsp;<span class="op" id="3503665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503670">t</span>&nbsp;<span class="op" id="3503672">=</span>&nbsp;<span class="ident" id="3503674">t</span><span class="op" id="3503675">[</span><span class="num" id="3503676">1</span><span class="op" id="3503677">:</span><span class="op" id="3503678">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503683">if</span>&nbsp;<span class="ident" id="3503686">hi</span><span class="op" id="3503688">,</span>&nbsp;<span class="ident" id="3503690">t</span><span class="op" id="3503691">,</span>&nbsp;<span class="ident" id="3503693">err</span>&nbsp;<span class="op" id="3503697">=</span>&nbsp;<span class="ident" id="3503699">p</span><span class="op" id="3503700">.</span><span class="ident" id="3503701">parseClassChar</span><span class="op" id="3503715">(</span><span class="ident" id="3503716">t</span><span class="op" id="3503717">,</span>&nbsp;<span class="ident" id="3503719">s</span><span class="op" id="3503720">)</span><span class="op" id="3503721">;</span>&nbsp;<span class="ident" id="3503723">err</span>&nbsp;<span class="op" id="3503727">!=</span>&nbsp;<span class="builtintype" id="3503730">nil</span>&nbsp;<span class="op" id="3503734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503740">return</span>&nbsp;<span class="string" id="3503747">&#34;&#34;</span><span class="op" id="3503749">,</span>&nbsp;<span class="ident" id="3503751">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503763">if</span>&nbsp;<span class="ident" id="3503766">hi</span>&nbsp;<span class="op" id="3503769">&lt;</span>&nbsp;<span class="ident" id="3503771">lo</span>&nbsp;<span class="op" id="3503774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503780">rng</span>&nbsp;<span class="op" id="3503784">=</span>&nbsp;<span class="ident" id="3503786">rng</span><span class="op" id="3503789">[</span><span class="op" id="3503790">:</span><span class="builtinfunc" id="3503791">len</span><span class="op" id="3503794">(</span><span class="ident" id="3503795">rng</span><span class="op" id="3503798">)</span><span class="op" id="3503799">-</span><span class="builtinfunc" id="3503800">len</span><span class="op" id="3503803">(</span><span class="ident" id="3503804">t</span><span class="op" id="3503805">)</span><span class="op" id="3503806">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503812">return</span>&nbsp;<span class="string" id="3503819">&#34;&#34;</span><span class="op" id="3503821">,</span>&nbsp;<span class="op" id="3503823">&amp;</span><span class="ident" id="3503824">Error</span><span class="op" id="3503829">{</span><span class="ident" id="3503830">Code</span><span class="op" id="3503834">:</span>&nbsp;<span class="ident" id="3503836">ErrInvalidCharRange</span><span class="op" id="3503855">,</span>&nbsp;<span class="ident" id="3503857">Expr</span><span class="op" id="3503861">:</span>&nbsp;<span class="ident" id="3503863">rng</span><span class="op" id="3503866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3503879">if</span>&nbsp;<span class="ident" id="3503882">p</span><span class="op" id="3503883">.</span><span class="ident" id="3503884">flags</span><span class="op" id="3503889">&amp;</span><span class="ident" id="3503890">FoldCase</span>&nbsp;<span class="op" id="3503899">==</span>&nbsp;<span class="num" id="3503902">0</span>&nbsp;<span class="op" id="3503904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503909">class</span>&nbsp;<span class="op" id="3503915">=</span>&nbsp;<span class="ident" id="3503917">appendRange</span><span class="op" id="3503928">(</span><span class="ident" id="3503929">class</span><span class="op" id="3503934">,</span>&nbsp;<span class="ident" id="3503936">lo</span><span class="op" id="3503938">,</span>&nbsp;<span class="ident" id="3503940">hi</span><span class="op" id="3503942">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3503946">}</span>&nbsp;<span class="keyword" id="3503948">else</span>&nbsp;<span class="op" id="3503953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3503958">class</span>&nbsp;<span class="op" id="3503964">=</span>&nbsp;<span class="ident" id="3503966">appendFoldedRange</span><span class="op" id="3503983">(</span><span class="ident" id="3503984">class</span><span class="op" id="3503989">,</span>&nbsp;<span class="ident" id="3503991">lo</span><span class="op" id="3503993">,</span>&nbsp;<span class="ident" id="3503995">hi</span><span class="op" id="3503997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504007">t</span>&nbsp;<span class="op" id="3504009">=</span>&nbsp;<span class="ident" id="3504011">t</span><span class="op" id="3504012">[</span><span class="num" id="3504013">1</span><span class="op" id="3504014">:</span><span class="op" id="3504015">]</span>&nbsp;<span class="comment" id="3504017">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504029">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504085">re</span><span class="op" id="3504087">.</span><span class="ident" id="3504088">Rune</span>&nbsp;<span class="op" id="3504093">=</span>&nbsp;<span class="ident" id="3504095">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504102">class</span>&nbsp;<span class="op" id="3504108">=</span>&nbsp;<span class="ident" id="3504110">cleanClass</span><span class="op" id="3504120">(</span><span class="op" id="3504121">&amp;</span><span class="ident" id="3504122">re</span><span class="op" id="3504124">.</span><span class="ident" id="3504125">Rune</span><span class="op" id="3504129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504132">if</span>&nbsp;<span class="ident" id="3504135">sign</span>&nbsp;<span class="op" id="3504140">&lt;</span>&nbsp;<span class="num" id="3504142">0</span>&nbsp;<span class="op" id="3504144">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504148">class</span>&nbsp;<span class="op" id="3504154">=</span>&nbsp;<span class="ident" id="3504156">negateClass</span><span class="op" id="3504167">(</span><span class="ident" id="3504168">class</span><span class="op" id="3504173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504179">re</span><span class="op" id="3504181">.</span><span class="ident" id="3504182">Rune</span>&nbsp;<span class="op" id="3504187">=</span>&nbsp;<span class="ident" id="3504189">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504196">p</span><span class="op" id="3504197">.</span><span class="ident" id="3504198">push</span><span class="op" id="3504202">(</span><span class="ident" id="3504203">re</span><span class="op" id="3504205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504208">return</span>&nbsp;<span class="ident" id="3504215">t</span><span class="op" id="3504216">,</span>&nbsp;<span class="builtintype" id="3504218">nil</span><br>
<span class="lineno">1610</span><span class="op" id="3504222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3504225">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="3504282">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="3504325">func</span>&nbsp;<span class="ident" id="3504330">cleanClass</span><span class="op" id="3504340">(</span><span class="ident" id="3504341">rp</span>&nbsp;<span class="op" id="3504344">*</span><span class="op" id="3504345">[</span><span class="op" id="3504346">]</span><span class="builtintype" id="3504347">rune</span><span class="op" id="3504351">)</span>&nbsp;<span class="op" id="3504353">[</span><span class="op" id="3504354">]</span><span class="builtintype" id="3504355">rune</span>&nbsp;<span class="op" id="3504360">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504364">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504420">sort</span><span class="op" id="3504424">.</span><span class="ident" id="3504425">Sort</span><span class="op" id="3504429">(</span><span class="ident" id="3504430">ranges</span><span class="op" id="3504436">{</span><span class="ident" id="3504437">rp</span><span class="op" id="3504439">}</span><span class="op" id="3504440">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504444">r</span>&nbsp;<span class="op" id="3504446">:=</span>&nbsp;<span class="op" id="3504449">*</span><span class="ident" id="3504450">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504454">if</span>&nbsp;<span class="builtinfunc" id="3504457">len</span><span class="op" id="3504460">(</span><span class="ident" id="3504461">r</span><span class="op" id="3504462">)</span>&nbsp;<span class="op" id="3504464">&lt;</span>&nbsp;<span class="num" id="3504466">2</span>&nbsp;<span class="op" id="3504468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504472">return</span>&nbsp;<span class="ident" id="3504479">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504486">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504519">w</span>&nbsp;<span class="op" id="3504521">:=</span>&nbsp;<span class="num" id="3504524">2</span>&nbsp;<span class="comment" id="3504526">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504542">for</span>&nbsp;<span class="ident" id="3504546">i</span>&nbsp;<span class="op" id="3504548">:=</span>&nbsp;<span class="num" id="3504551">2</span><span class="op" id="3504552">;</span>&nbsp;<span class="ident" id="3504554">i</span>&nbsp;<span class="op" id="3504556">&lt;</span>&nbsp;<span class="builtinfunc" id="3504558">len</span><span class="op" id="3504561">(</span><span class="ident" id="3504562">r</span><span class="op" id="3504563">)</span><span class="op" id="3504564">;</span>&nbsp;<span class="ident" id="3504566">i</span>&nbsp;<span class="op" id="3504568">+=</span>&nbsp;<span class="num" id="3504571">2</span>&nbsp;<span class="op" id="3504573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504577">lo</span><span class="op" id="3504579">,</span>&nbsp;<span class="ident" id="3504581">hi</span>&nbsp;<span class="op" id="3504584">:=</span>&nbsp;<span class="ident" id="3504587">r</span><span class="op" id="3504588">[</span><span class="ident" id="3504589">i</span><span class="op" id="3504590">]</span><span class="op" id="3504591">,</span>&nbsp;<span class="ident" id="3504593">r</span><span class="op" id="3504594">[</span><span class="ident" id="3504595">i</span><span class="op" id="3504596">+</span><span class="num" id="3504597">1</span><span class="op" id="3504598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504602">if</span>&nbsp;<span class="ident" id="3504605">lo</span>&nbsp;<span class="op" id="3504608">&lt;=</span>&nbsp;<span class="ident" id="3504611">r</span><span class="op" id="3504612">[</span><span class="ident" id="3504613">w</span><span class="op" id="3504614">-</span><span class="num" id="3504615">1</span><span class="op" id="3504616">]</span><span class="op" id="3504617">+</span><span class="num" id="3504618">1</span>&nbsp;<span class="op" id="3504620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504625">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504657">if</span>&nbsp;<span class="ident" id="3504660">hi</span>&nbsp;<span class="op" id="3504663">&gt;</span>&nbsp;<span class="ident" id="3504665">r</span><span class="op" id="3504666">[</span><span class="ident" id="3504667">w</span><span class="op" id="3504668">-</span><span class="num" id="3504669">1</span><span class="op" id="3504670">]</span>&nbsp;<span class="op" id="3504672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504678">r</span><span class="op" id="3504679">[</span><span class="ident" id="3504680">w</span><span class="op" id="3504681">-</span><span class="num" id="3504682">1</span><span class="op" id="3504683">]</span>&nbsp;<span class="op" id="3504685">=</span>&nbsp;<span class="ident" id="3504687">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504698">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504709">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3504713">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504737">r</span><span class="op" id="3504738">[</span><span class="ident" id="3504739">w</span><span class="op" id="3504740">]</span>&nbsp;<span class="op" id="3504742">=</span>&nbsp;<span class="ident" id="3504744">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504749">r</span><span class="op" id="3504750">[</span><span class="ident" id="3504751">w</span><span class="op" id="3504752">+</span><span class="num" id="3504753">1</span><span class="op" id="3504754">]</span>&nbsp;<span class="op" id="3504756">=</span>&nbsp;<span class="ident" id="3504758">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3504763">w</span>&nbsp;<span class="op" id="3504765">+=</span>&nbsp;<span class="num" id="3504768">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504771">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504775">return</span>&nbsp;<span class="ident" id="3504782">r</span><span class="op" id="3504783">[</span><span class="op" id="3504784">:</span><span class="ident" id="3504785">w</span><span class="op" id="3504786">]</span><br>
<span class="lineno"></span><span class="op" id="3504788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3504791">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="3504870">func</span>&nbsp;<span class="ident" id="3504875">appendLiteral</span><span class="op" id="3504888">(</span><span class="ident" id="3504889">r</span>&nbsp;<span class="op" id="3504891">[</span><span class="op" id="3504892">]</span><span class="builtintype" id="3504893">rune</span><span class="op" id="3504897">,</span>&nbsp;<span class="ident" id="3504899">x</span>&nbsp;<span class="builtintype" id="3504901">rune</span><span class="op" id="3504905">,</span>&nbsp;<span class="ident" id="3504907">flags</span>&nbsp;<span class="ident" id="3504913">Flags</span><span class="op" id="3504918">)</span>&nbsp;<span class="op" id="3504920">[</span><span class="op" id="3504921">]</span><span class="builtintype" id="3504922">rune</span>&nbsp;<span class="op" id="3504927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504930">if</span>&nbsp;<span class="ident" id="3504933">flags</span><span class="op" id="3504938">&amp;</span><span class="ident" id="3504939">FoldCase</span>&nbsp;<span class="op" id="3504948">!=</span>&nbsp;<span class="num" id="3504951">0</span>&nbsp;<span class="op" id="3504953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504957">return</span>&nbsp;<span class="ident" id="3504964">appendFoldedRange</span><span class="op" id="3504981">(</span><span class="ident" id="3504982">r</span><span class="op" id="3504983">,</span>&nbsp;<span class="ident" id="3504985">x</span><span class="op" id="3504986">,</span>&nbsp;<span class="ident" id="3504988">x</span><span class="op" id="3504989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3504992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3504995">return</span>&nbsp;<span class="ident" id="3505002">appendRange</span><span class="op" id="3505013">(</span><span class="ident" id="3505014">r</span><span class="op" id="3505015">,</span>&nbsp;<span class="ident" id="3505017">x</span><span class="op" id="3505018">,</span>&nbsp;<span class="ident" id="3505020">x</span><span class="op" id="3505021">)</span><br>
<span class="lineno">1650</span><span class="op" id="3505023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3505026">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3505105">func</span>&nbsp;<span class="ident" id="3505110">appendRange</span><span class="op" id="3505121">(</span><span class="ident" id="3505122">r</span>&nbsp;<span class="op" id="3505124">[</span><span class="op" id="3505125">]</span><span class="builtintype" id="3505126">rune</span><span class="op" id="3505130">,</span>&nbsp;<span class="ident" id="3505132">lo</span><span class="op" id="3505134">,</span>&nbsp;<span class="ident" id="3505136">hi</span>&nbsp;<span class="builtintype" id="3505139">rune</span><span class="op" id="3505143">)</span>&nbsp;<span class="op" id="3505145">[</span><span class="op" id="3505146">]</span><span class="builtintype" id="3505147">rune</span>&nbsp;<span class="op" id="3505152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505155">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505224">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505281">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505343">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505368">n</span>&nbsp;<span class="op" id="3505370">:=</span>&nbsp;<span class="builtinfunc" id="3505373">len</span><span class="op" id="3505376">(</span><span class="ident" id="3505377">r</span><span class="op" id="3505378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505381">for</span>&nbsp;<span class="ident" id="3505385">i</span>&nbsp;<span class="op" id="3505387">:=</span>&nbsp;<span class="num" id="3505390">2</span><span class="op" id="3505391">;</span>&nbsp;<span class="ident" id="3505393">i</span>&nbsp;<span class="op" id="3505395">&lt;=</span>&nbsp;<span class="num" id="3505398">4</span><span class="op" id="3505399">;</span>&nbsp;<span class="ident" id="3505401">i</span>&nbsp;<span class="op" id="3505403">+=</span>&nbsp;<span class="num" id="3505406">2</span>&nbsp;<span class="op" id="3505408">{</span>&nbsp;<span class="comment" id="3505410">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505437">if</span>&nbsp;<span class="ident" id="3505440">n</span>&nbsp;<span class="op" id="3505442">&gt;=</span>&nbsp;<span class="ident" id="3505445">i</span>&nbsp;<span class="op" id="3505447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505452">rlo</span><span class="op" id="3505455">,</span>&nbsp;<span class="ident" id="3505457">rhi</span>&nbsp;<span class="op" id="3505461">:=</span>&nbsp;<span class="ident" id="3505464">r</span><span class="op" id="3505465">[</span><span class="ident" id="3505466">n</span><span class="op" id="3505467">-</span><span class="ident" id="3505468">i</span><span class="op" id="3505469">]</span><span class="op" id="3505470">,</span>&nbsp;<span class="ident" id="3505472">r</span><span class="op" id="3505473">[</span><span class="ident" id="3505474">n</span><span class="op" id="3505475">-</span><span class="ident" id="3505476">i</span><span class="op" id="3505477">+</span><span class="num" id="3505478">1</span><span class="op" id="3505479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505484">if</span>&nbsp;<span class="ident" id="3505487">lo</span>&nbsp;<span class="op" id="3505490">&lt;=</span>&nbsp;<span class="ident" id="3505493">rhi</span><span class="op" id="3505496">+</span><span class="num" id="3505497">1</span>&nbsp;<span class="op" id="3505499">&amp;&amp;</span>&nbsp;<span class="ident" id="3505502">rlo</span>&nbsp;<span class="op" id="3505506">&lt;=</span>&nbsp;<span class="ident" id="3505509">hi</span><span class="op" id="3505511">+</span><span class="num" id="3505512">1</span>&nbsp;<span class="op" id="3505514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505520">if</span>&nbsp;<span class="ident" id="3505523">lo</span>&nbsp;<span class="op" id="3505526">&lt;</span>&nbsp;<span class="ident" id="3505528">rlo</span>&nbsp;<span class="op" id="3505532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505539">r</span><span class="op" id="3505540">[</span><span class="ident" id="3505541">n</span><span class="op" id="3505542">-</span><span class="ident" id="3505543">i</span><span class="op" id="3505544">]</span>&nbsp;<span class="op" id="3505546">=</span>&nbsp;<span class="ident" id="3505548">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505561">if</span>&nbsp;<span class="ident" id="3505564">hi</span>&nbsp;<span class="op" id="3505567">&gt;</span>&nbsp;<span class="ident" id="3505569">rhi</span>&nbsp;<span class="op" id="3505573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505580">r</span><span class="op" id="3505581">[</span><span class="ident" id="3505582">n</span><span class="op" id="3505583">-</span><span class="ident" id="3505584">i</span><span class="op" id="3505585">+</span><span class="num" id="3505586">1</span><span class="op" id="3505587">]</span>&nbsp;<span class="op" id="3505589">=</span>&nbsp;<span class="ident" id="3505591">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505604">return</span>&nbsp;<span class="ident" id="3505611">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3505623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505627">return</span>&nbsp;<span class="builtinfunc" id="3505634">append</span><span class="op" id="3505640">(</span><span class="ident" id="3505641">r</span><span class="op" id="3505642">,</span>&nbsp;<span class="ident" id="3505644">lo</span><span class="op" id="3505646">,</span>&nbsp;<span class="ident" id="3505648">hi</span><span class="op" id="3505650">)</span><br>
<span class="lineno">1675</span><span class="op" id="3505652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3505655">const</span>&nbsp;<span class="op" id="3505661">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505664">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505715">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505740">minFold</span>&nbsp;<span class="op" id="3505748">=</span>&nbsp;<span class="num" id="3505750">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3505758">maxFold</span>&nbsp;<span class="op" id="3505766">=</span>&nbsp;<span class="num" id="3505768">0x118df</span><br>
<span class="lineno"></span><span class="op" id="3505776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3505779">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="3505848">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3505905">func</span>&nbsp;<span class="ident" id="3505910">appendFoldedRange</span><span class="op" id="3505927">(</span><span class="ident" id="3505928">r</span>&nbsp;<span class="op" id="3505930">[</span><span class="op" id="3505931">]</span><span class="builtintype" id="3505932">rune</span><span class="op" id="3505936">,</span>&nbsp;<span class="ident" id="3505938">lo</span><span class="op" id="3505940">,</span>&nbsp;<span class="ident" id="3505942">hi</span>&nbsp;<span class="builtintype" id="3505945">rune</span><span class="op" id="3505949">)</span>&nbsp;<span class="op" id="3505951">[</span><span class="op" id="3505952">]</span><span class="builtintype" id="3505953">rune</span>&nbsp;<span class="op" id="3505958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3505961">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3505980">if</span>&nbsp;<span class="ident" id="3505983">lo</span>&nbsp;<span class="op" id="3505986">&lt;=</span>&nbsp;<span class="ident" id="3505989">minFold</span>&nbsp;<span class="op" id="3505997">&amp;&amp;</span>&nbsp;<span class="ident" id="3506000">hi</span>&nbsp;<span class="op" id="3506003">&gt;=</span>&nbsp;<span class="ident" id="3506006">maxFold</span>&nbsp;<span class="op" id="3506014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506018">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506062">return</span>&nbsp;<span class="ident" id="3506069">appendRange</span><span class="op" id="3506080">(</span><span class="ident" id="3506081">r</span><span class="op" id="3506082">,</span>&nbsp;<span class="ident" id="3506084">lo</span><span class="op" id="3506086">,</span>&nbsp;<span class="ident" id="3506088">hi</span><span class="op" id="3506090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506096">if</span>&nbsp;<span class="ident" id="3506099">hi</span>&nbsp;<span class="op" id="3506102">&lt;</span>&nbsp;<span class="ident" id="3506104">minFold</span>&nbsp;<span class="op" id="3506112">||</span>&nbsp;<span class="ident" id="3506115">lo</span>&nbsp;<span class="op" id="3506118">&gt;</span>&nbsp;<span class="ident" id="3506120">maxFold</span>&nbsp;<span class="op" id="3506128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506132">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506177">return</span>&nbsp;<span class="ident" id="3506184">appendRange</span><span class="op" id="3506195">(</span><span class="ident" id="3506196">r</span><span class="op" id="3506197">,</span>&nbsp;<span class="ident" id="3506199">lo</span><span class="op" id="3506201">,</span>&nbsp;<span class="ident" id="3506203">hi</span><span class="op" id="3506205">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506211">if</span>&nbsp;<span class="ident" id="3506214">lo</span>&nbsp;<span class="op" id="3506217">&lt;</span>&nbsp;<span class="ident" id="3506219">minFold</span>&nbsp;<span class="op" id="3506227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506231">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506270">r</span>&nbsp;<span class="op" id="3506272">=</span>&nbsp;<span class="ident" id="3506274">appendRange</span><span class="op" id="3506285">(</span><span class="ident" id="3506286">r</span><span class="op" id="3506287">,</span>&nbsp;<span class="ident" id="3506289">lo</span><span class="op" id="3506291">,</span>&nbsp;<span class="ident" id="3506293">minFold</span><span class="op" id="3506300">-</span><span class="num" id="3506301">1</span><span class="op" id="3506302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506306">lo</span>&nbsp;<span class="op" id="3506309">=</span>&nbsp;<span class="ident" id="3506311">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506323">if</span>&nbsp;<span class="ident" id="3506326">hi</span>&nbsp;<span class="op" id="3506329">&gt;</span>&nbsp;<span class="ident" id="3506331">maxFold</span>&nbsp;<span class="op" id="3506339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506343">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506382">r</span>&nbsp;<span class="op" id="3506384">=</span>&nbsp;<span class="ident" id="3506386">appendRange</span><span class="op" id="3506397">(</span><span class="ident" id="3506398">r</span><span class="op" id="3506399">,</span>&nbsp;<span class="ident" id="3506401">maxFold</span><span class="op" id="3506408">+</span><span class="num" id="3506409">1</span><span class="op" id="3506410">,</span>&nbsp;<span class="ident" id="3506412">hi</span><span class="op" id="3506414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506418">hi</span>&nbsp;<span class="op" id="3506421">=</span>&nbsp;<span class="ident" id="3506423">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3506436">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506507">for</span>&nbsp;<span class="ident" id="3506511">c</span>&nbsp;<span class="op" id="3506513">:=</span>&nbsp;<span class="ident" id="3506516">lo</span><span class="op" id="3506518">;</span>&nbsp;<span class="ident" id="3506520">c</span>&nbsp;<span class="op" id="3506522">&lt;=</span>&nbsp;<span class="ident" id="3506525">hi</span><span class="op" id="3506527">;</span>&nbsp;<span class="ident" id="3506529">c</span><span class="op" id="3506530">++</span>&nbsp;<span class="op" id="3506533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506537">r</span>&nbsp;<span class="op" id="3506539">=</span>&nbsp;<span class="ident" id="3506541">appendRange</span><span class="op" id="3506552">(</span><span class="ident" id="3506553">r</span><span class="op" id="3506554">,</span>&nbsp;<span class="ident" id="3506556">c</span><span class="op" id="3506557">,</span>&nbsp;<span class="ident" id="3506559">c</span><span class="op" id="3506560">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506564">f</span>&nbsp;<span class="op" id="3506566">:=</span>&nbsp;<span class="ident" id="3506569">unicode</span><span class="op" id="3506576">.</span><span class="ident" id="3506577">SimpleFold</span><span class="op" id="3506587">(</span><span class="ident" id="3506588">c</span><span class="op" id="3506589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506593">for</span>&nbsp;<span class="ident" id="3506597">f</span>&nbsp;<span class="op" id="3506599">!=</span>&nbsp;<span class="ident" id="3506602">c</span>&nbsp;<span class="op" id="3506604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506609">r</span>&nbsp;<span class="op" id="3506611">=</span>&nbsp;<span class="ident" id="3506613">appendRange</span><span class="op" id="3506624">(</span><span class="ident" id="3506625">r</span><span class="op" id="3506626">,</span>&nbsp;<span class="ident" id="3506628">f</span><span class="op" id="3506629">,</span>&nbsp;<span class="ident" id="3506631">f</span><span class="op" id="3506632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506637">f</span>&nbsp;<span class="op" id="3506639">=</span>&nbsp;<span class="ident" id="3506641">unicode</span><span class="op" id="3506648">.</span><span class="ident" id="3506649">SimpleFold</span><span class="op" id="3506659">(</span><span class="ident" id="3506660">f</span><span class="op" id="3506661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506665">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506671">return</span>&nbsp;<span class="ident" id="3506678">r</span><br>
<span class="lineno"></span><span class="op" id="3506680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3506683">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="3506758">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3506783">func</span>&nbsp;<span class="ident" id="3506788">appendClass</span><span class="op" id="3506799">(</span><span class="ident" id="3506800">r</span>&nbsp;<span class="op" id="3506802">[</span><span class="op" id="3506803">]</span><span class="builtintype" id="3506804">rune</span><span class="op" id="3506808">,</span>&nbsp;<span class="ident" id="3506810">x</span>&nbsp;<span class="op" id="3506812">[</span><span class="op" id="3506813">]</span><span class="builtintype" id="3506814">rune</span><span class="op" id="3506818">)</span>&nbsp;<span class="op" id="3506820">[</span><span class="op" id="3506821">]</span><span class="builtintype" id="3506822">rune</span>&nbsp;<span class="op" id="3506827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506830">for</span>&nbsp;<span class="ident" id="3506834">i</span>&nbsp;<span class="op" id="3506836">:=</span>&nbsp;<span class="num" id="3506839">0</span><span class="op" id="3506840">;</span>&nbsp;<span class="ident" id="3506842">i</span>&nbsp;<span class="op" id="3506844">&lt;</span>&nbsp;<span class="builtinfunc" id="3506846">len</span><span class="op" id="3506849">(</span><span class="ident" id="3506850">x</span><span class="op" id="3506851">)</span><span class="op" id="3506852">;</span>&nbsp;<span class="ident" id="3506854">i</span>&nbsp;<span class="op" id="3506856">+=</span>&nbsp;<span class="num" id="3506859">2</span>&nbsp;<span class="op" id="3506861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3506865">r</span>&nbsp;<span class="op" id="3506867">=</span>&nbsp;<span class="ident" id="3506869">appendRange</span><span class="op" id="3506880">(</span><span class="ident" id="3506881">r</span><span class="op" id="3506882">,</span>&nbsp;<span class="ident" id="3506884">x</span><span class="op" id="3506885">[</span><span class="ident" id="3506886">i</span><span class="op" id="3506887">]</span><span class="op" id="3506888">,</span>&nbsp;<span class="ident" id="3506890">x</span><span class="op" id="3506891">[</span><span class="ident" id="3506892">i</span><span class="op" id="3506893">+</span><span class="num" id="3506894">1</span><span class="op" id="3506895">]</span><span class="op" id="3506896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3506899">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3506902">return</span>&nbsp;<span class="ident" id="3506909">r</span><br>
<span class="lineno"></span><span class="op" id="3506911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3506914">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3507010">func</span>&nbsp;<span class="ident" id="3507015">appendFoldedClass</span><span class="op" id="3507032">(</span><span class="ident" id="3507033">r</span>&nbsp;<span class="op" id="3507035">[</span><span class="op" id="3507036">]</span><span class="builtintype" id="3507037">rune</span><span class="op" id="3507041">,</span>&nbsp;<span class="ident" id="3507043">x</span>&nbsp;<span class="op" id="3507045">[</span><span class="op" id="3507046">]</span><span class="builtintype" id="3507047">rune</span><span class="op" id="3507051">)</span>&nbsp;<span class="op" id="3507053">[</span><span class="op" id="3507054">]</span><span class="builtintype" id="3507055">rune</span>&nbsp;<span class="op" id="3507060">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507063">for</span>&nbsp;<span class="ident" id="3507067">i</span>&nbsp;<span class="op" id="3507069">:=</span>&nbsp;<span class="num" id="3507072">0</span><span class="op" id="3507073">;</span>&nbsp;<span class="ident" id="3507075">i</span>&nbsp;<span class="op" id="3507077">&lt;</span>&nbsp;<span class="builtinfunc" id="3507079">len</span><span class="op" id="3507082">(</span><span class="ident" id="3507083">x</span><span class="op" id="3507084">)</span><span class="op" id="3507085">;</span>&nbsp;<span class="ident" id="3507087">i</span>&nbsp;<span class="op" id="3507089">+=</span>&nbsp;<span class="num" id="3507092">2</span>&nbsp;<span class="op" id="3507094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507098">r</span>&nbsp;<span class="op" id="3507100">=</span>&nbsp;<span class="ident" id="3507102">appendFoldedRange</span><span class="op" id="3507119">(</span><span class="ident" id="3507120">r</span><span class="op" id="3507121">,</span>&nbsp;<span class="ident" id="3507123">x</span><span class="op" id="3507124">[</span><span class="ident" id="3507125">i</span><span class="op" id="3507126">]</span><span class="op" id="3507127">,</span>&nbsp;<span class="ident" id="3507129">x</span><span class="op" id="3507130">[</span><span class="ident" id="3507131">i</span><span class="op" id="3507132">+</span><span class="num" id="3507133">1</span><span class="op" id="3507134">]</span><span class="op" id="3507135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507141">return</span>&nbsp;<span class="ident" id="3507148">r</span><br>
<span class="lineno"></span><span class="op" id="3507150">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="3507153">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3507251">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3507277">func</span>&nbsp;<span class="ident" id="3507282">appendNegatedClass</span><span class="op" id="3507300">(</span><span class="ident" id="3507301">r</span>&nbsp;<span class="op" id="3507303">[</span><span class="op" id="3507304">]</span><span class="builtintype" id="3507305">rune</span><span class="op" id="3507309">,</span>&nbsp;<span class="ident" id="3507311">x</span>&nbsp;<span class="op" id="3507313">[</span><span class="op" id="3507314">]</span><span class="builtintype" id="3507315">rune</span><span class="op" id="3507319">)</span>&nbsp;<span class="op" id="3507321">[</span><span class="op" id="3507322">]</span><span class="builtintype" id="3507323">rune</span>&nbsp;<span class="op" id="3507328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507331">nextLo</span>&nbsp;<span class="op" id="3507338">:=</span>&nbsp;<span class="string" id="3507341">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507351">for</span>&nbsp;<span class="ident" id="3507355">i</span>&nbsp;<span class="op" id="3507357">:=</span>&nbsp;<span class="num" id="3507360">0</span><span class="op" id="3507361">;</span>&nbsp;<span class="ident" id="3507363">i</span>&nbsp;<span class="op" id="3507365">&lt;</span>&nbsp;<span class="builtinfunc" id="3507367">len</span><span class="op" id="3507370">(</span><span class="ident" id="3507371">x</span><span class="op" id="3507372">)</span><span class="op" id="3507373">;</span>&nbsp;<span class="ident" id="3507375">i</span>&nbsp;<span class="op" id="3507377">+=</span>&nbsp;<span class="num" id="3507380">2</span>&nbsp;<span class="op" id="3507382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507386">lo</span><span class="op" id="3507388">,</span>&nbsp;<span class="ident" id="3507390">hi</span>&nbsp;<span class="op" id="3507393">:=</span>&nbsp;<span class="ident" id="3507396">x</span><span class="op" id="3507397">[</span><span class="ident" id="3507398">i</span><span class="op" id="3507399">]</span><span class="op" id="3507400">,</span>&nbsp;<span class="ident" id="3507402">x</span><span class="op" id="3507403">[</span><span class="ident" id="3507404">i</span><span class="op" id="3507405">+</span><span class="num" id="3507406">1</span><span class="op" id="3507407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507411">if</span>&nbsp;<span class="ident" id="3507414">nextLo</span>&nbsp;<span class="op" id="3507421">&lt;=</span>&nbsp;<span class="ident" id="3507424">lo</span><span class="op" id="3507426">-</span><span class="num" id="3507427">1</span>&nbsp;<span class="op" id="3507429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507434">r</span>&nbsp;<span class="op" id="3507436">=</span>&nbsp;<span class="ident" id="3507438">appendRange</span><span class="op" id="3507449">(</span><span class="ident" id="3507450">r</span><span class="op" id="3507451">,</span>&nbsp;<span class="ident" id="3507453">nextLo</span><span class="op" id="3507459">,</span>&nbsp;<span class="ident" id="3507461">lo</span><span class="op" id="3507463">-</span><span class="num" id="3507464">1</span><span class="op" id="3507465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507469">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507473">nextLo</span>&nbsp;<span class="op" id="3507480">=</span>&nbsp;<span class="ident" id="3507482">hi</span>&nbsp;<span class="op" id="3507485">+</span>&nbsp;<span class="num" id="3507487">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507493">if</span>&nbsp;<span class="ident" id="3507496">nextLo</span>&nbsp;<span class="op" id="3507503">&lt;=</span>&nbsp;<span class="ident" id="3507506">unicode</span><span class="op" id="3507513">.</span><span class="ident" id="3507514">MaxRune</span>&nbsp;<span class="op" id="3507522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507526">r</span>&nbsp;<span class="op" id="3507528">=</span>&nbsp;<span class="ident" id="3507530">appendRange</span><span class="op" id="3507541">(</span><span class="ident" id="3507542">r</span><span class="op" id="3507543">,</span>&nbsp;<span class="ident" id="3507545">nextLo</span><span class="op" id="3507551">,</span>&nbsp;<span class="ident" id="3507553">unicode</span><span class="op" id="3507560">.</span><span class="ident" id="3507561">MaxRune</span><span class="op" id="3507568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507571">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507574">return</span>&nbsp;<span class="ident" id="3507581">r</span><br>
<span class="lineno"></span><span class="op" id="3507583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3507586">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3507651">func</span>&nbsp;<span class="ident" id="3507656">appendTable</span><span class="op" id="3507667">(</span><span class="ident" id="3507668">r</span>&nbsp;<span class="op" id="3507670">[</span><span class="op" id="3507671">]</span><span class="builtintype" id="3507672">rune</span><span class="op" id="3507676">,</span>&nbsp;<span class="ident" id="3507678">x</span>&nbsp;<span class="op" id="3507680">*</span><span class="ident" id="3507681">unicode</span><span class="op" id="3507688">.</span><span class="ident" id="3507689">RangeTable</span><span class="op" id="3507699">)</span>&nbsp;<span class="op" id="3507701">[</span><span class="op" id="3507702">]</span><span class="builtintype" id="3507703">rune</span>&nbsp;<span class="op" id="3507708">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507711">for</span>&nbsp;<span class="ident" id="3507715">_</span><span class="op" id="3507716">,</span>&nbsp;<span class="ident" id="3507718">xr</span>&nbsp;<span class="op" id="3507721">:=</span>&nbsp;<span class="keyword" id="3507724">range</span>&nbsp;<span class="ident" id="3507730">x</span><span class="op" id="3507731">.</span><span class="ident" id="3507732">R16</span>&nbsp;<span class="op" id="3507736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507740">lo</span><span class="op" id="3507742">,</span>&nbsp;<span class="ident" id="3507744">hi</span><span class="op" id="3507746">,</span>&nbsp;<span class="ident" id="3507748">stride</span>&nbsp;<span class="op" id="3507755">:=</span>&nbsp;<span class="builtintype" id="3507758">rune</span><span class="op" id="3507762">(</span><span class="ident" id="3507763">xr</span><span class="op" id="3507765">.</span><span class="ident" id="3507766">Lo</span><span class="op" id="3507768">)</span><span class="op" id="3507769">,</span>&nbsp;<span class="builtintype" id="3507771">rune</span><span class="op" id="3507775">(</span><span class="ident" id="3507776">xr</span><span class="op" id="3507778">.</span><span class="ident" id="3507779">Hi</span><span class="op" id="3507781">)</span><span class="op" id="3507782">,</span>&nbsp;<span class="builtintype" id="3507784">rune</span><span class="op" id="3507788">(</span><span class="ident" id="3507789">xr</span><span class="op" id="3507791">.</span><span class="ident" id="3507792">Stride</span><span class="op" id="3507798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507802">if</span>&nbsp;<span class="ident" id="3507805">stride</span>&nbsp;<span class="op" id="3507812">==</span>&nbsp;<span class="num" id="3507815">1</span>&nbsp;<span class="op" id="3507817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507822">r</span>&nbsp;<span class="op" id="3507824">=</span>&nbsp;<span class="ident" id="3507826">appendRange</span><span class="op" id="3507837">(</span><span class="ident" id="3507838">r</span><span class="op" id="3507839">,</span>&nbsp;<span class="ident" id="3507841">lo</span><span class="op" id="3507843">,</span>&nbsp;<span class="ident" id="3507845">hi</span><span class="op" id="3507847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507852">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507867">for</span>&nbsp;<span class="ident" id="3507871">c</span>&nbsp;<span class="op" id="3507873">:=</span>&nbsp;<span class="ident" id="3507876">lo</span><span class="op" id="3507878">;</span>&nbsp;<span class="ident" id="3507880">c</span>&nbsp;<span class="op" id="3507882">&lt;=</span>&nbsp;<span class="ident" id="3507885">hi</span><span class="op" id="3507887">;</span>&nbsp;<span class="ident" id="3507889">c</span>&nbsp;<span class="op" id="3507891">+=</span>&nbsp;<span class="ident" id="3507894">stride</span>&nbsp;<span class="op" id="3507901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507906">r</span>&nbsp;<span class="op" id="3507908">=</span>&nbsp;<span class="ident" id="3507910">appendRange</span><span class="op" id="3507921">(</span><span class="ident" id="3507922">r</span><span class="op" id="3507923">,</span>&nbsp;<span class="ident" id="3507925">c</span><span class="op" id="3507926">,</span>&nbsp;<span class="ident" id="3507928">c</span><span class="op" id="3507929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3507936">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3507939">for</span>&nbsp;<span class="ident" id="3507943">_</span><span class="op" id="3507944">,</span>&nbsp;<span class="ident" id="3507946">xr</span>&nbsp;<span class="op" id="3507949">:=</span>&nbsp;<span class="keyword" id="3507952">range</span>&nbsp;<span class="ident" id="3507958">x</span><span class="op" id="3507959">.</span><span class="ident" id="3507960">R32</span>&nbsp;<span class="op" id="3507964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3507968">lo</span><span class="op" id="3507970">,</span>&nbsp;<span class="ident" id="3507972">hi</span><span class="op" id="3507974">,</span>&nbsp;<span class="ident" id="3507976">stride</span>&nbsp;<span class="op" id="3507983">:=</span>&nbsp;<span class="builtintype" id="3507986">rune</span><span class="op" id="3507990">(</span><span class="ident" id="3507991">xr</span><span class="op" id="3507993">.</span><span class="ident" id="3507994">Lo</span><span class="op" id="3507996">)</span><span class="op" id="3507997">,</span>&nbsp;<span class="builtintype" id="3507999">rune</span><span class="op" id="3508003">(</span><span class="ident" id="3508004">xr</span><span class="op" id="3508006">.</span><span class="ident" id="3508007">Hi</span><span class="op" id="3508009">)</span><span class="op" id="3508010">,</span>&nbsp;<span class="builtintype" id="3508012">rune</span><span class="op" id="3508016">(</span><span class="ident" id="3508017">xr</span><span class="op" id="3508019">.</span><span class="ident" id="3508020">Stride</span><span class="op" id="3508026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508030">if</span>&nbsp;<span class="ident" id="3508033">stride</span>&nbsp;<span class="op" id="3508040">==</span>&nbsp;<span class="num" id="3508043">1</span>&nbsp;<span class="op" id="3508045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508050">r</span>&nbsp;<span class="op" id="3508052">=</span>&nbsp;<span class="ident" id="3508054">appendRange</span><span class="op" id="3508065">(</span><span class="ident" id="3508066">r</span><span class="op" id="3508067">,</span>&nbsp;<span class="ident" id="3508069">lo</span><span class="op" id="3508071">,</span>&nbsp;<span class="ident" id="3508073">hi</span><span class="op" id="3508075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508080">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508095">for</span>&nbsp;<span class="ident" id="3508099">c</span>&nbsp;<span class="op" id="3508101">:=</span>&nbsp;<span class="ident" id="3508104">lo</span><span class="op" id="3508106">;</span>&nbsp;<span class="ident" id="3508108">c</span>&nbsp;<span class="op" id="3508110">&lt;=</span>&nbsp;<span class="ident" id="3508113">hi</span><span class="op" id="3508115">;</span>&nbsp;<span class="ident" id="3508117">c</span>&nbsp;<span class="op" id="3508119">+=</span>&nbsp;<span class="ident" id="3508122">stride</span>&nbsp;<span class="op" id="3508129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508134">r</span>&nbsp;<span class="op" id="3508136">=</span>&nbsp;<span class="ident" id="3508138">appendRange</span><span class="op" id="3508149">(</span><span class="ident" id="3508150">r</span><span class="op" id="3508151">,</span>&nbsp;<span class="ident" id="3508153">c</span><span class="op" id="3508154">,</span>&nbsp;<span class="ident" id="3508156">c</span><span class="op" id="3508157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508164">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508167">return</span>&nbsp;<span class="ident" id="3508174">r</span><br>
<span class="lineno"></span><span class="op" id="3508176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3508179">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3508267">func</span>&nbsp;<span class="ident" id="3508272">appendNegatedTable</span><span class="op" id="3508290">(</span><span class="ident" id="3508291">r</span>&nbsp;<span class="op" id="3508293">[</span><span class="op" id="3508294">]</span><span class="builtintype" id="3508295">rune</span><span class="op" id="3508299">,</span>&nbsp;<span class="ident" id="3508301">x</span>&nbsp;<span class="op" id="3508303">*</span><span class="ident" id="3508304">unicode</span><span class="op" id="3508311">.</span><span class="ident" id="3508312">RangeTable</span><span class="op" id="3508322">)</span>&nbsp;<span class="op" id="3508324">[</span><span class="op" id="3508325">]</span><span class="builtintype" id="3508326">rune</span>&nbsp;<span class="op" id="3508331">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508334">nextLo</span>&nbsp;<span class="op" id="3508341">:=</span>&nbsp;<span class="string" id="3508344">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="3508353">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508385">for</span>&nbsp;<span class="ident" id="3508389">_</span><span class="op" id="3508390">,</span>&nbsp;<span class="ident" id="3508392">xr</span>&nbsp;<span class="op" id="3508395">:=</span>&nbsp;<span class="keyword" id="3508398">range</span>&nbsp;<span class="ident" id="3508404">x</span><span class="op" id="3508405">.</span><span class="ident" id="3508406">R16</span>&nbsp;<span class="op" id="3508410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508414">lo</span><span class="op" id="3508416">,</span>&nbsp;<span class="ident" id="3508418">hi</span><span class="op" id="3508420">,</span>&nbsp;<span class="ident" id="3508422">stride</span>&nbsp;<span class="op" id="3508429">:=</span>&nbsp;<span class="builtintype" id="3508432">rune</span><span class="op" id="3508436">(</span><span class="ident" id="3508437">xr</span><span class="op" id="3508439">.</span><span class="ident" id="3508440">Lo</span><span class="op" id="3508442">)</span><span class="op" id="3508443">,</span>&nbsp;<span class="builtintype" id="3508445">rune</span><span class="op" id="3508449">(</span><span class="ident" id="3508450">xr</span><span class="op" id="3508452">.</span><span class="ident" id="3508453">Hi</span><span class="op" id="3508455">)</span><span class="op" id="3508456">,</span>&nbsp;<span class="builtintype" id="3508458">rune</span><span class="op" id="3508462">(</span><span class="ident" id="3508463">xr</span><span class="op" id="3508465">.</span><span class="ident" id="3508466">Stride</span><span class="op" id="3508472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508476">if</span>&nbsp;<span class="ident" id="3508479">stride</span>&nbsp;<span class="op" id="3508486">==</span>&nbsp;<span class="num" id="3508489">1</span>&nbsp;<span class="op" id="3508491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508496">if</span>&nbsp;<span class="ident" id="3508499">nextLo</span>&nbsp;<span class="op" id="3508506">&lt;=</span>&nbsp;<span class="ident" id="3508509">lo</span><span class="op" id="3508511">-</span><span class="num" id="3508512">1</span>&nbsp;<span class="op" id="3508514">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508520">r</span>&nbsp;<span class="op" id="3508522">=</span>&nbsp;<span class="ident" id="3508524">appendRange</span><span class="op" id="3508535">(</span><span class="ident" id="3508536">r</span><span class="op" id="3508537">,</span>&nbsp;<span class="ident" id="3508539">nextLo</span><span class="op" id="3508545">,</span>&nbsp;<span class="ident" id="3508547">lo</span><span class="op" id="3508549">-</span><span class="num" id="3508550">1</span><span class="op" id="3508551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508561">nextLo</span>&nbsp;<span class="op" id="3508568">=</span>&nbsp;<span class="ident" id="3508570">hi</span>&nbsp;<span class="op" id="3508573">+</span>&nbsp;<span class="num" id="3508575">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508591">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508595">for</span>&nbsp;<span class="ident" id="3508599">c</span>&nbsp;<span class="op" id="3508601">:=</span>&nbsp;<span class="ident" id="3508604">lo</span><span class="op" id="3508606">;</span>&nbsp;<span class="ident" id="3508608">c</span>&nbsp;<span class="op" id="3508610">&lt;=</span>&nbsp;<span class="ident" id="3508613">hi</span><span class="op" id="3508615">;</span>&nbsp;<span class="ident" id="3508617">c</span>&nbsp;<span class="op" id="3508619">+=</span>&nbsp;<span class="ident" id="3508622">stride</span>&nbsp;<span class="op" id="3508629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508634">if</span>&nbsp;<span class="ident" id="3508637">nextLo</span>&nbsp;<span class="op" id="3508644">&lt;=</span>&nbsp;<span class="ident" id="3508647">c</span><span class="op" id="3508648">-</span><span class="num" id="3508649">1</span>&nbsp;<span class="op" id="3508651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508657">r</span>&nbsp;<span class="op" id="3508659">=</span>&nbsp;<span class="ident" id="3508661">appendRange</span><span class="op" id="3508672">(</span><span class="ident" id="3508673">r</span><span class="op" id="3508674">,</span>&nbsp;<span class="ident" id="3508676">nextLo</span><span class="op" id="3508682">,</span>&nbsp;<span class="ident" id="3508684">c</span><span class="op" id="3508685">-</span><span class="num" id="3508686">1</span><span class="op" id="3508687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508697">nextLo</span>&nbsp;<span class="op" id="3508704">=</span>&nbsp;<span class="ident" id="3508706">c</span>&nbsp;<span class="op" id="3508708">+</span>&nbsp;<span class="num" id="3508710">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508720">for</span>&nbsp;<span class="ident" id="3508724">_</span><span class="op" id="3508725">,</span>&nbsp;<span class="ident" id="3508727">xr</span>&nbsp;<span class="op" id="3508730">:=</span>&nbsp;<span class="keyword" id="3508733">range</span>&nbsp;<span class="ident" id="3508739">x</span><span class="op" id="3508740">.</span><span class="ident" id="3508741">R32</span>&nbsp;<span class="op" id="3508745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508749">lo</span><span class="op" id="3508751">,</span>&nbsp;<span class="ident" id="3508753">hi</span><span class="op" id="3508755">,</span>&nbsp;<span class="ident" id="3508757">stride</span>&nbsp;<span class="op" id="3508764">:=</span>&nbsp;<span class="builtintype" id="3508767">rune</span><span class="op" id="3508771">(</span><span class="ident" id="3508772">xr</span><span class="op" id="3508774">.</span><span class="ident" id="3508775">Lo</span><span class="op" id="3508777">)</span><span class="op" id="3508778">,</span>&nbsp;<span class="builtintype" id="3508780">rune</span><span class="op" id="3508784">(</span><span class="ident" id="3508785">xr</span><span class="op" id="3508787">.</span><span class="ident" id="3508788">Hi</span><span class="op" id="3508790">)</span><span class="op" id="3508791">,</span>&nbsp;<span class="builtintype" id="3508793">rune</span><span class="op" id="3508797">(</span><span class="ident" id="3508798">xr</span><span class="op" id="3508800">.</span><span class="ident" id="3508801">Stride</span><span class="op" id="3508807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508811">if</span>&nbsp;<span class="ident" id="3508814">stride</span>&nbsp;<span class="op" id="3508821">==</span>&nbsp;<span class="num" id="3508824">1</span>&nbsp;<span class="op" id="3508826">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508831">if</span>&nbsp;<span class="ident" id="3508834">nextLo</span>&nbsp;<span class="op" id="3508841">&lt;=</span>&nbsp;<span class="ident" id="3508844">lo</span><span class="op" id="3508846">-</span><span class="num" id="3508847">1</span>&nbsp;<span class="op" id="3508849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508855">r</span>&nbsp;<span class="op" id="3508857">=</span>&nbsp;<span class="ident" id="3508859">appendRange</span><span class="op" id="3508870">(</span><span class="ident" id="3508871">r</span><span class="op" id="3508872">,</span>&nbsp;<span class="ident" id="3508874">nextLo</span><span class="op" id="3508880">,</span>&nbsp;<span class="ident" id="3508882">lo</span><span class="op" id="3508884">-</span><span class="num" id="3508885">1</span><span class="op" id="3508886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508896">nextLo</span>&nbsp;<span class="op" id="3508903">=</span>&nbsp;<span class="ident" id="3508905">hi</span>&nbsp;<span class="op" id="3508908">+</span>&nbsp;<span class="num" id="3508910">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508915">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3508926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508930">for</span>&nbsp;<span class="ident" id="3508934">c</span>&nbsp;<span class="op" id="3508936">:=</span>&nbsp;<span class="ident" id="3508939">lo</span><span class="op" id="3508941">;</span>&nbsp;<span class="ident" id="3508943">c</span>&nbsp;<span class="op" id="3508945">&lt;=</span>&nbsp;<span class="ident" id="3508948">hi</span><span class="op" id="3508950">;</span>&nbsp;<span class="ident" id="3508952">c</span>&nbsp;<span class="op" id="3508954">+=</span>&nbsp;<span class="ident" id="3508957">stride</span>&nbsp;<span class="op" id="3508964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3508969">if</span>&nbsp;<span class="ident" id="3508972">nextLo</span>&nbsp;<span class="op" id="3508979">&lt;=</span>&nbsp;<span class="ident" id="3508982">c</span><span class="op" id="3508983">-</span><span class="num" id="3508984">1</span>&nbsp;<span class="op" id="3508986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3508992">r</span>&nbsp;<span class="op" id="3508994">=</span>&nbsp;<span class="ident" id="3508996">appendRange</span><span class="op" id="3509007">(</span><span class="ident" id="3509008">r</span><span class="op" id="3509009">,</span>&nbsp;<span class="ident" id="3509011">nextLo</span><span class="op" id="3509017">,</span>&nbsp;<span class="ident" id="3509019">c</span><span class="op" id="3509020">-</span><span class="num" id="3509021">1</span><span class="op" id="3509022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509027">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509032">nextLo</span>&nbsp;<span class="op" id="3509039">=</span>&nbsp;<span class="ident" id="3509041">c</span>&nbsp;<span class="op" id="3509043">+</span>&nbsp;<span class="num" id="3509045">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509055">if</span>&nbsp;<span class="ident" id="3509058">nextLo</span>&nbsp;<span class="op" id="3509065">&lt;=</span>&nbsp;<span class="ident" id="3509068">unicode</span><span class="op" id="3509075">.</span><span class="ident" id="3509076">MaxRune</span>&nbsp;<span class="op" id="3509084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509088">r</span>&nbsp;<span class="op" id="3509090">=</span>&nbsp;<span class="ident" id="3509092">appendRange</span><span class="op" id="3509103">(</span><span class="ident" id="3509104">r</span><span class="op" id="3509105">,</span>&nbsp;<span class="ident" id="3509107">nextLo</span><span class="op" id="3509113">,</span>&nbsp;<span class="ident" id="3509115">unicode</span><span class="op" id="3509122">.</span><span class="ident" id="3509123">MaxRune</span><span class="op" id="3509130">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509136">return</span>&nbsp;<span class="ident" id="3509143">r</span><br>
<span class="lineno"></span><span class="op" id="3509145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509148">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="3509202">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3509246">func</span>&nbsp;<span class="ident" id="3509251">negateClass</span><span class="op" id="3509262">(</span><span class="ident" id="3509263">r</span>&nbsp;<span class="op" id="3509265">[</span><span class="op" id="3509266">]</span><span class="builtintype" id="3509267">rune</span><span class="op" id="3509271">)</span>&nbsp;<span class="op" id="3509273">[</span><span class="op" id="3509274">]</span><span class="builtintype" id="3509275">rune</span>&nbsp;<span class="op" id="3509280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509283">nextLo</span>&nbsp;<span class="op" id="3509290">:=</span>&nbsp;<span class="string" id="3509293">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="3509302">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509334">w</span>&nbsp;<span class="op" id="3509336">:=</span>&nbsp;<span class="num" id="3509339">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3509353">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509369">for</span>&nbsp;<span class="ident" id="3509373">i</span>&nbsp;<span class="op" id="3509375">:=</span>&nbsp;<span class="num" id="3509378">0</span><span class="op" id="3509379">;</span>&nbsp;<span class="ident" id="3509381">i</span>&nbsp;<span class="op" id="3509383">&lt;</span>&nbsp;<span class="builtinfunc" id="3509385">len</span><span class="op" id="3509388">(</span><span class="ident" id="3509389">r</span><span class="op" id="3509390">)</span><span class="op" id="3509391">;</span>&nbsp;<span class="ident" id="3509393">i</span>&nbsp;<span class="op" id="3509395">+=</span>&nbsp;<span class="num" id="3509398">2</span>&nbsp;<span class="op" id="3509400">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509404">lo</span><span class="op" id="3509406">,</span>&nbsp;<span class="ident" id="3509408">hi</span>&nbsp;<span class="op" id="3509411">:=</span>&nbsp;<span class="ident" id="3509414">r</span><span class="op" id="3509415">[</span><span class="ident" id="3509416">i</span><span class="op" id="3509417">]</span><span class="op" id="3509418">,</span>&nbsp;<span class="ident" id="3509420">r</span><span class="op" id="3509421">[</span><span class="ident" id="3509422">i</span><span class="op" id="3509423">+</span><span class="num" id="3509424">1</span><span class="op" id="3509425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509429">if</span>&nbsp;<span class="ident" id="3509432">nextLo</span>&nbsp;<span class="op" id="3509439">&lt;=</span>&nbsp;<span class="ident" id="3509442">lo</span><span class="op" id="3509444">-</span><span class="num" id="3509445">1</span>&nbsp;<span class="op" id="3509447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509452">r</span><span class="op" id="3509453">[</span><span class="ident" id="3509454">w</span><span class="op" id="3509455">]</span>&nbsp;<span class="op" id="3509457">=</span>&nbsp;<span class="ident" id="3509459">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509469">r</span><span class="op" id="3509470">[</span><span class="ident" id="3509471">w</span><span class="op" id="3509472">+</span><span class="num" id="3509473">1</span><span class="op" id="3509474">]</span>&nbsp;<span class="op" id="3509476">=</span>&nbsp;<span class="ident" id="3509478">lo</span>&nbsp;<span class="op" id="3509481">-</span>&nbsp;<span class="num" id="3509483">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509488">w</span>&nbsp;<span class="op" id="3509490">+=</span>&nbsp;<span class="num" id="3509493">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509501">nextLo</span>&nbsp;<span class="op" id="3509508">=</span>&nbsp;<span class="ident" id="3509510">hi</span>&nbsp;<span class="op" id="3509513">+</span>&nbsp;<span class="num" id="3509515">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509521">r</span>&nbsp;<span class="op" id="3509523">=</span>&nbsp;<span class="ident" id="3509525">r</span><span class="op" id="3509526">[</span><span class="op" id="3509527">:</span><span class="ident" id="3509528">w</span><span class="op" id="3509529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509532">if</span>&nbsp;<span class="ident" id="3509535">nextLo</span>&nbsp;<span class="op" id="3509542">&lt;=</span>&nbsp;<span class="ident" id="3509545">unicode</span><span class="op" id="3509552">.</span><span class="ident" id="3509553">MaxRune</span>&nbsp;<span class="op" id="3509561">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3509565">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3509618">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509682">r</span>&nbsp;<span class="op" id="3509684">=</span>&nbsp;<span class="builtinfunc" id="3509686">append</span><span class="op" id="3509692">(</span><span class="ident" id="3509693">r</span><span class="op" id="3509694">,</span>&nbsp;<span class="ident" id="3509696">nextLo</span><span class="op" id="3509702">,</span>&nbsp;<span class="ident" id="3509704">unicode</span><span class="op" id="3509711">.</span><span class="ident" id="3509712">MaxRune</span><span class="op" id="3509719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3509722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3509725">return</span>&nbsp;<span class="ident" id="3509732">r</span><br>
<span class="lineno">1840</span><span class="op" id="3509734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509737">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="3509786">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="3509839">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="3509889">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="3509903">type</span>&nbsp;<span class="ident" id="3509908">ranges</span>&nbsp;<span class="keyword" id="3509915">struct</span>&nbsp;<span class="op" id="3509922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509925">p</span>&nbsp;<span class="op" id="3509927">*</span><span class="op" id="3509928">[</span><span class="op" id="3509929">]</span><span class="builtintype" id="3509930">rune</span><br>
<span class="lineno"></span><span class="op" id="3509935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="3509938">func</span>&nbsp;<span class="op" id="3509943">(</span><span class="ident" id="3509944">ra</span>&nbsp;<span class="ident" id="3509947">ranges</span><span class="op" id="3509953">)</span>&nbsp;<span class="ident" id="3509955">Less</span><span class="op" id="3509959">(</span><span class="ident" id="3509960">i</span><span class="op" id="3509961">,</span>&nbsp;<span class="ident" id="3509963">j</span>&nbsp;<span class="builtintype" id="3509965">int</span><span class="op" id="3509968">)</span>&nbsp;<span class="builtintype" id="3509970">bool</span>&nbsp;<span class="op" id="3509975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509978">p</span>&nbsp;<span class="op" id="3509980">:=</span>&nbsp;<span class="op" id="3509983">*</span><span class="ident" id="3509984">ra</span><span class="op" id="3509986">.</span><span class="ident" id="3509987">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509990">i</span>&nbsp;<span class="op" id="3509992">*=</span>&nbsp;<span class="num" id="3509995">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3509998">j</span>&nbsp;<span class="op" id="3510000">*=</span>&nbsp;<span class="num" id="3510003">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510006">return</span>&nbsp;<span class="ident" id="3510013">p</span><span class="op" id="3510014">[</span><span class="ident" id="3510015">i</span><span class="op" id="3510016">]</span>&nbsp;<span class="op" id="3510018">&lt;</span>&nbsp;<span class="ident" id="3510020">p</span><span class="op" id="3510021">[</span><span class="ident" id="3510022">j</span><span class="op" id="3510023">]</span>&nbsp;<span class="op" id="3510025">||</span>&nbsp;<span class="ident" id="3510028">p</span><span class="op" id="3510029">[</span><span class="ident" id="3510030">i</span><span class="op" id="3510031">]</span>&nbsp;<span class="op" id="3510033">==</span>&nbsp;<span class="ident" id="3510036">p</span><span class="op" id="3510037">[</span><span class="ident" id="3510038">j</span><span class="op" id="3510039">]</span>&nbsp;<span class="op" id="3510041">&amp;&amp;</span>&nbsp;<span class="ident" id="3510044">p</span><span class="op" id="3510045">[</span><span class="ident" id="3510046">i</span><span class="op" id="3510047">+</span><span class="num" id="3510048">1</span><span class="op" id="3510049">]</span>&nbsp;<span class="op" id="3510051">&gt;</span>&nbsp;<span class="ident" id="3510053">p</span><span class="op" id="3510054">[</span><span class="ident" id="3510055">j</span><span class="op" id="3510056">+</span><span class="num" id="3510057">1</span><span class="op" id="3510058">]</span><br>
<span class="lineno">1855</span><span class="op" id="3510060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510063">func</span>&nbsp;<span class="op" id="3510068">(</span><span class="ident" id="3510069">ra</span>&nbsp;<span class="ident" id="3510072">ranges</span><span class="op" id="3510078">)</span>&nbsp;<span class="ident" id="3510080">Len</span><span class="op" id="3510083">(</span><span class="op" id="3510084">)</span>&nbsp;<span class="builtintype" id="3510086">int</span>&nbsp;<span class="op" id="3510090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510093">return</span>&nbsp;<span class="builtinfunc" id="3510100">len</span><span class="op" id="3510103">(</span><span class="op" id="3510104">*</span><span class="ident" id="3510105">ra</span><span class="op" id="3510107">.</span><span class="ident" id="3510108">p</span><span class="op" id="3510109">)</span>&nbsp;<span class="op" id="3510111">/</span>&nbsp;<span class="num" id="3510113">2</span><br>
<span class="lineno"></span><span class="op" id="3510115">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="3510118">func</span>&nbsp;<span class="op" id="3510123">(</span><span class="ident" id="3510124">ra</span>&nbsp;<span class="ident" id="3510127">ranges</span><span class="op" id="3510133">)</span>&nbsp;<span class="ident" id="3510135">Swap</span><span class="op" id="3510139">(</span><span class="ident" id="3510140">i</span><span class="op" id="3510141">,</span>&nbsp;<span class="ident" id="3510143">j</span>&nbsp;<span class="builtintype" id="3510145">int</span><span class="op" id="3510148">)</span>&nbsp;<span class="op" id="3510150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510153">p</span>&nbsp;<span class="op" id="3510155">:=</span>&nbsp;<span class="op" id="3510158">*</span><span class="ident" id="3510159">ra</span><span class="op" id="3510161">.</span><span class="ident" id="3510162">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510165">i</span>&nbsp;<span class="op" id="3510167">*=</span>&nbsp;<span class="num" id="3510170">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510173">j</span>&nbsp;<span class="op" id="3510175">*=</span>&nbsp;<span class="num" id="3510178">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510181">p</span><span class="op" id="3510182">[</span><span class="ident" id="3510183">i</span><span class="op" id="3510184">]</span><span class="op" id="3510185">,</span>&nbsp;<span class="ident" id="3510187">p</span><span class="op" id="3510188">[</span><span class="ident" id="3510189">i</span><span class="op" id="3510190">+</span><span class="num" id="3510191">1</span><span class="op" id="3510192">]</span><span class="op" id="3510193">,</span>&nbsp;<span class="ident" id="3510195">p</span><span class="op" id="3510196">[</span><span class="ident" id="3510197">j</span><span class="op" id="3510198">]</span><span class="op" id="3510199">,</span>&nbsp;<span class="ident" id="3510201">p</span><span class="op" id="3510202">[</span><span class="ident" id="3510203">j</span><span class="op" id="3510204">+</span><span class="num" id="3510205">1</span><span class="op" id="3510206">]</span>&nbsp;<span class="op" id="3510208">=</span>&nbsp;<span class="ident" id="3510210">p</span><span class="op" id="3510211">[</span><span class="ident" id="3510212">j</span><span class="op" id="3510213">]</span><span class="op" id="3510214">,</span>&nbsp;<span class="ident" id="3510216">p</span><span class="op" id="3510217">[</span><span class="ident" id="3510218">j</span><span class="op" id="3510219">+</span><span class="num" id="3510220">1</span><span class="op" id="3510221">]</span><span class="op" id="3510222">,</span>&nbsp;<span class="ident" id="3510224">p</span><span class="op" id="3510225">[</span><span class="ident" id="3510226">i</span><span class="op" id="3510227">]</span><span class="op" id="3510228">,</span>&nbsp;<span class="ident" id="3510230">p</span><span class="op" id="3510231">[</span><span class="ident" id="3510232">i</span><span class="op" id="3510233">+</span><span class="num" id="3510234">1</span><span class="op" id="3510235">]</span><br>
<span class="lineno"></span><span class="op" id="3510237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510240">func</span>&nbsp;<span class="ident" id="3510245">checkUTF8</span><span class="op" id="3510254">(</span><span class="ident" id="3510255">s</span>&nbsp;<span class="builtintype" id="3510257">string</span><span class="op" id="3510263">)</span>&nbsp;<span class="builtintype" id="3510265">error</span>&nbsp;<span class="op" id="3510271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510274">for</span>&nbsp;<span class="ident" id="3510278">s</span>&nbsp;<span class="op" id="3510280">!=</span>&nbsp;<span class="string" id="3510283">&#34;&#34;</span>&nbsp;<span class="op" id="3510286">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3510290">rune</span><span class="op" id="3510294">,</span>&nbsp;<span class="ident" id="3510296">size</span>&nbsp;<span class="op" id="3510301">:=</span>&nbsp;<span class="ident" id="3510304">utf8</span><span class="op" id="3510308">.</span><span class="ident" id="3510309">DecodeRuneInString</span><span class="op" id="3510327">(</span><span class="ident" id="3510328">s</span><span class="op" id="3510329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510333">if</span>&nbsp;<span class="builtintype" id="3510336">rune</span>&nbsp;<span class="op" id="3510341">==</span>&nbsp;<span class="ident" id="3510344">utf8</span><span class="op" id="3510348">.</span><span class="ident" id="3510349">RuneError</span>&nbsp;<span class="op" id="3510359">&amp;&amp;</span>&nbsp;<span class="ident" id="3510362">size</span>&nbsp;<span class="op" id="3510367">==</span>&nbsp;<span class="num" id="3510370">1</span>&nbsp;<span class="op" id="3510372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510377">return</span>&nbsp;<span class="op" id="3510384">&amp;</span><span class="ident" id="3510385">Error</span><span class="op" id="3510390">{</span><span class="ident" id="3510391">Code</span><span class="op" id="3510395">:</span>&nbsp;<span class="ident" id="3510397">ErrInvalidUTF8</span><span class="op" id="3510411">,</span>&nbsp;<span class="ident" id="3510413">Expr</span><span class="op" id="3510417">:</span>&nbsp;<span class="ident" id="3510419">s</span><span class="op" id="3510420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510428">s</span>&nbsp;<span class="op" id="3510430">=</span>&nbsp;<span class="ident" id="3510432">s</span><span class="op" id="3510433">[</span><span class="ident" id="3510434">size</span><span class="op" id="3510438">:</span><span class="op" id="3510439">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510445">return</span>&nbsp;<span class="builtintype" id="3510452">nil</span><br>
<span class="lineno"></span><span class="op" id="3510456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510459">func</span>&nbsp;<span class="ident" id="3510464">nextRune</span><span class="op" id="3510472">(</span><span class="ident" id="3510473">s</span>&nbsp;<span class="builtintype" id="3510475">string</span><span class="op" id="3510481">)</span>&nbsp;<span class="op" id="3510483">(</span><span class="ident" id="3510484">c</span>&nbsp;<span class="builtintype" id="3510486">rune</span><span class="op" id="3510490">,</span>&nbsp;<span class="ident" id="3510492">t</span>&nbsp;<span class="builtintype" id="3510494">string</span><span class="op" id="3510500">,</span>&nbsp;<span class="ident" id="3510502">err</span>&nbsp;<span class="builtintype" id="3510506">error</span><span class="op" id="3510511">)</span>&nbsp;<span class="op" id="3510513">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3510516">c</span><span class="op" id="3510517">,</span>&nbsp;<span class="ident" id="3510519">size</span>&nbsp;<span class="op" id="3510524">:=</span>&nbsp;<span class="ident" id="3510527">utf8</span><span class="op" id="3510531">.</span><span class="ident" id="3510532">DecodeRuneInString</span><span class="op" id="3510550">(</span><span class="ident" id="3510551">s</span><span class="op" id="3510552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510555">if</span>&nbsp;<span class="ident" id="3510558">c</span>&nbsp;<span class="op" id="3510560">==</span>&nbsp;<span class="ident" id="3510563">utf8</span><span class="op" id="3510567">.</span><span class="ident" id="3510568">RuneError</span>&nbsp;<span class="op" id="3510578">&amp;&amp;</span>&nbsp;<span class="ident" id="3510581">size</span>&nbsp;<span class="op" id="3510586">==</span>&nbsp;<span class="num" id="3510589">1</span>&nbsp;<span class="op" id="3510591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510595">return</span>&nbsp;<span class="num" id="3510602">0</span><span class="op" id="3510603">,</span>&nbsp;<span class="string" id="3510605">&#34;&#34;</span><span class="op" id="3510607">,</span>&nbsp;<span class="op" id="3510609">&amp;</span><span class="ident" id="3510610">Error</span><span class="op" id="3510615">{</span><span class="ident" id="3510616">Code</span><span class="op" id="3510620">:</span>&nbsp;<span class="ident" id="3510622">ErrInvalidUTF8</span><span class="op" id="3510636">,</span>&nbsp;<span class="ident" id="3510638">Expr</span><span class="op" id="3510642">:</span>&nbsp;<span class="ident" id="3510644">s</span><span class="op" id="3510645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510651">return</span>&nbsp;<span class="ident" id="3510658">c</span><span class="op" id="3510659">,</span>&nbsp;<span class="ident" id="3510661">s</span><span class="op" id="3510662">[</span><span class="ident" id="3510663">size</span><span class="op" id="3510667">:</span><span class="op" id="3510668">]</span><span class="op" id="3510669">,</span>&nbsp;<span class="builtintype" id="3510671">nil</span><br>
<span class="lineno">1885</span><span class="op" id="3510675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510678">func</span>&nbsp;<span class="ident" id="3510683">isalnum</span><span class="op" id="3510690">(</span><span class="ident" id="3510691">c</span>&nbsp;<span class="builtintype" id="3510693">rune</span><span class="op" id="3510697">)</span>&nbsp;<span class="builtintype" id="3510699">bool</span>&nbsp;<span class="op" id="3510704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510707">return</span>&nbsp;<span class="string" id="3510714">&#39;0&#39;</span>&nbsp;<span class="op" id="3510718">&lt;=</span>&nbsp;<span class="ident" id="3510721">c</span>&nbsp;<span class="op" id="3510723">&amp;&amp;</span>&nbsp;<span class="ident" id="3510726">c</span>&nbsp;<span class="op" id="3510728">&lt;=</span>&nbsp;<span class="string" id="3510731">&#39;9&#39;</span>&nbsp;<span class="op" id="3510735">||</span>&nbsp;<span class="string" id="3510738">&#39;A&#39;</span>&nbsp;<span class="op" id="3510742">&lt;=</span>&nbsp;<span class="ident" id="3510745">c</span>&nbsp;<span class="op" id="3510747">&amp;&amp;</span>&nbsp;<span class="ident" id="3510750">c</span>&nbsp;<span class="op" id="3510752">&lt;=</span>&nbsp;<span class="string" id="3510755">&#39;Z&#39;</span>&nbsp;<span class="op" id="3510759">||</span>&nbsp;<span class="string" id="3510762">&#39;a&#39;</span>&nbsp;<span class="op" id="3510766">&lt;=</span>&nbsp;<span class="ident" id="3510769">c</span>&nbsp;<span class="op" id="3510771">&amp;&amp;</span>&nbsp;<span class="ident" id="3510774">c</span>&nbsp;<span class="op" id="3510776">&lt;=</span>&nbsp;<span class="string" id="3510779">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="3510783">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="3510786">func</span>&nbsp;<span class="ident" id="3510791">unhex</span><span class="op" id="3510796">(</span><span class="ident" id="3510797">c</span>&nbsp;<span class="builtintype" id="3510799">rune</span><span class="op" id="3510803">)</span>&nbsp;<span class="builtintype" id="3510805">rune</span>&nbsp;<span class="op" id="3510810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510813">if</span>&nbsp;<span class="string" id="3510816">&#39;0&#39;</span>&nbsp;<span class="op" id="3510820">&lt;=</span>&nbsp;<span class="ident" id="3510823">c</span>&nbsp;<span class="op" id="3510825">&amp;&amp;</span>&nbsp;<span class="ident" id="3510828">c</span>&nbsp;<span class="op" id="3510830">&lt;=</span>&nbsp;<span class="string" id="3510833">&#39;9&#39;</span>&nbsp;<span class="op" id="3510837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510841">return</span>&nbsp;<span class="ident" id="3510848">c</span>&nbsp;<span class="op" id="3510850">-</span>&nbsp;<span class="string" id="3510852">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510857">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510860">if</span>&nbsp;<span class="string" id="3510863">&#39;a&#39;</span>&nbsp;<span class="op" id="3510867">&lt;=</span>&nbsp;<span class="ident" id="3510870">c</span>&nbsp;<span class="op" id="3510872">&amp;&amp;</span>&nbsp;<span class="ident" id="3510875">c</span>&nbsp;<span class="op" id="3510877">&lt;=</span>&nbsp;<span class="string" id="3510880">&#39;f&#39;</span>&nbsp;<span class="op" id="3510884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510888">return</span>&nbsp;<span class="ident" id="3510895">c</span>&nbsp;<span class="op" id="3510897">-</span>&nbsp;<span class="string" id="3510899">&#39;a&#39;</span>&nbsp;<span class="op" id="3510903">+</span>&nbsp;<span class="num" id="3510905">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510912">if</span>&nbsp;<span class="string" id="3510915">&#39;A&#39;</span>&nbsp;<span class="op" id="3510919">&lt;=</span>&nbsp;<span class="ident" id="3510922">c</span>&nbsp;<span class="op" id="3510924">&amp;&amp;</span>&nbsp;<span class="ident" id="3510927">c</span>&nbsp;<span class="op" id="3510929">&lt;=</span>&nbsp;<span class="string" id="3510932">&#39;F&#39;</span>&nbsp;<span class="op" id="3510936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510940">return</span>&nbsp;<span class="ident" id="3510947">c</span>&nbsp;<span class="op" id="3510949">-</span>&nbsp;<span class="string" id="3510951">&#39;A&#39;</span>&nbsp;<span class="op" id="3510955">+</span>&nbsp;<span class="num" id="3510957">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3510961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3510964">return</span>&nbsp;<span class="op" id="3510971">-</span><span class="num" id="3510972">1</span><br>
<span class="lineno"></span><span class="op" id="3510974">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
