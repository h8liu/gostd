<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html" class="current">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8072632">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8072687">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8072741">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8072792">package</span>&nbsp;<span class="ident" id="8072800">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8072807">import</span>&nbsp;<span class="op" id="8072814">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8072817">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8072824">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8072837">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8072845">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8072855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8072858">func</span>&nbsp;<span class="ident" id="8072863">checkPos</span><span class="op" id="8072871">(</span><span class="ident" id="8072872">t</span>&nbsp;<span class="op" id="8072874">*</span><span class="ident" id="8072875">testing</span><span class="op" id="8072882">.</span><span class="ident" id="8072883">T</span><span class="op" id="8072884">,</span>&nbsp;<span class="ident" id="8072886">msg</span>&nbsp;<span class="builtintype" id="8072890">string</span><span class="op" id="8072896">,</span>&nbsp;<span class="ident" id="8072898">got</span><span class="op" id="8072901">,</span>&nbsp;<span class="ident" id="8072903">want</span>&nbsp;<span class="ident" id="8072908">Position</span><span class="op" id="8072916">)</span>&nbsp;<span class="op" id="8072918">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8072921">if</span>&nbsp;<span class="ident" id="8072924">got</span><span class="op" id="8072927">.</span><span class="ident" id="8072928">Filename</span>&nbsp;<span class="op" id="8072937">!=</span>&nbsp;<span class="ident" id="8072940">want</span><span class="op" id="8072944">.</span><span class="ident" id="8072945">Filename</span>&nbsp;<span class="op" id="8072954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8072958">t</span><span class="op" id="8072959">.</span><span class="ident" id="8072960">Errorf</span><span class="op" id="8072966">(</span><span class="string" id="8072967">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8072999">,</span>&nbsp;<span class="ident" id="8073001">msg</span><span class="op" id="8073004">,</span>&nbsp;<span class="ident" id="8073006">got</span><span class="op" id="8073009">.</span><span class="ident" id="8073010">Filename</span><span class="op" id="8073018">,</span>&nbsp;<span class="ident" id="8073020">want</span><span class="op" id="8073024">.</span><span class="ident" id="8073025">Filename</span><span class="op" id="8073033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073039">if</span>&nbsp;<span class="ident" id="8073042">got</span><span class="op" id="8073045">.</span><span class="ident" id="8073046">Offset</span>&nbsp;<span class="op" id="8073053">!=</span>&nbsp;<span class="ident" id="8073056">want</span><span class="op" id="8073060">.</span><span class="ident" id="8073061">Offset</span>&nbsp;<span class="op" id="8073068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073072">t</span><span class="op" id="8073073">.</span><span class="ident" id="8073074">Errorf</span><span class="op" id="8073080">(</span><span class="string" id="8073081">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8073111">,</span>&nbsp;<span class="ident" id="8073113">msg</span><span class="op" id="8073116">,</span>&nbsp;<span class="ident" id="8073118">got</span><span class="op" id="8073121">.</span><span class="ident" id="8073122">Offset</span><span class="op" id="8073128">,</span>&nbsp;<span class="ident" id="8073130">want</span><span class="op" id="8073134">.</span><span class="ident" id="8073135">Offset</span><span class="op" id="8073141">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073147">if</span>&nbsp;<span class="ident" id="8073150">got</span><span class="op" id="8073153">.</span><span class="ident" id="8073154">Line</span>&nbsp;<span class="op" id="8073159">!=</span>&nbsp;<span class="ident" id="8073162">want</span><span class="op" id="8073166">.</span><span class="ident" id="8073167">Line</span>&nbsp;<span class="op" id="8073172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073176">t</span><span class="op" id="8073177">.</span><span class="ident" id="8073178">Errorf</span><span class="op" id="8073184">(</span><span class="string" id="8073185">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8073213">,</span>&nbsp;<span class="ident" id="8073215">msg</span><span class="op" id="8073218">,</span>&nbsp;<span class="ident" id="8073220">got</span><span class="op" id="8073223">.</span><span class="ident" id="8073224">Line</span><span class="op" id="8073228">,</span>&nbsp;<span class="ident" id="8073230">want</span><span class="op" id="8073234">.</span><span class="ident" id="8073235">Line</span><span class="op" id="8073239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073245">if</span>&nbsp;<span class="ident" id="8073248">got</span><span class="op" id="8073251">.</span><span class="ident" id="8073252">Column</span>&nbsp;<span class="op" id="8073259">!=</span>&nbsp;<span class="ident" id="8073262">want</span><span class="op" id="8073266">.</span><span class="ident" id="8073267">Column</span>&nbsp;<span class="op" id="8073274">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073278">t</span><span class="op" id="8073279">.</span><span class="ident" id="8073280">Errorf</span><span class="op" id="8073286">(</span><span class="string" id="8073287">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8073317">,</span>&nbsp;<span class="ident" id="8073319">msg</span><span class="op" id="8073322">,</span>&nbsp;<span class="ident" id="8073324">got</span><span class="op" id="8073327">.</span><span class="ident" id="8073328">Column</span><span class="op" id="8073334">,</span>&nbsp;<span class="ident" id="8073336">want</span><span class="op" id="8073340">.</span><span class="ident" id="8073341">Column</span><span class="op" id="8073347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073350">}</span><br>
<span class="lineno"></span><span class="op" id="8073352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073355">func</span>&nbsp;<span class="ident" id="8073360">TestNoPos</span><span class="op" id="8073369">(</span><span class="ident" id="8073370">t</span>&nbsp;<span class="op" id="8073372">*</span><span class="ident" id="8073373">testing</span><span class="op" id="8073380">.</span><span class="ident" id="8073381">T</span><span class="op" id="8073382">)</span>&nbsp;<span class="op" id="8073384">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073387">if</span>&nbsp;<span class="ident" id="8073390">NoPos</span><span class="op" id="8073395">.</span><span class="ident" id="8073396">IsValid</span><span class="op" id="8073403">(</span><span class="op" id="8073404">)</span>&nbsp;<span class="op" id="8073406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073410">t</span><span class="op" id="8073411">.</span><span class="ident" id="8073412">Errorf</span><span class="op" id="8073418">(</span><span class="string" id="8073419">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="8073446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8073452">var</span>&nbsp;<span class="ident" id="8073456">fset</span>&nbsp;<span class="op" id="8073461">*</span><span class="ident" id="8073462">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073471">checkPos</span><span class="op" id="8073479">(</span><span class="ident" id="8073480">t</span><span class="op" id="8073481">,</span>&nbsp;<span class="string" id="8073483">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="8073494">,</span>&nbsp;<span class="ident" id="8073496">fset</span><span class="op" id="8073500">.</span><span class="ident" id="8073501">Position</span><span class="op" id="8073509">(</span><span class="ident" id="8073510">NoPos</span><span class="op" id="8073515">)</span><span class="op" id="8073516">,</span>&nbsp;<span class="ident" id="8073518">Position</span><span class="op" id="8073526">{</span><span class="op" id="8073527">}</span><span class="op" id="8073528">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073531">fset</span>&nbsp;<span class="op" id="8073536">=</span>&nbsp;<span class="ident" id="8073538">NewFileSet</span><span class="op" id="8073548">(</span><span class="op" id="8073549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073552">checkPos</span><span class="op" id="8073560">(</span><span class="ident" id="8073561">t</span><span class="op" id="8073562">,</span>&nbsp;<span class="string" id="8073564">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="8073576">,</span>&nbsp;<span class="ident" id="8073578">fset</span><span class="op" id="8073582">.</span><span class="ident" id="8073583">Position</span><span class="op" id="8073591">(</span><span class="ident" id="8073592">NoPos</span><span class="op" id="8073597">)</span><span class="op" id="8073598">,</span>&nbsp;<span class="ident" id="8073600">Position</span><span class="op" id="8073608">{</span><span class="op" id="8073609">}</span><span class="op" id="8073610">)</span><br>
<span class="lineno"></span><span class="op" id="8073612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073615">var</span>&nbsp;<span class="ident" id="8073619">tests</span>&nbsp;<span class="op" id="8073625">=</span>&nbsp;<span class="op" id="8073627">[</span><span class="op" id="8073628">]</span><span class="keyword" id="8073629">struct</span>&nbsp;<span class="op" id="8073636">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073639">filename</span>&nbsp;<span class="builtintype" id="8073648">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073656">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8073665">[</span><span class="op" id="8073666">]</span><span class="builtintype" id="8073667">byte</span>&nbsp;<span class="comment" id="8073672">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073687">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8073696">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8073701">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073710">[</span><span class="op" id="8073711">]</span><span class="builtintype" id="8073712">int</span><br>
<span class="lineno"></span><span class="op" id="8073716">}</span><span class="op" id="8073717">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073720">{</span><span class="string" id="8073721">&#34;a&#34;</span><span class="op" id="8073724">,</span>&nbsp;<span class="op" id="8073726">[</span><span class="op" id="8073727">]</span><span class="builtintype" id="8073728">byte</span><span class="op" id="8073732">{</span><span class="op" id="8073733">}</span><span class="op" id="8073734">,</span>&nbsp;<span class="num" id="8073736">0</span><span class="op" id="8073737">,</span>&nbsp;<span class="op" id="8073739">[</span><span class="op" id="8073740">]</span><span class="builtintype" id="8073741">int</span><span class="op" id="8073744">{</span><span class="op" id="8073745">}</span><span class="op" id="8073746">}</span><span class="op" id="8073747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073750">{</span><span class="string" id="8073751">&#34;b&#34;</span><span class="op" id="8073754">,</span>&nbsp;<span class="op" id="8073756">[</span><span class="op" id="8073757">]</span><span class="builtintype" id="8073758">byte</span><span class="op" id="8073762">(</span><span class="string" id="8073763">&#34;01234&#34;</span><span class="op" id="8073770">)</span><span class="op" id="8073771">,</span>&nbsp;<span class="num" id="8073773">5</span><span class="op" id="8073774">,</span>&nbsp;<span class="op" id="8073776">[</span><span class="op" id="8073777">]</span><span class="builtintype" id="8073778">int</span><span class="op" id="8073781">{</span><span class="num" id="8073782">0</span><span class="op" id="8073783">}</span><span class="op" id="8073784">}</span><span class="op" id="8073785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073788">{</span><span class="string" id="8073789">&#34;c&#34;</span><span class="op" id="8073792">,</span>&nbsp;<span class="op" id="8073794">[</span><span class="op" id="8073795">]</span><span class="builtintype" id="8073796">byte</span><span class="op" id="8073800">(</span><span class="string" id="8073801">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="8073821">)</span><span class="op" id="8073822">,</span>&nbsp;<span class="num" id="8073824">9</span><span class="op" id="8073825">,</span>&nbsp;<span class="op" id="8073827">[</span><span class="op" id="8073828">]</span><span class="builtintype" id="8073829">int</span><span class="op" id="8073832">{</span><span class="num" id="8073833">0</span><span class="op" id="8073834">,</span>&nbsp;<span class="num" id="8073836">1</span><span class="op" id="8073837">,</span>&nbsp;<span class="num" id="8073839">2</span><span class="op" id="8073840">,</span>&nbsp;<span class="num" id="8073842">3</span><span class="op" id="8073843">,</span>&nbsp;<span class="num" id="8073845">4</span><span class="op" id="8073846">,</span>&nbsp;<span class="num" id="8073848">5</span><span class="op" id="8073849">,</span>&nbsp;<span class="num" id="8073851">6</span><span class="op" id="8073852">,</span>&nbsp;<span class="num" id="8073854">7</span><span class="op" id="8073855">,</span>&nbsp;<span class="num" id="8073857">8</span><span class="op" id="8073858">}</span><span class="op" id="8073859">}</span><span class="op" id="8073860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073863">{</span><span class="string" id="8073864">&#34;d&#34;</span><span class="op" id="8073867">,</span>&nbsp;<span class="builtintype" id="8073869">nil</span><span class="op" id="8073872">,</span>&nbsp;<span class="num" id="8073874">100</span><span class="op" id="8073877">,</span>&nbsp;<span class="op" id="8073879">[</span><span class="op" id="8073880">]</span><span class="builtintype" id="8073881">int</span><span class="op" id="8073884">{</span><span class="num" id="8073885">0</span><span class="op" id="8073886">,</span>&nbsp;<span class="num" id="8073888">5</span><span class="op" id="8073889">,</span>&nbsp;<span class="num" id="8073891">10</span><span class="op" id="8073893">,</span>&nbsp;<span class="num" id="8073895">20</span><span class="op" id="8073897">,</span>&nbsp;<span class="num" id="8073899">30</span><span class="op" id="8073901">,</span>&nbsp;<span class="num" id="8073903">70</span><span class="op" id="8073905">,</span>&nbsp;<span class="num" id="8073907">71</span><span class="op" id="8073909">,</span>&nbsp;<span class="num" id="8073911">72</span><span class="op" id="8073913">,</span>&nbsp;<span class="num" id="8073915">80</span><span class="op" id="8073917">,</span>&nbsp;<span class="num" id="8073919">85</span><span class="op" id="8073921">,</span>&nbsp;<span class="num" id="8073923">90</span><span class="op" id="8073925">,</span>&nbsp;<span class="num" id="8073927">99</span><span class="op" id="8073929">}</span><span class="op" id="8073930">}</span><span class="op" id="8073931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8073934">{</span><span class="string" id="8073935">&#34;e&#34;</span><span class="op" id="8073938">,</span>&nbsp;<span class="builtintype" id="8073940">nil</span><span class="op" id="8073943">,</span>&nbsp;<span class="num" id="8073945">777</span><span class="op" id="8073948">,</span>&nbsp;<span class="op" id="8073950">[</span><span class="op" id="8073951">]</span><span class="builtintype" id="8073952">int</span><span class="op" id="8073955">{</span><span class="num" id="8073956">0</span><span class="op" id="8073957">,</span>&nbsp;<span class="num" id="8073959">80</span><span class="op" id="8073961">,</span>&nbsp;<span class="num" id="8073963">100</span><span class="op" id="8073966">,</span>&nbsp;<span class="num" id="8073968">120</span><span class="op" id="8073971">,</span>&nbsp;<span class="num" id="8073973">130</span><span class="op" id="8073976">,</span>&nbsp;<span class="num" id="8073978">180</span><span class="op" id="8073981">,</span>&nbsp;<span class="num" id="8073983">267</span><span class="op" id="8073986">,</span>&nbsp;<span class="num" id="8073988">455</span><span class="op" id="8073991">,</span>&nbsp;<span class="num" id="8073993">500</span><span class="op" id="8073996">,</span>&nbsp;<span class="num" id="8073998">567</span><span class="op" id="8074001">,</span>&nbsp;<span class="num" id="8074003">620</span><span class="op" id="8074006">}</span><span class="op" id="8074007">}</span><span class="op" id="8074008">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074011">{</span><span class="string" id="8074012">&#34;f&#34;</span><span class="op" id="8074015">,</span>&nbsp;<span class="op" id="8074017">[</span><span class="op" id="8074018">]</span><span class="builtintype" id="8074019">byte</span><span class="op" id="8074023">(</span><span class="string" id="8074024">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="8074053">)</span><span class="op" id="8074054">,</span>&nbsp;<span class="num" id="8074056">23</span><span class="op" id="8074058">,</span>&nbsp;<span class="op" id="8074060">[</span><span class="op" id="8074061">]</span><span class="builtintype" id="8074062">int</span><span class="op" id="8074065">{</span><span class="num" id="8074066">0</span><span class="op" id="8074067">,</span>&nbsp;<span class="num" id="8074069">10</span><span class="op" id="8074071">,</span>&nbsp;<span class="num" id="8074073">11</span><span class="op" id="8074075">}</span><span class="op" id="8074076">}</span><span class="op" id="8074077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074080">{</span><span class="string" id="8074081">&#34;g&#34;</span><span class="op" id="8074084">,</span>&nbsp;<span class="op" id="8074086">[</span><span class="op" id="8074087">]</span><span class="builtintype" id="8074088">byte</span><span class="op" id="8074092">(</span><span class="string" id="8074093">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="8074124">)</span><span class="op" id="8074125">,</span>&nbsp;<span class="num" id="8074127">24</span><span class="op" id="8074129">,</span>&nbsp;<span class="op" id="8074131">[</span><span class="op" id="8074132">]</span><span class="builtintype" id="8074133">int</span><span class="op" id="8074136">{</span><span class="num" id="8074137">0</span><span class="op" id="8074138">,</span>&nbsp;<span class="num" id="8074140">10</span><span class="op" id="8074142">,</span>&nbsp;<span class="num" id="8074144">11</span><span class="op" id="8074146">}</span><span class="op" id="8074147">}</span><span class="op" id="8074148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074151">{</span><span class="string" id="8074152">&#34;h&#34;</span><span class="op" id="8074155">,</span>&nbsp;<span class="op" id="8074157">[</span><span class="op" id="8074158">]</span><span class="builtintype" id="8074159">byte</span><span class="op" id="8074163">(</span><span class="string" id="8074164">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="8074196">)</span><span class="op" id="8074197">,</span>&nbsp;<span class="num" id="8074199">25</span><span class="op" id="8074201">,</span>&nbsp;<span class="op" id="8074203">[</span><span class="op" id="8074204">]</span><span class="builtintype" id="8074205">int</span><span class="op" id="8074208">{</span><span class="num" id="8074209">0</span><span class="op" id="8074210">,</span>&nbsp;<span class="num" id="8074212">10</span><span class="op" id="8074214">,</span>&nbsp;<span class="num" id="8074216">11</span><span class="op" id="8074218">,</span>&nbsp;<span class="num" id="8074220">24</span><span class="op" id="8074222">}</span><span class="op" id="8074223">}</span><span class="op" id="8074224">,</span><br>
<span class="lineno"></span><span class="op" id="8074226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8074229">func</span>&nbsp;<span class="ident" id="8074234">linecol</span><span class="op" id="8074241">(</span><span class="ident" id="8074242">lines</span>&nbsp;<span class="op" id="8074248">[</span><span class="op" id="8074249">]</span><span class="builtintype" id="8074250">int</span><span class="op" id="8074253">,</span>&nbsp;<span class="ident" id="8074255">offs</span>&nbsp;<span class="builtintype" id="8074260">int</span><span class="op" id="8074263">)</span>&nbsp;<span class="op" id="8074265">(</span><span class="builtintype" id="8074266">int</span><span class="op" id="8074269">,</span>&nbsp;<span class="builtintype" id="8074271">int</span><span class="op" id="8074274">)</span>&nbsp;<span class="op" id="8074276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074279">prevLineOffs</span>&nbsp;<span class="op" id="8074292">:=</span>&nbsp;<span class="num" id="8074295">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074298">for</span>&nbsp;<span class="ident" id="8074302">line</span><span class="op" id="8074306">,</span>&nbsp;<span class="ident" id="8074308">lineOffs</span>&nbsp;<span class="op" id="8074317">:=</span>&nbsp;<span class="keyword" id="8074320">range</span>&nbsp;<span class="ident" id="8074326">lines</span>&nbsp;<span class="op" id="8074332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074336">if</span>&nbsp;<span class="ident" id="8074339">offs</span>&nbsp;<span class="op" id="8074344">&lt;</span>&nbsp;<span class="ident" id="8074346">lineOffs</span>&nbsp;<span class="op" id="8074355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074360">return</span>&nbsp;<span class="ident" id="8074367">line</span><span class="op" id="8074371">,</span>&nbsp;<span class="ident" id="8074373">offs</span>&nbsp;<span class="op" id="8074378">-</span>&nbsp;<span class="ident" id="8074380">prevLineOffs</span>&nbsp;<span class="op" id="8074393">+</span>&nbsp;<span class="num" id="8074395">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074403">prevLineOffs</span>&nbsp;<span class="op" id="8074416">=</span>&nbsp;<span class="ident" id="8074418">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074431">return</span>&nbsp;<span class="builtinfunc" id="8074438">len</span><span class="op" id="8074441">(</span><span class="ident" id="8074442">lines</span><span class="op" id="8074447">)</span><span class="op" id="8074448">,</span>&nbsp;<span class="ident" id="8074450">offs</span>&nbsp;<span class="op" id="8074455">-</span>&nbsp;<span class="ident" id="8074457">prevLineOffs</span>&nbsp;<span class="op" id="8074470">+</span>&nbsp;<span class="num" id="8074472">1</span><br>
<span class="lineno"></span><span class="op" id="8074474">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8074477">func</span>&nbsp;<span class="ident" id="8074482">verifyPositions</span><span class="op" id="8074497">(</span><span class="ident" id="8074498">t</span>&nbsp;<span class="op" id="8074500">*</span><span class="ident" id="8074501">testing</span><span class="op" id="8074508">.</span><span class="ident" id="8074509">T</span><span class="op" id="8074510">,</span>&nbsp;<span class="ident" id="8074512">fset</span>&nbsp;<span class="op" id="8074517">*</span><span class="ident" id="8074518">FileSet</span><span class="op" id="8074525">,</span>&nbsp;<span class="ident" id="8074527">f</span>&nbsp;<span class="op" id="8074529">*</span><span class="ident" id="8074530">File</span><span class="op" id="8074534">,</span>&nbsp;<span class="ident" id="8074536">lines</span>&nbsp;<span class="op" id="8074542">[</span><span class="op" id="8074543">]</span><span class="builtintype" id="8074544">int</span><span class="op" id="8074547">)</span>&nbsp;<span class="op" id="8074549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074552">for</span>&nbsp;<span class="ident" id="8074556">offs</span>&nbsp;<span class="op" id="8074561">:=</span>&nbsp;<span class="num" id="8074564">0</span><span class="op" id="8074565">;</span>&nbsp;<span class="ident" id="8074567">offs</span>&nbsp;<span class="op" id="8074572">&lt;</span>&nbsp;<span class="ident" id="8074574">f</span><span class="op" id="8074575">.</span><span class="ident" id="8074576">Size</span><span class="op" id="8074580">(</span><span class="op" id="8074581">)</span><span class="op" id="8074582">;</span>&nbsp;<span class="ident" id="8074584">offs</span><span class="op" id="8074588">++</span>&nbsp;<span class="op" id="8074591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074595">p</span>&nbsp;<span class="op" id="8074597">:=</span>&nbsp;<span class="ident" id="8074600">f</span><span class="op" id="8074601">.</span><span class="ident" id="8074602">Pos</span><span class="op" id="8074605">(</span><span class="ident" id="8074606">offs</span><span class="op" id="8074610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074614">offs2</span>&nbsp;<span class="op" id="8074620">:=</span>&nbsp;<span class="ident" id="8074623">f</span><span class="op" id="8074624">.</span><span class="ident" id="8074625">Offset</span><span class="op" id="8074631">(</span><span class="ident" id="8074632">p</span><span class="op" id="8074633">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8074637">if</span>&nbsp;<span class="ident" id="8074640">offs2</span>&nbsp;<span class="op" id="8074646">!=</span>&nbsp;<span class="ident" id="8074649">offs</span>&nbsp;<span class="op" id="8074654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074659">t</span><span class="op" id="8074660">.</span><span class="ident" id="8074661">Errorf</span><span class="op" id="8074667">(</span><span class="string" id="8074668">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8074704">,</span>&nbsp;<span class="ident" id="8074706">f</span><span class="op" id="8074707">.</span><span class="ident" id="8074708">Name</span><span class="op" id="8074712">(</span><span class="op" id="8074713">)</span><span class="op" id="8074714">,</span>&nbsp;<span class="ident" id="8074716">offs2</span><span class="op" id="8074721">,</span>&nbsp;<span class="ident" id="8074723">offs</span><span class="op" id="8074727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074735">line</span><span class="op" id="8074739">,</span>&nbsp;<span class="ident" id="8074741">col</span>&nbsp;<span class="op" id="8074745">:=</span>&nbsp;<span class="ident" id="8074748">linecol</span><span class="op" id="8074755">(</span><span class="ident" id="8074756">lines</span><span class="op" id="8074761">,</span>&nbsp;<span class="ident" id="8074763">offs</span><span class="op" id="8074767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074771">msg</span>&nbsp;<span class="op" id="8074775">:=</span>&nbsp;<span class="ident" id="8074778">fmt</span><span class="op" id="8074781">.</span><span class="ident" id="8074782">Sprintf</span><span class="op" id="8074789">(</span><span class="string" id="8074790">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="8074814">,</span>&nbsp;<span class="ident" id="8074816">f</span><span class="op" id="8074817">.</span><span class="ident" id="8074818">Name</span><span class="op" id="8074822">(</span><span class="op" id="8074823">)</span><span class="op" id="8074824">,</span>&nbsp;<span class="ident" id="8074826">offs</span><span class="op" id="8074830">,</span>&nbsp;<span class="ident" id="8074832">p</span><span class="op" id="8074833">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074837">checkPos</span><span class="op" id="8074845">(</span><span class="ident" id="8074846">t</span><span class="op" id="8074847">,</span>&nbsp;<span class="ident" id="8074849">msg</span><span class="op" id="8074852">,</span>&nbsp;<span class="ident" id="8074854">f</span><span class="op" id="8074855">.</span><span class="ident" id="8074856">Position</span><span class="op" id="8074864">(</span><span class="ident" id="8074865">f</span><span class="op" id="8074866">.</span><span class="ident" id="8074867">Pos</span><span class="op" id="8074870">(</span><span class="ident" id="8074871">offs</span><span class="op" id="8074875">)</span><span class="op" id="8074876">)</span><span class="op" id="8074877">,</span>&nbsp;<span class="ident" id="8074879">Position</span><span class="op" id="8074887">{</span><span class="ident" id="8074888">f</span><span class="op" id="8074889">.</span><span class="ident" id="8074890">Name</span><span class="op" id="8074894">(</span><span class="op" id="8074895">)</span><span class="op" id="8074896">,</span>&nbsp;<span class="ident" id="8074898">offs</span><span class="op" id="8074902">,</span>&nbsp;<span class="ident" id="8074904">line</span><span class="op" id="8074908">,</span>&nbsp;<span class="ident" id="8074910">col</span><span class="op" id="8074913">}</span><span class="op" id="8074914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8074918">checkPos</span><span class="op" id="8074926">(</span><span class="ident" id="8074927">t</span><span class="op" id="8074928">,</span>&nbsp;<span class="ident" id="8074930">msg</span><span class="op" id="8074933">,</span>&nbsp;<span class="ident" id="8074935">fset</span><span class="op" id="8074939">.</span><span class="ident" id="8074940">Position</span><span class="op" id="8074948">(</span><span class="ident" id="8074949">p</span><span class="op" id="8074950">)</span><span class="op" id="8074951">,</span>&nbsp;<span class="ident" id="8074953">Position</span><span class="op" id="8074961">{</span><span class="ident" id="8074962">f</span><span class="op" id="8074963">.</span><span class="ident" id="8074964">Name</span><span class="op" id="8074968">(</span><span class="op" id="8074969">)</span><span class="op" id="8074970">,</span>&nbsp;<span class="ident" id="8074972">offs</span><span class="op" id="8074976">,</span>&nbsp;<span class="ident" id="8074978">line</span><span class="op" id="8074982">,</span>&nbsp;<span class="ident" id="8074984">col</span><span class="op" id="8074987">}</span><span class="op" id="8074988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8074991">}</span><br>
<span class="lineno"></span><span class="op" id="8074993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8074996">func</span>&nbsp;<span class="ident" id="8075001">makeTestSource</span><span class="op" id="8075015">(</span><span class="ident" id="8075016">size</span>&nbsp;<span class="builtintype" id="8075021">int</span><span class="op" id="8075024">,</span>&nbsp;<span class="ident" id="8075026">lines</span>&nbsp;<span class="op" id="8075032">[</span><span class="op" id="8075033">]</span><span class="builtintype" id="8075034">int</span><span class="op" id="8075037">)</span>&nbsp;<span class="op" id="8075039">[</span><span class="op" id="8075040">]</span><span class="builtintype" id="8075041">byte</span>&nbsp;<span class="op" id="8075046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075049">src</span>&nbsp;<span class="op" id="8075053">:=</span>&nbsp;<span class="builtinfunc" id="8075056">make</span><span class="op" id="8075060">(</span><span class="op" id="8075061">[</span><span class="op" id="8075062">]</span><span class="builtintype" id="8075063">byte</span><span class="op" id="8075067">,</span>&nbsp;<span class="ident" id="8075069">size</span><span class="op" id="8075073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075076">for</span>&nbsp;<span class="ident" id="8075080">_</span><span class="op" id="8075081">,</span>&nbsp;<span class="ident" id="8075083">offs</span>&nbsp;<span class="op" id="8075088">:=</span>&nbsp;<span class="keyword" id="8075091">range</span>&nbsp;<span class="ident" id="8075097">lines</span>&nbsp;<span class="op" id="8075103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075107">if</span>&nbsp;<span class="ident" id="8075110">offs</span>&nbsp;<span class="op" id="8075115">&gt;</span>&nbsp;<span class="num" id="8075117">0</span>&nbsp;<span class="op" id="8075119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075124">src</span><span class="op" id="8075127">[</span><span class="ident" id="8075128">offs</span><span class="op" id="8075132">-</span><span class="num" id="8075133">1</span><span class="op" id="8075134">]</span>&nbsp;<span class="op" id="8075136">=</span>&nbsp;<span class="string" id="8075138">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075151">return</span>&nbsp;<span class="ident" id="8075158">src</span><br>
<span class="lineno"></span><span class="op" id="8075162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8075165">func</span>&nbsp;<span class="ident" id="8075170">TestPositions</span><span class="op" id="8075183">(</span><span class="ident" id="8075184">t</span>&nbsp;<span class="op" id="8075186">*</span><span class="ident" id="8075187">testing</span><span class="op" id="8075194">.</span><span class="ident" id="8075195">T</span><span class="op" id="8075196">)</span>&nbsp;<span class="op" id="8075198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075201">const</span>&nbsp;<span class="ident" id="8075207">delta</span>&nbsp;<span class="op" id="8075213">=</span>&nbsp;<span class="num" id="8075215">7</span>&nbsp;<span class="comment" id="8075217">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075254">fset</span>&nbsp;<span class="op" id="8075259">:=</span>&nbsp;<span class="ident" id="8075262">NewFileSet</span><span class="op" id="8075272">(</span><span class="op" id="8075273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075276">for</span>&nbsp;<span class="ident" id="8075280">_</span><span class="op" id="8075281">,</span>&nbsp;<span class="ident" id="8075283">test</span>&nbsp;<span class="op" id="8075288">:=</span>&nbsp;<span class="keyword" id="8075291">range</span>&nbsp;<span class="ident" id="8075297">tests</span>&nbsp;<span class="op" id="8075303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8075307">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075344">if</span>&nbsp;<span class="ident" id="8075347">test</span><span class="op" id="8075351">.</span><span class="ident" id="8075352">source</span>&nbsp;<span class="op" id="8075359">!=</span>&nbsp;<span class="builtintype" id="8075362">nil</span>&nbsp;<span class="op" id="8075366">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8075369">len</span><span class="op" id="8075372">(</span><span class="ident" id="8075373">test</span><span class="op" id="8075377">.</span><span class="ident" id="8075378">source</span><span class="op" id="8075384">)</span>&nbsp;<span class="op" id="8075386">!=</span>&nbsp;<span class="ident" id="8075389">test</span><span class="op" id="8075393">.</span><span class="ident" id="8075394">size</span>&nbsp;<span class="op" id="8075399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075404">t</span><span class="op" id="8075405">.</span><span class="ident" id="8075406">Errorf</span><span class="op" id="8075412">(</span><span class="string" id="8075413">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8075468">,</span>&nbsp;<span class="ident" id="8075470">test</span><span class="op" id="8075474">.</span><span class="ident" id="8075475">filename</span><span class="op" id="8075483">,</span>&nbsp;<span class="builtinfunc" id="8075485">len</span><span class="op" id="8075488">(</span><span class="ident" id="8075489">test</span><span class="op" id="8075493">.</span><span class="ident" id="8075494">source</span><span class="op" id="8075500">)</span><span class="op" id="8075501">,</span>&nbsp;<span class="ident" id="8075503">test</span><span class="op" id="8075507">.</span><span class="ident" id="8075508">size</span><span class="op" id="8075512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8075521">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075560">f</span>&nbsp;<span class="op" id="8075562">:=</span>&nbsp;<span class="ident" id="8075565">fset</span><span class="op" id="8075569">.</span><span class="ident" id="8075570">AddFile</span><span class="op" id="8075577">(</span><span class="ident" id="8075578">test</span><span class="op" id="8075582">.</span><span class="ident" id="8075583">filename</span><span class="op" id="8075591">,</span>&nbsp;<span class="ident" id="8075593">fset</span><span class="op" id="8075597">.</span><span class="ident" id="8075598">Base</span><span class="op" id="8075602">(</span><span class="op" id="8075603">)</span><span class="op" id="8075604">+</span><span class="ident" id="8075605">delta</span><span class="op" id="8075610">,</span>&nbsp;<span class="ident" id="8075612">test</span><span class="op" id="8075616">.</span><span class="ident" id="8075617">size</span><span class="op" id="8075621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075625">if</span>&nbsp;<span class="ident" id="8075628">f</span><span class="op" id="8075629">.</span><span class="ident" id="8075630">Name</span><span class="op" id="8075634">(</span><span class="op" id="8075635">)</span>&nbsp;<span class="op" id="8075637">!=</span>&nbsp;<span class="ident" id="8075640">test</span><span class="op" id="8075644">.</span><span class="ident" id="8075645">filename</span>&nbsp;<span class="op" id="8075654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075659">t</span><span class="op" id="8075660">.</span><span class="ident" id="8075661">Errorf</span><span class="op" id="8075667">(</span><span class="string" id="8075668">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8075694">,</span>&nbsp;<span class="ident" id="8075696">f</span><span class="op" id="8075697">.</span><span class="ident" id="8075698">Name</span><span class="op" id="8075702">(</span><span class="op" id="8075703">)</span><span class="op" id="8075704">,</span>&nbsp;<span class="ident" id="8075706">test</span><span class="op" id="8075710">.</span><span class="ident" id="8075711">filename</span><span class="op" id="8075719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075727">if</span>&nbsp;<span class="ident" id="8075730">f</span><span class="op" id="8075731">.</span><span class="ident" id="8075732">Size</span><span class="op" id="8075736">(</span><span class="op" id="8075737">)</span>&nbsp;<span class="op" id="8075739">!=</span>&nbsp;<span class="ident" id="8075742">test</span><span class="op" id="8075746">.</span><span class="ident" id="8075747">size</span>&nbsp;<span class="op" id="8075752">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075757">t</span><span class="op" id="8075758">.</span><span class="ident" id="8075759">Errorf</span><span class="op" id="8075765">(</span><span class="string" id="8075766">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8075797">,</span>&nbsp;<span class="ident" id="8075799">f</span><span class="op" id="8075800">.</span><span class="ident" id="8075801">Name</span><span class="op" id="8075805">(</span><span class="op" id="8075806">)</span><span class="op" id="8075807">,</span>&nbsp;<span class="ident" id="8075809">f</span><span class="op" id="8075810">.</span><span class="ident" id="8075811">Size</span><span class="op" id="8075815">(</span><span class="op" id="8075816">)</span><span class="op" id="8075817">,</span>&nbsp;<span class="ident" id="8075819">test</span><span class="op" id="8075823">.</span><span class="ident" id="8075824">size</span><span class="op" id="8075828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075836">if</span>&nbsp;<span class="ident" id="8075839">fset</span><span class="op" id="8075843">.</span><span class="ident" id="8075844">File</span><span class="op" id="8075848">(</span><span class="ident" id="8075849">f</span><span class="op" id="8075850">.</span><span class="ident" id="8075851">Pos</span><span class="op" id="8075854">(</span><span class="num" id="8075855">0</span><span class="op" id="8075856">)</span><span class="op" id="8075857">)</span>&nbsp;<span class="op" id="8075859">!=</span>&nbsp;<span class="ident" id="8075862">f</span>&nbsp;<span class="op" id="8075864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8075869">t</span><span class="op" id="8075870">.</span><span class="ident" id="8075871">Errorf</span><span class="op" id="8075877">(</span><span class="string" id="8075878">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="8075911">,</span>&nbsp;<span class="ident" id="8075913">f</span><span class="op" id="8075914">.</span><span class="ident" id="8075915">Name</span><span class="op" id="8075919">(</span><span class="op" id="8075920">)</span><span class="op" id="8075921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8075925">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8075930">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8075983">for</span>&nbsp;<span class="ident" id="8075987">i</span><span class="op" id="8075988">,</span>&nbsp;<span class="ident" id="8075990">offset</span>&nbsp;<span class="op" id="8075997">:=</span>&nbsp;<span class="keyword" id="8076000">range</span>&nbsp;<span class="ident" id="8076006">test</span><span class="op" id="8076010">.</span><span class="ident" id="8076011">lines</span>&nbsp;<span class="op" id="8076017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076022">f</span><span class="op" id="8076023">.</span><span class="ident" id="8076024">AddLine</span><span class="op" id="8076031">(</span><span class="ident" id="8076032">offset</span><span class="op" id="8076038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076043">if</span>&nbsp;<span class="ident" id="8076046">f</span><span class="op" id="8076047">.</span><span class="ident" id="8076048">LineCount</span><span class="op" id="8076057">(</span><span class="op" id="8076058">)</span>&nbsp;<span class="op" id="8076060">!=</span>&nbsp;<span class="ident" id="8076063">i</span><span class="op" id="8076064">+</span><span class="num" id="8076065">1</span>&nbsp;<span class="op" id="8076067">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076073">t</span><span class="op" id="8076074">.</span><span class="ident" id="8076075">Errorf</span><span class="op" id="8076081">(</span><span class="string" id="8076082">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8076123">,</span>&nbsp;<span class="ident" id="8076125">f</span><span class="op" id="8076126">.</span><span class="ident" id="8076127">Name</span><span class="op" id="8076131">(</span><span class="op" id="8076132">)</span><span class="op" id="8076133">,</span>&nbsp;<span class="ident" id="8076135">f</span><span class="op" id="8076136">.</span><span class="ident" id="8076137">LineCount</span><span class="op" id="8076146">(</span><span class="op" id="8076147">)</span><span class="op" id="8076148">,</span>&nbsp;<span class="ident" id="8076150">i</span><span class="op" id="8076151">+</span><span class="num" id="8076152">1</span><span class="op" id="8076153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8076163">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076216">f</span><span class="op" id="8076217">.</span><span class="ident" id="8076218">AddLine</span><span class="op" id="8076225">(</span><span class="ident" id="8076226">offset</span><span class="op" id="8076232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076237">if</span>&nbsp;<span class="ident" id="8076240">f</span><span class="op" id="8076241">.</span><span class="ident" id="8076242">LineCount</span><span class="op" id="8076251">(</span><span class="op" id="8076252">)</span>&nbsp;<span class="op" id="8076254">!=</span>&nbsp;<span class="ident" id="8076257">i</span><span class="op" id="8076258">+</span><span class="num" id="8076259">1</span>&nbsp;<span class="op" id="8076261">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076267">t</span><span class="op" id="8076268">.</span><span class="ident" id="8076269">Errorf</span><span class="op" id="8076275">(</span><span class="string" id="8076276">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8076327">,</span>&nbsp;<span class="ident" id="8076329">f</span><span class="op" id="8076330">.</span><span class="ident" id="8076331">Name</span><span class="op" id="8076335">(</span><span class="op" id="8076336">)</span><span class="op" id="8076337">,</span>&nbsp;<span class="ident" id="8076339">f</span><span class="op" id="8076340">.</span><span class="ident" id="8076341">LineCount</span><span class="op" id="8076350">(</span><span class="op" id="8076351">)</span><span class="op" id="8076352">,</span>&nbsp;<span class="ident" id="8076354">i</span><span class="op" id="8076355">+</span><span class="num" id="8076356">1</span><span class="op" id="8076357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076367">verifyPositions</span><span class="op" id="8076382">(</span><span class="ident" id="8076383">t</span><span class="op" id="8076384">,</span>&nbsp;<span class="ident" id="8076386">fset</span><span class="op" id="8076390">,</span>&nbsp;<span class="ident" id="8076392">f</span><span class="op" id="8076393">,</span>&nbsp;<span class="ident" id="8076395">test</span><span class="op" id="8076399">.</span><span class="ident" id="8076400">lines</span><span class="op" id="8076405">[</span><span class="num" id="8076406">0</span><span class="op" id="8076407">:</span><span class="ident" id="8076408">i</span><span class="op" id="8076409">+</span><span class="num" id="8076410">1</span><span class="op" id="8076411">]</span><span class="op" id="8076412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8076421">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076475">if</span>&nbsp;<span class="ident" id="8076478">ok</span>&nbsp;<span class="op" id="8076481">:=</span>&nbsp;<span class="ident" id="8076484">f</span><span class="op" id="8076485">.</span><span class="ident" id="8076486">SetLines</span><span class="op" id="8076494">(</span><span class="ident" id="8076495">test</span><span class="op" id="8076499">.</span><span class="ident" id="8076500">lines</span><span class="op" id="8076505">)</span><span class="op" id="8076506">;</span>&nbsp;<span class="op" id="8076508">!</span><span class="ident" id="8076509">ok</span>&nbsp;<span class="op" id="8076512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076517">t</span><span class="op" id="8076518">.</span><span class="ident" id="8076519">Errorf</span><span class="op" id="8076525">(</span><span class="string" id="8076526">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="8076547">,</span>&nbsp;<span class="ident" id="8076549">f</span><span class="op" id="8076550">.</span><span class="ident" id="8076551">Name</span><span class="op" id="8076555">(</span><span class="op" id="8076556">)</span><span class="op" id="8076557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076565">if</span>&nbsp;<span class="ident" id="8076568">f</span><span class="op" id="8076569">.</span><span class="ident" id="8076570">LineCount</span><span class="op" id="8076579">(</span><span class="op" id="8076580">)</span>&nbsp;<span class="op" id="8076582">!=</span>&nbsp;<span class="builtinfunc" id="8076585">len</span><span class="op" id="8076588">(</span><span class="ident" id="8076589">test</span><span class="op" id="8076593">.</span><span class="ident" id="8076594">lines</span><span class="op" id="8076599">)</span>&nbsp;<span class="op" id="8076601">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076606">t</span><span class="op" id="8076607">.</span><span class="ident" id="8076608">Errorf</span><span class="op" id="8076614">(</span><span class="string" id="8076615">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8076657">,</span>&nbsp;<span class="ident" id="8076659">f</span><span class="op" id="8076660">.</span><span class="ident" id="8076661">Name</span><span class="op" id="8076665">(</span><span class="op" id="8076666">)</span><span class="op" id="8076667">,</span>&nbsp;<span class="ident" id="8076669">f</span><span class="op" id="8076670">.</span><span class="ident" id="8076671">LineCount</span><span class="op" id="8076680">(</span><span class="op" id="8076681">)</span><span class="op" id="8076682">,</span>&nbsp;<span class="builtinfunc" id="8076684">len</span><span class="op" id="8076687">(</span><span class="ident" id="8076688">test</span><span class="op" id="8076692">.</span><span class="ident" id="8076693">lines</span><span class="op" id="8076698">)</span><span class="op" id="8076699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076707">verifyPositions</span><span class="op" id="8076722">(</span><span class="ident" id="8076723">t</span><span class="op" id="8076724">,</span>&nbsp;<span class="ident" id="8076726">fset</span><span class="op" id="8076730">,</span>&nbsp;<span class="ident" id="8076732">f</span><span class="op" id="8076733">,</span>&nbsp;<span class="ident" id="8076735">test</span><span class="op" id="8076739">.</span><span class="ident" id="8076740">lines</span><span class="op" id="8076745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8076750">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076814">src</span>&nbsp;<span class="op" id="8076818">:=</span>&nbsp;<span class="ident" id="8076821">test</span><span class="op" id="8076825">.</span><span class="ident" id="8076826">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076835">if</span>&nbsp;<span class="ident" id="8076838">src</span>&nbsp;<span class="op" id="8076842">==</span>&nbsp;<span class="builtintype" id="8076845">nil</span>&nbsp;<span class="op" id="8076849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8076854">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076911">src</span>&nbsp;<span class="op" id="8076915">=</span>&nbsp;<span class="ident" id="8076917">makeTestSource</span><span class="op" id="8076931">(</span><span class="ident" id="8076932">test</span><span class="op" id="8076936">.</span><span class="ident" id="8076937">size</span><span class="op" id="8076941">,</span>&nbsp;<span class="ident" id="8076943">test</span><span class="op" id="8076947">.</span><span class="ident" id="8076948">lines</span><span class="op" id="8076953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8076957">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8076961">f</span><span class="op" id="8076962">.</span><span class="ident" id="8076963">SetLinesForContent</span><span class="op" id="8076981">(</span><span class="ident" id="8076982">src</span><span class="op" id="8076985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8076989">if</span>&nbsp;<span class="ident" id="8076992">f</span><span class="op" id="8076993">.</span><span class="ident" id="8076994">LineCount</span><span class="op" id="8077003">(</span><span class="op" id="8077004">)</span>&nbsp;<span class="op" id="8077006">!=</span>&nbsp;<span class="builtinfunc" id="8077009">len</span><span class="op" id="8077012">(</span><span class="ident" id="8077013">test</span><span class="op" id="8077017">.</span><span class="ident" id="8077018">lines</span><span class="op" id="8077023">)</span>&nbsp;<span class="op" id="8077025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077030">t</span><span class="op" id="8077031">.</span><span class="ident" id="8077032">Errorf</span><span class="op" id="8077038">(</span><span class="string" id="8077039">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8077091">,</span>&nbsp;<span class="ident" id="8077093">f</span><span class="op" id="8077094">.</span><span class="ident" id="8077095">Name</span><span class="op" id="8077099">(</span><span class="op" id="8077100">)</span><span class="op" id="8077101">,</span>&nbsp;<span class="ident" id="8077103">f</span><span class="op" id="8077104">.</span><span class="ident" id="8077105">LineCount</span><span class="op" id="8077114">(</span><span class="op" id="8077115">)</span><span class="op" id="8077116">,</span>&nbsp;<span class="builtinfunc" id="8077118">len</span><span class="op" id="8077121">(</span><span class="ident" id="8077122">test</span><span class="op" id="8077126">.</span><span class="ident" id="8077127">lines</span><span class="op" id="8077132">)</span><span class="op" id="8077133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8077137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077141">verifyPositions</span><span class="op" id="8077156">(</span><span class="ident" id="8077157">t</span><span class="op" id="8077158">,</span>&nbsp;<span class="ident" id="8077160">fset</span><span class="op" id="8077164">,</span>&nbsp;<span class="ident" id="8077166">f</span><span class="op" id="8077167">,</span>&nbsp;<span class="ident" id="8077169">test</span><span class="op" id="8077173">.</span><span class="ident" id="8077174">lines</span><span class="op" id="8077179">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8077182">}</span><br>
<span class="lineno"></span><span class="op" id="8077184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8077187">func</span>&nbsp;<span class="ident" id="8077192">TestLineInfo</span><span class="op" id="8077204">(</span><span class="ident" id="8077205">t</span>&nbsp;<span class="op" id="8077207">*</span><span class="ident" id="8077208">testing</span><span class="op" id="8077215">.</span><span class="ident" id="8077216">T</span><span class="op" id="8077217">)</span>&nbsp;<span class="op" id="8077219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077222">fset</span>&nbsp;<span class="op" id="8077227">:=</span>&nbsp;<span class="ident" id="8077230">NewFileSet</span><span class="op" id="8077240">(</span><span class="op" id="8077241">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077244">f</span>&nbsp;<span class="op" id="8077246">:=</span>&nbsp;<span class="ident" id="8077249">fset</span><span class="op" id="8077253">.</span><span class="ident" id="8077254">AddFile</span><span class="op" id="8077261">(</span><span class="string" id="8077262">&#34;foo&#34;</span><span class="op" id="8077267">,</span>&nbsp;<span class="ident" id="8077269">fset</span><span class="op" id="8077273">.</span><span class="ident" id="8077274">Base</span><span class="op" id="8077278">(</span><span class="op" id="8077279">)</span><span class="op" id="8077280">,</span>&nbsp;<span class="num" id="8077282">500</span><span class="op" id="8077285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077288">lines</span>&nbsp;<span class="op" id="8077294">:=</span>&nbsp;<span class="op" id="8077297">[</span><span class="op" id="8077298">]</span><span class="builtintype" id="8077299">int</span><span class="op" id="8077302">{</span><span class="num" id="8077303">0</span><span class="op" id="8077304">,</span>&nbsp;<span class="num" id="8077306">42</span><span class="op" id="8077308">,</span>&nbsp;<span class="num" id="8077310">77</span><span class="op" id="8077312">,</span>&nbsp;<span class="num" id="8077314">100</span><span class="op" id="8077317">,</span>&nbsp;<span class="num" id="8077319">210</span><span class="op" id="8077322">,</span>&nbsp;<span class="num" id="8077324">220</span><span class="op" id="8077327">,</span>&nbsp;<span class="num" id="8077329">277</span><span class="op" id="8077332">,</span>&nbsp;<span class="num" id="8077334">300</span><span class="op" id="8077337">,</span>&nbsp;<span class="num" id="8077339">333</span><span class="op" id="8077342">,</span>&nbsp;<span class="num" id="8077344">401</span><span class="op" id="8077347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8077350">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8077418">for</span>&nbsp;<span class="ident" id="8077422">_</span><span class="op" id="8077423">,</span>&nbsp;<span class="ident" id="8077425">offs</span>&nbsp;<span class="op" id="8077430">:=</span>&nbsp;<span class="keyword" id="8077433">range</span>&nbsp;<span class="ident" id="8077439">lines</span>&nbsp;<span class="op" id="8077445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077449">f</span><span class="op" id="8077450">.</span><span class="ident" id="8077451">AddLine</span><span class="op" id="8077458">(</span><span class="ident" id="8077459">offs</span><span class="op" id="8077463">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077467">f</span><span class="op" id="8077468">.</span><span class="ident" id="8077469">AddLineInfo</span><span class="op" id="8077480">(</span><span class="ident" id="8077481">offs</span><span class="op" id="8077485">,</span>&nbsp;<span class="string" id="8077487">&#34;bar&#34;</span><span class="op" id="8077492">,</span>&nbsp;<span class="num" id="8077494">42</span><span class="op" id="8077496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8077499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8077502">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8077539">for</span>&nbsp;<span class="ident" id="8077543">offs</span>&nbsp;<span class="op" id="8077548">:=</span>&nbsp;<span class="num" id="8077551">0</span><span class="op" id="8077552">;</span>&nbsp;<span class="ident" id="8077554">offs</span>&nbsp;<span class="op" id="8077559">&lt;=</span>&nbsp;<span class="ident" id="8077562">f</span><span class="op" id="8077563">.</span><span class="ident" id="8077564">Size</span><span class="op" id="8077568">(</span><span class="op" id="8077569">)</span><span class="op" id="8077570">;</span>&nbsp;<span class="ident" id="8077572">offs</span><span class="op" id="8077576">++</span>&nbsp;<span class="op" id="8077579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077583">p</span>&nbsp;<span class="op" id="8077585">:=</span>&nbsp;<span class="ident" id="8077588">f</span><span class="op" id="8077589">.</span><span class="ident" id="8077590">Pos</span><span class="op" id="8077593">(</span><span class="ident" id="8077594">offs</span><span class="op" id="8077598">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077602">_</span><span class="op" id="8077603">,</span>&nbsp;<span class="ident" id="8077605">col</span>&nbsp;<span class="op" id="8077609">:=</span>&nbsp;<span class="ident" id="8077612">linecol</span><span class="op" id="8077619">(</span><span class="ident" id="8077620">lines</span><span class="op" id="8077625">,</span>&nbsp;<span class="ident" id="8077627">offs</span><span class="op" id="8077631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077635">msg</span>&nbsp;<span class="op" id="8077639">:=</span>&nbsp;<span class="ident" id="8077642">fmt</span><span class="op" id="8077645">.</span><span class="ident" id="8077646">Sprintf</span><span class="op" id="8077653">(</span><span class="string" id="8077654">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="8077678">,</span>&nbsp;<span class="ident" id="8077680">f</span><span class="op" id="8077681">.</span><span class="ident" id="8077682">Name</span><span class="op" id="8077686">(</span><span class="op" id="8077687">)</span><span class="op" id="8077688">,</span>&nbsp;<span class="ident" id="8077690">offs</span><span class="op" id="8077694">,</span>&nbsp;<span class="ident" id="8077696">p</span><span class="op" id="8077697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077701">checkPos</span><span class="op" id="8077709">(</span><span class="ident" id="8077710">t</span><span class="op" id="8077711">,</span>&nbsp;<span class="ident" id="8077713">msg</span><span class="op" id="8077716">,</span>&nbsp;<span class="ident" id="8077718">f</span><span class="op" id="8077719">.</span><span class="ident" id="8077720">Position</span><span class="op" id="8077728">(</span><span class="ident" id="8077729">f</span><span class="op" id="8077730">.</span><span class="ident" id="8077731">Pos</span><span class="op" id="8077734">(</span><span class="ident" id="8077735">offs</span><span class="op" id="8077739">)</span><span class="op" id="8077740">)</span><span class="op" id="8077741">,</span>&nbsp;<span class="ident" id="8077743">Position</span><span class="op" id="8077751">{</span><span class="string" id="8077752">&#34;bar&#34;</span><span class="op" id="8077757">,</span>&nbsp;<span class="ident" id="8077759">offs</span><span class="op" id="8077763">,</span>&nbsp;<span class="num" id="8077765">42</span><span class="op" id="8077767">,</span>&nbsp;<span class="ident" id="8077769">col</span><span class="op" id="8077772">}</span><span class="op" id="8077773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077777">checkPos</span><span class="op" id="8077785">(</span><span class="ident" id="8077786">t</span><span class="op" id="8077787">,</span>&nbsp;<span class="ident" id="8077789">msg</span><span class="op" id="8077792">,</span>&nbsp;<span class="ident" id="8077794">fset</span><span class="op" id="8077798">.</span><span class="ident" id="8077799">Position</span><span class="op" id="8077807">(</span><span class="ident" id="8077808">p</span><span class="op" id="8077809">)</span><span class="op" id="8077810">,</span>&nbsp;<span class="ident" id="8077812">Position</span><span class="op" id="8077820">{</span><span class="string" id="8077821">&#34;bar&#34;</span><span class="op" id="8077826">,</span>&nbsp;<span class="ident" id="8077828">offs</span><span class="op" id="8077832">,</span>&nbsp;<span class="num" id="8077834">42</span><span class="op" id="8077836">,</span>&nbsp;<span class="ident" id="8077838">col</span><span class="op" id="8077841">}</span><span class="op" id="8077842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8077845">}</span><br>
<span class="lineno">165</span><span class="op" id="8077847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8077850">func</span>&nbsp;<span class="ident" id="8077855">TestFiles</span><span class="op" id="8077864">(</span><span class="ident" id="8077865">t</span>&nbsp;<span class="op" id="8077867">*</span><span class="ident" id="8077868">testing</span><span class="op" id="8077875">.</span><span class="ident" id="8077876">T</span><span class="op" id="8077877">)</span>&nbsp;<span class="op" id="8077879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077882">fset</span>&nbsp;<span class="op" id="8077887">:=</span>&nbsp;<span class="ident" id="8077890">NewFileSet</span><span class="op" id="8077900">(</span><span class="op" id="8077901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8077904">for</span>&nbsp;<span class="ident" id="8077908">i</span><span class="op" id="8077909">,</span>&nbsp;<span class="ident" id="8077911">test</span>&nbsp;<span class="op" id="8077916">:=</span>&nbsp;<span class="keyword" id="8077919">range</span>&nbsp;<span class="ident" id="8077925">tests</span>&nbsp;<span class="op" id="8077931">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8077935">base</span>&nbsp;<span class="op" id="8077940">:=</span>&nbsp;<span class="ident" id="8077943">fset</span><span class="op" id="8077947">.</span><span class="ident" id="8077948">Base</span><span class="op" id="8077952">(</span><span class="op" id="8077953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8077957">if</span>&nbsp;<span class="ident" id="8077960">i</span><span class="op" id="8077961">%</span><span class="num" id="8077962">2</span>&nbsp;<span class="op" id="8077964">==</span>&nbsp;<span class="num" id="8077967">1</span>&nbsp;<span class="op" id="8077969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8077974">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8078021">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078062">base</span>&nbsp;<span class="op" id="8078067">=</span>&nbsp;<span class="op" id="8078069">-</span><span class="num" id="8078070">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078078">fset</span><span class="op" id="8078082">.</span><span class="ident" id="8078083">AddFile</span><span class="op" id="8078090">(</span><span class="ident" id="8078091">test</span><span class="op" id="8078095">.</span><span class="ident" id="8078096">filename</span><span class="op" id="8078104">,</span>&nbsp;<span class="ident" id="8078106">base</span><span class="op" id="8078110">,</span>&nbsp;<span class="ident" id="8078112">test</span><span class="op" id="8078116">.</span><span class="ident" id="8078117">size</span><span class="op" id="8078121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078125">j</span>&nbsp;<span class="op" id="8078127">:=</span>&nbsp;<span class="num" id="8078130">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078134">fset</span><span class="op" id="8078138">.</span><span class="ident" id="8078139">Iterate</span><span class="op" id="8078146">(</span><span class="keyword" id="8078147">func</span><span class="op" id="8078151">(</span><span class="ident" id="8078152">f</span>&nbsp;<span class="op" id="8078154">*</span><span class="ident" id="8078155">File</span><span class="op" id="8078159">)</span>&nbsp;<span class="builtintype" id="8078161">bool</span>&nbsp;<span class="op" id="8078166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078171">if</span>&nbsp;<span class="ident" id="8078174">f</span><span class="op" id="8078175">.</span><span class="ident" id="8078176">Name</span><span class="op" id="8078180">(</span><span class="op" id="8078181">)</span>&nbsp;<span class="op" id="8078183">!=</span>&nbsp;<span class="ident" id="8078186">tests</span><span class="op" id="8078191">[</span><span class="ident" id="8078192">j</span><span class="op" id="8078193">]</span><span class="op" id="8078194">.</span><span class="ident" id="8078195">filename</span>&nbsp;<span class="op" id="8078204">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078210">t</span><span class="op" id="8078211">.</span><span class="ident" id="8078212">Errorf</span><span class="op" id="8078218">(</span><span class="string" id="8078219">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8078247">,</span>&nbsp;<span class="ident" id="8078249">f</span><span class="op" id="8078250">.</span><span class="ident" id="8078251">Name</span><span class="op" id="8078255">(</span><span class="op" id="8078256">)</span><span class="op" id="8078257">,</span>&nbsp;<span class="ident" id="8078259">tests</span><span class="op" id="8078264">[</span><span class="ident" id="8078265">j</span><span class="op" id="8078266">]</span><span class="op" id="8078267">.</span><span class="ident" id="8078268">filename</span><span class="op" id="8078276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078286">j</span><span class="op" id="8078287">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078293">return</span>&nbsp;<span class="builtintype" id="8078300">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078307">}</span><span class="op" id="8078308">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078312">if</span>&nbsp;<span class="ident" id="8078315">j</span>&nbsp;<span class="op" id="8078317">!=</span>&nbsp;<span class="ident" id="8078320">i</span><span class="op" id="8078321">+</span><span class="num" id="8078322">1</span>&nbsp;<span class="op" id="8078324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078329">t</span><span class="op" id="8078330">.</span><span class="ident" id="8078331">Errorf</span><span class="op" id="8078337">(</span><span class="string" id="8078338">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8078361">,</span>&nbsp;<span class="ident" id="8078363">j</span><span class="op" id="8078364">,</span>&nbsp;<span class="ident" id="8078366">i</span><span class="op" id="8078367">+</span><span class="num" id="8078368">1</span><span class="op" id="8078369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078376">}</span><br>
<span class="lineno"></span><span class="op" id="8078378">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="8078381">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="8078454">func</span>&nbsp;<span class="ident" id="8078459">TestFileSetPastEnd</span><span class="op" id="8078477">(</span><span class="ident" id="8078478">t</span>&nbsp;<span class="op" id="8078480">*</span><span class="ident" id="8078481">testing</span><span class="op" id="8078488">.</span><span class="ident" id="8078489">T</span><span class="op" id="8078490">)</span>&nbsp;<span class="op" id="8078492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078495">fset</span>&nbsp;<span class="op" id="8078500">:=</span>&nbsp;<span class="ident" id="8078503">NewFileSet</span><span class="op" id="8078513">(</span><span class="op" id="8078514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078517">for</span>&nbsp;<span class="ident" id="8078521">_</span><span class="op" id="8078522">,</span>&nbsp;<span class="ident" id="8078524">test</span>&nbsp;<span class="op" id="8078529">:=</span>&nbsp;<span class="keyword" id="8078532">range</span>&nbsp;<span class="ident" id="8078538">tests</span>&nbsp;<span class="op" id="8078544">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078548">fset</span><span class="op" id="8078552">.</span><span class="ident" id="8078553">AddFile</span><span class="op" id="8078560">(</span><span class="ident" id="8078561">test</span><span class="op" id="8078565">.</span><span class="ident" id="8078566">filename</span><span class="op" id="8078574">,</span>&nbsp;<span class="ident" id="8078576">fset</span><span class="op" id="8078580">.</span><span class="ident" id="8078581">Base</span><span class="op" id="8078585">(</span><span class="op" id="8078586">)</span><span class="op" id="8078587">,</span>&nbsp;<span class="ident" id="8078589">test</span><span class="op" id="8078593">.</span><span class="ident" id="8078594">size</span><span class="op" id="8078598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078604">if</span>&nbsp;<span class="ident" id="8078607">f</span>&nbsp;<span class="op" id="8078609">:=</span>&nbsp;<span class="ident" id="8078612">fset</span><span class="op" id="8078616">.</span><span class="ident" id="8078617">File</span><span class="op" id="8078621">(</span><span class="ident" id="8078622">Pos</span><span class="op" id="8078625">(</span><span class="ident" id="8078626">fset</span><span class="op" id="8078630">.</span><span class="ident" id="8078631">Base</span><span class="op" id="8078635">(</span><span class="op" id="8078636">)</span><span class="op" id="8078637">)</span><span class="op" id="8078638">)</span><span class="op" id="8078639">;</span>&nbsp;<span class="ident" id="8078641">f</span>&nbsp;<span class="op" id="8078643">!=</span>&nbsp;<span class="builtintype" id="8078646">nil</span>&nbsp;<span class="op" id="8078650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078654">t</span><span class="op" id="8078655">.</span><span class="ident" id="8078656">Errorf</span><span class="op" id="8078662">(</span><span class="string" id="8078663">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="8078681">,</span>&nbsp;<span class="ident" id="8078683">f</span><span class="op" id="8078684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078687">}</span><br>
<span class="lineno">200</span><span class="op" id="8078689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8078692">func</span>&nbsp;<span class="ident" id="8078697">TestFileSetCacheUnlikely</span><span class="op" id="8078721">(</span><span class="ident" id="8078722">t</span>&nbsp;<span class="op" id="8078724">*</span><span class="ident" id="8078725">testing</span><span class="op" id="8078732">.</span><span class="ident" id="8078733">T</span><span class="op" id="8078734">)</span>&nbsp;<span class="op" id="8078736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078739">fset</span>&nbsp;<span class="op" id="8078744">:=</span>&nbsp;<span class="ident" id="8078747">NewFileSet</span><span class="op" id="8078757">(</span><span class="op" id="8078758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078761">offsets</span>&nbsp;<span class="op" id="8078769">:=</span>&nbsp;<span class="builtinfunc" id="8078772">make</span><span class="op" id="8078776">(</span><span class="keyword" id="8078777">map</span><span class="op" id="8078780">[</span><span class="builtintype" id="8078781">string</span><span class="op" id="8078787">]</span><span class="builtintype" id="8078788">int</span><span class="op" id="8078791">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078794">for</span>&nbsp;<span class="ident" id="8078798">_</span><span class="op" id="8078799">,</span>&nbsp;<span class="ident" id="8078801">test</span>&nbsp;<span class="op" id="8078806">:=</span>&nbsp;<span class="keyword" id="8078809">range</span>&nbsp;<span class="ident" id="8078815">tests</span>&nbsp;<span class="op" id="8078821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078825">offsets</span><span class="op" id="8078832">[</span><span class="ident" id="8078833">test</span><span class="op" id="8078837">.</span><span class="ident" id="8078838">filename</span><span class="op" id="8078846">]</span>&nbsp;<span class="op" id="8078848">=</span>&nbsp;<span class="ident" id="8078850">fset</span><span class="op" id="8078854">.</span><span class="ident" id="8078855">Base</span><span class="op" id="8078859">(</span><span class="op" id="8078860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078864">fset</span><span class="op" id="8078868">.</span><span class="ident" id="8078869">AddFile</span><span class="op" id="8078876">(</span><span class="ident" id="8078877">test</span><span class="op" id="8078881">.</span><span class="ident" id="8078882">filename</span><span class="op" id="8078890">,</span>&nbsp;<span class="ident" id="8078892">fset</span><span class="op" id="8078896">.</span><span class="ident" id="8078897">Base</span><span class="op" id="8078901">(</span><span class="op" id="8078902">)</span><span class="op" id="8078903">,</span>&nbsp;<span class="ident" id="8078905">test</span><span class="op" id="8078909">.</span><span class="ident" id="8078910">size</span><span class="op" id="8078914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8078917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078920">for</span>&nbsp;<span class="ident" id="8078924">file</span><span class="op" id="8078928">,</span>&nbsp;<span class="ident" id="8078930">pos</span>&nbsp;<span class="op" id="8078934">:=</span>&nbsp;<span class="keyword" id="8078937">range</span>&nbsp;<span class="ident" id="8078943">offsets</span>&nbsp;<span class="op" id="8078951">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8078955">f</span>&nbsp;<span class="op" id="8078957">:=</span>&nbsp;<span class="ident" id="8078960">fset</span><span class="op" id="8078964">.</span><span class="ident" id="8078965">File</span><span class="op" id="8078969">(</span><span class="ident" id="8078970">Pos</span><span class="op" id="8078973">(</span><span class="ident" id="8078974">pos</span><span class="op" id="8078977">)</span><span class="op" id="8078978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8078982">if</span>&nbsp;<span class="ident" id="8078985">f</span><span class="op" id="8078986">.</span><span class="ident" id="8078987">Name</span><span class="op" id="8078991">(</span><span class="op" id="8078992">)</span>&nbsp;<span class="op" id="8078994">!=</span>&nbsp;<span class="ident" id="8078997">file</span>&nbsp;<span class="op" id="8079002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079007">t</span><span class="op" id="8079008">.</span><span class="ident" id="8079009">Errorf</span><span class="op" id="8079015">(</span><span class="string" id="8079016">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8079048">,</span>&nbsp;<span class="ident" id="8079050">f</span><span class="op" id="8079051">.</span><span class="ident" id="8079052">Name</span><span class="op" id="8079056">(</span><span class="op" id="8079057">)</span><span class="op" id="8079058">,</span>&nbsp;<span class="ident" id="8079060">pos</span><span class="op" id="8079063">,</span>&nbsp;<span class="ident" id="8079065">file</span><span class="op" id="8079069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079076">}</span><br>
<span class="lineno">215</span><span class="op" id="8079078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8079081">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8079150">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="8079189">func</span>&nbsp;<span class="ident" id="8079194">TestFileSetRace</span><span class="op" id="8079209">(</span><span class="ident" id="8079210">t</span>&nbsp;<span class="op" id="8079212">*</span><span class="ident" id="8079213">testing</span><span class="op" id="8079220">.</span><span class="ident" id="8079221">T</span><span class="op" id="8079222">)</span>&nbsp;<span class="op" id="8079224">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079227">fset</span>&nbsp;<span class="op" id="8079232">:=</span>&nbsp;<span class="ident" id="8079235">NewFileSet</span><span class="op" id="8079245">(</span><span class="op" id="8079246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079249">for</span>&nbsp;<span class="ident" id="8079253">i</span>&nbsp;<span class="op" id="8079255">:=</span>&nbsp;<span class="num" id="8079258">0</span><span class="op" id="8079259">;</span>&nbsp;<span class="ident" id="8079261">i</span>&nbsp;<span class="op" id="8079263">&lt;</span>&nbsp;<span class="num" id="8079265">100</span><span class="op" id="8079268">;</span>&nbsp;<span class="ident" id="8079270">i</span><span class="op" id="8079271">++</span>&nbsp;<span class="op" id="8079274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079278">fset</span><span class="op" id="8079282">.</span><span class="ident" id="8079283">AddFile</span><span class="op" id="8079290">(</span><span class="ident" id="8079291">fmt</span><span class="op" id="8079294">.</span><span class="ident" id="8079295">Sprintf</span><span class="op" id="8079302">(</span><span class="string" id="8079303">&#34;file-%d&#34;</span><span class="op" id="8079312">,</span>&nbsp;<span class="ident" id="8079314">i</span><span class="op" id="8079315">)</span><span class="op" id="8079316">,</span>&nbsp;<span class="ident" id="8079318">fset</span><span class="op" id="8079322">.</span><span class="ident" id="8079323">Base</span><span class="op" id="8079327">(</span><span class="op" id="8079328">)</span><span class="op" id="8079329">,</span>&nbsp;<span class="num" id="8079331">1031</span><span class="op" id="8079335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079341">max</span>&nbsp;<span class="op" id="8079345">:=</span>&nbsp;<span class="builtintype" id="8079348">int32</span><span class="op" id="8079353">(</span><span class="ident" id="8079354">fset</span><span class="op" id="8079358">.</span><span class="ident" id="8079359">Base</span><span class="op" id="8079363">(</span><span class="op" id="8079364">)</span><span class="op" id="8079365">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079368">var</span>&nbsp;<span class="ident" id="8079372">stop</span>&nbsp;<span class="ident" id="8079377">sync</span><span class="op" id="8079381">.</span><span class="ident" id="8079382">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079393">r</span>&nbsp;<span class="op" id="8079395">:=</span>&nbsp;<span class="ident" id="8079398">rand</span><span class="op" id="8079402">.</span><span class="ident" id="8079403">New</span><span class="op" id="8079406">(</span><span class="ident" id="8079407">rand</span><span class="op" id="8079411">.</span><span class="ident" id="8079412">NewSource</span><span class="op" id="8079421">(</span><span class="num" id="8079422">7</span><span class="op" id="8079423">)</span><span class="op" id="8079424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079427">for</span>&nbsp;<span class="ident" id="8079431">i</span>&nbsp;<span class="op" id="8079433">:=</span>&nbsp;<span class="num" id="8079436">0</span><span class="op" id="8079437">;</span>&nbsp;<span class="ident" id="8079439">i</span>&nbsp;<span class="op" id="8079441">&lt;</span>&nbsp;<span class="num" id="8079443">2</span><span class="op" id="8079444">;</span>&nbsp;<span class="ident" id="8079446">i</span><span class="op" id="8079447">++</span>&nbsp;<span class="op" id="8079450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079454">r</span>&nbsp;<span class="op" id="8079456">:=</span>&nbsp;<span class="ident" id="8079459">rand</span><span class="op" id="8079463">.</span><span class="ident" id="8079464">New</span><span class="op" id="8079467">(</span><span class="ident" id="8079468">rand</span><span class="op" id="8079472">.</span><span class="ident" id="8079473">NewSource</span><span class="op" id="8079482">(</span><span class="ident" id="8079483">r</span><span class="op" id="8079484">.</span><span class="ident" id="8079485">Int63</span><span class="op" id="8079490">(</span><span class="op" id="8079491">)</span><span class="op" id="8079492">)</span><span class="op" id="8079493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079497">stop</span><span class="op" id="8079501">.</span><span class="ident" id="8079502">Add</span><span class="op" id="8079505">(</span><span class="num" id="8079506">1</span><span class="op" id="8079507">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079511">go</span>&nbsp;<span class="keyword" id="8079514">func</span><span class="op" id="8079518">(</span><span class="op" id="8079519">)</span>&nbsp;<span class="op" id="8079521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079526">for</span>&nbsp;<span class="ident" id="8079530">i</span>&nbsp;<span class="op" id="8079532">:=</span>&nbsp;<span class="num" id="8079535">0</span><span class="op" id="8079536">;</span>&nbsp;<span class="ident" id="8079538">i</span>&nbsp;<span class="op" id="8079540">&lt;</span>&nbsp;<span class="num" id="8079542">1000</span><span class="op" id="8079546">;</span>&nbsp;<span class="ident" id="8079548">i</span><span class="op" id="8079549">++</span>&nbsp;<span class="op" id="8079552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079558">fset</span><span class="op" id="8079562">.</span><span class="ident" id="8079563">Position</span><span class="op" id="8079571">(</span><span class="ident" id="8079572">Pos</span><span class="op" id="8079575">(</span><span class="ident" id="8079576">r</span><span class="op" id="8079577">.</span><span class="ident" id="8079578">Int31n</span><span class="op" id="8079584">(</span><span class="ident" id="8079585">max</span><span class="op" id="8079588">)</span><span class="op" id="8079589">)</span><span class="op" id="8079590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079600">stop</span><span class="op" id="8079604">.</span><span class="ident" id="8079605">Done</span><span class="op" id="8079609">(</span><span class="op" id="8079610">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079614">}</span><span class="op" id="8079615">(</span><span class="op" id="8079616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8079619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079622">stop</span><span class="op" id="8079626">.</span><span class="ident" id="8079627">Wait</span><span class="op" id="8079631">(</span><span class="op" id="8079632">)</span><br>
<span class="lineno"></span><span class="op" id="8079634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8079637">func</span>&nbsp;<span class="ident" id="8079642">TestPositionFor</span><span class="op" id="8079657">(</span><span class="ident" id="8079658">t</span>&nbsp;<span class="op" id="8079660">*</span><span class="ident" id="8079661">testing</span><span class="op" id="8079668">.</span><span class="ident" id="8079669">T</span><span class="op" id="8079670">)</span>&nbsp;<span class="op" id="8079672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079675">src</span>&nbsp;<span class="op" id="8079679">:=</span>&nbsp;<span class="op" id="8079682">[</span><span class="op" id="8079683">]</span><span class="builtintype" id="8079684">byte</span><span class="op" id="8079688">(</span><span class="string" id="8079689">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="8079738">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079742">const</span>&nbsp;<span class="ident" id="8079748">filename</span>&nbsp;<span class="op" id="8079757">=</span>&nbsp;<span class="string" id="8079759">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079766">fset</span>&nbsp;<span class="op" id="8079771">:=</span>&nbsp;<span class="ident" id="8079774">NewFileSet</span><span class="op" id="8079784">(</span><span class="op" id="8079785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079788">f</span>&nbsp;<span class="op" id="8079790">:=</span>&nbsp;<span class="ident" id="8079793">fset</span><span class="op" id="8079797">.</span><span class="ident" id="8079798">AddFile</span><span class="op" id="8079805">(</span><span class="ident" id="8079806">filename</span><span class="op" id="8079814">,</span>&nbsp;<span class="ident" id="8079816">fset</span><span class="op" id="8079820">.</span><span class="ident" id="8079821">Base</span><span class="op" id="8079825">(</span><span class="op" id="8079826">)</span><span class="op" id="8079827">,</span>&nbsp;<span class="builtinfunc" id="8079829">len</span><span class="op" id="8079832">(</span><span class="ident" id="8079833">src</span><span class="op" id="8079836">)</span><span class="op" id="8079837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079840">f</span><span class="op" id="8079841">.</span><span class="ident" id="8079842">SetLinesForContent</span><span class="op" id="8079860">(</span><span class="ident" id="8079861">src</span><span class="op" id="8079864">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8079868">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8079893">for</span>&nbsp;<span class="ident" id="8079897">i</span><span class="op" id="8079898">,</span>&nbsp;<span class="ident" id="8079900">offs</span>&nbsp;<span class="op" id="8079905">:=</span>&nbsp;<span class="keyword" id="8079908">range</span>&nbsp;<span class="ident" id="8079914">f</span><span class="op" id="8079915">.</span><span class="ident" id="8079916">lines</span>&nbsp;<span class="op" id="8079922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079926">got1</span>&nbsp;<span class="op" id="8079931">:=</span>&nbsp;<span class="ident" id="8079934">f</span><span class="op" id="8079935">.</span><span class="ident" id="8079936">PositionFor</span><span class="op" id="8079947">(</span><span class="ident" id="8079948">f</span><span class="op" id="8079949">.</span><span class="ident" id="8079950">Pos</span><span class="op" id="8079953">(</span><span class="ident" id="8079954">offs</span><span class="op" id="8079958">)</span><span class="op" id="8079959">,</span>&nbsp;<span class="builtintype" id="8079961">false</span><span class="op" id="8079966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8079970">got2</span>&nbsp;<span class="op" id="8079975">:=</span>&nbsp;<span class="ident" id="8079978">f</span><span class="op" id="8079979">.</span><span class="ident" id="8079980">PositionFor</span><span class="op" id="8079991">(</span><span class="ident" id="8079992">f</span><span class="op" id="8079993">.</span><span class="ident" id="8079994">Pos</span><span class="op" id="8079997">(</span><span class="ident" id="8079998">offs</span><span class="op" id="8080002">)</span><span class="op" id="8080003">,</span>&nbsp;<span class="builtintype" id="8080005">true</span><span class="op" id="8080009">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080013">got3</span>&nbsp;<span class="op" id="8080018">:=</span>&nbsp;<span class="ident" id="8080021">f</span><span class="op" id="8080022">.</span><span class="ident" id="8080023">Position</span><span class="op" id="8080031">(</span><span class="ident" id="8080032">f</span><span class="op" id="8080033">.</span><span class="ident" id="8080034">Pos</span><span class="op" id="8080037">(</span><span class="ident" id="8080038">offs</span><span class="op" id="8080042">)</span><span class="op" id="8080043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080047">want</span>&nbsp;<span class="op" id="8080052">:=</span>&nbsp;<span class="ident" id="8080055">Position</span><span class="op" id="8080063">{</span><span class="ident" id="8080064">filename</span><span class="op" id="8080072">,</span>&nbsp;<span class="ident" id="8080074">offs</span><span class="op" id="8080078">,</span>&nbsp;<span class="ident" id="8080080">i</span>&nbsp;<span class="op" id="8080082">+</span>&nbsp;<span class="num" id="8080084">1</span><span class="op" id="8080085">,</span>&nbsp;<span class="num" id="8080087">1</span><span class="op" id="8080088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080092">checkPos</span><span class="op" id="8080100">(</span><span class="ident" id="8080101">t</span><span class="op" id="8080102">,</span>&nbsp;<span class="string" id="8080104">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="8080131">,</span>&nbsp;<span class="ident" id="8080133">got1</span><span class="op" id="8080137">,</span>&nbsp;<span class="ident" id="8080139">want</span><span class="op" id="8080143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080147">checkPos</span><span class="op" id="8080155">(</span><span class="ident" id="8080156">t</span><span class="op" id="8080157">,</span>&nbsp;<span class="string" id="8080159">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="8080184">,</span>&nbsp;<span class="ident" id="8080186">got2</span><span class="op" id="8080190">,</span>&nbsp;<span class="ident" id="8080192">want</span><span class="op" id="8080196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080200">checkPos</span><span class="op" id="8080208">(</span><span class="ident" id="8080209">t</span><span class="op" id="8080210">,</span>&nbsp;<span class="string" id="8080212">&#34;1.&nbsp;Position&#34;</span><span class="op" id="8080225">,</span>&nbsp;<span class="ident" id="8080227">got3</span><span class="op" id="8080231">,</span>&nbsp;<span class="ident" id="8080233">want</span><span class="op" id="8080237">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8080240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8080244">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8080289">const</span>&nbsp;<span class="ident" id="8080295">l1</span><span class="op" id="8080297">,</span>&nbsp;<span class="ident" id="8080299">l2</span>&nbsp;<span class="op" id="8080302">=</span>&nbsp;<span class="num" id="8080304">5</span><span class="op" id="8080305">,</span>&nbsp;<span class="num" id="8080307">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080310">f</span><span class="op" id="8080311">.</span><span class="ident" id="8080312">AddLineInfo</span><span class="op" id="8080323">(</span><span class="ident" id="8080324">f</span><span class="op" id="8080325">.</span><span class="ident" id="8080326">lines</span><span class="op" id="8080331">[</span><span class="ident" id="8080332">l1</span><span class="op" id="8080334">-</span><span class="num" id="8080335">1</span><span class="op" id="8080336">]</span><span class="op" id="8080337">,</span>&nbsp;<span class="string" id="8080339">&#34;&#34;</span><span class="op" id="8080341">,</span>&nbsp;<span class="num" id="8080343">100</span><span class="op" id="8080346">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080349">f</span><span class="op" id="8080350">.</span><span class="ident" id="8080351">AddLineInfo</span><span class="op" id="8080362">(</span><span class="ident" id="8080363">f</span><span class="op" id="8080364">.</span><span class="ident" id="8080365">lines</span><span class="op" id="8080370">[</span><span class="ident" id="8080371">l2</span><span class="op" id="8080373">-</span><span class="num" id="8080374">1</span><span class="op" id="8080375">]</span><span class="op" id="8080376">,</span>&nbsp;<span class="string" id="8080378">&#34;bar&#34;</span><span class="op" id="8080383">,</span>&nbsp;<span class="num" id="8080385">3</span><span class="op" id="8080386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8080390">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8080441">for</span>&nbsp;<span class="ident" id="8080445">i</span><span class="op" id="8080446">,</span>&nbsp;<span class="ident" id="8080448">offs</span>&nbsp;<span class="op" id="8080453">:=</span>&nbsp;<span class="keyword" id="8080456">range</span>&nbsp;<span class="ident" id="8080462">f</span><span class="op" id="8080463">.</span><span class="ident" id="8080464">lines</span>&nbsp;<span class="op" id="8080470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080474">got1</span>&nbsp;<span class="op" id="8080479">:=</span>&nbsp;<span class="ident" id="8080482">f</span><span class="op" id="8080483">.</span><span class="ident" id="8080484">PositionFor</span><span class="op" id="8080495">(</span><span class="ident" id="8080496">f</span><span class="op" id="8080497">.</span><span class="ident" id="8080498">Pos</span><span class="op" id="8080501">(</span><span class="ident" id="8080502">offs</span><span class="op" id="8080506">)</span><span class="op" id="8080507">,</span>&nbsp;<span class="builtintype" id="8080509">false</span><span class="op" id="8080514">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080518">want</span>&nbsp;<span class="op" id="8080523">:=</span>&nbsp;<span class="ident" id="8080526">Position</span><span class="op" id="8080534">{</span><span class="ident" id="8080535">filename</span><span class="op" id="8080543">,</span>&nbsp;<span class="ident" id="8080545">offs</span><span class="op" id="8080549">,</span>&nbsp;<span class="ident" id="8080551">i</span>&nbsp;<span class="op" id="8080553">+</span>&nbsp;<span class="num" id="8080555">1</span><span class="op" id="8080556">,</span>&nbsp;<span class="num" id="8080558">1</span><span class="op" id="8080559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080563">checkPos</span><span class="op" id="8080571">(</span><span class="ident" id="8080572">t</span><span class="op" id="8080573">,</span>&nbsp;<span class="string" id="8080575">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="8080602">,</span>&nbsp;<span class="ident" id="8080604">got1</span><span class="op" id="8080608">,</span>&nbsp;<span class="ident" id="8080610">want</span><span class="op" id="8080614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8080617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8080621">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8080668">for</span>&nbsp;<span class="ident" id="8080672">i</span><span class="op" id="8080673">,</span>&nbsp;<span class="ident" id="8080675">offs</span>&nbsp;<span class="op" id="8080680">:=</span>&nbsp;<span class="keyword" id="8080683">range</span>&nbsp;<span class="ident" id="8080689">f</span><span class="op" id="8080690">.</span><span class="ident" id="8080691">lines</span>&nbsp;<span class="op" id="8080697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080701">got2</span>&nbsp;<span class="op" id="8080706">:=</span>&nbsp;<span class="ident" id="8080709">f</span><span class="op" id="8080710">.</span><span class="ident" id="8080711">PositionFor</span><span class="op" id="8080722">(</span><span class="ident" id="8080723">f</span><span class="op" id="8080724">.</span><span class="ident" id="8080725">Pos</span><span class="op" id="8080728">(</span><span class="ident" id="8080729">offs</span><span class="op" id="8080733">)</span><span class="op" id="8080734">,</span>&nbsp;<span class="builtintype" id="8080736">true</span><span class="op" id="8080740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080744">got3</span>&nbsp;<span class="op" id="8080749">:=</span>&nbsp;<span class="ident" id="8080752">f</span><span class="op" id="8080753">.</span><span class="ident" id="8080754">Position</span><span class="op" id="8080762">(</span><span class="ident" id="8080763">f</span><span class="op" id="8080764">.</span><span class="ident" id="8080765">Pos</span><span class="op" id="8080768">(</span><span class="ident" id="8080769">offs</span><span class="op" id="8080773">)</span><span class="op" id="8080774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080778">want</span>&nbsp;<span class="op" id="8080783">:=</span>&nbsp;<span class="ident" id="8080786">Position</span><span class="op" id="8080794">{</span><span class="ident" id="8080795">filename</span><span class="op" id="8080803">,</span>&nbsp;<span class="ident" id="8080805">offs</span><span class="op" id="8080809">,</span>&nbsp;<span class="ident" id="8080811">i</span>&nbsp;<span class="op" id="8080813">+</span>&nbsp;<span class="num" id="8080815">1</span><span class="op" id="8080816">,</span>&nbsp;<span class="num" id="8080818">1</span><span class="op" id="8080819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8080823">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080870">line</span>&nbsp;<span class="op" id="8080875">:=</span>&nbsp;<span class="ident" id="8080878">want</span><span class="op" id="8080882">.</span><span class="ident" id="8080883">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8080890">if</span>&nbsp;<span class="ident" id="8080893">i</span><span class="op" id="8080894">+</span><span class="num" id="8080895">1</span>&nbsp;<span class="op" id="8080897">&gt;=</span>&nbsp;<span class="ident" id="8080900">l1</span>&nbsp;<span class="op" id="8080903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080908">want</span><span class="op" id="8080912">.</span><span class="ident" id="8080913">Filename</span>&nbsp;<span class="op" id="8080922">=</span>&nbsp;<span class="string" id="8080924">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080930">want</span><span class="op" id="8080934">.</span><span class="ident" id="8080935">Line</span>&nbsp;<span class="op" id="8080940">=</span>&nbsp;<span class="ident" id="8080942">line</span>&nbsp;<span class="op" id="8080947">-</span>&nbsp;<span class="ident" id="8080949">l1</span>&nbsp;<span class="op" id="8080952">+</span>&nbsp;<span class="num" id="8080954">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8080960">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8080964">if</span>&nbsp;<span class="ident" id="8080967">i</span><span class="op" id="8080968">+</span><span class="num" id="8080969">1</span>&nbsp;<span class="op" id="8080971">&gt;=</span>&nbsp;<span class="ident" id="8080974">l2</span>&nbsp;<span class="op" id="8080977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8080982">want</span><span class="op" id="8080986">.</span><span class="ident" id="8080987">Filename</span>&nbsp;<span class="op" id="8080996">=</span>&nbsp;<span class="string" id="8080998">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081007">want</span><span class="op" id="8081011">.</span><span class="ident" id="8081012">Line</span>&nbsp;<span class="op" id="8081017">=</span>&nbsp;<span class="ident" id="8081019">line</span>&nbsp;<span class="op" id="8081024">-</span>&nbsp;<span class="ident" id="8081026">l2</span>&nbsp;<span class="op" id="8081029">+</span>&nbsp;<span class="num" id="8081031">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8081035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081039">checkPos</span><span class="op" id="8081047">(</span><span class="ident" id="8081048">t</span><span class="op" id="8081049">,</span>&nbsp;<span class="string" id="8081051">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="8081076">,</span>&nbsp;<span class="ident" id="8081078">got2</span><span class="op" id="8081082">,</span>&nbsp;<span class="ident" id="8081084">want</span><span class="op" id="8081088">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8081092">checkPos</span><span class="op" id="8081100">(</span><span class="ident" id="8081101">t</span><span class="op" id="8081102">,</span>&nbsp;<span class="string" id="8081104">&#34;3.&nbsp;Position&#34;</span><span class="op" id="8081117">,</span>&nbsp;<span class="ident" id="8081119">got3</span><span class="op" id="8081123">,</span>&nbsp;<span class="ident" id="8081125">want</span><span class="op" id="8081129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8081132">}</span><br>
<span class="lineno"></span><span class="op" id="8081134">}</span>
</div>
</body>
</html>
