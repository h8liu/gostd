<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html" class="current">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1479742">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1479797">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1479851">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1479902">package</span>&nbsp;<span class="ident" id="1479910">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1479919">import</span>&nbsp;<span class="string" id="1479926">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1479936">//&nbsp;Breakpoint&nbsp;executes&nbsp;a&nbsp;breakpoint&nbsp;trap.</span><br>
<span class="lineno">10</span><span class="keyword" id="1479978">func</span>&nbsp;<span class="ident" id="1479983">Breakpoint</span><span class="op" id="1479993">(</span><span class="op" id="1479994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1479997">//&nbsp;LockOSThread&nbsp;wires&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;to&nbsp;its&nbsp;current&nbsp;operating&nbsp;system&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1480081">//&nbsp;Until&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;exits&nbsp;or&nbsp;calls&nbsp;UnlockOSThread,&nbsp;it&nbsp;will&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="1480158">//&nbsp;execute&nbsp;in&nbsp;that&nbsp;thread,&nbsp;and&nbsp;no&nbsp;other&nbsp;goroutine&nbsp;can.</span><br>
<span class="lineno">15</span><span class="keyword" id="1480213">func</span>&nbsp;<span class="ident" id="1480218">LockOSThread</span><span class="op" id="1480230">(</span><span class="op" id="1480231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1480234">//&nbsp;UnlockOSThread&nbsp;unwires&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;from&nbsp;its&nbsp;fixed&nbsp;operating&nbsp;system&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="1480322">//&nbsp;If&nbsp;the&nbsp;calling&nbsp;goroutine&nbsp;has&nbsp;not&nbsp;called&nbsp;LockOSThread,&nbsp;UnlockOSThread&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="keyword" id="1480406">func</span>&nbsp;<span class="ident" id="1480411">UnlockOSThread</span><span class="op" id="1480425">(</span><span class="op" id="1480426">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1480429">//&nbsp;GOMAXPROCS&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;CPUs&nbsp;that&nbsp;can&nbsp;be&nbsp;executing</span><br>
<span class="lineno"></span><span class="comment" id="1480497">//&nbsp;simultaneously&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.&nbsp;&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;1,&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1480572">//&nbsp;change&nbsp;the&nbsp;current&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="1480603">//&nbsp;The&nbsp;number&nbsp;of&nbsp;logical&nbsp;CPUs&nbsp;on&nbsp;the&nbsp;local&nbsp;machine&nbsp;can&nbsp;be&nbsp;queried&nbsp;with&nbsp;NumCPU.</span><br>
<span class="lineno">25</span><span class="comment" id="1480682">//&nbsp;This&nbsp;call&nbsp;will&nbsp;go&nbsp;away&nbsp;when&nbsp;the&nbsp;scheduler&nbsp;improves.</span><br>
<span class="lineno"></span><span class="keyword" id="1480737">func</span>&nbsp;<span class="ident" id="1480742">GOMAXPROCS</span><span class="op" id="1480752">(</span><span class="ident" id="1480753">n</span>&nbsp;<span class="builtintype" id="1480755">int</span><span class="op" id="1480758">)</span>&nbsp;<span class="builtintype" id="1480760">int</span>&nbsp;<span class="op" id="1480764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480767">if</span>&nbsp;<span class="ident" id="1480770">n</span>&nbsp;<span class="op" id="1480772">&gt;</span>&nbsp;<span class="ident" id="1480774">_MaxGomaxprocs</span>&nbsp;<span class="op" id="1480789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480793">n</span>&nbsp;<span class="op" id="1480795">=</span>&nbsp;<span class="ident" id="1480797">_MaxGomaxprocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480813">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480816">lock</span><span class="op" id="1480820">(</span><span class="op" id="1480821">&amp;</span><span class="ident" id="1480822">sched</span><span class="op" id="1480827">.</span><span class="ident" id="1480828">lock</span><span class="op" id="1480832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480835">ret</span>&nbsp;<span class="op" id="1480839">:=</span>&nbsp;<span class="builtintype" id="1480842">int</span><span class="op" id="1480845">(</span><span class="ident" id="1480846">gomaxprocs</span><span class="op" id="1480856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480859">unlock</span><span class="op" id="1480865">(</span><span class="op" id="1480866">&amp;</span><span class="ident" id="1480867">sched</span><span class="op" id="1480872">.</span><span class="ident" id="1480873">lock</span><span class="op" id="1480877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480880">if</span>&nbsp;<span class="ident" id="1480883">n</span>&nbsp;<span class="op" id="1480885">&lt;=</span>&nbsp;<span class="num" id="1480888">0</span>&nbsp;<span class="op" id="1480890">||</span>&nbsp;<span class="ident" id="1480893">n</span>&nbsp;<span class="op" id="1480895">==</span>&nbsp;<span class="ident" id="1480898">ret</span>&nbsp;<span class="op" id="1480902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1480906">return</span>&nbsp;<span class="ident" id="1480913">ret</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1480918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480922">semacquire</span><span class="op" id="1480932">(</span><span class="op" id="1480933">&amp;</span><span class="ident" id="1480934">worldsema</span><span class="op" id="1480943">,</span>&nbsp;<span class="builtintype" id="1480945">false</span><span class="op" id="1480950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480953">gp</span>&nbsp;<span class="op" id="1480956">:=</span>&nbsp;<span class="ident" id="1480959">getg</span><span class="op" id="1480963">(</span><span class="op" id="1480964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480967">gp</span><span class="op" id="1480969">.</span><span class="ident" id="1480970">m</span><span class="op" id="1480971">.</span><span class="ident" id="1480972">gcing</span>&nbsp;<span class="op" id="1480978">=</span>&nbsp;<span class="num" id="1480980">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1480983">onM</span><span class="op" id="1480986">(</span><span class="ident" id="1480987">stoptheworld</span><span class="op" id="1480999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1481003">//&nbsp;newprocs&nbsp;will&nbsp;be&nbsp;processed&nbsp;by&nbsp;starttheworld</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481051">newprocs</span>&nbsp;<span class="op" id="1481060">=</span>&nbsp;<span class="builtintype" id="1481062">int32</span><span class="op" id="1481067">(</span><span class="ident" id="1481068">n</span><span class="op" id="1481069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481073">gp</span><span class="op" id="1481075">.</span><span class="ident" id="1481076">m</span><span class="op" id="1481077">.</span><span class="ident" id="1481078">gcing</span>&nbsp;<span class="op" id="1481084">=</span>&nbsp;<span class="num" id="1481086">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481089">semrelease</span><span class="op" id="1481099">(</span><span class="op" id="1481100">&amp;</span><span class="ident" id="1481101">worldsema</span><span class="op" id="1481110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481113">onM</span><span class="op" id="1481116">(</span><span class="ident" id="1481117">starttheworld</span><span class="op" id="1481130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481133">return</span>&nbsp;<span class="ident" id="1481140">ret</span><br>
<span class="lineno"></span><span class="op" id="1481144">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="1481147">//&nbsp;NumCPU&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;logical&nbsp;CPUs&nbsp;on&nbsp;the&nbsp;local&nbsp;machine.</span><br>
<span class="lineno"></span><span class="keyword" id="1481214">func</span>&nbsp;<span class="ident" id="1481219">NumCPU</span><span class="op" id="1481225">(</span><span class="op" id="1481226">)</span>&nbsp;<span class="builtintype" id="1481228">int</span>&nbsp;<span class="op" id="1481232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481235">return</span>&nbsp;<span class="builtintype" id="1481242">int</span><span class="op" id="1481245">(</span><span class="ident" id="1481246">ncpu</span><span class="op" id="1481250">)</span><br>
<span class="lineno"></span><span class="op" id="1481252">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1481255">//&nbsp;NumCgoCall&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cgo&nbsp;calls&nbsp;made&nbsp;by&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="1481330">func</span>&nbsp;<span class="ident" id="1481335">NumCgoCall</span><span class="op" id="1481345">(</span><span class="op" id="1481346">)</span>&nbsp;<span class="ident" id="1481348">int64</span>&nbsp;<span class="op" id="1481354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481357">var</span>&nbsp;<span class="ident" id="1481361">n</span>&nbsp;<span class="ident" id="1481363">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481370">for</span>&nbsp;<span class="ident" id="1481374">mp</span>&nbsp;<span class="op" id="1481377">:=</span>&nbsp;<span class="op" id="1481380">(</span><span class="op" id="1481381">*</span><span class="ident" id="1481382">m</span><span class="op" id="1481383">)</span><span class="op" id="1481384">(</span><span class="ident" id="1481385">atomicloadp</span><span class="op" id="1481396">(</span><span class="ident" id="1481397">unsafe</span><span class="op" id="1481403">.</span><span class="ident" id="1481404">Pointer</span><span class="op" id="1481411">(</span><span class="op" id="1481412">&amp;</span><span class="ident" id="1481413">allm</span><span class="op" id="1481417">)</span><span class="op" id="1481418">)</span><span class="op" id="1481419">)</span><span class="op" id="1481420">;</span>&nbsp;<span class="ident" id="1481422">mp</span>&nbsp;<span class="op" id="1481425">!=</span>&nbsp;<span class="builtintype" id="1481428">nil</span><span class="op" id="1481431">;</span>&nbsp;<span class="ident" id="1481433">mp</span>&nbsp;<span class="op" id="1481436">=</span>&nbsp;<span class="ident" id="1481438">mp</span><span class="op" id="1481440">.</span><span class="ident" id="1481441">alllink</span>&nbsp;<span class="op" id="1481449">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1481453">n</span>&nbsp;<span class="op" id="1481455">+=</span>&nbsp;<span class="ident" id="1481458">int64</span><span class="op" id="1481463">(</span><span class="ident" id="1481464">mp</span><span class="op" id="1481466">.</span><span class="ident" id="1481467">ncgocall</span><span class="op" id="1481475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1481478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481481">return</span>&nbsp;<span class="ident" id="1481488">n</span><br>
<span class="lineno"></span><span class="op" id="1481490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1481493">//&nbsp;NumGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;currently&nbsp;exist.</span><br>
<span class="lineno"></span><span class="keyword" id="1481564">func</span>&nbsp;<span class="ident" id="1481569">NumGoroutine</span><span class="op" id="1481581">(</span><span class="op" id="1481582">)</span>&nbsp;<span class="builtintype" id="1481584">int</span>&nbsp;<span class="op" id="1481588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1481591">return</span>&nbsp;<span class="builtintype" id="1481598">int</span><span class="op" id="1481601">(</span><span class="ident" id="1481602">gcount</span><span class="op" id="1481608">(</span><span class="op" id="1481609">)</span><span class="op" id="1481610">)</span><br>
<span class="lineno"></span><span class="op" id="1481612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="1481615">func</span>&nbsp;<span class="ident" id="1481620">gcount</span><span class="op" id="1481626">(</span><span class="op" id="1481627">)</span>&nbsp;<span class="builtintype" id="1481629">int32</span>
</div>
</body>
</html>
