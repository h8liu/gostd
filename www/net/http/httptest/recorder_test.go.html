<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6729064">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6729119">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6729173">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6729224">package</span>&nbsp;<span class="ident" id="6729232">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6729242">import</span>&nbsp;<span class="op" id="6729249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6729252">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6729259">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6729271">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6729281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6729284">func</span>&nbsp;<span class="ident" id="6729289">TestRecorder</span><span class="op" id="6729301">(</span><span class="ident" id="6729302">t</span>&nbsp;<span class="op" id="6729304">*</span><span class="ident" id="6729305">testing</span><span class="op" id="6729312">.</span><span class="ident" id="6729313">T</span><span class="op" id="6729314">)</span>&nbsp;<span class="op" id="6729316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729319">type</span>&nbsp;<span class="ident" id="6729324">checkFunc</span>&nbsp;<span class="keyword" id="6729334">func</span><span class="op" id="6729338">(</span><span class="op" id="6729339">*</span><span class="ident" id="6729340">ResponseRecorder</span><span class="op" id="6729356">)</span>&nbsp;<span class="builtintype" id="6729358">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729365">check</span>&nbsp;<span class="op" id="6729371">:=</span>&nbsp;<span class="keyword" id="6729374">func</span><span class="op" id="6729378">(</span><span class="ident" id="6729379">fns</span>&nbsp;<span class="op" id="6729383">...</span><span class="ident" id="6729386">checkFunc</span><span class="op" id="6729395">)</span>&nbsp;<span class="op" id="6729397">[</span><span class="op" id="6729398">]</span><span class="ident" id="6729399">checkFunc</span>&nbsp;<span class="op" id="6729409">{</span>&nbsp;<span class="keyword" id="6729411">return</span>&nbsp;<span class="ident" id="6729418">fns</span>&nbsp;<span class="op" id="6729422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729426">hasStatus</span>&nbsp;<span class="op" id="6729436">:=</span>&nbsp;<span class="keyword" id="6729439">func</span><span class="op" id="6729443">(</span><span class="ident" id="6729444">wantCode</span>&nbsp;<span class="builtintype" id="6729453">int</span><span class="op" id="6729456">)</span>&nbsp;<span class="ident" id="6729458">checkFunc</span>&nbsp;<span class="op" id="6729468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729472">return</span>&nbsp;<span class="keyword" id="6729479">func</span><span class="op" id="6729483">(</span><span class="ident" id="6729484">rec</span>&nbsp;<span class="op" id="6729488">*</span><span class="ident" id="6729489">ResponseRecorder</span><span class="op" id="6729505">)</span>&nbsp;<span class="builtintype" id="6729507">error</span>&nbsp;<span class="op" id="6729513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729518">if</span>&nbsp;<span class="ident" id="6729521">rec</span><span class="op" id="6729524">.</span><span class="ident" id="6729525">Code</span>&nbsp;<span class="op" id="6729530">!=</span>&nbsp;<span class="ident" id="6729533">wantCode</span>&nbsp;<span class="op" id="6729542">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729548">return</span>&nbsp;<span class="ident" id="6729555">fmt</span><span class="op" id="6729558">.</span><span class="ident" id="6729559">Errorf</span><span class="op" id="6729565">(</span><span class="string" id="6729566">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6729588">,</span>&nbsp;<span class="ident" id="6729590">rec</span><span class="op" id="6729593">.</span><span class="ident" id="6729594">Code</span><span class="op" id="6729598">,</span>&nbsp;<span class="ident" id="6729600">wantCode</span><span class="op" id="6729608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729618">return</span>&nbsp;<span class="ident" id="6729625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729634">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729637">hasContents</span>&nbsp;<span class="op" id="6729649">:=</span>&nbsp;<span class="keyword" id="6729652">func</span><span class="op" id="6729656">(</span><span class="ident" id="6729657">want</span>&nbsp;<span class="builtintype" id="6729662">string</span><span class="op" id="6729668">)</span>&nbsp;<span class="ident" id="6729670">checkFunc</span>&nbsp;<span class="op" id="6729680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729684">return</span>&nbsp;<span class="keyword" id="6729691">func</span><span class="op" id="6729695">(</span><span class="ident" id="6729696">rec</span>&nbsp;<span class="op" id="6729700">*</span><span class="ident" id="6729701">ResponseRecorder</span><span class="op" id="6729717">)</span>&nbsp;<span class="builtintype" id="6729719">error</span>&nbsp;<span class="op" id="6729725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729730">if</span>&nbsp;<span class="ident" id="6729733">rec</span><span class="op" id="6729736">.</span><span class="ident" id="6729737">Body</span><span class="op" id="6729741">.</span><span class="ident" id="6729742">String</span><span class="op" id="6729748">(</span><span class="op" id="6729749">)</span>&nbsp;<span class="op" id="6729751">!=</span>&nbsp;<span class="ident" id="6729754">want</span>&nbsp;<span class="op" id="6729759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729765">return</span>&nbsp;<span class="ident" id="6729772">fmt</span><span class="op" id="6729775">.</span><span class="ident" id="6729776">Errorf</span><span class="op" id="6729782">(</span><span class="string" id="6729783">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6729804">,</span>&nbsp;<span class="ident" id="6729806">rec</span><span class="op" id="6729809">.</span><span class="ident" id="6729810">Body</span><span class="op" id="6729814">.</span><span class="ident" id="6729815">String</span><span class="op" id="6729821">(</span><span class="op" id="6729822">)</span><span class="op" id="6729823">,</span>&nbsp;<span class="ident" id="6729825">want</span><span class="op" id="6729829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729834">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729839">return</span>&nbsp;<span class="ident" id="6729846">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6729855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6729858">hasFlush</span>&nbsp;<span class="op" id="6729867">:=</span>&nbsp;<span class="keyword" id="6729870">func</span><span class="op" id="6729874">(</span><span class="ident" id="6729875">want</span>&nbsp;<span class="builtintype" id="6729880">bool</span><span class="op" id="6729884">)</span>&nbsp;<span class="ident" id="6729886">checkFunc</span>&nbsp;<span class="op" id="6729896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729900">return</span>&nbsp;<span class="keyword" id="6729907">func</span><span class="op" id="6729911">(</span><span class="ident" id="6729912">rec</span>&nbsp;<span class="op" id="6729916">*</span><span class="ident" id="6729917">ResponseRecorder</span><span class="op" id="6729933">)</span>&nbsp;<span class="builtintype" id="6729935">error</span>&nbsp;<span class="op" id="6729941">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729946">if</span>&nbsp;<span class="ident" id="6729949">rec</span><span class="op" id="6729952">.</span><span class="ident" id="6729953">Flushed</span>&nbsp;<span class="op" id="6729961">!=</span>&nbsp;<span class="ident" id="6729964">want</span>&nbsp;<span class="op" id="6729969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6729975">return</span>&nbsp;<span class="ident" id="6729982">fmt</span><span class="op" id="6729985">.</span><span class="ident" id="6729986">Errorf</span><span class="op" id="6729992">(</span><span class="string" id="6729993">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6730016">,</span>&nbsp;<span class="ident" id="6730018">rec</span><span class="op" id="6730021">.</span><span class="ident" id="6730022">Flushed</span><span class="op" id="6730029">,</span>&nbsp;<span class="ident" id="6730031">want</span><span class="op" id="6730035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730045">return</span>&nbsp;<span class="ident" id="6730052">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730058">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730065">tests</span>&nbsp;<span class="op" id="6730071">:=</span>&nbsp;<span class="op" id="6730074">[</span><span class="op" id="6730075">]</span><span class="keyword" id="6730076">struct</span>&nbsp;<span class="op" id="6730083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730087">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6730094">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730103">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6730110">func</span><span class="op" id="6730114">(</span><span class="ident" id="6730115">w</span>&nbsp;<span class="ident" id="6730117">http</span><span class="op" id="6730121">.</span><span class="ident" id="6730122">ResponseWriter</span><span class="op" id="6730136">,</span>&nbsp;<span class="ident" id="6730138">r</span>&nbsp;<span class="op" id="6730140">*</span><span class="ident" id="6730141">http</span><span class="op" id="6730145">.</span><span class="ident" id="6730146">Request</span><span class="op" id="6730153">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730157">checks</span>&nbsp;<span class="op" id="6730164">[</span><span class="op" id="6730165">]</span><span class="ident" id="6730166">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730177">}</span><span class="op" id="6730178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6730187">&#34;200&nbsp;default&#34;</span><span class="op" id="6730200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730205">func</span><span class="op" id="6730209">(</span><span class="ident" id="6730210">w</span>&nbsp;<span class="ident" id="6730212">http</span><span class="op" id="6730216">.</span><span class="ident" id="6730217">ResponseWriter</span><span class="op" id="6730231">,</span>&nbsp;<span class="ident" id="6730233">r</span>&nbsp;<span class="op" id="6730235">*</span><span class="ident" id="6730236">http</span><span class="op" id="6730240">.</span><span class="ident" id="6730241">Request</span><span class="op" id="6730248">)</span>&nbsp;<span class="op" id="6730250">{</span><span class="op" id="6730251">}</span><span class="op" id="6730252">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730257">check</span><span class="op" id="6730262">(</span><span class="ident" id="6730263">hasStatus</span><span class="op" id="6730272">(</span><span class="num" id="6730273">200</span><span class="op" id="6730276">)</span><span class="op" id="6730277">,</span>&nbsp;<span class="ident" id="6730279">hasContents</span><span class="op" id="6730290">(</span><span class="string" id="6730291">&#34;&#34;</span><span class="op" id="6730293">)</span><span class="op" id="6730294">)</span><span class="op" id="6730295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730299">}</span><span class="op" id="6730300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6730309">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="6730326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730331">func</span><span class="op" id="6730335">(</span><span class="ident" id="6730336">w</span>&nbsp;<span class="ident" id="6730338">http</span><span class="op" id="6730342">.</span><span class="ident" id="6730343">ResponseWriter</span><span class="op" id="6730357">,</span>&nbsp;<span class="ident" id="6730359">r</span>&nbsp;<span class="op" id="6730361">*</span><span class="ident" id="6730362">http</span><span class="op" id="6730366">.</span><span class="ident" id="6730367">Request</span><span class="op" id="6730374">)</span>&nbsp;<span class="op" id="6730376">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730382">w</span><span class="op" id="6730383">.</span><span class="ident" id="6730384">WriteHeader</span><span class="op" id="6730395">(</span><span class="num" id="6730396">201</span><span class="op" id="6730399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730405">w</span><span class="op" id="6730406">.</span><span class="ident" id="6730407">WriteHeader</span><span class="op" id="6730418">(</span><span class="num" id="6730419">202</span><span class="op" id="6730422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730428">w</span><span class="op" id="6730429">.</span><span class="ident" id="6730430">Write</span><span class="op" id="6730435">(</span><span class="op" id="6730436">[</span><span class="op" id="6730437">]</span><span class="builtintype" id="6730438">byte</span><span class="op" id="6730442">(</span><span class="string" id="6730443">&#34;hi&#34;</span><span class="op" id="6730447">)</span><span class="op" id="6730448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730453">}</span><span class="op" id="6730454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730459">check</span><span class="op" id="6730464">(</span><span class="ident" id="6730465">hasStatus</span><span class="op" id="6730474">(</span><span class="num" id="6730475">201</span><span class="op" id="6730478">)</span><span class="op" id="6730479">,</span>&nbsp;<span class="ident" id="6730481">hasContents</span><span class="op" id="6730492">(</span><span class="string" id="6730493">&#34;hi&#34;</span><span class="op" id="6730497">)</span><span class="op" id="6730498">)</span><span class="op" id="6730499">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730503">}</span><span class="op" id="6730504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6730513">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="6730530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730535">func</span><span class="op" id="6730539">(</span><span class="ident" id="6730540">w</span>&nbsp;<span class="ident" id="6730542">http</span><span class="op" id="6730546">.</span><span class="ident" id="6730547">ResponseWriter</span><span class="op" id="6730561">,</span>&nbsp;<span class="ident" id="6730563">r</span>&nbsp;<span class="op" id="6730565">*</span><span class="ident" id="6730566">http</span><span class="op" id="6730570">.</span><span class="ident" id="6730571">Request</span><span class="op" id="6730578">)</span>&nbsp;<span class="op" id="6730580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730586">w</span><span class="op" id="6730587">.</span><span class="ident" id="6730588">Write</span><span class="op" id="6730593">(</span><span class="op" id="6730594">[</span><span class="op" id="6730595">]</span><span class="builtintype" id="6730596">byte</span><span class="op" id="6730600">(</span><span class="string" id="6730601">&#34;hi&nbsp;first&#34;</span><span class="op" id="6730611">)</span><span class="op" id="6730612">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730618">w</span><span class="op" id="6730619">.</span><span class="ident" id="6730620">WriteHeader</span><span class="op" id="6730631">(</span><span class="num" id="6730632">201</span><span class="op" id="6730635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730641">w</span><span class="op" id="6730642">.</span><span class="ident" id="6730643">WriteHeader</span><span class="op" id="6730654">(</span><span class="num" id="6730655">202</span><span class="op" id="6730658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730663">}</span><span class="op" id="6730664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730669">check</span><span class="op" id="6730674">(</span><span class="ident" id="6730675">hasStatus</span><span class="op" id="6730684">(</span><span class="num" id="6730685">200</span><span class="op" id="6730688">)</span><span class="op" id="6730689">,</span>&nbsp;<span class="ident" id="6730691">hasContents</span><span class="op" id="6730702">(</span><span class="string" id="6730703">&#34;hi&nbsp;first&#34;</span><span class="op" id="6730713">)</span><span class="op" id="6730714">,</span>&nbsp;<span class="ident" id="6730716">hasFlush</span><span class="op" id="6730724">(</span><span class="ident" id="6730725">false</span><span class="op" id="6730730">)</span><span class="op" id="6730731">)</span><span class="op" id="6730732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730736">}</span><span class="op" id="6730737">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6730746">&#34;flush&#34;</span><span class="op" id="6730753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730758">func</span><span class="op" id="6730762">(</span><span class="ident" id="6730763">w</span>&nbsp;<span class="ident" id="6730765">http</span><span class="op" id="6730769">.</span><span class="ident" id="6730770">ResponseWriter</span><span class="op" id="6730784">,</span>&nbsp;<span class="ident" id="6730786">r</span>&nbsp;<span class="op" id="6730788">*</span><span class="ident" id="6730789">http</span><span class="op" id="6730793">.</span><span class="ident" id="6730794">Request</span><span class="op" id="6730801">)</span>&nbsp;<span class="op" id="6730803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730809">w</span><span class="op" id="6730810">.</span><span class="op" id="6730811">(</span><span class="ident" id="6730812">http</span><span class="op" id="6730816">.</span><span class="ident" id="6730817">Flusher</span><span class="op" id="6730824">)</span><span class="op" id="6730825">.</span><span class="ident" id="6730826">Flush</span><span class="op" id="6730831">(</span><span class="op" id="6730832">)</span>&nbsp;<span class="comment" id="6730834">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730858">w</span><span class="op" id="6730859">.</span><span class="ident" id="6730860">WriteHeader</span><span class="op" id="6730871">(</span><span class="num" id="6730872">201</span><span class="op" id="6730875">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730880">}</span><span class="op" id="6730881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730886">check</span><span class="op" id="6730891">(</span><span class="ident" id="6730892">hasStatus</span><span class="op" id="6730901">(</span><span class="num" id="6730902">200</span><span class="op" id="6730905">)</span><span class="op" id="6730906">,</span>&nbsp;<span class="ident" id="6730908">hasFlush</span><span class="op" id="6730916">(</span><span class="ident" id="6730917">true</span><span class="op" id="6730921">)</span><span class="op" id="6730922">)</span><span class="op" id="6730923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730927">}</span><span class="op" id="6730928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6730931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6730934">r</span><span class="op" id="6730935">,</span>&nbsp;<span class="ident" id="6730937">_</span>&nbsp;<span class="op" id="6730939">:=</span>&nbsp;<span class="ident" id="6730942">http</span><span class="op" id="6730946">.</span><span class="ident" id="6730947">NewRequest</span><span class="op" id="6730957">(</span><span class="string" id="6730958">&#34;GET&#34;</span><span class="op" id="6730963">,</span>&nbsp;<span class="string" id="6730965">&#34;http://foo.com/&#34;</span><span class="op" id="6730982">,</span>&nbsp;<span class="ident" id="6730984">nil</span><span class="op" id="6730987">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6730990">for</span>&nbsp;<span class="ident" id="6730994">_</span><span class="op" id="6730995">,</span>&nbsp;<span class="ident" id="6730997">tt</span>&nbsp;<span class="op" id="6731000">:=</span>&nbsp;<span class="keyword" id="6731003">range</span>&nbsp;<span class="ident" id="6731009">tests</span>&nbsp;<span class="op" id="6731015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731019">h</span>&nbsp;<span class="op" id="6731021">:=</span>&nbsp;<span class="ident" id="6731024">http</span><span class="op" id="6731028">.</span><span class="ident" id="6731029">HandlerFunc</span><span class="op" id="6731040">(</span><span class="ident" id="6731041">tt</span><span class="op" id="6731043">.</span><span class="ident" id="6731044">h</span><span class="op" id="6731045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731049">rec</span>&nbsp;<span class="op" id="6731053">:=</span>&nbsp;<span class="ident" id="6731056">NewRecorder</span><span class="op" id="6731067">(</span><span class="op" id="6731068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731072">h</span><span class="op" id="6731073">.</span><span class="ident" id="6731074">ServeHTTP</span><span class="op" id="6731083">(</span><span class="ident" id="6731084">rec</span><span class="op" id="6731087">,</span>&nbsp;<span class="ident" id="6731089">r</span><span class="op" id="6731090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731094">for</span>&nbsp;<span class="ident" id="6731098">_</span><span class="op" id="6731099">,</span>&nbsp;<span class="ident" id="6731101">check</span>&nbsp;<span class="op" id="6731107">:=</span>&nbsp;<span class="keyword" id="6731110">range</span>&nbsp;<span class="ident" id="6731116">tt</span><span class="op" id="6731118">.</span><span class="ident" id="6731119">checks</span>&nbsp;<span class="op" id="6731126">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6731131">if</span>&nbsp;<span class="ident" id="6731134">err</span>&nbsp;<span class="op" id="6731138">:=</span>&nbsp;<span class="ident" id="6731141">check</span><span class="op" id="6731146">(</span><span class="ident" id="6731147">rec</span><span class="op" id="6731150">)</span><span class="op" id="6731151">;</span>&nbsp;<span class="ident" id="6731153">err</span>&nbsp;<span class="op" id="6731157">!=</span>&nbsp;<span class="ident" id="6731160">nil</span>&nbsp;<span class="op" id="6731164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6731170">t</span><span class="op" id="6731171">.</span><span class="ident" id="6731172">Errorf</span><span class="op" id="6731178">(</span><span class="string" id="6731179">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6731187">,</span>&nbsp;<span class="ident" id="6731189">tt</span><span class="op" id="6731191">.</span><span class="ident" id="6731192">name</span><span class="op" id="6731196">,</span>&nbsp;<span class="ident" id="6731198">err</span><span class="op" id="6731201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6731213">}</span><br>
<span class="lineno">90</span><span class="op" id="6731215">}</span>
</div>
</body>
</html>
