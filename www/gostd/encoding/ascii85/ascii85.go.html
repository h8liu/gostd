<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5742461">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5742516">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5742570">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5742621">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5742677">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="5742754">package</span>&nbsp;<span class="ident" id="5742762">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5742771">import</span>&nbsp;<span class="op" id="5742778">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5742781">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5742787">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5742797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5742800">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5742819">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="5742878">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="5742941">//</span><br>
<span class="lineno"></span><span class="comment" id="5742944">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5743008">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5743074">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5743146">//</span><br>
<span class="lineno">25</span><span class="comment" id="5743149">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5743213">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="5743243">func</span>&nbsp;<span class="ident" id="5743248">Encode</span><span class="op" id="5743254">(</span><span class="ident" id="5743255">dst</span><span class="op" id="5743258">,</span>&nbsp;<span class="ident" id="5743260">src</span>&nbsp;<span class="op" id="5743264">[</span><span class="op" id="5743265">]</span><span class="builtintype" id="5743266">byte</span><span class="op" id="5743270">)</span>&nbsp;<span class="builtintype" id="5743272">int</span>&nbsp;<span class="op" id="5743276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743279">if</span>&nbsp;<span class="builtinfunc" id="5743282">len</span><span class="op" id="5743285">(</span><span class="ident" id="5743286">src</span><span class="op" id="5743289">)</span>&nbsp;<span class="op" id="5743291">==</span>&nbsp;<span class="num" id="5743294">0</span>&nbsp;<span class="op" id="5743296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743300">return</span>&nbsp;<span class="num" id="5743307">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743314">n</span>&nbsp;<span class="op" id="5743316">:=</span>&nbsp;<span class="num" id="5743319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743322">for</span>&nbsp;<span class="builtinfunc" id="5743326">len</span><span class="op" id="5743329">(</span><span class="ident" id="5743330">src</span><span class="op" id="5743333">)</span>&nbsp;<span class="op" id="5743335">&gt;</span>&nbsp;<span class="num" id="5743337">0</span>&nbsp;<span class="op" id="5743339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743343">dst</span><span class="op" id="5743346">[</span><span class="num" id="5743347">0</span><span class="op" id="5743348">]</span>&nbsp;<span class="op" id="5743350">=</span>&nbsp;<span class="num" id="5743352">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743356">dst</span><span class="op" id="5743359">[</span><span class="num" id="5743360">1</span><span class="op" id="5743361">]</span>&nbsp;<span class="op" id="5743363">=</span>&nbsp;<span class="num" id="5743365">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743369">dst</span><span class="op" id="5743372">[</span><span class="num" id="5743373">2</span><span class="op" id="5743374">]</span>&nbsp;<span class="op" id="5743376">=</span>&nbsp;<span class="num" id="5743378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743382">dst</span><span class="op" id="5743385">[</span><span class="num" id="5743386">3</span><span class="op" id="5743387">]</span>&nbsp;<span class="op" id="5743389">=</span>&nbsp;<span class="num" id="5743391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743395">dst</span><span class="op" id="5743398">[</span><span class="num" id="5743399">4</span><span class="op" id="5743400">]</span>&nbsp;<span class="op" id="5743402">=</span>&nbsp;<span class="num" id="5743404">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743409">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743472">var</span>&nbsp;<span class="ident" id="5743476">v</span>&nbsp;<span class="builtintype" id="5743478">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743487">switch</span>&nbsp;<span class="builtinfunc" id="5743494">len</span><span class="op" id="5743497">(</span><span class="ident" id="5743498">src</span><span class="op" id="5743501">)</span>&nbsp;<span class="op" id="5743503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743507">default</span><span class="op" id="5743514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743519">v</span>&nbsp;<span class="op" id="5743521">|=</span>&nbsp;<span class="builtintype" id="5743524">uint32</span><span class="op" id="5743530">(</span><span class="ident" id="5743531">src</span><span class="op" id="5743534">[</span><span class="num" id="5743535">3</span><span class="op" id="5743536">]</span><span class="op" id="5743537">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743542">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743556">case</span>&nbsp;<span class="num" id="5743561">3</span><span class="op" id="5743562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743567">v</span>&nbsp;<span class="op" id="5743569">|=</span>&nbsp;<span class="builtintype" id="5743572">uint32</span><span class="op" id="5743578">(</span><span class="ident" id="5743579">src</span><span class="op" id="5743582">[</span><span class="num" id="5743583">2</span><span class="op" id="5743584">]</span><span class="op" id="5743585">)</span>&nbsp;<span class="op" id="5743587">&lt;&lt;</span>&nbsp;<span class="num" id="5743590">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743595">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743609">case</span>&nbsp;<span class="num" id="5743614">2</span><span class="op" id="5743615">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743620">v</span>&nbsp;<span class="op" id="5743622">|=</span>&nbsp;<span class="builtintype" id="5743625">uint32</span><span class="op" id="5743631">(</span><span class="ident" id="5743632">src</span><span class="op" id="5743635">[</span><span class="num" id="5743636">1</span><span class="op" id="5743637">]</span><span class="op" id="5743638">)</span>&nbsp;<span class="op" id="5743640">&lt;&lt;</span>&nbsp;<span class="num" id="5743643">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743649">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743663">case</span>&nbsp;<span class="num" id="5743668">1</span><span class="op" id="5743669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743674">v</span>&nbsp;<span class="op" id="5743676">|=</span>&nbsp;<span class="builtintype" id="5743679">uint32</span><span class="op" id="5743685">(</span><span class="ident" id="5743686">src</span><span class="op" id="5743689">[</span><span class="num" id="5743690">0</span><span class="op" id="5743691">]</span><span class="op" id="5743692">)</span>&nbsp;<span class="op" id="5743694">&lt;&lt;</span>&nbsp;<span class="num" id="5743697">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743702">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743707">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743754">if</span>&nbsp;<span class="ident" id="5743757">v</span>&nbsp;<span class="op" id="5743759">==</span>&nbsp;<span class="num" id="5743762">0</span>&nbsp;<span class="op" id="5743764">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5743767">len</span><span class="op" id="5743770">(</span><span class="ident" id="5743771">src</span><span class="op" id="5743774">)</span>&nbsp;<span class="op" id="5743776">&gt;=</span>&nbsp;<span class="num" id="5743779">4</span>&nbsp;<span class="op" id="5743781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743786">dst</span><span class="op" id="5743789">[</span><span class="num" id="5743790">0</span><span class="op" id="5743791">]</span>&nbsp;<span class="op" id="5743793">=</span>&nbsp;<span class="string" id="5743795">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743802">dst</span>&nbsp;<span class="op" id="5743806">=</span>&nbsp;<span class="ident" id="5743808">dst</span><span class="op" id="5743811">[</span><span class="num" id="5743812">1</span><span class="op" id="5743813">:</span><span class="op" id="5743814">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743819">src</span>&nbsp;<span class="op" id="5743823">=</span>&nbsp;<span class="ident" id="5743825">src</span><span class="op" id="5743828">[</span><span class="num" id="5743829">4</span><span class="op" id="5743830">:</span><span class="op" id="5743831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743836">n</span><span class="op" id="5743837">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743843">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743859">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5743907">for</span>&nbsp;<span class="ident" id="5743911">i</span>&nbsp;<span class="op" id="5743913">:=</span>&nbsp;<span class="num" id="5743916">4</span><span class="op" id="5743917">;</span>&nbsp;<span class="ident" id="5743919">i</span>&nbsp;<span class="op" id="5743921">&gt;=</span>&nbsp;<span class="num" id="5743924">0</span><span class="op" id="5743925">;</span>&nbsp;<span class="ident" id="5743927">i</span><span class="op" id="5743928">--</span>&nbsp;<span class="op" id="5743931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743936">dst</span><span class="op" id="5743939">[</span><span class="ident" id="5743940">i</span><span class="op" id="5743941">]</span>&nbsp;<span class="op" id="5743943">=</span>&nbsp;<span class="string" id="5743945">&#39;!&#39;</span>&nbsp;<span class="op" id="5743949">+</span>&nbsp;<span class="builtintype" id="5743951">byte</span><span class="op" id="5743955">(</span><span class="ident" id="5743956">v</span><span class="op" id="5743957">%</span><span class="num" id="5743958">85</span><span class="op" id="5743960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5743965">v</span>&nbsp;<span class="op" id="5743967">/=</span>&nbsp;<span class="num" id="5743970">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5743975">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5743980">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744038">m</span>&nbsp;<span class="op" id="5744040">:=</span>&nbsp;<span class="num" id="5744043">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744047">if</span>&nbsp;<span class="builtinfunc" id="5744050">len</span><span class="op" id="5744053">(</span><span class="ident" id="5744054">src</span><span class="op" id="5744057">)</span>&nbsp;<span class="op" id="5744059">&lt;</span>&nbsp;<span class="num" id="5744061">4</span>&nbsp;<span class="op" id="5744063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744068">m</span>&nbsp;<span class="op" id="5744070">-=</span>&nbsp;<span class="num" id="5744073">4</span>&nbsp;<span class="op" id="5744075">-</span>&nbsp;<span class="builtinfunc" id="5744077">len</span><span class="op" id="5744080">(</span><span class="ident" id="5744081">src</span><span class="op" id="5744084">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744089">src</span>&nbsp;<span class="op" id="5744093">=</span>&nbsp;<span class="ident" id="5744095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744101">}</span>&nbsp;<span class="keyword" id="5744103">else</span>&nbsp;<span class="op" id="5744108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744113">src</span>&nbsp;<span class="op" id="5744117">=</span>&nbsp;<span class="ident" id="5744119">src</span><span class="op" id="5744122">[</span><span class="num" id="5744123">4</span><span class="op" id="5744124">:</span><span class="op" id="5744125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744133">dst</span>&nbsp;<span class="op" id="5744137">=</span>&nbsp;<span class="ident" id="5744139">dst</span><span class="op" id="5744142">[</span><span class="ident" id="5744143">m</span><span class="op" id="5744144">:</span><span class="op" id="5744145">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744149">n</span>&nbsp;<span class="op" id="5744151">+=</span>&nbsp;<span class="ident" id="5744154">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744160">return</span>&nbsp;<span class="ident" id="5744167">n</span><br>
<span class="lineno"></span><span class="op" id="5744169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5744172">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5744250">func</span>&nbsp;<span class="ident" id="5744255">MaxEncodedLen</span><span class="op" id="5744268">(</span><span class="ident" id="5744269">n</span>&nbsp;<span class="builtintype" id="5744271">int</span><span class="op" id="5744274">)</span>&nbsp;<span class="builtintype" id="5744276">int</span>&nbsp;<span class="op" id="5744280">{</span>&nbsp;<span class="keyword" id="5744282">return</span>&nbsp;<span class="op" id="5744289">(</span><span class="ident" id="5744290">n</span>&nbsp;<span class="op" id="5744292">+</span>&nbsp;<span class="num" id="5744294">3</span><span class="op" id="5744295">)</span>&nbsp;<span class="op" id="5744297">/</span>&nbsp;<span class="num" id="5744299">4</span>&nbsp;<span class="op" id="5744301">*</span>&nbsp;<span class="num" id="5744303">5</span>&nbsp;<span class="op" id="5744305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5744308">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5744377">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="5744439">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="5744500">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5744568">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5744595">func</span>&nbsp;<span class="ident" id="5744600">NewEncoder</span><span class="op" id="5744610">(</span><span class="ident" id="5744611">w</span>&nbsp;<span class="ident" id="5744613">io</span><span class="op" id="5744615">.</span><span class="ident" id="5744616">Writer</span><span class="op" id="5744622">)</span>&nbsp;<span class="ident" id="5744624">io</span><span class="op" id="5744626">.</span><span class="ident" id="5744627">WriteCloser</span>&nbsp;<span class="op" id="5744639">{</span>&nbsp;<span class="keyword" id="5744641">return</span>&nbsp;<span class="op" id="5744648">&amp;</span><span class="ident" id="5744649">encoder</span><span class="op" id="5744656">{</span><span class="ident" id="5744657">w</span><span class="op" id="5744658">:</span>&nbsp;<span class="ident" id="5744660">w</span><span class="op" id="5744661">}</span>&nbsp;<span class="op" id="5744663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5744666">type</span>&nbsp;<span class="ident" id="5744671">encoder</span>&nbsp;<span class="keyword" id="5744679">struct</span>&nbsp;<span class="op" id="5744686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744689">err</span>&nbsp;&nbsp;<span class="builtintype" id="5744694">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744701">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744706">io</span><span class="op" id="5744708">.</span><span class="ident" id="5744709">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744717">buf</span>&nbsp;&nbsp;<span class="op" id="5744722">[</span><span class="num" id="5744723">4</span><span class="op" id="5744724">]</span><span class="builtintype" id="5744725">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744733">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744773">nbuf</span>&nbsp;<span class="builtintype" id="5744778">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744789">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5744816">out</span>&nbsp;&nbsp;<span class="op" id="5744821">[</span><span class="num" id="5744822">1024</span><span class="op" id="5744826">]</span><span class="builtintype" id="5744827">byte</span>&nbsp;<span class="comment" id="5744832">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="5744849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5744852">func</span>&nbsp;<span class="op" id="5744857">(</span><span class="ident" id="5744858">e</span>&nbsp;<span class="op" id="5744860">*</span><span class="ident" id="5744861">encoder</span><span class="op" id="5744868">)</span>&nbsp;<span class="ident" id="5744870">Write</span><span class="op" id="5744875">(</span><span class="ident" id="5744876">p</span>&nbsp;<span class="op" id="5744878">[</span><span class="op" id="5744879">]</span><span class="builtintype" id="5744880">byte</span><span class="op" id="5744884">)</span>&nbsp;<span class="op" id="5744886">(</span><span class="ident" id="5744887">n</span>&nbsp;<span class="builtintype" id="5744889">int</span><span class="op" id="5744892">,</span>&nbsp;<span class="ident" id="5744894">err</span>&nbsp;<span class="builtintype" id="5744898">error</span><span class="op" id="5744903">)</span>&nbsp;<span class="op" id="5744905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744908">if</span>&nbsp;<span class="ident" id="5744911">e</span><span class="op" id="5744912">.</span><span class="ident" id="5744913">err</span>&nbsp;<span class="op" id="5744917">!=</span>&nbsp;<span class="ident" id="5744920">nil</span>&nbsp;<span class="op" id="5744924">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744928">return</span>&nbsp;<span class="num" id="5744935">0</span><span class="op" id="5744936">,</span>&nbsp;<span class="ident" id="5744938">e</span><span class="op" id="5744939">.</span><span class="ident" id="5744940">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5744945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5744949">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744969">if</span>&nbsp;<span class="ident" id="5744972">e</span><span class="op" id="5744973">.</span><span class="ident" id="5744974">nbuf</span>&nbsp;<span class="op" id="5744979">&gt;</span>&nbsp;<span class="num" id="5744981">0</span>&nbsp;<span class="op" id="5744983">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744987">var</span>&nbsp;<span class="ident" id="5744991">i</span>&nbsp;<span class="builtintype" id="5744993">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5744999">for</span>&nbsp;<span class="ident" id="5745003">i</span>&nbsp;<span class="op" id="5745005">=</span>&nbsp;<span class="num" id="5745007">0</span><span class="op" id="5745008">;</span>&nbsp;<span class="ident" id="5745010">i</span>&nbsp;<span class="op" id="5745012">&lt;</span>&nbsp;<span class="builtinfunc" id="5745014">len</span><span class="op" id="5745017">(</span><span class="ident" id="5745018">p</span><span class="op" id="5745019">)</span>&nbsp;<span class="op" id="5745021">&amp;&amp;</span>&nbsp;<span class="ident" id="5745024">e</span><span class="op" id="5745025">.</span><span class="ident" id="5745026">nbuf</span>&nbsp;<span class="op" id="5745031">&lt;</span>&nbsp;<span class="num" id="5745033">4</span><span class="op" id="5745034">;</span>&nbsp;<span class="ident" id="5745036">i</span><span class="op" id="5745037">++</span>&nbsp;<span class="op" id="5745040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745045">e</span><span class="op" id="5745046">.</span><span class="ident" id="5745047">buf</span><span class="op" id="5745050">[</span><span class="ident" id="5745051">e</span><span class="op" id="5745052">.</span><span class="ident" id="5745053">nbuf</span><span class="op" id="5745057">]</span>&nbsp;<span class="op" id="5745059">=</span>&nbsp;<span class="ident" id="5745061">p</span><span class="op" id="5745062">[</span><span class="ident" id="5745063">i</span><span class="op" id="5745064">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745069">e</span><span class="op" id="5745070">.</span><span class="ident" id="5745071">nbuf</span><span class="op" id="5745075">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745080">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745084">n</span>&nbsp;<span class="op" id="5745086">+=</span>&nbsp;<span class="ident" id="5745089">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745093">p</span>&nbsp;<span class="op" id="5745095">=</span>&nbsp;<span class="ident" id="5745097">p</span><span class="op" id="5745098">[</span><span class="ident" id="5745099">i</span><span class="op" id="5745100">:</span><span class="op" id="5745101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745105">if</span>&nbsp;<span class="ident" id="5745108">e</span><span class="op" id="5745109">.</span><span class="ident" id="5745110">nbuf</span>&nbsp;<span class="op" id="5745115">&lt;</span>&nbsp;<span class="num" id="5745117">4</span>&nbsp;<span class="op" id="5745119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745124">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745133">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745137">nout</span>&nbsp;<span class="op" id="5745142">:=</span>&nbsp;<span class="ident" id="5745145">Encode</span><span class="op" id="5745151">(</span><span class="ident" id="5745152">e</span><span class="op" id="5745153">.</span><span class="ident" id="5745154">out</span><span class="op" id="5745157">[</span><span class="num" id="5745158">0</span><span class="op" id="5745159">:</span><span class="op" id="5745160">]</span><span class="op" id="5745161">,</span>&nbsp;<span class="ident" id="5745163">e</span><span class="op" id="5745164">.</span><span class="ident" id="5745165">buf</span><span class="op" id="5745168">[</span><span class="num" id="5745169">0</span><span class="op" id="5745170">:</span><span class="op" id="5745171">]</span><span class="op" id="5745172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745176">if</span>&nbsp;<span class="ident" id="5745179">_</span><span class="op" id="5745180">,</span>&nbsp;<span class="ident" id="5745182">e</span><span class="op" id="5745183">.</span><span class="ident" id="5745184">err</span>&nbsp;<span class="op" id="5745188">=</span>&nbsp;<span class="ident" id="5745190">e</span><span class="op" id="5745191">.</span><span class="ident" id="5745192">w</span><span class="op" id="5745193">.</span><span class="ident" id="5745194">Write</span><span class="op" id="5745199">(</span><span class="ident" id="5745200">e</span><span class="op" id="5745201">.</span><span class="ident" id="5745202">out</span><span class="op" id="5745205">[</span><span class="num" id="5745206">0</span><span class="op" id="5745207">:</span><span class="ident" id="5745208">nout</span><span class="op" id="5745212">]</span><span class="op" id="5745213">)</span><span class="op" id="5745214">;</span>&nbsp;<span class="ident" id="5745216">e</span><span class="op" id="5745217">.</span><span class="ident" id="5745218">err</span>&nbsp;<span class="op" id="5745222">!=</span>&nbsp;<span class="ident" id="5745225">nil</span>&nbsp;<span class="op" id="5745229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745234">return</span>&nbsp;<span class="ident" id="5745241">n</span><span class="op" id="5745242">,</span>&nbsp;<span class="ident" id="5745244">e</span><span class="op" id="5745245">.</span><span class="ident" id="5745246">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745256">e</span><span class="op" id="5745257">.</span><span class="ident" id="5745258">nbuf</span>&nbsp;<span class="op" id="5745263">=</span>&nbsp;<span class="num" id="5745265">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745272">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745299">for</span>&nbsp;<span class="builtinfunc" id="5745303">len</span><span class="op" id="5745306">(</span><span class="ident" id="5745307">p</span><span class="op" id="5745308">)</span>&nbsp;<span class="op" id="5745310">&gt;=</span>&nbsp;<span class="num" id="5745313">4</span>&nbsp;<span class="op" id="5745315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745319">nn</span>&nbsp;<span class="op" id="5745322">:=</span>&nbsp;<span class="builtinfunc" id="5745325">len</span><span class="op" id="5745328">(</span><span class="ident" id="5745329">e</span><span class="op" id="5745330">.</span><span class="ident" id="5745331">out</span><span class="op" id="5745334">)</span>&nbsp;<span class="op" id="5745336">/</span>&nbsp;<span class="num" id="5745338">5</span>&nbsp;<span class="op" id="5745340">*</span>&nbsp;<span class="num" id="5745342">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745346">if</span>&nbsp;<span class="ident" id="5745349">nn</span>&nbsp;<span class="op" id="5745352">&gt;</span>&nbsp;<span class="builtinfunc" id="5745354">len</span><span class="op" id="5745357">(</span><span class="ident" id="5745358">p</span><span class="op" id="5745359">)</span>&nbsp;<span class="op" id="5745361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745366">nn</span>&nbsp;<span class="op" id="5745369">=</span>&nbsp;<span class="builtinfunc" id="5745371">len</span><span class="op" id="5745374">(</span><span class="ident" id="5745375">p</span><span class="op" id="5745376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745384">nn</span>&nbsp;<span class="op" id="5745387">-=</span>&nbsp;<span class="ident" id="5745390">nn</span>&nbsp;<span class="op" id="5745393">%</span>&nbsp;<span class="num" id="5745395">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745399">if</span>&nbsp;<span class="ident" id="5745402">nn</span>&nbsp;<span class="op" id="5745405">&gt;</span>&nbsp;<span class="num" id="5745407">0</span>&nbsp;<span class="op" id="5745409">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745414">nout</span>&nbsp;<span class="op" id="5745419">:=</span>&nbsp;<span class="ident" id="5745422">Encode</span><span class="op" id="5745428">(</span><span class="ident" id="5745429">e</span><span class="op" id="5745430">.</span><span class="ident" id="5745431">out</span><span class="op" id="5745434">[</span><span class="num" id="5745435">0</span><span class="op" id="5745436">:</span><span class="op" id="5745437">]</span><span class="op" id="5745438">,</span>&nbsp;<span class="ident" id="5745440">p</span><span class="op" id="5745441">[</span><span class="num" id="5745442">0</span><span class="op" id="5745443">:</span><span class="ident" id="5745444">nn</span><span class="op" id="5745446">]</span><span class="op" id="5745447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745452">if</span>&nbsp;<span class="ident" id="5745455">_</span><span class="op" id="5745456">,</span>&nbsp;<span class="ident" id="5745458">e</span><span class="op" id="5745459">.</span><span class="ident" id="5745460">err</span>&nbsp;<span class="op" id="5745464">=</span>&nbsp;<span class="ident" id="5745466">e</span><span class="op" id="5745467">.</span><span class="ident" id="5745468">w</span><span class="op" id="5745469">.</span><span class="ident" id="5745470">Write</span><span class="op" id="5745475">(</span><span class="ident" id="5745476">e</span><span class="op" id="5745477">.</span><span class="ident" id="5745478">out</span><span class="op" id="5745481">[</span><span class="num" id="5745482">0</span><span class="op" id="5745483">:</span><span class="ident" id="5745484">nout</span><span class="op" id="5745488">]</span><span class="op" id="5745489">)</span><span class="op" id="5745490">;</span>&nbsp;<span class="ident" id="5745492">e</span><span class="op" id="5745493">.</span><span class="ident" id="5745494">err</span>&nbsp;<span class="op" id="5745498">!=</span>&nbsp;<span class="ident" id="5745501">nil</span>&nbsp;<span class="op" id="5745505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745511">return</span>&nbsp;<span class="ident" id="5745518">n</span><span class="op" id="5745519">,</span>&nbsp;<span class="ident" id="5745521">e</span><span class="op" id="5745522">.</span><span class="ident" id="5745523">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745534">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745538">n</span>&nbsp;<span class="op" id="5745540">+=</span>&nbsp;<span class="ident" id="5745543">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745548">p</span>&nbsp;<span class="op" id="5745550">=</span>&nbsp;<span class="ident" id="5745552">p</span><span class="op" id="5745553">[</span><span class="ident" id="5745554">nn</span><span class="op" id="5745556">:</span><span class="op" id="5745557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745564">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745585">for</span>&nbsp;<span class="ident" id="5745589">i</span>&nbsp;<span class="op" id="5745591">:=</span>&nbsp;<span class="num" id="5745594">0</span><span class="op" id="5745595">;</span>&nbsp;<span class="ident" id="5745597">i</span>&nbsp;<span class="op" id="5745599">&lt;</span>&nbsp;<span class="builtinfunc" id="5745601">len</span><span class="op" id="5745604">(</span><span class="ident" id="5745605">p</span><span class="op" id="5745606">)</span><span class="op" id="5745607">;</span>&nbsp;<span class="ident" id="5745609">i</span><span class="op" id="5745610">++</span>&nbsp;<span class="op" id="5745613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745617">e</span><span class="op" id="5745618">.</span><span class="ident" id="5745619">buf</span><span class="op" id="5745622">[</span><span class="ident" id="5745623">i</span><span class="op" id="5745624">]</span>&nbsp;<span class="op" id="5745626">=</span>&nbsp;<span class="ident" id="5745628">p</span><span class="op" id="5745629">[</span><span class="ident" id="5745630">i</span><span class="op" id="5745631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5745634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745637">e</span><span class="op" id="5745638">.</span><span class="ident" id="5745639">nbuf</span>&nbsp;<span class="op" id="5745644">=</span>&nbsp;<span class="builtinfunc" id="5745646">len</span><span class="op" id="5745649">(</span><span class="ident" id="5745650">p</span><span class="op" id="5745651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745654">n</span>&nbsp;<span class="op" id="5745656">+=</span>&nbsp;<span class="builtinfunc" id="5745659">len</span><span class="op" id="5745662">(</span><span class="ident" id="5745663">p</span><span class="op" id="5745664">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745667">return</span><br>
<span class="lineno"></span><span class="op" id="5745674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745677">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5745731">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="5745784">func</span>&nbsp;<span class="op" id="5745789">(</span><span class="ident" id="5745790">e</span>&nbsp;<span class="op" id="5745792">*</span><span class="ident" id="5745793">encoder</span><span class="op" id="5745800">)</span>&nbsp;<span class="ident" id="5745802">Close</span><span class="op" id="5745807">(</span><span class="op" id="5745808">)</span>&nbsp;<span class="builtintype" id="5745810">error</span>&nbsp;<span class="op" id="5745816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5745819">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5745876">if</span>&nbsp;<span class="ident" id="5745879">e</span><span class="op" id="5745880">.</span><span class="ident" id="5745881">err</span>&nbsp;<span class="op" id="5745885">==</span>&nbsp;<span class="ident" id="5745888">nil</span>&nbsp;<span class="op" id="5745892">&amp;&amp;</span>&nbsp;<span class="ident" id="5745895">e</span><span class="op" id="5745896">.</span><span class="ident" id="5745897">nbuf</span>&nbsp;<span class="op" id="5745902">&gt;</span>&nbsp;<span class="num" id="5745904">0</span>&nbsp;<span class="op" id="5745906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745910">nout</span>&nbsp;<span class="op" id="5745915">:=</span>&nbsp;<span class="ident" id="5745918">Encode</span><span class="op" id="5745924">(</span><span class="ident" id="5745925">e</span><span class="op" id="5745926">.</span><span class="ident" id="5745927">out</span><span class="op" id="5745930">[</span><span class="num" id="5745931">0</span><span class="op" id="5745932">:</span><span class="op" id="5745933">]</span><span class="op" id="5745934">,</span>&nbsp;<span class="ident" id="5745936">e</span><span class="op" id="5745937">.</span><span class="ident" id="5745938">buf</span><span class="op" id="5745941">[</span><span class="num" id="5745942">0</span><span class="op" id="5745943">:</span><span class="ident" id="5745944">e</span><span class="op" id="5745945">.</span><span class="ident" id="5745946">nbuf</span><span class="op" id="5745950">]</span><span class="op" id="5745951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745955">e</span><span class="op" id="5745956">.</span><span class="ident" id="5745957">nbuf</span>&nbsp;<span class="op" id="5745962">=</span>&nbsp;<span class="num" id="5745964">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5745968">_</span><span class="op" id="5745969">,</span>&nbsp;<span class="ident" id="5745971">e</span><span class="op" id="5745972">.</span><span class="ident" id="5745973">err</span>&nbsp;<span class="op" id="5745977">=</span>&nbsp;<span class="ident" id="5745979">e</span><span class="op" id="5745980">.</span><span class="ident" id="5745981">w</span><span class="op" id="5745982">.</span><span class="ident" id="5745983">Write</span><span class="op" id="5745988">(</span><span class="ident" id="5745989">e</span><span class="op" id="5745990">.</span><span class="ident" id="5745991">out</span><span class="op" id="5745994">[</span><span class="num" id="5745995">0</span><span class="op" id="5745996">:</span><span class="ident" id="5745997">nout</span><span class="op" id="5746001">]</span><span class="op" id="5746002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5746005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746008">return</span>&nbsp;<span class="ident" id="5746015">e</span><span class="op" id="5746016">.</span><span class="ident" id="5746017">err</span><br>
<span class="lineno"></span><span class="op" id="5746021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5746024">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5746043">type</span>&nbsp;<span class="ident" id="5746048">CorruptInputError</span>&nbsp;<span class="ident" id="5746066">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5746073">func</span>&nbsp;<span class="op" id="5746078">(</span><span class="ident" id="5746079">e</span>&nbsp;<span class="ident" id="5746081">CorruptInputError</span><span class="op" id="5746098">)</span>&nbsp;<span class="ident" id="5746100">Error</span><span class="op" id="5746105">(</span><span class="op" id="5746106">)</span>&nbsp;<span class="builtintype" id="5746108">string</span>&nbsp;<span class="op" id="5746115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746118">return</span>&nbsp;<span class="string" id="5746125">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="5746163">+</span>&nbsp;<span class="ident" id="5746165">strconv</span><span class="op" id="5746172">.</span><span class="ident" id="5746173">FormatInt</span><span class="op" id="5746182">(</span><span class="ident" id="5746183">int64</span><span class="op" id="5746188">(</span><span class="ident" id="5746189">e</span><span class="op" id="5746190">)</span><span class="op" id="5746191">,</span>&nbsp;<span class="num" id="5746193">10</span><span class="op" id="5746195">)</span><br>
<span class="lineno"></span><span class="op" id="5746197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5746200">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5746258">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5746319">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5746383">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="5746448">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="5746503">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5746567">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="5746628">//</span><br>
<span class="lineno"></span><span class="comment" id="5746631">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5746691">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="5746753">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5746810">//</span><br>
<span class="lineno"></span><span class="comment" id="5746813">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="5746871">//</span><br>
<span class="lineno"></span><span class="keyword" id="5746874">func</span>&nbsp;<span class="ident" id="5746879">Decode</span><span class="op" id="5746885">(</span><span class="ident" id="5746886">dst</span><span class="op" id="5746889">,</span>&nbsp;<span class="ident" id="5746891">src</span>&nbsp;<span class="op" id="5746895">[</span><span class="op" id="5746896">]</span><span class="builtintype" id="5746897">byte</span><span class="op" id="5746901">,</span>&nbsp;<span class="ident" id="5746903">flush</span>&nbsp;<span class="builtintype" id="5746909">bool</span><span class="op" id="5746913">)</span>&nbsp;<span class="op" id="5746915">(</span><span class="ident" id="5746916">ndst</span><span class="op" id="5746920">,</span>&nbsp;<span class="ident" id="5746922">nsrc</span>&nbsp;<span class="builtintype" id="5746927">int</span><span class="op" id="5746930">,</span>&nbsp;<span class="ident" id="5746932">err</span>&nbsp;<span class="builtintype" id="5746936">error</span><span class="op" id="5746941">)</span>&nbsp;<span class="op" id="5746943">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746946">var</span>&nbsp;<span class="ident" id="5746950">v</span>&nbsp;<span class="builtintype" id="5746952">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746960">var</span>&nbsp;<span class="ident" id="5746964">nb</span>&nbsp;<span class="builtintype" id="5746967">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746972">for</span>&nbsp;<span class="ident" id="5746976">i</span><span class="op" id="5746977">,</span>&nbsp;<span class="ident" id="5746979">b</span>&nbsp;<span class="op" id="5746981">:=</span>&nbsp;<span class="keyword" id="5746984">range</span>&nbsp;<span class="ident" id="5746990">src</span>&nbsp;<span class="op" id="5746994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5746998">if</span>&nbsp;<span class="builtinfunc" id="5747001">len</span><span class="op" id="5747004">(</span><span class="ident" id="5747005">dst</span><span class="op" id="5747008">)</span><span class="op" id="5747009">-</span><span class="ident" id="5747010">ndst</span>&nbsp;<span class="op" id="5747015">&lt;</span>&nbsp;<span class="num" id="5747017">4</span>&nbsp;<span class="op" id="5747019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747024">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747037">switch</span>&nbsp;<span class="op" id="5747044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747048">case</span>&nbsp;<span class="ident" id="5747053">b</span>&nbsp;<span class="op" id="5747055">&lt;=</span>&nbsp;<span class="string" id="5747058">&#39;&nbsp;&#39;</span><span class="op" id="5747061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747066">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747077">case</span>&nbsp;<span class="ident" id="5747082">b</span>&nbsp;<span class="op" id="5747084">==</span>&nbsp;<span class="string" id="5747087">&#39;z&#39;</span>&nbsp;<span class="op" id="5747091">&amp;&amp;</span>&nbsp;<span class="ident" id="5747094">nb</span>&nbsp;<span class="op" id="5747097">==</span>&nbsp;<span class="num" id="5747100">0</span><span class="op" id="5747101">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747106">nb</span>&nbsp;<span class="op" id="5747109">=</span>&nbsp;<span class="num" id="5747111">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747116">v</span>&nbsp;<span class="op" id="5747118">=</span>&nbsp;<span class="num" id="5747120">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747124">case</span>&nbsp;<span class="string" id="5747129">&#39;!&#39;</span>&nbsp;<span class="op" id="5747133">&lt;=</span>&nbsp;<span class="ident" id="5747136">b</span>&nbsp;<span class="op" id="5747138">&amp;&amp;</span>&nbsp;<span class="ident" id="5747141">b</span>&nbsp;<span class="op" id="5747143">&lt;=</span>&nbsp;<span class="string" id="5747146">&#39;u&#39;</span><span class="op" id="5747149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747154">v</span>&nbsp;<span class="op" id="5747156">=</span>&nbsp;<span class="ident" id="5747158">v</span><span class="op" id="5747159">*</span><span class="num" id="5747160">85</span>&nbsp;<span class="op" id="5747163">+</span>&nbsp;<span class="builtintype" id="5747165">uint32</span><span class="op" id="5747171">(</span><span class="ident" id="5747172">b</span><span class="op" id="5747173">-</span><span class="string" id="5747174">&#39;!&#39;</span><span class="op" id="5747177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747182">nb</span><span class="op" id="5747184">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747189">default</span><span class="op" id="5747196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747201">return</span>&nbsp;<span class="num" id="5747208">0</span><span class="op" id="5747209">,</span>&nbsp;<span class="num" id="5747211">0</span><span class="op" id="5747212">,</span>&nbsp;<span class="ident" id="5747214">CorruptInputError</span><span class="op" id="5747231">(</span><span class="ident" id="5747232">i</span><span class="op" id="5747233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747241">if</span>&nbsp;<span class="ident" id="5747244">nb</span>&nbsp;<span class="op" id="5747247">==</span>&nbsp;<span class="num" id="5747250">5</span>&nbsp;<span class="op" id="5747252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747257">nsrc</span>&nbsp;<span class="op" id="5747262">=</span>&nbsp;<span class="ident" id="5747264">i</span>&nbsp;<span class="op" id="5747266">+</span>&nbsp;<span class="num" id="5747268">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747273">dst</span><span class="op" id="5747276">[</span><span class="ident" id="5747277">ndst</span><span class="op" id="5747281">]</span>&nbsp;<span class="op" id="5747283">=</span>&nbsp;<span class="builtintype" id="5747285">byte</span><span class="op" id="5747289">(</span><span class="ident" id="5747290">v</span>&nbsp;<span class="op" id="5747292">&gt;&gt;</span>&nbsp;<span class="num" id="5747295">24</span><span class="op" id="5747297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747302">dst</span><span class="op" id="5747305">[</span><span class="ident" id="5747306">ndst</span><span class="op" id="5747310">+</span><span class="num" id="5747311">1</span><span class="op" id="5747312">]</span>&nbsp;<span class="op" id="5747314">=</span>&nbsp;<span class="builtintype" id="5747316">byte</span><span class="op" id="5747320">(</span><span class="ident" id="5747321">v</span>&nbsp;<span class="op" id="5747323">&gt;&gt;</span>&nbsp;<span class="num" id="5747326">16</span><span class="op" id="5747328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747333">dst</span><span class="op" id="5747336">[</span><span class="ident" id="5747337">ndst</span><span class="op" id="5747341">+</span><span class="num" id="5747342">2</span><span class="op" id="5747343">]</span>&nbsp;<span class="op" id="5747345">=</span>&nbsp;<span class="builtintype" id="5747347">byte</span><span class="op" id="5747351">(</span><span class="ident" id="5747352">v</span>&nbsp;<span class="op" id="5747354">&gt;&gt;</span>&nbsp;<span class="num" id="5747357">8</span><span class="op" id="5747358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747363">dst</span><span class="op" id="5747366">[</span><span class="ident" id="5747367">ndst</span><span class="op" id="5747371">+</span><span class="num" id="5747372">3</span><span class="op" id="5747373">]</span>&nbsp;<span class="op" id="5747375">=</span>&nbsp;<span class="builtintype" id="5747377">byte</span><span class="op" id="5747381">(</span><span class="ident" id="5747382">v</span><span class="op" id="5747383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747388">ndst</span>&nbsp;<span class="op" id="5747393">+=</span>&nbsp;<span class="num" id="5747396">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747401">nb</span>&nbsp;<span class="op" id="5747404">=</span>&nbsp;<span class="num" id="5747406">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747411">v</span>&nbsp;<span class="op" id="5747413">=</span>&nbsp;<span class="num" id="5747415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747425">if</span>&nbsp;<span class="ident" id="5747428">flush</span>&nbsp;<span class="op" id="5747434">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747438">nsrc</span>&nbsp;<span class="op" id="5747443">=</span>&nbsp;<span class="builtinfunc" id="5747445">len</span><span class="op" id="5747448">(</span><span class="ident" id="5747449">src</span><span class="op" id="5747452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747456">if</span>&nbsp;<span class="ident" id="5747459">nb</span>&nbsp;<span class="op" id="5747462">&gt;</span>&nbsp;<span class="num" id="5747464">0</span>&nbsp;<span class="op" id="5747466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747471">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747525">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747574">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747625">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747679">if</span>&nbsp;<span class="ident" id="5747682">nb</span>&nbsp;<span class="op" id="5747685">==</span>&nbsp;<span class="num" id="5747688">1</span>&nbsp;<span class="op" id="5747690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747696">return</span>&nbsp;<span class="num" id="5747703">0</span><span class="op" id="5747704">,</span>&nbsp;<span class="num" id="5747706">0</span><span class="op" id="5747707">,</span>&nbsp;<span class="ident" id="5747709">CorruptInputError</span><span class="op" id="5747726">(</span><span class="builtinfunc" id="5747727">len</span><span class="op" id="5747730">(</span><span class="ident" id="5747731">src</span><span class="op" id="5747734">)</span><span class="op" id="5747735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747745">for</span>&nbsp;<span class="ident" id="5747749">i</span>&nbsp;<span class="op" id="5747751">:=</span>&nbsp;<span class="ident" id="5747754">nb</span><span class="op" id="5747756">;</span>&nbsp;<span class="ident" id="5747758">i</span>&nbsp;<span class="op" id="5747760">&lt;</span>&nbsp;<span class="num" id="5747762">5</span><span class="op" id="5747763">;</span>&nbsp;<span class="ident" id="5747765">i</span><span class="op" id="5747766">++</span>&nbsp;<span class="op" id="5747769">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747775">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747829">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5747887">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747944">v</span>&nbsp;<span class="op" id="5747946">=</span>&nbsp;<span class="ident" id="5747948">v</span><span class="op" id="5747949">*</span><span class="num" id="5747950">85</span>&nbsp;<span class="op" id="5747953">+</span>&nbsp;<span class="num" id="5747955">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5747961">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5747966">for</span>&nbsp;<span class="ident" id="5747970">i</span>&nbsp;<span class="op" id="5747972">:=</span>&nbsp;<span class="num" id="5747975">0</span><span class="op" id="5747976">;</span>&nbsp;<span class="ident" id="5747978">i</span>&nbsp;<span class="op" id="5747980">&lt;</span>&nbsp;<span class="ident" id="5747982">nb</span><span class="op" id="5747984">-</span><span class="num" id="5747985">1</span><span class="op" id="5747986">;</span>&nbsp;<span class="ident" id="5747988">i</span><span class="op" id="5747989">++</span>&nbsp;<span class="op" id="5747992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5747998">dst</span><span class="op" id="5748001">[</span><span class="ident" id="5748002">ndst</span><span class="op" id="5748006">]</span>&nbsp;<span class="op" id="5748008">=</span>&nbsp;<span class="builtintype" id="5748010">byte</span><span class="op" id="5748014">(</span><span class="ident" id="5748015">v</span>&nbsp;<span class="op" id="5748017">&gt;&gt;</span>&nbsp;<span class="num" id="5748020">24</span><span class="op" id="5748022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748028">v</span>&nbsp;<span class="op" id="5748030">&lt;&lt;=</span>&nbsp;<span class="num" id="5748034">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748040">ndst</span><span class="op" id="5748044">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748050">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748060">return</span><br>
<span class="lineno"></span><span class="op" id="5748067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5748070">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5748125">func</span>&nbsp;<span class="ident" id="5748130">NewDecoder</span><span class="op" id="5748140">(</span><span class="ident" id="5748141">r</span>&nbsp;<span class="ident" id="5748143">io</span><span class="op" id="5748145">.</span><span class="ident" id="5748146">Reader</span><span class="op" id="5748152">)</span>&nbsp;<span class="ident" id="5748154">io</span><span class="op" id="5748156">.</span><span class="ident" id="5748157">Reader</span>&nbsp;<span class="op" id="5748164">{</span>&nbsp;<span class="keyword" id="5748166">return</span>&nbsp;<span class="op" id="5748173">&amp;</span><span class="ident" id="5748174">decoder</span><span class="op" id="5748181">{</span><span class="ident" id="5748182">r</span><span class="op" id="5748183">:</span>&nbsp;<span class="ident" id="5748185">r</span><span class="op" id="5748186">}</span>&nbsp;<span class="op" id="5748188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748191">type</span>&nbsp;<span class="ident" id="5748196">decoder</span>&nbsp;<span class="keyword" id="5748204">struct</span>&nbsp;<span class="op" id="5748211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748214">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5748222">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748229">readErr</span>&nbsp;<span class="builtintype" id="5748237">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748244">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748252">io</span><span class="op" id="5748254">.</span><span class="ident" id="5748255">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748263">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748271">[</span><span class="num" id="5748272">1024</span><span class="op" id="5748276">]</span><span class="builtintype" id="5748277">byte</span>&nbsp;<span class="comment" id="5748282">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748301">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5748309">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748314">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748322">[</span><span class="op" id="5748323">]</span><span class="builtintype" id="5748324">byte</span>&nbsp;<span class="comment" id="5748329">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748357">outbuf</span>&nbsp;&nbsp;<span class="op" id="5748365">[</span><span class="num" id="5748366">1024</span><span class="op" id="5748370">]</span><span class="builtintype" id="5748371">byte</span><br>
<span class="lineno"></span><span class="op" id="5748376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5748379">func</span>&nbsp;<span class="op" id="5748384">(</span><span class="ident" id="5748385">d</span>&nbsp;<span class="op" id="5748387">*</span><span class="ident" id="5748388">decoder</span><span class="op" id="5748395">)</span>&nbsp;<span class="ident" id="5748397">Read</span><span class="op" id="5748401">(</span><span class="ident" id="5748402">p</span>&nbsp;<span class="op" id="5748404">[</span><span class="op" id="5748405">]</span><span class="builtintype" id="5748406">byte</span><span class="op" id="5748410">)</span>&nbsp;<span class="op" id="5748412">(</span><span class="ident" id="5748413">n</span>&nbsp;<span class="builtintype" id="5748415">int</span><span class="op" id="5748418">,</span>&nbsp;<span class="ident" id="5748420">err</span>&nbsp;<span class="builtintype" id="5748424">error</span><span class="op" id="5748429">)</span>&nbsp;<span class="op" id="5748431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748434">if</span>&nbsp;<span class="builtinfunc" id="5748437">len</span><span class="op" id="5748440">(</span><span class="ident" id="5748441">p</span><span class="op" id="5748442">)</span>&nbsp;<span class="op" id="5748444">==</span>&nbsp;<span class="num" id="5748447">0</span>&nbsp;<span class="op" id="5748449">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748453">return</span>&nbsp;<span class="num" id="5748460">0</span><span class="op" id="5748461">,</span>&nbsp;<span class="ident" id="5748463">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748471">if</span>&nbsp;<span class="ident" id="5748474">d</span><span class="op" id="5748475">.</span><span class="ident" id="5748476">err</span>&nbsp;<span class="op" id="5748480">!=</span>&nbsp;<span class="ident" id="5748483">nil</span>&nbsp;<span class="op" id="5748487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748491">return</span>&nbsp;<span class="num" id="5748498">0</span><span class="op" id="5748499">,</span>&nbsp;<span class="ident" id="5748501">d</span><span class="op" id="5748502">.</span><span class="ident" id="5748503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748508">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748512">for</span>&nbsp;<span class="op" id="5748516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748520">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748564">if</span>&nbsp;<span class="builtinfunc" id="5748567">len</span><span class="op" id="5748570">(</span><span class="ident" id="5748571">d</span><span class="op" id="5748572">.</span><span class="ident" id="5748573">out</span><span class="op" id="5748576">)</span>&nbsp;<span class="op" id="5748578">&gt;</span>&nbsp;<span class="num" id="5748580">0</span>&nbsp;<span class="op" id="5748582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748587">n</span>&nbsp;<span class="op" id="5748589">=</span>&nbsp;<span class="builtinfunc" id="5748591">copy</span><span class="op" id="5748595">(</span><span class="ident" id="5748596">p</span><span class="op" id="5748597">,</span>&nbsp;<span class="ident" id="5748599">d</span><span class="op" id="5748600">.</span><span class="ident" id="5748601">out</span><span class="op" id="5748604">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748609">d</span><span class="op" id="5748610">.</span><span class="ident" id="5748611">out</span>&nbsp;<span class="op" id="5748615">=</span>&nbsp;<span class="ident" id="5748617">d</span><span class="op" id="5748618">.</span><span class="ident" id="5748619">out</span><span class="op" id="5748622">[</span><span class="ident" id="5748623">n</span><span class="op" id="5748624">:</span><span class="op" id="5748625">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748630">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748644">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748687">var</span>&nbsp;<span class="ident" id="5748691">nn</span><span class="op" id="5748693">,</span>&nbsp;<span class="ident" id="5748695">nsrc</span><span class="op" id="5748699">,</span>&nbsp;<span class="ident" id="5748701">ndst</span>&nbsp;<span class="builtintype" id="5748706">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748712">if</span>&nbsp;<span class="ident" id="5748715">d</span><span class="op" id="5748716">.</span><span class="ident" id="5748717">nbuf</span>&nbsp;<span class="op" id="5748722">&gt;</span>&nbsp;<span class="num" id="5748724">0</span>&nbsp;<span class="op" id="5748726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748731">ndst</span><span class="op" id="5748735">,</span>&nbsp;<span class="ident" id="5748737">nsrc</span><span class="op" id="5748741">,</span>&nbsp;<span class="ident" id="5748743">d</span><span class="op" id="5748744">.</span><span class="ident" id="5748745">err</span>&nbsp;<span class="op" id="5748749">=</span>&nbsp;<span class="ident" id="5748751">Decode</span><span class="op" id="5748757">(</span><span class="ident" id="5748758">d</span><span class="op" id="5748759">.</span><span class="ident" id="5748760">outbuf</span><span class="op" id="5748766">[</span><span class="num" id="5748767">0</span><span class="op" id="5748768">:</span><span class="op" id="5748769">]</span><span class="op" id="5748770">,</span>&nbsp;<span class="ident" id="5748772">d</span><span class="op" id="5748773">.</span><span class="ident" id="5748774">buf</span><span class="op" id="5748777">[</span><span class="num" id="5748778">0</span><span class="op" id="5748779">:</span><span class="ident" id="5748780">d</span><span class="op" id="5748781">.</span><span class="ident" id="5748782">nbuf</span><span class="op" id="5748786">]</span><span class="op" id="5748787">,</span>&nbsp;<span class="ident" id="5748789">d</span><span class="op" id="5748790">.</span><span class="ident" id="5748791">readErr</span>&nbsp;<span class="op" id="5748799">!=</span>&nbsp;<span class="ident" id="5748802">nil</span><span class="op" id="5748805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748810">if</span>&nbsp;<span class="ident" id="5748813">ndst</span>&nbsp;<span class="op" id="5748818">&gt;</span>&nbsp;<span class="num" id="5748820">0</span>&nbsp;<span class="op" id="5748822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748828">d</span><span class="op" id="5748829">.</span><span class="ident" id="5748830">out</span>&nbsp;<span class="op" id="5748834">=</span>&nbsp;<span class="ident" id="5748836">d</span><span class="op" id="5748837">.</span><span class="ident" id="5748838">outbuf</span><span class="op" id="5748844">[</span><span class="num" id="5748845">0</span><span class="op" id="5748846">:</span><span class="ident" id="5748847">ndst</span><span class="op" id="5748851">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5748857">d</span><span class="op" id="5748858">.</span><span class="ident" id="5748859">nbuf</span>&nbsp;<span class="op" id="5748864">=</span>&nbsp;<span class="builtinfunc" id="5748866">copy</span><span class="op" id="5748870">(</span><span class="ident" id="5748871">d</span><span class="op" id="5748872">.</span><span class="ident" id="5748873">buf</span><span class="op" id="5748876">[</span><span class="num" id="5748877">0</span><span class="op" id="5748878">:</span><span class="op" id="5748879">]</span><span class="op" id="5748880">,</span>&nbsp;<span class="ident" id="5748882">d</span><span class="op" id="5748883">.</span><span class="ident" id="5748884">buf</span><span class="op" id="5748887">[</span><span class="ident" id="5748888">nsrc</span><span class="op" id="5748892">:</span><span class="ident" id="5748893">d</span><span class="op" id="5748894">.</span><span class="ident" id="5748895">nbuf</span><span class="op" id="5748899">]</span><span class="op" id="5748900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748906">continue</span>&nbsp;<span class="comment" id="5748915">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5748941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5748946">if</span>&nbsp;<span class="ident" id="5748949">ndst</span>&nbsp;<span class="op" id="5748954">==</span>&nbsp;<span class="num" id="5748957">0</span>&nbsp;<span class="op" id="5748959">&amp;&amp;</span>&nbsp;<span class="ident" id="5748962">d</span><span class="op" id="5748963">.</span><span class="ident" id="5748964">err</span>&nbsp;<span class="op" id="5748968">==</span>&nbsp;<span class="ident" id="5748971">nil</span>&nbsp;<span class="op" id="5748975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5748981">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749053">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749111">off</span>&nbsp;<span class="op" id="5749115">:=</span>&nbsp;<span class="num" id="5749118">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749124">for</span>&nbsp;<span class="ident" id="5749128">i</span>&nbsp;<span class="op" id="5749130">:=</span>&nbsp;<span class="num" id="5749133">0</span><span class="op" id="5749134">;</span>&nbsp;<span class="ident" id="5749136">i</span>&nbsp;<span class="op" id="5749138">&lt;</span>&nbsp;<span class="ident" id="5749140">d</span><span class="op" id="5749141">.</span><span class="ident" id="5749142">nbuf</span><span class="op" id="5749146">;</span>&nbsp;<span class="ident" id="5749148">i</span><span class="op" id="5749149">++</span>&nbsp;<span class="op" id="5749152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749159">if</span>&nbsp;<span class="ident" id="5749162">d</span><span class="op" id="5749163">.</span><span class="ident" id="5749164">buf</span><span class="op" id="5749167">[</span><span class="ident" id="5749168">i</span><span class="op" id="5749169">]</span>&nbsp;<span class="op" id="5749171">&gt;</span>&nbsp;<span class="string" id="5749173">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5749177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749185">d</span><span class="op" id="5749186">.</span><span class="ident" id="5749187">buf</span><span class="op" id="5749190">[</span><span class="ident" id="5749191">off</span><span class="op" id="5749194">]</span>&nbsp;<span class="op" id="5749196">=</span>&nbsp;<span class="ident" id="5749198">d</span><span class="op" id="5749199">.</span><span class="ident" id="5749200">buf</span><span class="op" id="5749203">[</span><span class="ident" id="5749204">i</span><span class="op" id="5749205">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749213">off</span><span class="op" id="5749216">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749236">d</span><span class="op" id="5749237">.</span><span class="ident" id="5749238">nbuf</span>&nbsp;<span class="op" id="5749243">=</span>&nbsp;<span class="ident" id="5749245">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749252">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749261">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749318">if</span>&nbsp;<span class="ident" id="5749321">d</span><span class="op" id="5749322">.</span><span class="ident" id="5749323">err</span>&nbsp;<span class="op" id="5749327">!=</span>&nbsp;<span class="ident" id="5749330">nil</span>&nbsp;<span class="op" id="5749334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749339">return</span>&nbsp;<span class="num" id="5749346">0</span><span class="op" id="5749347">,</span>&nbsp;<span class="ident" id="5749349">d</span><span class="op" id="5749350">.</span><span class="ident" id="5749351">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749361">if</span>&nbsp;<span class="ident" id="5749364">d</span><span class="op" id="5749365">.</span><span class="ident" id="5749366">readErr</span>&nbsp;<span class="op" id="5749374">!=</span>&nbsp;<span class="ident" id="5749377">nil</span>&nbsp;<span class="op" id="5749381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749386">d</span><span class="op" id="5749387">.</span><span class="ident" id="5749388">err</span>&nbsp;<span class="op" id="5749392">=</span>&nbsp;<span class="ident" id="5749394">d</span><span class="op" id="5749395">.</span><span class="ident" id="5749396">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5749407">return</span>&nbsp;<span class="num" id="5749414">0</span><span class="op" id="5749415">,</span>&nbsp;<span class="ident" id="5749417">d</span><span class="op" id="5749418">.</span><span class="ident" id="5749419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749425">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5749430">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749451">nn</span><span class="op" id="5749453">,</span>&nbsp;<span class="ident" id="5749455">d</span><span class="op" id="5749456">.</span><span class="ident" id="5749457">readErr</span>&nbsp;<span class="op" id="5749465">=</span>&nbsp;<span class="ident" id="5749467">d</span><span class="op" id="5749468">.</span><span class="ident" id="5749469">r</span><span class="op" id="5749470">.</span><span class="ident" id="5749471">Read</span><span class="op" id="5749475">(</span><span class="ident" id="5749476">d</span><span class="op" id="5749477">.</span><span class="ident" id="5749478">buf</span><span class="op" id="5749481">[</span><span class="ident" id="5749482">d</span><span class="op" id="5749483">.</span><span class="ident" id="5749484">nbuf</span><span class="op" id="5749488">:</span><span class="op" id="5749489">]</span><span class="op" id="5749490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5749494">d</span><span class="op" id="5749495">.</span><span class="ident" id="5749496">nbuf</span>&nbsp;<span class="op" id="5749501">+=</span>&nbsp;<span class="ident" id="5749504">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5749508">}</span><br>
<span class="lineno">310</span><span class="op" id="5749510">}</span>
</div>
</body>
</html>
