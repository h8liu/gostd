<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3817997">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3818052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3818106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3818157">//&nbsp;Package&nbsp;mime&nbsp;implements&nbsp;parts&nbsp;of&nbsp;the&nbsp;MIME&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="3818208">package</span>&nbsp;<span class="ident" id="3818216">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3818222">import</span>&nbsp;<span class="op" id="3818229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818232">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818239">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818250">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3818257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3818260">var</span>&nbsp;<span class="op" id="3818264">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818267">mimeLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3818282">sync</span><span class="op" id="3818286">.</span><span class="ident" id="3818287">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818296">mimeTypesLower</span>&nbsp;<span class="op" id="3818311">=</span>&nbsp;<span class="keyword" id="3818313">map</span><span class="op" id="3818316">[</span><span class="builtintype" id="3818317">string</span><span class="op" id="3818323">]</span><span class="builtintype" id="3818324">string</span><span class="op" id="3818330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818334">&#34;.css&#34;</span><span class="op" id="3818340">:</span>&nbsp;&nbsp;<span class="string" id="3818343">&#34;text/css;&nbsp;charset=utf-8&#34;</span><span class="op" id="3818368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818372">&#34;.gif&#34;</span><span class="op" id="3818378">:</span>&nbsp;&nbsp;<span class="string" id="3818381">&#34;image/gif&#34;</span><span class="op" id="3818392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818396">&#34;.htm&#34;</span><span class="op" id="3818402">:</span>&nbsp;&nbsp;<span class="string" id="3818405">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3818431">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818435">&#34;.html&#34;</span><span class="op" id="3818442">:</span>&nbsp;<span class="string" id="3818444">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3818470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818474">&#34;.jpg&#34;</span><span class="op" id="3818480">:</span>&nbsp;&nbsp;<span class="string" id="3818483">&#34;image/jpeg&#34;</span><span class="op" id="3818495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818499">&#34;.js&#34;</span><span class="op" id="3818504">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3818508">&#34;application/x-javascript&#34;</span><span class="op" id="3818534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818538">&#34;.pdf&#34;</span><span class="op" id="3818544">:</span>&nbsp;&nbsp;<span class="string" id="3818547">&#34;application/pdf&#34;</span><span class="op" id="3818564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818568">&#34;.png&#34;</span><span class="op" id="3818574">:</span>&nbsp;&nbsp;<span class="string" id="3818577">&#34;image/png&#34;</span><span class="op" id="3818588">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3818592">&#34;.xml&#34;</span><span class="op" id="3818598">:</span>&nbsp;&nbsp;<span class="string" id="3818601">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="3818626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818632">mimeTypes</span>&nbsp;<span class="op" id="3818642">=</span>&nbsp;<span class="ident" id="3818644">clone</span><span class="op" id="3818649">(</span><span class="ident" id="3818650">mimeTypesLower</span><span class="op" id="3818664">)</span><br>
<span class="lineno"></span><span class="op" id="3818666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="3818669">func</span>&nbsp;<span class="ident" id="3818674">clone</span><span class="op" id="3818679">(</span><span class="ident" id="3818680">m</span>&nbsp;<span class="keyword" id="3818682">map</span><span class="op" id="3818685">[</span><span class="builtintype" id="3818686">string</span><span class="op" id="3818692">]</span><span class="builtintype" id="3818693">string</span><span class="op" id="3818699">)</span>&nbsp;<span class="keyword" id="3818701">map</span><span class="op" id="3818704">[</span><span class="builtintype" id="3818705">string</span><span class="op" id="3818711">]</span><span class="builtintype" id="3818712">string</span>&nbsp;<span class="op" id="3818719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818722">m2</span>&nbsp;<span class="op" id="3818725">:=</span>&nbsp;<span class="builtinfunc" id="3818728">make</span><span class="op" id="3818732">(</span><span class="keyword" id="3818733">map</span><span class="op" id="3818736">[</span><span class="builtintype" id="3818737">string</span><span class="op" id="3818743">]</span><span class="builtintype" id="3818744">string</span><span class="op" id="3818750">,</span>&nbsp;<span class="builtinfunc" id="3818752">len</span><span class="op" id="3818755">(</span><span class="ident" id="3818756">m</span><span class="op" id="3818757">)</span><span class="op" id="3818758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818761">for</span>&nbsp;<span class="ident" id="3818765">k</span><span class="op" id="3818766">,</span>&nbsp;<span class="ident" id="3818768">v</span>&nbsp;<span class="op" id="3818770">:=</span>&nbsp;<span class="keyword" id="3818773">range</span>&nbsp;<span class="ident" id="3818779">m</span>&nbsp;<span class="op" id="3818781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818785">m2</span><span class="op" id="3818787">[</span><span class="ident" id="3818788">k</span><span class="op" id="3818789">]</span>&nbsp;<span class="op" id="3818791">=</span>&nbsp;<span class="ident" id="3818793">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818797">if</span>&nbsp;<span class="ident" id="3818800">strings</span><span class="op" id="3818807">.</span><span class="ident" id="3818808">ToLower</span><span class="op" id="3818815">(</span><span class="ident" id="3818816">k</span><span class="op" id="3818817">)</span>&nbsp;<span class="op" id="3818819">!=</span>&nbsp;<span class="ident" id="3818822">k</span>&nbsp;<span class="op" id="3818824">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3818829">panic</span><span class="op" id="3818834">(</span><span class="string" id="3818835">&#34;keys&nbsp;in&nbsp;mimeTypesLower&nbsp;must&nbsp;be&nbsp;lowercase&#34;</span><span class="op" id="3818877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3818884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3818887">return</span>&nbsp;<span class="ident" id="3818894">m2</span><br>
<span class="lineno"></span><span class="op" id="3818897">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3818900">var</span>&nbsp;<span class="ident" id="3818904">once</span>&nbsp;<span class="ident" id="3818909">sync</span><span class="op" id="3818913">.</span><span class="ident" id="3818914">Once</span>&nbsp;<span class="comment" id="3818919">//&nbsp;guards&nbsp;initMime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3818939">//&nbsp;TypeByExtension&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;file&nbsp;extension&nbsp;ext.</span><br>
<span class="lineno"></span><span class="comment" id="3819020">//&nbsp;The&nbsp;extension&nbsp;ext&nbsp;should&nbsp;begin&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno">45</span><span class="comment" id="3819089">//&nbsp;When&nbsp;ext&nbsp;has&nbsp;no&nbsp;associated&nbsp;type,&nbsp;TypeByExtension&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3819153">//</span><br>
<span class="lineno"></span><span class="comment" id="3819156">//&nbsp;Extensions&nbsp;are&nbsp;looked&nbsp;up&nbsp;first&nbsp;case-sensitively,&nbsp;then&nbsp;case-insensitively.</span><br>
<span class="lineno"></span><span class="comment" id="3819233">//</span><br>
<span class="lineno"></span><span class="comment" id="3819236">//&nbsp;The&nbsp;built-in&nbsp;table&nbsp;is&nbsp;small&nbsp;but&nbsp;on&nbsp;unix&nbsp;it&nbsp;is&nbsp;augmented&nbsp;by&nbsp;the&nbsp;local</span><br>
<span class="lineno">50</span><span class="comment" id="3819308">//&nbsp;system&#39;s&nbsp;mime.types&nbsp;file(s)&nbsp;if&nbsp;available&nbsp;under&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;these</span><br>
<span class="lineno"></span><span class="comment" id="3819379">//&nbsp;names:</span><br>
<span class="lineno"></span><span class="comment" id="3819389">//</span><br>
<span class="lineno"></span><span class="comment" id="3819392">//&nbsp;&nbsp;&nbsp;/etc/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="3819413">//&nbsp;&nbsp;&nbsp;/etc/apache2/mime.types</span><br>
<span class="lineno">55</span><span class="comment" id="3819442">//&nbsp;&nbsp;&nbsp;/etc/apache/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="3819470">//</span><br>
<span class="lineno"></span><span class="comment" id="3819473">//&nbsp;On&nbsp;Windows,&nbsp;MIME&nbsp;types&nbsp;are&nbsp;extracted&nbsp;from&nbsp;the&nbsp;registry.</span><br>
<span class="lineno"></span><span class="comment" id="3819532">//</span><br>
<span class="lineno"></span><span class="comment" id="3819535">//&nbsp;Text&nbsp;types&nbsp;have&nbsp;the&nbsp;charset&nbsp;parameter&nbsp;set&nbsp;to&nbsp;&#34;utf-8&#34;&nbsp;by&nbsp;default.</span><br>
<span class="lineno">60</span><span class="keyword" id="3819603">func</span>&nbsp;<span class="ident" id="3819608">TypeByExtension</span><span class="op" id="3819623">(</span><span class="ident" id="3819624">ext</span>&nbsp;<span class="builtintype" id="3819628">string</span><span class="op" id="3819634">)</span>&nbsp;<span class="builtintype" id="3819636">string</span>&nbsp;<span class="op" id="3819643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819646">once</span><span class="op" id="3819650">.</span><span class="ident" id="3819651">Do</span><span class="op" id="3819653">(</span><span class="ident" id="3819654">initMime</span><span class="op" id="3819662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819665">mimeLock</span><span class="op" id="3819673">.</span><span class="ident" id="3819674">RLock</span><span class="op" id="3819679">(</span><span class="op" id="3819680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819683">defer</span>&nbsp;<span class="ident" id="3819689">mimeLock</span><span class="op" id="3819697">.</span><span class="ident" id="3819698">RUnlock</span><span class="op" id="3819705">(</span><span class="op" id="3819706">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819710">//&nbsp;Case-sensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819737">v</span>&nbsp;<span class="op" id="3819739">:=</span>&nbsp;<span class="ident" id="3819742">mimeTypes</span><span class="op" id="3819751">[</span><span class="ident" id="3819752">ext</span><span class="op" id="3819755">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819758">if</span>&nbsp;<span class="ident" id="3819761">v</span>&nbsp;<span class="op" id="3819763">!=</span>&nbsp;<span class="string" id="3819766">&#34;&#34;</span>&nbsp;<span class="op" id="3819769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819773">return</span>&nbsp;<span class="ident" id="3819780">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819783">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819787">//&nbsp;Case-insensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819816">//&nbsp;Optimistically&nbsp;assume&nbsp;a&nbsp;short&nbsp;ASCII&nbsp;extension&nbsp;and&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819873">//&nbsp;allocation-free&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819907">var</span>&nbsp;<span class="ident" id="3819911">buf</span>&nbsp;<span class="op" id="3819915">[</span><span class="num" id="3819916">10</span><span class="op" id="3819918">]</span><span class="builtintype" id="3819919">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819925">lower</span>&nbsp;<span class="op" id="3819931">:=</span>&nbsp;<span class="ident" id="3819934">buf</span><span class="op" id="3819937">[</span><span class="op" id="3819938">:</span><span class="num" id="3819939">0</span><span class="op" id="3819940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819943">const</span>&nbsp;<span class="ident" id="3819949">utf8RuneSelf</span>&nbsp;<span class="op" id="3819962">=</span>&nbsp;<span class="num" id="3819964">0x80</span>&nbsp;<span class="comment" id="3819969">//&nbsp;from&nbsp;utf8&nbsp;package,&nbsp;but&nbsp;not&nbsp;importing&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820014">for</span>&nbsp;<span class="ident" id="3820018">i</span>&nbsp;<span class="op" id="3820020">:=</span>&nbsp;<span class="num" id="3820023">0</span><span class="op" id="3820024">;</span>&nbsp;<span class="ident" id="3820026">i</span>&nbsp;<span class="op" id="3820028">&lt;</span>&nbsp;<span class="builtinfunc" id="3820030">len</span><span class="op" id="3820033">(</span><span class="ident" id="3820034">ext</span><span class="op" id="3820037">)</span><span class="op" id="3820038">;</span>&nbsp;<span class="ident" id="3820040">i</span><span class="op" id="3820041">++</span>&nbsp;<span class="op" id="3820044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820048">c</span>&nbsp;<span class="op" id="3820050">:=</span>&nbsp;<span class="ident" id="3820053">ext</span><span class="op" id="3820056">[</span><span class="ident" id="3820057">i</span><span class="op" id="3820058">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820062">if</span>&nbsp;<span class="ident" id="3820065">c</span>&nbsp;<span class="op" id="3820067">&gt;=</span>&nbsp;<span class="ident" id="3820070">utf8RuneSelf</span>&nbsp;<span class="op" id="3820083">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820088">//&nbsp;Slow&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820105">return</span>&nbsp;<span class="ident" id="3820112">mimeTypesLower</span><span class="op" id="3820126">[</span><span class="ident" id="3820127">strings</span><span class="op" id="3820134">.</span><span class="ident" id="3820135">ToLower</span><span class="op" id="3820142">(</span><span class="ident" id="3820143">ext</span><span class="op" id="3820146">)</span><span class="op" id="3820147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820155">if</span>&nbsp;<span class="string" id="3820158">&#39;A&#39;</span>&nbsp;<span class="op" id="3820162">&lt;=</span>&nbsp;<span class="ident" id="3820165">c</span>&nbsp;<span class="op" id="3820167">&amp;&amp;</span>&nbsp;<span class="ident" id="3820170">c</span>&nbsp;<span class="op" id="3820172">&lt;=</span>&nbsp;<span class="string" id="3820175">&#39;Z&#39;</span>&nbsp;<span class="op" id="3820179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820184">lower</span>&nbsp;<span class="op" id="3820190">=</span>&nbsp;<span class="builtinfunc" id="3820192">append</span><span class="op" id="3820198">(</span><span class="ident" id="3820199">lower</span><span class="op" id="3820204">,</span>&nbsp;<span class="ident" id="3820206">c</span><span class="op" id="3820207">+</span><span class="op" id="3820208">(</span><span class="string" id="3820209">&#39;a&#39;</span><span class="op" id="3820212">-</span><span class="string" id="3820213">&#39;A&#39;</span><span class="op" id="3820216">)</span><span class="op" id="3820217">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820221">}</span>&nbsp;<span class="keyword" id="3820223">else</span>&nbsp;<span class="op" id="3820228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820233">lower</span>&nbsp;<span class="op" id="3820239">=</span>&nbsp;<span class="builtinfunc" id="3820241">append</span><span class="op" id="3820247">(</span><span class="ident" id="3820248">lower</span><span class="op" id="3820253">,</span>&nbsp;<span class="ident" id="3820255">c</span><span class="op" id="3820256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820266">//&nbsp;The&nbsp;conversion&nbsp;from&nbsp;[]byte&nbsp;to&nbsp;string&nbsp;doesn&#39;t&nbsp;allocate&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820327">//&nbsp;a&nbsp;map&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820345">return</span>&nbsp;<span class="ident" id="3820352">mimeTypesLower</span><span class="op" id="3820366">[</span><span class="builtintype" id="3820367">string</span><span class="op" id="3820373">(</span><span class="ident" id="3820374">lower</span><span class="op" id="3820379">)</span><span class="op" id="3820380">]</span><br>
<span class="lineno"></span><span class="op" id="3820382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3820385">//&nbsp;AddExtensionType&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with</span><br>
<span class="lineno">95</span><span class="comment" id="3820440">//&nbsp;the&nbsp;extension&nbsp;ext&nbsp;to&nbsp;typ.&nbsp;The&nbsp;extension&nbsp;should&nbsp;begin&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3820501">//&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3820534">func</span>&nbsp;<span class="ident" id="3820539">AddExtensionType</span><span class="op" id="3820555">(</span><span class="ident" id="3820556">ext</span><span class="op" id="3820559">,</span>&nbsp;<span class="ident" id="3820561">typ</span>&nbsp;<span class="builtintype" id="3820565">string</span><span class="op" id="3820571">)</span>&nbsp;<span class="builtintype" id="3820573">error</span>&nbsp;<span class="op" id="3820579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820582">if</span>&nbsp;<span class="op" id="3820585">!</span><span class="ident" id="3820586">strings</span><span class="op" id="3820593">.</span><span class="ident" id="3820594">HasPrefix</span><span class="op" id="3820603">(</span><span class="ident" id="3820604">ext</span><span class="op" id="3820607">,</span>&nbsp;<span class="string" id="3820609">&#34;.&#34;</span><span class="op" id="3820612">)</span>&nbsp;<span class="op" id="3820614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820618">return</span>&nbsp;<span class="ident" id="3820625">fmt</span><span class="op" id="3820628">.</span><span class="ident" id="3820629">Errorf</span><span class="op" id="3820635">(</span><span class="string" id="3820636">`mime:&nbsp;extension&nbsp;%q&nbsp;misses&nbsp;dot`</span><span class="op" id="3820667">,</span>&nbsp;<span class="ident" id="3820669">ext</span><span class="op" id="3820672">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820678">once</span><span class="op" id="3820682">.</span><span class="ident" id="3820683">Do</span><span class="op" id="3820685">(</span><span class="ident" id="3820686">initMime</span><span class="op" id="3820694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820697">return</span>&nbsp;<span class="ident" id="3820704">setExtensionType</span><span class="op" id="3820720">(</span><span class="ident" id="3820721">ext</span><span class="op" id="3820724">,</span>&nbsp;<span class="ident" id="3820726">typ</span><span class="op" id="3820729">)</span><br>
<span class="lineno"></span><span class="op" id="3820731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3820734">func</span>&nbsp;<span class="ident" id="3820739">setExtensionType</span><span class="op" id="3820755">(</span><span class="ident" id="3820756">extension</span><span class="op" id="3820765">,</span>&nbsp;<span class="ident" id="3820767">mimeType</span>&nbsp;<span class="builtintype" id="3820776">string</span><span class="op" id="3820782">)</span>&nbsp;<span class="builtintype" id="3820784">error</span>&nbsp;<span class="op" id="3820790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820793">_</span><span class="op" id="3820794">,</span>&nbsp;<span class="ident" id="3820796">param</span><span class="op" id="3820801">,</span>&nbsp;<span class="ident" id="3820803">err</span>&nbsp;<span class="op" id="3820807">:=</span>&nbsp;<span class="ident" id="3820810">ParseMediaType</span><span class="op" id="3820824">(</span><span class="ident" id="3820825">mimeType</span><span class="op" id="3820833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820836">if</span>&nbsp;<span class="ident" id="3820839">err</span>&nbsp;<span class="op" id="3820843">!=</span>&nbsp;<span class="ident" id="3820846">nil</span>&nbsp;<span class="op" id="3820850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820854">return</span>&nbsp;<span class="ident" id="3820861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820866">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820869">if</span>&nbsp;<span class="ident" id="3820872">strings</span><span class="op" id="3820879">.</span><span class="ident" id="3820880">HasPrefix</span><span class="op" id="3820889">(</span><span class="ident" id="3820890">mimeType</span><span class="op" id="3820898">,</span>&nbsp;<span class="string" id="3820900">&#34;text/&#34;</span><span class="op" id="3820907">)</span>&nbsp;<span class="op" id="3820909">&amp;&amp;</span>&nbsp;<span class="ident" id="3820912">param</span><span class="op" id="3820917">[</span><span class="string" id="3820918">&#34;charset&#34;</span><span class="op" id="3820927">]</span>&nbsp;<span class="op" id="3820929">==</span>&nbsp;<span class="string" id="3820932">&#34;&#34;</span>&nbsp;<span class="op" id="3820935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820939">param</span><span class="op" id="3820944">[</span><span class="string" id="3820945">&#34;charset&#34;</span><span class="op" id="3820954">]</span>&nbsp;<span class="op" id="3820956">=</span>&nbsp;<span class="string" id="3820958">&#34;utf-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820968">mimeType</span>&nbsp;<span class="op" id="3820977">=</span>&nbsp;<span class="ident" id="3820979">FormatMediaType</span><span class="op" id="3820994">(</span><span class="ident" id="3820995">mimeType</span><span class="op" id="3821003">,</span>&nbsp;<span class="ident" id="3821005">param</span><span class="op" id="3821010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821016">extLower</span>&nbsp;<span class="op" id="3821025">:=</span>&nbsp;<span class="ident" id="3821028">strings</span><span class="op" id="3821035">.</span><span class="ident" id="3821036">ToLower</span><span class="op" id="3821043">(</span><span class="ident" id="3821044">extension</span><span class="op" id="3821053">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821057">mimeLock</span><span class="op" id="3821065">.</span><span class="ident" id="3821066">Lock</span><span class="op" id="3821070">(</span><span class="op" id="3821071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821074">mimeTypes</span><span class="op" id="3821083">[</span><span class="ident" id="3821084">extension</span><span class="op" id="3821093">]</span>&nbsp;<span class="op" id="3821095">=</span>&nbsp;<span class="ident" id="3821097">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821107">mimeTypesLower</span><span class="op" id="3821121">[</span><span class="ident" id="3821122">extLower</span><span class="op" id="3821130">]</span>&nbsp;<span class="op" id="3821132">=</span>&nbsp;<span class="ident" id="3821134">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821144">mimeLock</span><span class="op" id="3821152">.</span><span class="ident" id="3821153">Unlock</span><span class="op" id="3821159">(</span><span class="op" id="3821160">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821163">return</span>&nbsp;<span class="ident" id="3821170">nil</span><br>
<span class="lineno"></span><span class="op" id="3821174">}</span>
</div>
</body>
</html>
