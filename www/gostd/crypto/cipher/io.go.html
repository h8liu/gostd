<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html" class="current">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3594184">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3594239">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3594293">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3594344">package</span>&nbsp;<span class="ident" id="3594352">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3594360">import</span>&nbsp;<span class="string" id="3594367">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3594373">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3594451">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3594483">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3594555">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3594610">type</span>&nbsp;<span class="ident" id="3594615">StreamReader</span>&nbsp;<span class="keyword" id="3594628">struct</span>&nbsp;<span class="op" id="3594635">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594638">S</span>&nbsp;<span class="ident" id="3594640">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594648">R</span>&nbsp;<span class="ident" id="3594650">io</span><span class="op" id="3594652">.</span><span class="ident" id="3594653">Reader</span><br>
<span class="lineno"></span><span class="op" id="3594660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3594663">func</span>&nbsp;<span class="op" id="3594668">(</span><span class="ident" id="3594669">r</span>&nbsp;<span class="ident" id="3594671">StreamReader</span><span class="op" id="3594683">)</span>&nbsp;<span class="ident" id="3594685">Read</span><span class="op" id="3594689">(</span><span class="ident" id="3594690">dst</span>&nbsp;<span class="op" id="3594694">[</span><span class="op" id="3594695">]</span><span class="builtintype" id="3594696">byte</span><span class="op" id="3594700">)</span>&nbsp;<span class="op" id="3594702">(</span><span class="ident" id="3594703">n</span>&nbsp;<span class="builtintype" id="3594705">int</span><span class="op" id="3594708">,</span>&nbsp;<span class="ident" id="3594710">err</span>&nbsp;<span class="builtintype" id="3594714">error</span><span class="op" id="3594719">)</span>&nbsp;<span class="op" id="3594721">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594724">n</span><span class="op" id="3594725">,</span>&nbsp;<span class="ident" id="3594727">err</span>&nbsp;<span class="op" id="3594731">=</span>&nbsp;<span class="ident" id="3594733">r</span><span class="op" id="3594734">.</span><span class="ident" id="3594735">R</span><span class="op" id="3594736">.</span><span class="ident" id="3594737">Read</span><span class="op" id="3594741">(</span><span class="ident" id="3594742">dst</span><span class="op" id="3594745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3594748">r</span><span class="op" id="3594749">.</span><span class="ident" id="3594750">S</span><span class="op" id="3594751">.</span><span class="ident" id="3594752">XORKeyStream</span><span class="op" id="3594764">(</span><span class="ident" id="3594765">dst</span><span class="op" id="3594768">[</span><span class="op" id="3594769">:</span><span class="ident" id="3594770">n</span><span class="op" id="3594771">]</span><span class="op" id="3594772">,</span>&nbsp;<span class="ident" id="3594774">dst</span><span class="op" id="3594777">[</span><span class="op" id="3594778">:</span><span class="ident" id="3594779">n</span><span class="op" id="3594780">]</span><span class="op" id="3594781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3594784">return</span><br>
<span class="lineno"></span><span class="op" id="3594791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3594794">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3594866">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3594939">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3595016">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3595081">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3595118">type</span>&nbsp;<span class="ident" id="3595123">StreamWriter</span>&nbsp;<span class="keyword" id="3595136">struct</span>&nbsp;<span class="op" id="3595143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595146">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3595150">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595158">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3595162">io</span><span class="op" id="3595164">.</span><span class="ident" id="3595165">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595173">Err</span>&nbsp;<span class="builtintype" id="3595177">error</span>&nbsp;<span class="comment" id="3595183">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3595193">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3595196">func</span>&nbsp;<span class="op" id="3595201">(</span><span class="ident" id="3595202">w</span>&nbsp;<span class="ident" id="3595204">StreamWriter</span><span class="op" id="3595216">)</span>&nbsp;<span class="ident" id="3595218">Write</span><span class="op" id="3595223">(</span><span class="ident" id="3595224">src</span>&nbsp;<span class="op" id="3595228">[</span><span class="op" id="3595229">]</span><span class="builtintype" id="3595230">byte</span><span class="op" id="3595234">)</span>&nbsp;<span class="op" id="3595236">(</span><span class="ident" id="3595237">n</span>&nbsp;<span class="builtintype" id="3595239">int</span><span class="op" id="3595242">,</span>&nbsp;<span class="ident" id="3595244">err</span>&nbsp;<span class="builtintype" id="3595248">error</span><span class="op" id="3595253">)</span>&nbsp;<span class="op" id="3595255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595258">c</span>&nbsp;<span class="op" id="3595260">:=</span>&nbsp;<span class="builtinfunc" id="3595263">make</span><span class="op" id="3595267">(</span><span class="op" id="3595268">[</span><span class="op" id="3595269">]</span><span class="builtintype" id="3595270">byte</span><span class="op" id="3595274">,</span>&nbsp;<span class="builtinfunc" id="3595276">len</span><span class="op" id="3595279">(</span><span class="ident" id="3595280">src</span><span class="op" id="3595283">)</span><span class="op" id="3595284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595287">w</span><span class="op" id="3595288">.</span><span class="ident" id="3595289">S</span><span class="op" id="3595290">.</span><span class="ident" id="3595291">XORKeyStream</span><span class="op" id="3595303">(</span><span class="ident" id="3595304">c</span><span class="op" id="3595305">,</span>&nbsp;<span class="ident" id="3595307">src</span><span class="op" id="3595310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595313">n</span><span class="op" id="3595314">,</span>&nbsp;<span class="ident" id="3595316">err</span>&nbsp;<span class="op" id="3595320">=</span>&nbsp;<span class="ident" id="3595322">w</span><span class="op" id="3595323">.</span><span class="ident" id="3595324">W</span><span class="op" id="3595325">.</span><span class="ident" id="3595326">Write</span><span class="op" id="3595331">(</span><span class="ident" id="3595332">c</span><span class="op" id="3595333">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595336">if</span>&nbsp;<span class="ident" id="3595339">n</span>&nbsp;<span class="op" id="3595341">!=</span>&nbsp;<span class="builtinfunc" id="3595344">len</span><span class="op" id="3595347">(</span><span class="ident" id="3595348">src</span><span class="op" id="3595351">)</span>&nbsp;<span class="op" id="3595353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595357">if</span>&nbsp;<span class="ident" id="3595360">err</span>&nbsp;<span class="op" id="3595364">==</span>&nbsp;<span class="builtintype" id="3595367">nil</span>&nbsp;<span class="op" id="3595371">{</span>&nbsp;<span class="comment" id="3595373">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595399">err</span>&nbsp;<span class="op" id="3595403">=</span>&nbsp;<span class="ident" id="3595405">io</span><span class="op" id="3595407">.</span><span class="ident" id="3595408">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595427">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595430">return</span><br>
<span class="lineno"></span><span class="op" id="3595437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3595440">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3595528">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3595579">func</span>&nbsp;<span class="op" id="3595584">(</span><span class="ident" id="3595585">w</span>&nbsp;<span class="ident" id="3595587">StreamWriter</span><span class="op" id="3595599">)</span>&nbsp;<span class="ident" id="3595601">Close</span><span class="op" id="3595606">(</span><span class="op" id="3595607">)</span>&nbsp;<span class="builtintype" id="3595609">error</span>&nbsp;<span class="op" id="3595615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595618">if</span>&nbsp;<span class="ident" id="3595621">c</span><span class="op" id="3595622">,</span>&nbsp;<span class="ident" id="3595624">ok</span>&nbsp;<span class="op" id="3595627">:=</span>&nbsp;<span class="ident" id="3595630">w</span><span class="op" id="3595631">.</span><span class="ident" id="3595632">W</span><span class="op" id="3595633">.</span><span class="op" id="3595634">(</span><span class="ident" id="3595635">io</span><span class="op" id="3595637">.</span><span class="ident" id="3595638">Closer</span><span class="op" id="3595644">)</span><span class="op" id="3595645">;</span>&nbsp;<span class="ident" id="3595647">ok</span>&nbsp;<span class="op" id="3595650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595654">return</span>&nbsp;<span class="ident" id="3595661">c</span><span class="op" id="3595662">.</span><span class="ident" id="3595663">Close</span><span class="op" id="3595668">(</span><span class="op" id="3595669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3595675">return</span>&nbsp;<span class="builtintype" id="3595682">nil</span><br>
<span class="lineno">55</span><span class="op" id="3595686">}</span>
</div>
</body>
</html>
