<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8215766">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8215821">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8215875">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8215926">package</span>&nbsp;<span class="ident" id="8215934">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8215939">import</span>&nbsp;<span class="op" id="8215946">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215949">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215958">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215964">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215977">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215988">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8215999">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216010">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8216020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8216023">type</span>&nbsp;<span class="ident" id="8216028">lzwTest</span>&nbsp;<span class="keyword" id="8216036">struct</span>&nbsp;<span class="op" id="8216043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216046">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8216057">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216065">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8216076">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216084">compressed</span>&nbsp;<span class="builtintype" id="8216095">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216103">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8216114">error</span><br>
<span class="lineno"></span><span class="op" id="8216120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8216123">var</span>&nbsp;<span class="ident" id="8216127">lzwTests</span>&nbsp;<span class="op" id="8216136">=</span>&nbsp;<span class="op" id="8216138">[</span><span class="op" id="8216139">]</span><span class="ident" id="8216140">lzwTest</span><span class="op" id="8216147">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216154">&#34;empty;LSB;8&#34;</span><span class="op" id="8216167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216171">&#34;&#34;</span><span class="op" id="8216173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216177">&#34;\x01\x01&#34;</span><span class="op" id="8216187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216191">nil</span><span class="op" id="8216194">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216197">}</span><span class="op" id="8216198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216205">&#34;empty;MSB;8&#34;</span><span class="op" id="8216218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216222">&#34;&#34;</span><span class="op" id="8216224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216228">&#34;\x80\x80&#34;</span><span class="op" id="8216238">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216242">nil</span><span class="op" id="8216245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216248">}</span><span class="op" id="8216249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216256">&#34;tobe;LSB;7&#34;</span><span class="op" id="8216268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216272">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8216298">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216302">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8216372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216376">nil</span><span class="op" id="8216379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216382">}</span><span class="op" id="8216383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216390">&#34;tobe;LSB;8&#34;</span><span class="op" id="8216402">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216406">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8216432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216436">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="8216518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216522">nil</span><span class="op" id="8216525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216528">}</span><span class="op" id="8216529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216532">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216536">&#34;tobe;MSB;7&#34;</span><span class="op" id="8216548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216552">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8216578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216582">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8216652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216656">nil</span><span class="op" id="8216659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216662">}</span><span class="op" id="8216663">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216670">&#34;tobe;MSB;8&#34;</span><span class="op" id="8216682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216686">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8216712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216716">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="8216798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216802">nil</span><span class="op" id="8216805">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216808">}</span><span class="op" id="8216809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216816">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="8216838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216842">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8216868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8216872">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="8216918">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8216922">io</span><span class="op" id="8216924">.</span><span class="ident" id="8216925">ErrUnexpectedEOF</span><span class="op" id="8216941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8216944">}</span><span class="op" id="8216945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8216948">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217038">&#34;gif;LSB;8&#34;</span><span class="op" id="8217049">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217053">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="8217115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217119">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="8217165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217169">nil</span><span class="op" id="8217172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217175">}</span><span class="op" id="8217176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8217179">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217292">&#34;pdf;MSB;8&#34;</span><span class="op" id="8217303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217307">&#34;-----A---B&#34;</span><span class="op" id="8217319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8217323">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="8217361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217365">nil</span><span class="op" id="8217368">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217371">}</span><span class="op" id="8217372">,</span><br>
<span class="lineno"></span><span class="op" id="8217374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8217377">func</span>&nbsp;<span class="ident" id="8217382">TestReader</span><span class="op" id="8217392">(</span><span class="ident" id="8217393">t</span>&nbsp;<span class="op" id="8217395">*</span><span class="ident" id="8217396">testing</span><span class="op" id="8217403">.</span><span class="ident" id="8217404">T</span><span class="op" id="8217405">)</span>&nbsp;<span class="op" id="8217407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217410">var</span>&nbsp;<span class="ident" id="8217414">b</span>&nbsp;<span class="ident" id="8217416">bytes</span><span class="op" id="8217421">.</span><span class="ident" id="8217422">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217430">for</span>&nbsp;<span class="ident" id="8217434">_</span><span class="op" id="8217435">,</span>&nbsp;<span class="ident" id="8217437">tt</span>&nbsp;<span class="op" id="8217440">:=</span>&nbsp;<span class="keyword" id="8217443">range</span>&nbsp;<span class="ident" id="8217449">lzwTests</span>&nbsp;<span class="op" id="8217458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217462">d</span>&nbsp;<span class="op" id="8217464">:=</span>&nbsp;<span class="ident" id="8217467">strings</span><span class="op" id="8217474">.</span><span class="ident" id="8217475">Split</span><span class="op" id="8217480">(</span><span class="ident" id="8217481">tt</span><span class="op" id="8217483">.</span><span class="ident" id="8217484">desc</span><span class="op" id="8217488">,</span>&nbsp;<span class="string" id="8217490">&#34;;&#34;</span><span class="op" id="8217493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217497">var</span>&nbsp;<span class="ident" id="8217501">order</span>&nbsp;<span class="ident" id="8217507">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217515">switch</span>&nbsp;<span class="ident" id="8217522">d</span><span class="op" id="8217523">[</span><span class="num" id="8217524">1</span><span class="op" id="8217525">]</span>&nbsp;<span class="op" id="8217527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217531">case</span>&nbsp;<span class="string" id="8217536">&#34;LSB&#34;</span><span class="op" id="8217541">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217546">order</span>&nbsp;<span class="op" id="8217552">=</span>&nbsp;<span class="ident" id="8217554">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217560">case</span>&nbsp;<span class="string" id="8217565">&#34;MSB&#34;</span><span class="op" id="8217570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217575">order</span>&nbsp;<span class="op" id="8217581">=</span>&nbsp;<span class="ident" id="8217583">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217589">default</span><span class="op" id="8217596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217601">t</span><span class="op" id="8217602">.</span><span class="ident" id="8217603">Errorf</span><span class="op" id="8217609">(</span><span class="string" id="8217610">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="8217628">,</span>&nbsp;<span class="ident" id="8217630">tt</span><span class="op" id="8217632">.</span><span class="ident" id="8217633">desc</span><span class="op" id="8217637">,</span>&nbsp;<span class="ident" id="8217639">d</span><span class="op" id="8217640">[</span><span class="num" id="8217641">1</span><span class="op" id="8217642">]</span><span class="op" id="8217643">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217651">litWidth</span><span class="op" id="8217659">,</span>&nbsp;<span class="ident" id="8217661">_</span>&nbsp;<span class="op" id="8217663">:=</span>&nbsp;<span class="ident" id="8217666">strconv</span><span class="op" id="8217673">.</span><span class="ident" id="8217674">Atoi</span><span class="op" id="8217678">(</span><span class="ident" id="8217679">d</span><span class="op" id="8217680">[</span><span class="num" id="8217681">2</span><span class="op" id="8217682">]</span><span class="op" id="8217683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217687">rc</span>&nbsp;<span class="op" id="8217690">:=</span>&nbsp;<span class="ident" id="8217693">NewReader</span><span class="op" id="8217702">(</span><span class="ident" id="8217703">strings</span><span class="op" id="8217710">.</span><span class="ident" id="8217711">NewReader</span><span class="op" id="8217720">(</span><span class="ident" id="8217721">tt</span><span class="op" id="8217723">.</span><span class="ident" id="8217724">compressed</span><span class="op" id="8217734">)</span><span class="op" id="8217735">,</span>&nbsp;<span class="ident" id="8217737">order</span><span class="op" id="8217742">,</span>&nbsp;<span class="ident" id="8217744">litWidth</span><span class="op" id="8217752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217756">defer</span>&nbsp;<span class="ident" id="8217762">rc</span><span class="op" id="8217764">.</span><span class="ident" id="8217765">Close</span><span class="op" id="8217770">(</span><span class="op" id="8217771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217775">b</span><span class="op" id="8217776">.</span><span class="ident" id="8217777">Reset</span><span class="op" id="8217782">(</span><span class="op" id="8217783">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217787">n</span><span class="op" id="8217788">,</span>&nbsp;<span class="ident" id="8217790">err</span>&nbsp;<span class="op" id="8217794">:=</span>&nbsp;<span class="ident" id="8217797">io</span><span class="op" id="8217799">.</span><span class="ident" id="8217800">Copy</span><span class="op" id="8217804">(</span><span class="op" id="8217805">&amp;</span><span class="ident" id="8217806">b</span><span class="op" id="8217807">,</span>&nbsp;<span class="ident" id="8217809">rc</span><span class="op" id="8217811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217815">if</span>&nbsp;<span class="ident" id="8217818">err</span>&nbsp;<span class="op" id="8217822">!=</span>&nbsp;<span class="ident" id="8217825">nil</span>&nbsp;<span class="op" id="8217829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217834">if</span>&nbsp;<span class="ident" id="8217837">err</span>&nbsp;<span class="op" id="8217841">!=</span>&nbsp;<span class="ident" id="8217844">tt</span><span class="op" id="8217846">.</span><span class="ident" id="8217847">err</span>&nbsp;<span class="op" id="8217851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217857">t</span><span class="op" id="8217858">.</span><span class="ident" id="8217859">Errorf</span><span class="op" id="8217865">(</span><span class="string" id="8217866">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8217891">,</span>&nbsp;<span class="ident" id="8217893">tt</span><span class="op" id="8217895">.</span><span class="ident" id="8217896">desc</span><span class="op" id="8217900">,</span>&nbsp;<span class="ident" id="8217902">err</span><span class="op" id="8217905">,</span>&nbsp;<span class="ident" id="8217907">tt</span><span class="op" id="8217909">.</span><span class="ident" id="8217910">err</span><span class="op" id="8217913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217918">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217923">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8217934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217938">s</span>&nbsp;<span class="op" id="8217940">:=</span>&nbsp;<span class="ident" id="8217943">b</span><span class="op" id="8217944">.</span><span class="ident" id="8217945">String</span><span class="op" id="8217951">(</span><span class="op" id="8217952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8217956">if</span>&nbsp;<span class="ident" id="8217959">s</span>&nbsp;<span class="op" id="8217961">!=</span>&nbsp;<span class="ident" id="8217964">tt</span><span class="op" id="8217966">.</span><span class="ident" id="8217967">raw</span>&nbsp;<span class="op" id="8217971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8217976">t</span><span class="op" id="8217977">.</span><span class="ident" id="8217978">Errorf</span><span class="op" id="8217984">(</span><span class="string" id="8217985">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="8218021">,</span>&nbsp;<span class="ident" id="8218023">tt</span><span class="op" id="8218025">.</span><span class="ident" id="8218026">desc</span><span class="op" id="8218030">,</span>&nbsp;<span class="ident" id="8218032">n</span><span class="op" id="8218033">,</span>&nbsp;<span class="ident" id="8218035">s</span><span class="op" id="8218036">,</span>&nbsp;<span class="builtinfunc" id="8218038">len</span><span class="op" id="8218041">(</span><span class="ident" id="8218042">tt</span><span class="op" id="8218044">.</span><span class="ident" id="8218045">raw</span><span class="op" id="8218048">)</span><span class="op" id="8218049">,</span>&nbsp;<span class="ident" id="8218051">tt</span><span class="op" id="8218053">.</span><span class="ident" id="8218054">raw</span><span class="op" id="8218057">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218064">}</span><br>
<span class="lineno"></span><span class="op" id="8218066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8218069">func</span>&nbsp;<span class="ident" id="8218074">benchmarkDecoder</span><span class="op" id="8218090">(</span><span class="ident" id="8218091">b</span>&nbsp;<span class="op" id="8218093">*</span><span class="ident" id="8218094">testing</span><span class="op" id="8218101">.</span><span class="ident" id="8218102">B</span><span class="op" id="8218103">,</span>&nbsp;<span class="ident" id="8218105">n</span>&nbsp;<span class="builtintype" id="8218107">int</span><span class="op" id="8218110">)</span>&nbsp;<span class="op" id="8218112">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218115">b</span><span class="op" id="8218116">.</span><span class="ident" id="8218117">StopTimer</span><span class="op" id="8218126">(</span><span class="op" id="8218127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218130">b</span><span class="op" id="8218131">.</span><span class="ident" id="8218132">SetBytes</span><span class="op" id="8218140">(</span><span class="ident" id="8218141">int64</span><span class="op" id="8218146">(</span><span class="ident" id="8218147">n</span><span class="op" id="8218148">)</span><span class="op" id="8218149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218152">buf0</span><span class="op" id="8218156">,</span>&nbsp;<span class="ident" id="8218158">err</span>&nbsp;<span class="op" id="8218162">:=</span>&nbsp;<span class="ident" id="8218165">ioutil</span><span class="op" id="8218171">.</span><span class="ident" id="8218172">ReadFile</span><span class="op" id="8218180">(</span><span class="string" id="8218181">&#34;../testdata/e.txt&#34;</span><span class="op" id="8218200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8218203">if</span>&nbsp;<span class="ident" id="8218206">err</span>&nbsp;<span class="op" id="8218210">!=</span>&nbsp;<span class="ident" id="8218213">nil</span>&nbsp;<span class="op" id="8218217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218221">b</span><span class="op" id="8218222">.</span><span class="ident" id="8218223">Fatal</span><span class="op" id="8218228">(</span><span class="ident" id="8218229">err</span><span class="op" id="8218232">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8218238">if</span>&nbsp;<span class="builtinfunc" id="8218241">len</span><span class="op" id="8218244">(</span><span class="ident" id="8218245">buf0</span><span class="op" id="8218249">)</span>&nbsp;<span class="op" id="8218251">==</span>&nbsp;<span class="num" id="8218254">0</span>&nbsp;<span class="op" id="8218256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218260">b</span><span class="op" id="8218261">.</span><span class="ident" id="8218262">Fatalf</span><span class="op" id="8218268">(</span><span class="string" id="8218269">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="8218292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218298">compressed</span>&nbsp;<span class="op" id="8218309">:=</span>&nbsp;<span class="builtinfunc" id="8218312">new</span><span class="op" id="8218315">(</span><span class="ident" id="8218316">bytes</span><span class="op" id="8218321">.</span><span class="ident" id="8218322">Buffer</span><span class="op" id="8218328">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218331">w</span>&nbsp;<span class="op" id="8218333">:=</span>&nbsp;<span class="ident" id="8218336">NewWriter</span><span class="op" id="8218345">(</span><span class="ident" id="8218346">compressed</span><span class="op" id="8218356">,</span>&nbsp;<span class="ident" id="8218358">LSB</span><span class="op" id="8218361">,</span>&nbsp;<span class="num" id="8218363">8</span><span class="op" id="8218364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8218367">for</span>&nbsp;<span class="ident" id="8218371">i</span>&nbsp;<span class="op" id="8218373">:=</span>&nbsp;<span class="num" id="8218376">0</span><span class="op" id="8218377">;</span>&nbsp;<span class="ident" id="8218379">i</span>&nbsp;<span class="op" id="8218381">&lt;</span>&nbsp;<span class="ident" id="8218383">n</span><span class="op" id="8218384">;</span>&nbsp;<span class="ident" id="8218386">i</span>&nbsp;<span class="op" id="8218388">+=</span>&nbsp;<span class="builtinfunc" id="8218391">len</span><span class="op" id="8218394">(</span><span class="ident" id="8218395">buf0</span><span class="op" id="8218399">)</span>&nbsp;<span class="op" id="8218401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8218405">if</span>&nbsp;<span class="builtinfunc" id="8218408">len</span><span class="op" id="8218411">(</span><span class="ident" id="8218412">buf0</span><span class="op" id="8218416">)</span>&nbsp;<span class="op" id="8218418">&gt;</span>&nbsp;<span class="ident" id="8218420">n</span><span class="op" id="8218421">-</span><span class="ident" id="8218422">i</span>&nbsp;<span class="op" id="8218424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218429">buf0</span>&nbsp;<span class="op" id="8218434">=</span>&nbsp;<span class="ident" id="8218436">buf0</span><span class="op" id="8218440">[</span><span class="op" id="8218441">:</span><span class="ident" id="8218442">n</span><span class="op" id="8218443">-</span><span class="ident" id="8218444">i</span><span class="op" id="8218445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218449">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218453">w</span><span class="op" id="8218454">.</span><span class="ident" id="8218455">Write</span><span class="op" id="8218460">(</span><span class="ident" id="8218461">buf0</span><span class="op" id="8218465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218471">w</span><span class="op" id="8218472">.</span><span class="ident" id="8218473">Close</span><span class="op" id="8218478">(</span><span class="op" id="8218479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218482">buf1</span>&nbsp;<span class="op" id="8218487">:=</span>&nbsp;<span class="ident" id="8218490">compressed</span><span class="op" id="8218500">.</span><span class="ident" id="8218501">Bytes</span><span class="op" id="8218506">(</span><span class="op" id="8218507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218510">buf0</span><span class="op" id="8218514">,</span>&nbsp;<span class="ident" id="8218516">compressed</span><span class="op" id="8218526">,</span>&nbsp;<span class="ident" id="8218528">w</span>&nbsp;<span class="op" id="8218530">=</span>&nbsp;<span class="ident" id="8218532">nil</span><span class="op" id="8218535">,</span>&nbsp;<span class="ident" id="8218537">nil</span><span class="op" id="8218540">,</span>&nbsp;<span class="ident" id="8218542">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218547">runtime</span><span class="op" id="8218554">.</span><span class="ident" id="8218555">GC</span><span class="op" id="8218557">(</span><span class="op" id="8218558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218561">b</span><span class="op" id="8218562">.</span><span class="ident" id="8218563">StartTimer</span><span class="op" id="8218573">(</span><span class="op" id="8218574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8218577">for</span>&nbsp;<span class="ident" id="8218581">i</span>&nbsp;<span class="op" id="8218583">:=</span>&nbsp;<span class="num" id="8218586">0</span><span class="op" id="8218587">;</span>&nbsp;<span class="ident" id="8218589">i</span>&nbsp;<span class="op" id="8218591">&lt;</span>&nbsp;<span class="ident" id="8218593">b</span><span class="op" id="8218594">.</span><span class="ident" id="8218595">N</span><span class="op" id="8218596">;</span>&nbsp;<span class="ident" id="8218598">i</span><span class="op" id="8218599">++</span>&nbsp;<span class="op" id="8218602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218606">io</span><span class="op" id="8218608">.</span><span class="ident" id="8218609">Copy</span><span class="op" id="8218613">(</span><span class="ident" id="8218614">ioutil</span><span class="op" id="8218620">.</span><span class="ident" id="8218621">Discard</span><span class="op" id="8218628">,</span>&nbsp;<span class="ident" id="8218630">NewReader</span><span class="op" id="8218639">(</span><span class="ident" id="8218640">bytes</span><span class="op" id="8218645">.</span><span class="ident" id="8218646">NewReader</span><span class="op" id="8218655">(</span><span class="ident" id="8218656">buf1</span><span class="op" id="8218660">)</span><span class="op" id="8218661">,</span>&nbsp;<span class="ident" id="8218663">LSB</span><span class="op" id="8218666">,</span>&nbsp;<span class="num" id="8218668">8</span><span class="op" id="8218669">)</span><span class="op" id="8218670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8218673">}</span><br>
<span class="lineno">140</span><span class="op" id="8218675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8218678">func</span>&nbsp;<span class="ident" id="8218683">BenchmarkDecoder1e4</span><span class="op" id="8218702">(</span><span class="ident" id="8218703">b</span>&nbsp;<span class="op" id="8218705">*</span><span class="ident" id="8218706">testing</span><span class="op" id="8218713">.</span><span class="ident" id="8218714">B</span><span class="op" id="8218715">)</span>&nbsp;<span class="op" id="8218717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218720">benchmarkDecoder</span><span class="op" id="8218736">(</span><span class="ident" id="8218737">b</span><span class="op" id="8218738">,</span>&nbsp;<span class="num" id="8218740">1e4</span><span class="op" id="8218743">)</span><br>
<span class="lineno"></span><span class="op" id="8218745">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8218748">func</span>&nbsp;<span class="ident" id="8218753">BenchmarkDecoder1e5</span><span class="op" id="8218772">(</span><span class="ident" id="8218773">b</span>&nbsp;<span class="op" id="8218775">*</span><span class="ident" id="8218776">testing</span><span class="op" id="8218783">.</span><span class="ident" id="8218784">B</span><span class="op" id="8218785">)</span>&nbsp;<span class="op" id="8218787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218790">benchmarkDecoder</span><span class="op" id="8218806">(</span><span class="ident" id="8218807">b</span><span class="op" id="8218808">,</span>&nbsp;<span class="num" id="8218810">1e5</span><span class="op" id="8218813">)</span><br>
<span class="lineno"></span><span class="op" id="8218815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="8218818">func</span>&nbsp;<span class="ident" id="8218823">BenchmarkDecoder1e6</span><span class="op" id="8218842">(</span><span class="ident" id="8218843">b</span>&nbsp;<span class="op" id="8218845">*</span><span class="ident" id="8218846">testing</span><span class="op" id="8218853">.</span><span class="ident" id="8218854">B</span><span class="op" id="8218855">)</span>&nbsp;<span class="op" id="8218857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8218860">benchmarkDecoder</span><span class="op" id="8218876">(</span><span class="ident" id="8218877">b</span><span class="op" id="8218878">,</span>&nbsp;<span class="num" id="8218880">1e6</span><span class="op" id="8218883">)</span><br>
<span class="lineno"></span><span class="op" id="8218885">}</span>
</div>
</body>
</html>
