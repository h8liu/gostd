<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1345505">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1345560">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1345614">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1345665">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345730">//&nbsp;DNS&nbsp;client:&nbsp;see&nbsp;RFC&nbsp;1035.</span><br>
<span class="lineno"></span><span class="comment" id="1345759">//&nbsp;Has&nbsp;to&nbsp;be&nbsp;linked&nbsp;into&nbsp;package&nbsp;net&nbsp;for&nbsp;Dial.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="1345807">//&nbsp;TODO(rsc):</span><br>
<span class="lineno"></span><span class="comment" id="1345821">//&nbsp;&nbsp;&nbsp;&nbspCould&nbsp;potentially&nbsp;handle&nbsp;many&nbsp;outstanding&nbsp;lookups&nbsp;faster.</span><br>
<span class="lineno"></span><span class="comment" id="1345882">//&nbsp;&nbsp;&nbsp;&nbspCould&nbsp;have&nbsp;a&nbsp;small&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="1345911">//&nbsp;&nbsp;&nbsp;&nbspRandom&nbsp;UDP&nbsp;source&nbsp;port&nbsp;(net.Dial&nbsp;should&nbsp;do&nbsp;that&nbsp;for&nbsp;us).</span><br>
<span class="lineno"></span><span class="comment" id="1345971">//&nbsp;&nbsp;&nbsp;&nbspRandom&nbsp;request&nbsp;IDs.</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="1345995">package</span>&nbsp;<span class="ident" id="1346003">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1346008">import</span>&nbsp;<span class="op" id="1346015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346018">&#34;errors&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346028">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346034">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346047">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346053">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1346061">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="1346068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1346071">//&nbsp;A&nbsp;dnsConn&nbsp;represents&nbsp;a&nbsp;DNS&nbsp;transport&nbsp;endpoint.</span><br>
<span class="lineno"></span><span class="keyword" id="1346121">type</span>&nbsp;<span class="ident" id="1346126">dnsConn</span>&nbsp;<span class="keyword" id="1346134">interface</span>&nbsp;<span class="op" id="1346144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346147"><a href="/net/net.go.html#1465335">Conn</a></span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346154">//&nbsp;readDNSResponse&nbsp;reads&nbsp;a&nbsp;DNS&nbsp;response&nbsp;message&nbsp;from&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346216">//&nbsp;transport&nbsp;endpoint&nbsp;and&nbsp;returns&nbsp;the&nbsp;received&nbsp;DNS&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346277">//&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346290">readDNSResponse</span><span class="op" id="1346305">(</span><span class="op" id="1346306">)</span>&nbsp;<span class="op" id="1346308">(</span><span class="op" id="1346309">*</span><span class="ident" id="1346310"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346316">,</span>&nbsp;<span class="builtintype" id="1346318">error</span><span class="op" id="1346323">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346327">//&nbsp;writeDNSQuery&nbsp;writes&nbsp;a&nbsp;DNS&nbsp;query&nbsp;message&nbsp;to&nbsp;the&nbsp;DNS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346383">//&nbsp;connection&nbsp;endpoint.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346408">writeDNSQuery</span><span class="op" id="1346421">(</span><span class="op" id="1346422">*</span><span class="ident" id="1346423"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346429">)</span>&nbsp;<span class="builtintype" id="1346431">error</span><br>
<span class="lineno"></span><span class="op" id="1346437">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1346440">func</span>&nbsp;<span class="op" id="1346445">(</span><span class="ident" id="1346446">c</span>&nbsp;<span class="op" id="1346448">*</span><span class="ident" id="1346449"><a href="/net/udpsock_posix.go.html#1519094">UDPConn</a></span><span class="op" id="1346456">)</span>&nbsp;<span class="ident" id="1346458">readDNSResponse</span><span class="op" id="1346473">(</span><span class="op" id="1346474">)</span>&nbsp;<span class="op" id="1346476">(</span><span class="op" id="1346477">*</span><span class="ident" id="1346478"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346484">,</span>&nbsp;<span class="builtintype" id="1346486">error</span><span class="op" id="1346491">)</span>&nbsp;<span class="op" id="1346493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346496">b</span>&nbsp;<span class="op" id="1346498">:=</span>&nbsp;<span class="builtinfunc" id="1346501">make</span><span class="op" id="1346505">(</span><span class="op" id="1346506">[</span><span class="op" id="1346507">]</span><span class="builtintype" id="1346508">byte</span><span class="op" id="1346512">,</span>&nbsp;<span class="num" id="1346514">512</span><span class="op" id="1346517">)</span>&nbsp;<span class="comment" id="1346519">//&nbsp;see&nbsp;RFC&nbsp;1035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346536">n</span><span class="op" id="1346537">,</span>&nbsp;<span class="ident" id="1346539">err</span>&nbsp;<span class="op" id="1346543">:=</span>&nbsp;<span class="ident" id="1346546"><a href="/net/dnsclient_unix.go.html#1346446">c</a></span><span class="op" id="1346547">.</span><span class="ident" id="1346548">Read</span><span class="op" id="1346552">(</span><span class="ident" id="1346553"><a href="/net/dnsclient_unix.go.html#1346496">b</a></span><span class="op" id="1346554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346557">if</span>&nbsp;<span class="ident" id="1346560"><a href="/net/dnsclient_unix.go.html#1346539">err</a></span>&nbsp;<span class="op" id="1346564">!=</span>&nbsp;<span class="ident" id="1346567">nil</span>&nbsp;<span class="op" id="1346571">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346575">return</span>&nbsp;<span class="ident" id="1346582">nil</span><span class="op" id="1346585">,</span>&nbsp;<span class="ident" id="1346587"><a href="/net/dnsclient_unix.go.html#1346539">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346595">msg</span>&nbsp;<span class="op" id="1346599">:=</span>&nbsp;<span class="op" id="1346602">&amp;</span><span class="ident" id="1346603"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346609">{</span><span class="op" id="1346610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346613">if</span>&nbsp;<span class="op" id="1346616">!</span><span class="ident" id="1346617"><a href="/net/dnsclient_unix.go.html#1346595">msg</a></span><span class="op" id="1346620">.</span><span class="ident" id="1346621">Unpack</span><span class="op" id="1346627">(</span><span class="ident" id="1346628"><a href="/net/dnsclient_unix.go.html#1346496">b</a></span><span class="op" id="1346629">[</span><span class="op" id="1346630">:</span><span class="ident" id="1346631"><a href="/net/dnsclient_unix.go.html#1346536">n</a></span><span class="op" id="1346632">]</span><span class="op" id="1346633">)</span>&nbsp;<span class="op" id="1346635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346639">return</span>&nbsp;<span class="ident" id="1346646">nil</span><span class="op" id="1346649">,</span>&nbsp;<span class="ident" id="1346651"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1346657">.</span><span class="ident" id="1346658">New</span><span class="op" id="1346661">(</span><span class="string" id="1346662">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="1346692">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346698">return</span>&nbsp;<span class="ident" id="1346705"><a href="/net/dnsclient_unix.go.html#1346595">msg</a></span><span class="op" id="1346708">,</span>&nbsp;<span class="ident" id="1346710">nil</span><br>
<span class="lineno"></span><span class="op" id="1346714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1346717">func</span>&nbsp;<span class="op" id="1346722">(</span><span class="ident" id="1346723">c</span>&nbsp;<span class="op" id="1346725">*</span><span class="ident" id="1346726"><a href="/net/udpsock_posix.go.html#1519094">UDPConn</a></span><span class="op" id="1346733">)</span>&nbsp;<span class="ident" id="1346735">writeDNSQuery</span><span class="op" id="1346748">(</span><span class="ident" id="1346749">msg</span>&nbsp;<span class="op" id="1346753">*</span><span class="ident" id="1346754"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346760">)</span>&nbsp;<span class="builtintype" id="1346762">error</span>&nbsp;<span class="op" id="1346768">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346771">b</span><span class="op" id="1346772">,</span>&nbsp;<span class="ident" id="1346774">ok</span>&nbsp;<span class="op" id="1346777">:=</span>&nbsp;<span class="ident" id="1346780"><a href="/net/dnsclient_unix.go.html#1346749">msg</a></span><span class="op" id="1346783">.</span><span class="ident" id="1346784">Pack</span><span class="op" id="1346788">(</span><span class="op" id="1346789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346792">if</span>&nbsp;<span class="op" id="1346795">!</span><span class="ident" id="1346796"><a href="/net/dnsclient_unix.go.html#1346774">ok</a></span>&nbsp;<span class="op" id="1346799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346803">return</span>&nbsp;<span class="ident" id="1346810"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1346816">.</span><span class="ident" id="1346817">New</span><span class="op" id="1346820">(</span><span class="string" id="1346821">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="1346849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346855">if</span>&nbsp;<span class="ident" id="1346858">_</span><span class="op" id="1346859">,</span>&nbsp;<span class="ident" id="1346861">err</span>&nbsp;<span class="op" id="1346865">:=</span>&nbsp;<span class="ident" id="1346868"><a href="/net/dnsclient_unix.go.html#1346723">c</a></span><span class="op" id="1346869">.</span><span class="ident" id="1346870">Write</span><span class="op" id="1346875">(</span><span class="ident" id="1346876"><a href="/net/dnsclient_unix.go.html#1346771">b</a></span><span class="op" id="1346877">)</span><span class="op" id="1346878">;</span>&nbsp;<span class="ident" id="1346880"><a href="/net/dnsclient_unix.go.html#1346861">err</a></span>&nbsp;<span class="op" id="1346884">!=</span>&nbsp;<span class="ident" id="1346887">nil</span>&nbsp;<span class="op" id="1346891">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346895">return</span>&nbsp;<span class="ident" id="1346902"><a href="/net/dnsclient_unix.go.html#1346861">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346910">return</span>&nbsp;<span class="ident" id="1346917">nil</span><br>
<span class="lineno"></span><span class="op" id="1346921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="1346924">func</span>&nbsp;<span class="op" id="1346929">(</span><span class="ident" id="1346930">c</span>&nbsp;<span class="op" id="1346932">*</span><span class="ident" id="1346933"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1346940">)</span>&nbsp;<span class="ident" id="1346942">readDNSResponse</span><span class="op" id="1346957">(</span><span class="op" id="1346958">)</span>&nbsp;<span class="op" id="1346960">(</span><span class="op" id="1346961">*</span><span class="ident" id="1346962"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1346968">,</span>&nbsp;<span class="builtintype" id="1346970">error</span><span class="op" id="1346975">)</span>&nbsp;<span class="op" id="1346977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346980">b</span>&nbsp;<span class="op" id="1346982">:=</span>&nbsp;<span class="builtinfunc" id="1346985">make</span><span class="op" id="1346989">(</span><span class="op" id="1346990">[</span><span class="op" id="1346991">]</span><span class="builtintype" id="1346992">byte</span><span class="op" id="1346996">,</span>&nbsp;<span class="num" id="1346998">1280</span><span class="op" id="1347002">)</span>&nbsp;<span class="comment" id="1347004">//&nbsp;1280&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;initial&nbsp;size&nbsp;for&nbsp;IP&nbsp;over&nbsp;Ethernet,&nbsp;see&nbsp;RFC&nbsp;4035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347077">if</span>&nbsp;<span class="ident" id="1347080">_</span><span class="op" id="1347081">,</span>&nbsp;<span class="ident" id="1347083">err</span>&nbsp;<span class="op" id="1347087">:=</span>&nbsp;<span class="ident" id="1347090"><a href="/net/dnsclient_unix.go.html#1346028">io</a></span><span class="op" id="1347092">.</span><span class="ident" id="1347093">ReadFull</span><span class="op" id="1347101">(</span><span class="ident" id="1347102"><a href="/net/dnsclient_unix.go.html#1346930">c</a></span><span class="op" id="1347103">,</span>&nbsp;<span class="ident" id="1347105"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347106">[</span><span class="op" id="1347107">:</span><span class="num" id="1347108">2</span><span class="op" id="1347109">]</span><span class="op" id="1347110">)</span><span class="op" id="1347111">;</span>&nbsp;<span class="ident" id="1347113"><a href="/net/dnsclient_unix.go.html#1347083">err</a></span>&nbsp;<span class="op" id="1347117">!=</span>&nbsp;<span class="ident" id="1347120">nil</span>&nbsp;<span class="op" id="1347124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347128">return</span>&nbsp;<span class="ident" id="1347135">nil</span><span class="op" id="1347138">,</span>&nbsp;<span class="ident" id="1347140"><a href="/net/dnsclient_unix.go.html#1347083">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347145">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347148">l</span>&nbsp;<span class="op" id="1347150">:=</span>&nbsp;<span class="builtintype" id="1347153">int</span><span class="op" id="1347156">(</span><span class="ident" id="1347157"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347158">[</span><span class="num" id="1347159">0</span><span class="op" id="1347160">]</span><span class="op" id="1347161">)</span><span class="op" id="1347162">&lt;&lt;</span><span class="num" id="1347164">8</span>&nbsp;<span class="op" id="1347166">|</span>&nbsp;<span class="builtintype" id="1347168">int</span><span class="op" id="1347171">(</span><span class="ident" id="1347172"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347173">[</span><span class="num" id="1347174">1</span><span class="op" id="1347175">]</span><span class="op" id="1347176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347179">if</span>&nbsp;<span class="ident" id="1347182"><a href="/net/dnsclient_unix.go.html#1347148">l</a></span>&nbsp;<span class="op" id="1347184">&gt;</span>&nbsp;<span class="builtinfunc" id="1347186">len</span><span class="op" id="1347189">(</span><span class="ident" id="1347190"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347191">)</span>&nbsp;<span class="op" id="1347193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347197"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span>&nbsp;<span class="op" id="1347199">=</span>&nbsp;<span class="builtinfunc" id="1347201">make</span><span class="op" id="1347205">(</span><span class="op" id="1347206">[</span><span class="op" id="1347207">]</span><span class="builtintype" id="1347208">byte</span><span class="op" id="1347212">,</span>&nbsp;<span class="ident" id="1347214"><a href="/net/dnsclient_unix.go.html#1347148">l</a></span><span class="op" id="1347215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347221">n</span><span class="op" id="1347222">,</span>&nbsp;<span class="ident" id="1347224">err</span>&nbsp;<span class="op" id="1347228">:=</span>&nbsp;<span class="ident" id="1347231"><a href="/net/dnsclient_unix.go.html#1346028">io</a></span><span class="op" id="1347233">.</span><span class="ident" id="1347234">ReadFull</span><span class="op" id="1347242">(</span><span class="ident" id="1347243"><a href="/net/dnsclient_unix.go.html#1346930">c</a></span><span class="op" id="1347244">,</span>&nbsp;<span class="ident" id="1347246"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347247">[</span><span class="op" id="1347248">:</span><span class="ident" id="1347249"><a href="/net/dnsclient_unix.go.html#1347148">l</a></span><span class="op" id="1347250">]</span><span class="op" id="1347251">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347254">if</span>&nbsp;<span class="ident" id="1347257"><a href="/net/dnsclient_unix.go.html#1347224">err</a></span>&nbsp;<span class="op" id="1347261">!=</span>&nbsp;<span class="ident" id="1347264">nil</span>&nbsp;<span class="op" id="1347268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347272">return</span>&nbsp;<span class="ident" id="1347279">nil</span><span class="op" id="1347282">,</span>&nbsp;<span class="ident" id="1347284"><a href="/net/dnsclient_unix.go.html#1347224">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347292">msg</span>&nbsp;<span class="op" id="1347296">:=</span>&nbsp;<span class="op" id="1347299">&amp;</span><span class="ident" id="1347300"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1347306">{</span><span class="op" id="1347307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347310">if</span>&nbsp;<span class="op" id="1347313">!</span><span class="ident" id="1347314"><a href="/net/dnsclient_unix.go.html#1347292">msg</a></span><span class="op" id="1347317">.</span><span class="ident" id="1347318">Unpack</span><span class="op" id="1347324">(</span><span class="ident" id="1347325"><a href="/net/dnsclient_unix.go.html#1346980">b</a></span><span class="op" id="1347326">[</span><span class="op" id="1347327">:</span><span class="ident" id="1347328"><a href="/net/dnsclient_unix.go.html#1347221">n</a></span><span class="op" id="1347329">]</span><span class="op" id="1347330">)</span>&nbsp;<span class="op" id="1347332">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347336">return</span>&nbsp;<span class="ident" id="1347343">nil</span><span class="op" id="1347346">,</span>&nbsp;<span class="ident" id="1347348"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1347354">.</span><span class="ident" id="1347355">New</span><span class="op" id="1347358">(</span><span class="string" id="1347359">&#34;cannot&nbsp;unmarshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="1347389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347395">return</span>&nbsp;<span class="ident" id="1347402"><a href="/net/dnsclient_unix.go.html#1347292">msg</a></span><span class="op" id="1347405">,</span>&nbsp;<span class="ident" id="1347407">nil</span><br>
<span class="lineno"></span><span class="op" id="1347411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="1347414">func</span>&nbsp;<span class="op" id="1347419">(</span><span class="ident" id="1347420">c</span>&nbsp;<span class="op" id="1347422">*</span><span class="ident" id="1347423"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1347430">)</span>&nbsp;<span class="ident" id="1347432">writeDNSQuery</span><span class="op" id="1347445">(</span><span class="ident" id="1347446">msg</span>&nbsp;<span class="op" id="1347450">*</span><span class="ident" id="1347451"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1347457">)</span>&nbsp;<span class="builtintype" id="1347459">error</span>&nbsp;<span class="op" id="1347465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347468">b</span><span class="op" id="1347469">,</span>&nbsp;<span class="ident" id="1347471">ok</span>&nbsp;<span class="op" id="1347474">:=</span>&nbsp;<span class="ident" id="1347477"><a href="/net/dnsclient_unix.go.html#1347446">msg</a></span><span class="op" id="1347480">.</span><span class="ident" id="1347481">Pack</span><span class="op" id="1347485">(</span><span class="op" id="1347486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347489">if</span>&nbsp;<span class="op" id="1347492">!</span><span class="ident" id="1347493"><a href="/net/dnsclient_unix.go.html#1347471">ok</a></span>&nbsp;<span class="op" id="1347496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347500">return</span>&nbsp;<span class="ident" id="1347507"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1347513">.</span><span class="ident" id="1347514">New</span><span class="op" id="1347517">(</span><span class="string" id="1347518">&#34;cannot&nbsp;marshal&nbsp;DNS&nbsp;message&#34;</span><span class="op" id="1347546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347549">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347552">l</span>&nbsp;<span class="op" id="1347554">:=</span>&nbsp;<span class="builtintype" id="1347557">uint16</span><span class="op" id="1347563">(</span><span class="builtinfunc" id="1347564">len</span><span class="op" id="1347567">(</span><span class="ident" id="1347568"><a href="/net/dnsclient_unix.go.html#1347468">b</a></span><span class="op" id="1347569">)</span><span class="op" id="1347570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347573"><a href="/net/dnsclient_unix.go.html#1347468">b</a></span>&nbsp;<span class="op" id="1347575">=</span>&nbsp;<span class="builtinfunc" id="1347577">append</span><span class="op" id="1347583">(</span><span class="op" id="1347584">[</span><span class="op" id="1347585">]</span><span class="builtintype" id="1347586">byte</span><span class="op" id="1347590">{</span><span class="builtintype" id="1347591">byte</span><span class="op" id="1347595">(</span><span class="ident" id="1347596"><a href="/net/dnsclient_unix.go.html#1347552">l</a></span>&nbsp;<span class="op" id="1347598">&gt;&gt;</span>&nbsp;<span class="num" id="1347601">8</span><span class="op" id="1347602">)</span><span class="op" id="1347603">,</span>&nbsp;<span class="builtintype" id="1347605">byte</span><span class="op" id="1347609">(</span><span class="ident" id="1347610"><a href="/net/dnsclient_unix.go.html#1347552">l</a></span><span class="op" id="1347611">)</span><span class="op" id="1347612">}</span><span class="op" id="1347613">,</span>&nbsp;<span class="ident" id="1347615"><a href="/net/dnsclient_unix.go.html#1347468">b</a></span><span class="op" id="1347616">...</span><span class="op" id="1347619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347622">if</span>&nbsp;<span class="ident" id="1347625">_</span><span class="op" id="1347626">,</span>&nbsp;<span class="ident" id="1347628">err</span>&nbsp;<span class="op" id="1347632">:=</span>&nbsp;<span class="ident" id="1347635"><a href="/net/dnsclient_unix.go.html#1347420">c</a></span><span class="op" id="1347636">.</span><span class="ident" id="1347637">Write</span><span class="op" id="1347642">(</span><span class="ident" id="1347643"><a href="/net/dnsclient_unix.go.html#1347468">b</a></span><span class="op" id="1347644">)</span><span class="op" id="1347645">;</span>&nbsp;<span class="ident" id="1347647"><a href="/net/dnsclient_unix.go.html#1347628">err</a></span>&nbsp;<span class="op" id="1347651">!=</span>&nbsp;<span class="ident" id="1347654">nil</span>&nbsp;<span class="op" id="1347658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347662">return</span>&nbsp;<span class="ident" id="1347669"><a href="/net/dnsclient_unix.go.html#1347628">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347674">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347677">return</span>&nbsp;<span class="ident" id="1347684">nil</span><br>
<span class="lineno"></span><span class="op" id="1347688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1347691">func</span>&nbsp;<span class="op" id="1347696">(</span><span class="ident" id="1347697">d</span>&nbsp;<span class="op" id="1347699">*</span><span class="ident" id="1347700"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="1347706">)</span>&nbsp;<span class="ident" id="1347708">dialDNS</span><span class="op" id="1347715">(</span><span class="ident" id="1347716">network</span><span class="op" id="1347723">,</span>&nbsp;<span class="ident" id="1347725">server</span>&nbsp;<span class="builtintype" id="1347732">string</span><span class="op" id="1347738">)</span>&nbsp;<span class="op" id="1347740">(</span><span class="ident" id="1347741"><a href="/net/dnsclient_unix.go.html#1346126">dnsConn</a></span><span class="op" id="1347748">,</span>&nbsp;<span class="builtintype" id="1347750">error</span><span class="op" id="1347755">)</span>&nbsp;<span class="op" id="1347757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347760">switch</span>&nbsp;<span class="ident" id="1347767"><a href="/net/dnsclient_unix.go.html#1347716">network</a></span>&nbsp;<span class="op" id="1347775">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347778">case</span>&nbsp;<span class="string" id="1347783">&#34;tcp&#34;</span><span class="op" id="1347788">,</span>&nbsp;<span class="string" id="1347790">&#34;tcp4&#34;</span><span class="op" id="1347796">,</span>&nbsp;<span class="string" id="1347798">&#34;tcp6&#34;</span><span class="op" id="1347804">,</span>&nbsp;<span class="string" id="1347806">&#34;udp&#34;</span><span class="op" id="1347811">,</span>&nbsp;<span class="string" id="1347813">&#34;udp4&#34;</span><span class="op" id="1347819">,</span>&nbsp;<span class="string" id="1347821">&#34;udp6&#34;</span><span class="op" id="1347827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347830">default</span><span class="op" id="1347837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347841">return</span>&nbsp;<span class="ident" id="1347848">nil</span><span class="op" id="1347851">,</span>&nbsp;<span class="ident" id="1347853"><a href="/net/net.go.html#1473867">UnknownNetworkError</a></span><span class="op" id="1347872">(</span><span class="ident" id="1347873"><a href="/net/dnsclient_unix.go.html#1347716">network</a></span><span class="op" id="1347880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347886">//&nbsp;Calling&nbsp;Dial&nbsp;here&nbsp;is&nbsp;scary&nbsp;--&nbsp;we&nbsp;have&nbsp;to&nbsp;be&nbsp;sure&nbsp;not&nbsp;to</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347946">//&nbsp;dial&nbsp;a&nbsp;name&nbsp;that&nbsp;will&nbsp;require&nbsp;a&nbsp;DNS&nbsp;lookup,&nbsp;or&nbsp;Dial&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348007">//&nbsp;call&nbsp;back&nbsp;here&nbsp;to&nbsp;translate&nbsp;it.&nbsp;The&nbsp;DNS&nbsp;config&nbsp;parser&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348069">//&nbsp;already&nbsp;checked&nbsp;that&nbsp;all&nbsp;the&nbsp;cfg.servers[i]&nbsp;are&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348124">//&nbsp;addresses,&nbsp;which&nbsp;Dial&nbsp;will&nbsp;use&nbsp;without&nbsp;a&nbsp;DNS&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348181">c</span><span class="op" id="1348182">,</span>&nbsp;<span class="ident" id="1348184">err</span>&nbsp;<span class="op" id="1348188">:=</span>&nbsp;<span class="ident" id="1348191"><a href="/net/dnsclient_unix.go.html#1347697">d</a></span><span class="op" id="1348192">.</span><span class="ident" id="1348193">Dial</span><span class="op" id="1348197">(</span><span class="ident" id="1348198"><a href="/net/dnsclient_unix.go.html#1347716">network</a></span><span class="op" id="1348205">,</span>&nbsp;<span class="ident" id="1348207"><a href="/net/dnsclient_unix.go.html#1347725">server</a></span><span class="op" id="1348213">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348216">if</span>&nbsp;<span class="ident" id="1348219"><a href="/net/dnsclient_unix.go.html#1348184">err</a></span>&nbsp;<span class="op" id="1348223">!=</span>&nbsp;<span class="ident" id="1348226">nil</span>&nbsp;<span class="op" id="1348230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348234">return</span>&nbsp;<span class="ident" id="1348241">nil</span><span class="op" id="1348244">,</span>&nbsp;<span class="ident" id="1348246"><a href="/net/dnsclient_unix.go.html#1348184">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348254">switch</span>&nbsp;<span class="ident" id="1348261"><a href="/net/dnsclient_unix.go.html#1347716">network</a></span>&nbsp;<span class="op" id="1348269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348272">case</span>&nbsp;<span class="string" id="1348277">&#34;tcp&#34;</span><span class="op" id="1348282">,</span>&nbsp;<span class="string" id="1348284">&#34;tcp4&#34;</span><span class="op" id="1348290">,</span>&nbsp;<span class="string" id="1348292">&#34;tcp6&#34;</span><span class="op" id="1348298">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348302">return</span>&nbsp;<span class="ident" id="1348309"><a href="/net/dnsclient_unix.go.html#1348181">c</a></span><span class="op" id="1348310">.</span><span class="op" id="1348311">(</span><span class="op" id="1348312">*</span><span class="ident" id="1348313"><a href="/net/tcpsock_posix.go.html#1507019">TCPConn</a></span><span class="op" id="1348320">)</span><span class="op" id="1348321">,</span>&nbsp;<span class="ident" id="1348323">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348328">case</span>&nbsp;<span class="string" id="1348333">&#34;udp&#34;</span><span class="op" id="1348338">,</span>&nbsp;<span class="string" id="1348340">&#34;udp4&#34;</span><span class="op" id="1348346">,</span>&nbsp;<span class="string" id="1348348">&#34;udp6&#34;</span><span class="op" id="1348354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348358">return</span>&nbsp;<span class="ident" id="1348365"><a href="/net/dnsclient_unix.go.html#1348181">c</a></span><span class="op" id="1348366">.</span><span class="op" id="1348367">(</span><span class="op" id="1348368">*</span><span class="ident" id="1348369"><a href="/net/udpsock_posix.go.html#1519094">UDPConn</a></span><span class="op" id="1348376">)</span><span class="op" id="1348377">,</span>&nbsp;<span class="ident" id="1348379">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1348387">panic</span><span class="op" id="1348392">(</span><span class="string" id="1348393">&#34;unreachable&#34;</span><span class="op" id="1348406">)</span><br>
<span class="lineno">120</span><span class="op" id="1348408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348411">//&nbsp;exchange&nbsp;sends&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;connection&nbsp;and&nbsp;hopes&nbsp;for&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="1348481">func</span>&nbsp;<span class="ident" id="1348486">exchange</span><span class="op" id="1348494">(</span><span class="ident" id="1348495">server</span><span class="op" id="1348501">,</span>&nbsp;<span class="ident" id="1348503">name</span>&nbsp;<span class="builtintype" id="1348508">string</span><span class="op" id="1348514">,</span>&nbsp;<span class="ident" id="1348516">qtype</span>&nbsp;<span class="builtintype" id="1348522">uint16</span><span class="op" id="1348528">,</span>&nbsp;<span class="ident" id="1348530">timeout</span>&nbsp;<span class="ident" id="1348538"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1348542">.</span><span class="ident" id="1348543">Duration</span><span class="op" id="1348551">)</span>&nbsp;<span class="op" id="1348553">(</span><span class="op" id="1348554">*</span><span class="ident" id="1348555"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1348561">,</span>&nbsp;<span class="builtintype" id="1348563">error</span><span class="op" id="1348568">)</span>&nbsp;<span class="op" id="1348570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348573">d</span>&nbsp;<span class="op" id="1348575">:=</span>&nbsp;<span class="ident" id="1348578"><a href="/net/dial.go.html#1330674">Dialer</a></span><span class="op" id="1348584">{</span><span class="ident" id="1348585">Timeout</span><span class="op" id="1348592">:</span>&nbsp;<span class="ident" id="1348594"><a href="/net/dnsclient_unix.go.html#1348530">timeout</a></span><span class="op" id="1348601">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348604">out</span>&nbsp;<span class="op" id="1348608">:=</span>&nbsp;<span class="ident" id="1348611"><a href="/net/dnsmsg.go.html#1376790">dnsMsg</a></span><span class="op" id="1348617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348621">dnsMsgHdr</span><span class="op" id="1348630">:</span>&nbsp;<span class="ident" id="1348632"><a href="/net/dnsmsg.go.html#1376153">dnsMsgHdr</a></span><span class="op" id="1348641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348646">recursion_desired</span><span class="op" id="1348663">:</span>&nbsp;<span class="builtintype" id="1348665">true</span><span class="op" id="1348669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348673">}</span><span class="op" id="1348674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348678">question</span><span class="op" id="1348686">:</span>&nbsp;<span class="op" id="1348688">[</span><span class="op" id="1348689">]</span><span class="ident" id="1348690"><a href="/net/dnsmsg.go.html#1361780">dnsQuestion</a></span><span class="op" id="1348701">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348706">{</span><span class="ident" id="1348707"><a href="/net/dnsclient_unix.go.html#1348503">name</a></span><span class="op" id="1348711">,</span>&nbsp;<span class="ident" id="1348713"><a href="/net/dnsclient_unix.go.html#1348516">qtype</a></span><span class="op" id="1348718">,</span>&nbsp;<span class="ident" id="1348720"><a href="/net/dnsmsg.go.html#1360181">dnsClassINET</a></span><span class="op" id="1348732">}</span><span class="op" id="1348733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348737">}</span><span class="op" id="1348738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348744">for</span>&nbsp;<span class="ident" id="1348748">_</span><span class="op" id="1348749">,</span>&nbsp;<span class="ident" id="1348751">network</span>&nbsp;<span class="op" id="1348759">:=</span>&nbsp;<span class="keyword" id="1348762">range</span>&nbsp;<span class="op" id="1348768">[</span><span class="op" id="1348769">]</span><span class="builtintype" id="1348770">string</span><span class="op" id="1348776">{</span><span class="string" id="1348777">&#34;udp&#34;</span><span class="op" id="1348782">,</span>&nbsp;<span class="string" id="1348784">&#34;tcp&#34;</span><span class="op" id="1348789">}</span>&nbsp;<span class="op" id="1348791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348795">c</span><span class="op" id="1348796">,</span>&nbsp;<span class="ident" id="1348798">err</span>&nbsp;<span class="op" id="1348802">:=</span>&nbsp;<span class="ident" id="1348805"><a href="/net/dnsclient_unix.go.html#1348573">d</a></span><span class="op" id="1348806">.</span><span class="ident" id="1348807">dialDNS</span><span class="op" id="1348814">(</span><span class="ident" id="1348815"><a href="/net/dnsclient_unix.go.html#1348751">network</a></span><span class="op" id="1348822">,</span>&nbsp;<span class="ident" id="1348824"><a href="/net/dnsclient_unix.go.html#1348495">server</a></span><span class="op" id="1348830">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348834">if</span>&nbsp;<span class="ident" id="1348837"><a href="/net/dnsclient_unix.go.html#1348798">err</a></span>&nbsp;<span class="op" id="1348841">!=</span>&nbsp;<span class="ident" id="1348844">nil</span>&nbsp;<span class="op" id="1348848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348853">return</span>&nbsp;<span class="ident" id="1348860">nil</span><span class="op" id="1348863">,</span>&nbsp;<span class="ident" id="1348865"><a href="/net/dnsclient_unix.go.html#1348798">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348875">defer</span>&nbsp;<span class="ident" id="1348881"><a href="/net/dnsclient_unix.go.html#1348795">c</a></span><span class="op" id="1348882">.</span><span class="ident" id="1348883">Close</span><span class="op" id="1348888">(</span><span class="op" id="1348889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348893">if</span>&nbsp;<span class="ident" id="1348896"><a href="/net/dnsclient_unix.go.html#1348530">timeout</a></span>&nbsp;<span class="op" id="1348904">&gt;</span>&nbsp;<span class="num" id="1348906">0</span>&nbsp;<span class="op" id="1348908">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348913"><a href="/net/dnsclient_unix.go.html#1348795">c</a></span><span class="op" id="1348914">.</span><span class="ident" id="1348915">SetDeadline</span><span class="op" id="1348926">(</span><span class="ident" id="1348927"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1348931">.</span><span class="ident" id="1348932">Now</span><span class="op" id="1348935">(</span><span class="op" id="1348936">)</span><span class="op" id="1348937">.</span><span class="ident" id="1348938">Add</span><span class="op" id="1348941">(</span><span class="ident" id="1348942"><a href="/net/dnsclient_unix.go.html#1348530">timeout</a></span><span class="op" id="1348949">)</span><span class="op" id="1348950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348958"><a href="/net/dnsclient_unix.go.html#1348604">out</a></span><span class="op" id="1348961">.</span><span class="ident" id="1348962">id</span>&nbsp;<span class="op" id="1348965">=</span>&nbsp;<span class="builtintype" id="1348967">uint16</span><span class="op" id="1348973">(</span><span class="ident" id="1348974"><a href="/net/dnsclient_unix.go.html#1346034">rand</a></span><span class="op" id="1348978">.</span><span class="ident" id="1348979">Int</span><span class="op" id="1348982">(</span><span class="op" id="1348983">)</span><span class="op" id="1348984">)</span>&nbsp;<span class="op" id="1348986">^</span>&nbsp;<span class="builtintype" id="1348988">uint16</span><span class="op" id="1348994">(</span><span class="ident" id="1348995"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1348999">.</span><span class="ident" id="1349000">Now</span><span class="op" id="1349003">(</span><span class="op" id="1349004">)</span><span class="op" id="1349005">.</span><span class="ident" id="1349006">UnixNano</span><span class="op" id="1349014">(</span><span class="op" id="1349015">)</span><span class="op" id="1349016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349020">if</span>&nbsp;<span class="ident" id="1349023">err</span>&nbsp;<span class="op" id="1349027">:=</span>&nbsp;<span class="ident" id="1349030"><a href="/net/dnsclient_unix.go.html#1348795">c</a></span><span class="op" id="1349031">.</span><span class="ident" id="1349032">writeDNSQuery</span><span class="op" id="1349045">(</span><span class="op" id="1349046">&amp;</span><span class="ident" id="1349047"><a href="/net/dnsclient_unix.go.html#1348604">out</a></span><span class="op" id="1349050">)</span><span class="op" id="1349051">;</span>&nbsp;<span class="ident" id="1349053"><a href="/net/dnsclient_unix.go.html#1349023">err</a></span>&nbsp;<span class="op" id="1349057">!=</span>&nbsp;<span class="ident" id="1349060">nil</span>&nbsp;<span class="op" id="1349064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349069">return</span>&nbsp;<span class="ident" id="1349076">nil</span><span class="op" id="1349079">,</span>&nbsp;<span class="ident" id="1349081"><a href="/net/dnsclient_unix.go.html#1349023">err</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349091">in</span><span class="op" id="1349093">,</span>&nbsp;<span class="ident" id="1349095"><a href="/net/dnsclient_unix.go.html#1348798">err</a></span>&nbsp;<span class="op" id="1349099">:=</span>&nbsp;<span class="ident" id="1349102"><a href="/net/dnsclient_unix.go.html#1348795">c</a></span><span class="op" id="1349103">.</span><span class="ident" id="1349104">readDNSResponse</span><span class="op" id="1349119">(</span><span class="op" id="1349120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349124">if</span>&nbsp;<span class="ident" id="1349127"><a href="/net/dnsclient_unix.go.html#1348798">err</a></span>&nbsp;<span class="op" id="1349131">!=</span>&nbsp;<span class="ident" id="1349134">nil</span>&nbsp;<span class="op" id="1349138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349143">return</span>&nbsp;<span class="ident" id="1349150">nil</span><span class="op" id="1349153">,</span>&nbsp;<span class="ident" id="1349155"><a href="/net/dnsclient_unix.go.html#1348798">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349161">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349165">if</span>&nbsp;<span class="ident" id="1349168"><a href="/net/dnsclient_unix.go.html#1349091">in</a></span><span class="op" id="1349170">.</span><span class="ident" id="1349171">id</span>&nbsp;<span class="op" id="1349174">!=</span>&nbsp;<span class="ident" id="1349177"><a href="/net/dnsclient_unix.go.html#1348604">out</a></span><span class="op" id="1349180">.</span><span class="ident" id="1349181">id</span>&nbsp;<span class="op" id="1349184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349189">return</span>&nbsp;<span class="ident" id="1349196">nil</span><span class="op" id="1349199">,</span>&nbsp;<span class="ident" id="1349201"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1349207">.</span><span class="ident" id="1349208">New</span><span class="op" id="1349211">(</span><span class="string" id="1349212">&#34;DNS&nbsp;message&nbsp;ID&nbsp;mismatch&#34;</span><span class="op" id="1349237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349245">if</span>&nbsp;<span class="ident" id="1349248"><a href="/net/dnsclient_unix.go.html#1349091">in</a></span><span class="op" id="1349250">.</span><span class="ident" id="1349251">truncated</span>&nbsp;<span class="op" id="1349261">{</span>&nbsp;<span class="comment" id="1349263">//&nbsp;see&nbsp;RFC&nbsp;5966</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349282">continue</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349297">return</span>&nbsp;<span class="ident" id="1349304"><a href="/net/dnsclient_unix.go.html#1349091">in</a></span><span class="op" id="1349306">,</span>&nbsp;<span class="ident" id="1349308">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349316">return</span>&nbsp;<span class="ident" id="1349323">nil</span><span class="op" id="1349326">,</span>&nbsp;<span class="ident" id="1349328"><a href="/net/dnsclient_unix.go.html#1346018">errors</a></span><span class="op" id="1349334">.</span><span class="ident" id="1349335">New</span><span class="op" id="1349338">(</span><span class="string" id="1349339">&#34;no&nbsp;answer&nbsp;from&nbsp;DNS&nbsp;server&#34;</span><span class="op" id="1349366">)</span><br>
<span class="lineno"></span><span class="op" id="1349368">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="1349371">//&nbsp;Do&nbsp;a&nbsp;lookup&nbsp;for&nbsp;a&nbsp;single&nbsp;name,&nbsp;which&nbsp;must&nbsp;be&nbsp;rooted</span><br>
<span class="lineno"></span><span class="comment" id="1349426">//&nbsp;(otherwise&nbsp;answer&nbsp;will&nbsp;not&nbsp;find&nbsp;the&nbsp;answers).</span><br>
<span class="lineno"></span><span class="keyword" id="1349475">func</span>&nbsp;<span class="ident" id="1349480">tryOneName</span><span class="op" id="1349490">(</span><span class="ident" id="1349491">cfg</span>&nbsp;<span class="op" id="1349495">*</span><span class="ident" id="1349496"><a href="/net/dnsconfig_unix.go.html#1356449">dnsConfig</a></span><span class="op" id="1349505">,</span>&nbsp;<span class="ident" id="1349507">name</span>&nbsp;<span class="builtintype" id="1349512">string</span><span class="op" id="1349518">,</span>&nbsp;<span class="ident" id="1349520">qtype</span>&nbsp;<span class="builtintype" id="1349526">uint16</span><span class="op" id="1349532">)</span>&nbsp;<span class="op" id="1349534">(</span><span class="builtintype" id="1349535">string</span><span class="op" id="1349541">,</span>&nbsp;<span class="op" id="1349543">[</span><span class="op" id="1349544">]</span><span class="ident" id="1349545"><a href="/net/dnsmsg.go.html#1362702">dnsRR</a></span><span class="op" id="1349550">,</span>&nbsp;<span class="builtintype" id="1349552">error</span><span class="op" id="1349557">)</span>&nbsp;<span class="op" id="1349559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349562">if</span>&nbsp;<span class="builtinfunc" id="1349565">len</span><span class="op" id="1349568">(</span><span class="ident" id="1349569"><a href="/net/dnsclient_unix.go.html#1349491">cfg</a></span><span class="op" id="1349572">.</span><span class="ident" id="1349573">servers</span><span class="op" id="1349580">)</span>&nbsp;<span class="op" id="1349582">==</span>&nbsp;<span class="num" id="1349585">0</span>&nbsp;<span class="op" id="1349587">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349591">return</span>&nbsp;<span class="string" id="1349598">&#34;&#34;</span><span class="op" id="1349600">,</span>&nbsp;<span class="ident" id="1349602">nil</span><span class="op" id="1349605">,</span>&nbsp;<span class="op" id="1349607">&amp;</span><span class="ident" id="1349608"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1349616">{</span><span class="ident" id="1349617">Err</span><span class="op" id="1349620">:</span>&nbsp;<span class="string" id="1349622">&#34;no&nbsp;DNS&nbsp;servers&#34;</span><span class="op" id="1349638">,</span>&nbsp;<span class="ident" id="1349640">Name</span><span class="op" id="1349644">:</span>&nbsp;<span class="ident" id="1349646"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1349650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349656">if</span>&nbsp;<span class="builtinfunc" id="1349659">len</span><span class="op" id="1349662">(</span><span class="ident" id="1349663"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1349667">)</span>&nbsp;<span class="op" id="1349669">&gt;=</span>&nbsp;<span class="num" id="1349672">256</span>&nbsp;<span class="op" id="1349676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349680">return</span>&nbsp;<span class="string" id="1349687">&#34;&#34;</span><span class="op" id="1349689">,</span>&nbsp;<span class="ident" id="1349691">nil</span><span class="op" id="1349694">,</span>&nbsp;<span class="op" id="1349696">&amp;</span><span class="ident" id="1349697"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1349705">{</span><span class="ident" id="1349706">Err</span><span class="op" id="1349709">:</span>&nbsp;<span class="string" id="1349711">&#34;DNS&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="1349730">,</span>&nbsp;<span class="ident" id="1349732">Name</span><span class="op" id="1349736">:</span>&nbsp;<span class="ident" id="1349738"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1349742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349745">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349748">timeout</span>&nbsp;<span class="op" id="1349756">:=</span>&nbsp;<span class="ident" id="1349759"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1349763">.</span><span class="ident" id="1349764">Duration</span><span class="op" id="1349772">(</span><span class="ident" id="1349773"><a href="/net/dnsclient_unix.go.html#1349491">cfg</a></span><span class="op" id="1349776">.</span><span class="ident" id="1349777">timeout</span><span class="op" id="1349784">)</span>&nbsp;<span class="op" id="1349786">*</span>&nbsp;<span class="ident" id="1349788"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1349792">.</span><span class="ident" id="1349793">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349801">var</span>&nbsp;<span class="ident" id="1349805">lastErr</span>&nbsp;<span class="builtintype" id="1349813">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349820">for</span>&nbsp;<span class="ident" id="1349824">i</span>&nbsp;<span class="op" id="1349826">:=</span>&nbsp;<span class="num" id="1349829">0</span><span class="op" id="1349830">;</span>&nbsp;<span class="ident" id="1349832"><a href="/net/dnsclient_unix.go.html#1349824">i</a></span>&nbsp;<span class="op" id="1349834">&lt;</span>&nbsp;<span class="ident" id="1349836"><a href="/net/dnsclient_unix.go.html#1349491">cfg</a></span><span class="op" id="1349839">.</span><span class="ident" id="1349840">attempts</span><span class="op" id="1349848">;</span>&nbsp;<span class="ident" id="1349850"><a href="/net/dnsclient_unix.go.html#1349824">i</a></span><span class="op" id="1349851">++</span>&nbsp;<span class="op" id="1349854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349858">for</span>&nbsp;<span class="ident" id="1349862">_</span><span class="op" id="1349863">,</span>&nbsp;<span class="ident" id="1349865">server</span>&nbsp;<span class="op" id="1349872">:=</span>&nbsp;<span class="keyword" id="1349875">range</span>&nbsp;<span class="ident" id="1349881"><a href="/net/dnsclient_unix.go.html#1349491">cfg</a></span><span class="op" id="1349884">.</span><span class="ident" id="1349885">servers</span>&nbsp;<span class="op" id="1349893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349898"><a href="/net/dnsclient_unix.go.html#1349865">server</a></span>&nbsp;<span class="op" id="1349905">=</span>&nbsp;<span class="ident" id="1349907"><a href="/net/ipsock.go.html#1445996">JoinHostPort</a></span><span class="op" id="1349919">(</span><span class="ident" id="1349920"><a href="/net/dnsclient_unix.go.html#1349865">server</a></span><span class="op" id="1349926">,</span>&nbsp;<span class="string" id="1349928">&#34;53&#34;</span><span class="op" id="1349932">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349937">msg</span><span class="op" id="1349940">,</span>&nbsp;<span class="ident" id="1349942">err</span>&nbsp;<span class="op" id="1349946">:=</span>&nbsp;<span class="ident" id="1349949"><a href="/net/dnsclient_unix.go.html#1348486">exchange</a></span><span class="op" id="1349957">(</span><span class="ident" id="1349958"><a href="/net/dnsclient_unix.go.html#1349865">server</a></span><span class="op" id="1349964">,</span>&nbsp;<span class="ident" id="1349966"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1349970">,</span>&nbsp;<span class="ident" id="1349972"><a href="/net/dnsclient_unix.go.html#1349520">qtype</a></span><span class="op" id="1349977">,</span>&nbsp;<span class="ident" id="1349979"><a href="/net/dnsclient_unix.go.html#1349748">timeout</a></span><span class="op" id="1349986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349991">if</span>&nbsp;<span class="ident" id="1349994"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span>&nbsp;<span class="op" id="1349998">!=</span>&nbsp;<span class="ident" id="1350001">nil</span>&nbsp;<span class="op" id="1350005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350011"><a href="/net/dnsclient_unix.go.html#1349805">lastErr</a></span>&nbsp;<span class="op" id="1350019">=</span>&nbsp;<span class="op" id="1350021">&amp;</span><span class="ident" id="1350022"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1350030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350037">Err</span><span class="op" id="1350040">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350045"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span><span class="op" id="1350048">.</span><span class="ident" id="1350049">Error</span><span class="op" id="1350054">(</span><span class="op" id="1350055">)</span><span class="op" id="1350056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350063">Name</span><span class="op" id="1350067">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1350071"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1350075">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350082">Server</span><span class="op" id="1350088">:</span>&nbsp;<span class="ident" id="1350090"><a href="/net/dnsclient_unix.go.html#1349865">server</a></span><span class="op" id="1350096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350108">if</span>&nbsp;<span class="ident" id="1350111">nerr</span><span class="op" id="1350115">,</span>&nbsp;<span class="ident" id="1350117">ok</span>&nbsp;<span class="op" id="1350120">:=</span>&nbsp;<span class="ident" id="1350123"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span><span class="op" id="1350126">.</span><span class="op" id="1350127">(</span><span class="ident" id="1350128"><a href="/net/net.go.html#1469488">Error</a></span><span class="op" id="1350133">)</span><span class="op" id="1350134">;</span>&nbsp;<span class="ident" id="1350136"><a href="/net/dnsclient_unix.go.html#1350117">ok</a></span>&nbsp;<span class="op" id="1350139">&amp;&amp;</span>&nbsp;<span class="ident" id="1350142"><a href="/net/dnsclient_unix.go.html#1350111">nerr</a></span><span class="op" id="1350146">.</span><span class="ident" id="1350147">Timeout</span><span class="op" id="1350154">(</span><span class="op" id="1350155">)</span>&nbsp;<span class="op" id="1350157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350164"><a href="/net/dnsclient_unix.go.html#1349805">lastErr</a></span><span class="op" id="1350171">.</span><span class="op" id="1350172">(</span><span class="op" id="1350173">*</span><span class="ident" id="1350174"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1350182">)</span><span class="op" id="1350183">.</span><span class="ident" id="1350184">IsTimeout</span>&nbsp;<span class="op" id="1350194">=</span>&nbsp;<span class="builtintype" id="1350196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350205">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350211">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350228">cname</span><span class="op" id="1350233">,</span>&nbsp;<span class="ident" id="1350235">addrs</span><span class="op" id="1350240">,</span>&nbsp;<span class="ident" id="1350242"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span>&nbsp;<span class="op" id="1350246">:=</span>&nbsp;<span class="ident" id="1350249"><a href="/net/dnsclient.go.html#1341192">answer</a></span><span class="op" id="1350255">(</span><span class="ident" id="1350256"><a href="/net/dnsclient_unix.go.html#1349507">name</a></span><span class="op" id="1350260">,</span>&nbsp;<span class="ident" id="1350262"><a href="/net/dnsclient_unix.go.html#1349865">server</a></span><span class="op" id="1350268">,</span>&nbsp;<span class="ident" id="1350270"><a href="/net/dnsclient_unix.go.html#1349937">msg</a></span><span class="op" id="1350273">,</span>&nbsp;<span class="ident" id="1350275"><a href="/net/dnsclient_unix.go.html#1349520">qtype</a></span><span class="op" id="1350280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350285">if</span>&nbsp;<span class="ident" id="1350288"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span>&nbsp;<span class="op" id="1350292">==</span>&nbsp;<span class="ident" id="1350295">nil</span>&nbsp;<span class="op" id="1350299">||</span>&nbsp;<span class="ident" id="1350302"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span><span class="op" id="1350305">.</span><span class="op" id="1350306">(</span><span class="op" id="1350307">*</span><span class="ident" id="1350308"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1350316">)</span><span class="op" id="1350317">.</span><span class="ident" id="1350318">Err</span>&nbsp;<span class="op" id="1350322">==</span>&nbsp;<span class="ident" id="1350325"><a href="/net/dnsclient.go.html#1340168">noSuchHost</a></span>&nbsp;<span class="op" id="1350336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350342">return</span>&nbsp;<span class="ident" id="1350349"><a href="/net/dnsclient_unix.go.html#1350228">cname</a></span><span class="op" id="1350354">,</span>&nbsp;<span class="ident" id="1350356"><a href="/net/dnsclient_unix.go.html#1350235">addrs</a></span><span class="op" id="1350361">,</span>&nbsp;<span class="ident" id="1350363"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350375"><a href="/net/dnsclient_unix.go.html#1349805">lastErr</a></span>&nbsp;<span class="op" id="1350383">=</span>&nbsp;<span class="ident" id="1350385"><a href="/net/dnsclient_unix.go.html#1349942">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350397">return</span>&nbsp;<span class="string" id="1350404">&#34;&#34;</span><span class="op" id="1350406">,</span>&nbsp;<span class="ident" id="1350408">nil</span><span class="op" id="1350411">,</span>&nbsp;<span class="ident" id="1350413"><a href="/net/dnsclient_unix.go.html#1349805">lastErr</a></span><br>
<span class="lineno">195</span><span class="op" id="1350421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1350424">func</span>&nbsp;<span class="ident" id="1350429">convertRR_A</span><span class="op" id="1350440">(</span><span class="ident" id="1350441">records</span>&nbsp;<span class="op" id="1350449">[</span><span class="op" id="1350450">]</span><span class="ident" id="1350451"><a href="/net/dnsmsg.go.html#1362702">dnsRR</a></span><span class="op" id="1350456">)</span>&nbsp;<span class="op" id="1350458">[</span><span class="op" id="1350459">]</span><span class="ident" id="1350460"><a href="/net/ip.go.html#1417189">IP</a></span>&nbsp;<span class="op" id="1350463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350466">addrs</span>&nbsp;<span class="op" id="1350472">:=</span>&nbsp;<span class="builtinfunc" id="1350475">make</span><span class="op" id="1350479">(</span><span class="op" id="1350480">[</span><span class="op" id="1350481">]</span><span class="ident" id="1350482"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1350484">,</span>&nbsp;<span class="builtinfunc" id="1350486">len</span><span class="op" id="1350489">(</span><span class="ident" id="1350490"><a href="/net/dnsclient_unix.go.html#1350441">records</a></span><span class="op" id="1350497">)</span><span class="op" id="1350498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350501">for</span>&nbsp;<span class="ident" id="1350505">i</span><span class="op" id="1350506">,</span>&nbsp;<span class="ident" id="1350508">rr</span>&nbsp;<span class="op" id="1350511">:=</span>&nbsp;<span class="keyword" id="1350514">range</span>&nbsp;<span class="ident" id="1350520"><a href="/net/dnsclient_unix.go.html#1350441">records</a></span>&nbsp;<span class="op" id="1350528">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350532">a</span>&nbsp;<span class="op" id="1350534">:=</span>&nbsp;<span class="ident" id="1350537"><a href="/net/dnsclient_unix.go.html#1350508">rr</a></span><span class="op" id="1350539">.</span><span class="op" id="1350540">(</span><span class="op" id="1350541">*</span><span class="ident" id="1350542"><a href="/net/dnsmsg.go.html#1366762">dnsRR_A</a></span><span class="op" id="1350549">)</span><span class="op" id="1350550">.</span><span class="ident" id="1350551">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350555"><a href="/net/dnsclient_unix.go.html#1350466">addrs</a></span><span class="op" id="1350560">[</span><span class="ident" id="1350561"><a href="/net/dnsclient_unix.go.html#1350505">i</a></span><span class="op" id="1350562">]</span>&nbsp;<span class="op" id="1350564">=</span>&nbsp;<span class="ident" id="1350566"><a href="/net/ip.go.html#1417459">IPv4</a></span><span class="op" id="1350570">(</span><span class="builtintype" id="1350571">byte</span><span class="op" id="1350575">(</span><span class="ident" id="1350576"><a href="/net/dnsclient_unix.go.html#1350532">a</a></span><span class="op" id="1350577">&gt;&gt;</span><span class="num" id="1350579">24</span><span class="op" id="1350581">)</span><span class="op" id="1350582">,</span>&nbsp;<span class="builtintype" id="1350584">byte</span><span class="op" id="1350588">(</span><span class="ident" id="1350589"><a href="/net/dnsclient_unix.go.html#1350532">a</a></span><span class="op" id="1350590">&gt;&gt;</span><span class="num" id="1350592">16</span><span class="op" id="1350594">)</span><span class="op" id="1350595">,</span>&nbsp;<span class="builtintype" id="1350597">byte</span><span class="op" id="1350601">(</span><span class="ident" id="1350602"><a href="/net/dnsclient_unix.go.html#1350532">a</a></span><span class="op" id="1350603">&gt;&gt;</span><span class="num" id="1350605">8</span><span class="op" id="1350606">)</span><span class="op" id="1350607">,</span>&nbsp;<span class="builtintype" id="1350609">byte</span><span class="op" id="1350613">(</span><span class="ident" id="1350614"><a href="/net/dnsclient_unix.go.html#1350532">a</a></span><span class="op" id="1350615">)</span><span class="op" id="1350616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350622">return</span>&nbsp;<span class="ident" id="1350629"><a href="/net/dnsclient_unix.go.html#1350466">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="1350635">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="keyword" id="1350638">func</span>&nbsp;<span class="ident" id="1350643">convertRR_AAAA</span><span class="op" id="1350657">(</span><span class="ident" id="1350658">records</span>&nbsp;<span class="op" id="1350666">[</span><span class="op" id="1350667">]</span><span class="ident" id="1350668"><a href="/net/dnsmsg.go.html#1362702">dnsRR</a></span><span class="op" id="1350673">)</span>&nbsp;<span class="op" id="1350675">[</span><span class="op" id="1350676">]</span><span class="ident" id="1350677"><a href="/net/ip.go.html#1417189">IP</a></span>&nbsp;<span class="op" id="1350680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350683">addrs</span>&nbsp;<span class="op" id="1350689">:=</span>&nbsp;<span class="builtinfunc" id="1350692">make</span><span class="op" id="1350696">(</span><span class="op" id="1350697">[</span><span class="op" id="1350698">]</span><span class="ident" id="1350699"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1350701">,</span>&nbsp;<span class="builtinfunc" id="1350703">len</span><span class="op" id="1350706">(</span><span class="ident" id="1350707"><a href="/net/dnsclient_unix.go.html#1350658">records</a></span><span class="op" id="1350714">)</span><span class="op" id="1350715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350718">for</span>&nbsp;<span class="ident" id="1350722">i</span><span class="op" id="1350723">,</span>&nbsp;<span class="ident" id="1350725">rr</span>&nbsp;<span class="op" id="1350728">:=</span>&nbsp;<span class="keyword" id="1350731">range</span>&nbsp;<span class="ident" id="1350737"><a href="/net/dnsclient_unix.go.html#1350658">records</a></span>&nbsp;<span class="op" id="1350745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350749">a</span>&nbsp;<span class="op" id="1350751">:=</span>&nbsp;<span class="builtinfunc" id="1350754">make</span><span class="op" id="1350758">(</span><span class="ident" id="1350759"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1350761">,</span>&nbsp;<span class="ident" id="1350763"><a href="/net/ip.go.html#1416782">IPv6len</a></span><span class="op" id="1350770">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1350774">copy</span><span class="op" id="1350778">(</span><span class="ident" id="1350779"><a href="/net/dnsclient_unix.go.html#1350749">a</a></span><span class="op" id="1350780">,</span>&nbsp;<span class="ident" id="1350782"><a href="/net/dnsclient_unix.go.html#1350725">rr</a></span><span class="op" id="1350784">.</span><span class="op" id="1350785">(</span><span class="op" id="1350786">*</span><span class="ident" id="1350787"><a href="/net/dnsmsg.go.html#1367021">dnsRR_AAAA</a></span><span class="op" id="1350797">)</span><span class="op" id="1350798">.</span><span class="ident" id="1350799">AAAA</span><span class="op" id="1350803">[</span><span class="op" id="1350804">:</span><span class="op" id="1350805">]</span><span class="op" id="1350806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350810"><a href="/net/dnsclient_unix.go.html#1350683">addrs</a></span><span class="op" id="1350815">[</span><span class="ident" id="1350816"><a href="/net/dnsclient_unix.go.html#1350722">i</a></span><span class="op" id="1350817">]</span>&nbsp;<span class="op" id="1350819">=</span>&nbsp;<span class="ident" id="1350821"><a href="/net/dnsclient_unix.go.html#1350749">a</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350827">return</span>&nbsp;<span class="ident" id="1350834"><a href="/net/dnsclient_unix.go.html#1350683">addrs</a></span><br>
<span class="lineno"></span><span class="op" id="1350840">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="1350843">var</span>&nbsp;<span class="ident" id="1350847">cfg</span>&nbsp;<span class="keyword" id="1350851">struct</span>&nbsp;<span class="op" id="1350858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350861">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1350871">chan</span>&nbsp;<span class="keyword" id="1350876">struct</span><span class="op" id="1350882">{</span><span class="op" id="1350883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350886">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1350896"><a href="/net/dnsclient_unix.go.html#1346053">sync</a></span><span class="op" id="1350900">.</span><span class="ident" id="1350901">RWMutex</span>&nbsp;<span class="comment" id="1350909">//&nbsp;protects&nbsp;dnsConfig&nbsp;and&nbsp;dnserr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350943">dnsConfig</span>&nbsp;<span class="op" id="1350953">*</span><span class="ident" id="1350954"><a href="/net/dnsconfig_unix.go.html#1356449">dnsConfig</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350965">dnserr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1350975">error</span><br>
<span class="lineno"></span><span class="op" id="1350981">}</span><br>
<span class="lineno"></span><span class="keyword" id="1350983">var</span>&nbsp;<span class="ident" id="1350987">onceLoadConfig</span>&nbsp;<span class="ident" id="1351002"><a href="/net/dnsclient_unix.go.html#1346053">sync</a></span><span class="op" id="1351006">.</span><span class="ident" id="1351007">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1351013">//&nbsp;Assume&nbsp;dns&nbsp;config&nbsp;file&nbsp;is&nbsp;/etc/resolv.conf&nbsp;here</span><br>
<span class="lineno">225</span><span class="keyword" id="1351064">func</span>&nbsp;<span class="ident" id="1351069">loadDefaultConfig</span><span class="op" id="1351086">(</span><span class="op" id="1351087">)</span>&nbsp;<span class="op" id="1351089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351092"><a href="/net/dnsclient_unix.go.html#1351151">loadConfig</a></span><span class="op" id="1351102">(</span><span class="string" id="1351103">&#34;/etc/resolv.conf&#34;</span><span class="op" id="1351121">,</span>&nbsp;<span class="num" id="1351123">5</span><span class="op" id="1351124">*</span><span class="ident" id="1351125"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1351129">.</span><span class="ident" id="1351130">Second</span><span class="op" id="1351136">,</span>&nbsp;<span class="ident" id="1351138">nil</span><span class="op" id="1351141">)</span><br>
<span class="lineno"></span><span class="op" id="1351143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1351146">func</span>&nbsp;<span class="ident" id="1351151">loadConfig</span><span class="op" id="1351161">(</span><span class="ident" id="1351162">resolvConfPath</span>&nbsp;<span class="builtintype" id="1351177">string</span><span class="op" id="1351183">,</span>&nbsp;<span class="ident" id="1351185">reloadTime</span>&nbsp;<span class="ident" id="1351196"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1351200">.</span><span class="ident" id="1351201">Duration</span><span class="op" id="1351209">,</span>&nbsp;<span class="ident" id="1351211">quit</span>&nbsp;<span class="op" id="1351216">&lt;-</span><span class="keyword" id="1351218">chan</span>&nbsp;<span class="keyword" id="1351223">chan</span>&nbsp;<span class="keyword" id="1351228">struct</span><span class="op" id="1351234">{</span><span class="op" id="1351235">}</span><span class="op" id="1351236">)</span>&nbsp;<span class="op" id="1351238">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351241">var</span>&nbsp;<span class="ident" id="1351245">mtime</span>&nbsp;<span class="ident" id="1351251"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1351255">.</span><span class="ident" id="1351256">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351262"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1351265">.</span><span class="ident" id="1351266">ch</span>&nbsp;<span class="op" id="1351269">=</span>&nbsp;<span class="builtinfunc" id="1351271">make</span><span class="op" id="1351275">(</span><span class="keyword" id="1351276">chan</span>&nbsp;<span class="keyword" id="1351281">struct</span><span class="op" id="1351287">{</span><span class="op" id="1351288">}</span><span class="op" id="1351289">,</span>&nbsp;<span class="num" id="1351291">1</span><span class="op" id="1351292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351295">if</span>&nbsp;<span class="ident" id="1351298">fi</span><span class="op" id="1351300">,</span>&nbsp;<span class="ident" id="1351302">err</span>&nbsp;<span class="op" id="1351306">:=</span>&nbsp;<span class="ident" id="1351309"><a href="/net/dnsclient_unix.go.html#1346047">os</a></span><span class="op" id="1351311">.</span><span class="ident" id="1351312">Stat</span><span class="op" id="1351316">(</span><span class="ident" id="1351317"><a href="/net/dnsclient_unix.go.html#1351162">resolvConfPath</a></span><span class="op" id="1351331">)</span><span class="op" id="1351332">;</span>&nbsp;<span class="ident" id="1351334"><a href="/net/dnsclient_unix.go.html#1351302">err</a></span>&nbsp;<span class="op" id="1351338">!=</span>&nbsp;<span class="ident" id="1351341">nil</span>&nbsp;<span class="op" id="1351345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351349"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1351352">.</span><span class="ident" id="1351353">dnserr</span>&nbsp;<span class="op" id="1351360">=</span>&nbsp;<span class="ident" id="1351362"><a href="/net/dnsclient_unix.go.html#1351302">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351367">}</span>&nbsp;<span class="keyword" id="1351369">else</span>&nbsp;<span class="op" id="1351374">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351378"><a href="/net/dnsclient_unix.go.html#1351245">mtime</a></span>&nbsp;<span class="op" id="1351384">=</span>&nbsp;<span class="ident" id="1351386"><a href="/net/dnsclient_unix.go.html#1351298">fi</a></span><span class="op" id="1351388">.</span><span class="ident" id="1351389">ModTime</span><span class="op" id="1351396">(</span><span class="op" id="1351397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351401"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1351404">.</span><span class="ident" id="1351405">dnsConfig</span><span class="op" id="1351414">,</span>&nbsp;<span class="ident" id="1351416"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1351419">.</span><span class="ident" id="1351420">dnserr</span>&nbsp;<span class="op" id="1351427">=</span>&nbsp;<span class="ident" id="1351429"><a href="/net/dnsconfig_unix.go.html#1356965">dnsReadConfig</a></span><span class="op" id="1351442">(</span><span class="ident" id="1351443"><a href="/net/dnsclient_unix.go.html#1351162">resolvConfPath</a></span><span class="op" id="1351457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351463">go</span>&nbsp;<span class="keyword" id="1351466">func</span><span class="op" id="1351470">(</span><span class="op" id="1351471">)</span>&nbsp;<span class="op" id="1351473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351477">for</span>&nbsp;<span class="op" id="1351481">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351486"><a href="/net/dnsclient_unix.go.html#1346061">time</a></span><span class="op" id="1351490">.</span><span class="ident" id="1351491">Sleep</span><span class="op" id="1351496">(</span><span class="ident" id="1351497"><a href="/net/dnsclient_unix.go.html#1351185">reloadTime</a></span><span class="op" id="1351507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351512">select</span>&nbsp;<span class="op" id="1351519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351524">case</span>&nbsp;<span class="ident" id="1351529">qresp</span>&nbsp;<span class="op" id="1351535">:=</span>&nbsp;<span class="op" id="1351538">&lt;-</span><span class="ident" id="1351540"><a href="/net/dnsclient_unix.go.html#1351211">quit</a></span><span class="op" id="1351544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351550"><a href="/net/dnsclient_unix.go.html#1351529">qresp</a></span>&nbsp;<span class="op" id="1351556">&lt;-</span>&nbsp;<span class="keyword" id="1351559">struct</span><span class="op" id="1351565">{</span><span class="op" id="1351566">}</span><span class="op" id="1351567">{</span><span class="op" id="1351568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351574">return</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351584">case</span>&nbsp;<span class="op" id="1351589">&lt;-</span><span class="ident" id="1351591"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1351594">.</span><span class="ident" id="1351595">ch</span><span class="op" id="1351597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351608">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351660">fi</span><span class="op" id="1351662">,</span>&nbsp;<span class="ident" id="1351664">err</span>&nbsp;<span class="op" id="1351668">:=</span>&nbsp;<span class="ident" id="1351671"><a href="/net/dnsclient_unix.go.html#1346047">os</a></span><span class="op" id="1351673">.</span><span class="ident" id="1351674">Stat</span><span class="op" id="1351678">(</span><span class="ident" id="1351679"><a href="/net/dnsclient_unix.go.html#1351162">resolvConfPath</a></span><span class="op" id="1351693">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351698">if</span>&nbsp;<span class="ident" id="1351701"><a href="/net/dnsclient_unix.go.html#1351664">err</a></span>&nbsp;<span class="op" id="1351705">!=</span>&nbsp;<span class="ident" id="1351708">nil</span>&nbsp;<span class="op" id="1351712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351718">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351735">//&nbsp;If&nbsp;the&nbsp;resolv.conf&nbsp;mtime&nbsp;didn&#39;t&nbsp;change,&nbsp;do&nbsp;not&nbsp;reload</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351795">m</span>&nbsp;<span class="op" id="1351797">:=</span>&nbsp;<span class="ident" id="1351800"><a href="/net/dnsclient_unix.go.html#1351660">fi</a></span><span class="op" id="1351802">.</span><span class="ident" id="1351803">ModTime</span><span class="op" id="1351810">(</span><span class="op" id="1351811">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351816">if</span>&nbsp;<span class="ident" id="1351819"><a href="/net/dnsclient_unix.go.html#1351795">m</a></span><span class="op" id="1351820">.</span><span class="ident" id="1351821">Equal</span><span class="op" id="1351826">(</span><span class="ident" id="1351827"><a href="/net/dnsclient_unix.go.html#1351245">mtime</a></span><span class="op" id="1351832">)</span>&nbsp;<span class="op" id="1351834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351840">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351857"><a href="/net/dnsclient_unix.go.html#1351245">mtime</a></span>&nbsp;<span class="op" id="1351863">=</span>&nbsp;<span class="ident" id="1351865"><a href="/net/dnsclient_unix.go.html#1351795">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351870">//&nbsp;In&nbsp;case&nbsp;of&nbsp;error,&nbsp;we&nbsp;keep&nbsp;the&nbsp;previous&nbsp;config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351922">ncfg</span><span class="op" id="1351926">,</span>&nbsp;<span class="ident" id="1351928"><a href="/net/dnsclient_unix.go.html#1351664">err</a></span>&nbsp;<span class="op" id="1351932">:=</span>&nbsp;<span class="ident" id="1351935"><a href="/net/dnsconfig_unix.go.html#1356965">dnsReadConfig</a></span><span class="op" id="1351948">(</span><span class="ident" id="1351949"><a href="/net/dnsclient_unix.go.html#1351162">resolvConfPath</a></span><span class="op" id="1351963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351968">if</span>&nbsp;<span class="ident" id="1351971"><a href="/net/dnsclient_unix.go.html#1351664">err</a></span>&nbsp;<span class="op" id="1351975">!=</span>&nbsp;<span class="ident" id="1351978">nil</span>&nbsp;<span class="op" id="1351982">||</span>&nbsp;<span class="builtinfunc" id="1351985">len</span><span class="op" id="1351988">(</span><span class="ident" id="1351989"><a href="/net/dnsclient_unix.go.html#1351922">ncfg</a></span><span class="op" id="1351993">.</span><span class="ident" id="1351994">servers</span><span class="op" id="1352001">)</span>&nbsp;<span class="op" id="1352003">==</span>&nbsp;<span class="num" id="1352006">0</span>&nbsp;<span class="op" id="1352008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352014">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352031"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352034">.</span><span class="ident" id="1352035">mu</span><span class="op" id="1352037">.</span><span class="ident" id="1352038">Lock</span><span class="op" id="1352042">(</span><span class="op" id="1352043">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352048"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352051">.</span><span class="ident" id="1352052">dnsConfig</span>&nbsp;<span class="op" id="1352062">=</span>&nbsp;<span class="ident" id="1352064"><a href="/net/dnsclient_unix.go.html#1351922">ncfg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352072"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352075">.</span><span class="ident" id="1352076">dnserr</span>&nbsp;<span class="op" id="1352083">=</span>&nbsp;<span class="ident" id="1352085">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352092"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352095">.</span><span class="ident" id="1352096">mu</span><span class="op" id="1352098">.</span><span class="ident" id="1352099">Unlock</span><span class="op" id="1352105">(</span><span class="op" id="1352106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352113">}</span><span class="op" id="1352114">(</span><span class="op" id="1352115">)</span><br>
<span class="lineno">270</span><span class="op" id="1352117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1352120">func</span>&nbsp;<span class="ident" id="1352125">lookup</span><span class="op" id="1352131">(</span><span class="ident" id="1352132">name</span>&nbsp;<span class="builtintype" id="1352137">string</span><span class="op" id="1352143">,</span>&nbsp;<span class="ident" id="1352145">qtype</span>&nbsp;<span class="builtintype" id="1352151">uint16</span><span class="op" id="1352157">)</span>&nbsp;<span class="op" id="1352159">(</span><span class="ident" id="1352160">cname</span>&nbsp;<span class="builtintype" id="1352166">string</span><span class="op" id="1352172">,</span>&nbsp;<span class="ident" id="1352174">addrs</span>&nbsp;<span class="op" id="1352180">[</span><span class="op" id="1352181">]</span><span class="ident" id="1352182"><a href="/net/dnsmsg.go.html#1362702">dnsRR</a></span><span class="op" id="1352187">,</span>&nbsp;<span class="ident" id="1352189">err</span>&nbsp;<span class="builtintype" id="1352193">error</span><span class="op" id="1352198">)</span>&nbsp;<span class="op" id="1352200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352203">if</span>&nbsp;<span class="op" id="1352206">!</span><span class="ident" id="1352207"><a href="/net/dnsclient.go.html#1342798">isDomainName</a></span><span class="op" id="1352219">(</span><span class="ident" id="1352220"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352224">)</span>&nbsp;<span class="op" id="1352226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352230">return</span>&nbsp;<span class="ident" id="1352237"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352241">,</span>&nbsp;<span class="ident" id="1352243">nil</span><span class="op" id="1352246">,</span>&nbsp;<span class="op" id="1352248">&amp;</span><span class="ident" id="1352249"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1352257">{</span><span class="ident" id="1352258">Err</span><span class="op" id="1352261">:</span>&nbsp;<span class="string" id="1352263">&#34;invalid&nbsp;domain&nbsp;name&#34;</span><span class="op" id="1352284">,</span>&nbsp;<span class="ident" id="1352286">Name</span><span class="op" id="1352290">:</span>&nbsp;<span class="ident" id="1352292"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352296">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352302"><a href="/net/dnsclient_unix.go.html#1350987">onceLoadConfig</a></span><span class="op" id="1352316">.</span><span class="ident" id="1352317">Do</span><span class="op" id="1352319">(</span><span class="ident" id="1352320"><a href="/net/dnsclient_unix.go.html#1351069">loadDefaultConfig</a></span><span class="op" id="1352337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352341">select</span>&nbsp;<span class="op" id="1352348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352351">case</span>&nbsp;<span class="ident" id="1352356"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352359">.</span><span class="ident" id="1352360">ch</span>&nbsp;<span class="op" id="1352363">&lt;-</span>&nbsp;<span class="keyword" id="1352366">struct</span><span class="op" id="1352372">{</span><span class="op" id="1352373">}</span><span class="op" id="1352374">{</span><span class="op" id="1352375">}</span><span class="op" id="1352376">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352379">default</span><span class="op" id="1352386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352393"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352396">.</span><span class="ident" id="1352397">mu</span><span class="op" id="1352399">.</span><span class="ident" id="1352400">RLock</span><span class="op" id="1352405">(</span><span class="op" id="1352406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352409">defer</span>&nbsp;<span class="ident" id="1352415"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352418">.</span><span class="ident" id="1352419">mu</span><span class="op" id="1352421">.</span><span class="ident" id="1352422">RUnlock</span><span class="op" id="1352429">(</span><span class="op" id="1352430">)</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352434">if</span>&nbsp;<span class="ident" id="1352437"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352440">.</span><span class="ident" id="1352441">dnserr</span>&nbsp;<span class="op" id="1352448">!=</span>&nbsp;<span class="ident" id="1352451">nil</span>&nbsp;<span class="op" id="1352455">||</span>&nbsp;<span class="ident" id="1352458"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352461">.</span><span class="ident" id="1352462">dnsConfig</span>&nbsp;<span class="op" id="1352472">==</span>&nbsp;<span class="ident" id="1352475">nil</span>&nbsp;<span class="op" id="1352479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352483"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1352487">=</span>&nbsp;<span class="ident" id="1352489"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352492">.</span><span class="ident" id="1352493">dnserr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352502">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352510">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1352513">//&nbsp;If&nbsp;name&nbsp;is&nbsp;rooted&nbsp;(trailing&nbsp;dot)&nbsp;or&nbsp;has&nbsp;enough&nbsp;dots,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1352570">//&nbsp;try&nbsp;it&nbsp;by&nbsp;itself&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352598">rooted</span>&nbsp;<span class="op" id="1352605">:=</span>&nbsp;<span class="builtinfunc" id="1352608">len</span><span class="op" id="1352611">(</span><span class="ident" id="1352612"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352616">)</span>&nbsp;<span class="op" id="1352618">&gt;</span>&nbsp;<span class="num" id="1352620">0</span>&nbsp;<span class="op" id="1352622">&amp;&amp;</span>&nbsp;<span class="ident" id="1352625"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352629">[</span><span class="builtinfunc" id="1352630">len</span><span class="op" id="1352633">(</span><span class="ident" id="1352634"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352638">)</span><span class="op" id="1352639">-</span><span class="num" id="1352640">1</span><span class="op" id="1352641">]</span>&nbsp;<span class="op" id="1352643">==</span>&nbsp;<span class="string" id="1352646">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352651">if</span>&nbsp;<span class="ident" id="1352654"><a href="/net/dnsclient_unix.go.html#1352598">rooted</a></span>&nbsp;<span class="op" id="1352661">||</span>&nbsp;<span class="ident" id="1352664"><a href="/net/parse.go.html#1479896">count</a></span><span class="op" id="1352669">(</span><span class="ident" id="1352670"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1352674">,</span>&nbsp;<span class="string" id="1352676">&#39;.&#39;</span><span class="op" id="1352679">)</span>&nbsp;<span class="op" id="1352681">&gt;=</span>&nbsp;<span class="ident" id="1352684"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352687">.</span><span class="ident" id="1352688">dnsConfig</span><span class="op" id="1352697">.</span><span class="ident" id="1352698">ndots</span>&nbsp;<span class="op" id="1352704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352708">rname</span>&nbsp;<span class="op" id="1352714">:=</span>&nbsp;<span class="ident" id="1352717"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352724">if</span>&nbsp;<span class="op" id="1352727">!</span><span class="ident" id="1352728"><a href="/net/dnsclient_unix.go.html#1352598">rooted</a></span>&nbsp;<span class="op" id="1352735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352740"><a href="/net/dnsclient_unix.go.html#1352708">rname</a></span>&nbsp;<span class="op" id="1352746">+=</span>&nbsp;<span class="string" id="1352749">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1352759">//&nbsp;Can&nbsp;try&nbsp;as&nbsp;ordinary&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352790"><a href="/net/dnsclient_unix.go.html#1352160">cname</a></span><span class="op" id="1352795">,</span>&nbsp;<span class="ident" id="1352797"><a href="/net/dnsclient_unix.go.html#1352174">addrs</a></span><span class="op" id="1352802">,</span>&nbsp;<span class="ident" id="1352804"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1352808">=</span>&nbsp;<span class="ident" id="1352810"><a href="/net/dnsclient_unix.go.html#1349480">tryOneName</a></span><span class="op" id="1352820">(</span><span class="ident" id="1352821"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352824">.</span><span class="ident" id="1352825">dnsConfig</span><span class="op" id="1352834">,</span>&nbsp;<span class="ident" id="1352836"><a href="/net/dnsclient_unix.go.html#1352708">rname</a></span><span class="op" id="1352841">,</span>&nbsp;<span class="ident" id="1352843"><a href="/net/dnsclient_unix.go.html#1352145">qtype</a></span><span class="op" id="1352848">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352852">if</span>&nbsp;<span class="ident" id="1352855"><a href="/net/dnsclient_unix.go.html#1352598">rooted</a></span>&nbsp;<span class="op" id="1352862">||</span>&nbsp;<span class="ident" id="1352865"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1352869">==</span>&nbsp;<span class="ident" id="1352872">nil</span>&nbsp;<span class="op" id="1352876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1352897">//&nbsp;Otherwise,&nbsp;try&nbsp;suffixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352926">for</span>&nbsp;<span class="ident" id="1352930">i</span>&nbsp;<span class="op" id="1352932">:=</span>&nbsp;<span class="num" id="1352935">0</span><span class="op" id="1352936">;</span>&nbsp;<span class="ident" id="1352938"><a href="/net/dnsclient_unix.go.html#1352930">i</a></span>&nbsp;<span class="op" id="1352940">&lt;</span>&nbsp;<span class="builtinfunc" id="1352942">len</span><span class="op" id="1352945">(</span><span class="ident" id="1352946"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1352949">.</span><span class="ident" id="1352950">dnsConfig</span><span class="op" id="1352959">.</span><span class="ident" id="1352960">search</span><span class="op" id="1352966">)</span><span class="op" id="1352967">;</span>&nbsp;<span class="ident" id="1352969"><a href="/net/dnsclient_unix.go.html#1352930">i</a></span><span class="op" id="1352970">++</span>&nbsp;<span class="op" id="1352973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352977">rname</span>&nbsp;<span class="op" id="1352983">:=</span>&nbsp;<span class="ident" id="1352986"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span>&nbsp;<span class="op" id="1352991">+</span>&nbsp;<span class="string" id="1352993">&#34;.&#34;</span>&nbsp;<span class="op" id="1352997">+</span>&nbsp;<span class="ident" id="1352999"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1353002">.</span><span class="ident" id="1353003">dnsConfig</span><span class="op" id="1353012">.</span><span class="ident" id="1353013">search</span><span class="op" id="1353019">[</span><span class="ident" id="1353020"><a href="/net/dnsclient_unix.go.html#1352930">i</a></span><span class="op" id="1353021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353025">if</span>&nbsp;<span class="ident" id="1353028"><a href="/net/dnsclient_unix.go.html#1352977">rname</a></span><span class="op" id="1353033">[</span><span class="builtinfunc" id="1353034">len</span><span class="op" id="1353037">(</span><span class="ident" id="1353038"><a href="/net/dnsclient_unix.go.html#1352977">rname</a></span><span class="op" id="1353043">)</span><span class="op" id="1353044">-</span><span class="num" id="1353045">1</span><span class="op" id="1353046">]</span>&nbsp;<span class="op" id="1353048">!=</span>&nbsp;<span class="string" id="1353051">&#39;.&#39;</span>&nbsp;<span class="op" id="1353055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353060"><a href="/net/dnsclient_unix.go.html#1352977">rname</a></span>&nbsp;<span class="op" id="1353066">+=</span>&nbsp;<span class="string" id="1353069">&#34;.&#34;</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353079"><a href="/net/dnsclient_unix.go.html#1352160">cname</a></span><span class="op" id="1353084">,</span>&nbsp;<span class="ident" id="1353086"><a href="/net/dnsclient_unix.go.html#1352174">addrs</a></span><span class="op" id="1353091">,</span>&nbsp;<span class="ident" id="1353093"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1353097">=</span>&nbsp;<span class="ident" id="1353099"><a href="/net/dnsclient_unix.go.html#1349480">tryOneName</a></span><span class="op" id="1353109">(</span><span class="ident" id="1353110"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1353113">.</span><span class="ident" id="1353114">dnsConfig</span><span class="op" id="1353123">,</span>&nbsp;<span class="ident" id="1353125"><a href="/net/dnsclient_unix.go.html#1352977">rname</a></span><span class="op" id="1353130">,</span>&nbsp;<span class="ident" id="1353132"><a href="/net/dnsclient_unix.go.html#1352145">qtype</a></span><span class="op" id="1353137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353141">if</span>&nbsp;<span class="ident" id="1353144"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1353148">==</span>&nbsp;<span class="ident" id="1353151">nil</span>&nbsp;<span class="op" id="1353155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353160">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353169">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353176">//&nbsp;Last&nbsp;ditch&nbsp;effort:&nbsp;try&nbsp;unsuffixed&nbsp;only&nbsp;if&nbsp;we&nbsp;haven&#39;t&nbsp;already,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353242">//&nbsp;that&nbsp;is,&nbsp;name&nbsp;is&nbsp;not&nbsp;rooted&nbsp;and&nbsp;has&nbsp;less&nbsp;than&nbsp;ndots&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353304">if</span>&nbsp;<span class="ident" id="1353307"><a href="/net/parse.go.html#1479896">count</a></span><span class="op" id="1353312">(</span><span class="ident" id="1353313"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1353317">,</span>&nbsp;<span class="string" id="1353319">&#39;.&#39;</span><span class="op" id="1353322">)</span>&nbsp;<span class="op" id="1353324">&lt;</span>&nbsp;<span class="ident" id="1353326"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1353329">.</span><span class="ident" id="1353330">dnsConfig</span><span class="op" id="1353339">.</span><span class="ident" id="1353340">ndots</span>&nbsp;<span class="op" id="1353346">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353350"><a href="/net/dnsclient_unix.go.html#1352160">cname</a></span><span class="op" id="1353355">,</span>&nbsp;<span class="ident" id="1353357"><a href="/net/dnsclient_unix.go.html#1352174">addrs</a></span><span class="op" id="1353362">,</span>&nbsp;<span class="ident" id="1353364"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1353368">=</span>&nbsp;<span class="ident" id="1353370"><a href="/net/dnsclient_unix.go.html#1349480">tryOneName</a></span><span class="op" id="1353380">(</span><span class="ident" id="1353381"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="1353384">.</span><span class="ident" id="1353385">dnsConfig</span><span class="op" id="1353394">,</span>&nbsp;<span class="ident" id="1353396"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><span class="op" id="1353400">+</span><span class="string" id="1353401">&#34;.&#34;</span><span class="op" id="1353404">,</span>&nbsp;<span class="ident" id="1353406"><a href="/net/dnsclient_unix.go.html#1352145">qtype</a></span><span class="op" id="1353411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353415">if</span>&nbsp;<span class="ident" id="1353418"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span>&nbsp;<span class="op" id="1353422">==</span>&nbsp;<span class="ident" id="1353425">nil</span>&nbsp;<span class="op" id="1353429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353434">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353446">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353450">if</span>&nbsp;<span class="ident" id="1353453">e</span><span class="op" id="1353454">,</span>&nbsp;<span class="ident" id="1353456">ok</span>&nbsp;<span class="op" id="1353459">:=</span>&nbsp;<span class="ident" id="1353462"><a href="/net/dnsclient_unix.go.html#1352189">err</a></span><span class="op" id="1353465">.</span><span class="op" id="1353466">(</span><span class="op" id="1353467">*</span><span class="ident" id="1353468"><a href="/net/dnsclient.go.html#1339713">DNSError</a></span><span class="op" id="1353476">)</span><span class="op" id="1353477">;</span>&nbsp;<span class="ident" id="1353479"><a href="/net/dnsclient_unix.go.html#1353456">ok</a></span>&nbsp;<span class="op" id="1353482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353486">//&nbsp;Show&nbsp;original&nbsp;name&nbsp;passed&nbsp;to&nbsp;lookup,&nbsp;not&nbsp;suffixed&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353546">//&nbsp;In&nbsp;general&nbsp;we&nbsp;might&nbsp;have&nbsp;tried&nbsp;many&nbsp;suffixes;&nbsp;showing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353605">//&nbsp;just&nbsp;one&nbsp;is&nbsp;misleading.&nbsp;See&nbsp;also&nbsp;golang.org/issue/6324.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353666"><a href="/net/dnsclient_unix.go.html#1353453">e</a></span><span class="op" id="1353667">.</span><span class="ident" id="1353668">Name</span>&nbsp;<span class="op" id="1353673">=</span>&nbsp;<span class="ident" id="1353675"><a href="/net/dnsclient_unix.go.html#1352132">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353684">return</span><br>
<span class="lineno"></span><span class="op" id="1353691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="1353694">//&nbsp;goLookupHost&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupHost.</span><br>
<span class="lineno"></span><span class="comment" id="1353757">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="1353817">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupHost&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="1353881">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1353942">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">340</span><span class="comment" id="1354005">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="1354017">func</span>&nbsp;<span class="ident" id="1354022">goLookupHost</span><span class="op" id="1354034">(</span><span class="ident" id="1354035">name</span>&nbsp;<span class="builtintype" id="1354040">string</span><span class="op" id="1354046">)</span>&nbsp;<span class="op" id="1354048">(</span><span class="ident" id="1354049">addrs</span>&nbsp;<span class="op" id="1354055">[</span><span class="op" id="1354056">]</span><span class="builtintype" id="1354057">string</span><span class="op" id="1354063">,</span>&nbsp;<span class="ident" id="1354065">err</span>&nbsp;<span class="builtintype" id="1354069">error</span><span class="op" id="1354074">)</span>&nbsp;<span class="op" id="1354076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354079">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;they&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354126"><a href="/net/dnsclient_unix.go.html#1354049">addrs</a></span>&nbsp;<span class="op" id="1354132">=</span>&nbsp;<span class="ident" id="1354134"><a href="/net/hosts.go.html#1405181">lookupStaticHost</a></span><span class="op" id="1354150">(</span><span class="ident" id="1354151"><a href="/net/dnsclient_unix.go.html#1354035">name</a></span><span class="op" id="1354155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354158">if</span>&nbsp;<span class="builtinfunc" id="1354161">len</span><span class="op" id="1354164">(</span><span class="ident" id="1354165"><a href="/net/dnsclient_unix.go.html#1354049">addrs</a></span><span class="op" id="1354170">)</span>&nbsp;<span class="op" id="1354172">&gt;</span>&nbsp;<span class="num" id="1354174">0</span>&nbsp;<span class="op" id="1354176">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354191">ips</span><span class="op" id="1354194">,</span>&nbsp;<span class="ident" id="1354196"><a href="/net/dnsclient_unix.go.html#1354065">err</a></span>&nbsp;<span class="op" id="1354200">:=</span>&nbsp;<span class="ident" id="1354203"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="1354213">(</span><span class="ident" id="1354214"><a href="/net/dnsclient_unix.go.html#1354035">name</a></span><span class="op" id="1354218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354221">if</span>&nbsp;<span class="ident" id="1354224"><a href="/net/dnsclient_unix.go.html#1354065">err</a></span>&nbsp;<span class="op" id="1354228">!=</span>&nbsp;<span class="ident" id="1354231">nil</span>&nbsp;<span class="op" id="1354235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354239">return</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354250"><a href="/net/dnsclient_unix.go.html#1354049">addrs</a></span>&nbsp;<span class="op" id="1354256">=</span>&nbsp;<span class="builtinfunc" id="1354258">make</span><span class="op" id="1354262">(</span><span class="op" id="1354263">[</span><span class="op" id="1354264">]</span><span class="builtintype" id="1354265">string</span><span class="op" id="1354271">,</span>&nbsp;<span class="num" id="1354273">0</span><span class="op" id="1354274">,</span>&nbsp;<span class="builtinfunc" id="1354276">len</span><span class="op" id="1354279">(</span><span class="ident" id="1354280"><a href="/net/dnsclient_unix.go.html#1354191">ips</a></span><span class="op" id="1354283">)</span><span class="op" id="1354284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354287">for</span>&nbsp;<span class="ident" id="1354291">_</span><span class="op" id="1354292">,</span>&nbsp;<span class="ident" id="1354294">ip</span>&nbsp;<span class="op" id="1354297">:=</span>&nbsp;<span class="keyword" id="1354300">range</span>&nbsp;<span class="ident" id="1354306"><a href="/net/dnsclient_unix.go.html#1354191">ips</a></span>&nbsp;<span class="op" id="1354310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354314"><a href="/net/dnsclient_unix.go.html#1354049">addrs</a></span>&nbsp;<span class="op" id="1354320">=</span>&nbsp;<span class="builtinfunc" id="1354322">append</span><span class="op" id="1354328">(</span><span class="ident" id="1354329"><a href="/net/dnsclient_unix.go.html#1354049">addrs</a></span><span class="op" id="1354334">,</span>&nbsp;<span class="ident" id="1354336"><a href="/net/dnsclient_unix.go.html#1354294">ip</a></span><span class="op" id="1354338">.</span><span class="ident" id="1354339">String</span><span class="op" id="1354345">(</span><span class="op" id="1354346">)</span><span class="op" id="1354347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354350">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354353">return</span><br>
<span class="lineno"></span><span class="op" id="1354360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1354363">//&nbsp;goLookupIP&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupIP.</span><br>
<span class="lineno"></span><span class="comment" id="1354422">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno">360</span><span class="comment" id="1354480">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupIP&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="1354542">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1354603">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="1354666">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="1354678">func</span>&nbsp;<span class="ident" id="1354683">goLookupIP</span><span class="op" id="1354693">(</span><span class="ident" id="1354694">name</span>&nbsp;<span class="builtintype" id="1354699">string</span><span class="op" id="1354705">)</span>&nbsp;<span class="op" id="1354707">(</span><span class="ident" id="1354708">addrs</span>&nbsp;<span class="op" id="1354714">[</span><span class="op" id="1354715">]</span><span class="ident" id="1354716"><a href="/net/ip.go.html#1417189">IP</a></span><span class="op" id="1354718">,</span>&nbsp;<span class="ident" id="1354720">err</span>&nbsp;<span class="builtintype" id="1354724">error</span><span class="op" id="1354729">)</span>&nbsp;<span class="op" id="1354731">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354734">//&nbsp;Use&nbsp;entries&nbsp;from&nbsp;/etc/hosts&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354779">haddrs</span>&nbsp;<span class="op" id="1354786">:=</span>&nbsp;<span class="ident" id="1354789"><a href="/net/hosts.go.html#1405181">lookupStaticHost</a></span><span class="op" id="1354805">(</span><span class="ident" id="1354806"><a href="/net/dnsclient_unix.go.html#1354694">name</a></span><span class="op" id="1354810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354813">if</span>&nbsp;<span class="builtinfunc" id="1354816">len</span><span class="op" id="1354819">(</span><span class="ident" id="1354820"><a href="/net/dnsclient_unix.go.html#1354779">haddrs</a></span><span class="op" id="1354826">)</span>&nbsp;<span class="op" id="1354828">&gt;</span>&nbsp;<span class="num" id="1354830">0</span>&nbsp;<span class="op" id="1354832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354836">for</span>&nbsp;<span class="ident" id="1354840">_</span><span class="op" id="1354841">,</span>&nbsp;<span class="ident" id="1354843">haddr</span>&nbsp;<span class="op" id="1354849">:=</span>&nbsp;<span class="keyword" id="1354852">range</span>&nbsp;<span class="ident" id="1354858"><a href="/net/dnsclient_unix.go.html#1354779">haddrs</a></span>&nbsp;<span class="op" id="1354865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354870">if</span>&nbsp;<span class="ident" id="1354873">ip</span>&nbsp;<span class="op" id="1354876">:=</span>&nbsp;<span class="ident" id="1354879"><a href="/net/ip.go.html#1430775">ParseIP</a></span><span class="op" id="1354886">(</span><span class="ident" id="1354887"><a href="/net/dnsclient_unix.go.html#1354843">haddr</a></span><span class="op" id="1354892">)</span><span class="op" id="1354893">;</span>&nbsp;<span class="ident" id="1354895"><a href="/net/dnsclient_unix.go.html#1354873">ip</a></span>&nbsp;<span class="op" id="1354898">!=</span>&nbsp;<span class="ident" id="1354901">nil</span>&nbsp;<span class="op" id="1354905">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354911"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span>&nbsp;<span class="op" id="1354917">=</span>&nbsp;<span class="builtinfunc" id="1354919">append</span><span class="op" id="1354925">(</span><span class="ident" id="1354926"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1354931">,</span>&nbsp;<span class="ident" id="1354933"><a href="/net/dnsclient_unix.go.html#1354873">ip</a></span><span class="op" id="1354935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354948">if</span>&nbsp;<span class="builtinfunc" id="1354951">len</span><span class="op" id="1354954">(</span><span class="ident" id="1354955"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1354960">)</span>&nbsp;<span class="op" id="1354962">&gt;</span>&nbsp;<span class="num" id="1354964">0</span>&nbsp;<span class="op" id="1354966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354971">return</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354986">type</span>&nbsp;<span class="ident" id="1354991">racer</span>&nbsp;<span class="keyword" id="1354997">struct</span>&nbsp;<span class="op" id="1355004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355008">qtype</span>&nbsp;<span class="builtintype" id="1355014">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355023">rrs</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1355029">[</span><span class="op" id="1355030">]</span><span class="ident" id="1355031"><a href="/net/dnsmsg.go.html#1362702">dnsRR</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1355039">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355049">lane</span>&nbsp;<span class="op" id="1355054">:=</span>&nbsp;<span class="builtinfunc" id="1355057">make</span><span class="op" id="1355061">(</span><span class="keyword" id="1355062">chan</span>&nbsp;<span class="ident" id="1355067"><a href="/net/dnsclient_unix.go.html#1354991">racer</a></span><span class="op" id="1355072">,</span>&nbsp;<span class="num" id="1355074">1</span><span class="op" id="1355075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355078">qtypes</span>&nbsp;<span class="op" id="1355085">:=</span>&nbsp;<span class="op" id="1355088">[</span><span class="op" id="1355089">...</span><span class="op" id="1355092">]</span><span class="builtintype" id="1355093">uint16</span><span class="op" id="1355099">{</span><span class="ident" id="1355100"><a href="/net/dnsmsg.go.html#1359704">dnsTypeA</a></span><span class="op" id="1355108">,</span>&nbsp;<span class="ident" id="1355110"><a href="/net/dnsmsg.go.html#1359999">dnsTypeAAAA</a></span><span class="op" id="1355121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355124">for</span>&nbsp;<span class="ident" id="1355128">_</span><span class="op" id="1355129">,</span>&nbsp;<span class="ident" id="1355131">qtype</span>&nbsp;<span class="op" id="1355137">:=</span>&nbsp;<span class="keyword" id="1355140">range</span>&nbsp;<span class="ident" id="1355146"><a href="/net/dnsclient_unix.go.html#1355078">qtypes</a></span>&nbsp;<span class="op" id="1355153">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355157">go</span>&nbsp;<span class="keyword" id="1355160">func</span><span class="op" id="1355164">(</span><span class="ident" id="1355165">qtype</span>&nbsp;<span class="builtintype" id="1355171">uint16</span><span class="op" id="1355177">)</span>&nbsp;<span class="op" id="1355179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355184">_</span><span class="op" id="1355185">,</span>&nbsp;<span class="ident" id="1355187">rrs</span><span class="op" id="1355190">,</span>&nbsp;<span class="ident" id="1355192">err</span>&nbsp;<span class="op" id="1355196">:=</span>&nbsp;<span class="ident" id="1355199"><a href="/net/dnsclient_unix.go.html#1352125">lookup</a></span><span class="op" id="1355205">(</span><span class="ident" id="1355206"><a href="/net/dnsclient_unix.go.html#1354694">name</a></span><span class="op" id="1355210">,</span>&nbsp;<span class="ident" id="1355212"><a href="/net/dnsclient_unix.go.html#1355165">qtype</a></span><span class="op" id="1355217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355222"><a href="/net/dnsclient_unix.go.html#1355049">lane</a></span>&nbsp;<span class="op" id="1355227">&lt;-</span>&nbsp;<span class="ident" id="1355230"><a href="/net/dnsclient_unix.go.html#1354991">racer</a></span><span class="op" id="1355235">{</span><span class="ident" id="1355236"><a href="/net/dnsclient_unix.go.html#1355165">qtype</a></span><span class="op" id="1355241">,</span>&nbsp;<span class="ident" id="1355243"><a href="/net/dnsclient_unix.go.html#1355187">rrs</a></span><span class="op" id="1355246">,</span>&nbsp;<span class="ident" id="1355248"><a href="/net/dnsclient_unix.go.html#1355192">err</a></span><span class="op" id="1355251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355255">}</span><span class="op" id="1355256">(</span><span class="ident" id="1355257"><a href="/net/dnsclient_unix.go.html#1355131">qtype</a></span><span class="op" id="1355262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355265">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355268">var</span>&nbsp;<span class="ident" id="1355272">lastErr</span>&nbsp;<span class="builtintype" id="1355280">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355287">for</span>&nbsp;<span class="keyword" id="1355291">range</span>&nbsp;<span class="ident" id="1355297"><a href="/net/dnsclient_unix.go.html#1355078">qtypes</a></span>&nbsp;<span class="op" id="1355304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355308">racer</span>&nbsp;<span class="op" id="1355314">:=</span>&nbsp;<span class="op" id="1355317">&lt;-</span><span class="ident" id="1355319"><a href="/net/dnsclient_unix.go.html#1355049">lane</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355326">if</span>&nbsp;<span class="ident" id="1355329"><a href="/net/dnsclient_unix.go.html#1355308">racer</a></span><span class="op" id="1355334">.</span><span class="builtintype" id="1355335">error</span>&nbsp;<span class="op" id="1355341">!=</span>&nbsp;<span class="ident" id="1355344">nil</span>&nbsp;<span class="op" id="1355348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355353"><a href="/net/dnsclient_unix.go.html#1355272">lastErr</a></span>&nbsp;<span class="op" id="1355361">=</span>&nbsp;<span class="ident" id="1355363"><a href="/net/dnsclient_unix.go.html#1355308">racer</a></span><span class="op" id="1355368">.</span><span class="builtintype" id="1355369">error</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355378">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355393">switch</span>&nbsp;<span class="ident" id="1355400"><a href="/net/dnsclient_unix.go.html#1355308">racer</a></span><span class="op" id="1355405">.</span><span class="ident" id="1355406">qtype</span>&nbsp;<span class="op" id="1355412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355416">case</span>&nbsp;<span class="ident" id="1355421"><a href="/net/dnsmsg.go.html#1359704">dnsTypeA</a></span><span class="op" id="1355429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355434"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span>&nbsp;<span class="op" id="1355440">=</span>&nbsp;<span class="builtinfunc" id="1355442">append</span><span class="op" id="1355448">(</span><span class="ident" id="1355449"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1355454">,</span>&nbsp;<span class="ident" id="1355456"><a href="/net/dnsclient_unix.go.html#1350429">convertRR_A</a></span><span class="op" id="1355467">(</span><span class="ident" id="1355468"><a href="/net/dnsclient_unix.go.html#1355308">racer</a></span><span class="op" id="1355473">.</span><span class="ident" id="1355474">rrs</span><span class="op" id="1355477">)</span><span class="op" id="1355478">...</span><span class="op" id="1355481">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355485">case</span>&nbsp;<span class="ident" id="1355490"><a href="/net/dnsmsg.go.html#1359999">dnsTypeAAAA</a></span><span class="op" id="1355501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355506"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span>&nbsp;<span class="op" id="1355512">=</span>&nbsp;<span class="builtinfunc" id="1355514">append</span><span class="op" id="1355520">(</span><span class="ident" id="1355521"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1355526">,</span>&nbsp;<span class="ident" id="1355528"><a href="/net/dnsclient_unix.go.html#1350643">convertRR_AAAA</a></span><span class="op" id="1355542">(</span><span class="ident" id="1355543"><a href="/net/dnsclient_unix.go.html#1355308">racer</a></span><span class="op" id="1355548">.</span><span class="ident" id="1355549">rrs</span><span class="op" id="1355552">)</span><span class="op" id="1355553">...</span><span class="op" id="1355556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355566">if</span>&nbsp;<span class="builtinfunc" id="1355569">len</span><span class="op" id="1355572">(</span><span class="ident" id="1355573"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1355578">)</span>&nbsp;<span class="op" id="1355580">==</span>&nbsp;<span class="num" id="1355583">0</span>&nbsp;<span class="op" id="1355585">&amp;&amp;</span>&nbsp;<span class="ident" id="1355588"><a href="/net/dnsclient_unix.go.html#1355272">lastErr</a></span>&nbsp;<span class="op" id="1355596">!=</span>&nbsp;<span class="ident" id="1355599">nil</span>&nbsp;<span class="op" id="1355603">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355607">return</span>&nbsp;<span class="ident" id="1355614">nil</span><span class="op" id="1355617">,</span>&nbsp;<span class="ident" id="1355619"><a href="/net/dnsclient_unix.go.html#1355272">lastErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355631">return</span>&nbsp;<span class="ident" id="1355638"><a href="/net/dnsclient_unix.go.html#1354708">addrs</a></span><span class="op" id="1355643">,</span>&nbsp;<span class="ident" id="1355645">nil</span><br>
<span class="lineno"></span><span class="op" id="1355649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="1355652">//&nbsp;goLookupCNAME&nbsp;is&nbsp;the&nbsp;native&nbsp;Go&nbsp;implementation&nbsp;of&nbsp;LookupCNAME.</span><br>
<span class="lineno"></span><span class="comment" id="1355717">//&nbsp;Used&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;refuses&nbsp;to&nbsp;handle&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="1355778">//&nbsp;(that&nbsp;is,&nbsp;only&nbsp;if&nbsp;cgoLookupCNAME&nbsp;is&nbsp;the&nbsp;stub&nbsp;in&nbsp;cgo_stub.go).</span><br>
<span class="lineno"></span><span class="comment" id="1355843">//&nbsp;Normally&nbsp;we&nbsp;let&nbsp;cgo&nbsp;use&nbsp;the&nbsp;C&nbsp;library&nbsp;resolver&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1355904">//&nbsp;depending&nbsp;on&nbsp;our&nbsp;lookup&nbsp;code,&nbsp;so&nbsp;that&nbsp;Go&nbsp;and&nbsp;C&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno">415</span><span class="comment" id="1355967">//&nbsp;answers.</span><br>
<span class="lineno"></span><span class="keyword" id="1355979">func</span>&nbsp;<span class="ident" id="1355984">goLookupCNAME</span><span class="op" id="1355997">(</span><span class="ident" id="1355998">name</span>&nbsp;<span class="builtintype" id="1356003">string</span><span class="op" id="1356009">)</span>&nbsp;<span class="op" id="1356011">(</span><span class="ident" id="1356012">cname</span>&nbsp;<span class="builtintype" id="1356018">string</span><span class="op" id="1356024">,</span>&nbsp;<span class="ident" id="1356026">err</span>&nbsp;<span class="builtintype" id="1356030">error</span><span class="op" id="1356035">)</span>&nbsp;<span class="op" id="1356037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356040">_</span><span class="op" id="1356041">,</span>&nbsp;<span class="ident" id="1356043">rr</span><span class="op" id="1356045">,</span>&nbsp;<span class="ident" id="1356047"><a href="/net/dnsclient_unix.go.html#1356026">err</a></span>&nbsp;<span class="op" id="1356051">:=</span>&nbsp;<span class="ident" id="1356054"><a href="/net/dnsclient_unix.go.html#1352125">lookup</a></span><span class="op" id="1356060">(</span><span class="ident" id="1356061"><a href="/net/dnsclient_unix.go.html#1355998">name</a></span><span class="op" id="1356065">,</span>&nbsp;<span class="ident" id="1356067"><a href="/net/dnsmsg.go.html#1359776">dnsTypeCNAME</a></span><span class="op" id="1356079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356082">if</span>&nbsp;<span class="ident" id="1356085"><a href="/net/dnsclient_unix.go.html#1356026">err</a></span>&nbsp;<span class="op" id="1356089">!=</span>&nbsp;<span class="ident" id="1356092">nil</span>&nbsp;<span class="op" id="1356096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356100">return</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356111"><a href="/net/dnsclient_unix.go.html#1356012">cname</a></span>&nbsp;<span class="op" id="1356117">=</span>&nbsp;<span class="ident" id="1356119"><a href="/net/dnsclient_unix.go.html#1356043">rr</a></span><span class="op" id="1356121">[</span><span class="num" id="1356122">0</span><span class="op" id="1356123">]</span><span class="op" id="1356124">.</span><span class="op" id="1356125">(</span><span class="op" id="1356126">*</span><span class="ident" id="1356127"><a href="/net/dnsmsg.go.html#1362812">dnsRR_CNAME</a></span><span class="op" id="1356138">)</span><span class="op" id="1356139">.</span><span class="ident" id="1356140">Cname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356147">return</span><br>
<span class="lineno"></span><span class="op" id="1356154">}</span>
</div>
</body>
</html>
