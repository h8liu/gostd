<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6708562">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6708618">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6708672">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6708723">package</span>&nbsp;<span class="ident" id="6708731">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6708736">import</span>&nbsp;<span class="op" id="6708743">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708746">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708755">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708762">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708768">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708779">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708790">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6708801">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6708808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6708811">type</span>&nbsp;<span class="ident" id="6708816">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="6708834">struct</span>&nbsp;<span class="op" id="6708841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708844">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6708858">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708866">litAddrOrName</span>&nbsp;<span class="builtintype" id="6708880">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708888">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708902">*</span><span class="ident" id="6708903">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6708911">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6708925">error</span><br>
<span class="lineno"></span><span class="op" id="6708931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6708934">var</span>&nbsp;<span class="ident" id="6708938">resolveIPAddrTests</span>&nbsp;<span class="op" id="6708957">=</span>&nbsp;<span class="op" id="6708959">[</span><span class="op" id="6708960">]</span><span class="ident" id="6708961">resolveIPAddrTest</span><span class="op" id="6708978">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6708981">{</span><span class="string" id="6708982">&#34;ip&#34;</span><span class="op" id="6708986">,</span>&nbsp;<span class="string" id="6708988">&#34;127.0.0.1&#34;</span><span class="op" id="6708999">,</span>&nbsp;<span class="op" id="6709001">&amp;</span><span class="ident" id="6709002">IPAddr</span><span class="op" id="6709008">{</span><span class="ident" id="6709009">IP</span><span class="op" id="6709011">:</span>&nbsp;<span class="ident" id="6709013">IPv4</span><span class="op" id="6709017">(</span><span class="num" id="6709018">127</span><span class="op" id="6709021">,</span>&nbsp;<span class="num" id="6709023">0</span><span class="op" id="6709024">,</span>&nbsp;<span class="num" id="6709026">0</span><span class="op" id="6709027">,</span>&nbsp;<span class="num" id="6709029">1</span><span class="op" id="6709030">)</span><span class="op" id="6709031">}</span><span class="op" id="6709032">,</span>&nbsp;<span class="builtintype" id="6709034">nil</span><span class="op" id="6709037">}</span><span class="op" id="6709038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709041">{</span><span class="string" id="6709042">&#34;ip4&#34;</span><span class="op" id="6709047">,</span>&nbsp;<span class="string" id="6709049">&#34;127.0.0.1&#34;</span><span class="op" id="6709060">,</span>&nbsp;<span class="op" id="6709062">&amp;</span><span class="ident" id="6709063">IPAddr</span><span class="op" id="6709069">{</span><span class="ident" id="6709070">IP</span><span class="op" id="6709072">:</span>&nbsp;<span class="ident" id="6709074">IPv4</span><span class="op" id="6709078">(</span><span class="num" id="6709079">127</span><span class="op" id="6709082">,</span>&nbsp;<span class="num" id="6709084">0</span><span class="op" id="6709085">,</span>&nbsp;<span class="num" id="6709087">0</span><span class="op" id="6709088">,</span>&nbsp;<span class="num" id="6709090">1</span><span class="op" id="6709091">)</span><span class="op" id="6709092">}</span><span class="op" id="6709093">,</span>&nbsp;<span class="builtintype" id="6709095">nil</span><span class="op" id="6709098">}</span><span class="op" id="6709099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709102">{</span><span class="string" id="6709103">&#34;ip4:icmp&#34;</span><span class="op" id="6709113">,</span>&nbsp;<span class="string" id="6709115">&#34;127.0.0.1&#34;</span><span class="op" id="6709126">,</span>&nbsp;<span class="op" id="6709128">&amp;</span><span class="ident" id="6709129">IPAddr</span><span class="op" id="6709135">{</span><span class="ident" id="6709136">IP</span><span class="op" id="6709138">:</span>&nbsp;<span class="ident" id="6709140">IPv4</span><span class="op" id="6709144">(</span><span class="num" id="6709145">127</span><span class="op" id="6709148">,</span>&nbsp;<span class="num" id="6709150">0</span><span class="op" id="6709151">,</span>&nbsp;<span class="num" id="6709153">0</span><span class="op" id="6709154">,</span>&nbsp;<span class="num" id="6709156">1</span><span class="op" id="6709157">)</span><span class="op" id="6709158">}</span><span class="op" id="6709159">,</span>&nbsp;<span class="builtintype" id="6709161">nil</span><span class="op" id="6709164">}</span><span class="op" id="6709165">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709169">{</span><span class="string" id="6709170">&#34;ip&#34;</span><span class="op" id="6709174">,</span>&nbsp;<span class="string" id="6709176">&#34;::1&#34;</span><span class="op" id="6709181">,</span>&nbsp;<span class="op" id="6709183">&amp;</span><span class="ident" id="6709184">IPAddr</span><span class="op" id="6709190">{</span><span class="ident" id="6709191">IP</span><span class="op" id="6709193">:</span>&nbsp;<span class="ident" id="6709195">ParseIP</span><span class="op" id="6709202">(</span><span class="string" id="6709203">&#34;::1&#34;</span><span class="op" id="6709208">)</span><span class="op" id="6709209">}</span><span class="op" id="6709210">,</span>&nbsp;<span class="builtintype" id="6709212">nil</span><span class="op" id="6709215">}</span><span class="op" id="6709216">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709219">{</span><span class="string" id="6709220">&#34;ip6&#34;</span><span class="op" id="6709225">,</span>&nbsp;<span class="string" id="6709227">&#34;::1&#34;</span><span class="op" id="6709232">,</span>&nbsp;<span class="op" id="6709234">&amp;</span><span class="ident" id="6709235">IPAddr</span><span class="op" id="6709241">{</span><span class="ident" id="6709242">IP</span><span class="op" id="6709244">:</span>&nbsp;<span class="ident" id="6709246">ParseIP</span><span class="op" id="6709253">(</span><span class="string" id="6709254">&#34;::1&#34;</span><span class="op" id="6709259">)</span><span class="op" id="6709260">}</span><span class="op" id="6709261">,</span>&nbsp;<span class="builtintype" id="6709263">nil</span><span class="op" id="6709266">}</span><span class="op" id="6709267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709270">{</span><span class="string" id="6709271">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6709286">,</span>&nbsp;<span class="string" id="6709288">&#34;::1&#34;</span><span class="op" id="6709293">,</span>&nbsp;<span class="op" id="6709295">&amp;</span><span class="ident" id="6709296">IPAddr</span><span class="op" id="6709302">{</span><span class="ident" id="6709303">IP</span><span class="op" id="6709305">:</span>&nbsp;<span class="ident" id="6709307">ParseIP</span><span class="op" id="6709314">(</span><span class="string" id="6709315">&#34;::1&#34;</span><span class="op" id="6709320">)</span><span class="op" id="6709321">}</span><span class="op" id="6709322">,</span>&nbsp;<span class="builtintype" id="6709324">nil</span><span class="op" id="6709327">}</span><span class="op" id="6709328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709331">{</span><span class="string" id="6709332">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="6709347">,</span>&nbsp;<span class="string" id="6709349">&#34;::1&#34;</span><span class="op" id="6709354">,</span>&nbsp;<span class="op" id="6709356">&amp;</span><span class="ident" id="6709357">IPAddr</span><span class="op" id="6709363">{</span><span class="ident" id="6709364">IP</span><span class="op" id="6709366">:</span>&nbsp;<span class="ident" id="6709368">ParseIP</span><span class="op" id="6709375">(</span><span class="string" id="6709376">&#34;::1&#34;</span><span class="op" id="6709381">)</span><span class="op" id="6709382">}</span><span class="op" id="6709383">,</span>&nbsp;<span class="builtintype" id="6709385">nil</span><span class="op" id="6709388">}</span><span class="op" id="6709389">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709393">{</span><span class="string" id="6709394">&#34;ip&#34;</span><span class="op" id="6709398">,</span>&nbsp;<span class="string" id="6709400">&#34;::1%en0&#34;</span><span class="op" id="6709409">,</span>&nbsp;<span class="op" id="6709411">&amp;</span><span class="ident" id="6709412">IPAddr</span><span class="op" id="6709418">{</span><span class="ident" id="6709419">IP</span><span class="op" id="6709421">:</span>&nbsp;<span class="ident" id="6709423">ParseIP</span><span class="op" id="6709430">(</span><span class="string" id="6709431">&#34;::1&#34;</span><span class="op" id="6709436">)</span><span class="op" id="6709437">,</span>&nbsp;<span class="ident" id="6709439">Zone</span><span class="op" id="6709443">:</span>&nbsp;<span class="string" id="6709445">&#34;en0&#34;</span><span class="op" id="6709450">}</span><span class="op" id="6709451">,</span>&nbsp;<span class="builtintype" id="6709453">nil</span><span class="op" id="6709456">}</span><span class="op" id="6709457">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709460">{</span><span class="string" id="6709461">&#34;ip6&#34;</span><span class="op" id="6709466">,</span>&nbsp;<span class="string" id="6709468">&#34;::1%911&#34;</span><span class="op" id="6709477">,</span>&nbsp;<span class="op" id="6709479">&amp;</span><span class="ident" id="6709480">IPAddr</span><span class="op" id="6709486">{</span><span class="ident" id="6709487">IP</span><span class="op" id="6709489">:</span>&nbsp;<span class="ident" id="6709491">ParseIP</span><span class="op" id="6709498">(</span><span class="string" id="6709499">&#34;::1&#34;</span><span class="op" id="6709504">)</span><span class="op" id="6709505">,</span>&nbsp;<span class="ident" id="6709507">Zone</span><span class="op" id="6709511">:</span>&nbsp;<span class="string" id="6709513">&#34;911&#34;</span><span class="op" id="6709518">}</span><span class="op" id="6709519">,</span>&nbsp;<span class="builtintype" id="6709521">nil</span><span class="op" id="6709524">}</span><span class="op" id="6709525">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709529">{</span><span class="string" id="6709530">&#34;&#34;</span><span class="op" id="6709532">,</span>&nbsp;<span class="string" id="6709534">&#34;127.0.0.1&#34;</span><span class="op" id="6709545">,</span>&nbsp;<span class="op" id="6709547">&amp;</span><span class="ident" id="6709548">IPAddr</span><span class="op" id="6709554">{</span><span class="ident" id="6709555">IP</span><span class="op" id="6709557">:</span>&nbsp;<span class="ident" id="6709559">IPv4</span><span class="op" id="6709563">(</span><span class="num" id="6709564">127</span><span class="op" id="6709567">,</span>&nbsp;<span class="num" id="6709569">0</span><span class="op" id="6709570">,</span>&nbsp;<span class="num" id="6709572">0</span><span class="op" id="6709573">,</span>&nbsp;<span class="num" id="6709575">1</span><span class="op" id="6709576">)</span><span class="op" id="6709577">}</span><span class="op" id="6709578">,</span>&nbsp;<span class="builtintype" id="6709580">nil</span><span class="op" id="6709583">}</span><span class="op" id="6709584">,</span>&nbsp;<span class="comment" id="6709586">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709606">{</span><span class="string" id="6709607">&#34;&#34;</span><span class="op" id="6709609">,</span>&nbsp;<span class="string" id="6709611">&#34;::1&#34;</span><span class="op" id="6709616">,</span>&nbsp;<span class="op" id="6709618">&amp;</span><span class="ident" id="6709619">IPAddr</span><span class="op" id="6709625">{</span><span class="ident" id="6709626">IP</span><span class="op" id="6709628">:</span>&nbsp;<span class="ident" id="6709630">ParseIP</span><span class="op" id="6709637">(</span><span class="string" id="6709638">&#34;::1&#34;</span><span class="op" id="6709643">)</span><span class="op" id="6709644">}</span><span class="op" id="6709645">,</span>&nbsp;<span class="builtintype" id="6709647">nil</span><span class="op" id="6709650">}</span><span class="op" id="6709651">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6709663">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709684">{</span><span class="string" id="6709685">&#34;l2tp&#34;</span><span class="op" id="6709691">,</span>&nbsp;<span class="string" id="6709693">&#34;127.0.0.1&#34;</span><span class="op" id="6709704">,</span>&nbsp;<span class="builtintype" id="6709706">nil</span><span class="op" id="6709709">,</span>&nbsp;<span class="ident" id="6709711">UnknownNetworkError</span><span class="op" id="6709730">(</span><span class="string" id="6709731">&#34;l2tp&#34;</span><span class="op" id="6709737">)</span><span class="op" id="6709738">}</span><span class="op" id="6709739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709742">{</span><span class="string" id="6709743">&#34;l2tp:gre&#34;</span><span class="op" id="6709753">,</span>&nbsp;<span class="string" id="6709755">&#34;127.0.0.1&#34;</span><span class="op" id="6709766">,</span>&nbsp;<span class="builtintype" id="6709768">nil</span><span class="op" id="6709771">,</span>&nbsp;<span class="ident" id="6709773">UnknownNetworkError</span><span class="op" id="6709792">(</span><span class="string" id="6709793">&#34;l2tp:gre&#34;</span><span class="op" id="6709803">)</span><span class="op" id="6709804">}</span><span class="op" id="6709805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6709808">{</span><span class="string" id="6709809">&#34;tcp&#34;</span><span class="op" id="6709814">,</span>&nbsp;<span class="string" id="6709816">&#34;1.2.3.4:123&#34;</span><span class="op" id="6709829">,</span>&nbsp;<span class="builtintype" id="6709831">nil</span><span class="op" id="6709834">,</span>&nbsp;<span class="ident" id="6709836">UnknownNetworkError</span><span class="op" id="6709855">(</span><span class="string" id="6709856">&#34;tcp&#34;</span><span class="op" id="6709861">)</span><span class="op" id="6709862">}</span><span class="op" id="6709863">,</span><br>
<span class="lineno"></span><span class="op" id="6709865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6709868">func</span>&nbsp;<span class="ident" id="6709873">init</span><span class="op" id="6709877">(</span><span class="op" id="6709878">)</span>&nbsp;<span class="op" id="6709880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6709883">if</span>&nbsp;<span class="ident" id="6709886">ifi</span>&nbsp;<span class="op" id="6709890">:=</span>&nbsp;<span class="ident" id="6709893">loopbackInterface</span><span class="op" id="6709910">(</span><span class="op" id="6709911">)</span><span class="op" id="6709912">;</span>&nbsp;<span class="ident" id="6709914">ifi</span>&nbsp;<span class="op" id="6709918">!=</span>&nbsp;<span class="builtintype" id="6709921">nil</span>&nbsp;<span class="op" id="6709925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6709929">index</span>&nbsp;<span class="op" id="6709935">:=</span>&nbsp;<span class="ident" id="6709938">fmt</span><span class="op" id="6709941">.</span><span class="ident" id="6709942">Sprintf</span><span class="op" id="6709949">(</span><span class="string" id="6709950">&#34;%v&#34;</span><span class="op" id="6709954">,</span>&nbsp;<span class="ident" id="6709956">ifi</span><span class="op" id="6709959">.</span><span class="ident" id="6709960">Index</span><span class="op" id="6709965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6709969">resolveIPAddrTests</span>&nbsp;<span class="op" id="6709988">=</span>&nbsp;<span class="builtinfunc" id="6709990">append</span><span class="op" id="6709996">(</span><span class="ident" id="6709997">resolveIPAddrTests</span><span class="op" id="6710015">,</span>&nbsp;<span class="op" id="6710017">[</span><span class="op" id="6710018">]</span><span class="ident" id="6710019">resolveIPAddrTest</span><span class="op" id="6710036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710041">{</span><span class="string" id="6710042">&#34;ip6&#34;</span><span class="op" id="6710047">,</span>&nbsp;<span class="string" id="6710049">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6710060">+</span>&nbsp;<span class="ident" id="6710062">ifi</span><span class="op" id="6710065">.</span><span class="ident" id="6710066">Name</span><span class="op" id="6710070">,</span>&nbsp;<span class="op" id="6710072">&amp;</span><span class="ident" id="6710073">IPAddr</span><span class="op" id="6710079">{</span><span class="ident" id="6710080">IP</span><span class="op" id="6710082">:</span>&nbsp;<span class="ident" id="6710084">ParseIP</span><span class="op" id="6710091">(</span><span class="string" id="6710092">&#34;fe80::1&#34;</span><span class="op" id="6710101">)</span><span class="op" id="6710102">,</span>&nbsp;<span class="ident" id="6710104">Zone</span><span class="op" id="6710108">:</span>&nbsp;<span class="ident" id="6710110">zoneToString</span><span class="op" id="6710122">(</span><span class="ident" id="6710123">ifi</span><span class="op" id="6710126">.</span><span class="ident" id="6710127">Index</span><span class="op" id="6710132">)</span><span class="op" id="6710133">}</span><span class="op" id="6710134">,</span>&nbsp;<span class="builtintype" id="6710136">nil</span><span class="op" id="6710139">}</span><span class="op" id="6710140">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710145">{</span><span class="string" id="6710146">&#34;ip6&#34;</span><span class="op" id="6710151">,</span>&nbsp;<span class="string" id="6710153">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6710164">+</span>&nbsp;<span class="ident" id="6710166">index</span><span class="op" id="6710171">,</span>&nbsp;<span class="op" id="6710173">&amp;</span><span class="ident" id="6710174">IPAddr</span><span class="op" id="6710180">{</span><span class="ident" id="6710181">IP</span><span class="op" id="6710183">:</span>&nbsp;<span class="ident" id="6710185">ParseIP</span><span class="op" id="6710192">(</span><span class="string" id="6710193">&#34;fe80::1&#34;</span><span class="op" id="6710202">)</span><span class="op" id="6710203">,</span>&nbsp;<span class="ident" id="6710205">Zone</span><span class="op" id="6710209">:</span>&nbsp;<span class="ident" id="6710211">index</span><span class="op" id="6710216">}</span><span class="op" id="6710217">,</span>&nbsp;<span class="builtintype" id="6710219">nil</span><span class="op" id="6710222">}</span><span class="op" id="6710223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710227">}</span><span class="op" id="6710228">...</span><span class="op" id="6710231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710237">if</span>&nbsp;<span class="ident" id="6710240">ips</span><span class="op" id="6710243">,</span>&nbsp;<span class="ident" id="6710245">err</span>&nbsp;<span class="op" id="6710249">:=</span>&nbsp;<span class="ident" id="6710252">LookupIP</span><span class="op" id="6710260">(</span><span class="string" id="6710261">&#34;localhost&#34;</span><span class="op" id="6710272">)</span><span class="op" id="6710273">;</span>&nbsp;<span class="ident" id="6710275">err</span>&nbsp;<span class="op" id="6710279">==</span>&nbsp;<span class="builtintype" id="6710282">nil</span>&nbsp;<span class="op" id="6710286">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6710289">len</span><span class="op" id="6710292">(</span><span class="ident" id="6710293">ips</span><span class="op" id="6710296">)</span>&nbsp;<span class="op" id="6710298">&gt;</span>&nbsp;<span class="num" id="6710300">1</span>&nbsp;<span class="op" id="6710302">&amp;&amp;</span>&nbsp;<span class="ident" id="6710305">supportsIPv4</span>&nbsp;<span class="op" id="6710318">&amp;&amp;</span>&nbsp;<span class="ident" id="6710321">supportsIPv6</span>&nbsp;<span class="op" id="6710334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6710338">resolveIPAddrTests</span>&nbsp;<span class="op" id="6710357">=</span>&nbsp;<span class="builtinfunc" id="6710359">append</span><span class="op" id="6710365">(</span><span class="ident" id="6710366">resolveIPAddrTests</span><span class="op" id="6710384">,</span>&nbsp;<span class="op" id="6710386">[</span><span class="op" id="6710387">]</span><span class="ident" id="6710388">resolveIPAddrTest</span><span class="op" id="6710405">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710410">{</span><span class="string" id="6710411">&#34;ip&#34;</span><span class="op" id="6710415">,</span>&nbsp;<span class="string" id="6710417">&#34;localhost&#34;</span><span class="op" id="6710428">,</span>&nbsp;<span class="op" id="6710430">&amp;</span><span class="ident" id="6710431">IPAddr</span><span class="op" id="6710437">{</span><span class="ident" id="6710438">IP</span><span class="op" id="6710440">:</span>&nbsp;<span class="ident" id="6710442">IPv4</span><span class="op" id="6710446">(</span><span class="num" id="6710447">127</span><span class="op" id="6710450">,</span>&nbsp;<span class="num" id="6710452">0</span><span class="op" id="6710453">,</span>&nbsp;<span class="num" id="6710455">0</span><span class="op" id="6710456">,</span>&nbsp;<span class="num" id="6710458">1</span><span class="op" id="6710459">)</span><span class="op" id="6710460">}</span><span class="op" id="6710461">,</span>&nbsp;<span class="builtintype" id="6710463">nil</span><span class="op" id="6710466">}</span><span class="op" id="6710467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710472">{</span><span class="string" id="6710473">&#34;ip4&#34;</span><span class="op" id="6710478">,</span>&nbsp;<span class="string" id="6710480">&#34;localhost&#34;</span><span class="op" id="6710491">,</span>&nbsp;<span class="op" id="6710493">&amp;</span><span class="ident" id="6710494">IPAddr</span><span class="op" id="6710500">{</span><span class="ident" id="6710501">IP</span><span class="op" id="6710503">:</span>&nbsp;<span class="ident" id="6710505">IPv4</span><span class="op" id="6710509">(</span><span class="num" id="6710510">127</span><span class="op" id="6710513">,</span>&nbsp;<span class="num" id="6710515">0</span><span class="op" id="6710516">,</span>&nbsp;<span class="num" id="6710518">0</span><span class="op" id="6710519">,</span>&nbsp;<span class="num" id="6710521">1</span><span class="op" id="6710522">)</span><span class="op" id="6710523">}</span><span class="op" id="6710524">,</span>&nbsp;<span class="builtintype" id="6710526">nil</span><span class="op" id="6710529">}</span><span class="op" id="6710530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710535">{</span><span class="string" id="6710536">&#34;ip6&#34;</span><span class="op" id="6710541">,</span>&nbsp;<span class="string" id="6710543">&#34;localhost&#34;</span><span class="op" id="6710554">,</span>&nbsp;<span class="op" id="6710556">&amp;</span><span class="ident" id="6710557">IPAddr</span><span class="op" id="6710563">{</span><span class="ident" id="6710564">IP</span><span class="op" id="6710566">:</span>&nbsp;<span class="ident" id="6710568">IPv6loopback</span><span class="op" id="6710580">}</span><span class="op" id="6710581">,</span>&nbsp;<span class="builtintype" id="6710583">nil</span><span class="op" id="6710586">}</span><span class="op" id="6710587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710591">}</span><span class="op" id="6710592">...</span><span class="op" id="6710595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710598">}</span><br>
<span class="lineno">60</span><span class="op" id="6710600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6710603">func</span>&nbsp;<span class="ident" id="6710608">skipRawSocketTest</span><span class="op" id="6710625">(</span><span class="ident" id="6710626">t</span>&nbsp;<span class="op" id="6710628">*</span><span class="ident" id="6710629">testing</span><span class="op" id="6710636">.</span><span class="ident" id="6710637">T</span><span class="op" id="6710638">)</span>&nbsp;<span class="op" id="6710640">(</span><span class="ident" id="6710641">skip</span>&nbsp;<span class="builtintype" id="6710646">bool</span><span class="op" id="6710650">,</span>&nbsp;<span class="ident" id="6710652">skipmsg</span>&nbsp;<span class="builtintype" id="6710660">string</span><span class="op" id="6710666">)</span>&nbsp;<span class="op" id="6710668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6710671">skip</span><span class="op" id="6710675">,</span>&nbsp;<span class="ident" id="6710677">skipmsg</span><span class="op" id="6710684">,</span>&nbsp;<span class="ident" id="6710686">err</span>&nbsp;<span class="op" id="6710690">:=</span>&nbsp;<span class="ident" id="6710693">skipRawSocketTests</span><span class="op" id="6710711">(</span><span class="op" id="6710712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710715">if</span>&nbsp;<span class="ident" id="6710718">err</span>&nbsp;<span class="op" id="6710722">!=</span>&nbsp;<span class="builtintype" id="6710725">nil</span>&nbsp;<span class="op" id="6710729">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6710733">t</span><span class="op" id="6710734">.</span><span class="ident" id="6710735">Fatal</span><span class="op" id="6710740">(</span><span class="ident" id="6710741">err</span><span class="op" id="6710744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710750">return</span>&nbsp;<span class="ident" id="6710757">skip</span><span class="op" id="6710761">,</span>&nbsp;<span class="ident" id="6710763">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="6710771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6710774">func</span>&nbsp;<span class="ident" id="6710779">TestResolveIPAddr</span><span class="op" id="6710796">(</span><span class="ident" id="6710797">t</span>&nbsp;<span class="op" id="6710799">*</span><span class="ident" id="6710800">testing</span><span class="op" id="6710807">.</span><span class="ident" id="6710808">T</span><span class="op" id="6710809">)</span>&nbsp;<span class="op" id="6710811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710814">switch</span>&nbsp;<span class="ident" id="6710821">runtime</span><span class="op" id="6710828">.</span><span class="ident" id="6710829">GOOS</span>&nbsp;<span class="op" id="6710834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710837">case</span>&nbsp;<span class="string" id="6710842">&#34;nacl&#34;</span><span class="op" id="6710848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6710852">t</span><span class="op" id="6710853">.</span><span class="ident" id="6710854">Skipf</span><span class="op" id="6710859">(</span><span class="string" id="6710860">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6710881">,</span>&nbsp;<span class="ident" id="6710883">runtime</span><span class="op" id="6710890">.</span><span class="ident" id="6710891">GOOS</span><span class="op" id="6710895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6710898">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710902">for</span>&nbsp;<span class="ident" id="6710906">_</span><span class="op" id="6710907">,</span>&nbsp;<span class="ident" id="6710909">tt</span>&nbsp;<span class="op" id="6710912">:=</span>&nbsp;<span class="keyword" id="6710915">range</span>&nbsp;<span class="ident" id="6710921">resolveIPAddrTests</span>&nbsp;<span class="op" id="6710940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6710944">addr</span><span class="op" id="6710948">,</span>&nbsp;<span class="ident" id="6710950">err</span>&nbsp;<span class="op" id="6710954">:=</span>&nbsp;<span class="ident" id="6710957">ResolveIPAddr</span><span class="op" id="6710970">(</span><span class="ident" id="6710971">tt</span><span class="op" id="6710973">.</span><span class="ident" id="6710974">net</span><span class="op" id="6710977">,</span>&nbsp;<span class="ident" id="6710979">tt</span><span class="op" id="6710981">.</span><span class="ident" id="6710982">litAddrOrName</span><span class="op" id="6710995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6710999">if</span>&nbsp;<span class="ident" id="6711002">err</span>&nbsp;<span class="op" id="6711006">!=</span>&nbsp;<span class="ident" id="6711009">tt</span><span class="op" id="6711011">.</span><span class="ident" id="6711012">err</span>&nbsp;<span class="op" id="6711016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711021">t</span><span class="op" id="6711022">.</span><span class="ident" id="6711023">Fatalf</span><span class="op" id="6711029">(</span><span class="string" id="6711030">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6711064">,</span>&nbsp;<span class="ident" id="6711066">tt</span><span class="op" id="6711068">.</span><span class="ident" id="6711069">net</span><span class="op" id="6711072">,</span>&nbsp;<span class="ident" id="6711074">tt</span><span class="op" id="6711076">.</span><span class="ident" id="6711077">litAddrOrName</span><span class="op" id="6711090">,</span>&nbsp;<span class="ident" id="6711092">err</span><span class="op" id="6711095">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711099">}</span>&nbsp;<span class="keyword" id="6711101">else</span>&nbsp;<span class="keyword" id="6711106">if</span>&nbsp;<span class="op" id="6711109">!</span><span class="ident" id="6711110">reflect</span><span class="op" id="6711117">.</span><span class="ident" id="6711118">DeepEqual</span><span class="op" id="6711127">(</span><span class="ident" id="6711128">addr</span><span class="op" id="6711132">,</span>&nbsp;<span class="ident" id="6711134">tt</span><span class="op" id="6711136">.</span><span class="ident" id="6711137">addr</span><span class="op" id="6711141">)</span>&nbsp;<span class="op" id="6711143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711148">t</span><span class="op" id="6711149">.</span><span class="ident" id="6711150">Fatalf</span><span class="op" id="6711156">(</span><span class="string" id="6711157">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6711180">,</span>&nbsp;<span class="ident" id="6711182">addr</span><span class="op" id="6711186">,</span>&nbsp;<span class="ident" id="6711188">tt</span><span class="op" id="6711190">.</span><span class="ident" id="6711191">addr</span><span class="op" id="6711195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711202">}</span><br>
<span class="lineno"></span><span class="op" id="6711204">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6711207">var</span>&nbsp;<span class="ident" id="6711211">icmpEchoTests</span>&nbsp;<span class="op" id="6711225">=</span>&nbsp;<span class="op" id="6711227">[</span><span class="op" id="6711228">]</span><span class="keyword" id="6711229">struct</span>&nbsp;<span class="op" id="6711236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711239">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6711245">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711253">laddr</span>&nbsp;<span class="builtintype" id="6711259">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711267">raddr</span>&nbsp;<span class="builtintype" id="6711273">string</span><br>
<span class="lineno">90</span><span class="op" id="6711280">}</span><span class="op" id="6711281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711284">{</span><span class="string" id="6711285">&#34;ip4:icmp&#34;</span><span class="op" id="6711295">,</span>&nbsp;<span class="string" id="6711297">&#34;0.0.0.0&#34;</span><span class="op" id="6711306">,</span>&nbsp;<span class="string" id="6711308">&#34;127.0.0.1&#34;</span><span class="op" id="6711319">}</span><span class="op" id="6711320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711323">{</span><span class="string" id="6711324">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6711339">,</span>&nbsp;<span class="string" id="6711341">&#34;::&#34;</span><span class="op" id="6711345">,</span>&nbsp;<span class="string" id="6711347">&#34;::1&#34;</span><span class="op" id="6711352">}</span><span class="op" id="6711353">,</span><br>
<span class="lineno"></span><span class="op" id="6711355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6711358">func</span>&nbsp;<span class="ident" id="6711363">TestConnICMPEcho</span><span class="op" id="6711379">(</span><span class="ident" id="6711380">t</span>&nbsp;<span class="op" id="6711382">*</span><span class="ident" id="6711383">testing</span><span class="op" id="6711390">.</span><span class="ident" id="6711391">T</span><span class="op" id="6711392">)</span>&nbsp;<span class="op" id="6711394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711397">if</span>&nbsp;<span class="ident" id="6711400">skip</span><span class="op" id="6711404">,</span>&nbsp;<span class="ident" id="6711406">skipmsg</span>&nbsp;<span class="op" id="6711414">:=</span>&nbsp;<span class="ident" id="6711417">skipRawSocketTest</span><span class="op" id="6711434">(</span><span class="ident" id="6711435">t</span><span class="op" id="6711436">)</span><span class="op" id="6711437">;</span>&nbsp;<span class="ident" id="6711439">skip</span>&nbsp;<span class="op" id="6711444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711448">t</span><span class="op" id="6711449">.</span><span class="ident" id="6711450">Skip</span><span class="op" id="6711454">(</span><span class="ident" id="6711455">skipmsg</span><span class="op" id="6711462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711469">for</span>&nbsp;<span class="ident" id="6711473">i</span><span class="op" id="6711474">,</span>&nbsp;<span class="ident" id="6711476">tt</span>&nbsp;<span class="op" id="6711479">:=</span>&nbsp;<span class="keyword" id="6711482">range</span>&nbsp;<span class="ident" id="6711488">icmpEchoTests</span>&nbsp;<span class="op" id="6711502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711506">net</span><span class="op" id="6711509">,</span>&nbsp;<span class="ident" id="6711511">_</span><span class="op" id="6711512">,</span>&nbsp;<span class="ident" id="6711514">err</span>&nbsp;<span class="op" id="6711518">:=</span>&nbsp;<span class="ident" id="6711521">parseNetwork</span><span class="op" id="6711533">(</span><span class="ident" id="6711534">tt</span><span class="op" id="6711536">.</span><span class="ident" id="6711537">net</span><span class="op" id="6711540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711544">if</span>&nbsp;<span class="ident" id="6711547">err</span>&nbsp;<span class="op" id="6711551">!=</span>&nbsp;<span class="builtintype" id="6711554">nil</span>&nbsp;<span class="op" id="6711558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711563">t</span><span class="op" id="6711564">.</span><span class="ident" id="6711565">Fatalf</span><span class="op" id="6711571">(</span><span class="string" id="6711572">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6711597">,</span>&nbsp;<span class="ident" id="6711599">err</span><span class="op" id="6711602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711606">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711610">if</span>&nbsp;<span class="ident" id="6711613">net</span>&nbsp;<span class="op" id="6711617">==</span>&nbsp;<span class="string" id="6711620">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6711626">&amp;&amp;</span>&nbsp;<span class="op" id="6711629">!</span><span class="ident" id="6711630">supportsIPv6</span>&nbsp;<span class="op" id="6711643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711648">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711664">c</span><span class="op" id="6711665">,</span>&nbsp;<span class="ident" id="6711667">err</span>&nbsp;<span class="op" id="6711671">:=</span>&nbsp;<span class="ident" id="6711674">Dial</span><span class="op" id="6711678">(</span><span class="ident" id="6711679">tt</span><span class="op" id="6711681">.</span><span class="ident" id="6711682">net</span><span class="op" id="6711685">,</span>&nbsp;<span class="ident" id="6711687">tt</span><span class="op" id="6711689">.</span><span class="ident" id="6711690">raddr</span><span class="op" id="6711695">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711699">if</span>&nbsp;<span class="ident" id="6711702">err</span>&nbsp;<span class="op" id="6711706">!=</span>&nbsp;<span class="builtintype" id="6711709">nil</span>&nbsp;<span class="op" id="6711713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711718">t</span><span class="op" id="6711719">.</span><span class="ident" id="6711720">Fatalf</span><span class="op" id="6711726">(</span><span class="string" id="6711727">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6711744">,</span>&nbsp;<span class="ident" id="6711746">err</span><span class="op" id="6711749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711757">c</span><span class="op" id="6711758">.</span><span class="ident" id="6711759">SetDeadline</span><span class="op" id="6711770">(</span><span class="ident" id="6711771">time</span><span class="op" id="6711775">.</span><span class="ident" id="6711776">Now</span><span class="op" id="6711779">(</span><span class="op" id="6711780">)</span><span class="op" id="6711781">.</span><span class="ident" id="6711782">Add</span><span class="op" id="6711785">(</span><span class="num" id="6711786">100</span>&nbsp;<span class="op" id="6711790">*</span>&nbsp;<span class="ident" id="6711792">time</span><span class="op" id="6711796">.</span><span class="ident" id="6711797">Millisecond</span><span class="op" id="6711808">)</span><span class="op" id="6711809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711813">defer</span>&nbsp;<span class="ident" id="6711819">c</span><span class="op" id="6711820">.</span><span class="ident" id="6711821">Close</span><span class="op" id="6711826">(</span><span class="op" id="6711827">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711832">typ</span>&nbsp;<span class="op" id="6711836">:=</span>&nbsp;<span class="ident" id="6711839">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6711859">if</span>&nbsp;<span class="ident" id="6711862">net</span>&nbsp;<span class="op" id="6711866">==</span>&nbsp;<span class="string" id="6711869">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6711875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711880">typ</span>&nbsp;<span class="op" id="6711884">=</span>&nbsp;<span class="ident" id="6711886">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6711906">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711910">xid</span><span class="op" id="6711913">,</span>&nbsp;<span class="ident" id="6711915">xseq</span>&nbsp;<span class="op" id="6711920">:=</span>&nbsp;<span class="ident" id="6711923">os</span><span class="op" id="6711925">.</span><span class="ident" id="6711926">Getpid</span><span class="op" id="6711932">(</span><span class="op" id="6711933">)</span><span class="op" id="6711934">&amp;</span><span class="num" id="6711935">0xffff</span><span class="op" id="6711941">,</span>&nbsp;<span class="ident" id="6711943">i</span><span class="op" id="6711944">+</span><span class="num" id="6711945">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711949">wb</span><span class="op" id="6711951">,</span>&nbsp;<span class="ident" id="6711953">err</span>&nbsp;<span class="op" id="6711957">:=</span>&nbsp;<span class="op" id="6711960">(</span><span class="op" id="6711961">&amp;</span><span class="ident" id="6711962">icmpMessage</span><span class="op" id="6711973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6711978">Type</span><span class="op" id="6711982">:</span>&nbsp;<span class="ident" id="6711984">typ</span><span class="op" id="6711987">,</span>&nbsp;<span class="ident" id="6711989">Code</span><span class="op" id="6711993">:</span>&nbsp;<span class="num" id="6711995">0</span><span class="op" id="6711996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712001">Body</span><span class="op" id="6712005">:</span>&nbsp;<span class="op" id="6712007">&amp;</span><span class="ident" id="6712008">icmpEcho</span><span class="op" id="6712016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712022">ID</span><span class="op" id="6712024">:</span>&nbsp;<span class="ident" id="6712026">xid</span><span class="op" id="6712029">,</span>&nbsp;<span class="ident" id="6712031">Seq</span><span class="op" id="6712034">:</span>&nbsp;<span class="ident" id="6712036">xseq</span><span class="op" id="6712040">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712046">Data</span><span class="op" id="6712050">:</span>&nbsp;<span class="ident" id="6712052">bytes</span><span class="op" id="6712057">.</span><span class="ident" id="6712058">Repeat</span><span class="op" id="6712064">(</span><span class="op" id="6712065">[</span><span class="op" id="6712066">]</span><span class="builtintype" id="6712067">byte</span><span class="op" id="6712071">(</span><span class="string" id="6712072">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6712094">)</span><span class="op" id="6712095">,</span>&nbsp;<span class="num" id="6712097">3</span><span class="op" id="6712098">)</span><span class="op" id="6712099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712104">}</span><span class="op" id="6712105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712109">}</span><span class="op" id="6712110">)</span><span class="op" id="6712111">.</span><span class="ident" id="6712112">Marshal</span><span class="op" id="6712119">(</span><span class="op" id="6712120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712124">if</span>&nbsp;<span class="ident" id="6712127">err</span>&nbsp;<span class="op" id="6712131">!=</span>&nbsp;<span class="builtintype" id="6712134">nil</span>&nbsp;<span class="op" id="6712138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712143">t</span><span class="op" id="6712144">.</span><span class="ident" id="6712145">Fatalf</span><span class="op" id="6712151">(</span><span class="string" id="6712152">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6712184">,</span>&nbsp;<span class="ident" id="6712186">err</span><span class="op" id="6712189">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712197">if</span>&nbsp;<span class="ident" id="6712200">_</span><span class="op" id="6712201">,</span>&nbsp;<span class="ident" id="6712203">err</span>&nbsp;<span class="op" id="6712207">:=</span>&nbsp;<span class="ident" id="6712210">c</span><span class="op" id="6712211">.</span><span class="ident" id="6712212">Write</span><span class="op" id="6712217">(</span><span class="ident" id="6712218">wb</span><span class="op" id="6712220">)</span><span class="op" id="6712221">;</span>&nbsp;<span class="ident" id="6712223">err</span>&nbsp;<span class="op" id="6712227">!=</span>&nbsp;<span class="builtintype" id="6712230">nil</span>&nbsp;<span class="op" id="6712234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712239">t</span><span class="op" id="6712240">.</span><span class="ident" id="6712241">Fatalf</span><span class="op" id="6712247">(</span><span class="string" id="6712248">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6712271">,</span>&nbsp;<span class="ident" id="6712273">err</span><span class="op" id="6712276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712284">var</span>&nbsp;<span class="ident" id="6712288">m</span>&nbsp;<span class="op" id="6712290">*</span><span class="ident" id="6712291">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712305">rb</span>&nbsp;<span class="op" id="6712308">:=</span>&nbsp;<span class="builtinfunc" id="6712311">make</span><span class="op" id="6712315">(</span><span class="op" id="6712316">[</span><span class="op" id="6712317">]</span><span class="builtintype" id="6712318">byte</span><span class="op" id="6712322">,</span>&nbsp;<span class="num" id="6712324">20</span><span class="op" id="6712326">+</span><span class="builtinfunc" id="6712327">len</span><span class="op" id="6712330">(</span><span class="ident" id="6712331">wb</span><span class="op" id="6712333">)</span><span class="op" id="6712334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712338">for</span>&nbsp;<span class="op" id="6712342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712347">if</span>&nbsp;<span class="ident" id="6712350">_</span><span class="op" id="6712351">,</span>&nbsp;<span class="ident" id="6712353">err</span>&nbsp;<span class="op" id="6712357">:=</span>&nbsp;<span class="ident" id="6712360">c</span><span class="op" id="6712361">.</span><span class="ident" id="6712362">Read</span><span class="op" id="6712366">(</span><span class="ident" id="6712367">rb</span><span class="op" id="6712369">)</span><span class="op" id="6712370">;</span>&nbsp;<span class="ident" id="6712372">err</span>&nbsp;<span class="op" id="6712376">!=</span>&nbsp;<span class="builtintype" id="6712379">nil</span>&nbsp;<span class="op" id="6712383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712389">t</span><span class="op" id="6712390">.</span><span class="ident" id="6712391">Fatalf</span><span class="op" id="6712397">(</span><span class="string" id="6712398">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6712420">,</span>&nbsp;<span class="ident" id="6712422">err</span><span class="op" id="6712425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712430">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712435">if</span>&nbsp;<span class="ident" id="6712438">net</span>&nbsp;<span class="op" id="6712442">==</span>&nbsp;<span class="string" id="6712445">&#34;ip4&#34;</span>&nbsp;<span class="op" id="6712451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712457">rb</span>&nbsp;<span class="op" id="6712460">=</span>&nbsp;<span class="ident" id="6712462">ipv4Payload</span><span class="op" id="6712473">(</span><span class="ident" id="6712474">rb</span><span class="op" id="6712476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712486">if</span>&nbsp;<span class="ident" id="6712489">m</span><span class="op" id="6712490">,</span>&nbsp;<span class="ident" id="6712492">err</span>&nbsp;<span class="op" id="6712496">=</span>&nbsp;<span class="ident" id="6712498">parseICMPMessage</span><span class="op" id="6712514">(</span><span class="ident" id="6712515">rb</span><span class="op" id="6712517">)</span><span class="op" id="6712518">;</span>&nbsp;<span class="ident" id="6712520">err</span>&nbsp;<span class="op" id="6712524">!=</span>&nbsp;<span class="builtintype" id="6712527">nil</span>&nbsp;<span class="op" id="6712531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712537">t</span><span class="op" id="6712538">.</span><span class="ident" id="6712539">Fatalf</span><span class="op" id="6712545">(</span><span class="string" id="6712546">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6712575">,</span>&nbsp;<span class="ident" id="6712577">err</span><span class="op" id="6712580">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712590">switch</span>&nbsp;<span class="ident" id="6712597">m</span><span class="op" id="6712598">.</span><span class="ident" id="6712599">Type</span>&nbsp;<span class="op" id="6712604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712609">case</span>&nbsp;<span class="ident" id="6712614">icmpv4EchoRequest</span><span class="op" id="6712631">,</span>&nbsp;<span class="ident" id="6712633">icmpv6EchoRequest</span><span class="op" id="6712650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712656">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712668">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712673">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712685">switch</span>&nbsp;<span class="ident" id="6712692">p</span>&nbsp;<span class="op" id="6712694">:=</span>&nbsp;<span class="ident" id="6712697">m</span><span class="op" id="6712698">.</span><span class="ident" id="6712699">Body</span><span class="op" id="6712703">.</span><span class="op" id="6712704">(</span><span class="keyword" id="6712705">type</span><span class="op" id="6712709">)</span>&nbsp;<span class="op" id="6712711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712715">case</span>&nbsp;<span class="op" id="6712720">*</span><span class="ident" id="6712721">icmpEcho</span><span class="op" id="6712729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712734">if</span>&nbsp;<span class="ident" id="6712737">p</span><span class="op" id="6712738">.</span><span class="ident" id="6712739">ID</span>&nbsp;<span class="op" id="6712742">!=</span>&nbsp;<span class="ident" id="6712745">xid</span>&nbsp;<span class="op" id="6712749">||</span>&nbsp;<span class="ident" id="6712752">p</span><span class="op" id="6712753">.</span><span class="ident" id="6712754">Seq</span>&nbsp;<span class="op" id="6712758">!=</span>&nbsp;<span class="ident" id="6712761">xseq</span>&nbsp;<span class="op" id="6712766">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712772">t</span><span class="op" id="6712773">.</span><span class="ident" id="6712774">Fatalf</span><span class="op" id="6712780">(</span><span class="string" id="6712781">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6712830">,</span>&nbsp;<span class="ident" id="6712832">p</span><span class="op" id="6712833">.</span><span class="ident" id="6712834">ID</span><span class="op" id="6712836">,</span>&nbsp;<span class="ident" id="6712838">p</span><span class="op" id="6712839">.</span><span class="ident" id="6712840">Seq</span><span class="op" id="6712843">,</span>&nbsp;<span class="ident" id="6712845">xid</span><span class="op" id="6712848">,</span>&nbsp;<span class="ident" id="6712850">xseq</span><span class="op" id="6712854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6712863">default</span><span class="op" id="6712870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6712875">t</span><span class="op" id="6712876">.</span><span class="ident" id="6712877">Fatalf</span><span class="op" id="6712883">(</span><span class="string" id="6712884">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6712933">,</span>&nbsp;<span class="ident" id="6712935">m</span><span class="op" id="6712936">.</span><span class="ident" id="6712937">Type</span><span class="op" id="6712941">,</span>&nbsp;<span class="ident" id="6712943">m</span><span class="op" id="6712944">.</span><span class="ident" id="6712945">Code</span><span class="op" id="6712949">,</span>&nbsp;<span class="ident" id="6712951">typ</span><span class="op" id="6712954">,</span>&nbsp;<span class="num" id="6712956">0</span><span class="op" id="6712957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712961">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6712964">}</span><br>
<span class="lineno"></span><span class="op" id="6712966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712969">func</span>&nbsp;<span class="ident" id="6712974">TestPacketConnICMPEcho</span><span class="op" id="6712996">(</span><span class="ident" id="6712997">t</span>&nbsp;<span class="op" id="6712999">*</span><span class="ident" id="6713000">testing</span><span class="op" id="6713007">.</span><span class="ident" id="6713008">T</span><span class="op" id="6713009">)</span>&nbsp;<span class="op" id="6713011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713014">if</span>&nbsp;<span class="ident" id="6713017">skip</span><span class="op" id="6713021">,</span>&nbsp;<span class="ident" id="6713023">skipmsg</span>&nbsp;<span class="op" id="6713031">:=</span>&nbsp;<span class="ident" id="6713034">skipRawSocketTest</span><span class="op" id="6713051">(</span><span class="ident" id="6713052">t</span><span class="op" id="6713053">)</span><span class="op" id="6713054">;</span>&nbsp;<span class="ident" id="6713056">skip</span>&nbsp;<span class="op" id="6713061">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713065">t</span><span class="op" id="6713066">.</span><span class="ident" id="6713067">Skip</span><span class="op" id="6713071">(</span><span class="ident" id="6713072">skipmsg</span><span class="op" id="6713079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713086">for</span>&nbsp;<span class="ident" id="6713090">i</span><span class="op" id="6713091">,</span>&nbsp;<span class="ident" id="6713093">tt</span>&nbsp;<span class="op" id="6713096">:=</span>&nbsp;<span class="keyword" id="6713099">range</span>&nbsp;<span class="ident" id="6713105">icmpEchoTests</span>&nbsp;<span class="op" id="6713119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713123">net</span><span class="op" id="6713126">,</span>&nbsp;<span class="ident" id="6713128">_</span><span class="op" id="6713129">,</span>&nbsp;<span class="ident" id="6713131">err</span>&nbsp;<span class="op" id="6713135">:=</span>&nbsp;<span class="ident" id="6713138">parseNetwork</span><span class="op" id="6713150">(</span><span class="ident" id="6713151">tt</span><span class="op" id="6713153">.</span><span class="ident" id="6713154">net</span><span class="op" id="6713157">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713161">if</span>&nbsp;<span class="ident" id="6713164">err</span>&nbsp;<span class="op" id="6713168">!=</span>&nbsp;<span class="builtintype" id="6713171">nil</span>&nbsp;<span class="op" id="6713175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713180">t</span><span class="op" id="6713181">.</span><span class="ident" id="6713182">Fatalf</span><span class="op" id="6713188">(</span><span class="string" id="6713189">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6713214">,</span>&nbsp;<span class="ident" id="6713216">err</span><span class="op" id="6713219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713227">if</span>&nbsp;<span class="ident" id="6713230">net</span>&nbsp;<span class="op" id="6713234">==</span>&nbsp;<span class="string" id="6713237">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6713243">&amp;&amp;</span>&nbsp;<span class="op" id="6713246">!</span><span class="ident" id="6713247">supportsIPv6</span>&nbsp;<span class="op" id="6713260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713265">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713281">c</span><span class="op" id="6713282">,</span>&nbsp;<span class="ident" id="6713284">err</span>&nbsp;<span class="op" id="6713288">:=</span>&nbsp;<span class="ident" id="6713291">ListenPacket</span><span class="op" id="6713303">(</span><span class="ident" id="6713304">tt</span><span class="op" id="6713306">.</span><span class="ident" id="6713307">net</span><span class="op" id="6713310">,</span>&nbsp;<span class="ident" id="6713312">tt</span><span class="op" id="6713314">.</span><span class="ident" id="6713315">laddr</span><span class="op" id="6713320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713324">if</span>&nbsp;<span class="ident" id="6713327">err</span>&nbsp;<span class="op" id="6713331">!=</span>&nbsp;<span class="builtintype" id="6713334">nil</span>&nbsp;<span class="op" id="6713338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713343">t</span><span class="op" id="6713344">.</span><span class="ident" id="6713345">Fatalf</span><span class="op" id="6713351">(</span><span class="string" id="6713352">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6713377">,</span>&nbsp;<span class="ident" id="6713379">err</span><span class="op" id="6713382">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713390">c</span><span class="op" id="6713391">.</span><span class="ident" id="6713392">SetDeadline</span><span class="op" id="6713403">(</span><span class="ident" id="6713404">time</span><span class="op" id="6713408">.</span><span class="ident" id="6713409">Now</span><span class="op" id="6713412">(</span><span class="op" id="6713413">)</span><span class="op" id="6713414">.</span><span class="ident" id="6713415">Add</span><span class="op" id="6713418">(</span><span class="num" id="6713419">100</span>&nbsp;<span class="op" id="6713423">*</span>&nbsp;<span class="ident" id="6713425">time</span><span class="op" id="6713429">.</span><span class="ident" id="6713430">Millisecond</span><span class="op" id="6713441">)</span><span class="op" id="6713442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713446">defer</span>&nbsp;<span class="ident" id="6713452">c</span><span class="op" id="6713453">.</span><span class="ident" id="6713454">Close</span><span class="op" id="6713459">(</span><span class="op" id="6713460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713465">ra</span><span class="op" id="6713467">,</span>&nbsp;<span class="ident" id="6713469">err</span>&nbsp;<span class="op" id="6713473">:=</span>&nbsp;<span class="ident" id="6713476">ResolveIPAddr</span><span class="op" id="6713489">(</span><span class="ident" id="6713490">tt</span><span class="op" id="6713492">.</span><span class="ident" id="6713493">net</span><span class="op" id="6713496">,</span>&nbsp;<span class="ident" id="6713498">tt</span><span class="op" id="6713500">.</span><span class="ident" id="6713501">raddr</span><span class="op" id="6713506">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713510">if</span>&nbsp;<span class="ident" id="6713513">err</span>&nbsp;<span class="op" id="6713517">!=</span>&nbsp;<span class="builtintype" id="6713520">nil</span>&nbsp;<span class="op" id="6713524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713529">t</span><span class="op" id="6713530">.</span><span class="ident" id="6713531">Fatalf</span><span class="op" id="6713537">(</span><span class="string" id="6713538">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6713564">,</span>&nbsp;<span class="ident" id="6713566">err</span><span class="op" id="6713569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713577">typ</span>&nbsp;<span class="op" id="6713581">:=</span>&nbsp;<span class="ident" id="6713584">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713604">if</span>&nbsp;<span class="ident" id="6713607">net</span>&nbsp;<span class="op" id="6713611">==</span>&nbsp;<span class="string" id="6713614">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6713620">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713625">typ</span>&nbsp;<span class="op" id="6713629">=</span>&nbsp;<span class="ident" id="6713631">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713655">xid</span><span class="op" id="6713658">,</span>&nbsp;<span class="ident" id="6713660">xseq</span>&nbsp;<span class="op" id="6713665">:=</span>&nbsp;<span class="ident" id="6713668">os</span><span class="op" id="6713670">.</span><span class="ident" id="6713671">Getpid</span><span class="op" id="6713677">(</span><span class="op" id="6713678">)</span><span class="op" id="6713679">&amp;</span><span class="num" id="6713680">0xffff</span><span class="op" id="6713686">,</span>&nbsp;<span class="ident" id="6713688">i</span><span class="op" id="6713689">+</span><span class="num" id="6713690">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713694">wb</span><span class="op" id="6713696">,</span>&nbsp;<span class="ident" id="6713698">err</span>&nbsp;<span class="op" id="6713702">:=</span>&nbsp;<span class="op" id="6713705">(</span><span class="op" id="6713706">&amp;</span><span class="ident" id="6713707">icmpMessage</span><span class="op" id="6713718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713723">Type</span><span class="op" id="6713727">:</span>&nbsp;<span class="ident" id="6713729">typ</span><span class="op" id="6713732">,</span>&nbsp;<span class="ident" id="6713734">Code</span><span class="op" id="6713738">:</span>&nbsp;<span class="num" id="6713740">0</span><span class="op" id="6713741">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713746">Body</span><span class="op" id="6713750">:</span>&nbsp;<span class="op" id="6713752">&amp;</span><span class="ident" id="6713753">icmpEcho</span><span class="op" id="6713761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713767">ID</span><span class="op" id="6713769">:</span>&nbsp;<span class="ident" id="6713771">xid</span><span class="op" id="6713774">,</span>&nbsp;<span class="ident" id="6713776">Seq</span><span class="op" id="6713779">:</span>&nbsp;<span class="ident" id="6713781">xseq</span><span class="op" id="6713785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713791">Data</span><span class="op" id="6713795">:</span>&nbsp;<span class="ident" id="6713797">bytes</span><span class="op" id="6713802">.</span><span class="ident" id="6713803">Repeat</span><span class="op" id="6713809">(</span><span class="op" id="6713810">[</span><span class="op" id="6713811">]</span><span class="builtintype" id="6713812">byte</span><span class="op" id="6713816">(</span><span class="string" id="6713817">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6713839">)</span><span class="op" id="6713840">,</span>&nbsp;<span class="num" id="6713842">3</span><span class="op" id="6713843">)</span><span class="op" id="6713844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713849">}</span><span class="op" id="6713850">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713854">}</span><span class="op" id="6713855">)</span><span class="op" id="6713856">.</span><span class="ident" id="6713857">Marshal</span><span class="op" id="6713864">(</span><span class="op" id="6713865">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713869">if</span>&nbsp;<span class="ident" id="6713872">err</span>&nbsp;<span class="op" id="6713876">!=</span>&nbsp;<span class="builtintype" id="6713879">nil</span>&nbsp;<span class="op" id="6713883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713888">t</span><span class="op" id="6713889">.</span><span class="ident" id="6713890">Fatalf</span><span class="op" id="6713896">(</span><span class="string" id="6713897">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6713929">,</span>&nbsp;<span class="ident" id="6713931">err</span><span class="op" id="6713934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6713938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6713942">if</span>&nbsp;<span class="ident" id="6713945">_</span><span class="op" id="6713946">,</span>&nbsp;<span class="ident" id="6713948">err</span>&nbsp;<span class="op" id="6713952">:=</span>&nbsp;<span class="ident" id="6713955">c</span><span class="op" id="6713956">.</span><span class="ident" id="6713957">WriteTo</span><span class="op" id="6713964">(</span><span class="ident" id="6713965">wb</span><span class="op" id="6713967">,</span>&nbsp;<span class="ident" id="6713969">ra</span><span class="op" id="6713971">)</span><span class="op" id="6713972">;</span>&nbsp;<span class="ident" id="6713974">err</span>&nbsp;<span class="op" id="6713978">!=</span>&nbsp;<span class="builtintype" id="6713981">nil</span>&nbsp;<span class="op" id="6713985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6713990">t</span><span class="op" id="6713991">.</span><span class="ident" id="6713992">Fatalf</span><span class="op" id="6713998">(</span><span class="string" id="6713999">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6714030">,</span>&nbsp;<span class="ident" id="6714032">err</span><span class="op" id="6714035">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714043">var</span>&nbsp;<span class="ident" id="6714047">m</span>&nbsp;<span class="op" id="6714049">*</span><span class="ident" id="6714050">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714064">rb</span>&nbsp;<span class="op" id="6714067">:=</span>&nbsp;<span class="builtinfunc" id="6714070">make</span><span class="op" id="6714074">(</span><span class="op" id="6714075">[</span><span class="op" id="6714076">]</span><span class="builtintype" id="6714077">byte</span><span class="op" id="6714081">,</span>&nbsp;<span class="num" id="6714083">20</span><span class="op" id="6714085">+</span><span class="builtinfunc" id="6714086">len</span><span class="op" id="6714089">(</span><span class="ident" id="6714090">wb</span><span class="op" id="6714092">)</span><span class="op" id="6714093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714097">for</span>&nbsp;<span class="op" id="6714101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714106">if</span>&nbsp;<span class="ident" id="6714109">_</span><span class="op" id="6714110">,</span>&nbsp;<span class="ident" id="6714112">_</span><span class="op" id="6714113">,</span>&nbsp;<span class="ident" id="6714115">err</span>&nbsp;<span class="op" id="6714119">:=</span>&nbsp;<span class="ident" id="6714122">c</span><span class="op" id="6714123">.</span><span class="ident" id="6714124">ReadFrom</span><span class="op" id="6714132">(</span><span class="ident" id="6714133">rb</span><span class="op" id="6714135">)</span><span class="op" id="6714136">;</span>&nbsp;<span class="ident" id="6714138">err</span>&nbsp;<span class="op" id="6714142">!=</span>&nbsp;<span class="builtintype" id="6714145">nil</span>&nbsp;<span class="op" id="6714149">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714155">t</span><span class="op" id="6714156">.</span><span class="ident" id="6714157">Fatalf</span><span class="op" id="6714163">(</span><span class="string" id="6714164">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6714196">,</span>&nbsp;<span class="ident" id="6714198">err</span><span class="op" id="6714201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6714211">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6714234">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6714257">//&nbsp;&nbsp;&nbsp;&nbsp;rb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6714284">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714291">if</span>&nbsp;<span class="ident" id="6714294">m</span><span class="op" id="6714295">,</span>&nbsp;<span class="ident" id="6714297">err</span>&nbsp;<span class="op" id="6714301">=</span>&nbsp;<span class="ident" id="6714303">parseICMPMessage</span><span class="op" id="6714319">(</span><span class="ident" id="6714320">rb</span><span class="op" id="6714322">)</span><span class="op" id="6714323">;</span>&nbsp;<span class="ident" id="6714325">err</span>&nbsp;<span class="op" id="6714329">!=</span>&nbsp;<span class="builtintype" id="6714332">nil</span>&nbsp;<span class="op" id="6714336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714342">t</span><span class="op" id="6714343">.</span><span class="ident" id="6714344">Fatalf</span><span class="op" id="6714350">(</span><span class="string" id="6714351">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6714380">,</span>&nbsp;<span class="ident" id="6714382">err</span><span class="op" id="6714385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714395">switch</span>&nbsp;<span class="ident" id="6714402">m</span><span class="op" id="6714403">.</span><span class="ident" id="6714404">Type</span>&nbsp;<span class="op" id="6714409">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714414">case</span>&nbsp;<span class="ident" id="6714419">icmpv4EchoRequest</span><span class="op" id="6714436">,</span>&nbsp;<span class="ident" id="6714438">icmpv6EchoRequest</span><span class="op" id="6714455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714461">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714478">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714486">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714490">switch</span>&nbsp;<span class="ident" id="6714497">p</span>&nbsp;<span class="op" id="6714499">:=</span>&nbsp;<span class="ident" id="6714502">m</span><span class="op" id="6714503">.</span><span class="ident" id="6714504">Body</span><span class="op" id="6714508">.</span><span class="op" id="6714509">(</span><span class="keyword" id="6714510">type</span><span class="op" id="6714514">)</span>&nbsp;<span class="op" id="6714516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714520">case</span>&nbsp;<span class="op" id="6714525">*</span><span class="ident" id="6714526">icmpEcho</span><span class="op" id="6714534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714539">if</span>&nbsp;<span class="ident" id="6714542">p</span><span class="op" id="6714543">.</span><span class="ident" id="6714544">ID</span>&nbsp;<span class="op" id="6714547">!=</span>&nbsp;<span class="ident" id="6714550">xid</span>&nbsp;<span class="op" id="6714554">||</span>&nbsp;<span class="ident" id="6714557">p</span><span class="op" id="6714558">.</span><span class="ident" id="6714559">Seq</span>&nbsp;<span class="op" id="6714563">!=</span>&nbsp;<span class="ident" id="6714566">xseq</span>&nbsp;<span class="op" id="6714571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714577">t</span><span class="op" id="6714578">.</span><span class="ident" id="6714579">Fatalf</span><span class="op" id="6714585">(</span><span class="string" id="6714586">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6714635">,</span>&nbsp;<span class="ident" id="6714637">p</span><span class="op" id="6714638">.</span><span class="ident" id="6714639">ID</span><span class="op" id="6714641">,</span>&nbsp;<span class="ident" id="6714643">p</span><span class="op" id="6714644">.</span><span class="ident" id="6714645">Seq</span><span class="op" id="6714648">,</span>&nbsp;<span class="ident" id="6714650">xid</span><span class="op" id="6714653">,</span>&nbsp;<span class="ident" id="6714655">xseq</span><span class="op" id="6714659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714664">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714668">default</span><span class="op" id="6714675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714680">t</span><span class="op" id="6714681">.</span><span class="ident" id="6714682">Fatalf</span><span class="op" id="6714688">(</span><span class="string" id="6714689">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6714738">,</span>&nbsp;<span class="ident" id="6714740">m</span><span class="op" id="6714741">.</span><span class="ident" id="6714742">Type</span><span class="op" id="6714746">,</span>&nbsp;<span class="ident" id="6714748">m</span><span class="op" id="6714749">.</span><span class="ident" id="6714750">Code</span><span class="op" id="6714754">,</span>&nbsp;<span class="ident" id="6714756">typ</span><span class="op" id="6714759">,</span>&nbsp;<span class="num" id="6714761">0</span><span class="op" id="6714762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714769">}</span><br>
<span class="lineno"></span><span class="op" id="6714771">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="6714774">func</span>&nbsp;<span class="ident" id="6714779">ipv4Payload</span><span class="op" id="6714790">(</span><span class="ident" id="6714791">b</span>&nbsp;<span class="op" id="6714793">[</span><span class="op" id="6714794">]</span><span class="builtintype" id="6714795">byte</span><span class="op" id="6714799">)</span>&nbsp;<span class="op" id="6714801">[</span><span class="op" id="6714802">]</span><span class="builtintype" id="6714803">byte</span>&nbsp;<span class="op" id="6714808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714811">if</span>&nbsp;<span class="builtinfunc" id="6714814">len</span><span class="op" id="6714817">(</span><span class="ident" id="6714818">b</span><span class="op" id="6714819">)</span>&nbsp;<span class="op" id="6714821">&lt;</span>&nbsp;<span class="num" id="6714823">20</span>&nbsp;<span class="op" id="6714826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714830">return</span>&nbsp;<span class="ident" id="6714837">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714840">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714843">hdrlen</span>&nbsp;<span class="op" id="6714850">:=</span>&nbsp;<span class="builtintype" id="6714853">int</span><span class="op" id="6714856">(</span><span class="ident" id="6714857">b</span><span class="op" id="6714858">[</span><span class="num" id="6714859">0</span><span class="op" id="6714860">]</span><span class="op" id="6714861">&amp;</span><span class="num" id="6714862">0x0f</span><span class="op" id="6714866">)</span>&nbsp;<span class="op" id="6714868">&lt;&lt;</span>&nbsp;<span class="num" id="6714871">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6714874">return</span>&nbsp;<span class="ident" id="6714881">b</span><span class="op" id="6714882">[</span><span class="ident" id="6714883">hdrlen</span><span class="op" id="6714889">:</span><span class="op" id="6714890">]</span><br>
<span class="lineno"></span><span class="op" id="6714892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6714895">var</span>&nbsp;<span class="ident" id="6714899">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6714920">=</span>&nbsp;<span class="op" id="6714922">[</span><span class="op" id="6714923">]</span><span class="keyword" id="6714924">struct</span>&nbsp;<span class="op" id="6714931">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714934">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6714940">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6714948">laddr</span>&nbsp;<span class="op" id="6714954">*</span><span class="ident" id="6714955">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="6714962">}</span><span class="op" id="6714963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6714966">{</span><span class="string" id="6714967">&#34;ip4:icmp&#34;</span><span class="op" id="6714977">,</span>&nbsp;<span class="op" id="6714979">&amp;</span><span class="ident" id="6714980">IPAddr</span><span class="op" id="6714986">{</span><span class="ident" id="6714987">IP</span><span class="op" id="6714989">:</span>&nbsp;<span class="ident" id="6714991">IPv4</span><span class="op" id="6714995">(</span><span class="num" id="6714996">127</span><span class="op" id="6714999">,</span>&nbsp;<span class="num" id="6715001">0</span><span class="op" id="6715002">,</span>&nbsp;<span class="num" id="6715004">0</span><span class="op" id="6715005">,</span>&nbsp;<span class="num" id="6715007">1</span><span class="op" id="6715008">)</span><span class="op" id="6715009">}</span><span class="op" id="6715010">}</span><span class="op" id="6715011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715014">{</span><span class="string" id="6715015">&#34;ip4:icmp&#34;</span><span class="op" id="6715025">,</span>&nbsp;<span class="op" id="6715027">&amp;</span><span class="ident" id="6715028">IPAddr</span><span class="op" id="6715034">{</span><span class="op" id="6715035">}</span><span class="op" id="6715036">}</span><span class="op" id="6715037">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715040">{</span><span class="string" id="6715041">&#34;ip4:icmp&#34;</span><span class="op" id="6715051">,</span>&nbsp;<span class="builtintype" id="6715053">nil</span><span class="op" id="6715056">}</span><span class="op" id="6715057">,</span><br>
<span class="lineno"></span><span class="op" id="6715059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715062">func</span>&nbsp;<span class="ident" id="6715067">TestIPConnLocalName</span><span class="op" id="6715086">(</span><span class="ident" id="6715087">t</span>&nbsp;<span class="op" id="6715089">*</span><span class="ident" id="6715090">testing</span><span class="op" id="6715097">.</span><span class="ident" id="6715098">T</span><span class="op" id="6715099">)</span>&nbsp;<span class="op" id="6715101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715104">switch</span>&nbsp;<span class="ident" id="6715111">runtime</span><span class="op" id="6715118">.</span><span class="ident" id="6715119">GOOS</span>&nbsp;<span class="op" id="6715124">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715127">case</span>&nbsp;<span class="string" id="6715132">&#34;nacl&#34;</span><span class="op" id="6715138">,</span>&nbsp;<span class="string" id="6715140">&#34;plan9&#34;</span><span class="op" id="6715147">,</span>&nbsp;<span class="string" id="6715149">&#34;windows&#34;</span><span class="op" id="6715158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715162">t</span><span class="op" id="6715163">.</span><span class="ident" id="6715164">Skipf</span><span class="op" id="6715169">(</span><span class="string" id="6715170">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6715191">,</span>&nbsp;<span class="ident" id="6715193">runtime</span><span class="op" id="6715200">.</span><span class="ident" id="6715201">GOOS</span><span class="op" id="6715205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715208">default</span><span class="op" id="6715215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715219">if</span>&nbsp;<span class="ident" id="6715222">os</span><span class="op" id="6715224">.</span><span class="ident" id="6715225">Getuid</span><span class="op" id="6715231">(</span><span class="op" id="6715232">)</span>&nbsp;<span class="op" id="6715234">!=</span>&nbsp;<span class="num" id="6715237">0</span>&nbsp;<span class="op" id="6715239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715244">t</span><span class="op" id="6715245">.</span><span class="ident" id="6715246">Skip</span><span class="op" id="6715250">(</span><span class="string" id="6715251">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6715280">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715291">for</span>&nbsp;<span class="ident" id="6715295">_</span><span class="op" id="6715296">,</span>&nbsp;<span class="ident" id="6715298">tt</span>&nbsp;<span class="op" id="6715301">:=</span>&nbsp;<span class="keyword" id="6715304">range</span>&nbsp;<span class="ident" id="6715310">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6715331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715335">c</span><span class="op" id="6715336">,</span>&nbsp;<span class="ident" id="6715338">err</span>&nbsp;<span class="op" id="6715342">:=</span>&nbsp;<span class="ident" id="6715345">ListenIP</span><span class="op" id="6715353">(</span><span class="ident" id="6715354">tt</span><span class="op" id="6715356">.</span><span class="ident" id="6715357">net</span><span class="op" id="6715360">,</span>&nbsp;<span class="ident" id="6715362">tt</span><span class="op" id="6715364">.</span><span class="ident" id="6715365">laddr</span><span class="op" id="6715370">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715374">if</span>&nbsp;<span class="ident" id="6715377">err</span>&nbsp;<span class="op" id="6715381">!=</span>&nbsp;<span class="builtintype" id="6715384">nil</span>&nbsp;<span class="op" id="6715388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715393">t</span><span class="op" id="6715394">.</span><span class="ident" id="6715395">Fatalf</span><span class="op" id="6715401">(</span><span class="string" id="6715402">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6715423">,</span>&nbsp;<span class="ident" id="6715425">err</span><span class="op" id="6715428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715436">defer</span>&nbsp;<span class="ident" id="6715442">c</span><span class="op" id="6715443">.</span><span class="ident" id="6715444">Close</span><span class="op" id="6715449">(</span><span class="op" id="6715450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715454">if</span>&nbsp;<span class="ident" id="6715457">la</span>&nbsp;<span class="op" id="6715460">:=</span>&nbsp;<span class="ident" id="6715463">c</span><span class="op" id="6715464">.</span><span class="ident" id="6715465">LocalAddr</span><span class="op" id="6715474">(</span><span class="op" id="6715475">)</span><span class="op" id="6715476">;</span>&nbsp;<span class="ident" id="6715478">la</span>&nbsp;<span class="op" id="6715481">==</span>&nbsp;<span class="builtintype" id="6715484">nil</span>&nbsp;<span class="op" id="6715488">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715493">t</span><span class="op" id="6715494">.</span><span class="ident" id="6715495">Fatal</span><span class="op" id="6715500">(</span><span class="string" id="6715501">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="6715526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715533">}</span><br>
<span class="lineno"></span><span class="op" id="6715535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6715538">func</span>&nbsp;<span class="ident" id="6715543">TestIPConnRemoteName</span><span class="op" id="6715563">(</span><span class="ident" id="6715564">t</span>&nbsp;<span class="op" id="6715566">*</span><span class="ident" id="6715567">testing</span><span class="op" id="6715574">.</span><span class="ident" id="6715575">T</span><span class="op" id="6715576">)</span>&nbsp;<span class="op" id="6715578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715581">switch</span>&nbsp;<span class="ident" id="6715588">runtime</span><span class="op" id="6715595">.</span><span class="ident" id="6715596">GOOS</span>&nbsp;<span class="op" id="6715601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715604">case</span>&nbsp;<span class="string" id="6715609">&#34;plan9&#34;</span><span class="op" id="6715616">,</span>&nbsp;<span class="string" id="6715618">&#34;windows&#34;</span><span class="op" id="6715627">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715631">t</span><span class="op" id="6715632">.</span><span class="ident" id="6715633">Skipf</span><span class="op" id="6715638">(</span><span class="string" id="6715639">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6715660">,</span>&nbsp;<span class="ident" id="6715662">runtime</span><span class="op" id="6715669">.</span><span class="ident" id="6715670">GOOS</span><span class="op" id="6715674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715677">default</span><span class="op" id="6715684">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715688">if</span>&nbsp;<span class="ident" id="6715691">os</span><span class="op" id="6715693">.</span><span class="ident" id="6715694">Getuid</span><span class="op" id="6715700">(</span><span class="op" id="6715701">)</span>&nbsp;<span class="op" id="6715703">!=</span>&nbsp;<span class="num" id="6715706">0</span>&nbsp;<span class="op" id="6715708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715713">t</span><span class="op" id="6715714">.</span><span class="ident" id="6715715">Skip</span><span class="op" id="6715719">(</span><span class="string" id="6715720">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6715749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715760">raddr</span>&nbsp;<span class="op" id="6715766">:=</span>&nbsp;<span class="op" id="6715769">&amp;</span><span class="ident" id="6715770">IPAddr</span><span class="op" id="6715776">{</span><span class="ident" id="6715777">IP</span><span class="op" id="6715779">:</span>&nbsp;<span class="ident" id="6715781">IPv4</span><span class="op" id="6715785">(</span><span class="num" id="6715786">127</span><span class="op" id="6715789">,</span>&nbsp;<span class="num" id="6715791">0</span><span class="op" id="6715792">,</span>&nbsp;<span class="num" id="6715794">0</span><span class="op" id="6715795">,</span>&nbsp;<span class="num" id="6715797">1</span><span class="op" id="6715798">)</span><span class="op" id="6715799">.</span><span class="ident" id="6715800">To4</span><span class="op" id="6715803">(</span><span class="op" id="6715804">)</span><span class="op" id="6715805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715808">c</span><span class="op" id="6715809">,</span>&nbsp;<span class="ident" id="6715811">err</span>&nbsp;<span class="op" id="6715815">:=</span>&nbsp;<span class="ident" id="6715818">DialIP</span><span class="op" id="6715824">(</span><span class="string" id="6715825">&#34;ip:tcp&#34;</span><span class="op" id="6715833">,</span>&nbsp;<span class="op" id="6715835">&amp;</span><span class="ident" id="6715836">IPAddr</span><span class="op" id="6715842">{</span><span class="ident" id="6715843">IP</span><span class="op" id="6715845">:</span>&nbsp;<span class="ident" id="6715847">IPv4</span><span class="op" id="6715851">(</span><span class="num" id="6715852">127</span><span class="op" id="6715855">,</span>&nbsp;<span class="num" id="6715857">0</span><span class="op" id="6715858">,</span>&nbsp;<span class="num" id="6715860">0</span><span class="op" id="6715861">,</span>&nbsp;<span class="num" id="6715863">1</span><span class="op" id="6715864">)</span><span class="op" id="6715865">}</span><span class="op" id="6715866">,</span>&nbsp;<span class="ident" id="6715868">raddr</span><span class="op" id="6715873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715876">if</span>&nbsp;<span class="ident" id="6715879">err</span>&nbsp;<span class="op" id="6715883">!=</span>&nbsp;<span class="builtintype" id="6715886">nil</span>&nbsp;<span class="op" id="6715890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715894">t</span><span class="op" id="6715895">.</span><span class="ident" id="6715896">Fatalf</span><span class="op" id="6715902">(</span><span class="string" id="6715903">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6715922">,</span>&nbsp;<span class="ident" id="6715924">err</span><span class="op" id="6715927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6715930">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715933">defer</span>&nbsp;<span class="ident" id="6715939">c</span><span class="op" id="6715940">.</span><span class="ident" id="6715941">Close</span><span class="op" id="6715946">(</span><span class="op" id="6715947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6715950">if</span>&nbsp;<span class="op" id="6715953">!</span><span class="ident" id="6715954">reflect</span><span class="op" id="6715961">.</span><span class="ident" id="6715962">DeepEqual</span><span class="op" id="6715971">(</span><span class="ident" id="6715972">raddr</span><span class="op" id="6715977">,</span>&nbsp;<span class="ident" id="6715979">c</span><span class="op" id="6715980">.</span><span class="ident" id="6715981">RemoteAddr</span><span class="op" id="6715991">(</span><span class="op" id="6715992">)</span><span class="op" id="6715993">)</span>&nbsp;<span class="op" id="6715995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715999">t</span><span class="op" id="6716000">.</span><span class="ident" id="6716001">Fatalf</span><span class="op" id="6716007">(</span><span class="string" id="6716008">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6716031">,</span>&nbsp;<span class="ident" id="6716033">c</span><span class="op" id="6716034">.</span><span class="ident" id="6716035">RemoteAddr</span><span class="op" id="6716045">(</span><span class="op" id="6716046">)</span><span class="op" id="6716047">,</span>&nbsp;<span class="ident" id="6716049">raddr</span><span class="op" id="6716054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716057">}</span><br>
<span class="lineno"></span><span class="op" id="6716059">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
